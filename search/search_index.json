{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"home","text":"<p> \u7ea6 0 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u4e0d\u5230 1 \u5206\u949f</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/1-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/","title":"1-\u76ee\u5f55\u7ed3\u6784","text":"<p> \u7ea6 922 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 18 \u5206\u949f</p> <p>\u5206\u533a\u8bbe\u7f6e\uff1aboot\u3001swap\u3001\u6839\u5206\u533a</p> <p>\u6839\u5206\u533a\u76ee\u5f55\u7ed3\u6784\uff1a </p> <p>/bin\uff1a binaries\uff0c\u8fd9\u4e2a\u76ee\u5f55\u5b58\u653e\u7740\u7ecf\u5e38\u4f7f\u7528\u7684\u547d\u4ee4\u3002</p> <p>/boot\uff1a \u5b58\u653e\u7684\u662f\u542f\u52a8 Linux \u65f6\u4f7f\u7528\u7684\u4e00\u4e9b\u6838\u5fc3\u6587\u4ef6\uff0c\u5305\u62ec\u4e00\u4e9b\u8fde\u63a5\u6587\u4ef6\u4ee5\u53ca\u955c\u50cf\u6587\u4ef6\u3002</p> <p>/dev \uff1a device\uff0c\u8be5\u76ee\u5f55\u4e0b\u5b58\u653e\u7684\u662f Linux \u7684\u5916\u90e8\u8bbe\u5907\uff0c\u5728 Linux \u4e2d\u8bbf\u95ee\u8bbe\u5907\u7684\u65b9\u5f0f\u548c\u8bbf\u95ee\u6587\u4ef6\u7684\u65b9\u5f0f\u662f\u76f8\u540c\u7684\u3002</p> <p>/etc\uff1a etcetera(\u7b49\u7b49)\uff0c\u8fd9\u4e2a\u76ee\u5f55\u7528\u6765\u5b58\u653e\u6240\u6709\u7684\u7cfb\u7edf\u7ba1\u7406\u6240\u9700\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u548c\u5b50\u76ee\u5f55\u3002</p> <p>/home\uff1a \u7528\u6237\u7684\u4e3b\u76ee\u5f55\uff0c\u5728 Linux \u4e2d\uff0c\u6bcf\u4e2a\u7528\u6237\u90fd\u6709\u4e00\u4e2a\u81ea\u5df1\u7684\u76ee\u5f55\uff0c\u8be5\u76ee\u5f55\u540d\u662f\u4ee5\u7528\u6237\u7684\u8d26\u53f7\u547d\u540d\u3002</p> <p>/lib\uff1a library\uff0c\u8fd9\u4e2a\u76ee\u5f55\u91cc\u5b58\u653e\u7740\u7cfb\u7edf\u6700\u57fa\u672c\u7684\u52a8\u6001\u8fde\u63a5\u5171\u4eab\u5e93\uff0c\u5176\u4f5c\u7528\u7c7b\u4f3c\u4e8e Windows \u91cc\u7684 DLL \u6587\u4ef6\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u5e94\u7528\u7a0b\u5e8f\u90fd\u9700\u8981\u7528\u5230\u8fd9\u4e9b\u5171\u4eab\u5e93\u3002</p> <p>/lost+found\uff1a \u8fd9\u4e2a\u76ee\u5f55\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u7a7a\u7684\uff0c\u5f53\u7cfb\u7edf\u975e\u6cd5\u5173\u673a\u540e\uff0c\u8fd9\u91cc\u5c31\u5b58\u653e\u4e86\u4e00\u4e9b\u6587\u4ef6\u3002</p> <p>/media\uff1a linux \u7cfb\u7edf\u4f1a\u81ea\u52a8\u8bc6\u522b\u4e00\u4e9b\u8bbe\u5907\uff0c\u4f8b\u5982U\u76d8\u3001\u5149\u9a71\u7b49\u7b49\uff0c\u5f53\u8bc6\u522b\u540e\uff0cLinux \u4f1a\u628a\u8bc6\u522b\u7684\u8bbe\u5907\u6302\u8f7d\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u3002</p> <p>/mnt\uff1a mount\uff0c\u7cfb\u7edf\u63d0\u4f9b\u8be5\u76ee\u5f55\u662f\u4e3a\u4e86\u8ba9\u7528\u6237\u4e34\u65f6\u6302\u8f7d\u522b\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5149\u9a71\u6302\u8f7d\u5728 /mnt/ \u4e0a\uff0c\u7136\u540e\u8fdb\u5165\u8be5\u76ee\u5f55\u5c31\u53ef\u4ee5\u67e5\u770b\u5149\u9a71\u91cc\u7684\u5185\u5bb9\u4e86\u3002</p> <p>/opt\uff1a optional\uff0c\u8fd9\u662f\u7ed9\u4e3b\u673a\u989d\u5916\u5b89\u88c5\u8f6f\u4ef6\u6240\u6446\u653e\u7684\u76ee\u5f55\uff0c\u6bd4\u5982\u4f60\u5b89\u88c5\u4e00\u4e2aORACLE\u6570\u636e\u5e93\u5219\u5c31\u53ef\u4ee5\u653e\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u9ed8\u8ba4\u662f\u7a7a\u7684\u3002</p> <p>/proc\uff1a process\uff0c/proc \u662f\u4e00\u4e2a\u4f2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u8fd9\u4e2a\u76ee\u5f55\u7684\u5185\u5bb9\u4e0d\u5728\u786c\u76d8\u4e0a\u800c\u662f\u5728\u5185\u5b58\u91cc\uff0c\u91cc\u9762\u7684\u4e00\u7cfb\u5217\u7279\u6b8a\u6587\u4ef6\u5b58\u50a8\u7684\u662f\u5f53\u524d\u7cfb\u7edf\u4e2d\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u8fd0\u884c\u7684\u72b6\u6001\u7b49\u4fe1\u606f\uff0c\u6bd4\u5982\u67e5\u770b\u8fdb\u7a0b\u72b6\u6001\uff1acat /proc//status\uff0c\u6ce8\u610f\uff0c\u9700\u8981\u5148\u901a\u8fc7ps\u547d\u4ee4\u67e5\u5230\u67d0\u4e2a\u8fdb\u7a0b\u7684pid\u3002 <p>/root\uff1a \u8be5\u76ee\u5f55\u4e3a\u7cfb\u7edf\u7ba1\u7406\u5458(\u4e5f\u79f0\u4f5c\u8d85\u7ea7\u6743\u9650\u8005)\u7684\u7528\u6237\u4e3b\u76ee\u5f55\u3002</p> <p>/run\uff1a \u662f\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b58\u50a8\u7cfb\u7edf\u542f\u52a8\u4ee5\u6765\u7684\u4fe1\u606f\u3002\u5f53\u7cfb\u7edf\u91cd\u542f\u65f6\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5e94\u8be5\u88ab\u5220\u6389\u6216\u6e05\u9664\uff0c\u5982\u679c\u4f60\u7684\u7cfb\u7edf\u4e0a\u6709 /var/run \u76ee\u5f55\uff0c\u5e94\u8be5\u8ba9\u5b83\u6307\u5411 run\u3002</p> <p>/sbin\uff1a s \u662f Super User \u7684\u610f\u601d\uff0c\u6240\u4ee5sbin\u662f Superuser Binaries \u7684\u7f29\u5199\uff0c\u8fd9\u91cc\u5b58\u653e\u7684\u662f\u7cfb\u7edf\u7ba1\u7406\u5458\u4f7f\u7528\u7684\u7cfb\u7edf\u7ba1\u7406\u7a0b\u5e8f\u3002</p> <p>/selinux\uff1a \u8fd9\u4e2a\u76ee\u5f55\u662f Redhat/CentOS \u6240\u7279\u6709\u7684\u76ee\u5f55\uff0cSelinux \u662f\u4e00\u4e2a\u5b89\u5168\u673a\u5236\uff0c\u7c7b\u4f3c\u4e8e windows \u7684\u9632\u706b\u5899\uff0c\u4f46\u662f\u8fd9\u5957\u673a\u5236\u6bd4\u8f83\u590d\u6742\uff0c\u8fd9\u4e2a\u76ee\u5f55\u5c31\u662f\u5b58\u653eselinux\u76f8\u5173\u7684\u6587\u4ef6\u7684\u3002</p> <p>/srv\uff1a services\uff0c\u8be5\u76ee\u5f55\u5b58\u653e\u4e00\u4e9b\u670d\u52a1\u542f\u52a8\u4e4b\u540e\u9700\u8981\u63d0\u53d6\u7684\u6570\u636e\u3002</p> <p>/sys\uff1a system\uff0c\u8fd9\u662f Linux2.6 \u5185\u6838\u7684\u4e00\u4e2a\u5f88\u5927\u7684\u53d8\u5316\uff0c\u8be5\u76ee\u5f55\u4e0b\u5b89\u88c5\u4e86 2.6 \u5185\u6838\u4e2d\u65b0\u51fa\u73b0\u7684\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf sysfs \u3002sysfs \u6587\u4ef6\u7cfb\u7edf\u96c6\u6210\u4e86\u4e0b\u97623\u79cd\u6587\u4ef6\u7cfb\u7edf\u7684\u4fe1\u606f\uff1a\u9488\u5bf9\u8fdb\u7a0b\u4fe1\u606f\u7684 proc \u6587\u4ef6\u7cfb\u7edf\u3001\u9488\u5bf9\u8bbe\u5907\u7684 devfs \u6587\u4ef6\u7cfb\u7edf\u4ee5\u53ca\u9488\u5bf9\u4f2a\u7ec8\u7aef\u7684 devpts \u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>/tmp\uff1a temporary\uff0c\u8fd9\u4e2a\u76ee\u5f55\u662f\u7528\u6765\u5b58\u653e\u4e00\u4e9b\u4e34\u65f6\u6587\u4ef6\u7684\u3002</p> <p>/usr\uff1a unix system resources\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u76ee\u5f55\uff0c\u7c7b\u4f3c\u4e8e windows \u4e0b\u7684 program files \u76ee\u5f55\u3002 /usr/bin\uff1a\u7cfb\u7edf\u7528\u6237\u4f7f\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 /usr/sbin\uff1a\u8d85\u7ea7\u7528\u6237\u4f7f\u7528\u7684\u6bd4\u8f83\u9ad8\u7ea7\u7684\u7ba1\u7406\u7a0b\u5e8f\u548c\u7cfb\u7edf\u5b88\u62a4\u7a0b\u5e8f\u3002 /usr/src\uff1a\u5185\u6838\u6e90\u4ee3\u7801\u9ed8\u8ba4\u7684\u653e\u7f6e\u76ee\u5f55\u3002</p> <p>/var\uff1a variable\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e2d\u5b58\u653e\u7740\u5728\u4e0d\u65ad\u6269\u5145\u7740\u7684\u4e1c\u897f\uff0c\u6211\u4eec\u4e60\u60ef\u5c06\u90a3\u4e9b\u7ecf\u5e38\u88ab\u4fee\u6539\u7684\u76ee\u5f55\u653e\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u5305\u62ec\u5404\u79cd\u65e5\u5fd7\u6587\u4ef6\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/10-shell%E8%84%9A%E6%9C%AC%E7%AE%80%E4%BB%8B/","title":"10-shell\u811a\u672c\u7b80\u4ecb","text":"<p> \u7ea6 385 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>shell\u662f\u4e00\u4e2a\u7528c\u8bed\u8a00\u7f16\u5199\u7684\u547d\u4ee4\u89e3\u91ca\u5668\uff0c\u7528\u4e8e\u63a5\u6536\u7528\u6237\u7684\u547d\u4ee4\uff0c\u7136\u540e\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\uff0c\u4e0eJava\u3001python\u7b49\u9ad8\u7ea7\u8bed\u8a00\u7684\u89e3\u91ca\u5668\u7c7b\u4f3c\u3002\u6253\u5f00\u4e00\u4e2a\u63a7\u5236\u53f0\u5176\u5b9e\u5c31\u662f\u542f\u52a8\u4e86\u4e00\u4e2a\u53ef\u4ee5\u548c\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\u7684shell\u8fdb\u7a0b\uff0c\u4f7f\u7528bash\u6216sh\u547d\u4ee4\u6267\u884c\u4e00\u4e2ashell\u811a\u672c\uff0c\u5176\u5b9e\u662f\u542f\u52a8\u4e86\u53e6\u5916\u4e00\u4e2ashell\u8fdb\u7a0b\u6765\u6267\u884c\u811a\u672c\u4e2d\u547d\u4ee4\u3002 Linux \u7684 \u6709\u5f88\u591a\u4e0d\u540c\u7684 Shell\uff0c\u5e38\u89c1\u7684\u6709\uff1a</p> <ul> <li>Bourne Shell\uff08/usr/bin/sh\u6216/bin/sh\uff09</li> <li>Bourne Again Shell\uff08/bin/bash\uff09</li> <li>C Shell\uff08/usr/bin/csh\uff09</li> <li>K Shell\uff08/usr/bin/ksh\uff09</li> <li>Shell for Root\uff08/sbin/sh\uff09</li> </ul> <p>centos\u63d0\u4f9b\u7684Shell\u89e3\u6790\u5668\u6709\uff1a Text Only<pre><code>cat /etc/shells\n</code></pre> Text Only<pre><code>/bin/sh\n/bin/bash\n/usr/bin/sh\n/usr/bin/bash\n</code></pre> bash\u548csh\u7684\u5173\uff0c\u5176\u5b9e\u90fd\u662fbash Text Only<pre><code>ll /usr/bin/ | grep bash\n</code></pre> Text Only<pre><code>-rwxr-xr-x. 1 root root\u00a0\u00a0\u00a01150584 5\u6708\u00a0\u00a027 11:11 bash\nlrwxrwxrwx. 1 root root\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04 5\u6708\u00a0\u00a027 11:11 sh -&gt; bash\n</code></pre> \u67e5\u770b\u9ed8\u8ba4shell Text Only<pre><code>echo $SHELL\n</code></pre> Text Only<pre><code>/bin/bash\n</code></pre></p> <p>\u6267\u884cshell\u811a\u672c\u7684\u4e24\u79cd\u65b9\u5f0f 1.\u4f7f\u7528bash\u6216sh\u547d\u4ee4\uff0c\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6267\u884c\u811a\u672c\uff0c\u4e0d\u9700\u8981\u811a\u672c\u6709\u53ef\u6267\u884c\u6743\u9650\uff0c\u5728\u811a\u672c\u7684\u7b2c\u4e00\u884c\u6307\u5b9a\u89e3\u91ca\u5668\u4fe1\u606f\u6ca1\u7528 Text Only<pre><code>bash test.sh\n</code></pre> Text Only<pre><code>sh test.sh\n</code></pre> 2.\u52a0\u4e0a\u53ef\u6267\u884c\u6743\u9650\u4e4b\u540e Text Only<pre><code>./tesh.sh\n</code></pre> \u4e00\u5b9a\u8981\u5199\u6210 ./test.sh\uff0c\u800c\u4e0d\u662f test.sh\uff0c\u8fd0\u884c\u5176\u5b83\u53ef\u6267\u884c\u7684\u7a0b\u5e8f\u4e5f\u4e00\u6837\uff0c\u76f4\u63a5\u5199 test.sh\uff0clinux \u7cfb\u7edf\u4f1a\u53bb PATH \u91cc\u5bfb\u627e\u6709\u6ca1\u6709\u53eb test.sh \u7684\uff0c\u800c\u53ea\u6709 /bin\uff0c/sbin\uff0c/usr/bin\uff0c/usr/sbin \u7b49\u5728 PATH \u91cc\uff0c\u4f60\u7684\u5f53\u524d\u76ee\u5f55\u901a\u5e38\u4e0d\u5728 PATH \u91cc\uff0c\u6240\u4ee5\u5199\u6210 test.sh \u662f\u4f1a\u627e\u4e0d\u5230\u547d\u4ee4\u7684\uff0c\u8981\u7528 ./test.sh \u544a\u8bc9\u7cfb\u7edf\u8bf4\uff0c\u5c31\u5728\u5f53\u524d\u76ee\u5f55\u627e\u3002</p> <p>\u811a\u672c\u4ee5#!/bin/bash\u5f00\u5934\uff0c\u7528\u4e8e\u6307\u5b9a\u89e3\u6790\u5668</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/10-shell%E8%84%9A%E6%9C%AC%E7%AE%80%E4%BB%8B/#_1","title":"\u7528\u4e8e\u6ce8\u91ca","text":""},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/11-shell%E5%8F%98%E9%87%8F/","title":"11-shell\u53d8\u91cf","text":"<p> \u7ea6 1610 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 32 \u5206\u949f</p> <p>\u53d8\u91cf \u5b9a\u4e49\u53d8\u91cf\uff0c\u6ce8\u610f\u7b49\u53f7\u4e24\u8fb9\u4e0d\u80fd\u6709\u7a7a\u683c Text Only<pre><code>a=2\n</code></pre> \u4f7f\u7528\u53d8\u91cf\u9700\u8981\u5728\u53d8\u91cf\u540d\u524d\u52a0\u4e0a$\uff0c\u8fd8\u53ef\u4ee5\u52a0\u4e0a{}\uff0c\u52a0\u82b1\u62ec\u53f7\u662f\u53ef\u9009\u7684 Text Only<pre><code>echo $a\necho ${a}=2\n</code></pre></p> <p>\u5728bash\u4e2d\uff0c\u53d8\u91cf\u7684\u503c\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff08\u6240\u4ee5\u65e0\u6cd5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u8fd0\u7b97\uff09\uff0c\u6240\u4ee5\u5b57\u7b26\u4e32\u53ef\u4ee5\u4e0d\u7528\u5f15\u53f7\uff0c\u4f46\u662f\u53d8\u91cf\u7684\u503c\u5982\u679c\u6709\u7a7a\u683c\uff0c\u9700\u8981\u4f7f\u7528\u53cc\u5f15\u53f7\u6216\u5355\u5f15\u53f7\u62ec\u8d77\u6765 Text Only<pre><code>#!/bin/bash\na=100\necho '$a'\necho \"$a\"\necho \"'$a'\"\necho '\"$a\"'\n</code></pre> Text Only<pre><code>$a\n100\n'100'\n\"$a\n</code></pre> \u603b\u7ed3\uff0c\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u7684\u533a\u522b\uff1a</p> <ul> <li>\u5355\u5f15\u53f7\u91cc\u7684\u4efb\u4f55\u5b57\u7b26\u90fd\u4f1a\u539f\u6837\u8f93\u51fa\uff0c\u8f6c\u4e49\u5b57\u7b26\u6216\u8005\u662f\u53d6\u53d8\u91cf\u503c\u90fd\u4e0d\u884c</li> <li>\u53cc\u5f15\u53f7\u91cc\u53ef\u4ee5\u53d6\u53d8\u91cf\u503c\uff0c\u4e5f\u53ef\u4ee5\u6709\u8f6c\u4e49\u5b57\u7b26\uff0c\u6ce8\u610f\u53cc\u5f15\u53f7\u5d4c\u5957\u5355\u5f15\u53f7\uff0c\u5355\u5f15\u53f7\u53ea\u662f\u53cc\u5f15\u53f7\u91cc\u9762\u7684\u666e\u901a\u5b57\u7b26</li> </ul> <p>\u53cd\u5f15\u53f7 \u53cd\u5f15\u53f7\u4f1a\u628a\u53cd\u5f15\u53f7\u4e2d\u7684\u5185\u5bb9\u4f5c\u4e3a\u547d\u4ee4\u6267\u884c\u4e00\u904d\uff0c\u7136\u540e\u628a\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c\u4f5c\u4e3a\u53cd\u5f15\u53f7\u6700\u7ec8\u7684\u5185\u5bb9\uff0c\\(() \u4e0e \u53cd\u5f15\u53f7 \u7684\u4f5c\u7528\u4e00\u6837\u3002 \u6bd4\u5982\uff1a Text Only<pre><code># date\n2021\u5e74 11\u6708 06\u65e5 \u661f\u671f\u516d 07:09:10 EDT\n</code></pre> \u53cd\u5f15\u53f7\u628adate\u7684\u8f93\u51fa\u7ed3\u679c\u4f5c\u4e3a\u53cd\u5f15\u53f7\u6700\u7ec8\u7684\u5185\u5bb9\uff0c\u7136\u540e\u4ea4\u7ed9shell\u4f5c\u4e3a\u547d\u4ee4\u6267\u884c\uff1a Text Only<pre><code># `date`\n-bash: 2021\u5e74: \u672a\u627e\u5230\u547d\u4ee4\n</code></pre> \u518d\u6bd4\u5982\uff0c\\)[1+1]\u8ba1\u7b97\u5f972\uff0c\u7136\u540e\u53cd\u5f15\u53f7\u628a2\u4f5c\u4e3a\u547d\u4ee4\u6267\u884c\uff0c$[1+1]\u7684\u8ba1\u7b97\u5e76\u4e0d\u662f\u4e00\u6761\u547d\u4ee4 Text Only<pre><code># echo `$[1+1]`\n-bash: 2: \u672a\u627e\u5230\u547d\u4ee4\n</code></pre> \u518d\u6bd4\u5982\uff0c\u53cd\u5f15\u53f7\u628a\u51fd\u6570fun\u7684\u8f93\u51fa\u7ed3\u679c\u4f5c\u4e3a\u53cd\u5f15\u53f7\u6700\u7ec8\u7684\u5185\u5bb9\uff0c\u7136\u540e\u8d4b\u503c\u7ed9\u4e86\u53d8\u91cfa Text Only<pre><code># fun(){\n&gt; echo 123\n&gt; echo 456\n&gt; return 111\n&gt; }\n#a=`fun`\n# echo $a\n123 456\n</code></pre></p> <p>\u53ea\u8bfb\u53d8\u91cf \u4f7f\u7528 readonly \u547d\u4ee4\u53ef\u4ee5\u5c06\u53d8\u91cf\u5b9a\u4e49\u4e3a\u53ea\u8bfb\u53d8\u91cf\uff0c\u53ea\u8bfb\u53d8\u91cf\u7684\u503c\u4e0d\u80fd\u88ab\u6539\u53d8 Text Only<pre><code>readonly b=3\n</code></pre></p> <p>\u5220\u9664\u53d8\u91cf \u4f7f\u7528 unset \u547d\u4ee4\u53ef\u4ee5\u5220\u9664\u53d8\u91cf\uff0c\u6ce8\u610freadonly\u53d8\u91cf\u4e0d\u80fd\u88abunset\uff0c\u9664\u975e\u9000\u51fa\u5f53\u524dshell\u8fdb\u7a0b\u624d\u80fd\u9500\u6bc1\u53ea\u8bfb\u53d8\u91cf Text Only<pre><code>unset a\n</code></pre></p> <p>\u6570\u7ec4 Text Only<pre><code>\u6570\u7ec4\u540d=(\u503c1 \u503c2 ... \u503cn)\n</code></pre> \u4f8b\u5982\uff1a Text Only<pre><code>array_name=(value0 value1 value2 value3)\n</code></pre> \u8fd8\u53ef\u4ee5\u5355\u72ec\u5b9a\u4e49\u6570\u7ec4\u7684\u5404\u4e2a\u5206\u91cf\uff1a Text Only<pre><code>array_name[0]=value0\narray_name[1]=value1\n</code></pre> \u8bfb\u53d6\u6570\u7ec4\u5143\u7d20\uff1a Text Only<pre><code>echo $array_name[1]\n</code></pre> Text Only<pre><code>echo ${array_name[@]}\n</code></pre> \u4f7f\u7528 @ \u7b26\u53f7\u53ef\u4ee5\u83b7\u53d6\u6570\u7ec4\u4e2d\u7684\u6240\u6709\u5143\u7d20\uff0c\u5fc5\u987b\u52a0\u4e0a{}\uff1a Text Only<pre><code>echo ${array_name[@]}\n</code></pre></p> <p>\u53d8\u91cf\u7684\u79cd\u7c7b \u672c\u5730\u53d8\u91cf\uff1a\u76f4\u63a5\u5b9a\u4e49\u7684\u53d8\u91cf\u5c31\u662f\u672c\u5730\u53d8\u91cf\uff0c\u53ea\u5728\u5f53\u524dshell\u8fdb\u7a0b\u4e2d\u6709\u6548\u3002 \u73af\u5883\u53d8\u91cf\uff1a\u5bf9\u5f53\u524dshell\u53ca\u5b50shell\u90fd\u6709\u6548\u7684\u53d8\u91cf\uff0c\u9700\u8981\u4f7f\u7528export\u5b9a\u4e49\uff0c\u73af\u5883\u53d8\u91cf\u4e00\u822c\u90fd\u5927\u5199\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u5b50shell\u8fdb\u7a0b\u662f\u5c06\u73af\u5883\u53d8\u91cf\u62f7\u8d1d\u4e86\u4e00\u4efd\u526f\u672c\u5230\u81ea\u5df1\u7684\u8fdb\u7a0b\u4e2d\u4e86\uff0c\u6240\u4ee5\u5728\u5b50shell\u4e2d\u4fee\u6539\u73af\u5883\u53d8\u91cf\u7684\u503c\u5e76\u4e0d\u4f1a\u6539\u53d8\u7236shell\u4e2d\u73af\u5883\u53d8\u91cf\u7684\u503c\u3002 Text Only<pre><code>export XX=abc\n</code></pre> \u6211\u4eec\u77e5\u9053\uff0c\u6253\u5f00\u4e00\u4e2a\u63a7\u5236\u53f0\u5176\u5b9e\u5c31\u662f\u542f\u52a8\u4e86\u4e00\u4e2a\u53ef\u4ee5\u548c\u7528\u6237\u8fdb\u884c\u4ea4\u4e92\u7684shell\u8fdb\u7a0b\uff0c\u4f7f\u7528bash\u6216sh\u547d\u4ee4\u6267\u884c\u4e00\u4e2ashell\u811a\u672c\uff0c\u5176\u5b9e\u662f\u542f\u52a8\u4e86\u53e6\u5916\u4e00\u4e2ashell\u8fdb\u7a0b\u6765\u6267\u884c\u811a\u672c\u4e2d\u547d\u4ee4\uff0c\u542f\u52a8\u7684\u53e6\u5916\u4e00\u4e2ashell\u5c31\u662f\u5f53\u524dshell\u7684\u5b50\u8fdb\u7a0b\uff0c\u5728\u5f53\u524dshell\u4e2d\u5b9a\u4e49\u7684\u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u5728\u5b50\u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff0c\u5728\u5b50shell\u4e2d\u4fee\u6539\u8be5\u73af\u5883\u53d8\u91cf\u7684\u503c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230\u7236shell\uff0c\u56e0\u4e3a\u5b50shell\u76f8\u5f53\u4e8e\u662f\u628a\u73af\u5883\u53d8\u91cf\u5728\u81ea\u5df1\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u590d\u5236\u4e86\u4e00\u4efd\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0cLinux\u5728\u5b9e\u73b0\u65f6\u5176\u5b9e\u5e76\u6ca1\u6709\u771f\u6b63\u590d\u5236\uff0c\u800c\u662f\u91c7\u7528\u5199\u65f6\u590d\u5236\u7684\u7b56\u7565\uff0c\u5199\u65f6\u590d\u5236\u7684\u5177\u4f53\u5b9e\u73b0\u662f\uff0c\u5728\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u53ea\u628a\u9875\u8868\u590d\u5236\u4e00\u4efd\uff0c\u4e5f\u5c31\u662f\u4e24\u4e2a\u8fdb\u7a0b\u7684\u5206\u9875\u6307\u5411\u4e86\u76f8\u540c\u7684\u7269\u7406\u5185\u5b58\uff0c\u5f53\u5b50\u8fdb\u7a0b\u4fee\u6539\u53d8\u91cf\u7684\u503c\u65f6\uff0cLinux\u4f1a\u5148\u628a\u53d8\u91cf\u590d\u5236\u4e00\u4efd\uff0c\u7136\u540e\u4fee\u6539\u518d\u4fee\u6539\u53d8\u91cf\u7684\u503c\uff0c\u6700\u540e\u518d\u4fee\u6539\u5b50\u8fdb\u7a0b\u9875\u8868\u7684\u6307\u5411\u3002 \u7528\u6237\u5728/etc/profile\u7b49\u6587\u4ef6\u4e2d\u914d\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u548c\u8fd9\u91cc\u8bf4\u7684\u73af\u5883\u53d8\u91cf\u662f\u4e00\u56de\u4e8b\uff0c\u6bcf\u6b21\u542f\u52a8\u4e00\u4e2a\u65b0shell\u65f6\u90fd\u4f1a\u5148\u52a0\u8f7d\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5982/etc/profile\uff0c/etc/profile.d/*.sh\uff0c~/.bashrc\uff0c~/.bash_profile\uff0c\u6240\u4ee5\u5728\u8fd9\u91cc\u914d\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u662f\u5168\u5c40\u7684\u3002 bash\u7684\u8fd0\u884c\u6a21\u5f0f\u53ef\u5206\u4e3alogin shell\u548cnon-login shell\u3002\u901a\u8fc7\u7ec8\u7aef\u767b\u5f55\u7684\u662f\u4e00\u4e2alogin shell\uff0c\u901a\u8fc7ssh\u767b\u5f55\u7684\u662f\u4e00\u4e2anon-login shell\u3002\u8fd9\u4e24\u79cdshell\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff0c\u5b83\u4eec\u542f\u52a8\u65f6\u4f1a\u52a0\u8f7d\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\uff0clogin shell\u542f\u52a8\u65f6\u4f1a\u52a0\u8f7d/etc/profile\uff0c~/.bash_profile\uff0c~/.bashrc\uff0cnon-login shell\u542f\u52a8\u65f6\u4f1a\u52a0\u8f7d~/.bashrc\u3002 \u800c\u5728\u52a0\u8f7d~/.bashrc\uff08\u5b9e\u9645\u662f~/.bashrc\u4e2d\u52a0\u8f7d\u7684/etc/bashrc\uff09\u6216 /etc/profile \u65f6\uff0c\u90fd\u4f1a\u6267\u884c\u5982\u4e0b\u4ee3\u7801\u7247\u6bb5\uff1a Text Only<pre><code>for i in /etc/profile.d/*.sh /etc/profile.d/sh.local ; do\n\u00a0\u00a0\u00a0\u00a0if [ -r \"$i\" ]; then\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if [ \"${-#*i}\" != \"$-\" ]; then\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0. \"$i\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0. \"$i\" &gt;/dev/null\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fi\n\u00a0\u00a0\u00a0\u00a0fi\ndone\n</code></pre> \u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u7ba1\u662flogin shell\u8fd8\u662fnon-login shell\uff0c\u542f\u52a8\u65f6\u90fd\u4f1a\u52a0\u8f7d/etc/profile.d/*.sh\u4e2d\u914d\u7f6e\u7684\u73af\u5883\u53d8\u91cf\uff0c\u6240\u4ee5\u5efa\u8bae\u7528\u6237\u76f4\u63a5\u5728/etc/profile.d\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a.sh\u6587\u4ef6\u4e13\u95e8\u5b58\u653e\u7528\u6237\u81ea\u5df1\u7684\u6240\u9700\u8981\u5b9a\u4e49\u7684\u73af\u5883\u53d8\u91cf\u3002 \u5e38\u7528\u7684\u7cfb\u7edf\u9884\u5b9a\u4e49\u7684\u73af\u5883\u53d8\u91cf\u6709\uff1a\\(HOME\u3001\\)PWD\u3001\\(SHELL\u3001\\)USER\u3001\\(PATH\u3001\\)HOSTNAME</p> <p>\u7279\u6b8a\u53d8\u91cf \\(n\uff1a**\\)0\u4ee3\u8868\u8be5\u811a\u672c\u540d\u79f0\uff0c\u5176\u5b83\\(n\u90fd\u662f\u53c2\u6570\uff0c\\)1-\\(9\u4ee3\u8868\u7b2c\u4e00\u5230\u7b2c\u4e5d\u4e2a\u53c2\u6570\uff0c\u7b2c\u5341\u4ee5\u4e0a\u7684\u53c2\u6570\u9700\u8981\u4f7f\u7528\u82b1\u62ec\u53f7\\) \\(#**\uff1a\u53c2\u6570\u4e2a\u6570 **\\)?\uff1a\u6700\u540e\u4e00\u6761\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\uff0c0\u8868\u793a\u6ca1\u6709\u9519\u8bef\uff0c\u5176\u4ed6\u4efb\u4f55\u503c\u8868\u660e\u6709\u9519\u8bef\uff1b\u5982\u679c\u6700\u540e\u4e00\u6761\u547d\u4ee4\u6267\u884c\u7684\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u90a3\u4e48\\(?\u8868\u793a\u662f\u51fd\u6570\u9000\u51fa\u72b6\u6001\uff0c\u51fd\u6570return\u7684\u8fd4\u56de\u503c\u5c31\u662f\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\uff0c\u5982\u679c\u51fd\u6570\u6ca1\u6709\u4f7f\u7528return\u8fd4\u56de\uff0c\u90a3\u4e48\u4f1a\u5c06\u51fd\u6570\u7684\u6700\u540e\u4e00\u6761\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u4f5c\u4e3a\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\uff0creturn\u540e\u8ddf\u7684\u6570\u503c\u7684\u8303\u56f4\u662f0-255 **\\)*\uff1a\u8fd9\u4e2a\u53d8\u91cf\u5305\u542b\u6240\u6709\u4f20\u9012\u7684\u53c2\u6570\uff0c\u7528\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u65f6\u5019\uff0c\u4f1a\u4ee5\"\\(1 (2 \u2026 \\(n\"\u7684\u5f62\u5f0f\u8f93\u51fa\u6240\u6709\u53c2\u6570 **\\)@**\uff1a\u4e0e\\)\\*\u4e00\u6837\uff0c\u8fd9\u4e2a\u53d8\u91cf\u5305\u542b\u6240\u6709\u4f20\u9012\u7684\u53c2\u6570\uff0c\u4f46\u662f\u7528\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u65f6\u5019\uff0c\u4f1a\u4ee5\"\\)1\" \"\\(2\" \u2026 \"\\)n\" \u7684\u5f62\u5f0f\u8f93\u51fa\u6240\u6709\u53c2\u6570 \u53c2\u6570\u53ef\u4ee5\u662f\u4f20\u9012\u7ed9shell\u811a\u672c\u7684\u53c2\u6570\uff08\u50cf\u7ed9main\u51fd\u6570\u4f20\u53c2\u4e00\u6837\uff09\uff0c\u4e5f\u53ef\u4ee5\u662f\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u53c2\u6570\u3002 \\(n\u3001\\)#\u3001$?\u6d4b\u8bd5\uff1a Text Only<pre><code>#!/bin/bash\nfunction func1(){\n\u00a0\u00a0echo '$2' = $2\n\u00a0\u00a0return 7\n}\nfunction func2(){\n\u00a0\u00a0echo '$3' = $3\n\u00a0\u00a0echo '$#' = $#\n}\nfunc1 1 2 3 4\necho '$?' = $?\nfunc2 1 2 3 4\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>$2 = 2\n$? = 7\n$3 = 3\n$# = 4\n</code></pre> \\(\\*\u548c\\)@\u6d4b\u8bd5\uff1a Text Only<pre><code>#!/bin/bash\nfunction func1(){\n\u00a0\u00a0echo $*\n\u00a0\u00a0for v in \"$*\"\n\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0echo $v\n\u00a0\u00a0done\n}\nfunction func2(){\n\u00a0\u00a0echo $@\n\u00a0\u00a0for v in \"$@\"\n\u00a0\u00a0do\n\u00a0\u00a0\u00a0echo $v\n\u00a0\u00a0done\n}\nfunc1 1 2 3\nfunc2 1 2 3\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>1 2 3\n1 2 3\n1 2 3\n1\n2\n3\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/12-%E8%BF%90%E7%AE%97%E7%AC%A6/","title":"12-\u8fd0\u7b97\u7b26","text":"<p> \u7ea6 386 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u7b97\u672f\u8fd0\u7b97\u7b26\uff1a+ , - , \\*,\u00a0\u00a0/,\u00a0\u00a0% \uff0c\u6ce8\u610f\u4e58\u6cd5\u5728\u4f7f\u7528\u65f6\u524d\u9762\u8981\u52a0\u4e00\u4e2a\u8f6c\u4e49\u7b26\\ \u5728bash\u4e2d\uff0c\u53d8\u91cf\u7684\u503c\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u6240\u4ee5\u65e0\u6cd5\u76f4\u63a5\u8fdb\u884c\u6570\u503c\u8fd0\u7b97\uff0c\u9700\u8981\u501f\u52a9\u7279\u5b9a\u7684\u8bed\u6cd5\uff1a Text Only<pre><code>$((\u8868\u8fbe\u5f0f))\n</code></pre> \u6216\u8005 Text Only<pre><code>$[\u8868\u8fbe\u5f0f]\n</code></pre> \u6bd4\u5982 Text Only<pre><code># echo $((1+2))\n3\n</code></pre> Text Only<pre><code># a=1\n# b=2\n# echo $((a+b))\n3\n# echo $(($a+$b))\n3\n# echo $[a+b]\n3\n# echo $[$a+$b]\n3\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528expr Text Only<pre><code>expr \u8868\u8fbe\u5f0f\n</code></pre> \u6ce8\u610f\u8fd0\u7b97\u7b26\u7684\u4e24\u8fb9\u90fd\u8981\u6709\u7a7a\u683c Text Only<pre><code># expr 1 + 1\n2\n</code></pre> Text Only<pre><code># expr 1+1\n1+1\n</code></pre> Text Only<pre><code># expr $a + $b\n3\n</code></pre> expr\u4f1a\u628a\u8fd0\u7b97\u7ed3\u679c\u76f4\u63a5\u8f93\u51fa\uff0c\u4e0d\u50cf $((\u8868\u8fbe\u5f0f)) \u548c\u00a0$[\u8868\u8fbe\u5f0f] \u9700\u8981\u501f\u52a9echo Text Only<pre><code># $[$a+$b]\n-bash: 3: \u672a\u627e\u5230\u547d\u4ee4\n</code></pre></p> <p>\u6761\u4ef6\u8fd0\u7b97\u7b26 \u4f7f\u7528\u6761\u4ef6\u8fd0\u7b97\u7b26\u7684\u8bed\u6cd5\u662f[ condition ]\uff0c\u6ce8\u610fcondition\u524d\u540e\u6709\u4e24\u4e2a\u7a7a\u683c\uff0c==\u524d\u540e\u4e5f\u6709\u4e24\u4e2a\u7a7a\u683c\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u5199\u6210 [ aaa == bbb ] \uff0c\u4e0d\u80fd\u5199\u6210[aaa==bbb]\u3002</p> <p>\\== \u548c != \u53ef\u4ee5\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u5b57\u7b26\u4e32\u548c\u6570\u5b57\uff0c0\u8868\u793atrue\uff0c\u975e0\u8868\u793afalse Text Only<pre><code># [ aaa == bbb ]\n# echo $?\n0\n# [ 1 == 2 ]\n# echo $?\n1\n</code></pre></p> <p>\u4ee5\u4e0b\u6761\u4ef6\u8fd0\u7b97\u7b26\u53ea\u80fd\u6bd4\u8f83\u6570\u5b57\uff1a</p> <ul> <li>-eq\uff0c\u7b49\u4e8e</li> <li>-ne\uff0c\u4e0d\u7b49\u4e8e</li> <li>-gt\uff0c\u5927\u4e8e</li> <li>-lt\uff0c\u5c0f\u4e8e</li> <li>-ge\uff0c\u5927\u4e8e\u7b49\u4e8e</li> <li>-le\uff0c\u5c0f\u4e8e\u7b49\u4e8e</li> </ul> Text Only<pre><code># [ 1 -eq 2 ]\n# echo $?\n1\n# [ 1 -ne 2 ]\n# echo $?\n0\n</code></pre> <p>\u5bf9\u6587\u4ef6\u6743\u9650\u8fdb\u884c\u5224\u65ad\u7684\u6761\u4ef6\u8fd0\u7b97\u7b26\uff1a</p> <ul> <li>-r \u6709\u8bfb\u7684\u6743\u9650\uff08read\uff09</li> <li>-w \u6709\u5199\u7684\u6743\u9650\uff08write\uff09</li> <li>-x \u6709\u6267\u884c\u7684\u6743\u9650\uff08execute\uff09</li> </ul> Text Only<pre><code># [ -x test.sh ]\n# echo $?\n1\n</code></pre> <p>\u5bf9\u6587\u4ef6\u7c7b\u578b\u8fdb\u884c\u5224\u65ad\u7684\u6761\u4ef6\u8fd0\u7b97\u7b26\uff1a</p> <ul> <li>-f \u6587\u4ef6\u5b58\u5728\u5e76\u4e14\u662f\u4e00\u4e2a\u5e38\u89c4\u7684\u6587\u4ef6\uff08file\uff09</li> <li>-e \u6587\u4ef6\u5b58\u5728\uff08existence\uff09</li> <li>-d \u6587\u4ef6\u5b58\u5728\u5e76\u662f\u4e00\u4e2a\u76ee\u5f55\uff08directory\uff09</li> </ul> Text Only<pre><code># [ -f test.sh ]\n# echo $?\n0\n</code></pre> <p>\u903b\u8f91\u8fd0\u7b97\u7b26\uff1a</p> <ul> <li>&amp;&amp;\uff0c\u4e0e</li> <li>||\uff0c\u6216</li> </ul>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/13-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/","title":"13-\u6d41\u7a0b\u63a7\u5236","text":"<p> \u7ea6 378 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>if \u5224\u65ad \u6ce8\u610f\uff0cif\u540e\u8981\u6709\u7a7a\u683c Text Only<pre><code>if [ \u6761\u4ef6\u5224\u65ad\u5f0f ];then\n\u00a0\u00a0\u4ee3\u7801\u5757\nelif [ \u6761\u4ef6\u5224\u65ad\u5f0f ];then\n\u00a0\u00a0\u4ee3\u7801\u5757\nelse\u00a0\n\u00a0\u00a0\u4ee3\u7801\u5757\nfi\n</code></pre> \u6216\u8005 Text Only<pre><code>if [ \u6761\u4ef6\u5224\u65ad\u5f0f ]\nthen\n\u00a0 \u00a0\u00a0\u4ee3\u7801\u5757\nelif [ \u6761\u4ef6\u5224\u65ad\u5f0f ]\nthen\n \u4ee3\u7801\u5757\nelse\n \u4ee3\u7801\u5757\nfi\n</code></pre> \u6bd4\u5982 Text Only<pre><code>#!/bin/bash\nif [ $1 -gt 10 ];then\n\u00a0\u00a0echo \"$1 great then 10\"\nelif [ $1 -lt 10 ]\nthen\n\u00a0\u00a0echo \"$1 less then 10\"\nelse\n\u00a0\u00a0echo \"$1 equal 10\"\nfi\n</code></pre></p> <p>case \u8bed\u53e5 Text Only<pre><code>case $\u53d8\u91cf\u540d in\n\u00a0\u00a0\"\u503c1\"\uff09\n\u00a0\u00a0\u00a0\u00a0\u5982\u679c\u53d8\u91cf\u7684\u503c\u7b49\u4e8e\u503c1\uff0c\u5219\u6267\u884c\u4ee3\u7801\u57571\n\u00a0\u00a0\u00a0\u00a0;;\n\u00a0\u00a0\"\u503c2\"\uff09\n\u00a0\u00a0\u00a0\u00a0\u5982\u679c\u53d8\u91cf\u7684\u503c\u7b49\u4e8e\u503c2\uff0c\u5219\u6267\u884c\u4ee3\u7801\u57572\n\u00a0\u00a0\u00a0\u00a0;;\n\u00a0\u00a0\u2026\u7701\u7565\u5176\u4ed6\u5206\u652f\u2026\n\u00a0\u00a0*\uff09\n\u00a0\u00a0\u00a0\u00a0\u5982\u679c\u53d8\u91cf\u7684\u503c\u4e0d\u662f\u4ee5\u4e0a\u7684\u503c\uff0c\u5219\u6267\u884c\u6b64\u4ee3\u7801\u5757\n\u00a0\u00a0\u00a0\u00a0;;\nesac\n</code></pre> \u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>case\u884c\u5c3e\u5fc5\u987b\u4e3a\u5355\u8bcd\u201cin\u201d\uff0c\u6bcf\u4e00\u4e2a\u6a21\u5f0f\u5339\u914d\u5fc5\u987b\u4ee5\u53f3\u62ec\u53f7\u201c\uff09\u201d\u7ed3\u675f</li> <li>\u53cc\u5206\u53f7\u201c;;\u201d\u8868\u793a\u547d\u4ee4\u5e8f\u5217\u7ed3\u675f\uff0c\u76f8\u5f53\u4e8ejava\u4e2d\u7684break</li> <li>\u6700\u540e\u7684\u201c*\uff09\u201d\u8868\u793a\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u76f8\u5f53\u4e8ejava\u4e2d\u7684default</li> </ul> <p>\u6bd4\u5982\uff1a Text Only<pre><code>#!/bin/bash\ncase $1 in\n\"10\")\n\u00a0\u00a0echo equal 10 ;;\n20)\n\u00a0\u00a0echo \"equal 20\" ;;\n*)\n\u00a0\u00a0echo default ;;\nesac\n</code></pre></p> <p>for \u5faa\u73af \u8bed\u6cd5\u4e00\uff1a Text Only<pre><code>for (( \u521d\u59cb\u503c;\u5faa\u73af\u63a7\u5236\u6761\u4ef6;\u53d8\u91cf\u53d8\u5316 ))\n\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u7a0b\u5e8f\n\u00a0\u00a0done\n</code></pre> \u6bd4\u5982\u4ece0\u52a0\u5230100\uff1a Text Only<pre><code>#!/bin/bash\ns=0\nfor(( i=0; i&lt;=100; i++ ))\ndo\n\u00a0\u00a0s=$[$s+$i]\ndone\necho $s\n</code></pre> \u6ce8\u610f\u53ea\u6709\u5728for\u7684\u62ec\u53f7\u91cc\u624d\u652f\u6301 &lt;= \u548c ++\uff0c\u5176\u5b83\u5730\u65b9\u4e0d\u652f\u6301</p> <p>\u8bed\u6cd5\u4e8c\uff1a Text Only<pre><code>for \u53d8\u91cf in \u503c1 \u503c2 \u503c3\u2026\n\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u7a0b\u5e8f\n\u00a0\u00a0done\n</code></pre> \u6bd4\u5982\uff1a Text Only<pre><code>#!/bin/bash\nfor v in 1 2 3\ndo\n\u00a0\u00a0echo $v\ndone\n</code></pre></p> <p>while \u5faa\u73af Text Only<pre><code>while [ \u6761\u4ef6\u5224\u65ad\u5f0f ]\n\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u7a0b\u5e8f\n\u00a0\u00a0done\n</code></pre> \u6bd4\u5982\u4ece0\u52a0\u5230100\uff1a Text Only<pre><code>#!/bin/bash\ni=0\nwhile [ $i -le 100 ]\ndo\n\u00a0\u00a0s=`expr $s + $i`\n\u00a0\u00a0i=$((i+1))\ndone\necho $s\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/14-%20%E5%87%BD%E6%95%B0/","title":"14- \u51fd\u6570","text":"<p> \u7ea6 207 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>\u5e38\u7528\u7cfb\u7edf\u51fd\u6570 1.basename pathname [suffix] \u529f\u80fd\u63cf\u8ff0\uff1abasename\u547d\u4ee4\u4f1a\u5220\u9664\u8def\u5f84\u6700\u540e\u4e00\u4e2a'/'\u5b57\u7b26\u53ca\u524d\u9762\u6240\u6709\u5b57\u7b26\uff0csuffix\u4e3a\u540e\u7f00\uff0c\u5982\u679csuffix\u88ab\u6307\u5b9a\u4e86\uff0cbasename\u4f1a\u5c06suffix\u53bb\u6389\u3002 Text Only<pre><code># basename /root/test.sh\ntest.sh\n# basename /root/test.sh .sh\ntest\n</code></pre></p> <p>2.dirname \u6587\u4ef6\u7edd\u5bf9\u8def\u5f84 \u529f\u80fd\u63cf\u8ff0\uff1a\u4ece\u7ed9\u5b9a\u7684\u5305\u542b\u7edd\u5bf9\u8def\u5f84\u7684\u6587\u4ef6\u540d\u4e2d\u53bb\u9664\u6587\u4ef6\u540d\uff08\u975e\u76ee\u5f55\u7684\u90e8\u5206\uff09\uff0c\u7136\u540e\u8fd4\u56de\u5269\u4e0b\u7684\u8def\u5f84\uff08\u76ee\u5f55\u7684\u90e8\u5206\uff09 Text Only<pre><code># dirname /root/test.sh\n/root\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u51fd\u6570 function\u53ef\u5199\u53ef\u4e0d\u5199 Text Only<pre><code>[ function ] funname()\n{\n\u00a0\u00a0\u00a0\u4ee3\u7801\u5757;\n\u00a0\u00a0\u00a0[return int;]\n}\n</code></pre> \u51fd\u6570return\u7684\u8fd4\u56de\u503c\u662f\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\uff0c\u5982\u679c\u51fd\u6570\u6ca1\u6709\u4f7f\u7528return\u8fd4\u56de\uff0c\u90a3\u4e48\u4f1a\u5c06\u51fd\u6570\u7684\u6700\u540e\u4e00\u6761\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u4f5c\u4e3a\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\uff0creturn\u540e\u8ddf\u7684\u6570\u503c\u7684\u8303\u56f4\u662f0-255\uff0c\u53ef\u4ee5\u7528$?\u62ff\u5230\u51fd\u6570\u7684\u9000\u51fa\u72b6\u6001\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/15-shell%E5%B7%A5%E5%85%B7/","title":"15-shell\u5de5\u5177","text":"<p> \u7ea6 947 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>1.cut \u4ece\u6587\u4ef6\u4e2d\u88c1\u526a\u5b57\u7b26\uff1a Text Only<pre><code>cut -d \u5206\u9694\u7b26 -f \u5217\u53f7(\u4ece1\u5f00\u59cb) \u6587\u4ef6\u540d\n</code></pre> \u6bd4\u5982\u63d0\u53d6\u73af\u5883\u53d8\u91cfPATH\u7684\u7b2c\u4e8c\u4e2a\u503c Text Only<pre><code># echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n# echo $PATH | cut -d : -f 2\n/usr/local/bin\n</code></pre></p> <p>2.sed sed\u7f16\u8f91\u5668\u88ab\u79f0\u4f5c\u6d41\u7f16\u8f91\u5668\uff08 stream editor\uff09\uff0c\u548c\u666e\u901a\u7684\u4ea4\u4e92\u5f0f\u6587\u672c\u7f16\u8f91\u5668\u6070\u597d\u76f8\u53cd\u3002\u5728\u4ea4\u4e92\u5f0f\u6587\u672c\u7f16\u8f91\u5668\u4e2d\uff08\u6bd4\u5982vim\uff09\uff0c\u4f60\u53ef\u4ee5\u7528\u952e\u76d8\u547d\u4ee4\u6765\u4ea4\u4e92\u5f0f\u5730\u63d2\u5165\u3001\u5220\u9664\u6216\u66ff\u6362\u6570\u636e\u4e2d\u7684\u6587\u672c\u3002\u6d41\u7f16\u8f91\u5668\u5219\u4f1a\u5728\u7f16\u8f91\u5668\u5904\u7406\u6570\u636e\u4e4b\u524d\u57fa\u4e8e\u9884\u5148\u63d0\u4f9b\u7684\u4e00\u7ec4\u89c4\u5219\u6765\u7f16\u8f91\u6570\u636e\u6d41\u3002 sed\u7684\u6267\u884c\u8fc7\u7a0b\uff1a (1) \u4e00\u6b21\u4ece\u8f93\u5165\u4e2d\u8bfb\u53d6\u4e00\u884c\u6570\u636e\u3002 (2) \u6839\u636e\u6240\u63d0\u4f9b\u7684\u7f16\u8f91\u5668\u547d\u4ee4\u5339\u914d\u6570\u636e\u3002 (3) \u6309\u7167\u547d\u4ee4\u4fee\u6539\u6d41\u4e2d\u7684\u6570\u636e\u3002 (4) \u5c06\u65b0\u7684\u6570\u636e\u8f93\u51fa\u5230STDOUT\u3002 \u5728\u6d41\u7f16\u8f91\u5668\u5c06\u6240\u6709\u547d\u4ee4\u4e0e\u4e00\u884c\u6570\u636e\u5339\u914d\u5b8c\u6bd5\u540e\uff0c\u5b83\u4f1a\u8bfb\u53d6\u4e0b\u4e00\u884c\u6570\u636e\u5e76\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u3002 sed\u547d\u4ee4\u7684\u683c\u5f0f\u5982\u4e0b\uff1a Text Only<pre><code>sed [\u9009\u9879] \u547d\u4ee4 \u6587\u4ef6\n</code></pre> \u9009\u9879\uff1a-e\uff0c\u6307\u5b9a\u591a\u6761\u547d\u4ee4\uff1b-i \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5e76\u5c06\u5904\u7406\u540e\u7684\u7ed3\u679c\u5199\u56de\u6587\u4ef6 \u547d\u4ee4\uff1aa \u65b0\u589e\u4e00\u884c\uff1bd \u5220\u9664\uff1bs \u67e5\u627e\u5e76\u66ff\u6362</p> <p>\u6570\u636e\uff1a Text Only<pre><code># vim sed.txt\ni\nlove\nyou\n</code></pre> \u65b0\u589e\u4e00\u884c\uff1a Text Only<pre><code># sed '2a\\this is a new line' sed.txt\ni\nlove\nthis is a new line\nyou\n</code></pre> \u5220\u9664\u4e00\u884c\uff1a Text Only<pre><code># sed '2d' sed.txt\ni\nyou\n</code></pre> \u5220\u9664\u5305\u542blove\u7684\u884c\uff1a Text Only<pre><code># sed '/love/d' sed.txt\ni\nyou\n</code></pre> \u628ayou\u66ff\u6362\u6210her\uff1a Text Only<pre><code># sed 's/you/her/g' sed.txt\ni\nlove\nher\n</code></pre> \u5220\u9664\u7b2c\u4e00\u884c\u5e76\u628a\u628ayou\u66ff\u6362\u6210her\uff1a Text Only<pre><code># sed -e '2d' -e 's/you/her/g' sed.txt\ni\nher\n</code></pre></p> <p>3.awk \u4e00\u4e2a\u5f3a\u5927\u7684\u6587\u672c\u5206\u6790\u5de5\u5177\uff0c\u628a\u6587\u4ef6\u9010\u884c\u7684\u8bfb\u5165\uff0c\u4ee5\u7a7a\u683c\u4e3a\u9ed8\u8ba4\u5206\u9694\u7b26\u5c06\u6bcf\u884c\u5207\u7247\uff0c\u5207\u5f00\u7684\u90e8\u5206\u518d\u8fdb\u884c\u5206\u6790\u5904\u7406\u3002 Text Only<pre><code>awk [\u9009\u9879] 'pattern1{action1}\u00a0\u00a0pattern2{action2} ...' filename\n</code></pre></p> <ul> <li>\u9009\u9879\uff1a-F\uff1a\u6307\u5b9a\u5206\u9694\u7b26\uff1b-v \u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf</li> <li>pattern\uff1aawk\u5728\u6570\u636e\u4e2d\u67e5\u627e\u7684\u5185\u5bb9\uff0c\u5c31\u662f\u5339\u914d\u6a21\u5f0f</li> <li>action\uff1a\u5728\u627e\u5230\u5339\u914d\u5185\u5bb9\u65f6\u6240\u6267\u884c\u7684\u4e00\u7cfb\u5217\u547d\u4ee4</li> </ul> <p>awk\u5185\u7f6e\u53d8\u91cf\uff1a Text Only<pre><code>FILENAME\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0awk\u6d4f\u89c8\u7684\u6587\u4ef6\u540d\nNF\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u6d4f\u89c8\u8bb0\u5f55\u7684\u57df\u7684\u4e2a\u6570\uff08\u5207\u5272\u540e\uff0c\u5217\u7684\u4e2a\u6570\uff09\nNR\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5df2\u8bfb\u7684\u8bb0\u5f55\u6570\n</code></pre></p> <p>\u641c\u7d22/etc/passwd\u6587\u4ef6\u4ee5root\u5173\u952e\u5b57\u5f00\u5934\u7684\u6240\u6709\u884c\uff0c\u5e76\u8f93\u51fa\u8be5\u884c\u7684\u7b2c1\u5217\u548c\u7b2c7\u5217\uff0c\u4e2d\u95f4\u4ee5 \",\" \u53f7\u5206\u5272\uff0c\u6ce8\u610f\\(0\u662f\u5f53\u524d\u884c\u7684\u5185\u5bb9\uff0c\\)1\u662f\u5206\u5272\u540e\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c$7\u662f\u5206\u5272\u540e\u7684\u7b2c7\u4e2a\u5143\u7d20\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 Text Only<pre><code># awk -F : '/^root/{print $1\",\"$7}' /etc/passwd\nroot,/bin/bash\n</code></pre></p> <p>\u53ea\u663e\u793a/etc/passwd\u7684\u7b2c\u4e00\u5217\u548c\u7b2c\u4e03\u5217\uff0c\u4ee5\u9017\u53f7\u5206\u5272\uff0c\u4e14\u5728\u6240\u6709\u884c\u524d\u9762\u6dfb\u52a0\u5217\u540duser\uff0cshell\uff0c\u6bcf\u4e00\u884c\u9700\u8981\u5728\u524d\u9762\u663e\u793a\u884c\u53f7\uff0c\u5728\u6700\u540e\u4e00\u884c\u663e\u793a\u8bfb\u53d6\u4e86\u591a\u5c11\u884c BEGIN\u6a21\u5f0f\u5728\u8bfb\u53d6\u6587\u4ef6\u4e4b\u524d\u6267\u884c\uff0cEND\u6a21\u5f0f\u5728\u8bfb\u53d6\u6587\u4ef6\u4e4b\u540e\u6267\u884c\uff1a Text Only<pre><code># awk -F : 'BEGIN{print \"user, shell\"} {print\u00a0NR\" \"$1\",\"$7} END{print \"rows:\" NR}' /etc/passwd\nuser, shell\n1 root,/bin/bash\n2 bin,/sbin/nologin\n...\nrows:28\n</code></pre></p> <p>\u5bf9\u6587\u4ef6\u91cc\u7684\u6570\u6c42\u548c Text Only<pre><code># vim num.txt\n3\n2\n1\n# awk '{sum+=$1; print $1} END{print \"sum=\"sum}' num.txt\n3\n2\n1\nsum=6\n</code></pre></p> <p>\u67e5\u8be2\u7a7a\u884c\u7684\u884c\u53f7\uff1a Text Only<pre><code>awk '/^$/{print NR}' sed.txt\n</code></pre></p> <p>\u9009\u9879-v\u793a\u4f8b\uff1a\u5411\u63a7\u5236\u53f0\u6bcf\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\uff0c\u5c31\u4f1a\u7acb\u9a6c\u8f93\u51fa\u8fd9\u4e2a\u6570\u5b57\u52a01\u4e4b\u540e\u7684\u7ed3\u679c Text Only<pre><code>awk -v i=1 '{print $1+i}'\n</code></pre></p> <p>4.sort \u5bf9\u6587\u4ef6\u7684\u5185\u5bb9\u6392\u5e8f Text Only<pre><code>sort [\u9009\u9879] \u6587\u4ef6\u5217\u8868\n</code></pre> \u9009\u9879\uff1a</p> <ul> <li>-n \u4f9d\u7167\u6570\u503c\u7684\u5927\u5c0f\u6392\u5e8f</li> <li>-r \u4ee5\u76f8\u53cd\u7684\u987a\u5e8f\u6765\u6392\u5e8f</li> <li>-t \u8bbe\u7f6e\u6392\u5e8f\u65f6\u6240\u7528\u7684\u5206\u9694\u5b57\u7b26</li> <li>-k \u6307\u5b9a\u9700\u8981\u6392\u5e8f\u7684\u5217</li> </ul> <p>\u6570\u636e\uff1a Text Only<pre><code># vim sort.txt\na:1\nc:3\nb:2\n</code></pre></p> Text Only<pre><code># sort sort.txt\na:1\nb:2\nc:3\n\n# sort -r sort.txt\nc:3\nb:2\na:1\n\n# sort -t : -k 2 -r sort.txt\nc:3\nb:2\na:1\n</code></pre> <p>5.uniq \u8fde\u7eed\u91cd\u590d\u7684\u6570\u636e\u53ea\u53d6\u4e00\u4e2a \u9009\u9879\uff1a</p> <ul> <li>-i \uff1a\u5ffd\u7565\u5927\u5c0f\u5199</li> <li>-c \uff1a\u8fdb\u884c\u8ba1\u6570</li> </ul> <p>\u6570\u636e\uff1a Text Only<pre><code># vim uniq.txt\na\na\nb\nb\nc\n</code></pre> Text Only<pre><code># uniq uniq.txt\na\nb\nc\n</code></pre> Text Only<pre><code># uniq -c uniq.txt\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02 a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02 b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01 c\n</code></pre> \u7edf\u8ba1\u6bcf\u4e2a\u4eba\u7684\u767b\u5f55\u603b\u6b21\u6570\uff1a Text Only<pre><code># last | cut -d ' ' -f 1 | sort | uniq -c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01\n\u00a0\u00a0\u00a0\u00a0\u00a045 reboot\n\u00a0\u00a0\u00a0\u00a0117 root\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01 wtmp\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/2-vim/","title":"2-vim","text":"<p> \u7ea6 750 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>\u6b63\u5e38\u6a21\u5f0f \u6309 esc \u6216 ctrl+[ \u9000\u51fa\u5176\u5b83\u6a21\u5f0f\u56de\u5230\u6b63\u5e38\u6a21\u5f0f</p> <p>\u590d\u5236\uff1a yy\u00a0 \u00a0\u590d\u5236\u4e00\u884c nyy \u590d\u5236n\u884c</p> <p>\u7c98\u8d34\uff1a \u5c0f\u5199p \u5728\u5149\u6807\u540e\u7c98\u8d34 \u5927\u5199P \u5728\u5149\u6807\u524d\u7c98\u8d34</p> <p>\u5220\u9664\uff1a dd\u00a0 \u00a0 \u00a0\u5220\u9664\u4e00\u6574\u884c dw\u00a0 \u00a0 \u00a0\u5220\u9664\u4e00\u4e2a\u5355\u8bcd dnw\u00a0 \u00a0\u5220\u9664 n \u4e2a\u5355\u8bcd ndd\u00a0 \u00a0\u5220\u9664\u4ece\u5149\u6807\u5f00\u59cb\u7684 n \u884c dG\u00a0 \u00a0 \u00a0\u5220\u9664\u5149\u6807\u6240\u5728\u884c\u5230\u6587\u672c\u7684\u7ed3\u675f</p> <p>\u5220\u9664\u548c\u66ff\u6362\u5b57\u7b26\uff1a x\u00a0 \u00a0\u5220\u9664\u5149\u6807\u5f53\u524d\u6240\u5728\u7684\u5b57\u7b26 r\u00a0 \u00a0\u66ff\u6362\u6389\u5149\u6807\u5f53\u524d\u6240\u5728\u7684\u5b57\u7b26 R\u00a0 \u66ff\u6362\u6389\u4ece\u5149\u6807\u5f00\u59cb\u4ee5\u540e\u7684\u6240\u6709\u5b57\u7b26\uff0c\u9664\u975e ESC \u9000\u51fa</p> <p>\u5feb\u901f\u5b9a\u4f4d\u5149\u6807\uff1a gg\u00a0 \u5149\u6807\u5b9a\u4f4d\u5230\u7b2c\u4e00\u884c\u7684\u884c\u9996 G\u00a0 \u00a0 \u5149\u6807\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u884c\u7684\u884c\u9996 nG\u00a0 \u5149\u6807\u5b9a\u4f4d\u5230\u7b2c n \u884c\u7684\u884c\u9996</p> <p>\u64a4\u9500\u548c\u6062\u590d\uff1a u\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u64a4\u9500\uff0c\u5373ctrl + z ctrl + r\u00a0 \u00a0 \u6062\u590d\u64a4\u9500\uff0c\u5373ctrl + shift + z</p> <p>~\u00a0 \u5c06\u5149\u6807\u4e0b\u7684\u5b57\u6bcd\u6539\u53d8\u5927\u5c0f\u5199 .\u00a0 \u00a0 \u91cd\u590d\u4e0a\u4e00\u4e2a\u64cd\u4f5c\u7684\u547d\u4ee4</p> <p>\u8fde\u7eed\u6309\u4e24\u6b21\u5927\u5199 ZZ \u4fdd\u5b58\u5e76\u9000\u51fa</p> <p>\u63d2\u5165\u6a21\u5f0f \u4ece\u6b63\u5e38\u6a21\u5f0f\u8fdb\u5165\u63d2\u5165\u6a21\u5f0f\uff1a i\u00a0 \u00a0 \u00a0 \u00a0\u5728\u5149\u6807\u6240\u5728\u7684\u5b57\u7b26\u7684\u524d\u9762\u63d2\u5165 a\u00a0 \u00a0 \u00a0 \u5728\u5149\u6807\u6240\u5728\u7684\u5b57\u7b26\u7684\u540e\u9762\u63d2\u5165 o\u00a0 \u00a0 \u00a0 \u5728\u5149\u6807\u6240\u5728\u884c\u7684\u540e\u9762\u65b0\u63d2\u5165\u4e00\u884c cc\u00a0 \u00a0 \u00a0\u5220\u9664\u5149\u6807\u6240\u5728\u884c\u5e76\u63d2\u5165 cw\u00a0 \u00a0 \u5220\u9664\u5149\u6807\u540e\u9762\u4e00\u4e2a\u5355\u8bcd\u5e76\u63d2\u5165</p> <p>\u547d\u4ee4\u6a21\u5f0f \u6b63\u5e38\u6a21\u5f0f\u4e0b\u6309 / \u8fdb\u5165\u641c\u7d22\uff0c\u8f93\u5165\u641c\u7d22\u8bcd\u540e\u6309\u4e0b\u56de\u8f66\u952e\u518d\u6309 n \u53ef\u4ee5\u8df3\u5230\u4e0b\u4e00\u4e2a\u5339\u914d\u8bcd :noh\u00a0\u6309\u56de\u8f66\u540e\u53d6\u6d88\u641c\u7d22\u5339\u914d\u7684\u9ad8\u4eae</p> <p>\u6b63\u5e38\u6a21\u5f0f\u4e0b\u6309 : \u8fdb\u5165\u547d\u4ee4\u6a21\u5f0f :set nu\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u663e\u793a\u884c\u53f7 :set nonu\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u53d6\u6d88\u884c\u53f7 :n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u5149\u6807\u5b9a\u4f4d\u5230 n \u884c :n1,n2d\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u5220\u9664\u591a\u884c\u6587\u672c,n1 \u548c n2 \u6307\u7684\u662f\u8d77\u59cb\u884c\u53f7\u548c\u7ed3\u675f\u884c\u53f7\uff0cd \u662f\u5220\u9664\u5173\u952e\u5b57</p> <p>\u6587\u672c\u7684\u66ff\u6362\uff1a Text Only<pre><code>:{\u4f5c\u7528\u8303\u56f4}s/{\u76ee\u6807}/{\u66ff\u6362}/{\u66ff\u6362\u7684\u6807\u5fd7}\n</code></pre> \u4f5c\u7528\u8303\u56f4\u5206\u4e3a\u5f53\u524d\u884c\u3001\u5168\u6587\u3001\u9009\u533a\u3002 \u66ff\u6362\u7684\u6807\u5fd7\u53ef\u4ee5\u662f\uff0cg\u8868\u793a\u5168\u5c40(global)\u66ff\u6362\uff0c\u4e0d\u52a0g\u8868\u793a\u53ea\u66ff\u6362\u7b2c\u4e00\u6b21\u51fa\u73b0\uff1bi \u8868\u793a\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u67e5\u627e\uff0cI \u8868\u793a\u5927\u5c0f\u5199\u654f\u611f\uff1bc \u8868\u793a\u9700\u8981\u786e\u8ba4\u3002 \u4f8b\u5982\uff1a \u628a\u5f53\u524d\u5149\u6807\u6240\u5728\u884c\u7684 abc \u66ff\u6362\u6210 aaa Text Only<pre><code>:s/abc/aaa/g\n</code></pre> \u628a\u5168\u6587\u4e2d\u7684 abc \u66ff\u6362\u6210 aa Text Only<pre><code>:%s/abc/aaa/g\n</code></pre> \u628a n1 \u5230 n2 \u884c\u7684abc\u5168\u90e8\u66ff\u6362\u6210aaa Text Only<pre><code>:n1,n2s/abc/aaa/g\n</code></pre> \u628a\u5168\u6587\u4e2d\u7684s\u548cS\u66ff\u6362\u6210A Text Only<pre><code>:%s/s/A/gi\n</code></pre></p> <p>\u9000\u51favim\uff1a :wq\u00a0\u00a0 \u00a0\u00a0 \u00a0\u00a0 \u00a0\u00a0 \u00a0 \u00a0 \u00a0\u4fdd\u5b58\u5e76\u9000\u51fa :x\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u4fdd\u5b58\u5e76\u9000\u51fa :w\u00a0 \u00a0\u00a0 \u00a0\u00a0 \u00a0\u00a0 \u00a0\u00a0 \u00a0 \u00a0 \u00a0\u4fdd\u5b58\u4fee\u6539\uff0c\u4f46\u4e0d\u9000\u51fa :q!\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u4e0d\u4fdd\u5b58\u4fee\u6539\uff0c\u5f3a\u5236\u9000\u51fa :saveas file\u00a0 \u00a0 \u00a0\u53e6\u5b58\u4e3a</p> <p>\u53ef\u89c6\u5316\u6a21\u5f0f \u53ef\u89c6\u5316\u6a21\u5f0f\u53ef\u4ee5\u9009\u62e9\u6587\u672c\u533a\u57df\uff0c\u4e0e\u7528\u9f20\u6807\u9009\u62e9\u6587\u672c\u533a\u57df\u4e00\u6837\uff1a \u5c0f\u5199v\u00a0 \u00a0 \u00a0 \u00a0 \u8fdb\u5165\u4ee5\u5b57\u7b26\u4e3a\u5355\u4f4d\u9009\u62e9\u6587\u672c\u7684\u53ef\u89c6\u5316\u6a21\u5f0f \u5927\u5199V\u00a0 \u00a0 \u00a0 \u00a0\u8fdb\u5165\u4ee5\u884c\u4e3a\u5355\u4f4d\u9009\u62e9\u6587\u672c\u7684\u53ef\u89c6\u5316\u6a21\u5f0f</p> <p>\u53ef\u89c6\u5316\u6a21\u5f0f\u4e0b\u9009\u62e9\u64cd\u4f5c\u533a\u57df\u4ee5\u540e: d\u00a0 \u00a0 \u5220\u9664\u6240\u9009\u62e9\u7684\u533a\u57df y\u00a0 \u00a0 \u590d\u5236\u6240\u9009\u62e9\u7684\u533a\u57df p\u00a0 \u00a0 \u628a\u590d\u5236\u7684\u6587\u672c\u7c98\u8d34\u5230\u6240\u9009\u62e9\u7684\u533a\u57df</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/3-%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/","title":"3-\u7528\u6237\u548c\u7528\u6237\u7ec4\u7ba1\u7406","text":"<p> \u7ea6 586 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u7528\u6237\u7ec4\u7ba1\u7406 groupadd\uff0c\u6dfb\u52a0\u7528\u6237\u7ec4 Text Only<pre><code>groupadd \u7528\u6237\u7ec4\u540d\n</code></pre> groupdel\uff0c\u5220\u9664\u7528\u6237\u7ec4 Text Only<pre><code>groupdel \u7528\u6237\u7ec4\u540d\n</code></pre></p> <p>\u7528\u6237\u7ba1\u7406 useradd\uff0c\u6dfb\u52a0\u7528\u6237\uff0c\u7528\u6237\u7684\u5bb6\u76ee\u5f55\u5728/home\u4e0b\uff0c\u76ee\u5f55\u76ee\u5f55\u540d\u4e0e\u7528\u6237\u540d\u76f8\u540c Text Only<pre><code>useradd \u7528\u6237\u540d\n</code></pre> \u6dfb\u52a0\u7528\u6237\u65f6\u6307\u5b9a\u7528\u6237\u5bb6\u76ee\u5f55\u7684\u4f4d\u7f6e Text Only<pre><code>useradd -d \u76ee\u5f55\u8def\u5f84 \u7528\u6237\u540d\n</code></pre> \u6dfb\u52a0\u7528\u6237\u5e76\u6307\u5b9a\u6240\u5904\u7684\u7528\u6237\u7ec4\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7ec4\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e0e\u8be5\u7528\u6237\u540d\u540c\u540d\u7684\u7528\u6237\u7ec4\uff0c\u5e76\u628a\u8fd9\u4e2a\u7528\u6237\u52a0\u5230\u8fd9\u4e2a\u7ec4\u3002-g \u4fee\u6539\u7ec4\uff1b-G \u6dfb\u52a0\u7ec4\uff0c\u5373\u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u5c5e\u4e8e\u591a\u4e2a\u7ec4\u3002 Text Only<pre><code>useradd -g \u7528\u6237\u7ec4 \u7528\u6237\u540d\n</code></pre> usermod\uff0c\u4fee\u6539\u7528\u6237\u7684\u7ec4 Text Only<pre><code>usermod -g \u7528\u6237\u7ec4 \u7528\u6237\u540d\n</code></pre> passwd\uff0c\u4fee\u6539\u7528\u6237\u7684\u5bc6\u7801\uff0c\u53ea\u80fd\u7528\u7528root\u6765\u6539\uff0c\u5728root\u7528\u6237\u4e0b\u76f4\u63a5\u8f93\u5165passwd\u5c31\u662f\u6539root\u7684\u5bc6\u7801 Text Only<pre><code>passwd \u7528\u6237\u540d\n</code></pre> su\uff0cswitch user\uff0c\u5207\u6362\u7528\u6237\uff0c\u4ece\u6743\u9650\u9ad8\u7684\u7528\u6237\u5207\u6362\u5230\u6743\u9650\u4f4e\u7684\u7528\u6237\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801\uff0c\u5426\u5219\u9700\u8981\u8f93\u5165\u5bc6\u7801 Text Only<pre><code>su \u7528\u6237\u540d\n</code></pre> userdel\uff0c\u5220\u9664\u7528\u6237\uff0c\u53ea\u80fd\u7528root\u7528\u6237\u5220\u9664\u7528\u6237 \u5220\u9664\u7528\u6237\u4f46\u662f\u4fdd\u7559\u5bb6\u76ee\u5f55 Text Only<pre><code>userdel \u7528\u6237\u540d\n</code></pre> \u5220\u9664\u7528\u6237\u5e76\u4e14\u5220\u9664\u5bb6\u76ee\u5f55 Text Only<pre><code>userdel -r \u7528\u6237\u540d\n</code></pre> id\uff0c\u67e5\u8be2\u7528\u6237\u4fe1\u606f Text Only<pre><code>id \u7528\u6237\u540d\n</code></pre> who\uff0c\u67e5\u770b\u5f53\u524d\u662f\u4f7f\u7528\u7684\u662f\u54ea\u4e2a\u7528\u6237\u767b\u5f55\u5230shell Text Only<pre><code>who\n</code></pre> Text Only<pre><code>who am i\n</code></pre> logout\uff0c\u6ce8\u9500 Text Only<pre><code>logout\n</code></pre></p> <p>/etc/passwd\u6587\u4ef6 /etc/passwd\u4e2d\u4e00\u884c\u8bb0\u5f55\u5bf9\u5e94\u7740\u4e00\u4e2a\u7528\u6237\uff0c\u6bcf\u884c\u8bb0\u5f55\u88ab\u5192\u53f7(:)\u5206\u9694\u4e3a7\u4e2a\u5b57\u6bb5\uff0c\u5176\u683c\u5f0f\u548c\u5177\u4f53\u542b\u4e49\u662f\uff1a\u7528\u6237\u540d:\u53e3\u4ee4:\u7528\u6237\u6807\u8bc6\u53f7:\u7ec4\u6807\u8bc6\u53f7:\u6ce8\u91ca\u6027\u63cf\u8ff0:\u4e3b\u76ee\u5f55:\u767b\u5f55Shell\u3002\u5176\u4e2d\u53e3\u4ee4(passwd)\u5b57\u6bb5\u5728\u4e00\u4e9b\u7cfb\u7edf\u4e2d\u5b58\u653e\u7740\u52a0\u5bc6\u540e\u7684\u7528\u6237\u53e3\u4ee4\uff0c\u867d\u7136\u8fd9\u4e2a\u5b57\u6bb5\u5b58\u653e\u7684\u53ea\u662f\u7528\u6237\u53e3\u4ee4\u7684\u52a0\u5bc6\u4e32\uff0c\u4e0d\u662f\u660e\u6587\uff0c\u4f46\u662f\u7531\u4e8e/etc/passwd\u6587\u4ef6\u5bf9\u6240\u6709\u7528\u6237\u90fd\u53ef\u8bfb\uff0c\u6240\u4ee5\u8fd9\u4ecd\u662f\u4e00\u4e2a\u5b89\u5168\u9690\u60a3\u3002\u56e0\u6b64\uff0c\u73b0\u5728\u8bb8\u591aLinux\u7cfb\u7edf\uff08\u5982SVR4\uff09\u90fd\u4f7f\u7528\u4e86shadow\u6280\u672f\uff0c\u628a\u771f\u6b63\u7684\u52a0\u5bc6\u540e\u7684\u7528\u6237\u53e3\u4ee4\u5b57\u5b58\u653e\u5230/etc/shadow\u6587\u4ef6\u4e2d\uff0c\u800c\u5728/etc/passwd\u6587\u4ef6\u7684\u53e3\u4ee4\u5b57\u6bb5\u4e2d\u53ea\u5b58\u653e\u4e00\u4e2a\u7279\u6b8a\u7684\u5b57\u7b26\uff0c\u4f8b\u5982\u201cx\u201d\u6216\u8005\u201c*\u201d\u3002 \u67e5\u770b\u6709\u591a\u5c11\u7528\u6237 Text Only<pre><code>cat /etc/passwd\n</code></pre></p> <p>/etc/group\u6587\u4ef6\uff0c\u8bb0\u5f55\u7ec4\u4fe1\u606f\u7684\u6587\u4ef6 \u67e5\u770b\u6240\u6709\u7ec4 Text Only<pre><code>cat\u00a0/etc/group\n</code></pre></p> <p>sudo\uff0cSuperUser do \u914d\u7f6e\u7528\u6237\u53ef\u4ee5\u4f7f\u7528sudo\uff1avim /etc/sudoers</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/4-%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/","title":"4-\u6587\u4ef6\u7ba1\u7406","text":"<p> \u7ea6 1438 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 29 \u5206\u949f</p> <p>\u6587\u4ef6\u7ba1\u7406 ls\uff0clist\uff0c\u67e5\u770b\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u548c\u76ee\u5f55 \u67e5\u770b\u6240\u6709 Text Only<pre><code>ls -a\n</code></pre> \u9012\u5f52\u7684\u67e5\u770b\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u6587\u4ef6\u548c\u76ee\u5f55 Text Only<pre><code>ls -R\n</code></pre> \u67e5\u770b\u8be6\u7ec6\u4fe1\u606f Text Only<pre><code>ls -l\u00a0\u00a0\u7b80\u5199\uff1all\n</code></pre> \u53cb\u597d\u5730\u663e\u793a\u6587\u4ef6\u5927\u5c0f Text Only<pre><code>ls -lh\n</code></pre> \u7edf\u8ba1\u76ee\u5f55\u4e0b\u6709\u591a\u5c11\u4e2a\u6587\u4ef6\uff08\u4e0d\u5305\u542b\u76ee\u5f55\uff09 Text Only<pre><code>ll \u76ee\u5f55 | grep ^- | wc -l\n</code></pre> \u7edf\u8ba1\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u6709\u591a\u5c11\u4e2a\u6587\u4ef6 Text Only<pre><code>ll -R \u76ee\u5f55 | grep ^- | wc -l\n</code></pre> \u4ee5\u6811\u72b6\u7684\u5f62\u5f0f\u5c55\u73b0\u76ee\u5f55\uff0c\u9ed8\u8ba4\u6ca1\u6709tree\u547d\u4ee4\uff0c\u8981\u5148\u5b89\u88c5 Text Only<pre><code>yum install tree\n</code></pre> Text Only<pre><code>tree \u76ee\u5f55\n</code></pre></p> <p>wc\uff0cword count\uff0c\u7edf\u8ba1\u6587\u4ef6\u7684Byte\u6570\u3001\u5b57\u6570\u3001\u6216\u662f\u5217\u6570\uff0c\u82e5\u4e0d\u6307\u5b9a\u6587\u4ef6\u540d\u79f0\u3001\u6216\u662f\u7ed9\u7684\u6587\u4ef6\u540d\u4e3a\"-\"\uff0cwc\u6307\u4ee4\u4f1a\u4ece\u6807\u51c6\u8f93\u5165\u8bbe\u5907\u8bfb\u53d6\u6570\u636e</p> <ul> <li>-c\u6216--bytes\u6216--chars\u00a0 \u00a0 \u00a0 \u00a0\u663e\u793aBytes\u6570</li> <li>-l\u6216--lines\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u663e\u793a\u884c\u6570</li> <li>-w\u6216--words\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u663e\u793a\u5b57\u6570</li> </ul> <p>pwd\uff0cpresent work directory</p> <p>cd\uff0cchange directory \u8fd4\u56de\u5bb6\u76ee\u5f55 Text Only<pre><code>cd ~\n</code></pre> \u8fd4\u56de\u4e4b\u524d\u7684\u76ee\u5f55 Text Only<pre><code>cd -\n</code></pre></p> <p>mkdir\uff0cmake directory \u521b\u5efa\u591a\u7ea7\u76ee\u5f55 Text Only<pre><code>mkdir -p\n</code></pre></p> <p>rmdir\uff0cremove directory\uff0c\u5220\u9664\u7a7a\u76ee\u5f55</p> <p>rm\uff0cremove\uff0c\u5220\u9664\u6587\u4ef6\u548c\u76ee\u5f55 \u5f3a\u5236\u9012\u5f52\u5220\u9664\u8be5\u76ee\u5f55\u6216\u8005\u6587\u4ef6\u3002-r\uff0crecursive\uff0c\u9012\u5f52\uff1b-f\uff0cforce\uff0c\u5f3a\u5236\uff1b Text Only<pre><code>rm -rf\n</code></pre></p> <p>cp\uff0ccopy\uff0c\u590d\u5236\uff0c\u5982\u679c\u6e90\u6587\u4ef6\u6709\u4e24\u4e2a\u4ee5\u4e0a\uff0c\u5219\u76ee\u7684\u6587\u4ef6\u4e00\u5b9a\u8981\u662f\u76ee\u5f55\u624d\u884c Text Only<pre><code>cp \u6e90\u6587\u4ef6\u6216\u8005\u76ee\u5f55 \u76ee\u6807\u6587\u4ef6\u6216\u8005\u76ee\u5f55\n</code></pre> -r \u9012\u5f52\u590d\u5236\u6574\u4e2a\u76ee\u5f55 \\cp \u5f3a\u5236\u8986\u76d6\u4e0d\u63d0\u793a</p> <p>mv\uff0cmove\uff0c\u91cd\u547d\u540d\u6216\u79fb\u52a8 \u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u5728\u540c\u4e00\u76ee\u5f55\u5c31\u662f\u91cd\u547d\u540d\uff0c\u4e0d\u5728\u540c\u4e00\u76ee\u5f55\u5c31\u662f\u79fb\u52a8</p> <p>cat\uff0ccatenate -n\u663e\u793a\u884c\u53f7 Text Only<pre><code>cat xx.txt | more\n</code></pre></p> <p>tac\uff0ccat \u7684\u53cd\u5411\u64cd\u4f5c\uff0c\u4ece\u6700\u540e\u4e00\u884c\u5f00\u59cb\u6253\u5370</p> <p>more\uff0cmore\u662f\u57fa\u4e8eVI\u7f16\u8f91\u5668\u7684\u6587\u672c\u8fc7\u6ee4\u5668\uff0c\u6309\u56de\u8f66\u4e00\u884c\u4e00\u884c\u7684\u770b\uff0c\u6309\u7a7a\u683c\u4e00\u9875\u4e00\u9875\u7684\u7ffb Text Only<pre><code>more xxx.txt\n</code></pre></p> <p>less\uff0cless\u548cmore\u4e00\u6837\uff0c\u4e5f\u662f\u7528\u6765\u4e00\u9875\u4e00\u9875\u7684\u67e5\u770b\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u4f46\u662f\u6bd4more\u591a\u4e86\u4e00\u4e2a\u5411\u524d\u7ffb\u9875\u7684\u529f\u80fd\uff0cless\u5e76\u4e0d\u662f\u5c06\u6574\u4e2a\u6587\u4ef6\u4e00\u6b21\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u800c\u662f\u6839\u636e\u663e\u793a\u7684\u60c5\u51b5\u52a0\u8f7d</p> <p>echo Text Only<pre><code>echo $PATH\necho $HOSTNAME\n</code></pre></p> <p>head\uff0c\u67e5\u770b\u6587\u4ef6\u524d\u51e0\u884c -n\uff0c\u6307\u5b9a\u884c\u6570\uff0chead\u548ctail\u4e0d\u6307\u5b9a\u884c\u6570\u90fd\u662f\u9ed8\u8ba4\u770b10\u884c Text Only<pre><code>head -n 5 xxx.txt\n</code></pre></p> <p>tail \uff0c\u67e5\u770b\u6587\u4ef6\u6700\u540e\u51e0\u884c \u5b9e\u65f6\u76d1\u63a7\u6587\u4ef6 Text Only<pre><code>tail -f\n</code></pre></p> <p>od\uff0cOctal Dump\uff0c\u4ee5\u516b\u8fdb\u5236\u3001\u5341\u8fdb\u5236\u3001\u5341\u516d\u8fdb\u5236\u663e\u793a\u6587\u4ef6\u5185\u5bb9</p> <p>ln\uff0clink \u8f6f\u8fde\u63a5\uff08\u7b26\u53f7\u8fde\u63a5\uff09 Text Only<pre><code>ln -s [\u6e90\u6587\u4ef6\u6216\u76ee\u5f55] [\u76ee\u6807]\n</code></pre> \u786c\u94fe\u63a5 Text Only<pre><code>ln [\u6e90\u6587\u4ef6\u6216\u76ee\u5f55] [\u76ee\u6807]\n</code></pre></p> <p> \u6587\u4ef6\u7c7b\u578b\uff1a</p> <ul> <li>- \u8868\u793a\u666e\u901a\u6587\u4ef6</li> <li>l \u8868\u793a\u94fe\u63a5</li> <li>d \u8868\u793a\u76ee\u5f55</li> <li>c \u8868\u793a\u5b57\u7b26\u8bbe\u5907\uff0c\u5982\u9f20\u6807\u3001\u952e\u76d8</li> <li>b \u8868\u793a\u5757\u8bbe\u5907</li> </ul> <p>rwx\u4f5c\u7528\u5230\u6587\u4ef6\uff1a</p> <ul> <li>r \u8868\u793a\u53ef\u8bfb</li> <li>w \u8868\u793a\u53ef\u5199\uff0c\u4f46\u662f\u4e0d\u4e00\u5b9a\u80fd\u5220\u9664\uff0c\u9664\u975e\u8be5\u7528\u6237\u5bf9\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u5177\u6709\u5199\u6743\u9650</li> <li>x \u8868\u793a\u53ef\u6267\u884c</li> </ul> <p>rwx\u4f5c\u7528\u5230\u76ee\u5f55\uff1a</p> <ul> <li>r \u8868\u793a\u53ef\u8bfb</li> <li>w \u8868\u793a\u4fee\u6539</li> <li>x \u8868\u793a\u53ef\u8fdb\u5165\u5230\u76ee\u5f55</li> </ul> <p>chown\uff0c\u4fee\u6539\u6587\u4ef6\u7684\u6240\u6709\u8005\uff0c-R \u4f7f\u6539\u53d8\u5bf9\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u751f\u6548 Text Only<pre><code>chown \u7528\u6237\u540d \u6587\u4ef6\u540d\n</code></pre> chgrp\uff0c\u4fee\u6539\u6587\u4ef6\u7684\u6240\u5728\u7ec4\uff0c-R \u4f7f\u6539\u53d8\u5bf9\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u751f\u6548 Text Only<pre><code>chgrp \u7ec4\u540d \u6587\u4ef6\u540d\n</code></pre> \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528chown\u4fee\u6539\u6587\u4ef6\u7684\u6240\u6709\u8005\u548c\u7ec4\uff0c\u6587\u4ef6\u7684\u6240\u6709\u8005\u53ef\u4ee5\u4e0d\u5728\u6240\u5c5e\u7ec4 Text Only<pre><code>chown \u7528\u6237:\u7528\u6237\u7ec4 \u591a\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\n</code></pre> chmod\uff0c\u4fee\u6539\u6587\u4ef6\u7684\u6743\u9650 Text Only<pre><code>chmod 777\u00a0\u6587\u4ef6\u540d\n</code></pre> u\uff1a\u6240\u6709\u8005\uff0cg\uff1a\u6240\u5728\u7ec4\uff0co\uff1a\u5176\u5b83\u4eba\uff0ca\uff1a\u6240\u6709\u4eba Text Only<pre><code>chmod u=rwx,g=rx,o=x \u6587\u4ef6\u540d\n</code></pre> \u7ed9\u5176\u5b83\u4eba\u52a0\u4e0a\u53ef\u6267\u884c\u7684\u6743\u9650 Text Only<pre><code>chmod o+x \u6587\u4ef6\u540d\n</code></pre> \u7ed9\u6240\u5728\u7ec4\u53bb\u6389\u5199\u6743\u9650 Text Only<pre><code>chmod g-x \u6587\u4ef6\u540d\n</code></pre> \u7ed9\u6240\u6709\u4eba\u53ef\u6267\u884c\u7684\u6743\u9650 Text Only<pre><code>chmod a+x\u00a0\u6587\u4ef6\u540d\n</code></pre> \u6216\u8005\u7701\u7565a\u4e5f\u662f\u7ed9\u6240\u6709\u4eba\u53ef\u6267\u884c\u7684\u6743\u9650 Text Only<pre><code>chmod +x \u6587\u4ef6\u540d\n</code></pre></p> <p>touch\uff0c\u66f4\u65b0\u6587\u4ef6\u65f6\u95f4 \u6216 \u5efa\u7acb\u65b0\u6587\u4ef6 Text Only<pre><code>touch [\u9009\u9879] filename\n</code></pre> \u9009\u9879\uff1a</p> <ul> <li>-a\u00a0 \u00a0\u66f4\u65b0 atime</li> <li>-c\u00a0 \u00a0\u66f4\u65b0 ctime\uff0c\u82e5\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\u5219\u4e0d\u5efa\u7acb\u65b0\u6587\u4ef6</li> <li>-m\u00a0 \u66f4\u65b0 mtime</li> <li>-d\u00a0 \u00a0\u540e\u9762\u53ef\u4ee5\u63a5\u66f4\u65b0\u65e5\u671f\u800c\u4e0d\u4f7f\u7528\u5f53\u524d\u65e5\u671f\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 --date=\"\u65e5\u671f\u6216\u65f6\u95f4\"</li> <li>-t\u00a0 \u00a0 \u540e\u9762\u53ef\u4ee5\u63a5\u66f4\u65b0\u65f6\u95f4\u800c\u4e0d\u4f7f\u7528\u5f53\u524d\u65f6\u95f4\uff0c\u683c\u5f0f\u4e3a[YYYYMMDDhhmm]</li> </ul> <p>\u538b\u7f29\u548c\u89e3\u538b gzip/gunzip \u538b\u7f29 Text Only<pre><code>gzip a\n</code></pre> \u89e3\u538b Text Only<pre><code>gunzip a.gz\n</code></pre></p> <p>zip/unzip \u538b\u7f29\u76ee\u5f55 Text Only<pre><code>zip -r \u538b\u7f29\u6587\u4ef6\u540d \u76ee\u5f55\n</code></pre> \u89e3\u538b Text Only<pre><code>unzip \u538b\u7f29\u6587\u4ef6 -d \u76ee\u6807\u8def\u5f84\n</code></pre></p> <p>tar\uff0cTape(\u78c1\u5e26) Archive \u538b\u7f29\u6307\u4ee4\u53ea\u80fd\u5bf9\u4e00\u4e2a\u6587\u4ef6\u8fdb\u884c\u538b\u7f29\uff0c\u800c\u6253\u5305\u80fd\u591f\u5c06\u591a\u4e2a\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a\u5927\u6587\u4ef6\u3002tar \u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u6253\u5305\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 gzip\u3001bzip2\u3001xz \u5c06\u6253\u5305\u6587\u4ef6\u8fdb\u884c\u538b\u7f29\u3002 \u9009\u9879\uff1a</p> <ul> <li>-z \uff1a\u4f7f\u7528 zip</li> <li>-j \uff1a\u4f7f\u7528 bzip2</li> <li>-J \uff1a\u4f7f\u7528 xz</li> <li>-c \uff1a\u65b0\u5efa\u6253\u5305\u6587\u4ef6</li> <li>-t \uff1a\u67e5\u770b\u6253\u5305\u6587\u4ef6\u91cc\u9762\u6709\u54ea\u4e9b\u6587\u4ef6</li> <li>-x \uff1a\u89e3\u6253\u5305\u6216\u89e3\u538b\u7f29\u7684\u529f\u80fd</li> <li>-v \uff1a\u5728\u538b\u7f29/\u89e3\u538b\u7f29\u7684\u8fc7\u7a0b\u4e2d\uff0c\u663e\u793a\u6b63\u5728\u5904\u7406\u7684\u6587\u4ef6\u540d</li> <li>-f \uff1afilename\uff1a\u8981\u5904\u7406\u7684\u6587\u4ef6</li> <li>-C \u76ee\u5f55 \uff1a\u5728\u7279\u5b9a\u76ee\u5f55\u89e3\u538b\u7f29</li> </ul> <p>\u6253\u5305\u538b\u7f29 Text Only<pre><code>tar [-z|-j|-J] [cv] [-f \u65b0\u5efa\u7684 tar \u6587\u4ef6] filename...\n</code></pre> \u6bd4\u5982\uff0c\u5c06a b c \u4e09\u4e2a\u6587\u4ef6\u6253\u5305 Text Only<pre><code>tar -zcvf test.tar.gz a b c\n</code></pre> \u89e3\u538b Text Only<pre><code>tar [-z|-j|-J] [xv] [-f \u5df2\u6709\u7684 tar \u6587\u4ef6] [-C \u76ee\u5f55]\n</code></pre> \u6bd4\u5982\uff1a Text Only<pre><code>tar -zxvf test.tar.gz -C ./dir\n</code></pre> \u67e5\u770b Text Only<pre><code>tar [-z|-j|-J] [tv] [-f \u5df2\u6709\u7684 tar \u6587\u4ef6]\n</code></pre> \u6bd4\u5982\uff1a Text Only<pre><code>tar -ztvf test.tar.gz\n</code></pre></p> <p>\u641c\u7d22\u6587\u4ef6 find \u6309\u6587\u4ef6\u540d\u67e5\u627e\uff0c\u5728home\u53ca\u5176\u6240\u6709\u5b50\u76ee\u5f55\u4e0b\u67e5\u627e\u4ee5hello\u5f00\u5934\u7684\u6587\u4ef6 Text Only<pre><code>find /root -name hello*\n</code></pre> \u6309\u7528\u6237\u67e5\u627e Text Only<pre><code>find /root -user bob\n</code></pre> \u67e5\u627e\u6587\u4ef6\u5927\u5c0f\u5927\u4e8e200M\u7684\u6587\u4ef6 Text Only<pre><code>find /root -size +200M\n</code></pre></p> <p>locate\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u6587\u4ef6\u4f4d\u7f6e\uff0c\u4f7f\u7528locate\u9700\u8981\u5148\u5efa\u7acb\u6570\u636e\u5e93 \u4f7f\u7528locate\u6307\u4ee4\u4e4b\u524d\u8981\u4f7f\u7528updatedb\u6307\u4ee4\u521b\u5efa\u6570\u636e\u5e93 Text Only<pre><code>updatedb\n</code></pre> Text Only<pre><code>locate hello.txt\n</code></pre></p> <p>which\uff0c\u53ef\u4ee5\u67e5\u770b\u6307\u4ee4\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5728\u54ea\u4e2a\u76ee\u5f55\u4e0b\uff0c\u8be5\u547d\u4ee4\u57fa\u672c\u53ea\u5728$PATH\u8def\u5f84\u4e2d\u641c\u7d22\uff0c\u67e5\u627e\u8303\u56f4\u5c0f\uff0c\u67e5\u627e\u901f\u5ea6\u5feb Text Only<pre><code>which man\n</code></pre></p> <p>whereis\uff0c\u548cwhich\u4e00\u6837 Text Only<pre><code>whereis man\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/5-%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/","title":"5-\u78c1\u76d8\u7ba1\u7406","text":"<p> \u7ea6 377 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u78c1\u76d8\u7ba1\u7406 lsblk\uff0clist block\uff0c\u67e5\u770b\u78c1\u76d8\u5206\u533a\u53ca\u6302\u8f7d\u60c5\u51b5 fdisk\uff0cformat disk\uff0c\u7ed9\u78c1\u76d8\u5206\u533a Text Only<pre><code>fdisk /dev/sdb\n</code></pre> mkfs\uff0cmake file system\uff0c\u683c\u5f0f\u5316\u78c1\u76d8\u5206\u533a Text Only<pre><code>mkfs -t ext4 /dev/sdb1\n</code></pre> mount\uff0c\u6302\u8f7d\uff0c\u91cd\u542f\u540e\u5931\u6548 Text Only<pre><code>mount /dev/sdb1 /newdisk\n</code></pre> unmount\uff0c\u5378\u8f7d Text Only<pre><code>unmount /dev/sdb1\n</code></pre> \u4fee\u6539/etc/fstab\u5b9e\u73b0\u6c38\u4e45\u6302\u8f7d</p> <p>df\uff0cdisk free\uff0c\u67e5\u770b\u78c1\u76d8\u7684\u4f7f\u7528\u60c5\u51b5\uff0ch\u662fhuman\u7684\u610f\u601d\uff0c\u5373\u53cb\u597d\u7684\u663e\u793a\u5927\u5c0f Text Only<pre><code>df -h\n</code></pre> du\uff0cdisk usage\uff0c\u67e5\u770b\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709\u76ee\u5f55\u5360\u7528\u7684\u78c1\u76d8\u7a7a\u95f4\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a\u5f53\u524d\u76ee\u5f55 Text Only<pre><code>du -h \u76ee\u5f55\n</code></pre> \u67e5\u770b\u6307\u5b9a\u76ee\u5f55\u4e0b\u6240\u6709\u76ee\u5f55\u53ca\u6587\u4ef6\u7684\u5927\u5c0f Text Only<pre><code>du -ah \u76ee\u5f55\n</code></pre></p> <p>dd\uff0cdata description \u4ece\u6807\u51c6\u8f93\u5165\u6216\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6839\u636e\u6307\u5b9a\u7684\u683c\u5f0f\u6765\u8f6c\u6362\u6570\u636e\uff0c\u518d\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u3001\u6587\u4ef6\u6216\u8bbe\u5907\u3002</p> <ul> <li>if=\u6587\u4ef6\u540d\uff1a\u8f93\u5165\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u4e3a\u6807\u51c6\u8f93\u5165</li> <li>of=\u6587\u4ef6\u540d\uff1a\u8f93\u51fa\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u4e3a\u6807\u51c6\u8f93\u51fa</li> <li>ibs=bytes\uff1a\u4e00\u6b21\u8bfb\u5165bytes\u4e2a\u5b57\u8282\uff0c\u5373\u6307\u5b9a\u4e00\u4e2a\u5757\u5927\u5c0f\u4e3abytes\u4e2a\u5b57\u8282</li> <li>obs=bytes\uff1a\u4e00\u6b21\u8f93\u51fabytes\u4e2a\u5b57\u8282\uff0c\u5373\u6307\u5b9a\u4e00\u4e2a\u5757\u5927\u5c0f\u4e3abytes\u4e2a\u5b57\u8282</li> <li>bs=bytes\uff1a\u540c\u65f6\u8bbe\u7f6e\u8bfb\u5165/\u8f93\u51fa\u7684\u5757\u5927\u5c0f\u4e3abytes\u4e2a\u5b57\u8282\u3002</li> <li>conv=&lt;\u5173\u952e\u5b57&gt;\uff0c\u5173\u952e\u5b57\u53ef\u4ee5\u6709\uff1a</li> </ul> <p>lcase\uff1a\u628a\u5927\u5199\u5b57\u7b26\u8f6c\u6362\u4e3a\u5c0f\u5199\u5b57\u7b26 ucase\uff1a\u628a\u5c0f\u5199\u5b57\u7b26\u8f6c\u6362\u4e3a\u5927\u5199\u5b57\u7b26 \u5c06\u672c\u5730\u7684/dev/hdb\u6574\u76d8\u5907\u4efd\u5230/dev/hdd Text Only<pre><code>dd if=/dev/hdb of=/dev/hdd\n</code></pre> \u5728Linux \u4e0b\u5236\u4f5c\u542f\u52a8\u76d8\uff1a Text Only<pre><code>dd if=boot.img of=/dev/fd0 bs=1440k\n</code></pre> \u5c06afile\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u82f1\u6587\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199\u8f93\u51fa\u5230bfile\u6587\u4ef6 Text Only<pre><code>dd if=afile of=bfile conv=ucase\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/6-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86/","title":"6-\u7f51\u7edc\u7ba1\u7406","text":"<p> \u7ea6 685 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>\u7f51\u7edc \u4e3b\u673a\u7684\u8def\u7531\u8868\u5728\u4e3b\u673a\u5411\u5916\u53d1\u9001\u6570\u636e\u65f6\u7528\uff08\u591a\u5f20\u7f51\u5361\u65f6\u624d\u53ef\u80fd\u4f1a\u9700\u8981\u914d\u7f6e\uff09\uff0c\u4e0d\u662f\u7528\u6765\u8f6c\u53d1\u6570\u636e\u7684\uff0c\u4e3b\u673a\u63a5\u6536\u5230\u6570\u636e\u4e4b\u540e\u4f1a\u67e5\u770b\u76ee\u7684ip\u5730\u5740\uff0c\u5982\u679c\u662f\u672c\u673a\u67d0\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684ip\u90a3\u4e48\u5c31\u6536\u4e0b\uff0c\u4e0d\u662f\u5c31\u4e22\u5f03\uff0c\u4e3b\u673a\u6ca1\u6709\u8def\u7531\u529f\u80fd\uff0c\u4e0d\u4f1a\u8f6c\u53d1\u6570\u636e\uff0c\u8f6c\u53d1\u6570\u636e\u662f\u8def\u7531\u5668\u7684\u5de5\u4f5c\u3002 \u67e5\u770bip\u5730\u5740 Text Only<pre><code>ip address\n</code></pre> \u5b89\u88c5\u5b9e\u7528\u7f51\u7edc\u5de5\u5177net-tools Text Only<pre><code>yum install net-tools\n</code></pre> \u5b89\u88c5net-tools\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4 ifconfig\u67e5\u770bip\u5730\u5740 Text Only<pre><code>ifconfig\n</code></pre> netstat \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u5404\u79cd\u7f51\u7edc\u76f8\u5173\u4fe1\u606f</p> <ul> <li>-a (all)\u663e\u793a\u6240\u6709\u9009\u9879\uff0c\u9ed8\u8ba4\u4e0d\u663e\u793aLISTEN\u76f8\u5173</li> <li>-t (tcp)\u4ec5\u663e\u793atcp\u76f8\u5173\u9009\u9879</li> <li>-u (udp)\u4ec5\u663e\u793audp\u76f8\u5173\u9009\u9879</li> <li>-n \u62d2\u7edd\u663e\u793a\u522b\u540d\uff0c\u80fd\u663e\u793a\u6570\u5b57\u7684\u5168\u90e8\u8f6c\u5316\u6210\u6570\u5b57</li> <li>-l \u4ec5\u5217\u51fa\u6709\u5728 Listen (\u76d1\u542c) \u7684\u670d\u52d9\u72b6\u6001</li> <li>-p \u663e\u793a\u5efa\u7acb\u76f8\u5173\u94fe\u63a5\u7684\u7a0b\u5e8f\u540d</li> <li>-r \u663e\u793a\u8def\u7531\u4fe1\u606f\uff0c\u8def\u7531\u8868</li> <li>-e \u663e\u793a\u6269\u5c55\u4fe1\u606f\uff0c\u4f8b\u5982uid\u7b49</li> <li>-s \u6309\u5404\u4e2a\u534f\u8bae\u8fdb\u884c\u7edf\u8ba1</li> <li>-c \u6bcf\u9694\u4e00\u4e2a\u56fa\u5b9a\u65f6\u95f4\uff0c\u6267\u884c\u8be5netstat\u547d\u4ee4</li> </ul> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u4e00\u822c\u90fd\u4f1a\u52a0\u4e0anp</li> <li>LISTEN\u548cLISTENING\u7684\u72b6\u6001\u53ea\u6709\u7528-a\u6216\u8005-l\u624d\u80fd\u770b\u5230</li> <li>Active Internet connections\uff0c\u79f0\u4e3a\u6709\u6e90TCP\u8fde\u63a5</li> <li>Active UNIX domain sockets\uff0c\u79f0\u4e3a\u6709\u6e90Unix\u57df\u5957\u63a5\u53e3(\u548c\u7f51\u7edc\u5957\u63a5\u5b57\u4e00\u6837\uff0c\u4f46\u662f\u53ea\u80fd\u7528\u4e8e\u672c\u673a\u901a\u4fe1\uff0c\u6027\u80fd\u53ef\u4ee5\u63d0\u9ad8\u4e00\u500d)</li> </ul> <p>\u5217\u51fa\u6240\u6709 tcp \u7aef\u53e3 Text Only<pre><code>netstat -atnp\n</code></pre> \u5217\u51fa\u6240\u6709 udp \u7aef\u53e3 Text Only<pre><code>netstat -aunp\n</code></pre> \u53ea\u663e\u793a\u76d1\u542c\u7aef\u53e3 Text Only<pre><code>netstat -lnp\n</code></pre> \u53ea\u5217\u51fa\u6240\u6709\u76d1\u542c tcp \u7aef\u53e3 Text Only<pre><code>netstat -ltnp\n</code></pre> \u53ea\u5217\u51fa\u6240\u6709\u76d1\u542c udp \u7aef\u53e3 Text Only<pre><code>netstat -lunp\n</code></pre> \u627e\u51fa\u7a0b\u5e8f\u8fd0\u884c\u7684\u7aef\u53e3 Text Only<pre><code>netstat -ap | grep ssh\n</code></pre> \u663e\u793a\u7f51\u7edc\u63a5\u53e3\u5217\u8868 Text Only<pre><code>netstat -i\n</code></pre></p> <p>\u4fee\u6539\u7f51\u5361\u914d\u7f6e Text Only<pre><code>vim /etc/sysconfig/network-scripts/ifcfg-ens33\n</code></pre> Text Only<pre><code>TYPE=Ethernet\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u7f51\u5361\u7c7b\u578b\uff1a\u4e3a\u4ee5\u592a\u7f51\nPROXY_METHOD=none\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u4ee3\u7406\u65b9\u5f0f\uff1a\u5173\u95ed\u72b6\u6001\nBROWSER_ONLY=no\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u53ea\u662f\u6d4f\u89c8\u5668\uff1a\u5426\nBOOTPROTO=dhcp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u7f51\u5361\u534f\u8bae DHCP \u52a8\u6001\u4e3b\u673a\u914d\u7f6e\u534f\u8bae\nDEFROUTE=yes\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u9ed8\u8ba4\u8def\u7531\uff1a\u662f\nIPV4_FAILURE_FATAL=no\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u662f\u5426\u5f00\u542fIPV4\u81f4\u547d\u9519\u8bef\u68c0\u6d4b\uff1a\u5426\nPV6INIT=yes\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# IPV6\u662f\u5426\u81ea\u52a8\u521d\u59cb\u5316: \u662f\nIPV6_AUTOCONF=\"yes\"\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# IPV6\u662f\u5426\u81ea\u52a8\u914d\u7f6e\uff1a\u662f\nIPV6_ADDR_GEN_MODE=stable-privacy\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# IPV6\u5730\u5740\u751f\u6210\u6a21\u578b\uff0cstable-privacy\u662f\u4e00\u79cd\u751f\u6210IPV6\u7684\u7b56\u7565\nNAME=ens33\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u7f51\u5361\u540d\u5b57\uff08\u4e0eDEVICE\u4e00\u81f4\uff09\nUUID=6ac17c2b-473e-4894-811b-4940ee7bf455\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u552f\u4e00\u6807\u8bc6\u7801\nDEVICE=ens33\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u7f51\u5361\u8bbe\u5907\nONBOOT=yes\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u662f\u5426\u6fc0\u6d3b\u7f51\u5361\nIPADDR=192.168.20.20\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# ip\u5730\u5740\uff08static\u8bbe\u7f6e\uff09\nNETMASK=255.255.255.0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u5b50\u7f51\u63a9\u7801\nGATEWAY=192.168.20.2\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u7f51\u5173\nDNS1=114.114.114.114\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# dns\u5730\u5740\u89e3\u6790\n</code></pre></p> <p>\u4fee\u6539Linux\u7684hosts\u6587\u4ef6 Text Only<pre><code>vim /etc/hosts\n</code></pre></p> <p>\u9632\u706b\u5899\u76f8\u5173\u914d\u7f6e \u67e5\u770b\u9632\u706b\u5899\u914d\u7f6e Text Only<pre><code>firewall-cmd --list-all\n</code></pre> \u5f00\u653e\u670d\u52a1 Text Only<pre><code>firewall-cmd --permanent --add-service=http\n</code></pre> \u5f00\u653e\u7aef\u53e3 Text Only<pre><code>firewall-cmd --permanent --add-port=80/tcp\n</code></pre> \u5173\u95ed\u7aef\u53e3 Text Only<pre><code>firewall-cmd --permanent --remove-port=80/tcp\n</code></pre> \u67e5\u8be2\u7aef\u53e3\u662f\u5426\u5f00\u653e Text Only<pre><code>firewall-cmd --query-port=80/tcp\n</code></pre> \u91cd\u65b0\u8f7d\u5165\u9632\u706b\u5899\u89c4\u5219 Text Only<pre><code>firewall-cmd --reload\n</code></pre> \u5173\u95ed\u9632\u706b\u5899 Text Only<pre><code>systemctl stop firewalld\n</code></pre> \u5173\u95ed\u5f00\u673a\u81ea\u542f Text Only<pre><code>systemctl disable firewalld.service\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/7-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/","title":"7-\u8fdb\u7a0b\u7ba1\u7406","text":"<p> \u7ea6 541 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>\u8fdb\u7a0b\u7ba1\u7406 \u53c2\u8003\uff1ahttps://www.jianshu.com/p/943b90150c10   ps\uff0cProcess Status\uff0c\u67e5\u770b\u6240\u6709\u8fdb\u8fdb\u7a0b \u5e38\u7528\u7684\u5c313\u79cd\uff1aps -f \u3001ps aux \u548c ps -ef \uff0cps -f\u4f1a\u663e\u793a\u5f53\u524dshell\u8fdb\u7a0b\u53ca\u5176\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\uff0cps aux\u548cps -ef\u90fd\u4f1a\u663e\u793a\u6240\u6709\u8fdb\u7a0b\uff0c\u533a\u522b\u5728\u4e8eps aux\u4f1a\u5b9e\u73b0\u8fdb\u7a0b\u7684\u8d44\u6e90\u5360\u7528\u60c5\u51b5\uff0cps -ef\u4f1a\u663e\u793a\u8fdb\u7a0b\u7684PPID\uff0c\u5373\u7236\u8fdb\u7a0b\u53f7\u3002 \u663e\u793a\u5f53\u524dshell\u8fdb\u7a0b\u53ca\u5176\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b Text Only<pre><code>ps -f\n</code></pre> \u67e5\u770b\u6307\u5b9a\u8fdb\u7a0b Text Only<pre><code>ps aux | grep sshd\n</code></pre> \u6309cpu\u4f7f\u7528\u7387\u6392\u5e8f\u663e\u793a Text Only<pre><code>ps -aux --sort -%cpu | less\n</code></pre> \u901a\u8fc7ppid\u67e5\u770b\u7236\u8fdb\u7a0b\uff0csystemd\u4e3a1\u53f7\u8fdb\u7a0b\uff0c\u662f\u6240\u6709\u8fdb\u7a0b\u7684\u7236\u8fdb\u7a0b Text Only<pre><code>ps -ef | less\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u5b89\u88c5psmisc\uff0c\u901a\u8fc7pstree\u547d\u4ee4\u4ee5\u6811\u72b6\u5f62\u5f0f\u67e5\u770b\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5173\u7cfb Text Only<pre><code>yum install psmisc\n</code></pre> \u67e5\u770b\u8fdb\u7a0b\u6811\uff0c-p\u00a0\u5e26\u8fdb\u7a0b\u53f7\u663e\u793a\u8fdb\u7a0b\u6811\uff0c-u \u5e26\u4e0a\u7528\u6237\u4fe1\u606f Text Only<pre><code>pstree\n</code></pre></p> <p>top\uff0c\u5b9e\u65f6\u663e\u793a\u8fdb\u7a0b\u4fe1\u606f -d \u6307\u5b9a\u5237\u65b0\u7684\u65f6\u95f4\u95f4\u9694(\u79d2)\uff0c\u9ed8\u8ba43\u79d2\uff1b-i \u4e0d\u663e\u793a\u4efb\u4f55\u95f2\u7f6e\u548c\u50f5\u6b7b\u8fdb\u7a0b\uff1b-p \u6307\u5b9a\u8fdb\u7a0b\u53f7\u76d1\u63a7\u7279\u5b9a\u7684\u8fdb\u7a0b\uff0c-H \u663e\u793a\u7ebf\u7a0b Text Only<pre><code>top\n</code></pre> \u4ea4\u4e92\u64cd\u4f5c\uff1a</p> <ul> <li>P\uff1a\u6309cpu\u4f7f\u7528\u7387\u6392\u5e8f\uff0c\u9ed8\u8ba4</li> <li>M\uff1a\u6309\u5185\u5b58\u4f7f\u7528\u7387\u6392\u5e8f</li> <li>N\uff1a\u6309PID\u6392\u5e8f</li> <li>u\uff1a\u76d1\u89c6\u6307\u5b9a\u7528\u6237\u542f\u52a8\u7684\u8fdb\u7a0b</li> <li>H\uff1a\u5207\u6362\u662f\u5426\u663e\u793a\u7ebf\u7a0b</li> <li>k\uff1a\u6740\u6b7b\u8fdb\u7a0b</li> <li>q\uff1a\u9000\u51fa</li> </ul> <p>\u5728\u547d\u4ee4\u672b\u5c3e\u52a0\u4e0a\u5b57\u7b26 &amp; \u53ef\u4ee5\u5c06\u547d\u4ee4\u7f6e\u4e8e\u540e\u53f0\u6267\u884c\uff0c\u7136\u540e\u53ef\u4ee5\u4f7f\u7528\u00a0jobs -l \u547d\u4ee4\u663e\u793a\u540e\u53f0\u4f5c\u4e1a\u4fe1\u606f</p> <p>noup\uff0cno hang up\uff0cnohup\u4e0e&amp;\u4e00\u8d77\u7528\u7684\u6548\u679c\u662f\u5c06\u8fdb\u7a0b\u7f6e\u4e8e\u540e\u53f0\u8fd0\u884c\uff0c\u5e76\u4e14\u5728\u9000\u51fa\u7ec8\u7aef\u65f6\u4e0d\u5173\u95ed\u540e\u53f0\u8fdb\u7a0b\uff0c\u5982\u679c\u4e0d\u9002\u7528nohup\uff0c\u800c\u4ec5\u4f7f\u7528&amp;\u7684\u8bdd\uff0c\u9000\u51fa\u7ec8\u7aef\u4f1a\u5173\u95ed\u540e\u53f0\u8fdb\u7a0b\uff0c\u4f8b\u5982\uff1a Text Only<pre><code>nohup sleep 60 &amp;\n</code></pre></p> <p>kill\uff0c\u6740\u6b7b\u8fdb\u7a0b\uff0c-9\uff0c\u5f3a\u5236\u6740\u6b7b killall\uff0c\u6740\u6b7b\u8fdb\u7a0b\u53ca\u5176\u6240\u6709\u5b50\u8fdb\u7a0b</p> <p>\u670d\u52a1\u7ba1\u7406 systemctl\u7ba1\u7406\u7684\u670d\u52a1\u90fd\u5728/usr/lib/systemd/system\u4e0b \u67e5\u770b\u6240\u6709\u670d\u52a1 Text Only<pre><code>systemctl list-unit-files | less\n</code></pre> \u542f\u52a8/\u5173\u95ed/\u91cd\u542f \u670d\u52a1 Text Only<pre><code>systemctl start/stop/restart \u670d\u52a1\u540d\n</code></pre> \u67e5\u770b\u670d\u52a1\u72b6\u6001 Text Only<pre><code>systemctl status \u670d\u52a1\u540d\n</code></pre> \u6fc0\u6d3b/\u7981\u6b62\u81ea\u52a8\u542f\u52a8 Text Only<pre><code>systemctl enable/disable \u670d\u52a1\u540d\n</code></pre> \u67e5\u770b\u670d\u52a1\u662f\u5426\u6fc0\u6d3b Text Only<pre><code>systemctl is-active sshd\n</code></pre> \u67e5\u770b\u670d\u52a1\u662f\u5426\u662f\u5f00\u673a\u81ea\u542f Text Only<pre><code>systemctl is-enabled sshd\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/8-%E5%8C%85%E7%AE%A1%E7%90%86/","title":"8-\u5305\u7ba1\u7406","text":"<p> \u7ea6 257 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>rpm\uff0cRedhat Package Manager \u67e5\u8be2\u662f\u5426\u5b89\u88c5\u4e86\u67d0\u4e2a\u8f6f\u4ef6 Text Only<pre><code>rpm -q sshd\n</code></pre> \u67e5\u8be2\u6240\u6709\u5df2\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305 Text Only<pre><code>rpm -qa\n</code></pre> \u5b89\u88c5rpm\u5305\uff0c-i\uff0cinstall\uff1b-v verbose \u63d0\u793a\uff1b-h hsah \u8fdb\u5ea6\u6761 Text Only<pre><code>rpm -ivh rpm\u5305\u5168\u540d\n</code></pre> \u5378\u8f7d\uff0c-e erase\uff1b-nodeps \u5f3a\u5236\u5220\u9664 Text Only<pre><code>rpm -e rpm\u5305\u5168\u540d\n</code></pre> \u67e5\u8be2\u8f6f\u4ef6\u5305\u4fe1\u606f Text Only<pre><code>rpm -qi\u00a0rpm\u5305\u5168\u540d\n</code></pre> \u67e5\u770b\u6307\u5b9a\u6587\u4ef6\u5c5e\u4e8e\u54ea\u4e2aRPM\u8f6f\u4ef6\u5305 Text Only<pre><code>rpm -qf \u6587\u4ef6\n</code></pre></p> <p>yum(Yellow dog Updater, Modified)\uff0cyum \u57fa\u4e8e rpm\uff0c\u5177\u6709\u4f9d\u8d56\u7ba1\u7406\u548c\u8f6f\u4ef6\u5347\u7ea7\u529f\u80fd\uff0c\u53ef\u4ee5\u81ea\u52a8\u5904\u7406\u4f9d\u8d56\u6027\u5173\u7cfb\uff0c\u5e76\u4e14\u4e00\u6b21\u5b89\u88c5\u6240\u6709\u4f9d\u8d56\u7684\u8f6f\u4ef6\u5305\uff0c\u65e0\u987b\u7e41\u7410\u5730\u4e00\u6b21\u6b21\u4e0b\u8f7d\u3001\u5b89\u88c5\u3002 \u5217\u51fa\u53ef\u5b89\u88c5\u7684\u8f6f\u4ef6\u6e05\u5355\uff0c\u5e38\u7528grep\u8fc7\u6ee4 Text Only<pre><code>yum list | grep\u00a0\u5305\u540d\n</code></pre> \u641c\u7d22\u8f6f\u4ef6\u5305\uff0c\u4e0e\u4e0a\u9762\u90a3\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u5dee\u4e0d\u591a Text Only<pre><code>yum search\u00a0\u5305\u540d\n</code></pre> \u5b89\u88c5\u6307\u5b9a\u7684yum\u5305 Text Only<pre><code>yum install \u5305\u540d\n</code></pre> \u79fb\u9664\u5b89\u88c5 Text Only<pre><code>yum remove \u5305\u540d\n</code></pre> \u5217\u51fa\u6240\u6709\u53ef\u66f4\u65b0\u7684\u8f6f\u4ef6\u6e05\u5355\u547d\u4ee4 Text Only<pre><code>yum check-update\n</code></pre> \u66f4\u65b0\u6240\u6709\u8f6f\u4ef6 Text Only<pre><code>yum update\n</code></pre> \u66f4\u65b0\u6307\u5b9a\u7684\u8f6f\u4ef6 Text Only<pre><code>yum update \u5305\u540d\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/Linux/9-%E5%85%B6%E5%AE%83%E5%91%BD%E4%BB%A4/","title":"9-\u5176\u5b83\u547d\u4ee4","text":"<p> \u7ea6 975 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>\u65f6\u95f4\u548c\u65e5\u671f cal\uff0ccalendar\uff0c\u663e\u793a\u65e5\u5386</p> <p>date\uff0c\u5f53\u524d\u65f6\u95f4 \u663e\u793a\u5e74 Text Only<pre><code>date +%Y\n</code></pre> \u663e\u793a\u5e74\u6708\u65e5 Text Only<pre><code>date \"+%Y-%m-%d %H:%M:%S\"\n</code></pre></p> <p>\u8bbe\u7f6e\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4 Text Only<pre><code>date -s ''2021-11-11 11:11:11''\n</code></pre></p> <p>\u5b9a\u65f6\u4efb\u52a1 crontab\uff0c-e \u7f16\u8f91\u5b9a\u65f6\u4efb\u52a1\uff0c-l \u67e5\u8be2crontab\u4efb\u52a1\uff0c-r \u5220\u9664\u5f53\u524d\u7528\u6237\u7684\u6240\u6709crontab\u4efb\u52a1 Text Only<pre><code>crontab -e\n</code></pre> \u7136\u540e\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff0c\u8868\u793a\u6bcf\u4e00\u5206\u949f\u6267\u884c\u4e00\u6b21 Text Only<pre><code>*/1**** ls -l /root\n</code></pre></p> <p>\u5176\u5b83\u6709\u7528\u7684\u547d\u4ee4 man\uff0cmanual\uff0c\u83b7\u53d6\u5e2e\u52a9\u4fe1\u606f\uff0c\u6bd4\u5982\u83b7\u53d6ls\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f Text Only<pre><code>man ls\n</code></pre></p> <p>history\uff0c\u67e5\u770b\u5386\u53f2\u547d\u4ee4 \u67e5\u770b10\u6761\u5386\u53f2\u547d\u4ee4 Text Only<pre><code>history 10\n</code></pre></p> <p>\u4fee\u6539\u4e3b\u673a\u540d Text Only<pre><code>vim /etc/hostname\n</code></pre></p> <p>hostname\uff0c\u67e5\u770b\u4e3b\u673a\u540d Text Only<pre><code>hostname\n</code></pre></p> <p>grep\uff0cGlobally search a Regular Expression and Print\uff0c\u6587\u672c\u641c\u7d22\u5de5\u5177\uff0c\u80fd\u4f7f\u7528\u7279\u5b9a\u6a21\u5f0f\u5339\u914d\uff08\u5305\u62ec\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u641c\u7d22\u6587\u672c\uff0c\u5e76\u9ed8\u8ba4\u8f93\u51fa\u5339\u914d\u884c\u3002 \u9009\u9879\uff1a</p> <ul> <li>-r \u4ee5\u9012\u5f52\u7684\u65b9\u5f0f\u67e5\u627e\u76ee\u5f55\u4e0b\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6587\u4ef6\u53ca\u8be5\u884c\u7684\u5185\u5bb9</li> <li>-c \u7edf\u8ba1\u5339\u914d\u5230\u7684\u884c\u6570</li> <li>-v \u53cd\u5411\u9009\u62e9\uff0c\u4e5f\u5c31\u662f\u663e\u793a\u51fa\u6ca1\u6709\u5339\u914d\u7684\u884c</li> <li>-n \u8f93\u51fa\u884c\u53f7</li> <li>-i \u5ffd\u7565\u5927\u5c0f\u5199</li> </ul> <p>\u8f93\u51fa\u5339\u914d\u7684\u884c\u53ca\u884c\u53f7 Text Only<pre><code>grep -n 'yes'\u00a0/root/hello.txt\n</code></pre> \u67e5\u627e /root \u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u4e2d\u5305\u542b\u5b57\u7b26\u4e32\"yes\"\u7684\u6587\u4ef6\uff0c\u5e76\u6253\u5370\u51fa\u8be5\u5b57\u7b26\u4e32\u6240\u5728\u884c\u7684\u5185\u5bb9 Text Only<pre><code>grep -r 'yes' /root\n</code></pre></p> <p>last \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u7528\u6237\u6700\u8fd1\u767b\u5f55\u4fe1\u606f</p> <p>\u8f93\u5165\u8f93\u51fa\u91cd\u5b9a\u5411  \u8f93\u51fa\u91cd\u5b9a\u5411 &gt;(\u8986\u76d6) \u548c &gt;&gt;(\u8ffd\u52a0) Text Only<pre><code>echo aaa 1&gt; a.txt\n</code></pre> echo\u7684\u8f93\u51fa\u9ed8\u8ba4\u662f\u6807\u51c6\u8f93\u51fa\uff0c\u8fd9\u91cc\u4f7f\u7528 1&gt; \u8868\u793a\u5c06\u6807\u51c6\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6a.txt\uff0c\u7b49\u4ef7\u4e8e\u76f4\u63a5\u4f7f\u7528 Text Only<pre><code>echo aaa &gt; a.txt\n</code></pre> \u5c06ll\u547d\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5408\u5e76\uff1a Text Only<pre><code>ll &gt; list.txt 2&gt;&amp;1\n</code></pre></p> <p>\u53cc\u5411\u8f93\u51fa\u91cd\u5b9a\u5411 tee\u6307\u4ee4\u4f1a\u4ece\u6807\u51c6\u8f93\u5165\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5c06\u5185\u5bb9\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u7684\u540c\u65f6\u8f93\u51fa\u5230\u6587\u4ef6 \u9009\u9879\uff1a-a\u00a0\u9644\u52a0\u5230\u65e2\u6709\u6587\u4ef6\u7684\u540e\u9762\uff0c\u800c\u975e\u8986\u76d6\u5b83 Text Only<pre><code>tee [-a] file\n</code></pre></p> <p>\u7ba1\u9053 \u7ba1\u9053\u4e32\u8d77\u7684\u4e24\u4e2a\u547d\u4ee4\u4f1a\u4f9d\u6b21\u6267\u884c\u3002 Linux\u7cfb\u7edf\u5b9e\u9645\u4e0a\u4f1a\u540c\u65f6\u8fd0\u884c\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u5728\u7cfb\u7edf\u5185\u90e8\u5c06\u5b83\u4eec\u8fde\u63a5\u8d77\u6765\u3002\u5728\u7b2c\u4e00\u4e2a\u547d\u4ee4\u4ea7\u751f\u8f93\u51fa\u7684\u540c\u65f6\uff0c\u8f93\u51fa\u4f1a\u88ab\u7acb\u5373\u9001\u7ed9\u7b2c\u4e8c\u4e2a\u547d\u4ee4\u3002\u6570\u636e\u4f20\u8f93\u4e0d\u4f1a\u7528\u5230\u4efb\u4f55\u4e2d\u95f4\u6587\u4ef6\u6216\u7f13\u51b2\u533a\u3002</p> <p>\u5173\u673a\u3001\u91cd\u542f \u7acb\u523b\u5173\u673a Text Only<pre><code>shutdown -h now\npoweroff\ninit 0\nhalt\n</code></pre> \u5b9a\u65f6\u5173\u673a \u4e00\u5206\u949f\u540e\u5173\u673a\uff0c\u76f4\u63a5\u8f93\u5165 shutdown \u7b49\u540c\u4e8e\u4e00\u5206\u949f\u540e\u5173\u673a Text Only<pre><code>shutdown -h 1\n</code></pre> 11:00\u5173\u673a Text Only<pre><code>shutdown -h 11:00\n</code></pre> \u7acb\u5373\u91cd\u542f Text Only<pre><code>shutdown -r now\ninit 6\nreboot\n</code></pre> \u5b9a\u65f6\u91cd\u542f 10\u5206\u949f\u540e\u91cd\u542f Text Only<pre><code>shutdown -r 10\n</code></pre> 11\uff1a00\u91cd\u542f Text Only<pre><code>shutdown -r 11:00\n</code></pre> \u540c\u6b65\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5230\u78c1\u76d8 Text Only<pre><code>sync\n</code></pre></p> <p>\u8fd0\u884c\u7ea7\u522b\uff1a</p> <ul> <li>0\uff1ahalt \u5173\u673a\uff0c\u4ee3\u8868\u7cfb\u7edf\u505c\u673a\u72b6\u6001\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u8fd0\u884c\u7ea7\u522b\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\uff0c\u5426\u5219\u7535\u8111\u4e00\u5f00\u673a\u5c31\u8fdb\u5165\u5173\u673a\u6a21\u5f0f\uff0c\u7535\u8111\u5c06\u4e0d\u80fd\u6b63\u5e38\u542f\u52a8</li> <li>1\uff1aSingle user mode \u5355\u7528\u6237\u6a21\u5f0f\uff0c\u53ea\u652f\u6301root\u8d26\u6237\uff0c\u4e3b\u8981\u7528\u4e8e\u7cfb\u7edf\u7ef4\u62a4\uff0c\u7981\u6b62\u8fdc\u7a0b\u767b\u9646\uff0c\u7c7b\u4f3c\u4e8eWindows\u4e0b\u7684\u5b89\u5168\u6a21\u5f0f</li> <li>2\uff1aMultiuser without NFS\uff0c\u591a\u7528\u6237\u6a21\u5f0f\uff0c\u6ca1\u6709\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u652f\u6301</li> <li>3\uff1aFull Multiuser mode \u5b8c\u5168\u591a\u7528\u6237\u6a21\u5f0f\uff0c\u6709\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u6237\u767b\u5f55\u540e\u8fdb\u5165\u63a7\u5236\u53f0\u547d\u4ee4\u884c\u6a21\u5f0f\uff0c\u5728\u6ca1\u6709\u7f51\u7edc\u7684\u73af\u5883\u4e0b\u7b49\u540c\u4e8e\u8fd0\u884c\u7ea7\u522b2</li> <li>4\uff1aunused \u7cfb\u7edf\u672a\u4f7f\u7528\uff0c\u7528\u4f5c\u4fdd\u7559\uff0c\u4e00\u822c\u4e0d\u7528\uff0c\u5728\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\u53ef\u4ee5\u7528\u5b83\u6765\u505a\u4e00\u4e9b\u4e8b\u60c5\uff0c\u4f8b\u5982\uff1a\u5728\u7b14\u8bb0\u672c\u7535\u8111\u7684\u7535\u6c60\u7528\u5c3d\u65f6\uff0c\u53ef\u4ee5\u5207\u6362\u5230\u8fd9\u4e00\u6a21\u5f0f\u6765\u505a\u4e00\u4e9b\u8bbe\u7f6e</li> <li>5\uff1aX11 \u56fe\u5f62\u754c\u9762\u7684\u591a\u7528\u6237\u6a21\u5f0f\u7528\u6237\u767b\u5f55\u540e\u76f4\u63a5\u8fdb\u5165X-Window\u7cfb\u7edf</li> <li>6\uff1aReboot \u91cd\u542f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd0\u884c\u7ea7\u522b\u4e0d\u80fd\u8bbe\u4e3a6\uff0c\u5426\u5219\u7535\u8111\u4e00\u5f00\u673a\u5c31\u8fdb\u5165\u91cd\u542f\u6a21\u5f0f\u4f1a\u4e00\u76f4\u4e0d\u505c\u5730\u91cd\u542f\uff0c\u7cfb\u7edf\u5c06\u4e0d\u80fd\u6b63\u5e38\u7684\u542f\u52a8</li> </ul> <p>\u83b7\u53d6\u9ed8\u8ba4\u8fd0\u884c\u7ea7\u522b Text Only<pre><code>systemctl get-default\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/1-IO/","title":"1-IO","text":"<p> \u7ea6 5829 \u4e2a\u5b57  14 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 117 \u5206\u949f</p> <p>\u524d\u60c5\u63d0\u8981\uff1a \u7528\u6237\u6001\u548c\u5185\u6838\u6001\u6307\u7684\u662fcpu\u6b63\u5728\u6267\u884c\u8c01\u7684\u4ee3\u7801\uff0c\u5982\u679c\u6267\u884c\u7684\u662f\u7528\u6237\u4ee3\u7801\uff0c\u90a3\u4e48cpu\u6b63\u5904\u4e8e\u7528\u6237\u6001\uff0c\u5982\u679c\u6267\u884c\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u4ee3\u7801\uff0c\u90a3\u4e48cpu\u5904\u4e8e\u5185\u6838\u6001\u3002\u5f53\u7528\u6237\u7a0b\u5e8f\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u65f6\u4f1a\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u4ee3\u7801\uff0c\u4e8e\u662fcpu\u4fbf\u4f1a\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u5f53\u7cfb\u7edf\u8c03\u7528\u5b8c\u6210\u65f6\uff0ccpu\u4e5f\u5c31\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002\u9700\u8981\u91cd\u70b9\u8bf4\u660e\u7684\u662f\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u5e76\u4e0d\u662fcpu\u8fdb\u5165\u4ec0\u4e48\u795e\u5947\u7684\u72b6\u6001\uff0c\u53ea\u4e0d\u8fc7\u662f\u8fd0\u884c\u7684\u4e0d\u540c\u5c42\u6b21\u7684\u4ee3\u7801\u800c\u5df2\uff0c\u5f53\u7136\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u80fd\u6267\u884c\u6743\u9650\u66f4\u9ad8\u7684\u6307\u4ee4\uff0c\u6240\u4ee5\u4e5f\u5c31\u662f\u5185\u6838\u6001\u76f8\u6bd4\u4e8e\u7528\u6237\u6001\u66f4\u6709\u66f4\u9ad8\u7684\u8bbf\u95ee\u6743\u9650\u3002 \u4ece\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u4ee3\u4ef7\u662f\u5f88\u5927\u7684\uff0c\u56e0\u4e3a\u5f53\u7528\u6237\u7a0b\u5e8f\u8c03\u7528\u7cfb\u7edf\u8c03\u7528\u65f6\uff0c\u8fdb\u7a0b\u5c31\u4f1a\u5f00\u59cb\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u4ee3\u7801\uff0c\u6bcf\u6b21\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u4ee3\u7801\u7684\u65f6\u5019\u53ef\u80fd\u771f\u6b63\u6267\u884c\u6211\u4eec\u60f3\u8981\u7684\u529f\u80fd\u7684\u4ee3\u7801\u5c31\u90a3\u51e0\u884c\uff0c\u4f46\u662f\u4e3a\u4e86\u6267\u884c\u8fd9\u51e0\u884c\u4ee3\u7801\u9700\u8981\u7ecf\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u5c42\u5c42\u8c03\u7528\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u662f\u4e00\u4e2a\u901a\u7528\u6027\u5f88\u5f3a\u7684\u5e73\u53f0\uff0c\u9700\u8981\u505a\u5f88\u591a\u5176\u5b83\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u6821\u9a8c\u7b49\uff0c\u6240\u4ee5\u8bf4\u7cfb\u7edf\u8c03\u7528\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u7684\u4ee3\u4ef7\u5f88\u5927\u3002 \u7528\u6237\u7a7a\u95f4\u6307\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u7528\u6237\u8fdb\u7a0b\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u5185\u6838\u7a7a\u95f4\u6307\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5df1\u6267\u884c\u65f6\u7684\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u3002</p> <p>IO\uff1a \u5e94\u7528\u8fdb\u7a0b\u5e76\u4e0d\u662f\u76f4\u63a5\u4e0eIO\u8bbe\u5907\u4ea4\u4e92\u5b8c\u6210\u6570\u636e\u7684\u8f93\u5165\u8f93\u51fa\uff0c\u800c\u662f\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4ea4\u4e92\uff0c\u518d\u7531\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\u5b8c\u6210IO\u3002 \u6bd4\u5982\u5e94\u7528\u7a0b\u5e8f\u8bfb\u6570\u636e\u7684\u8fc7\u7a0b\u662f\uff0c\u5728\u7528\u6237\u6001\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u7136\u540e\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u5728\u5185\u6838\u6001\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8c03\u7528\u9a71\u52a8\u7a0b\u5e8f\u5c06\u5916\u90e8\u8bbe\u5907\u7684\u6570\u636e\u8bfb\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u63a5\u7740\u64cd\u4f5c\u7cfb\u7edf\u5c06\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u6700\u540e\u7531\u5185\u6838\u6001\u5207\u6362\u5230\u7528\u6237\u6001\u3002 \u5e94\u7528\u7a0b\u5e8f\u5c06\u6570\u636e\u5199\u51fa\u7684\u8fc7\u7a0b\u4e0e\u8bfb\u5165\u7684\u8fc7\u7a0b\u4e00\u6837\uff0c\u53ea\u662f\u6570\u636e\u7684\u6d41\u5411\u76f8\u53cd\uff0c\u5373\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6570\u636e\u4ece\u7528\u6237\u7a0b\u5e8f\u5730\u5740\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u63a5\u7740\u7531\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u9a71\u52a8\u7a0b\u5e8f\u5c06\u6570\u636e\u5199\u51fa\u5230\u5916\u90e8\u8bbe\u5907\u3002  \u53ef\u89c1\u7528\u6237\u7a0b\u5e8f\u4e0e\u5916\u90e8\u8bbe\u5907\u5b8c\u6210\u6570\u636e\u4ea4\u4e92\u7684\u8fc7\u7a0b\u90fd\u9700\u8981\u7ecf\u8fc7\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4ece\u800cIO\u4e5f\u5c31\u88ab\u5206\u4e3a\u4e86\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u5373\u5916\u90e8\u8bbe\u5907\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u3001\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u4e0e\u7528\u6237\u7a0b\u5e8f\u5730\u5740\u7a7a\u95f4\u4e4b\u95f4\u6570\u636e\u4f20\u8f93\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u5c06\u6570\u636e\u4ece\u7528\u6237\u5730\u5740\u7a7a\u95f4\u5199\u5230\u5916\u90e8\u8bbe\u5907 \u6216\u8005 \u4ece\u5916\u90e8\u8bbe\u5907\u8bfb\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\uff0c\u800c\u975e\u8981\u5728\u5185\u6838\u7a7a\u95f4\u52a0\u4e00\u4e2a\u7f13\u51b2\u533a\u5462\uff1f \u9996\u5148\u662f\u8bfb\u6570\u636e\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u8c03\u5ea6\u7684\u7f18\u6545\uff0c\u6211\u4eec\u77e5\u9053IO\u6bd4\u8f83\u8017\u65f6\uff0c\u6240\u4ee5\u5f53\u8fdb\u7a0b\u53d1\u751fIO\u662f\u4e00\u5b9a\u8981\u88ab\u52a0\u5165\u5230\u7b49\u5f85\u961f\u5217\u4e2d\u963b\u585e\u7684\uff0c\u5982\u679c\u4e0d\u5728\u5185\u6838\u8bbe\u7f6e\u7f13\u51b2\u533a\uff0c\u76f4\u63a5\u5c06\u6570\u636e\u5199\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\u7684\u8bdd\uff0c\u90a3\u4e48\u6bcf\u6765\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u636e\u5c31\u9700\u8981\u5524\u9192\u8fdb\u7a0b\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u6837\u7684\u8c03\u5ea6\u5f00\u9500\u65e0\u7591\u5de8\u5927\u3002\u90a3\u600e\u4e48\u4e0d\u5728\u7528\u6237\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u8bbe\u7f6e\u7f13\u51b2\u533a\u5462\uff0c\u5f53\u7f13\u51b2\u533a\u586b\u6ee1\u4e86\u518d\u5524\u9192\u7528\u6237\u8fdb\u7a0b\u5904\u7406\uff1f\u597d\u4e3b\u610f\uff0c\u4f46\u662f\u7531\u4e8e\u865a\u62df\u5185\u5b58\u7684\u673a\u5236\uff0c\u7528\u6237\u8fdb\u7a0b\u7684\u7f13\u51b2\u533a\u5206\u9875\u53ef\u80fd\u4f1a\u88ab\u8c03\u51fa\uff0c\u8fd9\u4f1a\u5b58\u5728\u95ee\u9898\uff08\u81f3\u4e8e\u4ec0\u4e48\u95ee\u9898\u4e0d\u80fd\u8bf4\u5f97\u5f88\u6e05\u695a\uff0c\u53cd\u6b63\u80fd\u611f\u89c9\u5230\u5c31\u662f\u6709\u95ee\u9898\uff09\u3002\u6240\u4ee5\u6700\u7a33\u59a5\u7684\u65b9\u5f0f\u662f\u5728\u5185\u6838\u5efa\u7acb\u7f13\u51b2\u533a\uff08\u5176\u5b9e\u8fd8\u662f\u4e2a\u53cc\u7f13\u51b2\u533a\u673a\u5236\uff09\uff0c\u5f53\u7f13\u51b2\u533a\u6ee1\u4e86\u4e4b\u540e\u518d\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\u3002 \u5176\u5b9e\u6570\u636e\u4ece\u5185\u5b58\u5230\u5185\u5b58\u7684\u901f\u5ea6\u662f\u5f88\u5feb\u7684\uff08\u5f53\u7136\u8fd9\u4e2d\u95f4\u9700\u8981\u7ecf\u8fc7cpu\uff09\uff0c\u4e3a\u4e86\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6548\u7387\uff0c\u53ef\u4ee5\u4f7f\u7528Memory Map (mmap\uff0c\u4e5f\u662f\u4e00\u4e2aLinux\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u4e2a\u5e94\u8be5\u4ec5\u9650\u4e8e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u8bfb\u6570\u636e\u7684\u60c5\u51b5)\uff0c\u5c31\u662f\u76f4\u63a5\u628a\u5185\u6838\u7f13\u51b2\u533a\u7684\u5730\u5740\u7a7a\u95f4\u6620\u5c04\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\uff08\u5e94\u8be5\u662f\u76f4\u63a5\u5c06\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u7684\u5730\u5740\u5199\u5230\u8fdb\u7a0b\u7684\u9875\u8868\u5373\u53ef\uff09\uff0c\u8fd9\u6837\u5c31\u7701\u53bb\u4e86\u4e00\u6b21\u6570\u636e\u590d\u5236\u7684\u6210\u672c\u3002 \u7136\u540e\u5199\u6570\u636e\u4e5f\u662f\u540c\u6837\u7684\u9053\u7406\uff0c\u6ca1\u6709\u5185\u6838\u7f13\u51b2\u533a\uff0c\u76f4\u63a5\u5c06\u6570\u636e\u4ece\u7528\u6237\u5730\u5740\u7a7a\u95f4\u5199\u5230\u5916\u90e8\u8bbe\u5907\u65f6\uff0c\u9700\u8981\u963b\u585e\u7528\u6237\u8fdb\u7a0b\uff0c\u8fd9\u671f\u95f4\u7528\u6237\u8fdb\u7a0b\u7684\u6570\u636e\u5206\u9875\u53ef\u80fd\u4f1a\u88ab\u6362\u51fa\uff0c\u5c06\u5206\u9875\u4ece\u78c1\u76d8\u6362\u8fdb\u53c8\u662f\u4e00\u6b21IO\uff0c\u6548\u7387\u964d\u4f4e\uff08\u6709\u6ca1\u6709\u53ef\u80fd\u9501\u4f4f\u5206\u9875\u4e0d\u7136\u64cd\u4f5c\u7cfb\u7edf\u6362\u51fa\u5462\uff0c\u8bfb\u6570\u636e\u7684\u65f6\u5019\u80af\u5b9a\u662f\u4e0d\u80fd\u91c7\u7528\u9501\u9875\u8fd9\u79cd\u64cd\u4f5c\u7684\uff0c\u56e0\u4e3a\u4e0d\u77e5\u9053\u6570\u636e\u4ec0\u4e48\u65f6\u5019\u6765\uff0c\u5f3a\u884c\u9501\u9875\u4f1a\u5bfc\u81f4\u6574\u4e2a\u7528\u6237\u5730\u5740\u5229\u7528\u6025\u5267\u964d\u4f4e\uff0c\u4f46\u662f\u5199\u6570\u636e\u4e0d\u5e94\u8be5\u6709\u8fd9\u6837\u7684\u987e\u8651\uff0c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u64cd\u4f5c\u7cfb\u7edf\u6709\u9501\u4f4f\u5206\u9875\u8fd9\u8fd9\u79cd\u64cd\u4f5c\u5417\uff09\u3002</p> <p>\u6839\u636e\u5916\u90e8IO\u8bbe\u5907\u7684\u4e0d\u540c\uff0cIO\u53ef\u5206\u4e3a\u5f88\u591a\u79cd\uff0c\u6bd4\u5982\u78c1\u76d8IO\u3001\u7f51\u7edcIO\u3001\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7684IO\u7b49\uff0c\u5404\u79cdIO\u7684\u7279\u70b9\u4e0d\u540c\uff0c\u6240\u4ee5\u9488\u5bf9\u6bcf\u4e00\u79cdIO\u8bbe\u5907\u90fd\u6709\u4e0d\u540c\u7684\u6570\u636e\u8f93\u5165\u8f93\u51fa\u65b9\u5f0f\u3002</p> <p>\u5916\u90e8\u8bbe\u5907 \u5230 \u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a \u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\u6709\uff1a</p> <ol> <li>\u8f6e\u8be2\u65b9\u5f0f\uff1aCPU\u4e3b\u52a8\u5728\u5404\u79cd\u8bbe\u5907\u4e2d\u8f6e\u8be2\u68c0\u67e5\u72b6\u6001\uff0c\u6709\u6570\u636e\u5c31IO\u3002</li> <li>\u4e2d\u65ad\u65b9\u5f0f\uff1a\u8bbe\u5907\u6709\u6570\u636e\u7684\u65f6\u5019\uff0c\u53d1\u51fa\u4e2d\u65ad\uff0c\u7531CPU\u51b3\u5b9a\u8981\u4e0d\u8981\u54cd\u5e94\u4e2d\u65ad\uff0c\u7136\u540e\u4e2d\u65ad\uff0c\u53bb\u5904\u7406\u8bbe\u5907\u7684IO\uff0cCPU\u4e0d\u7528\u7ecf\u5e38\u8f6e\u8be2\u8bbe\u5907\u72b6\u6001\uff0c\u88ab\u52a8\u63a5\u6536\u4e2d\u65ad\u5c31\u884c\u3002</li> <li>DMA\uff08direct memory access\uff0c\u76f4\u63a5\u5b58\u50a8\u5668\u8bbf\u95ee\uff09\u65b9\u5f0f\uff1a\u5982\u679c1\u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e2d\u65ad\u4e00\u6b21\uff0c\u4f201KB\u7684\u6570\u636e\u5f97\u4e2d\u65ad1024\u6b21\uff0c\u592a\u6d6a\u8d39CPU\u65f6\u95f4\uff0c\u4e8e\u662f\u6709\u4e86DMA\u65b9\u5f0f\uff0cCPU\u53ea\u9700\u8981\u628a\u5f00\u5934\u548c\u7ed3\u675f\u7684\u5730\u5740\u544a\u8bc9DMA\uff0c\u4e2d\u95f4\u7531DMA\u5b8c\u6210\u6570\u636eIO\uff0cCPU\u4ece\u5b57\u8282\u5e72\u9884\u89e3\u653e\u5230\u6570\u636e\u5757\u7684\u5e72\u9884\u3002</li> <li>\u901a\u9053\u63a7\u5236\u65b9\u5f0f\uff1aDMA\u65b9\u5f0f\u53ea\u80fd\u63a7\u5236\u4e00\u4e2a\u8bbe\u5907\u7684\u4e00\u5757\u6570\u636e\uff0c\u591a\u5757\u6570\u636e\u8fd8\u662f\u8981CPU\u5e72\u9884\u591a\u6b21\uff0c\u4e8e\u662f\u5c31\u6709\u4e86\u901a\u9053\u6765\u63a7\u5236IO\uff0c\u5b83\u6bd4DMA\u66f4\u5f3a\u5927\uff0c\u80fd\u63a7\u5236\u591a\u5757\u6570\u636e\uff0c\u591a\u4e2a\u8bbe\u5907\u7684IO\uff0c\u66f4\u52a0\u89e3\u653e\u4e86CPU\u53c2\u4e0eIO\u8fc7\u7a0b\u3002</li> </ol> <p>\u6bd4\u5982\u4ece\u7f51\u5361\u63a5\u6536\u6570\u636e\u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u7f13\u51b2\u533a\u7684\u8fc7\u7a0b\u662f\uff0c\u7f51\u5361\u63a5\u6536\u5230\u53d1\u9001\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\uff0c\u7ecf\u89e3\u8c03\u8f6c\u6362\u6210\u6570\u5b57\u4fe1\u53f7\u7f13\u5b58\u5728\u7f51\u5361\u7684\u7f13\u51b2\u533a\u4e2d\uff08\u8fd9\u4e2a\u7f13\u51b2\u533a\u5e94\u8be5\u6bd4\u8f83\u5c0f\uff09\uff0c\u7136\u540e\u7531DMA\u5c06\u7f13\u51b2\u533a\u6570\u636e\u5199\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\uff08\u8fd9\u4e2a\u8fc7\u7a0b\u5e94\u8be5\u662f\u7531DMA\u6267\u884c\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u5b8c\u6210\u7684\uff09\uff0c\u63a5\u7740\u7f51\u5361\u5411cpu\u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\u901a\u77e5\u6709\u6570\u636e\u5230\u8fbe\uff0c\u7136\u540ecpu\u6267\u884c\u4e2d\u65ad\u7a0b\u5e8f\uff0c\u4e2d\u65ad\u7a0b\u5e8f\u505a\u7684\u4e8b\u60c5\u662f\uff0c\u5148\u5c06\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u5199\u5230\u5bf9\u5e94\u7684socket\u7684\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u5c06\u8be5socket\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\u5524\u9192\uff0c\u81f3\u6b64\u6570\u636e\u5df2\u7ecf\u5230\u8fbe\u5185\u6838\u7f13\u51b2\u533a\uff0c\u7528\u6237\u8fdb\u7a0b\u4e5f\u88ab\u5524\u9192\u4e86\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5c5e\u4e8e\u6570\u636e\u4ece\u5916\u90e8\u8bbe\u5907\u5230\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u7684\u8fc7\u7a0b\uff0c\u81f3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u5982\u4f55\u5c06\u8fdb\u7a0b\u52a0\u5165socket\u7684\u7b49\u5f85\u961f\u5217\u5c31\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u5411\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684IO\u6a21\u578b\u7684\u8303\u56f4\u4e86\uff0c\u53cd\u6b63\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u53ea\u8d1f\u8d23\u5c06\u6570\u636e\u5199\u5230\u5bf9\u5e94socket\u7684\u8f93\u5165\u7f13\u51b2\u533a\u5e76\u5524\u9192socket\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\u3002  \u6709\u4e2a\u95ee\u9898\uff0c\u5728\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\u8fd9\u672c\u4e66\u91cc\u63cf\u8ff0\u7684\u8fc7\u7a0b\u662f\u6570\u636e\u5148\u7f13\u5b58\u5728\u5916\u90e8\u8bbe\u5907\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u7136\u540e\u590d\u5236\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\uff0c\u518d\u590d\u5236\u5230\u7528\u6237\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u662f\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5c06\u5df2\u7ecf\u5199\u5230\u5185\u5b58\u4e2d\u6570\u636e\u518d\u91cd\u65b0\u6839\u636e\u5957\u63a5\u5b57\u76845\u5143\u7ec4\u5199\u5230\u5bf9\u5e94\u7684socket\u7684\u8f93\u5165\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2d\u95f4\u53c8\u591a\u4e86\u4e00\u6b21\u6570\u636e\u7684\u590d\u5236\uff0c\u80fd\u4e0d\u80fd\u76f4\u63a5\u7531DMA\u8c03\u7528\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u5c06\u7f51\u5361\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u76f4\u63a5\u5199\u5230socket\u5bf9\u5e94\u7684\u8f93\u5165\u7f13\u51b2\u533a\u4e2d\u5462\uff08\u6216\u8005\u8bf4socket\u7684\u8f93\u5165\u8f93\u51fa\u7f13\u51b2\u533a\u5728\u7528\u6237\u5730\u5740\u7a7a\u95f4\uff1f\u611f\u89c9\u4e5f\u4e0d\u5bf9\u5440\uff0c\u8fd9\u4e2a\u7b49\u5f85\u961f\u5217\u5e94\u8be5\u5728\u5185\u6838\u7f13\u51b2\u533a\uff09\u3002</p> <p>\u4e0a\u9762\u63cf\u8ff0\u7684\u662fDMA\u65b9\u5f0f\uff0c\u5982\u679c\u91c7\u7528\u4e2d\u65ad\u7684\u65b9\u5f0f\u8bfb\u6570\u636e\uff0c\u6211\u60f3\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff0c\u7f51\u5361\u5148\u5c06\u6570\u636e\u7f13\u5b58\u5728\u81ea\u5df1\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u5411cpu\u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\uff0c\u63a5\u7740cpu\u6267\u884c\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u5c06\u6570\u636e\u4ece\u7f13\u51b2\u533a\u5199\u5230socket\u7684\u8f93\u5165\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u5524\u9192\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u770b\u5230\u4ece\u6570\u636e\u4ece\u5916\u90e8\u8bbe\u5907\u5230\u5185\u5b58\u662f\u9700\u8981cpu\u53c2\u4e0e\u7684\uff0c\u5373\u7531cpu\u6267\u884c\u9a71\u52a8\u7a0b\u5e8f\uff0c\u800cDMA\u65b9\u5f0f\u4e2dCPU\u4e0d\u53c2\u4e0e\uff0c\u7531DMA\u5b8c\u6210\uff0c\u4e2d\u65ad\u7a0b\u5e8f\u9700\u8981cpu\u53c2\u4e0e\u6267\u884c\uff0c\u4f46\u662f\u8fd9\u662f\u6570\u636e\u4ece\u5185\u5b58\u5230\u5185\u5b58\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u5e94\u8be5\u5f88\u5feb\u3002\u56e0\u4e3a\u7f51\u5361\u89e3\u8c03\u7684\u901f\u5ea6\u548c\u7f51\u5361\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u6709\u9650\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u534f\u8c03\u53d1\u9001\u65b9\u7684\u53d1\u9001\u901f\u7387\u3002</p> <p>DMA\u89e3\u51b3\u7684\u662f\u6570\u636e\u4ece\u5916\u90e8\u8bbe\u5907\u5230\u5185\u6838\u7f13\u51b2\u533a\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u9700\u8981CPU\u53c2\u4e0e\uff0c\u4f46\u662f\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u5230\u7528\u6237\u7f13\u51b2\u533a \u6216\u8005 \u4ece\u5185\u6838\u7f13\u51b2\u533a\u5230\u5185\u6838\u7f13\u51b2\u533a \u4e4b\u95f4\u7684\u62f7\u8d1d\u662f\u9700\u8981CPU\u53c2\u4e0e\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u8fc7\u7a0b\u5f88\u5feb\uff0c\u603b\u4e4b\u5c31\u662f\u6570\u636e\u4ece\u5185\u5b58\u5230\u5185\u5b58\u9700\u8981\u7ecf\u8fc7CPU\uff0c\u4f46\u662f\u6570\u636e\u4ece\u5185\u5b58\u5230\u5916\u8bbe\u3000\u6216\u8005\u3000\u4ece\u5916\u8bbe\u5230\u5185\u5b58\u91cc\u4e0d\u9700\u8981\u7ecf\u8fc7CPU\uff0c\u5728DMA\u7684\u63a7\u5236\u4e0b\u5c31\u53ef\u4ee5\u5b8c\u6210\u3002</p> <p>\u5bf9\u4e8e\u7528\u6237\u8fdb\u7a0b\u800c\u8a00\uff0c\u7528\u6237\u8fdb\u7a0b\u80fd\u770b\u5230\u7684\u53ea\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\uff0c\u6240\u4ee5\u5f53\u7528\u6237\u8fdb\u7a0b\u8bfb\u6570\u636e\u65f6\uff0c\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u6709\u6ca1\u6709\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u9700\u4e0d\u9700\u8981\u963b\u585e\u7528\u6237\u8fdb\u7a0b\uff0c\u91c7\u53d6\u4e0d\u540c\u7684\u7b56\u7565\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7528\u6237\u7684\u4e0d\u540c\u7684\u7f16\u7a0b\u63a5\u53e3\uff0c\u4fd7\u79f0IO\u6a21\u578b\uff1b\u5f53\u7528\u6237\u8fdb\u7a0b\u5199\u6570\u636e\u65f6\uff0c\u5185\u6838\u7f13\u51b2\u533a\u6ca1\u6709\u7a7a\u95f4\uff0c\u662f\u4e00\u5b9a\u4f1a\u963b\u585e\u7528\u6237\u7684\u8fdb\u7a0b\uff0c\u6ca1\u6709\u5176\u5b83\u7b56\u7565\uff08\u5f85\u786e\u5b9a\uff1f\uff09\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a \u4e0e \u7528\u6237\u7a0b\u5e8f\u5730\u5740\u7a7a\u95f4 \u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u5411\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684IO\u6a21\u578b\uff08\u53ea\u662f\u8bfb\u6570\u636e\uff1f\uff09\uff1a</p> <ol> <li>\u963b\u585e\uff1a\u7528\u6237\u7ebf\u7a0b\u8c03\u7528\u67d0\u4e9b\u7cfb\u7edf\u51fd\u6570\u53bb\u5185\u6838\u53d6\u6570\u636e\uff0c\u76f4\u5230\u6570\u636e\u5230\u8fbe\u5185\u6838cache\u524d\uff0c\u8be5\u7ebf\u7a0b\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u7b49\u5f85\u6570\u636e\u5230\u8fbe\u3002</li> <li>\u975e\u963b\u585e\uff1a\u7528\u6237\u7ebf\u7a0b\u53d6\u6570\u636e\u65f6\u5982\u679c\u5185\u6838cache\u6ca1\u6709\u6570\u636e\uff0c\u7528\u6237\u7ebf\u7a0b\u4e0d\u4f1a\u963b\u585e\u7b49\u5f85\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u7136\u540e\u4e0d\u65ad\u5730\u5faa\u73af\u53bb\u5185\u6838\u6001\u53d6\u6570\u636e\uff0c\u76f4\u5230\u5185\u6838\u6001\u51c6\u5907\u597d\u4e86\u6570\u636e\u3002</li> <li>IO\u591a\u8def\u590d\u7528\uff1a\u4e00\u4e2a\u7ebf\u7a0b\u7ba1\u7406\u591a\u8defIO\uff0c\u7ebf\u7a0b\u8fd8\u662f\u88ab\u963b\u585e\u8c03\u7528\uff0c\u5176\u4e2d\u4e00\u8def\u6216\u51e0\u8defIO\u6709\u6570\u636e\u4e86\u5c31\u8fd4\u56de\u3002\u4f8b\u5982 socket \u7684 select() \u51fd\u6570\uff0c\u7ebf\u7a0b\u8c03\u7528 select() \u8fdb\u5165\u963b\u585e\u6001\uff0c\u4efb\u4f55\u4e00\u4e2aIO\u6709\u6570\u636e\u4e86\uff0c\u7ebf\u7a0b\u5c31\u9000\u51fa\u963b\u585e\u6001\uff0c\u7136\u540e\u7ebf\u7a0b\u904d\u5386\u5168\u90e8IO\uff0c\u5224\u65ad\u662f\u54ea\u4e2aIO\u6709\u6570\u636e\u3002</li> <li>\u4fe1\u53f7\u9a71\u52a8IO\uff1a\u7ed9\u4e00\u4e2aIO\u6ce8\u518c\u4e00\u4e2a\u4fe1\u53f7\u548c\u4fe1\u53f7\u89e6\u53d1\u7684\u56de\u8c03\u51fd\u6570\uff0c\u4e00\u65e6\u4fe1\u53f7\u88ab\u89e6\u53d1\uff0c\u56de\u8c03\u51fd\u6570\u91cc\u8bfb\u53d6\u6570\u636e\u3002\u4f8b\u5982\u7ed9 socket \u6ce8\u518c\u4e00\u4e2a\u201c\u53ef\u8bfb\u201d\u7684\u4fe1\u53f7\uff0c\u5f53\u6570\u636e\u6765\u4e86\uff0c\u53ef\u8bfb\u7684\u65f6\u5019\uff0c\u4fe1\u53f7\u88ab\u89e6\u53d1\uff0c\u6267\u884c\u56de\u8c03\u51fd\u6570\u4ece\u5185\u6838cache\u590d\u5236\u6570\u636e\u5230\u7528\u6237\u7a7a\u95f4\u3002</li> <li>\u5f02\u6b65IO\uff1a\u5f02\u6b65IO\u4e2d\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5b8c\u6210\u4e86\u6570\u636e\u4ece\u5185\u6838\u5230\u7528\u6237\u7a7a\u95f4\u7684\u62f7\u8d1d\u540e\uff0c\u4ee5\u4fe1\u53f7\u7684\u65b9\u5f0f\u901a\u77e5\u7528\u6237\u7ebf\u7a0b\u53ef\u4ee5\u4e0b\u4e00\u6b65\u64cd\u4f5c\u3002\u7701\u53bb\u4e86\u7528\u6237\u7ebf\u7a0b\u963b\u585e\u4e0b\u6765\u62f7\u8d1d\u6570\u636e\u7684\u8fc7\u7a0b\u3002</li> </ol> <p>\u6ce8\u610f\uff0c\u5bf9\u4e8e\u78c1\u76d8IO\u800c\u8a00\uff0c\u7cfb\u7edf\u8c03\u7528\u90fd\u662f\u963b\u585eIO\uff0c\u56e0\u4e3a\u78c1\u76d8\u4e0a\u6587\u4ef6\u90fd\u662f\u4e8b\u5148\u51c6\u5907\u597d\u7684\u6570\u636e\uff0c\u4e0d\u50cf\u7f51\u7edcIO\u9700\u8981\u7b49\u5f85\u6570\u636e\u7684\u5230\u6765\uff0c\u6240\u4ee5\u7f51\u7edcIO\u9700\u8981\u8003\u8651\u6570\u636e\u5230\u4e86\u6ca1\u6709\uff0c\u4ece\u800c\u51b3\u5b9a\u662f\u5426\u9700\u8981\u963b\u585e\u7528\u6237\u8fdb\u7a0b\uff0c\u6240\u4ee5\u7f51\u7edcIO\u6709\u4e0a\u97625\u79cd\u65b9\u5f0f\u3002\u603b\u4e4b\u4e00\u53e5\u8bdd\uff0c\u8003\u8651IO\u65f6\u4e0d\u80fd\u603b\u60f3\u7740\u7f51\u7edcIO\uff0c\u6bcf\u4e00\u79cdIO\u8bbe\u5907\u6839\u636e\u6570\u636e\u8f93\u5165\u7684\u7279\u70b9\u4e0d\u540c\uff0c\u90fd\u6709\u4e0d\u540c\u7684IO\u65b9\u5f0f\u3002</p> <p>\u4ee5\u4e0b\u91cd\u70b9\u8bf4\u660e\u7f51\u7edcIO\u7684\u5404\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff1a 1.\u963b\u585eIO \u4e00\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u4e00\u4e2asocket\u4e2d\u7684\u6570\u636e\uff0c\u5982\u679c\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u90a3\u4e48\u5c31\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u64cd\u4f5c\u7cfb\u7edf\u628a\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\u3002 \u963b\u585eIO\u6a21\u578b\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5f53socket\u7684\u8f93\u5165\u7f13\u51b2\u533a\u6ca1\u6709\u6570\u636e\u65f6\u76f4\u63a5\u5c06\u7ebf\u7a0b\u963b\u585e\u5230socket\u7684\u7b49\u5f85\u961f\u5217\u4e2d\u3002  2.\u975e\u963b\u585e\u5f0fIO \u4e00\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u4e00\u4e2asocket\u4e2d\u7684\u6570\u636e\uff0c\u5982\u679c\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u4e0d\u963b\u585e\u800c\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u7136\u540e\u4e0d\u65ad\u5faa\u73af\u53bb\u5185\u6838\u6001\u53d6\u6570\u636e\uff0c\u76f4\u5230\u5185\u6838\u6001\u51c6\u5907\u597d\u4e86\u6570\u636e\u3002\u4e0e\u963b\u585e\u5f0fIO\u76f8\u6bd4\uff0c\u6b64\u79cd\u65b9\u5f0f\u6ca1\u6709\u7ebf\u7a0b\u8c03\u5ea6\u7684\u5f00\u9500\uff0c\u4f46\u662f\u5b58\u5728\u7740\u4e0d\u65ad\u4ece\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u4e4b\u95f4\u5207\u6362\u7684\u5f00\u9500\u3002 \u975e\u963b\u585eIO\u6a21\u578b\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5f53socket\u7684\u8f93\u5165\u7f13\u51b2\u533a\u6ca1\u6709\u6570\u636e\u65f6\u4e0d\u963b\u585e\u7ebf\u7a0b\uff0c\u7531\u7ebf\u7a0b\u81ea\u5df1\u51b3\u5b9a\u662f\u5426\u518d\u6b21\u5411\u5185\u6838\u53d6\u6570\u636e\u3002  3.IO\u591a\u8def\u590d\u7528 \u4e00\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u591a\u4e2asocket\u4e2d\u6570\u636e\uff0c\u5982\u679c\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u90a3\u4e48\u5c31\u963b\u585e\u7b49\u5f85\uff0c\u4e00\u65e6\u5185\u6838\u7f13\u51b2\u533a\u6709socket\u7684\u51c6\u5907\u597d\u4e86\u6570\u636e\uff0c\u5c31\u7acb\u5373\u8fd4\u56de\u5904\u7406\u6570\u636e\uff0c\u5904\u7406\u5b8c\u540e\u518d\u8fdb\u884c\u4e0b\u4e00\u8f6e\u3002  IO\u591a\u8def\u590d\u7528\u5728Linux\u4e0a\u6709\u591a\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u6bd4\u5982select\u3001poll\u3001epoll\uff08FreeBSD \u4e2d\u5219\u4e3a kqueue\uff0c\u5373epoll \u662f linux \u4e0b\u7684\uff0ckqueue \u662f unix \u4e0b\u7684\uff09\u7b49\u3002</p> <p>select\uff1a \u7528\u6cd5\uff1a\u5c06\u8981\u76d1\u542c\u7684socket\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u52a0\u5165\u5230\u76d1\u542c\u96c6\u5408\u4e2d\uff0c\u7136\u540e\u963b\u585e\u7b49\u5f85\uff08\u8003\u8651\u7684\u662f\u6ca1\u6709\u6570\u636e\u7684\u60c5\u51b5\uff09\uff0c\u4e00\u65e6\u6709\u4e8b\u4ef6\u51c6\u5907\u5c31\u7eea\u4e86\u5c31\u8fd4\u56de\uff0c\u7136\u540e\u904d\u5386\u6574\u4e2asocket\u96c6\u5408\u67e5\u770b\u54ea\u4e9bsocket\u4e2d\u6709\u6570\u636e\u3002 Text Only<pre><code>int s = socket(AF_INET, SOCK_STREAM, 0);\u00a0\u00a0\nbind(s, ...)\nlisten(s, ...)\nint fds[] =\u00a0\u00a0\u5b58\u653e\u9700\u8981\u76d1\u542c\u7684socket\nwhile(1){\n\u00a0\u00a0\u00a0\u00a0int n = select(..., fds, ...)\n\u00a0\u00a0\u00a0\u00a0for(int i=0; i &lt; fds.count; i++){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(FD_ISSET(fds[i], ...)){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//fds[i]\u7684\u6570\u636e\u5904\u7406\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u539f\u7406\uff1a \u8c03\u7528select\u65f6\uff0c \u2460 \u4f1a\u5c06socket\u96c6\u5408\u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c \u2461 \u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u904d\u5386\u8be5\u96c6\u5408\uff0c\u5c06\u7ebf\u7a0b\u52a0\u5165\u5230\u6240\u6709socket\u7684\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u7136\u540e\u963b\u585e\u7ebf\u7a0b\uff0c \u2462 \u63a5\u7740\u4e00\u65e6\u67d0\u4e2asocket\u7684\u8f93\u5165\u7f13\u51b2\u533a\u6709\u6570\u636e\u5230\u8fbe\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u5c06\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u7136\u540e\u518d\u6b21\u904d\u5386socket\u96c6\u5408\u5c06\u7ebf\u7a0b\u79fb\u51fa\u6bcf\u4e2asocket\u7684\u7b49\u5f85\u961f\u5217\uff0c\u5524\u9192\u8be5\u7ebf\u7a0b\uff0c\u56de\u5230\u7528\u6237\u6001 \u2463 \u6700\u540e\u7528\u6237\u8fdb\u7a0b\u904d\u5386socket\u96c6\u5408\u67e5\u770b\u54ea\u4e9bsocket\u4e2d\u6709\u6570\u636e\u3002  \u4ece\u8fd9\u4e2a\u6d41\u7a0b\u4e2d\u53ef\u4ee5\u770b\u5230select\u65b9\u5f0f\u6709\u5982\u4e0b\u7684\u7f3a\u70b9\uff1a 1.\u6bcf\u6b21\u8c03\u7528select\u90fd\u9700\u8981\u5c06\u6574\u4e2asocket\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4 2.\u64cd\u4f5c\u7cfb\u7edf\u6bcf\u6b21\u5c06\u8fdb\u7a0b\u52a0\u5165\u6216\u8005\u79fb\u9664\u7b49\u5f85\u961f\u5217\u65f6\u9700\u8981\u904d\u5386\u6574\u4e2a\u76d1\u542c\u96c6\u5408\uff0c\u8fdb\u7a0b\u6bcf\u6b21\u88ab\u5524\u9192\u4e4b\u540e\u4e5f\u9700\u8981\u904d\u5386\u6574\u4e2a\u76d1\u542c\u96c6\u5408\uff0c\u6240\u4ee5\u4e00\u6b21select\u8c03\u7528\u8981\u904d\u53863\u6b21</p> <p>epoll\uff1a epoll\u5c31\u662f\u6765\u89e3\u51b3select\u8fd9\u4e9b\u7f3a\u70b9\u7684\uff0c\u4e3b\u8981\u662f\u5c06select\u7684\u7b2c\u2461\u6b65\u62c6\u5f00\u4e86\u3002 epoll\u7684\u7528\u6cd5\u662f\uff1a\u5148\u7528epoll_create\u521b\u5efa\u4e00\u4e2aepoll\u5bf9\u8c61epfd\uff0c\u518d\u901a\u8fc7epoll_ctl\u5c06\u9700\u8981\u76d1\u89c6\u7684socket\u6dfb\u52a0\u5230epfd\u4e2d\uff08\u6b64\u6b65\u53ef\u4ee5\u770b\u4f5c\u662f\u53ea\u662f\u5c06\u8fdb\u7a0b\u52a0\u5165\u5230\u4e86socket\u7684\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u963b\u585e\u8fdb\u7a0b\uff09\uff0c\u6700\u540e\u8c03\u7528epoll_wait\u7b49\u5f85\u6570\u636e\uff08\u8fd9\u91cc\u624d\u963b\u585e\u4e86\u8fdb\u7a0b\uff09\u3002 Text Only<pre><code>int s = socket(AF_INET, SOCK_STREAM, 0);\u00a0\u00a0\u00a0\nbind(s, ...)\nlisten(s, ...)\n\nint epfd = epoll_create(...);\nepoll_ctl(epfd, ...); //\u5c06\u6240\u6709\u9700\u8981\u76d1\u542c\u7684socket\u6dfb\u52a0\u5230epfd\u4e2d\n\nwhile(1){\n\u00a0\u00a0\u00a0\u00a0int n = epoll_wait(...)\n\u00a0\u00a0\u00a0\u00a0for(\u63a5\u6536\u5230\u6570\u636e\u7684socket){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5904\u7406\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4e3a\u4ec0\u4e48\u8bf4epoll\u89e3\u51b3\u4e86select\u7684\u90a3\u4e9b\u95ee\u9898\u5462\uff1f 1.\u8c03\u7528epoll_ctl\u662f\u5c06\u9700\u8981\u76d1\u542c\u7684socket\u7684\u653e\u5230epoll_create\u521b\u5efa\u7684epoll\u5bf9\u8c61epfd\u7684\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u5e76\u4e0d\u662f\u5c06\u8fdb\u7a0b\u653e\u5230socket\u7684\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u6240\u4ee5\u5e76\u6ca1\u6709\u963b\u585e\u8fdb\u7a0b\uff0c\u53ea\u6709\u5f53\u8c03\u7528epoll_wait\u624d\u963b\u585e\u8fdb\u7a0b\uff0c\u963b\u585e\u8fdb\u7a0b\u662f\u5c06\u8fdb\u7a0b\u653e\u5230epfd\u7684\u53e6\u4e00\u4e2a\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u6240\u4ee5\u6bcf\u6b21\u8fdb\u7a0b\u88ab\u5524\u9192\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5c06\u8fdb\u7a0b\u7a0b\u79fb\u51fa\u7b49\u5f85\u961f\u5217\u5373\u53ef\uff0c\u5e76\u4e0d\u9700\u8981\u5c06socket\u79fb\u51fa\u7b49\u5f85\u961f\u5217\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f7f\u7528epoll\u53ea\u9700\u8981\u5728\u7b2c\u4e00\u6b21\u5c06\u76d1\u542c\u96c6\u5408\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u5f53\u7136\u5982\u679c\u540e\u7eed\u8fd8\u9700\u8981\u5c06socket\u52a0\u5165\u6216\u79fb\u51fa\u76d1\u542c\u96c6\u5408\uff0c\u6709\u76f8\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u3002 2.\u8fdb\u7a0b\u88ab\u5524\u9192\u65f6\u64cd\u4f5c\u7cfb\u7edf\u8fd4\u56de\u7684\u662f\u6240\u6709\u5df2\u7ecf\u63a5\u6536\u5230\u6570\u636e\u7684socket\uff0c\u5e76\u4e0d\u9700\u8981\u7528\u6237\u8fdb\u7a0b\u904d\u5386\u6574\u4e2a\u76d1\u542c\u96c6\u5408\u8fdb\u884c\u5224\u65ad\u3002</p> <p>epoll\u539f\u7406\uff1a \u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u5c06\u8fdb\u7a0b\u52a0\u5165\u6216\u79fb\u51fa\u5230socket\u7684\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u5462\uff0c\u662f\u5728\u7b2c\u4e00\u6b21\u904d\u5386\u6574\u4e2a\u76d1\u542c\u96c6\u5408\uff0c\u4ee5\u540e\u6bcf\u5f53\u6709\u65b0\u7684socket\u9700\u8981\u52a0\u5165\uff0c\u6216\u8005\u65e7\u7684socket\u79fb\u51fa\u65f6\u90fd\u91cd\u65b0\u904d\u5386\u4e00\u6b21socket\u96c6\u5408\u5417\uff08\u65b0\u52a0\u5165socket\u65f6\u4e3a\u9632\u6b62\u91cd\u590d\u52a0\u5165\u9700\u8981\u904d\u5386\uff09\uff1f \u2460 \u5176\u5b9e\u5e76\u4e0d\u9700\u8981\u904d\u5386\u6574\u4e2asocket\u96c6\u5408\uff0c\u56e0\u4e3aepoll\u4e3a\u6574\u4e2asocket\u96c6\u5408\u521b\u5efa\u4e86\u4e00\u4e2a\u7ea2\u9ed1\u6811\u7d22\u5f15\uff0c\u8fd9\u6837\u65b0\u52a0\u5165socket\u7684\u65f6\u5019\u76f4\u63a5\u5728\u7ea2\u9ed1\u6811\u4e0a\u67e5\u627e\u770b\u6709\u6ca1\u6709\u91cd\u590d\u5373\u53ef\uff0c\u6ca1\u6709\u91cd\u590d\u5c31\u5c06socket\u7684\u7d22\u5f15\u63d2\u5165\u5230\u7ea2\u9ed1\u6811\u4e0a\uff0c\u91cd\u590d\u4e86\u5c31\u62d2\u7edd\u63d2\u5165\u3002\u5c06socket\u79fb\u51fa\u76d1\u542c\u96c6\u5408\u65f6\u76f4\u63a5\u5728\u7ea2\u9ed1\u6811\u4e0a\u67e5\u627esocket\u5bf9\u5e94\u7684\u7d22\u5f15\u7136\u540e\u5220\u9664\u5373\u53ef\u3002 \uff08\u6ce8\u610f\u8fd9\u4e2a\u7ea2\u9ed1\u6811\u7d22\u5f15\u5c31\u5728eventpoll\u4e2d\uff0c\u5728epoll\u6e90\u7801\u7684\u6570\u636e\u7ed3\u6784\u4e2d\u53ebrbr\uff0ceventpoll\u4e5f\u662f\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u5458\uff0c\u7531\u7cfb\u7edf\u8c03\u7528epoll_ceate\u521b\u5efa\uff0c\u548csocket\u4e00\u6837\uff0c\u5b83\u4e5f\u6709\u7b49\u5f85\u961f\u5217\uff0c\u7a0d\u540e\u963b\u585e\u8fdb\u7a0b\u7684\u65f6\u5019\u4f1a\u628a\u8fdb\u7a0b\u52a0\u5165\u8fd9\u4e2aeventpoll\u7684\u7b49\u5f85\u961f\u5217\u4e2d\u3002\uff09  \u2461 \u7136\u540e\u963b\u585e\u8fdb\u7a0b\uff08\u6240\u6709socket\u90fd\u6ca1\u6709\u6570\u636e\uff09  \u2462 \u7136\u540e\u6709\u6570\u636e\u6765\u4e86\uff0c\u4e2d\u65ad\u7a0b\u5e8f\u4e00\u662f\u4f1a\u628a\u6709\u6570\u636e\u7684socket\u7684\u7d22\u5f15\u6dfb\u52a0\u5230\u5c31\u7eea\u5217\u8868\u4e2d\uff08\u8fd9\u4e2a\u5c31\u7eea\u5217\u8868\u4e5f\u5728eventpoll\u4e2d\uff0c\u5728epoll\u6e90\u7801\u7684\u6570\u636e\u7ed3\u6784\u4e2d\u53ebrdlist\uff0c\u662f\u4e00\u4e2a\u94fe\u8868\u7ed3\u6784\uff09\uff0c\u4e8c\u662f\u4f1a\u5524\u9192eventpoll\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\u3002\uff08\u611f\u89c9epoll\u80fd\u6bd4select\u66f4\u9ad8\u6548\uff0c\u4e3b\u8981\u5c31\u662f\u9760\u8fd9\u4e2a\u4e2d\u65ad\u7a0b\u5e8f\uff0c\u539f\u5148\u5728select\u4e2d\uff0c\u4e2d\u65ad\u7a0b\u5e8f\u53ea\u80fd\u5524\u9192socket\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\uff0c\u73b0\u5728\u5728epoll\u4e2d\uff0c\u4e2d\u65ad\u7a0b\u5e8f\u4e0d\u4ec5\u53ef\u4ee5\u7ef4\u62a4rdlist\u5217\u8868\uff0c\u8fd8\u53ef\u4ee5\u5524\u9192\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\uff09  \u2463 \u6700\u540e\u5c06socket\u7684\u6570\u636e\u548crdlist\u4ece\u5185\u6838\u7a7a\u95f4\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u7136\u540e\u4ece\u7528\u6237\u8fdb\u7a0b\u6267\u884c\u3002</p> <p>\u603b\u7ed3\uff1aselect\u548cepoll\u7684\u533a\u522b\u5c31\u5728\u4e8e\uff0cselect\u662f\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u5373\u4f20\u5165\u76d1\u542c\u96c6\u5408\u548c\u963b\u585e\u8fdb\u7a0b\u7528\u4e00\u6b65\u64cd\u4f5c\u5b8c\u6210\uff1b\u4f46\u662fepoll\u662f3\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u5373\u5148\u7528epoll_create\u521b\u5efaepoll\uff0c\u4e5f\u5c31\u662f\u5185\u6838\u7a7a\u95f4\u7684eventpoll\uff0c\u4e5f\u662f\u4e00\u4e2a\u6587\u4ef6\uff1b\u7136\u540eepoll_ctl\u4f20\u5165\u76d1\u542c\u96c6\u5408\uff0c\u6700\u540eepoll_wait\u963b\u585e\u8fdb\u7a0b\u3002\u95ee\u9898\u7684\u5173\u952e\u5c31\u5728\u4e8e\u6bcf\u6b21\u8c03\u7528select\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u628a\u8fd9\u4e09\u4ef6\u4e8b\u90fd\u505a\u4e00\u904d\uff0c\u800cepoll\u628a\u8fd9\u4e09\u4ef6\u4e8b\u62c6\u89e3\u4e86\uff0c\u5728\u4f7f\u7528epoll\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u5904\u7406\u5b8c\u6570\u636e\u53ea\u9700\u8981\u8c03\u7528\u6700\u540e\u4e00\u6b65\u91cd\u65b0\u963b\u585e\u8fdb\u7a0b\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u5728\u628a\u524d\u9762\u91cd\u590d\u7684\u4e8b\u60c5\u518d\u505a\u4e00\u904d\u3002</p> <p>4.\u4fe1\u53f7\u9a71\u52a8IO \u4e00\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u4e00\u4e2asocket\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u7ba1\u5185\u6838\u6570\u636e\u6709\u6ca1\u6709\u51c6\u5907\u5230\u90fd\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u7136\u540e\u63a5\u7740\u7ee7\u7eed\u8fd0\u884c\u5904\u7406\u5176\u5b83\u4e8b\u60c5\uff0c\u5f53\u5185\u6838\u7f13\u51b2\u533a\u51c6\u5907\u597d\u6570\u636e\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u7ed9\u7ebf\u7a0b\u53d1\u9001\u4e00\u4e2a\u4fe1\u53f7\uff0c\u7ebf\u7a0b\u6536\u5230\u4fe1\u53f7\u4e4b\u540e\u8c03\u7528\u56de\u8c03\u51fd\u6570\u3002  5.\u5f02\u6b65IO \u4e0e\u4fe1\u53f7\u9a71\u52a8IO\u7c7b\u4f3c\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u4e00\u4e2asocket\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u7ba1\u5185\u6838\u6570\u636e\u6709\u6ca1\u6709\u51c6\u5907\u5230\u90fd\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u7136\u540e\u63a5\u7740\u7ee7\u7eed\u8fd0\u884c\u5904\u7406\u5176\u5b83\u4e8b\u60c5\uff0c\u53ea\u4e0d\u8fc7\u5f02\u6b65IO\u8fd4\u56de\u7684\u65f6\u673a\u662f\u5f53\u64cd\u4f5c\u7cfb\u7edf\u628a\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\u65f6\uff0c\u800c\u4e0d\u662f\u5185\u6838\u7a7a\u95f4\u51c6\u5907\u597d\u6570\u636e\u65f6\u3002 </p> <p>\u603b\u7ed3\uff1a\u6700\u540e\u51e0\u79cdIO\u65b9\u5f0f\u7684\u5bf9\u6bd4\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u524d4\u79cd\u5728\u5185\u6838\u7a7a\u95f4\u51c6\u5907\u597d\u6570\u636e\u540e\u90fd\u4f1a\u963b\u585e\u7b49\u5f85\u64cd\u4f5c\u7cfb\u7edf\u5c06\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u800c\u5f02\u6b65IO\u4e0d\u9700\u8981\uff0c\u8fd9\u662f\u56e0\u4e3a\u524d4\u4e2d\u65b9\u5f0f\u90fd\u4f7f\u7528\u4e86\u7cfb\u7edf\u8c03\u7528recvfrom\u4ece\u5185\u6838\u7f13\u51b2\u533a\u53d6\u6570\u636e\uff0c\u5f53\u7528\u6237\u7a0b\u5e8f\u8c03\u7528\u7cfb\u7edf\u8c03\u7528\u65f6\uff0c\u8fdb\u7a0b\u5c31\u4f1a\u5f00\u59cb\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u7528\u6237\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u5bf9\u4e8e\u7528\u6237\u5c42\u9762\u6765\u8bf4\u53ef\u4ee5\u8ba4\u4e3a\u662f\u963b\u585e\u4e86\u3002 \u9664\u4e86IO\u591a\u8def\u590d\u7528\u5916\u7684\u5176\u5b83IO\u65b9\u5f0f\u90fd\u662f\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u4e00\u4e2asocket\uff0c\u867d\u7136\u5728\u5904\u7406\u7684\u5ef6\u65f6\u4e0a\u662f\u4f18\u4e8eIO\u591a\u8def\u590d\u7528\uff0c\u4f46\u662f\u7528\u7684\u6700\u591a\u7684\u8fd8\u662fIO\u591a\u8def\u590d\u7528\u65b9\u5f0f\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u5927\u91cfsocket\uff0c\u4ece\u800c\u5b9e\u73b0\u9ad8\u5e76\u53d1\u8fde\u63a5\u3002 </p> <p>\u524d\u9762\u7684IO\u6a21\u578b\u597d\u50cf\u90fd\u662f\u9488\u5bf9\u7528\u6237\u8fdb\u7a0b\u8bfb\u6570\u636e\u800c\u8a00\u7684\uff08\u5f85\u786e\u5b9a\uff1f\u597d\u50cfIO\u591a\u8def\u590d\u7528\u4e2d\u6709write\u4e8b\u4ef6\uff09\uff0c\u5bf9\u4e8e\u5c06\u6570\u636e\u4ece\u7528\u6237\u8fdb\u7a0b\u5199\u6570\u636e\uff0c\u597d\u50cf\u53ea\u80fd\u662f\u5148\u5c06\u6570\u636e\u4ece\u7528\u6237\u5730\u5740\u7a7a\u95f4\u5199\u5230\u5185\u6838\u7f13\u51b2\u533a\uff0c\u4e0d\u80fd\u4f7f\u7528mmap\uff0c\u800c\u4e14\u8c03\u7528\u5199\u6570\u636e\u7684\u7cfb\u7edf\u8c03\u7528\u65f6\u4e00\u5b9a\u662f\u4f1a\u963b\u585e\u7528\u6237\u8fdb\u7a0b\u7684\uff0c\u76f4\u5230\u6570\u636e\u5199\u5b8c\u4e3a\u6b62\u3002</p> <p>\u4f46\u5982\u679c\u662f\u5148\u4ece\u5916\u90e8\u8bbe\u5907\u8bfb\uff0c\u7136\u540e\u518d\u5199\u5230\u5916\u90e8\u8bbe\u5907\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u53ef\u4ee5\u4f18\u5316\u7684\u3002 1.\u8bfb\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528mmap\u3002\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u662f\u76f4\u63a5\u5c06\u6570\u636e\u4ece\u5185\u6838\u7684\u8bfb\u7f13\u51b2\u533a\u5199\u5230\u4e86\u5185\u6838\u5199\u7f13\u51b2\u533a\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u5c06\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\u7684\u6210\u672c\u3002 2.\u4f7f\u7528sendfile\u7cfb\u7edf\u8c03\u7528\u4e00\u6b21\u641e\u5b9a\u3002\u76f8\u6bd4\u4e8emmap\u53ea\u662f\u51cf\u5c11\u4e00\u6b21\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\uff0c\u6570\u636e\u540c\u6837\u662f\u76f4\u63a5\u4ece\u5185\u6838\u7684\u8bfb\u7f13\u51b2\u533a\u5199\u5230\u4e86\u5185\u6838\u5199\u7f13\u51b2\u533a\u3002\u56e0\u4e3a\u53ea\u5728\u5185\u6838\u6001\u8fdb\u884c\uff0c\u6240\u4ee5\u7528\u6237\u8fdb\u7a0b\u65e0\u6cd5\u64cd\u4f5c\u6570\u636e\uff0c\u4ee3\u7801\u4e0a\u7684\u4f53\u73b0\u5c31\u662f\uff0c\u4f7f\u7528mmap\u662f\u4e24\u90e8\u641e\u5b9a\u7684\uff0c\u6240\u4ee5\u4e2d\u95f4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u4f46\u662f\u4f7f\u7528snedfile\u662f\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u6ca1\u6709\u64cd\u4f5c\u6570\u636e\u7684\u4f59\u5730\u3002 3.sendfile+DMA Scatter/Gather\u3002\u76f8\u6bd4\u4e8e\u53ea\u4f7f\u7528sendfile\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u6570\u636e\u662f\u76f4\u63a5\u4ece\u5185\u6838\u8bfb\u7f13\u51b2\u533a\u6620\u5c04\u5230\u5185\u6838\u5199\u7f13\u51b2\u533a\u7684\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/","title":"10-git","text":""},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_1","title":"\u4e00\u3001\u5e38\u7528\u547d\u4ee4","text":""},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_2","title":"\u521d\u59cb\u5316\u8bbe\u7f6e","text":"<ol> <li>\u8bbe\u7f6e\u7528\u6237\u540d</li> </ol> Text Only<pre><code>git config --global user.name Jmoon\n</code></pre> <ol> <li>\u8bbe\u7f6e\u90ae\u7bb1</li> </ol> Text Only<pre><code>git config --global user.email jmoon531@foxmail.com\n</code></pre> <ol> <li>\u521d\u59cb\u5316\u672c\u5730\u5e93</li> </ol> Text Only<pre><code>git init\n</code></pre> <ol> <li>\u67e5\u770b\u672c\u5730\u5e93\u72b6\u6001</li> </ol> Text Only<pre><code>git status\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_3","title":"\u6682\u5b58\u533a","text":"<p>\u6682\u5b58\u533a\u7684\u4f5c\u7528\u5c31\u662f\u8ba9\u5728\u547d\u4ee4\u884c\u4e0b\u53ef\u4ee5\u5206\u591a\u6b21\u63d0\u4ea4\u4fee\u6539\u3002\u4f46\u662f\u5728IDEA\u4e2d\u53ef\u4ee5\u52fe\u9009\u6587\u4ef6\u5206\u591a\u6b21\u63d0\u4ea4\uff0c\u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3a\u5728IDEA\u4e2d\u4f7f\u7528git\u6ca1\u6709\u6682\u5b58\u533a\uff08\u6216\u8005\u628a<code>git add</code>\u547d\u4ee4\u8ba4\u4e3a\u662f\u4f7f\u7528git\u5bf9\u6587\u4ef6\u8fdb\u884c\u7248\u672c\u63a7\u5236\uff0c\u628a<code>git rm</code>\u547d\u4ee4\u8ba4\u4e3a\u662f\u89e3\u9664\u5bf9\u6587\u4ef6\u7684\u7248\u672c\u63a7\u5236\uff09\u3002</p> <ol> <li>\u6dfb\u52a0\u5230\u6682\u5b58\u533a\uff0c\u5982\u679c\u8be5\u6587\u4ef6\u7b2c\u4e00\u6b21\u88ab\u6dfb\u52a0\uff0c\u90a3\u4e48\u4f1a\u88abgit\u8fdb\u884c\u7248\u672c\u63a7\u5236\uff1b\u5728\u5de5\u4f5c\u533a\u4fee\u6539\u540e\u518dadd\uff0c\u53ef\u4ee5\u8986\u76d6\u6682\u5b58\u533a\u4e4b\u524d\u7684\u4fee\u6539\u3002</li> </ol> Text Only<pre><code>git add &lt;\u6587\u4ef6\u540d&gt;\n</code></pre> <ol> <li>\u4ece\u6682\u5b58\u533a\u4e2d\u5220\u9664\u6587\u4ef6\uff0c\u53ef\u8ba4\u4e3a\u662f\u89e3\u9664\u7248\u672c\u63a7\u5236\uff0c\u8981\u6c42\u662f\u6682\u5b58\u533a\u7684\u6587\u4ef6\u5185\u5bb9\u548c\u672c\u5730\u6587\u4ef6\u7684\u5185\u5bb9\u4e00\u81f4\uff0c\u52a0-f\u53ef\u4ee5\u5f3a\u5236\u5220\u9664\u3002</li> </ol> Text Only<pre><code>\u4ece\u6682\u5b58\u533a\u4e2d\u5220\u9664\u5355\u4e2a\u6587\u4ef6\uff1agit rm --cached &lt;\u6587\u4ef6\u540d&gt;\n\u4ece\u6682\u5b58\u533a\u4e2d\u5220\u9664\u5168\u90e8\u6587\u4ef6\uff1agit rm --cached -r .\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#commit","title":"commit\uff08\u63d0\u4ea4\uff09","text":"<ol> <li>\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93</li> </ol> Text Only<pre><code>git commit -m \"\u63d0\u4ea4\u4fe1\u606f\" &lt;\u6587\u4ef6\u540d&gt;\n</code></pre> <ol> <li>\u820d\u5f03\u4e0a\u4e00\u6b21\u63d0\u4ea4\uff0c\u91cd\u65b0\u63d0\u4ea4\u4e00\u4e2a\u65b0\u7684\u7248\u672c\uff08\u56fe\u4e2dC2'\uff09\u3002\u4e0a\u4e00\u6b21\u63d0\u4ea4\u4e0d\u4f1a\u6d88\u5931\uff0c\u53ea\u662f\u4e0d\u5728\u5f53\u524d\u5206\u652f\u4e0a\u4e86\uff08\u56fe\u4e2dC2\uff09\uff0cgit\u91cc\u7684\u6240\u6709\u63d0\u4ea4\u6c38\u8fdc\u90fd\u4e0d\u6d88\u5931\u3002</li> </ol> Text Only<pre><code>git commit --amend -m \"\u65b0\u7684\u63d0\u4ea4\u4fe1\u606f\"\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#branch","title":"branch\uff08\u5206\u652f\uff09","text":"<ol> <li> <p>\u67e5\u770b\u6709\u54ea\u4e9b\u5206\u652f</p> </li> <li> <p>\u67e5\u770b\u672c\u5730\u5206\u652f\uff1a<code>git branch -v</code></p> </li> <li>\u67e5\u770b\u8fdc\u7a0b\u5206\u652f\uff1a<code>git branch -r</code></li> <li> <p>\u67e5\u770b\u6240\u6709\u5206\u652f\uff1a<code>git branch -a</code></p> </li> <li> <p>\u5728\u6307\u5b9a\u7248\u672c\u5904\u521b\u5efa\u5206\u652f\uff0c\u4e0d\u52a0\u7248\u672c\u53f7\u8868\u793a\u5728\u5f53\u524d\u7248\u672c\u5904</p> </li> </ol> Text Only<pre><code>git branch &lt;\u5206\u652f\u540d&gt; &lt;\u7248\u672c\u53f7&gt;\n</code></pre> <p>\u5e38\u7528\u5728\u5f53\u524d\u7248\u672c\u5904\u521b\u5efa\u5206\u652f</p> Text Only<pre><code>git branch &lt;\u5206\u652f\u540d&gt;\n</code></pre> <ol> <li>\u5220\u9664\u5206\u652f</li> </ol> Text Only<pre><code>git branch -d &lt;\u5206\u652f\u540d&gt;\n</code></pre> <ol> <li>\u5c06\u6307\u5b9a\u5206\u652f\u5207\u6362\u5230\u6307\u5b9a\u7684\u7248\u672c\u5904\uff0c-f \u8868\u793a\u5f3a\u5236\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4e5f\u53ef\u4ee5\u8fdb\u884c\u7248\u672c\u56de\u9000\uff0c\u4e0e<code>git reset</code>\u7684\u533a\u522b\u662f\uff0c<code>git branch -f</code> \u79fb\u52a8\u7684\u5206\u652f\u4e0d\u80fd\u4e0ehead\u5904\u4e8e\u5408\u4f53\u72b6\u6001\uff0c\u800c<code>git reset</code> \u5fc5\u987b\u5904\u4e8e\u5408\u4f53\u72b6\u6001\uff08\u4e5f\u5c31\u662f<code>git branch -f</code> \u8fdb\u884c\u7248\u672c\u56de\u9000\u65f6\u4e0d\u9700\u8981head\u6307\u9488\u5e26\u7740\u79fb\u52a8\uff0c\u800c<code>git reset</code> \u5fc5\u987b\u5f97head\u6307\u9488\u5e26\u7740\u79fb\u52a8\uff0c<code>git branch -f</code>\u770b\u4e0a\u53bb\u786e\u5b9e\u66f4\u52a0\u65b9\u4fbf\u5feb\u901f\u70b9\uff0c\u4f46\u662f\u5728IDEA\u4e2d\u4e0d\u652f\u6301\u8fd9\u6837\u505a\uff0c\u6240\u4ee5\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528<code>git branch -f</code>\uff0c\u5176\u5b9e\u7248\u672c\u63a7\u5236\u53ea\u8bb0\u4f4f\u5e38\u7528\u7684\u51e0\u4e2a\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86\uff0c\u867d\u7136\u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u8ba9\u64cd\u4f5c\u66f4\u52a0\u5feb\u901f\uff0c\u4f46\u662f\u8fd9\u4f1a\u589e\u52a0\u601d\u8003\u7684\u65f6\u95f4\u6210\u672c\uff0c\u5178\u578b\u7684\u592a\u7075\u6d3b\u4e86\u53ef\u80fd\u53cd\u5012\u4f1a\u8ba9\u5de5\u4f5c\u51fa\u9519\uff0c\u5c31\u8bb0\u4f4f\u90a3\u51e0\u4e2a\u5173\u952e\u547d\u4ee4\uff0c\u867d\u7136\u9ebb\u70e6\u70b9\uff0c\u4f46\u662f\u5728\u90a3\u4e2a\u601d\u7ef4\u6a21\u5f0f\u4e0b\u7248\u672c\u63a7\u5236\u7684\u539f\u5219\u663e\u5f97\u66f4\u52a0\u7b80\u5355\uff0c\u4ece\u800c\u8ba9\u7248\u672c\u66f4\u52a0\u5bb9\u6613\u88ab\u73a9\u5f04\uff09\u3002</li> </ol> Text Only<pre><code>git branch -f &lt;\u5206\u652f\u540d&gt; &lt;\u7248\u672c\u53f7/\u5206\u652f\u540d&gt;\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_4","title":"\u5206\u652f\u5408\u5e76","text":"<ol> <li>\u5408\u5e76\u5206\u652f\uff0c\u6bd4\u5982\uff0c<code>git merge bugfix</code> \u5c06bugfix\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f\uff0c\u8981\u5728master\u5206\u652f\u4e0a\u8fdb\u884c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u53ea\u4f1a\u8ba9master\u5206\u652f\u524d\u8fdb\u4e00\u4e2a\u7248\u672c\uff0c\u5bf9bugfix\u5206\u652f\u4e0d\u9020\u6210\u4efb\u4f55\u5f71\u54cd\uff0c\u56e0\u6b64\u5982\u679c\u5408\u5e76\u4e00\u4e2a\u6bd4\u5f53\u524d\u5206\u652f\u6162\u7684\u5206\u652f\uff08\u6162\u7684\u5206\u652f\u5904\u4e8e\u5feb\u7684\u5206\u652f\u7684\u63d0\u4ea4\u6811\u4e0a\uff09\uff0c\u4e0d\u4f1a\u751f\u6210\u65b0\u7684\u8282\u70b9\u3002</li> </ol> Text Only<pre><code>git merge &lt;\u4e00\u4e2a\u6216\u591a\u4e2a\u5206\u652f&gt;\n</code></pre> <p>\u6ce8\u610f\uff1a\u5f53\u4e24\u4e2a\u5206\u652f\u4e4b\u95f4\u975e\u516c\u5171\u8282\u70b9\uff08\u8282\u70b9\u5c31\u662f\u63d0\u4ea4\u7684\u7248\u672c\uff09\u4fee\u6539\u4e86\u540c\u4e00\u4e2a\u6587\u4ef6\u7684\u540c\u4e00\u884c\u5c31\u4f1a\u51fa\u73b0\u51b2\u7a81\uff0c\u6240\u4ee5\u4fee\u6539\u540c\u4e00\u6587\u4ef6\u5728\u5408\u5e76\u65f6\u5f88\u53ef\u80fd\u4f1a\u51fa\u73b0\u51b2\u7a81\uff0c\u53ea\u8981\u4e0d\u4fee\u6539\u540c\u4e00\u6587\u4ef6\u5c31\u4e0d\u4f1a\u51fa\u73b0\u51b2\u7a81\u3002\u5f53\u51fa\u73b0\u5408\u5e76\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u624b\u52a8\u5408\u5e76\u51b2\u7a81\u6587\u4ef6\u4ece\u800c\u89e3\u51b3\u51b2\u7a81\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u7ec8\u6b62\u5408\u5e76\u3002</p> Text Only<pre><code>git merge --abort\n</code></pre> <ol> <li>rebase\u547d\u4ee4\uff0c\u628a\u5206\u652f2\u8f6c\u79fb\u5230\u5206\u652f1\u4e0a\uff0c\u53ea\u5199\u4e00\u4e2a\u5206\u652f\u540d\u8868\u793a\u628a\u5f53\u524d\u5206\u652f\u8f6c\u79fb\u5230\u6307\u5b9a\u5206\u652f\u4e0a\u3002rebase\u64cd\u4f5c\u548cmerge\u64cd\u4f5c\u4ea7\u751f\u7684\u6548\u679c\u4e00\u6837\uff0c\u4f46\u662frebase\u64cd\u4f5c\u53ef\u4ee5\u8ba9\u63d0\u4ea4\u6811\u66f4\u52a0\u7ebf\u6027\u3002</li> </ol> Text Only<pre><code>git rebase &lt;\u5206\u652f\u540d1&gt; &lt;\u5206\u652f\u540d2&gt;\n</code></pre> <p>\u4f8b\u5982\uff0c\u5728bugfix\u5206\u652f\u4e0a<code>git rebase main</code>\u53ef\u4ee5\u5c06bugfix\u5206\u652f\u4e0a\u7684C2\u3001C3\u7248\u672c\u590d\u5236\u5230main\u5206\u652f\u4e0a\uff0c\u5e76\u4e14\u4fdd\u7559bugfix\u5206\u652f\u3002</p> <p></p> <p></p> <p>\u5207\u6362\u5230main\u5206\u652f\u4e0a\uff0c\u5728\u4e00\u4e2a\u6162\u5206\u652f\u4e0a\u4f7f\u7528rebase\u547d\u4ee4\uff08<code>git rebase bugfix</code>\uff09\u7684\u4f5c\u7528\u662f\u5c06\u6162\u5206\u652f\u79fb\u52a8\u5230\u5feb\u5206\u652f\u5904\uff0c\u76f8\u5f53\u4e8e\u5728\u6162\u5206\u652f\u4e0a\u4f7f\u7528<code>git merge bugfix</code> \u6216\u8005<code>git reset bugfix</code>\u3002\u4ece\u4e0a\u9762\u5408\u5e76\u5206\u652f\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528rebase\u5408\u5e76\u5206\u652f\u8981\u6bd4\u4f7f\u7528merge\u6162\u4e00\u6b65\uff0c\u53e6\u5916\u7531\u4e8erebase\u9700\u8981\u5728main\u5206\u652f\u4e0a\u8ffd\u52a0\u591a\u4e2a\u7248\u672c\uff0c\u6240\u4ee5\u53ef\u80fd\u4f1a\u9700\u8981\u5904\u7406\u591a\u6b21\u51b2\u7a81\uff0c\u5373\u6bcf\u8ffd\u52a0\u4e00\u4e2a\u90fd\u53ef\u80fd\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u6bcf\u6b21\u90fd\u9700\u8981\u624b\u52a8\u5408\u5e76\u51b2\u7a81\uff0c\u4f46\u662fmerge\u6700\u591a\u53ea\u4f1a\u4ea7\u751f\u4e00\u6b21\u51b2\u7a81\u3002</p> <p>Git\u7684\u7edf\u4e00\u64cd\u4f5c\u903b\u8f91\uff1a\u79fb\u52a8\u5206\u652f\u5fc5\u987b\u5148checkout\u5230\u8fd9\u4e2a\u5206\u652f\uff0c\u5728\u8fd9\u4e00\u70b9\u4e0a\uff0creset\u3001merge\u3001rebase \u548c cherry-pick\u662f\u4e00\u6837\u7684\u3002</p> <ol> <li>cherry-pick\u547d\u4ee4\uff0c\u628a\u6307\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u63d0\u4ea4\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u8ba9\u63d0\u4ea4\u6811\u66f4\u52a0\u7ebf\u6027\u3002</li> </ol> Text Only<pre><code>git cherry-pick &lt;\u4e00\u4e2a\u6216\u591a\u4e2a\u7248\u672c\u53f7&gt;\n</code></pre> <p>\u4f8b\u5982\uff0c<code>git cherry-pick C2 C4</code> \u628aC2 C4  \u7248\u672c\u590d\u5236\u5230main\u5206\u652f\u4e0a\uff0c\u5982\u679c\u53ea\u60f3\u8981C4\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u53eacherry-pick C4\uff0c\u8fd9\u6bd4merge\u751f\u6210\u7684\u63d0\u4ea4\u6811\u66f4\u52a0\u7ebf\u6027\uff0c\u5982\u679c\u5220\u9664\u5206\u652fside\uff0c\u4e5f\u4e0d\u4f1a\u5728main\u5206\u652f\u4fdd\u7559C2\u3001C3\uff0c\u5982\u679c\u662fmerge\uff0c\u90a3\u4e48\u5408\u5e76\u5f97\u5230\u7684main\u5206\u652f\u4f1a\u4fdd\u7559C2\u3001C3\u3001C4\u3002</p> <p>\u53e6\u5916\uff0cmerge \u548c rebase \u547d\u4ee4\u540e\u9762\u53ea\u80fd\u8ddf\u5206\u652f\uff0c\u800c cherry-pick \u547d\u4ee4\u9700\u8981\u8ddf\u7248\u672c\u53f7\uff0c\u6240\u4ee5\u5728git\u547d\u4ee4\u884c\u4e2d\u63d0\u4f9b\u4e86\u4ea4\u4e92\u5f0frebase\uff08\u4ea4\u4e92\u5f0frebase\u662f\u53ef\u89c6\u5316\u64cd\u4f5c\u7684cherry-pick\uff09\u3002</p> <p></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#checkouthead","title":"checkout\uff08\u79fb\u52a8head\u6307\u9488\uff09","text":"<p>head\u6307\u9488\u6307\u5411\u7684\u7248\u672c\u5c31\u662f\u5de5\u4f5c\u533a\u5185\u5bb9\uff08\u6216\u8005\u8bf4\u5c31\u662f\u6211\u4eec\u770b\u5230\u7684\u5185\u5bb9\uff09\u7684\u539f\u59cb\u7248\u672c\uff0c\u5de5\u4f5c\u533a\u65b0\u7684\u4fee\u6539\u6b63\u662f\u4e0e\u8fd9\u4e2a\u7248\u672c\u7684\u5185\u5bb9\u6bd4\u8f83\u7ed3\u679c\uff0c\u4e5f\u5c31\u662f<code>git diff</code>\u547d\u4ee4\u5c31\u662f\u5728\u62ff\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u4e0ehead\u6307\u9488\u6307\u5411\u7684\u7248\u672c\u4f5c\u6bd4\u8f83\uff0c\u6240\u4ee5head\u6307\u9488\u4f4d\u7f6e\u81f3\u5173\u91cd\u8981\u3002</p> <p><code>git checkout</code>\u547d\u4ee4\u5c31\u662f\u7528\u6765\u79fb\u52a8head\u6307\u9488\u7684\uff0c\u800chead\u6307\u9488\u6307\u5411\u7684\u7248\u672c\u5c31\u662f\u6211\u4eec\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff0c\u6240\u4ee5checkout\u5fc5\u5b9a\u4f1a\u91cd\u7f6e\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u3002</p> <ol> <li>\u5207\u6362\u5230\u5206\u652f\uff08\u7279\u6307\u5c06head\u6307\u9488\u79fb\u52a8\u5230\u5206\u652f\u540d\u5904\uff0c\u4e0e\u5206\u652f\u8fdb\u884c\u5408\u4f53\uff09\uff0ccheckout\u540e\u9762\u8ddf\u5206\u652f\u540d\uff0c\u6b64\u65f6head\u6307\u9488\u4f1a\u4e0e\u5206\u652f\u5408\u4f53\u3002</li> </ol> Text Only<pre><code>git checkout &lt;\u5206\u652f\u540d&gt; \u6216 git switch &lt;\u5206\u652f\u540d&gt;\n</code></pre> <ol> <li>\u5207\u6362\u5230\u67d0\u4e2a\u7248\u672c\uff0ccheckout\u540e\u9762\u8ddf\u7248\u672c\u540d\uff0c\u6b64\u65f6head\u6307\u9488\u4f1a\u6307\u5411\u6307\u5b9a\u7684\u7248\u672c\uff0c\u5904\u4e8e\u5206\u79bb\u72b6\u6001\u3002</li> </ol> Text Only<pre><code>git checkout &lt;\u7248\u672c\u53f7&gt;\n</code></pre> <p>\u5982\u679chead\u6307\u9488\u5904\u4e8e\u5408\u4f53\u72b6\u6001\uff0c\u901a\u8fc7 <code>git checkout head</code>\u547d\u4ee4\u53ef\u4ee5\u5feb\u901f\u5206\u79bbhead\u6307\u9488\uff0c\u800c\u4e0d\u7528\u8f93\u5165\u5f53\u524d\u5206\u652f\u7684\u7248\u672c\u53f7\uff0c\u5373\u6b64\u65f6head\u6307\u9488\u4ecd\u7136\u6307\u9488\u5f53\u524d\u7248\u672c\u53f7\uff0c\u53ea\u662f\u8fdb\u884c\u4e86\u5206\u79bb\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0d\u4f1a\u91cd\u7f6e\u5de5\u4f5c\u533a\u5185\u5bb9\u3002</p> <p>checkout -b \u53c2\u6570\u7684\u7528\u6cd5\uff08\u4e0d\u662f\u91cd\u70b9\uff09\uff1a</p> <p>\u5728\u6307\u5b9a\u7684\u7248\u672c\u5904 \u521b\u5efa\u5206\u652f \u5e76 \u5207\u6362\u5230\u8be5\u5206\u652f\uff0c\u7248\u672c\u53f7\u7701\u7565\u8868\u793a\u5728\u5f53\u524d\u7248\u672c\u5904\u3002</p> Text Only<pre><code>git checkout -b &lt;\u5206\u652f\u540d&gt; &lt;\u7248\u672c\u53f7/\u5206\u652f\u540d&gt; \u7b49\u540c\u4e8e git switch -c &lt;\u5206\u652f\u540d&gt; &lt;\u7248\u672c\u53f7/\u5206\u652f\u540d&gt; \n</code></pre> <p>\u5728\u5f53\u524d\u7248\u672c\u5904 \u521b\u5efa\u5206\u652f \u5e76 \u5207\u6362\u5230\u8be5\u5206\u652f \u5e76 \u6307\u5b9a\u8981\u8ddf\u8e2a\u7684\u8fdc\u7a0b\u5206\u652f\uff1b\u5728IDEA\u4e2d\uff0c\u5f53\u672c\u5730\u6ca1\u6709\u540c\u540d\u5206\u652f\u65f6\uff0ccheckout\u5230\u8fdc\u7a0b\u5206\u652f\u4f1a\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u521b\u5efa\u540c\u540d\u672c\u5730\u5206\u652f\u5e76\u5c06\u8fdc\u7a0b\u5206\u652f\u8bbe\u7f6e\u4e3a\u4e0a\u6e38\u5206\u652f\uff0c\u7b26\u5408\u540e\u9762\u603b\u7ed3\u7684\u4f7f\u7528\u8fdc\u7a0b\u4ed3\u5e93\u8fdb\u884c\u7248\u672c\u7ba1\u7406\u7684\u6700\u4f73\u5b9e\u8df5\u3002</p> Text Only<pre><code>git checkout -b &lt;\u672c\u5730\u5206\u652f\u540d&gt; &lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_5","title":"\u7248\u672c\u56de\u9000","text":""},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#1reset","title":"1\u3001<code>reset</code>\u547d\u4ee4","text":"<p><code>reset</code>\u547d\u4ee4\u5c06\u5206\u652f\u540d\u79fb\u52a8\u5230\u6307\u5b9a\u7248\u672c\u7248\u672c\u5904</p> Text Only<pre><code>git reset &lt;\u7248\u672c\u53f7/\u5206\u652f\u540d&gt;\n</code></pre> <p>\u9009\u9879\uff1a</p> <ul> <li> <p>--soft\uff0c\u5c06head\u6307\u9488\u56de\u9000\u5230\u6307\u5b9a\u7684\u7248\u672c\uff0c\u4e0d\u6e05\u7a7a\u6682\u5b58\u533a\uff0c\u4e5f\u4e0d\u4f1a\u6539\u53d8\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff08\u4e0d\u6e05\u7a7a\u6682\u5b58\u533a\u7684\u6548\u679c\u5c31\u662f\uff0c\u6ca1\u6709\u88ab\u91cd\u7f6e\u7684\u5de5\u4f5c\u533a\u7684\u6709\u4e9b\u5185\u5bb9\u4f1a\u53d8\u6210\u65b0\u7684\u4fee\u6539\uff09\u3002</p> </li> <li> <p>--mixed\uff08\u9ed8\u8ba4\uff09\uff0c\u5c06head\u6307\u9488\u56de\u9000\u5230\u6307\u5b9a\u7684\u7248\u672c\uff0c\u5e76\u6e05\u7a7a\u6682\u5b58\u533a\uff0c\u4f46\u4e0d\u4f1a\u6539\u53d8\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff08\u6e05\u7a7a\u6682\u5b58\u533a\u7684\u6548\u679c\u5c31\u662f\uff0c\u6ca1\u6709\u88ab\u91cd\u7f6e\u7684\u5de5\u4f5c\u533a\u7684\u6709\u4e9b\u5185\u5bb9\u4e0d\u4f1a\u53d8\u6210\u65b0\u7684\u4fee\u6539\uff0c\u800c\u662f\u4f1a\u88ab\u4f5c\u4e3a<code>untracked</code>\u6587\u4ef6\uff0c\u5373\u4e0d\u88abgit\u6240\u7ba1\u7406\uff09\u3002</p> </li> <li> <p>--hard\uff0c\u5c06head\u6307\u9488\u56de\u9000\u5230\u6307\u5b9a\u7684\u7248\u672c\uff0c\u5e76\u6e05\u7a7a\u6682\u5b58\u533a\uff0c\u8fd8\u4f1a\u628a\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u4e5f\u91cd\u7f6e\u5230\u6307\u5b9a\u7248\u672c\u3002</p> </li> <li> <p>--keep\uff0c\u5c06head\u6307\u9488\u56de\u9000\u5230\u6307\u5b9a\u7684\u7248\u672c\uff0c\u4e0d\u6e05\u7a7a\u6682\u5b58\u533a\uff0c\u4f46\u4f1a\u628a\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u4e5f\u91cd\u7f6e\u5230\u6307\u5b9a\u7248\u672c\u3002</p> </li> </ul> <p>\u53ef\u4ee5\u8ba4\u4e3a\u5728idea\u4e2d\u4f7f\u7528git\u6ca1\u6709\u6682\u5b58\u533a\u7684\u6982\u5ff5\uff0c\u6240\u4ee5\u4e0d\u4f7f\u7528soft\u548ckeep\u3002</p> <p>\u4e0e<code>git checkout</code>\u7684\u533a\u522b\uff1a<code>git reset</code> \u65e2\u53ef\u4ee5\u5728head\u6307\u9488\u5904\u4e8e\u6e38\u79bb\u72b6\u6001\u4e0b\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5728head\u6307\u9488\u5904\u4e8e\u5408\u4f53\u72b6\u6001\u4e0b\u4f7f\u7528\u3002\u5728\u5408\u4f53\u72b6\u6001\u4e0b\u4f7f\u7528\uff0c\u7248\u672c\u53f7\u548chead\u6307\u9488\u53ef\u540c\u65f6\u79fb\u52a8\uff1b\u5728\u5206\u79bb\u72b6\u6001\u4e0b\uff0c\u53ea\u4f1a\u79fb\u52a8head\u6307\u9488\uff0c\u76f8\u5f53\u4e8echeckout\u547d\u4ee4\uff08checkout\u547d\u4ee4\u53ea\u80fd\u7528\u6765\u79fb\u52a8head\u6307\u9488\uff0c\u5373\u4f7fhead\u6307\u9488\u5904\u4e8e\u5408\u4f53\u72b6\u6001\uff0c<code>checkout</code>\u4e5f\u65e0\u6cd5\u8ba9\u5206\u652f\u79fb\u52a8\uff09\uff0c\u53ea\u4e0d\u8fc7reset\u66f4\u52a0\u7075\u6d3b\u4e00\u70b9\uff0c\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u91cd\u7f6e\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff0c\u800ccheckout\u4e00\u5b9a\u4f1a\u91cd\u7f6e\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff0c\u5373<code>git checkout</code>\u76f8\u5f53\u4e8e<code>git reset --hard</code>\u3002\u867d\u7136\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u662freset\u547d\u4ee4\u7684\u6b63\u786e\u4f7f\u7528\u65b9\u6cd5\uff08\u4e0d\u8981\u641e\u8fd9\u4e48\u7075\u6d3b\uff09\uff0c\u56e0\u4e3areset\u547d\u4ee4\u7684\u672c\u610f\u662f\u7528\u6765\u56de\u9000\u7248\u672c\u7684\uff0c\u4e5f\u5c31\u662f<code>reset</code>\u7528\u6765\u79fb\u52a8\u5206\u652f\u7684\uff0c<code>checkout</code>\u7528\u6765\u79fb\u52a8head\u6307\u9488\u7684\uff0c</p> <p>\u5f3a\u70c8\u4e0d\u5efa\u8bae\u5728head\u5904\u4e8e\u5206\u79bb\u72b6\u6001\u4e0b\u4f7f\u7528 <code>git reset --soft/mixed</code>\uff0c\u672c\u6765\u79fb\u52a8head\u6307\u9488\u5c31\u662f\u4e3a\u4e86\u6539\u53d8\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff0c\u4f60\u8fd9\u6837\u505a\u4f1a\u8ba9\u5de5\u4f5c\u53d8\u5f97\u7d0a\u4e71\u3002</p> <p>\u603b\u7ed3 \uff1a</p> <ol> <li>\u4e0d\u8981\u5728head\u5206\u79bb\u72b6\u6001\u4e0b\u4f7f\u7528reset\u547d\u4ee4\uff0c<code>reset</code>\u547d\u4ee4\u662f\u5728head\u6307\u9488\u5904\u4e8e\u5728\u5408\u4f53\u72b6\u6001\u4e0b\u79fb\u52a8\u5206\u652f\u7684\u547d\u4ee4\uff0c\u65e2\u53ef\u4ee5\u8ba9\u5206\u652f\u5411\u524d\u79fb\u52a8\u4e5f\u53ef\u4ee5\u8ba9\u5206\u652f\u5411\u540e\u79fb\u52a8\uff0c\u4ece\u800c\u5b9e\u73b0\u7248\u672c\u56de\u9000\u3002</li> <li>\u4e0d\u8981\u4f7f\u7528--soft\u3001--mixed\u3001--keep\u9009\u9879\uff0c\u8fd9\u4e9b\u9009\u9879\u4f1a\u8ba9\u7248\u672c\u63a7\u5236\u53d8\u5f97\u590d\u6742\u3002</li> </ol>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#2revert","title":"2\u3001<code>revert</code>\u547d\u4ee4","text":"<p><code>revert</code>\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u7528\u65b0\u7684\u63d0\u4ea4\u6765\u64a4\u9500\u524d\u9762\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7248\u672c\u7684\u4fee\u6539\u3002</p> Text Only<pre><code>git revert &lt;\u4e00\u4e2a\u6216\u591a\u4e2a\u7248\u672c\u53f7&gt;\n</code></pre> <p>\u4f8b\u5982 <code>git revert c2 c0</code>\u4f1a\u751f\u6210\u4e24\u4e2a\u65b0\u7684\u63d0\u4ea4\uff0cc2'\u64a4\u9500\u4e86c2\u7684\u4fee\u6539\uff0cc0'\u64a4\u9500\u4e86c0\u7684\u4fee\u6539\uff0c\u6bd4\u5982c0\u65b0\u5efa0.txt\uff0cc1\u65b0\u5efa1.txt\uff0cc2\u65b0\u5efa2.txt\uff0c\u90a3\u4e48c0'\u7684\u7248\u672c\u7684\u7ed3\u679c\u662f\u53ea\u67091.txt\u8fd9\u4e2a\u6587\u4ef6\u3002</p> <p></p> <p>\u60c5\u666f\uff1a\u5de5\u4f5c\u4e0a\u9047\u5230\u7684\uff0c\u4ecetest\u5206\u652f\u4e0a\u65b0\u5efamy\u5206\u652f\uff0c\u7136\u540e\u6dfb\u52a0a.txt\u5e76\u63d0\u4ea4\uff0c\u4e4b\u540e\u5408\u5e76\u5230dev\u5206\u652f\u5e76\u90e8\u7f72\u5230\u6d4b\u8bd5\u73af\u5883\u3002\u6d4b\u8bd5\u8bf4\u6709bug\uff0c\u7136\u540e\u6211\u5206\u6790\u4e86\u4e00\u4e0b\uff0c\u8981\u5b8c\u5168\u820d\u5f03\u4e4b\u524d\u7684\u4fee\u6539\uff0c\u91cd\u65b0\u5199\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u9009\u62e9\u5c06\u4e2a\u4eba\u5206\u652f\u56de\u9000\u5230test\uff0c\u7136\u540e\u91cd\u65b0\u6dfb\u52a0b.txt\uff0c\u518d\u5408\u5e76\u5230dev\uff0cdev\u4e0a\u7684\u7248\u662f\u4e0d\u4f1a\u5220\u9664a.txt\u7684\u3002\uff08\u5176\u5b9e\u8fd9\u6837\u505a\u4e0d\u4f1a\u5f71\u54cd\u5230\u751f\u4ea7\u73af\u5883\uff0c\u53ea\u662f\u4f1a\u9020\u6210dev\u5206\u652f\u7684\u7248\u672c\u5f88\u6df7\u4e71\uff0cdev\u7684\u7248\u672c\u6df7\u4e71\u5176\u5b9e\u4e5f\u6ca1\u4ec0\u4e48\uff0cdev\u672c\u6765\u5c31\u5f88\u6df7\u4e71\uff0c\u53cd\u6b63\u6bcf\u6b21\u65b0\u5efa\u5206\u652f\u90fd\u662f\u4ecemaster\u548ctest\u4e0a\u5efa\u3002\uff09</p> <p></p> <p>\u6211\u7684\u505a\u6cd5\u662f\uff0c\u4e0d\u56de\u9000\u5230test\uff0c\u800c\u662f\u76f4\u63a5\u5728my\u5206\u652f\u4e0a\u624b\u52a8\u5220\u9664a.txt\uff0c\u7136\u540e\u6dfb\u52a0b.txt\uff0c\u6700\u540e\u5408\u5e76\u5230dev\u3002\u5176\u5b9e\u8fd9\u6837\u505a\u9ebb\u70e6\u4e86\uff0c\u6700\u6b63\u786e\u7684\u505a\u6cd5\u662f\u7528<code>revet</code>\u547d\u4ee4\u56de\u9000\u4e00\u4e2a\u7248\u672c\uff0c\u7136\u540e\u5728\u6dfb\u52a0b.txt\uff0c\u8fd9\u6837\u5408\u5e76\u5230dev\u5206\u652f\uff0cdev\u5206\u652f\u5c31\u4e0d\u4f1a\u518d\u4fdd\u7559a.txt\u4e86\u3002</p> <p></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_6","title":"\u5173\u4e8e\u5de5\u4f5c\u533a\u7684\u5185\u5bb9","text":"<ul> <li> <p>\u5982\u679c\u5de5\u4f5c\u533a\u6ca1\u6709\u65b0\u7684\u4fee\u6539\uff0c\u6216\u8005\u5e76\u4e0d\u5173\u5fc3\u5de5\u4f5c\u533a\u4fee\u6539\u7684\u5185\u5bb9\u662f\u5426\u4f1a\u4e22\u5931\uff0c\u5176\u5b9e\u662f\u53ef\u4ee5\u4efb\u610f\u5207\u6362\u5206\u652f\uff08\u7279\u6307\u8ba9head\u6307\u9488\u4e0e\u5206\u652f\u5408\u4f53\uff09\u3001\u79fb\u52a8head\u6307\u9488\u7684\u4f4d\u7f6e\uff08\u7279\u6307\u8ba9head\u6307\u9488\u5904\u4e8e\u6e38\u79bb\u72b6\u6001\uff09\u3001\u8fdb\u884c\u7248\u672c\u56de\u9000\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u53ea\u662f\u6539\u53d8head\u6307\u9488\u7684\u4f4d\u7f6e\uff0c\u6216\u8005\u5206\u652f\u7684\u4f4d\u7f6e\uff0c\u800c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u53ef\u9006\u7684\uff0c\u56e0\u4e3a\u7248\u672c\u5c31\u5728\u90a3\uff0c\u5e76\u4e0d\u4f1a\u6539\u53d8\uff0c\u6216\u8005\u4e22\u5931\uff0c\u53ea\u8981\u4f60\u8bb0\u5f97\u7248\u672c\u53f7\uff0c\u4f60\u5c31\u53ef\u4ee5\u8ba9head\u6307\u9488\u6216\u8005\u5206\u652f\u79fb\u52a8\u5230\u8be5\u5904\u3002\u6240\u4ee5\u65e0\u8bba\u4f7f\u7528<code>git branch -f</code> \u8fd8\u662f <code>git reset</code> \u8fdb\u884c\u7248\u672c\u56de\u9000\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7\u662f\u64cd\u4f5c\u8fc7\u7a0b\u6709\u6240\u533a\u522b\u800c\u5df2\u3002</p> </li> <li> <p>\u5982\u4f55\u820d\u5f03\u5de5\u4f5c\u533a\u7684\u5168\u90e8\u4fee\u6539\uff1f\u7b54\uff1a\u2460 \u53ef\u4ee5\u5148checkout\u5230\u53e6\u4e00\u4e2a\u7248\u672c\uff0c\u7136\u540echeckout\u56de\u6765\uff1b\u2461 \u66f4\u5feb\u901f\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 <code>git reset --hard head</code>\uff08\u6ce8\u610f\uff0c<code>git checkout head</code>\u5e76\u4e0d\u80fd\u91cd\u7f6e\u5de5\u4f5c\u533a\uff09\u3002</p> </li> <li> <p>\u5982\u679c\u5173\u5fc3\u5de5\u4f5c\u533a\u65b0\u4fee\u6539\u7684\u5185\u5bb9\uff0c\u4e0d\u60f3\u5728\u5207\u6362\u5206\u652f\u3001\u79fb\u52a8head\u6307\u9488\u3001\u56de\u9000\u7248\u672c\u65f6\u4e22\u5931\uff0c\u90a3\u4e48\u5904\u7406\u7684\u529e\u6cd5\u53ef\u4ee5\u6709\uff1a</p> </li> <li> <p>\u8fdb\u884c\u4e00\u6b21\u65b0\u7684\u63d0\u4ea4\uff0c\u53ea\u8981\u63d0\u4ea4\u751f\u6210\u4e86\u65b0\u7684\u7248\u672c\uff0c\u90a3\u4e48\u4fee\u6539\u5c31\u80af\u5b9a\u4e0d\u4f1a\u4e22\u5931\u3002</p> </li> <li> <p>\u5982\u679c\u4e0d\u60f3\u628a\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u8fdb\u884c\u4e00\u6b21\u65b0\u7684\u63d0\u4ea4\uff0c\u90a3\u4e48\u5c31\u4e0d\u80fd\u4f7f\u7528checkout\uff0c\u6240\u4ee5\u5c31\u4e0d\u80fd\u5b9e\u73b0\u5207\u6362\u5206\u652f\uff0c\u4f46\u662f\u79fb\u52a8head\u6307\u9488 \u548c \u56de\u9000\u7248\u672c \u53ef\u4ee5\u5206\u522b\u5728 head\u6307\u9488\u5904\u4e8e\u5206\u79bb \u548c \u5408\u4f53 \u72b6\u6001\u4e0b\u901a\u8fc7  <code>git reset --soft/mixed</code>\u5b9e\u73b0\uff0c\u4e0d\u8fc7\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u5728\u5206\u79bb\u72b6\u6001\u4e0b\u4f7f\u7528<code>git reset --soft/mixed</code>\u547d\u4ee4\uff0c\u4e8e\u662f\u603b\u7ed3\u4fbf\u662f\uff0c\u5982\u679c\u4e0d\u60f3\u628a\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u8fdb\u884c\u4e00\u6b21\u65b0\u7684\u63d0\u4ea4\uff0c\u4f46\u662f\u8fd8\u60f3\u4fdd\u7559\u5de5\u4f5c\u533a\u65b0\u7684\u4fee\u6539\uff0c\u90a3\u4e48\u53ea\u80fd\u7528<code>git reset --soft/mixed</code>\u547d\u4ee4\u8fdb\u884c\u7248\u672c\u56de\u9000\u3002</p> <p>\u6211\u59cb\u7ec8\u4e0d\u5efa\u8bae\u5728\u6539\u53d8head\u6307\u9488\u7684\u4f4d\u7f6e\u4e4b\u540e\uff0c\u5de5\u4f5c\u533a\u4ecd\u7136\u4fdd\u7559\u4e4b\u524d\u7684\u4fee\u6539\uff0c\u4e5f\u5c31\u662f\u4e0d\u5efa\u8bae\u628a\u5de5\u4f5c\u533a\u7684\u4fee\u6539\u5e26\u5230\u5176\u5b83\u7248\u672c\u5904\uff0c\u6240\u4ee5\u8fd8\u662f\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528<code>git reset --soft/mixed</code>\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u4e0d\u8981\u5728\u60f3\u5207\u6362\u5206\u652f\u3001\u79fb\u52a8head\u6307\u9488\u3001\u56de\u9000\u7248\u672c\u65f6\uff0c\u8fd8\u60f3\u4e0d\u751f\u6210\u65b0\u7684\u63d0\u4ea4\uff0c\u540c\u65f6\u8fd8\u60f3\u4fdd\u7559\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u3002</p> </li> <li> <p><code>git stash</code>\u547d\u4ee4</p> <p>\u4f7f\u7528<code>git stash</code>\u547d\u4ee4\u5c06\u5de5\u4f5c\u533a\u7684\u4fee\u6539\u8d2e\u85cf\u8d77\u6765\u4e4b\u540e\u518d\u505a\u5207\u6362\u5206\u652f\u3001\u79fb\u52a8head\u6307\u9488\u3001\u56de\u9000\u7248\u672c\u7684\u64cd\u4f5c\u3002\u8d2e\u85cf\u4e4b\u540e\uff0c\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u91cd\u7f6e\u4e3a\u7248\u672c\u5e93\u7684\u5185\u5bb9\u3002\u53ef\u4ee5\u5728\u4efb\u4f55\u7248\u672c\u5904\u6062\u590d\u8d2e\u85cf\u70b9\uff0c\u4e0d\u4e00\u5b9a\u8981\u5728\u5efa\u7acb\u8d2e\u85cf\u70b9\u7684\u7248\u672c\u5904\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6062\u590d\u8d2e\u85cf\u4e4b\u540e\uff0c\u8d2e\u85cf\u70b9\u7684\u4fee\u6539\u4f1a\u76f4\u63a5\u5e94\u7528\u5230\u5de5\u4f5c\u533a\uff0c\u4e0d\u597d\u5c06\u4fee\u6539\u6709\u9009\u62e9\u6027\u7684\u5e94\u7528\u5230\u5207\u6362\u540e\u7684\u5206\u652f\uff0c\u6700\u597d\u53ea\u662f\u7528\u6765\u5728\u4e0d\u4e22\u5931\u5de5\u4f5c\u533a\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\uff0c\u6682\u65f6\u5207\u6362\u5230\u5176\u4ed6\u7248\u672c\uff0c\u5207\u56de\u6765\u4e4b\u540e\u518d\u6062\u590d\u8d2e\u85cf\u70b9\u3002</p> <ul> <li>\u8d2e\u85cf\u5f53\u524d\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u7684\u4fee\u6539\u3002</li> </ul> <p>\u5982\u679c\u5f53\u524d\u5de5\u4f5c\u533a\u6709\u4fee\u6539\u4f46\u662f\u6ca1\u6709\u63d0\u4ea4\uff0c\u76f4\u63a5\u5207\u6362\u5206\u652f\u4f1a\u91cd\u7f6e\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u3002\u5728\u4e0d\u60f3\u63d0\u4ea4\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd8\u60f3\u5207\u6362\u5206\u652f\uff0c\u53ef\u4ee5\u8d2e\u85cf\u5f53\u524d\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u4fee\u6539\u7684\u5185\u5bb9\u3002</p> Text Only<pre><code>git stash\n</code></pre> <ul> <li>\u67e5\u8be2\u6240\u6709\u8d2e\u85cf\u70b9\u3002</li> </ul> Text Only<pre><code>git stash list\n</code></pre> <ul> <li>\u6062\u590d\u5e76\u5220\u9664\u8d2e\u85cf\u70b9\uff08\u6700\u8fd1\u4e00\u6b21\uff09\u3002</li> </ul> Text Only<pre><code>git stash pop\n</code></pre> <ul> <li>\u67e5\u8be2\u540e\uff0c\u6062\u590d\u7b2c\u4e8c\u6b21\u63d0\u4ea4\u7684\u8d2e\u85cf\u70b9\u3002</li> </ul> Text Only<pre><code>git stash apply stash@{2}\n</code></pre> </li> <li> <p>IDEA\u7684shelf\uff08\u6401\u7f6e\uff09\u529f\u80fd</p> <p><code>stash</code>\u547d\u4ee4\u5728\u6062\u590d\u8d2e\u85cf\u4e4b\u540e\uff0c\u8d2e\u85cf\u70b9\u7684\u4fee\u6539\u4f1a\u76f4\u63a5\u5e94\u7528\u5230\u5de5\u4f5c\u533a\uff0c\u6240\u4ee5\u901a\u5e38\u53ea\u7528\u6765\u5728\u4e0d\u4e22\u5931\u5de5\u4f5c\u533a\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\uff0c\u6682\u65f6\u5207\u6362\u5230\u5176\u4ed6\u7248\u672c\uff0c\u5207\u56de\u6765\u4e4b\u540e\u518d\u6062\u590d\u8d2e\u85cf\u70b9\u3002\u800cIDEA\u63d0\u4f9b\u4e86\u66f4\u5f3a\u5927\u7684\u8d2e\u85cf\u529f\u80fd\uff0c\u5373shelf\uff08\u6401\u7f6e\uff09\uff0c\u5b83\u80fd\u5728\u5207\u6362\u7248\u672c\u65f6\uff08\u6539\u53d8head\u6307\u9488\u7684\u4f4d\u7f6e\uff09\uff0c\u4fdd\u5b58\u5de5\u4f5c\u533a\u672a\u63d0\u4ea4\u7684\u4fee\u6539\uff0c\u7136\u540e\u5728\u4efb\u4f55\u6709\u9700\u8981\u7684\u65f6\u5019\u5c06\u8fd9\u4e9b\u4fee\u6539\u6709\u9009\u62e9\u6027\u5730\u5e94\u7528\u5230\u5de5\u4f5c\u533a\uff08\u4e0d\u7ba1\u5f53\u524dhead\u6307\u9488\u6307\u5411\u90a3\u4e2a\u7248\u672c\uff0c\u6216\u8005\u8bf4\u8fd9\u4e2a\u6401\u7f6e\u4e0e\u7248\u672c\u65e0\u5173\uff09\uff0c\u5176\u5b9e\u5c31\u662f\u5728GUI\u7684\u60c5\u51b5\u4e0b\u5bf9stash\u7684\u6539\u8fdb\u3002</p> <p>\u5982\u4f55\u4f7f\u7528shelf\uff08\u6401\u7f6e\uff09\u529f\u80fd\uff1fcheckout\u65f6\u5982\u679c\u6709\u672a\u63d0\u4ea4\u7684\u4fee\u6539\uff0c\u9009\u62e9smart checkout\u5c06\u76f4\u63a5\u89e6\u53d1IDEA\u4e2d\u7684shelf\uff08\u6401\u7f6e\uff09\u529f\u80fd\u3002</p> <p></p> <p>Unshelve\u662f\u5e94\u7528\u4fee\u6539\uff0cdelete\u662f\u5220\u9664\u8fd9\u4e2a\u6401\u7f6e\uff08\u518d\u5220\u9664\u4e00\u6b21\u624d\u4f1a\u771f\u6b63\u5220\u9664\uff09\uff0crestore\u662f\u5c06\u5220\u9664\u4e00\u6b21\u7684\u6401\u7f6e\u8fd8\u539f\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u903b\u8f91\u4e0e\u56de\u6536\u7ad9\u4e00\u6837\u3002</p> <p>shelf\uff08\u6401\u7f6e\uff09\u529f\u80fd\u5728\u5207\u6362\u5206\u652f\u3001\u79fb\u52a8head\u6307\u9488\u3001\u56de\u9000\u7248\u672c\u65f6\uff0c\u65e2\u53ef\u4ee5\u4fdd\u7559\u5de5\u4f5c\u533a\u7684\u4fee\u6539\uff0c\u53c8\u53ef\u4ee5\u5728head\u6307\u9488\u6539\u53d8\u4f4d\u7f6e\u540e\u91cd\u7f6e\u5de5\u4f5c\u533a\uff0cshelf\u529f\u80fd\u9ed8\u8ba4\u662f\u76f4\u63a5\u5c06\u6401\u7f6e\u7684\u4fee\u6539\u5e94\u7528\u5230\u5207\u6362\u540e\u7248\u672c\u7684\u5de5\u4f5c\u533a\uff0c\u6240\u4ee5\u53ef\u80fd\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u5982\u679c\u4ea7\u751f\u51b2\u7a81\u4e86\uff0c\u53ef\u4ee5\u9009\u62e9\u7ec8\u6b62\u5e94\u7528\u8865\u4e01\uff0c\u5982\u679c\u6ca1\u6709\u51b2\u7a81\uff0c\u53ef\u4ee5\u9009\u62e9\u56de\u6eda\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff0c\u4ece\u800c\u5b9e\u73b0\u91cd\u7f6e\u5de5\u4f5c\u533a\uff0c\u540e\u9762\u8fd8\u53ef\u4ee5\u6709\u9009\u62e9\u6027\u5730\u8bb2\u5c06\u8fd9\u4e9b\u4fee\u6539\u5e94\u7528\u5230\u5207\u6362\u540e\u7248\u672c\u7684\u5de5\u4f5c\u533a\uff0c\u53ef\u8c13\u4e00\u4e3e\u591a\u5f97\u3002</p> </li> </ul> <p>\u603b\u7ed3\uff1a</p> <ul> <li>\u5728\u5207\u6362\u5206\u652f\u3001\u79fb\u52a8head\u6307\u9488\u3001\u56de\u9000\u7248\u672c\u65f6\u8fdb\u884c\u65b0\u7684\u63d0\u4ea4\u7edd\u5bf9\u4e0d\u4f1a\u4e22\u5931\u4fee\u6539\uff0c\u5341\u5206\u7a33\u59a5\u3002</li> <li>\u65e0\u8bba\u662f\u79fb\u52a8head\u6307\u9488\uff0c\u8fd8\u662f\u56de\u9000\u7248\u672c\uff0c\u4e0d\u5efa\u8bae\u628a\u5de5\u4f5c\u533a\u7684\u4fee\u6539\u76f4\u63a5\u5e94\u7528\u5230\u5176\u5b83\u7248\u672c\u5904\uff0c\u6240\u4ee5\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528<code>git reset --soft/mixed</code>\u547d\u4ee4\u3002</li> <li>\u4f7f\u7528IDEA\u4e2d\u7684shelf\uff08\u6401\u7f6e\uff09\u529f\u80fd\uff0c\u5728\u4efb\u4f55\u6709\u9700\u8981\u7684\u65f6\u5019\u5c06\u4fee\u6539\u6709\u9009\u62e9\u6027\u5730\u5e94\u7528\u5230\u5de5\u4f5c\u533a\u3002</li> </ul>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_7","title":"\u8fdc\u7a0b\u4ed3\u5e93","text":"<ol> <li> <p>\u514b\u9686\u4ed3\u5e93</p> <p>git clone  <li> <p>\u6dfb\u52a0\u8fdc\u7a0b\u5e93\u5730\u5740\uff08\u4e00\u4e2a\u672c\u5730\u4ed3\u5e93\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5f88\u5c11\u8fd9\u4e48\u5e72\uff0c\u539f\u56e0\u662f\u4e0d\u8981\u628a\u7248\u672c\u63a7\u5236\u641e\u590d\u6742\u4e86\uff09\uff08\u5176\u5b9eGit\u7684\u5206\u5e03\u5f0f\u7279\u6027\u4e5f\u4f53\u73b0\u5728\u8fd9\u91cc\uff0c\u6211\u751a\u81f3\u53ef\u4ee5\u628a\u6276\u8c26\u548c\u534e\u6797\u7684\u672c\u5730\u4ed3\u5e93\u8bbe\u7f6e\u6210\u6211\u7684\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u7136\u540e\u5c06\u6211\u7684\u7248\u672c\u63a8\u9001\u5230\u4ed6\u4eec\u7684\u5206\u652f\u4e0a\uff0c\u4e5f\u5c31\u662f\u5176\u5b9eGit\u662f\u6ca1\u6709\u4e2d\u5fc3\u4ed3\u5e93\u8fd9\u4e00\u6982\u5ff5\u7684\uff0c\u53ea\u4e0d\u8fc7\u662f\u6211\u4eec\u5728\u5f00\u53d1\u5b9e\u8df5\u4e2d\u4e60\u60ef\u8bbe\u7f6e\u4e00\u4e2a\u4e2d\u5fc3\u4ed3\u5e93\u4f5c\u4e3a\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u8fd9\u7b26\u5408\u6211\u4eec\u7684\u601d\u7ef4\u4e60\u60ef\u3002\uff09</p> </li> Text Only<pre><code>git remote add &lt;\u8fdc\u7a0b\u5e93\u540d&gt; &lt;url&gt;\n</code></pre> <ol> <li>\u67e5\u770b\u6dfb\u52a0\u7684\u8fdc\u7a0b\u5e93</li> </ol> Text Only<pre><code>git remote -v\n</code></pre> <ol> <li>\u5220\u9664\u8fdc\u7a0b\u5e93\u5730\u5740</li> </ol> Text Only<pre><code>git remote rm &lt;\u8fdc\u7a0b\u5e93\u540d&gt;\n</code></pre> <ol> <li>\u91cd\u547d\u540d\u8fdc\u7a0b\u5e93\u7684\u522b\u540d</li> </ol> Text Only<pre><code>git remote rename &lt;\u65e7\u8fdc\u7a0b\u5e93\u540d&gt; &lt;\u65b0\u8fdc\u7a0b\u5e93\u540d&gt;\n</code></pre> <ol> <li>\u67e5\u770b\u8fdc\u7a0b\u5e93\u72b6\u6001</li> </ol> Text Only<pre><code>git remote show &lt;\u8fdc\u7a0b\u5e93\u540d&gt;\n</code></pre> <ol> <li>\u63a8\u9001\u5206\u652f\u5230\u8fdc\u7a0b\u5e93</li> </ol> Text Only<pre><code>git push &lt;\u8fdc\u7a0b\u5e93\u540d&gt; &lt;\u672c\u5730\u5206\u652f\u540d/\u7248\u672c\u53f7&gt;:&lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u672c\u5730\u5206\u652f \u6216\u8005 \u7248\u672c\u53f7 \u5fc5\u987b\u8981\u6bd4 \u8fdc\u7a0b\u5206\u652f \u9ad8\u624d\u80fdpush\u6210\u529f\uff08\u591a\u4eba\u534f\u4f5c\u65f6\uff0cpush\u524d\u6700\u597d\u5148fetch\u4e00\u4e0b\uff0c\u66f4\u65b0\u4e00\u4e0b\u8fdc\u7a0b\u5206\u652f\u7684\u4f4d\u7f6e\uff09\uff0c\u4e5f\u5c31\u662f\u8fdc\u7a0b\u5206\u652f\u8981\u5728\u672c\u5730\u5206\u652f\u7684\u63d0\u4ea4\u6811\u4e0a\u3002</li> <li>\u53ef\u4ee5\u5c06\u672c\u5730\u5206\u652fpush\u5230\u4e0d\u540c\u540d\u7684\u8fdc\u7a0b\u5206\u652f\u4e0a\uff0c\u751a\u81f3\u53ef\u4ee5\u5f80\u4efb\u610f\u7684\u8fdc\u7a0b\u5206\u652f\u4e0apush\u7248\u672c\u53f7\uff0c\u6240\u4ee5\u4e8b\u5b9e\u4e0a\u8fdc\u7a0b\u5206\u652f\u548c\u672c\u5730\u5206\u652f\u6ca1\u6709\u9ed8\u8ba4\u7684\u5bf9\u5e94\u6216\u8005\u7ed1\u5b9a\u5173\u7cfb\uff0c\u4f46\u662f\u522b\u6ca1\u4e8b\u627e\u4e8b\uff0c\u5b9e\u8df5\u4e2d\u6700\u597d\u9ed8\u8ba4\u6709\u8fd9\u79cd\u7ed1\u5b9a\u5bf9\u5e94\u5173\u7cfb\uff0c\u4e0d\u8981\u76f4\u63a5push\u7248\u672c\u53f7\u5230\u8fdc\u7a0b\u5206\u652f\u4e0a\uff0c\u5e76\u4e14\u53ea\u5c06\u672c\u5730\u5206\u652fpush\u5230\u8fdc\u7a0b\u540c\u540d\u5206\u652f\u4e0a\uff0c\u6700\u4f73\u5b9e\u8df5\u5c31\u662f\uff0c\u5728\u5c06\u672c\u5730\u5206\u652f\u5408\u5e76\u597d\u4e4b\u540e\u518d\u63a8\u9001\u5230\u8fdc\u7a0b\u7684\u540c\u540d\u5206\u652f\u4e0a\uff0c\u6216\u8005\u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e0a\u5c06\u5206\u652f\u5408\u5e76\u597d\u4e4b\u540e\uff0c\u518d\u5728\u672c\u5730\u4ed3\u5e93\u62c9\u53d6\u540c\u540d\u8fdc\u7a0b\u5206\u652f\u7684\u66f4\u65b0\u3002</li> </ul> <p>\u7701\u7565\u8fdc\u7a0b\u5206\u652f\u540d\u8868\u793a\u63a8\u9001\u5230\u8fdc\u7a0b\u540c\u540d\u5206\u652f\uff1a</p> Text Only<pre><code>git push &lt;\u8fdc\u7a0b\u5e93\u540d&gt; &lt;\u672c\u5730\u5206\u652f\u540d&gt;\n</code></pre> <p>\u7701\u7565\u672c\u5730\u5206\u652f\u540d\u8868\u793apush\u5f53\u524d\u6240\u5728\u7684\u5206\u652f\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u4e24\u6761\u547d\u4ee4\u4e0d\u7528checkout\u5206\u652f\u5c31\u53ef\u4ee5\u4f7f\u7528\u3002</p> Text Only<pre><code>git push &lt;\u8fdc\u7a0b\u5e93\u540d&gt;\n</code></pre> <p>\u63a8\u9001\u4e00\u4e2a\u7a7a\u672c\u5730\u5206\u652f\u7b49\u4e8e\u5220\u9664\u8fdc\u7a0b\u5206\u652f\uff1a</p> Text Only<pre><code>git push &lt;\u8fdc\u7a0b\u5e93\u540d&gt;  :&lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt; \n</code></pre> <p>\u5220\u9664\u8fdc\u7a0b\u5206\u652f\u8fd8\u53ef\u4ee5\u5199\u6210\uff1a</p> Text Only<pre><code>git push &lt;\u8fdc\u7a0b\u5e93\u540d&gt; --delete &lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;\n</code></pre> <p>\u63a8\u9001\u6240\u6709\u5206\u652f\u5230\u8fdc\u7a0b\u5e93\uff1a</p> Text Only<pre><code> git push --all &lt;\u8fdc\u7a0b\u5e93\u540d&gt;\n</code></pre> <ol> <li><code>fetch</code>\u547d\u4ee4</li> </ol> Text Only<pre><code>git fetch &lt;\u8fdc\u7a0b\u5e93\u540d&gt; &lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;\n</code></pre> <p>\u62c9\u53d6\u8fdc\u7a0b\u4ed3\u5e93\u7684\u8fdc\u7a0b\u5206\u652f\u7684\u66f4\u65b0\uff0c\u4f7f\u5f97\u672c\u5730\u4ed3\u5e93\u7684\u8fdc\u7a0b\u5206\u652f \u4e0e \u8fdc\u7a0b\u4ed3\u5e93\u540c\u6b65\uff0c\u7701\u7565\u8fdc\u7a0b\u5206\u652f\u540d\u8868\u793a\u62c9\u53d6\u6240\u6709\u8fdc\u7a0b\u5206\u652f\u3002</p> <ol> <li>\u62c9\u53d6\u8fdc\u7a0b\u5206\u652f\u5230\u672c\u5730\u5e93</li> </ol> Text Only<pre><code>git pull &lt;\u8fdc\u7a0b\u4e3b\u673a\u540d&gt; &lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;:&lt;\u672c\u5730\u5206\u652f\u540d&gt;\n</code></pre> <p>pull\u547d\u4ee4\u7b49\u540c\u4e8e\u5148fetch\u8fdc\u7a0b\u5206\u652f\u7684\u66f4\u65b0\uff0c\u7136\u540emerge\u5230\u672c\u5730\u5206\u652f\u4e0a\uff08IEAD\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528merge\u6216\u8005rebase\u4e24\u4e2a\u5408\u5e76\u65b9\u5f0f\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\uff09\uff0c\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f\u53ef\u4ee5\u4e0d\u540c\u540d\uff0c\u540c\u6837\uff0c\u522b\u6ca1\u4e8b\u627e\u4e8b\u3002</p> <p>IDEA\u7684\u8fd9\u4e2a\u9009\u9879\u5c31\u662f<code>git pull</code>\uff0c\u529f\u80fd\u662f\u5c06\u5f53\u524d\u5206\u652f\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u8ffd\u8e2a\u7684\u4e0a\u6e38\u5206\u652ffetch\u4e0b\u6765\u5e76\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f\u4e0a\uff0c\u53ef\u4ee5\u9009\u62e9merge\u6216\u8005rebase\u4e24\u79cd\u65b9\u5f0f\uff0c\u524d\u9762\u8bf4\u8fc7\uff0c\u5982\u679c\u4e00\u4e2a\u6162\u5206\u652f\u5728\u5feb\u5206\u652f\u7684\u63d0\u4ea4\u6811\u4e0a\uff0c\u90a3\u4e48\u5728\u4e00\u4e2a\u6162\u5206\u652f\u4e0a\u4f7f\u7528merge\u6216\u8005rebase\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u5c06\u6162\u5206\u652f\u79fb\u52a8\u5230\u5feb\u5206\u652f\u5904\u3002\u6240\u4ee5\u8fd9\u4e2a\u9009\u9879\u7684\u529f\u80fd\u901a\u5e38\u662f\uff0c\u66f4\u65b0\u8fdc\u7a0b\u5206\u652f\uff0c\u5e76\u628a\u672c\u5730\u5206\u652f\u79fb\u52a8\u5230\u8fdc\u7a0b\u5206\u652f\u5904\u3002</p> <p></p> <p>\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u9ed8\u8ba4\u8ffd\u8e2a\u7684\u4e0a\u6e38\u5206\u652f\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9\u8981\u62c9\u53d6\u7684\u4e0a\u6e38\u5206\u652f\uff0c\u5e76\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f\u4e0a\uff0c\u540c\u65f6\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u4e0a\u6e38\u5206\u652f\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u8ffd\u8e2a\u7684\u4e0a\u6e38\u5206\u652f\u3002</p> <p></p> <p></p> <p>\u4e0a\u9762\u7684\u4e0b\u62c9\u7bad\u5934IDEA\u53d6\u540d\u4e3aupdate\uff0c\u672c\u8d28\u662fpull\uff0c\u4f46\u662f\u53ea\u80fd\u66f4\u65b0\u8bbe\u7f6e\u6709\u4e0a\u6e38\u5206\u652f\u7684\u672c\u5730\u5206\u652f\uff0c\u4e0b\u9762\u7684\u865a\u7ebf\u4e0b\u62c9\u7bad\u5934\u7684\u529f\u80fd\u662ffetch all branch\u3002</p> <p></p> <p>\u7701\u7565\u672c\u5730\u5206\u652f\u540d\u8868\u793a\u5f53\u524d\u5206\u652f</p> Text Only<pre><code>git pull &lt;\u8fdc\u7a0b\u4e3b\u673a\u540d&gt; &lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;\n</code></pre> <ol> <li>\u8bbe\u7f6e\u9ed8\u8ba4\u8ffd\u8e2a\u7684\u4e0a\u6e38\u5206\u652f\uff0c\u5373\u4e3a\u672c\u5730\u5206\u652f\u548c\u8fdc\u7a0b\u5206\u652f\u8bbe\u7f6e\u4e00\u4e2a\u7ed1\u5b9a\u5173\u7cfb\uff0c\u4e4b\u540e\u5728\u8be5\u5206\u652f\u4e0a\u4f7f\u7528push \u548c pull \u5c31\u53ef\u4ee5\u4e0d\u5e26\u53c2\u6570\u76f4\u63a5\u4f7f\u7528\u4e86</li> </ol> Text Only<pre><code>git push --set-upstream &lt;\u8fdc\u7a0b\u5e93\u540d&gt; &lt;\u8fdc\u7a0b\u5206\u652f\u540d&gt;\n</code></pre> <p>\u4e3a\u6bcf\u4e2a\u9700\u8981\u63a8\u9001\u5230\u8fdc\u7a0b\u4ed3\u5e93\u7684\u672c\u5730\u5206\u652f\u90fd\u8bbe\u7f6e\u8fd9\u4e2a\u4e0a\u6e38\u5206\u652f\uff0c\u4ee5\u540e\u5c31\u9ed8\u8ba4\u8fdc\u7a0b\u548c\u672c\u5730\u7684\u540c\u540d\u5206\u652f\u6709\u8fd9\u4e2a\u7ed1\u5b9a\u5bf9\u5e94\u5173\u7cfb\u3002\u5728push\u6216\u8005pull\u90fd\u5148checkout\u5230\u8fd9\u4e2a\u5206\u652f\u4e0a\uff0c\u7136\u540e\u5c06\u672c\u5730\u5206\u652f\u5408\u5e76\u597d\u4e4b\u540e\u518dpush\u5230\u8fdc\u7a0b\u7684\u540c\u540d\u5206\u652f\u4e0a\uff0c\u6216\u8005\u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e0a\u5c06\u5206\u652f\u5408\u5e76\u597d\u4e4b\u540e\uff0c\u518d\u5728\u672c\u5730\u4ed3\u5e93pull\u540c\u540d\u8fdc\u7a0b\u5206\u652f\u7684\u66f4\u65b0\uff0c\u8fd9\u5c31\u662f\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u4f7f\u7528<code>git status</code>\u53ef\u4ee5\u770b\u5230\u4e3a\u672c\u5730\u5206\u652f\u8bbe\u7f6e\u7684\u4e0a\u6e38\u5206\u652f\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_8","title":"\u5176\u5b83\u5e38\u7528\u547d\u4ee4\u548c\u64cd\u4f5c","text":"<ol> <li> <p>\u67e5\u770b\u5386\u53f2\u64cd\u4f5c\uff0c\u663e\u793a\u7684\u662f\u5728\u54ea\u4e2a\u7248\u672c\u6267\u884c\u4e86\u4ec0\u4e48\u64cd\u4f5c</p> Text Only<pre><code>git reflog\n</code></pre> </li> <li> <p>\u67e5\u770b\u5f53\u524d\u5206\u652f\u7684\u7248\u672c\u4fe1\u606f\uff08\u663e\u793a\u5f53\u524d\u7248\u672c\u7684\u63d0\u4ea4\u6811\uff09\uff0c\u663e\u793a\u7684\u662f\u4ece\u7b2c\u4e00\u4e2a\u7248\u672c\u5f00\u59cb\uff0c\u7ecf\u8fc7\u54ea\u4e9b\u7248\u672c\uff08\u7248\u672c\u4e2d\u8bb0\u5f55\u7684\u662f\u4fee\u6539\uff09\u53ef\u4ee5\u5230\u8fbe\u5f53\u524d\u7248\u672c\u3002</p> Text Only<pre><code>git log\n</code></pre> <p>\u5b8c\u6574\u7528\u6cd5\uff1a<code>git log &lt;head/\u5206\u652f\u540d/\u7248\u672c\u53f7/fetch_head&gt;</code> \u663e\u793a\u4ece\u7b2c\u4e00\u4e2a\u7248\u672c\u5f00\u59cb\uff0c\u7ecf\u8fc7\u54ea\u4e9b\u7248\u672c\u53ef\u4ee5\u5230\u8fbe\u6307\u5b9a\u7684\u7248\u672c\uff0c\u5176\u4e2dhead\u8868\u793ahead\u6307\u9488\uff0cfetch_head\u8868\u793a\u8fdc\u7a0b\u5206\u652f\u7684head\u6307\u9488</p> </li> <li> <p>\u6253tag\u6807\u8bb0\uff0c\u6807\u8bb0\u4e00\u822c\u662f\u8f6f\u4ef6\u7684\u91cc\u7a0b\u7891\u7248\u672c\uff0c\u7701\u7565\u7248\u672c\u53f7\u8868\u793a\u5728\u5f53\u524d\u7248\u672c\u6253\u4e0atag\u6807\u8bb0</p> </li> </ol> Text Only<pre><code>git tag &lt;\u6807\u8bb0&gt; &lt;\u7248\u672c\u53f7&gt;\n</code></pre> <ol> <li>\u751f\u6210RSA\u5bc6\u94a5</li> </ol> Text Only<pre><code>ssh-keygen -t rsa -C \"jmoon531@foxmail.com\"\n</code></pre> <ol> <li> <p>\u5ffd\u7565\u6587\u4ef6</p> <p>.ignore\u6587\u4ef6\uff0c\u5c06.ignore\u6587\u4ef6\u914d\u7f6e\u5230 ~/.gitconfig \u6587\u4ef6\u4e2d\uff0c\u6ce8\u610f\u4e0d\u8981\u4f7f\u7528\u53cd\u659c\u6760</p> </li> </ol> <p>```    # Compiled class file</p> <p> \u7ea6 8377 \u4e2a\u5b57  17 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 168 \u5206\u949f</p> <p>*.class</p> <p># Log file</p> <p>*.log</p> <p># BlueJ files</p> <p>*.ctxt</p> <p># Mobile Tools for Java (J2ME)</p> <p>.mtj.tmp/</p> <p># Package Files #</p> <p>.jar    .war    .nar    .ear    .zip    .tar.gz    *.rar</p> <p># virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml</p> <p>hs_err_pid*</p> <p># .ignore    .gitignore    .ignore</p> <p># idea    out    .idea    *.iml</p> <p># maven    target    Text Only<pre><code>\n</code></pre>    [core]        excludesfile = C:/Users/Jmoon/git.ignore    ```</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#_9","title":"\u5e38\u7528\u547d\u4ee4\u6700\u540e\u603b\u7ed3","text":"<p>\u63d0\u4ea4\uff1a</p> <ul> <li>commit\u3001commit --amend</li> </ul> <p>\u5206\u652f\u64cd\u4f5c\uff1a</p> <ul> <li>branch\uff08\u65b0\u5efa\u548c\u5220\u9664\u5206\u652f\uff09</li> </ul> <p>\u79fb\u52a8head\u6307\u9488\uff1a</p> <ul> <li>checkout\uff08\u5207\u6362\u5230\u5206\u652f \u548c \u5207\u6362\u5230\u7248\u672c\uff09</li> </ul> <p>\u5408\u5e76\u7248\u672c\uff1a</p> <ul> <li>merge</li> <li>rebase</li> <li>cherry-pick</li> </ul> <p>\u56de\u9000\u7248\u672c\uff1a</p> <ul> <li>reset --hard</li> <li>revert</li> </ul> <p>\u8d2e\u85cf\u5de5\u4f5c\u533a\u4fee\u6539\uff1a</p> <ul> <li>IDEA\u7684shelf\uff08\u6401\u7f6e\uff09\u529f\u80fd</li> </ul> <p>\u8fdc\u7a0b\uff1a</p> <ul> <li>push</li> <li>fetch</li> <li>pull</li> </ul> <p>\u5176\u4ed6\uff1a</p> <ul> <li>log</li> <li>tag</li> </ul>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#git","title":"\u4e8c\u3001Git\u5173\u952e\u7406\u89e3","text":"<p>head\u6307\u9488\u3001\u5206\u652f\u3001\u8fdc\u7a0b\u5206\u652f\u3001\u6807\u7b7e(tag) \u7684\u7406\u89e3\uff1f</p> <p>\u5171\u540c\u70b9\uff1a\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u5728\u67d0\u4e2a\u7248\u672c\u4e0a\u53d6\u7684\u540d\u5b57\uff1b\u6216\u8005\u7406\u89e3\u6210Java\u4e2d\u7684\u503c\u7c7b\u578b\uff08\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c\u5f15\u7528\uff09\uff0c\u5b58\u7684\u503c\u5c31\u662f\u7248\u672c\u53f7\u3002\u901a\u8fc7\u8fd9\u51e0\u4e2a\u6807\u8bb0\u5c31\u80fd\u5f88\u65b9\u4fbf\u5b8c\u6210git\u7684\u5206\u652f\u64cd\u4f5c\uff0c\u4ece\u800c\u5b9e\u73b0\u7248\u672c\u63a7\u5236\u3002\u56e0\u4e3a\u5206\u652f\u3001\u8fdc\u7a0b\u5206\u652f\u3001\u6807\u7b7e(tag) \u90fd\u662f\u5728\u67d0\u4e2a\u7248\u672c\u4e0a\u7684\u540d\u79f0\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u8fd9\u4e2a\u7528checkout\u547d\u4ee4\u8ba9head\u6307\u9488\u79fb\u52a8\u8be5\u7248\u672c\u5904\u3002</p> <p>\u533a\u522b\uff1a</p> <p>1\u3001head\u6307\u9488\u3001\u5206\u652f \u548c \u8fdc\u7a0b\u5206\u652f \u662f\u53ef\u4ee5\u79fb\u52a8\u7684\uff0c\u4f46\u662f\u6807\u7b7e\u662f\u4e0d\u80fd\u79fb\u52a8\u7684\uff0c\u4e5f\u5c31\u662fhead\u6307\u9488\u3001\u5206\u652f \u548c \u8fdc\u7a0b\u5206\u652f\u4e2d \u5b58\u7684\u7248\u672c\u53f7\u53ef\u4ee5\u6539\u53d8\uff0c\u4f46\u662f\u6807\u7b7e\u4e2d\u5b58\u7684\u7248\u672c\u53f7\u4e0d\u80fd\u6539\u53d8\u3002</p> <p>2\u3001head\u6307\u9488\u3001\u5206\u652f \u548c \u8fdc\u7a0b\u5206\u652f \u7684\u79fb\u52a8\u662f\u6709\u533a\u522b\u7684\uff0c\u5176\u4e2dhead\u6307\u9488\u53ef\u4ee5\u968f\u4fbf\u79fb\u52a8\uff08\u4f7f\u7528checkout\u8fdb\u884c\u79fb\u52a8\uff09\uff1b\u5206\u652f\u9700\u8981\u4e0ehead\u6307\u9488\u7ed3\u5408\u624d\u80fd\u88abhead\u6307\u9488\u5e26\u7740\u79fb\u52a8\uff08commit\u3001reset\u3001revert\u624d\u80fd\u79fb\u52a8\uff09\uff1b\u8fdc\u7a0b\u5206\u652f\u4e0d\u80fd\u4e0ehead\u6307\u9488\u7ed3\u5408\uff0c\u53ea\u80fd\u5728\u7528push\u3001fetch\u3001pull\u547d\u4ee4\u624d\u80fd\u79fb\u52a8\u3002</p> <p>3\u3001head\u6307\u9488\u6307\u5411\u7684\u7248\u672c\u5c31\u662f\u6211\u4eec\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\uff0c\u5206\u652f\u3001\u8fdc\u7a0b\u5206\u652f\u3001\u6807\u7b7e(tag) \u90fd\u53ea\u662f\u67d0\u4e2a\u7248\u672c\u7684\u522b\u540d\uff08\u8fd9\u4e2a\u662f\u6700\u5173\u952e\u7684\u7406\u89e3\uff09\u3002</p> <p>git\u4e2d\u6bcf\u4e00\u6b21\u63d0\u4ea4\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u7248\u672c\uff0c\u7248\u672c\u8bb0\u5f55\u7684\u5c31\u662f\u6539\u53d8\uff0c\u7248\u672c\u6c38\u8fdc\u90fd\u4e0d\u4f1a\u6d88\u5931\uff0c\u4e5f\u4e0d\u80fd\u88ab\u5220\u9664\u3002\u63a5\u7740git\u9700\u8981\u4e24\u79cd\u6307\u9488\u6765\u5b9e\u73b0\u7248\u672c\u63a7\u5236\uff0c\u5373head\u6307\u9488\u548c\u5206\u652f\u6307\u9488\uff0chead\u6307\u9488\u53ea\u6709\u4e00\u4e2a\uff0c\u5206\u652f\u6307\u9488\u53d6\u51b3\u4e8e\u4f60\u521b\u5efa\u4e86\u591a\u5c11\u5206\u652f\uff0c\u6307\u9488\u7684\u5b9e\u8d28\u662f\u7248\u672c\u53f7\uff0c\u6307\u5411\u67d0\u4e2a\u7248\u672c\u3002head\u6307\u9488\u6307\u5411\u7684\u4f4d\u7f6e\u5c31\u662f\u4f60\u5f53\u524d\u5de5\u4f5c\u7684\u4f4d\u7f6e\uff0c\u5176\u5b83\u5206\u652f\u6307\u9488\u76f8\u5f53\u4e8e\u662f\u6839\u636e\u60c5\u666f\u7684\u9700\u8981\u751f\u6210\u7684\u6807\u8bb0\u3002</p> <p>\u547d\u4ee4<code>git checkout &lt;\u7248\u672c\u53f7&gt;</code>\u662f\u7528\u6765\u6539\u53d8head\u6307\u9488\u6307\u5411\u7684\u4f4d\u7f6e\u7684\uff0c\u6b64\u65f6head\u6307\u9488\u5904\u4e8e\u5206\u79bb\u72b6\u6001\uff1b\u5206\u652f\u6307\u9488\u53ea\u6709\u4e0ehead\u6307\u9488\u5408\u4f53\u4e4b\u540e\u624d\u80fd\u88ab\u6539\u53d8\u4f4d\u7f6e\uff0c\u5408\u4f53\u7684\u547d\u4ee4\u662f<code>git checkout &lt;\u5206\u652f\u540d&gt;</code>\uff08\u5206\u652f\u540d\u5c31\u662f\u5206\u652f\u6307\u9488\u7684\u540d\u5b57\uff09\uff0c\u5408\u4f53\u4e4b\u540e\u4f7f\u7528\u547d\u4ee4<code>git reset</code>\u548c<code>git merge</code>\u53ef\u4ee5\u540c\u65f6\u6539\u53d8head\u6307\u9488\u548c\u5206\u652f\u6307\u9488\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u5355\u72ec\u6539\u53d8\u5206\u652f\u6307\u9488\u7684\u4f4d\u7f6e\uff0c\u5206\u652f\u6307\u9488\u53ea\u80fd\u88abhead\u6307\u9488\u5e26\u7740\u3002</p> <p><code>git checkout c1</code>\u540e\uff0chead\u6307\u9488\u5904\u4e8e\u5206\u79bb\u72b6\u6001\uff1a</p> <p></p> <p>\u5206\u79bb\u72b6\u6001\u4e0b\u4e5f\u53ef\u4ee5\u63d0\u4ea4\uff0c\u4f46\u5f53\u4f60\u5207\u6362\u5230\u5176\u5b83\u7248\u672c\u540e\uff0c\u8fd8\u60f3\u5728\u5207\u6362\u5230\u8fd9\u4e2a\u7248\u672c\uff0c\u4f60\u5c31\u9700\u8981\u8bb0\u4f4f\u8fd9\u4e2a\u63d0\u4ea4\u7684\u7248\u672c\u53f7\uff0c\u6240\u4ee5git\u4f1a\u5728\u4f60\u5207\u6362\u7248\u672c\u65f6\uff0c\u8981\u6c42\u4f60\u4e3a\u63d0\u4ea4\u521b\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u4ee5\u4fbf\u4ee5\u540e\u53ef\u4ee5\u901a\u8fc7<code>git log</code>\u8ffd\u8e2a\u5230\uff0c\u6bd5\u7adf\u5206\u652f\u540d\u662f\u4eba\u80fd\u8bb0\u4f4f\u7684\uff1a</p> <p></p> <p><code>git branch bugfix01</code>\u521b\u5efabugfix01\u5206\u652f\uff1a</p> <p></p> <p><code>git checkout main</code>\u4e4b\u540emain\u5206\u652f\u6307\u9488\u548chead\u6307\u9488\u5408\u4f53\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684\u5207\u6362\u5230main\u5206\u652f\u4e0a\u4e86\uff1a</p> <p></p> <p>\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7<code>git merge bugfix01</code>\u547d\u4ee4\u6216\u8005<code>git reset bugfix01</code>\u547d\u4ee4\u6216\u8005<code>git reset c3</code>\u547d\u4ee4\u6765\u79fb\u52a8main\u5206\u652f\u6307\u9488\uff0c\u6548\u679c\u662f\u4e00\u6837\uff0c\u56e0\u4e3a\u662f\u5728\u540c\u4e00\u6761\u8def\u5f84\u4e0a\uff1b\u5982\u679c\u4e24\u4e2a\u5206\u652f\u6709\u4e0d\u5728\u540c\u4e00\u6761\u8def\u5f84\u4e0a\u7684\u8282\u70b9\uff08\u7248\u672c\uff09\u5c31\u5fc5\u987b\u901a\u8fc7<code>git merge</code>\u547d\u4ee4\u6765\u5408\u5e76\u5206\u652f\u4e86\uff0c\u6b64\u65f6\u5408\u5e76\u4f1a\u518d\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u7248\u672c\u3002</p> <p></p> <p>\u8fdc\u7a0b\u5206\u652f\u662f\u672c\u5730\u4ed3\u5e93\u5bf9\u8fdc\u7a0b\u4ed3\u5e93\u5206\u652f\u7684\u7d22\u5f15\uff0c\u662f\u4e00\u4e9b\u65e0\u6cd5\u79fb\u52a8\u7684\u672c\u5730\u5206\u652f\uff08\u65e0\u6cd5\u4e0ehead\u6307\u9488\u5408\u4f53\uff0c\u4e8e\u662f\u65e0\u6cd5\u50cf\u672c\u5730\u5206\u652f\u4e00\u6837\uff0c\u53ef\u4ee5\u968fhead\u6307\u9488\u4e00\u8d77\u79fb\u52a8\uff09\uff0c\u53ea\u6709\u5728 Git \u8fdb\u884c\u7f51\u7edc\u4ea4\u4e92\u65f6\u624d\u4f1a\u66f4\u65b0\uff08push\u3001pull\u3001fetch\uff09\u3002\u8fdc\u7a0b\u5206\u652f\u4e5f\u50cf\u662f\u4e66\u7b7e\uff0c\u63d0\u9192\u7740\u4f60\u4e0a\u6b21\u8fde\u63a5\u8fdc\u7a0b\u4ed3\u5e93\u65f6\u4e0a\u9762\u5404\u5206\u652f\u7684\u4f4d\u7f6e\uff0c\u7528 <code>(\u8fdc\u7a0b\u4ed3\u5e93\u540d)/(\u5206\u652f\u540d)</code> \u7684\u5f62\u5f0f\u8868\u793a\u3002</p> <p><code>git fetch</code> \u547d\u4ee4\u53ef\u4ee5\u5c06\u8fdc\u7a0b\u4ed3\u5e93\u7684\u5206\u652f\u62c9\u53d6\u5230\u672c\u5730\u4ed3\u5e93\u7684\u8fdc\u7a0b\u5206\u652f\u4e0a\uff0c\u7701\u7565\u5206\u652f\u540d\u8868\u793a\u62c9\u53d6\u6240\u6709\u8fdc\u7a0b\u4ed3\u5e93\u7684\u5206\u652f\uff1a</p> Text Only<pre><code>git fetch &lt;\u8fdc\u7a0b\u4e3b\u673a\u540d&gt; &lt;\u5206\u652f\u540d&gt;\n</code></pre> <p>\u6bd4\u5982\uff0c\u6267\u884c<code>git fetch origin master</code>\u4e4b\u540e\uff0c\u4f1a\u65b0\u589e\u4e00\u4e9b\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u62c9\u53d6\u4e0b\u62c9\u7684\u7248\u672c\uff0c\u548c\u4e00\u4e2a\u4f60\u65e0\u6cd5\u79fb\u52a8\u7684 <code>origin/serverfix</code> \u6307\u9488\uff0c\u7136\u540e\u7531\u4f60\u51b3\u5b9a\u662f\u5426\u5c06\u672c\u5730\u5206\u652f\u7684\u5185\u5bb9\u4e0e<code>origin/serverfix</code> \u6307\u9488\u6307\u5411\u7248\u672c\u8fdb\u884c\u5408\u5e76\u3002</p> <p><code>git fetch origin serverfix</code> \u4e4b\u540e\u7684\u5e38\u7528\u64cd\u4f5c\uff1a</p> Text Only<pre><code>\u2460 \u67e5\u770b\u8fdc\u7a0b\u5206\u652f \u6216 \u67e5\u770b\u6240\u6709\u5206\u652f\uff1agit branch -r / git branch -a\n\u2461 \u67e5\u770b\u7ecf\u8fc7\u54ea\u4e9b\u7248\u672c\u53ef\u4ee5\u5230\u8fdc\u7a0b\u5206\u652f\u6240\u6307\u5411\u7684\u7248\u672c\uff1agit log origin/master\n\u2462 \u67e5\u770b\u5f53\u524dmaster\u5206\u652f\u4e0e\u8fdc\u7a0b\u5206\u652f\u7684\u5dee\u5f02\uff1agit diff master origin/master\n\u2463 \u56e0\u4e3afetch\u4e4b\u540e\u53ea\u662f\u4e0b\u8f7d\u4e86\u4e00\u4e9b\u8d85\u524d\u4e8e\u672c\u5730\u5206\u652f\u7684\u7248\u672c\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u628a\u8fdc\u7a0b\u5206\u652f\u7684\u5185\u5bb9\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f\uff1agit merge origin/master\n\u2463 \u5728\u8be5\u8fdc\u7a0b\u5206\u652f\u4e0a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5206\u652f\u5e76\u5207\u6362\u5230\u8be5\u5206\u652f\u4e0a\uff1agit checkout -b bugfix origin/master\n</code></pre> <p>push\u6210\u529f\u7684\u6761\u4ef6\u662f\uff0c\u9996\u5148 \u8fdc\u7a0b\u5206\u652forigin/master  \u8981\u4e0e \u8fdc\u7a0b\u4ed3\u5e93\u7684master\u5206\u652f  \u4e00\u81f4\uff0c\u7136\u540e \u672c\u5730\u7684master\u5206\u652f \u8981\u8d85\u524d\u4e8e origin/master\u3002</p> <p>\u573a\u666f\uff1a\u8fdc\u7a0b\u5206\u652f\u548c\u672c\u5730\u5206\u652f\u540c\u6b65\u4e4b\u540e\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u5206\u652f\u4e0a\u8fdb\u884c\u4e86\u591a\u6b21\u63d0\u4ea4\uff0c\u8fd9\u65f6\u60f3\u820d\u5f03\u4e2d\u95f4\u7684\u6240\u6709\u63d0\u4ea4\uff0c\u53ea\u4fdd\u7559\u6700\u540e\u4e00\u6b21\u7684\u63d0\u4ea4\u518d\u63a8\u5230\u8fdc\u7a0b\u5206\u652f\u4e0a\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a     \u2460 \u76f4\u63a5reset --mixed\u5230\u8fdc\u7a0b\u5206\u652f\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u6b64\u65f6\u5de5\u4f5c\u533a\u7684\u5185\u5bb9\u8fd8\u5728\uff0c\u6682\u5b58\u533a\u7684\u5185\u5bb9\u5df2\u7ecf\u6e05\u7a7a\uff0c\u63a5\u7740\u6dfb\u52a0\u6682\u5b58\u533a\u7136\u540e\u63d0\u4ea4\uff0c\u6700\u540epush\u5230\u8fdc\u7a0b\u4ed3\u5e93\u3002     \u2461\u628ahead\u6307\u9488\u79fb\u52a8\u5230\u8fdc\u7a0b\u5206\u652f\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u7136\u540echerry-pick\u6700\u540e\u8fd9\u4e2a\u7248\u672c\uff0c\u63a5\u7740\u628a\u56de\u5230\u672c\u5730\u5206\u652f\u4e0a\uff0c\u518dreset\u5230\u521a\u521a\u90a3\u4e2a\u7248\u672c\u4e0a\u5c31ok\u4e86\u3002</p> <p>\u5982\u679c\u60f3\u4fdd\u7559\u4e2d\u95f4\u7684\u67d0\u51e0\u4e2a\u7248\u672c\uff0c\u7528cherry-pick\u7684\u8bdd\u9700\u8981\u89e3\u51b3\u51b2\u7a81\uff0c\u6240\u4ee5\u4e00\u822c\u51fa\u73b0\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u90fd\u662f\u5f00\u53d1\u7ecf\u9a8c\u4e0d\u8db3\u9020\u6210\u7684\u5427\uff0c\u6211\u89c9\u5f97\u597d\u7684\u9879\u76ee\u7ba1\u7406\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff0c\u62ff\u4e0d\u51c6\u7684\u5c31\u65b0\u5efa\u5206\u652f\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u5206\u652f\u4e0a\u968f\u4fbf\u63d0\u4ea4\uff0c\u6700\u540e\u56de\u5230\u4e3b\u5206\u652f\u4e0acherry-pick\uff0c\u5728\u4e3b\u5206\u652f\u4e0a\u6700\u591a\u51fa\u73b0\u53cd\u6094\u4e00\u6b21\u7684\u63d0\u4ea4\uff0c\u7528amend\u53ef\u4ee5\u89e3\u51b3\u3002\u53ea\u8981\u4e0d\u628a\u5206\u652f\u63d0\u4ea4\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u4f60\u786e\u5b9e\u53ef\u4ee5\u968f\u5fc3\u6240\u6b32\u7684\u5728\u672c\u5730\u4ed3\u5e93\u4e2d\u63d0\u4ea4\uff0c\u5982\u679c\u628a\u5206\u652f\u63a8\u5230\u8fdc\u7a0b\u4ed3\u5e93\u4ee5\u540e\u5c31\u6ca1\u5f97\u53cd\u6094\u4e86\u3002 git\u7684\u63d0\u4ea4\u4f1a\u5f62\u6210\u4e00\u68f5\u6811\uff0c\u6bcf\u6b21\u63d0\u4ea4\u5c31\u662f\u8fd9\u68f5\u6811\u4e0a\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u628a\u5206\u652f\u770b\u6210\u662f\u67d0\u6b21\u63d0\u4ea4\u7684\u4e00\u4e2a\u6807\u8bb0\uff0c\u6216\u8005\u628a\u5206\u652f\u770b\u6210\u4ece\u6839\u5230\u67d0\u6b21\u63d0\u4ea4\u4e2d\u95f4\u7684\u6bcf\u6b21\u63d0\u4ea4\u7684\u8bb0\u5f55\uff0c\u90fd\u884c\uff0c\u56e0\u4e3a\u6548\u679c\u90fd\u662f\u4e00\u6837\u7684\u3002\u8282\u70b9\u4e0d\u4f1a\u6d88\u5931\uff0c\u4f46\u662f\u4e0d\u5728\u5206\u652f\u4e0a\u7684\u8282\u70b9\u53ef\u4ee5\u8bf4\u662f\u6d88\u5931\u4e86\uff0c\u56e0\u4e3a\u5982\u679c\u4f60\u4e0d\u8bb0\u5f97\u5b83\u7684\u7248\u672c\u53f7\uff0c\u4ed6\u5c31\u7b49\u4e8e\u77f3\u6c89\u5927\u6d77\u4e86\u3002</p> <p><code>git log &lt;\u5206\u652f\u540d&gt;</code>\u5c31\u662f\u6765\u8ffd\u8e2a\u8fd9\u4e2a\u5206\u652f\u4e0a\u7684\u6bcf\u4e00\u6b21\u63d0\u4ea4\u7684\uff0c\u6240\u4ee5merge\u7684\u4e24\u4e2a\u7236\u8282\u70b9\u90fd\u662f\u8fd9\u4e2a\u5206\u652f\u4e0a\u7684\u8282\u70b9\uff0c\u90fd\u53ef\u4ee5\u8ffd\u8e2a\u5230\uff0c\u4e8e\u662frebase\u8981\u76f4\u89c2\u4e00\u70b9\uff0c\u5b83\u5e26\u6765\u7684\u662f\u7ebf\u6027\u63d0\u4ea4\u3002</p> <p>\u5220\u9664\u67d0\u4e2a\u672c\u5730\u4ed3\u5e93\u7684\u5206\u652f\u5e76\u4e0d\u5f71\u54cd\u5176\u4ed6\u672c\u5730\u4ed3\u5e93\u7684\u5206\u652f</p> <p>\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u60c5\u666f\uff0cA\u672c\u5730\u4ed3\u5e93\u65b0\u5efa\u4e86branch01\uff0c\u7136\u540e\u63a8\u9001\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u4e4b\u540eB\u672c\u5730\u4ed3\u5e93\u62c9\u53d6branch01\uff0c\u7136\u540e\u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u5220\u9664branch01\uff0c\u6b64\u65f6fetch\u6216\u8005pull\u5e76\u4e0d\u4f1a\u5220\u9664A\u3001B\u672c\u4ed3\u5e93\u7684branch01\u5206\u652f\uff0c\u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u56e0\u4e3a\u5206\u652f\u53ea\u662f\u5728\u67d0\u4e2a\u7248\u672c\u5904\u8d77\u7684\u540d\u5b57\uff0c\u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\u5220\u9664\u5206\u652f\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u5220\u9664\u4e86\u6807\u8bb0\uff0c\u7248\u672c\u53f7\u5e76\u6ca1\u6709\u5728\u4ed3\u5e93\u4e2d\u6d88\u5931\uff0c\u800cfetch\u6216\u548cpull\u5e76\u4e0d\u4f1a\u5220\u9664\u672c\u5730\u4ed3\u5e93\u7684\u5206\u652f\uff0c\u8fd9\u4e24\u4e2a\u547d\u4ee4\u53ea\u4f1a\u62c9\u53d6\u8fdc\u7a0b\u4ed3\u5e93\u5206\u652f\u65b0\u7684\u63d0\u4ea4\uff0c\u6240\u4ee5\u672c\u5730\u4ed3\u5e93\u7684\u5206\u652f\u4e5f\u5c31\u6ca1\u6709\u88ab\u5220\u9664\u3002\u6b64\u65f6\u5982\u679c\u5728A\u672c\u5730\u4ed3\u5e93\u5220\u9664branch01\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5230B\u672c\u5730\u4ed3\u5e93\uff0c\u8fd8\u662f\u4e0a\u9762\u7684\u539f\u56e0\uff0c\u5982\u679c\u613f\u610f\uff0cB\u672c\u5730\u4ed3\u5e93\u53ef\u4ee5\u91cd\u65b0\u63a8\u9001branch01\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u53ea\u662f\u628a\u8fd9\u4e2a\u540d\u5b57\u63a8\u9001\u4e0a\u53bb\u4e86\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u7248\u672c\u5176\u5b9e\u8fd8\u5728\u8fdc\u7a0b\u4ed3\u5e93\u4e2d\uff0c\u8fd9\u4e2a\u60c5\u666f\u771f\u7684\u5f88\u597d\u5730\u4f53\u73b0\u4e86git\u5206\u5e03\u5f0f\u4ed3\u5e93\u7684\u7279\u70b9\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/10-git/#git_1","title":"\u4e09\u3001Git\u63d0\u4ea4\u89c4\u8303","text":"<p>\u5728\u4f7f\u7528 Git \u8fdb\u884c\u7248\u672c\u63a7\u5236\u65f6\uff0c\u9075\u5faa\u4e00\u5b9a\u7684\u63d0\u4ea4\u89c4\u8303\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u8fd9\u4e0d\u4ec5\u6709\u52a9\u4e8e\u56e2\u961f\u6210\u5458\u4e4b\u95f4\u7684\u6c9f\u901a\uff0c\u4e5f\u4fbf\u4e8e\u540e\u7eed\u7684\u4ee3\u7801\u7ef4\u62a4\u548c\u95ee\u9898\u8ffd\u8e2a\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684 Git \u63d0\u4ea4\u4fe1\u606f\u524d\u7f00\u53ca\u5176\u542b\u4e49\uff1a</p> <ul> <li>feat: \u8868\u793a\u65b0\u589e\u4e86\u4e00\u4e2a\u529f\u80fd\uff0c\u5982 feat: \u65b0\u589e\u767b\u5f55\u63a5\u53e3\u3002</li> <li>fix: \u8868\u793a\u4fee\u590d\u4e86\u4e00\u4e2a Bug\uff0c\u5982 fix: \u4fee\u590d\u767b\u5f55\u9a8c\u8bc1\u5931\u8d25\u95ee\u9898\u3002</li> <li>docs: \u4ec5\u4ec5\u4fee\u6539\u4e86\u6587\u6863\uff0c\u6bd4\u5982 docs: \u66f4\u65b0\u4e86\u5b89\u88c5\u6587\u6863\u3002</li> <li>style: \u5bf9\u4ee3\u7801\u683c\u5f0f\u8fdb\u884c\u4e86\u8c03\u6574\uff0c\u4e0d\u5f71\u54cd\u4ee3\u7801\u903b\u8f91\uff0c\u4f8b\u5982 style: \u8c03\u6574\u7f29\u8fdb\u3002</li> <li>refactor: \u4ee3\u7801\u91cd\u6784\uff0c\u6ca1\u6709\u65b0\u589e\u529f\u80fd\u6216\u4fee\u590d Bug\uff0c\u5982 refactor: \u4f18\u5316\u4e86\u641c\u7d22\u7b97\u6cd5\u3002</li> <li>perf: \u6027\u80fd\u4f18\u5316\uff0c\u63d0\u9ad8\u6027\u80fd\u7684\u4ee3\u7801\u66f4\u6539\uff0c\u4f8b\u5982 perf: \u4f18\u5316\u56fe\u7247\u52a0\u8f7d\u901f\u5ea6\u3002</li> <li>test: \u6dfb\u52a0\u6216\u4fee\u6539\u6d4b\u8bd5\u4ee3\u7801\uff0c\u5982 test: \u6dfb\u52a0\u7528\u6237\u6a21\u5757\u5355\u5143\u6d4b\u8bd5\u3002</li> <li>chore: \u53d8\u66f4\u6784\u5efa\u6d41\u7a0b\u6216\u8f85\u52a9\u5de5\u5177\uff0c\u5982 chore: \u66f4\u65b0\u4f9d\u8d56\u7248\u672c\u3002</li> <li>revert: \u64a4\u9500\u4e4b\u524d\u7684\u63d0\u4ea4\uff0c\u4f8b\u5982 revert: \u64a4\u9500\u4e0a\u4e00\u6b21\u63d0\u4ea4\u3002</li> <li>ci: \u6301\u7eed\u96c6\u6210\u76f8\u5173\u7684\u6539\u52a8\uff0c\u5982 ci: \u4fee\u6539 CI \u914d\u7f6e\u3002</li> </ul> <p>\u8fd9\u4e9b\u89c4\u8303\u7684\u63d0\u4ea4\u4fe1\u606f\u6709\u52a9\u4e8e\u81ea\u52a8\u5316\u5de5\u5177\uff08\u5982\u53d1\u5e03\u5de5\u5177\u6216 Changelog \u751f\u6210\u5668\uff09\u89e3\u6790\u548c\u5904\u7406\u63d0\u4ea4\u8bb0\u5f55\u3002\u901a\u8fc7\u7f16\u5199\u7b26\u5408\u89c4\u8303\u7684\u63d0\u4ea4\u6d88\u606f\uff0c\u53ef\u4ee5\u8ba9\u56e2\u961f\u548c\u534f\u4f5c\u8005\u66f4\u597d\u5730\u7406\u89e3\u9879\u76ee\u7684\u53d8\u66f4\u5386\u53f2\u548c\u7248\u672c\u63a7\u5236\uff0c\u4ece\u800c\u63d0\u9ad8\u4ee3\u7801\u7ef4\u62a4\u6548\u7387\u548c\u8d28\u91cf\u3002 \u4f8b\u5982\uff0c\u5f53\u4f60\u5b8c\u6210\u4e00\u4e2a\u65b0\u529f\u80fd\u7684\u5f00\u53d1\u65f6\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 feat \u524d\u7f00\u6765\u63d0\u4ea4\uff0c\u8fd9\u6837\u56e2\u961f\u6210\u5458\u5c31\u80fd\u6e05\u695a\u5730\u77e5\u9053\u8fd9\u6b21\u63d0\u4ea4\u589e\u52a0\u4e86\u4e00\u4e2a\u65b0\u529f\u80fd\u3002\u540c\u6837\uff0c\u5982\u679c\u4f60\u4fee\u590d\u4e86\u4e00\u4e2a Bug\uff0c\u4f7f\u7528 fix \u524d\u7f00\u53ef\u4ee5\u660e\u786e\u5730\u544a\u77e5\u56e2\u961f\u8fd9\u6b21\u63d0\u4ea4\u7684\u76ee\u7684\u662f\u4fee\u590d\u95ee\u9898\u3002 \u603b\u7684\u6765\u8bf4\uff0c\u9075\u5faa Git \u63d0\u4ea4\u89c4\u8303\u53ef\u4ee5\u4f7f\u9879\u76ee\u66f4\u52a0\u6a21\u5757\u5316\u3001\u6613\u4e8e\u7ef4\u62a4\u548c\u7406\u89e3\u3002\u5b83\u4e0d\u4ec5\u63d0\u9ad8\u4e86\u9879\u76ee\u7684\u53ef\u8bfb\u6027\uff0c\u8fd8\u4e3a\u56e2\u961f\u534f\u4f5c\u63d0\u4f9b\u4e86\u6e05\u6670\u7684\u5386\u53f2\u8bb0\u5f55\u548c\u6307\u5bfc\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/11-maven/","title":"11-maven","text":"<p> \u7ea6 1722 \u4e2a\u5b57  51 \u884c\u4ee3\u7801  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 35 \u5206\u949f</p> <p>maven\u4e24\u5927\u4f5c\u7528\uff1a1.\u81ea\u52a8\u6784\u5efa\u9879\u76ee 2.\u4f9d\u8d56\u7ba1\u7406</p> XML<pre><code>&lt;!-- settings.xml \u4e0b\u7684\u914d\u7f6e --&gt;\n    \u672c\u5730\u4ed3\u5e93\u7684\u4f4d\u7f6e\uff1a\n    &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;\n\n    \u66f4\u6362\u963f\u91cc\u4e91\u955c\u50cf\uff1a\n    &lt;mirror&gt;\n        &lt;id&gt;aliyunmaven&lt;/id&gt;\n        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\n        &lt;name&gt;\u963f\u91cc\u4e91\u516c\u5171\u4ed3\u5e93&lt;/name&gt;\n        &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;\n    &lt;/mirror&gt;\n</code></pre> <ul> <li>mvn dependency:tree \u6253\u5370\u9879\u76ee\u7684\u6574\u4e2a\u4f9d\u8d56\u6811</li> <li> <p>mvn archetype:generate \u6839\u636e\u539f\u578b\uff08\u6a21\u677f\uff09\u521b\u5efaMaven\u9879\u76ee   \u6bd4\u5982\u6839\u636eMaven Simple Project Archetype\u521b\u5efa\u666e\u901a\u7684java\u9879\u76ee\uff1a   mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-simple -DarchetypeVersion=1.4</p> </li> <li> <p>mvn tomcat7:run \u5728tomcat\u5bb9\u5668\u4e2d\u8fd0\u884cweb\u5e94\u7528  mvn jetty:run \u5728jetty\u5bb9\u5668\u4e2d\u8fd0\u884cweb\u5e94\u7528</p> </li> <li> <p>\u547d\u4ee4\u53c2\u6570</p> </li> </ul> <p>-D\u4f20\u5165\u5c5e\u6027\u53c2\u6570   mvn package -Dmaven.test.skip=true \u6253\u5305\u65f6\u8df3\u8fc7\u5355\u5143\u6d4b\u8bd5\uff0cidea\u53f3\u4fa7\u7684\u26a1\u56fe\u6807\u5c31\u662f\u8fd9\u4e2a\u529f\u80fd</p> <p>-P\u4f7f\u7528\u6307\u5b9a\u7684profile\u914d\u7f6e</p> <ul> <li> <p>\u8fd0\u884cmvn\u5de5\u7a0b   mvn exec:java -Dexec.mainClass=\"com.xxx.demo.Hello\"</p> </li> <li> <p>\u7ee7\u627f</p> </li> <li> <p>\u7ee7\u627f\u5fc5\u987b\u5728\u5b50\u6a21\u5757\u4e2d\u7528\u6307\u660e\u7236\u6a21\u5757\uff08maven\u672f\u8bed\uff1a\u7ee7\u627f\uff09 <li> <p>\u7ee7\u627f\u65f6\uff0c\u4f1a\u7ee7\u627fgroupId\u548cversion\uff0c\u5982\u679c\u5b50\u6a21\u5757\u6307\u5b9a\u4e86groupId\u548cversion\uff0c\u5219\u4f1a\u8986\u76d6\u7236\u6a21\u5757\u7684\uff0c\u4ee5\u5b50\u6a21\u5757\u4e3a\u51c6\uff1b\u8fd8\u4f1a\u7ee7\u627f\u7236\u6a21\u5757\u7684\u4f9d\u8d56\uff0c\u7ee7\u627f\u6700\u4e3b\u8981\u7684\u5c31\u662f\u8fd9\u4e2a\u4f5c\u7528\uff0c\u7edf\u4e00\u7ba1\u7406\u5b50\u6a21\u5757\u90fd\u7528\u5230\u4e86\u7684\u4f9d\u8d56\u3002</p> </li> <li> <p>\u5728\u7236\u6a21\u5757\u4e2d\u7528\u6307\u660e\u5b50\u6a21\u5757\uff0c\u6307\u660e\u5b50\u6a21\u5757\u540e\u53ef\u4ee5\u5728\u7236\u6a21\u5757\u7684pom.xml\u4e0b\u8fd0\u884c\u4e00\u952e\u5b89\u88c5\uff08maven\u672f\u8bed\uff1a\u805a\u5408\uff09 <li> <p>\u5177\u6709\u7ee7\u627f\u5173\u7cfb\u7684\u6a21\u5757\uff0c\u5728maven\u5de5\u7a0b\u7684\u76ee\u5f55\u7ed3\u6784\u4e0a\u4e5f\u6700\u597d\u5177\u6709\u540c\u6837\u7684\u5c42\u6b21\u5173\u7cfb\uff0c\u4e0d\u7136\u7684\u8bdd\u9700\u8981\u5728\u5b50\u6a21\u5757pom.xml\u4e2d\u7684\u4e0b\u914d\u7f6e\u6307\u660e\u7236\u6a21\u5757\u7684\u76f8\u5bf9\u8def\u5f84\uff0c\u624d\u80fd\u6b63\u786e\u7ee7\u627f\uff0c\u56e0\u4e3a\u7684\u9ed8\u8ba4\u503c\u662f../pom.xml\uff08\u4e5f\u5c31\u662f\u8bf4maven\u9ed8\u8ba4\u4e5f\u60f3\u4f60\u7528\u8fd9\u6837\u5c42\u7ea7\u7ed3\u6784\u7684\u76ee\u5f55\u6765\u5efa\u7acb\u5de5\u7a0b\uff09\uff1b\u4e5f\u9700\u8981\u5728\u6b63\u786e\u5730\u6307\u660e\u8f83\u4e3a\u590d\u6742\u7684\u76f8\u5bf9\u8def\u5f84\uff0c\u624d\u80fd\u5728\u7236\u6a21\u5757\u4e0b\u6b63\u786e\u5730\u8fd0\u884c\u4e00\u952e\u5b89\u88c5\u3002 <li> <p>\u4e0d\u8fc7\uff0c\u5728\u5b50\u6a21\u5757pom.xml\u4e2d\u7684\u4e0b\u914d\u7f6e\u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\u5c31\u662f\uff0c\u5373\u4f7f\u6ca1\u6709\u5b89\u88c5\u7236\u6a21\u5757\uff0c\u4e5f\u80fd\u5b89\u88c5\u5b50\u6a21\u5757\u5e76\u4e14\u6b63\u786e\u5730\u7ee7\u627f\u7236\u6a21\u5757\u3002 <li> <p>\u4e5f\u5c31\u662f\u5982\u679c\u6307\u660e\u4e86\uff0c\u90a3\u5c31\u53bb\u8be5\u8def\u5f84\u4e0b\u53bb\u627e\u7236\u6a21\u5757\uff1b\u5982\u679c\u6ca1\u6709\u914d\u7f6e\uff0c\u90a3\u5c31\u5148\u53bb\u4e0a\u4e00\u7ea7\u76ee\u5f55\u627e\u7236\u6a21\u5757\uff08\u8fd9\u662f\u9ed8\u8ba4\u503c\uff09\uff0c\u4e0a\u4e00\u7ea7\u6ca1\u6709maven\u5de5\u7a0b\u90a3\u5c31\u53bb\u4ed3\u5e93\u91cc\u627e\uff0c\u4ed3\u5e93\u91cc\u6ca1\u6709\u5c31build failure. <li> <p>\u5728\u76ee\u5f55\u4e0a\u4fdd\u6301\u8fd9\u79cd\u5c42\u6b21\u5173\u7cfb\u53ef\u4ee5\u5341\u5206\u6e05\u6670\u7684\u8bf4\u660e\u8fd9\u4e2a\u5de5\u7a0b\u7684\u7ed3\u6784\uff0c\u800c\u4e14\u7236\u6a21\u5757\u53ef\u4ee5\u8bf4\u53ea\u6709pom.xml\u6587\u4ef6\u6709\u7528\uff0c\u56e0\u4e3a\u88ab\u7ee7\u627f\u7684\u6a21\u5757\uff08\u7236\u6a21\u5757\uff09\u7684\u6253\u5305\u65b9\u5f0f\u662fpom\uff0c\u5728\u8fd9\u79cd\u6253\u5305\u65b9\u5f0f\u4e0b\uff0c\u5373\u4f7f\u7236\u6a21\u5757\u6709\u4e3b\u7a0b\u5e8f\u4ee3\u7801\uff0c\u4e5f\u4e0d\u4f1a\u751f\u6210jar\uff0c\u6211\u4eec\u4e0d\u5e94\u8be5\u8ba9\u4e00\u4e2amaven\u5de5\u7a0b\u7684\u76ee\u5f55\u53ea\u6709pom.xml\u5b64\u96f6\u96f6\u7684\u653e\u5728\u90a3\uff0c\u518d\u8bf4\u65e2\u7136\u5177\u6709\u7ee7\u627f\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5de5\u7a0b\uff0c\u6240\u4ee5\u66f4\u5e94\u8be5\u628a\u5b50\u6a21\u5757\u76ee\u5f55\u653e\u5728\u7236\u6a21\u5757\u76ee\u5f55\u4e2d\uff0c\u4fdd\u6301\u8fd9\u79cd\u7ee7\u627f\u7684\u76ee\u5f55\u5c42\u6b21\u7ed3\u6784\u3002\u4e0d\u8fc7\uff0c\u5b89\u88c5\u65f6\u4ee5\u6a21\u5757\u58f0\u660e\u7684\u5750\u6807\u4e3a\u51c6\u5b89\u88c5\u5728\u4ed3\u5e93\u4e2d\uff0c\u4e0emaven\u5de5\u7a0b\u7684\u76ee\u5f55\u7ed3\u6784\u6ca1\u6709\u5173\u7cfb\u3002</p> </li> <li> <p>idea\u7ba1\u7406maven\u6a21\u5757\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u4e0d\u4ec5\u9700\u8981\u5728\u5b50\u6a21\u5757\u4e2d\u914d\u7f6e\uff0c\u4e5f\u8981\u5728\u7236\u6a21\u5757\u4e2d\u914d\u7f6e\uff0c\u6240\u4ee5\u5728idea\u4e2d\uff0c\u53ea\u8981\u6b63\u786e\u7684\u914d\u7f6e\u4e86\uff0c\u5b50\u6a21\u5757\u548c\u7236\u6a21\u5757\u7684\u76ee\u5f55\u53ef\u4ee5\u4e0d\u5177\u6709\u5c42\u6b21\u5173\u7cfb\uff0c\u4f46\u662f\u8fd9\u65e0\u7591\u662f\u7ed9\u81ea\u5df1\u627e\u9ebb\u70e6\uff0c\u6240\u4ee5\u6700\u597d\u987a\u4ece\u8fd9\u79cd\u76ee\u5f55\u7ed3\u6784\uff0c\u7ea6\u5b9a\u5927\u4e8e\u914d\u7f6e\u3002\u4e0d\u8981\u5728\u4e0b\u914d\u7f6e\uff0c\u56e0\u4e3a\u54b1\u4eec\u5df2\u7ecf\u4e25\u683c\u6309\u7167\u7ee7\u627f\u7684\u76ee\u5f55\u7ed3\u6784\u5efa\u7acb\u4e86\u5de5\u7a0b\uff0c\u800c\u7684\u9ed8\u8ba4\u503c\u5c31\u662f../pom.xml\uff0c\u8fd9\u662f\u6b63\u786e\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5355\u72ec\u5b89\u88c5\u5b50\u6a21\u5757\uff0c\u5e76\u4e14\u5df2\u7ecf\u914d\u7f6e\u4e86\uff0c\u4e5f\u53ef\u4ee5\u5728\u7236\u6a21\u5757\u8fdb\u884c\u4e00\u952e\u5b89\u88c5\u3002 <li> <p>\u4f9d\u8d56\u4f20\u9012\u7684\u539f\u5219\uff1a1.\u8def\u5f84\u6700\u77ed\u8005\u4f18\u5148  2.\u8def\u5f84\u76f8\u540c\u5148\u58f0\u660e\u8005\u4f18\u5148</p> </li> <li> <p>\u7ee7\u627f\u53ef\u4ee5\u53eainstall\u5b50\u6a21\u5757\uff0c\u4e0d\u5b89\u88c5\u7236\u6a21\u5757\uff08\u524d\u63d0\u662f\u5728\u5b50\u6a21\u5757pom.xml\u4e2d\u7684\u4e0b\u6b63\u786e\u914d\u7f6e\uff09\uff0c\u4f46\u662f\u5bf9\u4e8e\u4f9d\u8d56\uff0c\u4e0d\u7ba1\u662f\u7f16\u8bd1\uff08\u8fd9\u91cc\u7684\u7f16\u8bd1\u662f\u6307maven default\u751f\u547d\u5468\u671f\u7684\u9636\u6bb5\uff0c\u4e0eidea\u4e2d\u7684\u7f16\u8bd1\u8fd0\u884c\u4e0d\u540c\uff0cidea\u7684\u7f16\u8bd1\u8fd0\u884c\u80fd\u6b63\u786e\u627e\u5230\u914d\u7f6e\u7684\u4f9d\u8d56\uff09\u8fd8\u662f\u5b89\u88c5\uff0c\u90fd\u5fc5\u987b\u5148\u5b89\u88c5\u88ab\u4f9d\u8d56\u7684\u6a21\u5757\u3002 <li> <p>\u53ef\u8fd0\u884c\u7684jar\uff08\u5728META-INF/MANIFEST.MF\u4e2d\u6307\u660emain-class\uff0c\u4e5f\u5c31\u6307\u660e\u4e86\u7a0b\u5e8f\u7684\u5165\u53e3\uff09\u5c31\u662f\u63d2\u4ef6\uff0c\u5176\u4ed6\u7684jar\u5c31\u662f\u7c7b\u5e93\uff0c\u5373\u5e38\u8bf4\u7684jar\u5305\u3002</p> </li> <li> <p>maven\u7684\u751f\u547d\u5468\u671f\u5c31\u662f\u8c03\u7528\u76f8\u5e94\u7684maven\u63d2\u4ef6\u6267\u884c\u4efb\u52a1\uff0c\u4e3a\u4e86\u4ee3\u7801\u590d\u7528\uff0c\u76f8\u4f3c\u7684\u4efb\u52a1\u7528\u540c\u4e00\u63d2\u4ef6\u5b8c\u6210\uff0c\u56e0\u4e3a\u4ed6\u4eec\u7684\u505a\u7684\u4e8b\u5927\u90e8\u5206\u90fd\u76f8\u540c\uff0c\u5177\u4f53\u7684\u5dee\u5f02\u7528\u4e0d\u540c\u7684\u76ee\u6807\u533a\u5206\uff0c\u6bd4\u5982\u7f16\u8bd1\u7684\u4efb\u52a1\u7528maven-compiler-plugin:3.1\u63d2\u4ef6\u5b8c\u6210\uff0c\u4f46\u662f\u5bf9\u5f85\u4e3b\u7a0b\u5e8f\u548c\u6d4b\u8bd5\u7a0b\u5e8f\u7684\u7f16\u8bd1\u6709\u4e9b\u8bb8\u5dee\u5f02\uff0c\u4e8e\u662f\u7528\u4e0d\u540c\u7684\u76ee\u6807\u533a\u5206\uff0c\u5373\u7f16\u8bd1\u4e3b\u7a0b\u5e8f\u7684\u76ee\u6807\u662fcompile\uff0c\u7f16\u8bd1\u6d4b\u8bd5\u7a0b\u5e8f\u7684\u76ee\u6807\u662ftestCompile\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u540c\u4e00\u4e2a\u51fd\u6570\uff0c\u4f20\u4e0d\u540c\u7684\u53c2\u6570\u3002</p> </li> <li> <p>\u53ef\u4ee5\u5728maven\u4ed3\u5e93\u4e2d\u5b89\u88c5\u5176\u4ed6\u63d2\u4ef6\uff0c\u5982\u679cmaven\u5de5\u7a0b\u9700\u8981\u7528\u5230\u975emaven\u7684\u63d2\u4ef6\uff0c\u6bd4\u5982jetty\u548ctomcat\u7684\u63d2\u4ef6\uff0c\u9700\u8981\u5728\u4e0b\u9762\u7684\u6807\u7b7e\u4e2d\u5b9a\u4e49\uff1b\u4e5f\u53ef\u4ee5\u5b9a\u4e49maven\u63d2\u4ef6\u7528\u4e8e\u6307\u5b9a\u7248\u672c\uff0c\u4e5f\u53ea\u662f\u4e3a\u4e86\u6307\u5b9a\u7248\u672c\uff0c\u56e0\u4e3a\u5373\u4f7f\u6ca1\u6709\u6307\u5b9amaven\u63d2\u4ef6\uff0c\u5728\u6784\u5efa\u5de5\u7a0b\u65f6\u4e5f\u4f1a\u8c03\u7528\u9ed8\u8ba4\u7684maven\u63d2\u4ef6\u3002</p> </li> XML<pre><code>&lt;build&gt;\n    &lt;pluginManagement&gt;\n        &lt;plugins&gt;\n\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.eclipse.jetty&lt;/groupId&gt;\n                &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;9.4.15.v20190215&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;scanIntervalSeconds&gt;10&lt;/scanIntervalSeconds&gt;\n                    &lt;webApp&gt;\n                        &lt;contextPath&gt;/webapp&lt;/contextPath&gt;\n                    &lt;/webApp&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n\n        &lt;/plugins&gt;\n    &lt;/pluginManagement&gt;\n&lt;/build&gt;\n</code></pre> <ul> <li>\u4f7f\u7528 maven jetty plugin \u90e8\u7f72\u4e00\u4e2a\u591a\u6a21\u5757\u7684web\u9879\u76ee\u7684\u6b65\u9aa4\uff1a   \u2460 \u5fc5\u987b\u5148\u5b89\u88c5\u5176\u5b83\u88ab\u4f9d\u8d56\u7684\u6a21\u5757   \u2461 \u7136\u540e\u5728web\u6a21\u5757\u7684pom.xml\u76ee\u5f55\u4e0b\u8fd0\u884cjetty\u63d2\u4ef6 mvn jetty:run (\u8fd0\u884cjetty\u7684web\u6a21\u5757\u4e0d\u5fc5 \u5b89\u88c5 \u6216\u8005 \u6253\u5305 \u6216\u8005 \u7f16\u8bd1\uff0c\u56e0\u4e3ajetty\u63d2\u4ef6\u7684run\u76ee\u6807\u4f1a\u5b8c\u6210 \u7f16\u8bd1 \u548c \u90e8\u7f72)   \u6240\u4ee5\u4f7f\u7528maven\u63d2\u4ef6\u6765\u90e8\u7f72\u9879\u76ee\u5341\u5206\u7684\u9ebb\u70e6\uff0c\u56e0\u4e3a\u5982\u679c\u88ab\u4f9d\u8d56\u7684\u6a21\u5757\u6709\u6539\u52a8\uff0c\u5fc5\u987b\u81ea\u5df1\u624b\u52a8\u91cd\u65b0\u5b89\u88c5\u88ab\u4f9d\u8d56\u7684\u6a21\u5757\u624d\u80fd\u751f\u6548\u3002</li> </ul> <p>\u5982\u679c\u4e0d\u5bf9\u9879\u76ee\u5212\u5206\u591a\u4e2a\u6a21\u5757\uff0cdao\u5c42\u3001service\u5c42\u548ccontroller\u5c42\u653e\u5728\u540c\u4e00\u4e2a\u6a21\u5757\u7684\u4e0d\u540c\u5305\u4e2d\uff0c\u90a3\u4e48\u7528maven\u63d2\u4ef6\u6765\u90e8\u7f72\u9879\u76ee\u4f1a\u5f88\u65b9\u4fbf\uff0c\u4f46\u6211\u7528maven\u4e0d\u5c31\u662f\u51b2\u7740\u5b83\u53ef\u4ee5\u5212\u5206\u6a21\u5757\uff0c\u5728\u6a21\u5757\u4e4b\u95f4\u8fdb\u884c\u4f9d\u8d56\u7ba1\u7406\u6765\u7684\u5417\uff0c\u597d\u5427\uff0c\u7efc\u4e0a\uff0c\u4f7f\u7528maven\u6765\u7ba1\u7406\u9879\u76ee\uff0c\u4f46\u4e0d\u8981\u4f7f\u7528maven\u63d2\u4ef6\u6765\u90e8\u7f72\u9879\u76ee\uff0c\u4f7f\u7528idea\u96c6\u6210\u5916\u90e8\u72ec\u7acb\u7684\u670d\u52a1\u5668\u6765\u90e8\u7f72\u9879\u76ee\u66f4\u597d\uff0cidea\u4f1a\u5206\u6790\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\uff0c\u7136\u540e\u5408\u7406\u7684\u7f16\u8bd1\u5404\u4e2a\u6a21\u5757\u5e76\u90e8\u7f72web\u6a21\u5757\u3002</p> <ul> <li>\u7236\u5de5\u7a0b\u4f7f\u7528dependencyManagement\u4e0d\u5b9e\u9645\u5bfc\u5165\u4f9d\u8d56\uff0c\u5b50\u5de5\u7a0b\u9700\u8981\u663e\u793a\u7684\u58f0\u660e\u4f9d\u8d56\uff0c\u6545\u800cdependencyManagement\u4e3b\u8981\u7528\u4e8e\u7ba1\u7406\u7248\u672c\u3002</li> </ul> <ul> <li>\u6700\u4f73\u5b9e\u8df5\u662f\u628aconf/settings.xml\u6587\u4ef6\u590d\u5236\u4e00\u4efd\u5230 [\u7528\u6237\u76ee\u5f55]/.m2/ \u4e0b\uff0c\u4ee5\u540e\u53ea\u4fee\u6539\u8fd9\u4e2asettings.xml\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u56e0\u4e3aidea\u9ed8\u8ba4\u662f\u8bfb\u53d6\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u4e0b\u8f7d\u7684maven\u548cidea\u90fd\u662f\u8bfb\u53d6\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e86\u3002</li> <li>\u89e3\u51b3 \u4e0d\u518d\u652f\u6301\u6e90\u9009\u9879 5\u3002\u8bf7\u4f7f\u7528 7 \u6216\u66f4\u9ad8\u7248\u672c\u3002\u9519\u8bef</li> </ul> XML<pre><code>&lt;properties&gt;\n    &lt;maven.compiler.source&gt;15&lt;/maven.compiler.source&gt;\n    &lt;maven.compiler.target&gt;15&lt;/maven.compiler.target&gt;\n&lt;/properties&gt;\n</code></pre> <ul> <li>\u6253\u6210\u5e26\u4e3b\u7c7b\u7684jar\u5305</li> </ul> XML<pre><code>&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n            &lt;version&gt;3.0.2&lt;/version&gt;\n            &lt;configuration&gt;\n                &lt;archive&gt;\n                    &lt;manifest&gt;\n                        &lt;addClasspath&gt;true&lt;/addClasspath&gt;\n                        &lt;mainClass&gt;fully.qualified.MainClass&lt;/mainClass&gt;\n                    &lt;/manifest&gt;\n                &lt;/archive&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> <ul> <li>idea \u53f3\u4fa7\u7684\u6587\u4ef6\u5939\u5237\u65b0\u56fe\u6807\u7684\u529f\u80fd\u662f\u6267\u884c\u4e86maven\u8d44\u6e90\u63d2\u4ef6\u7684\u4e24\u4e2a\u76ee\u6807  maven-resources-plugin:resources\u548cmaven-resources-plugin:testResources</li> </ul>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12-nginx/","title":"12-nginx","text":"<p> \u7ea6 956 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12-nginx/#nginx","title":"nginx\u5e38\u7528\u547d\u4ee4","text":"<ul> <li> <p>\u67e5\u770bnginx\u7248\u672c</p> Text Only<pre><code>nginx -v\n</code></pre> </li> <li> <p>\u505c\u6b62nginx</p> Text Only<pre><code>nginx -s -stop\n</code></pre> </li> <li> <p>\u91cd\u65b0\u52a0\u8f7dnginx\u914d\u7f6e\u6587\u4ef6</p> Text Only<pre><code>nginx -s reload\n</code></pre> </li> <li> <p>\u4e0d\u8fd0\u884c\uff0c\u4ec5\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\u662f\u5426\u6b63\u786e\uff0c\u4e5f\u53ef\u7528\u6765\u67e5\u770bnginx\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e</p> Text Only<pre><code>nginx -t\n</code></pre> </li> </ul>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12-nginx/#_1","title":"\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u793a\u4f8b","text":"<p>nginx\u7684docker\u5bb9\u5668\u9ed8\u8ba4\u8bfb\u53d6\u7684\u4e3b\u914d\u7f6e\u6587\u4ef6\u662f<code>/etc/nginx/nginx.conf</code>\uff0c\u5728\u4e3b\u914d\u7f6e\u6587\u4ef6\u7684http\u5757\u4e2d\u6709\u8fd9\u4e48\u4e00\u9879<code>include /etc/nginx/conf.d/*.conf;</code>\uff0c\u4e5f\u5c31\u662fnginx\u8fd8\u4f1a\u8bfb\u53d6<code>/etc/nginx/conf.d/</code>\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u914d\u7f6e\uff0c\u7136\u540e\u653e\u5728\u4e3b\u914d\u7f6e\u6587\u4ef6\u7684http\u5757\u4e2d\uff0c\u6240\u4ee5\u6709\u4e24\u79cd\u65b9\u5f0f\u4fee\u6539nginx\u7684\u914d\u7f6e\uff0c\u4e00\u79cd\u662f\u76f4\u63a5\u4fee\u6539<code>/etc/nginx/nginx.conf</code>\uff0c\u53e6\u5916\u4e00\u79cd\u662f\u5728<code>/etc/nginx/conf.d/</code>\u4e0b\u53e6\u5916\u518d\u5199\u914d\u7f6e\uff0c\u4e0b\u9762\u91c7\u7528\u53e6\u5916\u518d\u5199\u914d\u7f6e\u7684\u65b9\u5f0f\u3002</p> <p>1.\u542f\u52a8\u4e24\u4e2atomcat\u5bb9\u5668\uff0c\u81ea\u52a8\u5206\u914d\u7684ip\u5206\u522b\u662f<code>172.17.0.2</code>\u3001<code>172.17.0.3</code>\uff0c\u90e8\u7f72\u540c\u6837\u7684web\u5de5\u7a0b\u3002</p> Text Only<pre><code>docker run -d -v /root/webapps:/usr/local/tomcat/webapps --name tomcat01 tomcat\ndocker run -d -v /root/webapps:/usr/local/tomcat/webapps --name tomcat02 tomcat\ndocker run -d -v /root/webapps:/usr/local/tomcat/webapps --name tomcat03 tomcat\n</code></pre> <p>2.\u7f16\u8f91nginx.conf\uff0c\u914d\u7f6e\u4e09\u4e2alocation\u6765\u5339\u914d\u4e0d\u540c\u8def\u5f84\uff0c\u8ba9nginx\u628a\u4e0d\u540c\u8def\u5f84\u7684\u8bf7\u6c42\u5206\u6d3e\u7684\u4e0d\u540c\u7684tomcat\u4e0a\uff0c/service/\u5206\u6d3e\u7ed9tomcat01\uff0c/static/\u5206\u6d3e\u7ed9tomcat02\uff0c\u5269\u4f59\u6240\u6709\u5206\u6d3e\u7ed9tomcat03\u3002</p> Text Only<pre><code>server {\n  listen 80;\n  location /service/ {\n    proxy_pass http://172.17.0.2:8080;\n  }\n  location /static/ {\n    proxy_pass http://172.17.0.3:8080;\n  }\n  location / {\n    proxy_pass http://172.17.0.4:8080;\n  }\n}\n</code></pre> <p>3.\u542f\u52a8nginx\u5bb9\u5668\uff0c\u628a\u5bbf\u4e3b\u673a\u7684nginx.conf\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u7684<code>/etc/nginx/conf.d/</code>\u4e0b</p> Text Only<pre><code>docker run -d -v /root/nginx.conf:/etc/nginx/conf.d/nginx.conf -p 80:80 --name master-nginx nginx\n</code></pre> <p>4.\u8fdb\u5165nginx\u5bb9\u5668\uff0c\u5220\u9664<code>/etc/nginx/conf.d/default.conf</code>\u5e76\u8ba9nginx\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e</p> Text Only<pre><code>docker exec -it master-nginx /bin/bash\nrm /etc/nginx/conf.d/default.conf\nnginx -s reload\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12-nginx/#_2","title":"\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e\u793a\u4f8b","text":"<p>1.\u4e3a\u4e86\u9a8c\u8bc1\u8d1f\u8f7d\u5747\u8861\u5206\u79bb\u7684\u6548\u679c\uff0c\u9700\u8981\u5c06web\u5de5\u7a0b\u590d\u5236\u4e86\u4e00\u4efd\uff0c\u7136\u540e\u5728\u76f8\u540c\u7684\u4e00\u4e2a\u9875\u9762\u505a\u70b9\u4e0d\u4e00\u6837\u7684\u6807\u8bb0\uff0c\u63a5\u7740\u542f\u52a8\u4e24\u4e2atomcat\u5bb9\u5668\uff0c\u5206\u522b\u90e8\u7f72\u8fd9\u4e24\u4e2aweb\u5de5\u7a0b\u3002</p> Text Only<pre><code>docker run -d -v /root/webapps01:/usr/local/tomcat/webapps --name tomcat01 tomcat\ndocker run -d -v /root/webapps02:/usr/local/tomcat/webapps --name tomcat02 tomcat\n</code></pre> <p>2.\u5728\u5bbf\u4e3b\u673a\u4e0a\u65b0\u5efa\u4e00\u4e2anginx\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u8c03\u6574\u6587\u4ef6\u6743\u9650\u4e3a777\uff0c\u4e0d\u7136\u6302\u8f7d\u6b64\u6587\u4ef6\u5230\u5bb9\u5668\u540e\uff0c\u4f1a\u51fa\u73b0\u5728\u5bbf\u4e3b\u673a\u4fee\u6539\u4f46\u5728\u5bb9\u5668\u4e0d\u540c\u6b65\u7684\u95ee\u9898\uff0c\u53ea\u6709\u91cd\u542f\u5bb9\u5668\u624d\u80fd\u540c\u6b65\uff0c\u6839\u672c\u539f\u56e0\u662fvin\u7f16\u8f91\u6587\u4ef6\u4e4b\u540e\u4f1a\u6539\u53d8\u6587\u4ef6\u7684inode\uff0c\u628a\u6743\u9650\u6539\u6210777\u540e\u5c31\u4e0d\u4f1a\u6539\u53d8inode\u4e86\u3002</p> Text Only<pre><code>mkdir nginx.conf\nchmod 777 nginx.conf\n</code></pre> <p>3.\u7f16\u8f91nginx.conf</p> Text Only<pre><code>#tomcat\u670d\u52a1\u5668\u7684ip\u5730\u5740\u5217\u8868\nupstream loadingbalance{\n  server 172.17.0.2:8080;\n  server 172.17.0.3:8080;\n}\nserver {\n  listen 80;\n  location / {\n    proxy_pass http://loadingbalance;\n  }\n}\n</code></pre> <p>4.\u542f\u52a8nginx\u5bb9\u5668\uff0c\u628a\u5bbf\u4e3b\u673a\u7684nginx.conf\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u7684<code>/etc/nginx/conf.d/</code>\u4e0b</p> Text Only<pre><code>docker run -d -v /root/nginx.conf:/etc/nginx/conf.d/nginx.conf -p 80:80 --name master-nginx nginx\n</code></pre> <p>5.\u8fdb\u5165nginx\u5bb9\u5668\uff0c\u5220\u9664<code>/etc/nginx/conf.d/default.conf</code>\u5e76\u8ba9nginx\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e</p> Text Only<pre><code>docker exec -it master-nginx /bin/bash\nrm /etc/nginx/conf.d/default.conf\nnginx -s reload\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/12-nginx/#_3","title":"\u52a8\u9759\u5206\u79bb\u914d\u7f6e\u793a\u4f8b","text":"<p>\u52a8\u9759\u5206\u79bb\u7684\u601d\u8def\u662f\u9759\u6001\u8d44\u6e90\u8bf7\u6c42\u76f4\u63a5\u8ba9nginx\u670d\u52a1\u5668\u8fd4\u56de\uff0c\u52a8\u6001\u8d44\u6e90\u8bf7\u6c42\u518d\u8ba9nginx\u8f6c\u53d1\u5230tomcat\u670d\u52a1\u5668\u3002\u6240\u4ee5\u9700\u8981\u628a\u6574\u4e2aweb\u5de5\u7a0b\u5728nginx\u670d\u52a1\u5668\u4e0a\u4e5f\u653e\u4e00\u4efd\uff0c\u5f53\u8bf7\u6c42\u662f\u4ee5html\u3001jpg\u7b49\u7ed3\u5c3e\u65f6\uff0c\u76f4\u63a5\u7531nginx\u670d\u52a1\u5668\u8fd4\u56de\u3002\u56e0\u4e3a\u8981\u4fee\u6539\u4e3b\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684user\uff0c\u6240\u4ee5\u4e0b\u9762\u91c7\u7528\u76f4\u63a5\u4fee\u6539<code>/etc/nginx/nginx.conf</code>\u7136\u540e\u6302\u8f7d\u5230\u5bb9\u5668\u7684\u65b9\u5f0f\u5b8c\u6210nginx\u7684\u914d\u7f6e\u3002</p> <p>1.\u7f16\u8f91nginx.conf\uff0c\u5148\u628a\u4e3b\u914d\u7f6e\u6587\u4ef6<code>/etc/nginx/nginx.conf</code>\u91cc\u7684\u5185\u5bb9\u590d\u5236\u51fa\u6765\uff0c\u7136\u540e\u5728\u6b64\u57fa\u7840\u4e0a\u4fee\u6539\u3002</p> Text Only<pre><code>#\u6ce8\u610f\u4fee\u6539nginx\u8bbf\u95ee\u672c\u5730\u8d44\u6e90\u6587\u4ef6\u65f6\u6240\u7528\u7684\u7528\u6237\uff0c\u4e0d\u7136nginx\u65e0\u6cd5\u8bbf\u95ee\u6240\u5728\u670d\u52a1\u5668\u7684\u672c\u5730\u8d44\u6e90\u4ece\u800c\u62a5403 forbidden\nuser  root;\nworker_processes  auto;\n\nerror_log  /var/log/nginx/error.log notice;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    upstream loadingbalance{\n      server 172.17.0.2:8080;\n      server 172.17.0.3:8080;\n    }\n\n    server {\n      listen 80;\n\n      #\u9759\u6001\u8d44\u6e90\u8bf7\u6c42\u76f4\u63a5\u8ba9nginx\u670d\u52a1\u5668\u8fd4\u56de\n      location ~* \\.(html|gif|jpg|jpeg|png|css|js|ico)$ {\n        root /root/webapps/;\n        expires 3d;\n      }\n\n      location / {\n        proxy_pass http://loadingbalance;\n      }\n    }\n}\n</code></pre> <p>2.\u542f\u52a8nginx\u5bb9\u5668\uff0c\u628a\u5bbf\u4e3b\u673a\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6<code>nginx.conf</code>\u548cweb\u5de5\u7a0b<code>/root/webapps01</code>\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d</p> Text Only<pre><code>docker run -d -v /root/nginx.conf:/etc/nginx/nginx.conf -v /root/webapps01:/root/webapps -p 80:80 --name master-nginx nginx\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/","title":"13-redis","text":""},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#redis","title":"redis\u670d\u52a1\u5668\u542f\u52a8\u547d\u4ee4","text":"Text Only<pre><code>\u4ee5\u9ed8\u8ba4\u914d\u7f6e\u542f\u52a8\uff1aredis-server\n\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u542f\u52a8\uff1aredis-server /path/to/redis.conf\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#redis_1","title":"redis\u5ba2\u6237\u7aef\u8fde\u63a5\u547d\u4ee4","text":"Text Only<pre><code>redis-cli -h &lt;ip&gt; -p &lt;port&gt; \u7701\u7565-h\u53c2\u6570\u9ed8\u8ba4\u8fde\u63a5127.0.0.1\uff0c\u7701\u7565-p\u53c2\u6570\u9ed8\u8ba46379\u7aef\u53e3\n\u4e5f\u53ef\u4ee5\u53ea\u6267\u884c\u4e00\u6761\u547d\u4ee4\u800c\u4e0d\u8fdb\u5165\u5ba2\u6237\u7aef\uff1aredis-cli &lt;\u547d\u4ee4&gt;\uff0c\u5982:\n\u67e5\u770bredis\u670d\u52a1\u5668\u4fe1\u606f\uff1aredis-cl info server\n\u5173\u95edredis\u670d\u52a1\u5668\u4fe1\u606f\uff1aredis-cl shutdown\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#redis_2","title":"redis\u5bb9\u5668","text":"<p>redis\u7684docker\u5bb9\u5668\u6ca1\u6709\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u5728redis\u7684\u5b98\u65b9github\u4ed3\u5e93\u4e0b\u8f7dredis.conf\uff0c\u7136\u540e\u518d\u7f16\u8f91\uff0c\u5728\u542f\u52a8redis\u670d\u52a1\u5668\u5bb9\u5668\u65f6\u6302\u8f7d\uff0c\u6ce8\u610f\uff0c\u6302\u8f7d\u6587\u4ef6\u9700\u8981\u4fee\u6539\u6587\u4ef6\u7684\u6743\u9650\u4e3a777\uff0c\u5bb9\u5668\u624d\u80fd\u540c\u6b65\u6587\u4ef6\u7684\u4fee\u6539\u3002</p> Text Only<pre><code>docker run -d -v /root/redis/redis.conf:/data/redis.conf -v /root/redis/data:/data -p 6379:6379 --name myredis redis redis-server /usr/local/etc/redis/redis.conf\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#redis_3","title":"redis\u914d\u7f6e\u6587\u4ef6","text":"Text Only<pre><code>################################ \u5e38\u89c4\u914d\u7f6e ################################\n#\u540e\u53f0\u542f\u52a8redis\ndaemonize yes\n#\u7ed1\u5b9a\u5230\u672c\u673a\u7684\u67d0\u4e2a\u7f51\u7edc\u63a5\u53e3\u4e0a\uff0c127.0.0.1\u662fipv4\u7684\u73af\u56de\u63a5\u53e3\uff0c::1\u662fipv6\u7684\u73af\u56de\u63a5\u53e3\uff0c-\u8868\u793a\u5f53redis\u68c0\u6d4b\u5230\u672c\u673a\u7f51\u7edc\u63a5\u53e3\u5e76\u6ca1\u6709\u8be5ip\u5730\u5740\u65f6\u542f\u52a8\u4e0d\u4f1a\u5931\u8d25\uff0c\u6ce8\u91ca\u6389bind\uff0credis\u4f1a\u9ed8\u8ba4\u7ed1\u5b9a\u672c\u673a\u6240\u6709\u7684\u7f51\u7edc\u63a5\u53e3\n#bind 127.0.0.1 -::1\n#\u8bbe\u7f6e\u7aef\u53e3\nport 6379\n#\u8bbe\u7f6e\u5ba2\u6237\u7aef\u65e0\u64cd\u4f5c\u7684\u8d85\u65f6\u65f6\u95f4\ntimeout 0\n#\u6bcf300s\u68c0\u6d4b\u4e00\u6b21\u5ba2\u6237\u7aef\u7684\u5fc3\u8df3\ntcp-keepalive 300\n#\u8bbe\u7f6eredis\u7684\u6570\u636e\u5e93\u4e2a\u6570\ndatabases 16\n#\u8bbe\u7f6e\u5bc6\u7801\n#requirepass foobared\n#\u5f00\u542f\u4fdd\u62a4\u6a21\u5f0f\u4f1a\u4f7f\u5f97\u53ea\u80fd\u901a\u8fc7\u672c\u673a\u73af\u56de\u63a5\u53e3\u8fde\u63a5redis\nprotected-mode no\n#\u5728\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u7684\u540d\u79f0\uff0c\u82e5\u4e3a\u7a7a\u4e32\u5219\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u4e0a\uff0c\u82e5\u4e3a\u7a7a\u4e32\u4e14\u662f\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u542f\u52a8\uff0c\u5219\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230/dev/null\nlogfile \"\"\n\n################################ SNAPSHOTTING RDB\u6301\u4e45\u5316\u914d\u7f6e ################################\n#\u5173\u95edRDB\u6301\u4e45\u5316\n# save \"\"\n&lt;div markdown=\"1\" style=\"margin-top: -30px; font-size: 0.75em; opacity: 0.7;\"&gt;\n:material-circle-edit-outline: \u7ea6 5325 \u4e2a\u5b57 :material-clock-time-two-outline: \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 106 \u5206\u949f\n&lt;/div&gt;\n#rdb\u6301\u4e45\u5316\u7684\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4dump.rdb\ndbfilename dump.rdb\n#\u6587\u4ef6\u4fdd\u5b58\u7684\u4f4d\u7f6e\ndir /data\n#\u4fdd\u5b58\u7b56\u7565\nsave 3600 1\nsave 300 100\nsave 60 10000\n#bgsave\u51fa\u9519\u65f6\u505c\u6b62\u5199\nstop-writes-on-bgsave-error yes\n#\u5f00\u542f\u538b\u7f29\u5b58\u50a8\nrdbcompression yes\n#\u5b58\u50a8\u65f6\u751f\u6210\u6821\u9a8c\u548c\uff0c\u6062\u590d\u65f6\u68c0\u67e5\u6821\u9a8c\u548c\nrdbchecksum yes\n\n################################ APPEND ONLY MODE AOF\u6301\u4e45\u5316\u914d\u7f6e ################################\n#\u5f00\u542fAOF\uff0cAOF\u548cRDB\u540c\u65f6\u5f00\u542f\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u53d6AOF\u7684\u6570\u636e\nappendonly yes\n#AOF\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4appendonly.aof\uff0c\u4e14\u4e0edump.rdb\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\nappendfilename \"appendonly.aof\"\n#AOF\u540c\u6b65\u9891\u7387\n#\u59cb\u7ec8\u540c\u6b65\uff0c\u6bcf\u6b21Redis\u7684\u5199\u5165\u90fd\u4f1a\u7acb\u523b\u8bb0\u5165\u65e5\u5fd7\uff1b\u6027\u80fd\u8f83\u5dee\u4f46\u6570\u636e\u5b8c\u6574\u6027\u6bd4\u8f83\u597d\n# appendfsync always\n#\u6bcf\u79d2\u540c\u6b65\uff0c\u6bcf\u79d2\u8bb0\u5165\u65e5\u5fd7\u4e00\u6b21\uff0c\u5982\u679c\u5b95\u673a\uff0c\u672c\u79d2\u7684\u6570\u636e\u53ef\u80fd\u4e22\u5931\nappendfsync everysec\n#redis\u4e0d\u4e3b\u52a8\u8fdb\u884c\u540c\u6b65\uff0c\u628a\u540c\u6b65\u65f6\u673a\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\n# appendfsync no\n# \u4e0d\u662f\u5f88\u6e05\u695a\u8fd9\u4e2a\u914d\u7f6e\u7684\u542b\u4e49\uff0c\u5927\u81f4\u610f\u601d\u662f\u6709\u5b50\u7ebf\u7a0b\u5728bgsave\u6216\u8005bgrewriteaof\u65f6\u4e0d\u8fdb\u884c\u6587\u4ef6AOF\u6587\u4ef6\u540c\u6b65\u3002\u5b98\u65b9\u5efa\u8bae\u4e3ano\uff0c\u5373\u8981\u8fdb\u884c\u6587\u4ef6\u540c\u6b65\uff0c\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u4f46\u4f1a\u9020\u6210\u963b\u585e\uff1b\u8bbe\u7f6e\u4e3ayes\u8868\u793a\u4e0d\u8fdb\u884c\u6587\u4ef6\u540c\u6b65\uff0c\u800c\u662f\u5199\u8fdb\u7f13\u51b2\u533a\uff0c\u5f85\u5b50\u7ebf\u7a0b\u4e0b\u6b21\u4fdd\u5b58\u65f6\u518d\u540c\u6b65AOF\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u4f1a\u6570\u636e\u4e22\u5931\u3002\nno-appendfsync-on-rewrite no\n#\u91cd\u5199\u89e6\u53d1\u7684\u65f6\u673a\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n#\u5ffd\u7565AOF\u6587\u4ef6\u7ed3\u5c3e\u4e0d\u5b8c\u6574\u7684\u60c5\u51b5\u7ee7\u7eed\u52a0\u8f7d\u6062\u590d\u6570\u636e\naof-load-truncated yes\n#\u91cd\u5199\u65f6\u628ardb\u6587\u4ef6\u6570\u636e\u653e\u5728\u5728\u65b0\u7684AOF\u6587\u4ef6\u7684\u5934\u90e8\u4f5c\u4e3a\u5df2\u6709\u7684\u5386\u53f2\u6570\u636e\uff0c\u66ff\u6362\u6389\u539f\u6765\u7684\u6d41\u6c34\u8d26\u64cd\u4f5c\naof-use-rdb-preamble yes\n\n############## REPLICATION \u4e3b\u4ece\u590d\u5236 ##################\n#\u8bbe\u7f6e\u4ece\u673a\u7684master\u4e3b\u673a\n# replicaof &lt;masterip&gt; &lt;masterport&gt;\n#\u8bbe\u7f6e\u4e3b\u673a\u6302\u6389\u4e86\u4ece\u673a\u8fd8\u53ef\u4ee5\u8bfb\uff0c\u5355\u8bcdstale\u662f\u9648\u65e7\u7684\u610f\u601d\uff0c\u8868\u793a\u4e3b\u673a\u6302\u6389\u4e86\uff0c\u5728\u4ece\u673a\u4e0a\u8bfb\u5230\u7684\u53ef\u80fd\u662f\u4e00\u4e9b\u65e7\u6570\u636e\nreplica-serve-stale-data yes\n#\u8bbe\u7f6e\u4ece\u673a\u53ea\u8bfb\uff0c\u8bbe\u7f6e\u4e3ano\u53ef\u80fd\u4ea7\u751f\u4e00\u4e9b\u95ee\u9898\nreplica-read-only yes\n#backlog\u7528\u4e8e\u4ece\u673a\u589e\u91cf\u5f0f\u66f4\u65b0\n# repl-backlog-size 1mb\n#\u8bbe\u7f6e\u5f53\u4e3b\u673a\u6ca1\u6709\u4ece\u673a\u65f6\uff0c\u4e3b\u673abacklog\u8fc7\u671f\u5220\u9664\u65f6\u95f4\uff0c0\u8868\u793a\u6c38\u4e0d\u5220\u9664\uff0c\u6ce8\u610f\uff0c\u4ece\u673a\u672c\u6765\u5c31\u6c38\u4e0d\u5220\u9664backlog\n# repl-backlog-ttl 3600\n#\u54e8\u5175\u9009\u4e3e\u65f6\uff0c\u4ece\u673a\u7684\u4f18\u5148\u7ea7\uff0c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u4e3a0\u8868\u793a\u6c38\u4e0d\u5f53master\nreplica-priority 100\n\n################################ REDIS CLUSTER  ###############################\n#\u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f\ncluster-enabled yes\n#\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u8282\u70b9\u81ea\u52a8\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u8be5\u6587\u4ef6\u4e0d\u8981\u624b\u52a8\u53bb\u4fee\u6539\ncluster-config-file nodes-6379.conf\n#\u8282\u70b9\u5224\u5b9a\u4e3a\u4e0d\u53ef\u8fbe\u7684\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\ncluster-node-timeout 15000\n#\u5982\u679c\u8bbe\u7f6e\u4e3ayes\uff0c\u5f53\u67d0\u4e00\u6bb5\u63d2\u69fd\u7684\u4e3b\u4ece\u90fd\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u4e5f\u5c31\u6302\u6389\u4e86\uff1b\u8bbe\u7f6e\u4e3ano\uff0c\u5f53\u67d0\u4e00\u6bb5\u63d2\u69fd\u7684\u4e3b\u4ece\u90fd\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u4e0d\u4f1a\u6302\u6389\uff0c\u53ea\u662f\u8be5\u6bb5\u63d2\u69fd\u4e0d\u53ef\u7528\ncluster-require-full-coverage yes\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#redis_4","title":"redis\u5e38\u7528\u547d\u4ee4","text":"<p>\u52a8\u6001\u8bbe\u7f6eredis\u7684\u8fd0\u884c\u914d\u7f6e</p> Text Only<pre><code>config set &lt;directive&gt; &lt;value&gt;\nredis\u8fd0\u884c\u671f\u95f4\u8bbe\u7f6e\u5bc6\u7801\uff0c\u91cd\u542f\u5931\u6548\uff1aconfig set requirepass 123456\n\u8bbe\u7f6e\u5bc6\u7801\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u8ba4\u8bc1\uff1aauth &lt;password&gt;\n</code></pre> <p>\u83b7\u53d6redis\u7684\u914d\u7f6e\u4fe1\u606f</p> Text Only<pre><code>config get &lt;pattern&gt;\n</code></pre> <p>\u628aredis\u8fd0\u884c\u65f6\u7684\u914d\u7f6e\u4fe1\u606f\u91cd\u5199\u5230\u6587\u4ef6</p> Text Only<pre><code>config rewrite\n</code></pre> <p>\u5207\u6362\u6570\u636e\u5e93\uff0c\u9ed8\u8ba416\u4e2a\u6570\u636e\u5e930~15</p> Text Only<pre><code>select &lt;dbid&gt;\n</code></pre> <p>\u67e5\u770b\u5f53\u524d\u5e93\u7684key</p> Text Only<pre><code>keys &lt;pattern&gt;\n&lt;pattern&gt;\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5982\u67e5\u770b\u5f53\u524d\u5e93\u7684\u6240\u6709key\uff1akeys *\n</code></pre> <p>\u5224\u65ad\u67d0\u4e2akey\u662f\u5426\u5b58\u5728</p> Text Only<pre><code>exists &lt;key&gt;\n</code></pre> <p>\u67e5\u770bkey\u5bf9\u5e94\u7684value\u662f\u4ec0\u4e48\u6570\u636e\u7c7b\u578b\uff0credis\u76845\u5927\u5e38\u7528\u6570\u636e\u7ed3\u6784\uff1a\u5b57\u7b26\u4e32 (string)\u3001\u5217\u8868 (list)\u3001\u96c6\u5408 (set)\u3001\u54c8\u5e0c (hash)\u3001\u6709\u5e8f\u96c6\u5408 (zset)</p> Text Only<pre><code>type &lt;key&gt;\n</code></pre> <p>\u5220\u9664key-value</p> Text Only<pre><code>del &lt;key&gt;\n</code></pre> <p>\u975e\u963b\u585e\u5f02\u6b65\u5730\u5220\u9664key-value</p> Text Only<pre><code>unlink &lt;key&gt;\n</code></pre> <p>\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4</p> Text Only<pre><code>expire &lt;key&gt; &lt;seconds&gt;\n</code></pre> <p>\u67e5\u770b\u5269\u4f59\u591a\u5c11\u65f6\u95f4\u8fc7\u671f\uff0cttl (time to live)</p> Text Only<pre><code>ttl &lt;key&gt;\n</code></pre> <p>\u6e05\u7a7a\u5f53\u524d\u5e93</p> Text Only<pre><code>flushdb\n</code></pre> <p>\u6e05\u7a7a\u5168\u90e8\u5e93</p> Text Only<pre><code>flushall\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#string","title":"\u5b57\u7b26\u4e32 (string) \u5e38\u7528\u64cd\u4f5c","text":"<p>String\u7c7b\u578b\u662fRedis\u6700\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4e00\u4e2aRedis\u4e2d\u5b57\u7b26\u4e32value\u6700\u591a\u53ef\u4ee5\u662f512M\uff0c</p> <p>\u6dfb\u52a0\u952e\u503c\u5bf9</p> Text Only<pre><code>set &lt;key&gt; &lt;value&gt;  \nset &lt;key&gt; &lt;value&gt; [ex &lt;seconds&gt; | px &lt;miliseconds&gt;] [nx | xx]\n\u540c\u65f6\u8bbe\u7f6ekey\u7684\u8fc7\u671f\u65f6\u95f4 ex \u79d2 px \u6beb\u79d2\nnx\u4e0d\u5b58\u5728\u65f6\u624d\u8bbe\u7f6e\uff0c\u7b49\u540c\u4e8esetnx &lt;key&gt; &lt;value&gt; \u5f53key\u4e0d\u5b58\u5728\u65f6\u6dfb\u52a0\uff0cxx\u5b58\u5728\u65f6\u624d\u8bbe\u7f6e\n</code></pre> <p>\u67e5\u8be2\u952e\u5bf9\u5e94\u7684\u503c</p> Text Only<pre><code>get &lt;key&gt;\n</code></pre> <p>\u628a value \u8ffd\u52a0\u5230\u539f\u503c\u7684\u672b\u5c3e</p> Text Only<pre><code>append &lt;key&gt; &lt;value&gt;\n</code></pre> <p>\u67e5\u8be2\u503c\u7684\u957f\u5ea6</p> Text Only<pre><code>strlen &lt;key&gt;\n</code></pre> <p>\u589e\u52a0value\u4e2d\u6570\u5b57\u7684\u503c\uff0c\u5b57\u7b26\u4e32\u91cc\u5fc5\u987b\u5168\u662f\u6570\u5b57\uff0c\u8fd9\u662f\u4e00\u4e2a\u539f\u5b50\u6027\u64cd\u4f5c</p> Text Only<pre><code>incr &lt;key&gt; \u52a01\nincrby &lt;key&gt; &lt;step&gt; \u52a0step\n</code></pre> <p>\u51cf\u5c11value\u4e2d\u6570\u5b57\u7684\u503c\uff0c\u5b57\u7b26\u4e32\u91cc\u5fc5\u987b\u5168\u662f\u6570\u5b57\uff0c\u8fd9\u662f\u4e00\u4e2a\u539f\u5b50\u6027\u64cd\u4f5c</p> Text Only<pre><code>decr &lt;key&gt; \u51cf1\ndecr &lt;key&gt; &lt;step&gt; \u51cfstep\n</code></pre> <p>\u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value\u5bf9</p> Text Only<pre><code>mset &lt;key&gt; &lt;value&gt; [&lt;key&gt; &lt;value&gt; ....]\n</code></pre> <p>\u540c\u65f6\u83b7\u53d6\u4e00\u4e2a\u6216\u591a\u4e2a value </p> Text Only<pre><code>mget &lt;key&gt; [&lt;key&gt; ....]\n</code></pre> <p>\u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7ed9\u5b9a key \u90fd\u4e0d\u5b58\u5728\uff0c\u6709\u4e00\u4e2a\u5b58\u5728\u5219\u4f1a\u5bfc\u81f4\u6240\u6709\u8bbe\u7f6e\u5931\u8d25</p> Text Only<pre><code>msetnx &lt;key&gt; &lt;value&gt; [&lt;key&gt; &lt;value&gt; ....]\n</code></pre> <p>\u83b7\u53d6\u503c\u7684\u5b50\u4e32\uff0c\u7c7b\u4f3cjava\u4e2d\u7684substring\uff0c\u524d\u95ed\uff0c\u540e\u95ed\uff0c-1\u8868\u793a\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e</p> Text Only<pre><code>getrange &lt;key&gt; &lt;\u8d77\u59cb\u4f4d\u7f6e&gt; &lt;\u7ed3\u675f\u4f4d\u7f6e&gt;\n</code></pre> <p>\u4ece\u8d77\u59cb\u4f4d\u7f6e\u5f00\u59cb\u8986\u76d6\u539f\u503c</p> Text Only<pre><code>setrange &lt;key&gt; &lt;\u8d77\u59cb\u4f4d\u7f6e&gt; &lt;value&gt;\n</code></pre> <p>\u8bbe\u7f6e\u65b0\u503c\u7684\u540c\u65f6\u83b7\u5f97\u65e7\u503c</p> Text Only<pre><code>getset &lt;key&gt; &lt;value&gt;\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#list","title":"\u5217\u8868 (list) \u5e38\u7528\u64cd\u4f5c","text":"<p>\u5411\u5217\u8868\u4e2d\u63d2\u5165\u503c</p> Text Only<pre><code>lpush &lt;key&gt; &lt;element&gt; [&lt;element&gt; ...] \u4ece\u5de6\u8fb9\u63d2\u5165\u503c\nrpush &lt;key&gt; &lt;element&gt; [&lt;element&gt; ...] \u4ece\u53f3\u8fb9\u63d2\u5165\u503c\n</code></pre> <p>\u4ece\u5de6\u5230\u53f3\u5728\u5217\u8868\u4e2d\u53d6\u503c</p> Text Only<pre><code>lrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; \n</code></pre> <p>\u5f39\u51fa\u5217\u8868\u4e2d\u7684\u503c</p> Text Only<pre><code>lpop &lt;key&gt; [count] \u4ece\u5de6\u8fb9\u5f39\nrpop &lt;key&gt; [count] \u4ece\u53f3\u8fb9\u5f39\n</code></pre> <p>\u4ece key1 \u5217\u8868\u53f3\u8fb9\u5f39\u51fa\u4e00\u4e2a\u503c\uff0c\u63d2\u5230 key2\u5217\u8868\u5de6\u8fb9</p> Text Only<pre><code>rpoplpush &lt;key1&gt; &lt;key2&gt;\n</code></pre> <p>\u53d6\u7d22\u5f15\u5728 index\u5904\u7684\u503c\uff08\u4ece\u5de6\u5230\u53f3\uff09</p> Text Only<pre><code>lindex &lt;key&gt; &lt;index&gt;\n</code></pre> <p>\u83b7\u5f97\u5217\u8868\u957f\u5ea6</p> Text Only<pre><code>llen &lt;key&gt;\n</code></pre> <p>\u5728 value \u7684 \u524d\u9762/\u540e\u9762 \u63d2\u5165 newvalue </p> Text Only<pre><code>linsert &lt;key&gt; before/after &lt;pivot&gt; &lt;element&gt;\n</code></pre> <p>\u4ece\u5de6\u5230\u53f3\u5220\u9664n\u4e2a value</p> Text Only<pre><code>lrem &lt;key&gt; &lt;n&gt; &lt;value&gt;\n</code></pre> <p>\u5c06\u5217\u8868\u4e0b\u6807\u4e3aindex\u7684\u503c\u66ff\u6362\u6210value</p> Text Only<pre><code>lset &lt;key&gt; &lt;index&gt; &lt;value&gt;\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#set","title":"\u96c6\u5408 (set) \u5e38\u7528\u64cd\u4f5c","text":"<p>\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a member \u52a0\u5165\u5230\u96c6\u5408 key \u4e2d\uff0c\u81ea\u52a8\u53bb\u91cd</p> Text Only<pre><code>sadd &lt;key&gt; &lt;value1&gt; [&lt;member&gt;]\n</code></pre> <p>\u53d6\u51fa\u96c6\u5408\u4e2d\u7684\u6240\u6709\u503c</p> Text Only<pre><code>smembers &lt;key&gt;\n</code></pre> <p>\u5224\u65ad\u96c6\u5408\u662f\u5426\u4e3a\u542b\u6709 member\uff0c\u67091\uff0c\u6ca1\u67090</p> Text Only<pre><code>sismember &lt;key&gt; &lt;member&gt;\n</code></pre> <p>\u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570</p> Text Only<pre><code>scard &lt;key&gt;\n</code></pre> <p>\u5220\u9664\u96c6\u5408\u4e2d\u7684\u67d0\u4e2a\u5143\u7d20</p> Text Only<pre><code>srem &lt;key&gt; &lt;member&gt; [&lt;member&gt; ...]\n</code></pre> <p>\u4ece\u96c6\u5408\u4e2d\u968f\u673a\u5f39\u51fa\u4e00\u4e2a\u503c</p> Text Only<pre><code>spop &lt;key&gt;\n</code></pre> <p>\u968f\u673a\u4ece\u8be5\u96c6\u5408\u4e2d\u53d6\u51fan\u4e2a\u503c\uff0c\u4e0d\u4f1a\u4ece\u96c6\u5408\u4e2d\u5220\u9664</p> Text Only<pre><code>srandmember &lt;key&gt; &lt;n&gt;\n</code></pre> <p>\u628a\u96c6\u5408\u4e2d\u4e00\u4e2a\u503c\u4ece\u4e00\u4e2a\u96c6\u5408\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u96c6\u5408</p> Text Only<pre><code>smove &lt;source&gt; &lt;destination&gt; &lt;value&gt;\n</code></pre> <p>\u5f97\u5230\u96c6\u5408\u7684\u4ea4\u96c6</p> Text Only<pre><code>sinter &lt;key1&gt; [&lt;key2&gt;...]\n</code></pre> <p>\u5f97\u5230\u96c6\u5408\u7684\u5e76\u96c6</p> Text Only<pre><code>sunion &lt;key1&gt; [&lt;key2&gt;...]\n</code></pre> <p>\u5f97\u5230 key1 - key2 - ... \u7684\u5dee\u96c6\uff0c\u5373key1\u4e2d\u6709\u4f46\u662fkey2....\u6ca1\u6709\u7684\u5143\u7d20</p> Text Only<pre><code>sdiff &lt;key1&gt; [&lt;key2&gt;...]\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#hash","title":"\u54c8\u5e0c (hash) \u5e38\u7528\u64cd\u4f5c","text":"<p>\u8bbe\u7f6e field value </p> Text Only<pre><code>hset &lt;key&gt; &lt;field&gt; &lt;value&gt; [&lt;field&gt; &lt;value&gt; ...]\n</code></pre> <p>\u4ece\u53d6\u51fa field \u7684 value </p> Text Only<pre><code>hget &lt;key&gt; &lt;field&gt;\n</code></pre> <p>\u68c0\u67e5 field \u662f\u5426\u5b58\u5728</p> Text Only<pre><code>hexists &lt;key&gt; &lt;field&gt;\n</code></pre> <p>\u5217\u51fa\u6240\u6709field</p> Text Only<pre><code>hkeys &lt;key&gt;\n</code></pre> <p>\u5217\u51fa\u6240\u6709value</p> Text Only<pre><code>hvals &lt;key&gt;\n</code></pre> <p>\u5c06 field \u7684\u503cvalue\u589e\u52a0 increment</p> Text Only<pre><code>hincrby &lt;key&gt; &lt;field&gt; &lt;increment&gt;\n</code></pre> <p>\u8bbe\u7f6e field \u7684\u503c\u4e3a value \uff0c\u5f53\u4e14\u4ec5\u5f53\u57df field \u4e0d\u5b58\u5728 </p> Text Only<pre><code>hsetnx &lt;key&gt; &lt;field&gt; &lt;value&gt;\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#zset","title":"\u6709\u5e8f\u96c6\u5408 (zset) \u5e38\u7528\u64cd\u4f5c","text":"<p>\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a member \u5143\u7d20\u53ca\u5176 score \u503c\u52a0\u5165\u5230\u6709\u5e8f\u96c6 key \u5f53\u4e2d</p> Text Only<pre><code>zadd &lt;key&gt; &lt;score&gt; &lt;member&gt; [&lt;score&gt; &lt;member&gt;...]\n</code></pre> <p>\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u4e0b\u6807\u5728\u4e4b\u95f4\u5305\u62ec\u4e0b\u6807\u7684\u5143\u7d20\uff08\u4ece\u5c0f\u5230\u5927\uff09\uff0c\u52a0withscores\u8868\u793a\u628ascore\u4e5f\u5e26\u4e0a Text Only<pre><code>zrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES]\n</code></pre> <p>\u8fd4\u56de score \u503c\u4ecb\u4e8e min \u548c max \u4e4b\u95f4\uff08\u5305\u62ecmin\uff0cmax)\u7684\u5143\u7d20\uff08\u4ece\u5c0f\u5230\u5927\uff09</p> Text Only<pre><code>zrangebyscore key min max [withscores] [limit offset count]\n</code></pre> <p>\u540c\u4e0a\uff0c\u6539\u4e3a\u4ece\u5927\u5230\u5c0f\u6392\u5217</p> Text Only<pre><code>zrevrangebyscore key max min [withscores] [limit offset count]\n</code></pre> <p>value \u7684 score \u52a0\u4e0a increment</p> Text Only<pre><code>zincrby &lt;key&gt; &lt;increment&gt; &lt;value&gt;\n</code></pre> <p>\u5220\u9664\u8be5\u96c6\u5408\u4e0b\uff0c\u6307\u5b9a\u503c\u7684\u5143\u7d20</p> Text Only<pre><code>zrem &lt;key&gt; &lt;value&gt;\n</code></pre> <p>\u7edf\u8ba1\u8be5\u96c6\u5408\uff0c\u5206\u6570\u533a\u95f4\u5185\u7684\u5143\u7d20\u4e2a\u6570 </p> Text Only<pre><code>zcount &lt;key&gt; &lt;min&gt; &lt;max&gt;\n</code></pre> <p>\u8fd4\u56de\u8be5\u503c\u5728\u96c6\u5408\u4e2d\u7684\u6392\u540d\uff0c\u4ece0\u5f00\u59cb</p> Text Only<pre><code>zrank &lt;key&gt; &lt;value&gt;\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#_1","title":"\u53d1\u5e03\u548c\u8ba2\u9605","text":"<p>\u8ba2\u9605</p> Text Only<pre><code>subscribe channel [channel...]\npsubscribe &lt;pattern&gt; [&lt;pattern&gt;...]\n</code></pre> <p>\u53d1\u5e03</p> Text Only<pre><code>publish channel message\n</code></pre> <p>\u67e5\u770b\u6d3b\u8dc3\u7684\u9891\u9053\u6570</p> Text Only<pre><code>pubsub channels [&lt;pattern&gt;]\n</code></pre> <p>\u67e5\u770b\u9891\u9053\u8ba2\u9605\u6570</p> Text Only<pre><code>pubsub numsub [&lt;channel&gt;...]\n</code></pre> <p>\u67e5\u770b\u6a21\u5f0f\u8ba2\u9605\u6570</p> Text Only<pre><code>pubsub numpat\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#bitmaps","title":"Bitmaps","text":"<p>\u8bbe\u7f6e\u503c</p> Text Only<pre><code>setbit &lt;key&gt; &lt;offset&gt; &lt;value&gt;\n</code></pre> <p>\u83b7\u53d6\u503c</p> Text Only<pre><code>getbit &lt;key&gt; &lt;offset&gt;\n</code></pre> <p>\u6307\u5b9a\u8303\u56f4\u4e3a1\u7684\u4e2a\u6570</p> Text Only<pre><code>bitcount [start] [end]\n</code></pre> <p>Bitmaps\u4e4b\u95f4\u7684\u8fd0\u7b97</p> Text Only<pre><code>bitop &lt;and|or|not|xor&gt; &lt;destkey&gt; &lt;key&gt; [&lt;key&gt;...]\n</code></pre> <p>\u83b7\u53d6\u7b2c\u4e00\u4e2a\u503c\u4e3abit\u7684\u504f\u79fb\u91cf</p> Text Only<pre><code>bitpos &lt;key&gt; &lt;bit&gt; [start] [end]\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#hyperloglog","title":"HyperLogLog","text":"<p>\u6dfb\u52a0\u5143\u7d20</p> Text Only<pre><code>pfadd &lt;key&gt; &lt;element&gt; [&lt;element&gt;]\n</code></pre> <p>\u8ba1\u7b97\u4e00\u4e2a\u6216\u591a\u4e2aHyperLogLog\u7684\u72ec\u7acb\u603b\u6570</p> Text Only<pre><code>pfcount &lt;key&gt; [&lt;key&gt;...]\n</code></pre> <p>\u5408\u5e76\u591a\u4e2aHyperLogLog\u5230destkey</p> Text Only<pre><code>pfmerge &lt;destkey&gt; &lt;sourcekey&gt; [&lt;sourcekey&gt;]\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#redis_5","title":"redis\u4e8b\u52a1","text":"<p>redis\u91cc\u9762\u7684\u5355\u4e2a\u547d\u4ee4\u90fd\u662f\u539f\u5b50\u64cd\u4f5c\uff0c\u4f46\u5f53\u67d0\u4e2a\u9700\u6c42\u9700\u8981\u6267\u884c\u591a\u6761\u547d\u4ee4\u65f6\u5c31\u4e0d\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u4e86\uff0credis\u4e8b\u52a1\u5c31\u662f\u5c06\u591a\u6761\u547d\u4ee4\u6253\u5305\u5728\u4e00\u8d77\u6267\u884c\uff0c\u9632\u6b62\u5176\u5b83\u547d\u4ee4\u63d2\u961f\u3002</p> <p>multi\u547d\u4ee4\u8868\u793a\u5f00\u59cb\u7ec4\u961f\uff0c\u8f93\u5165\u7684\u6bcf\u6761\u547d\u4ee4\u90fd\u4e0d\u4f1a\u6267\u884c\uff0c\u53ea\u662f\u5148\u628a\u547d\u4ee4\u7ec4\u5408\u5728\u4e00\u8d77</p> Text Only<pre><code>multi\n</code></pre> <p>discard\u547d\u4ee4\u8868\u793a \u653e\u5f03\u6267\u884c\u961f\u5217 \u5e76 \u7ed3\u675f\u7ec4\u961f</p> Text Only<pre><code>discard\n</code></pre> <p>exec\u547d\u4ee4\u8868\u793a \u7ed3\u675f\u7ec4\u961f \u5e76  \u6267\u884c\u961f\u5217\uff0c\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u63d2\u961f\u3002\u6267\u884c\u8fc7\u7a0b\u6307\u4ee4\u4e0d\u88ab\u63d2\u961f\u6709\u4e09\u79cd\u60c5\u51b5\uff0c\u4e00\u662f\u5355\u7ebf\u7a0b\u6267\u884c\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6ca1\u6709\u5176\u5b83\u7ebf\u7a0b\uff0c\u81ea\u7136\u4e0d\u4f1a\u88ab\u6253\u65ad\uff1b\u4e8c\u662f\u591a\u7ebf\u7a0b\u5e76\u53d1\uff0c\u4f46\u662f\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u6267\u884c\uff0c\u5176\u5b83\u7ebf\u7a0b\u963b\u585e\uff0c\u4e8e\u662f\u4e0d\u4f1a\u88ab\u6253\u65ad\uff1b~~\u4e09\u662f\u591a\u7ebf\u7a0b\u5e76\u884c\uff0c\u5e76\u884c\u65f6\u5404\u81ea\u6267\u884c\u5404\u81ea\u7684\uff0c\u6ca1\u6709\u9501\uff0c\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u6240\u6709\u7ebf\u7a0b\u90fd\u80fd\u540c\u65f6\u6267\u884c\uff0c\u4e5f\u6ca1\u6709\u88ab\u6253\u65ad\uff0c\uff08\u4f46\u5176\u5b9e\u5728\u4e00\u6761\u65f6\u95f4\u7ebf\u4e0a\u770b\uff0c\u597d\u50cf\u6307\u4ee4\u7684\u6267\u884c\u8fd8\u662f\u6709\u5148\u540e\uff0c\u4e5f\u5c31\u662f\u8fd8\u662f\u88ab\u63d2\u961f\u4e86~~\u3002redis\u5728\u6267\u884cexec\u547d\u4ee4\u65f6\u91c7\u7528\u7684\u662f\u5355\u7ebf\u7a0b\u6267\u884c\u3002</p> Text Only<pre><code>exec\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7ec4\u961f\u8fc7\u7a0b\u4e2d\u67d0\u6761\u547d\u4ee4\u51fa\u73b0\u4e86\u8bed\u6cd5\u7b49\u9519\u8bef\uff0c\u90a3\u4e48\u6574\u4e2a\u961f\u5217\u90fd\u4f1a\u88ab\u53d6\u6d88\uff1b\u6267\u884c\u8fc7\u7a0b\u4e2d\u67d0\u6761\u547d\u4ee4\u51fa\u73b0\u4e86\u8bed\u6cd5\u7b49\u9519\u8bef\uff0c\u90a3\u4e48\u8be5\u547d\u4ee4\u4e0d\u4f1a\u6267\u884c\uff0c\u4f46\u5176\u5b83\u547d\u4ee4\u4f9d\u7136\u4f1a\u6b63\u5e38\u6267\u884c\uff0c\u8fd9\u6b63\u662fredis\u4e8b\u52a1\u4e0d\u540c\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e8b\u52a1\u7684\u5730\u65b9\uff0credis\u4e8b\u52a1\u4e0d\u4f1a\u56de\u6eda\uff0c\u6ca1\u6709\u539f\u5b50\u6027\u3002</p> <p>\u56e0\u4e3aredis\u4e8b\u52a1\u5728\u7ec4\u961f\u8fc7\u7a0b\u4e2d\u547d\u4ee4\u6ca1\u6709\u6267\u884c\uff0c\u800c\u5728\u6267\u884c\u8fc7\u7a0b\u4e5f\u4e0d\u4f1a\u88ab\u5176\u5b83\u547d\u4ee4\u63d2\u961f\uff0c\u6240\u4ee5redis\u4e8b\u52a1\u7684\u6267\u884c\u662f\u4e32\u884c\u5316\u7684\uff0c\u9694\u79bb\u6027\u5c31\u662f\u4e32\u884c\u5316\uff0c\u6ca1\u6709mysql\u7684\u9694\u79bb\u7ea7\u522b\u3002</p> <p>\u867d\u7136redis\u4e8b\u52a1\u662f\u4e32\u884c\u5316\u6267\u884c\u7684\uff0c\u4f46\u7531\u4e8e\u5176\u5bf9\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u662f\u6253\u5305\u6267\u884c\uff0c\u5bfc\u81f4\u5176\u4e32\u884c\u5316\u4e0emysql\u7684\u4e32\u884c\u5316\u5341\u5206\u4e0d\u540c\uff0c\u56e0\u4e3a\u6253\u5305\u6267\u884c\u610f\u5473\u7740redis\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u53ef\u80fd\u7a7f\u63d2\u5176\u5b83java\u4ee3\u7801\u7684\u903b\u8f91\uff0c\u4f46mysql\u7684\u4e8b\u52a1\u5c31\u4e0d\u4e00\u6837\uff0cmysql\u7684\u4e8b\u52a1\u662f\u5e76\u53d1\u6267\u884c\u7684\u957f\u4e8b\u52a1\uff0c\u6bcf\u4e2a\u547d\u4ee4\u90fd\u662f\u7acb\u5373\u6267\u884c\u53ef\u4ee5\u62ff\u5230\u7ed3\u679c\u7684\uff0c\u4e8b\u52a1\u6267\u884c\u671f\u95f4\u53ef\u4ee5\u6839\u636e\u7ed3\u679c\u6267\u884c\u5176\u5b83java\u4ee3\u7801\u903b\u8f91\uff0c\u4ece\u800c\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u7136\u540e\u901a\u8fc7\u9501\u6765\u4fdd\u8bc1\u4e32\u884c\u5316\uff0c\u4e5f\u5373\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u6267\u884c\u540e\u6570\u636e\u5e93\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u8fd9\u4e2a\u4e00\u81f4\u6027\u5305\u62ec\u4e86java\u4ee3\u7801\u7684\u903b\u8f91\u3002\u4f46redis\u4e8b\u52a1\u4e32\u884c\u5316\u5e26\u6765\u7684\u4e00\u81f4\u6027\u5e76\u4e0d\u5305\u62ecjava\u4ee3\u7801\u7684\u903b\u8f91\u3002</p> <p>\u4e00\u81f4\u6027\u662f\u4e00\u4e2a\u903b\u8f91\u4e0a\u7684\u6982\u5ff5\uff0c\u6307\u7684\u662f\u6ee1\u8db3\u7279\u5b9a\u903b\u8f91\u7684\u72b6\u6001\uff0c\u5728\u79d2\u6740\u6848\u4f8b\u4e2d\u5e93\u5b58\u4e0d\u80fd\u5c0f\u4e8e0\u5c31\u662f\u4e00\u4e2a\u903b\u8f91\uff0c\u4fdd\u8bc1\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u6307\u6570\u636e\u5e93\u4ece\u4e00\u79cd\u4e00\u81f4\u6027\u72b6\u6001\u8f6c\u79fb\u5230\u53e6\u4e00\u79cd\u4e00\u81f4\u6027\u72b6\u6001\u3002mysql\u7684\u4e32\u884c\u5316\u4e8b\u52a1\u662f\u4e00\u4e2a\u957f\u8fc7\u7a0b\uff0c\u4e8b\u52a1\u671f\u95f4\u53ef\u4ee5\u52a0\u5165\u5404\u79cdjava\u4ee3\u7801\u7684\u903b\u8f91\u5224\u65ad\u6765\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u4f46redis\u4e0d\u80fd\uff0c\u90a3\u5982\u4f55\u5728redis\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u4e2d\u52a0\u5165java\u4ee3\u7801\u7684\u903b\u8f91\u5462\uff1f</p> <p>\u7b54\u6848\u5c31\u662f\u4e50\u89c2\u9501\u3002mysql\u7684\u4e32\u884c\u5316\u4e8b\u52a1\u91c7\u7528\u662f\u60b2\u89c2\u9501\uff0c\u5982\u8bfb\u9501\u3001\u5199\u9501\uff1bredis\u5219\u91c7\u7528\u4e50\u89c2\u9501\uff1b\u8fd9\u90fd\u662f\u5404\u81ea\u6267\u884c\u7279\u70b9\u6240\u51b3\u5b9a\u3002</p> <p>redis\u4e50\u89c2\u9501\u547d\u4ee4watch\u9700\u8981\u5728multi\u547d\u4ee4\u4e4b\u524d\u6267\u884c\uff0c\u5177\u4f53\u7684\u6267\u884c\u4f4d\u7f6e\u8981\u770b\u4e1a\u52a1\u4ee3\u7801\u7684\u903b\u8f91\uff0c\u56e0\u4e3a\u5b83\u5c31\u662f\u7528\u6765\u786e\u4fdd\u4e00\u81f4\u6027\u4e2d\u6709\u4e1a\u52a1\u903b\u8f91\u7684\u3002</p> Text Only<pre><code>watch &lt;key&gt;\n</code></pre> <p>\u79d2\u6740\u6848\u4f8b\uff0c\u6ce8\u610fwatch\u7684\u4f4d\u7f6e\uff1a</p> Text Only<pre><code>public String doSecKill(String phone, String prodId) {\n        if (phone == null || prodId == null || phone.length() == 0 || prodId.length() == 0) {\n            log.info(\"\u7cfb\u7edf\u9519\u8bef\uff01\");\n            return \"\u7cfb\u7edf\u9519\u8bef\uff01\";\n        }\n\n        //\u5546\u54c1\u7684\u5e93\u5b58\n        String stock = \"sk:\" + prodId + \":stock\";\n        //\u79d2\u6740\u6210\u529f\u7684\u7528\u6237\u7684\u624b\u673a\u53f7\n        String user = \"sk:\" + prodId + \":phone\";\n\n        try (Jedis jedis = jedisPool.getResource()) {\n\n            if (jedis.get(stock) == null) {\n                log.info(\"\u79d2\u6740\u8fd8\u6ca1\u5f00\u59cb\uff01\uff01\");\n                return \"\u79d2\u6740\u8fd8\u6ca1\u5f00\u59cb\uff01\";\n            }\n            if (jedis.sismember(user, phone)) {\n                log.info(\"\u60a8\u5df2\u6210\u529f\u79d2\u6740\u5230\u5546\u54c1\uff0c\u4e0d\u53ef\u91cd\u590d\u79d2\u6740\uff01\");\n                return \"\u60a8\u5df2\u6210\u529f\u79d2\u6740\u5230\u5546\u54c1\uff0c\u4e0d\u53ef\u91cd\u590d\u79d2\u6740\uff01\";\n            }\n/*watch\u5fc5\u987b\u653e\u5728\u8fd9\u91cc\u6216\u4e4b\u524d\uff0c\u5f53\u6709\u4e24\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\u6267\u884c\u5230\u8fd9\u8fd8\u6ca1watch\u65f6\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u4e2awatch\u5e76\u6267\u884c\u4e86\u540e\u9762\u6240\u6709\u7684\u4ee3\u7801\uff0c\u90a3\u4e48\u5176\u5b83\u7ebf\u7a0bwatch\u7684\u5c06\u4f1a\u662f0\uff0c\u7136\u540e\u6302\u5728\u4e0b\u9762\u7684if\u5224\u65ad\uff1b\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u90fdwatch\u7684\u662f1\uff0c\u901a\u8fc7\u4e86\u4e0b\u9762\u7684if\u5224\u65ad\uff0c\u5219\u60b2\u89c2\u9501\u53ea\u4f1a\u8ba9\u5176\u4e2d\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u6210\u529f\uff0c\u5176\u5b83\u5747\u5931\u8d25\u3002*/\n            jedis.watch(stock);\n            //\u4e0b\u9762\u7684jedis.get(stock)\u5e76\u4e0d\u5c5e\u4e8eredis\u4e8b\u52a1\u4e2d\u7684\u64cd\u4f5c\n            if (Integer.parseInt(jedis.get(stock)) &lt;= 0) {\n                log.info(\"\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01\");\n                return \"\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01\";\n            }\n\n/*\u5982\u679c\u628awatch\u653e\u5728\u8fd9\u91cc\uff0c\u53ef\u80fd\u51fa\u73b0\uff0c\u5728stock=1\u65f6\uff0c\u6709\u4e24\u4e2a\u8bf7\u6c42\u540c\u65f6\u5230\u8fd9\u91cc\uff0c\u4e00\u4e2a\u6ca1\u6709\u6267\u884cwatch\uff0c\u4e00\u4e2a\u5df2\u7ecfwatch\u5e76\u6267\u884c\u4e86\u5269\u4e0b\u6240\u6709\uff0c\u4e8e\u662f\u6ca1\u6709watch\u7684\u7ebf\u7a0b\u6b64\u65f6watch\u7684\u5c31\u662f0\uff0c\u7136\u540e\u8fd8\u80fd\u6b63\u5e38\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u4e8e\u662f\u5e93\u5b58\u5c31\u53d8\u6210-1\u4e86*/\n            //jedis.watch(stock);\n            Transaction multi = jedis.multi();\n            multi.decr(stock);\n/*\u7531\u4e8e\u8fd9\u91cc\u5e76\u6ca1\u6709\u771f\u6b63\u6267\u884csadd\uff0c\u524d\u9762\u7684if\u5224\u65ad\u53ea\u80fd\u662f\u5728\u771f\u6b63add\u4e4b\u540e\u6709\u6548\uff0c\u6240\u4ee5\u53ef\u80fd\u51fa\u73b0\u4e00\u4e2a\u7528\u6237\u7684\u591a\u6b21\u8bf7\u6c42\u90fd\u6267\u884c\u5230\u8fd9\u91cc\uff0c\u4f46\u6ca1\u6709\u6267\u884c\u4e0b\u9762\u7684exec\uff0c\u6700\u540e\u7684\u6548\u679c\u662f\u4e00\u4e2a\u7528\u6237\u6210\u529f\u62a2\u5230\u591a\u6b21\uff0c\u5e93\u5b58\u5f52\u96f6\u4e86\uff0c\u4f46\u7531\u4e8e\u662fset\u96c6\u5408\uff0c\u6240\u4ee5\u53ea\u6709\u4fdd\u7559\u7528\u6237\u7684\u4e00\u6761\u4fe1\u606f\uff0c\u4e8e\u662f\u6210\u529f\u62a2\u5230\u7684\u7528\u6237\u6570\u5c11\u4e8e\u5e93\u5b58\u6570*/\n            multi.sadd(user, phone);\n            List&lt;Object&gt; results;\n            /*//\u9a8c\u8bc1\u53d6\u4e0d\u5230\u503c\uff0c\u786e\u5b9e\u53d6\u4e0d\u5230\n            if (multi.get(stock) != null) {\n                System.out.println(multi.get(stock));\n            }*/\n            results = multi.exec();\n            if (results == null || results.size() == 0) {\n                log.info(\"\u5f88\u9057\u61be\u60a8\u672a\u80fd\u62a2\u5230\u5546\u54c1\uff01\");\n                return \"\u5f88\u9057\u61be\u60a8\u672a\u80fd\u62a2\u5230\u5546\u54c1\uff01\";\n            }\n            log.info(\"\u79d2\u6740\u6210\u529f\");\n            return \"\u79d2\u6740\u6210\u529f\uff01\";\n        }\n    }\n</code></pre> <p>apache benchmark \u5b89\u88c5</p> Text Only<pre><code>yum install httpd-tools\n</code></pre> <p>\u538b\u6d4b\u547d\u4ee4</p> Text Only<pre><code>ab -n 2000 -c 400 -p ~/postfile -T application/x-www-form-urlencoded http://192.168.37.1:8080/secKill\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#_2","title":"\u4e3b\u4ece\u590d\u5236","text":"<p>\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u4e0b\uff0cslave\u4ece\u673a\u53ea\u80fd\u8bfb\u4e0d\u80fd\u5199\uff0cmaster\u53ef\u8bfb\u53ef\u5199\uff0c\u6240\u4ee5master\u7684\u89d2\u8272\u4e3b\u8981\u662f\u5199\uff0cslave\u7684\u89d2\u8272\u4e3b\u8981\u662f\u8bfb\u3002</p> <p>\u8bbe\u7f6e\u6210\u4e3a\u8c01\u7684slave\uff0c\u5982\u679c\u5728\u5ba2\u6237\u7aef\u4e2d\u6267\u884c\uff0c\u5219\u91cd\u542f\u4f1a\u5931\u6548\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff0c\u91cd\u542f\u6709\u6548</p> Text Only<pre><code>replicaof &lt;host&gt; &lt;port&gt;\n</code></pre> <p>\u8bbe\u7f6e\u4e0d\u6210\u4e3aslave\uff0c\u800c\u662fmaster</p> Text Only<pre><code>replicaof no one\n</code></pre> <p>\u67e5\u770b\u4e3b\u4ece\u590d\u5236\u7684\u4fe1\u606f</p> Text Only<pre><code>info replication\nrole\n</code></pre> <p>\u54e8\u5175\u6a21\u5f0f\u914d\u7f6e\u6d41\u7a0b\uff1a</p> <p>\u54e8\u5175\u6a21\u5f0f\u6b63\u786e\u6253\u5f00\u65b9\u5f0f\u662f\u4e3a\u6bcf\u4e2aredis\u4e3b\u673a\u90fd\u8fd0\u884c\u4e00\u4e2a\u54e8\u5175\uff0c\u8fd9\u6837master\u4e3b\u673a\u6302\u6389\u4e86\uff0c\u5269\u4e0b\u7684slave\u4e3b\u673a\u7684\u54e8\u5175\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684replica-priority\u503c\u9009\u4e3e\u4ea7\u751f\u65b0\u7684master\uff0c\u539f\u6765\u7684master\u91cd\u65b0\u4e0a\u7ebf\u540e\u4f1a\u53d8\u6210\u73b0\u5728master\u7684slave\u3002</p> <p>1.\u7f16\u8f91\u542f\u52a8\u54e8\u5175\u7684\u914d\u7f6e\u6587\u4ef6sentinel.conf\u3002\u7531\u4e8eredis\u7684docker\u5bb9\u5668\u4e2d\u6ca1\u6709\u542f\u52a8\u54e8\u5175\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u5230redis\u7684\u5b98\u65b9github\u4ed3\u5e93\u4e0a\u4e0b\u8f7dsentinel.conf\u6587\u4ef6\uff0c\u7136\u540e\u57fa\u4e8e\u6b64\u6587\u4ef6\u8fdb\u884c\u7f16\u8f91\uff0c\u7f16\u8f91\u5b8c\u518d\u590d\u5236\u5230\u5bb9\u5668\u5185\u3002</p> Text Only<pre><code># \u7ed1\u5b9a\u7f51\u7edc\u63a5\u53e3\n# bind 127.0.0.1 192.168.1.1\n# \u5173\u95ed\u4fdd\u62a4\u6a21\u5f0f\uff0c\u4e0d\u7136\u53ea\u80fd\u672c\u673a\u8bbf\u95ee\nprotected-mode yes\n# \u7aef\u53e3\u53f7\nport 26379\n# \u662f\u5426\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u542f\u52a8\ndaemonize no\n# \u82e5\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u542f\u52a8\uff0c\u6307\u5b9apid\u5b58\u653e\u7684\u4f4d\u7f6e\npidfile /var/run/redis-sentinel.pid\n#\u5728\u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u7684\u540d\u79f0\uff0c\u82e5\u4e3a\u7a7a\u4e32\u5219\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u4e0a\uff0c\u82e5\u4e3a\u7a7a\u4e32\u4e14\u662f\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u542f\u52a8\uff0c\u5219\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230/dev/null\nlogfile \"\"\n#\u5de5\u4f5c\u76ee\u5f55\ndir /tmp\n\n# \u6700\u91cd\u8981\u7684\u914d\u7f6e\uff0c&lt;master-name&gt;\u662f\u4e3amaster\u8d77\u7684\u522b\u540d\uff0c&lt;ip&gt; &lt;redis-port&gt;\u662f\u54e8\u5175\u542f\u52a8\u65f6master\u7684IP\u548c\u7aef\u53e3\uff0c\u54e8\u5175\u4f1a\u901a\u8fc7info\n# replication \u547d\u4ee4\u83b7\u53d6\u5230master\u4e3b\u673a\u6240\u6709slave\u4ece\u673a\u7684ip\u548c\u7aef\u53e3\u53f7\uff0c&lt;quorum&gt;\u8868\u793a\u5224\u5b9amaster\u4e0d\u53ef\u8fbe\u81f3\u5c11\u9700\u8981quorum\u4e2a\u54e8\u5175\u540c\u610f\u3002\n# quorum\u4e00\u822c\u8bbe\u7f6e\u4e3a(sentinels/2 + 10)\uff0c\u4f8b\u5982\uff1asentinel monitor mymaster 172.17.0.4 6379 2\nsentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;\n\n# \u5982\u679c\u88ab\u76d1\u63a7\u7684master\u4e3b\u673a\u914d\u7f6e\u4e86\u5bc6\u7801\uff0c\u90a3\u4e48\u9700\u8981\u4ee5\u4e0b\u914d\u7f6e\u8fdb\u884c\u8ba4\u8bc1\n# sentinel auth-pass &lt;master-name&gt; &lt;password&gt;\n\n# \u6bcf\u4e2a\u54e8\u5175\u8282\u70b9\u901a\u8fc7ping\u547d\u4ee4\u6765\u5224\u65ad\u6570\u636e\u8282\u70b9\u548c\u5176\u5b83\u54e8\u5175\u8282\u70b9\u662f\u5426\u53ef\u8fbe\uff0c\u5982\u679c\u5728\u4e0b\u9762\u914d\u7f6e\u7684\u65f6\u95f4\u6ca1\u6709\u6536\u5230\u56de\u590d\uff0c\u5219\u5224\u5b9a\u4e3a\u4e0d\u53ef\u8fbe\uff0c\u9ed8\u8ba430\u79d2\n# sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;\nsentinel down-after-milliseconds mymaster 30000\n\n# \u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u8bbe\u7f6e\u591a\u5c11\u4e2a\u4ece\u8282\u70b9\u5e76\u884c\u53d1\u8d77\u590d\u5236\u7684\u8bf7\u6c42\n# sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;\nsentinel parallel-syncs mymaster 1\n\n# \u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba43\u5206\u949f\n# sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;\nsentinel failover-timeout mymaster 180000\n</code></pre> <p>2.\u542f\u52a8\u54e8\u5175</p> Text Only<pre><code>redis-sentinel sentinel.conf\n</code></pre> <p>\u53ef\u4ee5\u8fde\u63a5\u54e8\u5175\u67e5\u770b\u54e8\u5175\u76d1\u63a7\u7684\u76f8\u5173\u4fe1\u606f</p> Text Only<pre><code>redis-cli -h &lt;sentinel-ip&gt; -p 26379\ninfo sentinel\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/13-redis/#_3","title":"\u96c6\u7fa4","text":"<p>\u6570\u636e\u5206\u533a\u662f\u5206\u5e03\u5f0f\u5b58\u50a8\u7684\u6838\u5fc3\uff0c\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u9996\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\u628a\u6574\u4e2a\u6570\u636e\u96c6\u6309\u7167\u5206\u533a\u89c4\u5219\u6620\u5c04\u5230\u591a\u4e2a\u8282\u70b9\u4e0a\uff0c\u5373\u628a\u6570\u636e\u96c6\u5212\u5206\u5230\u591a\u4e2a\u8282\u70b9\u4e0a\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u8d1f\u8d23\u6574\u4e2a\u6570\u636e\u96c6\u7684\u4e00\u4e2a\u5b50\u96c6\u3002</p> <p>\u624b\u52a8\u914d\u7f6e\u96c6\u7fa4\u6d41\u7a0b\uff1a</p> <p>1.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u662f\u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f</p> <p>2.\u542f\u52a86\u4e2aredis\u5bb9\u5668\uff0credis01\u3001redis02 ...</p> Text Only<pre><code>docker run -d -v /root/redis/redis.conf:/data/redis.conf --name redis01 redis redis-server /data/redis.conf\n...\n</code></pre> <p>3.\u4efb\u610f\u8fdb\u5165\u4e00\u4e2aredis\u5b9e\u4f8b\u7684\u5ba2\u6237\u7aef\uff0c\u7136\u540e\u4e0e\u5176\u5b835\u4e2a\u8282\u70b9\u63e1\u624b\uff0c\u52a0\u5165\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u4f1a\u81ea\u52a8\u8fdb\u884c\u534f\u5546\uff0c\u6240\u4ee5\u65e0\u9700\u5728\u6bcf\u4e00\u4e2a\u8282\u70b9\u505a\u4e0e\u5176\u5b835\u4e2a\u8282\u70b9\u63e1\u624b\u7684\u52a8\u4f5c\u3002</p> Text Only<pre><code>cluster meet 172.17.0.2 6379\n...\n</code></pre> <p>4.\u5206\u522b\u8fde\u63a5\u8282\u70b9\u7136\u540e\u5206\u914dslot\u3002\u8282\u70b9\u63e1\u624b\u540e\u96c6\u7fa4\u8fd8\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u56e0\u4e3aslot\u8fd8\u6ca1\u6709\u5206\u914d\uff0c\u6b64\u65f6\u96c6\u7fa4\u4ecd\u5904\u4e8e\u4e0b\u7ebf\u72b6\u6001\uff0c\u4e0d\u80fd\u8fdb\u884c\u6570\u636e\u7684\u8bfb\u5199\u3002</p> Text Only<pre><code>redis-cli -h 172.17.0.2 cluster addslots {0...5461}\nredis-cli -h 172.17.0.3 cluster addslots {5462...10922}\nredis-cli -h 172.17.0.4 cluster addslots {10922...16383}\n</code></pre> <p>5.\u8fde\u63a5\u5230\u5269\u4e0b3\u53f0redis\u4e3b\u673a\uff0c\u8ba9\u5176\u6210\u4e3a\u524d\u97623\u53f0\u4e3b\u673a\u7684\u4ece\u673a</p> Text Only<pre><code>redis-cli -h 172.17.0.5 cluster replicate {nodeId}\nredis-cli -h 172.17.0.6 cluster replicate {nodeId}\nredis-cli -h 172.17.0.7 cluster replicate {nodeId}\n</code></pre> <p>\u81ea\u52a8\u914d\u7f6e\u96c6\u7fa4\u6d41\u7a0b\uff1a</p> <p>1.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u662f\u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f</p> <p>2.\u542f\u52a86\u4e2aredis\u5bb9\u5668\uff0credis01\u3001redis02 ...</p> Text Only<pre><code>docker run -d -v /root/redis/redis.conf:/data/redis.conf --name redis01 redis redis-server /data/redis.conf\n...\n</code></pre> <p>3.\u81ea\u52a8\u914d\u7f6e\u96c6\u7fa4</p> Text Only<pre><code>docker exec -it redis01 redis-cli --cluster create --cluster-replicas 1 172.17.0.2:6379 172.17.0.3:6379 172.17.0.4:6379 172.17.0.5:6379 172.17.0.6:6379 172.17.0.7:6379\n</code></pre> <p>\u5e38\u7528\u547d\u4ee4\uff1a</p> <p>\u4f7f\u7528redis-cli\u5ba2\u6237\u7aef\u8fde\u63a5\u5230redis\u96c6\u7fa4\uff0c\u52a0 -c \u9009\u9879\u8868\u793a\u4ee5\u96c6\u7fa4\u7684\u65b9\u5f0f\u8fde\u63a5\uff0c\u4e5f\u5c31\u662f\u5728\u8bbe\u7f6e\u548c\u8bfb\u53d6\u503c\u65f6\u53ef\u4ee5\u6839\u636eslot\u91cd\u5b9a\u5411\u8fde\u63a5\u5230\u4e0d\u540c\u7684redis\u670d\u52a1\u5668\u4e0a\uff0c\u4e0d\u52a0 -c \u7684\u8bdd\u4e0d\u80fd\u91cd\u5b9a\u5411\uff0c\u53ea\u80fd\u8bbe\u7f6e\u548c\u8bfb\u53d6\u8fde\u63a5\u7684redis\u670d\u52a1\u5668\u4e0a\u7684slot\u3002</p> Text Only<pre><code>docker exec -it redis01 redis-cli -c\n</code></pre> <p>\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb</p> Text Only<pre><code>cluster nodes\n</code></pre> <p>\u67e5\u8be2\u952e\u6240\u5bf9\u5e94\u7684slot</p> Text Only<pre><code>cluster keyslot &lt;key&gt;\n</code></pre> <p>\u67e5\u8be2slot\u4e2d\u6709\u591a\u5c11\u952e\uff0c\u8981\u4e0eslot\u6240\u5728\u7684\u670d\u52a1\u5668\u8fde\u63a5\u624d\u80fd\u67e5\u8be2\u5230</p> Text Only<pre><code>cluster countkeysinslot &lt;slot&gt;\n</code></pre> <p>\u67e5\u8be2slot\u4e2d\u7684\u524dcount\u4e2a\u952e</p> Text Only<pre><code>cluster getkeysinslot &lt;slot&gt; &lt;count&gt;\n</code></pre> <p>\u7f13\u5b58\u7a7f\u900f</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u6076\u610f\u7528\u6237\u9ad8\u5e76\u53d1\u8bbf\u95ee\u6570\u636e\u5e93\u4e2d\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u8fd9\u65f6redis\u4e2d\u80af\u5b9a\u6ca1\u6709\u4e5f\u6ca1\u6709\u8fd9\u4e9b\u6570\u636e\uff0c\u4e8e\u662f\u5c06\u6240\u6709\u8bf7\u6c42\u90fd\u76f4\u63a5\u4ea4\u7ed9\u6570\u636e\u5e93\uff0c\u9020\u6210\u6570\u636e\u5e93\u5b95\u673a\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>1.\u5e03\u9686\u8fc7\u6ee4\u5668</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668\u53ef\u4ee5\u786e\u5b9a\u67d0\u6761\u6570\u636e\u4e00\u5b9a\u4e0d\u5b58\u5728\uff0c\u6216\u8005\u67d0\u6761\u6570\u636e\u53ef\u80fd\u5b58\u5728\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u5c06\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\u7684\u952e\u6620\u5c04\u5230\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u8bf7\u6c42\u8fc7\u6765\uff0c\u9996\u5148\u68c0\u67e5\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u8fd4\u56de\u4e3a0\uff0c\u5219\u53ef\u4ee5\u65ad\u5b9a\u6570\u636e\u5e93\u4e2d\u4e00\u5b9a\u6ca1\u6709\u8fd9\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd4\u56de\u4e3a1\uff0c\u867d\u7136\u4e0d\u80fd\u767e\u5206\u4e4b\u767e\u80af\u5b9a\u6570\u636e\u5e93\u4e2d\u4e00\u5b9a\u6709\u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u4e5f\u6709\u767e\u5206\u4e4b\u516b\u4e5d\u5341\u7684\u6982\u7387\u53ef\u80fd\u6709\uff0c\u4e8e\u662f\u653e\u884c\uff0c\u9996\u5148\u67e5redis\uff0c\u518d\u67e5\u6570\u636e\u5e93\uff0c\u4e0d\u4fdd\u8bc1\u4e00\u5b9a\u80fd\u67e5\u5230\u6570\u636e\u3002\u6bd4\u5982\u6570\u636e\u5e93\u952e\u7684\u53d6\u503c\u8303\u56f4\u662f40\u4ebf\uff0c\u6570\u636e\u5e93\u91cc\u6709\u8fd940\u4ebf\u4e2d\u768410\u4ebf\u6761\u6570\u636e\uff0c\u5c06\u8fd910\u4ebf\u6761\u6570\u636e\u6620\u5c04\u5230\u5e03\u9686\u8fc7\u6ee4\u5668\u4e4b\u540e\uff0c\u5982\u679c\u8bf7\u6c42\u7684\u6570\u636e\u662f\u8fd910\u4ebf\u6761\u6570\u636e\u4e2d\u7684\u4e00\u6761\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u5e76\u4e0d\u80fd\u767e\u5206\u4e4b\u767e\u786e\u5b9a\u8fd9\u6761\u6570\u636e\u4e00\u5b9a\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u4e8e\u662f\u8fd4\u56de1\uff0c\u800c\u5bf9\u4e8e\u5269\u4e0b30\u4ebf\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u5176\u4e2d\u767e\u5206\u4e4b\u4e5d\u5341\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u4f1a\u8fd4\u56de0\uff0c\u5373\u80af\u5b9a\u7684\u544a\u8bc9\u4f60\u6570\u636e\u5e93\u4e2d\u6ca1\u6709\u8fd9\u6761\u6570\u636e\uff0c\u800c\u5bf9\u4e8e\u5269\u4e0b\u767e\u5206\u4e4b\u5341\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u62ff\u4e0d\u51c6\uff0c\u4f1a\u8fd4\u56de1\uff0c\u6240\u4ee5\u5e03\u9686\u8fc7\u6ee4\u5668\u80fd\u62e6\u4e0b30\u4ebf*90%\u7684\u6076\u610f\u8bf7\u6c42\u3002</p> <p>2.\u62e6\u622aip</p> <p>3.\u7f13\u5b58\u7a7a\u503c</p> <p>\u7f13\u5b58\u51fb\u7a7f</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u70ed\u70b9key\u7a81\u7136\u8fc7\u671f\u5931\u6548\uff0c\u6240\u6709\u5e76\u53d1\u8bf7\u6c42\u76f4\u63a5\u6253\u5230\u6570\u636e\u5e93\u4e0a\uff0c\u9020\u6210\u6570\u636e\u5b95\u673a</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u8fd9\u91cc\u4e3b\u8981\u662f\u56e0\u4e3a\u8fc7\u671f\u4e4b\u540e\uff0c\u6240\u6709\u5e76\u53d1\u8bf7\u6c42\u76f4\u63a5\u6253\u5230\u6570\u636e\u5e93\u4e0a\uff0c\u6240\u4ee5\u53ef\u4ee5\u91c7\u7528\u52a0\u9501\u7684\u529e\u6cd5\uff0c\u53ea\u8ba9\u4e00\u4e2a\u8bf7\u6c42\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u8bbf\u95ee\u5b8c\u4e4b\u540e\u5c06\u7ed3\u679c\u7f13\u5b58\u5230redis\u4e2d\uff0c\u63a5\u7740\u5176\u5b83\u8bf7\u6c42\u4eceredis\u4e2d\u53d6\u6570\u636e\u3002\u5982\u679c\u662f\u5355\u4f53\u5e94\u7528\uff0c\u76f4\u63a5\u52a0\u4e92\u65a5\u9501\u5373\u53ef\uff0c\u5206\u5e03\u5f0f\u96c6\u7fa4\u5e94\u7528\u5c31\u9700\u8981\u52a0\u5206\u5e03\u5f0f\u9501\u3002</p> <p>\u7f13\u5b58\u96ea\u5d29</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a\u5927\u9762\u79efkey\u540c\u65f6\u5931\u6548\uff0c\u4e5f\u662f\u6240\u6709\u8bf7\u6c42\u76f4\u63a5\u6253\u6570\u636e\u5e93\u4e0a\uff0c\u9020\u6210\u6570\u636e\u5e93\u5b95\u673a</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u968f\u673a\u8bbe\u7f6ekey\u7684\u5931\u6548\u65f6\u95f4\uff0c\u9632\u6b62\u540c\u65f6\u5931\u6548</p> <p>\u5206\u5e03\u5f0f\u9501</p> <p>\u6240\u8c13\u5206\u5e03\u5f0f\u9501\uff0c\u5176\u5b9e\u5c31\u662f\u8ba9\u591a\u53f0\u5e94\u7528\u670d\u52a1\u5668\u4e92\u65a5\u7684\u8bbf\u95ee\u540c\u4e00\u4e2a\u6570\u636e\uff0c\u8fd9\u4e2a\u6570\u636e\u662f\u6240\u6709\u5e94\u7528\u670d\u52a1\u5668\u90fd\u80fd\u8bbf\u95ee\u5230\u7684\u3002</p> <p>\u4e09\u79cd\u4e3b\u6d41\u7684\u5206\u5e03\u5f0f\u9501\uff1a 1.\u57fa\u4e8e\u6570\u636e\u5e93 2.\u57fa\u4e8e\u7f13\u5b58\uff08redis\uff09\u7b49 3.\u57fa\u4e8ezookeeper</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/14-Stream%20%E5%92%8C%20Optional/","title":"Stream \u548c Optional","text":"<p> \u7ea6 802 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u4f7f\u7528\u7684Stream\u7684\u6b65\u9aa4\uff1a</p> <ol> <li>\u83b7\u53d6Stream\u6d41</li> <li>\u4e2d\u95f4\u65b9\u6cd5\uff08\u52a0\u5de5\u6570\u636e\uff09</li> <li>\u7ec8\u7ed3\u65b9\u6cd5</li> </ol> <p>\u4e00\u3001\u83b7\u53d6Stream\u6d41</p> <ol> <li>\u96c6\u5408List\u3001Set\u4f7f\u7528Collection\u63a5\u53e3\u7684stream\u65b9\u6cd5</li> </ol> Text Only<pre><code>default Stream&lt;E&gt; stream();\n</code></pre> <ol> <li>\u6570\u7ec4\u4f7f\u7528Arrays\u5de5\u5177\u7c7b\u7684\u9759\u6001\u65b9\u6cd5\uff08\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6570\u7ec4\u00a0\u548c\u00a0\u5f15\u7528\u6570\u636e\u7c7b\u578b\u6570\u7ec4\u00a0\u5747\u53ef\u4f7f\u7528\uff09</li> </ol> Text Only<pre><code>public static IntStream stream(int[] array);\npublic static &lt;T&gt; Stream&lt;T&gt; stream(T[] array);\n</code></pre> <ol> <li>\u96f6\u6563\u6570\u636e\u4f7f\u7528Stream\u63a5\u53e3\u4e2d\u7684of\u65b9\u6cd5\uff08\u5f15\u7528\u6570\u636e\u7c7b\u578b\u6570\u7ec4\u00a0\u4e5f\u53ef\u4f7f\u7528\uff09</li> </ol> <p>Text Only<pre><code>public static&lt;T&gt; Stream&lt;T&gt; of(T t);\npublic static&lt;T&gt; Stream&lt;T&gt; of(T... values);\n</code></pre> \u4f8b\u5982\uff1a Text Only<pre><code>Stream&lt;Integer&gt; stream = Stream.of(1, 2, 3);\n</code></pre></p> <p>\u4e8c\u3001\u4e2d\u95f4\u65b9\u6cd5</p> \u65b9\u6cd5\u540d \u8bf4\u660e Stream filter(Predicate predicate) \u7528\u4e8e\u5bf9\u6d41\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4 Stream limit(long maxSize) \u8fd4\u56de\u6b64\u6d41\u4e2d\u7684\u5143\u7d20\u7ec4\u6210\u7684\u6d41\uff0c\u622a\u53d6\u524d\u6307\u5b9a\u53c2\u6570\u4e2a\u6570\u7684\u6570\u636e Stream skip(long n) \u8df3\u8fc7\u6307\u5b9a\u53c2\u6570\u4e2a\u6570\u7684\u6570\u636e\uff0c\u8fd4\u56de\u7531\u8be5\u6d41\u7684\u5269\u4f59\u5143\u7d20\u7ec4\u6210\u7684\u6d41 static  Stream concat(Stream a, Stream b) \u5408\u5e76a\u548cb\u4e24\u4e2a\u6d41\u4e3a\u4e00\u4e2a\u6d41 Stream distinct() \u8fd4\u56de\u7531\u8be5\u6d41\u7684\u4e0d\u540c\u5143\u7d20\uff08\u6839\u636eObject.equals(Object) \uff09\u7ec4\u6210\u7684\u6d41  Stream map(Function&lt;? super T, ? extends R&gt; mapper); \u8f6c\u6362 ..... <p>\u4e09\u3001\u7ec8\u7ed3\u65b9\u6cd5 Text Only<pre><code>void forEach(Consumer&lt;? super T&gt; action);\nObject[] toArray(); `//\u6536\u96c6\u5230\u6570\u7ec4\u4e2d`\n&lt;A&gt; A[] toArray(IntFunction&lt;A[]&gt; generator);\nT reduce(T identity, BinaryOperator&lt;T&gt; accumulator); //T identity\u00a0\u662f\u4f20\u9012\u7ed9reduce\u7684\u521d\u59cb\u503c\uff0c\u6240\u4ee5\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u80af\u5b9a\u4e0d\u4e3anull\nOptional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator); //\u8fd9\u4e2areduce\u65b9\u6cd5\u6ca1\u6709\u521d\u59cb\u503c\uff0c\u6240\u4ee5reduce\u7684\u7ed3\u679c\u5c31\u6709\u53ef\u80fd\u4e3anull\uff0cOption\u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u5305\u542bNull\u548c\u503c\u7684\u4e00\u4e2a\u7c7b\u578b\nOptional&lt;T&gt; min(Comparator&lt;? super T&gt; comparator);\nOptional&lt;T&gt; max(Comparator&lt;? super T&gt; comparator);\nlong count();\n&lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector); `//\u6536\u96c6\u5230\u96c6\u5408\u4e2d`\n</code></pre></p> <p>\u628a\u7ed3\u679c\u6536\u96c6\u5230\u96c6\u5408\u4e2d Text Only<pre><code>&lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector);\n</code></pre> \u53c2\u6570\u5de5\u5177\u7c7bCollectors\u63d0\u4f9b\u4e86\u5177\u4f53\u7684\u6536\u96c6\u65b9\u5f0f</p> \u65b9\u6cd5\u540d \u8bf4\u660e public static  Collector toList() \u628a\u5143\u7d20\u6536\u96c6\u5230List\u96c6\u5408\u4e2d public static  Collector toSet() \u628a\u5143\u7d20\u6536\u96c6\u5230Set\u96c6\u5408\u4e2d public static Collector toMap(Function keyMapper,Function valueMapper) \u628a\u5143\u7d20\u6536\u96c6\u5230Map\u96c6\u5408\u4e2d Text Only<pre><code>List&lt;Integer&gt; list = list1.stream().filter(number -&gt; number % 2 == 0).collect(Collectors.toList());\nSet&lt;Integer&gt; set = list1.stream().filter(number -&gt; number % 2 == 0).toSet());\nMap&lt;String, Integer&gt; map = list.stream().collect(Collectors.toMap(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0s -&gt; s.split(\",\")[0],\u00a0//\u7b2c\u4e00\u4e2alambda\u8868\u8fbe\u5f0f\u6307\u5b9a\u5982\u4f55\u83b7\u53d6\u5230Map\u4e2d\u7684\u952e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0s -&gt; Integer.parseInt(s.split(\",\")[1]) ));//\u7b2c\u4e8c\u4e2alambda\u8868\u8fbe\u5f0f\u6307\u5b9a\u5982\u4f55\u83b7\u53d6Map\u4e2d\u7684\u503c\n</code></pre> <p>Optional Optional\u6709\u4e24\u4e2a\u4f5c\u7528\uff1a 1\u3001Optional\u7c7b\u7684\u6ce8\u91ca\u8bf4\uff0cOptional\u8bbe\u8ba1\u7684\u4e3b\u8981\u76ee\u7684\u662f\u4f5c\u4e3a\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u63d0\u9192\u8c03\u7528\u8005Optional\u5305\u88f9\u7684\u503c\u53ef\u80fd\u4e3anull\u3002  2\u3001\u51fd\u6570\u5f0f\u7f16\u7a0b\u65f6\u7684\u94fe\u5f0f\u8c03\u7528\u4e0d\u7528\u603b\u53bb\u8003\u8651NullPointerException\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u53ea\u8981\u4f60\u5904\u7406\u7684\u65f6\u5019\u4e00\u76f4\u5728\u7528Optional\uff0c\u5c31\u4e0d\u7528\u8003\u8651\u7a7a\u6307\u9488\u5f02\u5e38\uff0c\u9664\u975e\u4f60\u8981\u53d6\u51faOptional\u91cc\u7684value\u65f6\u624d\u9700\u8981\u8003\u8651\u503c\u6709\u53ef\u80fd\u4e3anull\u3002 \u6bd4\u5982\uff1a Text Only<pre><code>public class OptionalTest {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0 \u00a0 \u00a0 \u00a0 m1().stream()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(i -&gt; i.map(a -&gt; a + (a % 2 == 0 ? \" is even\" : \" is odd\")))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.filter(Optional::isPresent)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(Optional::get)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.forEach(System.out::println);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0static List&lt;Optional&lt;Integer&gt;&gt; m1() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Stream.of(1, 2, 3, null, 5, null, 7, 8).map(Optional::ofNullable).toList();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48\u8bf4\u53ea\u8981\u4f60\u5904\u7406\u7684\u65f6\u5019\u4e00\u76f4\u5728\u7528Optional\uff0c\u5c31\u4e0d\u7528\u8003\u8651\u7a7a\u6307\u9488\u5f02\u5e38\uff1f \u56e0\u4e3a\u5728\u4f7f\u7528Optional\u7684map\u3001flatMap\u65b9\u6cd5\u65f6\uff0cmap\u3001flatMap\u65b9\u6cd5\u91cc\u9762\u5df2\u7ecf\u5224\u7a7a\u4e86\u3002  \u4e3a\u4ec0\u4e48\u8bf4\u53ea\u6709\u5f53\u4f60\u4eceOptional\u91cc\u7684value\u65f6\u624d\u9700\u8981\u8003\u8651\u503c\u6709\u53ef\u80fd\u4e3anull\uff1f \u4eceOptional\u91cc\u53d6value\u65f6\u4f1a\u7528\u5230get()\u3001orElse()\u7b49\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u8003\u8651\u5230\u4e86null\u7684\u60c5\u51b5\uff0c\u63d0\u9192\u8c03\u7528\u8005\u53bb\u5904\u7406\uff0c\u6bd4\u5982get()\u4e0a\u9762\u7684\u6ce8\u89e3\uff1a  </p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/2-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%20%E5%92%8C%20%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/","title":"2-\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b \u548c \u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u65b9\u5f0f","text":"<p> \u7ea6 2728 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 55 \u5206\u949f</p> <p>\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b \u5728\u7ebf\u7a0b\u6982\u5ff5\u8fd8\u6ca1\u6709\u63d0\u51fa\u6765\u7684\u65f6\u5019\uff0c\u5982\u679c\u60f3\u8981\u5728\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\u7684\u540c\u65f6\u5145\u5206\u5229\u7528cpu\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u53ef\u4ee5\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u65f6\u8fdb\u7a0b\u4e0d\u4ec5\u662f\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u8fd8\u662f\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\u3002 \u4f5c\u4e3a\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u5982\u679c\u662f\u8fd0\u884c\u5728\u5355\u6838cpu\u4e0a\uff0c\u5f53\u67d0\u4e2a\u8fdb\u7a0b\u56e0\u9700\u8981\u7b49\u5f85IO\u5b8c\u6210\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u53ef\u4ee5\u5148\u628a\u5b83\u6302\u8d77\uff0c\u628acpu\u8d44\u6e90\u8ba9\u51fa\u6765\u7ed9\u5176\u5b83\u8fdb\u7a0b\u6267\u884c\uff0c\u4ece\u800c\u5145\u5206\u5229\u7528\u4e86cpu\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u5982\u679c\u662f\u591a\u6838cpu\uff0c\u8fd9\u4e9b\u8fdb\u7a0b\u8fd8\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u3002\u8fd9\u6837\u867d\u7136\u53ef\u4ee5\u5145\u5206\u5229\u7528cpu\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u4f46\u662f\u5728\u5bf9\u8fdb\u7a0b\u8fdb\u884c\u8c03\u5ea6\u65f6\uff0c\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u4ee3\u4ef7\u592a\u5927\u3002 \u4f5c\u4e3a\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u62e5\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4e92\u8865\u5e72\u6270\uff0c\u56e0\u4e3a\u521b\u5efa\u591a\u4e2a\u8fdb\u7a0b\u662f\u4e3a\u5171\u540c\u5b8c\u6210\u540c\u4e00\u4ef6\u4e8b\u60c5\uff0c\u6240\u4ee5\u8fdb\u7a0b\u4e4b\u95f4\u514d\u4e0d\u4e86\u8981\u8fdb\u884c\u4fe1\u606f\u7684\u4ea4\u6d41\uff0c\u8fd9\u65f6\u53ea\u80fd\u4f9d\u9760\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u5b8c\u6210\uff0c\u6bd4\u5982\u9700\u8981\u4f9d\u9760\u4fe1\u53f7\u91cf\u5b8c\u6210\u540c\u6b65\u4e92\u65a5\u3001\u9700\u8981\u4f9d\u9760\u6d88\u606f\u961f\u5217\u6216\u8005\u5171\u4eab\u5185\u5b58\u7b49\u65b9\u5f0f\u5b8c\u6210\u6570\u636e\u7684\u4f20\u9012\u3002\u8fd9\u79cd\u901a\u4fe1\u4e0d\u4ec5\u4ee3\u4ef7\u5927\uff0c\u56e0\u4e3a\u90fd\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u9700\u8981\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u800c\u4e14\u7f16\u7a0b\u6a21\u578b\u8fd8\u6bd4\u8f83\u590d\u6742\uff0c\u8fdc\u6ca1\u6709\u50cf\u7ebf\u7a0b\u76f4\u63a5\u4f9d\u9760\u5171\u4eab\u5730\u5740\u7a7a\u95f4\u90a3\u6837\u6765\u7684\u76f4\u63a5\u65b9\u4fbf\u3002</p> <p>\u6240\u4ee5\u7ebf\u7a0b\u5c31\u88ab\u63d0\u51fa\u6765\u4e86\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u4f5c\u4e3a\u8d44\u6e90\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u8fdb\u7a0b\u5c31\u4e0d\u518d\u88ab\u4f5c\u4e3a\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u53ea\u4f5c\u4e3a\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\uff0c\u5404\u4e2a\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff08\u5982Java\u4e2d\u7684\u5806\u548c\u65b9\u6cd5\u533a\uff09\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u4fdd\u7559\u5c11\u91cf\u81ea\u5df1\u79c1\u6709\u7684\u8d44\u6e90\uff08\u5982Java\u4e2d\u7684\u6808\u548c\u7a0b\u5e8f\u8ba1\u7b97\u5668\uff09\u3002\u7ebf\u7a0b\u5f15\u5165\u4e4b\u540e\uff0c\u53ef\u4ee5\u4f9d\u9760\u591a\u4e2a\u7ebf\u7a0b\u6765\u5408\u4f5c\u5b8c\u6210\u4e4b\u524d\u7528\u591a\u4e2a\u8fdb\u7a0b\u5b8c\u6210\u7684\u5de5\u4f5c\u3002 \u7ebf\u7a0b\u89e3\u51b3\u4e86\u4e4b\u524d\u8fdb\u7a0b\u5207\u6362\u5f00\u9500\u5927\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u5207\u6362\u9700\u8981\u4fdd\u7559\u7684\u6267\u884c\u73b0\u573a\u53ea\u662f\u81ea\u5df1\u62e5\u6709\u7684\u54ea\u4e9b\u5c11\u7559\u7684\u8d44\u6e90\uff0c\u5e76\u4e0d\u9700\u8981\u7ba1\u6574\u4e2a\u8fdb\u7a0b\u3002\u7ebf\u7a0b\u4e4b\u95f4\u534f\u4f5c\u5b8c\u6210\u67d0\u9879\u5de5\u4f5c\u4e5f\u4e0d\u9700\u8981\u50cf\u8fdb\u7a0b\u76f4\u63a5\u901a\u4fe1\u90a3\u4e48\u9ebb\u70e6\u4e86\uff0c\u76f4\u63a5\u4f9d\u9760\u5171\u4eab\u7684\u5730\u5740\u7a7a\u95f4\u5373\u53ef\u3002</p> <p>\u5f15\u5165\u7ebf\u7a0b\u4e4b\u540e\uff0c\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6709\uff1a 1.\u5185\u6838\u7ebf\u7a0b\u5b9e\u73b0\uff0c\u4e5f\u79f01:1\u5b9e\u73b0 \u4e00\u4e2aLWP\uff08light wight Process\uff0c\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u7ebf\u7a0b\uff0c\u5e7f\u4e49\u4e0a\u5c5e\u4e8e\u7528\u6237\u7ebf\u7a0b\uff09\u6620\u5c04\u5230\u4e00\u4e2aKLT\uff08Kernel-Level Thread\uff0c\u5185\u6838\u7ebf\u7a0b\uff09\u3002\u56e0\u4e3a\u9700\u8981\u4f9d\u9760\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6\u5185\u6838\u7ebf\u7a0b\u6267\u884c\uff0c\u6240\u4ee5\u6b64\u79cd\u65b9\u5f0f\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u652f\u6301\uff0c\u4e5f\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u8981\u6709\u5185\u6838\u7ebf\u7a0b\u3002LWP\u662fKLT\u7684\u4e00\u79cd\u9ad8\u7ea7\u63a5\u53e3\uff0c\u6240\u4ee5\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301KLT\u624d\u80fd\u5728\u7528\u6237\u8fdb\u7a0b\u5185\u521b\u5efaLWP\u3002  2.\u7528\u6237\u7ebf\u7a0b\u5b9e\u73b0\uff0c\u4e5f\u79f0N:1\u5b9e\u73b0 \u6b64\u79cd\u65b9\u5f0f\u4e0b\u5185\u6838\u611f\u77e5\u4e0d\u5230\u7528\u6237\u7ebf\u7a0b\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u4e5f\u5c31\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u6709\u5185\u6838\u7ebf\u7a0b\uff0c\u4e8e\u662f\u4e5f\u5c31\u6ca1\u6709\u5c06\u7528\u6237\u8fdb\u7a0b\u6620\u5c04\u5230\u5185\u6838\u7ebf\u7a0b\u4e0a\u7684\u8bf4\u6cd5\uff0c\u8fd9\u79cd\u7ebf\u7a0b\u5b9e\u73b0\u65b9\u5f0f\u53ea\u9700\u8981\u51fd\u6570\u5e93\u652f\u6301\u5c31\u884c\uff0c\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u652f\u6301\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u4e0d\u652f\u6301\u7ebf\u7a0b\u53ea\u652f\u6301\u8fdb\u7a0b\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u4e5f\u80fd\u5b9e\u73b0\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6240\u4ee5\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u79f0\u4e3a\u7528\u6237\u7ebf\u7a0b\u3002 \u4ece\u64cd\u4f5c\u7cfb\u7edf\u6765\u770b\u8fd9\u548c\u6ca1\u6709\u5f15\u5165\u7ebf\u7a0b\u53ea\u6709\u8fdb\u7a0b\u65f6\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u64cd\u4f5c\u4ecd\u7136\u76f4\u63a5\u4ee5\u8fdb\u7a0b\u4e3a\u5355\u4f4d\u8fdb\u884c\u8c03\u5ea6\uff0c\u7528\u6237\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u8c03\u5ea6\u548c\u9500\u6bc1\u5b8c\u5168\u5728\u7528\u6237\u6001\u5b8c\u6210\uff0c\u53ef\u4ee5\u5728\u7528\u6237\u8fdb\u7a0b\u4e2d\u521b\u5efa\u591a\u4e2aUT\uff08User Thread\uff09\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u662f\u591a\u7ebf\u7a0b\u4e86\uff0c\u867d\u7136\u8fd9\u79cd\u65b9\u5f0f\u521b\u5efa\u7ebf\u7a0b\u62e5\u6709\u7ebf\u7a0b\u7684\u7279\u70b9\u548c\u4f18\u70b9\uff0c\u4f46\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e0d\u80fd\u771f\u6b63\u5e76\u884c\u6267\u884c\uff0c\u4e0d\u8fc7\u8fd9\u8fd8\u662f\u8981\u6bd4\u6ca1\u6709\u7ebf\u7a0b\u7684\u5355\u4e2a\u8fdb\u7a0b\u8981\u597d~~\uff0c\u56e0\u4e3a\u67d0\u4e2a\u7ebf\u7a0b\u56e0IO\u963b\u585e\u4e86\uff0c\u8fdb\u7a0b\u53ef\u4ee5\u8c03\u5ea6\u5176\u5b83\u7ebf\u7a0b\u6267\u884c~~\u3002\u5176\u5b9e\u7528\u6237\u7ebf\u7a0b\u5b9e\u73b0\u65b9\u5f0f\u8981\u6bd4\u5185\u6838\u7ebf\u7a0b\u5b9e\u73b0\u65b9\u5f0f\u5728\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u9500\u6bc1\u3001\u540c\u6b65\u3001\u8c03\u5ea6\u65b9\u9762\u7684\u5f00\u9500\u66f4\u5c0f\uff0c\u56e0\u4e3a\u7528\u6237\u7ebf\u7a0b\u7684\u8fd9\u4e9b\u64cd\u4f5c\u5b8c\u5168\u5728\u7528\u6237\u6001\u4e2d\u5b8c\u6210\uff0c\u800c\u5185\u6838\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u9500\u6bc1\u3001\u540c\u6b65\u9700\u8981\u7cfb\u7edf\u8c03\u7528\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u5728\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u4e4b\u95f4\u6765\u56de\u5207\u6362\u3002 \u6ce8\u610f\uff0c\u4e00\u5b9a\u8981\u4ece\u64cd\u4f5c\u7cfb\u7edf\u7684\u53d1\u5c55\u6765\u770b\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e\u7528\u6237\u7ebf\u7a0b\u800c\u8a00\uff0c\u4e0d\u5fc5\u4fee\u6539\u7ebf\u7a0b\u6ca1\u6709\u51fa\u73b0\u524d\u53ea\u652f\u6301\u8fdb\u7a0b\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u4e5f\u53ef\u5b9e\u73b0\uff1b\u800c\u5bf9\u4e8e\u5185\u6838\u7ebf\u7a0b\u800c\u8a00\uff0c\u4e3a\u4e86\u652f\u6301\u591a\u7ebf\u7a0b\u5728\u591a\u6838cpu\u4e0a\u5e76\u884c\uff0c\u5fc5\u987b\u4fee\u6539\u539f\u6765\u53ea\u652f\u6301\u8fdb\u7a0b\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u624d\u80fd\u5b9e\u73b0\u3002  3.\u6df7\u5408\u5b9e\u73b0\uff0c\u4e5f\u79f0\uff2e:M\u5b9e\u73b0 \u65e2\u6709UT\uff0c\u53c8\u6709LWP\uff0c\u8fd8\u6709KLT </p> <p>\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u7684\u5b9e\u73b0\u65b9\u5f0f\u51b3\u5b9a\u7740\u7528\u6237\u7ebf\u7a0b\u5982\u4f55\u5e76\u53d1\uff0c\u6bd4\u59821:1\u5b9e\u73b0\u548c\u6df7\u5408\u5b9e\u73b0\u90fd\u80fd\u505a\u5230\u540c\u4e00\u8fdb\u7a0b\u5185\u7684\u7ebf\u7a0b\u5728\u5904\u7406\u5668\u4e0a\u5e76\u884c\u6267\u884c\uff0c\u800c\u7528\u6237\u7ebf\u7a0b\u7684\u5b9e\u73b0\u4e0d\u80fd\u505a\u5230\u3002\u4e0d\u8fc7\uff0c\u65e0\u8bba\u7ebf\u7a0b\u662f\u5355\u6838\u4e0a\u7684\u5e76\u53d1\uff0c\u8fd8\u662f\u591a\u6838\u4e0a\u7684\u5e76\u884c\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6267\u884c\u90fd\u662f\u5f02\u6b65\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u65e0\u6cd5\u9884\u77e5\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\uff0c\u6240\u4ee5\u90fd\u9700\u8981\u540c\u6b65\u673a\u5236\u5b9e\u73b0 \u7ebf\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u4e92\u65a5\u8bbf\u95ee \u6216\u8005\u662f \u7ebf\u7a0b\u4e4b\u95f4\u5148\u540e\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u90fd\u9700\u8981\u9760\u52a0\u9501\u6765\u5b9e\u73b0\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\uff0c\u4e8e\u662f\u4e4e\u65e0\u8bba\u54ea\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6765\u8bf4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u662f\u5728\u5b9e\u9645\u8fd0\u884c\u65f6\u7684\u5e76\u53d1\u89c4\u6a21\u548c\u8fd0\u884c\u6548\u7387\u4e0a\u6709\u5dee\u5f02\u800c\u5df2\u3002</p> <p>\u4ece\u8fdb\u7a0b\u5230\u7ebf\u7a0b\u7684\u53d1\u5c55\u6765\u770b\uff1a 1.\u5373\u4f7f\u6ca1\u6709\u5f15\u5165\u7ebf\u7a0b\u53ea\u4f9d\u9760\u8fdb\u7a0b\u4e5f\u53ef\u4ee5\u5e76\u53d1\uff0c\u53ea\u4e0d\u8fc7\u662f\u8fdb\u7a0b\u76f8\u6bd4\u4e8e\u7ebf\u7a0b\u8c03\u5ea6\u5f00\u9500\u66f4\u5927\uff0c\u5bf9\u7528\u6237\u800c\u8a00\uff0c\u7f16\u7a0b\u6a21\u578b\u66f4\u52a0\u590d\u6742\u4e00\u70b9\u3002 \u6bd4\u5982\u4f9d\u7136\u53ef\u4ee5\u5229\u7528Linux\u7684\u7cfb\u7edf\u8c03\u7528fork()\u521b\u5efa\u591a\u4e2a\u5b50\u8fdb\u7a0b\u5b8c\u6210\u5e76\u53d1\uff0c\u4f7f\u7528\u7ba1\u9053\u7b49\u901a\u4fe1\u65b9\u5f0f\u5b8c\u6210\u8fdb\u7a0b\u7684\u540c\u6b65\u4ee5\u53ca\u6570\u636e\u7684\u4f20\u9012\u3002 \u518d\u6bd4\u5982python\u4e5f\u53ef\u4ee5\u521b\u5efa\u8fdb\u7a0b\uff0c\u4f7f\u7528\u591a\u4e2a\u8fdb\u7a0b\u5b8c\u6210\u5e76\u53d1\u3002\u8fd8\u6bd4\u5982PHP\u4e2d\u4e5f\u662f\u5229\u7528\u591a\u8fdb\u7a0b\u5b8c\u6210\u5e76\u53d1\u3002</p> <p>2.\u5728\u5f15\u5165\u7ebf\u7a0b\u4e4b\u540e\uff0c\u5373\u4f7f\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u652f\u6301\u7ebf\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u7531\u51fd\u6570\u5e93\u652f\u6301\u5b9e\u73b0\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u79f0\u4e3a\u7528\u6237\u7ebf\u7a0b\u3002 \u6bd4\u5982\u65e9\u671f\u7684Linux\uff0c\u5728\u6ca1\u6709\u5411\u5185\u6838\u4e2d\u5f15\u5165\u5185\u6838\u7ebf\u7a0b\u65f6\uff0c\u5c31\u662f\u4f7f\u7528\u51fd\u6570\u5e93\u7684\u652f\u6301\u5411\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u4e86\u7ebf\u7a0b\u3002 \u518d\u6bd4\u5982python\u7684\u591a\u7ebf\u7a0b\uff0c\u5b8c\u5168\u5c31\u662f\u7528\u6237\u7ebf\u7a0b\u7684\u5b9e\u73b0\uff08\u8fc7\u7a0b\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff0c\u5982\u679cpython\u8fd0\u884c\u57281:1\u5b9e\u73b0\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u90a3\u4e48python\u865a\u62df\u673a\u4f1a\u5c06python\u7a0b\u5e8f\u4e2d\u6240\u6709\u521b\u5efa\u7684\u7ebf\u7a0b\u653e\u5230\u4e00\u4e2aLWP\u4e2d\u6267\u884c\uff0c\u53c8\u56e0\u4e3a\u4e00\u4e2a\u7528\u6237\u6001\u7684LWP\u4f1a\u6620\u5c04\u4e00\u4e2a\u5185\u6838\u6001\u7684KLT\u4e0a\uff0c\u6240\u4ee5\u6240\u6709\u5728python\u4e2d\u521b\u5efa\u7684\u7ebf\u7a0b\u4e0d\u53ef\u80fd\u505a\u5230\u5e76\u884c\u6267\u884c\uff0c\u53ea\u80fd\u50cf\u5728\u5355\u6838cpu\u4e0a\u8f6e\u8f6c\u6267\u884c\uff09\u3002</p> <p>\u73b0\u5728\u7684Linux\u7684\u7ebf\u7a0b\u5b9e\u73b0\u65b9\u5f0f\u662f1:1\uff08\u6709\u4e9b\u5546\u4e1a\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u662f\u6df7\u5408\u5b9e\u73b0\uff09\uff0cJava\u4e5f\u662f\u91c7\u75281:1\u5b9e\u73b0\u3002 Java\u5e76\u4e0d\u652f\u6301\u591a\u8fdb\u7a0b\u5e76\u53d1\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u5728\u4e00\u4e2aJava\u8fdb\u7a0b\u4e2d\u521b\u5efa\u53e6\u4e00\u4e2aJava\u8fdb\u7a0b\uff0c\u53ea\u80fd\u5728Java\u8fdb\u7a0b\u4e2d\u521b\u5efa\u7ebf\u7a0b\u3002Java\u91cd\u65b0\u89c4\u5b9a\u4e86\u8fd0\u884c\u5728\u8fdb\u7a0b\u5185\u90e8\u7684\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u5e76\u4e0d\u9075\u4ece\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u7ebf\u7a0b\u72b6\u6001\u7684\u5b9a\u4e49\uff0c\u6240\u4ee5\u4e5f\u5c31\u4f1a\u51fa\u73b0\u5373\u4f7f\u64cd\u4f5c\u7cfb\u7edf\u5c06\u67d0\u4e2aJava\u7ebf\u7a0b\u6302\u8d77\u4e86\uff0c\u4f46\u662f\u5bf9\u4e8eJava\u800c\u8a00\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u72b6\u6001\u8fd8\u662fRunnable\u7684\u60c5\u51b5\uff0c\u8fd9\u4e5f\u662fJava\u5411\u7528\u6237\u63d0\u4f9b\u7edf\u4e00\u7f16\u7a0b\u601d\u60f3\u7684\u4f53\u73b0\u3002</p> <p>\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u65b9\u5f0fIPC (Inter-Process Communication) \u56e0\u4e3a\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u662f\u9694\u79bb\u7684\uff0c\u6240\u4ee5\u4e0d\u80fd\u50cf\u7ebf\u7a0b\u90a3\u6837\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u5171\u4eab\u8d44\u6e90\u90a3\u6837\u5b8c\u6210\u901a\u4fe1\uff0c\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u5fc5\u987b\u8981\u64cd\u4f5c\u7cfb\u7edf\u6765\u5e2e\u5fd9\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u7cfb\u7edf\u8c03\u7528\uff0c\u6240\u4ee5\u8fdb\u7a0b\u901a\u4fe1\u65f6\u9700\u8981\u5728\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u4e4b\u95f4\u5207\u6362\uff0c\u81f3\u4e8e\u901a\u4fe1\u7684\u6570\u636e\u9700\u4e0d\u9700\u8981\u4ece\u7528\u6237\u6001\u590d\u5236\u5230\u5185\u6838\u6001\u7136\u540e\u518d\u590d\u5236\u5230\u7528\u6237\u6001\uff0c\u8fd9\u4e2a\u6211\u89c9\u5f97\u5e94\u8be5\u89c6\u5177\u4f53\u7684\u901a\u4fe1\u65b9\u5f0f\u800c\u5b9a\uff0c\u5bf9\u4e8e\u5355\u673a\u5185\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u53ef\u80fd\u64cd\u4f5c\u7cfb\u7edf\u7684\u67d0\u4e9b\u901a\u4fe1\u65b9\u5f0f\u5e76\u4e0d\u9700\u8981\u8fd9\u6837\u6765\u56de\u62f7\u8d1d\u6570\u636e\uff08\u6211\u8ba4\u4e3a\u5355\u673a\u5185\u8fdb\u7a0b\u95f4\u7684\u6570\u636e\u4ea4\u6362\u90fd\u9700\u8981\u7ecf\u8fc7\u5185\u6838\u7f13\u51b2\u533a\uff0c\u4e0d\u8fc7\u4e0d\u9700\u8981\u6765\u56de\u590d\u5236\uff0c\u901a\u8fc7mmap\u53ef\u4ee5\u9ad8\u6548\u7684\u89e3\u51b3\uff09\uff0c\u4f46\u5bf9\u4e8e\u4e0d\u540c\u4e3b\u673a\u4e4b\u95f4\u7684\u8fdb\u7a0b\u7684\u8de8\u7f51\u7edc\u901a\u4fe1\uff0c\u53ef\u4ee5\u80af\u5b9a\u7684\u662f\u9700\u8981\u5728\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u4e4b\u95f4\u6765\u56de\u62f7\u8d1d\u6570\u636e\uff0c\u56e0\u4e3a\u8de8\u7f51\u7edc\u901a\u4fe1\u5c5e\u4e8eIO\uff0c\u5fc5\u987b\u7ecf\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\uff08\u5728\u63a5\u6536\u65b9\u53ef\u4ee5mmap\uff09\u3002</p> <p>Linux\u7684IPC\u65b9\u5f0f\uff1a 1.\u4fe1\u53f7 \u5728Linux \u4e2d\u4fe1\u53f7\u53d1\u9001\u548c\u6355\u83b7\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u662f\u4e00\u79cd\u5728\u65e9\u671funix\u7cfb\u7edf\u91cc\u9762\u5c31\u5b58\u5728\u7684\u901a\u4fe1\u65b9\u5f0f\uff0cshell\u547d\u4ee4kill -9\u5c31\u662f\u5728\u5411\u8fdb\u7a0b\u53d1\u9001\u7ed3\u675f\u7684\u4fe1\u53f7\u3002 2.\u7ba1\u9053 \u65e0\u540d\u7ba1\u9053\u4ec5\u7528\u4e8e\u7236\u5b50\u8fdb\u7a0b\u6216\u5144\u5f1f\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u9012\u3002\u65e9\u671funix\u7684\u65e0\u540d\u7ba1\u9053\u53ea\u652f\u6301\u534a\u53cc\u5de5\u65b9\u5f0f\uff0c\u4f46\u662f\u73b0\u4ee3unix\u652f\u6301\u5168\u53cc\u5de5\u65b9\u5f0f\u4e86\u3002 \u6709\u540d\u7ba1\u9053\u4e5f\u79f0FIFO\u7ba1\u9053\uff0c\u6709\u540d\u7ba1\u9053\u548c\u65e0\u540d\u7ba1\u9053\u672c\u8d28\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u6709\u540d\u7ba1\u9053\u4f1a\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u751f\u6210\u4e00\u4e2a\u76ee\u5f55\u9879\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u5141\u8bb8\u4e0e\u5176\u5b83\u4e0d\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u7684\u8fdb\u7a0b\u8fdb\u884c\u901a\u4fe1\u4e86\u3002 3.\u6d88\u606f\u961f\u5217 4.\u5171\u4eab\u5b58\u50a8\u533a 5.\u4fe1\u53f7\u91cf 6.\u5957\u63a5\u5b57 \u5957\u63a5\u5b57\u75313\u4e2a\u5c5e\u6027\u786e\u5b9a\uff1a\u57df\u3001\u7aef\u53e3\u53f7\u3001\u534f\u8bae\u7c7b\u578b \u5957\u63a5\u5b57\u6709\u4e24\u79cd\u57df\uff1a \u4e00\u4e2a\u57df\u662fAF_INET\uff0c\u6307\u7684\u662fInternet\u7f51\u7edc\uff0c\u7528\u4e8e\u8de8\u7f51\u7edc\u901a\u4fe1\uff1b\u53e6\u4e00\u4e2a\u57df\u662fAF_UNIX\uff0c\u8868\u793aUNIX\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u4e8e\u672c\u673a\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u6bd4\u4f7f\u7528\u7f51\u7edc\u5957\u63a5\u5b57\u66f4\u52a0\u9ad8\u6548\u3002\u4e5f\u5c31\u662f\u8bf4\u5957\u63a5\u5b57\u7ed9\u4e86\u7f51\u7edc\u901a\u4fe1\u548c\u672c\u5730\u901a\u4fe1\u4e00\u4e2a\u7edf\u4e00\u7684\u6a21\u578b\u3002</p> <p>\u5957\u63a5\u5b57\u67093\u79cd\u534f\u8bae\u7c7b\u578b\uff1a \u4e00\u662f\u6d41\u5957\u63a5\u5b57\uff0c\u5728\u57df\u4e2d\u901a\u8fc7TCP/IP\u8fde\u63a5\u5b9e\u73b0\u3002 \u4e8c\u662f\u6570\u636e\u62a5\u5957\u63a5\u5b57\uff0c\u5728\u57df\u4e2d\u901a\u5e38\u662f\u901a\u8fc7UDP/IP\u534f\u8bae\u5b9e\u73b0\u7684\u3002 \u4e09\u662f\u539f\u59cb\u5957\u63a5\u5b57\uff0c\u539f\u59cb\u5957\u63a5\u5b57\u5141\u8bb8\u5bf9\u8f83\u4f4e\u5c42\u6b21\u7684\u534f\u8bae\u76f4\u63a5\u8bbf\u95ee\uff0c\u6bd4\u5982IP\u3001 ICMP\u534f\u8bae\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u53d1\u9001\u4e00\u4e9b\u81ea\u5b9a\u5305\u5934\u6216\u81ea\u5b9a\u534f\u8bae\u7684IP\u5305\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/3-BIO%E4%B9%8B%E7%BD%91%E7%BB%9CIO/","title":"3-BIO\u4e4b\u7f51\u7edcIO","text":"<p> \u7ea6 1001 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>\u78c1\u76d8IO\u90fd\u662f\u963b\u585eIO\uff0c\u672c\u8282\u4e3b\u8981\u8bb2\u7684\u662f\u963b\u585e\u5f0f\u7f51\u7edcIO\u7684\u5b9e\u73b0\u65b9\u5f0f Socket\u7f16\u7a0b\u62bd\u8c61\uff1a socket\u5728JDK\u4e2d\u88ab\u62bd\u8c61\u6210\u4e86\u4e00\u79cd\u6587\u4ef6\uff0c\u5728Linux\u91cc\u9762socket\u4e5f\u662f\u88ab\u62bd\u8c61\u6210\u6587\u4ef6\uff0c\u5f53socket\u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u5c31\u76f8\u5f53\u4e8e\u65b0\u5efa\u4e86\u4e00\u4e2a\u6587\u4ef6\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u901a\u8fc7\u6587\u4ef6\u6d41\u7684\u65b9\u5f0f\u8bfb\u5199socket\u91cc\u9762\u7684\u6570\u636e\u4ece\u800c\u5b8c\u6210\u901a\u4fe1\u3002 </p> <p>BIO\uff1aBlocking IO \u963b\u585e\u5f0fIO \u4f7f\u7528BIO\u7684\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u7684\u4f20\u8f93\uff0c\u6bcf\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u90fd\u4f1a\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u6765\u5904\u7406\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4ee5\u540c\u6b65\u963b\u585e\u5f0fIO\u7684\u65b9\u5f0f\u8fdb\u884c\u901a\u4fe1\uff0c\u4ee3\u7801\u5982\u4e0b\u3002 \u670d\u52a1\u7aef\uff1a Text Only<pre><code>public class Server {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServerSocket ss = new ServerSocket(9999);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0/**\n\u00a0\u00a0 \u00a0\u00a0 \u00a0 \u00a0\u00a0\u00a0\u00a0 \u00a0* main\u7ebf\u7a0b\u5728\u8fd9\u91cc\u4f1a\u963b\u585e\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff0c\u4f46\u662f\u6b64\u65f6\u7ebf\u7a0b\u7684\u72b6\u6001\u5728jvisualvm\u4e2d\u770b\u5230\u7684\u662f\u8fd0\u884cRunnable\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u5bf9\u4e8e\u8fd9\u4e2a\u73b0\u8c61\u6211\u662f\u8fd9\u6837\u8ba4\u4e3a\u7684\uff0cJava\u7ebf\u7a0b\u5b9e\u73b0\u7684\u65b9\u5f0f\u662f\u4e00\u5bf9\u4e00\uff0c\u5373\u4e00\u4e2aJava\u7ebf\u7a0b\u5bf9\u5e94\u4e8e\u4e00\u4e2acpu\u7ebf\u7a0b\uff0c\u8fd9\u91ccmain\u7ebf\u7a0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u786e\u5b9e\u662f\u5728\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u662f\u963b\u585e\u4e86\uff0c\u4f46\u662fJava\u5c42\u9762\u8ba4\u4e3a\u6ca1\u6709\u963b\u585e\uff0c\u56e0\u4e3aJava\u4e2d\u89c4\u5b9a\u7684\u662f\u53ea\u6709\u7ebf\u7a0b\u5728\u7ade\u4e89synchronized\u9501\u5931\u8d25\u624d\u4f1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u8fd9\u662fJava\u5bf9\u7ebf\u7a0b\u72b6\u6001\u7684\u4e00\u6b21\u5305\u88c5\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Socket socket = ss.accept();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u4f7f\u7528lambda\u8868\u8fbe\u5f0f\uff0csocket\u5c31\u88ab\u95ed\u5305\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u5982\u679c\u4e0d\u4f7f\u7528lambda\u8868\u8fbe\u5f0f\uff0c\u5c31\u9700\u8981\u5199\u4e00\u4e2a\u5b9e\u73b0Runnable\u63a5\u53e3\u7684\u7c7b\uff0c\u5c06socket\u901a\u8fc7\u6784\u9020\u5668\u4f20\u8fdb\u53bb\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u7136\u540e\u6bcf\u6b21new\u8fd9\u4e2a\u7c7b\u7684\u5bf9\u8c61\uff0c\u518d\u628a\u8fd9\u4e2a\u5bf9\u8c61\u4f20\u7ed9Thread\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while ((line = bufferedReader.readLine()) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u670d\u52a1\u7aef\u6536\u5230\uff1a\" + line);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5ba2\u6237\u7aef\uff1a Text Only<pre><code>public class Client {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Socket socket = new Socket(\"localhost\", 9999);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintStream printStream = new PrintStream(socket.getOutputStream());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Scanner scanner = new Scanner(System.in);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.print(\"\u5ba2\u6237\u7aef\u53d1\u9001\uff1a\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = scanner.nextLine();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printStream.println(line);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8fd9\u79cd\u901a\u4fe1\u65b9\u5f0f\u7684\u597d\u5904\u662f\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6d88\u606f\u670d\u52a1\u7aef\u53ef\u4ee5\u53ca\u65f6\u6536\u5230\uff0c\u56e0\u4e3a\u662f\u963b\u585e\u5f0f\u7684\u540c\u6b65\u7b49\u5f85\u3002\u4f46\u574f\u5904\u4e5f\u5f88\u660e\u663e\uff0c\u5982\u679c\u6709\u5927\u91cf\u8fde\u63a5\u540c\u65f6\u5b58\u5728\u5c31\u4f1a\u65b0\u5efa\u5927\u91cf\u7684\u7ebf\u7a0b\uff0c\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u9700\u8981\u4fdd\u5b58\u81ea\u5df1\u8fd0\u884c\u65f6\u7684\u4fe1\u606f\uff0c\u79ef\u5c11\u6210\u591a\uff0c\u76f4\u63a5\u5bfc\u81f4\u6808\u5185\u5b58OOM\u3002\uff08~~\u8fd9\u91cc\u6ca1\u8bf4\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u6808\uff0c\u662f\u56e0\u4e3a\u6211\u89c9\u5f97\u6808\u662f\u7ebf\u7a0b\u8fd0\u884c\u65f6\u624d\u4f1a\u5206\u914d\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7ebf\u7a0b\u5931\u53bbcpu\u65f6\u95f4\u7247\u540e\u5c31\u6ca1\u6709\u8be5\u7ebf\u7a0b\u7684\u6808\u4e86\uff0c\u800c\u662f\u5c06\u81ea\u5df1\u8fd0\u884c\u65f6\u7684\u4fe1\u606f\u4fdd\u5b58\u4e0b\u6765\uff0c\u7b49\u5f85\u4e0b\u6b21\u88ab\u8c03\u5ea6\u6267\u884c\u65f6\u518d\u6062\u590d\u6267\u884c\u73b0\u573a\uff0c\u8fd9\u5c31\u662f\u4e0a\u4e0b\u6587\u5207\u6362\u3002~~\uff09</p> <p>\u4f7f\u7528\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u63a7\u5236\u7ebf\u7a0b\u7684\u6570\u91cf\u907f\u514d\u6808\u5185\u5b58OOM\uff0c\u8fd8\u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u5f00\u9500\uff08\u7ebf\u7a0b\u6c60\u6ca1\u6709\u51cf\u5c11\u8c03\u5ea6\u7ebf\u7a0b\u65f6\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u7b49\u5f00\u9500\uff09\u3002\u5f53\u4efb\u52a1\u5728\u963b\u585e\u961f\u5217\u4e2d\uff0c\u8fd8\u6ca1\u6709\u88ab\u653e\u5728\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\u65f6\u5019\uff0c\u670d\u52a1\u5668\u5c31\u4e0d\u80fd\u53ca\u65f6\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6d88\u606f\uff0c\u8fd9\u662f\u5f02\u6b65IO\u7684\u6548\u679c\uff0c\u6240\u4ee5\u8bf4\u9760\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u7684IO\u662f\u4e00\u79cd\u4f2a\u5f02\u6b65IO\u3002 \u4e3a\u4ec0\u4e48\u53ef\u4ee5\u6709\u8fd9\u79cd\u5f02\u6b65\u7684\u6548\u679c\u5462\uff1f \u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7a7a\u95f4\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\u6570\u636e\uff0c\u53ea\u662f\u7ebf\u7a0b\u6ca1\u6709\u88ab\u8c03\u5ea6\uff0c\u5bfc\u81f4\u5e94\u7528\u8fdb\u7a0b\u4e0d\u80fd\u4ece\u5185\u6838\u7a7a\u95f4\u4e2d\u8bfb\u53d6\u6570\u636e\u3002</p> <p>\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684BIO\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\u7684\u670d\u52a1\u5668\u7aef\u4ee3\u7801\u5982\u4e0b\uff0c\u5f53\u4efb\u52a1\u8fd8\u5728\u963b\u585e\u961f\u5217\u4e2d\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u88ab\u653e\u5230\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\u65f6\u5019\uff0c\u610f\u5473\u7740\u4e0d\u80fd\u4ecesocket\u4e2d\u8bfb\u6570\u636e\uff0c\u4f46\u5b9e\u9645\u4e0a\u670d\u52a1\u5668\u7aef\u7684socket\u7684\u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\uff1a Text Only<pre><code>public class Server {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServerSocket ss = new ServerSocket(9999);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 3, 10, TimeUnit.SECONDS,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new ArrayBlockingQueue&lt;Runnable&gt;(2), Executors.defaultThreadFactory(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(r, executor) -&gt; System.out.println(r.toString() + \"is discard\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Socket socket = ss.accept();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while ((line = bufferedReader.readLine()) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u670d\u52a1\u7aef\u6536\u5230\uff1a\" + line);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0pool.execute(task);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/4-NIO%E4%B9%8B%E7%BC%93%E5%86%B2%E5%8C%BA%E5%92%8C%E9%80%9A%E9%81%93/","title":"4-NIO\u4e4b\u7f13\u51b2\u533a\u548c\u901a\u9053","text":"<p> \u7ea6 1850 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 37 \u5206\u949f</p> <p>JDK1.4\u5f15\u5165\u7684NIO\uff0c\u662fNew IO\u6216\u8005Non-blocking IO\u7684\u7f29\u5199\uff0c\u4e0eBIO\u57fa\u4e8e\u6587\u4ef6\u6d41\u7684\u7f16\u7a0b\u601d\u60f3\u4e0d\u540c\uff0cNIO\u5f15\u5165\u4e86\u4e00\u5957\u65b0\u7684IO\u7f16\u7a0b\u6a21\u578b\u6216\u8005\u8bf4\u662f\u7f16\u7a0b\u601d\u60f3\uff0c\u8fd9\u5957\u7f16\u7a0b\u6a21\u578b\u57fa\u4e8e\u4e09\u4e2a\u57fa\u672c\u7ec4\u4ef6\uff1a\u901a\u9053\u3001\u7f13\u51b2\u533a\u3001\u9009\u62e9\u5668\u3002 \u6211\u89c9\u5f97NIO\u66f4\u51c6\u786e\u5e94\u8be5\u662fNew IO\u7684\u7f29\u5199\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u672c\u5730\u6587\u4ef6\u8bfb\u5199\u5e76\u6ca1\u6709\u975e\u963b\u585e\uff0c\u975e\u963b\u585e\u662f\u9488\u5bf9\u7f51\u7edcIO\u7684\u800c\u8a00\u7684\uff0c\u53ea\u6709\u7f51\u7edcIO\u624d\u80fd\u4f7f\u7528\u4e0a\u9009\u62e9\u5668\uff0c\u9009\u62e9\u5668\u662f\u7528\u6765\u76d1\u542c\u7f51\u7edcIO\u4e8b\u4ef6\u7684\uff0c\u662f\u5b9e\u73b0\u975e\u963b\u585eIO\u7684\u5173\u952e\u3002 Java\u7a0b\u5e8f\u5458\u662f\u5e78\u798f\u7684\uff0cJDK\u603b\u662f\u5c4f\u853d\u5e95\u5c42\u7684\u5dee\u5f02\uff0c\u5c01\u88c5\u6210\u7edf\u4e00\u7684\u7f16\u7a0b\u6a21\u578b\u4f9b\u7a0b\u5e8f\u5458\u4f7f\u7528\uff0cNIO\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\uff0cNIO\u7684\u5e95\u5c42\u5b9e\u73b0\u5728Windows\u4e0eLinux\u4e2d\u80af\u5b9a\u4e0d\u540c\uff0cLinux\u4e2d\u7684\u5b9e\u73b0\u53ef\u80fd\u662f\u57fa\u4e8eselect\u3001poll\u6216\u8005\u662fepoll\u5b9e\u73b0\uff0c\u4f46\u662f\u5728Java\u4e2d\u4f7f\u7528NIO\u63d0\u4f9b\u7684API\u65f6\u5b8c\u5168\u4e0d\u7528\u5173\u5fc3\u5e95\u5c42\u7684\u5177\u4f53\u7ec6\u8282\uff0c\u53ea\u9700\u4e86\u89e3Java\u4e3a\u6211\u4eec\u5c01\u88c5\u597d\u7684\u6a21\u578b\u548c\u7f16\u7a0b\u5b9e\u73b0\u5373\u53ef\u3002</p> <p>\u901a\u9053\uff08Channel\uff09\u548c\u7f13\u51b2\u533a\uff08Buffer\uff09 \u901a\u9053\uff1a\u901a\u9053\u8868\u793a\u6253\u5f00\u5230\u6587\u4ef6\u7684\u8fde\u63a5\uff0cIO\u8bbe\u5907\u548c\u5957\u63a5\u5b57\u90fd\u53ef\u770b\u4f5c\u662f\u6587\u4ef6\uff0c\u901a\u9053\u662f\u53cc\u5411\u7684\uff0c\u800cBIO\u7684\u6587\u4ef6\u6d41\u662f\u5355\u5411\u7684\u3002 \u7f13\u51b2\u533a\uff1a\u5b58\u50a8\u7279\u5b9a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u5bb9\u5668\uff0c\u6240\u6709\u7f13\u51b2\u533a\u90fd\u662f\u62bd\u8c61\u7c7b java.nio.Buffer \u7684\u5b50\u7c7b\uff0c\u901a\u9053\u53ea\u80fd\u4e0e\u7f13\u51b2\u533a\u8fdb\u884c\u4ea4\u4e92\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6570\u636e\u662f\u4ece\u901a\u9053\u8bfb\u5165\u7f13\u51b2\u533a\uff0c\u4ece\u7f13\u51b2\u533a\u5199\u5165\u901a\u9053\u4e2d\u7684\u3002 </p> <p>\u7f13\u51b2\u533a\uff08Buffer\uff09 Buffer\u7684\u5b50\u7c7b\uff1a</p> <ul> <li>ByteBuffer</li> <li>CharBuffer</li> <li>ShortBuffer</li> <li>IntBuffer</li> <li>LongBuffer</li> <li>FloatBuffer</li> <li>DoubleBuffer</li> </ul> <p>Buffer\u7684\u91cd\u8981\u6982\u5ff5\uff1a</p> <ul> <li>\u5bb9\u91cf (capacity) \uff1a\u8868\u793aBuffer\u7684\u6700\u5927\u6570\u636e\u5bb9\u91cf\uff0c\u4e0d\u80fd\u4e3a\u8d1f\uff0c\u521b\u5efa\u540e\u4e0d\u80fd\u66f4\u6539\u3002</li> <li>\u9650\u5236 (limit)\uff1a\u5199\u7684\u65f6\u5019\u6307\u5411\u6700\u540e\u4e00\u4e2a\u53ef\u5199\u5165\u7684\u4f4d\u7f6e\uff0c\u8bfb\u7684\u65f6\u5019\u6307\u5411\u6700\u540e\u4e00\u4e2a\u4e0d\u80fd\u8bfb\u7684\u4f4d\u7f6e\u3002</li> <li>\u4f4d\u7f6e (position)\uff1a\u4e0b\u4e00\u4e2a\u8981\u8bfb\u53d6\u6216\u5199\u5165\u7684\u4f4d\u7f6e</li> </ul> <p> \u62bd\u8c61\u7c7bBuffer\u4e2d\u5e38\u7528\u7684\u65b9\u6cd5\uff1a </p> <p>Buffer\u7684\u5b50\u7c7b\u5404\u81ea\u90fd\u63d0\u4f9b\u4e86get()\u65b9\u6cd5\u548cput()\u65b9\u6cd5\u7528\u4e8e\u64cd\u4f5c\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\uff0c\u4ee5ByteBuffer\u4e3a\u4f8b\uff1a</p> <ul> <li>\u83b7\u53d6 Buffer \u4e2d\u7684\u6570\u636e</li> </ul> <p>get() \uff1a\u8bfb\u53d6\u5355\u4e2a\u5b57\u8282 get(byte[] dst)\uff1a\u6279\u91cf\u8bfb\u53d6\u591a\u4e2a\u5b57\u8282\u5230 dst \u4e2d get(int index)\uff1a\u8bfb\u53d6\u6307\u5b9a\u7d22\u5f15\u4f4d\u7f6e\u7684\u5b57\u8282(\u4e0d\u4f1a\u79fb\u52a8 position)</p> <ul> <li>\u653e\u5165\u6570\u636e\u5230 Buffer \u4e2d</li> </ul> <p>put(byte b)\uff1a\u5c06\u7ed9\u5b9a\u5355\u4e2a\u5b57\u8282\u5199\u5165\u7f13\u51b2\u533a\u7684\u5f53\u524d\u4f4d\u7f6e put(byte[] src)\uff1a\u5c06 src \u4e2d\u7684\u5b57\u8282\u5199\u5165\u7f13\u51b2\u533a\u7684\u5f53\u524d\u4f4d\u7f6e put(int index, byte b)\uff1a\u5c06\u6307\u5b9a\u5b57\u8282\u5199\u5165\u7f13\u51b2\u533a\u7684\u7d22\u5f15\u4f4d\u7f6e(\u4e0d\u4f1a\u79fb\u52a8 position) \u793a\u4f8b\uff1a Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0String str=\"abcde\";\n\n\u00a0\u00a0\u00a0\u00a0//1.\u5206\u914d\u4e00\u4e2a\u6307\u5b9a\u5927\u5c0f\u7684\u7f13\u51b2\u533a\n\u00a0\u00a0\u00a0\u00a0ByteBuffer buf=ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"--------------allocate()----------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//0\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.limit());//1024\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.capacity());//1024\n\n\u00a0\u00a0\u00a0\u00a0//2.\u5229\u7528put()\u5b58\u653e\u6570\u636e\u5230\u7f13\u51b2\u533a\u4e2d\n\u00a0\u00a0\u00a0\u00a0buf.put(str.getBytes());\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"-------------put()-------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//5\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.limit());//1024\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.capacity());//1024\n\n\u00a0\u00a0\u00a0\u00a0//3.\u5207\u6362\u8bfb\u53d6\u6570\u636e\u6a21\u5f0f\n\u00a0\u00a0\u00a0\u00a0buf.flip();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"--------------flip()------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//0\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.limit());//5\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.capacity());//1024\n\n\u00a0\u00a0\u00a0\u00a0//4.\u5229\u7528get()\u8bfb\u53d6\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0byte[] dst=new byte[buf.limit()];\n\u00a0\u00a0\u00a0\u00a0buf.get(dst);\n\u00a0\u00a0\u00a0\u00a0System.out.println(new String(dst,0,dst.length));//abcd\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"--------------get()------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//5\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.limit());//5\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.capacity());//1024\n\n\u00a0\u00a0\u00a0\u00a0//5.rewind():\u53ef\u91cd\u590d\u8bfb\n\u00a0\u00a0\u00a0\u00a0buf.rewind();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"--------------rewind()------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//0\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.limit());//5\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.capacity());//1024\n\n\u00a0\u00a0\u00a0\u00a0//6.clear():\u6e05\u7a7a\u7f13\u51b2\u533a\u3002\u4f46\u662f\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u4f9d\u7136\u5b58\u5728\uff0c\u53ea\u662f\u5904\u5728\u201c\u88ab\u9057\u5fd8\u201d\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0buf.clear();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"--------------clear()------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//0\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.limit());//1024\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.capacity());//1024\n\u00a0\u00a0\u00a0\u00a0System.out.println((char)buf.get());\n}\n</code></pre></p> Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0String str=\"abcde\";\n\u00a0\u00a0\u00a0\u00a0ByteBuffer buf=ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0buf.put(str.getBytes());\n\u00a0\u00a0\u00a0\u00a0buf.flip();\n\n\u00a0\u00a0\u00a0\u00a0byte[] dst=new byte[buf.limit()];\n\u00a0\u00a0\u00a0\u00a0buf.get(dst,0,2);\n\u00a0\u00a0\u00a0\u00a0System.out.println(new String(dst,0,2));//ab\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//2\n\n\u00a0\u00a0\u00a0\u00a0//mark():\u6807\u8bb0\n\u00a0\u00a0\u00a0\u00a0buf.mark();\n\u00a0\u00a0\u00a0\u00a0buf.get(dst,2,2);//\u518d\u8bfb\u4e24\u4e2a\u4f4d\u7f6e\n\u00a0\u00a0\u00a0\u00a0System.out.println(new String(dst, 2, 2));//cd\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//4\n\n\u00a0\u00a0\u00a0\u00a0//reset():\u6062\u590d\u5230mark\u7684\u4f4d\u7f6e\n\u00a0\u00a0\u00a0\u00a0buf.reset();\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.position());//2\n\n\u00a0\u00a0\u00a0\u00a0//\u5224\u65ad\u7f13\u51b2\u533a\u4e2d\u662f\u5426\u8fd8\u6709\u5269\u4f59\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0if(buf.hasRemaining()){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u7f13\u51b2\u533a\u4e2d\u53ef\u4ee5\u64cd\u4f5c\u7684\u6570\u91cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(buf.remaining());//3\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>\u76f4\u63a5\u7f13\u51b2\u533a\u4e0e\u975e\u76f4\u63a5\u7f13\u51b2\u533a\uff1a</p> <ul> <li>\u975e\u76f4\u63a5\u7f13\u51b2\u533a\uff1a\u901a\u8fc7allocate()\u65b9\u6cd5\u5206\u914d\u7f13\u51b2\u533a\uff0c\u5c06\u7f13\u51b2\u533a\u5efa\u7acb\u5728JVM\u7684\u5185\u5b58\u4e2d\u3002</li> <li>\u76f4\u63a5\u7f13\u51b2\u533a\uff1a\u901a\u8fc7allocateDirect()\u65b9\u6cd5\u5206\u914d\u76f4\u63a5\u7f13\u51b2\u533a\uff0c\u5c06\u7f13\u51b2\u533a\u5efa\u7acb\u5728\u672c\u5730\u7269\u7406\u5185\u5b58\u4e2d\u3002\u76f4\u63a5\u7f13\u51b2\u533a\u8fd8\u53ef\u4ee5\u901a\u8fc7FileChannel \u7684 map() \u65b9\u6cd5\u6765\u521b\u5efa\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56deMappedByteBuffer\u5bf9\u8c61\uff0cMappedByteBuffer\u662fByteBuffer\u7684\u5b50\u7c7b\u3002\u76f4\u63a5\u7f13\u51b2\u533a\u7684\u8bfb\u5199\u6548\u7387\u8fdc\u9ad8\u4e8e\u975e\u76f4\u63a5\u7f13\u51b2\u533a\uff0c\u4f46\u5176\u5206\u914d\u548c\u56de\u6536\u7684\u6548\u7387\u4f4e\u4e8e\u975e\u76f4\u63a5\u7f13\u51b2\u533a\u3002</li> </ul> <p>Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0//\u5206\u914d\u76f4\u63a5\u7f13\u51b2\u533a\n\u00a0\u00a0\u00a0\u00a0ByteBuffer buf=ByteBuffer.allocateDirect(1024);\n\u00a0\u00a0\u00a0\u00a0System.out.println(buf.isDirect());//true\n}\n</code></pre> \u901a\u9053\uff08Channel\uff09 \u901a\u9053\u662f\u4e0e\u6587\u4ef6\u5efa\u7acb\u7684\u53cc\u5411\u8fde\u63a5\uff0c\u53ea\u80fd\u4e0e\u7f13\u51b2\u533a\u8fdb\u884c\u4ea4\u4e92\u3002 java.nio.channels.Channel \u63a5\u53e3\u7684\u4e3b\u8981\u5b9e\u73b0\u7c7b\uff1a</p> <ul> <li>FileChannel\uff1a\u7528\u4e8e\u8bfb\u53d6\u3001\u5199\u5165\u3001\u6620\u5c04\u548c\u64cd\u4f5c\u6587\u4ef6\u7684\u901a\u9053\u3002</li> <li>SocketChannel\uff1a\u901a\u8fc7 TCP \u8bfb\u5199\u7f51\u7edc\u4e2d\u7684\u6570\u636e\u3002</li> <li>ServerSocketChannel\uff1a\u53ef\u4ee5\u76d1\u542c\u65b0\u8fdb\u6765\u7684 TCP \u8fde\u63a5\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u65b0\u8fdb\u6765\u7684\u8fde\u63a5\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a SocketChannel\u3002</li> <li>DatagramChannel\uff1a\u901a\u8fc7 UDP \u8bfb\u5199\u7f51\u7edc\u4e2d\u7684\u6570\u636e\u901a\u9053\u3002</li> </ul> <p>\u83b7\u53d6\u901a\u9053\uff1a 1.java\u9488\u5bf9\u652f\u6301\u901a\u9053\u7684\u7c7b\u63d0\u4f9b\u4e86getChannel()\u65b9\u6cd5</p> <ul> <li>\u672c\u5730IO\uff1a</li> </ul> <p>FileInputStream/FileOutputStream RandomAccessFile</p> <ul> <li>\u7f51\u7edcIO\uff1a</li> </ul> <p>Socket ServerSocket DatagramSocket 2.JDK 1.7 \u7684NIO.2 \u9488\u5bf9\u5404\u4e2a\u901a\u9053\u63d0\u4f9b\u4e86\u9759\u6001\u65b9\u6cd5 open() 3.JDK 1.7 \u7684NIO.2 \u7684Files\u5de5\u5177\u7c7b\u7684newByteChannel()</p> <p>\u4e0b\u9762\u4ee5FileChannel\u4e3a\u4f8b\u5c55\u793a\u901a\u9053\u7684\u7528\u6cd5 FileChannel \u7684\u5e38\u7528\u65b9\u6cd5\uff1a </p> <p>\u793a\u4f8b1\uff0c\u901a\u9053\u53ef\u4ee5\u4e0e\u6587\u4ef6\u5efa\u7acb\u53ef\u8bfb\u53ef\u5199\u7684\u53cc\u5411\u8fde\u63a5\uff1a Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0try (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//1.\u83b7\u53d6\u901a\u9053`\n `FileChannel channel = FileChannel.open(Paths.get(\"D:/1.txt\"), StandardOpenOption.WRITE, StandardOpenOption.READ, StandardOpenOption.CREATE)`\n\u00a0\u00a0\u00a0\u00a0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer buf01 = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf01.put(\"abcedfg\".getBytes());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf01.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//\u5f80\u901a\u9053\u91cc\u5199`\n `channel.write(buf01, 0);`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer buf02 = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u4ece\u901a\u9053\u91cc\u8bfb`\n `channel.read(buf02);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf02.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0byte[] bytes = new byte[buf02.limit()];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf02.get(bytes);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(new String(bytes, 0, bytes.length));\n\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u793a\u4f8b2\uff0c\u4f7f\u7528\u901a\u9053\u5b8c\u6210\u672c\u5730\u6587\u4ef6\u7684\u590d\u5236\uff0c\u6ce8\u610f\uff0c\u4ece\u6d41\u4e2d\u83b7\u53d6\u7684\u901a\u9053\u5e76\u4e0d\u662f\u53cc\u5411\u7684\uff1a Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0long start = System.currentTimeMillis();\n\u00a0\u00a0\u00a0\u00a0try (FileInputStream fis = new FileInputStream(\"d:/1.avi\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputStream fos = new FileOutputStream(\"d:/2.avi\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//1.\u83b7\u53d6\u901a\u9053`\n `FileChannel inChannel = fis.getChannel();`\n `FileChannel outChannel = fos.getChannel()`\n\u00a0\u00a0\u00a0\u00a0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5206\u914d\u6307\u5b9a\u5927\u5c0f\u7684\u7f13\u51b2\u533a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer buf = ByteBuffer.allocate(1024);\n\u00a0 \u00a0 \u00a0 \u00a0\u00a0`//3.\u5c06\u6587\u4ef6\u4e2d\u6570\u636e\u4ece\u901a\u9053\u8bfb\u5230\u7f13\u51b2\u533a\u4e2d`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (inChannel.read(buf) != -1) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.flip();//\u5207\u6362\u8bfb\u53d6\u6570\u636e\u7684\u6a21\u5f0f\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0`//4.\u5c06\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u4ece\u901a\u9053\u5199\u5230\u6587\u4ef6\u4e2d`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outChannel.write(buf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.clear();//\u6e05\u7a7a\u7f13\u51b2\u533a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0long end = System.currentTimeMillis();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8017\u8d39\u65f6\u95f4\uff1a\" + (end - start));//\u8017\u8d39\u65f6\u95f4\uff1a1094\n}\n</code></pre></p> <p>\u793a\u4f8b3\uff0c\u4f7f\u7528\u76f4\u63a5\u7f13\u51b2\u533a\u5b8c\u6210\u672c\u5730\u6587\u4ef6\u7684\u590d\u5236\uff1a Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0long start = System.currentTimeMillis();\n\u00a0\u00a0\u00a0\u00a0try (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileChannel inChannel = FileChannel.open(Paths.get(\"d:/1.avi\"), StandardOpenOption.READ);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileChannel outChannel = FileChannel.open(Paths.get(\"d:/2.avi\"), StandardOpenOption.WRITE, StandardOpenOption.READ, StandardOpenOption.CREATE)\n\u00a0\u00a0\u00a0\u00a0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5185\u5b58\u6620\u5c04\u6587\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MappedByteBuffer inMappedBuf = inChannel.map(FileChannel.MapMode.READ_ONLY, 0, inChannel.size());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MappedByteBuffer outMappedBuf = outChannel.map(FileChannel.MapMode.READ_WRITE, 0, inChannel.size());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0byte[] dst = new byte[inMappedBuf.limit()];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u76f4\u63a5\u5bf9\u7f13\u51b2\u533a\u8fdb\u884c\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c`\n `inMappedBuf.get(dst);`\n `outMappedBuf.put(dst);`\n\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0long end = System.currentTimeMillis();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8017\u8d39\u7684\u65f6\u95f4\u4e3a\uff1a\" + (end - start));//\u8017\u8d39\u7684\u65f6\u95f4\u4e3a\uff1a200\n}\n</code></pre></p> <p>\u6216\u8005\u4f7f\u7528 transferFrom() \u6216\u8005 _transferTo()_\u76f4\u63a5\u901a\u9053\u5bf9\u901a\u9053\u4f20\u8f93\u5b8c\u6210\u672c\u5730\u6587\u4ef6\u7684\u590d\u5236\uff0c\u540c\u6837\u4e5f\u662f\u4f7f\u7528\u4e86\u76f4\u63a5\u7f13\u51b2\u533a\uff1a</p> Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0long start = System.currentTimeMillis();\n\u00a0\u00a0\u00a0\u00a0try (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileChannel inChannel = FileChannel.open(Paths.get(\"d:/1.txt\"), StandardOpenOption.READ);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileChannel outChannel = FileChannel.open(Paths.get(\"d:/3.txt\"), StandardOpenOption.WRITE, StandardOpenOption.READ, StandardOpenOption.CREATE)\n\u00a0\u00a0\u00a0\u00a0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`inChannel.transferTo(0, inChannel.size(), outChannel);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//outChannel.transferFrom(inChannel, 0, inChannel.size());\n\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0long end = System.currentTimeMillis();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8017\u8d39\u7684\u65f6\u95f4\u4e3a\uff1a\" + (end - start));//\u8017\u8d39\u7684\u65f6\u95f4\u4e3a\uff1a200\n}\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5206\u6563\u8bfb\u53d6\u548c\u805a\u96c6\u5199\u5165\u5b8c\u6210\u672c\u5730\u6587\u4ef6\u7684\u590d\u5236 \u5206\u6563\u8bfb\u53d6\uff08Scattering Reads\uff09\uff1a\u5c06\u901a\u9053\u4e2d\u7684\u6570\u636e\u5206\u6563\u8bfb\u5230\u591a\u4e2a\u7f13\u51b2\u533a\u4e2d \u805a\u96c6\u5199\u5165\uff08Gathering Writes\uff09\uff1a\u5c06\u591a\u4e2a\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u805a\u96c6\u5199\u5230\u901a\u9053\u4e2d \u533a\u522b\u53ea\u5728\u4e8eread\u548cwrite\u4f20\u7684\u662f\u7f13\u51b2\u533a\u6570\u7ec4 Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0try (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileChannel inChannel = FileChannel.open(Paths.get(\"d:/1.txt\"), StandardOpenOption.READ);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileChannel outChannel = FileChannel.open(Paths.get(\"d:/4.txt\"), StandardOpenOption.WRITE, StandardOpenOption.READ, StandardOpenOption.CREATE)\n\u00a0\u00a0\u00a0\u00a0) {\n\u00a0 \u00a0 \u00a0 \u00a0 ByteBuffer buf01 = ByteBuffer.allocate(100);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer buf02 = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer[] bufs = {buf01, buf02};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0inChannel.read(bufs);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ByteBuffer byteBuffer : bufs) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0byteBuffer.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outChannel.write(bufs);\n\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/5-NIO%E4%B9%8B%E9%80%89%E6%8B%A9%E5%99%A8%E4%B8%8EIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/","title":"5-NIO\u4e4b\u9009\u62e9\u5668\u4e0eIO\u591a\u8def\u590d\u7528","text":"<p> \u7ea6 1139 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 23 \u5206\u949f</p> <p>\u591a\u8def\u590d\u7528\uff0c\u975e\u963b\u585e\u5f0fIO\u662f\u9488\u5bf9\u7f51\u7edcIO\u800c\u8a00\u7684\uff0c\u9009\u62e9\u5668\uff08Selector\uff09\u5c31\u662f\u591a\u8def\u590d\u7528\u7684\u5b9e\u73b0\u3002Selector \u53ef\u4ee5\u540c\u65f6\u76d1\u63a7\u591a\u4e2a SelectableChannel \u7684 IO \u72b6\u51b5\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5229\u7528 Selector \u53ef\u4f7f\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b\u7ba1\u7406\u591a\u4e2a Channel\u3002  \u62bd\u8c61\u7c7bjava.nio.channels.SelectableChannel\u7684\u4e09\u4e2a\u4e3b\u8981\u5b9e\u73b0\u7c7b\u662fSocketChannel\u3001ServerSocketChannel\u3001DatagramChannel\uff0c\u5747\u7528\u7f51\u7edcIO\uff0c\u6240\u4ee5Selector\u4e0d\u80fd\u76d1\u89c6\u7528\u4e8e\u672c\u5730IO\u7684FileChannel\u3002</p> <p>Selector\u7684\u7528\u6cd5\uff1a</p> <ol> <li>\u521b\u5efa Selector \uff1a\u901a\u8fc7\u8c03\u7528 Selector.open() \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a Selector</li> </ol> Text Only<pre><code>Selector selector = Selector.open();\n</code></pre> <ol> <li> <p>\u5411\u9009\u62e9\u5668\u6ce8\u518c\u901a\u9053\uff1aSelectableChannel.register(Selector sel, int ops)\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570 ops\u7528\u4e8e\u6307\u5b9a\u76d1\u542c\u4e8b\u4ef6\uff0c\u53ef\u4ee5\u9009\u62e9\u7684\u4e8b\u4ef6\u6709\uff1a</p> </li> <li> <p>\u8bfb : SelectionKey.OP_READ\u00a0\u00a0\uff081\uff09</p> </li> <li>\u5199 : SelectionKey.OP_WRITE\u00a0\u00a0\u00a0\u00a0\uff084\uff09</li> <li>\u8fde\u63a5 : SelectionKey.OP_CONNECT \uff088\uff09</li> <li>\u63a5\u6536 : SelectionKey.OP_ACCEPT\u00a0\u00a0\uff0816\uff09</li> </ol> <p>\u82e5\u6ce8\u518c\u65f6\u4e0d\u6b62\u76d1\u542c\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u201c\u6216\u201d\u64cd\u4f5c\u7b26\u8fde\u63a5\uff0c\u5982\uff1aSelectionKey.OP_READ|SelectionKey.OP_WRITE</p> <p>\u4e0b\u9762\u4ee5\u670d\u52a1\u7aef\u63a5\u6536\u6765\u81ea\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e3a\u4f8b\uff0c\u5728BIO\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u90fd\u4f1a\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u6765\u5904\u7406\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4ee5\u540c\u6b65\u963b\u585e\u5f0fIO\u7684\u65b9\u5f0f\u8fdb\u884c\u901a\u4fe1\uff0c\u5982\u56fe\u6240\u793a\uff1a </p> <p>\u800c\u5728NIO\u6a21\u5f0f\u4e0b\uff0c\u867d\u7136\u670d\u52a1\u5668\u7aef\u53ea\u6709\u4e3b\u7ebf\u7a0b\u8fd9\u4e48\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4f46\u662fselector\u53ef\u4ee5\u540c\u65f6\u76d1\u89c6\u591a\u4e2aChannel\u7684\u72b6\u6001\uff0c\u8fbe\u5230\u540c\u65f6\u4e0e\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6548\u679c\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a </p> <p>\u670d\u52a1\u7aef\uff1a Text Only<pre><code>public class Server {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//1. \u83b7\u53d6\u9009\u62e9\u5668`\n `Selector selector = Selector.open();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//2. \u51c6\u5907\u7f13\u51b2\u533a\uff0c\u7f13\u51b2\u533a\u590d\u7528\u4e86\uff0c\u5e76\u6ca1\u6709\u4e00\u4e2asocket\u4e00\u4e2a\u5bf9\u5e94\u7684\u7f13\u51b2\u533a\uff0c\u56e0\u4e3a\u662f\u5355\u7ebf\u7a0b\uff0c\u6240\u4ee5\u662f\u987a\u5e8f\u7684\u5904\u7406\u6bcf\u4e2asocket\u4e2d\u7684\u6570\u636e`\n `ByteBuffer buf = ByteBuffer.allocate(1024);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3. \u83b7\u53d6\u901a\u9053\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServerSocketChannel ssChannel = ServerSocketChannel.open();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4. \u5207\u6362\u975e\u963b\u585e\u6a21\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssChannel.configureBlocking(false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//5. \u7ed1\u5b9a\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssChannel.bind(new InetSocketAddress(9999));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//6. \u5c06\u901a\u9053\u6ce8\u518c\u5230\u9009\u62e9\u5668\u4e0a, \u5e76\u4e14\u6307\u5b9a\u201c\u76d1\u542c\u63a5\u6536\u4e8b\u4ef6\u201d`\n `ssChannel.register(selector, SelectionKey.OP_ACCEPT);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//7. select\u662f\u963b\u585e\u7684\uff0c\u4e00\u65e6\u6709Channel\u7684\u4e8b\u4ef6\u51c6\u5907\u597d\u4e86\u5c31\u8fd4\u56de`\n `while (selector.select() &gt; 0) {`\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 `//8. \u83b7\u53d6\u5f53\u524d\u9009\u62e9\u5668\u4e2d\u6240\u6709\u6ce8\u518c\u7684\u201c\u9009\u62e9\u952e(\u5df2\u5c31\u7eea\u7684\u76d1\u542c\u4e8b\u4ef6)\u201d\uff0c`\n `// \u56e0\u4e3a\u8fd9\u91cc\u8fd4\u56de\u7684\u662f\u6240\u6709\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\u7684\u4e8b\u4ef6\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u5faa\u73af\u904d\u5386\u7684\u6240\u6709\u4e8b\u4ef6\u90fd\u662f\u6709\u6570\u636e\u7684`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (it.hasNext()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//9. \u83b7\u53d6\u201c\u5c31\u7eea\u201d\u7684\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SelectionKey sk = it.next();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//10. \u5982\u679c\u662fACCEPT\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (sk.isAcceptable()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//11. \u83b7\u53d6\u5ba2\u6237\u7aef\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel sChannel = ssChannel.accept();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//12. \u5207\u6362\u975e\u963b\u585e\u6a21\u5f0f`\n `sChannel.configureBlocking(false);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//13. \u5c06\u8be5\u901a\u9053\u6ce8\u518c\u5230\u9009\u62e9\u5668\u4e0a`\n `sChannel.register(selector, SelectionKey.OP_READ);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (sk.isReadable()) { //14. \u5982\u679c\u662fREAD\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//15. \u83b7\u53d6\u5f53\u524d\u9009\u62e9\u5668\u4e0a\u201c\u8bfb\u5c31\u7eea\u201d\u72b6\u6001\u7684\u901a\u9053\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel sChannel = (SocketChannel) sk.channel();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//16. \u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u4f1a\u8bfb\u53d6\u4e0d\u5230\u6570\u636e\uff0c\u6240\u4ee5\u8fd9\u91cc\u662f\u4e0d\u4f1a\u963b\u585e\u7684`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int len = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// BIO\u5728\u8bfb\u53d6\u5957\u63a5\u5b57\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u4f1a\u963b\u585e\u4e00\u76f4\u7b49\u5f85\u5957\u63a5\u5b57\u6587\u4ef6\u4e2d\u6570\u636e\u7684\u5230\u6765\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728BIO\u65b9\u5f0f\u770b\u6765\u5957\u63a5\u5b57\u662f\u4e00\u4e2a\u6ca1\u6709\u7ed3\u675f\u6807\u5fd7\u7684\u6587\u4ef6\uff0c`\n `// \u800c\u4ece\u901a\u9053\u4e2d\u8bfb\u53d6\u5c31\u4e0d\u540c\u7684\uff0c\u5f53\u672c\u6b21\u4e8b\u4ef6\u91cc\u7684\u6570\u636e\u8bfb\u5b8c\u4e86\u5c31\u4f1a\u8fd4\u56de\uff0c\u7c7b\u4f3c\u4e8e\u4ece\u6587\u4ef6\u4e2d\u8bfb`\n `while ((len = sChannel.read(buf)) &gt; 0) {`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(new String(buf.array(), 0, len));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//17. \u53d6\u6d88\u9009\u62e9\u952e SelectionKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0it.remove();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> selector.select()\u4f1a\u963b\u585e\uff0c\u53ea\u8981\u6709\u4e00\u4e2aChannel\u7684\u4e8b\u4ef6\u51c6\u5907\u597d\u4e86\uff0cselector.select()\u5c31\u4f1a\u8fd4\u56de\uff0c\u518d\u8fdb\u5165\u5230while\u5faa\u73af\u91cc\u9762\u901a\u8fc7selector.selectedKeys().iterator()\u62ff\u5230\u6240\u6709\u5df2\u7ecf\u51c6\u5907\u597d\u7684\u4e8b\u4ef6\uff0c\u91cc\u9762\u7684\u64cd\u4f5c\u90fd\u662f\u540c\u6b65\u7684\uff0c\u5e76\u4e14\u4e0d\u4f1a\u963b\u585e\uff0c\u540c\u6b65\u7684\u610f\u601d\u662f\u4e00\u4e2a\u4e8b\u4ef6\u63a5\u7740\u4e00\u4e2a\u4e8b\u4ef6\u7684\u5904\u7406\uff0c\u4e0d\u4f1a\u963b\u585e\u662f\u56e0\u4e3a\u5904\u7406\u7684\u4e8b\u4ef6\u90fd\u662f\u5df2\u7ecf\u51c6\u5907\u597d\u6709\u6570\u636e\u7684\u3002 \u5728BIO\u6a21\u5f0f\u4e0b\uff0c\u8bfb\u4e00\u884c\u5c31\u662f\u8bfb\u4e00\u884c\uff0c\u5982\u679c\u6ca1\u6709\u4e00\u884c\u5c31\u963b\u585e\u7684\u7b49\u4e00\u884c\u6570\u636e\u5230\u6765\uff0c\u8bfb\u5b8c\u4e00\u884c\u518d\u8fd4\u56de\uff1b\u800c\u5728NIO\u6a21\u5f0f\u4e0b\uff0cSelector\u53ea\u6709\u5f53\u6570\u636e\u51c6\u5907\u597d\u4e86\u624d\u4f1a\u901a\u77e5\uff0c\u6240\u4ee5\u8bfb\u7684\u65f6\u5019\u80af\u5b9a\u662f\u6709\u6570\u636e\u7684\u3002\u603b\u7ed3\u4e00\u53e5\u975e\u963b\u585e\u4e3b\u8981\u5728\u4e8eSelector\u3002</p> <p>\u5ba2\u6237\u7aef\uff1a Text Only<pre><code>public class Client {\n\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1. \u83b7\u53d6\u901a\u9053\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel sChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\", 9999));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2. \u5207\u6362\u975e\u963b\u585e\u6a21\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.configureBlocking(false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3. \u5206\u914d\u6307\u5b9a\u5927\u5c0f\u7684\u7f13\u51b2\u533a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer buf = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4. \u53d1\u9001\u6570\u636e\u7ed9\u670d\u52a1\u7aef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Scanner scan = new Scanner(System.in);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while(scan.hasNext()){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str = scan.nextLine();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.put((new SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss\").format(System.currentTimeMillis()) + \"\\n\" + str).getBytes());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.write(buf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//5. \u5173\u95ed\u901a\u9053\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.close();\n\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5373\u4f7f\u670d\u52a1\u7aef\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u4e8e\u591a\u4e2a\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\u53d1\u9001\u6570\u636e\uff0c\u8fd9\u5c31IO\u591a\u8def\u590d\u7528\u7684\u5f3a\u5927\u4e4b\u5904\u3002\u4f46\u6b63\u56e0\u4e3a\u662f\u5728\u5355\u7ebf\u7a0b\u4e0b\u987a\u5e8f\u7684\u5904\u7406\u6bcf\u4e2a\u51c6\u5907\u597d\u4e86\u7684\u4e8b\u4ef6\uff0c\u6240\u4ee5\u6bcf\u4e2a\u4e8b\u4ef6\u4e0d\u5e94\u8be5\u592a\u8fc7\u4e8e\u7e41\u91cd\uff0c\u4e0d\u7136\u4e0b\u4e00\u4e2a\u4e8b\u4ef6\u5c31\u4f1a\u7b49\u5f88\u4e45\uff0c\u5bfc\u81f4\u54cd\u5e94\u6162\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/6-NIO%E4%B9%8B%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B-%E7%BE%A4%E8%81%8A%E7%B3%BB%E7%BB%9F/","title":"6-NIO\u4e4b\u7f51\u7edc\u7f16\u7a0b\u5e94\u7528\u5b9e\u4f8b-\u7fa4\u804a\u7cfb\u7edf","text":"<p> \u7ea6 435 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>\u7fa4\u804a\u7cfb\u7edf\uff1a\u5ba2\u6237\u7aef\u5148\u628a\u6d88\u606f\u53d1\u9001\u5230\u670d\u52a1\u5668\uff0c\u7136\u540e\u7531\u670d\u52a1\u5668\u53d1\u9001\u7ed9\u9664\u53d1\u9001\u6d88\u606f\u7684\u5ba2\u6237\u7aef\u4e4b\u5916\u7684\u6240\u6709\u5ba2\u6237\u7aef \u670d\u52a1\u5668\u7aef Text Only<pre><code>public class Server {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;SocketChannel&gt; channels = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Selector selector = Selector.open();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer buf = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServerSocketChannel ssChannel = ServerSocketChannel.open();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssChannel.configureBlocking(false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssChannel.bind(new InetSocketAddress(9999));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssChannel.register(selector, SelectionKey.OP_ACCEPT);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (selector.select() &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (it.hasNext()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SelectionKey sk = it.next();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (sk.isAcceptable()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel sChannel = ssChannel.accept();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0channels.add(sChannel);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.configureBlocking(false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.register(selector, SelectionKey.OP_READ);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (sk.isReadable()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel sChannel = (SocketChannel) sk.channel();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// socket\u5f02\u5e38\u5173\u95ed\u65f6\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a\u5f02\u5e38\u7684\u6d88\u606f\u7ed9\u670d\u52a1\u5668\uff0c\u662f\u4e2a\u53ef\u8bfb\u4e8b\u4ef6\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4f46\u662f\u5177\u4f53\u53c8\u8bfb\u4e0d\u51fa\u4e1c\u897f\u6765\uff0c\u56e0\u800c\u629b\u5f02\u5e38\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while ((sChannel.read(buf)) &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u53d1\u9001\u7ed9\u9664\u81ea\u5df1\u4e4b\u5916\u7684\u6240\u6709\u5ba2\u6237\u7aef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (SocketChannel socketChannel : channels) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (socketChannel != sChannel) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0socketChannel.write(buf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buf.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (SocketException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5904\u7406\u4e0b\u7ebf\uff0c\u9700\u8981\u5173\u95ed\u901a\u9053\uff0c\u4ece\u96c6\u5408\u4e2d\u79fb\u9664\u901a\u9053\uff0c\u6700\u540e\u8fd8\u8981\u5728\u9009\u62e9\u5668\u91cc\u9762\u53d6\u6d88\u6ce8\u518c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(sChannel.getRemoteAddress() + \"\u4e0b\u7ebf\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0channels.remove(sChannel);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sk.cancel();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0it.remove();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4e3b\u8981\u662f\u5ba2\u6237\u7aef Text Only<pre><code>public class Client {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel sChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\", 9999));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.configureBlocking(false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Selector selector = Selector.open();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.register(selector, SelectionKey.OP_READ);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer writeBuf = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// \u5ba2\u6237\u7aef\u5373\u9700\u8981\u8f93\u5165\u6d88\u606f\uff0c\u53c8\u9700\u8981\u63a5\u6536\u6d88\u606f\uff0c\u8f93\u5165\u6d88\u606f\u662f\u963b\u585e\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e0d\u80fd\u548c\u63a5\u6536\u6d88\u606f\u653e\u5728\u540c\u4e00\u7ebf\u7a0b\u5185\uff0c`\n `// \u5fc5\u987b\u4e3a\u63a5\u6536\u6d88\u606f\u5355\u72ec\u5f00\u4e00\u4e2a\u7ebf\u7a0b`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable receive = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ByteBuffer readBuf = ByteBuffer.allocate(1024);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (selector.select() &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (it.hasNext()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SelectionKey sk = it.next();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (sk.isReadable()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SocketChannel socketChannel = (SocketChannel) sk.channel();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int len = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while ((len = socketChannel.read(readBuf)) &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0readBuf.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(new String(readBuf.array(), 0, len));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0readBuf.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0it.remove();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(receive).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4. \u53d1\u9001\u6570\u636e\u7ed9\u670d\u52a1\u7aef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Scanner scan = new Scanner(System.in);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (scan.hasNext()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd9\u662f\u4e00\u4e2a\u4f1a\u963b\u585e\u7684\u8f93\u5165\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str = scan.nextLine();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writeBuf.put((new SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss\").format(System.currentTimeMillis()) + \": \"+ str).getBytes());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writeBuf.flip();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.write(writeBuf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writeBuf.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//5. \u5173\u95ed\u901a\u9053\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sChannel.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/7-ArrayList%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/","title":"7-ArrayList\u6e90\u7801\u7b14\u8bb0","text":"<p> \u7ea6 492 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>ArrayList\u5e95\u5c42\u662f\u6570\u7ec4\uff0c\u5982\u679c\u4f7f\u7528\u65e0\u53c2\u6784\u9020\u5668\uff0c\u5219\u521d\u59cb\u5316\u5bb9\u91cf\u662f0\uff0c\u5728\u7b2c\u4e00\u6b21\u6dfb\u52a0\u65f6\u4f1a\u6269\u5bb9\u523010\uff0c\u4ee5\u540e\u6bcf\u6b21\u6269\u5bb9\u90fd\u662f\u6269\u5230\u539f\u6765\u76841.5\uff0c\u6bd4\u598210\u4f1a\u6269\u5bb9\u523015\uff1b\u5982\u679c\u4f7f\u7528\u6307\u5b9a\u5927\u5c0f\u7684\u6709\u53c2\u6784\u9020\u5668\uff0c\u5219\u521d\u59cb\u5316\u65f6\u5c31\u662f\u8fd9\u4e2a\u5bb9\u91cf\uff0c\u4ee5\u540e\u6bcf\u6b21\u6269\u5bb9\u4e5f\u662f\u6269\u5230\u539f\u6765\u76841.5\u3002</p> <p>\u5e38\u91cf\u548c\u5b57\u6bb5\uff1a Text Only<pre><code>// \u9ed8\u8ba4\u5bb9\u91cf\uff0c10\nprivate static final int DEFAULT_CAPACITY = 10;\nprivate static final Object[] EMPTY_ELEMENTDATA = {};\nprivate static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};\n// \u5b58\u5143\u7d20\u7684\u6570\u7ec4\ntransient Object[] elementData; // non-private to simplify nested class access\n// \u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\nprivate int size;\n</code></pre></p> <p>\u6784\u9020\u5668 Text Only<pre><code>// \u5e26\u521d\u59cb\u5bb9\u91cf\u7684\u6784\u9020\u5668\npublic ArrayList(int initialCapacity) {\n\u00a0 \u00a0 //\u521d\u59cb\u5bb9\u91cf\u5927\u4e8e0\uff0c\u76f4\u63a5\u521d\u59cb\u5316\uff0c\u4e0d\u5ef6\u8fdf\u521b\u5efa\n\u00a0\u00a0\u00a0\u00a0if (initialCapacity &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.elementData = new Object[initialCapacity];\n\u00a0\u00a0\u00a0\u00a0} else if (initialCapacity == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.elementData = EMPTY_ELEMENTDATA;\n\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalArgumentException(\"Illegal Capacity: \"+\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0initialCapacity);\n\u00a0\u00a0\u00a0\u00a0}\n}\n\n// \u65e0\u53c2\u6784\u9020\u5668\npublic ArrayList() {\n\u00a0\u00a0\u00a0\u00a0//\u5148\u8d4b\u7a7a\u6570\u7ec4\uff0c\u7b49\u5230\u6dfb\u52a0\u7684\u65f6\u5019\u518d\u6269\u5bb9\u5230\u9ed8\u8ba4\u5bb9\u91cf\n\u00a0\u00a0\u00a0\u00a0this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n}\n</code></pre></p> <p>add()\u65b9\u6cd5\uff1a Text Only<pre><code>public boolean add(E e) {\n\u00a0\u00a0\u00a0\u00a0modCount++;\n\u00a0\u00a0\u00a0\u00a0add(e, elementData, size);\n\u00a0\u00a0\u00a0\u00a0return true;\n}\n\nprivate void add(E e, Object[] elementData, int s) {\n\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u6570\u7ec4\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\u7b49\u4e8e\u6570\u7ec4\u7684\u957f\u5ea6\u5c31\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0if (s == elementData.length)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0elementData = grow();\n\u00a0\u00a0\u00a0\u00a0//\u6269\u5bb9\u540e\u8d4b\u503c\n\u00a0\u00a0\u00a0\u00a0elementData[s] = e;\n\u00a0\u00a0\u00a0\u00a0//\u4e2a\u6570\u52a01\n\u00a0\u00a0\u00a0\u00a0size = s + 1;\n}\n</code></pre></p> <p>\u6269\u5bb9\u65b9\u6cd5\uff1a Text Only<pre><code>private Object[] grow() {\n\u00a0\u00a0\u00a0\u00a0return grow(size + 1);\n}\n\n//minCapacity\u662f\u5b9e\u9645\u9700\u8981\u7684\u6700\u5c0f\u5bb9\u91cf\nprivate Object[] grow(int minCapacity) {\n\u00a0\u00a0\u00a0\u00a0//\u65e7\u5bb9\u91cf\n\u00a0\u00a0\u00a0\u00a0int oldCapacity = elementData.length;\n\u00a0\u00a0\u00a0\u00a0//\u65e7\u5bb9\u91cf\u5927\u4e8e0\uff0c\u9700\u8981\u5728\u521b\u5efa\u6570\u7ec4\u5e76\u590d\u5236\u5143\u7d20\n\u00a0\u00a0\u00a0\u00a0if (oldCapacity &gt; 0 || elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8ba1\u7b97\u65b0\u5bb9\u91cf\uff0c\u4e3b\u8981\u662foldCapacity &gt;&gt; 1\uff0c\u8fd9\u4e2a\u8868\u793a\u539f\u5bb9\u91cf\u76840.5\u500d\uff0cnewCapacity = oldCapacity + oldCapacity &gt;&gt; 1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int newCapacity = ArraysSupport.newLength(oldCapacity,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0minCapacity - oldCapacity,\u00a0\u00a0/* minimum growth */\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oldCapacity &gt;&gt; 1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/* preferred growth */ );\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u65b0\u6570\u7ec4\u5e76\u590d\u5236\u5143\u7d20\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return elementData = Arrays.copyOf(elementData, newCapacity);\n\u00a0\u00a0\u00a0\u00a0} else {//\u65e7\u5bb9\u91cf\u7b49\u4e8e0\u8868\u793a\u4f7f\u7528\u65e0\u53c2\u6784\u9020\u5668\u540e\u7b2c\u4e00\u6b64\u6dfb\u52a0\u5143\u7d20\uff0c\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa\u6570\u7ec4\uff0c\u4e0d\u9700\u8981\u590d\u5236\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5b9e\u9645\u9700\u8981\u7684\u6700\u5c0f\u5bb9\u91cf \u548c \u9ed8\u8ba4\u5bb9\u91cf\u4e2d \u9009\u5927\u7684\u90a3\u4e2a\uff0c\u54ea\u80af\u5b9a\u662f\u9ed8\u8ba4\u5bb9\u91cf\u5927\u5440\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return elementData = new Object[Math.max(DEFAULT_CAPACITY, minCapacity)];\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/8-HashMap%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/","title":"8-HashMap\u6e90\u7801\u7b14\u8bb0","text":"<p> \u7ea6 1898 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 38 \u5206\u949f</p> <p>HashMap\u7684\u6570\u636e\u7ed3\u6784\u662f\uff1a\u6570\u7ec4+\u94fe\u8868+\u7ea2\u9ed1\u6811\u3002\u6570\u7ec4\u7684\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u79f0\u4e3abin(\u6876)\u3002</p> <p>HashMap\u7684put\u5143\u7d20\u7684\u6d41\u7a0b\uff1a \u9996\u5148\u6839\u636ekey\u7684hash\u503c\u627e\u5230\u5728\u6570\u7ec4\u4e2d\u5e94\u8be5\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u5148\u5224\u65ad\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u5426\u4e3a\u7a7a\uff0c\u82e5\u4e3a\u7a7a\u5c31\u76f4\u63a5\u63d2\u5728\u6570\u7ec4\u7684\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u5426\u5219\u5c31\u4f9d\u6b21\u68c0\u67e5\u94fe\u8868\u4e0a\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\uff0c\u5224\u65adkey\u503c\u662f\u5426\u76f8\u7b49\uff0c\u82e5\u76f8\u7b49\uff0c\u5c31\u66ff\u6362value\u503c\uff0c\u82e5\u6ca1\u4e00\u4e2a\u76f8\u7b49\u7684\uff0c\u5c31\u63d2\u5230\u94fe\u8868\u5c3e\u90e8\uff0c\u63d2\u5165\u540e\u5982\u679c\u94fe\u8868\u957f\u5ea6\u5927\u4e8e8\uff0c\u5219\u8fd8\u9700\u8981\u628a\u94fe\u8868\u53d8\u6210\u7ea2\u9ed1\u6811\u3002\u63d2\u5b8c\u4e4b\u540e\u6700\u540e\u8fd8\u8981\u68c0\u67e5\u8282\u70b9\u603b\u6570\u662f\u5426\u5927\u4e8e\u9608\u503c\uff0c\u5982\u679c\u5927\u4e8e\u8fd8\u9700\u8fdb\u884c\u6269\u5bb9\u3002 \u6ce8\u610f\uff1a\u68c0\u67e5\u5934\u8282\u70b9\u548c\u68c0\u67e5\u94fe\u8868\u540e\u9762\u7684\u8282\u70b9\u5e76\u4e0d\u662f\u5728\u4e00\u8d77\u7684\u64cd\u4f5c</p> <p>HashMap\u7684\u6269\u5bb9\u673a\u5236\uff1a <code>\u5f53\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u65f6</code>\uff0c\u82e5\u8282\u70b9\u603b\u6570\u5927\u4e8e\u9608\u503c\uff08\u6570\u7ec4\u957f\u5ea6*\u8d1f\u8f7d\u56e0\u5b50\uff09\uff0c\u6216\u67d0\u4e2a\u94fe\u8868\u7684\u957f\u5ea6\u5927\u4e8e\u6811\u5316\u7684\u9608\u503c\uff0c\u51fa\u73b0\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\u60c5\u51b5\u5c31\u4f1a\u5c06\u6570\u7ec4\u6269\u5bb9\u4e3a\u539f\u6765\u7684\u4e24\u500d\uff1b<code>\u5f53\u6570\u7ec4\u957f\u5ea6\u5927\u4e8e64\u65f6</code>\uff0c\u53ea\u4f1a\u5728\u8282\u70b9\u603b\u6570\u5927\u4e8e\u9608\u503c\u65f6\u6269\u5bb9\uff0c\u82e5\u67d0\u4e2a\u94fe\u8868\u7684\u957f\u5ea6\u7b49\u4e8e\u6811\u5316\u7684\u9608\u503c\uff0c\u5219\u4f1a\u5c06\u94fe\u8868\u53d8\u6210\u7ea2\u9ed1\u6811\u3002 \u6ce8\u610f\u4e24\u70b9\uff1a1.\u662f\u8282\u70b9\u603b\u6570\u4e0e\u6570\u7ec4\u957f\u5ea6*\u8d1f\u8f7d\u56e0\u5b50\u6bd4\u8f83\uff0c\u800c\u4e0d\u662f\u6570\u7ec4\u4e0a\u5df2\u88ab\u5360\u6709\u7684\u4f4d\u7f6e\u00a0 2. \u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u65f6\uff0c\u94fe\u8868\u957f\u5ea6\u7b49\u4e8e8\u4e0d\u4f1a\u89e6\u53d1\u6811\u5316\uff0c\u800c\u662f\u89e6\u53d1\u6269\u5bb9</p> <p>\u770b\u6ce8\u91ca\uff0c\u89e3\u8bfb\u90fd\u5728\u6ce8\u91ca\u91cc\u3002</p> <p>\u5e38\u91cf\u7684\u542b\u4e49\uff1a Text Only<pre><code>//\u9ed8\u8ba4\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\u4e3a16\nstatic final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16\n//\u6570\u7ec4\u7684\u6700\u5927\u957f\u5ea6\nstatic final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;\n//\u9ed8\u8ba4\u7684\u8d1f\u8f7d\u56e0\u5b50\nstatic final float DEFAULT_LOAD_FACTOR = 0.75f;\n//\u6811\u5316\u7684\u9608\u503c\uff0c\u5373\u5f53\u6ee1\u8db3\u6811\u5316\u7684\u6761\u4ef6\uff08\u6570\u7ec4\u957f\u5ea6\u5927\u4e8e64\uff09\uff0c\u82e5\u94fe\u8868\u7684\u957f\u5ea6\u4e3a8\u5219\u6811\u5316\nstatic final int TREEIFY_THRESHOLD = 8;\n//\u89e3\u9664\u6811\u5316\u7684\u9608\u503c\uff0c\u6269\u5bb9\u4e4b\u540e\u9700\u8981\u91cd\u65b0\u5c06\u5df2\u7ecf\u6811\u5316\u7684\u6bcf\u4e2a\u5143\u7d20\u6620\u5c04\u5230\u65b0\u7684\u6876\u4f4d\u4e0a\uff0c\u6b64\u65f6\u82e5\u65b0\u6876\u4f4d\u4e0a\u7684\u8282\u70b9\u6811\u5c0f\u4e8e6\uff0c\u8fd9\u4e0d\u4f1a\u7ee7\u7eed\u7ef4\u6301\u7ea2\u9ed1\u6811\u7684\u7ed3\u6784\nstatic final int UNTREEIFY_THRESHOLD = 6;\n//\u6811\u5316\u9700\u8981\u6ee1\u8db3\u6570\u7ec4\u957f\u5ea6\u6700\u5c0f\u4e3a64\nstatic final int MIN_TREEIFY_CAPACITY = 64;\n</code></pre></p> <p>\u5b57\u6bb5\uff1a Text Only<pre><code>//\u6570\u7ec4\ntransient Node&lt;K,V&gt;[] table;\n//\u65b9\u6cd5keySet() \u548c values()\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u4e0d\u91cd\u8981\ntransient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;\n//\u8282\u70b9\u603b\u6570\ntransient int size;\n//\u4fee\u6539\u6b21\u6570\uff0c\u4e0d\u91cd\u8981\ntransient int modCount;\n//\u6269\u5bb9\u9608\u503c\nint threshold;\n//\u8d1f\u8f7d\u56e0\u5b50\nfinal float loadFactor;\n</code></pre></p> <p>\u6784\u9020\u5668 Text Only<pre><code>/**\n* \u6700\u4e3b\u8981\u7684\u4e00\u4e2a\u6784\u9020\u5668\uff0c\u5176\u5b83\u6784\u9020\u5668\u90fd\u662f\u8c03\u7528\u5b83\uff0c\u53ef\u4ee5\u770b\u5230\u6784\u9020\u5668\u5e76\u6ca1\u6709\u521b\u5efa\u6570\u7ec4\uff0c\u53ea\u662f\u7ed9threshold\u548cloadFactor\u8d4b\u503c\uff0c\u8fd9\u662f\u56e0\u4e3a\u60f3\u5ef6\u8fdf\u521b\u5efa\n*/\npublic HashMap(int initialCapacity, float loadFactor) {\n\u00a0\u00a0\u00a0\u00a0if (initialCapacity &lt; 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalArgumentException(\"Illegal initial capacity: \" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0initialCapacity);\n\u00a0\u00a0\u00a0\u00a0if (initialCapacity &gt; MAXIMUM_CAPACITY)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0initialCapacity = MAXIMUM_CAPACITY;\n\u00a0\u00a0\u00a0\u00a0if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalArgumentException(\"Illegal load factor: \" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loadFactor);\n\u00a0\u00a0\u00a0\u00a0this.loadFactor = loadFactor;\n\u00a0\u00a0\u00a0\u00a0// tableSizeFor(initialCapacity)\u4f1a\u8fd4\u56de\u5927\u4e8e\u7b49\u4e8einitialCapacity\u7684\u6700\u5c0f2\u7684\u5e42\u6b21\uff0c\u7136\u540e\u8d4b\u7ed9threshold\n\u00a0\u00a0\u00a0\u00a0// \u4e3a\u4ec0\u4e48\u8981\u8d4b\u7ed9threshold\u5462\uff1f\u56e0\u4e3aHashMap\u7684\u6570\u7ec4\u88ab\u8bbe\u8ba1\u6210\u5ef6\u8fdf\u521b\u5efa\uff0c\u5148\u8d4b\u7ed9threshold\uff0c\u7b49\u5230\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u65f6\u518d\u8c03\u7528resize()\u65b9\u6cd5\u6269\u5bb9\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u5230\u90a3\u65f6\u624d\u4f1a\u521b\u5efa\u6570\u7ec4\uff0c\u6570\u7ec4\u957f\u5ea6\u4e5f\u5c31\u662fthreshold\uff0c\u7136\u540e\u518d\u7ed9threshold\u8d4b\u65b0\u503c\u5373\u6570\u7ec4\u957f\u5ea6*\u8d1f\u8f7d\u56e0\u5b50\n\u00a0\u00a0\u00a0\u00a0this.threshold = tableSizeFor(initialCapacity);\n}\n\n/**\n* \u4e00\u4e2a\u53c2\u6570\u7684\u6784\u9020\u5668\u8c03\u7528\u4e24\u4e2a\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u8d1f\u8f7d\u56e0\u5b500.75\n*/\npublic HashMap(int initialCapacity) {\n\u00a0\u00a0\u00a0\u00a0this(initialCapacity, DEFAULT_LOAD_FACTOR);\n}\n\n/**\n* \u6700\u5e38\u4f7f\u7528\u7684\u65e0\u53c2\u6784\u9020\u5668\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u8d1f\u8f7d\u56e0\u5b500.75\uff0c\n* \u5176\u5b83\u5b57\u6bb5\u5c31\u76f4\u63a5\u662f\u5bf9\u8c61\u521d\u59cb\u5316\u65f6\u7684\u9ed8\u8ba4\u503c\uff0c\u5982 table=null threshold=0\n*/\npublic HashMap() {\n\u00a0\u00a0\u00a0\u00a0this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted\n}\n</code></pre></p> <p>put()\u65b9\u6cd5 Text Only<pre><code>public V put(K key, V value) {\n\u00a0\u00a0\u00a0\u00a0return putVal(hash(key), key, value, false, true);\n}\n\n/**\n* put()\u65b9\u6cd5\u7684\u6838\u5fc3\u662f\u8fd9\u4e2a\u65b9\u6cd5\n*/\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean evict) {\n\u00a0\u00a0\u00a0\u00a0//\u4e00\u4e9b\u4e34\u65f6\u53d8\u91cf\uff0cn\u662f\u6570\u7ec4\u957f\u5ea6\uff0ci\u662f\u5143\u7d20\u5e94\u8be5\u63d2\u5165\u7684\u6876\u7684\u4f4d\u7f6e\n\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt;[] tab; HashMap.Node&lt;K,V&gt; p; int n, i;\n\u00a0\u00a0\u00a0\u00a0//\u5148\u5c06table\u8d4b\u7ed9\u4e34\u65f6\u53d8\u91cftab\uff0c\u7136\u540e\u518d\u5224\u65ad\u662f\u5426\u4e3a\u7a7a\uff0c\u540e\u9762\u8fd8\u4f1a\u6709\u5f88\u591a\u8fd9\u6837 \u8d4b\u503c\u5e76\u5224\u65ad\u5199\u5728\u4e00\u8d77 \u7684\u9a9a\u64cd\u4f5c\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u8fd9\u4e2aif\u8bed\u53e5\u5c31\u662f\u68c0\u67e5\u6570\u7ec4\u662f\u5426\u4e3a\u7a7a\u6216\u957f\u5ea6\u4e3a0\n\u00a0\u00a0\u00a0\u00a0if ((tab = table) == null || (n = tab.length) == 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6269\u5bb9\u5e76\u8d4b\u503c\uff0c\u5199\u5728\u4e00\u8d77\u7684\u9a9a\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0n = (tab = `resize()`).length;\n\u00a0\u00a0\u00a0\u00a0// \u5df2\u7ecf\u521b\u5efa\u8fc7\u6570\u7ec4\u4e86\uff0ci = (n - 1) &amp; hash \u627e\u5230\u5143\u7d20\u5e94\u8be5\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u770b\u6570\u7ec4\u7684\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u5426\u4e3a\u7a7a\uff0cp\u8fd9\u65f6\u6307\u5411\u4e86\u5934\u5143\u7d20\n\u00a0\u00a0\u00a0\u00a0if ((p = tab[i = (n - 1) &amp; hash]) == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e3a\u7a7a\u5c31\u76f4\u63a5\u653e\u5728\u8fd9\u91cc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tab[i] = newNode(hash, key, value, null);\n\u00a0\u00a0\u00a0\u00a0// \u5df2\u7ecf\u521b\u5efa\u8fc7\u6570\u7ec4\u4e86\uff0c\u4f46\u662f\u5934\u8282\u70b9\u4e0d\u4e3a\u7a7a\uff0c\u5c31\u9700\u8981\u7ee7\u7eed\u5224\u65ad\u4e86\n\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt; e; K k;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// p.hash == hash \u4e0e\u5934\u8282\u70b9\u7684hash\u503c\u76f8\u540c\uff0c\u5e76\u4e14 (k = p.key) == key \u4e0e\u5934\u8282\u70b9\u7684key\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u5143\u7d20 \u6216\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u867d\u7136\u4e0e\u5934\u8282\u70b9\u7684key\u6307\u5411\u7684\u4e0d\u662f\u540c\u4e00\u4e2a\u5143\u7d20\uff0c\u4f46\u662f(key != null &amp;&amp; key.equals(k)) \u4e0e\u5934\u8282\u70b9\u7684\u503c\u76f8\u540c\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u90a3\u4e48\u8d4b\u503c\u7ed9e\uff0c\u7136\u540e\u5230\u6700\u540e\u4e00\u4e2aif\uff0c\u5224\u65ad\u662f\u5426\u66ff\u4ee3\u8282\u70b9\u7684value\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (p.hash == hash &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u4e0e\u5934\u8282\u70b9\u7684Key\u4e0d\u76f8\u540c\uff0c\u5c31\u9700\u8981\u5f80\u4e0b\u8d70\u4e86\uff0c\u8fd9\u91cc\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u6811\u4e86\uff0c\u5982\u679c\u6811\u5316\u4e86\uff0c\u5c31\u6309\u6811\u5316\u7684\u903b\u8f91\u63d2\u5165\u6216\u8005\u66ff\u6362\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (p instanceof HashMap.TreeNode)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e = ((HashMap.TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6309\u94fe\u8868\u7684\u903b\u8f91\u8d70\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u904d\u5386\u5934\u8282\u70b9\u540e\u9762\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int binCount = 0; ; ++binCount) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8d70\u5230\u5c3e\u4e86\uff0c\u76f4\u63a5\u63d2\u5165\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((e = p.next) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u76f4\u63a5\u63d2\u5165\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0p.next = newNode(hash, key, value, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u5df2\u7ecf\u904d\u53867\u4e2a\u5143\u7d20\u4e86\uff0c\u52a0\u4e0a\u6700\u540e\u521b\u5efa\u7684\u8fd9\u4e2a\u4e5f\u5c31\u662f\u94fe\u8868\u4e0a\u4e0d\u5305\u62ec\u5934\u8282\u70b9\u67098\u4e2a\u8282\u70b9\u4e86\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u65f6\u9700\u8981\u6811\u5316\uff0ctreeifyBin(tab, hash);\u65b9\u6cd5\u9996\u5148\u4f1a\u5224\u65ad\u6570\u7ec4\u7684\u957f\u5ea6\u662f\u5426\u5c0f\u4e8e64\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c0f\u4e8e\u76f4\u63a5\u6269\u5bb9\uff0c\u5927\u4e8e\u624d\u6811\u5316\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0treeifyBin(tab, hash);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd8\u6ca1\u8d70\u5230\u672b\u5c3e\uff0c\u53d1\u73b0\u6709key\u76f8\u540c\u7684\uff0c\u90a3\u4e48break\u51fa\u53bb\uff0c\u540e\u9762\u7684if\u4f1a\u5224\u65ad\u662f\u5426\u66ff\u6362value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (e.hash == hash &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0p = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u66ff\u6362value\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (e != null) { // existing mapping for key\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0V oldValue = e.value;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// onlyIfAbsent\u8868\u793a\u53ea\u6709\u7f3a\u5c11\u624d\u505a\u66ff\u6362\uff0c\u8c03\u7528put\u5c31\u662ffalse\uff0c\u4e5f\u5c31\u662f\uff0c\u66ff\u6362value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u4e2a\u8c03\u7528putIfAbsent()\u65b9\u6cd5\u624d\u6709\u7528\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!onlyIfAbsent || oldValue == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.value = value;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0afterNodeAccess(e);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return oldValue;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0++modCount;\n\u00a0\u00a0\u00a0\u00a0//size\u52a01\uff0c\u5982\u679c\u8d85\u8fc7\u9608\u503c\u5c31\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0if (++size &gt; threshold)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`resize();`\n\u00a0\u00a0\u00a0\u00a0afterNodeInsertion(evict);\n\u00a0\u00a0\u00a0\u00a0return null;\n}\n\n// \u8be5\u65b9\u6cd5\u9996\u5148\u4f1a\u5224\u65ad\u6570\u7ec4\u7684\u957f\u5ea6\u662f\u5426\u5c0f\u4e8e64\uff0c\u5c0f\u4e8e\u76f4\u63a5\u6269\u5bb9\uff0c\u5927\u4e8e\u624d\u6811\u5316\u3002\nfinal void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) {\n\u00a0\u00a0\u00a0\u00a0int n, index; Node&lt;K,V&gt; e;\n\u00a0\u00a0\u00a0\u00a0if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`resize()`;\n\u00a0\u00a0\u00a0\u00a0else if ((e = tab[index = (n - 1) &amp; hash]) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; hd = null, tl = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0do {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (tl == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hd = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0p.prev = tl;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tl.next = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tl = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} while ((e = e.next) != null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((tab[index] = hd) != null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hd.treeify(tab);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u6269\u5bb9\u65b9\u6cd5 Text Only<pre><code>/**\n* \u6269\u5bb9\u65b9\u6cd5\n*/\nfinal HashMap.Node&lt;K,V&gt;[] resize() {\n\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt;[] oldTab = table;\n\u00a0\u00a0\u00a0\u00a0// \u65e7\u5bb9\u91cf\n\u00a0\u00a0\u00a0\u00a0int oldCap = (oldTab == null) ? 0 : oldTab.length;\n\u00a0\u00a0\u00a0\u00a0// \u65e7\u9608\u503c\n\u00a0\u00a0\u00a0\u00a0int oldThr = threshold;\n\u00a0\u00a0\u00a0\u00a0// \u65b0\u5bb9\u91cf\uff0c\u65b0\u9608\u503c\uff0c\u4e0b\u9762\u5341\u51e0\u884c\u90fd\u662f\u5728\u786e\u5b9a\u5b83\u4fe9\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0int newCap, newThr = 0;\n\u00a0\u00a0\u00a0\u00a0// \u65e7\u5bb9\u91cf\u5927\u4e8e0\uff0c\u6570\u7ec4\u4e0d\u4e3a\u7a7a\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u6b21`\u5e38\u89c4\u7684\u6269\u5bb9\u64cd\u4f5c`\n\u00a0\u00a0\u00a0\u00a0if (oldCap &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u65e7\u5bb9\u91cf\u5927\u4e8e\u6700\u5927\u5bb9\u91cf\uff0c\u4e00\u822c\u5f88\u5c11\u51fa\u73b0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (oldCap &gt;= MAXIMUM_CAPACITY) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threshold = Integer.MAX_VALUE;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return oldTab;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5148\u628a\u65e7\u5bb9\u91cf\u7684\u4e24\u500d\u8d4b\u7ed9\u65b0\u5bb9\u91cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u65e7\u5bb9\u91cf\u5c0f\u4e8e16\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oldCap &gt;= DEFAULT_INITIAL_CAPACITY)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u65e7\u5bb9\u91cf\u5c0f\u4e8e16\uff0c\u4e0d\u4f1a\u628a\u65e7\u7684\u9608\u503c\u8d4b\u7ed9\u65b0\u9608\u503c\uff08\u60c5\u51b5\u4e00\uff0c\u4e0b\u9762\u7684if\u8bed\u53e5\u518d\u4f1a\u7ed9newThr\u8d4b\u503c\uff09\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0d\u5c0f\u4e8e\u76f4\u63a5\u628a\u65e7\u9608\u503c\u7684\u4e24\u500d\u8d4b\u7ed9\u65b0\u9608\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newThr = oldThr &lt;&lt; 1; // double threshold\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0// \u8d70\u5230\u8fd9\u8868\u793a\u65e7\u5bb9\u91cf\u4e3a0\uff0c\u65e7\u9608\u503c\u5927\u4e8e0\uff0c\u53ea\u6709\u8c03\u7528\u6709\u53c2\u6784\u9020\uff0c\u5728\u7b2c\u4e00\u6b21\u5f80map\u4e2d\u6dfb\u52a0\u5143\u7d20\u624d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\n\u00a0\u00a0\u00a0\u00a0else if (oldThr &gt; 0) // initial capacity was placed in threshold\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u65e7\u9608\u503c\u8d4b\u7ed9\u65b0\u5bb9\u91cf\uff08\u60c5\u51b5\u4e8c\uff0c\u4e0b\u9762\u7684if\u8bed\u53e5\u518d\u4f1a\u7ed9newThr\u8d4b\u503c\uff09\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newCap = oldThr;\n\u00a0\u00a0\u00a0\u00a0// \u8d70\u5230\u8fd9\u8868\u793a\u65e7\u5bb9\u91cf\u4e3a0\uff0c\u65e7\u9608\u503c\u4e5f\u4e3a0\uff0c\u53ea\u6709\u8c03\u7528\u65e0\u53c2\u6784\u9020\uff0c\u5728\u7b2c\u4e00\u6b21\u5f80map\u4e2d\u6dfb\u52a0\u5143\u7d20\u624d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\n\u00a0\u00a0\u00a0\u00a0else {\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// zero initial threshold signifies using defaults\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u65b0\u5bb9\u91cf\u7b49\u4e8e16\uff0c\u65b0\u9608\u503c\u7b49\u4e8e12\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newCap = DEFAULT_INITIAL_CAPACITY;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u65b0\u9608\u503c\u7b49\u4e8e0\uff0c\u7ed9\u4e0a\u9762\u7684\u4e24\u79cd\u60c5\u51b5\u7684newThr\u8d4b\u503c\n\u00a0\u00a0\u00a0\u00a0if (newThr == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0float ft = (float)newCap * loadFactor;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(int)ft : Integer.MAX_VALUE);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u65b0\u9608\u503c\u8d4b\u7ed9\u6210\u5458\u53d8\u91cf\n\u00a0\u00a0\u00a0\u00a0threshold = newThr;\n\u00a0\u00a0\u00a0\u00a0//\u81f3\u6b64\uff0c\u65b0\u5bb9\u91cf\u548c\u65b0\u9608\u503c\u65e7\u786e\u5b9a\u5b8c\u6210\u4e86\n\n\u00a0\u00a0\u00a0\u00a0//\u6269\u5bb9\u64cd\u4f5c\u5f00\u59cb\n\u00a0\u00a0\u00a0\u00a0@SuppressWarnings({\"rawtypes\",\"unchecked\"})\n\u00a0\u00a0\u00a0\u00a0//\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt;[] newTab = (HashMap.Node&lt;K,V&gt;[])new HashMap.Node[newCap];\n\u00a0\u00a0\u00a0\u00a0table = newTab;\n\u00a0\u00a0\u00a0\u00a0//\u4e0d\u662f\u7b2c\u4e00\u6b21\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0if (oldTab != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u904d\u5386\u6570\u7ec4\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int j = 0; j &lt; oldCap; ++j) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt; e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6570\u7ec4\u5143\u7d20\u4e0d\u4e3a\u7a7a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((e = oldTab[j]) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u65e7\u6570\u7ec4\u5143\u7d20\u7f6e\u7a7a\u662f\u4e3a\u4e86\u65b9\u4fbfGC\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oldTab[j] = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6ca1\u6709\u4e0b\u4e00\u4e2a\u5143\u7d20\uff0c\u4e5f\u5c31\u662f\u53ea\u6709\u5934\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (e.next == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u76f4\u63a5\u628a\u8fd9\u4e2a\u5143\u7d20\u653e\u5230\u65b0\u6570\u7ec4\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newTab[e.hash &amp; (newCap - 1)] = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5426\u5219\uff0c\u5982\u679c\u662f\u6811\uff0c\u628a\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u91cd\u65b0\u6563\u5217\u5230\u65b0\u6570\u7ec4\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (e instanceof HashMap.TreeNode)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((HashMap.TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5426\u5219\uff0c\u5219\u662f\u94fe\u8868\uff0c\u628a\u94fe\u8868\u7684\u6bcf\u4e2a\u8282\u70b9\u91cd\u65b0\u6563\u5217\u5230\u65b0\u6570\u7ec4\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else { // preserve order\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd9\u91cc\u6d89\u53ca\u5230\u4e00\u4e2a\u7b97\u6cd5\uff0c\u5c31\u662f\u6309\u500d\u6570\u6269\u5bb9\u4e4b\u540e\uff0c\u91cd\u65b0\u6563\u5217\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u662f\u6563\u5217\u5230\u65b0\u6570\u7ec4\u76f8\u540c\u7684\u4f4d\u7f6e\u4e0a\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e8c\u662f\u6563\u5217\u5230\u65b0\u6570\u7ec4\u7684\u4f4d\u7f6e=\u539f\u6765\u7684\u4f4d\u7f6e+\u539f\u6765\u7684\u5bb9\u91cf\uff0c\u56e0\u4e3a\u4f4d\u7f6e\u662f\u8fd9\u6837\u8ba1\u7b97\u7684 hash &amp; (n-1)\uff0cn\u662f\u6570\u7ec4\u5bb9\u91cf\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e24\u6b21\u7ed3\u679c\u4f4e\u4f4d\u662f\u76f8\u540c\u7684\uff0c\u53ea\u6709\u65b0\u589e\u52a0\u7684\u9ad8\u4f4d\u4e0d\u540c\uff0c0\u6216\u8005\u662f1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt; loHead = null, loTail = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt; hiHead = null, hiTail = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap.Node&lt;K,V&gt; next;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0do {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0next = e.next;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u9ad8\u4f4d\u662f0\u7684\u94fe\u8d77\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((e.hash &amp; oldCap) == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (loTail == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loHead = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loTail.next = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loTail = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u9ad8\u4f4d\u662f1\u7684\u94fe\u8d77\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (hiTail == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hiHead = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hiTail.next = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hiTail = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} while ((e = next) != null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u653e\u5230\u65b0\u6570\u7ec4\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (loTail != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loTail.next = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newTab[j] = loHead;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (hiTail != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hiTail.next = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0newTab[j + oldCap] = hiHead;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return newTab;\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/9-docker/","title":"9-docker","text":"<p> \u7ea6 2895 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 58 \u5206\u949f</p> <p>docker\u5b98\u65b9\u5b89\u88c5\u6559\u7a0b\uff1a</p> <p>https://docs.docker.com/engine/install/centos/#install-using-the-repository</p> <p>\u963f\u91cc\u4e91docker\u955c\u50cf\u52a0\u901f\u5668\uff1a</p> <p>https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors</p> Text Only<pre><code>sudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'\n{\n  \"registry-mirrors\": [\"https://lvq55l26.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n</code></pre> <p>CentOs\u5e38\u7528\u547d\u4ee4\uff1a</p> <ul> <li>\u5f00\u542fdocker\u670d\u52a1</li> </ul> Text Only<pre><code>systemctl start docker\n</code></pre> <ul> <li>\u67e5\u770b\u8fdb\u7a0b\u72b6\u6001</li> </ul> Text Only<pre><code>systemctl status docker\n</code></pre> <ul> <li>\u67e5\u770b\u7cfb\u7edf\u5168\u90e8\u7684\u8fdb\u7a0b</li> </ul> Text Only<pre><code>ps -ef\n</code></pre> <ul> <li>\u6dfb\u52a0\u8def\u7531</li> </ul> Text Only<pre><code> ip route add 172.16.0.0/16 via 172.16.5.1 dev ens192\n</code></pre> <ul> <li>\u5220\u9664\u8def\u7531</li> </ul> Text Only<pre><code> ip route del 172.16.0.0/16\n</code></pre> <ul> <li>\u505c\u6b62docker</li> </ul> Text Only<pre><code>systemctl stop docker\nsystemctl stop docker.socket\n</code></pre> <p>docker\u5e38\u7528\u547d\u4ee4\uff1a</p> <ul> <li>\u67e5\u770bdocker\u7248\u672c</li> </ul> Text Only<pre><code>docker version\n</code></pre> <ul> <li>\u5217\u51fa\u672c\u5730\u955c\u50cf</li> </ul> Text Only<pre><code>docker images\n  Options:\n    -a             \u5217\u51fa\u672c\u5730\u6240\u6709\u955c\u50cf\uff08\u542b\u4e2d\u95f4\u6620\u50cf\u5c42\uff09\n    -q             \u53ea\u663e\u793a\u955c\u50cfID\n    --digests    \u663e\u793a\u955c\u50cf\u7684\u6458\u8981\u4fe1\u606f\n    --no-trunc  \u663e\u793a\u5b8c\u6574\u7684\u955c\u50cf\u4fe1\u606f\ndocker images -qa\n</code></pre> <ul> <li>\u5728\u5b98\u65b9\u7684Docker Hub\u4e0a\u641c\u7d22\u67d0\u4e2a\u955c\u50cf</li> </ul> Text Only<pre><code>docker search &lt;\u955c\u50cf\u540d&gt;\n  Options:\n    -s    \u6307\u5b9a\u6700\u5c11\u7684star\u6570\n</code></pre> <ul> <li>\u62c9\u53d6\u955c\u50cf</li> </ul> Text Only<pre><code>docker pull &lt;\u955c\u50cf&gt;\n</code></pre> <ul> <li>\u6839\u636e\u955c\u50cf\u521b\u5efa\u5bb9\u5668\u5e76\u8fd0\u884c</li> </ul> <p>\u4e0d\u5e26 -d \u53c2\u6570\u65f6\u4f1a\u5728\u524d\u53f0\u542f\u52a8\u5bb9\u5668\uff0c\u6240\u8c13\u5728\u524d\u53f0\u542f\u52a8\u5c31\u662f\u8c03\u5ea6\u7684\u4f18\u5148\u7ea7\u9ad8\u5e76\u4e14\u5360\u7528\u6807\u51c6\u8f93\u5165\u8f93\u51fa\uff0c\u5982\u679c\u8fd9\u65f6\u7a0b\u5e8f\u6ca1\u6709\u4efb\u4f55\u963b\u585e\uff08\u6bd4\u5982 \u7b49\u5f85\u5efa\u7acb\u8fde\u63a5  \u6216\u8005 \u7b49\u5f85\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u5165 \u7b49\uff09\u3001\u4e5f\u6ca1\u6709\u5411\u6807\u51c6\u8f93\u51fa\u5199\u4efb\u4f55\u5185\u5bb9\uff0c\u8fd8\u6ca1\u6709\u6267\u884c\u7e41\u91cd\u7684\u8ba1\u7b97\u4efb\u52a1\uff0c\u90a3\u4e48\u5bb9\u5668\u5f88\u5feb\u5c31\u5728\u524d\u53f0\u6267\u884c\u5b8c\u6210\u5e76\u7ed3\u675f\uff0c\u8868\u73b0\u6210\u597d\u50cf\u4ec0\u4e48\u90fd\u6ca1\u6709\u53d1\u751f\u8fc7\u3002\u52a0\u4e0a-d\u53c2\u6570\u5c31\u662f\u8ba9\u7a0b\u5e8f\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u4e0d\u4f1a\u5360\u7528\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u3002</p> <p>\u52a0\u4e0a -it \u53c2\u6570\u4f1a\u5728\u542f\u52a8\u5bb9\u5668\u7684\u540c\u65f6\u5f00\u542f\u5e76\u8fdb\u5165\u4ea4\u4e92\u5f0f\u7ec8\u7aef\uff0c\u4e3b\u8981\u662f-i \uff0c\u5b83\u4f1a\u628a\u6807\u51c6\u8f93\u5165\uff0c\u8f93\u51fa\uff0c\u9519\u8bef\u6d41\u90fd\u4ea4\u7ed9\u5bb9\u5668\uff0c\u5f53\u7136\u8fd9\u8981\u6c42\u88ab\u542f\u52a8\u7684\u7a0b\u5e8f\u5fc5\u987b\u80fd\u7b49\u5f85\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u5165\uff0c\u5982\u679c\u7a0b\u5e8f\u6ca1\u6709\u7b49\u5f85\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u5165\uff0c\u90a3\u4e48\u5373\u4f7fdocker\u7ed9\u4f60\u5f00\u542f\u4e86\u6807\u51c6\u8f93\u5165\u4e5f\u662f\u767d\u642d\uff1b\u8fd8\u6709\uff0c\u5373\u4f7f\u7a0b\u5e8f\u662f\u5728\u7b49\u5f85\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u5165\uff0c\u4f46\u662f\u4f60\u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u6ca1\u6709\u7528-i\u53c2\u6570\u6307\u5b9adocker\u4e3a\u5176\u5f00\u542f\u6807\u51c6\u8f93\u5165\uff0c\u90a3\u4e5f\u4e0d\u884c\u3002\u6bd4\u5982\u8fd0\u884ccentos\u65f6\uff0c\u7f3a\u7701\u547d\u4ee4\u662f'/bin/bash'\uff08\u6784\u5efa\u65f6Dockerfile\u6587\u4ef6\u6700\u540e\u4e00\u884c\u662f CMD /bin/bash\uff09\uff0c\u4ece\u800c\u5f00\u542f\u4e86\u7ec8\u7aef\u7b49\u5f85\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u5165\uff0c\u5982\u679c\u8fd9\u65f6\u6ca1\u6709\u4e3a\u5176\u5f00\u542f\u6807\u51c6\u8f93\u5165\uff0c\u90a3\u4e5f\u4e0d\u884c\u3002</p> Text Only<pre><code>docker run &lt;\u955c\u50cf\u540d&gt;\n  Options:\n      -d      \u540e\u53f0\u542f\u52a8\n      -it     \u542f\u52a8\u7684\u540c\u65f6\u5f00\u542f\u5e76\u8fdb\u5165\u4ea4\u4e92\u5f0f\u7ec8\u7aef\uff08-i\u548c-t\u7684\u5408\u4f53\uff09\uff0c\n          -i (interactive) \u5f00\u542f\u6807\u51c6\u8f93\u5165\uff0c\u4ee5\u4ea4\u4e92\u5f0f\u7684\u65b9\u5f0f\u542f\u52a8\n          -t (pseudo-tty) \u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\n    --name  \u7ed9\u5bb9\u5668\u8d77\u4e00\u4e2a\u540d\u5b57\n    -p &lt;\u5bbf\u4e3b\u673a\u7aef\u53e3&gt;:&lt;\u5bb9\u5668\u7aef\u53e3&gt; \u542f\u52a8\u5bb9\u5668\u65f6\u505a\u7aef\u53e3\u6620\u5c04\n    -P \u542f\u52a8\u5bb9\u5668\u65f6\u968f\u673a\u5206\u914d\u5bbf\u4e3b\u673a\u7aef\u53e3\n    -v &lt;\u5bbf\u4e3b\u673a\u76ee\u5f55&gt;:&lt;\u5bb9\u5668\u76ee\u5f55&gt;[:ro] \u7ed1\u5b9a\u6302\u8f7d\u6570\u636e\u5377\n    --volume-from &lt;\u5bb9\u5668&gt; \u6302\u8f7d\u6307\u5b9a\u7684\u5bb9\u5668\u4e2d\u7684\u6570\u636e\u5377\n    --restart \u8bbe\u7f6e\u5bb9\u5668\u7684\u91cd\u542f\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e0d\u91cd\u542f\n        always \u53ea\u6709\u4f7f\u7528docekr stop\u547d\u4ee4\u505c\u6b62\u5bb9\u5668\u624d\u4e0d\u4f1a\u91cd\u542f\uff0c\u5176\u5b83\u60c5\u51b5\u5bfc\u81f4\u5bb9\u5668\u505c\u6b62\uff0cdocker\u90fd\u4f1a\u91cd\u65b0\u542f\u52a8\u5bb9\u5668\uff0c\u5305\u62ecdocker\u91cd\u542f                 \u4e5f\u4f1a\u91cd\u65b0\u542f\u52a8\u8be5\u5bb9\u5668\n        unless-stopped \u4e0ealways\u7684\u53ea\u6709\u4e00\u4e2a\u5dee\u522b\u5c31\u662fdocker\u91cd\u542f\u65f6\u4e0d\u4f1a\u542f\u52a8\u8be5\u5bb9\u5668\n        on-failure[:&lt;\u5931\u8d25\u91cd\u542f\u6b21\u6570&gt;] \u5bb9\u5668\u9000\u51fa\u65f6\u8fd4\u56de\u503c\u4e0d\u662f0\u7684\u65f6\u5019\u5c31\u4f1a\u91cd\u542f\u5bb9\u5668\n    --rm \u5982\u679c\u5bb9\u5668\u5df2\u7ecf\u5b58\u5728\u90a3\u5c31\u81ea\u52a8\u79fb\u9664\n</code></pre> <p>\u4f8b\u5b50\uff1a</p> Text Only<pre><code>docker run centos /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n</code></pre> <ul> <li> <p>\u8fd0\u884cmysql\u955c\u50cf</p> Text Only<pre><code>docker run -p 3306:3306 --name mysql \\\n-v /mysql/cof:/etc/mysql/conf.d -v /mysql/logs \\\n-v /mysql/logs:/logs \\\n-v /mysql/data:/var/lib/mysql \\\n-e MYSQL_ROOT_PASSWORD=123456 \\\n-d mysql:8.0\n</code></pre> </li> <li> <p>\u8fd0\u884credis\u955c\u50cf</p> Text Only<pre><code>docker run -p 6379:6379 \\\n-v /myredis/data:data \\\n-v /myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf \\\n-d redis:3.2 redis-server /usr/local/etc/redis/redis.conf --appendonly yes\n</code></pre> </li> <li> <p>\u663e\u793a\u5bb9\u5668</p> </li> </ul> Text Only<pre><code>docker ps\n  \u4e0d\u5e26\u53c2\u6570\u8868\u793a\u663e\u793a\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\n  Options:\n    -a \u663e\u793a\u6240\u6709\u5bb9\u5668\uff0c\u5305\u62ec\u505c\u6389\u4e86\u7684\uff08\u6240\u6709\u72b6\u6001\uff09\n    -l \u663e\u793a\u4e0a\u4e00\u6b21\u521b\u5efa\u7684\u5bb9\u5668\uff08\u6240\u6709\u72b6\u6001\uff09\n    -n &lt;\u6570\u91cf&gt; \u663e\u793a\u524dn\u6b21\u521b\u5efa\u7684\u5bb9\u5668\uff08\u6240\u6709\u72b6\u6001\uff09\n    -q \u53ea\u663e\u793a\u5bb9\u5668\u7684\u7f16\u53f7\uff0c\u9700\u8981\u4e0e-a\u6216-l\u642d\u914d\u4f7f\u7528\n</code></pre> <ul> <li>\u67e5\u770b\u5bb9\u5668\u65e5\u5fd7</li> </ul> Text Only<pre><code>dockers logs &lt;\u5bb9\u5668&gt;\n  Options:\n    -f  \u8ddf\u968f\u65e5\u5fd7\u6700\u65b0\u8f93\u51fa\n    -t  \u663e\u793a\u65f6\u95f4\u6233\n    --tail &lt;\u6570\u5b57&gt;  \u663e\u793a\u65e5\u5fd7\u672b\u5c3e\u51e0\u884c\uff08\u8fd9\u662flinux\u7684\u5e38\u7528\u547d\u4ee4\uff09\n</code></pre> <ul> <li>\u67e5\u770b\u5bb9\u5668\u5185\u7684\u8fdb\u7a0b</li> </ul> Text Only<pre><code>docker top &lt;\u5bb9\u5668&gt;\n</code></pre> <ul> <li>\u67e5\u770b\u7ec6\u8282</li> </ul> Text Only<pre><code>docker inspect &lt;\u5bb9\u5668/\u955c\u50cf&gt;\n  Options:\n    --format \u4f7f\u7528\u7ed9\u5b9a\u7684Go\u6a21\u677f\u683c\u5f0f\u5316\u8f93\u51fa\n    \u4f8b\u5982\uff1a\n      \u67e5\u770b\u955c\u50cf\u7684\u5206\u5c42\u4fe1\u606f\uff1adocker inspect --format {{.RootFS}} &lt;\u955c\u50cf&gt;\n      \u67e5\u770b\u955c\u50cf\u7684\u6570\u636e\u5377\u4fe1\u606f\uff1adocker inspect --format {{.ContainerConfig.Volumes}} &lt;\u955c\u50cf&gt;\n</code></pre> <ul> <li>\u9000\u51fa\u4ea4\u4e92\u5f0f\u7ec8\u7aef\u5e76\u505c\u6b62\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668</li> </ul> Text Only<pre><code>exit\n</code></pre> <ul> <li>\u9000\u51fa\u4ea4\u4e92\u5f0f\u7ec8\u7aef\u4f46\u4e0d\u505c\u6b62\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668</li> </ul> Text Only<pre><code>ctrl \u5148\u6309 p \u518d\u6309 q \uff08\u6ce8\uff1a\u5728ssh\u7ec8\u7aef\u91cc\u65e0\u6cd5\u64cd\u4f5c\uff0c\u5728linux\u7684\u7ec8\u7aef\u91cc\u53ef\u4ee5\uff09\n</code></pre> <ul> <li>\u91cd\u65b0\u8fdb\u5165\u4e0e\u5bb9\u5668\u4ea4\u4e92\u7684\u7ec8\u7aef\uff0c\u4e5f\u5c31\u662f\u628a\u6807\u51c6\u8f93\u5165\uff0c\u8f93\u51fa\uff0c\u9519\u8bef\u6d41\u90fd\u4ea4\u7ed9\u6307\u5b9a\u7684\u5bb9\u5668</li> </ul> Text Only<pre><code>docker attach &lt;\u5bb9\u5668&gt;\n</code></pre> <ul> <li>\u8ba9\u5bb9\u5668\u6267\u884c\u547d\u4ee4\uff08\u6ca1\u6709\u8fdb\u5165\u4e0e\u5bb9\u5668\u4ea4\u4e92\u7684\u7ec8\u7aef\uff09</li> </ul> Text Only<pre><code>docker exec &lt;\u5bb9\u5668&gt; &lt;\u547d\u4ee4&gt;\n</code></pre> Text Only<pre><code>\u5982\u91cd\u65b0\u8fdb\u5165\u4e0e\u5bb9\u5668\u4ea4\u4e92\u7684\u7ec8\u7aef\uff1a`docker exec -it &lt;\u5bb9\u5668&gt; /bin/bash` \uff0c\u8fd9\u91cc -i \u4f1a\u628a\u6807\u51c6\u8f93\u5165\uff0c\u8f93\u51fa\uff0c\u9519\u8bef\u6d41\u90fd\u4ea4\u7ed9\u6307\u5b9a\u7684\u5bb9\u5668\uff0c-t \u4f1a\u5728\u5bb9\u5668\u91cc\u65b0\u5f00\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff08\u4e0eattach\u547d\u4ee4\u4e0d\u540c\uff0cattach\u547d\u4ee4\u662f\u4e0d\u4f1a\u65b0\u5f00\u7ec8\u7aef\uff0c\u800c\u662f\u8fdb\u5165\u5df2\u6709\u7684\u8fdb\u7a0b\uff09\uff0c\u5982\u679c\u8fd9\u65f6\u5728\u8fd9\u4e2a\u65b0\u5f00\u7684\u4f2a\u7ec8\u7aef\u91cc\u8f93\u5165exit\u4f1a\u9000\u51fa\u8be5\u7ec8\u7aef\uff0c\u4f46\u4e0d\u4f1a\u5bfc\u81f4\u5bb9\u5668\u5173\u95ed\uff0c**\u53ea\u6709\u5f53\u6740\u6b7b\u5bb9\u5668\u4e2d\u7684\u4e3b\u8fdb\u7a0b\uff0c\u4e5f\u5373PID\u4e3a1\u7684\u8fdb\u7a0b\uff0c\u624d\u4f1a\u6740\u6b7b\u5bb9\u5668**\u3002\n</code></pre> <ul> <li>\u5728\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u4e4b\u95f4\u62f7\u8d1d\u6587\u4ef6</li> </ul> Text Only<pre><code>docker cp src_path dest_path    \u6ce8\u610f\uff1a\u5bb9\u5668\u4e2d\u8def\u5f84\u7684\u5199\u6cd5\u662f&lt;\u5bb9\u5668&gt;:&lt;\u6587\u4ef6\u8def\u5f84&gt;\n</code></pre> <ul> <li>\u5728\u540e\u53f0\u542f\u52a8\u5df2\u7ecf\u505c\u6b62\u7684\u5bb9\u5668</li> </ul> Text Only<pre><code>docker start &lt;\u5bb9\u5668&gt;\n</code></pre> <ul> <li>\u91cd\u542f\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668</li> </ul> Text Only<pre><code>docker restart &lt;\u5bb9\u5668&gt;\n</code></pre> <ul> <li>\u505c\u6b62\u5bb9\u5668</li> </ul> Text Only<pre><code>docker stop &lt;\u5bb9\u5668&gt;\n</code></pre> <ul> <li>\u5f3a\u5236\u505c\u6b62\u5bb9\u5668</li> </ul> Text Only<pre><code>docker kill &lt;\u5bb9\u5668&gt;\n</code></pre> <ul> <li>\u5220\u9664\u5bb9\u5668</li> </ul> Text Only<pre><code>docker rm &lt;\u5bb9\u5668&gt;\n\u5220\u9664\u5168\u90e8\u7684\u5bb9\u5668\u7684\u4e24\u6761\u547d\u4ee4\uff1a\n  docker rm $(docker ps -qa) \uff0cdocker -qa\u8fd4\u56de\u7684\u662f\u5168\u90e8\u5bb9\u5668\u7684ID\n  docker ps -qa | xargs docker rm\n</code></pre> <ul> <li>\u5220\u9664\u955c\u50cf</li> </ul> <p>\u5982\u679c\u901a\u8fc7\u955c\u50cf\u521b\u5efa\u4e86\u5bb9\u5668\uff0c\u90a3\u4e48\u8be5\u955c\u50cf\u5c31\u88ab\u5bb9\u5668\u6240\u4f9d\u8d56\u4e86\uff0c\u5220\u9664\u64cd\u4f5c\u5c06\u4e0d\u88ab\u5141\u8bb8\u3002</p> Text Only<pre><code>docker rmi &lt;\u955c\u50cf&gt;\n</code></pre> <ul> <li>\u63d0\u4ea4\u5bb9\u5668\u751f\u6210\u955c\u50cf</li> </ul> Text Only<pre><code>docker commit -a -m &lt;\u5bb9\u5668&gt; \u955c\u50cf\u540d:tag\n-a \u4f5c\u8005\n-m \u63d0\u4ea4\u4fe1\u606f \n\u955c\u50cf\u540d\u5982 jmoon/tomcat:1.0\n</code></pre> <ul> <li>\u6839\u636eDockerFile\u6784\u5efa\u955c\u50cf</li> </ul> Text Only<pre><code>docker build -f &lt;dockerfile&gt; -t &lt;\u955c\u50cf\u540d:tag&gt; &lt;\u6784\u5efa\u4e0a\u4e0b\u6587&gt;\n</code></pre> <p>\u4e0d\u52a0 -f \u9009\u9879\u9ed8\u8ba4\u8bfb\u53d6\u5f53\u524d\u8def\u5f84\u4e0b\u7684 Dockerfile\uff0c\u6784\u5efa\u4e0a\u4e0b\u6587\uff08Build Context\uff09\u5c31\u662f\u5e94\u7528\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u6700\u4f73\u5b9e\u8df5\u5c31\u662f\u628aDockerfile\u6587\u4ef6\u653e\u5728\u5e94\u7528\u6587\u4ef6\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u5728\u5e94\u7528\u6587\u4ef6\u6839\u76ee\u5f55\u4e0b\u6267\u884c<code>docker build -t &lt;\u955c\u50cf\u540d:tag&gt; .</code></p> <ul> <li>\u67e5\u770b\u955c\u50cf\u6784\u5efa\u7684\u5386\u53f2\u4fe1\u606f</li> </ul> Text Only<pre><code>docker history &lt;\u955c\u50cf&gt;\n</code></pre> <ul> <li>\u63a8\u9001\u955c\u50cf\u5230Hub</li> </ul> Text Only<pre><code>1.\u767b\u5f55\u963f\u91cc\u4e91Docker Registry\n    docker login registry.cn-shenzhen.aliyuncs.com\n2.\u7ed9\u8981\u63a8\u9001\u955c\u50cf\u518d\u547d\u4e00\u4e2a\u540d\u5e76\u6807\u8bb0\u4e0a\u7248\u672c\u53f7\uff0c\u547d\u540d\u89c4\u8303\u662f \u963f\u91cc\u4e91DockerRegistry\u5730\u5740/\u547d\u540d\u7a7a\u95f4/\u955c\u50cf\u4ed3\u5e93:[\u955c\u50cf\u7248\u672c\u53f7]\n    docker tag &lt;\u955c\u50cf&gt; registry.cn-shenzhen.aliyuncs.com/jmoon531/myalpine:[\u955c\u50cf\u7248\u672c\u53f7]\n3.\u63a8\u9001\u955c\u50cf\n    docker push registry.cn-shenzhen.aliyuncs.com/jmoon531/myalpine:[\u955c\u50cf\u7248\u672c\u53f7]\n</code></pre> <p>\u955c\u50cf\u6ce8\u518c\uff08<code>image register</code> \uff09\u3001\u955c\u50cf\u4ed3\u5e93\uff08<code>image repository</code>\uff09\u3001\u955c\u50cf\uff08 <code>image</code>\uff09\u7684\u5173\u7cfb\uff1a</p> <p><code>image register</code>\u7ffb\u8bd1\u662f\u955c\u50cf\u6ce8\u518c\u7c3f\u6216\u955c\u50cf\u767b\u8bb0\u7c3f\uff0c\u4e5f\u5c31\u662fDockerHub\u7684\u5730\u5740\uff0c\u9ed8\u8ba4\u662fdocker.io\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662f\u7b2c\u4e09\u65b9Hub\u5982\u963f\u91cc\u4e91\uff0c\u90a3\u4e48\u9700\u8981\u660e\u786e\u6307\u51faregistry.cn-shenzhen.aliyuncs.com\u3002\u547d\u4ee4<code>docker pull jmoon/mycentos</code> \u8868\u793a\u5728docker.io\uff0c\u62c9\u53d6\u4e8c\u7ea7\u547d\u540d\u7a7a\u95f4jmoon\u4e0b\u7684mycentos\u955c\u50cf\u4ed3\u5e93\u91cc\u7684\u6807\u7b7e\u4e3alatest\u7684\u955c\u50cf\uff0c\u4e3b\u8981\u662f\u8981\u77e5\u9053mycentos\u955c\u50cf\u4ed3\u5e93\u91cc\u6709\u8bb8\u591a\u4e0d\u540c\u7248\u672c\u7684mycentos\u955c\u50cf\u3002</p> <p>Dockerfile\u6587\u4ef6\u7528\u4e8e\u6784\u5efa\u955c\u50cf</p> Text Only<pre><code>FROM \u7236\u955c\u50cf\nMAINTAINER \u521b\u5efa\u955c\u50cf\u7684\u4f5c\u8005\u4fe1\u606f\nRUN \u6267\u884c\u547d\u4ee4\uff0c\u4e00\u6761RUN\u547d\u4ee4\u6267\u884c\u5b8c\u540e\u4f1a\u5728\u5f53\u524d\u955c\u50cf\u5c42\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u955c\u50cf\u5c42\nEXPOSE \u6307\u660e\u5bb9\u5668\u5411\u5916\u5f00\u653e\u7684\u7aef\u53e3\nWORKDIR \u4e3a\u63a5\u4e0b\u6765\u7684\u6307\u4ee4\u6307\u5b9a\u5de5\u4f5c\u76ee\u5f55\nENV \u8bbe\u7f6e\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\nADD \u5411\u955c\u50cf\u6587\u4ef6\u6dfb\u52a0\u6587\u4ef6\uff0c\u5982\u679c\u662f\u538b\u7f29\u6587\u4ef6\u4f1a\u88ab\u89e3\u538b\nCOPY \u5411\u955c\u50cf\u6587\u4ef6\u6dfb\u52a0\u6587\u4ef6\uff0c\u4e0d\u4f1a\u89e3\u538b\nVOLUME \u5728\u6307\u5b9a\u8def\u5f84\u521b\u5efa\u6302\u8f7d\u70b9\nCMD \u8bbe\u7f6e\u5bb9\u5668\u542f\u52a8\u65f6\u9ed8\u8ba4\u8fd0\u884c\u7684\u547d\u4ee4\uff0c\u8986\u76d6\u7684\u65b9\u5f0f\nENTRYPOINT \u8bbe\u7f6e\u5bb9\u5668\u542f\u52a8\u65f6\u9ed8\u8ba4\u8fd0\u884c\u7684\u547d\u4ee4\uff0c\u8ffd\u52a0\u7684\u65b9\u5f0f\nONBUILD \u88ab\u4f5c\u4e3a\u7236\u955c\u50cf\u6784\u5efa\u65f6\u89e6\u53d1\u7684\u547d\u4ee4\nUSER \u4e3a\u6307\u5b9a\u63a5\u4e0b\u6765\u7684RUN\u3001ENTRYPOINT\u3001CMD\u547d\u4ee4\u7684\u7528\u6237\n</code></pre> <p>\u65b0\u589e\u955c\u50cf\u5c42\u7684\u6307\u4ee4\u5305\u62ecFROM\u3001RUN\u3001ADD\u4ee5\u53caCOPY\uff0c\u800c\u5176\u5b83\u547d\u4ee4\u53ea\u4f1a\u65b0\u589e\u5143\u6570\u636e \uff0c\u533a\u5206\u547d\u4ee4\u662f\u5426\u4f1a\u65b0\u589e\u955c\u50cf\u5c42\u7684\u4e00\u4e2a\u57fa\u672c\u539f\u5219\u662f\uff0c\u5982\u679c\u6307\u4ee4\u7684\u4f5c\u7528\u662f\u5411\u955c\u50cf\u4e2d\u6dfb\u52a0\u65b0\u7684\u6587\u4ef6\u6216\u7a0b\u5e8f\uff0c\u90a3\u4e48\u8fd9\u6761\u6307\u4ee4\u5c31\u4f1a\u65b0\u589e\u955c\u50cf\u5c42\uff1b\u5982\u679c\u53ea\u662f\u544a\u8bc9Docker\u5982\u4f55\u5b8c\u6210\u6784\u5efa\u6216\u8005\u5982\u4f55\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\uff0c\u90a3\u4e48\u5c31\u53ea\u4f1a\u589e\u52a0\u955c\u50cf\u7684\u5143\u6570\u636e\u3002</p> <p>\u5b98\u65b9hello-world\u7684Dockerfile</p> Text Only<pre><code>FROM scratch\nCOPY hello /\nCMD [\"/hello\"]\n</code></pre> <p>\u5b98\u65b9centos8\u7684Dockerfile</p> Text Only<pre><code>FROM scratch\nADD centos-8-x86_64.tar.xz /\nLABEL org.label-schema.schema-version=\"1.0\"     org.label-schema.name=\"CentOS Base Image\"     org.label-schema.vendor=\"CentOS\"     org.label-schema.license=\"GPLv2\"     org.label-schema.build-date=\"20201204\"\nCMD [\"/bin/bash\"]\n</code></pre> <p>\u6d4b\u8bd5\u7528\u4f8b</p> Text Only<pre><code>FROM centos\nENV loginpath /temp\nWORKDIR $loginpath\nRUN echo \"success\u270c\"\nCMD /bin/bash\n</code></pre> <p>\u4e00\u3001\u955c\u50cf</p> <p>1.\u5173\u952e\u7406\u89e3</p> <p>docker\u955c\u50cf\u7531\u4e00\u4e9b\u677e\u8026\u5408\u7684\u53ea\u8bfb\u955c\u50cf\u5c42\u7ec4\u6210\uff0c\u6240\u6709\u7684docker\u955c\u50cf\u90fd\u8d77\u59cb\u4e8e\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\u5c42\uff0c\u5f53\u8fdb\u884c\u4fee\u6539\u6216\u589e\u52a0\u65b0\u7684\u5185\u5bb9\u65f6\uff0c\u5c31\u4f1a\u5728\u5f53\u524d\u955c\u50cf\u5c42\u4e4b\u4e0a\u521b\u5efa\u65b0\u7684\u955c\u50cf\u5c42\u3002\u955c\u50cf\u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u914d\u7f6e\u5bf9\u8c61\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u955c\u50cf\u5c42\u7684\u5217\u8868\u4ee5\u53ca\u4e00\u4e9b\u5143\u6570\u636e\u4fe1\u606f\uff0c\u955c\u50cf\u5c42\u624d\u662f\u5b9e\u9645\u6570\u636e\u5b58\u50a8\u7684\u5730\u65b9\u3002\u591a\u4e2a\u955c\u50cf\u4e4b\u95f4\u4f1a\u5171\u4eab\u955c\u50cf\u5c42\uff0c\u5728\u5220\u9664\u955c\u50cf\u65f6\uff0c\u88ab\u591a\u4e2a\u955c\u50cf\u5171\u4eab\u7684\u955c\u50cf\u5c42\u5e76\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u53ea\u6709\u5f53\u4f9d\u8d56\u8be5\u955c\u50cf\u5c42\u7684\u5168\u90e8\u955c\u50cf\u90fd\u88ab\u5220\u9664\u540e\uff0c\u8be5\u955c\u50cf\u5c42\u624d\u4f1a\u88ab\u5220\u9664\u3002</p> <p>docker\u901a\u8fc7\u5b58\u50a8\u5f15\u64ce\u7684\u65b9\u5f0f\u5b9e\u73b0\u955c\u50cf\u5c42\u5806\u6808\uff0c\u5e76\u4fdd\u8bc1\u591a\u955c\u50cf\u5c42\u5bf9\u5916\u5c55\u793a\u4e3a\u7edf\u4e00\u7684\u6587\u4ef6\u7cfb\u7edf\u3002Linux\u4e0a\u53ef\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u6709AUFS\u3001Overlay2\u3001Device\u3001Mapper\u3001Btrfs\u4ee5\u53caZFS\uff0c\u800cdocker\u5728Windows\u4e0a\u4ec5\u652f\u6301windowsfilter\u4e00\u79cd\u5b58\u50a8\u5f15\u64ce\u3002\u6bcf\u4e2a\u5b58\u50a8\u5f15\u64ce\u90fd\u6709\u81ea\u5df1\u7684\u955c\u50cf\u5206\u5c42\u3001\u955c\u50cf\u5171\u4eab\u4ee5\u53ca\u5199\u65f6\u590d\u5236(Cow)\u6280\u672f\u7684\u5b9e\u73b0\u3002</p> <p>2.\u5199\u65f6\u590d\u5236\u673a\u5236</p> <p>\u901a\u8fc7docker run\u547d\u4ee4\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u5bb9\u5668\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u8be5\u955c\u50cf\u4e4b\u4e0a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u53ef\u8bfb\u5199\u7684\u6587\u4ef6\u7cfb\u7edf\u5c42\u7ea7\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u6587\u4ef6\u7cfb\u7edf\u5f53\u6210\u4e00\u4e2a\u65b0\u7684\u4e34\u65f6\u955c\u50cf\uff0c\u800c\u547d\u4ee4\u91cc\u6240\u6307\u7684\u955c\u50cf\u79f0\u4e3a\u7236\u955c\u50cf\u3002\u7236\u955c\u50cf\u91cc\u7684\u5185\u5bb9\u90fd\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6302\u8f7d\u8fdb\u6765\u7684\uff0c\u5bb9\u5668\u4f1a\u8bfb\u53d6\u7236\u955c\u50cf\u7684\u5185\u5bb9\uff0c\u4e0d\u8fc7\u4e00\u65e6\u9700\u8981\u4fee\u6539\u7236\u955c\u50cf\u6587\u4ef6\uff0c\u4fbf\u4f1a\u89e6\u53d1docker\u4ece\u7236\u955c\u50cf\u4e2d\u590d\u5236\u8fd9\u4e2a\u6587\u4ef6\u5230\u4e34\u65f6\u955c\u50cf\u4e2d\u6765\uff0c\u6240\u6709\u7684\u4fee\u6539\u5747\u53d1\u751f\u5728\u4e34\u65f6\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u800c\u4e0d\u4f1a\u5bf9\u7236\u955c\u50cf\u9020\u6210\u4efb\u4f55\u5f71\u54cd\uff0c\u8fd9\u5c31\u662fDocker\u955c\u50cf\u7684\u5199\u65f6\u590d\u5236\u673a\u5236\u3002</p> <p>\u4e8c\u3001\u6570\u636e\u5377</p> <p>\u6570\u636e\u5377\u5728docker commit\u65f6\u4e0d\u4f1a\u88ab\u6253\u5305\u8fdb\u955c\u50cf\uff1b\u6570\u636e\u5377\u53ef\u4ee5\u8ba9\u5bbf\u4e3b\u673a\u548c\u5bb9\u5668\u4e4b\u95f4\uff0c\u591a\u4e2a\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff1b\u6570\u636e\u5377\u53ef\u4ee5\u662f\u5355\u4e2a\u6587\u4ef6\uff0c\u6bd4\u5982socket\u3002</p> <p>\u521b\u5efa\u6570\u636e\u5377\u7684\u65b9\u5f0f\uff1a</p> <p>1.\u521b\u5efa\u955c\u50cf\u65f6\uff0c\u5728Dockerfile\u4e2d\u4f7f\u7528VOLUME\u6307\u4ee4\uff1a</p> Text Only<pre><code>VOLUME /path1 /path2 \u6216 VOLUME [\"/path1\", \"path2\"]\n</code></pre> <p>2.\u521b\u5efa\u5bb9\u5668\u65f6\uff0c\u4f7f\u7528-v</p> Text Only<pre><code>docker run -v &lt;\u5bbf\u4e3b\u673a\u76ee\u5f55&gt;:&lt;\u5bb9\u5668\u76ee\u5f55&gt; &lt;\u955c\u50cf&gt;\n\u8bbe\u7f6e\u5bb9\u5668\u4e2d\u76ee\u5f55\u662f\u53ea\u8bfb\u7684\uff1adockers run -v &lt;\u5bbf\u4e3b\u673a\u76ee\u5f55&gt;:&lt;\u5bb9\u5668\u76ee\u5f55&gt;:ro &lt;\u955c\u50cf&gt;\uff0c\u6b64\u65f6\u4e0d\u80fd\u5bf9\u5bb9\u5668\u5185\u7684\u76ee\u5f55\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u4f46\u662f\u53ef\u4ee5\u5bf9\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\u8fdb\u884c\u5199\u64cd\u4f5c\u3002\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u58f0\u660e\u5bbf\u4e3b\u673a\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4f1a\u5728\u5bbf\u4e3b\u673a/var/lib/docker/vfs/dir\u4e0b\u5206\u914d\u4e00\u4e2a\u5177\u6709\u552f\u4e00\u540d\u5b57\u7684\u76ee\u5f55</p> <p><code>--volume-from</code> \u4f1a\u6302\u8f7d\u6307\u5b9a\u5bb9\u5668\u7684\u6240\u6709\u6570\u636e\u5377\u5230\u5f53\u524d\u5bb9\u5668\uff0c\u8fd9\u65f6\u6570\u636e\u5377\u4e2d\u7684\u6570\u636e\u5728\u591a\u4e2a\u5bb9\u5668\u4e2d\u5171\u4eab\u3002</p> <p>\u4e09\u3001\u7f51\u7edc</p> <p>1.<code>docker run -P</code> \u5927\u5199P\u4f1a\u968f\u673a\u5206\u914d\u4e3b\u673a\u7aef\u53e3\uff0c\u7136\u540e\u6620\u5c04\u5230\u5bb9\u5668\u5411\u5916\u66b4\u9732\u7684\u7aef\u53e3\uff0c\u5bb9\u5668\u5411\u5916\u5f00\u653e\u7684\u7aef\u53e3\u662f\u7531Dockerfile\u7684EXPOSE\u6307\u5b9a\u7684\uff0c\u5982\uff1a</p> Text Only<pre><code>docker run -d -it -P tomcat\ndocker ps -a\u67e5\u770b\u5230\u7684\u7ed3\u679c\uff1aPORTS 0.0.0.0:49153-&gt;8080/tcp \u8868\u793a\u5c06\u5bbf\u4e3b\u673a\u6240\u6709ip\u768449153\u7aef\u53e3\u90fd\u6620\u5c04\u5230\u5bb9\u5668\u76848080\u7aef\u53e3\n</code></pre> <p>2.<code>docker run -p</code> \u5c0f\u5199p\u6307\u5b9a\u5bbf\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u7684\u7aef\u53e3\u5230\u5bb9\u5668\u5f00\u653e\u7aef\u53e3\u7684\u6620\u5c04\uff0c\u5982\uff1a</p> Text Only<pre><code>docker run -d -it -p 80:8080 tomcat \u5c06\u5bbf\u4e3b\u673a\u6240\u6709ip\u768480\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u76848080\u7aef\u53e3\ndocker run -d -it -p 127.0.0.1:80:8080 tomcat \u5c06\u5bbf\u4e3b\u673a\u7684127.0.0.1\u768480\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u76848080\u7aef\u53e3\uff0c\u7528\u672c\u673a\u7684\u5176\u5b83ip\u662f\u8bbf\u95ee\u4e0d\u5230\u7684\ndocker run -d -it -p 127.0.0.1::8080 tomcat \u968f\u673a\u5206\u914d\u5bbf\u4e3b\u673a\u7684127.0.0.1\u7684\u4e00\u4e2a\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u76848080\u7aef\u53e3\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/IO/","title":"IO","text":"<p> \u7ea6 4277 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 86 \u5206\u949f</p> <p>IO\u7684\u4e00\u4e9b\u57fa\u672c\u7684\u4e8b\u5b9e\uff1a 1\u3001\u5e38\u89c4\u60c5\u51b5\u4e0b\uff0c\u65e0\u8bba\u662f\u78c1\u76d8IO\u8fd8\u662f\u7f51\u7edcIO\uff0c\u6570\u636e\u7ecf\u8fc7\u5185\u6838\u7a7a\u95f4\uff0c\u6bd4\u5982 Input \u7684\u65f6\u5019\u6570\u636e\u9700\u8981\u5148\u5230\u5185\u6838\u7a7a\u95f4\uff08Kernel Space\uff09\u7136\u540e\u518d\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\uff08User Space\uff09\uff0cOutput\u7684\u65f6\u5019\u6570\u636e\u9700\u8981\u5148\u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\u3002 2\u3001IO\u7684\u6700\u540e\u4e00\u6b65\u662fDMA\u5b8c\u6210\u7684\uff0c\u4e0d\u9700\u8981CPU\u53c2\u4e0e\uff0c\u6700\u540e\u4e00\u6b65\u662f\u6307\u628a\u6570\u636e \u4ece\u5185\u5b58\u642c\u5230IO\u8bbe\u5907\u7684\u7f13\u51b2\u533a\uff08\u8be5\u7f13\u51b2\u533a\u5728IO\u8bbe\u5907\u4e2d\uff09 \u6216\u8005 \u4eceIO\u8bbe\u5907\u7f13\u51b2\u533a\u4e2d\u642c\u5230\u5185\u5b58\u3002 \u603b\u7ed3\uff1a\u5e38\u89c4\u7684\uff0c\u65e0\u8bba\u662f\u78c1\u76d8IO\u8fd8\u662f\u7f51\u7edcIO\uff0c\u6570\u636e\u9700\u8981\u5148\u7ecf\u8fc7\u5185\u6838\u7a7a\u95f4\uff0c\u6bd4\u5982 Input \u7684\u65f6\u5019\u6570\u636e\u5148\u7ecf\u8fc7DMA\u4eceIO\u8bbe\u5907\u642c\u5230\u5185\u6838\u7a7a\u95f4\uff08Kernel Space\uff09\u7136\u540e\u518d\u7ecf\u8fc7CPU\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\uff08User Space\uff09\uff0cOutput\u7684\u65f6\u5019\u6570\u636e\u5148\u7ecf\u8fc7CPU\u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\u7136\u540e\u518d\u7ecf\u8fc7DMA\u642c\u5230IO\u8bbe\u5907\u4e2d\u3002 </p> <p></p> <p>\u524d\u9762\u8bf4\u76845\u79cdIO\u6a21\u578b\u4ece\u7528\u6237\u7ebf\u7a0b\u7684\u89c6\u89d2\u51fa\u53d1\uff0c\u662f\u7528\u6237\u7ebf\u7a0b\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4ea4\u4e92\u7684\u65b9\u5f0f\uff0c\u8fd9\u91cc\u8bf4\u7684\u78c1\u76d8IO\u65b9\u5f0f\u548c\u7f51\u7edcIO\u65b9\u5f0f\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u628a\u6570\u636e\u4ece\u5916\u8bbe\u642c\u5230\u5185\u5b58\u7684\u8fc7\u7a0b\uff0c\u4e24\u8005\u4e0d\u51b2\u7a81\uff0c\u662f\u72ec\u7acb\u7684\u4e24\u5757\u5185\u5bb9\uff0c\u4e5f\u662f\u76f8\u4e92\u642d\u914d\u4f7f\u7528\u7684\u5173\u7cfb\uff0c\u6bd4\u5982IO\u591a\u8def\u590d\u7528\u901a\u5e38\u90fd\u662f\u7528\u4e8e\u7f51\u7edcIO\uff0c\u4f46\u5176\u5b9e\u4e5f\u53ef\u4ee5\u4e0e\u78c1\u76d8IO\u642d\u914d\u4f7f\u7528\u3002</p> <p>\u4ee5\u4e0a\u8fd9\u4e9bIO\u6a21\u578b\u7406\u8bba\u4e0a\u662f\u901a\u7528\u7684\uff0c\u4e0d\u6311\u6587\u4ef6\u7c7b\u578b\uff0c\u4e0d\u7ba1\u662f\u78c1\u76d8\u6587\u4ef6\u8fd8\u662fSocket\u6587\u4ef6\uff0c\u90fd\u53ef\u4ee5\u7528\uff0c\u4f46\u662f\u4e0d\u540c\u7c7b\u578b\u7684\u6587\u4ef6\u7684\u5dee\u5f02\u6bd4\u8f83\u5927\uff0c\u6bd4\u5982Socket\u6587\u4ef6\u6709\u4e24\u4e2a\u7279\u70b9\uff1a\u4e00\u662f\u6570\u636e\u5e76\u4e0d\u662f\u65f6\u523b\u88ab\u51c6\u5907\u597d\u4e86\uff0c\u4e8c\u662f\u6570\u636e\u6ca1\u6709\u5c3d\u5934\uff1b\u4e0a\u8ff0\u4efb\u4f55\u6a21\u578b\u90fd\u53ef\u4ee5\u7528\u4e8eSocket\u6587\u4ef6\u7684IO\uff1b\u4f46\u662f\u78c1\u76d8\u6587\u4ef6\u7684\u7279\u70b9\u6b63\u597d\u76f8\u53cd\uff0c\u78c1\u76d8\u6587\u4ef6\u603b\u662f\u5927\u5c0f\u5df2\u77e5\u5e76\u53ef\u8bfb\uff0c\u6240\u4ee5\u540c\u6b65\u975e\u963b\u585eIO\u3001IO\u591a\u8def\u590d\u7528\u5e76\u4e0d\u9002\u5408\u78c1\u76d8\u6587\u4ef6\u3002 Text Only<pre><code>\u6587\u5fc3\u4e00\u8a00\uff1a\n\u95ee\uff1alinux\u7684IO\u591a\u8def\u590d\u7528\u7cfb\u7edf\u8c03\u7528select\u53ef\u4ee5\u7528\u4e8e\u78c1\u76d8\u6587\u4ef6IO\u5417\uff1f\n\u7b54\uff1a\u5728Linux\u7cfb\u7edf\u4e2d\uff0cselect\u7cfb\u7edf\u8c03\u7528\u4e3b\u8981\u7528\u4e8e\u76d1\u89c6\u591a\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08file descriptors\uff09\u7684\u72b6\u6001\u53d8\u5316\uff0c\u5305\u62ec\u5957\u63a5\u5b57\uff08sockets\uff09\u3001\u7ba1\u9053\uff08pipes\uff09\u4ee5\u53ca\u7ec8\u7aef\u8bbe\u5907\u7b49\uff0c\u4ee5\u4fbf\u5728\u8fd9\u4e9b\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e0a\u6267\u884cIO\u64cd\u4f5c\u3002\u5c3d\u7ba1select\u7684\u8bbe\u8ba1\u521d\u8877\u662f\u5904\u7406\u7f51\u7edcIO\u548c\u7c7b\u4f3c\u7684\u57fa\u4e8e\u6d41\u7684IO\u64cd\u4f5c\uff0c\u5b83\u786e\u5b9e\u53ef\u4ee5\u7528\u4e8e\u76d1\u89c6\u4efb\u4f55\u7c7b\u578b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u72b6\u6001\u53d8\u5316\uff0c\u5305\u62ec\u90a3\u4e9b\u4e0e\u78c1\u76d8\u6587\u4ef6\u76f8\u5173\u8054\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\n\u7136\u800c\uff0c\u5c06select\u7528\u4e8e\u78c1\u76d8\u6587\u4ef6IO\u65f6\uff0c\u9700\u8981\u660e\u786e\u4e00\u70b9\uff1aselect\u76d1\u89c6\u7684\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u201c\u53ef\u8bfb\u201d\u3001\u201c\u53ef\u5199\u201d\u548c\u201c\u5f02\u5e38\u201d\u6761\u4ef6\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7528\u4e8e\u76d1\u63a7\u78c1\u76d8\u6587\u4ef6\u7684\u8bfb\u5199\u8fdb\u5ea6\u6216\u5b8c\u6210\u72b6\u6001\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5bf9\u4e8e\u78c1\u76d8\u6587\u4ef6\uff0cselect\u80fd\u544a\u8bc9\u4f60\u7684\u53ea\u662f\u67d0\u4e2a\u65f6\u523b\u6587\u4ef6\u63cf\u8ff0\u7b26\u662f\u5426\u51c6\u5907\u597d\u8fdb\u884c\u975e\u963b\u585e\u7684\u8bfb\u6216\u5199\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u6587\u4ef6IO\u64cd\u4f5c\u672c\u8eab\u4f55\u65f6\u5b8c\u6210\u3002\n\u5bf9\u4e8e\u78c1\u76d8\u6587\u4ef6\u6765\u8bf4\uff0c\u56e0\u4e3a\u6587\u4ef6\u901a\u5e38\u88ab\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u201c\u53ef\u8bfb\u201d\u548c\u201c\u53ef\u5199\u201d\u6761\u4ef6\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u662f\u7acb\u5373\u53ef\u7528\u7684\uff0c\u8fd9\u53ef\u80fd\u4f1a\u8ba9select\u7684\u4f7f\u7528\u5728\u78c1\u76d8\u6587\u4ef6IO\u4e0a\u770b\u8d77\u6765\u4e0d\u90a3\u4e48\u6709\u7528\u3002\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u78c1\u76d8IO\uff0c\u66f4\u5e38\u7528\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u66f4\u5e95\u5c42\u7684\u63a5\u53e3\uff08\u5982\u76f4\u63a5IO\u6216\u5f02\u6b65IO\uff09\u6216\u66f4\u9ad8\u7ea7\u7684\u62bd\u8c61\uff08\u5982Linux\u7684AIO\u63a5\u53e3\u6216\u4f7f\u7528\u7ebf\u7a0b/\u8fdb\u7a0b\u6c60\u6765\u5904\u7406IO\u5bc6\u96c6\u578b\u4efb\u52a1\uff09\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u53ef\u80fd\u66f4\u9002\u5408\u5904\u7406\u78c1\u76d8IO\u7684\u590d\u6742\u6027\u548c\u6027\u80fd\u9700\u6c42\u3002\n\u603b\u7ed3\u6765\u8bf4\uff0c\u867d\u7136select\u7cfb\u7edf\u8c03\u7528\u5728\u6280\u672f\u4e0a\u53ef\u4ee5\u7528\u4e8e\u78c1\u76d8\u6587\u4ef6IO\uff0c\u4f46\u5176\u4e3b\u8981\u5e94\u7528\u573a\u666f\u4ecd\u7136\u662f\u7f51\u7edcIO\u548c\u7c7b\u4f3c\u7684\u57fa\u4e8e\u6d41\u7684IO\u64cd\u4f5c\u3002\u5bf9\u4e8e\u78c1\u76d8\u6587\u4ef6IO\uff0c\u53ef\u80fd\u9700\u8981\u8003\u8651\u5176\u4ed6\u66f4\u9002\u5408\u7684\u65b9\u6cd5\u6216\u5de5\u5177\u3002\n</code></pre> \u4ee3\u7801\u9a8c\u8bc1\uff0c\u53ef\u4ee5\u6210\u529f\u8bfb\u78c1\u76d8\u6587\u4ef6\uff1a Text Only<pre><code>#include &lt;stdio.h&gt;\u00a0\u00a0\n#include &lt;stdlib.h&gt;\u00a0\u00a0\n#include &lt;unistd.h&gt;\u00a0\u00a0\n#include &lt;fcntl.h&gt;\u00a0\u00a0\n#include &lt;sys/select.h&gt;\u00a0\u00a0\n#include &lt;sys/time.h&gt;\u00a0\u00a0\n#include &lt;errno.h&gt;\u00a0\u00a0\n#include &lt;string.h&gt;\u00a0\u00a0\nint main() {\n\u00a0\u00a0\u00a0\u00a0int fd;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0fd_set readfds;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0struct timeval tv;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0int retval;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0// \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u53d6\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0fd = open(\"example.txt\", O_RDONLY);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0if (fd == -1) {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0perror(\"open\");\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exit(EXIT_FAILURE);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0}\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0// \u521d\u59cb\u5316\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0FD_ZERO(&amp;readfds);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0FD_SET(fd, &amp;readfds);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff08\u8fd9\u91cc\u8bbe\u7f6e\u4e3a1\u79d2\uff09\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0tv.tv_sec = 1;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0tv.tv_usec = 0;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0// \u4f7f\u7528select\u76d1\u89c6\u6587\u4ef6\u63cf\u8ff0\u7b26\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0retval = select(fd + 1, &amp;readfds, NULL, NULL, &amp;tv);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0if (retval == -1) {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0perror(\"select\");\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0close(fd);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exit(EXIT_FAILURE);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0} else if (retval == 0) {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printf(\"No data within one second.\\n\");\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0} else {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u8fd4\u56de\u503c\u5927\u4e8e0\uff0c\u8bf4\u660e\u6709\u6587\u4ef6\u63cf\u8ff0\u7b26\u51c6\u5907\u597d\u4e86\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4f46\u5bf9\u4e8e\u78c1\u76d8\u6587\u4ef6\uff0c\u8fd9\u51e0\u4e4e\u603b\u662f\u4f1a\u53d1\u751f\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (FD_ISSET(fd, &amp;readfds)) {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printf(\"File descriptor %d is ready to read.\\n\", fd);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u91cc\u53ef\u4ee5\u6dfb\u52a0\u8bfb\u53d6\u6587\u4ef6\u7684\u4ee3\u7801\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4f46\u7531\u4e8e\u6587\u4ef6\u901a\u5e38\u5df2\u7ecf\u6253\u5f00\u5e76\u51c6\u5907\u597d\u8bfb\u53d6\uff0c\u6240\u4ee5\u8fd9\u4e00\u6b65\u53ef\u80fd\u770b\u8d77\u6765\u662f\u591a\u4f59\u7684\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bfbfd\u8868\u793a\u7684\u6587\u4ef6\u5e76\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0char buffer[1024];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int bytes_read = read(fd, buffer, sizeof(buffer));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (bytes_read &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0buffer[bytes_read] = '\\0';\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printf(\"%s\", buffer);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printf(\"Unexpected condition.\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0close(fd);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exit(EXIT_FAILURE);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0}\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0// \u5173\u95ed\u6587\u4ef6\u63cf\u8ff0\u7b26\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0close(fd);\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0return 0;\u00a0\u00a0\n}\n</code></pre> \u4eceAI\u7684\u56de\u7b54\uff0c\u4ee5\u53caselect\u7cfb\u7edf\u8c03\u7528\u7684\u5b9a\u4e49\uff0cselect\u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u76d1\u89c6\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u201c\u53ef\u8bfb\u201d\u72b6\u6001\uff0c\u8fd8\u53ef\u4ee5\u76d1\u89c6\u201c\u53ef\u5199\u201d\u72b6\u6001\u3002\u6240\u4ee5\u4e0a\u8ff0IO\u6a21\u578b\u4e0d\u4ec5\u80fd\u7528\u4e8eI\uff0c\u8fd8\u80fd\u7528\u4e8eO\uff0c\u53ea\u4e0d\u8fc7\u50cfIO\u591a\u8def\u590d\u7528\u7edd\u5927\u591a\u6570\u60c5\u51b5\u90fd\u5728\u7528\u4e8eI\u3002\u603b\u7684\u6765\u8bf4\uff0c\u540c\u6b65\u963b\u585eIO \u548c \u5f02\u6b65IO \u5728\u3000\u78c1\u76d8I\u548cO \u548c \u7f51\u7edcI\u548cO \u90fd\u5e38\u7528\uff0c\u4f46\u662f\u540c\u6b65\u975e\u963b\u585eIO \u548c IO\u591a\u8def\u590d\u7528 \u591a\u7528\u4e8e \u7f51\u7edcI\uff0c\u4f5c\u4e3a\u670d\u52a1\u7aef\u3002 Text Only<pre><code>int select(int nfds, fd_set *_Nullable restrict readfds,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fd_set *_Nullable restrict writefds,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fd_set *_Nullable restrict exceptfds,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0struct timeval *_Nullable restrict timeout);\n</code></pre> Text Only<pre><code>\u6587\u5fc3\u4e00\u8a00\uff1a\n\u95ee\uff1aselect\u76d1\u89c6\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u201c\u53ef\u5199\u201d\u72b6\u6001\u7528\u4e8e\u4ec0\u4e48\u573a\u666f?\n\u7b54\uff1aselect \u7cfb\u7edf\u8c03\u7528\u76d1\u89c6\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u201c\u53ef\u5199\u201d\u72b6\u6001\u4e3b\u8981\u7528\u4e8e\u90a3\u4e9b\u9700\u8981\u786e\u4fdd\u5728\u5199\u5165\u6570\u636e\u4e4b\u524d\uff0c\u76ee\u6807\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08\u5982\u5957\u63a5\u5b57\u3001\u7ba1\u9053\u6216\u6587\u4ef6\uff09\u5904\u4e8e\u53ef\u4ee5\u975e\u963b\u585e\u5199\u5165\u7684\u72b6\u6001\u7684\u573a\u666f\u3002\u7136\u800c\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fd9\u79cd\u201c\u53ef\u5199\u201d\u72b6\u6001\u7684\u76d1\u63a7\u5177\u6709\u4e0d\u540c\u7684\u5b9e\u9645\u610f\u4e49\u548c\u5e94\u7528\u573a\u666f\u3002\n\u5957\u63a5\u5b57\uff08Sockets\uff09\n\u5728\u5957\u63a5\u5b57\u7f16\u7a0b\u4e2d\uff0cselect \u7684\u201c\u53ef\u5199\u201d\u72b6\u6001\u76d1\u89c6\u5c24\u4e3a\u91cd\u8981\u3002\u56e0\u4e3a\u7f51\u7edc\u5957\u63a5\u5b57\u5728\u5199\u5165\u6570\u636e\u65f6\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7f51\u7edc\u62e5\u585e\u3001\u5bf9\u65b9\u7f13\u51b2\u533a\u6ee1\u7b49\u539f\u56e0\u800c\u963b\u585e\u3002\u901a\u8fc7 select \u76d1\u89c6\u5957\u63a5\u5b57\u7684\u53ef\u5199\u72b6\u6001\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5728\u5c1d\u8bd5\u5199\u5165\u4e4b\u524d\u77e5\u9053\u5957\u63a5\u5b57\u662f\u5426\u51c6\u5907\u597d\u63a5\u6536\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u963b\u585e\u6216\u9009\u62e9\u66f4\u5408\u9002\u7684\u65f6\u673a\u53d1\u9001\u6570\u636e\u3002\n\u7ba1\u9053\uff08Pipes\uff09\u548c FIFOs\n\u7ba1\u9053\u548c FIFOs \u662f\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u4e00\u79cd\u673a\u5236\u3002\u5f53\u5199\u5165\u7aef\u5c1d\u8bd5\u5411\u7ba1\u9053\u6216 FIFO \u5199\u5165\u6570\u636e\u65f6\uff0c\u5982\u679c\u8bfb\u53d6\u7aef\u6ca1\u6709\u8db3\u591f\u5feb\u5730\u8bfb\u53d6\u6570\u636e\uff0c\u5199\u5165\u7aef\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7ba1\u9053\u7f13\u51b2\u533a\u6ee1\u800c\u963b\u585e\u3002\u4f7f\u7528 select \u76d1\u89c6\u7ba1\u9053\u6216 FIFO \u7684\u53ef\u5199\u72b6\u6001\u53ef\u4ee5\u5e2e\u52a9\u5199\u5165\u7aef\u5728\u5c1d\u8bd5\u5199\u5165\u4e4b\u524d\u786e\u8ba4\u7ba1\u9053\u6216 FIFO \u6709\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u4ece\u800c\u907f\u514d\u963b\u585e\u3002\n\u78c1\u76d8\u6587\u4ef6\n\u5bf9\u4e8e\u78c1\u76d8\u6587\u4ef6\uff0cselect \u7684\u201c\u53ef\u5199\u201d\u72b6\u6001\u76d1\u89c6\u901a\u5e38\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u56e0\u4e3a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u901a\u5e38\u4f7f\u7528\u7f13\u5b58\u673a\u5236\u6765\u7ba1\u7406\u78c1\u76d8\u6587\u4ef6\u7684\u8bfb\u5199\u64cd\u4f5c\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5f53\u5e94\u7528\u7a0b\u5e8f\u5411\u78c1\u76d8\u6587\u4ef6\u5199\u5165\u6570\u636e\u65f6\uff0c\u6570\u636e\u9996\u5148\u88ab\u5199\u5165\u5230\u5185\u5b58\u4e2d\u7684\u7f13\u5b58\u4e2d\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5199\u5165\u5230\u78c1\u76d8\u4e0a\u3002\u56e0\u6b64\uff0c\u78c1\u76d8\u6587\u4ef6\u7684\u201c\u53ef\u5199\u201d\u72b6\u6001\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u662f\u7acb\u5373\u53ef\u7528\u7684\uff0c\u9664\u975e\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\u6216\u6587\u4ef6\u7cfb\u7edf\u5b58\u5728\u5176\u4ed6\u9650\u5236\u3002\n\u7136\u800c\uff0c\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u5982\u9700\u8981\u786e\u4fdd\u6570\u636e\u5df2\u7ecf\u5b89\u5168\u5730\u5199\u5165\u5230\u78c1\u76d8\u4e0a\uff08\u800c\u4e0d\u4ec5\u4ec5\u662f\u7f13\u5b58\u4e2d\uff09\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u4f7f\u7528 fsync \u6216 fdatasync \u7b49\u7cfb\u7edf\u8c03\u7528\u6765\u5f3a\u5236\u5c06\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u3002\u4f46\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cselect \u5e76\u4e0d\u662f\u7528\u6765\u76d1\u89c6\u78c1\u76d8\u6587\u4ef6\u7684\u53ef\u5199\u72b6\u6001\u7684\u6b63\u786e\u5de5\u5177\u3002\n\u603b\u7ed3\n\u56e0\u6b64\uff0cselect \u76d1\u89c6\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u201c\u53ef\u5199\u201d\u72b6\u6001\u4e3b\u8981\u7528\u4e8e\u7f51\u7edc\u5957\u63a5\u5b57\u548c\u7ba1\u9053\u7b49\u7c7b\u578b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u4ee5\u786e\u4fdd\u5728\u5199\u5165\u6570\u636e\u4e4b\u524d\u8fd9\u4e9b\u6587\u4ef6\u63cf\u8ff0\u7b26\u5904\u4e8e\u53ef\u4ee5\u975e\u963b\u585e\u5199\u5165\u7684\u72b6\u6001\u3002\u5bf9\u4e8e\u78c1\u76d8\u6587\u4ef6\uff0c\u7531\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u5b58\u673a\u5236\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u4f7f\u7528 select \u6765\u76d1\u89c6\u5176\u53ef\u5199\u72b6\u6001\u3002\n</code></pre></p> <p>\u5e38\u89c4\u60c5\u51b5\u4e0b\uff0c\u78c1\u76d8IO\u6570\u636e\u9700\u8981\u5728\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u4e4b\u95f4\u8fdb\u884c\u4e00\u6b21\u62f7\u8d1d\uff0c\u7f51\u7edcIO\u6570\u636e\u9700\u8981\u7ecf\u8fc7\u5185\u6838\u7a7a\u95f4\u7684\u62c6\u5305\u6216\u8005\u5c01\u5305\u7684\u8fc7\u7a0b\uff08\u975e\u5e38\u89c4\u5730\uff0c\u4f7f\u7528\u539f\u59cb\u5957\u63a5\u5b57\u53ef\u4ee5\u76f4\u63a5\u62ff\u5230\u7ecf\u8fc7\u7f51\u5361\u89e3\u6790\u540e\u7684\u539f\u59cb\u6570\u636e\u5305\uff09\u3002 \u975e\u5e38\u89c4\u5730\uff0c\u9488\u5bf9\u78c1\u76d8IO\uff0c\u53ef\u4ee5\u5728\u8003\u8651\u51cf\u5c11\u4e00\u6b21\u4ece\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7684\u62f7\u8d1d\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u00a0mmap \u548c \u76f4\u63a5IO\uff0c\u6240\u4ee5\u78c1\u76d8IO\u4e00\u5171\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a\u6807\u51c6I/O\u3001\u76f4\u63a5 I/O\u3001mmap\u3002 1\u3001\u76f4\u63a5IO \u76f4\u63a5IO\u662f\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u76f4\u63a5 I/O \u7ed5\u8fc7\u4e86\u5185\u6838\u7f13\u5b58\uff0c\u6570\u636e\u76f4\u63a5\u5728\u7528\u6237\u7a7a\u95f4\u548c\u78c1\u76d8\u4e4b\u95f4\u4f20\u8f93\uff0c\u51cf\u5c11\u4e86\u989d\u5916\u7684\u5185\u5b58\u62f7\u8d1d\u64cd\u4f5c\uff0c\u591a\u4e0e\u5f02\u6b65IO\u65b9\u5f0f\u7ed3\u5408\u4f7f\u7528\uff08\u65e9\u671fLinux\u7684\u5f02\u6b65IO\u53ea\u652f\u6301\u76f4\u63a5IO \u539f\u751f\u7684 Linux \u5f02\u6b65\u6587\u4ef6\u64cd\u4f5c\uff0cio_uring \u5c1d\u9c9c\u4f53\u9a8c - \u6211\u5927EOI\u524d\u7aef - SegmentFault \u601d\u5426\uff09\u3002 \u76f4\u63a5IO\u6700\u5e38\u89c1\u5c31\u662f\u5e94\u7528\u4e8e\u6570\u636e\u5e93\u7cfb\u7edf\uff0c\u6570\u636e\u5e93\u81ea\u5df1\u66f4\u52a0\u4e86\u89e3\u8be5\u5982\u4f55\u7f13\u5b58\u81ea\u5df1\u7684\u6570\u636e\u4ee5\u53ca\u5237\u5199\u810f\u9875\u7684\u65f6\u673a\uff0c\u6240\u4ee5\u6b64\u65f6\u64cd\u4f5c\u7cfb\u7edf\u7684pagecache\u53cd\u5012\u6dfb\u4e71\u964d\u4f4e\u4e86\u6027\u80fd\uff0c\u6240\u4ee5\u6570\u636e\u5e93\u90fd\u4f7f\u7528\u76f4\u63a5IO\u3002</p> <p>2\u3001mmap mmap\u76f4\u63a5\u5c06\u6587\u4ef6\u6620\u5c04\u5230\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u4ee5\u5185\u5b58\u7684\u65b9\u5f0f\u8bbf\u95ee\u6587\u4ef6\uff0c\u800c\u4e0d\u9700\u8981\u663e\u793a\u5730\u8c03\u7528\u8bfb\u5199\u51fd\u6570\uff0c\u548c\u7528\u6237\u7a0b\u5e8f\u8bbf\u95ee\u5176\u4ed6\u6570\u636e\u4e00\u6837\uff0c\u6570\u636e\u5e76\u4e0d\u662f\u4e00\u5b9a\u88ab\u52a0\u8f7d\u5230\u5185\u5b58\u4e86\uff0c\u5f53\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u5728\u5185\u5b58\u7684\u65f6\u5019\u5c31\u4f1a\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\uff08page fault\uff09\uff0c\u7136\u540e\u542f\u52a8\u78c1\u76d8IO\u4ece\u78c1\u76d8\u628a\u6570\u636e\u8bfb\u5230\u5185\u5b58\uff0c\u8bfb\u5230\u5185\u5b58\u4e4b\u540e\uff0c\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u7684Pagecache\u7684\u865a\u62df\u5730\u5740\u90fd\u4f1a\u6620\u5c04\u5230\u540c\u4e00\u7247\u7269\u7406\u5185\u5b58\uff0c\u6240\u4ee5mmap\u907f\u514d\u4e86\u6807\u51c6IO\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u7531\u4e8e\u5185\u6838\u7a7a\u95f4pagecache\u4e5f\u6620\u5c04\u4e86\uff0c\u6240\u4ee5mmap\u4e5f\u6709\u9884\u8bfb\uff08\u9884\u8bfb\u7684\u9875\u5185\u6838\u7a7a\u95f4pagecache\u6620\u5c04\u4e86\uff0c\u4f46\u662f\u7528\u6237\u7a7a\u95f4\u6ca1\u6709\u6620\u5c04\uff0c\u540e\u9762\u9700\u8981\u901a\u8fc7\u7f3a\u9875\u4e2d\u65ad\u5b8c\u6210\u6620\u5c04\uff09\uff0c\u5e76\u4e14\u4e5f\u4f1a\u88ab\u81ea\u52a8\u5237\u810f\uff08\u771f\u6b63\u8fbe\u5230\u4e86\u4fee\u6539\u5185\u5b58\u5c31\u50cf\u4fee\u6539\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u4e00\u6837\uff09\u3002</p> <p>mmap\u76f4\u63a5\u5c06\u6587\u4ef6\u6620\u5c04\u5230\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u4ee5\u5185\u5b58\u7684\u65b9\u5f0f\u8bbf\u95ee\u6587\u4ef6\uff0c\u800c\u4e0d\u9700\u8981\u663e\u793a\u5730\u8c03\u7528\u8bfb\u5199\u51fd\u6570\uff0c\u5f53\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u5728\u5185\u5b58\u7684\u65f6\u5019\u5c31\u4f1a\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\uff08page fault\uff09\uff0c\u7f3a\u9875\u4e2d\u65ad\u7a0b\u5e8f\u9996\u5148\u4f1a\u68c0\u67e5PageCache\u91cc\u9762\u6709\u6ca1\u6709\uff0c\u5982\u679c\u6709\u5c31\u76f4\u63a5\u66f4\u65b0\u9875\u8868\u6307\u5411PageCache\u90a3\u6bb5\u7269\u7406\u5185\u5b58\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u6307\u6325DMA\u628a\u6570\u636e\u4ece\u78c1\u76d8\u8bfb\u5230PageCache\uff0c\u7136\u540e\u518d\u66f4\u65b0\u9875\u8868\u6307\u5411PageCache\u6307\u5411\u7684\u8fd9\u6bb5\u7269\u7406\u5185\u5b58\uff0c\u6240\u4ee5mmap\u907f\u514d\u4e86\u6807\u51c6IO\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u5e76\u4e14\u8fd8\u5177\u5907\u4e86PageCache\u9884\u8bfb\u548c\u5237\u810f\u7684\u80fd\u529b\u3002</p> <p>mmap\u548c\u76f4\u63a5IO\u76f8\u5bf9\u6807\u51c6IO\u90fd\u51cf\u5c11\u4e86\u6570\u636e\u62f7\u8d1d\uff1bmmap\u548c\u6807\u51c6IO\u76f8\u6bd4\u4e8e\u76f4\u63a5IO\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u76f4\u63a5IO\u7ed5\u8fc7\u4e86pagecache\uff0c\u800cmmap\u548c\u6807\u51c6IO\u90fd\u5229\u7528\u4e86pagecache\uff1bmmap\u76f8\u6bd4\u4e8e\u76f4\u63a5IO\u548c\u6807\u51c6IO\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0cmmap\u4f9d\u9760\u7f3a\u9875\u4e2d\u65ad\u4ece\u78c1\u76d8\u4e2d\u8bfb\u6570\u636e\uff0c\u800c\u76f4\u63a5IO\u548c\u6807\u51c6IO\u4f9d\u9760\u7cfb\u7edf\u8c03\u7528\u4ece\u78c1\u76d8\u4e2d\u8bfb\u6570\u636e\uff0c\u4e0d\u8fc7\u5f52\u6839\u7ed3\u5e95\u90fd\u662f\u78c1\u76d8IO\uff0c\u4f9d\u9760DMA\u5c06\u6570\u636e\u4ece\u78c1\u76d8\u642c\u5230\u5185\u5b58\uff0c\u53ea\u4e0d\u8fc7\u8d70\u7684\u8def\u5f84\u4e0d\u540c\u7f62\u4e86\uff0c\u6240\u4ee5\u4ed6\u4eec\u4e24\u8005\u7684\u6548\u7387\u7684\u6bd4\u8f83\u5c31\u662f\u7cfb\u7edf\u8c03\u7528\u548c\u989d\u5916\u7684\u590d\u5236\u64cd\u4f5c\u7684\u5f00\u9500\u548c\u9875\u9519\u8bef\u7684\u5f00\u9500\u4e4b\u95f4\u7684\u6bd4\u8f83\uff0c\u54ea\u4e00\u4e2a\u5f00\u9500\u5c11\u5c31\u662f\u54ea\u4e00\u4e2a\u8868\u73b0\u66f4\u597d\u3002 Text Only<pre><code>\u6587\u5fc3\u4e00\u8a00\uff1a\n\u95ee\uff1a\u5bf9\u4e8e\u8fde\u7eed\u591a\u9875\u7684\u7f3a\u9875\uff0c\u4e00\u6b21\u7f3a\u9875\u4e2d\u65ad\u80fd\u641e\u5b9a\u5417\uff1f\n\u7b54\uff1a\u5728\u8fde\u7eed\u591a\u9875\u7f3a\u9875\u7684\u60c5\u51b5\u4e0b\uff0c\u5373\u7a0b\u5e8f\u8fde\u7eed\u5c1d\u8bd5\u8bbf\u95ee\u591a\u4e2a\u4e0d\u5728\u7269\u7406\u5185\u5b58\u4e2d\u7684\u865a\u62df\u5185\u5b58\u9875\u9762\u65f6\uff0c\u6bcf\u4e2a\u672a\u6620\u5c04\u7684\u9875\u9762\u8bbf\u95ee\u90fd\u4f1a\u89e6\u53d1\u4e00\u6b21\u72ec\u7acb\u7684\u7f3a\u9875\u4e2d\u65ad\u3002\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u9010\u4e00\u5904\u7406\u8fd9\u4e9b\u4e2d\u65ad\uff0c\u6bcf\u6b21\u5904\u7406\u4e00\u4e2a\u7f3a\u9875\uff0c\u76f4\u5230\u6240\u6709\u7f3a\u9875\u90fd\u88ab\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u4e2d\u3002\n\u8fd9\u79cd\u73b0\u8c61\u88ab\u79f0\u4e3a\u201c\u9875\u9762\u6296\u52a8\u201d\uff08Page Thrashing\uff09\uff0c\u5b83\u4f1a\u5bfc\u81f4\u5927\u91cf\u7684 I/O \u64cd\u4f5c\u548c CPU \u65f6\u95f4\u6d88\u8017\u5728\u9875\u9762\u7684\u52a0\u8f7d\u548c\u7f6e\u6362\u4e0a\uff0c\u4e25\u91cd\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u3002\u4e3a\u4e86\u907f\u514d\u9875\u9762\u6296\u52a8\uff0c\u64cd\u4f5c\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u4f1a\u91c7\u7528\u9884\u53d6\u7b56\u7565\uff0c\u9884\u6d4b\u5e76\u63d0\u524d\u52a0\u8f7d\u53ef\u80fd\u9700\u8981\u7684\u9875\u9762\uff0c\u4ee5\u51cf\u5c11\u7f3a\u9875\u4e2d\u65ad\u7684\u9891\u7387\u3002\u6b64\u5916\uff0c\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u91c7\u7528\u4e86\u5404\u79cd\u4f18\u5316\u6280\u672f\uff0c\u5982\u9875\u9762\u7f13\u5b58\u3001\u9875\u9762\u9884\u8bfb\u548c\u9875\u9762\u5408\u5e76\uff0c\u4ee5\u63d0\u9ad8 I/O \u6548\u7387\u548c\u51cf\u5c11\u7f3a\u9875\u4e2d\u65ad\u7684\u5f71\u54cd\u3002\n</code></pre></p> <p>mmap\u662f\u4e0d\u662f\u5168\u9762\u4f18\u4e8e\u6807\u51c6IO\uff1f \u4ece\u4e0a\u9762AI\u7684\u56de\u7b54\u6765\u770b\uff0c\u867d\u7136mmap\u548c\u6807\u51c6IO\u90fd\u6709\u5229\u7528pagecache\u7684\u9884\u8bfb\u673a\u5236\uff0c\u4f46\u662fmmap\u6bcf\u8bfb\u4e00\u6b21\u65b0\u9875\u90fd\u662f\u4e00\u6b21\u7f3a\u9875\u4e2d\u65ad\uff0c\u867d\u7136\u5982\u679c\u9875\u88ab\u9884\u8bfb\u4e86\u53ef\u4ee5\u4e0d\u771f\u6b63\u8fdb\u884c\u78c1\u76d8IO\uff0c\u4f46\u662f\u7f3a\u9875\u4e2d\u65ad\u5374\u662f\u5fc5\u987b\u7684\uff0c\u800c\u6807\u51c6IO\u5374\u4e0d\u540c\uff0c\u6807\u6ce8IO\u53ef\u4ee5\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u8fde\u7eed\u8bfb\u591a\u9875\uff0c\u6240\u4ee5\u8bf4mmap\u548c\u6807\u51c6IO\u7684\u6548\u7387\u6bd4\u8f83\u5c31\u662f\u7cfb\u7edf\u8c03\u7528\u548c\u989d\u5916\u7684\u590d\u5236\u64cd\u4f5c\u7684\u5f00\u9500\u548c\u9875\u9519\u8bef\u7684\u5f00\u9500\u4e4b\u95f4\u7684\u6bd4\u8f83\u3002\u4ece\u8fd9\u70b9\u6765\u770b\uff0cmmap\u9002\u5408\u5927\u6587\u4ef6\u7684\u968f\u673a\u8bfb\uff0c\u6807\u51c6IO\u9002\u5408\u5927\u6587\u4ef6\u7684\u987a\u5e8f\u8bfb\u548c\u8bfb\u5f88\u591a\u96f6\u788e\u7684\u5c0f\u6587\u4ef6\u3002 mmap\uff0cpagecache\u9884\u8bfb\u7684\u591a\u9875\uff0c\u7528\u6237\u7a7a\u95f4\u7684\u9875\u8868\u5e94\u8be5\u4e5f\u6620\u5c04\u4e86\u624d\u5bf9\uff0c\u8fd9\u6837\u6548\u7387\u624d\u9ad8\uff0c\u4e0d\u81f3\u4e8e\u6bcf\u8bfb\u4e00\u9875\u90fd\u662f\u4e00\u6b21\u7f3a\u9875\u4e2d\u65ad\u3002\u8fd9\u6837\u7684\u8bdd\uff0cmmap\u7f3a\u9875\u4e2d\u65ad\u7684\u6b21\u6570\u5168\u4f9d\u8d56pagecache\u7684\u9884\u8bfb\u7b56\u7565\u4e86\uff0c\u53ef\u80fd\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff4d\uff4dap\u7f3a\u9875\u4e2d\u65ad\u7684\u5f00\u9500\u4ecd\u7136\u6bd4\u7cfb\u7edf\u8c03\u7528\u548c\u989d\u5916\u7684\u590d\u5236\u64cd\u4f5c\u7684\u5f00\u9500\u8981\u5927\u3002</p> <p>\u62d3\u5c55\uff1amalloc\u4e5f\u4f7f\u7528\u4e86mmap\u3002mmap\u6309\u7167\u6620\u5c04\u7684\u7c7b\u578b\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a\u6587\u4ef6\u6620\u5c04\u548c\u533f\u540d\u6620\u5c04\uff0c\u5728\u5185\u5b58\u4e2d\u5206\u914d\u7a7a\u95f4\u5c31\u662f\u533f\u540d\u6620\u5c04\u3002 mmap\u53c2\u8003: https://www.zhihu.com/question/522132580/answer/2524710759 https://www.zhihu.com/question/522132580/answer/2624604520</p> <p>\u78c1\u76d8IO\u4e09\u79cd\u65b9\u5f0f\u7684\u6bd4\u8f83\uff1a 1.\u76f4\u63a5IO\uff1a\u867d\u7136\u76f4\u63a5IO\u76f8\u6bd4\u4e8e\u6807\u51c6IO\u51cf\u5c11\u4e86\u6570\u636e\u62f7\u8d1d\uff0c\u4f46\u662f\u5b83\u4e5f\u5931\u53bb\u4e86pagecache\u7684\u4f18\u70b9\uff0c\u5373\u9884\u8bfb\u4e0e\u5408\u5e76\u5199\uff0c\u6240\u4ee5\u9002\u5408\u6709\u80fd\u529b\u7ba1\u7406\u9884\u8bfb\u548c\u5237\u810f\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u6bd4\u5982\u6570\u636e\u5e93\uff0c\u6216\u8005\u662f\u9488\u5bf9\u5927\u6587\u4ef6\u7684\u5927\u89c4\u6a21\u987a\u5e8f\u8bfb\u5199\u3002 2.mmap\uff1a\u5229\u7528\u4e86pagecache\u7684\u4f18\u52bf\uff0c\u540c\u65f6\u4e5f\u907f\u514d\u6570\u636e\u62f7\u8d1d\u7684\u52a3\u52bf\uff0c\u770b\u4f3c\u5b8c\u5168\u78be\u538b\u6807\u51c6IO\uff0c\u4f46\u662fmmap\u6bcf\u6b21\u8bfb\u65b0\u9875\u90fd\u662f\u4e00\u6b21\u7f3a\u9875\u4e2d\u65ad\uff0c\u79ef\u5c11\u6210\u591a\u4f1a\u6bd4\u6807\u51c6IO\u66f4\u5dee\uff0c\u6240\u4ee5mmap\u9002\u5408\u5927\u6587\u4ef6\u7684\u968f\u673a\u8bfb\u5199\uff0c\u4e0d\u9002\u5408\u5927\u6587\u4ef6\u7684\u987a\u5e8f\u8bfb\u5199\u548c\u8bfb\u5199\u5f88\u591a\u96f6\u788e\u7684\u5c0f\u6587\u4ef6\u3002 3.\u6807\u51c6IO\uff1a\u6700\u7b80\u5355\u901a\u7528\u7684IO\u65b9\u5f0f\uff0cpagecache\u5e26\u6765\u7684\u4f18\u52bf\u6bd4\u52a3\u52bf\u53ef\u89c2\uff0c\u5404\u7c7b\u6587\u4ef6\u7684\u8bfb\u5199\u6027\u80fd\u90fd\u4e0d\u4f1a\u592a\u5dee\u3002</p> <p>\u96f6\u62f7\u8d1d zero-copy\uff08sendfile\uff09 \u4e0b\u9762\u662fsendfile\u7cfb\u7edf\u8c03\u7528 Text Only<pre><code>ssize_t sendfile(int out_fd, int in_fd, off_t *_Nullable offset,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0size_t count);\n</code></pre> \u5173\u4e8e\u6587\u4ef6\u63cf\u8ff0\u7b26in_fd\u548cout_fd\u7684\u89e3\u91ca\uff1a Text Only<pre><code>The in_fd argument must correspond to a file which supports\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mmap(2)-like operations (i.e., it cannot be a socket).\u00a0\u00a0Except\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0since Linux 5.12 and if out_fd is a pipe, in which case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sendfile() desugars to a splice(2) and its restrictions apply.\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Before Linux 2.6.33, out_fd must refer to a socket.\u00a0\u00a0Since Linux\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.6.33 it can be any file.\u00a0\u00a0If it's seekable, then sendfile()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0changes the file offset appropriately.\n</code></pre> in_fd\u5fc5\u987b\u662f\u652f\u6301mmap\u7684\u6587\u4ef6\uff0c\u4e0d\u80fd\u662fsocket\u6587\u4ef6\uff0c\u5728Linux 2.6.33\u4e4b\u524d\uff0cout_fd\u5fc5\u987b\u662fsocket\uff0c\u4f46\u662fLinux 2.6.33\u4e4b\u540e\u53ef\u4ee5\u662f\u4efb\u610f\u6587\u4ef6\u3002\u6240\u4ee5\u96f6\u62f7\u8d1d\u4e0d\u9650\u4e8e\u4ece\u78c1\u76d8\u8bfb\u5f80\u7f51\u7edc\u5199\u7684\u573a\u666f\uff0c\u4e5f\u53ef\u4ee5\u662f\u4ece\u78c1\u76d8\u8bfb\u5f80\u78c1\u76d8\u5199\u3002\u4f7f\u7528sendfile\u4ece\u78c1\u76d8\u8bfb\u5f80\u78c1\u76d8\u5199\u5c31\u7eaf\u7cb9\u662f\u6587\u4ef6\u590d\u5236\u4e86\uff0c\u4f7f\u7528\u76f4\u63a5IO\u8bfb\u5199\u4e5f\u53ef\u4ee5\u8fbe\u5230\u907f\u514d\u6570\u636e\u62f7\u8d1d\u7684\u6548\u679c\uff08\u4e0d\u8fc7\u591a\u4e86\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u7684\u5f00\u9500\uff09\uff0c\u5e76\u4e14\u76f4\u63a5IO\u8fd8\u53ef\u4ee5\u4fee\u6539\u6587\u4ef6\u5185\u5bb9\uff0c\u6240\u4ee5sendfile\u8fd8\u662f\u591a\u7528\u4e8e\u4ece\u78c1\u76d8\u8bfb\u5f80\u7f51\u7edc\u5199\u7684\u573a\u666f\uff0c\u6bd4\u4f7f\u7528\u76f4\u63a5IO\u4ece\u78c1\u76d8\u8bfb\u7f51\u7edcIO\u5411\u7f51\u7edc\u5199\u6027\u80fd\u66f4\u9ad8\uff0c\u56e0\u4e3asendfile\u4f1a\u76f4\u63a5\u628apagecache\u6620\u5c04\u5230socket\u7f13\u51b2\u533a\uff0c\u800c\u76f4\u63a5IO\u9700\u8981\u5c06\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\u5f80\u5185\u6838\u7684socket\u7f13\u51b2\u533a\u4e2d\u590d\u5236\uff0c\u5e76\u4e14sendfile\u53ea\u6709\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u3002 java nio\u4e2d\u7684transferTo()\u6b63\u662f\u4f7f\u7528\u4e86sendfile\u7cfb\u7edf\u8c03\u7528\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Lambda/","title":"Lambda","text":"<p> \u7ea6 55 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>\u5e2e\u52a9\u66f4\u597d\u7684\u5728Java\u4e2d\u4f7f\u7528\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u5e93 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;io.vavr&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;vavr&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;0.10.4&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> \u6bd4\u5982\uff1a Text Only<pre><code>Try.success(sc.nextInt())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.andThen(t -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (t == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"fail\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"success\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.failed()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.andThen(cause -&gt; System.out.println(\"\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\" + cause.getMessage() + \"\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\"));\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/01-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/","title":"01-\u5e76\u53d1\u7f16\u7a0b\u57fa\u7840","text":"<p> \u7ea6 717 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff1a 1.\u7ee7\u627fThread\u7c7b\uff0c\u91cd\u5199run()\u65b9\u6cd5 Text Only<pre><code>class Task extends Thread{\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"task\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0Thread task = new Task();\n\u00a0\u00a0\u00a0\u00a0task.start();\n}\n</code></pre> 2.\u5b9e\u73b0Runnable\u63a5\u53e3 Text Only<pre><code>class Task implements Runnable{\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"task\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0Thread task = new Thread(new Task());\n\u00a0\u00a0\u00a0\u00a0task.start();\n}\n</code></pre> 3.FutureTask\u65b9\u5f0f\uff0c\u5b9e\u73b0Callable\u63a5\u53e3 Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0Callable&lt;String&gt; task= () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(3);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"result\";\n\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0FutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(task);\n\u00a0\u00a0\u00a0\u00a0Thread thread = new Thread(futureTask);\n\u00a0\u00a0\u00a0\u00a0thread.start();\n\u00a0\u00a0\u00a0\u00a0String res = null;\n\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0res = futureTask.get();\n\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0System.out.println(res);\n}\n</code></pre></p> <p>Callable\u63a5\u53e3\u4e0eRunnable\u63a5\u53e3\u7684\u5dee\u5f02\uff1f 1.Callable\u63a5\u53e3\u6709\u8fd4\u56de\u503c\uff0c\u800cRunnable\u63a5\u53e3\u6ca1\u6709 2.Callable\u63a5\u53e3\u58f0\u660e\u4e86\u629b\u5f02\u5e38\uff0c\u800cRunnable\u63a5\u53e3\u6ca1\u6709 3.\u65b9\u6cd5\u540d\u4e0d\u4e00\u6837\uff0c\u4e00\u4e2a\u662frun\uff0c\u4e00\u4e2a\u662fcall</p> <p>\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61 Text Only<pre><code>Thread.currentThread();\n</code></pre> \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\u7684\u540d\u5b57 Text Only<pre><code>Thread\u5bf9\u8c61.getName()\n</code></pre> \u4fee\u6539\u7ebf\u7a0b\u5bf9\u8c61\u7684\u540d\u5b57 Text Only<pre><code>Thread\u5bf9\u8c61.setName()\n</code></pre> \u5f53\u524d\u7ebf\u7a0b\u8ba9\u4f4d\uff0c\u9759\u6001\u65b9\u6cd5yield() Text Only<pre><code>static void yield()\n</code></pre> \u5408\u5e76\u7ebf\u7a0b\uff0c\u5f53\u524d\u7ebf\u7a0b\u6682\u505c\uff0c\u7b49\u5f85\u88ab\u8c03\u7528join\u65b9\u6cd5\u7684\u7ebf\u7a0b\u7ed3\u675f Text Only<pre><code>Thread\u5bf9\u8c61.join()\n</code></pre></p> <p>synchronized \u540c\u6b65\u4ee3\u7801\u5757 \u5b9e\u4f8b\u65b9\u6cd5 \u9501\u5f53\u524dthis \u9759\u6001\u65b9\u6cd5 \u9501\u5f53\u524d\u7c7b</p> <p>\u6b7b\u9501 Text Only<pre><code>public class DeadLock {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object o1 = new Object();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object o2 = new Object();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread06 t1 = new Thread06(o1, o2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread07 t2 = new Thread07(o1, o2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0t1.setName(\"t1\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0t2.setName(\"t2\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0t1.start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0t2.start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n\nclass Thread06 extends Thread {\n\u00a0\u00a0\u00a0\u00a0Object o2;\n\u00a0\u00a0\u00a0\u00a0Object o1;\n\n\u00a0\u00a0\u00a0\u00a0public Thread06(Object o1, Object o2) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.o1 = o1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.o2 = o2;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (o1) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread.sleep(1000);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (o2) {}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\nclass Thread07 extends Thread {\n\u00a0\u00a0\u00a0\u00a0Object o2;\n\u00a0\u00a0\u00a0\u00a0Object o1;\n\n\u00a0\u00a0\u00a0\u00a0public Thread07(Object o1, Object o2) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.o1 = o1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.o2 = o2;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (o2) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread.sleep(1000);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (o1) {}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005 o.wait() \u4f7f\u5728o\u5bf9\u8c61\u4e0a\u52a0\u9501\u7684\u7ebf\u7a0b\u5168\u91ca\u653e\u9501\u5e76\u7b49\u5f85 o.notify() \u5524\u9192\u4e00\u4e2a\u5728o\u7b49\u5f85\u961f\u5217\u4e0a\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\u9996\u5148\u4f1a\u53bb\u7ade\u4e89\u9501\uff0c\u6210\u529f\u83b7\u5f97\u9501\u4e4b\u540e\u624d\u4f1a\u4ece\u4e0a\u6b21wait\u7684\u5730\u65b9\u7ee7\u7eed\u6267\u884c\u3002 o.notifyAll() \u5524\u9192\u6240\u6709\u5728o\u7b49\u5f85\u961f\u5217\u4e0a\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\u9996\u5148\u4f1a\u53bb\u7ade\u4e89\u9501\uff0c\u6210\u529f\u83b7\u5f97\u9501\u4e4b\u540e\u624d\u4f1a\u4ece\u4e0a\u6b21wait\u7684\u5730\u65b9\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u793a\u4f8b\uff1a\u4e00\u4e2a\u751f\u4ea7\u8005\uff0c\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u4ed3\u5e93\u7684\u5bb9\u91cf\u4e3a1 Text Only<pre><code>public class ProducerConsumer {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List list = new ArrayList();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(new Producer(list), \"\u751f\u4ea7\u8005\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(new Consumer(list), \"\u6d88\u8d39\u8005\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n//\u751f\u4ea7\u8005\nclass Producer implements Runnable {\n\u00a0\u00a0\u00a0\u00a0private List list;\n\n\u00a0\u00a0\u00a0\u00a0public Producer(List list) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.list = list;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (list) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (list.size() &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//wait()\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0c\u505a\u4e24\u4ef6\u4e8b:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e00\u662f\u5c06\u8be5\u5bf9\u8c61\u4e0a\u7684\u9501\u91ca\u653e\u6389\uff08\u6240\u4ee5wait\u8981\u653e\u5728\u5bf9\u5e94\u7684synchronized\u8bed\u53e5\u91cc\u9762\uff09\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e8c\u662f\u5c06\u6267\u884c\u6b64wait\u65b9\u6cd5\u7684\u7ebf\u7a0b\u963b\u585e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"producer wait\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0list.wait();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object obj = new Object();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0list.add(obj);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"----&gt;\" + obj);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//notify()\u53ea\u505a\u4e00\u4ef6\u4e8b\uff0c\u5373\u5524\u9192\u963b\u585e\u961f\u5217\u4e0a\u7684\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u52a0\u5165\u5230\u5c31\u7eea\u961f\u5217\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0list.notify();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n//\u6d88\u8d39\u8005\nclass Consumer implements Runnable {\n\u00a0\u00a0\u00a0\u00a0private List list;\n\n\u00a0\u00a0\u00a0\u00a0public Consumer(List list) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.list = list;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (list) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (list.size() == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"consumer wait\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0list.wait();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object obj = list.remove(0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"----&gt;\" + obj);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0list.notify();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/02-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/","title":"02-\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u578b","text":"<p> \u7ea6 452 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u677f\uff1a\u7ebf\u7a0b\u00a0 \u64cd\u4f5c\u00a0 \u8d44\u6e90\u7c7b Text Only<pre><code>class Ticket{`//\u8d44\u6e90\u7c7b`\n\u00a0\u00a0\u00a0\u00a0//\u7968\n\u00a0\u00a0\u00a0\u00a0private int number = 30;\n\u00a0\u00a0\u00a0\u00a0`//\u64cd\u4f5c`\n\u00a0\u00a0\u00a0\u00a0public synchronized void saleTicket(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (number &gt; 0){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\u5356\u51fa\u7b2c\uff1a\"+(number--)+\"\\t\u8fd8\u5269\u4e0b\uff1a\"+number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n/**\n*\u9898\u76ee\uff1a\u4e09\u4e2a\u552e\u7968\u5458\u00a0\u00a0\u00a0\u5356\u51fa\u00a0\u00a0\u00a030\u5f20\u7968\n* \u591a\u7ebf\u7a0b\u7f16\u7a0b\u7684\u4f01\u4e1a\u7ea7\u5957\u8def+\u6a21\u677f\n* 1.\u5728\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u7684\u524d\u63d0\u4e0b\uff0c\u7ebf\u7a0b\u00a0\u00a0\u00a0\u00a0\u64cd\u4f5c(\u5bf9\u5916\u66b4\u9732\u7684\u8c03\u7528\u65b9\u6cd5)\u00a0\u00a0\u00a0\u00a0\u00a0\u8d44\u6e90\u7c7b\n*/\npublic class SaleTicket {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Ticket ticket = new Ticket();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u7ebf\u7a0bA`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(new Runnable() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 40; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ticket.saleTicket();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"A\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u7ebf\u7a0bB`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(new Runnable() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 40; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ticket.saleTicket();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"B\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u53ef\u91cd\u5165\u9501 ReentrantLock Text Only<pre><code>//\u8d44\u6e90\u7c7b = \u5b9e\u4f8b\u53d8\u91cf + \u5b9e\u4f8b\u65b9\u6cd5\nclass Ticket{\n\u00a0\u00a0\u00a0\u00a0//\u7968\n\u00a0\u00a0\u00a0\u00a0private int number = 30;\n\u00a0\u00a0\u00a0\u00a0Lock lock\u00a0\u00a0= new ReentrantLock();\n\n\u00a0\u00a0\u00a0\u00a0public void sale(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (number &gt; 0){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\u5356\u51fa\u7b2c\uff1a\"+(number--)+\"\\t\u8fd8\u5269\u4e0b\uff1a\"+number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}catch (Exception e){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\n/**\n*\u9898\u76ee\uff1a\u4e09\u4e2a\u552e\u7968\u5458\u00a0\u00a0\u00a0\u5356\u51fa\u00a0\u00a0\u00a030\u5f20\u7968\n* \u7b14\u8bb0\uff1a\u5982\u4f55\u7f16\u5199\u4f01\u4e1a\u7ea7\u7684\u591a\u7ebf\u7a0b\n* \u56fa\u5b9a\u7684\u7f16\u7a0b\u5957\u8def+\u6a21\u677f\n* 1.\u5728\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u7684\u524d\u63d0\u4e0b\uff0c\u7ebf\u7a0b\u00a0\u00a0\u00a0\u00a0\u64cd\u4f5c(\u5bf9\u5916\u66b4\u9732\u7684\u8c03\u7528\u65b9\u6cd5)\u00a0\u00a0\u00a0\u00a0\u00a0\u8d44\u6e90\u7c7b\n*\u00a0\u00a01.1\u5148\u521b\u5efa\u4e00\u4e2a\u8d44\u6e90\u7c7b\n*/\npublic class SaleTicketDemo1 {\n\u00a0\u00a0\u00a0\u00a0//\u4e3b\u7ebf\u7a0b\uff0c\u4e00\u5207\u7a0b\u5e8f\u7684\u5165\u53e3\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Ticket ticket = new Ticket();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{for (int i = 1; i &lt;= 40; i++) ticket.sale();},\"A\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{for (int i = 1; i &lt;= 40; i++) ticket.sale();},\"B\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{for (int i = 1; i &lt;= 40; i++) ticket.sale();},\"C\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/02-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/#_1","title":"02-\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6a21\u578b","text":""},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/02-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/#_2","title":"\u751f\u4ea7\u8005\u6d88\u8d39\u8005","text":"<p>\u6a21\u677f\uff1a\u5224\u65ad \u5e72\u6d3b \u901a\u77e5 Text Only<pre><code>`/**`\n`* \u9898\u76ee\uff1a\u73b0\u5728\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u64cd\u4f5c\u521d\u59cb\u503c\u4e3a\u96f6\u7684\u4e00\u4e2a\u53d8\u91cf\uff0c`\n`* \u5b9e\u73b0\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u52a01\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf-1\uff0c`\n`* \u5b9e\u73b0\u4ea4\u66ff\uff0c\u676510\u8f6e\uff0c\u53d8\u91cf\u521d\u59cb\u503c\u4e3a0.`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u524d\u63d0\u4e0b\uff0c\u7ebf\u7a0b\u64cd\u4f5c\u8d44\u6e90\u7c7b`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.\u5224\u65ad/\u5e72\u6d3b/\u901a\u77e5`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03.\u9632\u6b62\u865a\u5047\u5524\u9192(\u5224\u65ad\u53ea\u80fd\u7528while\uff0c\u4e0d\u80fd\u7528if)`\n`* \u77e5\u8bc6\u5c0f\u603b\u7ed3\uff1a\u591a\u7ebf\u7a0b\u7f16\u7a0b\u5957\u8def+while\u5224\u65ad+\u65b0\u7248\u5199\u6cd5`\n`*/`\nclass Aircondition{\n\u00a0\u00a0\u00a0\u00a0private int number = 0;\n\u00a0\u00a0\u00a0\u00a0//\u8001\u7248\u5199\u6cd5\n\u00a0\u00a0\u00a0\u00a0public synchronized void increment() throws Exception{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number != 0){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.wait();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number++;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.notifyAll();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public synchronized void decrement() throws Exception{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number == 0){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.wait();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number--;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.notifyAll();\n\u00a0\u00a0\u00a0\u00a0}\n}\npublic class ProdConsumerDemo4 {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Aircondition aircondition = new Aircondition();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0aircondition.increment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"A\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0aircondition.decrement();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"B\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u91cd\u5165\u9501\u7248\uff1a Text Only<pre><code>/**\n* \u9898\u76ee\uff1a\u73b0\u5728\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u64cd\u4f5c\u521d\u59cb\u503c\u4e3a\u96f6\u7684\u4e00\u4e2a\u53d8\u91cf\uff0c\n* \u5b9e\u73b0\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u52a01\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf-1\uff0c\n* \u5b9e\u73b0\u4ea4\u66ff\uff0c\u676510\u8f6e\uff0c\u53d8\u91cf\u521d\u59cb\u503c\u4e3a0.\n*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u524d\u63d0\u4e0b\uff0c\u7ebf\u7a0b\u64cd\u4f5c\u8d44\u6e90\u7c7b\n*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.\u5224\u65ad/\u5e72\u6d3b/\u901a\u77e5\n*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03.\u9632\u6b62\u865a\u5047\u5524\u9192(\u5224\u65ad\u53ea\u80fd\u7528while\uff0c\u4e0d\u80fd\u7528if)\n* \u77e5\u8bc6\u5c0f\u603b\u7ed3\uff1a\u591a\u7ebf\u7a0b\u7f16\u7a0b\u5957\u8def+while\u5224\u65ad+\u65b0\u7248\u5199\u6cd5\n*/\nclass Aircondition{\n\u00a0\u00a0\u00a0\u00a0private int number = 0;\n\u00a0\u00a0\u00a0\u00a0private Lock lock = new ReentrantLock();\n\u00a0\u00a0\u00a0\u00a0private Condition condition = lock.newCondition();\n\n\u00a0\u00a0\u00a0\u00a0//\u65b0\u7248\u5199\u6cd5\n\u00a0\u00a0\u00a0\u00a0public void increment() throws Exception{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number != 0){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0condition.await();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number++;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0condition.signalAll();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void decrement() throws Exception{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number == 0){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0condition.await();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number--;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0condition.signalAll();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic class ProdConsumerDemo4 {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Aircondition aircondition = new Aircondition();\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0aircondition.increment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"A\").start();\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0aircondition.decrement();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"B\").start();\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0aircondition.increment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"C\").start();\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0aircondition.decrement();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"D\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/02-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/#_3","title":"\u7cbe\u786e\u901a\u77e5\u987a\u5e8f\u8bbf\u95ee","text":"Text Only<pre><code>import java.util.concurrent.locks.*;\n/**\n`* \u5907\u6ce8\uff1a\u591a\u7ebf\u7a0b\u4e4b\u95f4\u6309\u987a\u5e8f\u8c03\u7528\uff0c\u5b9e\u73b0A-&gt;B-&gt;C`\n`* \u4e09\u4e2a\u7ebf\u7a0b\u542f\u52a8\uff0c\u8981\u6c42\u5982\u4e0b\uff1a`\n`* AA\u6253\u53705\u6b21\uff0cBB\u6253\u537010\u6b21\uff0cCC\u6253\u537015\u6b21`\n`* \u63a5\u7740`\n`* AA\u6253\u53705\u6b21\uff0cBB\u6253\u537010\u6b21\uff0cCC\u6253\u537015\u6b21`\n`* \u676510\u8f6e`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.\u9ad8\u5185\u805a\u4f4e\u8026\u5408\u524d\u63d0\u4e0b\uff0c\u7ebf\u7a0b\u64cd\u4f5c\u8d44\u6e90\u7c7b`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.\u5224\u65ad/\u5e72\u6d3b/\u901a\u77e5`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03.\u591a\u7ebf\u7a0b\u4ea4\u4e92\u4e2d\uff0c\u9632\u6b62\u865a\u5047\u5524\u9192(\u5224\u65ad\u53ea\u80fd\u7528while\uff0c\u4e0d\u80fd\u7528if)`\n`*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a04.\u6807\u5fd7\u4f4d`\n*/\nclass ShareData{\n\u00a0\u00a0\u00a0\u00a0private int number = 1;//A:1,B:2,C:3\n\u00a0\u00a0\u00a0\u00a0private Lock lock = new ReentrantLock();\n\u00a0\u00a0\u00a0\u00a0private Condition c1 = lock.newCondition();\n\u00a0\u00a0\u00a0\u00a0private Condition c2 = lock.newCondition();\n\u00a0\u00a0\u00a0\u00a0private Condition c3 = lock.newCondition();\n\n\u00a0\u00a0\u00a0\u00a0public void printc1(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number != 1){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c1.await();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 5; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3.\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number = 2;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u77e5\u7b2c2\u4e2a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c2.signal();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void printc2(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number != 2){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c2.await();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3.\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number = 3;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u77e5\u7b2c3\u4e2a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c3.signal();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void printc3(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u5224\u65ad\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (number != 3){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c3.await();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u5e72\u6d3b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 15; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"\\t\"+i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3.\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0number = 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u77e5\u7b2c1\u4e2a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c1.signal();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic class ConditionDemo {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ShareData shareData = new ShareData();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0shareData.printc1();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"A\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0shareData.printc2();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"B\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 1; i &lt;= 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0shareData.printc3();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\"C\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/03-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E9%9B%86%E5%90%88/","title":"03-\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408","text":"<p> \u7ea6 304 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>ArrayList\u96c6\u5408\u7ebf\u7a0b\u4e0d\u5b89\u5168 Text Only<pre><code>public static void main(String[] args) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0List&lt;String&gt; list=new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 100; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0list.add(UUID.randomUUID().toString().substring(0, 8));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(list);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, String.valueOf(i)).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5f02\u5e38\uff1a<code>java.util.ConcurrentModificationException</code> \u89e3\u51b3\u529e\u6cd5\uff1a 1.<code>Vector\u96c6\u5408</code> \uff0c\u5e95\u5c42\u7ed9add\u65b9\u6cd5\u52a0\u4e86synchronized\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u8bfb\u6216\u5199\u3002 2.<code>Collections.synchronizedList(new ArrayList&lt;&gt;());</code> 3. <code>CopyOnWriteArrayList</code> \uff0cJUC\u5305\u4e2d\u7684\uff0c<code>\u5199\u65f6\u590d\u5236\uff0c\u8bfb\u5199\u5206\u79bb\u7684\u601d\u60f3</code>\uff0c\u4ece\u5176add\u65b9\u6cd5\u7684\u5b9e\u73b0\u53ef\u4ee5\u770b\u51fa\u5199\u65f6\u52a0\u9501\uff0c\u7136\u540e\u590d\u5236\u539f\u6765\u7684\u96c6\u5408\uff0c\u518d\u5f80\u91cc\u6dfb\u52a0\u5143\u7d20\uff0c\u6700\u540e\u518d\u628a\u6dfb\u52a0\u5143\u7d20\u540e\u7684\u96c6\u5408\u8d4b\u7ed9\u539f\u6765\u7684\u5f15\u7528\u3002\u800cget\u65b9\u6cd5\u6ca1\u6709\u52a0\u9501\uff0c\u6240\u4ee5\u540c\u4e00\u65f6\u95f4\u53ef\u4ee5\u6709\u5f88\u591a\u7ebf\u7a0b\u8fdb\u884c\u8bfb\uff0c\u4f46\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u5199\uff0c\u5199\u5e76\u4e0d\u5f71\u54cd\u8bfb\uff0c\u56e0\u4e3a\u662f\u5728\u4e0d\u540c\u7684\u96c6\u5408\u4e0a\u8fdb\u884c\u3002 Text Only<pre><code>public boolean add(E e) {\n\u00a0\u00a0\u00a0\u00a0synchronized (lock) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object[] es = getArray();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int len = es.length;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0es = Arrays.copyOf(es, len + 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0es[len] = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setArray(es);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic E get(int index) {\n\u00a0\u00a0\u00a0\u00a0return elementAt(getArray(), index);\n}\n</code></pre></p> <p>HashSet\u96c6\u5408\u7ebf\u7a0b\u4e0d\u5b89\u5168 Text Only<pre><code>public static void main(String[] args) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0Set&lt;String&gt; set=new HashSet&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0for(int i=0;i&lt;100;i++){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0set.add(UUID.randomUUID().toString().substring(0, 8));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(set);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},String.valueOf(i)).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5f02\u5e38\uff1a<code>java.util.ConcurrentModificationException</code> \u89e3\u51b3\u529e\u6cd5\uff1a 1.<code>Collections.synchronizedSet(new HashSet&lt;&gt;());</code> 2. <code>CopyOnWriteArraySet</code>\uff0cJUC\u5305\u4e2d\u7684</p> <p>HashMap\u96c6\u5408\u7ebf\u7a0b\u4e0d\u5b89\u5168 \u89e3\u51b3\u529e\u6cd5\uff1a 1.<code>Collections.synchronizedMap(new HashMap&lt;&gt;());</code> 2. <code>ConcurrentHashMap</code>\uff0cJUC\u5305\u4e2d\u7684</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/04-Callable%E6%8E%A5%E5%8F%A3%20%E5%92%8C%20FutureTask/","title":"04-Callable\u63a5\u53e3 \u548c FutureTask","text":"<p> \u7ea6 976 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>Callable\u521b\u5efa\u7ebf\u7a0b\u7684\u6d41\u7a0b\uff1a 1.\u5b9e\u73b0Callable\u63a5\u53e3 Text Only<pre><code>class MyThreadCallable implements Callable&lt;Integer&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer call() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"******come in here\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1024;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 2.\u521b\u5efaFutureTask\u5bf9\u8c61 Text Only<pre><code>FutureTask futureTask = new FutureTask(new MyThreadCallable());\n</code></pre> 3.\u521b\u5efa\u7ebf\u7a0b Text Only<pre><code>new Thread(futureTask, \"A\").start();\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48\u8981\u4e09\u6b65\uff1f \u5b9e\u73b0Callable\u63a5\u53e3\u5c31\u662f\u4efb\u52a1\uff0c\u521b\u5efaFutureTask\u5bf9\u8c61\u662f\u4e3a\u4e86\u80fd\u62ff\u5230\u8fd4\u56de\u503c\uff0c\u521b\u5efaThread\u5bf9\u8c61\u662f\u4e3a\u521b\u5efa\u7ebf\u7a0b</p> <p>\u4e3b\u7ebf\u7a0b\u963b\u585e\u7b49\u5f85\u4e3a\u4e86\u80fd\u62ff\u5230\u8fd4\u56de\u503c\uff08\u56e0\u4e3a\u8981\u62ff\u8fd4\u56de\u503c\u5fc5\u987b\u963b\u585e\uff0c\u6240\u4ee5\u6700\u539f\u59cb\u7684Thread\u7684run()\u65b9\u6cd5\u80af\u5b9a\u4e0d\u80fd\u8bbe\u8ba1\u6210\u6709\u8fd4\u56de\u503c\uff09\uff1a Text Only<pre><code>Integer result = futureTask.get()\n</code></pre></p> <p>\u5b8c\u6574\u4ee3\u7801\uff1a Text Only<pre><code>class MyThreadCallable implements Callable&lt;Integer&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer call() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"******come in here\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread.sleep(5000);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1024;\n\u00a0\u00a0\u00a0\u00a0}\n}\npublic class CallableDemo {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(new MyThreadCallable());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(futureTask, \"A\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u963b\u585e\u7b49\u5f85\u8fd4\u56de\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Integer result = futureTask.get();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName()+\"***\u8ba1\u7b97\u5b8c\u6210\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u539f\u7406\uff1a \u521b\u5efa\u7ebf\u7a0b\u7684\u539f\u7406\u6ca1\u53d8\uff0c\u8fd8\u662fnew Thread().start();\u6267\u884c\u7684\u662fThread\u7684run\u65b9\u6cd5\uff0crun\u65b9\u6cd5\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u4e3a\u4ec0\u4e48\u4f7f\u7528FutureTask\u540e\u53ef\u4ee5\u62ff\u5230\u8fd4\u56de\u503c\uff1f FutureTask\u5b9e\u73b0\u4e86Runnable\u63a5\u53e3\u91cd\u5199\u4e86run\u65b9\u6cd5\uff0c \u5728\u91cd\u5199\u7684run\u65b9\u6cd5\u4e2d\u8c03\u7528\u4e86result = c.call();\uff0c\u4e5f\u5c31\u662fCallable\u63a5\u53e3\u7684call\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u662f\u7559\u7ed9\u7528\u6237\u81ea\u5b9a\u4e49\u7684\uff0c\u6267\u884c\u5b8c\u62ff\u5230\u7ed3\u679c\u4e4b\u540e\u4e4b\u540e\u8c03\u7528set(result);\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u505a\u4e24\u4ef6\u4e8b\uff0c\u4e00\u662f\u4fdd\u5b58\u7ed3\u679c\u5230FutureTask\u7684\u5b9e\u4f8b\u53d8\u91cf\u4e2d\uff0c\u4e8c\u662f\u66f4\u65b0\u72b6\u6001\u5b57\u6bb5\u3002\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8c03\u7528futureTask.get();\u62ff\u5230\u8fd4\u56de\u503c\u4e86\u3002 Text Only<pre><code>public void run() {\n\u00a0\u00a0\u00a0\u00a0if (state != NEW ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0!RUNNER.compareAndSet(this, null, Thread.currentThread()))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Callable&lt;V&gt; c = callable;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (c != null &amp;&amp; state == NEW) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0V result;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean ran;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `result = c.call();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ran = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Throwable ex) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ran = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setException(ex);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (ran)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`set(result);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// runner must be non-null until state is settled to\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// prevent concurrent calls to run()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0runner = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// state must be re-read after nulling runner to prevent\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// leaked interrupts\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int s = state;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (s &gt;= INTERRUPTING)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0handlePossibleCancellationInterrupt(s);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>protected void set(V v) {\n\u00a0\u00a0\u00a0\u00a0if (STATE.compareAndSet(this, NEW, COMPLETING)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outcome = v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STATE.setRelease(this, NORMAL); // final state\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0finishCompletion();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> futureTask.get();\u4f1a\u963b\u585e\uff0c\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f\u56e0\u4e3aawaitDone()\u8fd4\u56de\u8c03\u7528\u4e86LockSupport.park(); Text Only<pre><code>public V get() throws InterruptedException, ExecutionException {\n\u00a0\u00a0\u00a0\u00a0int s = state;\n\u00a0\u00a0\u00a0\u00a0if (s &lt;= COMPLETING)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0s = awaitDone(false, 0L);\n\u00a0\u00a0\u00a0\u00a0return report(s);\n}\n</code></pre> FutrueTask\u4efb\u52a1\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff0c\u6bd4\u5982\u4e0b\u9762\u7a0b\u5e8f\u53ea\u4f1a\u6253\u5370\u4e00\u6b21 come in here\uff0c\u539f\u56e0\uff1a\u4ecerun()\u524d\u4e24\u884c\u53ef\u4ee5\u770b\u5230\uff0cFutureTask\u53ea\u4f1a\u8c03\u7528Callable\u63a5\u53e3\u7684call\u65b9\u6cd5\u4e00\u6b21\u3002 Text Only<pre><code>class MyThreadCallable implements Callable&lt;Integer&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer call() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"******come in here\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1024;\n\u00a0\u00a0\u00a0\u00a0}\n}\npublic class CallableDemo01 {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(new MyThreadCallable());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(futureTask, \"A\").start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(futureTask, \"B\").start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4f7f\u7528FutrueTask\u5b9e\u73b0\u7c7b\u4f3c\u4e8e\u524d\u7aefAjax\u90a3\u6837\u7684\u5f02\u6b65\u8c03\u7528\uff1a \u4e0d\u7528\u62c5\u5fc3\u7ebf\u7a0b\u6267\u884c\u7684\u65f6\u5019\u629b\u5f02\u5e38\uff0c\u56e0\u4e3a\u5728FutureTask\u91cd\u5199\u7684run\u65b9\u6cd5\u4e2d\u5df2\u7ecf\u628a\u5f02\u5e38\u5168\u541e\u4e86\uff0c\u53ea\u6709\u5728get()\u7684\u65f6\u5019\u624d\u4f1a\u518d\u628a\u5f02\u5e38\u5410\u51fa\u6765\u3002 Text Only<pre><code>public class AsyncCall&lt;V&gt; {\n\u00a0\u00a0\u00a0\u00a0private final FutureTask&lt;V&gt; futureTask;\n\n\u00a0\u00a0\u00a0\u00a0private AsyncCall(FutureTask&lt;V&gt; futureTask) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.futureTask = futureTask;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static &lt;V&gt; AsyncCall&lt;V&gt; call(Callable&lt;V&gt; callable) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FutureTask&lt;V&gt; futureTask = new FutureTask&lt;&gt;(callable);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(futureTask).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new AsyncCall&lt;&gt;(futureTask);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void then(Consumer&lt;V&gt; success, Consumer&lt;Throwable&gt; failure) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0V result = futureTask.get();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0success.accept(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failure.accept(e);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6d4b\u8bd5\uff1a Text Only<pre><code>public class TestAsyncCall {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0AsyncCall.call(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u5f02\u6b65\u8c03\u75281\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1 / 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).then(v -&gt; System.out.println(\"\u5f02\u6b65\u8c03\u75281\u6210\u529f\uff0c\u7ed3\u679c\u662f\uff1a\" + v), e -&gt; System.out.println(\"\u5f02\u6b65\u8c03\u75281\u5931\u8d25\uff0c\u5f02\u5e38\uff1a\" + e));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0AsyncCall.call(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u5f02\u6b65\u8c03\u75282\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).then(v -&gt; System.out.println(\"\u5f02\u6b65\u8c03\u75282\u6210\u529f\uff0c\u7ed3\u679c\u662f\uff1a\" + v), e -&gt; System.out.println(\"\u5f02\u6b65\u8c03\u75282\u5931\u8d25\uff0c\u5f02\u5e38\uff1a\" + e));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4e0d\u8fc7\u5176\u5b9e\u4e0a\u9762\u7684\u5199\u6cd5\u8fd8\u662f\u6709\u70b9\u8131\u88e4\u5b50\u653e\u5c41\u7684\u611f\u89c9\uff0c\u56e0\u4e3acall()\u548cthen()\u4e24\u4e2a\u65b9\u6cd5\u7684\u6267\u884c\u6709\u5148\u540e\u5173\u7cfb\uff0c\u4e00\u70b9\u4e5f\u4e0d\u91cd\u5408\uff0c\u5b8c\u5168\u53ef\u4ee5\u5728\u4e00\u4e2a\u7ebf\u7a0b\u91cc\u6309\u987a\u5e8f\u6267\u884c\u3002 Text Only<pre><code>public class AsyncCall02&lt;V&gt; {\n\u00a0\u00a0\u00a0\u00a0private final Callable&lt;V&gt; callable;\n\n\u00a0\u00a0\u00a0\u00a0private AsyncCall02(Callable&lt;V&gt; callable) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.callable = callable;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static &lt;V&gt; AsyncCall02&lt;V&gt; call(Callable&lt;V&gt; callable) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new AsyncCall02&lt;&gt;(callable);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void then(Consumer&lt;V&gt; success, Consumer&lt;Throwable&gt; failure) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0V result = callable.call();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0success.accept(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failure.accept(e);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48\u524d\u7aef\u4f7f\u7528\u5f02\u6b65\u8c03\u7528\u6bd4\u540e\u7aef\u591a\uff1f \u8fd9\u662f\u4e24\u79cd\u4e0d\u540c\u573a\u666f\u6240\u5904\u7406\u7684\u4efb\u52a1\u7c7b\u578b\u7684\u5dee\u5f02\u6240\u51b3\u5b9a\u7684\uff0c\u524d\u7aef\u662f\u8c03\u7528\u8005\uff0c\u5411\u540e\u7aef\u53d6\u7ed3\u679c\uff0c\u5f53\u524d\u7aef\u540e\u7eed\u6b65\u9aa4\u4e0d\u4f9d\u8d56\u8fd9\u4e2a\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u4ed6\u5c31\u4e0d\u613f\u610f\u7b49\uff0c\u8981\u5148\u5e72\u540e\u9762\u7684\u6d3b\uff0c\u7b49\u8fd9\u4e2a\u7ed3\u679c\u53d1\u9001\u56de\u6765\u4e86\u518d\u5904\u7406\uff0c\u6bd4\u5982\u628a\u7ed3\u679c\u663e\u793a\u5728\u9875\u9762\u4e0a\uff0c\u524d\u7aef\u7684\u573a\u666f\u5c31\u662f\u5904\u7406\u4e0e\u7528\u6237\u4ea4\u4e92\uff0c\u5f88\u591a\u64cd\u4f5c\u90fd\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u6240\u4ee5\u5f02\u6b65\u4efb\u52a1\u8981\u6bd4\u540e\u7aef\u591a\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/05-CompletableFuture/","title":"05-CompletableFuture","text":"<p> \u7ea6 847 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <p>\u5728\u524d\u9762\u4e3a\u4e86\u6a21\u62dfAjax\u7684\u5f02\u6b65\u8c03\u7528\u65b9\u5f0f\uff0c\u6211\u5199\u4e86\u4e00\u4e2aAsyncCall\u7c7b\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u7c7b\u5b8c\u6210\u8fd9\u6837\u7684\u666e\u904d\u4e14\u901a\u7528\u7684\u7f16\u7a0b\u8303\u5f0f\uff1aAsync.call(\u4f60\u7684\u4efb\u52a1).then(\u8c03\u7528\u6210\u529f\u4e86\u7684\u52a8\u4f5c, \u8c03\u7528\u5931\u8d25\u4e86\u7684\u52a8\u4f5c) \uff0c\u5176\u5b9eJDK8\u5f15\u5165\u7684CompletableFuture\u7c7b\u6b63\u662f\u6765\u5b8c\u6210\u8fd9\u6837\u7684\u4efb\u52a1\u7684\uff0c\u5b83\u989d\u5916\u8fd8\u63d0\u4f9b\u4e86\u66f4\u591a\u65b9\u4fbf\u7684\u8c03\u7528\uff0c\u6bd4\u5982\u591a\u4e2aFuture\u7ec4\u5408\u5904\u7406\u7684\u80fd\u529b\uff0c\u4f7fJava\u5728\u5904\u7406\u591a\u4efb\u52a1\u7684\u534f\u540c\u5de5\u4f5c\u65f6\u66f4\u52a0\u987a\u7545\u4fbf\u5229\u3002</p> <p>\u53c2\u8003\uff1a CompletableFuture\u4f7f\u7528\u8be6\u89e3\uff08\u5168\u7f51\u770b\u8fd9\u4e00\u7bc7\u5c31\u884c\uff09_supplyasync-CSDN\u535a\u5ba2 \u4f18\u96c5\u5904\u7406\u5e76\u53d1\uff1aJava CompletableFuture\u6700\u4f73\u5b9e\u8df5 - \u4e2a\u4eba\u6587\u7ae0 - SegmentFault \u601d\u5426</p> <p>1\u3001\u521b\u5efaCompletableFuture\u4efb\u52a1 supplyAsync\u662f\u521b\u5efa\u5e26\u6709\u8fd4\u56de\u503c\u7684\u5f02\u6b65\u4efb\u52a1\uff1brunAsync\u662f\u521b\u5efa\u6ca1\u6709\u8fd4\u56de\u503c\u7684\u5f02\u6b65\u4efb\u52a1\u3002\u5206\u522b\u6709\u4e24\u4e2a\u91cd\u8f7d\u65b9\u6cd5\uff0c\u4e00\u4e2a\u4f7f\u7528\u7684\u662f\u9ed8\u8ba4\u7ebf\u7a0b\u6c60\uff08ForkJoinPool.commonPool()\uff09\u7684\u65b9\u6cd5\uff0c\u53e6\u4e00\u4e2a\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\u3002 Text Only<pre><code>// \u5e26\u8fd4\u56de\u503c\u5f02\u6b65\u8bf7\u6c42\uff0c\u9ed8\u8ba4\u7ebf\u7a0b\u6c60\npublic static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier)\n// \u5e26\u8fd4\u56de\u503c\u7684\u5f02\u6b65\u8bf7\u6c42\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\npublic static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier, Executor executor)\n// \u4e0d\u5e26\u8fd4\u56de\u503c\u7684\u5f02\u6b65\u8bf7\u6c42\uff0c\u9ed8\u8ba4\u7ebf\u7a0b\u6c60\npublic static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable)\n// \u4e0d\u5e26\u8fd4\u56de\u503c\u7684\u5f02\u6b65\u8bf7\u6c42\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\npublic static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable, Executor executor)\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws ExecutionException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6a21\u62df\u8017\u65f6\u7684\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println((\"\u6570\u636e\u52a0\u8f7d\u4e2d\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"\u7ed3\u679c\";\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0CompletableFuture&lt;Void&gt; future2 = CompletableFuture.runAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println((\"\u6b63\u5728\u6267\u884c\u4e00\u4e9b\u5904\u7406\"));\n\u00a0\u00a0\u00a0\u00a0});\n}\n</code></pre> Text Only<pre><code>\u6570\u636e\u52a0\u8f7d\u4e2d\n\u6b63\u5728\u6267\u884c\u4e00\u4e9b\u5904\u7406\n</code></pre> \u83b7\u53d6\u4efb\u52a1\u8fd4\u56de\u503c\u7684\u65b9\u6cd5 Text Only<pre><code>// \u5982\u679c\u5b8c\u6210\u5219\u8fd4\u56de\u7ed3\u679c\uff0c\u5426\u5219\u5c31\u629b\u51fa\u5177\u4f53\u7684\u5f02\u5e38\npublic T get() throws InterruptedException, ExecutionException\n// \u6700\u5927\u65f6\u95f4\u7b49\u5f85\u8fd4\u56de\u7ed3\u679c\uff0c\u5426\u5219\u5c31\u629b\u51fa\u5177\u4f53\u5f02\u5e38\npublic T get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException\n// \u5b8c\u6210\u65f6\u8fd4\u56de\u7ed3\u679c\u503c\uff0c\u5426\u5219\u629b\u51faunchecked\u5f02\u5e38\u3002\u4e3a\u4e86\u66f4\u597d\u5730\u7b26\u5408\u901a\u7528\u51fd\u6570\u5f62\u5f0f\u7684\u4f7f\u7528\uff0c\u5982\u679c\u5b8c\u6210\u6b64 CompletableFuture\u6240\u6d89\u53ca\u7684\u8ba1\u7b97\u5f15\u53d1\u5f02\u5e38\uff0c\u5219\u6b64\u65b9\u6cd5\u5c06\u5f15\u53d1unchecked\u5f02\u5e38\u5e76\u5c06\u5e95\u5c42\u5f02\u5e38\u4f5c\u4e3a\u5176\u539f\u56e0\npublic T join()\n// \u5982\u679c\u5b8c\u6210\u5219\u8fd4\u56de\u7ed3\u679c\u503c\uff08\u6216\u629b\u51fa\u4efb\u4f55\u9047\u5230\u7684\u5f02\u5e38\uff09\uff0c\u5426\u5219\u8fd4\u56de\u7ed9\u5b9a\u7684 valueIfAbsent\u3002\npublic T getNow(T valueIfAbsent)\n// \u5982\u679c\u4efb\u52a1\u6ca1\u6709\u5b8c\u6210\uff0c\u8fd4\u56de\u7684\u503c\u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u503c\npublic boolean complete(T value)\n// \u5982\u679c\u4efb\u52a1\u6ca1\u6709\u5b8c\u6210\uff0c\u5c31\u629b\u51fa\u7ed9\u5b9a\u5f02\u5e38\npublic boolean completeExceptionally(Throwable ex)\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws ExecutionException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6a21\u62df\u8017\u65f6\u7684\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println((\"\u6570\u636e\u52a0\u8f7d\u4e2d\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"future1\u7ed3\u679c\";\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u7ed3\u679c-&gt;\" + future1.get());\n\u00a0\u00a0\u00a0\u00a0CompletableFuture&lt;Void&gt; future2 = CompletableFuture.runAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println((\"\u6b63\u5728\u6267\u884c\u4e00\u4e9b\u5904\u7406\"));\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u7ed3\u679c-&gt;\" + future2.get());\n}\n</code></pre> Text Only<pre><code>\u6570\u636e\u52a0\u8f7d\u4e2d\n\u7ed3\u679c-&gt;future1\u7ed3\u679c\n\u6b63\u5728\u6267\u884c\u4e00\u4e9b\u5904\u7406\n\u7ed3\u679c-&gt;null\n</code></pre></p> <p>2\u3001\u5f02\u6b65\u56de\u8c03\u5904\u7406 Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0CompletableFuture.supplyAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u67e5\u8be2\u6570\u636e\u5e93\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"\u67e5\u8be2\u7ed3\u679c\";\n\u00a0\u00a0\u00a0\u00a0}).thenApply(result -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5bf9\u7ed3\u679c\u8fdb\u884c\u5904\u7406\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"thenApply\u5904\u7406\u540e\u7684\u7ed3\u679c\uff1a\" + result;\n\u00a0\u00a0\u00a0\u00a0}).thenAccept(processedResult -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6d88\u8d39\u5904\u7406\u540e\u7684\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"thenAccept\u6700\u7ec8\u7ed3\u679c\uff1a\" + processedResult);\n\u00a0\u00a0\u00a0\u00a0}).thenRun(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6267\u884c\u4e00\u4e9b\u4e0d\u9700\u8981\u524d\u4e00\u4e2a\u7ed3\u679c\u7684\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u6240\u6709\u64cd\u4f5c\u5b8c\u6210\");\n\u00a0\u00a0\u00a0\u00a0});\n}\n</code></pre> Text Only<pre><code>\u67e5\u8be2\u6570\u636e\u5e93\nthenAccept\u6700\u7ec8\u7ed3\u679c\uff1athenApply\u5904\u7406\u540e\u7684\u7ed3\u679c\uff1a\u67e5\u8be2\u7ed3\u679c\n\u6240\u6709\u64cd\u4f5c\u5b8c\u6210\n</code></pre></p> <p>3\u3001\u591a\u4efb\u52a1\u7ec4\u5408\u5904\u7406 Text Only<pre><code>public static void main(String[] args) throws ExecutionException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u52a0\u8f7d\u7528\u6237\u6570\u636e\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"\u7528\u6237\u5c0f\u9ed1\";\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0 \u00a0 CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u52a0\u8f7d\u914d\u7f6e\u4fe1\u606f\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"\u914d\u7f6e\u4fe1\u606f\";\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0// \u7ec4\u5408\u4e24\u4e2afuture\uff0c\u7b49\u5f85\u5b83\u4eec\u90fd\u5b8c\u6210\n\u00a0\u00a0\u00a0\u00a0CompletableFuture&lt;String&gt; combinedFuture = future1.thenCombine(future2, (user, config) -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"\u5904\u7406\u7ed3\u679c: \" + user + \"\uff0c\" + config;\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0System.out.println(combinedFuture.get());\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/06-%E9%94%81%20%E5%92%8C%20%E5%90%8C%E6%AD%A5%E5%99%A8/","title":"06-\u9501 \u548c \u540c\u6b65\u5668","text":"<p> \u7ea6 969 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>ReentrantLock\uff0c\u53ef\u91cd\u5165\u9501 A\u548c\u7ebf\u7a0bB\u4f7f\u7528\u540c\u4e00\u4e2a\u9501LOCK\uff0c\u6b64\u65f6\u7ebf\u7a0bA\u9996\u5148\u83b7\u53d6\u5230\u9501LOCK.lock()\uff0c\u5e76\u4e14\u59cb\u7ec8\u6301\u6709\u4e0d\u91ca\u653e\u3002\u5982\u679c\u6b64\u65f6B\u8981\u53bb\u83b7\u53d6\u9501\uff0c\u6709\u56db\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>LOCK.lock(): \u6b64\u65b9\u5f0f\u4f1a\u59cb\u7ec8\u5904\u4e8e\u7b49\u5f85\u4e2d\uff0c\u5373\u4f7f\u8c03\u7528B.interrupt()\u4e5f\u4e0d\u80fd\u4e2d\u65ad\uff0c\u9664\u975e\u7ebf\u7a0bA\u8c03\u7528LOCK.unlock()\u91ca\u653e\u9501\u3002</li> <li>LOCK.lockInterruptibly(): \u6b64\u65b9\u5f0f\u4f1a\u7b49\u5f85\uff0c\u4f46\u5f53\u8c03\u7528B.interrupt()\u4f1a\u88ab\u4e2d\u65ad\u7b49\u5f85\uff0c\u5e76\u629b\u51faInterruptedException\u5f02\u5e38\uff0c\u5426\u5219\u4f1a\u4e0elock()\u4e00\u6837\u59cb\u7ec8\u5904\u4e8e\u7b49\u5f85\u4e2d\uff0c\u76f4\u5230\u7ebf\u7a0bA\u91ca\u653e\u9501\u3002</li> <li>LOCK.tryLock(): \u8be5\u5904\u4e0d\u4f1a\u7b49\u5f85\uff0c\u83b7\u53d6\u4e0d\u5230\u9501\u5c31\u76f4\u63a5\u8fd4\u56defalse\uff0c\u53bb\u6267\u884c\u4e0b\u9762\u7684\u903b\u8f91\u3002</li> <li>LOCK.tryLock(10, TimeUnit.SECONDS)\uff1a\u8be5\u5904\u4f1a\u572810\u79d2\u65f6\u95f4\u5185\u5904\u4e8e\u7b49\u5f85\u4e2d\uff0c\u4f46\u5f53\u8c03\u7528B.interrupt()\u4f1a\u88ab\u4e2d\u65ad\u7b49\u5f85\uff0c\u5e76\u629b\u51faInterruptedException\u300210\u79d2\u65f6\u95f4\u5185\u5982\u679c\u7ebf\u7a0bA\u91ca\u653e\u9501\uff0c\u4f1a\u83b7\u53d6\u5230\u9501\u5e76\u8fd4\u56detrue\uff0c\u5426\u521910\u79d2\u8fc7\u540e\u4f1a\u83b7\u53d6\u4e0d\u5230\u9501\u5e76\u8fd4\u56defalse\uff0c\u53bb\u6267\u884c\u4e0b\u9762\u7684\u903b\u8f91\u3002</li> </ul> <p>ReadWriteLock\uff0c\u8bfb\u5199\u9501 \u8bfb\u8bfb\u4e0d\u4e92\u65a5 \u8bfb\u5199\u4e92\u65a5\uff0c\u52a0\u4e86\u8bfb\u9501\u4e4b\u540e\u4f1a\u963b\u585e\u5176\u5b83\u8bd5\u56fe\u52a0\u5199\u9501\u7684\u7ebf\u7a0b \u5199\u5199\u4e92\u65a5\uff0c\u52a0\u4e86\u5199\u9501\u4e4b\u540e\uff0c\u4f1a\u963b\u585e\u5176\u5b83\u8bd5\u56fe\u52a0\u5199\u9501\u7684\u7ebf\u7a0b</p> <p><code>\u4e0e\u5199\u65f6\u590d\u5236\u7684\u533a\u522b\u662f</code>\uff0c\u5199\u65f6\u590d\u5236\u53ea\u6709\u5199\u5199\u64cd\u4f5c\u4e92\u65a5\uff0c\u8bfb\u8bfb\u548c\u8bfb\u5199\u90fd\u4e0d\u4e92\u65a5\uff08\u53ef\u4ee5\u8fd9\u6837\u8ba4\u4e3a\uff0c\u8bfb\u5199\u540c\u65f6\u8fdb\u884c\u65f6\uff0c\u8bfb\u64cd\u4f5c\u8bfb\u5230\u7684\u662f\u8bfb\u64cd\u4f5c\u5f00\u59cb\u65f6\u7684\u5feb\u7167\uff09</p> <p>\u793a\u4f8b\uff1a\u53ef\u4ee5\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\uff1b\u8bfb\u4e2d\u95f4\u4e0d\u4f1a\u6709\u5199\uff1b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5199\uff0c\u5199\u4e2d\u95f4\u4e0d\u4f1a\u6709\u8bfb\u6216\u8005\u5176\u5b83\u5199 Text Only<pre><code>class MyCache{\n\u00a0\u00a0\u00a0\u00a0Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0ReadWriteLock readWriteLock = new ReentrantReadWriteLock();\n\u00a0\u00a0\u00a0\u00a0Lock readLock = readWriteLock.readLock();\n\u00a0\u00a0\u00a0\u00a0Lock writeLock = readWriteLock.writeLock();\n\u00a0\u00a0\u00a0\u00a0public void write(String key, Object value) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writeLock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\\n\" + Thread.currentThread().getName() + \"\u6b63\u5728\u5199\u5165---&gt;\" + value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.MILLISECONDS.sleep((int)(Math.random() * 100));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0map.put(key, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u5199\u5165\u5b8c\u6210!\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}finally{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writeLock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void read(String key) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0readLock.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u6b63\u5728\u8bfb\u53d6...\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.MILLISECONDS.sleep((int)(Math.random() * 100));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object result = map.get(key);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u8bfb\u53d6\u5b8c\u6210--&gt;\" + result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0readLock.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\npublic class ReadWriteLockDemo {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MyCache myCache = new MyCache();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0final int temp = i;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0myCache.write(String.valueOf(temp), String.valueOf(temp));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0myCache.read(String.valueOf(temp));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>CountDownLatch\uff0c\u5012\u8ba1\u6570 \u8c03\u7528countDownLatch.countDown();\u7684\u7ebf\u7a0b\u4f1a\u5c06\u8ba1\u6570\u5668\u51cf\u4e00\u3002\u8c03\u7528countDownLatch.await();\u7684\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u8ba1\u6570\u5668\u51cf\u4e3a0\u3002 \u4e5f\u5c31\u662f\u8c03\u7528countDownLatch.await();\u7684\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85\u6240\u6709\u8c03\u7528countDownLatch.countDown();\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u540e\u518d\u6267\u884c\u3002 \u76f8\u7b49\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u8c03\u7528\u6bcf\u4e2a\u7ebf\u7a0b\u7684join()\u65b9\u6cd5\uff0c\u4e0d\u8fc7\u8fd8\u662fCountDownLatch\u7528\u8d77\u6765\u66f4\u52a0\u65b9\u4fbf\u3002 Text Only<pre><code>public static void main(String[] args) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0CountDownLatch countDownLatch = new CountDownLatch(6);\n\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 6; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t\u79bb\u5f00\u6559\u5ba4\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`countDownLatch.countDown();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, String.valueOf(i)).start();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0`countDownLatch.await();`\n\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t\u73ed\u957f\u9501\u95e8\u8d70\u4eba\");\n}\n</code></pre></p> Text Only<pre><code>public static void main(String[] args) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0CountDownLatch countDownLatch = new CountDownLatch(1);\n\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 6; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t\u7b49\u73ed\u957f\u5f00\u95e8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0countDownLatch.await();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t\u8fdb\u5165\u6559\u5ba4\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, String.valueOf(i)).start();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(5);\n\u00a0\u00a0 \u00a0System.out.println(Thread.currentThread().getName() + \"\\t\u73ed\u957f\u5f00\u95e8\");\n\u00a0\u00a0\u00a0\u00a0countDownLatch.countDown();\n\u00a0 \u00a0}\n</code></pre> <p>CyclicBarrier\uff0c\u5faa\u73af\u6805\u680f \u4e0b\u9762\u7a0b\u5e8f\u6f14\u793a\u7684\u662f\uff0c10\u4e2a\u58eb\u5175\u5fc5\u987b\u5230\u9f50\u4e4b\u540e\u624d\u53ef\u4ee5\u5f00\u59cb\u5b8c\u6210\u81ea\u5df1\u5404\u81ea\u7684\u4efb\u52a1\u3002 \u6bcf\u4e2a\u7ebf\u7a0bawait\u7684\u65f6\u5019\u4f1a\u505c\u4e0b\u6765\u7b49\u5f85\uff0c\u5f53\u5230\u8fbe10\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u89e6\u53d1CyclicBarrier\u4e2d\u7684\u4efb\u52a1\uff0cCyclicBarrier\u4e2d\u7684\u4efb\u52a1\u4e2d\u7684\u4efb\u52a1\u5b8c\u6210\u65f6\u5c31\u4f1a\u5524\u9192\u6240\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u4e00\u76f4\u8fd9\u6837\u91cd\u590d\u5faa\u73af\u5f80\u590d\u7684\u8fdb\u884c\uff0c\u6240\u4ee5\u79f0\u4e4b\u4e3a\u5faa\u73af\u8ba1\u6570\u3002 Text Only<pre><code>class Soldier implements Runnable{\n\u00a0\u00a0\u00a0\u00a0private final CyclicBarrier cyclicBarrier;\n\n\u00a0\u00a0\u00a0\u00a0public Soldier(CyclicBarrier cyclicBarrier) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.cyclicBarrier = cyclicBarrier;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u7b7e\u5230\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`cyclicBarrier.await();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u4efb\u52a1\u5b8c\u6210\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`cyclicBarrier.await();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\nclass BarrierRun implements Runnable{\n\u00a0\u00a0\u00a0\u00a0boolean flag = true;\n\u00a0\u00a0\u00a0\u00a0int N;\n\n\u00a0\u00a0\u00a0\u00a0public BarrierRun(int n) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0N = n;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(flag){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Soldier\u603b\u6570: \" + N + \", \u5230\u9f50\u4e86\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0flag = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}else{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Soldier\u603b\u6570: \" + N + \", \u4efb\u52a1\u5b8c\u6210\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic class CyclicBarrierDemo02 {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread[] soldiers = new Thread[10];\n `CyclicBarrier cyclicBarrier = new CyclicBarrier(10, new BarrierRun(10));`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable r = new Soldier(cyclicBarrier);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0soldiers[i] = new Thread(r, \"soldier-\" + i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0soldiers[i].start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Semaphore\uff0c\u4fe1\u53f7\u91cf \u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u91cc\u5b66\u7684pv\u64cd\u4f5c\u91cc\u7684\u4fe1\u53f7\u91cf\uff0c\u8868\u793a\u8d44\u6e90\u6570\u76ee\uff0c\u62a2\u5230\u4e86\u5c31\u51cf1\uff0c\u7528\u5b8c\u4e86\u5c31\u91ca\u653e\u6389\uff0c\u4e5f\u5373\u52a01 Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0Semaphore semaphore = new Semaphore(3);\n\n\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 7; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `semaphore.acquire();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u62a2\u5360\u5230\u4e00\u4e2a\u8d44\u6e90\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u91ca\u653e\u8d44\u6e90\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `semaphore.release();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, String.valueOf(i)).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/07-ThreadLocal%E5%8E%9F%E7%90%86/","title":"07-ThreadLocal\u539f\u7406","text":"<p> \u7ea6 801 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u5b9e\u4f8b\u5316ThreadLocal\u5bf9\u8c61\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a 1.\u666e\u901a\u7684\u5b9e\u4f8b\u5316 Text Only<pre><code>ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;&gt;();\n</code></pre> 2.\u6307\u5b9a\u521d\u59cb\u5316value\u7684\u5b9e\u4f8b\u5316\uff0c\u5728get()\u65b9\u6cd5\u6ca1\u6709\u503c\u65f6\u8c03\u7528initialValue()\u65b9\u6cd5\u8bbe\u7f6e\u9ed8\u8ba4\u503c Text Only<pre><code>ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected Integer initialValue() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1;\n\u00a0\u00a0\u00a0\u00a0}\n};\n</code></pre> \u4e0a\u9762\u7684\u5199\u6cd5\u7b49\u4ef7\u4e8e\uff0c\u63a8\u8350\u4f7f\u7528\u4e0b\u9762\u8fd9\u79cd\uff0cwithInitial()\u65b9\u6cd5\u5c31\u662fjdk\u63d0\u4f9b\u7528\u6765\u66ff\u4ee3\u4e0a\u9762\u90a3\u79cd\u5b9e\u4f8b\u5316\u65b9\u5f0f\u7684\u65b9\u6cd5 Text Only<pre><code>ThreadLocal&lt;Integer&gt; threadLocal = ThreadLocal.withInitial(() -&gt; 1);\n</code></pre></p> <p>\u539f\u7406\uff1a ThreadLocalMap\u662fThreadLocal\u7684\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u6bcf\u4e2aThread\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2aThreadLocalMap\u5bf9\u8c61\uff0c\u503c\u5c31\u4fdd\u5b58\u5728\u8be5ThreadLocalMap\u5bf9\u8c61\u91cc\u9762\uff0c\u901a\u8fc7\u8c03\u7528ThreadLocalMap\u7684set()\u548cget()\u65b9\u6cd5\u6765\u8bbe\u7f6e\u548c\u83b7\u53d6\u503c\u3002 Text Only<pre><code>ThreadLocal.ThreadLocalMap threadLocals = null;\n</code></pre></p> <p>ThreadLocal\u4f1a\u4e3a\u6bcf\u4e2aThread\u5bf9\u8c61\u521b\u5efa\u4e00\u4e2aThreadLocalMap\u5b9e\u4f8b\uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ebf\u7a0bset\u503c\u548cget\u503c\u90fd\u4e0d\u4f1a\u4e92\u76f8\u5e72\u6270\u3002\u5728set\u503c\u7684\u65f6\u5019\uff0ckey\u662f\u8c03\u7528set\u65b9\u6cd5\u7684ThreadLocal\u5bf9\u8c61\uff0c\u6240\u4ee5Thread\u53ef\u4ee5\u5229\u7528\u4e0d\u540c\u7684ThradLocal\u4fdd\u5b58\u4e0d\u540c\u7684\u503c\u3002 Text Only<pre><code>public void set(T value) {\n\u00a0\u00a0\u00a0\u00a0Thread t = Thread.currentThread();\n\u00a0\u00a0\u00a0\u00a0ThreadLocalMap map = getMap(t);\n\u00a0\u00a0\u00a0\u00a0if (map != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0map.set(this, value);\n\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0createMap(t, value);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre>  \u6ca1\u770b\u6e90\u7801\u4e4b\u524d\u7684\u601d\u8003\u662f\uff1aThreadLocal\u662f\u4e00\u4e2aMap\uff0c\u6bcf\u4e2aThread\u8c03\u7528ThreadLocal\u7684set\u5c31\u662f\u5728\u5f80\u8fd9\u4e2aMap\u91cc\u8bbe\u7f6e\u503c\uff0ckey\u662fThread\uff0c\u6240\u4ee5ThreadLocal\u9700\u8981\u89e3\u51b3\u5e76\u53d1\u4fee\u6539Map\u7684\u95ee\u9898\u3002\u5982\u679c\u8981\u4fdd\u5b58\u591a\u4e2a\u503c\u5c31\u9700\u8981\u521b\u5efa\u591a\u4e2aThreadLocal\u3002 \u770b\u4e86\u6e90\u7801\u4e4b\u540e\u53d1\u73b0\u662f\u53cd\u7684\uff0c\u6bcf\u4e2aThread\u90fd\u6709\u4e00\u4e2aMap\uff0c\u7136\u540e\u8c03\u7528ThreadLocal\u7684set\u5c31\u662f\u5728\u5f80\u8fd9\u4e2aMap\u91cc\u8bbe\u7f6e\u503c\uff0ckey\u662fThreadLocal\u5bf9\u8c61\uff0c\u5982\u6b64\u4e00\u6765\u5c31\u4e0d\u9700\u8981\u89e3\u51b3\u5e76\u53d1\u4fee\u6539Map\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684Map\uff0c\u4e0d\u5b58\u5728\u5e76\u53d1\u4fee\u6539\u7684\u95ee\u9898\u3002\u56e0\u4e3akey\u662fThreadLocal\u5bf9\u8c61\uff0c\u6240\u4ee5\u8981\u4fdd\u5b58\u591a\u4e2a\u503c\u5c31\u9700\u8981\u521b\u5efa\u591a\u4e2aThreadLocal\uff0c\u4e5f\u53ef\u4ee5\u8fbe\u5230\u540c\u6837\u7684\u76ee\u7684\u5e76\u4e14\u8fd8\u5de7\u5999\u7684\u907f\u5f00\u4e86\u5e76\u53d1\u4fee\u6539Map\u7684\u95ee\u9898\u3002 \u4e0b\u9762\u662fThradLocal\u7684get()\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230\u5c31\u662f\u5728Thread\u81ea\u5df1\u7684Map\u4e0a\u53d6\u503c\u3002 Text Only<pre><code>public T get() {\n\u00a0\u00a0\u00a0\u00a0Thread t = Thread.currentThread();\n\u00a0\u00a0\u00a0\u00a0ThreadLocalMap map = getMap(t);\n\u00a0\u00a0\u00a0\u00a0if (map != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ThreadLocalMap.Entry e = map.getEntry(this);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (e != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@SuppressWarnings(\"unchecked\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0T result = (T)e.value;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return result;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return setInitialValue();\n}\n</code></pre></p> <p>ThreadLocal\u7684\u5185\u5b58\u6cc4\u9732\u95ee\u9898\uff1a\u5982\u679c\u4e00\u4e2a\u4f7f\u7528\u4e86ThreadLocal\u7684\u7ebf\u7a0b\u8fdf\u8fdf\u4e0d\u7ed3\u675f\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u4e00\u76f4\u6301\u6709ThreadLocalMap\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u6240\u4ee5ThreadLocalMap\u5bf9\u8c61\u4e5f\u5c31\u4e0d\u80fd\u88ab\u56de\u6536\uff0cThreadLocalMap\u5bf9\u8c61\u91cc\u9762\u4fdd\u5b58\u7740key\u548cvalue\uff0c\u5b83\u4eec\u4e5f\u662f\u5f15\u7528\uff0c\u4e0d\u8fc7key\u662fThreadLocal\u5bf9\u8c61\u7684\u5f31\u5f15\u7528\uff0c\u6240\u4ee5\u4e0d\u4f1a\u7ed9ThreadLocal\u5bf9\u8c61\u7684\u56de\u6536\u9020\u6210\u8d1f\u62c5\uff0c\u4f46\u662fvalue\u662f\u7528\u6237\u8bbe\u7f6e\u7684\u5f3a\u5f15\u7528\uff0c\u6240\u4ee5\u53ea\u8981ThreadLocalMap\u5bf9\u8c61\u4e0d\u91ca\u653e\uff0cvalue\u6240\u6307\u5411\u7684\u5bf9\u8c61\u4e5f\u5c31\u4e0d\u80fd\u88ab\u91ca\u653e\uff0c\u5e76\u4e14\u8fd8\u4f1a\u51fa\u73b0key\u6240\u6307\u5411\u7684ThreadLocalMap\u5bf9\u8c61\u5df2\u7ecf\u88ab\u56de\u6536\uff0c\u6b64\u65f6key\u4e3anull\uff0c\u4f46\u662fkey\u5bf9\u5e94\u7684value\u5374\u4e0d\u80fd\u56de\u6536\u7684\u60c5\u51b5\uff0c\u8fd9\u5c31\u662f\u59a5\u59a5\u7684\u5185\u5b58\u6cc4\u9732\u3002\uff08ThreadLocalMap\u7684Entry\u7684key\u662f\u5f31\u5f15\u7528\uff0c\u6240\u4ee5Entry\u7684key\u4e0d\u4f1a\u4f5c\u4e3aThreadLocal\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\uff0c\u5f53\u53d1\u751fgc\u65f6\uff0c\u5982\u679cThreadLocal\u5bf9\u8c61\u6ca1\u6709\u5f3a\u5f15\u7528\u4e86\uff08\u5178\u578b\u7684\u5c31\u662f\u6700\u521d\u521b\u5efaThreadLocal\u5bf9\u8c61\u65f6\u7684\u5f15\u7528\uff09\uff0cThreadLocal\u5bf9\u8c61\u53ef\u4ee5\u88ab\u987a\u5229\u56de\u6536\uff0c\u6b64\u65f6ThreadLocalMap\u7684Entry\u7684key\u4e3anull\u3002\uff09 \u89e3\u51b3\u5185\u5b58ThreadLocal\u7684\u5185\u5b58\u6cc4\u9732\u7684\u65b9\u6cd5\u5c31\u662f\u5f53\u7ebf\u7a0b\u4e0d\u518d\u4f7f\u7528ThreadLocal\u65f6\uff0c\u9700\u8981\u8c03\u7528\u5176remove()\u65b9\u6cd5\u5220\u9664ThreadLocalMap\u5bf9\u8c61\u91cc\u7684Entry\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/08-ConcurrentHashMap-jdk15%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/","title":"08-ConcurrentHashMap-jdk15\u6e90\u7801\u89e3\u8bfb","text":"<p> \u7ea6 5823 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 116 \u5206\u949f</p> <p>ConcurrentHashMap\u7684\u6570\u636e\u7ed3\u6784\u548cHashMap\u4e00\u6837\uff1a\u6570\u7ec4+\u94fe\u8868+\u7ea2\u9ed1\u6811\u3002 </p> <p>\u51e0\u4e2a\u91cd\u8981\u7684\u5e38\u91cf Text Only<pre><code>//\u6570\u7ec4\u6700\u5927\u5bb9\u91cf\nprivate static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;\n//\u6570\u7ec4\u9ed8\u8ba4\u5bb9\u91cf\nprivate static final int DEFAULT_CAPACITY = 16;\n//\u9ed8\u8ba4\u7684\u88c5\u8f7d\u56e0\u5b50\uff0c\u4e5f\u53ef\u4ee5\u5728\u6784\u9020\u5668\u4e2d\u7ed9\u51fa\uff0c\u4e0d\u8fc7\u5b83\u53ea\u5728\u521d\u59cb\u5316\u6570\u7ec4\u7684\u65f6\u5019\u6709\u7528\uff0c\u4e4b\u540e\u7684\u6269\u5bb9\u9608\u503c\u90fd\u4e0e\u5b83\u6ca1\u5173\u7cfb\uff0c\u5373\u4e4b\u540e\u8ba1\u7b97\u6269\u5bb9\u9608\u503c\u6ca1\u6709\u4f7f\u7528\u5b83\u8fdb\u884c\u8ba1\u7b97\uff0c\u800c\u662f\u4f7f\u7528\u4f4d\u8fd0\u7b97\uff0c\u5982n - (n &gt;&gt;&gt; 2)\nprivate static final float LOAD_FACTOR = 0.75f;\n//\u9ed8\u8ba4\u6811\u5316\u9608\u503c\uff0c\u5f53\u94fe\u8868\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e\u8fd9\u4e2a\u9608\u503c\u65f6\u8003\u8651\u6811\u5316\nstatic final int TREEIFY_THRESHOLD = 8;\n//\u89e3\u9664\u6811\u5316\u7684\u9608\u503c\nstatic final int UNTREEIFY_THRESHOLD = 6;\n//\u6700\u5c0f\u6811\u5316\u7684\u5bb9\u91cf\uff0c\u5373\u5f53\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u7684\u65f6\u5019\uff0c\u82e5\u94fe\u8868\u957f\u5ea6\u5927\u4e8e8\uff0c\u4e0d\u4f1a\u8fdb\u884c\u6811\u5316\uff0c\u800c\u662f\u8fdb\u884c\u6269\u5bb9\nstatic final int MIN_TREEIFY_CAPACITY = 64;\n//\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f\uff0c\u591a\u7ebf\u7a0b\u8fc1\u79fbmap\u65f6\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u9886\u53d6\u7684\u6700\u5c0f\u5b50\u6570\u7ec4\u7684\u957f\u5ea6\nprivate static final int MIN_TRANSFER_STRIDE = 16;\n//\u534f\u52a9\u6269\u5bb9\u7684\u6700\u5927\u7ebf\u7a0b\u6570\nprivate static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1;\n//forwarding\u8282\u70b9\u7684hash\u503c\nstatic final int MOVED = -1; // hash for forwarding nodes\n`//\u5982\u679c\u4e00\u4e2a\u6876\u5df2\u7ecf\u6811\u5316\u4e86\uff0c\u90a3\u4e48\u6811\u6839\u8282\u70b9\u7684hash\u5c31\u662f-2`\n`static final int TREEBIN\u00a0\u00a0\u00a0= -2; // hash for roots of trees`\n//cpu\u6838\u6570\nstatic final int NCPU = Runtime.getRuntime().availableProcessors();\n</code></pre></p> <p>\u51e0\u4e2a\u91cd\u8981\u7684\u9759\u6001\u5185\u90e8\u7c7b \u94fe\u8868\u7684\u8282\u70b9\uff1a Text Only<pre><code>static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {\n\u00a0\u00a0\u00a0\u00a0final int hash;\n\u00a0\u00a0\u00a0\u00a0final K key;\n\u00a0\u00a0\u00a0\u00a0volatile V val;\n\u00a0\u00a0\u00a0\u00a0volatile Node&lt;K,V&gt; next;\n}\n</code></pre> \u8fc1\u79fb\u65f6\uff0c\u653e\u5728\u5df2\u7ecf\u8fc1\u79fb\u5b8c\u7684\u6876\u4e0a\uff0c\u5c31\u662f\u628a\u6570\u7ec4\u5143\u7d20\u539f\u6765\u7684\u4f4d\u7f6e\u4e0a\u7684\u8282\u70b9\u66ff\u6362\u6210forwarding\u8282\u70b9 Text Only<pre><code>static final class `ForwardingNode`&lt;K,V&gt; extends Node&lt;K,V&gt; {\n\u00a0\u00a0\u00a0\u00a0final Node&lt;K,V&gt;[] nextTable;\n\u00a0\u00a0\u00a0\u00a0ForwardingNode(Node&lt;K,V&gt;[] tab) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0super(`MOVED`, null, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.nextTable = tab;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u7ea2\u9ed1\u6811\u8282\u70b9\uff1a Text Only<pre><code>static final class TreeNode&lt;K,V&gt; `extends Node&lt;K,V&gt;` {\n\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; parent;\u00a0\u00a0// red-black tree links\n\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; left;\n\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; right;\n\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; prev;\u00a0\u00a0\u00a0\u00a0// needed to unlink next upon deletion\n\u00a0\u00a0\u00a0\u00a0boolean red;\n\n\u00a0\u00a0\u00a0\u00a0TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TreeNode&lt;K,V&gt; parent) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0super(hash, key, val, next);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.parent = parent;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u7ef4\u62a4ConcurrentHashMap\u7684\u8282\u70b9\u6570\u65f6\u7528\uff1a Text Only<pre><code>@jdk.internal.vm.annotation.Contended static final class CounterCell {\n\u00a0\u00a0\u00a0\u00a0volatile long value;\n\u00a0\u00a0\u00a0\u00a0CounterCell(long x) { value = x; }\n}\n</code></pre></p> <p>\u51e0\u4e2a\u91cd\u8981\u7684\u9759\u6001\u65b9\u6cd5 \u8fd9\u51e0\u4e2a\u662f\u5229\u7528CAS\u64cd\u4f5c\u5b9e\u73b0\u7684\u539f\u5b50\u65b9\u6cd5\uff1a Text Only<pre><code>//\u53d6\u6570\u7ec4\u4e0b\u6807 i \u5904\u7684Node\u8282\u70b9\nstatic final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) {\n\u00a0\u00a0\u00a0\u00a0return (Node&lt;K,V&gt;)U.getReferenceAcquire(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);\n}\n\n//\u8bbe\u7f6e\u6570\u7ec4\u4e0b\u6807 i \u5904\u7684Node\u8282\u70b9\uff0c\u5982\u679c\u7b26\u5408\u9884\u671fc\uff0c\u624d\u8bbe\u7f6e\u4e3av\nstatic final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) {\n\u00a0\u00a0\u00a0\u00a0return U.compareAndSetReference(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);\n}\n\n//\u76f4\u63a5\u5c06Node\u8bbe\u7f6e\u5230\u6570\u7ec4\u4e0b\u6807 i \u5904\nstatic final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) {\n\u00a0\u00a0\u00a0\u00a0U.putReferenceRelease(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);\n}\n</code></pre></p> <p>\u51e0\u4e2a\u91cd\u8981\u7684\u6210\u5458\u53d8\u91cf Text Only<pre><code>//\u6570\u7ec4\ntransient volatile Node&lt;K,V&gt;[] table;\n//\u6269\u5bb9\u65f6\u65b0\u5efa\u7684\u6570\u7ec4\uff0c\u7b49\u5230\u628a\u539f\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u90fd\u8fc1\u79fb\u5230\u65b0\u65b0\u6570\u7ec4\u540e\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\u8d4b\u7ed9\u4e0a\u9762table\uff0c\u7136\u540e\u8fd9\u4e2a\u53d8\u91cf\u8d4b\u4e3anull\u3002\u6240\u4ee5\u8fd9\u4e2a\u53d8\u91cf\u53ea\u5728\u6269\u5bb9\u65f6\u624d\u975enull\nprivate transient volatile Node&lt;K,V&gt;[] nextTable;\n//ConcurrentHashMap\u7684\u8282\u70b9\u6570\u7684\u57fa\u6570\uff0c\u5b83\u4e0e\u4e0b\u9762\u7684CounterCell\u6570\u7ec4\u4e2d\u6240\u6709\u5143\u7d20\u7684\u548c\u624d\u662f\u771f\u6b63\u7684ConcurrentHashMap\u7684\u8282\u70b9\u6570\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u63d0\u9ad8\u5e76\u53d1\u7a0b\u5ea6\uff0c\u5176\u539f\u7406\u548c\u539f\u5b50\u7d2f\u52a0\u5668LongAdder\u4e00\u6837\nprivate transient volatile long baseCount;\nprivate transient volatile CounterCell[] counterCells;\n//\u5bf9counterCells\u5e76\u53d1\u4fee\u6539\u65f6\u7684\u9501\u6807\u8bb0\uff08\u5229\u7528cas\u5b9e\u73b0\uff09\nprivate transient volatile int cellsBusy;\n//sizeCtl\u7684\u503c\u542b\u4e49\u6bd4\u8f83\u591a\uff0c\u540e\u9762\u5355\u72ec\u8bf4\u660e\nprivate transient volatile int sizeCtl;\n//\u6269\u5bb9\u65f6\uff0ctransferIndex\u6307\u793a\u7740\u8fd8\u6ca1\u6709\u88ab\u9886\u53d6\u8fc1\u79fb\u4efb\u52a1\u7684\u6570\u7ec4\u6700\u5927\u4e0b\u6807+1\nprivate transient volatile int transferIndex;\n</code></pre></p> <p>sizeCtl\u542b\u4e49</p> <ul> <li>sizeCtl\u4e3a0\uff0c\u4ee3\u8868\u6570\u7ec4\u672a\u521d\u59cb\u5316\uff0c \u4e14\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\u4e3a16</li> <li>sizeCtl\u4e3a\u6b63\u6570\uff0c\u5982\u679c\u6570\u7ec4\u672a\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u5176\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\uff0c\u5982\u679c\u6570\u7ec4\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u5176\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u7684\u6269\u5bb9\u9608\u503c</li> <li>sizeCtl\u4e3a-1\uff0c\u8868\u793a\u6570\u7ec4\u6b63\u5728\u8fdb\u884c\u521d\u59cb\u5316</li> <li>sizeCtl\u5c0f\u4e8e0\uff0c\u5e76\u4e14\u4e0d\u662f-1\uff0c\u8868\u793a\u6570\u7ec4\u6b63\u5728\u6269\u5bb9\uff0c -(1+n)\uff0c\u8868\u793a\u6b64\u65f6\u6709n\u4e2a\u7ebf\u7a0b\u6b63\u5728\u5171\u540c\u5b8c\u6210\u6570\u7ec4\u7684\u6269\u5bb9\u64cd\u4f5c</li> </ul> <p>\u521d\u59cb\u5316 ConcurrentHashMap\u4e2d\u4e00\u5171\u67095\u4e2a\u6784\u9020\u65b9\u6cd5\uff0c\u8fd9\u56db\u4e2a\u6784\u9020\u65b9\u6cd5\u4e2d\u90fd\u6ca1\u6709\u5bf9\u5185\u90e8\u7684\u6570\u7ec4\u505a\u521d\u59cb\u5316\uff0c \u53ea\u662f\u5bf9\u4e00\u4e9b\u53d8\u91cf\u7684\u521d\u59cb\u503c\u505a\u4e86\u5904\u7406\uff0c\u771f\u6b63\u505a\u6570\u7ec4\u521d\u59cb\u5316\u662f\u5728\u7b2c\u4e00\u6b21\u6dfb\u52a0\u5143\u7d20\u65f6\u5b8c\u6210\uff0c\u5373\u61d2\u521d\u59cb\u5316\uff08Lazily initialized\uff09\u3002 Text Only<pre><code>//\u5982\u679c\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u6570\u7ec4\u957f\u5ea6\u9ed8\u8ba4\u662f16\npublic ConcurrentHashMap() {\n}\n//\u4f20\u4e00\u4e2a\u521d\u59cb\u5bb9\u91cf\uff0cConcurrentHashMap\u4f1a\u57fa\u4e8e\u8fd9\u4e2a\u503c\u8ba1\u7b97\u4e00\u4e2a\u6bd4\u8fd9\u4e2a\u503c\u5927\u76842\u7684\u5e42\u6b21\u65b9\u6570\u4f5c\u4e3a\u521d\u59cb\u5bb9\u91cf\npublic ConcurrentHashMap(int initialCapacity) {\n\u00a0\u00a0\u00a0\u00a0this(initialCapacity, LOAD_FACTOR, 1);\n}\n\npublic ConcurrentHashMap(Map&lt;? extends K, ? extends V&gt; m) {\n\u00a0\u00a0\u00a0\u00a0this.sizeCtl = DEFAULT_CAPACITY;\n\u00a0\u00a0\u00a0\u00a0putAll(m);\n}\n\npublic ConcurrentHashMap(int initialCapacity, float loadFactor) {\n\u00a0\u00a0\u00a0\u00a0this(initialCapacity, loadFactor, 1);\n}\n//\u8ba1\u7b97\u4e00\u4e2a\u5927\u4e8e\u6216\u8005\u7b49\u4e8e\u7ed9\u5b9a\u7684\u5bb9\u91cf\u503c\uff0c\u8be5\u503c\u662f2\u7684\u5e42\u6b21\u65b9\u6570\u4f5c\u4e3a\u521d\u59cb\u5bb9\u91cf\npublic ConcurrentHashMap(int initialCapacity,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0float loadFactor, int concurrencyLevel) {\n\u00a0\u00a0\u00a0\u00a0if (!(loadFactor &gt; 0.0f) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalArgumentException();\n\u00a0\u00a0\u00a0\u00a0if (initialCapacity &lt; concurrencyLevel)\u00a0\u00a0\u00a0// Use at least as many bins\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0initialCapacity = concurrencyLevel;\u00a0\u00a0\u00a0// as estimated threads\n\u00a0\u00a0\u00a0\u00a0long size = (long)(1.0 + (long)initialCapacity / loadFactor);\n\u00a0\u00a0\u00a0\u00a0int cap = (size &gt;= (long)MAXIMUM_CAPACITY) ?\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MAXIMUM_CAPACITY : tableSizeFor((int)size);\n\u00a0\u00a0\u00a0\u00a0this.sizeCtl = cap;\n}\n</code></pre></p> <p>put\u65b9\u6cd5 \u6e90\u7801\u89e3\u8bfb\uff1a Text Only<pre><code>public V put(K key, V value) {\n\u00a0\u00a0\u00a0\u00a0return putVal(key, value, false);\n}\n\n/** Implementation for put and putIfAbsent */\n//put\u65b9\u6cd5\u548cputIfAbsent\u65b9\u6cd5\u7684\u5b9e\u73b0\u90fd\u662fputVal\u65b9\u6cd5\uff0conlyIfAbsent\u5c31\u662f\u7528\u6765\u533a\u5206\u7684\u6807\u8bb0\nfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n\u00a0\u00a0\u00a0\u00a0if (key == null || value == null) throw new NullPointerException();\n\u00a0\u00a0\u00a0\u00a0int hash = spread(key.hashCode()); //\u8ba1\u7b97key\u7684hash\u503c\n\u00a0\u00a0\u00a0\u00a0int binCount = 0; //\u6876\u4e2d\u8282\u70b9\u7684\u6570\u91cf\n\u00a0\u00a0\u00a0\u00a0// cas\u64cd\u4f5c\u5931\u8d25\u540e\u9700\u8981\u91cd\u8bd5\uff0c\u6240\u4ee5\u4f7f\u7528\u6b7b\u5faa\u73af\uff0c\u4f7f\u7528\u6b7b\u5faa\u73af+cas\u64cd\u4f5c\u7684\u65e0\u9501\u5e76\u53d1\u7b56\u7565\u6bd4\u52a0\u4e92\u65a5\u9501\u6548\u7387\u66f4\u9ad8\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u53e6\u5916\u53ef\u4ee5\u770b\u5230\u5faa\u73af\u91cc\u9762\u6709\u5f88\u591aif\u5206\u652f\uff0c\u4e5f\u5c31\u662f\u5f53cas\u64cd\u4f5c\u5931\u8d25\u540e\u4f1a\u91cd\u8bd5\u5f88\u591a\u79cd\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u5e76\u4e0d\u50cf\u6700\u521d\u5165\u95e8\u4e50\u89c2\u9501\u53ea\u4f1a\u4e0d\u65ad\u91cd\u8bd5\u4e00\u4e2a\u64cd\u4f5c\u7684\u4f8b\u5b50\uff0c\u8fd9\u91cc\u624d\u662f\u4e50\u89c2\u9501\u6b63\u786e\u7684\u6253\u5f00\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0for (ConcurrentHashMap.Node&lt;K,V&gt;[] tab = table;;) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt; f; int n, i, fh; K fk; V fv;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (tab == null || (n = tab.length) == 0) //\u7b2c\u4e00\u6b21put\u7684\u65f6\u5019\u624d\u4f1a\u521d\u59cb\u5316\u6570\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 **`tab = initTable();`**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// (n - 1) &amp; hash\u5c31\u662fhash\u5bf9n\u53d6\u4f59\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5i\u5c31\u662f\u6876\u7684\u4f4d\u7f6e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u8fd9\u4e2a\u6876\u91cc\u9762\u6ca1\u6709\u5143\u7d20\uff0c\u90a3\u4e48\u76f4\u63a5\u4f7f\u7528cas\u64cd\u4f5c\u8bbe\u7f6e\u5373\u53ef\uff0c\u5931\u8d25\u4e86\u6b7b\u5faa\u73af\u91cd\u8bd5\u5176\u4ed6\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (casTabAt(tab, i, null, new ConcurrentHashMap.Node&lt;K,V&gt;(hash, key, value)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// no lock when adding to empty bin\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u6b63\u5904\u4e8e\u6269\u5bb9\u9636\u6bb5\uff0c\u5e76\u4e14\u5f53\u524d\u7684\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5f53\u524d\u7684put\u7ebf\u7a0b\u8fdb\u884c\u534f\u52a9\u6269\u5bb9\uff0c\u4ee5\u4fbf\u5c3d\u5feb\u5b8c\u6210\u6269\u5bb9\uff0c\u7136\u540e\u6b7b\u5faa\u73af\u91cd\u8bd5\u5176\u4ed6\u6dfb\u52a0\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if ((fh = f.hash) == MOVED)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0**tab = helpTransfer(tab, f);**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (onlyIfAbsent // check first node without acquiring lock\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&amp;&amp; fh == hash\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&amp;&amp; ((fk = f.key) == key || (fk != null &amp;&amp; key.equals(fk)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&amp;&amp; (fv = f.val) != null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return fv;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0V oldVal = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u52a0\u9501\uff0c\u53ef\u4ee5\u786e\u4fdd\u5176\u4ed6put\u7ebf\u7a0b\u4e0d\u5bf9\u8be5\u6876\u8fdb\u884c\u6dfb\u52a0\u64cd\u4f5c\u6216\u8005\u6811\u5316\u64cd\u4f5c\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u6709\u6269\u5bb9\u7ebf\u7a0b\uff0c\u90a3\u4e48\u8fd8\u53ef\u4ee5\u4fdd\u8bc1\u6269\u5bb9\u7ebf\u7a0b\u4e0d\u5bf9\u8be5\u6876\u8fdb\u884c\u8fc1\u79fb\uff0c\u76f4\u5230\u5f53\u524d\u7ebf\u7a0b\u7684\u6dfb\u52a0\u64cd\u4f5c\u5b8c\u6210\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (f) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u6709\u7ebf\u7a0b\u7ebf\u7a0b\u56e0\u4e3a\u4e0a\u4e00\u53e5\u7684\u52a0\u9501\u64cd\u4f5c\u963b\u585e\u4e86\uff0c\u5f53\u672c\u7ebf\u7a0b\u7684\u6dfb\u52a0\u64cd\u4f5c\u5b8c\u6210\u7d27\u63a5\u7740\u5b8c\u6210\u4e86\u6811\u5316\u64cd\u4f5c\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u90a3\u4e48\u6876\u7684\u7684\u54e5\u5143\u7d20\u5c31\u53ef\u80fd\u53d8\u4e86\uff0c\u6240\u4ee5\u5f53\u963b\u585e\u7ebf\u7a0b\u88ab\u5524\u9192\u4e4b\u540e\uff0c\u9700\u8981\u5728\u8fd9\u91ccdouble check\u4e00\u4e0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (tabAt(tab, i) == f) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (fh &gt;= 0) { //\u5927\u4e8e0\u8868\u793a\u662f\u94fe\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0binCount = 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6bcf\u904d\u5386\u4e00\u4e2a\u8282\u70b9\uff0cbinCount\u52a01\uff0c\u540e\u9762\u4f1a\u6839\u636ebinCount\u7684\u503c\u5224\u65ad\u662f\u5426\u9700\u8981\u8fdb\u884c\u6811\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConcurrentHashMap.Node&lt;K,V&gt; e = f;; ++binCount) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0K ek;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6709\u76f8\u540c\u7684key\uff0c\u90a3\u4e48\u76f4\u63a5\u66f4\u65b0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (e.hash == hash &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((ek = e.key) == key ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(ek != null &amp;&amp; key.equals(ek)))) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oldVal = e.val;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!onlyIfAbsent)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.val = value;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6ca1\u6709\u76f8\u540c\u7684key\uff0c\u90a3\u4e48\u5c06\u65b0\u8282\u70b9\u6dfb\u52a0\u5728\u94fe\u8868\u5c3e\u90e8\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt; pred = e;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((e = e.next) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0pred.next = new ConcurrentHashMap.Node&lt;K,V&gt;(hash, key, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e0d\u662f\u94fe\u8868\uff0c\u5982\u679c\u662f\u6811\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (f instanceof ConcurrentHashMap.TreeBin) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt; p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u56e0\u4e3a\u5df2\u7ecf\u662f\u6811\u5316\u4e86\uff0c\u6240\u4ee5\u5e76\u4e0d\u9700\u8981binCount++\uff0c\u76f4\u63a5\u8d4b\u503c\u4e3a2\u5373\u53ef\uff0c\u8d4b\u503c\u4e3a2\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u540e\u9762\u5224\u65adbinCount&lt;=1\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0binCount = 2;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((p = ((ConcurrentHashMap.TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0value)) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oldVal = p.val;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!onlyIfAbsent)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0p.val = value;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (f instanceof ConcurrentHashMap.ReservationNode)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalStateException(\"Recursive update\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//binCount != 0\u8868\u793a\u6dfb\u52a0\u5b8c\u6210\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (binCount != 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5224\u65ad\u662f\u5426\u9700\u8981\u8fdb\u884c\u6811\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (binCount &gt;= TREEIFY_THRESHOLD)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0treeifyBin(tab, i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679ckey\u503c\u5df2\u7ecf\u5b58\u5728\uff0c\u90a3\u4e48\u5c31\u4e0d\u9700\u8981\u6267\u884c\u540e\u9762\u7684addCount\u4e86\uff0c\u76f4\u63a5\u8fd4\u56de\u5373\u53ef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (oldVal != null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return oldVal;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0`//\u5bf9ConcurrentHashMap\u7684size+1`\n `**addCount(1L, binCount);**`\n\u00a0\u00a0\u00a0\u00a0return null;\n}\n</code></pre> put\u65b9\u6cd5\u6982\u8ff0\uff1aput\u65b9\u6cd5\u5b9e\u73b0\u5e76\u53d1\u5b89\u5168\u7684\u4e3b\u8981\u601d\u60f3\u662f cas+\u81ea\u65cb \u7684\u65e0\u9501\u5e76\u53d1\u7b56\u7565\uff0cConcurrentHashMap\u91cc\u7684\u5f88\u591a\u64cd\u4f5c\u90fd\u662f\u57fa\u4e8e cas+\u81ea\u65cb \u7684\u7b56\u7565\uff0c\u5927\u81f4\u505a\u6cd5\u5c31\u662f\uff0c\u5728\u81ea\u65cb\u91cc\u9762\u4f1a\u6709\u5f88\u591aif\u5206\u652f\uff0c\u7136\u540e\u9010\u4e2a\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u7b26\u5408\u67d0\u4e2a\u5206\u652f\u5224\u65ad\u5c31\u8fdb\u884ccas\u64cd\u4f5c\uff0c\u5f53cas\u64cd\u4f5c\u6210\u529f\u5c31break\u9000\u51fa\u81ea\u65cb\uff0c\u5982\u679ccas\u5931\u8d25\u5c31\u81ea\u65cb\u91cd\u8bd5\u91cd\u65b0\u9010\u4e2a\u5224\u65ad\u3002 put\u7684\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b\uff1a 1. \u9996\u5148\u68c0\u67e5\u662f\u5426\u662f\u7b2c\u4e00\u6b21put\u5143\u7d20\uff0c\u5982\u679c\u662f\uff0c\u9700\u8981\u5148\u521d\u59cb\u5316\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u5728new ConcurrentHashMap\u7684\u65f6\u5019\u5e76\u6ca1\u6709\u521d\u59cb\u5316\u6570\u7ec4\uff0c\u771f\u6b63\u505a\u6570\u7ec4\u521d\u59cb\u5316\u662f\u5728\u7b2c\u4e00\u6b21\u6dfb\u52a0\u5143\u7d20\u65f6\u5b8c\u6210\uff0c\u5373\u61d2\u521d\u59cb\u5316\uff08Lazily initialized\uff09\u3002\u521d\u59cb\u5316\u5b8c\u6210\u540e\u81ea\u65cb\u8fdb\u884c\u6dfb\u52a0\u5143\u7d20\u3002 2. \u5c06keyhash\u4e4b\u540e\u627e\u5230key\u6240\u5728\u6876\uff0c\u7136\u540e\u68c0\u67e5\u4e3anull\uff0c\u5982\u679c\u662f\uff0c\u5c1d\u8bd5\u4f7f\u7528cas\u8bbe\u7f6evalue\uff0ccas\u6210\u529f\u5c31\u76f4\u63a5break\uff0c\u8868\u793a\u6dfb\u52a0\u6210\u529f\uff0c\u5982\u679c\u5931\u8d25\u4e86\uff0c\u81ea\u65cb\u91cd\u65b0\u5c1d\u8bd5\u5176\u4ed6\u60c5\u51b5\u7684\u6dfb\u52a0\u64cd\u4f5c\u3002 3. \u4e0a\u4e00\u6b65\u5931\u8d25\u540e\u8868\u793a\u6876\u7684\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u4e00\u5b9a\u6709\u4e86\u5143\u7d20\uff0c\u6240\u4ee5\u9700\u8981\u68c0\u67e5\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u662fforwarding\u8282\u70b9\uff0c\u5982\u679c\u662f\uff0c\u8868\u793a\u5f53\u524d\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u4e86\uff0c\u5e76\u4e14\u6269\u5bb9\u64cd\u4f5c\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u6b64\u7ebf\u7a0b\u9700\u8981\u53bb\u534f\u52a9\u6269\u5bb9\u3002 4. \u5982\u679c\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e0d\u662fforwarding\u8282\u70b9\uff0c\u90a3\u4e48\u53ef\u80fd\u7684\u60c5\u51b5\u67093\u79cd\uff1a\u3010\u6ca1\u6709\u8fdb\u884c\u6269\u5bb9\u3011\u3001\u6216\u8005\u3010\u6b63\u5728\u6269\u5bb9\uff0c\u4f46\u662f\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u3011\u3001\u6216\u8005\u3010\u6b63\u5728\u6269\u5bb9\uff0c\u4f46\u662f\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u5b8c\uff0c\u53ea\u88ab\u8fc1\u79fb\u4e86\u4e00\u90e8\u5206\u3011\u3002\u7531\u4e8e\u6267\u884c\u6dfb\u52a0\u64cd\u4f5c\u9700\u8981\u4fee\u6539\u94fe\u8868\u6216\u8005\u6811\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u52a0\u4e92\u65a5\u9501\uff0c\u5bf9\u4e8e\u524d\u4e24\u79cd\u60c5\u51b5\uff0c\u8be5\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u52a0\u9501\u6210\u529f\u5e76\u6dfb\u52a0\u6210\u529f\uff0c\u4f46\u662f\u5bf9\u4e8e\u7b2c3\u79cd\u60c5\u51b5\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u6269\u5bb9\u7ebf\u7a0b\u6b63\u5728\u8fc1\u79fb\u6876\u7684\u65f6\u5019\u4e5f\u4f1a\u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u52a0\u4e92\u65a5\u9501\uff0c\u7b49\u5230\u6269\u5bb9\u7ebf\u7a0b\u91ca\u653e\u9501\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u62a2\u5230\u9501\u4e5f\u4e0d\u80fd\u6dfb\u52a0\u6210\u529f\uff0c\u56e0\u4e3a\u4f1adouble check\u4e00\u4e2a\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u8fd8\u662f\u539f\u6765\u7684\u90a3\u4e2a\u5143\u7d20\uff0c\u663e\u7136\u7b2c\u4e00\u4e2a\u5143\u7d20\u88ab\u6269\u5bb9\u7ebf\u7a0b\u6362\u6210\u4e86forwarding\u8282\u70b9\uff0c\u4e8e\u662f\u8be5\u7ebf\u7a0b\u6dfb\u52a0\u5931\u8d25\uff0c\u81ea\u65cb\u91cd\u65b0\u5c1d\u8bd5\u540e\u5230\u7b2c3\u6b65\u53bb\u534f\u52a9\u6269\u5bb9\u3002 5. \u6dfb\u52a0\u5b8c\u6210\u540e\u9700\u8981\u68c0\u67e5\u6876\u7684\u8282\u70b9\u6570\u91cf\uff0c\u5982\u679c\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c\uff0c\u9700\u8981\u8fdb\u884c\u6811\u5316\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0eHashMap\u4e00\u6837\uff0c\u5f53\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u5e76\u4e14\u94fe\u8868\u957f\u5ea6\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c8\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u8fdb\u884c\u6811\u5316\u64cd\u4f5c\uff0c\u800c\u662f\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\u3002 6. \u6700\u540e\u4f1a\u8c03\u7528`addcount`\u65b9\u6cd5\u7ef4\u62a4\u8282\u70b9\u4e2a\u6570\uff0c\u5e76\u4e14\u5f53\u8282\u70b9\u4e2a\u6570\u8fbe\u5230\u6269\u5bb9\u9608\u503c\u65f6`addCount`\u65b9\u6cd5\u8fd8\u4f1a\u8c03\u7528\u6269\u5bb9\u65b9\u6cd5\u3002 </p> <p>\u4ec0\u4e48\u60c5\u51b5\u4e0b\u7ebf\u7a0b\u624d\u4f1a\u8fdb\u884c\u6269\u5bb9\u6216\u8bf4\u52a0\u5165\u6269\u5bb9\uff1f</p> <ol> <li> <p>put\u7ebf\u7a0b\u53d1\u73b0\u6876\u5df2\u88ab\u8fc1\u79fb\uff0c\u5373\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u662fForwardingNode\uff0c\u90a3\u4e48\u4ed6\u4f1a\u52a0\u5165\u6269\u5bb9\u3002\uff08putVal\u65b9\u6cd5\u91cc\u9762\u8c03\u7528helpTransfer\uff0c\u7136\u540e\u8c03\u7528transfer\u65b9\u6cd5\uff09</p> </li> <li> <p>put\u7ebf\u7a0bput\u6210\u529f\u4e4b\u540e\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u7136\u540e\u53d1\u73b0\u8fbe\u5230\u6269\u5bb9\u9608\u503c\u5e76\u4e14\u6ca1\u6709\u7ebf\u7a0b\u5728\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\u4ed6\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u542f\u52a8\u6269\u5bb9\u6d41\u7a0b\u3002\uff08addCount\u65b9\u6cd5\u91cc\u9762\u8c03\u7528transfer\u65b9\u6cd5\uff09</p> </li> <li> <p>put\u7ebf\u7a0bput\u6210\u529f\u4e4b\u540e\uff0c\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c\uff0c\u4f46\u662f\u6570\u7ec4\u957f\u5ea6\u5374\u5c0f\u4e8e64\uff0c\u90a3\u4e48\u4ed6\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u542f\u52a8\u6269\u5bb9\u6d41\u7a0b\u3002\uff08putVal\u65b9\u6cd5\u91cc\u9762\u8c03\u7528treeifyBin\u65b9\u6cd5\uff0c\u7136\u540e\u8c03\u7528tryPresize\u65b9\u6cd5\uff0c\u7136\u540e\u8c03\u7528transfer\u65b9\u6cd5\uff09</p> </li> <li> <p>put\u7ebf\u7a0bput\u4e00\u4e2a\u65b0\u8282\u70b9\u6210\u529f\u4e4b\u540e\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u7136\u540e\u53d1\u73b0\u6709\u7ebf\u7a0b\u5728\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\u5b83\u4f1a\u52a0\u5165\u6269\u5bb9\uff08\u6ce8\u610fput\u7684\u662f\u5df2\u6709value\uff0c\u90a3\u4e48\u5b83\u4e0d\u9700\u8981\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u52a0\u5165\u6269\u5bb9\uff09\u3002\uff08addCount\u65b9\u6cd5\u91cc\u9762\u8c03\u7528transfer\u65b9\u6cd5\uff09</p> </li> </ol> <p>\u5982\u679c\u5df2\u6709\u7ebf\u7a0b\u6b63\u5728\u8fdb\u884c\u6269\u5bb9\uff0c\u8fd9\u65f6\u65b0\u6765\u4e86\u4e00\u4e2aput\u7ebf\u7a0b\uff0c\u53d1\u73b0\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\uff0c\u90a3\u4e48\u5b83\u4f1a\u600e\u4e48\u505a\uff1f \u5f53put\u7ebf\u7a0b\u53d1\u73b0\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\uff0c\u90a3\u4e48\u8868\u793a\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u4e0d\u662fForwardingNode\uff0c\u6b64\u65f6\u6709\u4e24\u79cd\u60c5\u51b5\u53ef\u80fd\u53d1\u751f\uff0c\u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\uff0c\u8fd9\u4e2a\u6876\u6b63\u5728\u88ab\u8fc1\u79fb\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u8282\u70b9\u4e00\u5b9a\u5df2\u7ecf\u88ab\u5176\u4ed6\u6269\u5bb9\u7ebf\u7a0b\u52a0\u4e86\u9501\uff0c\u4e8e\u662f\u8be5put\u7ebf\u7a0b\u963b\u585e\uff1b\u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u6ca1\u6709\u88ab\u52a0\u9501\uff0c\u90a3\u4e48\u8be5put\u7ebf\u7a0b\u4f1a\u52a0\u9501\uff0c\u7136\u540eput\u6210\u529f\uff0c\u5982\u679cput\u7684\u662f\u5df2\u6709value\uff0c\u90a3\u4e48\u5b83\u4e0d\u9700\u8981\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u52a0\u5165\u6269\u5bb9\uff0c\u4f46\u5982\u679cput\u7684\u662f\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u8be5put\u7ebf\u7a0b\u5728put\u6210\u529f\u4e4b\u540e\u4f1a\u52a0\u5165\u6269\u5bb9\u3002</p> <p>\u603b\u7ed3\uff1a\u4e00\u4e2a\u589e\u52a0\u65b0\u8282\u70b9\u7684\u7ebf\u7a0b\u89e6\u53d1\u4e86\u6269\u5bb9\u64cd\u4f5c\uff0c\u7136\u540e\u5f00\u59cb\u8fc1\u79fb\u6876\uff0c\u540e\u9762\u6765\u7684\u5199\u7ebf\u7a0b\u5982\u679c\u6876\u8fd8\u6ca1\u88ab\u8fc1\u79fb\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u8bbe\u7f6e\u6210\u529f\uff0c\u5982\u679c\u8be5\u7ebf\u7a0b\u4e5f\u662f\u65b0\u589e\u8282\u70b9\uff0c\u90a3\u4e48\u4f1a\u8fdb\u884c\u534f\u52a9\u6269\u5bb9\uff0c\u5982\u679c\u8be5\u7ebf\u7a0b\u4e0d\u662f\u65b0\u589e\u8282\u70b9\uff0c\u800c\u662f\u4fee\u6539\u5df2\u6709\u8282\u70b9\u7684value\uff0c\u5219\u4e0d\u4f1a\u8fdb\u884c\u8fdb\u884c\u534f\u52a9\u6269\u5bb9\uff1b\u5982\u679c\u540e\u9762\u6765\u7684\u5199\u7ebf\u7a0b\u7684\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u4e86\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u65b0\u589e\u8282\u70b9\u7684\u7ebf\u7a0b\u8fd8\u662f\u4fee\u6539\u5df2\u6709\u8282\u70b9\u7684value\u7684\u7ebf\u7a0b\uff0c\u90fd\u4f1a\u88ab\u52a0\u5165\u534f\u52a9\u6269\u5bb9\u7684\u5927\u519b\u4e2d\uff0c\u76f4\u5230\u6269\u5bb9\u5b8c\u6bd5\uff0c\u7ebf\u7a0b\u624d\u80fd\u5b8c\u6210\u65b0\u589e\u8282\u70b9\u6216\u8005\u4fee\u6539\u8282\u70b9value\u3002</p> <p>\u6570\u7ec4\u521d\u59cb\u5316 Text Only<pre><code>private final ConcurrentHashMap.Node&lt;K,V&gt;[] initTable() {\n\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt;[] tab; int sc;\n\u00a0\u00a0\u00a0\u00a0// \u7528\u5faa\u73af\u7684\u76ee\u7684\u5c31\u662f\uff0c\u5982\u679c\u6709\u591a\u4e2a\u7ebf\u7a0b\u5728put\u7684\u65f6\u5019\u6570\u7ec4\u90fd\u8fd8\u6ca1\u6709\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7ebf\u7a0b\u90fd\u4f1a\u8fdb\u5165\u8fd9\u91cc\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u7136\u540e\u4e4b\u540e\u7684cas\u64cd\u4f5c\u53ea\u4f1a\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6210\u529f\uff0c\u4e5f\u5c31\u662f\u521d\u59cb\u5316\u64cd\u4f5c\u53ea\u4f1a\u8ba9\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\uff0c\u4f46\u662f\u5269\u4e0b\u7684\u7ebf\u7a0b\n\u00a0\u00a0\u00a0\u00a0// \u8fd8\u4e0d\u80fd\u8df3\u51fa\u8fd9\u4e2a\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u5fc5\u987b\u7b49\u5f85\u521d\u59cb\u5316\u7ebf\u7a0b\u5b8c\u6210\u624d\u53ef\u4ee5\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528while\u5faa\u73af\u8ba9\u5176\u4ed6\u7ebf\u7a0b\n\u00a0\u00a0\u00a0\u00a0// \u8fdb\u884c\u81ea\u65cb\uff0c\u7c7b\u4f3c\u7684\uff0c\u5728ConcurrentHashMap\u91cc\u6709\u5f88\u591a\u5730\u65b9\u90fd\u662f\u4f7f\u7528cas\u64cd\u4f5c+\u5faa\u73af\u7684\u65b9\u5f0f\u5b9e\u73b0\u65e0\u9501\u7684\u5e76\u53d1\u5b89\u5168\u3002\n\u00a0\u00a0\u00a0\u00a0while ((tab = table) == null || tab.length == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//sc\u5c0f\u4e8e0\u7684\u60c5\u51b5\u53ea\u6709sc=-1\uff0c\u4e5f\u5c31\u662f\u4e0b\u9762cas\u64cd\u4f5c\u6210\u529f\u7684\u7ebf\u7a0b\u5c06sc\u8bbe\u7f6e\u4e3a\u4e86-1\uff0c\u8868\u793a\u6b63\u5728\u521d\u59cb\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((sc = sizeCtl) &lt; 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread.yield(); // lost initialization race; just spin\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) { //cas\u64cd\u4f5c\u6210\u529f\u7684\u7ebf\u7a0b\u5c06sc\u8bbe\u7f6e\u4e3a\u4e86-1\uff0c\u8868\u793a\u6b63\u5728\u521d\u59cb\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5176\u4ed6\u6ca1\u6709\u8fdb\u884c\u521d\u59cb\u5316\u7684\u7ebf\u7a0b\u5728\u521d\u59cb\u5316\u7ebf\u7a0b\u9000\u51fa\u540e\uff0c\u540c\u6837\u4f1a\u6210\u529f\u6267\u884ccas\u64cd\u4f5c\uff0c\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u521d\u59cb\u5316\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u91cc\u5fc5\u987b\u8fdb\u884c\u6821\u9a8c\uff0c\u7c7b\u4f3c\u7684\u53cc\u91cd\u6821\u9a8c\u5728ConcurrentHashMap\u91cc\u8fd8\u6709\u5f88\u591a\u5730\u65b9\u6709\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((tab = table) == null || tab.length == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// sizeCtl\u4e3a0\uff0c\u4ee3\u8868\u6570\u7ec4\u672a\u521d\u59cb\u5316\uff0c \u4e14\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\u4e3a16\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// sizeCtl\u4e3a\u6b63\u6570\uff0c\u5982\u679c\u6570\u7ec4\u672a\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u5176\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@SuppressWarnings(\"unchecked\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt;[] nt = (ConcurrentHashMap.Node&lt;K,V&gt;[])new ConcurrentHashMap.Node&lt;?,?&gt;[n];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0table = tab = nt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521d\u59cb\u5316\u5b8c\u6210\uff0csc\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u7684\u6269\u5bb9\u9608\u503c\uff0cn - (n &gt;&gt;&gt; 2)= 3/4 * n = 0.75n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sc = n - (n &gt;&gt;&gt; 2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sizeCtl = sc;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return tab;\n}\n</code></pre></p> <p>addCount\u65b9\u6cd5 put\u65b9\u6cd5\u7684\u6700\u540e\u9700\u8981\u7ef4\u62a4ConcurrentHashMap\u8282\u70b9\u4e2a\u6570\uff0c\u5373\u5c06\u8282\u70b9\u4e2a\u6570\u52a01\uff0caddCount\u5c31\u662f\u8fd9\u4e2a\u529f\u80fd\uff0c\u5e76\u4e14\u52a01\u4e4b\u540e\u8fd8\u4f1a\u68c0\u67e5\u8282\u70b9\u7684\u6570\u91cf\u662f\u5426\u5927\u4e8e\u6269\u5bb9\u9608\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u8fdb\u884c\u6269\u5bb9\u3002 Text Only<pre><code>// \u7ef4\u62a4\u6570\u7ec4\u957f\u5ea6\uff0c\u4e0e\u539f\u5b50\u7d2f\u52a0\u5668LongAdder\u7684\u5b9e\u73b0\u601d\u8def\u4e00\u81f4\uff0c\u5927\u81f4\u6d41\u7a0b\u5c31\u662f\uff1a\n// \u5148\u5b9a\u4e49\u4e00\u4e2abaseCount\u53d8\u91cf\uff0c\u5f53\u7ebf\u7a0b\u6210\u529f\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u4e4b\u540e\uff0c\u9996\u5148\u4f7f\u7528cas\u64cd\u4f5c\u5bf9\u5176\u52a01\uff0c\n// \u5982\u679ccas\u6210\u529f\uff0c\u90a3\u4e07\u4e8b\u5927\u5409\uff0c\u5982\u679ccas\u64cd\u4f5c\u5931\u8d25\uff0c\u8868\u793a\u53d1\u751f\u4e86\u7ade\u4e89\uff0c\u8fd9\u65f6\u8ba9\u7ade\u4e89\u5931\u8d25\u7684\u7ebf\u7a0b\n// \u5bf9CounterCell[]\u6570\u7ec4\u7684\u67d0\u4e2a\u5143\u7d20\uff08\u968f\u4fbf\u4e00\u4e2a\u5143\u7d20\u5c31\u884c\uff09\u4f7f\u7528cas\u64cd\u4f5c\u8fdb\u884c\u52a01\u64cd\u4f5c\uff0c\u5982\u679c\u8fd9\u6837\u8fd8\u53d1\u751f\u4e86\u7ade\u4e89\uff0c\n// \u90a3\u7ade\u4e89\u5931\u8d25\u7684\u7ebf\u7a0b\u4f1a\u5bf9CounterCell[]\u6570\u7ec4\u6269\u5bb9\uff0c\u7136\u540e\u518d\u5bf9CounterCell[]\u6570\u7ec4\u7684\u67d0\u4e2a\u5143\u7d20\u4f7f\u7528cas\u64cd\u4f5c\u8fdb\u884c\u52a01\u64cd\u4f5c\u3002\n// \u5982\u6b64\u4e00\u6765\uff0cConcurrentHashMap\u8282\u70b9\u7684\u6570\u91cf\u7684\u8ba1\u7b97\u8fc7\u7a0b\u5c31\u5e94\u8be5\u662fbaseCount\u52a0\u4e0aCounterCell[]\u6570\u7ec4\u7684\u548c\u3002\nprivate final void addCount(long x, int check) {\n\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.CounterCell[] cs;\n\u00a0\u00a0\u00a0\u00a0long b, s;\n\u00a0\u00a0\u00a0\u00a0if ((cs = counterCells) != null ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4f7f\u7528cas\u64cd\u4f5c\u5bf9baseCount\u52a01\uff0c\u5982\u679ccas\u6210\u529f\uff0c\u90a3\u4e07\u4e8b\u5927\u5409\uff0c\u4e0d\u8fdb\u5165if\u5185\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0!U.compareAndSetLong(this, BASECOUNT, b = baseCount, s = b + x)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.CounterCell c;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int m;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean uncontended = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5230\u8fd9\u91cc\u8868\u793a\u5bf9baseCount\u7684cas\u64cd\u4f5c\u5931\u8d25\u4e86\uff0c\u53d1\u751f\u4e86\u7ade\u4e89\uff0c\u7ade\u4e89\u5931\u8d25\u7684\u7ebf\u7a0b\u9700\u8981\u5bf9CounterCell[]\u6570\u7ec4\u7684\u67d0\u4e2a\u5143\u7d20\u52a01\uff0c\n\u00a0 \u00a0 \u00a0 \u00a0 //\u00a0cs == null\uff0c\u5982\u679cCounterCell[]\u6570\u7ec4\u8fd8\u6ca1\u6709\u521d\u59cb\u5316\uff0c\u90a3\u76f4\u63a5\u521d\u59cb\u5316\uff1b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u5df2\u7ecf\u521d\u59cb\u5316\u4e86\uff0c\u4f46\u662f\u5bf9CounterCell[]\u6570\u7ec4\u7684\u67d0\u4e2a\u5143\u7d20\u4f7f\u7528cas\u64cd\u4f5c\u8fdb\u884c\u52a01\u53c8\u53d1\u751f\u4e86\u7ade\u4e89\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u90a3\u7ade\u4e89\u5931\u8d25\u7684\u7ebf\u7a0b\u4f1a\u5bf9CounterCell[]\u6570\u7ec4\u8fdb\u884c\u521d\u59cb\u5316\u6216\u8005\u6269\u5bb9\uff0cfullAddCount\u5c31\u662f\u521d\u59cb\u5316\u6216\u8005\u6269\u5bb9\u7684\u65b9\u6cd5\n\u00a0 \u00a0 \u00a0 \u00a0 if (cs == null || (m = cs.length - 1) &lt; 0 ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(c = cs[ThreadLocalRandom.getProbe() &amp; m]) == null ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0!(uncontended =\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 //\u52a01\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0U.compareAndSetLong(c, CELLVALUE, v = c.value, v + x))) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u521d\u59cb\u5316\u6216\u8005\u6269\u5bb9`\n `**fullAddCount(x, uncontended);**`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//check\u4f20\u7684\u662fbinCount\uff0c\u94fe\u8868\u548c\u6811\u90fd\u4f1a\u5927\u4e8e1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (check &lt;= 1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0s = sumCount(); //\u8ba1\u7b97ConcurrentHashMap\u8282\u70b9\u7684\u6570\u91cf\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0// \u5bf9ConcurrentHashMap\u8282\u70b9\u7684\u6570\u91cf\u52a01\u4e4b\u540e\u5c31\u9700\u8981\u68c0\u67e5\u8282\u70b9\u7684\u6570\u91cf\u662f\u5426\u5927\u4e8e\u6269\u5bb9\u9608\u503c\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u8fdb\u884c\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0if (check &gt;= 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K, V&gt;[] tab, nt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int n, sc;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8282\u70b9\u6570\u91cf\u5927\u4e8e\u6269\u5bb9\u9608\u503csizeCtl\uff0c\u5e76\u4e14 (tab = table) != null\u6570\u7ec4\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5e76\u4e14(n = tab.length) &lt; MAXIMUM_CAPACITY \u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e\u6700\u5927\u957f\u5ea6\uff0c\u90a3\u4e48\u8fdb\u884c\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6b7b\u5faa\u73af\u7684\u4f5c\u7528\u662f\uff0c\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u53c2\u52a0\u5b8c\u4e00\u8f6e\u6269\u5bb9\u4e4b\u540e\uff0c\u68c0\u67e5\u53d1\u73b0\u4ecd\u7136\u6ee1\u8db3\u6269\u5bb9\u6761\u4ef6\uff0c\u90a3\u4e48\u5f53\u524d\u7ebf\u7a0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u7ee7\u7eed\u52a0\u5165\u6269\u5bb9\u5927\u519b\uff0c\u6211\u611f\u89c9\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (s &gt;= (long) (sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(n = tab.length) &lt; MAXIMUM_CAPACITY) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6269\u5bb9\u7b2c\u4e00\u6b65\u5c31\u662f\u8981\u7ed9sizeCtl\u8bbe\u7f6e\u4e00\u4e2a\u5c0f\u4e8e-1\u7684\u8d1f\u6570\uff0c\u8868\u793a\u6709\u7ebf\u7a0b\u6b63\u5728\u6269\u5bb9\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u91cc\u7684rs=-242626568\u662f\u4e00\u4e2a\u57fa\u6570\uff0c\u4e4b\u540e\u6bcf\u589e\u52a0\u4e00\u4e2a\u6269\u5bb9\u7ebf\u7a0b\uff0c\u5c31\u4f1a\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int rs = resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (sc &lt; 0) { //sc &lt; 0\u8868\u793a\u6b63\u5728\u8fdb\u884c\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6269\u5bb9\u5df2\u7ecf\u7ed3\u675f\uff0c\u76f4\u63a5break\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (sc == rs + MAX_RESIZERS || sc == rs + 1 ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(nt = nextTable) == null || transferIndex &lt;= 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6269\u5bb9\u6ca1\u6709\u7ed3\u675f\uff0c\u90a3\u4e48\u5f53\u524d\u7ebf\u7a0b\u52a0\u5165\u5230\u6269\u5bb9\u5927\u519b\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (U.compareAndSetInt(this, SIZECTL, sc, sc + 1))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0**transfer(tab, nt);**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (U.compareAndSetInt(this, SIZECTL, sc, rs + 2))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0**transfer(tab, null);** //\u5982\u679c\u4e0d\u662f\u6b63\u5728\u6269\u5bb9\uff0c\u90a3\u4e48\u5f53\u524d\u7ebf\u7a0b\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u6269\u5bb9\uff0csizeCtl\u7684\u521d\u503c\u4e3ars + 2\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0s = sumCount();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>fullAddCount\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\uff0c\u5bf9CounterCell[]\u521d\u59cb\u5316\u6216\u8005\u6269\u5bb9\uff0c\u5e76\u5b8c\u6210\u52a01\u7684\u64cd\u4f5c\u3002 Text Only<pre><code>// CounterCell[]\u521d\u59cb\u5316\u6216\u8005\u6269\u5bb9\uff0c\u5e76\u5b8c\u6210\u52a01\u7684\u64cd\u4f5c\uff0c\n// wasUncontended\u8868\u793a\u662f\u5426\u6ca1\u6709\u53d1\u751f\u7ade\u4e89\uff0c\u4f20\u8fdb\u6765\u7684\u53c2\u4e00\u5b9a\u662ffalse\uff0c\u5373\u6709\u53d1\u751f\u7ade\u4e89\nprivate final void fullAddCount(long x, boolean wasUncontended) {\n\u00a0\u00a0\u00a0\u00a0int h;\n\u00a0\u00a0\u00a0\u00a0//\u5c31\u662f\u7ed9h\u968f\u4fbf\u8d4b\u4e2a\u503c\n\u00a0\u00a0\u00a0\u00a0if ((h = ThreadLocalRandom.getProbe()) == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ThreadLocalRandom.localInit();\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// force initialization\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0h = ThreadLocalRandom.getProbe();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wasUncontended = true;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0boolean collide = false;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// True if last slot nonempty\n\u00a0\u00a0\u00a0\u00a0for (;;) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.CounterCell[] cs; ConcurrentHashMap.CounterCell c; int n; long v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679cCounterCell[]\u5df2\u88ab\u521d\u59cb\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((cs = counterCells) != null &amp;&amp; (n = cs.length) &gt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u627e\u7684\u4f4d\u7f6e\u4e3anull\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((c = cs[(n - 1) &amp; h]) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5c1d\u8bd5new\u4e00\u4e2a\uff0ccellsBusy\u5c31\u662f\u4e00\u4e2a\u4e0a\u9501\u6807\u5fd7\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (cellsBusy == 0) {\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Try to attach new Cell\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.CounterCell r = new ConcurrentHashMap.CounterCell(x); // Optimistic create\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//new CounterCell\u4f1a\u9501\u4f4f\u6574\u4e2aCounterCell[]\uff0c\u4e0d\u51c6\u540e\u9762\u7684\u7ebf\u7a0bnew\uff0c\u4f46\u662f\u53ef\u4ee5\u5bf9CounterCell[]\u4e2d\u5df2\u6709\u7684\u5143\u7d20\u8fdb\u884c\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53ef\u80fd\u4f60\u5728\u60f3\u4e3a\u4ec0\u4e48\u4e0d\u53ea\u9501\u4f4f\u8fd9\u4e2a\u5373\u5c06new CounterCell\u7684slot\uff0c\u8ba9\u5176\u4ed6\u7a7aslot\u4e5f\u53ef\u4ee5new\uff0c\u5bf9\u4e0d\u8d77\u505a\u4e0d\u5230\uff0c\u90a3\u6837\u592a\u590d\u6742\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (cellsBusy == 0 &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0U.compareAndSetInt(this, CELLSBUSY, 0, 1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean created = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Recheck under lock\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.CounterCell[] rs; int m, j;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53cc\u91cd\u68c0\u67e5\uff0c\u56e0\u4e3a\u540e\u9762\u6765\u7684\u7ebf\u7a0b\u4e5f\u53ef\u80fd\u9009\u4e2d\u4e86\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u5e76\u4e14\u8fdb\u884c\u7b2c\u4e8c\u4e2aif\u5224\u65ad\u65f6\u8fd9\u4e2a\u7ebf\u7a0b\u8fd8\u6ca1\u8d4b\u4e0a\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((rs = counterCells) != null &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(m = rs.length) &gt; 0 &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rs[j = (m - 1) &amp; h] == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rs[j] = r;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0created = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cellsBusy = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (created)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0continue;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Slot is now non-empty\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0collide = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (!wasUncontended)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// CAS already known to fail\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wasUncontended = true;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Continue after rehash\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u627e\u7684\u4f4d\u7f6e\u4e0d\u4e3anull\uff0c\u76f4\u63a5cas\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (U.compareAndSetLong(c, CELLVALUE, v = c.value, v + x))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (counterCells != cs || n &gt;= NCPU) //\u53d8\u91cfcollide\u7684\u4f5c\u7528\u6709\u4e24\u4e2a\uff0c\u4e00\u662f\u5982\u679cCAS\u975e\u7a7acell\u5931\u8d25\u4e86\u4e00\u6b21\uff0c\u90a3\u4e48\u518d\u7ee7\u7eed\u91cd\u8bd5\u4e00\u6b21\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8d70\u6269\u5bb9\uff0c\u4e8c\u662f\u5982\u679ccounterCells\u7684\u957f\u5ea6\u5927\u4e8eCPU\u7684\u6838\u5fc3\u6570\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u518d\u5bf9CounterCell[]\u8fdb\u884c\u6269\u5bb9\u4e86\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0collide = false;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// At max size or stale\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (!collide)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0collide = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u9009\u4e2d\u540c\u4e00\u4e2aCounterCell\uff0c\u5e76\u4e14\u8fd8\u53d1\u751f\u7ade\u4e89\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bf9CounterCell[]\u8fdb\u884c\u6269\u5bb9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (cellsBusy == 0 &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0U.compareAndSetInt(this, CELLSBUSY, 0, 1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6269\u5bb9\uff0c\u6269\u5bb9\u7684\u65f6\u5019\u53ef\u4ee5\u5bf9\u5176\u4e2d\u7684CounterCell\u52a01\uff0c\u56e0\u4e3aCounterCell[]\u4e2d\u5b58\u7684\u662f\u6307\u5411CounterCell\u7684\u5f15\u7528\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u5bf9\u8c61\uff0c\u5e76\u53d1\u64cd\u4f5c\u4e92\u4e0d\u5f71\u54cd\uff0c\u5982\u679c\u60f3new\u4e00\u4e2aCounterCell\u52a0\u5165\u5230CounterCell[]\u624d\u4f1a\u5e76\u53d1\u51b2\u7a81\uff0c\u8fd9\u5c31\u662f\u8bbe\u7f6ecellsBusy\u53d8\u91cf\u7684\u539f\u56e0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (counterCells == cs) // Expand table unless stale\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0counterCells = Arrays.copyOf(cs, n &lt;&lt; 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cellsBusy = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0collide = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0continue;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Retry with expanded table\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0h = ThreadLocalRandom.advanceProbe(h);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679cCounterCell[]\u8fd8\u6ca1\u6709\u88ab\u521d\u59cb\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (cellsBusy == 0 &amp;&amp; counterCells == cs &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0U.compareAndSetInt(this, CELLSBUSY, 0, 1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean init = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Initialize table\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53cc\u91cd\u6821\u9a8c\uff0c\u56e0\u4e3a\u540e\u9762\u9700\u8981\u6539\u53d8counterCells\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (counterCells == cs) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521d\u59cb\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.CounterCell[] rs = new ConcurrentHashMap.CounterCell[2];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u52a01\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rs[h &amp; 1] = new ConcurrentHashMap.CounterCell(x);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0counterCells = rs;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0init = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cellsBusy = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (init)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521d\u59cb\u5316CounterCell[]\u65f6\u51fa\u73b0\u4e86\u7ade\u4e89\uff0c\u7ade\u4e89\u5931\u8d25\u7684\u7ebf\u7a0b\u4f1a\u5230\u8fd9\u91cc\u6765\uff0c\u76f4\u63a5\u5bf9baseCount\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (U.compareAndSetLong(this, BASECOUNT, v = baseCount, v + x))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Fall back on using base\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>ConcurrentHashMap\u7ef4\u62a4size\u7684\u6d41\u7a0b\u6982\u8ff0\uff1a \u6570\u636e\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a </p> <ol> <li>\u5982\u679cCounterCell[]\u6570\u7ec4\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u4e48\u76f4\u63a5\u5bf9CounterCell[]\u6570\u7ec4\u4e2d\u67d0\u4e2a\u5143\u7d20\uff08\u968f\u673a\u7684\uff09\u505a\u52a01\u7684cas\u64cd\u4f5c</li> <li>\u5982\u679cCounterCell[]\u6570\u7ec4\u4e3a\u7a7a\uff0c\u90a3\u76f4\u63a5\u5bf9baseCount\u505a\u52a01\u7684cas\u64cd\u4f5c\uff0c\u5982\u679c\u6210\u529f\u5c31\u8fd4\u56de\uff0c\u5982\u679c\u5931\u8d25\u90a3\u4e48\u5bf9CounterCell[]\u6570\u7ec4\u4e2d\u67d0\u4e2a\u5143\u7d20\uff08\u968f\u673a\u7684\uff09\u505a\u52a01\u7684cas\u64cd\u4f5c</li> </ol> <p>\u5bf9CounterCell[]\u6570\u7ec4\u4e2d\u67d0\u4e2a\u5143\u7d20\u505a\u52a01\u7684cas\u64cd\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5982\u679cCounterCell[]\u6570\u7ec4\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u968f\u673a\u627e\u4e00\u4e2a\u5143\u7d20\u52a01\uff0c\u5982\u679c\u6539\u5143\u7d20\u4e3anull\uff0c\u90a3\u5148new\u4e00\u4e2a\u5143\u7d20\uff0c\u7136\u540e\u81ea\u65cb\u52a01\uff0c\u5982\u679c\u52a01\u5931\u8d25\uff0c\u90a3\u5c31\u518d\u81ea\u65cb\u91cd\u8bd5\u4e00\u6b21\uff0c\u5982\u679c\u518d\u6b21\u5931\u8d25\u5219\u5224\u65adCounterCell[]\u957f\u5ea6\u662f\u5426\u5927\u4e8eCPU\u6838\u5fc3\u6570\uff0c\u5982\u679c\u5c0f\u4e8e\u5219\u5c06CounterCell[]\u6570\u7ec4\u6269\u5bb9\u4e3a\u539f\u6765\u4e24\u500d\uff0c\u5426\u5219\u4e00\u76f4\u81ea\u65cb\u91cd\u8bd5</p> </li> <li> <p>\u5982\u679cCounterCell[]\u6570\u7ec4\u4e3a\u7a7a\uff0c\u5219\u521d\u59cb\u5316CounterCell[]\u6570\u7ec4\uff0c\u7136\u540e\u968f\u673a\u627e\u4e00\u4e2a\u5143\u7d20\u52a01</p> </li> <li> <p>\u5982\u679c\u7ade\u4e89\u521d\u59cb\u5316CounterCell[]\u6570\u7ec4\u5931\u8d25\uff0c\u90a3\u5c31\u5bf9baseCount\u505a\u52a01\u7684cas\u64cd\u4f5c\u3002</p> </li> </ol> <p>\u9700\u8981\u6ce8\u610f\u4e24\u70b9\uff1a 1.\u4e3a\u4ec0\u4e48\u52a01\u64cd\u4f5c\u90fd\u8981\u8fd9\u4e48\u9ebb\u70e6\uff0c\u56e0\u4e3a\u60f3\u9ad8\u6548\u7684\u5b9e\u73b0\u591a\u4e2a\u7ebf\u7a0b\u7684\u5e76\u53d1\u5199\uff0c\u4e0d\u540c\u7ebf\u7a0b\u5bf9\u591a\u4e2a\u4e0d\u540c\u7684\u5bf9\u8c61\u6267\u884c\u52a01\u7684cas\u64cd\u4f5c\u66f4\u52a0\u4e0d\u5bb9\u6613\u5931\u8d25 2.CounterCell[]\u6570\u7ec4\u5728\u6269\u5bb9\u65f6\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u5bf9\u5df2\u6709\u7684CounterCell\u505a\u52a01\u7684cas\u64cd\u4f5c\uff0c\u4f46\u662f\u4e0d\u80fdnew\u4e00\u4e2aCounterCell\u52a0\u5165\u5230CounterCell[]\u6570\u7ec4\u4e2d\uff0c\u56e0\u4e3a\u524d\u8005\u662f\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u5bf9\u8c61\u4e2d\u5b8c\u6210\uff0c\u540e\u8005\u662f\u591a\u4e2a\u7ebf\u7a0b\u5728\u4fee\u6539\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p> <p>size\u65b9\u6cd5\uff0c\u7528\u4e8e\u8ba1\u7b97ConcurrentHashMap\u8282\u70b9\u7684\u6570\u91cf\uff0c\u8ba1\u7b97\u8fc7\u7a0b\u5c31\u5e94\u8be5\u662fbaseCount\u52a0\u4e0aCounterCell[]\u6570\u7ec4\u7684\u548c\u3002 Text Only<pre><code>public int size() {\n\u00a0\u00a0\u00a0\u00a0long n = sumCount();\n\u00a0\u00a0\u00a0\u00a0return ((n &lt; 0L) ? 0 :\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(int)n);\n}\n</code></pre> Text Only<pre><code>final long sumCount() {\n\u00a0\u00a0\u00a0\u00a0CounterCell[] cs = counterCells;\n\u00a0\u00a0\u00a0\u00a0long sum = baseCount;\n\u00a0\u00a0\u00a0\u00a0if (cs != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (CounterCell c : cs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (c != null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum += c.value;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return sum;\n}\n</code></pre></p> <p>transfer\u65b9\u6cd5\uff0c\u6269\u5bb9\u65b9\u6cd5\u7684\u5b9e\u73b0 Text Only<pre><code>// \u6269\u5bb9\uff0c\u53c2\u6570tab\u662f\u65e7\u7684hash\u8868\uff0cnextTab\u662f\u5373\u5c06\u8981\u8fc1\u79fb\u5230\u7684\u65b0hash\u8868\uff0c\u8fc1\u79fb\u5b8c\u6210\u4e4b\u540e\u4f1a\u5c06nextTab\u8d4b\u7ed9table\uff0c\u7136\u540enextTable\u7f6e\u4e3anull\n// \uff08\u7c7b\u4f3csc\u662f\u6210\u5458\u53d8\u91cfsizeCtl\u7684\u5c40\u90e8\u53d8\u91cf\u526f\u672c\uff0ctab\u662f\u6210\u5458\u53d8\u91cftable\u7684\u5c40\u90e8\u53d8\u91cf\u526f\u672c\uff0cnextTab\u662f\u6210\u5458\u53d8\u91cfnextTable\u7684\u5c40\u90e8\u53d8\u91cf\u526f\u672c\uff09\nprivate final void transfer(ConcurrentHashMap.Node&lt;K,V&gt;[] tab, ConcurrentHashMap.Node&lt;K,V&gt;[] nextTab) {\n\u00a0\u00a0\u00a0\u00a0int n = tab.length, stride;\n\u00a0\u00a0\u00a0\u00a0// \u8ba1\u7b97\u6b65\u957fstride\uff0c\u6bcf\u4e2a\u6269\u5bb9\u7ebf\u7a0b\u6bcf\u6b21\u90fd\u662f\u9886\u53d6\u6570\u7ec4\u7684\u4e00\u4e2a\u6b65\u957f\u957f\u5ea6\u4f5c\u4e3a\u4e00\u6b21\u8fc1\u79fb\u4efb\u52a1\uff0c\u672c\u6b21\u8fc1\u79fb\u4efb\u52a1\u5b8c\u6210\u4e4b\u540e\uff0c\u518d\u9886\u53d6\u4e0b\u4e00\u6b21\u7684\u8fc1\u79fb\u4efb\u52a1\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u82e5cpu\u662f\u5355\u6838\uff0c\u5373NCPU=1\uff0c\u90a3\u4e48stride\u5c31\u7b49\u4e8e\u6574\u4e2a\u6570\u7ec4\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u53ea\u7528\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u6574\u4e2amap\u7684\u8fc1\u79fb\uff0c\u5426\u5219\u901a\u8fc7cpu\u6838\u6570\u4e0e\u6570\u7ec4\u957f\u5ea6\u4e00\u8d77\u8ba1\u7b97\u51fastride\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u82e5\u6b65\u957f\u5c0f\u4e8e\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f\n\u00a0\u00a0\u00a0\u00a0if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0stride = MIN_TRANSFER_STRIDE; // subdivide range\n\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u65b0\u6570\u7ec4\u8fd8\u6ca1\u6709\u88ab\u521d\u59cb\u5316\uff0c\u90a3\u5c31\u5148\u8fdb\u884c\u521d\u59cb\u5316\n\u00a0\u00a0\u00a0\u00a0if (nextTab == null) {\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// initiating\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@SuppressWarnings(\"unchecked\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt;[] nt = (ConcurrentHashMap.Node&lt;K,V&gt;[])new ConcurrentHashMap.Node&lt;?,?&gt;[n &lt;&lt; 1];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nextTab = nt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Throwable ex) {\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// try to cope with OOME\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sizeCtl = Integer.MAX_VALUE;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5c06\u521d\u59cb\u5316\u597d\u7684\u65b0\u6570\u7ec4\u8d4b\u7ed9\u6210\u5458\u53d8\u91cfnextTable\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nextTable = nextTab;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6210\u5458\u53d8\u91cftransferIndex\u6307\u793a\u7740\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u7684\u6570\u7ec4\u6700\u5927\u4e0b\u6807\uff0c\u5373\u4e0b\u4e00\u6b21\u8fc1\u79fb\u4efb\u52a1\u4f1a\u4ece\u8fd9\u91cc\u5f00\u59cb\u9886\u53d6\u4e00\u4e2a\u6b65\u957f\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6bcf\u6b21\u7684\u8fc1\u79fb\u4efb\u52a1\u90fd\u662f\u4ece\u53f3\u5f80\u5de6\u5206\u914d\u4e00\u4e2a\u6b65\u957f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0transferIndex = n;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0int nextn = nextTab.length;\n\u00a0\u00a0\u00a0\u00a0//\u65b0\u5efa\u4e00\u4e2aForwarding\u8282\u70b9\uff0cForwardingNode\u6709\u4e2a\u6210\u5458\u53d8\u91cfnextTable\uff0c\u540c\u6837\u6307\u5411\u65b0\u7684\u8fd8\u672a\u8fc1\u79fb\u5b8c\u7684\u6570\u7ec4\n\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.ForwardingNode&lt;K,V&gt; fwd = new ConcurrentHashMap.ForwardingNode&lt;K,V&gt;(nextTab);\n\u00a0\u00a0\u00a0\u00a0boolean advance = true; //\u6807\u8bc6\u8fc1\u79fb\u7ebf\u7a0b\u662f\u5426\u7ee7\u7eed--i\n\u00a0\u00a0\u00a0\u00a0//\u6807\u8bc6\u8fc1\u79fb\u662f\u5426\u7ed3\u675f\uff0c\u8fd9\u4e2a\u53d8\u91cf\u7684\u4e3b\u8981\u4f5c\u7528\u662f\uff0c\u63a7\u5236\u6700\u540e\u4e00\u4e2a\u5b8c\u6210\u8fc1\u79fb\u7684\u7ebf\u7a0b\u5728\u5373\u5c06\u9000\u51fa\u8fc1\u79fb\u65f6\u505a\u4e00\u6b21\u6574\u4e2a\u6570\u7ec4\u7684\u626b\u63cf\uff0c\u4ee5\u514d\u51fa\u73b0\u6709\u672a\u88ab\u8fc1\u79fb\u7684\u6876\n\u00a0\u00a0\u00a0\u00a0boolean finishing = false; // to ensure sweep before committing nextTab\n\u00a0\u00a0\u00a0\u00a0//i\u6307\u793a\u7740\u7ebf\u7a0b\u6b63\u5728\u5904\u7406\u7684\u6876\uff0cbound\u6307\u793a\u672c\u6b21\u8fc1\u79fb\u4efb\u52a1\u7684\u4e0b\u754c\n\u00a0\u00a0\u00a0\u00a0for (int i = 0, bound = 0;;) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt; f; int fh;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (advance) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int nextIndex, nextBound;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u672a\u5230\u672c\u6b21\u8fc1\u79fb\u4efb\u52a1\u7684\u4e0b\u754c\uff0c\u5c31--i\u7ee7\u7eed\u505a\u8fc1\u79fb\u52a8\u4f5c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (--i &gt;= bound || finishing) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//transferIndex=0\u8868\u793a\u6574\u4e2a\u6570\u7ec4\u5212\u5206\u7684\u8fc1\u79fb\u4efb\u52a1\u90fd\u88ab\u9886\u53d6\u5b8c\u4e86\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6240\u4ee5\u5982\u679ci&lt;bound\u5e76\u4e14transferIndex=0\uff0c\u4e5f\u5c31\u8868\u793a\u5f53\u524d\u7ebf\u7a0b\u4e0d\u5fc5\u518d\u9886\u53d6\u8fc1\u79fb\u4efb\u52a1\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if ((nextIndex = transferIndex) &lt;= 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0i = -1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7ebf\u7a0b\u5728\u8fd9\u91cc\u9886\u53d6\u4e00\u4e2a\u8fc1\u79fb\u4efb\u52a1\uff0c\u6bd4\u5982\u5f53\u524d\u5c31\u6570\u7ec4\u957f\u5ea6\u662f64\uff0c\u90a3\u4e48transferIndex=64\uff0c\u4e8e\u662fbound=64-16=48\uff0ci=63\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e5f\u5373\u7ebf\u7a0b\u672c\u6b21\u7684\u8fc1\u79fb\u4efb\u52a1\u662f\u6570\u7ec4\u7684[48,63]\u8fd916\u4e2a\u6876\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (U.compareAndSetInt\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(this, TRANSFERINDEX, nextIndex,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nextBound = (nextIndex &gt; stride ?\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nextIndex - stride : 0))) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0bound = nextBound;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0i = nextIndex - 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// i&lt;0\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662ftransferIndex=0\u5e76\u4e14\u5f53\u524d\u7ebf\u7a0b\u4ee5\u5df2\u7ecf\u5b8c\u6210\u672c\u6b21\u8fc1\u79fb\u4efb\u52a1\u7684\u65f6\u5019\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e5f\u5c31\u662f\u6574\u4e2a\u6570\u7ec4\u5212\u5206\u7684\u8fc1\u79fb\u4efb\u52a1\u90fd\u88ab\u9886\u53d6\u5b8c\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sc;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (finishing) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nextTable = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0table = nextTab;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5f53\u524d\u7ebf\u7a0b\u4ee5\u5df2\u7ecf\u5b8c\u6210\u672c\u6b21\u8fc1\u79fb\u4efb\u52a1\u5e76\u4e14\u6ca1\u6709\u53ef\u9886\u53d6\u7684\u8fc1\u79fb\u4efb\u52a1\uff0c\u9700\u8981\u9000\u51fa\u8fc1\u79fb\uff0c\u9000\u51fa\u524dsc - 1\uff0c\u8868\u793a\u6b63\u5728\u6269\u5bb9\u7684\u7ebf\u7a0b\u6570\u91cf-1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (U.compareAndSetInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e0d\u7b49\u53f7\u6210\u7acb\u8868\u793a\u5f53\u524d\u7ebf\u7a0b\u5e76\u4e0d\u662f\u6700\u540e\u9000\u51fa\u8fc1\u79fb\u7684\u7ebf\u7a0b\uff0c\u6240\u4ee5\u4e4b\u524d\u8fd4\u56de\u5373\u53ef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u80fd\u8d70\u5230\u8fd9\u91cc\uff0c\u8868\u793a\u5f53\u524d\u7ebf\u7a0b\u5c31\u662f\u6700\u540e\u4e00\u4e2a\u9000\u51fa\u8fc1\u79fb\u7684\u7ebf\u7a0b\uff0c\u6240\u4ee5\u7f6efinishing=true\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0finishing = advance = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//i=n\u5c31\u662f\u8ba9\u6700\u540e\u9000\u51fa\u8fc1\u79fb\u7684\u4efb\u52a1\u91cd\u65b0\u68c0\u67e5\u4e00\u904d\u6570\u7ec4\uff0c\u4ee5\u514d\u51fa\u73b0\u9057\u6f0f\u7684\u8fdd\u80cc\u8fc1\u79fb\u7684\u6876\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0i = n; // recheck before commit\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6b63\u51c6\u5907\u8fc1\u79fb\u7684\u6876\u4e3anull\uff0c\u76f4\u63a5\u5c06forwarding\u8282\u70b9\u8bbe\u7f6e\u5230\u5f53\u524d\u6876\u5373\u53ef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if ((f = tabAt(tab, i)) == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = casTabAt(tab, i, null, fwd);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684hash\u503c\u4e3aMOVED\u8868\u793a\u5f53\u524d\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\uff0c\u6240\u4ee5\u9700\u8981\u76f4\u63a5\u68c0\u67e5\u4e0b\u4e00\u4e2a\u6876\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u4e2aif\u6761\u4ef6\u53ea\u5728\u6700\u540e\u4e00\u4e2a\u7ebf\u7a0b\u9000\u51fa\u65f6\u68c0\u67e5\u6574\u4e2a\u6570\u7ec4\u65f6\u6210\u7acb\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if ((fh = f.hash) == MOVED)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = true; // already processed\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else { //\u8fdb\u5230\u8fd9\u91cc\u8868\u793a\u9700\u8981\u5bf9\u6876\u4e2d\u7684\u94fe\u8868\u6216\u8005\u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u8fdb\u884c\u8fc1\u79fb\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (f) { //\u9501\u4f4f\u94fe\u8868\u6216\u8005\u6811\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u4ee5\u514d\u5176\u4ed6put\u7ebf\u7a0b\u5728\u8be5\u6876\u4e0a\u63d2\u5165\u6216\u4fee\u6539\u8282\u70b9\uff0c\uff08\u4e0d\u4f1a\u5bfc\u81f4\u5176\u4ed6\u6269\u5bb9\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u9886\u53d6\u5230\u7684\u4efb\u52a1\u90fd\u662f\u4e0d\u540c\u7684\u8303\u56f4\uff09\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (tabAt(tab, i) == f) { //double check\u4e00\u4e0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt; ln, hn;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// \u4e0b\u9762\u8fdb\u884c\u94fe\u8868\u6216\u6811\u7684\u8fc1\u79fb\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff0c\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u6bcf\u4e2a\u8282\u70b9\u8fdb\u884c\u590d\u5236\uff0c\u4e5f\u5c31\u662f\u65b0Map\u4e2d\u7684\u8282\u70b9\u90fd\u662fnew\u51fa\u6765\u7684\uff0c`\n `// \u5e76\u4e0d\u53ea\u662f\u5c06\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u590d\u5236\u5230\u4e86\u65b0\u6570\u7ec4\uff0c\u8fd9\u4e48\u505a\u7684\u539f\u56e0\u5c31\u662f\u786e\u4fdd\u8bfb\u5199\u53ef\u4ee5\u5e76\u53d1\uff0c\u5373\u5199\u65f6\u590d\u5236\u7684\u601d\u60f3\uff0c\u4fdd\u8bc1\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u8bfb\u4e0d\u53d7\u5f71\u54cd`\n `// \u8fc1\u79fb\u5b8c\u4e4b\u540e\u4f1a\u5c06forwarding\u8282\u70b9\u8bbe\u7f6e\u5230\u65e7\u6876\u4e0a\uff0c\u4e4b\u540e\u7684\u8bfb\u4f1a\u88ab\u8f6c\u53d1\u5230\u65b0\u6570\u7ec4\u4e0a\u8fdb\u884c`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (fh &gt;= 0) { //\u5982\u679c\u662f\u94fe\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int runBit = fh &amp; n;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt; lastRun = f;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConcurrentHashMap.Node&lt;K,V&gt; p = f.next; p != null; p = p.next) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int b = p.hash &amp; n;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (b != runBit) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0runBit = b;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lastRun = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (runBit == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ln = lastRun;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hn = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hn = lastRun;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ln = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConcurrentHashMap.Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int ph = p.hash; K pk = p.key; V pv = p.val;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((ph &amp; n) == 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ln = new ConcurrentHashMap.Node&lt;K,V&gt;(ph, pk, pv, ln);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hn = new ConcurrentHashMap.Node&lt;K,V&gt;(ph, pk, pv, hn);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setTabAt(nextTab, i, ln);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setTabAt(nextTab, i + n, hn);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setTabAt(tab, i, fwd); //\u5c06forwarding\u8282\u70b9\u8bbe\u7f6e\u5230\u65e7\u6876\u4e0a\uff0c\u4e4b\u540e\u7684\u8bfb\u4f1a\u88ab\u8f6c\u53d1\u5230\u65b0\u6570\u7ec4\u4e0a\u8fdb\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (f instanceof ConcurrentHashMap.TreeBin) { //\u5982\u679c\u5df2\u7ecf\u6811\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.TreeBin&lt;K,V&gt; t = (ConcurrentHashMap.TreeBin&lt;K,V&gt;)f;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.TreeNode&lt;K,V&gt; lo = null, loTail = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.TreeNode&lt;K,V&gt; hi = null, hiTail = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int lc = 0, hc = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConcurrentHashMap.Node&lt;K,V&gt; e = t.first; e != null; e = e.next) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int h = e.hash;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.TreeNode&lt;K,V&gt; p = new ConcurrentHashMap.TreeNode&lt;K,V&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(h, e.key, e.val, null, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((h &amp; n) == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((p.prev = loTail) == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lo = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loTail.next = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0loTail = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0++lc;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((p.prev = hiTail) == null)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hi = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hiTail.next = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hiTail = p;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0++hc;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(hc != 0) ? new ConcurrentHashMap.TreeBin&lt;K,V&gt;(lo) : t;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(lc != 0) ? new ConcurrentHashMap.TreeBin&lt;K,V&gt;(hi) : t;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setTabAt(nextTab, i, ln);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setTabAt(nextTab, i + n, hn);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setTabAt(tab, i, fwd); //\u5c06forwarding\u8282\u70b9\u8bbe\u7f6e\u5230\u65e7\u6876\u4e0a\uff0c\u4e4b\u540e\u7684\u8bfb\u4f1a\u88ab\u8f6c\u53d1\u5230\u65b0\u6570\u7ec4\u4e0a\u8fdb\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0advance = true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (f instanceof ConcurrentHashMap.ReservationNode)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalStateException(\"Recursive update\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>helpTransfer\u65b9\u6cd5\uff0c \u534f\u52a9\u6269\u5bb9\u65b9\u6cd5\uff0cput\u7ebf\u7a0b\u5bf9key\u505a\u5b8chash\u53d6\u4f59\u64cd\u4f5c\u540e\uff0c\u53d1\u73b0\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u4e5f\u4f1a\u53c2\u4e0e\u6269\u5bb9\uff0c\u597d\u5904\u662f\u63d0\u9ad8\u5e76\u53d1\uff0c\u4ee5\u4fbf\u5feb\u901f\u5b8c\u6210\u6269\u5bb9\uff0c\u53ea\u6709\u5b8c\u6210\u6269\u5bb9\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u624d\u80fd\u5c06\u503cput\u6210\u529f\u3002 Text Only<pre><code>// \u534f\u52a9\u6269\u5bb9\u65b9\u6cd5\uff0c\u5f53put\u7ebf\u7a0b\u5bf9key\u505a\u5b8chash\u53d6\u4f59\u64cd\u4f5c\u540e\uff0c\u53d1\u73b0\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u4e5f\u4f1a\u53c2\u4e0e\u6269\u5bb9\uff0c\u597d\u5904\u662f\u63d0\u9ad8\u5e76\u53d1\uff0c\u4ee5\u4fbf\u5feb\u901f\u5b8c\u6210\u6269\u5bb9\uff0c\n// \u53ea\u6709\u5b8c\u6210\u6269\u5bb9\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u624d\u80fd\u5c06\u503cput\u6210\u529f\u3002\nfinal ConcurrentHashMap.Node&lt;K,V&gt;[] helpTransfer(ConcurrentHashMap.Node&lt;K,V&gt;[] tab, ConcurrentHashMap.Node&lt;K,V&gt; f) {\n\u00a0\u00a0\u00a0\u00a0ConcurrentHashMap.Node&lt;K,V&gt;[] nextTab; int sc;\n\u00a0\u00a0\u00a0\u00a0//\u91cd\u590d\u68c0\u67e5\u4e00\u4e0b\u6570\u7ec4\u662f\u5426\u4e3anull\uff0c\u5f53\u524d\u8282\u70b9\u662f\u5426\u662fForwardingNode\uff0c\u65b0\u6570\u7ec4\u662f\u5426\u4e3aNull\uff0c\u4ee5\u514d\u5e76\u53d1\u51fa\u73b0\u95ee\u9898\uff0c\u5565\u95ee\u9898\u4e5f\u61d2\u5f97\u7ec6\u60f3\u4e86\n\u00a0\u00a0\u00a0\u00a0if (tab != null &amp;&amp; (f instanceof ConcurrentHashMap.ForwardingNode) &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(nextTab = ((ConcurrentHashMap.ForwardingNode&lt;K,V&gt;)f).nextTable) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//sizeCtl\u6b63\u5728\u6269\u5bb9\u65f6\u7684\u57fa\u6570\uff0c\u6bcf\u589e\u52a0\u4e00\u4e2a\u6269\u5bb9\u7ebf\u7a0b\u5c31\u4f1a\u5728\u6b64\u57fa\u7840\u4e0a\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int rs = resizeStamp(tab.length) &lt;&lt; RESIZE_STAMP_SHIFT;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (nextTab == nextTable &amp;&amp; table == tab &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(sc = sizeCtl) &lt; 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6ca1\u6709\u6269\u5bb9\u7ebf\u7a0b\u4e86\uff08\u5f53\u524d\u7ebf\u7a0b\u5e76\u4e0d\u662f\u6269\u5bb9\u7684\u53d1\u8d77\u8005\uff0c\u5b83\u53ea\u662f\u5728\u6dfb\u52a0\u5143\u7d20\u65f6\u53d1\u73b0\u4e86map\u6b63\u5728\u6269\u5bb9\u7f62\u4e86\uff09\uff0c\u6216\u8005\u6ca1\u6709\u5b50\u4efb\u52a1\u4e86\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (sc == rs + MAX_RESIZERS || sc == rs + 1 ||\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0transferIndex &lt;= 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5426\u5219\u53c2\u52a0\u6269\u5bb9\uff0c\u6269\u5bb9\u7ebf\u7a0b\u6570\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (U.compareAndSetInt(this, SIZECTL, sc, sc + 1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0transfer(tab, nextTab);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return nextTab;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return table;\n}\n</code></pre></p> <p>\u6269\u5bb9 \u6b65\u957f\u662f\u5982\u4f55\u8ba1\u7b97\u7684\uff1f \u82e5cpu\u662f\u5355\u6838\uff0c\u5373NCPU=1\uff0c\u90a3\u4e48stride\u5c31\u7b49\u4e8e\u6574\u4e2a\u6570\u7ec4\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u53ea\u7528\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u6574\u4e2amap\u7684\u8fc1\u79fb\uff0c\u5426\u5219\u901a\u8fc7cpu\u6838\u6570\u4e0e\u6570\u7ec4\u957f\u5ea6\u4e00\u8d77\u8ba1\u7b97\u51fastride\uff0c\u7136\u540e\u82e5\u6b65\u957f\u5c0f\u4e8e\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f16\u3002</p> <p>\u591a\u7ebf\u7a0b\u6269\u5bb9\u6d41\u7a0b\u6982\u8ff0\uff1a</p> <ol> <li>\u9996\u5148\u68c0\u67e5\u662f\u5426\u662f\u7b2c\u4e00\u6b21put\u5143\u7d20\uff0c\u5982\u679c\u662f\uff0c\u9700\u8981\u5148\u521d\u59cb\u5316\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u5728new ConcurrentHashMap\u7684\u65f6\u5019\u5e76\u6ca1\u6709\u521d\u59cb\u5316\u6570\u7ec4\uff0c\u771f\u6b63\u505a\u6570\u7ec4\u521d\u59cb\u5316\u662f\u5728\u7b2c\u4e00\u6b21\u6dfb\u52a0\u5143\u7d20\u65f6\u5b8c\u6210\uff0c\u5373\u61d2\u521d\u59cb\u5316\uff08Lazily initialized\uff09\u3002\u521d\u59cb\u5316\u5b8c\u6210\u540e\u81ea\u65cb\u8fdb\u884c\u6dfb\u52a0\u5143\u7d20\u3002</li> <li>\u5c06keyhash\u4e4b\u540e\u627e\u5230key\u6240\u5728\u6876\uff0c\u7136\u540e\u68c0\u67e5\u4e3anull\uff0c\u5982\u679c\u662f\uff0c\u5c1d\u8bd5\u4f7f\u7528cas\u8bbe\u7f6evalue\uff0ccas\u6210\u529f\u5c31\u76f4\u63a5break\uff0c\u8868\u793a\u6dfb\u52a0\u6210\u529f\uff0c\u5982\u679c\u5931\u8d25\u4e86\uff0c\u81ea\u65cb\u91cd\u65b0\u5c1d\u8bd5\u5176\u4ed6\u60c5\u51b5\u7684\u6dfb\u52a0\u64cd\u4f5c\u3002</li> <li>\u4e0a\u4e00\u6b65\u5931\u8d25\u540e\u8868\u793a\u6876\u7684\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u4e00\u5b9a\u6709\u4e86\u5143\u7d20\uff0c\u6240\u4ee5\u9700\u8981\u68c0\u67e5\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u662fforwarding\u8282\u70b9\uff0c\u5982\u679c\u662f\uff0c\u8868\u793a\u5f53\u524d\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u4e86\uff0c\u5e76\u4e14\u6269\u5bb9\u64cd\u4f5c\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u6b64\u7ebf\u7a0b\u9700\u8981\u53bb\u534f\u52a9\u6269\u5bb9\u3002</li> <li>\u5982\u679c\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e0d\u662fforwarding\u8282\u70b9\uff0c\u90a3\u4e48\u53ef\u80fd\u7684\u60c5\u51b5\u67093\u79cd\uff1a\u3010\u6ca1\u6709\u8fdb\u884c\u6269\u5bb9\u3011\u3001\u6216\u8005\u3010\u6b63\u5728\u6269\u5bb9\uff0c\u4f46\u662f\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u3011\u3001\u6216\u8005\u3010\u6b63\u5728\u6269\u5bb9\uff0c\u4f46\u662f\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u5b8c\uff0c\u53ea\u88ab\u8fc1\u79fb\u4e86\u4e00\u90e8\u5206\u3011\u3002\u7531\u4e8e\u6267\u884c\u6dfb\u52a0\u64cd\u4f5c\u9700\u8981\u4fee\u6539\u94fe\u8868\u6216\u8005\u6811\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u52a0\u4e92\u65a5\u9501\uff0c\u5bf9\u4e8e\u524d\u4e24\u79cd\u60c5\u51b5\uff0c\u8be5\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u52a0\u9501\u6210\u529f\u5e76\u6dfb\u52a0\u6210\u529f\uff0c\u4f46\u662f\u5bf9\u4e8e\u7b2c3\u79cd\u60c5\u51b5\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u6269\u5bb9\u7ebf\u7a0b\u6b63\u5728\u8fc1\u79fb\u6876\u7684\u65f6\u5019\u4e5f\u4f1a\u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u52a0\u4e92\u65a5\u9501\uff0c\u7b49\u5230\u6269\u5bb9\u7ebf\u7a0b\u91ca\u653e\u9501\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u62a2\u5230\u9501\u4e5f\u4e0d\u80fd\u6dfb\u52a0\u6210\u529f\uff0c\u56e0\u4e3a\u4f1adouble check\u4e00\u4e2a\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u8fd8\u662f\u539f\u6765\u7684\u90a3\u4e2a\u5143\u7d20\uff0c\u663e\u7136\u7b2c\u4e00\u4e2a\u5143\u7d20\u88ab\u6269\u5bb9\u7ebf\u7a0b\u6362\u6210\u4e86forwarding\u8282\u70b9\uff0c\u4e8e\u662f\u8be5\u7ebf\u7a0b\u6dfb\u52a0\u5931\u8d25\uff0c\u81ea\u65cb\u91cd\u65b0\u5c1d\u8bd5\u540e\u5230\u7b2c3\u6b65\u53bb\u534f\u52a9\u6269\u5bb9\u3002</li> <li>\u6dfb\u52a0\u5b8c\u6210\u540e\u9700\u8981\u68c0\u67e5\u6876\u7684\u8282\u70b9\u6570\u91cf\uff0c\u5982\u679c\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c\uff0c\u9700\u8981\u8fdb\u884c\u6811\u5316\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0eHashMap\u4e00\u6837\uff0c\u5f53\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u5e76\u4e14\u94fe\u8868\u957f\u5ea6\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c8\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u8fdb\u884c\u6811\u5316\u64cd\u4f5c\uff0c\u800c\u662f\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\u3002</li> <li>\u6700\u540e\u4f1a\u8c03\u7528addcount\u65b9\u6cd5\u7ef4\u62a4\u8282\u70b9\u4e2a\u6570\uff0c\u5e76\u4e14\u5f53\u8282\u70b9\u4e2a\u6570\u8fbe\u5230\u6269\u5bb9\u9608\u503c\u65f6addCount\u65b9\u6cd5\u8fd8\u4f1a\u8c03\u7528\u6269\u5bb9\u65b9\u6cd5\u3002</li> </ol> <p> \u94fe\u8868\u7684\u8fc1\u79fb\uff1a  \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff1a\u94fe\u8868\u548c\u6811\u7684\u8fc1\u79fb\u65f6\uff0c\u662f\u5bf9\u6bcf\u4e2a\u8282\u70b9\u8fdb\u884c\u590d\u5236\uff0c\u4e5f\u5c31\u662f\u65b0Map\u4e2d\u7684\u8282\u70b9\u90fd\u662fnew\u51fa\u6765\u7684\uff0c\u800c\u4e0d\u662f\u53ea\u5c06\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u590d\u5236\u5230\u4e86\u65b0\u6570\u7ec4\uff0c\u8fd9\u4e48\u505a\u7684\u539f\u56e0\u5c31\u662f\u786e\u4fdd\u8bfb\u5199\u53ef\u4ee5\u5e76\u53d1\uff0c\u5373\u5199\u65f6\u590d\u5236\u7684\u601d\u60f3\uff0c\u4fdd\u8bc1\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u8bfb\u4e0d\u53d7\u5f71\u54cd\uff08\u8fc1\u79fb\u65f6\u540c\u4e00\u4e2a\u6876\u4e0a\u7684\u5143\u7d20\u4f1a\u88ab\u5206\u6563\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u7684\u4e24\u4e2a\u4e0d\u540c\u7684\u6876\u4e2d\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5bf9\u8282\u70b9\u8fdb\u884c\u590d\u5236\u5fc5\u7136\u4f1a\u5bf9\u8bfb\u64cd\u4f5c\u6df7\u4e71\uff09\uff0c\u8fc1\u79fb\u5b8c\u4e4b\u540e\u4f1a\u5c06forwarding\u8282\u70b9\u8bbe\u7f6e\u5230\u65e7\u6876\u4e0a\uff0c\u4e4b\u540e\u7684\u8bfb\u4f1a\u88ab\u8f6c\u53d1\u5230\u65b0\u6570\u7ec4\u4e0a\u8fdb\u884c\u3002</p> <p>get\u65b9\u6cd5 ConcurrentHashMap\u7684\u8bbe\u8ba1\u5df2\u7ecf\u89e3\u51b3\u4e86\u8bfb\u5199\u5e76\u53d1\u7684\u95ee\u9898\uff0c\u53ea\u7ba1\u8bfb\u5c31\u597d\uff0c\u4e3b\u8981\u539f\u56e0\uff1a 1.Node\u7684val\u7528volatile\u4fee\u9970\uff0c\u6240\u4ee5\u5982\u679c\u5199\u7ebf\u7a0b\u5148\u4fee\u6539\u4e86\uff0c\u8bfb\u7ebf\u7a0b\u80fd\u53ca\u65f6\u8bfb\u5230\uff08\u8fd9\u91cc\u6ca1\u6709\u6570\u636e\u5e93\u4e8b\u52a1\u7684\u90a3\u79cd\u6982\u5ff5\uff0c\u6ca1\u6709\u8bf4\u6211\u73b0\u5728\u5728\u8bfb\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4e0d\u80fd\u5199\u7684\u60c5\u51b5\uff09\u3002 2.\u8bfb\u64cd\u4f5c\u53d1\u751f\u5728\u5199\u64cd\u4f5c\u4e4b\u524d\uff0c\u6216\u8005\u8bfb\u64cd\u4f5c\u53d1\u751f\u5728\u5199\u64cd\u4f5c\u4e4b\u540e\uff0c\u6216\u8005\u8bfb\u64cd\u4f5c\u53d1\u751f\u5728\u5199\u64cd\u4f5c\u4e4b\u4e2d\uff08\u6269\u5bb9\u65f6\uff09\u90fd\u662f\u53ef\u4ee5\u7684\uff0c\u5bb9\u5668\u5e76\u4e0d\u4fdd\u8bc1\u8fd9\u79cd\u8bfb\u5199\u987a\u5e8f\uff0c\u60f3\u8981\u4fdd\u8bc1\u8bfb\u5199\u987a\u5e8f\u5e94\u8be5\u662f\u4e0a\u5c42\u5e94\u7528\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u53e6\u5916\u52a0\u9501\u3002\u89e3\u91ca\u4e00\u4e0b\u8bfb\u64cd\u4f5c\u53d1\u751f\u5728\u5199\u64cd\u4f5c\u4e4b\u4e2d\uff08\u6269\u5bb9\u65f6\uff09\u7684\u573a\u666f\uff1a\u5982\u679c\u6b63\u5728\u53d1\u751f\u6269\u5bb9\u64cd\u4f5c\uff0c\u5e76\u4e14\u8bfb\u7ebf\u7a0b\u7684\u6240\u8bfb\u7684\u6876\u88ab\u8fc1\u79fb\u4e86\uff0c\u8bfb\u7ebf\u7a0b\u4e0d\u4f1a\u88ab\u62c9\u5230\u6269\u5bb9\u5927\u519b\uff0c\u800c\u662f\u76f4\u63a5<code>\u6839\u636eforwarding\u8282\u70b9\u7684nextTable\u5c5e\u6027\u5728\u65b0\u6269\u5bb9\u7684\u6570\u7ec4\u4e0a\u67e5\u627e</code>\uff0c\u8fd9\u4e5f\u5c31\u662fforwarding\u8282\u70b9\u540d\u5b57\u7684\u7531\u6765\uff0c\u5373\u5c06\u8bfb\u8bf7\u6c42\u8f6c\u53d1\u5230\u65b0\u7684\u6269\u5bb9\u6570\u7ec4\u3002 Text Only<pre><code>public V get(Object key) {\n\u00a0\u00a0\u00a0\u00a0Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek;\n\u00a0\u00a0\u00a0\u00a0int h = spread(key.hashCode());\n\u00a0\u00a0\u00a0\u00a0if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(e = tabAt(tab, (n - 1) &amp; h)) != null) {\n\u00a0 \u00a0 \u00a0 \u00a0 //\u5982\u679c\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u5c31\u662f\u8981\u627e\u7684\uff0c\u76f4\u63a5\u8fd4\u56de\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((eh = e.hash) == h) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return e.val;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 `//eh&lt;0\u6709\u4e24\u79cd\u53ef\u80fd\uff0c\u4e00\u662f\uff0c\u8be5\u6876\u662f\u4e00\u9897\u6811\uff0c\u6839\u8282\u70b9\u7684hash\u503c\u7b49\u4e8e-2\uff1b\u53e6\u5916\u4e00\u79cd\u53ef\u80fd\u662fConcurrentHashMap\u6b63\u5728\u6269\u5bb9\uff0c\u8be5\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u4e86\uff0c\u6240\u4ee5\u6b64\u4f4d\u7f6e\u662f\u4e00\u4e2aforwarding\u8282\u70b9\u3002\u56e0\u4e3a\u8282\u70b9\u90fd\u662f\u7ee7\u627f\u81eaNode\uff0c\u6240\u4ee5e.find(h, key)\u4f1a\u8c03\u7528\u5bf9\u5e94\u5b9e\u4f8b\u7684\u65b9\u6cd5\u5728\u6811\u4e0a\u67e5\u627e\uff0c\u6216\u8005\u6839\u636eforwarding\u8282\u70b9\u7684nextTable\u5c5e\u6027\u5728\u65b0\u6269\u5bb9\u7684\u6570\u7ec4\u4e0a\u67e5\u627e\u3002`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (eh &lt; 0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return (p = e.find(h, key)) != null ? p.val : null;\n\u00a0 \u00a0 \u00a0 \u00a0 //\u5728\u94fe\u8868\u4e0a\u67e5\u627e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while ((e = e.next) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (e.hash == h &amp;&amp;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return e.val;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return null;\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/09-BolckingQueue/","title":"09-BolckingQueue","text":"<p> \u7ea6 454 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>BolckingQueue\uff0c\u963b\u585e\u961f\u5217 \u5148\u8fdb\u5148\u51fa\u7684\u961f\u5217\uff0c\u6709\u5982\u4e0b4\u7ec4\u65b9\u6cd5\uff0c\u65b9\u6cd5\u90fd\u6709\u52a0\u91cd\u5165\u9501\uff0c\u6240\u4ee5\u80fd\u4fdd\u8bc1\u591a\u7ebf\u7a0b\u4e0b\u63d2\u5165\u79fb\u9664\u7684\u5b89\u5168\u6027</p> Throws exception Special value Blocks Times out Insert add(e) offer(e) put(e) offer(e, time, unit) Remove remove() poll() take() poll(time, unit) Examine element() peek() not applicable not applicable <p>\u629b\u51fa\u5f02\u5e38\u7ec4\u7684\u4e09\u4e2a\u65b9\u6cd5\u7684\u610f\u601d\u662f\uff0cadd(e)\u5f80\u4e00\u4e2a\u6ee1\u961f\u5217\u91cc\u63d2\u5165\u5143\u7d20\uff0cremove()\u5f80\u4e00\u4e2a\u7a7a\u961f\u5217\u91cc\u79fb\u9664\u5143\u7d20\uff0celement()\u67e5\u770b\u7a7a\u961f\u5217\u5934\u7684\u5143\u7d20\uff0c\u90fd\u4f1a\u629b\u5f02\u5e38\u3002 \u7279\u6b8a\u503c\u7ec4\u7684\u4e09\u4e2a\u65b9\u6cd5\u7684\u610f\u601d\u662f\uff0coffer(e)\u5f80\u4e00\u4e2a\u6ee1\u961f\u5217\u91cc\u63d2\u5165\u5143\u7d20\u4f1a\u8fd4\u56defalse\uff0c\u6216\u8005poll()\u5f80\u4e00\u4e2a\u7a7a\u961f\u5217\u91cc\u79fb\u9664\u5143\u7d20\u4f1a\u8fd4\u56denull\uff0cpeek()\u67e5\u770b\u7a7a\u961f\u5217\u5934\u7684\u5143\u7d20\u4f1a\u8fd4\u56denull\u3002 \u963b\u585e\u7ec4\u7684\u4e09\u4e2a\u65b9\u6cd5\u7684\u610f\u601d\u662f\uff0c\u5f80\u4e00\u4e2a\u6ee1\u961f\u5217\u91cc\u63d2\u5165\u5143\u7d20\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u6709\u7a7a\u95f4\uff0c\u6216\u5f80\u4e00\u4e2a\u7a7a\u961f\u5217\u91cc\u79fb\u9664\u5143\u7d20\u4e5f\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u91cc\u9762\u6709\u5143\u7d20\uff08\u5176\u5b9e\u5185\u90e8\u5b9e\u73b0\u5c31\u662f\u6761\u4ef6\u53d8\u91cfCondition\u7684await\u548csignal\uff09\u3002 \u8d85\u65f6\u7ec4\u7684\u4e09\u4e2a\u65b9\u6cd5\u7684\u610f\u601d\u662f\uff0c\u5f80\u4e00\u4e2a\u6ee1\u961f\u5217\u91cc\u63d2\u5165\u5143\u7d20\uff0c\u6216\u5f80\u4e00\u4e2a\u7a7a\u961f\u5217\u91cc\u79fb\u9664\u5143\u7d20\u90fd\u4f1a\u963b\u585e\uff0c\u4f46\u6709\u963b\u585e\u662f\u65f6\u95f4\u7684\uff0c\u8d85\u8fc7\u65f6\u95f4\u5c31\u4e0d\u7b49\u4e86\u3002</p> <p>BolckingQueue\u53ea\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u8981\u7528\u7684\u8bdd\u5c31\u4e3b\u8981\u7528\u5b83\u7684\u4e09\u4e2a\u5b9e\u73b0\u7c7b\uff1a \u2460 ArrayBlockingQueue \u6570\u7ec4\u6784\u6210\u7684\u6709\u754c\u963b\u585e\u961f\u5217 \u2461 LinkedBlockingQueue \u94fe\u8868\u6784\u6210\u7684\u6709\u754c\uff08\u4f46\u6700\u5927\u503c\u4e3aInteger.MAX_VALUE\uff09\u963b\u585e\u961f\u5217 \u2462 SynchronousQueue \u4e0d\u5b58\u50a8\u5143\u7d20\u7684\u963b\u585e\u961f\u5217 \u5176\u4ed6\u5b9e\u73b0\u7c7b\uff1a</p> <ol> <li>PriorityBlockingQueue \uff1a\u652f\u6301\u4f18\u5148\u7ea7\u6392\u5e8f\u7684\u65e0\u754c\u963b\u585e\u961f\u5217</li> <li>DelayQueue\uff1a\u4f7f\u7528\u4f18\u5148\u7ea7\u961f\u5217\u5b9e\u73b0\u7684\u65e0\u754c\u963b\u585e\u961f\u5217</li> <li>LinkedTransferQueue\uff1a\u7531\u94fe\u8868\u7ed3\u6784\u7ec4\u6210\u7684\u65e0\u754c\u963b\u585e\u961f\u5217</li> <li>LinkedBlockingDeque\uff1a\u7531\u94fe\u8868\u7ed3\u6784\u7ec4\u6210\u7684\u53cc\u5411\u963b\u585e\u961f\u5217</li> </ol>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/10-%E7%BA%BF%E7%A8%8B%E6%B1%A0/","title":"10--\u7ebf\u7a0b\u6c60","text":"<p> \u7ea6 725 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p></p> <p>Executors\u662f\u7ebf\u7a0b\u6c60\u7684\u5de5\u5177\u7c7b\u548c\u5de5\u5382\u7c7b\uff0c\u4e3b\u8981\u662f\u6765\u521b\u5efa\u7ebf\u7a0b\u6c60\u7684\uff0c\u6bd4\u5982\uff1a Text Only<pre><code>ExecutorService threadPool = Executors.newFixedThreadPool(5);\u00a0\u00a0\u00a0\u00a0//\u56fa\u5b9a\u5bb9\u91cf\nExecutorService threadPool = Executors.newSingleThreadExecutor();\u00a0\u00a0\u00a0\u00a0\u00a0//\u5355\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\nExecutorService threadPool = Executors.newCachedThreadPool();\u00a0\u00a0\u00a0\u00a0\u00a0//\u7f13\u5b58\u7684 \u5373\u8d85\u51fa\u5c31\u81ea\u52a8\u521b\u5efa\u7ebf\u7a0b\u7684\n</code></pre> \u8fd9\u51e0\u79cd\u7c7b\u578b\u7684\u7ebf\u7a0b\u6c60\u5176\u5b9e\u90fd\u662fThreadPoolExecutor\u7684\u5b9e\u4f8b\u3002</p> <p>\u4e0b\u9762\u662fThreadPoolExecutor\u7c7b\u7684\u6784\u9020\u5668\uff1a Text Only<pre><code>public ThreadPoolExecutor(int corePoolSize,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int maximumPoolSize,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long keepAliveTime,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit unit,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BlockingQueue&lt;Runnable&gt; workQueue,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ThreadFactory threadFactory,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0RejectedExecutionHandler handler)\n</code></pre> corePoolSize\uff1a\u7ebf\u7a0b\u6c60\u4e2d\u5e38\u9a7b\u7684\u7ebf\u7a0b\u6570 \u3002\u521d\u59cb\u65f6\uff0c\u5f53\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\u6c60\u6570\u5c0f\u4e8ecorePoolSize\u65f6\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u662f\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u624d\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528prestartAllCoreThreads\u65b9\u6cd5\u4e00\u6b21\u6027\u7684\u542f\u52a8corePoolSize\u4e2a\u6570\u7684\u7ebf\u7a0b\uff0c\u5f53\u7ebf\u7a0b\u6570\u7b49\u4e8ecorePoolSize\u65f6\uff0c\u65b0\u4efb\u52a1\u4f1a\u8ffd\u52a0\u5230workQueue\u4e2d\u3002 maximumPoolSize\uff1a\u7ebf\u7a0b\u6c60\u4e2d\u6700\u5927\u7ebf\u7a0b\u6570 keepAliveTime\uff1a \u8d85\u8fc7\u5e38\u9a7b\u7ebf\u7a0b\u6570\u7684\u7ebf\u7a0b\u5728\u7a7a\u95f2\u4e0b\u6765keepAliveTime\u540e\u4f1a\u88ab\u9500\u6bc1 unit\uff1akeepAliveTime\u7684\u65f6\u95f4\u5355\u4f4d workQueue\uff1a\u963b\u585e\u961f\u5217 threadFactory\uff1a\u7ebf\u7a0b\u5de5\u5382\uff0c\u7528\u4e8e\u521b\u5efa\u7ebf\u7a0b\uff0c\u4e00\u822c\u9ed8\u8ba4 handler\uff1a\u62d2\u7edd\u7b56\u7565\uff0c\u5f53\u963b\u585e\u961f\u5217\u6ee1\u4e86\uff0c\u5e76\u4e14\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u7b49\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570\u65f6\uff0c\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u4f1a\u6267\u884c\u62d2\u7edd\u7b56\u7565</p> <p>\u7ebf\u7a0b\u6c60\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a \u00a0\u00a0 \u00a01.\u5f53\u63d0\u4ea4\u7684\u4efb\u52a1\u6570\u5c0f\u4e8e\u5e38\u9a7b\u7ebf\u7a0b\u6570corePoolSize\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528\u5e38\u9a7b\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff1b \u00a0\u00a0 \u00a02.\u5e38\u9a7b\u7ebf\u7a0b\u5747\u5728\u6267\u884c\u4efb\u52a1\u65f6\uff0c\u518d\u63d0\u4ea4\u7684\u4efb\u52a1\u4f1a\u8fdb\u5165\u963b\u585e\u961f\u5217workQueue \u00a0 \u00a0 3.\u963b\u585e\u961f\u5217\u5df2\u6ee1\u65f6\uff0c\u4f1a\u76f4\u63a5\u518d\u521b\u5efa\u7ebf\u7a0b\u6267\u884c\u65b0\u7684\u4efb\u52a1\uff0c\u4f46\u603b\u7684\u7ebf\u7a0b\u6570\u4e0d\u4f1a\u8d85\u8fc7maximumPoolSize \u00a0 \u00a0 4.\u603b\u7684\u7ebf\u7a0b\u6570\u7b49\u4e8e\u6700\u5927\u7ebf\u7a0b\u6570maximumPoolSize\uff0c\u5e76\u4e14\u6240\u6709\u7ebf\u7a0b\u5747\u5728\u6267\u884c\u4efb\u52a1\uff0c\u800c\u4e14\u6b64\u65f6\u4efb\u52a1\u961f\u5217\u4e5f\u662f\u6ee1\u7684\uff0c\u90a3\u4e48\u518d\u63d0\u4ea4\u7684\u4efb\u52a1\u4f1a\u6267\u884c\u62d2\u7edd\u7b56\u7565handler</p> <p></p> <p>\u62d2\u7edd\u7b56\u7565\uff1a 1.AbortPolicy\uff0c\u9ed8\u8ba4\u7684\uff0c\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u963b\u6b62\u7cfb\u7edf\u6b63\u5e38\u5de5\u4f5c Text Only<pre><code>new ThreadPoolExecutor.AbortPolicy()\n</code></pre> 2.CallerRunsPolicy\uff0c\u628a\u4efb\u52a1\u4ea4\u7ed9\u8c03\u7528\u8005\u7ebf\u7a0b\u6267\u884c Text Only<pre><code>new ThreadPoolExecutor.CallerRunsPolicy()\n</code></pre> 3.DiscardPolicy\uff0c\u9ed8\u9ed8\u4e22\u5f03\u4efb\u52a1 Text Only<pre><code>new ThreadPoolExecutor.DiscardPolicy()\n</code></pre> 4.DiscardOldestPolicy\uff0c\u4e22\u6389\u6700\u8001\u7684\u4efb\u52a1\uff0c\u4e5f\u5c31\u662f\u4e0b\u4e00\u4e2a\u5373\u5c06\u6267\u884c\u7684\u4efb\u52a1 Text Only<pre><code>new ThreadPoolExecutor.DiscardOldestPolicy()\n</code></pre></p> <p>\u793a\u4f8b\uff1a Text Only<pre><code>public class ThreadPoolDemo02 {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a05,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a08,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(2),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Executors.defaultThreadFactory(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new ThreadPoolExecutor.AbortPolicy()\n//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new ThreadPoolExecutor.CallerRunsPolicy()\n//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new ThreadPoolExecutor.DiscardPolicy()\n//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new ThreadPoolExecutor.DiscardOldestPolicy()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 15; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0final int temp = i;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadPoolExecutor.execute(()-&gt;{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \" \u4e3a\u63d0\u4f9b \" + temp + \" \u670d\u52a1\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadPoolExecutor.shutdown();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4ee5\u4e0b\u51e0\u79cd\u521b\u5efa\u7ebf\u7a0b\u6c60\u7684\u65b9\u5f0f\u7528\u7684\u5c11 \u521b\u5efa\u56fa\u5b9a\u5bb9\u91cf\u7684\u7ebf\u7a0b\u6c60 Text Only<pre><code>ExecutorService threadPool = Executors.newFixedThreadPool(5);\u00a0\u00a0\u00a0\u00a0//\u56fa\u5b9a\u5bb9\u91cf\n</code></pre> \u5b9e\u9645\u4e0a  \u5176\u4e2dnew LinkedBlockingQueue()\u5c31\u662f\uff1a  \u6240\u4ee5\u56fa\u5b9a\u5bb9\u91cf\u7684\u7ebf\u7a0b\u6c60\u591a\u51fa\u7684\u4efb\u52a1\u4f1a\u653e\u5728LinkedBlockingQueue\u4e2d\uff0c\u76f4\u5230OOM <p>\u521b\u5efa\u5355\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\uff1a Text Only<pre><code>ExecutorService threadPool = Executors.newSingleThreadExecutor();\u00a0\u00a0\u00a0\u00a0\u00a0//\u5355\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\n</code></pre>  \u6240\u4ee5\u591a\u51fa\u7684\u4efb\u52a1\u4f1a\u653e\u5728LinkedBlockingQueue\u4e2d\uff0c\u76f4\u5230OOM</p> <p>\u521b\u5efa\u7f13\u5b58\u7ebf\u7a0b\u6c60\uff1a Text Only<pre><code>ExecutorService threadPool = Executors.newCachedThreadPool();\u00a0\u00a0\u00a0\u00a0\u00a0//\u7f13\u5b58\u7684 \u5373\u8d85\u51fa\u5c31\u81ea\u52a8\u521b\u5efa\u7ebf\u7a0b\u7684\n</code></pre>  \u4e5f\u5c31\u6765\u65b0\u4efb\u52a1\u540e\uff0c\u5982\u679c\u7ebf\u7a0b\u6c60\u5c31\u6ca1\u6709\u7a7a\u95f2\u7684\u7ebf\u7a0b\u5c31\u521b\u5efa\u65b0\u7ebf\u7a0b\u6267\u884c\u65b0\u4efb\u52a1\uff0c\u76f4\u5230\u521b\u5efa\u7684\u7ebf\u7a0b\u592a\u591a\u4e86\u5bfc\u81f4OOM</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/11-%E6%9F%A5%E7%9C%8B%E5%92%8C%E6%9D%80%E6%AD%BB%E7%BA%BF%E7%A8%8B/","title":"11-\u67e5\u770b\u548c\u6740\u6b7b\u7ebf\u7a0b","text":"<p> \u7ea6 164 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p> <p>Windows cmd\u547d\u4ee4\uff1a</p> \u67e5\u770b\u8fdb\u7a0b tasklist \u6740\u6b7b\u8fdb\u7a0b taskkill <p>Linux\u547d\u4ee4\uff1a</p> \u67e5\u770b\u6240\u6709\u8fdb\u7a0b ps -ef \u67e5\u770b\u67d0\u4e2a\u8fdb\u7a0b\uff08PID\uff09\u7684\u6240\u6709\u7ebf\u7a0b ps -fT -p  \u6740\u6b7b\u8fdb\u7a0b kill \u6309\u5927\u5199 H \u5207\u6362\u662f\u5426\u663e\u793a\u7ebf\u7a0b top \u67e5\u770b\u67d0\u4e2a\u8fdb\u7a0b\uff08PID\uff09\u7684\u6240\u6709\u7ebf\u7a0b top -H -p  <p>Java\u547d\u4ee4\uff1a</p> \u547d\u4ee4\u67e5\u770b\u6240\u6709 Java \u8fdb\u7a0b jps \u67e5\u770b\u67d0\u4e2a Java \u8fdb\u7a0b\uff08PID\uff09\u7684\u6240\u6709\u7ebf\u7a0b\u72b6\u6001 jstack  <p>jconsole \u8fdc\u7a0b\u76d1\u63a7\u914d\u7f6e</p> <p>1.\u542f\u52a8\u65f6\u914d\u7f6e\u5fc5\u8981\u7684\u865a\u62df\u673a\u53c2\u6570\u4fe1\u606f\uff0c\u4f7f\u5f97\u80fd\u8fdc\u7a0b\u8bbf\u95ee\u5230 Text Only<pre><code>java -Djava.rmi.server.hostname=&lt;ip\u5730\u5740&gt; -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=&lt;\u8fde\u63a5\u7aef\u53e3&gt; -Dcom.sun.management.jmxremote.ssl=&lt;\u662f\u5426\u5b89\u5168\u8fde\u63a5&gt; -Dcom.sun.management.jmxremote.authenticate=&lt;\u662f\u5426\u8ba4\u8bc1&gt; java\u7c7b\n</code></pre> 2.\u547d\u4ee4\u884c\u8f93\u5165jconsole\u5373\u53ef\u5f00\u542f\uff0c\u9009\u62e9\u8fdc\u7a0b\u8fde\u63a5 </p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/12-%E5%AF%B9%E8%B1%A1%E5%A4%B4%E7%BB%93%E6%9E%84/","title":"12-\u5bf9\u8c61\u5934\u7ed3\u6784","text":"<p> \u7ea6 526 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>Java\u5bf9\u8c61\u5934\uff08\u4ee532\u4f4d\u865a\u62df\u673a\u4e3a\u4f8b\uff09</p> <p>1.\u666e\u901a\u5bf9\u8c61 \u666e\u901a\u5bf9\u8c61\u7684\u5bf9\u8c61\u5934\u7531 Mark Word \u548c \u7c7b\u578b\u6307\u9488 \u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMark Word\u536032\u4f4d\uff0c\u7c7b\u578b\u6307\u9488\u4e5f\u536032\u4f4d\uff0c\u5982\u4e0b\u6240\u793a\uff1a </p> <p>2.\u6570\u7ec4\u5bf9\u8c61 \u6570\u7ec4\u5bf9\u8c61\u8fd8\u9700\u8981\u989d\u591632\u4f4d\u7528\u4e8e\u5b58\u50a8\u6570\u7ec4\u957f\u5ea6 </p> <p>Mark Word \u7684\u7ed3\u6784 32\u4f4d\u865a\u62df\u673a </p> <p>64\u4f4d\u865a\u62df\u673a </p> <p>\u5f53\u5bf9\u8c61\u4f4dNormal\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u670931\u4f4d\u5b58\u7684\u662fhashcode\uff0chashcode\u503c\u4f1a\u5ef6\u8fdf\u5230\u7a0b\u5e8f\u8c03\u7528hashCode()\u65b9\u6cd5\u65f6\u624d\u4f1a\u8ba1\u7b97\u5e76\u586b\u5145\uff1b\u67094\u4f4d\u662f\u5206\u4ee3\u5e74\u9f84\uff0c\u53ef\u4ee5\u770b\u51fa\u5206\u4ee3\u5e74\u9f84\u7684\u6700\u5927\u503c\u53ea\u80fd\u8bbe\u4e3a15\uff1b\u7d27\u63a5\u7740\u7684\u662fbiased_lock\u504f\u5411\u9501\u7684\u6807\u5fd7\u4f4d\uff0c\u901a\u8fc7\u8be5\u6807\u5fd7\u4f4d\u53ef\u4ee5\u533a\u5206\u5bf9\u8c61\u662f\u5904\u4e8eNormal\u6b63\u5e38\u72b6\u6001\u8fd8\u662fBiased\u53ef\u504f\u5411\u72b6\u6001\uff0c\u56e0\u4e3a\u8fd9\u4e24\u79cd\u72b6\u6001\u6700\u540e\u4e24\u4e2a\u6807\u5fd7\u4f4d\u662f\u76f8\u540c\u7684\u3002</p> <p>\u5bf9\u8c61\u5904\u4e8eBiased\u53ef\u504f\u5411\u72b6\u6001\u65f6\uff0c\u524d54\u4f4d\u5b58\u7684\u662f\u7ebf\u7a0bid\uff0c\u8fd9\u4e2a\u7ebf\u7a0bid\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7684\uff0c\u4e0e\u5728Java\u7a0b\u5e8f\u4e2d\u901a\u8fc7Thread.getId()\u83b7\u53d6\u7684\u7ebf\u7a0bid\u6ca1\u6709\u5173\u7cfb\uff1bepoch\u662f\u504f\u5411\u65f6\u95f4\u6233\uff0c\u4e0d\u77e5\u9053\u5177\u4f53\u7528\u5904\uff1b\u7136\u540e\u662f\u5206\u4ee3\u5e74\u9f84\u548c\u504f\u5411\u9501\u6807\u5fd7\u4f4d\uff0c\u4e0e\u524d\u9762\u4ecb\u7ecd\u7684\u4e00\u6837\u3002</p> <p>\u5bf9\u8c61\u5904\u4e8eLightweight Locked\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u65f6\uff0c\u524d62\u4f4dptr_to_lock_record\u5b58\u7684\u662f\u6307\u5411\u9501\u8bb0\u5f55\u7684\u6307\u9488\uff0c\u6211\u4eec\u77e5\u9053\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\u90fd\u4f1a\u5728\u865a\u62df\u673a\u6808\u4e2d\u751f\u6210\u4e00\u4e2a\u6808\u5e27\uff0c\u5f53\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u51fa\u73b0synchronized\u52a0\u9501\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5728\u6808\u5e27\u4e2d\u751f\u6210\u4e00\u4e2a\u9501\u8bb0\u5f55\uff08\u540e\u9762\u4f1a\u5177\u4f53\u8bb2\u8fd9\u4e2a\u9501\u8bb0\u5f55\u7684\u7528\u5904\uff09\uff0c\u5bf9\u8c61\u5934\u91cc\u7684\u8fd9\u4e2a\u6307\u9488\u5c31\u662f\u6307\u5411\u6808\u5e27\u91cc\u7684\u8fd9\u4e2a\u9501\u8bb0\u5f55\u3002</p> <p>\u5bf9\u8c61\u5904\u4e8eHeavyweight Locked\u91cd\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u65f6\uff0c\u524d62\u4f4dptr_to_heavyweight_monitor\u5b58\u7684\u662f\u7ba1\u7a0b\u7684\u5730\u5740\uff0c\u7ba1\u7a0b\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u521b\u5efa\u7684\u4e00\u4e2a\u7ed3\u6784\uff0c\u662f\u9501\u7684\u5b9e\u73b0\uff08\u540e\u9762\u4f1a\u5177\u4f53\u8bb2\u7ba1\u7a0b\u662f\u5982\u4f55\u5b9e\u73b0\u9501\u7684\u529f\u80fd\u7684\uff09\u3002</p> <p>\u6700\u540e\u4e00\u79cd\u72b6\u6001\u662f\u8981\u88abGC\u7684\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u5bf9\u8c61\u5373\u5c06\u88ab\u5783\u573e\u56de\u6536\u5668\u6e05\u7406\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/13-Monitor%E4%B8%8E%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81%E7%9A%84%E5%8A%A0%E9%94%81%E5%8E%9F%E7%90%86/","title":"13-Monitor\u4e0e\u91cd\u91cf\u7ea7\u9501\u7684\u52a0\u9501\u539f\u7406","text":"<p> \u7ea6 620 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>Monitor \u7ba1\u7a0b Monitor\u7ffb\u8bd1\u4e3a\u7ba1\u7a0b\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u91cc\u4e5f\u88ab\u79f0\u4e3a\u7ba1\u7a0b\uff0c\u5b83\u5176\u5b9e\u662f\u9501\u7684\u4e00\u79cd\u5b9e\u73b0\uff0c\u6240\u4ee5\u4e5f\u79f0\u4e3a\u9501\u3002 Monitor\u7684\u7ed3\u6784\u5982\u4e0b\uff1a </p> <ul> <li>WaitSet\u6307\u5411\u56e0\u4e3a\u8c03\u7528Object::wait\u800c\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u96c6\u5408\u3002</li> <li>cxq\u6307\u5411\u56e0\u4e3a\u7ade\u4e89\u9501\u5931\u8d25\u800c\u963b\u585e\u7684\u7ebf\u7a0b\u96c6\u5408\u3002</li> <li>EntryList\u6307\u5411\u5373\u5c06\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\u961f\u5217\uff0c\u6bcf\u6b21\u5f53\u9501\u88ab\u91ca\u653e\u65f6\u4f1a\u5524\u9192EntryList\u961f\u9996\u7684\u7ebf\u7a0b\u3002</li> <li>Owner\u6307\u5411\u7684\u83b7\u5f97\u9501\u7684\u7ebf\u7a0b\u3002</li> <li>recursions\u662f\u9501\u91cd\u5165\u8ba1\u6570\u3002</li> </ul> <p>\u91cd\u91cf\u7ea7\u9501\u7684\u52a0\u89e3\u9501\u8fc7\u7a0b\uff1a \u91cd\u91cf\u7ea7\u9501\u52a0\u9501\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5728\u5bf9\u8c61\u4e0a\u52a0\u91cd\u91cf\u7ea7\u9501\u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u68c0\u67e5\u5bf9\u8c61MarkWord\u6700\u540e\u4e24\u4f4d\u662f\u4e0d\u662f01\uff0c\u5373\u662f\u5426\u5904\u4e8eHeavyweight Locked\u91cd\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u5148\u7ed9\u5bf9\u8c61\u521d\u59cb\u5316\u4e00\u4e2aMonitor\u7ba1\u7a0b\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u5bf9\u8c61\u5934\u7684MarkWord\u7528cas\u64cd\u4f5c\u7f6e\u4e3a\u91cd\u91cf\u7ea7\u9501\u72b6\uff08MarkWord\u7684\u524d62\u4f4d\u662f\u6307\u5411Monitor\u5bf9\u8c61\u7684\u6307\u9488\uff0c\u540e\u4e24\u4f4d\u662f01\uff09\uff0c\u4e4b\u540e\u518d\u5c06Monitor\u7684Owner\u6307\u5411\u8be5\u7ebf\u7a0b\uff0c\u5e76\u8bbe\u7f6erecursions\u4e3a1\uff0c\u6b64\u65f6\u8be5\u7ebf\u7a0b\u5c31\u52a0\u9501\u6210\u529f\u4e86\u3002</li> <li>\u5982\u679c\u53d1\u73b0\u5bf9\u8c61\u5df2\u7ecf\u5904\u4e8e\u91cd\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff0c\u90a3\u4e48\u9996\u5148\u4f1a\u901a\u8fc7MarkWord\u7684\u524d62\u4f4d\u627e\u5230Monitor\uff0c\u7136\u540e\u68c0\u67e5Owner\u662f\u5426\u6307\u5411\u81ea\u5df1\uff0c\u5982\u679c\u662f\uff0c\u90a3\u4e48\u9501\u91cd\u5165\uff0c\u76f4\u63a5\u5c06recursions\u52a01\u5373\u53ef\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u5c31\u5c06\u7ebf\u7a0b\u52a0\u5165\u5230cxq\u7ade\u4e89\u961f\u5217\u4e2d\u7136\u540e\u6302\u8d77\u3002</li> <li>\u5982\u679c\u7ebf\u7a0b\u5728\u89e3\u9501\u4e4b\u524d\u8c03\u7528Object::wait\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u4e5f\u4f1a\u91ca\u653e\u9501\uff0c\u7136\u540e\u52a0\u5165\u5230WaitSet\u961f\u5217\u4e2d\u7136\u540e\u6302\u8d77\u3002\u5f53\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528Object::notifyAll\uff0c\u4f1a\u5c06WaitSet\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\u3002</li> <li>\u5f53 synchronized\u5757\u7ed3\u675f \u6216\u8005 \u4f7f\u7528Object::wait \u91ca\u653e\u9501\u65f6\uff0c\u4f1a\u5148\u5c06cxq\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\uff0c\u7136\u540e\u5524\u9192EntryList\u961f\u9996\u7684\u7ebf\u7a0b\u3002</li> </ol> <p>\u603b\u7ed3\uff1a\u9501\u91ca\u653e\u65f6\uff0c\u53ea\u4f1a\u5524\u9192EntryList\u961f\u9996\u7684\u7ebf\u7a0b\u3002\u6240\u4ee5\u5bf9\u4e8e\u5904\u4e8ewaiting\u72b6\u6001\u7684\u7ebf\u7a0b\uff0c\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528notify\u65b9\u6cd5\uff0c\u90a3\u4e48\u4ed6\u5c31\u4e0d\u4f1a\u88ab\u52a0\u5165\u5230EntryList\u961f\u5217\u4e2d\uff0c\u4e5f\u5c31\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u5524\u9192\uff1b\u5bf9\u4e8e\u56e0\u4e3a\u7ade\u4e89\u9501\u5931\u8d25\u800c\u963b\u585e\u7684\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u6bcf\u6b21\u91ca\u653e\u9501\u90fd\u4f1a\u5c06cxq\u961f\u5217\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\u961f\u5217\uff0c\u6240\u4ee5\u53ea\u8981\u9501\u88ab\u91ca\u653e\uff0c\u5b83\u4eec\u5c31\u6709\u88ab\u5524\u9192\u7684\u673a\u4f1a\uff08\u53ef\u4ee5\u7b80\u5355\u5730\u5c06cxq\u961f\u5217\u548cEntryList\u961f\u5217\u770b\u4f5c\u662f\u4e00\u8d77\u7684\uff0c\u7136\u540e\u6bcf\u6b21\u8c03\u7528notify\u65b9\u6cd5\u90fd\u4f1a\u5c06WaitSet\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\u961f\u5217\uff09\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/14-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81%E7%9A%84%E5%8A%A0%E9%94%81%E5%8E%9F%E7%90%86/","title":"14-\u8f7b\u91cf\u7ea7\u9501\u7684\u52a0\u9501\u539f\u7406","text":"<p> \u7ea6 563 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>\u6bcf\u6b21\u52a0\u9501\u90fd\u521b\u5efaMonitor\u672a\u514d\u5f00\u9500\u592a\u5927\uff0c\u5c24\u5176\u5bf9\u4e8e\u9501\u7ade\u4e89\u4e0d\u6fc0\u70c8\u7684\u7a0b\u5e8f\u800c\u8a00\uff0c\u4e3a\u6b64JVM\u5bf9synchronized\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u63d0\u51fa\u4e86\u8f7b\u91cf\u7ea7\u9501\u7684\u65b9\u6cd5\u3002\u4e5f\u5c31\u662f\u7b2c\u4e00\u6b21\u5bf9\u5bf9\u8c61\u52a0\u9501\u65f6\u4e0d\u521b\u5efaMonitor\uff0c\u800c\u662f\u5148\u52a0\u8f7b\u91cf\u7ea7\u9501\uff0c\u5982\u679c\u5f53\u8f7b\u91cf\u7ea7\u9501\u672a\u89e3\u9501\u65f6\u6709\u65b0\u7684\u7ebf\u7a0b\u6765\u7ade\u4e89\u8fd9\u628a\u9501\uff0c\u5c31\u5c06\u8f7b\u91cf\u7ea7\u9501\u5347\u7ea7\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002</p> <p>\u8f7b\u91cf\u7ea7\u9501\u7684\u52a0\u9501\u8fc7\u7a0b\uff1a 1.\u5f53\u65b9\u6cd5\u6267\u884csynchronized(obj)\u65f6\uff0c\u4f1a\u518d\u5bf9\u5e94\u7684\u6808\u5e27\u4e2d\u751f\u6210\u4e00\u4e2aLock Record\u9501\u8bb0\u5f55\uff0c\u9501\u8bb0\u5f55\u7684\u7b2c\u4e00\u9879\u662f\u9501\u8bb0\u5f55\u5730\u5740\uff08\u6700\u540e\u4e24\u4f4d\u662f\u6807\u5fd7\u4f4d00\uff09\uff0c\u7b2c\u4e8c\u9879\u662fobj\u5bf9\u8c61\u7684\u5f15\u7528\u5730\u5740\u3002 </p> <p>2. \u8ba9\u9501\u8bb0\u5f55\u4e2d Object reference \u6307\u5411\u9501\u5bf9\u8c61\uff0c\u5e76\u5c1d\u8bd5\u7528 CAS \u5c06\u9501\u8bb0\u5f55\u5730\u5740\u4e0e\u5bf9\u8c61\u7684 Mark Word\u4ea4\u6362\u3002 </p> <p>3. \u5982\u679c cas \u66ff\u6362\u6210\u529f\uff0c\u90a3\u4e48\u8868\u793a\u8f7b\u91cf\u7ea7\u9501\u52a0\u9501\u6210\u529f\uff0c\u6b64\u65f6\u5bf9\u8c61\u5934\u5b58\u50a8\u4e86 \u9501\u8bb0\u5f55\u5730\u5740\u548c\u72b6\u6001 00 \uff0c\u4e5f\u5c31\u662f\u5bf9\u8c61\u5df2\u7ecf\u5904\u4e8e\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u4e86\u3002  \u6709\u4e24\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4 cas \u5931\u8d25\uff0c \u2460 \u5982\u679c\u5176\u5b83\u7ebf\u7a0b\u5df2\u7ecf\u6301\u6709\u4e86\u8be5 Object \u7684\u8f7b\u91cf\u7ea7\u9501\uff0c\u90a3\u4e48cas\u64cd\u4f5c\u4f1a\u5931\u8d25\uff0c\u56e0\u4e3acas\u671f\u671bMark Word\u7684\u540e\u4e24\u4f4d\u662f01\uff0c\u800c\u6b64\u65f6\u662f00\u5904\u4e8e\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff0c\u5728\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u4e0b\u51fa\u73b0\u9501\u7ade\u4e89\u60c5\u51b5\uff0c\u4f1a\u5bfc\u81f4\u8fdb\u5165\u9501\u81a8\u80c0\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u9700\u8981\u5c06\u7ebf\u7a0b\u52a0\u5165\u5230\u963b\u585e\u961f\u5217\uff0c\u53ea\u6709\u7ba1\u7a0b\u624d\u6709\u8fd9\u4e2a\u529f\u80fd\u3002 \u2461 \u5982\u679c\u8fd8\u662f\u672c\u7ebf\u7a0b\u6267\u884c\u4e86 synchronized \u4e5f\u4f1a\u5bfc\u81f4cas\u64cd\u4f5c\u5931\u8d25\uff0c\u4e0d\u8fc7\u8fd9\u662f\u9501\u91cd\u5165\u73b0\u8c61\uff0c\u4f1a\u518d\u6dfb\u52a0\u4e00\u6761 Lock Record \u4f5c\u4e3a\u91cd\u5165\u7684\u8ba1\u6570 </p> <p>\u8f7b\u91cf\u7ea7\u9501\u7684\u89e3\u9501\u8fc7\u7a0b\uff1a 1. \u5f53\u9000\u51fa synchronized \u4ee3\u7801\u5757\u5373\u89e3\u9501\u65f6\uff0c\u5982\u679c\u6709\u53d6\u503c\u4e3a null \u7684\u9501\u8bb0\u5f55\uff0c\u8868\u793a\u6709\u91cd\u5165\uff0c\u8fd9\u65f6\u5220\u9664\u9501\u8bb0\u5f55\uff0c\u8868\u793a\u91cd\u5165\u8ba1\u6570\u51cf1 2. \u5f53\u9000\u51fa synchronized \u4ee3\u7801\u5757\uff08\u89e3\u9501\u65f6\uff09\u9501\u8bb0\u5f55\u7684\u503c\u4e0d\u4e3a null\uff0c\u8fd9\u65f6\u4f7f\u7528 cas \u5c06 Mark Word \u7684\u503c\u6062\u590d\u7ed9\u5bf9\u8c61\u5934\uff0c\u82e5cas\u64cd\u4f5c\u6210\u529f\uff0c\u5219\u89e3\u9501\u6210\u529f\uff0c\u82e5\u5931\u8d25\uff0c\u8bf4\u660e\u8f7b\u91cf\u7ea7\u9501\u8fdb\u884c\u4e86\u9501\u81a8\u80c0\u5df2\u7ecf\u5347\u7ea7\u4e3a\u91cd\u91cf\u7ea7\u9501\uff0c\u8981\u8fdb\u5165\u91cd\u91cf\u7ea7\u9501\u89e3\u9501\u6d41\u7a0b\u3002 </p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/15-%E9%94%81%E8%86%A8%E8%83%80%E5%92%8C%E8%87%AA%E6%97%8B%E4%BC%98%E5%8C%96/","title":"15-\u9501\u81a8\u80c0\u548c\u81ea\u65cb\u4f18\u5316","text":"<p> \u7ea6 424 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u9501\u81a8\u80c0 Thread-0\u7ebf\u7a0b\u5df2\u7ecf\u6301\u6709\u4e86\u5bf9\u8c61\u7684\u8f7b\u91cf\u7ea7\u9501\uff0c\u90a3\u4e48Thread-1\u7684\u52a0\u9501\u64cd\u4f5c\u4f1a\u5931\u8d25\uff0c\u56e0\u4e3acas\u64cd\u4f5c\u671f\u671bMark Word\u7684\u540e\u4e24\u4f4d\u662f01\uff0c\u800c\u6b64\u65f6\u662f00\u5904\u4e8e\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u3002\u5f53\u5728\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u4e0b\u51fa\u73b0\u9501\u7ade\u4e89\u60c5\u51b5\u65f6\uff0c\u4f1a\u5bfc\u81f4\u8fdb\u5165\u9501\u81a8\u80c0\u8fc7\u7a0b\uff0c\u9501\u81a8\u80c0\u540e\u4f1a\u4e3a\u5bf9\u8c61\u521b\u5efaMonitor\uff0c\u56e0\u4e3a\u9700\u8981\u5c06\u7ebf\u7a0b\u52a0\u5165\u5230\u963b\u585e\u961f\u5217\uff0c\u53ea\u6709\u7ba1\u7a0b\u624d\u6709\u8fd9\u4e2a\u529f\u80fd\u3002</p> <p>1. \u5f53 Thread-1 \u8fdb\u884c\u8f7b\u91cf\u7ea7\u52a0\u9501\u65f6\uff0cThread-0 \u5df2\u7ecf\u5bf9\u8be5\u5bf9\u8c61\u52a0\u4e86\u8f7b\u91cf\u7ea7\u9501 </p> <p>2. \u8fd9\u65f6 Thread-1 \u52a0\u8f7b\u91cf\u7ea7\u9501\u5931\u8d25\uff0c\u8fdb\u5165\u9501\u81a8\u80c0\u6d41\u7a0b\uff0c\u9996\u5148\u4f1a\u4e3a Object \u5bf9\u8c61\u7533\u8bf7 Monitor \uff0c\u8ba9 \u5bf9\u8c61\u7684Mark Word\u6307\u5411Monitor\u5730\u5740\uff0c\u7136\u540e\u81ea\u5df1\u8fdb\u5165 Monitor \u7684 EntryList\u963b\u585e\u961f\u5217\u3002 </p> <p>3. \u5f53 Thread-0 \u9000\u51fa\u540c\u6b65\u5757\u89e3\u9501\u65f6\uff0c\u4f7f\u7528 cas \u5c06\u9501\u8bb0\u5f55\u4e2d\u4fdd\u5b58\u7684Mark Word\u6062\u590d\u7ed9\u5bf9\u8c61\u5934\u7684\u64cd\u4f5c\u4f1a\u5931\u8d25\uff0c\u56e0\u4e3acas\u64cd\u4f5c\u671f\u671b\u5bf9\u8c61\u5934\u7684\u540e\u4e24\u4f4d\u5f0f00\uff0c\u800c\u6b64\u65f6\u662f10\u5904\u4e8e\u91cd\u91cf\u7ea7\u9501\u9501\u5b9a\u72b6\u6001\u3002\u8fd9\u65f6\u4f1a\u8fdb\u5165\u91cd\u91cf\u7ea7\u89e3\u9501\u6d41\u7a0b\uff0c\u5373\u5148\u6309\u7167 Monitor \u5730\u5740\u627e\u5230 Monitor \u5bf9\u8c61\uff0c\u7136\u540e\u8bbe\u7f6e Owner \u4e3a null\uff0c\u63a5\u7740\u5524\u9192 EntryList \u4e2d BLOCKED \u7ebf\u7a0b\u3002</p> <p>*\u81ea\u65cb\u4f18\u5316*\uff1a \u7ade\u4e89\u91cd\u91cf\u7ea7\u9501\u7684\u65f6\u5019\uff0c\u6216\u8005\u662f\u9501\u81a8\u80c0\u540e\uff0c\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u672a\u7ade\u4e89\u5230\u9501\uff0c\u90a3\u4e48JVM\u5e76\u4e0d\u4f1a\u7acb\u5373\u5c06\u8fd9\u4e2a\u7ebf\u7a0b\u52a0\u5165\u5230\u963b\u585e\u961f\u5217\u6302\u8d77\uff0c\u800c\u662f\u5148\u4f1a\u8ba9\u8fd9\u4e2a\u7ebf\u7a0b\u81ea\u65cb\u4e00\u4f1a\uff0c\u4e5f\u5c31\u662f\u8ba9\u8fd9\u4e2a\u7ebf\u7a0b\u53cd\u590d\u518d\u5c1d\u8bd5\u51e0\u6b21\u52a0\u9501\uff0c\u5982\u679c\u6210\u529f\uff0c\u90a3\u4e48\u5c31\u987a\u5229\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u5426\u5219\u5c31\u4f1a\u88ab\u52a0\u5165\u5230\u963b\u585e\u961f\u5217\u6302\u8d77\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/16-%E5%81%8F%E5%90%91%E9%94%81%E5%8F%8A%E9%94%81%E6%B6%88%E9%99%A4/","title":"16-\u504f\u5411\u9501\u53ca\u9501\u6d88\u9664","text":"<p> \u7ea6 462 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>\u504f\u5411\u9501</p> <p>\u8f7b\u91cf\u7ea7\u9501\u5728\u6ca1\u6709\u5176\u5b83\u7ebf\u7a0b\u7ade\u4e89\u65f6\uff0c\u6bcf\u6b21\u91cd\u5165\u4ecd\u7136\u9700\u8981\u6267\u884c CAS \u64cd\u4f5c\uff08\u8fd9\u662f\u4e2a\u4f1a\u5931\u8d25\u7684CAS\u64cd\u4f5c\uff09\uff0c Java 6 \u4e2d\u5f15\u5165\u4e86\u504f\u5411\u9501\u6765\u505a\u8fdb\u4e00\u6b65\u4f18\u5316\u3002 \u5f00\u542f\u4e86\u504f\u5411\u9501\uff08\u9ed8\u8ba4\u5f00\u542f\uff09\uff0c\u90a3\u4e48\u5bf9\u8c61\u521b\u5efa\u540e\uff0cmarkword \u503c\u4e3a 0x05 \u5373\u6700\u540e 3 \u4f4d\u4e3a 101\uff0c\u8fd9\u65f6\u5b83\u7684thread\u3001epoch\u3001age \u90fd\u4e3a 0\u3002\u504f\u5411\u9501\u662f\u9ed8\u8ba4\u662f\u5ef6\u8fdf\u7684\uff0c\u4e0d\u4f1a\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u7acb\u5373\u751f\u6548\uff0c\u5982\u679c\u60f3\u907f\u514d\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u52a0 VM \u53c2\u6570 -XX:BiasedLockingStartupDelay=0 \u6765\u7981\u7528\u5ef6\u8fdf\u3002 \u5982\u679c\u4f7f\u7528\u4e86hashCode()\u65b9\u6cd5\uff0c\u90a3\u4e48\u5bf9\u8c61\u5934\u7684\u72b6\u6001\u4f1a\u7acb\u9a6c\u53d8\u6210Normal\u6b63\u5e38\u72b6\u6001\uff0c\u7136\u540e\u5c06hashcode\u586b\u5165Mark Word\u4e2d\uff0c\u4ee5\u540e\u52a0\u9501\u5c31\u4e0e\u504f\u5411\u9501\u65e0\u5173\u4e86\uff0c\u8d77\u6b65\u5c31\u662f\u8f7b\u91cf\u7ea7\u9501\u3002</p> <p>\u5982\u679c\u504f\u5411\u9501\u53ef\u7528\uff0c\u90a3\u4e48\u504f\u5411\u9501\u7684\u52a0\u9501\u8fc7\u7a0b\u662f\uff0c\u7ebf\u7a0b\u7b2c\u4e00\u6b21synchronized\u7ed9\u5bf9\u8c61\u52a0\u9501\u65f6\uff0c\u4f1a\u4f7f\u7528 CAS \u5c06\u7ebf\u7a0b ID \u8bbe\u7f6e\u5230\u5bf9\u8c61\u7684 Mark Word \u5934\uff0c\u5728\u6ca1\u6709\u5176\u5b83\u7ebf\u7a0b\u63d2\u624b\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u7ebf\u7a0b\u89e3\u9501\u524d\uff0c\u5bf9\u6b64\u5bf9\u8c61\u7684synchronized\u64cd\u4f5c\u90fd\u5c06\u53ea\u9700\u8981\u68c0\u67e5Mark Word\u4e2d\u7684\u7ebf\u7a0bID\u662f\u4e0d\u662f\u548c\u81ea\u5df1\u7684\u76f8\u540c\uff0c\u76f8\u6bd4\u4e8e\u8f7b\u91cf\u7ea7\u9501\u786e\u5b9e\u5feb\u4e86\u4e0d\u5c11\u3002\u5982\u679c\u51fa\u73b0\u9501\u7ade\u4e89\uff0c\u90a3\u4e48\u7acb\u5373\u9501\u81a8\u80c0\u5347\u7ea7\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002 \u6709\u4e00\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4\u504f\u5411\u9501\u5347\u7ea7\u4e3a\u8f7b\u91cf\u7ea7\u9501\uff0c\u90a3\u5c31\u662f\u5728\u504f\u5411\u9501\u89e3\u9501\u540e\uff0c\u53c8\u6709\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u7ed9\u8fd9\u4e2a\u5bf9\u8c61\u52a0\u9501\u4e86\uff0c\u8fd9\u4e0d\u662f\u540c\u4e00\u65f6\u95f4\u6bb5\u7684\u7ade\u4e89\u5173\u7cfb\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bfc\u81f4\u5347\u7ea7\u4e3a\u91cd\u91cf\u7ea7\u9501\uff0c\u4f46\u662f\u4f1a\u5bfc\u81f4\u540e\u52a0\u9501\u7684\u7ebf\u7a0b\u52a0\u7684\u9501\u53d8\u6210\u8f7b\u91cf\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u504f\u5411\u9501\u3002</p> <p>\u9501\u5347\u7ea7\uff1a https://blog.csdn.net/DBC_121/article/details/105453101</p> <p>\u9501\u6d88\u9664\uff1a\u9501\u6d88\u9664\u7684\u610f\u601d\u662f\uff0cJVM\u7684\u5373\u65f6\u7f16\u8bd1\u5668\u4f1a\u628a\u67d0\u4e9b\u65e0\u610f\u4e49\u7684\u52a0\u9501\u64cd\u4f5c\u76f4\u63a5\u4f18\u5316\u6389\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/17-volatile/","title":"17-volatile","text":"<p> \u7ea6 1098 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 22 \u5206\u949f</p> <p>volatile\u662fJava\u865a\u62df\u673a\u63d0\u4f9b\u7684\u8f7b\u91cf\u7ea7\u7684\u540c\u6b65\u673a\u5236\uff0c\u5b83\u7684\u4e09\u4e2a\u7279\u70b9\u662f\uff1a</p> <ul> <li>\u4fdd\u8bc1\u53ef\u89c1\u6027</li> <li>\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027</li> <li>\u7981\u6b62\u6307\u4ee4\u91cd\u6392</li> </ul> <p>\u53ef\u89c1\u6027 volatile\u4fdd\u8bc1\u53ef\u89c1\u6027\u7684\u610f\u601d\u662f\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u6267\u884cgetfield\u3001getstatic\u7b49\u8bfb\u64cd\u4f5c\u5b57\u8282\u7801\u6307\u4ee4\u65f6\uff0c\u4e00\u5b9a\u62ff\u5230\u7684\u662f\u4e3b\u5185\u5b58\u4e2d\u7684\u6700\u65b0\u7ed3\u679c\u3002\uff08\u53ef\u4ee5\u8fd9\u6837\u8ba4\u4e3a\u52a0\u4e86volatile\u7684\u53d8\u91cf\uff0c\u7ebf\u7a0b\u53ea\u80fd\u4ece\u4e3b\u5185\u5b58\u4e2d\u83b7\u53d6\u5b83\u7684\u503c\uff09</p> <p>\u53ef\u89c1\u6027\u4ee3\u7801\u9a8c\u8bc1\uff1a \u4ee5\u4e0b\u4ee3\u7801\u9a8c\u8bc1\u4e86volatile\u7684\u53ef\u89c1\u6027\uff0c\u5728\u6ca1\u52a0volatile\u4e4b\u524d\uff0c\u4e3b\u7ebf\u7a0b\u4e0d\u80fd\u53ca\u65f6\u53d1\u73b0\u4e3b\u5185\u5b58\u4e2d\u5df2\u7ecf\u4fee\u6539\u4e86\u7684number\uff0c\u8fd9\u662f\u5373\u65f6\u7f16\u8bd1\u5668\u7684\u4f18\u5316\uff0c\u5373\u65f6\u7f16\u8bd1\u5668\u5c06\u5b57\u8282\u7801\u7f16\u8bd1\u6210\u672c\u5730\u673a\u5668\u6307\u4ee4\u540e\uff0c\u53ea\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6number\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u4e00\u76f4\u4f7f\u7528\u7684\u662f\u5de5\u4f5c\u5185\u5b58\u91cc\u6700\u5f00\u59cb\u65f6\u8bfb\u5230\u7684number\uff0c\u6240\u4ee5\u4e00\u76f4\u6b7b\u5faa\u73af\uff1b\u52a0\u4e86volatile\u4e4b\u540e\uff0c\u7ebf\u7a0bt\u4e00\u65e6\u5c06\u4fee\u6539\u8fc7\u540e\u7684number\u5199\u56de\u4e3b\u5185\u5b58\u4e4b\u540e\uff0c\u5c31\u4f1a\u5f3a\u5236\u5237\u65b0\u5176\u5b83\u7ebf\u7a0b\u5de5\u4f5c\u5185\u5b58\u91cc\u7684number\u503c\uff0c\u6240\u4ee5\u8fd9\u65f6\u4e3b\u7ebf\u7a0b\u80fd\u53ca\u65f6\u53d1\u73b0number\u5df2\u7ecf\u6539\u53d8\uff0c\u4ece\u800c\u8df3\u51fa\u6b7b\u5faa\u73af\u3002 Text Only<pre><code>class MyData {\n\n\u00a0\u00a0\u00a0\u00a0`volatile` int number = 0;\n\n\u00a0\u00a0\u00a0\u00a0public void addTo60() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.number = 60;\n\u00a0\u00a0\u00a0\u00a0}\n}\n/**\n* \u9a8c\u8bc1volatile\u7684\u53ef\u89c1\u6027\n*/\npublic class VolatileDemo {\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String args []) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8d44\u6e90\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MyData myData = new MyData();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t come in\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4fdd\u8bc1\u4e3b\u7ebf\u7a0b\u7684while\u5faa\u73af\u5148\u8bfb\u5230\u4e86number\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n `// \u4e3b\u7ebf\u7a0b\u7684while\u5faa\u73af\u5148\u8bfb\u5230\u4e86number\u7684\u503c\u540e\uff0c\u6b64\u7ebf\u7a0b\u518d\u4fee\u6539number\u7684\u503c\uff0c`\n `// \u5982\u679c\u6ca1\u6709\u52a0volatile\uff0c\u90a3\u4e48\u4e3b\u7ebf\u7a0b\u5c31\u65e0\u6cd5\u53ca\u65f6\u83b7\u53d6\u5230\u4fee\u6539\u540e\u7684number\u503c`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0myData.addTo60();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8f93\u51fa\u4fee\u6539\u540e\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t update number value:\" + myData.number);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, \"t\").start();\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while(myData.number == 0);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t mission is over\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u539f\u5b50\u6027 \u53ef\u89c1\u6027 vs \u539f\u5b50\u6027 \u4e0a\u9762\u7684\u4f8b\u5b50\u4f53\u73b0\u7684\u5b9e\u9645\u5c31\u662f\u53ef\u89c1\u6027\uff0c\u5b83\u4fdd\u8bc1\u7684\u662f\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5bf9 volatile \u53d8\u91cf\u7684\u4fee\u6539\u5bf9\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u89c1\uff0c\u4f46volatile\u4e0d\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u4ec5\u9002\u7528\u4e8e\u4e00\u4e2a\u5199\u7ebf\u7a0b\uff0c\u591a\u4e2a\u8bfb\u7ebf\u7a0b\u7684\u60c5\u51b5\uff0c \u4e0a\u4f8b\u4ece\u5b57\u8282\u7801\u7406\u89e3\u662f\u8fd9\u6837\u7684\uff1a </p> <p>\u5bf9\u4e8e\u4e24\u4e2a\u5199\u7ebf\u7a0b\uff0c\u53ea\u80fd\u4fdd\u8bc1\u53ef\u89c1\u6027\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u6bd4\u5982\u4e00\u4e2a\u7ebf\u7a0b\u505ai++\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u505ai--\uff0c\u5b57\u8282\u7801\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\u53ef\u80fd\u662f\u8fd9\u6837\u7684\uff1a  \u4e24\u4e2a\u7ebf\u7a0b\u7684getstatic\u64cd\u4f5c\u5747\u662f\u4ece\u4e3b\u5185\u5b58\u4e2d\u83b7\u53d6\u6700\u65b0\u7684\u503c\uff0c\u8fd9\u662fvolatile\u6240\u4fdd\u8bc1\u7684\uff0c\u4f46\u662f\u7531\u4e8ei++\u548ci--\u4e0d\u662f\u539f\u5b50\u64cd\u4f5c\uff0c\u6240\u4ee5\u6700\u7ec8\u7ed3\u679c\u4e0d\u6b63\u786e\u3002</p> <p>\u6709\u5e8f\u6027 \u4e3a\u4e86\u63d0\u5347CPU\u6307\u4ee4\u6d41\u6c34\u7ebf\u7684\u6548\u7387\uff0cJVM\u7684\u5373\u65f6\u7f16\u8bd1\u5668\u6216\u8005\u662fCPU\u90fd\u53ef\u80fd\u4f1a\u5728\u4e0d\u5f71\u54cd\u7a0b\u5e8f\u987a\u5e8f\u6267\u884c\u7ed3\u679c\u7684\u524d\u63d0\u4e0b\uff0c\u5bf9\u6307\u4ee4\u8fdb\u884c\u91cd\u6392\u5e8f\uff0c\u8fd9\u5728\u5355\u7ebf\u7a0b\u7684\u73af\u5883\u4e0b\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u56e0\u4e3a\u91cd\u6392\u5e8f\u4e0d\u4f1a\u5f71\u54cd\u7a0b\u5e8f\u7684\u987a\u5e8f\u6267\u884c\u7684\u7ed3\u679c\uff0c\u4f46\u8fd9\u5728\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u5c31\u4f1a\u6709\u95ee\u9898\u3002\u6307\u4ee4\u91cd\u6392\u4e0d\u662f\u51fa\u73b0\u5728\u5b57\u8282\u7801\u4e2d\uff0c\u800c\u662f\u8fd0\u884c\u65f6JVM\u6216CPU\u5bf9\u6307\u4ee4\u6267\u884c\u987a\u5e8f\u7684\u4e00\u79cd\u6539\u53d8\u3002</p> <p>\u5178\u578b\u4f8b\u5b50\u5982\u4e0b\uff1a\u5982\u679cactor2()\u65b9\u6cd5\u5185\u7684\u4e24\u6761\u8bed\u53e5\u6ca1\u6709\u8fdb\u884c\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c\u90a3\u4e48\u5728\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u4e0b\uff0cactor1()\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u53ef\u80fd\u662f1\u6216\u8005\u662f4\uff1b\u4f46\u5982\u679c\u5bf9actor2()\u65b9\u6cd5\u5185\u7684\u4e24\u6761\u8bed\u53e5\u8fdb\u884c\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c\u4e5f\u5c31\u662f\u5148ready = true\u518dnum = 2\uff0c\u663e\u7136\u8fd9\u5bf9actor2()\u65b9\u6cd5\u987a\u5e8f\u6267\u884c\u7684\u7ed3\u679c\u5e76\u6ca1\u6709\u5f71\u54cd\uff0c\u4f46\u5728\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u4e0b\uff0cactor1()\u65b9\u6cd5\u7684\u8fd4\u56de\u7684\u7ed3\u679c\u5c31\u6709\u53ef\u80fd\u662f0\u4e86\u3002 Text Only<pre><code>int num = 0;\nboolean ready = false;\n//\u7ebf\u7a0b1 \u6267\u884c\u6b64\u65b9\u6cd5\npublic int actor1(int r) {\n\u00a0\u00a0 \u00a0if(ready) {\n\u00a0\u00a0\u00a0\u00a0 \u00a0 \u00a0r = num + num;\n\u00a0\u00a0 \u00a0} else {\n\u00a0\u00a0\u00a0\u00a0 \u00a0 \u00a0r = 1;\n\u00a0\u00a0 \u00a0}\n\u00a0\u00a0 \u00a0return r\n}\n// \u7ebf\u7a0b2 \u6267\u884c\u6b64\u65b9\u6cd5\npublic void actor2() {\n\u00a0\u00a0 \u00a0num = 2;\n\u00a0\u00a0 \u00a0ready = true;\n}\n</code></pre></p> <p>volatile\u53ef\u4ee5\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c volatile \u7684\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\u662f\u5185\u5b58\u5c4f\u969c</p> <ul> <li>\u5bf9 volatile \u53d8\u91cf\u7684\u5199\u6307\u4ee4\u540e\u4f1a\u52a0\u5165\u5199\u5c4f\u969c</li> <li>\u5bf9 volatile \u53d8\u91cf\u7684\u8bfb\u6307\u4ee4\u524d\u4f1a\u52a0\u5165\u8bfb\u5c4f\u969c</li> </ul> <p>\u5199\u5c4f\u969c\uff1a \u00a0 \u00a0 \u2460\u00a0\u4fdd\u8bc1\u53ef\u89c1\u6027\uff1a\u5199\u5c4f\u969c\u4e4b\u524d\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u6539\u52a8\uff0c\u90fd\u540c\u6b65\u5230\u4e3b\u5b58\u5f53\u4e2d \u00a0 \u00a0 \u2461 \u4fdd\u8bc1\u6709\u5e8f\u6027\uff1a\u4e0d\u4f1a\u5c06\u5199\u5c4f\u969c\u4e4b\u524d\u7684\u4ee3\u7801\u6392\u5728\u5199\u5c4f\u969c\u4e4b\u540e \u8bfb\u5c4f\u969c\uff1a \u00a0 \u00a0 \u2460\u00a0\u4fdd\u8bc1\u53ef\u89c1\u6027\uff1a \u5c4f\u969c\u4e4b\u540e\u5bf9\u5171\u4eab\u53d8\u91cf\u7684\u8bfb\u53d6\uff0c\u52a0\u8f7d\u7684\u662f\u4e3b\u5b58\u4e2d\u6700\u65b0\u6570\u636e \u00a0 \u00a0 \u2461 \u4fdd\u8bc1\u6709\u5e8f\u6027\uff1a \u4e0d\u4f1a\u5c06\u8bfb\u5c4f\u969c\u4e4b\u540e\u7684\u4ee3\u7801\u6392\u5728\u8bfb\u5c4f\u969c\u4e4b\u524d</p> <p></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/18-DCL%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","title":"18-DCL\u5355\u4f8b\u6a21\u5f0f","text":"<p> \u7ea6 420 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>\u5355\u7ebf\u7a0b\u4e0b\u7684\u5355\u4f8b\u6a21\u5f0f\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u4f1a\u51fa\u9519\uff0c\u793a\u4f8b\uff1a Text Only<pre><code>public class Singleton {\n\n\u00a0\u00a0\u00a0\u00a0private static Singleton instance = null;\n\n\u00a0\u00a0\u00a0\u00a0private Singleton () {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t \u6211\u662f\u6784\u9020\u65b9\u6cd5SingletonDemo\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static Singleton getInstance() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(instance == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0instance = new Singleton();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return instance;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0 \u00a0 public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Singleton.getInstance();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, String.valueOf(i)).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>DCL\uff0cDouble Check Lock \u53cc\u91cd\u68c0\u67e5\u9501\u5f62\u5f0f\u7684\u5355\u4f8b\u6a21\u5f0f\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u4e0e\u76f4\u63a5\u5728\u65b9\u6cd5\u4e0a\u52a0synchronized\u7684\u533a\u522b\u662f\uff0c\u76f4\u63a5\u5728\u65b9\u6cd5\u4e0a\u52a0synchronized\u4f1a\u8ba9\u6240\u6709\u7ebf\u7a0b\u8c03\u7528getInstance()\u65b9\u6cd5\u90fd\u52a0\u9501\uff0c\u800c\u53cc\u91cd\u68c0\u67e5\u5219\u53ea\u4f1a\u8ba9\u90e8\u5206\u901a\u8fc7\u7b2c\u4e00\u4e2aif\u68c0\u67e5\u7684\u7ebf\u7a0b\u52a0\u9501\uff0c\u5f53\u8fd9\u90e8\u5206\u4e2d\u7684\u67d0\u4e2a\u7ebf\u7a0b\u521b\u5efa\u5b8c\u5b9e\u4f8b\u4e4b\u540e\uff0c\u5269\u4f59\u90e8\u5206\u7684\u7ebf\u7a0b\u5c31\u4e0d\u80fd\u901a\u8fc7\u7b2c\u4e00if\u7684\u68c0\u67e5\u4e86\uff0c\u4ece\u800c\u4e0d\u5fc5\u518d\u52a0\u9501\u3002</p> Text Only<pre><code>public class Singleton {\n\n\u00a0\u00a0\u00a0\u00a0private static\u00a0`volatile` Singleton instance = null;\n\n\u00a0\u00a0\u00a0\u00a0private Singleton() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\\t \u6211\u662f\u6784\u9020\u65b9\u6cd5SingletonDemo\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static Singleton getInstance() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (instance == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (Singleton.class) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (instance == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0instance = new Singleton();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return instance;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p><code>\u8bb0\u5f97\u8fd8\u8981\u5728\u53d8\u91cf\u4e0a\u52a0volatile</code>\uff0c\u56e0\u4e3ainstance = new Singleton();\u8fd9\u6761\u8bed\u53e5\u7f16\u8bd1\u540e\u4f1a\u4ea7\u751f\u591a\u6761\u5b57\u8282\u7801\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5982\u679c\u6ca1\u52a0volatile\uff0c\u90a3\u4e4821\u884c\u548c24\u884c\u53ef\u80fd\u4f1a\u88ab\u91cd\u6392\u5e8f\uff0c\u4e5f\u5c31\u662f\u5148\u7ed9instance\u8d4b\u503c\uff0c\u7136\u540e\u518d\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u521d\u59cb\u5316\u5bf9\u8c61\uff0c\u5f53\u7ed9instance\u8d4b\u503c\u540e\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u7b2c\u4e00\u4e2aif\u5224\u65ad\u7ed3\u679c\u4e0d\u4e3anull\uff0c\u7136\u540e\u8fd4\u56deinstance\uff0c\u6700\u540e\u88ab\u4f7f\u7528\u7684instance\u5c31\u662f\u8fd8\u6ca1\u88ab\u521d\u59cb\u5316\u7684\u5bf9\u8c61\uff0c\u4e8e\u662f\u51fa\u73b0\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\u73b0\u8c61\uff1b\u5982\u679c\u52a0\u4e0avolatile\uff0c\u5c06\u7981\u6b62\u8fd9\u591a\u6761\u5b57\u8282\u7801\u6307\u4ee4\u91cd\u6392\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u5148\u8d4b\u503c\u540e\u521d\u59cb\u5316\u7684\u73b0\u8c61\u4e86\uff0c\u53ea\u80fd\u662f\u5148\u521d\u59cb\u5316\u540e\u8d4b\u503c\u3002</p> <p></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/19-CAS%E5%8F%8A%E8%87%AA%E6%97%8B%E9%94%81/","title":"19-CAS\u53ca\u81ea\u65cb\u9501","text":"<p> \u7ea6 1121 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 22 \u5206\u949f</p> <p>CAS\uff1aCompare And Set \u6bd4\u8f83\u5e76\u66f4\u65b0 \u6216\u8005 Compare And Swap \u6bd4\u8f83\u5e76\u4ea4\u6362 CAS\u662f\u5e76\u53d1\u73af\u5883\u4e0b\u66f4\u65b0\u53d8\u91cf\u7684\u4e00\u79cd\u6280\u672f\uff0c\u5b83\u7684\u66f4\u65b0\u8fc7\u7a0b\u662f\uff1a\u6301\u6709\u4e00\u4e2a\u53d8\u91cf\u7684\u9884\u671f\u503c\u548c\u65b0\u503c\uff0c\u66f4\u65b0\u65f6\u5148\u68c0\u67e5\u53d8\u91cf\u7684\u503c\u662f\u5426\u4e0e\u9884\u671f\u503c\u76f8\u540c\uff0c\u5982\u679c\u76f8\u540c\u5219\u66f4\u65b0\u4e3a\u65b0\u503c\uff0c\u8fd4\u56detrue\uff0c\u8868\u793a\u66f4\u65b0\u6210\u529f\uff1b\u5982\u679c\u4e0d\u540c\u5219\u8fd4\u56defalse\uff0c\u8868\u793a\u66f4\u65b0\u5931\u8d25\u3002\u8fd9\u662f\u4e50\u89c2\u9501\u7684\u601d\u60f3\uff0c\u73b0\u4ee3\u5904\u7406\u5668\u57fa\u672c\u4e0a\u90fd\u652f\u6301CAS\u539f\u5b50\u6307\u4ee4\u3002</p> <p>\u4e3a\u4e86\u80fd\u5728Java\u4e2d\u4e5f\u53ef\u4ee5\u4f7f\u7528CAS\u64cd\u4f5c\uff0cJDK\u63d0\u4f9b\u4e86Unsafe\u7c7b\uff0cUnsafe\u7c7b\u6709\u4e00\u7cfb\u5217\u7684compareAndSet\u65b9\u6cd5\uff0c\u6bcf\u4e2anative\u7684 compareAndSet\u65b9\u6cd5\u90fd\u662f\u4e00\u4e2a\u539f\u5b50\u7684CAS\u64cd\u4f5c\uff0c\u7528\u4e8e\u66f4\u65b0\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u8be5\u53d8\u91cf\u5fc5\u987b\u88ab\u58f0\u660e\u4e3avolatile\uff0c\u4e0d\u7136\u66f4\u65b0\u7ed3\u679c\u53ef\u80fd\u5bf9\u5176\u5b83\u7ebf\u7a0b\u4e0d\u53ef\u89c1\uff0c\u4e5f\u5c31\u662f\u5728Java\u4e2d\u4f7f\u7528CAS\u64cd\u4f5c\u5fc5\u987b\u914d\u5408volatile\u5173\u952e\u5b57\uff0c\u6bd4\u5982AtomicInteger\u7b49\u7c7b\u7684\u6210\u5458\u53d8\u91cf\u90fd\u662f\u88ab\u58f0\u660e\u4e3avolatile\uff08AtomicInteger\u662f\u4f7f\u7528Unsafe\u7c7b\u63d0\u4f9b\u7684CAS\u64cd\u4f5c\u5b9e\u73b0\u7684\u4e00\u4e2a\u539f\u5b50\u7c7b\uff0c\u5b9e\u73b0\u4e86\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5bf9\u6574\u6570\u7684\u539f\u5b50\u64cd\u4f5c\uff09\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u66f4\u65b0int\u53d8\u91cf\u7684compareAndSetInt\u65b9\u6cd5\uff0c\u5b83\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570Object o\u662f\u8981\u66f4\u65b0\u7684\u5b57\u6bb5\u6240\u5728\u5bf9\u8c61\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570long offset\u662f\u5b57\u6bb5\u5728\u5bf9\u8c61\u4e2d\u7684\u76f8\u5bf9\u504f\u79fb\u5730\u5740\uff0c\u76f8\u5f53\u4e8ec\u7684\u6307\u9488\uff1b\u7b2c\u4e09\u4e2a\u53c2\u6570\u662fexpected\u53d8\u91cf\u9884\u671f\u503c\uff1b\u7b2c\u56db\u4e2a\u53c2\u6570x\u662f\u60f3\u4fee\u6539\u6210\u7684\u65b0\u503c\u3002\u6240\u4ee5\u5b83\u7684\u66f4\u65b0\u8fc7\u7a0b\u662f\uff0c\u9996\u5148\u68c0\u67e5\u5185\u5b58\u4e2d\u53d8\u91cf\u7684\u503c\u662f\u5426\u4e0eexpected\u76f8\u7b49\uff0c\u5982\u679c\u76f8\u7b49\u5219\u8bbe\u7f6e\u4e3a\u65b0\u503cx\u5e76\u8fd4\u56detrue\uff0c\u5426\u5219\u76f4\u63a5\u8fd4\u56defalse\uff1b Unsafe\u7c7b\u7684\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u662fnative\u65b9\u6cd5\uff0cJDK\u5e76\u4e0d\u60f3\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\uff0c\u800c\u662f\u4f7f\u7528\u4e00\u4e9b\u66f4\u4e0a\u5c42\u7684\u7c7b\uff0c\u6bd4\u5982AtomicInteger\u7b49\u3002 </p> <p>AtomicInteger\u4f7f\u7528Unsafe\u63d0\u4f9b\u7684CAS\u64cd\u4f5c\u5b9e\u73b0\u4e86\u4e00\u7cfb\u5217\u597d\u7528\u7684\u7ebf\u7a0b\u5b89\u5168\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982\uff0cAtomicInteger\u7c7b\u7684getAndIncrement()\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u81ea\u589e\u52a01\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u8c03\u7528\u4e86Unsafe\u7684getAndAddInt()\u65b9\u6cd5\uff0c\u5982\u4e0b\uff0cgetAndAddInt()\u65b9\u6cd5\u7684\u6267\u884c\u8fc7\u7a0b\u662f\uff1a\u9996\u5148\u8bfb\u53d6\u5185\u5b58\u4e2d\u53d8\u91cf\u7684\u6700\u65b0\u503c\uff0c\u7136\u540e\u5728\u6b64\u503c\u7684\u57fa\u7840\u4e0a\u52a0delta\uff0c\u518d\u8c03\u7528weakCompareAndSetInt\u65b9\u6cd5\u6bd4\u8f83\u5e76\u66f4\u65b0\uff0c\u5982\u679c\u8fd4\u56defalse\uff0c\u8868\u793a\u66f4\u65b0\u5931\u8d25\uff0c\u91cd\u65b0\u8bfb\u53d6\u53d8\u91cf\u7684\u6700\u65b0\u503c\uff0c\u7136\u540e\u5728\u6b64\u503c\u7684\u57fa\u7840\u4e0a\u52a0delta\uff0c\u518d\u5c1d\u8bd5\u6bd4\u8f83\u5e76\u66f4\u65b0\uff0c\u5982\u6b64\u4e00\u76f4\u5faa\u73af\u4e0b\u53bb\uff0c\u76f4\u5230\u66f4\u65b0\u6210\u529f\u8fd4\u56detrue\u3002 \u8bfb\u5230\u6700\u65b0\u7684\u503c\u540e\uff0c\u5c31\u5230\u4e00\u8fb9\u505a\u8fd0\u7b97\uff0c\u8fd9\u4e2a\u8fd0\u7b97\u4e0d\u662f\u539f\u5b50\u7684\uff0c\u53ef\u80fd\u5f88\u8017\u65f6\uff0c\u8fd0\u7b97\u5b8c\u540e\u62ff\u7740\u7ed3\u679c\u5c1d\u8bd5\u6bd4\u8f83\u5e76\u66f4\u65b0\uff0c\u6bd4\u8f83\u5e76\u66f4\u65b0\u7684\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u539f\u5b50\u7684\uff0c\u5982\u679c\u66f4\u65b0\u5931\u8d25\uff0c\u8868\u793a\u5728\u6211\u8ba1\u7b97\u671f\u95f4\u6709\u4eba\u505a\u4e86\u66f4\u65b0\uff0c\u6211\u8fd9\u6b21\u7684\u8ba1\u7b97\u7ed3\u679c\u5df2\u7ecf\u6ca1\u6709\u7528\u4e86\uff0c\u53ea\u80fd\u518d\u6b21\u8bfb\u53d6\u6700\u65b0\u503c\u540e\u91cd\u65b0\u8ba1\u7b97\uff0c\u76f4\u5230\u8fd9\u4e2a\u66f4\u65b0\u6210\u529f\u3002\u5178\u578b\u7684\u4e50\u89c2\u9501\u3002</p> <p>AtomicInteger\u7c7b\u7684getAndIncrement()\u65b9\u6cd5\uff1a  Unsafe\u7684getAndAddInt()\u65b9\u6cd5\uff1a </p> <p>CAS\u5b9e\u73b0\u81ea\u65cb\u9501\uff1a</p> Text Only<pre><code>public class SpinLock {\n\n\u00a0 \u00a0//\u539f\u5b50\u5f15\u7528\u7ebf\u7a0b\n\u00a0 \u00a0AtomicReference&lt;`Thread`&gt; atomicReference = new AtomicReference&lt;&gt;();\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u52a0\u9501\n\u00a0 \u00a0 */\n\u00a0 \u00a0public void myLock() {\n\u00a0 \u00a0 \u00a0 \u00a0`// \u52a0\u9501\u64cd\u4f5c\uff0c\u5982\u679c\u662fnull\uff0c\u5219\u66f4\u65b0\u4e3a\u5f53\u524d\u7ebf\u7a0b\uff0c\u5426\u8005\u81ea\u65cb`\n `while(!atomicReference.compareAndSet(null, Thread.currentThread()));`\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(Thread.currentThread().getName() + \"\u52a0\u9501\u6210\u529f\");\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u89e3\u9501\n\u00a0 \u00a0 */\n\u00a0 \u00a0public void myUnLock() {\n\u00a0 \u00a0 \u00a0 \u00a0`// \u89e3\u9501\u64cd\u4f5c`\n `atomicReference.compareAndSet(Thread.currentThread(), null);`\n\u00a0 \u00a0}\n\n\u00a0 \u00a0public static void main(String[] args) {\n\n\u00a0 \u00a0 \u00a0 \u00a0SpinLock spinLock = new SpinLock();\n\n\u00a0 \u00a0 \u00a0 \u00a0// \u542f\u52a8t1\u7ebf\u7a0b\uff0c\u5f00\u59cb\u64cd\u4f5c\n\u00a0 \u00a0 \u00a0 \u00a0new Thread(() -&gt; {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0// \u5f00\u59cb\u5360\u6709\u9501\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0spinLock.myLock();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0try {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0TimeUnit.SECONDS.sleep(5);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0} catch (InterruptedException e) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0e.printStackTrace();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0// \u5f00\u59cb\u91ca\u653e\u9501\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0spinLock.myUnLock();\n\u00a0 \u00a0 \u00a0 \u00a0}, \"t1\").start();\n\n\u00a0 \u00a0 \u00a0 \u00a0// \u8ba9main\u7ebf\u7a0b\u6682\u505c1\u79d2\uff0c\u4f7f\u5f97t1\u7ebf\u7a0b\uff0c\u5148\u6267\u884c\n\u00a0 \u00a0 \u00a0 \u00a0try {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0 \u00a0 \u00a0 \u00a0} catch (InterruptedException e) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0e.printStackTrace();\n\u00a0 \u00a0 \u00a0 \u00a0}\n\n\u00a0 \u00a0 \u00a0 \u00a0// 1\u79d2\u540e\uff0c\u542f\u52a8t2\u7ebf\u7a0b\uff0c\u5f00\u59cb\u5360\u7528\u8fd9\u4e2a\u9501\n\u00a0 \u00a0 \u00a0 \u00a0new Thread(() -&gt; {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0// \u5f00\u59cb\u5360\u6709\u9501\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0spinLock.myLock();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0// \u5f00\u59cb\u91ca\u653e\u9501\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0spinLock.myUnLock();\n\u00a0 \u00a0 \u00a0 \u00a0}, \"t2\").start();\n\u00a0 \u00a0}\n}\n</code></pre> <p>\u6216\u8005\u4f7f\u7528AtomicInteger\u7c7b\uff1a Text Only<pre><code>public class LockCas {\n\u00a0 \u00a0private AtomicInteger state = new AtomicInteger(0);\n\n\u00a0 \u00a0public void lock() {\n\u00a0 \u00a0 \u00a0 \u00a0`// \u52a0\u9501\u64cd\u4f5c`\n `while (!state.compareAndSet(0, 1));`\n\u00a0 \u00a0}\n\n\u00a0 \u00a0public void unlock() {\n\u00a0 \u00a0 \u00a0 \u00a0`// \u89e3\u9501\u64cd\u4f5c`\n `state.set(0);`\n\u00a0 \u00a0}\n}\n</code></pre></p> <p>\u4ece\u4ee5\u4e0a\u57fa\u4e8eCAS\u64cd\u4f5c\u5b9e\u73b0\u53d8\u91cf\u503c\u52a01\u548c\u81ea\u65cb\u9501\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u4e00\u79cd\u65e0\u9501\u5b9e\u73b0\uff0c\u5b83\u5e76\u4e0d\u9700\u8981\u50cfsychronized\u548c\u53ef\u91cd\u5165\u9501\u8fd9\u79cd\u60b2\u89c2\u9501\u90a3\u6837\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u6709\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u4e00\u822c\u800c\u8a00\u8fd9\u79cd\u65e0\u9501\u7684\u5b9e\u73b0\u53ef\u80fd\u6548\u7387\u66f4\u9ad8\uff0c\u4f46\u662f\u4e00\u76f4\u5faa\u73af\u91cd\u8bd5\u4e5f\u4f1a\u6027\u80fd\u4e0a\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u5e76\u4e0d\u89c1\u5f97\u4e00\u5b9a\u6bd4\u60b2\u89c2\u9501\u6548\u7387\u66f4\u9ad8\uff0c\u5982\u679c\u5728\u5355\u6838CPU\u4e0b\uff0c\u8fd9\u79cd\u65e0\u9501\u73b0\u5b9e\u7ebf\u7a0b\u5b89\u5168\u7684\u65b9\u5f0f\u5c31\u6ca1\u610f\u4e49\u4e86\uff0c\u56e0\u4e3a\u4e0d\u4f46\u4f1a\u5207\u6362\u7ebf\u7a0b\uff0c\u800c\u4e14\u8fd8\u4f1a\u5faa\u73af\u91cd\u8bd5\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/20-Unsafe%E7%B1%BB/","title":"20-Unsafe\u7c7b","text":"<p> \u7ea6 417 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>Unsafe\u63d0\u4f9b\u7684API\u5927\u81f4\u53ef\u5206\u4e3a<code>\u5185\u5b58\u64cd\u4f5c</code>\u3001<code>CAS</code>\u3001Class\u76f8\u5173\u3001\u5bf9\u8c61\u64cd\u4f5c\u3001<code>\u7ebf\u7a0b\u8c03\u5ea6</code>\u3001\u7cfb\u7edf\u4fe1\u606f\u83b7\u53d6\u3001\u5185\u5b58\u5c4f\u969c\u3001\u6570\u7ec4\u64cd\u4f5c\u7b49\u51e0\u7c7b\u3002 </p> <p>Unsafe\u7c7b\u5bf9\u8c61\u7684\u83b7\u53d6 \u4eceUnsafe\u7c7b\u7684\u6784\u9020\u5668\u53ef\u4ee5\u770b\u51faUnsafe\u7c7b\u662f\u5355\u4f8b\u7684\uff0c\u4f46\u662f\u5b83\u63d0\u4f9b\u7684\u9759\u6001getUnsafe()\u65b9\u6cd5\u4f1a\u5224\u65ad\u8c03\u7528getUnsafe()\u7684\u65b9\u6cd5\u6240\u5904\u7684\u7c7b\u662f\u5426\u662f\u7531\u5f15\u5bfc\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\uff0c\u5982\u679c\u4e0d\u662f\u5c31\u629b\u51fa\u5f02\u5e38\uff0c\u6240\u4ee5JDK\u5e76\u4e0d\u5e0c\u671b\u6211\u4eec\u76f4\u63a5\u4f7f\u7528Unsafe\u7c7b\uff0c\u4ece\u5b83\u7684\u540d\u5b57\u5c31\u53ef\u4ee5\u770b\u51fa\u5f00\u53d1\u4eba\u5458\u76f4\u63a5\u4f7f\u7528\u5b83\u662f\u4e0d\u5b89\u5168\u7684\uff0c\u4f46\u662f\u975e\u8981\u83b7\u53d6\u4e5f\u662f\u6709\u529e\u6cd5\u7684\uff0c\u90a3\u5c31\u662f\u901a\u8fc7\u53cd\u5c04\u83b7\u53d6\u3002\uff08\u6211\u4eec\u77e5\u9053\uff0c\u9664\u4e86\u901a\u8fc7\u679a\u4e3e\u5b9e\u73b0\u7684\u5355\u4f8b\u4e0d\u80fd\u88ab\u53cd\u5c04\u6253\u7834\u5916\uff0c\u5176\u5b83\u901a\u8fc7\u6784\u9020\u5668\u79c1\u6709\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u5355\u4f8b\u90fd\u53ef\u4ee5\u88ab\u53cd\u5c04\u6253\u7834\u3002\u4e0d\u8fc7\u63a5\u4e0b\u6765\u5e76\u4e0d\u662f\u4ee5\u65b0\u521b\u5efa\u5bf9\u8c61\u7684\u65b9\u5f0f\u83b7\u53d6Unsafe\u5bf9\u8c61\uff0c\u800c\u5df2\u76f4\u63a5\u83b7\u53d6Unsafe\u4ee5\u5355\u4f8b\u65b9\u5f0f\u521b\u5efa\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff09  </p> <p>\u901a\u8fc7\u53cd\u5c04\u83b7\u53d6Unsafe\u7c7b\u7684\u5b9e\u4f8b\uff1a Text Only<pre><code>try {\n\u00a0\u00a0\u00a0\u00a0Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\n\u00a0\u00a0\u00a0\u00a0theUnsafe.setAccessible(true);\n\u00a0\u00a0\u00a0\u00a0unsafe = (Unsafe) theUnsafe.get(null);\n} catch (NoSuchFieldException | IllegalAccessException e) {\n\u00a0\u00a0\u00a0\u00a0throw new Error(e);\n}\n</code></pre></p> <p>\u901a\u8fc7Unsafe\u5bf9\u8c61\u64cd\u4f5c\u5176\u5b83\u5b9e\u4f8b\u5bf9\u8c61\uff1a Text Only<pre><code>class Student {\n\u00a0\u00a0\u00a0\u00a0volatile int id;\n\u00a0\u00a0\u00a0\u00a0volatile String name;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String toString() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"Student{\" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"id=\" + id +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", name='\" + name + '\\'' +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'}';\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Unsafe unsafe = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Field theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0theUnsafe.setAccessible(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0unsafe = (Unsafe) theUnsafe.get(null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (NoSuchFieldException | IllegalAccessException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new Error(e);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Field id = Student.class.getDeclaredField(\"id\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Field name = Student.class.getDeclaredField(\"name\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u83b7\u5f97\u6210\u5458\u53d8\u91cf\u7684\u504f\u79fb\u91cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long idOffset = unsafe.objectFieldOffset(id);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long nameOffset = unsafe.objectFieldOffset(name);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Student student = new Student();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4f7f\u7528 cas \u65b9\u6cd5\u66ff\u6362\u6210\u5458\u53d8\u91cf\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0unsafe.compareAndSwapInt(student, idOffset, 0, 20); // \u8fd4\u56de true\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0unsafe.compareAndSwapObject(student, nameOffset, null, \"\u5f20\u4e09\"); // \u8fd4\u56de true\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(student);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/21-%E5%8E%9F%E5%AD%90%E7%B1%BB%E4%B8%8EABA%E9%97%AE%E9%A2%98/","title":"21-\u539f\u5b50\u7c7b\u4e0eABA\u95ee\u9898","text":"<p> \u7ea6 364 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>JUC\u57fa\u4e8eUnsafe\u7c7b\u7684CAS\u64cd\u4f5c\u63d0\u4f9b\u4e86\u8bb8\u591a\u539f\u5b50\u7c7b\uff0c\u5b9e\u73b0\u4e86\u8bb8\u591a\u5e38\u7528\u7684\u7ebf\u7a0b\u5b89\u5168\u7684\u64cd\u4f5c\u3002</p> <p>\u539f\u5b50\u6574\u6570\uff1a AtomicBoolean AtomicInteger AtomicLong</p> <p>\u539f\u5b50\u5f15\u7528\uff1a AtomicReference AtomicMarkableReference AtomicStampedReference</p> <p>\u539f\u5b50\u6570\u7ec4\uff1a AtomicIntegerArray AtomicLongArray AtomicReferenceArray</p> <p>\u5bf9\u666e\u901a\u7684\u6210\u5458\u53d8\u91cf\uff1a AtomicReferenceFieldUpdater AtomicIntegerFieldUpdater AtomicLongFieldUpdater</p> <p>\u539f\u5b50\u7d2f\u52a0\u5668 LongAdder</p> <p>\u5728\u4f7f\u7528AtomicBoolean\u3001AtomicInteger\u3001AtomicLong\u3001AtomicReference\u7b49\u539f\u5b50\u7c7b\u65f6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684\u52a0\u51cf\u4e58\u9664\u7b49\u4fee\u6539\u64cd\u4f5c\uff0c\u4f46\u8fd9\u4e9b\u64cd\u4f5c\u6709\u4e00\u4e2a\u95ee\u9898\uff1aT1\u7ebf\u7a0b\u8bfb\u5230\u53d8\u91cf\u7684\u503c\u662fA\uff0c\u7136\u540e\u8fd9\u65f6T2\u7ebf\u7a0b\u5c06A\u8be5\u4e3aB\uff0c\u63a5\u7740T3\u7ebf\u7a0b\u5c06B\u6539\u4e3aA\uff0cT1\u7ebf\u7a0b\u6b64\u65f6\u53bb\u66f4\u65b0\u53d8\u91cf\u7684\u503c\u4e5f\u4f1a\u6210\u529f\uff0c\u56e0\u4e3a\u6700\u540e\u7684\u503c\u8fd8\u662fA\uff0c\u4f46\u662fT1\u7ebf\u7a0b\u5e76\u4e0d\u77e5\u9053\u7684\u662f\u53d8\u91cf\u7684\u503c\u5728\u5b83\u8bfb\u53d6\u76f4\u5230\u66f4\u65b0\u671f\u95f4\u5df2\u7ecf\u53d1\u751f\u4e86\u591a\u6b21\u4fee\u6539\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684ABA\u95ee\u9898\u3002</p> <p>\u6709\u4e9b\u65f6\u5019\u8fd9\u4e2a\u95ee\u9898\u53ef\u80fd\u5e76\u4e0d\u6784\u6210\u95ee\u9898\uff0c\u4f46\u6709\u4e9b\u65f6\u5019\u8fd9\u5c31\u662f\u4e2a\u95ee\u9898\uff0c\u90a3\u4e48\u5f53\u5b83\u662f\u95ee\u9898\u7684\u65f6\u5019\u5982\u4f55\u89e3\u51b3\u5462\uff1f \u7b54\u6848\u662f\u4f7f\u7528AtomicStampedReference\u5e26\u6233\u7684\u539f\u5b50\u5f15\u7528\u7c7b\uff0c\u5b83\u7684compareAndSet\u65b9\u6cd5\u5982\u4e0b\uff1a Text Only<pre><code>public boolean compareAndSet(V\u00a0\u00a0\u00a0expectedReference,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0V\u00a0\u00a0\u00a0newReference,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int expectedStamp,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int newStamp)\n</code></pre> expectedReference\u662f\u671f\u671b\u503c\uff0cnewReference\u662f\u65b0\u503c\uff0cexpectedStamp\u662f\u671f\u671b\u7684\u6233\uff0cnewStamp\u662f\u65b0\u6233\u3002</p> <p>\u7ea6\u5b9a\u6bcf\u4e00\u6b21\u66f4\u65b0\u6210\u529f\u90fd\u8bbe\u7f6e\u4e00\u4e2a\u65b0\u7684\u6233\uff0c\u8fd9\u4e2a\u6233\u5c31\u662f\u7248\u672c\u53f7\uff0c\u5728expectedStamp\u7684\u57fa\u7840\u4e0a\u52a01\uff0c\u66f4\u65b0\u65f6expectedReference\u548cexpectedStamp\u6709\u4e00\u4e2a\u4e0d\u7b26\u5408\u9884\u671f\u5c31\u66f4\u65b0\u5931\u8d25\u3002</p>"},{"location":"Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/22-AQS/","title":"22-AQS","text":"<p> \u7ea6 1223 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 24 \u5206\u949f</p> <p>AQS \u5168\u79f0\u662f AbstractQueuedSynchronizer\uff0c\u662f\u963b\u585e\u5f0f\u9501\u548c\u76f8\u5173\u7684\u540c\u6b65\u5668\u5de5\u5177\u7684\u6846\u67b6 \uff0c\u8bb8\u591a\u540c\u6b65\u7c7b\u5b9e\u73b0\u90fd\u4f9d\u8d56\u4e8e\u5b83\uff0c\u6bd4\u5982JUC\u4e2d\u7684ReentrantLock\u3001 Semaphore\u3001 CountDownLatch\u7b49\u5de5\u5177\u7c7b\u90fd\u662f\u57fa\u4e8eAQS\uff08AbstractQueuedSynchronizer\uff09\u5b9e\u73b0\u7684\uff0cAQS\u53c8\u662f\u57fa\u4e8eUnsafe\u7c7b\u63d0\u4f9b\u7684CAS\u64cd\u4f5c\u3001volatile\u5173\u952e\u5b57\u548cUnsafe\u7c7b\u63d0\u4f9b\u7684park()\u4e0eunpark()\u65b9\u6cd5\u5b9e\u73b0\u7684\uff08AQS\u5e76\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528Unsafe\u7c7b\u7684park()\u4e0eunpark()\u65b9\u6cd5\uff0c\u800c\u662f\u4f7f\u7528\u7684\u662fLockSupport\u7684\u9759\u6001\u65b9\u6cd5par()\u548cunpark()\u65b9\u6cd5\uff0c\u800cLockSupport\u7684park()\u548cunpark()\u65b9\u6cd5\u662f\u4f7f\u7528Unsafe\u7c7b\u7684park()\u4e0eunpark()\u65b9\u6cd5\u5b9e\u73b0\u7684\uff09\u3002</p> <p>\u8fd9\u91cc\u8981\u8bf4\u660e\u4e00\u70b9\uff0c\u539f\u5b50\u7c7b\u662f\u57fa\u4e8eUnsafe\u7c7b\u63d0\u4f9b\u7684CAS\u64cd\u4f5c\u518d\u52a0\u4e0a\u65e0\u9501\uff08\u4e5f\u5c31\u662f\u4e00\u76f4\u5faa\u73af\u91cd\u8bd5\uff09\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\uff0c\u800cAQS\u662f\u57fa\u4e8eUnsafe\u7c7b\u63d0\u4f9b\u7684CAS\u64cd\u4f5c\u548cpark()\u4e0eunpark()\u5b9e\u73b0\u7684\u3002\u5728\u524d\u4e00\u79cd\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684\u65b9\u5f0f\u4e2d\uff0c\u7ebf\u7a0b\u662f\u6ca1\u6709\u963b\u585e\u7684\uff1b\u800c\u5728AQS\u4e2d\u7ebf\u7a0b\u662f\u6709\u963b\u585e\u7684\uff0c\u963b\u585e\u548c\u7b49\u5f85\u5524\u9192\u7684\u64cd\u4f5c\u90fd\u6709\uff0c\u8fd9\u548csynchronized\u4e00\u6837\uff0c\u90fd\u662f\u6709\u963b\u585e\u7684\uff0c\u53ea\u4e0d\u8fc7park()\u662f\u57fa\u4e8eparker\u5b9e\u73b0\u7684\uff0c\u800csynchronized\u662f\u57fa\u4e8emonitor\u5b9e\u73b0\u7684\u3002 parker\u548cmonitor\u90fd\u662f\u7531jvm\u5e95\u5c42\u5b9e\u73b0\u7684\uff0c\u7528C++\u5199\u7684\uff0c\u533a\u522b\u5c31\u5728\u4e8e\uff0cmonitor\u662f\u9501\uff0c\u800cparker\u5e76\u4e0d\u662f\u4e00\u79cd\u9501\u3002monitor\u662f\u9501\u7684\u4e00\u79cd\u5b8c\u6574\u5b9e\u73b0\uff0c\u5305\u62ec\u4e86\u52a0\u9501\u6210\u529f\u548c\u5931\u8d25\u7684\u903b\u8f91\u3001\u963b\u585e\u548c\u5524\u9192\u7684\u903b\u8f91\uff1b\u800cparker\u5219\u6ca1\u6709\uff0cparker\u53ea\u662f\u63d0\u4f9b\u4e86\u963b\u585e\u548c\u5524\u9192\u7ebf\u7a0b\u6700\u57fa\u672c\u7684\u64cd\u4f5c\uff0c\u4e0e\u9501\u662f\u4e24\u7801\u4e8b\uff0c\u9501\u7684\u903b\u8f91\u4ea4\u7531\u4e0a\u5c42\u7684AQS\u5b9e\u73b0\u3002\u4e0d\u8fc7\u53ea\u8981\u662f\u963b\u585e\u6216\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u6765\u5e2e\u5fd9\uff0c\u963b\u585e\u548c\u5524\u9192\u7ebf\u7a0b\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u5728\u5185\u6838\u6001\u4e2d\u5b8c\u6210\uff0c\u6240\u4ee5\u90fd\u4e0d\u53ef\u907f\u514d\u7684\u6d89\u53ca\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u7684\u8f6c\u6362\uff0c\u8fd9\u79cd\u72b6\u6001\u8f6c\u6362\u9700\u8981\u5f88\u5927\u7684\u5f00\u9500\u3002</p> <p>AQS\u5728JUC\u5305\u4e2d\u626e\u6f14\u7684\u89d2\u8272\u4e0e\u7ba1\u7a0b\u5f88\u7c7b\u4f3c\uff0c\u5b83\u63d0\u4f9b\u7684\u57fa\u4e8e FIFO \u7684\u7b49\u5f85\u961f\u5217\uff0c\u7c7b\u4f3c\u4e8e Monitor \u7684 EntryList\uff1b\u8fd8\u63d0\u4f9b\u4e86\u6761\u4ef6\u53d8\u91cf\u6765\u5b9e\u73b0\u7b49\u5f85\u3001\u5524\u9192\u673a\u5236\uff0c\u5e76\u4e14\u652f\u6301\u591a\u4e2a\u6761\u4ef6\u53d8\u91cf\uff0c\u7c7b\u4f3c\u4e8e Monitor \u7684 WaitSet\uff0c\u4e0d\u8fc7Monitor\u53ea\u652f\u6301\u4e00\u4e2aWaitSet\uff1bAQS\u4ece\u7236\u7c7b\u4e2d\u7ee7\u627f\u800c\u6765\u7684exclusiveOwnerThread\u5b57\u6bb5\u4ee5\u53ca\u5bf9\u5e94\u7684set\u548cget\u65b9\u6cd5\u7c7b\u4f3c\u4e8eMonitor\u7684Owner\u3002\u4f46AQS\u6bd4Monitor\u66f4\u5f3a\u5927\uff0c\u6bd4\u5982\u7684ReentrantLock\u6709\u5f88\u591asynchronized\u4e0d\u5177\u5907\u7684\u7279\u70b9\uff0cSemaphore\u3001 CountDownLatch\u7b49\u5de5\u5177\u7c7b\u4e5f\u57fa\u4e8eAQS\u5b9e\u73b0\u4e86\u5f88\u591a\u5f3a\u5927\u65b9\u4fbf\u7684\u529f\u80fd\u3002</p> <p>\u4e3a\u4ec0\u4e48AQS\u6bd4Monitor\u66f4\u5f3a\u5927\u5462\uff1f\u56e0\u4e3asynchronized\u7684\u52a0\u89e3\u9501\u903b\u8f91\u5168\u90e8\u662f\u7531monitor\u6765\u5b9e\u73b0\u7684\uff08\u6240\u4ee5\u8bf4\u662f\u7ba1\u7a0b\u561b\uff09\uff0cmonitor\u53c8\u662fjvm\u7684\u5e95\u5c42\u5b9e\u73b0\uff1b\u800cAQS\u5219\u662f\u7531Java\u6765\u5b9e\u73b0\u7684\uff0c\u53ea\u6709\u963b\u585e\u548c\u5524\u9192\u64cd\u4f5c\u662fJVM\u7684\u5e95\u5c42\u5b9e\u73b0\uff08\u5f53\u7136\u8fd8\u6709CAS\uff09\uff0c\u76f8\u6bd4\u4e8emonitor\u7684\u963b\u585e\u548c\u5524\u9192\uff0cparker\u7684\u963b\u585e\u5524\u9192\u66f4\u4e3a\u7075\u6d3b\uff0cAQS\u53ea\u5b9e\u73b0\u4e86\u9501\u7684\u6846\u67b6\uff0c\u4ee5\u65b9\u4fbf\u5177\u4f53\u9501\u5b9e\u73b0\u7684\u6269\u5c55\uff0c\u4e5f\u6bd4monitor\u7075\u6d3b\u3002</p> <p>\u603b\u7ed3\u5230\u4e00\u70b9\u5c31\u662f\uff1asynchronized\u7684\u5b9e\u73b0\u5168\u90e8\u4ea4\u7531jvm\u5e95\u5c42\u6765\u5b8c\u6210\uff0c\u800cAQS\u53ea\u4f7f\u7528\u4e86jvm\u5e95\u5c42\u63d0\u4f9b\u7684CAS\u548cpark\u4e24\u4e2a\u64cd\u4f5c\uff0c\u5176\u5b83\u5b9e\u73b0\u9501\u7684\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\u5168\u90e8\u901a\u8fc7Java\u4ee3\u7801\u6765\u5b9e\u73b0\u3002</p> <p>ReentrantLock\u76f8\u6bd4\u4e8esynchronized\u53ef\u4ee5\uff1a</p> <ol> <li>\u53ef\u4e2d\u65ad</li> <li>\u53ef\u4ee5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4</li> <li>\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u516c\u5e73\u9501</li> <li>\u652f\u6301\u591a\u4e2a\u6761\u4ef6\u53d8\u91cf</li> </ol> <p>ReentrantLock\u548csynchronized\u7684\u5171\u540c\u70b9\u662f\u53ef\u91cd\u5165\u3002 \u53ef\u91cd\u5165\u662f\u6307\u4e00\u4e2a\u7ebf\u7a0b\u5982\u679c\u83b7\u5f97\u4e86\u9501\uff0c\u90a3\u4e48\u5728\u5b83\u91ca\u653e\u9501\u4e4b\u524d\uff0c\u53ef\u4ee5\u91cd\u590d\u52a0\u9501\u800c\u4e0d\u4f1a\u963b\u585e\uff0c\u5982\u679c\u662f\u4e0d\u53ef\u91cd\u5165\u9501\uff0c\u90a3\u4e48\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5728\u91ca\u653e\u9501\u4e4b\u524d\u7684\u518d\u6b21\u52a0\u9501\u64cd\u4f5c\u4e5f\u4f1a\u5bfc\u81f4\u81ea\u5df1\u88ab\u963b\u585e\u6302\u8d77\u3002</p> <p>AQS\u5b9e\u73b0\u4e0d\u53ef\u91cd\u5165\u9501\uff0c\u8fd9\u662fJDK\u4e2dAQS\u7684\u6ce8\u91ca\u63d0\u4f9b\u7684\u4e00\u4e2a\u4f8b\u5b50\uff1a Text Only<pre><code>class Mutex implements Lock, java.io.Serializable {\n\n\u00a0\u00a0\u00a0\u00a0private final Sync sync = new Sync();\n\n\u00a0\u00a0\u00a0\u00a0public void lock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sync.acquire(1);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public boolean tryLock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sync.tryAcquire(1);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void unlock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sync.release(1);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public Condition newCondition() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sync.newCondition();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public boolean isLocked() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sync.isLocked();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public boolean isHeldByCurrentThread() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sync.isHeldExclusively();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public boolean hasQueuedThreads() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sync.hasQueuedThreads();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void lockInterruptibly() throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sync.acquireInterruptibly(1);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public boolean tryLock(long timeout, TimeUnit unit)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sync.tryAcquireNanos(1, unit.toNanos(timeout));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// Our internal helper class\n\u00a0\u00a0\u00a0\u00a0private static `class Sync extends AbstractQueuedSynchronizer` {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Acquires the lock if state is zero\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean tryAcquire(int acquires) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assert acquires == 1; // Otherwise unused\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (compareAndSetState(0, 1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setExclusiveOwnerThread(Thread.currentThread());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Releases the lock by setting state to zero\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0protected boolean tryRelease(int releases) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assert releases == 1; // Otherwise unused\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!isHeldExclusively())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new IllegalMonitorStateException();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setExclusiveOwnerThread(null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setState(0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Reports whether in locked state\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean isLocked() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return getState() != 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean isHeldExclusively() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// a data race, but safe due to out-of-thin-air guarantees\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return getExclusiveOwnerThread() == Thread.currentThread();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Provides a Condition\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Condition newCondition() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ConditionObject();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Deserializes properly\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private void readObject(ObjectInputStream s)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throws IOException, ClassNotFoundException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0s.defaultReadObject();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setState(0); // reset to unlocked state\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic class Test {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Mutex mutex = new Mutex();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mutex.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u4e0a\u7b2c\u4e00\u628a\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mutex.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u56e0\u4e3a\u662f\u4e0d\u53ef\u91cd\u5165\u9501\uff0c\u6240\u4ee5\u4e0a\u7b2c\u4e8c\u628a\u9501\u7684\u65f6\u5019\u88ab\u963b\u585e\u4e86\uff0c\u8fd9\u91cc\u4e0d\u4f1a\u6253\u5370\u51fa\u6765\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mutex.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mutex.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u89e3\u9501\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4ece\u4ee5\u4e0a\u5b9e\u73b0\u53ef\u4ee5\u770b\u51faAQS\u5df2\u7ecf\u5b9e\u73b0\u4e86\u901a\u7528\u7684\u57fa\u7840\u7ed3\u6784\u548c\u529f\u80fd\uff0c\u5728\u5b83\u7684\u57fa\u7840\u4e4b\u4e0a\u6211\u4eec\u5c31\u53ef\u4ee5\u6784\u5efa\u81ea\u5df1\u7684\u52a0\u9501\u903b\u8f91\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/1.MyBatis%E5%85%A5%E9%97%A8-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/","title":"1.MyBatis\u5165\u95e8-\u589e\u5220\u6539\u67e5","text":"<p> \u7ea6 1090 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 22 \u5206\u949f</p> <p>\u4e00\u3001\u589e\u5220\u6539 1.\u521b\u5efaMyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 \u4e60\u60ef\u4e0a\u547d\u540d\u4e3a mybatis-config.xml\uff0c\u8fd9\u4e2a\u6587\u4ef6\u540d\u4ec5\u4ec5\u53ea\u662f\u5efa\u8bae\uff0c\u5e76\u975e\u5f3a\u5236\u8981\u6c42\u3002 Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\u00a0\u00a0\n&lt;!DOCTYPE configuration\u00a0\u00a0\nPUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\u00a0\u00a0\n\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;\u00a0\u00a0\n&lt;configuration&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\u8bbe\u7f6e\u8fde\u63a5\u6570\u636e\u5e93\u7684\u73af\u5883--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;environments default=\"development\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;environment id=\"development\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;transactionManager type=\"JDBC\"/&gt;\u00a0 \u00a0\u00a0&lt;!--\u4e8b\u52a1\u7ba1\u7406\u5668--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;dataSource type=\"POOLED\"&gt;\u00a0 \u00a0&lt;!--\u6570\u636e\u5e93\u8fde\u63a5\u6c60--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"driver\" value=\"com.mysql.cj.jdbc.Driver\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"url\" value=\"jdbc:mysql://localhost:3306/MyBatis\"/&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"username\" value=\"root\"/&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"password\" value=\"123456\"/&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/dataSource&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/environment&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0&lt;/environments&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0`&lt;!--\u5f15\u5165\u6620\u5c04\u6587\u4ef6--&gt;` \n `&lt;mappers&gt;` \n `&lt;mapper resource=\"mappers/UserMapper.xml\"/&gt;` \n `&lt;/mappers&gt;` \n&lt;/configuration&gt;\n</code></pre></p> <p>2.\u521b\u5efaMapper\u63a5\u53e3\uff0c\u76f8\u5f53\u4e8e\u4ee5\u524d\u7684dao\uff0c\u4e0d\u8fc7mapper\u4ec5\u4ec5\u662f\u63a5\u53e3\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u63d0\u4f9b\u5b9e\u73b0\u7c7b\u3002 Text Only<pre><code>public interface UserMapper {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0/**\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0* \u6dfb\u52a0\u7528\u6237\u4fe1\u606f\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0*/\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0int insertUser();\n\n\u00a0\u00a0 \u00a0/*\n\u00a0\u00a0 \u00a0* \u5220\u9664\u7528\u6237\u4fe1\u606f\n\u00a0\u00a0 \u00a0*/\n\u00a0 \u00a0 int\u00a0deleteUser();\n\n\u00a0\u00a0 \u00a0/*\n\u00a0\u00a0 \u00a0* \u66f4\u65b0\u7528\u6237\u4fe1\u606f\n\u00a0\u00a0 \u00a0*/\n\u00a0\u00a0 \u00a0int updateUser();\n}\n</code></pre></p> <p>3.\u521b\u5efaMyBatis\u7684\u6620\u5c04\u6587\u4ef6 MyBatis\u6620\u5c04\u6587\u4ef6\u7528\u4e8e\u7f16\u5199SQL\uff0c\u8bbf\u95ee\u4ee5\u53ca\u64cd\u4f5c\u8868\u4e2d\u7684\u6570\u636e\u3002 \u6620\u5c04\u6587\u4ef6\u7684\u547d\u540d\u89c4\u5219\uff1a\u8868\u6240\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b\u7684\u7c7b\u540d+Mapper.xml\uff0c\u4f8b\u5982\uff1a\u8868t_user\uff0c\u6620\u5c04\u7684\u5b9e\u4f53\u7c7b\u4e3aUser\uff0c\u6240\u5bf9\u5e94\u7684\u6620\u5c04\u6587\u4ef6\u4e3aUserMapper.xml\uff0c\u9700\u8981\u5728MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f15\u5165\u8be5\u6587\u4ef6\u3002\uff08\u89c4\u8303\u60c5\u51b5\u4e0bMyBatis\u6620\u5c04\u6587\u4ef6\u5b58\u653e\u7684\u4f4d\u7f6e\u662fsrc/main/resources/mappers\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u653e\u5728\u5176\u4ed6\u4f4d\u7f6e\uff0c\u53ea\u8981\u5728\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e0b\u6b63\u786e\u914d\u7f6e\u5373\u53ef\u3002\uff09 MyBatis\u4e2d\u53ef\u4ee5\u9762\u5411\u63a5\u53e3\u64cd\u4f5c\u6570\u636e\uff0c\u8981\u4fdd\u8bc1\u4e24\u4e2a\u4e00\u81f4\uff1a</p> <ul> <li><code>mapper\u63a5\u53e3\u7684\u5168\u7c7b\u540d \u548c \u6620\u5c04\u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4\uff08namespace\uff09\u4fdd\u6301\u4e00\u81f4</code> <code>mapper\u63a5\u53e3\u4e2d\u65b9\u6cd5\u7684\u65b9\u6cd5\u540d \u548c \u6620\u5c04\u6587\u4ef6\u4e2d\u7f16\u5199SQL\u7684\u6807\u7b7e\u7684id\u5c5e\u6027 \u4fdd\u6301\u4e00\u81f4</code></li> </ul> Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\u00a0\u00a0\n&lt;!DOCTYPE mapper\u00a0\u00a0\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\u00a0\u00a0\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\u00a0\u00a0\n&lt;mapper `namespace=\"com.atguigu.mybatis.mapper.UserMapper\"`&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0&lt;!--int insertUser();--&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0&lt;insert `id=\"insertUser\"`&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0insert into t_user values(null,'\u5f20\u4e09','123',23,'\u5973')\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0&lt;/insert&gt;\n\u00a0\u00a0 \u00a0&lt;!--int deleteUser();--&gt;\n\n\u00a0\u00a0 \u00a0&lt;delete id=\"deleteUser\"&gt;\n\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0delete from t_user where id = 6\n\u00a0\u00a0 \u00a0&lt;/delete&gt;\n\n\u00a0\u00a0 \u00a0&lt;!--int updateUser();--&gt;\n\u00a0\u00a0 \u00a0&lt;update id=\"updateUser\"&gt;\n\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0update t_user set username = '\u5f20\u4e09' where id = 5\n\u00a0\u00a0 \u00a0&lt;/update&gt;\n&lt;/mapper&gt;\n</code></pre> <p>\u589e\u5220\u6539\u6807\u7b7e\u4e0d\u7528\u5199resultType\uff0c\u5982\u679c\u63a5\u53e3\u7684\u65b9\u6cd5\u6709\u8fd4\u56de\u503c\uff0c\u90a3\u4e48MyBatis\u6839\u636e\u5f71\u54cd\u7684\u884c\u6570\u81ea\u52a8\u5224\u65ad\uff0c\u5982\u679c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662fboolean\uff0c\u5c31\u8f6c\u6362\u6210true\u6216\u8005false\uff0c\u5982\u679c\u662fint\uff0c\u5c31\u662f\u5f71\u54cd\u7684\u884c\u6570 \u3002</p> <p>4.\u8fd0\u884c</p> <p>\u8c03\u7528Mapper\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u6839\u636eMapper\u7684\u5168\u7c7b\u540d\u5339\u914d\u5230namespace\uff0c\u901a\u8fc7\u8c03\u7528\u7684\u65b9\u6cd5\u540d\u5339\u914d\u5230\u6620\u5c04\u6587\u4ef6\u4e2d\u7684id\uff0c\u4ece\u800c\u6267\u884c\u6807\u7b7e\u4e2d\u7684SQL\u8bed\u53e5\u3002 Text Only<pre><code>public class UserMapperTest {\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testInsertUser() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1\u3001`\u8bfb\u53d6MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0InputStream is = Resources.getResourceAsStream`(\"mybatis-config.xml\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2\u3001\u83b7\u53d6SqlSessionFactoryBuilder\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3\u3001\u901a\u8fc7\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u6240\u5bf9\u5e94\u7684\u5b57\u8282\u8f93\u5165\u6d41\u521b\u5efa\u5de5\u5382\u7c7bSqlSessionFactory\uff0c\u751f\u4ea7SqlSession\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4.1\u3001`\u83b7\u53d6sqlSession\uff0c\u9ed8\u8ba4\u901a\u8fc7SqlSession\u5bf9\u8c61\u6240\u64cd\u4f5csql\u5fc5\u987b\u624b\u52a8\u63d0\u4ea4\u6216\u56de\u6eda\u4e8b\u52a1`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//SqlSession sqlSession = sqlSessionFactory.openSession();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4.2\u3001`\u6216\u8005 true \u8868\u793a\u901a\u8fc7SqlSession\u5bf9\u8c61\u6240\u64cd\u4f5c\u7684sql\u90fd\u4f1a\u81ea\u52a8\u63d0\u4ea4`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SqlSession sqlSession = sqlSessionFactory.openSession(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//5\u3001\u901a\u8fc7\u4ee3\u7406\u6a21\u5f0f\u521b\u5efaUserMapper\u63a5\u53e3\u7684\u4ee3\u7406\u5b9e\u73b0\u7c7b\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0UserMapper userMapper = sqlSession.getMapper(UserMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8c03\u7528UserMapper\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u6839\u636eUserMapper\u7684\u5168\u7c7b\u540d\u5339\u914d\u5143\u7d20\u6587\u4ef6\uff0c\u901a\u8fc7\u8c03\u7528\u7684\u65b9\u6cd5\u540d\u5339\u914d\u6620\u5c04\u6587\u4ef6\u4e2d\u7684SQL\u6807\u7b7e\uff0c\u5e76\u6267\u884c\u6807\u7b7e\u4e2d\u7684SQL\u8bed\u53e5\n\u00a0 \u00a0 \u00a0 \u00a0 //\u589e\u5220\u6539\u7684\u8fd4\u56de\u503c\u662f\u5f71\u54cd\u7684\u884c\u6570\uff0c\u6bd4\u5982\u63d2\u5165\u4e24\u6761\u6570\u636e\u5f71\u54cd\u7684\u884c\u6570\u662f2\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int result = userMapper.insertUser();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u63d0\u4ea4\u4e8b\u52a1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//sqlSession.commit();\n\u00a0 \u00a0 \u00a0 \u00a0\u00a0sqlSession.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"result:\" + result);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001\u67e5\u8be2 1\u3001\u67e5\u8be2\u9700\u8981\u5c01\u88c5\u8fd4\u56de\u503c\uff0c\u5373\u4f7f\u662f\u5355\u4e2a\u6570\u503c\u6216\u8005\u5b57\u7b26\u4e32\uff0c\u4e5f\u8981\u6307\u5b9a\u67e5\u8be2\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u3002\u5982\u679c\u67e5\u8be2\u7684\u662f\u4e00\u884c\u6570\u636e\uff0c\u90a3\u4e48\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f53\u7c7b\u3002</p> <ul> <li>ORM\uff08Object Relationship Mapping\uff09\u5bf9\u8c61\u5173\u7cfb\u6620\u5c04<ul> <li>\u5bf9\u8c61\uff1aJava\u7684\u5b9e\u4f53\u7c7b\u5bf9\u8c61</li> <li>\u5173\u7cfb\uff1a\u5173\u7cfb\u578b\u6570\u636e\u5e93</li> <li>\u6620\u5c04\uff1a\u4e8c\u8005\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb</li> </ul> </li> </ul> <p>\u4f8b\u5982\uff1a\u8868t_user\uff0c\u6620\u5c04\u7684\u5b9e\u4f53\u7c7b\u4e3aUser\uff0c\u653e\u5728pojo\u5305 \u6216\u8005 bean\u5305</p> Java\u6982\u5ff5 \u6570\u636e\u5e93\u6982\u5ff5 \u7c7b \u8868 \u5c5e\u6027 \u5b57\u6bb5/\u5217 \u5bf9\u8c61 \u8bb0\u5f55/\u884c Text Only<pre><code>@Data\n@AllArgsConstructor\npublic class User {\n\u00a0\u00a0\u00a0\u00a0private int id;\n\u00a0\u00a0\u00a0\u00a0private String name;\n\u00a0\u00a0\u00a0\u00a0private int age;\n}\n</code></pre> <p>2\u3001\u5728Mapper\u63a5\u53e3\u4e2d\u6dfb\u52a0\u65b9\u6cd5 Text Only<pre><code>public interface UserMapper {\u00a0\u00a0\n\u00a0 \u00a0\u00a0/**\n\u00a0\u00a0 \u00a0* \u67e5\u8be2\u7528\u6237\u4fe1\u606f\uff0c\u67e5\u8be2\u7684\u6570\u636e\u53ea\u6709\u4e00\u6761\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b9e\u4f53\u7c7b\u6216\u96c6\u5408\u4f5c\u4e3a\u8fd4\u56de\u503c\n\u00a0\u00a0 \u00a0*/\n\u00a0\u00a0 \u00a0User getUserById();\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0* \u67e5\u8be2\u6240\u6709\u7528\u6237\u4fe1\u606f\uff0c`\u5f53\u67e5\u8be2\u7684\u6570\u636e\u4e3a\u591a\u6761\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u5b9e\u4f53\u7c7b\u4f5c\u4e3a\u8fd4\u56de\u503c\uff0c\u5fc5\u987b\u4f7f\u7528\u96c6\u5408`\uff0c\u5426\u5219\u4f1a\u629b\u51fa\u5f02\u5e38TooManyResultsException\uff1b\n\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0 \u00a0List&lt;User&gt; getUserList();\n}\n</code></pre></p> <p>3\u3001\u5728Mapper\u5bf9\u5e94\u7684xml\u6587\u4ef6\u4e2d\u5199SQL\u3002 Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\u00a0\u00a0\n&lt;!DOCTYPE mapper\u00a0\u00a0\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\u00a0\u00a0\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\u00a0\u00a0\n&lt;mapper namespace=\"com.atguigu.mybatis.mapper.UserMapper\"&gt;\u00a0\u00a0\n\n\u00a0\u00a0 \u00a0&lt;!-- \u67e5\u8be2\u4e00\u4e2a\u5b9e\u4f53\u7c7b\u5bf9\u8c61 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;select id=\"getUserById\" `resultType=\"pojo.User\"`&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select * from user where id = 2\n\u00a0\u00a0\u00a0\u00a0&lt;/select&gt;\n\n\u00a0\u00a0 \u00a0&lt;!-- \u67e5\u8be2\u96c6\u5408 --&gt;\n\u00a0\u00a0 \u00a0&lt;!--List&lt;User&gt; getUserList();--&gt;\n\u00a0\u00a0 \u00a0&lt;select id=\"getUserList\" resultType=\"com.atguigu.mybatis.bean.User\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0select * from t_user\n\u00a0\u00a0 \u00a0&lt;/select&gt;\n&lt;/mapper&gt;\n</code></pre></p> <p>\u67e5\u8be2\u7684\u6807\u7b7eselect\u5fc5\u987b\u8bbe\u7f6e\u5c5e\u6027resultType\u6216resultMap\uff0c\u7528\u4e8e\u8bbe\u7f6e\u5b9e\u4f53\u7c7b\u4e0e\u6570\u636e\u5e93\u8868\u4e00\u884c\u6570\u636e\u7684\u6620\u5c04\u5173\u7cfb</p> <ul> <li><code>resultType\uff1a\u81ea\u52a8\u6620\u5c04\uff0c\u7528\u4e8e\u5c5e\u6027\u540d\u548c\u8868\u4e2d\u5b57\u6bb5\u540d\u4e00\u81f4\u7684\u60c5\u51b5</code> </li> <li><code>resultMap\uff1a\u81ea\u5b9a\u4e49\u6620\u5c04\uff0c\u7528\u4e8e\u4e00\u5bf9\u591a\u6216\u591a\u5bf9\u4e00\u6216\u5b57\u6bb5\u540d\u548c\u5c5e\u6027\u540d\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5</code> </li> </ul> <p>\u5982\u679cresultType\u8bbe\u7f6e\u4e3aMap\uff0c\u90a3\u4e48\u4e00\u4e2aMap\u5bf9\u8c61\u5bf9\u5e94\u6570\u636e\u5e93\u4e2d\u4e00\u6761\u6570\u636e\uff0c\u5217\u540d\u8bbe\u7f6e\u4e3akey\uff0c\u503c\u8bbe\u7f6e\u4e3avalue\u3002</p> <p>4\u3001\u901a\u8fc7 SqlSession\u00a0\u8c03\u7528Mapper\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5</p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/2.%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%20%E4%B8%8E%20%E5%BC%95%E5%85%A5%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F/","title":"2.\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 \u4e0e \u5f15\u5165\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u5f0f","text":"<p> \u7ea6 365 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>1.\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 \u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u6807\u7b7e\u5fc5\u987b\u6309\u7167\u56fa\u5b9a\u7684\u987a\u5e8f\u5199\uff0c\u6709\u7684\u6807\u7b7e\u53ef\u4ee5\u4e0d\u5199\uff0c\u4f46\u987a\u5e8f\u4e00\u5b9a\u4e0d\u80fd\u4e71\uff1a properties\u3001settings\u3001typeAliases\u3001typeHandlers\u3001objectFactory\u3001objectWrapperFactory\u3001reflectorFactory\u3001plugins\u3001environments\u3001databaseIdProvider\u3001mappers</p> Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE configuration\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PUBLIC \"-//MyBatis.org//DTD Config 3.0//EN\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"http://MyBatis.org/dtd/MyBatis-3-config.dtd\"&gt;\n&lt;configuration&gt;\n\n\u00a0 \u00a0\u00a0`&lt;!-- resource\u5f15\u5165\u7c7b\u8def\u5f84\u7684\u5c5e\u6027\u914d\u7f6e\u6587\u4ef6\uff0curl\u5f15\u5165\u78c1\u76d8\u4e0a\u6216\u8005\u7f51\u7edc\u4e0a\u7684\uff0c\u4e8c\u8005\u9009\u5176\u4e00 --&gt;`\n `&lt;properties resource=\"druid.properties\" url=\"\"/&gt;`\n\n `&lt;!-- \u8fd9\u662f MyBatis \u4e2d\u6781\u4e3a\u91cd\u8981\u7684\u8c03\u6574\u8bbe\u7f6e\uff0c\u5b83\u4eec\u4f1a\u6539\u53d8 MyBatis \u7684\u8fd0\u884c\u65f6\u884c\u4e3a --&gt;`\n `&lt;settings&gt;`\n\n `&lt;!--\u8bbe\u7f6e\u53ef\u4ee5\u5c06\u6570\u636e\u5e93\u7684\u4e0b\u5212\u7ebf\u547d\u540d order_id \u6620\u5c04\u6210java\u7c7b\u7684\u9a7c\u5cf0\u547d\u540d orderId--&gt;`\n `&lt;setting name=\"mapUnderscoreToCamelCase\" value=\"true\"/&gt;`\n\n `&lt;!-- \u53c2\u6570map\u7684key\u4f7f\u7528\u53c2\u6570\u540d\uff0c\u9ed8\u8ba4\u4e5f\u662ftrue\uff0c\u4f7f\u7528\u8be5\u9009\u9879\u9700\u8981\u7f16\u8bd1\u52a0\u4e0a-parameters\u9009\u9879 --&gt;`\n `&lt;setting name=\"useActualParamName\" value=\"true\"/&gt;`\n\n `&lt;!-- \u5f53\u4f7f\u7528&lt;association&gt;\u65f6\uff0c\u5982\u4e0b\u4e24\u6761\u914d\u7f6e\u53ef\u4ee5\u8bbe\u7f6e\u5ef6\u8fdf\u52a0\u8f7d --&gt;`\n `&lt;setting name=\"lazyLoadingEnabled\" value=\"true\"/&gt;`\n `&lt;setting name=\"aggressiveLazyLoading\" value=\"false\"/&gt;`\n\n `&lt;/settings&gt;`\n\n\u00a0\u00a0\u00a0\u00a0&lt;typeAliases&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0 \u00a0typeAlias\uff1a\u8bbe\u7f6e\u67d0\u4e2a\u5177\u4f53\u7684\u7c7b\u578b\u7684\u522b\u540d\uff0c\u5728resultType\u65f6\u53ef\u4ee5\u76f4\u63a5\u7528\u7c7b\u578b\u522b\u540d\u6307\u5b9a\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u9700\u8981\u6307\u5b9a\u5168\u7c7b\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0\u5c5e\u6027\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0type\uff1a\u9700\u8981\u8bbe\u7f6e\u522b\u540d\u7684\u7c7b\u578b\u7684\u5168\u7c7b\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0alias\uff1a\u8bbe\u7f6e\u6b64\u7c7b\u578b\u7684\u522b\u540d\uff0c`\u522b\u540d\u4e0d\u533a\u5206\u5927\u5c0f\u5199`\u3002\u82e5`\u4e0d\u8bbe\u7f6e\u6b64\u5c5e\u6027\uff0c\u8be5\u7c7b\u578b\u62e5\u6709\u9ed8\u8ba4\u7684\u522b\u540d\uff0c\u5373\u7c7b\u540d`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--&lt;typeAlias type=\"com.atguigu.mybatis.bean.User\"&gt;&lt;/typeAlias&gt;--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--&lt;typeAlias type=\"com.atguigu.mybatis.bean.User\" alias=\"user\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/typeAlias&gt;--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u4ee5\u5305\u4e3a\u5355\u4f4d\uff0c\u8bbe\u7f6e\u6539\u5305\u4e0b\u6240\u6709\u7684\u7c7b\u578b\u90fd\u62e5\u6709\u9ed8\u8ba4\u7684\u522b\u540d\uff0c\u5373\u7c7b\u540d\u4e14\u4e0d\u533a\u5206\u5927\u5c0f\u5199--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;package name=\"com.atguigu.mybatis.bean\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/typeAliases&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0environments\uff1a\u8bbe\u7f6e\u591a\u4e2a\u8fde\u63a5\u6570\u636e\u5e93\u7684\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0\u5c5e\u6027\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0default\uff1a\u8bbe\u7f6e\u9ed8\u8ba4\u4f7f\u7528\u7684\u73af\u5883\u7684id\n\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;environments default=\"mysql_test\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0environment\uff1a\u8bbe\u7f6e\u5177\u4f53\u7684\u8fde\u63a5\u6570\u636e\u5e93\u7684\u73af\u5883\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5c5e\u6027\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0id\uff1a\u8bbe\u7f6e\u73af\u5883\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u53ef\u5c06environments\u6807\u7b7e\u7684default\u5c5e\u6027\u8bbe\u7f6e\u4e3a\u67d0\u4e2a\u73af\u5883\u7684id\uff0c\u8868\u793a\u9ed8\u8ba4\u4f7f\u7528\u7684\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;environment id=\"mysql_test\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0transactionManager\uff1a\u8bbe\u7f6e\u4e8b\u52a1\u7ba1\u7406\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5c5e\u6027\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type\uff1a\u8bbe\u7f6e\u4e8b\u52a1\u7ba1\u7406\u65b9\u5f0f\uff0ctype=\"JDBC|MANAGED\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"JDBC\"\uff1a\u8bbe\u7f6e\u5f53\u524d\u73af\u5883\u7684\u4e8b\u52a1\u7ba1\u7406\u90fd\u5fc5\u987b\u624b\u52a8\u5904\u7406\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"MANAGED\"\uff1a\u8bbe\u7f6e\u4e8b\u52a1\u88ab\u7ba1\u7406\uff0c\u4f8b\u5982spring\u4e2d\u7684AOP\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;transactionManager type=\"JDBC\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataSource\uff1a\u8bbe\u7f6e\u6570\u636e\u6e90\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5c5e\u6027\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type\uff1a\u8bbe\u7f6e\u6570\u636e\u6e90\u7684\u7c7b\u578b\uff0ctype=\"POOLED|UNPOOLED|JNDI\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"POOLED\"\uff1a\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff0c\u5373\u4f1a\u5c06\u521b\u5efa\u7684\u8fde\u63a5\u8fdb\u884c\u7f13\u5b58\uff0c\u4e0b\u6b21\u4f7f\u7528\u53ef\u4ee5\u4ece\u7f13\u5b58\u4e2d\u76f4\u63a5\u83b7\u53d6\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u521b\u5efa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"UNPOOLED\"\uff1a\u4e0d\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff0c\u5373\u6bcf\u6b21\u4f7f\u7528\u8fde\u63a5\u90fd\u9700\u8981\u91cd\u65b0\u521b\u5efa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"JNDI\"\uff1a\u8c03\u7528\u4e0a\u4e0b\u6587\u4e2d\u7684\u6570\u636e\u6e90\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;dataSource type=\"POOLED\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u8bbe\u7f6e\u9a71\u52a8\u7c7b\u7684\u5168\u7c7b\u540d--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"driver\" value=\"${jdbc.driver}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u8bbe\u7f6e\u8fde\u63a5\u6570\u636e\u5e93\u7684\u8fde\u63a5\u5730\u5740--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"url\" value=\"${jdbc.url}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u8bbe\u7f6e\u8fde\u63a5\u6570\u636e\u5e93\u7684\u7528\u6237\u540d--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"username\" value=\"${jdbc.username}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u8bbe\u7f6e\u8fde\u63a5\u6570\u636e\u5e93\u7684\u5bc6\u7801--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"password\" value=\"${jdbc.password}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/dataSource&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/environment&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/environments&gt;\n\n\u00a0\u00a0\u00a0\u00a0`&lt;!--\u5f15\u5165\u6620\u5c04\u6587\u4ef6--&gt;`\n `&lt;mappers&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- &lt;mapper resource=\"UserMapper.xml\"/&gt; --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u4ee5\u5305\u4e3a\u5355\u4f4d\uff0c\u5c06\u5305\u4e0b\u6240\u6709\u7684\u6620\u5c04\u6587\u4ef6\u5f15\u5165\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u6ce8\u610f\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01. \u6b64\u65b9\u5f0f\u5fc5\u987b\u4fdd\u8bc1mapper\u63a5\u53e3\u548cmapper\u6620\u5c04\u6587\u4ef6\u5fc5\u987b\u5728\u76f8\u540c\u7684\u5305\u4e0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02. mapper\u63a5\u53e3\u8981\u548cmapper\u6620\u5c04\u6587\u4ef6\u7684\u540d\u5b57\u4e00\u81f4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;package name=\"com.atguigu.mybatis.mapper\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/mappers&gt;\n&lt;/configuration&gt;\n</code></pre> <p>2.\u5f15\u5165\u6620\u5c04\u6587\u4ef6 maven\u9ed8\u8ba4\u53ea\u4f1a\u6253\u5305\u8d44\u6e90\u76ee\u5f55\uff08src/main/resources\uff09\u4e0b\u9762\u7684\u6240\u6709\u6587\u4ef6\u5230target\uff0c\u800c\u4e0d\u4f1a\u5c06\u6e90\u7801\u76ee\u5f55\uff08src/main/java\uff09\u4e0b\u7684XML\u6587\u4ef6\u7b49\u8d44\u6e90\u6587\u4ef6\u6253\u5305\uff0c\u53ea\u4f1a\u5c06\u6e90\u7801\u76ee\u5f55\u4e2d\u7684Java\u6587\u4ef6\u8fdb\u884c\u7f16\u8bd1\u6253\u5305\u3002\u6240\u4ee5\u5982\u679c\u9700\u8981\u628aXML\u6587\u4ef6\u653e\u5728java\u76ee\u5f55\u4e0b\uff0c\u9700\u8981\u914d\u7f6epom.xml\u4e2d\u7684resources\u6807\u7b7e\uff0c\u6307\u5b9a\u6253\u5305\u65f6\u52a0\u5165src/main/java\u4e0b\u9762\u7684XML\u6587\u4ef6\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f \u8bbe\u7f6eresources\u6807\u7b7e\u4f1a\u8986\u76d6maven\u9ed8\u8ba4\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u6307\u5b9a\u6253\u5305\u8d44\u6e90\u76ee\u5f55\uff08src/main/resources\uff09\u4e0b\u9762\u7684\u6240\u6709\u6587\u4ef6\u3002 Text Only<pre><code>&lt;build&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;resources&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;resource&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;directory&gt;src/main/java&lt;/directory&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;includes&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;include&gt;**/*.xml&lt;/include&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/includes&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/resource&gt;\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;resource&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;directory&gt;src/main/resources&lt;/directory&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;includes&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;include&gt;**/*&lt;/include&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/includes&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/resource&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/resources&gt;\n&lt;/build&gt;\n</code></pre></p> <p>\u7f16\u8bd1\u4e4b\u540e\uff0c\u4e0d\u7ba1\u6620\u5c04\u6587\u4ef6\u662f\u5426\u548c\u63a5\u53e3\u5904\u4e8e\u540c\u4e00\u76ee\u5f55\u4e0b\uff0c\u662f\u5426\u540d\u5b57\u76f8\u540c\uff0c\u90fd\u9700\u8981\u5728\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u5f15\u5165\u6620\u5c04\u6587\u4ef6\u3002 1.\u5982\u679c\u4e0d\u5728\u540c\u4e00\u8def\u5f84\u4e0b\uff0c\u90a3\u4e48\u53ea\u80fd\u7528\u00a0\u6765\u5f15\u5165\u3002 2.\u5982\u679c\u5728\u540c\u4e00\u8def\u5f84\uff0c\u5e76\u4e14\u63a5\u53e3\u540d\u4e0e\u6620\u5c04\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u90a3\u4e48\u8fd8\u53ef\u4ee5\u7528\u00a0\u6765\u5f15\u5165\uff0c\u8fd9\u79cd\u65b9\u5f0f\u6bcf\u6b21\u53ea\u5f15\u5165\u4e00\u4e2a\u7c7b\u7684\u6620\u5c04\u6587\u4ef6\u3002\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\u5305\u540d\uff0c\u4e00\u6b21\u6027\u5f15\u5165\u5305\u4e0b\u9762\u7684\u6240\u6709XML\u6587\u4ef6\uff0c\u66f4\u52a0\u65b9\u4fbf\u3002</p> <p>3.\u7c7b\u578b\u522b\u540d MyBatis\u9ed8\u8ba4\u7684\u7c7b\u578b\u522b\u540d\uff1a  </p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/3.%E5%85%A5%E5%8F%82/","title":"3.\u5165\u53c2","text":"<p> \u7ea6 674 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>\u4e00\u3001\u83b7\u53d6\u53c2\u6570\u503c\u7684\u5199\u6cd5 MyBatis\u83b7\u53d6\u53c2\u6570\u503c\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a${}\u548c#{}\uff1a</p> <ul> <li>${} \u672c\u8d28\u662f \u5b57\u7b26\u4e32\u62fc\u63a5</li> <li> </li> </ul>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/3.%E5%85%A5%E5%8F%82/#_1","title":"{} \u672c\u8d28\u662f \u5360\u4f4d\u7b26\u8d4b\u503c","text":""},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/3.%E5%85%A5%E5%8F%82/#sqlsql","title":"{} \u548c \\({} \u7684\u533a\u522b\uff1a#{}\u662f\u4ee5\u9884\u7f16\u8bd1sql\u8bed\u53e5\u7684\u65b9\u5f0f\u8bbe\u7f6e\u503c\uff0c\\){}\u662f\u62fc\u63a5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u3002#{}\u53ef\u4ee5\u9632\u6b62SQL\u6ce8\u5165\uff0c\u6240\u4ee5\u7edd\u5927\u591a\u6570\u60c5\u51b5\u90fd\u662f\u4f18\u5148\u4f7f\u7528#{}\u3002","text":"<p>${}\u7684\u4f7f\u7528\u573a\u666f\u5c31\u662f\u5728\u9884\u7f16\u8bd1sql\u8bed\u53e5\u4e0d\u652f\u6301\u5360\u4f4d\u7b26\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5206\u8868\uff1a\u6bd4\u5982\u6309\u5e74\u4efd\u5206\u8868\u65f6\uff0cselect * from salary_${year};</li> <li>\u6392\u5e8f\uff1aselect * from employee order by ${name};</li> </ul> <p>\u5165\u53c2\u53ef\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a\u5355\u4e2a\u53c2\u6570\u00a0\u548c\u00a0\u591a\u4e2a\u53c2\u6570\u3002</p> <p>\u4e8c\u3001\u5355\u4e2a\u53c2\u6570 \u5982\u679c\u662f\u5355\u4e2a\u5b57\u9762\u91cf\uff0c\u76f4\u63a5\u5199#{\u53c2\u6570\u540d}\uff1b\u5982\u679c\u662f pojo\u6216\u8005Map\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u6210 #{\u5c5e\u6027\u540d}\u00a0\u6216\u8005 #{key}\u3002 1.\u5355\u4e2a\u5b57\u9762\u91cf Text Only<pre><code>&lt;!--User getUserByName(String name);--&gt;\n&lt;select id=\"getUserByUsername\" resultType=\"User\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user where username = #{name}\n&lt;/select&gt;\n</code></pre></p> <p>\u5982\u679c\u4f7f\u7528 \\({}\uff0c\u90a3\u4e48\u9700\u8981\u624b\u52a8\u52a0\u4e0a\u5355\u5f15\u53f7\u6216\u8005\u53cc\u5f15\u53f7\uff1a Text Only<pre><code>&lt;!--User getUserByUsername(String username);--&gt;\n&lt;select id=\"getUserByUsername\" resultType=\"User\"&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0select * from t_user where username = `'${username}'` \n&lt;/select&gt;\n</code></pre> \u5f53\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u4e2d\u6709\"\u53cc\u5f15\u53f7\u65f6\uff08name = \"zhang\\\\\"san\"\uff09\uff0c\u5fc5\u987b\u4f7f\u7528\u5355\u5f15\u53f7\uff0c\u5982\u679c\u4f7f\u7528\u53cc\u5f15\u53f7\u5219\u9700\u8981\u52a0\u4e0a\u8f6c\u4e49\u7b26\uff08name = \"zhang\\\\\\\\\\\\\"san\"\uff09\u3002\u540c\u7406\uff0c\u5f53\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u4e2d\u6709\u5355\u5f15\u53f7\u65f6\uff08name = \"zhang'san\"\uff09\uff0c\u5fc5\u987b\u4f7f\u7528\u53cc\u5f15\u53f7\uff0c\u5982\u679c\u4f7f\u7528\u5355\u5f15\u53f7\u5219\u9700\u8981\u52a0\u4e0a\u8f6c\u4e49\u7b26\uff08name = \"zhang\\\\\\\\'san\"\uff09\u3002\u53ef\u89c1\uff0c\u4f7f\u7528\\){}\u591a\u4e48\u7684\u9ebb\u70e6\u3002</p> <p>2.pojo Text Only<pre><code>&lt;!--int insertUser(User user);--&gt;\n&lt;insert id=\"insertUser\"&gt;\n\u00a0\u00a0\u00a0\u00a0insert into t_user values(null,`#{username},#{password},#{age},#{sex},#{email}`)\n&lt;/insert&gt;\n</code></pre></p> <p>3.map Text Only<pre><code>&lt;!--User checkLoginByMap(Map&lt;String,Object&gt; map);--&gt;\n&lt;select id=\"checkLoginByMap\" resultType=\"User\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user where `username = #{username} and password = #{password}`\n&lt;/select&gt;\n</code></pre></p> <p>\u4e09\u3001\u591a\u4e2a\u53c2\u6570 \u82e5mapper\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u6709\u591a\u4e2a\u53c2\u6570\uff0c\u9700\u8981\u4f7f\u7528arg0....argN \u6216\u8005 param1....paramN \u6765\u6307\u5b9a\u83b7\u53d6\u54ea\u4e2a\u53c2\u6570\u3002\u6ce8\u610f\uff0carg\u662f\u4ecearg0\u5f00\u59cb\u7684\uff0cparam\u662f\u4eceparam1\u5f00\u59cb\u7684\u3002 1.\u591a\u4e2a\u5b57\u9762\u91cf Text Only<pre><code>&lt;!--User checkLogin(String username,String password);--&gt;\n&lt;select id=\"checkLogin\" resultType=\"User\"&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0select * from t_user where username = `#{arg0} and password = #{arg1}` \n&lt;/select&gt;\n</code></pre> Text Only<pre><code>&lt;!--User checkLogin(String username,String password);--&gt;\n&lt;select id=\"checkLogin\" resultType=\"User\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user where username = `#{param1} and password = #{param2}`\n&lt;/select&gt;\n</code></pre></p> <p>2.\u6df7\u5408\u7684 Text Only<pre><code>&lt;!-- User queryUserByIdAndName(`Integer id, Map&lt;String, String&gt; map`); --&gt;\n&lt;select id=\"queryUserByIdAndName\" resultType=\"pojo.User\"&gt;\n\u00a0\u00a0select *\n\u00a0\u00a0from user\n\u00a0\u00a0where `id = #{arg0}`\n\u00a0\u00a0\u00a0\u00a0and `name = #{arg1.name}`\n&lt;/select&gt;\n</code></pre></p> <p>\u56db\u3001\u4f7f\u7528@Param\u6807\u8bc6\u53c2\u6570 \u4f7f\u7528arg0....argN \u6216\u8005 param1....paramN \u7684\u5199\u6cd5\u4e0d\u591f\u76f4\u89c2\uff0c\u4e3a\u907f\u514d\u8fd9\u79cd\u5199\u6cd5\uff0c\u53ef\u4f7f\u7528@Param\u6ce8\u89e3\u6807\u6ce8\u53c2\u6570\u7684\u540d\u5b57\uff0c\u5355\u4e2a\u53c2\u6570\u7684\u60c5\u51b5\u4e5f\u53ef\u4ee5\u4f7f\u7528@Param\u6ce8\u89e3\u3002 Text Only<pre><code>&lt;!-- User queryUserByIdAndName(Integer id, `@Param(\"map\") Map&lt;String, String&gt; map`); --&gt;\n&lt;select id=\"queryUserByIdAndName\" resultType=\"pojo.User\"&gt;\n\u00a0\u00a0select *\n\u00a0\u00a0from user\n\u00a0\u00a0where id = #{arg0}\n\u00a0\u00a0\u00a0\u00a0and name = `#{map.name}`\n&lt;/select&gt;\n</code></pre> \u6ce8\u610f\uff1a\u5bf9\u4e8e\u5355\u4e2a\u53c2\u6570\u7684pojo\u6216\u8005map\uff0c\u5982\u679c\u4f7f\u7528\u4e86@Param\uff0c\u90a3\u5c31\u5fc5\u987b\u4f7f\u7528#{xx.\u5b57\u6bb5\u540d}\u7684\u5f62\u5f0f\uff0c\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\u7684pojo\u7684\u5b57\u6bb5\u540d\u3002</p> <p>\u603b\u7ed3\uff0c\u5728\u5904\u7406\u53c2\u6570\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u62b9\u53bb\u53c2\u6570\u540d\uff0c\u6240\u4ee5\u5728XML\u6587\u4ef6\u4e2d\u9700\u8981\u4f7f\u7528 arg0 ... argN\u00a0\u7684\u5199\u6cd5\uff0c\u5728\u5355\u4e2a\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u53d8\u91cf\u540d\uff0c\u662f\u56e0\u4e3a\u8fd9\u65f6\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u600e\u4e48\u5199\u90fd\u80fd\u552f\u4e00\u786e\u5b9a\u3002jdk8\u4ee5\u540e\u5b57\u8282\u7801\u4e2d\u53ef\u4ee5\u4fdd\u5b58\u53c2\u6570\u540d\u4e86\uff0c\u4e8e\u662f\u53ef\u4ee5\u518dmybatis-config.xml\u6587\u4ef6\u914d\u7f6e\uff0c\u5e76\u914d\u5408\u5f00\u542f\u7f16\u8bd1\u9009\u9879-parameters\uff0c\u5c31\u4e0d\u9700\u8981\u518d\u7528@Param\u6307\u5b9amap\u7684key\u4e86\uff0c\u76f4\u63a5\u7528#{\u53c2\u6570\u540d}\u53d6\u5c31\u53ef\u4ee5\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/4.%E5%8A%A8%E6%80%81SQL/","title":"4.\u52a8\u6001SQL","text":"<p> \u7ea6 624 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u52a8\u6001SQL\u6280\u672f\u662f\u4e00\u79cd\u6839\u636e\u7279\u5b9a\u6761\u4ef6\u52a8\u6001\u62fc\u88c5SQL\u8bed\u53e5\u7684\u529f\u80fd\uff0c\u501f\u52a9 OGNL \u7684\u8868\u8fbe\u5f0f\u5b9e\u73b0\u3002</p> <p>\u4e00\u3001if if\u6807\u7b7e\u5bf9test\u5c5e\u6027\u7684\u8868\u8fbe\u5f0f\u8fdb\u884c\u5224\u65ad\uff0c\u82e5\u7ed3\u679c\u4e3atrue\uff0c\u5219\u6807\u7b7e\u4e2d\u7684\u5185\u5bb9\u4f1a\u88ab\u62fc\u63a5\uff1b\u53cd\u4e4b\u4e0d\u4f1a\u3002test\u00a0\u91cc\u9762\u53ef\u4ee5\u76f4\u63a5\u5199empName\uff0c\u4e5f\u53ef\u4ee5\u5199\u6210#{empName}\u3002 \u5728where\u540e\u9762\u6dfb\u52a0\u4e00\u4e2a\u6052\u6210\u7acb\u6761\u4ef6 1=1 \u00a0\u53ef\u4ee5\u7528\u6765\u62fc\u63a5and\u8bed\u53e5\uff0c\u8fd9\u4e2a\u6052\u6210\u7acb\u6761\u4ef6\u5e76\u4e0d\u4f1a\u5f71\u54cd\u67e5\u8be2\u7684\u7ed3\u679c\u3002 Text Only<pre><code>&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;\n&lt;select id=\"getEmpByCondition\" resultType=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp where 1=1\n\u00a0\u00a0\u00a0\u00a0&lt;if test=\"empName != null and empName !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and emp_name = #{empName}\n\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;if test=\"age != null and age !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and age = #{age}\n\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;if test=\"sex != null and sex !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and sex = #{sex}\n\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;if test=\"email != null and email !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and email = #{email}\n\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n&lt;/select&gt;\n</code></pre></p> <p>\u4e8c\u3001choose\u3001when\u3001otherwise choose\u3001when\u3001otherwise\u76f8\u5f53\u4e8eif...else if..else\uff0c\u53ea\u4f1a\u6210\u7acb\u4e00\u4e2a\uff0cwhen\u81f3\u5c11\u8981\u6709\u4e00\u4e2a\uff0cotherwise\u81f3\u591a\u53ea\u6709\u4e00\u4e2a\u3002 Text Only<pre><code>&lt;select id=\"getEmpByChoose\" resultType=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp\n\u00a0\u00a0\u00a0\u00a0&lt;where&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;choose&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;when test=\"empName != null and empName != ''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0emp_name = #{empName}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/when&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;when test=\"age != null and age != ''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0age = #{age}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/when&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;when test=\"sex != null and sex != ''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sex = #{sex}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/when&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;when test=\"email != null and email != ''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0email = #{email}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/when&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;otherwise&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0did = 1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/otherwise&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/choose&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/where&gt;\n&lt;/select&gt;\n</code></pre></p> <p>\u4e09\u3001where where\u4e00\u822c\u548cif\u7ed3\u5408\u4f7f\u7528\uff0c\u5982\u679cwhere\u6807\u7b7e\u4e2d\u7684if\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u5219where\u6807\u7b7e\u6ca1\u6709\u4efb\u4f55\u529f\u80fd\uff0c\u5373\u4e0d\u4f1a\u6dfb\u52a0where\u5173\u952e\u5b57\uff1b\u5982\u679cwhere\u6807\u7b7e\u4e2d\u7684if\u6761\u4ef6\u6ee1\u8db3\uff0c\u5219where\u6807\u7b7e\u4f1a\u81ea\u52a8\u6dfb\u52a0where\u5173\u952e\u5b57\uff0c\u5e76\u5c06\u6761\u4ef6\u6700\u524d\u65b9\u591a\u4f59\u7684and/or\u53bb\u6389\uff0c\u4f46\u4e0d\u80fd\u53bb\u6389\u6761\u4ef6\u540e\u591a\u4f59\u7684and/or\u3002\u6ce8\u610f\uff0c\u53ea\u6709where\u6807\u7b7e\uff0c\u6ca1\u6709from\u3001group by\u3001having\u7b49\u5176\u4ed6\u5173\u952e\u5b57\u6807\u7b7e\u3002 Text Only<pre><code>&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;\n&lt;select id=\"getEmpByCondition\" resultType=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp\n `&lt;where&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"empName != null and empName !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0emp_name = #{empName}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"age != null and age !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and age = #{age}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"sex != null and sex !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and sex = #{sex}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"email != null and email !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and email = #{email}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/where&gt;\n&lt;/select&gt;\n</code></pre></p> <p>\u56db\u3001trim trim\u7528\u4e8e\u6dfb\u52a0\u6216\u53bb\u6389\u6807\u7b7e\u4e2d\u7684\u5185\u5bb9\uff0c\u5e38\u7528\u5c5e\u6027\uff1a prefix\uff1a\u5728\u6700\u524d\u9762\u6dfb\u52a0\u6307\u5b9a\u7684\u5185\u5bb9 suffix\uff1a\u5728\u6700\u540e\u9762\u6dfb\u52a0\u6307\u5b9a\u7684\u5185\u5bb9 prefixOverrides\uff1a\u53bb\u6389\u6700\u524d\u9762\u6307\u5b9a\u7684\u5185\u5bb9\uff08\u5982\u679c\u6709\uff09 suffixOverrides\uff1a\u53bb\u6389\u6700\u540e\u9762\u6307\u5b9a\u7684\u5185\u5bb9\uff08\u5982\u679c\u6709\uff09 Text Only<pre><code>&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;\n&lt;select id=\"getEmpByCondition\" resultType=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp\n `&lt;trim prefix=\"where\" suffixOverrides=\"and|or\"&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"empName != null and empName !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0emp_name = #{empName} and\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"age != null and age !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0age = #{age} and\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"sex != null and sex !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sex = #{sex} or\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"email != null and email !=''\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0email = #{email}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/trim&gt;\n&lt;/select&gt;\n</code></pre></p> <p>\u4e94\u3001foreach \u5c5e\u6027\uff1a</p> <ul> <li>collection\uff1a\u8bbe\u7f6e\u8981\u5faa\u73af\u7684\u6570\u7ec4\u6216\u96c6\u5408</li> <li>item\uff1a\u8868\u793a\u96c6\u5408\u6216\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6570\u636e</li> <li>separator\uff1a\u8bbe\u7f6e\u5faa\u73af\u4f53\u4e4b\u95f4\u7684\u5206\u9694\u7b26\uff0c\u5206\u9694\u7b26\u524d\u540e\u9ed8\u8ba4\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u5982,</li> <li>open\uff1a\u8bbe\u7f6eforeach\u6807\u7b7e\u4e2d\u7684\u5185\u5bb9\u7684\u5f00\u59cb\u7b26</li> <li>close\uff1a\u8bbe\u7f6eforeach\u6807\u7b7e\u4e2d\u7684\u5185\u5bb9\u7684\u7ed3\u675f\u7b26</li> </ul> <p>\u6279\u91cf\u5220\u9664\uff1a Text Only<pre><code>&lt;!--int deleteMoreByArray(Integer[] eids);--&gt;\n&lt;delete id=\"deleteMoreByArray\"&gt;\n\u00a0\u00a0\u00a0\u00a0delete from t_emp where eid in\n\u00a0\u00a0\u00a0\u00a0&lt;foreach collection=\"eids\" item=\"eid\" separator=\",\" open=\"(\" close=\")\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#{eid}\n\u00a0\u00a0\u00a0\u00a0&lt;/foreach&gt;\n&lt;/delete&gt;\n</code></pre></p> <p>\u6279\u91cf\u6dfb\u52a0 Text Only<pre><code>&lt;insert id=\"insertMoreByList\"&gt;\n\u00a0\u00a0\u00a0\u00a0insert into t_emp values\n\u00a0\u00a0\u00a0\u00a0&lt;foreach collection=\"emps\" item=\"emp\" separator=\",\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(null,#{emp.empName},#{emp.age},#{emp.sex},#{emp.email},null)\n\u00a0\u00a0\u00a0\u00a0&lt;/foreach&gt;\n&lt;/insert&gt;\n</code></pre></p> <p>\u516d\u3001SQL\u7247\u6bb5 \u7528\u4e8e\u8bb0\u5f55\u4e00\u6bb5\u516c\u5171sql\u7247\u6bb5\uff0c\u5728\u4efb\u4f55\u9700\u8981\u4f7f\u7528\u7684\u5730\u65b9\u901a\u8fc7include\u6807\u7b7e\u8fdb\u884c\u5f15\u5165\u3002 \u58f0\u660esql\u7247\u6bb5\uff1a\u6807\u7b7e Text Only<pre><code>&lt;sql id=\"empColumns\"&gt;eid,emp_name,age,sex,email&lt;/sql&gt;\n</code></pre> \u5f15\u7528sql\u7247\u6bb5\uff1a\u6807\u7b7e Text Only<pre><code>&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;\n&lt;select id=\"getEmpByCondition\" resultType=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0select `&lt;include refid=\"empColumns\"&gt;&lt;/include&gt;` from t_emp\n&lt;/select&gt;\n</code></pre> <p>\u4e03\u3001set set \u6807\u7b7e\u4f1a\u52a8\u6001\u5730\u5728\u884c\u9996\u63d2\u5165 SET \u5173\u952e\u5b57\uff0c\u5e76\u4f1a\u5220\u6389\u989d\u5916\u7684\u9017\u53f7\u3002\u6bd4\u5982\uff1a Text Only<pre><code>&lt;!-- int updateById(@Param(\"stu\") Student student); --&gt;\n&lt;update id=\"updateById\"&gt;\n\u00a0\u00a0\u00a0\u00a0update public.student\n\u00a0\u00a0\u00a0\u00a0&lt;set&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"#{stu.id} != null\"&gt;id=#{stu.id},&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"#{stu.name} != null\"&gt;name=#{stu.name},&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"#{stu.sex} != null\"&gt;sex=#{stu.sex},&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"#{stu.className} != null\"&gt;class_name=#{stu.className}&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/set&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;where&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"#{stu.id} != null\"&gt;id=#{stu.id}&lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/where&gt;\n&lt;/update&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/5.%E8%BF%94%E5%9B%9E%E5%80%BC%20-%20%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%8C%E6%95%B0/","title":"5.\u8fd4\u56de\u503c - \u6570\u636e\u7684\u884c\u6570","text":"<p> \u7ea6 334 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>\u8fd4\u56de\u503c\u7684\u884c\u6570\u53ef\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u589e\u5220\u6539\u7684\u8fd4\u56de\u503c\uff1a\u589e\u5220\u6539\u6807\u7b7e\u4e0d\u7528\u5199resultType\uff0c\u5982\u679c\u63a5\u53e3\u7684\u65b9\u6cd5\u6709\u8fd4\u56de\u503c\uff0c\u90a3\u4e48MyBatis\u6839\u636e\u5f71\u54cd\u7684\u884c\u6570\u81ea\u52a8\u5224\u65ad\uff0c\u5982\u679c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662fboolean\uff0c\u5c31\u8f6c\u6362\u6210true\u6216\u8005false\uff0c\u5982\u679c\u662fint\uff0c\u5c31\u662f\u5f71\u54cd\u7684\u884c\u6570 \u3002</li> <li>\u67e5\u8be2\u7684\u8fd4\u56de\u503c\u6709\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a<ul> <li>\u5355\u884c\u6570\u636e</li> <li>\u591a\u884c\u6570\u636e</li> </ul> </li> </ul> <p>\u4e00\u3001\u5355\u884c\u6570\u636e 1.\u5982\u679c\u662f\u5355\u4e2a\u5b57\u9762\u91cf\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\u00a0\u6216\u8005\u00a0\u5305\u88c5\u7c7b\u578b\u00a0\u63a5\u6536 Text Only<pre><code>&lt;!--\nint getCount();\n\u5728MyBatis\u4e2d\uff0c\u5bf9\u4e8eJava\u4e2d\u5e38\u7528\u7684\u7c7b\u578b\u90fd\u8bbe\u7f6e\u4e86\u7c7b\u578b\u522b\u540d\u00a0\u00a0\n\u4f8b\u5982\uff1ajava.lang.Integer--&gt;int|integer\u00a0\u00a0\n\u00a0 \u00a0 \u00a0int--&gt;_int|_integer\u00a0\u00a0\n\u00a0 \u00a0 \u00a0Map--&gt;map,List--&gt;list\u00a0\u00a0\n--&gt;\n&lt;select id=\"getCount\" `resultType=\"_integer\"`&gt;\n\u00a0\u00a0\u00a0\u00a0select count(id) from t_user\n&lt;/select&gt;\n</code></pre></p> <p>2.\u7528\u5b9e\u4f53\u7c7b\u5c01\u88c5 Text Only<pre><code>&lt;!--User getUserById(@Param(\"id\") int id);--&gt;\n&lt;select id=\"getUserById\" resultType=\"User\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user where id = #{id}\n&lt;/select&gt;\n</code></pre></p> <p>3.\u7528Map\u5c01\u88c5 Text Only<pre><code>&lt;!--Map&lt;String, Object&gt; getUserToMap(@Param(\"id\") int id);--&gt;\n&lt;select id=\"getUserToMap\" resultType=\"map\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user where id = #{id}\n&lt;/select&gt;\n&lt;!--\u7ed3\u679c\uff1a\n`{password=123456, sex=\u7537, id=1, age=23, username=admin}`\n--&gt;\n</code></pre></p> <p>\u4e8c\u3001\u591a\u884c\u6570\u636e \u591a\u884c\u6570\u636e\u53ef\u4ee5\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\u63a5\u6536\uff1a</p> <ul> <li>\u4f7f\u7528List\u96c6\u5408\uff08\u6700\u5e38\u7528\uff09</li> <li>\u5728\u63a5\u53e3\u7684\u65b9\u6cd5\u4e0a\u6dfb\u52a0@MapKey\u6ce8\u89e3\uff0c\u4f7f\u7528Map\u63a5\u6536</li> </ul> <p>\u5176\u4e2d\u7b2c\u4e00\u79cd\u6700\u5e38\u7528\uff0c\u7b2c\u4e8c\u79cd\u57fa\u672c\u4e0d\u7528\u3002 resultType\u4ecd\u7136\u662f\u5199\u6bcf\u884c\u6570\u636e\u7684\u5c01\u88c5\u65b9\u5f0f\u3002</p> <p>1.\u4f7f\u7528List\u96c6\u5408\u63a5\u6536\uff0c\u4f7f\u7528\u5b9e\u4f53\u7c7b\u5c01\u88c5\u6bcf\u884c\u6570\u636e Text Only<pre><code>&lt;!--`List&lt;User&gt;` getUserList();--&gt;\n&lt;select id=\"getUserList\" resultType=\"User\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user\n&lt;/select&gt;\n</code></pre></p> <p>2.\u4f7f\u7528List\u96c6\u5408\u63a5\u6536\uff0c\u4f7f\u7528Map\u5c01\u88c5\u6bcf\u884c\u6570\u636e Text Only<pre><code>&lt;!--Map&lt;String, Object&gt; getAllUserToMap();--&gt;\u00a0\u00a0\n&lt;select id=\"getAllUserToMap\" resultType=\"map\"&gt;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0select * from t_user\u00a0\u00a0\n&lt;/select&gt;\n`&lt;!--`\n `\u7ed3\u679c\uff1a`\n `[`\n `{password=123456, sex=\u7537, id=1, age=23, username=admin},`\n `{password=123456, sex=\u7537, id=2, age=23, username=\u5f20\u4e09},`\n `{password=123456, sex=\u7537, id=3, age=23, username=\u5f20\u4e09}`\n `]`\n`--&gt;`\n</code></pre></p> <p>3.\u4f7f\u7528Map\u63a5\u6536\uff0c\u4f7f\u7528\u5b9e\u4f53\u7c7b\u5c01\u88c5\u6bcf\u884c\u6570\u636e Text Only<pre><code>&lt;!--\n//@MapKey\u6ce8\u89e3\u8bbe\u7f6emap\u96c6\u5408\u7684\u952e\uff0c\u503c\u662f\u6bcf\u6761\u6570\u636e\u5c01\u88c5\u5f97\u5230\u7684User\n@MapKey(\"id\")\nMap&lt;String, User&gt; getAllUserToMap();\n--&gt;\n&lt;select id=\"getAllUserToMap\" resultType=\"User\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user\n&lt;/select&gt;\n&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u7ed3\u679c\uff1a\n\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01=User(password=123456, sex=\u7537, id=1, age=23, username=admin),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02=User(password=123456, sex=\u7537, id=2, age=23, username=\u5f20\u4e09),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03=User(password=123456, sex=\u7537, id=3, age=23, username=\u5f20\u4e09)\n\u00a0\u00a0\u00a0\u00a0}\n--&gt;\n</code></pre></p> <p>4.\u4f7f\u7528Map\u63a5\u6536\uff0c\u4f7f\u7528Map\u5c01\u88c5\u6bcf\u884c\u6570\u636e Text Only<pre><code>&lt;!--\n//`@MapKey\u6ce8\u89e3\u8bbe\u7f6emap\u96c6\u5408\u7684\u952e`\uff0c\u503c\u662f\u6bcf\u6761\u6570\u636e\u6240\u5c01\u88c5\u5f97\u5230\u7684map\n@MapKey(\"id\")\nMap&lt;String, Map&lt;String, Object&gt;&gt; getAllUserToMap();\n--&gt;\n&lt;select id=\"getAllUserToMap\" resultType=\"map\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_user\n&lt;/select&gt;\n`&lt;!--`\n `\u7ed3\u679c\uff1a`\n `{`\n `1={password=123456, sex=\u7537, id=1, age=23, username=admin},`\n `2={password=123456, sex=\u7537, id=2, age=23, username=\u5f20\u4e09},`\n `3={password=123456, sex=\u7537, id=3, age=23, username=\u5f20\u4e09}`\n `}`\n`--&gt;`\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/6.%E8%BF%94%E5%9B%9E%E5%80%BC%20-%20resultType%20%E5%92%8C%20resultMap/","title":"6.\u8fd4\u56de\u503c - resultType \u548c resultMap","text":"<p> \u7ea6 1763 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 35 \u5206\u949f</p> <p>select\u6807\u7b7e\u5fc5\u987b\u8bbe\u7f6e\u5c5e\u6027resultType\u6216resultMap\uff0c\u7528\u4e8e\u8bbe\u7f6e\u5b9e\u4f53\u7c7b\u4e0e\u6570\u636e\u5e93\u8868\u4e00\u884c\u6570\u636e\u7684\u6620\u5c04\u5173\u7cfb\uff08\u56e0\u4e3a\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\u3001\u5305\u88c5\u6570\u636e\u7c7b\u578b\u3001Map\u7684\u5c01\u88c5\u89c4\u5219\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u4e3b\u8981\u662f\u5173\u4e8e\u5b9e\u4f53\u7c7b\u8fd4\u56de\u503c\u7c7b\u578b\u7684\u5c01\u88c5\u89c4\u5219\uff09\u3002</p> <ul> <li>resultType\uff1a\u81ea\u52a8\u6620\u5c04\uff0c\u7528\u4e8e\u5c5e\u6027\u540d\u548c\u8868\u4e2d\u5217\u540d\u4e00\u81f4\u7684\u60c5\u51b5\u3002</li> <li>resultMap\uff1a\u81ea\u5b9a\u4e49\u6620\u5c04\uff0c\u7528\u4e8e\u5c5e\u6027\u540d\u548c\u8868\u4e2d\u5217\u540d\u4e0d\u4e00\u81f4\u3001\u4e00\u5bf9\u591a\u3001\u591a\u5bf9\u4e00 \u7684\u60c5\u51b5\u3002</li> </ul> <p>\u4e00\u3001resultType resultType\u7528\u4e8e\u5c5e\u6027\u540d\u548c\u8868\u4e2d\u5217\u540d\u4e00\u81f4\u7684\u60c5\u51b5\u3002\u5982\u679cresultType\u8bbe\u7f6e\u4e3aMap\uff0c\u90a3\u4e48\u4e00\u4e2aMap\u5bf9\u8c61\u5bf9\u5e94\u6570\u636e\u5e93\u4e2d\u4e00\u6761\u6570\u636e\uff0c\u5217\u540d\u8bbe\u7f6e\u4e3akey\uff0c\u503c\u8bbe\u7f6e\u4e3avalue\u3002</p> <p>\u5728 \u5217\u540d \u548c \u5b9e\u4f53\u7c7b\u7684\u5c5e\u6027\u540d \u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u4e0b\u4ecd\u8981\u4f7f\u7528resultType\uff0c\u6b64\u65f6\u53ef\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u5904\u7406\u5217\u540d\u548c\u5b9e\u4f53\u7c7b\u5c5e\u6027\u7684\u6620\u5c04\u5173\u7cfb\uff1a</p> <ul> <li>\u5982\u679c\u8868\u7684\u5217\u540d\u4f7f\u7528_\u4e0b\u5212\u7ebf\u7684\u89c4\u5219\uff0c\u5b9e\u4f53\u7c7b\u7684\u5c5e\u6027\u540d\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d\u89c4\u5219\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5728MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684setting\u6807\u7b7e\u4e2d\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u5168\u5c40\u914d\u7f6e\u4fe1\u606fmapUnderscoreToCamelCase\uff0c\u53ef\u4ee5\u5728\u67e5\u8be2\u8868\u4e2d\u6570\u636e\u65f6\uff0c\u81ea\u52a8\u5c06_\u7c7b\u578b\u7684\u5b57\u6bb5\u540d\u8f6c\u6362\u4e3a\u9a7c\u5cf0\uff0c\u4f8b\u5982\uff1a\u5c06\u5217\u540duser_name\u6620\u5c04\u6210\u5c5e\u6027\u540duserName\u3002</li> </ul> Text Only<pre><code>&lt;settings&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;setting name=\"mapUnderscoreToCamelCase\" value=\"true\"/&gt;\n&lt;/settings&gt;\n</code></pre> <ul> <li>\u4e3a\u5217\u8d77\u522b\u540d\uff0c\u4fdd\u8bc1\u548c\u5b9e\u4f53\u7c7b\u4e2d\u7684\u5c5e\u6027\u540d\u4fdd\u6301\u4e00\u81f4</li> </ul> Text Only<pre><code>&lt;!--List&lt;Emp&gt; getAllEmp();--&gt;\n&lt;select id=\"getAllEmp\" resultType=\"Emp\"&gt;\n\u00a0\u00a0 \u00a0select\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0eid,\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0`emp_name as empName,`\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0age\n\u00a0\u00a0 \u00a0from\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0t_emp\n&lt;/select&gt;\n</code></pre> <p>\u4e8c\u3001resultMap resultMap\u7528\u4e8e\u8bbe\u7f6e\u8868\u7684\u5217\u540d\u00a0\u4e0e\u00a0\u5b9e\u4f53\u7c7b\u5c5e\u6027\u00a0\u7684\u6620\u5c04\u5173\u7cfb\u3002 resultMap\u5c5e\u6027\uff1a</p> <ul> <li>id\uff1a\u8868\u793a\u81ea\u5b9a\u4e49\u6620\u5c04\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u4e0d\u80fd\u91cd\u590d</li> <li>type\uff1a\u67e5\u8be2\u7684\u6570\u636e\u8981\u6620\u5c04\u7684\u5b9e\u4f53\u7c7b</li> </ul> <p>\u5b50\u6807\u7b7e\uff1a</p> <ul> <li>id\uff1a\u8bbe\u7f6e\u4e3b\u952e\u7684\u6620\u5c04\u5173\u7cfb</li> <li>result\uff1a\u8bbe\u7f6e\u666e\u901a\u5b57\u6bb5\u7684\u6620\u5c04\u5173\u7cfb</li> <li>\u5b50\u6807\u7b7e\u5c5e\u6027\uff1a<ul> <li>property\uff1a\u8bbe\u7f6e\u6620\u5c04\u5173\u7cfb\u4e2d\u5b9e\u4f53\u7c7b\u4e2d\u7684\u5c5e\u6027\u540d</li> <li>column\uff1a\u8bbe\u7f6e\u6620\u5c04\u5173\u7cfb\u4e2d\u8868\u4e2d\u7684\u5b57\u6bb5\u540d</li> </ul> </li> </ul> <p>1.\u6bd4\u5982\u5982\u679c\u4e0d\u4f7f\u7528 as\u00a0\u4e3a\u5217\u53d6\u522b\u540d\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528resultMap\u6765\u8bbe\u7f6e\u6620\u5c04\u5173\u7cfb\uff1a Text Only<pre><code>&lt;resultMap `id``=\"stuResultMap\"` type=\"cn.ctyun.pojo.Student\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id column=\"id\" property=\"id\" &gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result column=\"name\" property=\"name\" &gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result column=\"sex\" property=\"sex\" &gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0 `&lt;result column=\"class_name\" property=\"className\" &gt;&lt;/result&gt;`\n&lt;/resultMap&gt;\n&lt;!--List&lt;Student&gt; getAllStudent();--&gt;\n&lt;select id=\"getAllStudent\" `resultMap=\"stuResultMap\"`&gt;\n\u00a0\u00a0\u00a0\u00a0select * from Student\n&lt;/select&gt;\n</code></pre></p> <p>2.\u5c06 \u591a\u5217\u6570\u636e \u6620\u5c04\u5230 \u5b9e\u4f53\u7c7b\u7684\u4e00\u4e2a\u5c5e\u6027 \u6bd4\u5982\u5c06\u67e5\u8be2\u5230\u7684\u90e8\u95e8\u4fe1\u606f\u5c01\u88c5\u5230dept\u5b57\u6bb5\u4e2d Text Only<pre><code>public class Emp {\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0private Integer eid;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0private String empName;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0private Integer age;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0private String sex;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0private String email;\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0`private Dept dept;`\n\u00a0\u00a0\u00a0\u00a0//...\u6784\u9020\u5668\u3001get\u3001set\u65b9\u6cd5\u7b49\n}\n</code></pre> \u5199\u6cd5\u4e00\uff1a Text Only<pre><code>&lt;resultMap id=\"empAndDeptResultMapOne\" type=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id property=\"eid\" column=\"eid\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"empName\" column=\"emp_name\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"age\" column=\"age\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"sex\" column=\"sex\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"email\" column=\"email\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0 `&lt;result property=\"dept.did\" column=\"did\"&gt;&lt;/result&gt;`\n `&lt;result property=\"dept.deptName\" column=\"dept_name\"&gt;&lt;/result&gt;`\n&lt;/resultMap&gt;\n&lt;!--Emp getEmpAndDept(@Param(\"eid\")Integer eid);--&gt;\n&lt;select id=\"getEmpAndDept\" resultMap=\"empAndDeptResultMapOne\"&gt;\n\u00a0\u00a0\u00a0\u00a0select *\n\u00a0\u00a0 \u00a0from t_emp\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0left join t_dept\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0on t_emp.eid = t_dept.did\n\u00a0\u00a0 \u00a0where t_emp.eid = #{eid}\n&lt;/select&gt;\n</code></pre></p> <p>\u5199\u6cd5\u4e8c\uff1a\u4f7f\u7528association\u6807\u7b7e</p> <ul> <li>property\uff1a\u5c5e\u6027\u540d</li> <li>javaType\uff1a\u5c5e\u6027\u7c7b\u578b</li> </ul> Text Only<pre><code>&lt;resultMap id=\"empAndDeptResultMapTwo\" type=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id property=\"eid\" column=\"eid\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"empName\" column=\"emp_name\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"age\" column=\"age\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"sex\" column=\"sex\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"email\" column=\"email\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0`&lt;association property=\"dept\" javaType=\"Dept\"&gt;`\n `&lt;id property=\"did\" column=\"did\"&gt;&lt;/id&gt;`\n `&lt;result property=\"deptName\" column=\"dept_name\"&gt;&lt;/result&gt;`\n `&lt;/association&gt;`\n&lt;/resultMap&gt;\n&lt;!--Emp getEmpAndDept(@Param(\"eid\")Integer eid);--&gt;\n&lt;select id=\"getEmpAndDept\" resultMap=\"empAndDeptResultMapTwo\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp left join t_dept on t_emp.eid = t_dept.did where t_emp.eid = #{eid}\n&lt;/select&gt;\n</code></pre> <p>\u5199\u6cd5\u4e09\uff1a\u4f7f\u7528association\u6807\u7b7e\u8fdb\u884c\u5206\u6b65\u67e5\u8be2 \u5c31\u662fSQL\u5b50\u67e5\u8be2\u7684\u5199\u6cd5\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u76f8\u5f53\u4e8e\u628a\u5b50\u67e5\u8be2\u5957\u5728\u4e86\u8bbe\u4e86select\u4e2d\u3002 \u7b2c\u4e00\u6b65\uff1a\u67e5\u8be2\u5458\u5de5\u4fe1\u606f</p> <ul> <li>column\uff1a\u628acolumn\u7684\u503c\u4f5c\u4e3a\u5165\u53c2\u8c03\u7528\u7b2c\u4e8c\u6b65\u7684\u67e5\u8be2</li> <li>select\uff1a\u8bbe\u7f6e\u7b2c\u4e8c\u6b65\u67e5\u8be2\u7684sql\uff0c\u5373 mapper\u63a5\u53e3\u7684 &lt;\u5168\u7c7b\u540d.\u65b9\u6cd5\u540d&gt;</li> </ul> Text Only<pre><code>&lt;resultMap id=\"`empAndDeptByStepResultMap`\" type=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id property=\"eid\" column=\"eid\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"empName\" column=\"emp_name\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"age\" column=\"age\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"sex\" column=\"sex\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"email\" column=\"email\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;association property=\"dept\" `column=\"did\"`\n `select=\"com.atguigu.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo\"&gt;`\n\u00a0\u00a0\u00a0\u00a0&lt;/association&gt;\n&lt;/resultMap&gt;\n&lt;!--Emp getEmpAndDeptByStepOne(@Param(\"eid\") Integer eid);--&gt;\n&lt;select id=\"getEmpAndDeptByStepOne\" resultMap=\"`empAndDeptByStepResultMap`\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp where eid = #{eid}\n&lt;/select&gt;\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff1a\u67e5\u8be2\u90e8\u95e8\u4fe1\u606f \u8fd9\u4e2a\u5b50\u67e5\u8be2\u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u67e5\u8be2\uff0c\u5982\u679c\u4e4b\u524d\u5c31\u5df2\u7ecf\u6709\u4e86\uff0c\u53ef\u4ee5\u88ab\u73b0\u5728\u8fd9\u4e2a\u9700\u6c42\u590d\u7528\uff0c\u8fd9\u79cd\u5206\u6b65\u67e5\u8be2\u7684\u53ef\u8bfb\u6027\u771f\u7684\u5f88\u5dee\uff0c\u9664\u4e86\u53ef\u4ee5\u590d\u7528\u4e4b\u524d\u5199\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u4e0d\u7136\u771f\u7684\u60f3\u4e0d\u5230\u8fd9\u79cd\u5199\u6cd5\u7684\u4f18\u52bf\u4e86\u3002 Text Only<pre><code>&lt;!--\u6b64\u5904\u7684resultMap\u4ec5\u662f\u5904\u7406\u5b57\u6bb5\u548c\u5c5e\u6027\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4e0d\u662f\u5206\u6b65\u67e5\u8be2\u6240\u5fc5\u8981\u7684--&gt;\n&lt;resultMap id=\"EmpAndDeptByStepTwoResultMap\" type=\"Dept\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id property=\"did\" column=\"did\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"deptName\" column=\"dept_name\"&gt;&lt;/result&gt;\n&lt;/resultMap&gt;\n&lt;!--Dept `getEmpAndDeptByStepTwo`(@Param(\"did\") Integer did);--&gt;\n&lt;select id=\"getEmpAndDeptByStepTwo\" resultMap=\"EmpAndDeptByStepTwoResultMap\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_dept where did = #{did}\n&lt;/select&gt;\n</code></pre></p> <p>3.\u5c06 \u591a\u884c\u6570\u636e \u6620\u5c04\u5230 \u5b9e\u4f53\u7c7b\u7684\u4e00\u4e2a\u5c5e\u6027\u4e0a \u76f8\u6bd4\u4e8e\u524d\u9762\uff0c\u8fd9\u91cc\u4e0d\u4ec5\u9700\u8981\u5c06\u00a0\u591a\u5217\u6c47\u805a\u5230\u4e00\u4e2a\u5b9e\u4f53\u7c7b\u4e2d\uff0c\u8fd8\u8981\u5c06\u591a\u884c\u6570\u636e\u6c47\u805a\u5230List\u4e2d\u3002</p> <p>\u6bd4\u5982\u67e5\u8be2\u4e00\u4e2a\u90e8\u95e8\u7684\u6240\u6709\u5458\u5de5 Text Only<pre><code>public class Dept {\n\u00a0\u00a0\u00a0\u00a0private Integer did;\n\u00a0\u00a0\u00a0\u00a0private String deptName;\n\u00a0\u00a0\u00a0 `private List&lt;Emp&gt; emps;`\n\u00a0\u00a0\u00a0\u00a0//...\u6784\u9020\u5668\u3001get\u3001set\u65b9\u6cd5\u7b49\n}\n</code></pre></p> <p>\u5199\u6cd5\u4e00\uff1a\u4f7f\u7528collection\u6807\u7b7e</p> <ul> <li>collection\uff1a\u96c6\u5408</li> <li>ofType\uff1a\u96c6\u5408\u4e2d\u5143\u7d20\u7684\u7c7b\u578b</li> </ul> <p>\u76f8\u5f53\u4e8eMyBatis\u81ea\u52a8\u6dfb\u52a0\u4e86group by\uff0c\u7136\u540e\u8fdb\u884c\u805a\u5408\u3002 Text Only<pre><code>&lt;resultMap id=\"DeptAndEmpResultMap\" type=\"Dept\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id property=\"did\" column=\"did\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"deptName\" column=\"dept_name\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0 `&lt;collection property=\"emps\" ofType=\"Emp\"&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;id property=\"eid\" column=\"eid\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;result property=\"empName\" column=\"emp_name\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;result property=\"age\" column=\"age\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;result property=\"sex\" column=\"sex\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;result property=\"email\" column=\"email\"&gt;&lt;/result&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/collection&gt;\n&lt;/resultMap&gt;\n&lt;!--Dept getDeptAndEmp(@Param(\"did\") Integer did);--&gt;\n&lt;select id=\"getDeptAndEmp\" resultMap=\"DeptAndEmpResultMap\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_dept left join t_emp on t_dept.did = t_emp.did where t_dept.did = #{did}\n&lt;/select&gt;\n</code></pre></p> <p>\u5199\u6cd5\u4e8c\uff1a\u4f7f\u7528collection\u6807\u7b7e\u5206\u6b65\u67e5\u8be2 \u7b2c\u4e00\u6b65\uff1a\u67e5\u8be2\u90e8\u95e8\u4fe1\u606f</p> <ul> <li>column\uff1a\u628acolumn\u7684\u503c\u4f5c\u4e3a\u5165\u53c2\u8c03\u7528\u7b2c\u4e8c\u6b65\u7684\u67e5\u8be2</li> <li>select\uff1a\u8bbe\u7f6e\u7b2c\u4e8c\u6b65\u67e5\u8be2\u7684sql\uff0c\u5373 mapper\u63a5\u53e3\u7684 &lt;\u5168\u7c7b\u540d.\u65b9\u6cd5\u540d&gt;</li> </ul> Text Only<pre><code>&lt;resultMap id=\"`DeptAndEmpByStepOneResultMap`\" type=\"Dept\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;id property=\"did\" column=\"did\"&gt;&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;result property=\"deptName\" column=\"dept_name\"&gt;&lt;/result&gt;\n `&lt;collection property=\"emps\" column=\"did\"`\n `select=\"com.atguigu.mybatis.mapper.EmpMapper.getDeptAndEmpByStepTwo\"&gt;`\n `&lt;/collection&gt;`\n&lt;/resultMap&gt;\n&lt;!--Dept getDeptAndEmpByStepOne(@Param(\"did\") Integer did);--&gt;\n&lt;select id=\"getDeptAndEmpByStepOne\" resultMap=\"`DeptAndEmpByStepOneResultMap`\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_dept where did = #{did}\n&lt;/select&gt;\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff1a\u6839\u636e\u90e8\u95e8id\u67e5\u8be2\u90e8\u95e8\u4e2d\u7684\u6240\u6709\u5458\u5de5 \u8fd9\u4e2a\u5b50\u67e5\u8be2\u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u67e5\u8be2\uff0c\u5982\u679c\u4e4b\u524d\u5c31\u5df2\u7ecf\u6709\u4e86\uff0c\u53ef\u4ee5\u88ab\u73b0\u5728\u8fd9\u4e2a\u9700\u6c42\u590d\u7528\u3002 Text Only<pre><code>&lt;!--List&lt;Emp&gt; getDeptAndEmpByStepTwo(@Param(\"did\") Integer did);--&gt;\n&lt;select id=\"`getDeptAndEmpByStepTwo`\" resultType=\"Emp\"&gt;\n\u00a0\u00a0\u00a0\u00a0select * from t_emp where did = #{did}\n&lt;/select&gt;\n</code></pre></p> <p>\u603b\u7ed3\uff1a\u4f7f\u7528association\u6807\u7b7e\u8fdb\u884c\u5206\u6b65\u67e5\u8be2\u00a0\u7684\u00a0\u5b50\u67e5\u8be2\u00a0\u53ea\u80fd\u8fd4\u56de\u4e00\u884c\u6570\u636e\uff1b\u800c\u4f7f\u7528collection\u6807\u7b7e\u5206\u6b65\u67e5\u8be2\u00a0\u7684\u00a0\u5b50\u67e5\u8be2\u00a0\u4f1a\u8fd4\u56de\u591a\u884c\u6570\u636e\u3002</p> <p><code>\u5f00\u53d1\u5e94\u8be5\u9075\u5faa\u826f\u597d\u7684\u547d\u540d\u89c4\u8303\uff0c\u5373\u6570\u636e\u5e93\u4f7f\u7528\\_\u4e0b\u5212\u7ebf\u7684\u547d\u540d\u65b9\u5f0f\uff0cJava\u7c7b\u4e2d\u7684\u5c5e\u6027\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d\uff0c\u8fd9\u6837\u505a\uff0cresultType\u53ef\u4ee5\u8986\u76d698%\u7684\u4f7f\u7528\u9700\u6c42\uff0c\u5373\u4f7f\u5217\u540d\u4e0e\u5c5e\u6027\u540d\u5bf9\u4e0d\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528as\u8d77\u522b\u540d\uff0c\u6bd4resultMap\u66f4\u52a0\u65b9\u4fbf\uff0c\u4ece\u800cresultType\u57fa\u672c\u53ef\u4ee5\u8986\u76d699%\u7684\u9700\u6c42</code>\uff0c\u5e94\u8be5\u5f88\u5c11\u6709\u673a\u4f1a\u4f7f\u7528\u5230association\u6807\u7b7e\u00a0\u548c\u00a0collection\u6807\u7b7e\u00a0\u5b8c\u6210\u00a0\u591a\u5bf9\u4e00\u7684\u6620\u5c04\uff0c\u5373\u4f7f\u6709\u4e2a\u522b\u9700\u6c42\u9700\u8981\u4f7f\u7528\uff0c\u90a3\u5206\u6b65\u67e5\u8be2\u4e5f\u4e0d\u4f1a\u662f\u9996\u9009\uff0c\u6240\u4ee5\u4e0b\u9762\u4ecb\u7ecd\u7684\u5ef6\u8fdf\u52a0\u8f7d\u66f4\u662f\u5f88\u5c11\u5f88\u5c11\u6709\u673a\u4f1a\u7528\u5230\u3002</p> <p>\u5c01\u88c5\u5b9e\u4f53\u7c7b\u7684\u8fc7\u7a0b\uff08\u6ca1\u770b\u6e90\u7801\uff0c\u5168\u51ed\u5b9e\u9a8c\u73b0\u8c61\u603b\u7ed3\uff09\uff1a \u5982\u679c\u5217\u540d\u4e0e\u5c5e\u6027\u540d\u7684\u6620\u5c04\u5173\u7cfb\u786e\u5b9a\uff08\u7b26\u5408\u4e0b\u5212\u7ebf\u4e0e\u9a7c\u5cf0\u7684\u547d\u540d\u89c4\u5219 \u6216\u8005 \u4f7f\u7528resultMap\u6307\u5b9a\u6620\u5c04\u89c4\u5219\uff09\uff0c\u90a3\u4e48MyBatis\u4f1a\u76f4\u63a5\u53cd\u5c04\u8c03\u7528\u5c5e\u6027\u7684setter\u65b9\u6cd5\u8d4b\u503c\uff1b\u5982\u679c\u4e0d\u786e\u5b9a\uff0c\u5219\u5148\u5c1d\u8bd5\u8c03\u7528\u6709\u53c2\u6784\u9020\uff0c\u5c06\u67e5\u8be2\u5f97\u5230\u7684\u6570\u636e\u6309\u987a\u5e8f\u7ed9\u6709\u53c2\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u9010\u4e2a\u8d4b\u503c\uff0c\u5982\u679c\u6ca1\u6709\u629b\u5f02\u5e38\u5219\u6784\u9020\u6210\u529f\uff0c\u5982\u679c\u629b\u5f02\u5e38\uff0c\u5219\u518d\u5c1d\u8bd5\u7528\u65e0\u53c2\u6784\u9020\u521b\u5efa\u5bf9\u8c61\uff08\u6ca1\u6709\u65e0\u53c2\u6784\u9020\u5219\u76f4\u63a5\u5931\u8d25\uff09\uff0c\u5e76\u5c06\u80fd\u786e\u5b9a\u6620\u5c04\u5173\u7cfb\u7684\u5217\u7528\u5c5e\u6027\u7684setter\u65b9\u6cd5\u8d4b\u503c\uff0c\u5176\u4ed6\u4e0d\u80fd\u786e\u5b9a\u6620\u5c04\u5173\u7cfb\u7684\u5217\u5219\u4e3anull\u3002</p> <p>\u4e09\u3001\u5ef6\u8fdf\u52a0\u8f7d \u4f7f\u7528 resultMap\u00a0\u7684\u5206\u6b65\u67e5\u8be2\u53ef\u4ee5\u5b9e\u73b0\u5ef6\u8fdf\u52a0\u8f7d\uff0c\u5373\u53ea\u6709\u7528\u5230\u7b2c\u4e8c\u6b65SQL\u67e5\u8be2\u7684\u5b57\u6bb5\u65f6\u624d\u4f1a\u6267\u884c\u7b2c\u4e8c\u6b65\u7684SQL\uff0c\u4f7f\u7528\u5ef6\u8fdf\u52a0\u8f7d\u9700\u8981\u5148\u5728\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002</p> <ol> <li>lazyLoadingEnabled\uff1a\u5ef6\u8fdf\u52a0\u8f7d\u7684\u5168\u5c40\u5f00\u5173\u3002\u5f53\u5f00\u542f\u65f6\uff0c\u6240\u6709\u5173\u8054\u5bf9\u8c61\u90fd\u4f1a\u5ef6\u8fdf\u52a0\u8f7d</li> <li>aggressiveLazyLoading\uff1a\u5f53\u5f00\u542f\u65f6\uff0c\u4efb\u4f55\u65b9\u6cd5\u7684\u8c03\u7528\u90fd\u4f1a\u52a0\u8f7d\u8be5\u5bf9\u8c61\u7684\u6240\u6709\u5c5e\u6027\u3002 \u5426\u5219\uff0c\u6bcf\u4e2a\u5c5e\u6027\u4f1a\u6309\u9700\u52a0\u8f7d\u3002</li> </ol> <p>\u6b64\u65f6\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6309\u9700\u52a0\u8f7d\uff0c\u83b7\u53d6\u7684\u6570\u636e\u662f\u4ec0\u4e48\uff0c\u5c31\u53ea\u4f1a\u6267\u884c\u76f8\u5e94\u7684sql\u3002 \u8fd8\u53ef\u901a\u8fc7association\u548ccollection\u4e2d\u7684fetchType\u5c5e\u6027\u8bbe\u7f6e\u5f53\u524d\u7684\u5206\u6b65\u67e5\u8be2\u662f\u5426\u4f7f\u7528\u5ef6\u8fdf\u52a0\u8f7d\uff0cfetchType=\"lazy(\u5ef6\u8fdf\u52a0\u8f7d)|eager(\u7acb\u5373\u52a0\u8f7d)\"\uff0c\u8fd9\u4e2a\u8bbe\u7f6e\u4f1a\u8986\u76d6\u5168\u5c40\u7684\u8bbe\u7f6e\u3002 Text Only<pre><code>&lt;settings&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\u5f00\u542f\u5ef6\u8fdf\u52a0\u8f7d--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;setting name=\"lazyLoadingEnabled\" value=\"true\"/&gt;\n&lt;/settings&gt;\n</code></pre></p> Text Only<pre><code>@Test\npublic void getEmpAndDeptByStepOne() {\n\u00a0\u00a0\u00a0\u00a0SqlSession sqlSession = SqlSessionUtils.getSqlSession();\n\u00a0\u00a0\u00a0\u00a0EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);\n\u00a0\u00a0\u00a0\u00a0Emp emp = mapper.getEmpAndDeptByStepOne(1);\n\u00a0\u00a0\u00a0\u00a0System.out.println(emp.getEmpName());\n}\n</code></pre> <p>\u5173\u95ed\u5ef6\u8fdf\u52a0\u8f7d\uff0c\u4e24\u6761SQL\u8bed\u53e5\u90fd\u8fd0\u884c\u4e86\uff1a </p> <p>\u5f00\u542f\u5ef6\u8fdf\u52a0\u8f7d\uff0c\u53ea\u8fd0\u884c\u83b7\u53d6emp\u7684SQL\u8bed\u53e5\uff1a </p> <p>\u5f00\u542f\u5ef6\u8fdf\u52a0\u8f7d\uff0c\u7528\u5230\u67e5\u8be2dept\u7684\u65f6\u5019\u624d\u4f1a\u8c03\u7528\u76f8\u5e94\u7684SQL\u8bed\u53e5\uff1a Text Only<pre><code>@Test\npublic void getEmpAndDeptByStepOne() {\n\u00a0\u00a0\u00a0\u00a0SqlSession sqlSession = SqlSessionUtils.getSqlSession();\n\u00a0\u00a0\u00a0\u00a0EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);\n\u00a0\u00a0\u00a0\u00a0Emp emp = mapper.getEmpAndDeptByStepOne(1);\n\u00a0\u00a0\u00a0\u00a0System.out.println(emp.getEmpName());\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"----------------\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(emp.getDept());\n}\n</code></pre> </p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/7.%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/","title":"7.\u6ce8\u89e3\u5f00\u53d1","text":"<p> \u7ea6 971 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>mybatis\u7684\u5e38\u7528\u6ce8\u89e3</p> \u6ce8\u89e3 \u8bf4\u660e @Insert \u5b9e\u73b0\u65b0\u589e @Delete \u5b9e\u73b0\u5220\u9664 @Update \u5b9e\u73b0\u66f4\u65b0 @Select \u5b9e\u73b0\u67e5\u8be2 @Result \u5b9e\u73b0\u7ed3\u679c\u96c6\u5c01\u88c5 @Results \u53ef\u4ee5\u4e0e@Result \u4e00\u8d77\u4f7f\u7528\uff0c\u5c01\u88c5\u591a\u4e2a\u7ed3\u679c\u96c6 @ResultMap \u5b9e\u73b0\u5f15\u7528@Results \u5b9a\u4e49\u7684\u5c01\u88c5 @One \u5b9e\u73b0\u4e00\u5bf9\u4e00\u7ed3\u679c\u96c6\u5c01\u88c5 @Many \u5b9e\u73b0\u4e00\u5bf9\u591a\u7ed3\u679c\u96c6\u5c01\u88c5 @SelectProvider \u5b9e\u73b0\u52a8\u6001 SQL \u6620\u5c04 @CacheNamespace \u5b9e\u73b0\u6ce8\u89e3\u4e8c\u7ea7\u7f13\u5b58\u7684\u4f7f\u7528 <p>\u4f7f\u7528\u6ce8\u89e3\u8fdb\u884c\u5f00\u53d1\u9700\u8981\u91cd\u70b9\u5173\u6ce8\u4e24\u4e2a\u95ee\u9898\uff0c\u4e00\u662f\u5982\u4f55\u4f7f\u7528\u6ce8\u89e3\u5b9e\u73b0resultMap\uff0c\u4e8c\u662f\u5982\u4f55\u4f7f\u7528\u6ce8\u89e3\u5b9e\u73b0\u52a8\u6001SQL\u3002</p> <p>\u4f7f\u7528\u6ce8\u89e3\u5f00\u53d1\u4e0d\u9700\u8981\u5f15\u5165\u6620\u5c04\u6587\u4ef6\uff0c\u4f46\u8fd8\u662f\u9700\u8981\u5728MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9aMapper\u63a5\u53e3\u6240\u5728\u4f4d\u7f6e\u3002 Text Only<pre><code>&lt;mappers&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;package name=\"xxx.mapper\"&gt;&lt;/package&gt;\n&lt;/mappers&gt;\n</code></pre></p> <p>\u4e00\u3001\u4f7f\u7528\u6ce8\u89e3\u5b9e\u73b0resultMap \u4f7f\u7528\u6ce8\u89e3\u4e0d\u9700\u8981\u6307\u5b9aresultType\uff0c\u4f46\u5982\u679c\u662f\u590d\u6742\u5173\u7cfb\u6620\u5c04\uff0c\u5219\u9700\u8981\u4f7f\u7528@Result\u3001@Results\u3001@ResultMap\u8fdb\u884c\u6307\u5b9a\u3002</p> @Result \u4e2d\u7684\u5c5e\u6027 \u4ecb\u7ecd id \u662f\u5426\u662f\u4e3b\u952e\u5b57\u6bb5 column \u6570\u636e\u5e93\u7684\u5217\u540d property \u9700\u8981\u88c5\u914d\u7684\u5c5e\u6027\u540d one \u9700\u8981\u4f7f\u7528\u7684@One \u6ce8\u89e3\uff08@Result\uff08one=@One\uff09\uff08\uff09\uff09\uff09 many \u9700\u8981\u4f7f\u7528\u7684@Many \u6ce8\u89e3\uff08@Result\uff08many=@many\uff09\uff08\uff09\uff09\uff09 <p>1.\u666e\u901a\u6620\u5c04\u5173\u7cfb \u5728@Results\u4e2d\u4f7f\u7528@Result\u6307\u5b9a\u6bcf\u5217\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u7136\u540e\u4f7f\u7528@ResultMap\u5728\u4efb\u4f55\u6709\u9700\u8981\u7684\u5730\u65b9\u8fdb\u884c\u6307\u5b9a\u3002\u5982\u679c\u4e0d\u9700\u8981\u5728\u5176\u5b83\u5730\u65b9\u7528\u53ef\u4ee5\u4e0d\u5199id\uff0c\u7136\u540e \"value=\" \u4e5f\u53ef\u4ee5\u7701\u7565\u6389\uff0c\u76f4\u63a5\u7528@Result\u6307\u5b9a\u6620\u5c04\u5173\u7cfb\u3002 Text Only<pre><code>@Select(\"select id, uid, money from account where id = #{id}\")\n@`Results`(id = \"accountMap\", value = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@`Result`(id = true, column = \"id\", property = \"id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"uid\", property = \"uid\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"money\", property = \"balance\")\n})\nAccount find(Long id);\n\n@Select(\"select * from account\")\n@`ResultMap`(\"accountMap\")\nList&lt;Account&gt; findAll();\n</code></pre></p> <p>2.\u5c06 \u591a\u5217\u6570\u636e \u6620\u5c04\u5230 \u5b9e\u4f53\u7c7b\u7684\u4e00\u4e2a\u5c5e\u6027 \u5173\u7cfb\uff1a\u4e00\u4e2aUser\u62e5\u6709\u591a\u4e2aAccount\uff0c\u4e00\u4e2aAccount\u53ea\u5c5e\u4e8e\u4e00\u4e2aUser\u3002 \u4f8b\u5982\uff1a\u5c06\u67e5\u8be2\u5230User\u5c01\u88c5\u5230Account\u4e2d\uff1a Text Only<pre><code>public class Account {\n\u00a0\u00a0\u00a0\u00a0private Integer id;\n\u00a0\u00a0\u00a0\u00a0private Double balance;\n\u00a0\u00a0\u00a0\u00a0`private User user;`\n}\n</code></pre> Text Only<pre><code>public class User {\n\u00a0\u00a0\u00a0\u00a0private Long id;\n\u00a0\u00a0\u00a0\u00a0private String name;\n\u00a0\u00a0\u00a0\u00a0private int age;\n\u00a0\u00a0\u00a0\u00a0private String email;\n\u00a0\u00a0\u00a0\u00a0`private List&lt;Account&gt; accounts;`\n}\n</code></pre> @One \u6ce8\u89e3\uff08\u4e00\u5bf9\u4e00\uff09\uff0c\u4ee3\u66ff\u4e86\u6807\u7b7e\uff0c\u662f\u591a\u8868\u67e5\u8be2\u7684\u5173\u952e\uff0c\u5728\u6ce8\u89e3\u4e2d\u7528\u6765\u6307\u5b9a\u5b50\u67e5\u8be2\u8fd4\u56de\u5355\u4e00\u5bf9\u8c61\u3002 @One \u6ce8\u89e3\u5c5e\u6027\u4ecb\u7ecd\uff1a <ul> <li>select \u6307\u5b9a\u7528\u6765\u591a\u8868\u67e5\u8be2\u7684 sqlmapper</li> <li>fetchType \u4f1a\u8986\u76d6\u5168\u5c40\u7684\u914d\u7f6e\u53c2\u6570 lazyLoadingEnabled\u3002</li> <li>\u4f7f\u7528\u683c\u5f0f\uff1a@Result(column=\" \u201c,property=\u201d\",one=@One(select=\"\"))</li> </ul> <p>Text Only<pre><code>public interface AccountMapper {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u67e5\u8be2\u6240\u6709\u8d26\u6237\uff0c\u5e76\u4e14\u83b7\u53d6\u6bcf\u4e2a\u8d26\u6237\u4e0b\u7684\u7528\u6237\u4fe1\u606f,\u4e00\u5bf9\u4e00\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Select(\"select * from account\")\n\u00a0\u00a0\u00a0\u00a0@Results(id = \"aMap\", value = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(id = true, column = \"id\", property = \"id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"money\", property = \"balance\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`@Result(column = \"uid\", property = \"user\", one = @One(select = \"cn.ctyun.mapper.UserMapper.findById\", fetchType = FetchType.EAGER))`\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0List&lt;Account&gt; findAll();\n}\n</code></pre> Text Only<pre><code>public interface UserMapper {\n\u00a0\u00a0\u00a0\u00a0@Select(\"select * from public.user where id=`#{id}`\")\n\u00a0\u00a0\u00a0\u00a0`User findById(@Param(\"id\") Integer id);`\n}\n</code></pre></p> <p>3.\u5c06 \u591a\u884c\u6570\u636e \u6620\u5c04\u5230 \u5b9e\u4f53\u7c7b\u7684\u4e00\u4e2a\u5c5e\u6027\u4e0a \u4f8b\u5982\uff1a\u5c06\u4e00\u4e2aUser\u7684\u591a\u4e2aAccount\u5c01\u88c5\u5230User\u4e2d @Many \u6ce8\u89e3\uff08\u591a\u5bf9\u4e00\uff09\uff0c\u4ee3\u66ff\u4e86\u6807\u7b7e,\u662f\u662f\u591a\u8868\u67e5\u8be2\u7684\u5173\u952e\uff0c\u5728\u6ce8\u89e3\u4e2d\u7528\u6765\u6307\u5b9a\u5b50\u67e5\u8be2\u8fd4\u56de\u5bf9\u8c61\u96c6\u5408\u3002 \u4f7f\u7528\u683c\u5f0f\uff1a@Result(property=\"\",column=\"\",many=@Many(select=\"\")) Text Only<pre><code>public interface UserMapper {\n\u00a0\u00a0\u00a0\u00a0@Select(\"select * from public.user where id=#{id}\")\n\u00a0\u00a0\u00a0\u00a0User findById(@Param(\"id\") Integer id);\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u67e5\u8be2\u6240\u6709\u7528\u6237\uff0c\u6bcf\u4f4d\u7528\u6237\u6709\u591a\u4e2a\u8d26\u6237\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Select(\"select * from public.user\")\n\u00a0\u00a0\u00a0\u00a0@Results(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0id = \"UserMap\", value = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(id = true, column = \"id\", property = \"id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"name\", property = \"name\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"age\", property = \"age\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"email\", property = \"email\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`@Result(column = \"id\", property = \"accounts\",`\n `many = @Many(select = \"cn.ctyun.mapper.AccountMapper.findAccountByUid\", fetchType = FetchType.LAZY)),`\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0List&lt;User&gt; findAll();\n}\n</code></pre> Text Only<pre><code>public interface AccountMapper {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u67e5\u8be2\u6240\u6709\u8d26\u6237\uff0c\u5e76\u4e14\u83b7\u53d6\u6bcf\u4e2a\u8d26\u6237\u4e0b\u7684\u7528\u6237\u4fe1\u606f,\u4e00\u5bf9\u4e00\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Select(\"select * from account\")\n\u00a0\u00a0\u00a0\u00a0@Results(id = \"aMap\", value = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(id = true, column = \"id\", property = \"id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"money\", property = \"balance\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"uid\", property = \"user\", one = @One(select = \"cn.ctyun.mapper.UserMapper.findById\", fetchType = FetchType.EAGER))\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0List&lt;Account&gt; findAll();\n\n\u00a0\u00a0\u00a0\u00a0@Select(\"select id, uid, money from account where uid = `#{uid}`\")\n\u00a0\u00a0\u00a0\u00a0@Results(id = \"accountMap\", value = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(id = true, column = \"id\", property = \"id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"money\", property = \"balance\")\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0List&lt;Account&gt; `findAccountByUid`(@Param(\"uid\") Long uid);\n}\n</code></pre> <p>Mybatis\u6ce8\u89e3\u5f00\u53d1\uff08\u8d85\u8be6\u7ec6\uff09_mybatis\u63a5\u53e3\u6ce8\u89e3_\u725b\u54c4\u54c4\u7684\u67ef\u5357\u7684\u535a\u5ba2-CSDN\u535a\u5ba2</p> <p>\u4e8c\u3001\u4f7f\u7528\u6ce8\u89e3\u5b9e\u73b0\u52a8\u6001SQL \u4f7f\u7528\u52a8\u6001SQL\u9700\u8981\u5c06sql\u8bed\u53e5\u5305\u542b\u5728script\u6807\u7b7e\u91cc\u3002\u4e0eJava15\u7684\u6587\u672c\u5757\u8bed\u6cd5\u662f\u7edd\u914d\u3002 Text Only<pre><code>@Select(`\"\"\"`\n `&lt;script&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select * from student\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;where&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;if test=\"wildcard != null and wildcard != ''\"&gt; name like concat('%', #{wildcard}, '%') &lt;/if&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/where&gt;\n `&lt;/script&gt;`\n `\"\"\"`)\nList&lt;Student&gt; getUserByLike(String wildcard);\n</code></pre></p> <p>MyBatis\u52a8\u6001SQL(\u6ce8\u89e3\u7248)_\u97e9\u5e08\u5b66\u5b50--\u5c0f\u502a\u7684\u535a\u5ba2-CSDN\u535a\u5ba2</p>"},{"location":"Web%E5%BC%80%E5%8F%91/MyBatis/8.MyBatis-plus/","title":"8.MyBatis-plus","text":"<p> \u7ea6 2164 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 43 \u5206\u949f</p> <p>\u4e00\u3001MyBatis-Plus\u00a0\u4e0e\u00a0MyBatis\u00a0\u7684\u533a\u522b MyBatis-Plus\u00a0\u53ea\u505a\u589e\u5f3a\u4e0d\u505a\u6539\u53d8\uff1aMyBatis-plus\u53ea\u662f\u5728MyBatis\u7684\u57fa\u7840\u589e\u52a0\u4e86\u8ba9\u4f7f\u7528\u66f4\u52a0\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u6700\u4e3b\u8981\u662f\u6539\u8fdb\u4e86MyBatis\u5bf9\u5355\u8868\u67e5\u8be2\u7684\u5199\u6cd5\uff0c\u80fd\u5341\u5206\u65b9\u4fbf\u5730\u6784\u9020\u51fa\u4e1a\u52a1\u9700\u6c42\u4e2d99%\u7684\u5355\u8868\u67e5\u8be2\uff0c\u66f4\u52a0\u6781\u81f4\u5730\u7b80\u5316\u4e86\u5355\u8868\u67e5\u8be2\u7684\u5f00\u53d1\uff0c\u6bd4\u5982\u4f7f\u7528MyBatis\u5bf9\u67d0\u5f20\u8868\u8fdb\u884c\u6279\u91cf\u67e5\u8be2\u65f6\uff0c\u9700\u8981\u73b0\u5728Mapper\u63a5\u53e3\u91cc\u9762\u5199\u65b9\u6cd5\uff0c\u7136\u540e\u5728XML\u6216\u8005\u6ce8\u89e3\u91cc\u9762\u5199SQL\uff0c\u663e\u7136\u5355\u8868\u6279\u91cf\u67e5\u8be2\u662f\u4e00\u4e2a\u5341\u5206\u5e38\u89c1\u7684SQL\uff0c\u4e8e\u662fMyBatis-plus\u5c31\u5c06\u8fd9\u79cd\u901a\u7528\u7684SQL\u63d0\u53d6\u51fa\u6765\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002 \u4f7f\u7528MyBatis-plus\uff0c\u4e0d\u7528\u7f16\u5199SQL\u5373\u53ef\u5b9e\u73b0\u5bf9\u5355\u8868\u7684\u5927\u90e8\u5206CRUD\u64cd\u4f5c\uff0c\u5bf9\u4e8e\u590d\u6742\u5355\u8868\u67e5\u8be2\uff0c\u591a\u8868\u5173\u8054\u67e5\u8be2\u7b49\u65e0\u80fd\u4e3a\u529b\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u52a8\u7528MyBatis\u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u8bf4MyBatis\u7684\u8bbe\u8ba1\u662f\u4e3a\u4e86\u901a\u7528\u6027\uff0c\u62e5\u6709\u5b8c\u6574\u7684\u6301\u4e45\u5316\u5c42\u6846\u67b6\u7684\u529f\u80fd\uff0c\u800cMyBatis-plus\u7684\u8bbe\u8ba1\u5219\u662f\u4e3a\u4e86\u66f4\u52a0\u65b9\u4fbf\u7684\u4f7f\u7528\uff0c\u6781\u81f4\u5730\u7b80\u5316\u7684MyBatis\u5355\u8868\u64cd\u4f5c\u80fd\u529b\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0cMyBatis-plus\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7684\u589e\u5f3a\u529f\u80fd\uff1a 1\u3001BaseMapper\u548cServiceImpl\u63d0\u4f9b\u5355\u8868\u7684CRUD\u5b9e\u73b0\uff0c\u53ef\u901a\u8fc7Wrapper\u5341\u5206\u65b9\u4fbf\u5730\u5b9e\u73b0\u6761\u4ef6\u7684\u5c01\u88c5\u3002 2\u3001\u63d0\u4f9b\u65b9\u4fbf\u7684\u6ce8\u89e3\uff0c\u4ee5\u652f\u6301\u5e38\u7528\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u53ef\u4ee5\u6307\u5b9a\u6620\u5c04\u7684\u6570\u636e\u5e93\u8868\u540d\u3001\u652f\u6301\u591a\u79cd\u4e3b\u952e\u751f\u6210\u7b56\u7565\u3001\u903b\u8f91\u5220\u9664\u3001\u4e50\u89c2\u9501\u7b49\u3002 3\u3001\u63d0\u4f9b\u5206\u9875\u3001\u4e50\u89c2\u9501\u7b49\u63d2\u4ef6\u3002</p> <p>\u4e8c\u3001\u5728SpringBoot\u9879\u76ee\u4e2d\u4f7f\u7528MyBatis-plus MyBatis-plus\u4e00\u822c\u90fd\u662f\u5728SpringBoot\u9879\u76ee\u4e2d\u4f7f\u7528\uff0c\u5f15\u5165MyBatis-plus\u7684\u573a\u666f\u542f\u52a8\u5668\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;com.baomidou&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;\u6700\u65b0\u7248\u672c&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> MyBatis\u548cMyBatis-plus\u7684\u914d\u7f6e\u90fd\u5199\u5728application.yml\u7684mybatis-plus\u4e0b Text Only<pre><code>#MyBatis-Plus\u76f8\u5173\u914d\u7f6e\nmybatis-plus:\n\u00a0\u00a0mapper-locations: 'classpath:cn.telecom.ctyun.mapper/*.xml'\n\u00a0\u00a0configuration:\n\u00a0\u00a0\u00a0\u00a0#\u914d\u7f6e\u65e5\u5fd7\n\u00a0\u00a0\u00a0\u00a0log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n</code></pre></p> <p>\u4e09\u3001BaseMapper BaseMapper\u5c01\u88c5\u4e86\u901a\u7528CRUD\u63a5\u53e3\uff0c\u65b9\u6cd5\u540d\u5206\u522b\u4ee5Insert\u3001Delete\u3001Update\u3001Select\u5f00\u5934\u3002\u6cdb\u578bT\u662fORM\u5bf9\u8c61\uff0c\u5982\u679c\u9700\u8981BaseMapper\u63d0\u4f9b\u7684\u901a\u7528CRUD\u80fd\u529b\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u8ba9\u81ea\u5df1\u7684Mapper\u63a5\u53e3\u7ee7\u627fBaseMapper\uff1a Text Only<pre><code>public interface UserMapper extends BaseMapper&lt;User&gt; {\n}\n</code></pre> \u4f7f\u7528@MapperScan(\"cn.telecom.ctyun.mapper\")\u6ce8\u89e3\u626b\u63cfMapper\u63a5\u53e3\uff0cMyBatis-plus\u4f1a\u81ea\u52a8\u89e3\u6790\u6cdb\u578bT\u5bf9\u5e94\u7684\u5b9e\u4f53\u5173\u7cfb\u6620\u5c04\uff0c\u7136\u540e\u5c06Mapper\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u5bf9\u8c61\u6ce8\u5165\u5230\u5bb9\u5668\u4e2d\uff0c\u4e4b\u540e\u53ef\u4ece\u5bb9\u5668\u4e2d\u81ea\u52a8\u88c5\u914d\u62ff\u5230\u8fd9\u4e2a\u5bf9\u8c61\u5e76\u4f7f\u7528\u5176\u63d0\u4f9b\u7684\u901a\u7528CRUD\u529f\u80fd\uff1a Text Only<pre><code>@SpringBootTest\npublic class MyBatisPlusTest {\n `@Resource`\n `private UserMapper userMapper;`\n\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0void testSelectList() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u8fc7\u6761\u4ef6\u6784\u9020\u5668\u67e5\u8be2\u4e00\u4e2alist\u96c6\u5408\uff0c\u82e5\u6ca1\u6709\u6761\u4ef6\uff0c\u5219\u53ef\u4ee5\u8bbe\u7f6enull\u4e3a\u53c2\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;User&gt; users = userMapper.selectList(null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0users.forEach(System.out::println);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>\u56db\u3001IService\u548cServiceImpl ServiceImpl, T&gt;\u00a0\u662f\u901a\u7528\u7684Service\u5c42\u5b9e\u73b0\u7c7b\uff0c\u4e5f\u6709CRUD\u65b9\u6cd5\uff0c\u662f\u5bf9BaseMapper\u7684\u65b9\u6cd5\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u63d0\u4f9b\u66f4\u591a\u7684\u901a\u7528CRUD\u529f\u80fd\uff1b\u4e3a\u4e86\u4e0eBaseMapper\u65b9\u6cd5\u533a\u5206\uff0cServiceImpl\u4e2dsave\u65b9\u6cd5\u4ee3\u66ff\u4e86BaseMapper\u7684insert\u65b9\u6cd5\uff0csaveOrUpdate\u65b9\u6cd5\u4ee3\u66ff\u4e86update\uff0cremove\u65b9\u6cd5\u4ee3\u66ff\u4e86 delete\u65b9\u6cd5\uff0cget\u67e5\u8be2\u5355\u884c\u3001list\u67e5\u8be2\u96c6\u5408\u3001page\u5206\u9875\u67e5\u8be2\u4ee3\u66ff\u4e86select\u65b9\u6cd5\u3002 ServiceImpl\u4e0d\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4e5f\u4e0d\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u800c\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\uff0c\u6240\u4ee5\u7406\u8bba\u4e0a\u662f\u53ef\u4ee5\u76f4\u63a5new ServiceImpl\u5bf9\u8c61\u8fdb\u884c\u4f7f\u7528\u7684\uff0c\u4f46\u662f\u7531\u4e8eServiceImpl\u5f88\u591a\u65b9\u6cd5\u7684\u5b9e\u73b0\u90fd\u662f\u8c03\u7528BaseMapper\u7684\u65b9\u6cd5\uff0c\u6240\u4ee5ServiceImpl\u7c7b\u6709\u4e00\u4e2aBaseMapper\u7684\u5c5e\u6027\uff0c\u800c\u8fd9\u4e2a\u5c5e\u6027\u9700\u8981\u4f9d\u9760\u81ea\u52a8\u88c5\u914d\u83b7\u5f97\u5bf9\u8c61\uff0c\u6240\u4ee5\u8981\u60f3\u6b63\u5e38\u4f7f\u7528ServiceImpl\uff0c\u5fc5\u987b\u8981\u4eceSpringBoot\u5bb9\u5668\u4e2d\u62ff\uff0c\u5373\uff1a Text Only<pre><code>@Resource\nServiceImpl&lt;UserMapper, User&gt; userService;\n</code></pre> \u8fd9\u6837\u867d\u7136\u53ef\u4ee5\u4f7f\u7528ServiceImpl\u63d0\u4f9b\u7684\u901a\u7528CRUD\u65b9\u6cd5\uff0c\u4f46\u662f\u5374\u4e0d\u80fd\u5728Service\u5c42\u65b0\u589e\u52a0\u65b9\u6cd5\uff0c\u6240\u4ee5\u4e00\u822c\u90fd\u4e0d\u8fd9\u6837\u7528\uff0c\u800c\u662f\u7528\u6211\u4eec\u81ea\u5df1\u7684Service\u5c42\u65b9\u6cd5\u53bb\u7ee7\u627f ServiceImpl \uff1a Text Only<pre><code>public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; {\n\u00a0\u00a0 \u00a0@Resource\n\u00a0\u00a0 \u00a0private UserMapper userMapper;\n}\n</code></pre> \u53c8\u56e0\u4e3a\u5728\u6211\u4eec\u4e60\u60ef\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\uff0c\u4e00\u822c\u662f\u5728Service\u5c42\u5148\u5199\u4e00\u4e2a\u63a5\u53e3\uff0c\u7136\u540e\u518d\u5199\u4e00\u4e2a\u5b83\u7684\u5b9e\u73b0\u7c7b\uff0c\u6240\u4ee5\uff1a Text Only<pre><code>public interface UserService {\n}\n</code></pre> \u7136\u540e Text Only<pre><code>public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService {\n\u00a0\u00a0\u00a0\u00a0@Resource\n\u00a0\u00a0\u00a0\u00a0private UserMapper userMapper;\n}\n</code></pre> \u4f46\u662f\u8fd9\u6837UserService\u63a5\u53e3\u91cc\u6ca1\u6709ServiceImpl\u65b9\u6cd5\u7684\u58f0\u660e\uff0c\u65e0\u6cd5\u901a\u8fc7UserService\u63a5\u53e3\u8c03\u7528ServiceImpl\u5b9e\u73b0\u7684\u901a\u7528CRUD\u65b9\u6cd5\uff0c\u4e8e\u662fMyBatista-plus\u63d0\u4f9b\u4e86IService\u63a5\u53e3\uff0cServiceImpl\u6b63\u662f\u5b9e\u73b0\u4e86IService\uff0c\u6240\u4ee5\u53ea\u8981UserService\u63a5\u53e3\u7ee7\u627fIService\u63a5\u53e3\u5373\u53ef\u5b9e\u73b0\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\uff1a Text Only<pre><code>public interface UserService extends IService&lt;User&gt; {\n}\n</code></pre> <p>\u4e94\u3001\u6761\u4ef6\u6784\u9020\u5668 delete\u3001update\u3001select\u5747\u53ef\u4ee5\u5e26where\u6761\u4ef6\uff0c\u6240\u4ee5BaseMapper\u548cServiceImpl\u4e2d\u7684\u901a\u7528\u65b9\u6cd5\u53ef\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662fwhere\u6761\u4ef6\u4e2d\u7528\u4e8e\u8fc7\u6ee4\u6570\u636e\u7684\u5b57\u6bb5\u662f\u56fa\u5b9a\u7684\uff0c\u89c1\u65b9\u6cd5\u540d\u5c31\u80fd\u77e5\u9053\u5176\u610f\u601d\uff0c\u6bd4\u5982getById\uff1b\u53e6\u5916\u4e00\u7c7b\u5c31\u662fwhere\u6761\u4ef6\u4e2d\u7528\u4e8e\u8fc7\u6ee4\u6570\u636e\u7684\u5b57\u6bb5\u662f\u7075\u6d3b\u53ef\u53d8\u7684\uff0c\u8fd9\u79cd\u5c31\u9700\u8981\u4f7f\u7528\u6761\u4ef6\u6784\u9020\u5668\u6765\u6784\u9020\uff0c\u6bd4\u5982 T getOne(Wrapper queryWrapper);  <ul> <li>AbstractWrapper\uff1a \u7528\u4e8e\u67e5\u8be2\u6761\u4ef6\u5c01\u88c5\uff0c\u751f\u6210 sql \u7684 where \u6761\u4ef6\u3002</li> <li>QueryWrapper\uff1a\u7ee7\u627f\u81ea AbstractWrapper\uff0c\u591a\u4e86\u51e0\u4e2aselect\u65b9\u6cd5\uff0c\u7528\u4e8e\u9009\u62e9select\u54ea\u4e9b\u5217\u3002</li> <li>UpdateWrapper\uff1a\u7ee7\u627f\u81ea AbstractWrapper\uff0c\u591a\u4e86\u51e0\u4e2aset\u65b9\u6cd5\uff0c\u7528\u4e8e\u9009\u62e9set\u54ea\u4e9b\u5217\u7684\u503c\u3002</li> <li>LambdaQueryWrapper\uff1a\u529f\u80fd\u7b49\u540c\u4e8eQueryWrapper\uff0c\u63d0\u4f9b\u4e86Lambda\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u53ef\u4ee5\u907f\u514d\u586b\u9519\u5217\u540d\u3002</li> <li>LambdaUpdateWrapper\uff1a\u529f\u80fd\u7b49\u540c\u4e8eUpdateWrapper\uff0c\u63d0\u4f9b\u4e86Lambda\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u53ef\u4ee5\u907f\u514d\u586b\u9519\u5217\u540d\u3002</li> </ul> <p>LambdaQueryWrapper\u4e0eQueryWrapper\u533a\u522b\u4ec5\u4ec5\u5728\u4e8e\uff0cLambdaQueryWrapper\u53ef\u4ee5\u4f7f\u7528pojo\u5bf9\u8c61getter\u65b9\u6cd5\u7684\u65b9\u6cd5\u5f15\u7528\u6765\u907f\u514d\u586b\u9519\u5217\u540d\uff0c\u4f8b\u5982\uff1a Text Only<pre><code>LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();\nqueryWrapper.like(StringUtils.isNotBlank(username), `User::getName`, username);\nList&lt;User&gt; list = userMapper.selectList(queryWrapper);\n</code></pre></p> <p>\u4e0a\u9762\u4ee3\u7801\u7684\u5f62\u5f0f\u662f\uff0c\u5148\u4f7f\u7528Wrapper\u94fe\u5f0f\u7684\u6784\u9020\u6761\u4ef6\uff0c\u7136\u540e\u5c06\u6784\u9020\u597d\u7684Wrapper\u4f20\u9012\u5230delete\u3001update\u3001select\u65b9\u6cd5\u4e2d\u7ec4\u6210\u5b8c\u6574\u7684SQL\u8bed\u53e5\uff0c\u662f\u4e00\u79cd\u7b26\u5408\u5e38\u89c4\u7f16\u7a0b\u601d\u7ef4\u7684\u65b9\u5f0f\u3002\u9664\u6b64\u4e4b\u5916\uff0cServiceImpl\u8fd8\u63d0\u4f9b\u4e86\u4e00\u79cd\u94fe\u5f0f\u8c03\u7528\u7684\u5199\u6cd5\uff08\u4e0eStream\u7684\u5199\u6cd5\u4e00\u6837\uff09\uff0c\u5148\u4e00\u6b65\u4e00\u6b65\u6784\u9020\u597d\uff0c\u6700\u540e\u518d\u8c03\u7528\u67e5\u8be2\u7684\u65b9\u6cd5\u3002 query Text Only<pre><code>// \u94fe\u5f0f\u67e5\u8be2 \u666e\u901a\nQueryChainWrapper&lt;T&gt; query();\n// \u94fe\u5f0f\u67e5\u8be2 lambda \u5f0f\u3002\u6ce8\u610f\uff1a\u4e0d\u652f\u6301 Kotlin\nLambdaQueryChainWrapper&lt;T&gt; lambdaQuery();\n\n// \u793a\u4f8b\uff1a\nquery().eq(\"column\", value).one();\nlambdaQuery().eq(Entity::getId, value).list();\n</code></pre></p> <p>update Text Only<pre><code>// \u94fe\u5f0f\u66f4\u6539 \u666e\u901a\nUpdateChainWrapper&lt;T&gt; update();\n// \u94fe\u5f0f\u66f4\u6539 lambda \u5f0f\u3002\u6ce8\u610f\uff1a\u4e0d\u652f\u6301 Kotlin\nLambdaUpdateChainWrapper&lt;T&gt; lambdaUpdate();\n\n// \u793a\u4f8b\uff1a\nupdate().eq(\"column\", value).remove();\nlambdaUpdate().eq(Entity::getId, value).update(entity);\n</code></pre></p> <p>\u516d\u3001\u6ce8\u89e3 @TableName\uff1a \u8868\u540d\u6ce8\u89e3\uff0c\u6807\u8bc6\u5b9e\u4f53\u7c7b\u5bf9\u5e94\u7684\u8868 @TableId\uff1a \u4e3b\u952e\u6ce8\u89e3\uff0c \u5b9e\u4f53\u7c7b\u4e3b\u952e\u5b57\u6bb5 @TableField\uff1a\u5b57\u6bb5\u6ce8\u89e3\uff08\u975e\u4e3b\u952e\uff09 @Version\uff1a\u4e50\u89c2\u9501\u6ce8\u89e3 @EnumValue\uff1a\u666e\u901a\u679a\u4e3e\u7c7b\u6ce8\u89e3(\u6ce8\u89e3\u5728\u679a\u4e3e\u5b57\u6bb5\u4e0a) @TableLogic\uff1a\u6807\u8bb0\u5728\u7528\u4e8e\u903b\u8f91\u5220\u9664\u7684\u5b57\u6bb5\u4e0a</p> <p>\u4e03\u3001\u5206\u9875 MyBatis Plus\u81ea\u5e26\u5206\u9875\u63d2\u4ef6\uff0c\u53ea\u8981\u5411\u5bb9\u5668\u4e2d\u6dfb\u52a0\u5206\u9875\u63d2\u4ef6\u5373\u53ef\u4f7f\u7528\u5206\u9875\u529f\u80fd\uff1a Text Only<pre><code>@Configuration\n@MapperScan(\"com.atguigu.mybatisplus.mapper\")\npublic class MyBatisPlusConfig {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public MybatisPlusInterceptor mybatisPlusInterceptor(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6dfb\u52a0\u5206\u9875\u63d2\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return interceptor;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>1\u3001\u4f7f\u7528BaseMapper\u81ea\u5e26\u7684selectPage\u65b9\u6cd5\u6216\u8005ServiceImpl\u81ea\u5e26\u7684page\u65b9\u6cd5 Text Only<pre><code>`Page&lt;User&gt; page = userService.page(new Page&lt;&gt;(1, 10), new LambdaQueryWrapper&lt;User&gt;().between(User::getAge, 3, 33));`\nList&lt;User&gt; records = page.getRecords(); //\u5206\u9875\u6570\u636e\nboolean hasNext = page.hasNext();\nlong pages = page.getPages();\nlong current = page.getCurrent();\nlong size = page.getSize();\nlong total = page.getTotal();\n</code></pre></p> <p>2\u3001\u81ea\u5e26\u7684\u5206\u9875\u67e5\u8be2\u4ec5\u9488\u5bf9\u5355\u8868\u67e5\u8be2\u7684\u573a\u666f\uff0c\u5982\u679c\u662f\u591a\u8868\u5173\u8054\u540e\u7684\u5206\u9875\u67e5\u8be2\u5219\u53ea\u80fd\u81ea\u5b9a\u4e49\u67e5\u8be2\u65b9\u6cd5\uff0c\u6bd4\u5982\uff1a account\u4e0euser\u7684\u5173\u7cfb\u662f n: 1\uff0c\u5373\u4e00\u4e2aaccount\u53ea\u5c5e\u4e8e\u4e00\u4e2auser\uff0c\u4e00\u4e2auser\u6709\u591a\u4e2aaccount\u3002 \u81ea\u5b9a\u4e49\u5206\u9875\u67e5\u8be2\u65b9\u6cd5\uff0cpage\u5206\u9875\u5bf9\u8c61\u3001\u5fc5\u987b\u653e\u5728\u7b2c\u4e00\u4f4d\u3002 Text Only<pre><code>@Results({\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(id = true, column = \"account_id\", property = \"id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"uid\", property = \"uid\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"money\", property = \"balance\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"user_id\", property = \"user.id\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"name\", property = \"user.name\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"age\", property = \"user.age\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Result(column = \"email\", property = \"user.email\")\n})\n@Select(\"\"\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a.id as account_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uid,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0money,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0b.id as user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0age,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0email\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from public.account a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0left join public.user b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0on a.uid=b.id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`${ew.customSqlSegment}`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"\"\")\n`//page \u5206\u9875\u5bf9\u8c61\u5fc5\u987b\u653e\u5728\u7b2c\u4e00\u4f4d`\nPage&lt;Account&gt; selectAccountWithUserPage(`@Param(\"page\") Page&lt;User&gt; page`, `@Param(Constants.WRAPPER) LambdaQueryWrapper&lt;Account&gt; ew`);\n</code></pre> Text Only<pre><code>@Test\npublic void testPage03() {\n\u00a0\u00a0\u00a0\u00a0Page&lt;Account&gt; page = accountMapper.selectAccountWithUserPage(new Page&lt;&gt;(1, 10), new LambdaQueryWrapper&lt;Account&gt;().between(Account::getBalance, 0, 10000));\n\u00a0\u00a0\u00a0\u00a0List&lt;Account&gt; records = page.getRecords(); //\u5206\u9875\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0records.forEach(System.out::println);\n}\n</code></pre> \u4e0a\u9762\u8fd9\u4e2a\u793a\u4f8b\u8fd8\u5c55\u793a\u4e86\u5982\u4f55\u5728\u81ea\u5b9a\u4e49Mapper\u65b9\u6cd5\u4f7f\u7528\u6761\u4ef6\u6784\u9020\u5668\uff0c\u5373 param \u53c2\u6570\u540d\u8981\u4e48\u53ebew,\u8981\u4e48\u52a0\u4e0a\u6ce8\u89e3@Param(Constants.WRAPPER)\uff0c\u7136\u540e\u4f7f\u7528\\({ew.customSqlSegment}\uff0c\u6ce8\u610f\u662f\\)\u3002\u4f7f\u7528\u6761\u4ef6\u6784\u9020\u5668\u53ef\u4ee5\u907f\u514d\u4f7f\u7528\u52a8\u6001SQL\u62fc\u63a5where\u6761\u4ef6\u3002</p> <p>\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3\uff1a 1\u3001\u76f4\u63a5\u5728SpringBoot\u9879\u76ee\u4e2d\u5f15\u5165MyBatis-plus\u7684\u4f9d\u8d56\uff0cMyBatis-plus\u57fa\u4e8eMyBatis\uff0c\u6240\u4ee5\u4f1a\u81ea\u52a8\u5bfc\u5165MyBatis\u7684\u573a\u666f\u542f\u52a8\u5668\u3002 2\u3001\u5728application.yml\u4e2d\u7684 mybatis-plus: \u4e0b\u5199\u914d\u7f6e\uff0c\u6452\u5f03XML\u5199\u914d\u7f6e\u7684\u65b9\u5f0f\u3002 3\u3001\u7ee7\u627fBaseMapper\u3001IService\u3001ServiceImpl\uff0c\u5e76\u5728springboot\u4e3b\u7a0b\u5e8f\u7c7b\uff08\u6216\u8005\u5728\u914d\u7f6e\u7c7b\uff09\u4e0a\u4f7f\u7528@MapperScan\u6ce8\u89e3\u628aMapper\u63a5\u53e3\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\u3002 4\u3001\u5bf9\u4e8e\u5355\u8868\u7684CRUD\uff0c\u76f4\u63a5\u5728Service\u4e2d\u4f7f\u7528ServiceImpl\u81ea\u5e26\u7684\u65b9\u6cd5\uff0c\u4e0d\u8981\u4f7f\u7528BaseMapper\u4e2d\u539f\u59cb\u7684CRUD\u65b9\u6cd5\uff1b\u5bf9\u4e8e\u590d\u6742\u7684SQL\uff0c\u6bd4\u5982\u591a\u8868\u5173\u8054\u67e5\u8be2\uff0c\u5219\u9700\u8981\u5728Mapper\u4e2d\u5199\u63a5\u53e3\uff0c\u5e76\u642d\u914dJava15\u7684Text Block\u8bed\u6cd5\u4f7f\u7528\u6ce8\u89e3\u5f00\u53d1\u7f16\u5199SQL\uff0c\u80fd\u4e0d\u4f7f\u7528XML\u5c3d\u91cf\u4e0d\u4f7f\u7528XML\uff0c\u7136\u540e\u5728Service\u4e2d\u4f7f\u7528Mapper\u7684\u8be5\u65b9\u6cd5\u3002 5\u3001\u53ea\u4f7f\u7528Lambda\u6761\u4ef6\u6784\u9020\u5668</p> <p>\u5b98\u7f51\uff1a MyBatis-Plus (baomidou.com)</p> <p>\u4e0b\u4e00\u6b65\u91cd\u70b9\u5b66\u4e60\u76ee\u6807\uff1a\u4ee3\u7801\u751f\u6210\u5668\u7684\u4f7f\u7528\u3001\u4e3b\u952e\u7b56\u7565</p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/0-Servlet%E7%9A%84%E6%9C%AC%E8%B4%A8/","title":"0-Servlet\u7684\u672c\u8d28","text":"<p> \u7ea6 269 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>Servlet\u662f\u4e00\u5957\u89c4\u8303\uff08\u63a5\u53e3\uff09\uff0c\u7c7b\u4f3c\u4e8eJDBC\uff0c\u53ea\u4e0d\u8fc7JDBC\u662fJavaSE\u7684\u5185\u5bb9\uff0cJDK\u4e2d\u5305\u542b\uff0c\u4f46\u662fServlet\u662fJavaEE\u7684\u5185\u5bb9\uff0cJDK\u4e2d\u4e0d\u5305\u542b\uff0c\u6240\u4ee5\u8fd9\u5957\u63a5\u53e3\u8fd8\u9700\u8981\u53e6\u5916\u5bfc\u5305\u3002\u5f53\u7136\uff0c\u65e0\u8bba\u662fServlet\uff0c\u8fd8\u662fJDBC\uff0c\u90fd\u662f\u63a5\u53e3\uff0c\u771f\u6b63\u8fd0\u884c\u8fd8\u9700\u8981\u5b9e\u73b0\u7c7b\uff0c\u6bd4\u5982\u5982\u679c\u8fde\u63a5\u7684\u662fMySQL\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5c06MySQL\u5b98\u65b9\u63d0\u4f9b\u7684JDBC\u5305\u5bfc\u5165\u5230\u9879\u76ee\u4e2d\uff0c\u7c7b\u4f3c\u7684\uff0cTomcat\u5c31\u662fServlet\u63a5\u53e3\u7684\u4e00\u79cd\u5b9e\u73b0\u3002</p> <p>\u6a21\u62df\u4e00\u4e0bServlet\u7684\u539f\u7406</p> <p>Servlet\u89c4\u8303\uff08\u63a5\u53e3\uff09 Text Only<pre><code>public interface Servlet {\n\u00a0\u00a0\u00a0\u00a0void service();\n}\n</code></pre></p> <p>Tomcat Text Only<pre><code>public class Tomcat {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Tomcat \u542f\u52a8\u6210\u529f\uff01\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Scanner scanner = new Scanner(System.in);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileReader fileReader = new FileReader(\"D:\\\\Project\\\\IdeaProjects\\\\servlet\\\\src\\\\main\\\\java\\\\web.xml\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.load(fileReader);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fileReader.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap&lt;String, Servlet&gt; map = new HashMap&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8bf7\u8f93\u5165\u8bbf\u95ee\u8def\u5f84\uff1a\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String path = scanner.next();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String ser = (String) properties.get(path);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Servlet servlet = map.getOrDefault(ser, (Servlet) Class.forName(ser).newInstance());\n `servlet.service();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Web\u7a0b\u5e8f\u5f00\u53d1\u7684Servlet LoginServlet Text Only<pre><code>public class LoginServlet implements Servlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u6210\u529f\u767b\u5f55!\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>SaveConfigServlet Text Only<pre><code>public class SaveConfigServlet implements Servlet{\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u6210\u529f\u4fdd\u5b58\u914d\u7f6e\uff01\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4f7f\u7528web.xml\u914d\u7f6e\u8bf7\u6c42\u8def\u5f84\u4e0eServlet\u7684\u5bf9\u5e94\u5173\u7cfb Text Only<pre><code>/login=LoginServlet\n/save=SaveConfigServlet\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/1-Servlet%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/","title":"1-Servlet\u751f\u547d\u5468\u671f","text":"<p> \u7ea6 301 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u751f\u547d\u5468\u671f\uff1a\u5bf9\u8c61\u4ece\u521b\u5efa\u5230\u9500\u6bc1\u7ecf\u5386\u7684\u8fc7\u7a0b\u3002 Text Only<pre><code>public class HelloServlet implements Servlet {\n\u00a0\u00a0\u00a0\u00a0//\u5bf9\u8c61\u521b\u5efa\u7684\u65f6\u5019\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void init(ServletConfig servletConfig) throws ServletException {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u7528\u6237\u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u5bf9\u8c61\u5373\u5c06\u9500\u6bc1\u65f6\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void destroy() {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public ServletConfig getServletConfig() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String getServletInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Servlet\u751f\u547d\u5468\u671f\uff1a</p> <ol> <li>\u7528\u6237\u53d1\u9001\u8bf7\u6c42</li> <li>Tomcat\u63a5\u6536\u8bf7\u6c42\uff0c\u627e\u8def\u5f84\u5bf9\u5e94\u7684Servlet\u5bf9\u8c61</li> <li>\u6ca1\u627e\u5230\uff0c\u5229\u7528\u53d1\u5c04\u673a\u5236\u521b\u5efa\u5bf9\u8c61\uff08\u4e8b\u5b9e\u4e0aTomcat\u4f1a\u5c06Servlet\u5b58\u5728Map\u4e2d\uff0ckey\u662f\u8bf7\u6c42\u8def\u5f84\uff0cvalue\u662fServlet\u5bf9\u8c61\u7684\u5f15\u7528\uff09</li> </ol> <p>3.1\u00a0\u8c03\u7528\u65e0\u53c2\u6784\u9020 \u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0 3.2\u00a0\u8c03\u7528init\u65b9\u6cd5</p> <ol> <li>\u8c03\u7528service\u65b9\u6cd5</li> <li>\u5f53web\u5bb9\u5668\u5173\u95ed\uff0c\u6216\u8005\u8be5Servlet\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u8c03\u7528destroy\u65b9\u6cd5\uff0c\u5b8c\u6210\u9500\u6bc1\u524d\u7684\u52a8\u4f5c</li> </ol> <p>\u6ce8\u610f\uff1aTomcat\u4f1a\u591a\u7ebf\u7a0b\u5904\u7406\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u4f46\u662f\u4e0d\u4f1a\u6bcf\u6b21\u8bf7\u6c42\u90fd\u521b\u5efaServlet\u5bf9\u8c61\uff0c\u6240\u6709\u7528\u6237\u76f8\u540c\u7684\u8bf7\u6c42\u90fd\u662f\u540c\u4e00\u4e2aServlet\u5bf9\u8c61\u5904\u7406\u7684\uff0c\u6240\u4ee5<code>Servlet\u7684\u5b9e\u4f8b\u53d8\u91cf\u6d89\u53ca\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002</code></p> <p>\u53ef\u4ee5\u8fdb\u884c\u914d\u7f6e\u8ba9Servlet\u5bf9\u8c61\u5728web\u5bb9\u5668\u542f\u52a8\u9636\u6bb5\u5b8c\u6210\u521b\u5efa\u3002 Text Only<pre><code>&lt;servlet&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-class&gt;t2.HelloServlet&lt;/servlet-class&gt;\n\u00a0\u00a0\u00a0\u00a0`&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;`\n&lt;/servlet&gt;\n&lt;servlet-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/hello&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/10-%E8%BF%87%E6%BB%A4%E5%99%A8/","title":"10-\u8fc7\u6ee4\u5668","text":"<p> \u7ea6 629 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>JavaWeb\u7684\u4e09\u5927\u7ec4\u4ef6\uff1aServlet\u3001Filter\uff08\u8fc7\u6ee4\u5668\uff09\u3001Listener\uff08\u76d1\u542c\u5668\uff09\u3002 Filter\uff08\u8fc7\u6ee4\u5668\uff09 \u53c2\u8003\uff1a https://juejin.cn/post/7000950677409103880</p> <p>Filter\u548cServlet\u5dee\u4e0d\u591a\uff0c\u90fd\u662f\u5904\u7406\u8bf7\u6c42\u7684\uff0c\u53ea\u4e0d\u8fc7Filter\u5728Servlet\u4e4b\u524d\u6267\u884c\uff0c\u8d77\u5230\u8fc7\u6ee4\u8bf7\u6c42\u7684\u4f5c\u7528\uff0c\u6bd4\u5982\uff1a\u907f\u514d\u4e2d\u6587\u4e71\u7801\uff08\u7edf\u4e00\u8bbe\u7f6e\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u7f16\u7801\uff09\u3001\u6743\u9650\u9a8c\u8bc1\u3001\u81ea\u52a8\u767b\u5f55\u7b49\u3002 1\u3001\u914d\u7f6eFilter\u7684\u8bf7\u6c42\u8def\u5f84\uff0c\u8def\u5f84\u4e00\u822c\u90fd\u662f\u6a21\u7cca\u5339\u914d\uff0c\u4ee5\u505a\u5230\u62e6\u622a\u66f4\u591a\u8bf7\u6c42 Text Only<pre><code>&lt;filter&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;AdminFilter01&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-class&gt;filter.AdminFilter01&lt;/filter-class&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;init-param&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;param-name&gt;url&lt;/param-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;param-value&gt;it's a url.&lt;/param-value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/init-param&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;AdminFilter01&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;\n\n&lt;filter&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;AdminFilter02&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-class&gt;filter.AdminFilter02&lt;/filter-class&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;AdminFilter02&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;\n</code></pre></p> <p>2\u3001\u5b9e\u73b0javax.servlet.Filter\u63a5\u53e3 Text Only<pre><code>public class AdminFilter01 implements Filter {\n\u00a0\u00a0\u00a0\u00a0FilterConfig filterConfig;\n\n\u00a0\u00a0\u00a0\u00a0public AdminFilter01() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"1. AdminFilter\u6784\u9020\u5668\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void init(FilterConfig filterConfig) throws ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"2. AdminFilter init()\u65b9\u6cd5\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.filterConfig = filterConfig;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"filter-name\u7684\u503c\u662f\uff1a\" + filterConfig.getFilterName());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u521d\u59cb\u5316\u53c2\u6570url\u7684\u503c\u662f\" + filterConfig.getInitParameter(\"url\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(filterConfig.getServletContext());\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u62e6\u622a/admin\u4e0b\u7684\u6240\u6709\u8bf7\u6c42\uff0c\u5b9e\u73b0\u53ea\u6709username=admin\u7684\u7528\u6237\u624d\u80fd\u8bbf\u95eeadmin\u4e0b\u7684\u8d44\u6e90\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"3. AdminFilter doFilter()\u65b9\u6cd5\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpSession session = ((HttpServletRequest) request).getSession();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0User user = (User) session.getAttribute(\"user\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (user == null){ //\u8bbf\u95eeadmin\u4e0b\u7684\u8d44\u6e90\u65f6\u53d1\u73b0\u7528\u6237\u6ca1\u6709\u767b\u5f55\uff0c\u91cd\u5b9a\u5411\u5230\u7528\u6237\u767b\u5f55\u9875\u9762\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0request.getRequestDispatcher(\"/login.jsp\").forward(request,response);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (!user.getName().equals(\"admin\")) { //\u8bbf\u95eeadmin\u4e0b\u7684\u8d44\u6e90\u65f6\u53d1\u73b0\u7528\u6237\u4e0d\u662fadmin\uff0c\u91cd\u5b9a\u5411\u5230\u666e\u901a\u4e3b\u9875\u9762\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0request.getRequestDispatcher(\"/index.jsp\").forward(request,response);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else { //\u7528\u6237\u662fadmin\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u524d\u7f6e\u4ee3\u78011\"); //\u4e0a\u9762\u90fd\u662f\u524d\u7f6e\u4ee3\u7801\uff0c\u8fc7\u6ee4\u5668\u7684\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* chain.doFilter(request, response);\u7684\u4f5c\u7528\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*\u00a0\u00a0\u00a0\u00a01.\u5982\u679c\u6709\u4e0b\u4e00\u4e2aFilter\u8fc7\u6ee4\u5668\uff0c\u5219\u6267\u884c\u4e0b\u4e00\u4e2a\u8fc7\u6ee4\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*\u00a0\u00a0\u00a0\u00a02.\u5982\u679c\u6ca1\u6709\u4e0b\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5219\u653e\u884c\uff0c\u6267\u884c\u5bf9\u5e94\u7684Servlet\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u5982\u679c\u8fd9\u4e2a\u5730\u65b9\u6ca1\u6709\u5199chain.doFilter(req,resp); \u8d44\u6e90\u5c31\u4f1a\u88ab\u62e6\u622a\uff0c\u4e0d\u518d\u5f80\u4e0b\u8d70\u4e86\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u6267\u884cServlet\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0chain.doFilter(request, response); //\u653e\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u540e\u7f6e\u4ee3\u78011\uff08\u6267\u884c\u5b8cServlet\u540e\u518d\u56de\u5230\u8fd9\u91cc\uff09\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void destroy() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"4. AdminFilter destroy()\u65b9\u6cd5\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>3\u3001Filter\u7684\u751f\u547d\u5468\u671f</p> <ol> <li>\u521d\u59cb\u5316\uff1aservlet \u5bb9\u5668\u5728\u5b9e\u4f8b\u5316Filter\u540e\u4f1ainit\u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u533a\u522b\u4e8eServlet\uff0c\u8fc7\u6ee4\u5668\u4f1a\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u7acb\u5373\u5b9e\u4f8b\u5316\u5e76\u521d\u59cb\u5316\u3002init\u65b9\u6cd5\u4f1a\u4f20\u9012\u4e00\u4e2aFilterConfig\u5bf9\u8c61\uff0c\u4ece\u8be5\u5bf9\u8c61\u53ef\u4ee5\u83b7\u53d6\u521d\u59cb\u5316\u53c2\u6570\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7FilterConfig\u83b7\u53d6ServletContext\u5bf9\u8c61\u3002</li> <li>\u5b58\u6d3b\uff1a\u548c\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u662f\u4e00\u81f4\u7684\uff0c\u5728\u5185\u5b58\u4e2d\u662f\u5355\u4f8b\u7684\uff0c\u9488\u5bf9\u62e6\u622a\u8303\u56f4\u5185\u7684\u8d44\u6e90\uff0c\u6bcf\u6b21\u8bbf\u95ee\u90fd\u4f1a\u8c03\u7528void doFIlter(request,response.chain)\u8fdb\u884c\u62e6\u622a\u3002</li> <li>\u9500\u6bc1\uff1a\u5e94\u7528\u5173\u95ed\u65f6\uff0c\u4f1a\u8c03\u7528destroy\u65b9\u6cd5\u3002</li> </ol> <p>4\u3001\u591a\u4e2a\u8fc7\u6ee4\u5668\u7684\u6267\u884c\u987a\u5e8f \u5f53\u8bf7\u6c42\u5bf9\u5e94\u5b58\u5728\u591a\u4e2a\u8fc7\u6ee4\u5668\u65f6\uff0c\u8fc7\u6ee4\u5668\u6309\u7167web.xml\u4e2d\u5b9a\u4e49\u7684\u5148\u540e\u987a\u5e8f\u6267\u884c\u3002"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/11-%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%88%E5%86%85%E5%90%AB%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%89/","title":"11-\u76d1\u542c\u5668\uff08\u5185\u542b\u89c2\u5bdf\u8005\u6a21\u5f0f\uff09","text":"<p> \u7ea6 970 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>\u76d1\u542c\u5668\uff08Listener\uff09 \u53c2\u8003\uff1ahttps://juejin.cn/post/7001392790282174472</p> <p>\u4e00\u3001\u89c2\u5bdf\u8005\u6a21\u5f0f \u89c2\u5bdf\u8005\u63a5\u53e3\uff0c\u6240\u6709\u89c2\u5bdf\u8005\u90fd\u8981\u5b9e\u73b0\u7684\u63a5\u53e3 Text Only<pre><code>public interface Observer {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5f53Subject\uff08\u4e3b\u9898\uff09\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\uff0c\u4e8e\u662f\u5c31\u8fbe\u5230\u4e86\u901a\u77e5\u89c2\u5bdf\u8005\u6267\u884c\u76f8\u5e94\u52a8\u4f5c\u7684\u76ee\u7684\n\u00a0\u00a0\u00a0\u00a0\u00a0*\n\u00a0\u00a0\u00a0\u00a0\u00a0* @param subject \u901a\u77e5\u89c2\u5bdf\u8005\u7684\u4e3b\u9898\n\u00a0\u00a0\u00a0\u00a0\u00a0* @param arg\u00a0\u00a0\u00a0\u00a0\u00a0\u8981\u5411\u89c2\u5bdf\u8005\u4f20\u9012\u7684\u5176\u4ed6\u53c2\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0void response(Subject subject, Object... arg);\n}\n</code></pre> \u4e3b\u9898\u63a5\u53e3\uff0c\u4e3b\u9898\u662f\u6307\u88ab\u89c2\u5bdf\u7684\u4e3b\u4f53\uff0c\u6bcf\u4e00\u4e2a\u88ab\u89c2\u5bdf\u7684\u7c7b\u90fd\u8981\u5b9e\u73b0\u8be5\u63a5\u53e3 Text Only<pre><code>public interface Subject {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5411\u4e3b\u9898\u4e2d\u6ce8\u518c\u89c2\u5bdf\u8005\uff1a\u4e3b\u9898\u5728\u53d1\u751f\u53d8\u5316\u65f6\u9700\u8981\u901a\u77e5\u89c2\u5bdf\u8005\uff0c\u6240\u4ee5\u9700\u8981\u4fdd\u6301\u6240\u6709\u89c2\u5bdf\u8005\u7684\u5f15\u7528\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0* @param observer \u89c2\u5bdf\u8005\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0void registerObserver(Observer observer);\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u79fb\u9664\u89c2\u5bdf\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0* @param observer \u89c2\u5bdf\u8005\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0void removeObserver(Observer observer);\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u901a\u77e5\u6240\u6709\u5df2\u7ecf\u6ce8\u518c\u7684\u89c2\u5bdf\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0void notifyAllObserver();\n}\n</code></pre> \u4e3b\u98981\uff1a Text Only<pre><code>public class SubOne implements Subject {\n\n\u00a0\u00a0\u00a0\u00a0List&lt;Observer&gt; observers = new ArrayList&lt;&gt;();\n\n\u00a0\u00a0\u00a0\u00a0//\u6ce8\u518c\u89c2\u5bdf\u8005\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void registerObserver(Observer observer) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0observers.add(observer);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u79fb\u9664\u89c2\u5bdf\u8005\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void removeObserver(Observer observer) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0observers.remove(observer);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u901a\u77e5\u6240\u6709\u89c2\u5bdf\u8005\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void notifyAllObserver() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Observer observer : observers) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0observer.response(this);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void doSomething() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u4e3b\u9898\u505a\u4e86\u67d0\u4e9b\u52a8\u4f5c\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0notifyAllObserver();//\u505a\u5b8c\u52a8\u4f5c\u9700\u8981\u901a\u77e5\u89c2\u5bdf\u8005\uff0c\u8fbe\u5230\u4e86\u901a\u77e5\u89c2\u5bdf\u8005\u6267\u884c\u76f8\u5e94\u52a8\u4f5c\u7684\u76ee\u7684\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u89c2\u5bdf\u80051 Text Only<pre><code>public class ObserverOne implements Observer {\n\n\u00a0\u00a0\u00a0\u00a0//\u628a\u81ea\u5df1\u6ce8\u518c\u5230\u4e3b\u9898\u4e2d\n\u00a0\u00a0\u00a0\u00a0public ObserverOne(Subject subject) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0subject.registerObserver(this);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void response(Subject subject, Object... arg) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(subject + \"\u53d1\u751f\u53d8\u5316\uff0cObserverOne \u5bf9\u6b64\u505a\u51fa\u53cd\u5e94\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u89c2\u5bdf\u80052 Text Only<pre><code>public class ObserverTwo implements Observer {\n\n\u00a0\u00a0\u00a0\u00a0//\u628a\u81ea\u5df1\u6ce8\u518c\u5230\u4e3b\u9898\u4e2d\n\u00a0\u00a0\u00a0\u00a0public ObserverTwo(Subject subject) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0subject.registerObserver(this);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void response(Subject subject, Object... arg) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(subject + \"\u53d1\u751f\u53d8\u5316\uff0cObserverTwo \u5bf9\u6b64\u505a\u51fa\u53cd\u5e94\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4e3b\u7a0b\u5e8f Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0SubOne subOne = new SubOne(); //\u521b\u5efa\u4e3b\u9898\n\u00a0\u00a0\u00a0\u00a0new ObserverOne(subOne); //\u65b0\u5efa\u89c2\u5bdf\u80051\n\u00a0\u00a0\u00a0\u00a0new ObserverTwo(subOne); //\u65b0\u5efa\u89c2\u5bdf\u80052\n\u00a0\u00a0\u00a0\u00a0subOne.doSomething();\n}\n</code></pre></p> <p>\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u7c7b\u56fe </p> <p>\u4e8c\u3001\u76d1\u542c\u5668\uff08Listener\uff09 \u76d1\u542c\u5668\u5c31\u662f\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u5728Servlet\u89c4\u8303\u4e2d\u5b9a\u4e49\u4e86\u591a\u79cd\u7c7b\u578b\u7684\u76d1\u542c\u5668\uff0c\u7528\u4e8e\u76d1\u542cServletContext\uff0cHttpSession\u548cServletRequest\u8fd9\u4e09\u4e2a\u57df\u5bf9\u8c61\u7684\u53d8\u5316\u3002</p> <p>1\u3001\u751f\u547d\u5468\u671f\u76d1\u542c\u5668 \u751f\u547d\u5468\u671f\u76d1\u542c\u5668\u4e13\u95e8\u7528\u4e8e\u76d1\u542c\u57df\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u9500\u6bc1\u4e8b\u4ef6\uff0c\u4e3b\u8981\u6709\u4e09\u4e2aServletContextListener\u3001HttpSessionListener\u3001ServletRequestListener\u3002 ServletContextListener\uff0c\u76d1\u542cServletContext\u5bf9\u8c61\u7684\u521b\u5efa\u548c\u9500\u6bc1\u3002 Text Only<pre><code>default public void contextInitialized(ServletContextEvent evt)\uff1aServletContext\u5bf9\u8c61\u88ab\u521b\u5efa\u540e\u8c03\u7528\uff1b\ndefault public void contextDestroyed(ServletContextEvent evt)\uff1aServletContext\u5bf9\u8c61\u88ab\u9500\u6bc1\u524d\u8c03\u7528\uff1b\n</code></pre> HttpSessionListener\uff0c\u5f00\u59cb\u4f1a\u8bdd\u548c\u7ed3\u675f\u4f1a\u8bdd\u65f6\u8c03\u7528\u4e0b\u9762\u4e24\u4e2a\u65b9\u6cd5\uff1a Text Only<pre><code>default public void sessionCreated(HttpSessionEvent evt)\uff1aHttpSession\u5bf9\u8c61\u88ab\u521b\u5efa\u540e\u8c03\u7528\uff1b\ndefault public void sessionDestroyed(HttpSessionEvent evt)\uff1aHttpSession\u5bf9\u8c61\u88ab\u9500\u6bc1\u524d\u8c03\u7528\uff1b\n</code></pre> ServletRequestListener\uff0c\u5f00\u59cb\u8bf7\u6c42\u548c\u7ed3\u675f\u8bf7\u6c42\u65f6\u8c03\u7528\u4e0b\u9762\u4e24\u4e2a\u65b9\u6cd5\uff1a Text Only<pre><code>default public void requestInitiallized(ServletRequestEvent evt)\uff1aServletRequest\u5bf9\u8c61\u88ab\u521b\u5efa\u540e\u8c03\u7528\uff1b\ndefault public void requestDestroyed(ServletRequestEvent evt)\uff1aServletRequest\u5bf9\u8c61\u88ab\u9500\u6bc1\u524d\u8c03\u7528\u3002\n</code></pre></p> <p>\u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a\u76d1\u542cSession\u521b\u5efa\u548c\u9500\u6bc1\u7684\u76d1\u542c\u5668 Text Only<pre><code>public class MyHttpSessionListener implements HttpSessionListener {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void sessionCreated(HttpSessionEvent se) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Session\u521b\u5efa: \" + se.getSession());\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void sessionDestroyed(HttpSessionEvent se) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Session\u9500\u6bc1: \" + se.getSession());\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u9700\u8981\u5728web.xml\u4e2d\u914d\u7f6e\uff0c\u76d1\u542c\u5668\u5c31\u662f\u89c2\u5bdf\u8005\uff0c\u6b64\u914d\u7f6e\u544a\u8bc9web\u5bb9\u5668\u521b\u5efa\u4e86\u4e00\u4e2a\u76d1\u542c\u5668\uff0c\u9700\u8981\u5c06\u5176\u6ce8\u518c\u5230HttpSession\u7c7b\u4e2d\u7684\u89c2\u5bdf\u8005\u5217\u8868\u4e2d\u3002 Text Only<pre><code>&lt;!--\u90e8\u7f72\u76d1\u542c\u5668--&gt;\n&lt;listener&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;listener-class&gt;com.example.listener.MyHttpSessionListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n</code></pre></p> <p>2\u3001\u5c5e\u6027\u76d1\u542c\u5668 \u5c5e\u6027\u76d1\u542c\u5668\u4e13\u95e8\u7528\u4e8e\u76d1\u542c\u57df\u5bf9\u8c61\u7684\u57df\u5c5e\u6027\u7684\u589e\u3001\u5220\u3001\u6539\u4e8b\u4ef6\uff0c\u4e3b\u8981\u6709\u4e09\u4e2a\uff1aServletContextAttributeListener\u3001HttpSessionAttributeListener\u3001ServletRequestAttributeListener\u3002 ServletContextAttributeListener\uff1a\u5728ServletContext\u57df\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u5c5e\u6027\u65f6\u8c03\u7528\u4e0b\u9762\u65b9\u6cd5\u3002 Text Only<pre><code>default public void attributeAdded(ServletContextAttributeEvent evt)\uff1a\u6dfb\u52a0\u57df\u5c5e\u6027\ndefault public void attributeRemoved(ServletContextAttributeEvent evt) \uff1a\u5220\u9664\u57df\u5c5e\u6027\ndefault public void attributeReplaced(ServletContextAttributeEvent evt) \uff1a\u4fee\u6539\u57df\u5c5e\u6027\n</code></pre> HttpSessionAttributeListener\uff1a\u5728HttpSession\u57df\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u5c5e\u6027\u65f6\u8c03\u7528\u4e0b\u9762\u65b9\u6cd5 Text Only<pre><code>default public void attributeAdded(HttpSessionBindingEvent evt) \uff1a\u6dfb\u52a0\u57df\u5c5e\u6027\ndefault public void attributeRemoved (HttpSessionBindingEvent evt) \uff1a\u5220\u9664\u57df\u5c5e\u6027\ndefault public void attributeReplaced (HttpSessionBindingEvent evt) \uff1a\u4fee\u6539\u57df\u5c5e\u6027\n</code></pre> ServletRequestAttributeListener\uff1a\u5728ServletRequest\u57df\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u5c5e\u6027\u65f6\u8c03\u7528\u4e0b\u9762\u65b9\u6cd5 Text Only<pre><code>default public void attributeAdded(ServletRequestAttributeEvent evt) \uff1a\u6dfb\u52a0\u57df\u5c5e\u6027\ndefault public void attributeRemoved (ServletRequestAttributeEvent evt) \uff1a\u5220\u9664\u57df\u5c5e\u6027\ndefault public void attributeReplaced (ServletRequestAttributeEvent evt) \uff1a\u4fee\u6539\u57df\u5c5e\u6027\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/2-ServletConfig%E6%8E%A5%E5%8F%A3/","title":"2-ServletConfig\u63a5\u53e3","text":"<p> \u7ea6 245 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>ServletConfig\u63a5\u53e3\uff1a 1\u3001ServletConfig\u662fServlet\u7684\u914d\u7f6e\u4fe1\u606f\u5bf9\u8c61\uff08Servlet\u5c06\u914d\u7f6e\u4fe1\u606f\u914d\u7f6e\u5728web.xml\u4e2d\uff09\u3002 2\u3001\u4e00\u4e2aServlet\u5bf9\u8c61\u5bf9\u5e94\u4e00\u4e2aServletConfig\u5bf9\u8c61\u3002 3\u3001\u5982\u679c\u8981\u5728service\u65b9\u6cd5\u4e2d\u4f7f\u7528ServletConfig\u5bf9\u8c61\uff0c\u53ef\u4ee5\u5728init\u65b9\u6cd5\u4e2d\u5c06ServletConfig\u8d4b\u7ed9\u5b9e\u4f8b\u53d8\u91cf\u3002 4\u3001ServletConfig\u63a5\u53e3\u5e38\u7528\u7684\u65b9\u6cd5\uff1a Text Only<pre><code>public class HelloServlet implements Servlet {\n\n\u00a0\u00a0\u00a0\u00a0private ServletConfig servletConfig;\n\n\u00a0\u00a0\u00a0\u00a0//\u5bf9\u8c61\u521b\u5efa\u7684\u65f6\u5019\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void init(ServletConfig servletConfig) throws ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.servletConfig = servletConfig;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u7528\u6237\u6bcf\u6b21\u8bf7\u6c42\u65f6\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0servletResponse.setContentType(\"text/html;charset=UTF-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter writer = servletResponse.getWriter();\n\u00a0 \u00a0 \u00a0 \u00a0 //servletConfig\u76844\u4e2a\u65b9\u6cd5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1\u3001\u901a\u8fc7key\u83b7\u53d6value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String value1 = `servletConfig.getInitParameter(\"key1\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String value2 = servletConfig.getInitParameter(\"key2\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(value1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(value2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2\u3001\u83b7\u53d6\u6240\u6709key\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Enumeration&lt;String&gt; keys = `servletConfig.getInitParameterNames();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (keys.hasMoreElements()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(keys.nextElement());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(servletConfig.getInitParameter(keys.nextElement()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3\u3001\u83b7\u53d6&lt;servlet-name&gt;\u6807\u7b7e\u4e2d\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String servletName = `servletConfig.getServletName();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(servletName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//**4\u3001\u83b7\u53d6ServletContext\u5bf9\u8c61\uff08\u91cd\u70b9\uff09**`\n `ServletContext application = servletConfig.getServletContext();`\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u5bf9\u8c61\u5373\u5c06\u9500\u6bc1\u65f6\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void destroy() {\n\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public ServletConfig getServletConfig() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return servletConfig;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String getServletInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5728web.xml\u4e2d\u5199\u914d\u7f6e\u4fe1\u606f Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0version=\"4.0\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;servlet-class&gt;t2.HelloServlet&lt;/servlet-class&gt;\n `&lt;init-param&gt;`\n `&lt;param-name&gt;key1&lt;/param-name&gt;`\n `&lt;param-value&gt;value1&lt;/param-value&gt;`\n `&lt;/init-param&gt;`\n `&lt;init-param&gt;`\n `&lt;param-name&gt;key2&lt;/param-name&gt;`\n `&lt;param-value&gt;value2&lt;/param-value&gt;`\n `&lt;/init-param&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/servlet&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/hello&lt;/url-pattern&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/servlet-mapping&gt;\n&lt;/web-app&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/3-ServletContext%E6%8E%A5%E5%8F%A3/","title":"3-ServletContext\u63a5\u53e3","text":"<p> \u7ea6 434 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>ServletContext\uff08Servlet\u4e0a\u4e0b\u6587\uff09\uff1a 1\u3001\u4e00\u4e2awebapp\u53ea\u6709\u4e00\u4e2aServletContext\u5bf9\u8c61\uff0c\u4e00\u4e2awebapp\u53ea\u6709\u4e00\u4e2aweb.xml\u6587\u4ef6\uff0cServletContext\u662fweb.xml\u7684\u5316\u8eab\u3002 2\u3001\u4e00\u4e2aweb.xml\u6587\u4ef6\u4e2d\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u6807\u7b7e\uff0c\u4e00\u4e2aServlet\u5bf9\u5e94\u4e00\u4e2aServletConfig\uff0cServletConfig\u662f\u6807\u7b7e\u7684\u5316\u8eab\u3002 3\u3001ServletContext\u5bf9\u8c61\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u521b\u5efa\uff0c\u5728\u670d\u52a1\u5668\u5173\u95ed\u65f6\u9500\u6bc1\uff0c\u6240\u6709Servlet\u5171\u4eab\u4e00\u4e2aServletContext\u5bf9\u8c61\uff0c\u662f\u6240\u6709Servlet\u7684\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u6bd4\u5982\uff0c\u6240\u6709\u7528\u6237\u82e5\u8981\u5171\u4eab\u540c\u4e00\u4e2a\u6570\u636e\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u6570\u636e\u653e\u5230ServletContext\u5bf9\u8c61\u4e2d\uff1b\u5f53\u7136\uff0c\u56e0\u4e3a\u662f\u591a\u7ebf\u7a0b\u5171\u4eab\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6240\u4ee5\u4fee\u6539<code>ServletContext\u4e2d\u7684\u6570\u636e\u65f6\u6d89\u53ca\u5230\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898</code>\u3002 <p>ServletContext\u5e38\u7528\u7684\u65b9\u6cd5\uff1a 1\u3001\u83b7\u53d6\u521d\u59cb\u5316\u53c2\u6570 \u5728web.xml\u4e2d\u914d\u7f6e\u4e0a\u4e0b\u6587\u53c2\u6570\uff0c\u8fd9\u4e9b\u4fe1\u606f\u4f1a\u88ab\u81ea\u52a8\u5c01\u88c5\u5230ServletContext\u5bf9\u8c61\u4e2d Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0version=\"4.0\"&gt;\n\n `&lt;context-param&gt;`\n `&lt;param-name&gt;username&lt;/param-name&gt;`\n `&lt;param-value&gt;zhangsan&lt;/param-value&gt;`\n `&lt;/context-param&gt;`\n `&lt;context-param&gt;`\n `&lt;param-name&gt;password&lt;/param-name&gt;`\n `&lt;param-value&gt;xxxx&lt;/param-value&gt;`\n `&lt;/context-param&gt;`\n\n\u00a0\u00a0\u00a0\u00a0&lt;servlet&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;servlet-class&gt;t2.HelloServlet&lt;/servlet-class&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;init-param&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;param-name&gt;key1&lt;/param-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;param-value&gt;value1&lt;/param-value&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/init-param&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/servlet&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/hello&lt;/url-pattern&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/servlet-mapping&gt;\n&lt;/web-app&gt;\n</code></pre> \u62ff\u5230\u6807\u7b7e\u4e2d\u914d\u7f6ekey-value\u952e\u503c\u5bf9\uff1a Text Only<pre><code>public class ServletTest02 implements Servlet {\n\n\u00a0\u00a0\u00a0\u00a0private ServletConfig servletConfig;\n\n\u00a0\u00a0\u00a0\u00a0//\u5bf9\u8c61\u521b\u5efa\u7684\u65f6\u5019\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void init(ServletConfig servletConfig) throws ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.servletConfig = servletConfig;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u7528\u6237\u6bcf\u6b21\u8bf7\u6c42\u65f6\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServletContext context = servletConfig.getServletContext();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u8fc7key\u83b7\u53d6value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String username = `context.getInitParameter(\"username\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String password = context.getInitParameter(\"password\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u6240\u6709key\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Enumeration&lt;String&gt; params = `context.getInitParameterNames();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (params.hasMoreElements()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String key = params.nextElement();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String value = context.getInitParameter(key);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u5bf9\u8c61\u5373\u5c06\u9500\u6bc1\u65f6\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void destroy() {}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public ServletConfig getServletConfig() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return servletConfig;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String getServletInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>2\u3001\u83b7\u53d6\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84 Text Only<pre><code>@Override\npublic void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0ServletContext context = servletConfig.getServletContext();\n\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0String realPath = `context.getRealPath(\"/index.html\");` //c:\\\\tomcat8\\\\webapps\\servlet-test\\index.html\n}\n</code></pre></p> <p>3\u3001\u5411ServletContext\u4e2d\u5b58\u53d6\u6570\u636e\uff08\u91cd\u70b9\uff09 AServlet Text Only<pre><code>@Override\npublic void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0ServletContext context = servletConfig.getServletContext();\n\u00a0\u00a0\u00a0\u00a0`context.setAttribute(\"zhangsan\", 18);`\n}\n</code></pre> BServlet Text Only<pre><code>@Override\npublic void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0ServletContext context = servletConfig.getServletContext();\n\u00a0\u00a0\u00a0\u00a0Integer age = (Integer) `context.getAttribute(\"zhangsan\");`\n\u00a0\u00a0\u00a0\u00a0`context.removeAttribute(\"zhangsan\");`\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/4-%E6%8A%BD%E8%B1%A1%E7%B1%BBGenericServlet%EF%BC%88%E5%86%85%E5%90%AB%20%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%EF%BC%89/","title":"4-\u62bd\u8c61\u7c7bGenericServlet\uff08\u5185\u542b \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\uff09","text":"<p> \u7ea6 274 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>\u6bcf\u6b21\u5b9e\u73b0Servlet\u90fd\u8981\u91cd\u5199\u5f88\u591a\u65b9\u6cd5\uff0c\u800c\u4ec5\u4ec5\u53ea\u6709service\u65b9\u6cd5\u662f\u5fc5\u8981\u7684\uff0c\u8fd9\u6837\u672a\u5fc5\u8fc7\u4e8e\u9ebb\u70e6\uff0c\u6240\u4ee5Servlet\u89c4\u8303\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u4fbf\u7684\u62bd\u8c61\u7c7bGenericServlet\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u4e8e\u4e0b\u9762\uff1a Text Only<pre><code>public abstract class GenericServlet implements Servlet {\n\n\u00a0\u00a0\u00a0\u00a0private transient ServletConfig config;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public `final` void init(ServletConfig servletConfig) throws ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.config = servletConfig;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `init();`\n\u00a0\u00a0\u00a0\u00a0}\n\n `public void init() {`\n `}`\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public ServletConfig getServletConfig() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return config;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String getServletInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"\";\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void destroy() {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0////////////////////\u989d\u5916\u63d0\u4f9b\u7684\u65b9\u6cd5/////////////////\n\u00a0\u00a0\u00a0\u00a0public String getInitParameter(String name) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return this.getServletConfig().getInitParameter(name);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public Enumeration&lt;String&gt; getInitParameterNames() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return this.getServletConfig().getInitParameterNames();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public ServletContext getServletContext() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return this.getServletConfig().getServletContext();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u975e\u5e38\u503c\u5f97\u5b66\u4e60\u7684\u7f16\u7a0b\u601d\u60f3\uff08\u8bbe\u8ba1\u6a21\u5f0f-\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\uff09\uff1a\u56e0\u4e3a\u91cc\u9762\u6709\u4e3a\u5b9e\u4f8b\u53d8\u91cfconfig\u8d4b\u503c\u7684\u4ee3\u7801\uff0c\u5982\u679c\u5b50\u7c7b\u8986\u76d6\u4f46\u662f\u6ca1\u6709\u8c03\u7528super.init(config)\uff0c\u5c31\u57cb\u4e0b\u4e86\u7a7a\u6307\u9488\u5f02\u5e38\u7684\u9690\u60a3\uff0c\u6240\u4ee5\u4e0d\u60f3\u88ab\u5b50\u7c7b\u8986\u76d6 init(ServletConfig)\u65b9\u6cd5\uff0c\u5c31\u5fc5\u987b\u4e3a init(ServletConfig)\u52a0\u4e0afianl\u5173\u952e\u5b57\uff0c\u4f46\u662f\u8fd9\u6837\u5b50\u7c7b\u5c31\u4e0d\u80fd\u5728\u521d\u59cb\u5316Servlet\u65f6\u505a\u64cd\u4f5c\u4e86\uff0c\u4e8e\u662f\u8fd9\u91cc\u63d0\u4f9b\u4e86\u7a7a\u7684init()\u65b9\u6cd5\u4f9b\u5b50\u7c7b\u91cd\u5199\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/5-HttpServlet%E6%8E%A5%E5%8F%A3/","title":"5-HttpServlet\u63a5\u53e3","text":"<p> \u7ea6 886 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 18 \u5206\u949f</p> <p>\u4e00\u3001Http\u534f\u8bae </p> <p></p> <p>\u6ce8\u610f\uff1aGET\u8bf7\u6c42\u652f\u6301\u7f13\u5b58\uff0c\u7b2c\u4e8c\u6b21\u8bbf\u95eeget\u8bf7\u6c42\u65f6\u4f1a\u8d70\u6d4f\u89c8\u5668\u7f13\u5b58\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728GET\u8bf7\u6c42\u540e\u9762\u52a0\u4e00\u4e2a\u65f6\u95f4\u6233\u4ece\u800c\u907f\u514d\u8d70\u7f13\u5b58\uff1bPOST\u8bf7\u6c42\u4e0d\u652f\u6301\u7f13\u5b58\uff0c\u6bcf\u6b21\u63d0\u4ea4POST\u8bf7\u6c42\u90fd\u4f1a\u8bbf\u95ee\u670d\u52a1\u5668\u3002</p> <p>HTTP\u534f\u8bae\u5728\u540c\u4e00\u4e2a\u7aef\u53e3\u4e0b\u8fde\u7eed\u53d1\u9001\u591a\u6b21\u8bf7\u6c42\uff0c\u4e00\u4f1a\u540e\u8fde\u7eed\u6536\u5230\u591a\u4e2a\u54cd\u5e94\uff0c\u8bf7\u95ee\u786e\u5b9a\u8bf7\u6c42\u4e0e\u54cd\u5e94\u7684\u5bf9\u5e94\u5173\u7cfb\uff1f \u56de\u7b54\uff1aHTTP/1.1\u534f\u8bae\u5728\u540c\u4e00\u4e2a\u7aef\u53e3\u4e0b\u53d1\u9001\u4e00\u6b21\u8bf7\u6c42\uff0c\u5fc5\u987b\u7b49\u5f85\u8be5\u8bf7\u6c42\u7684\u54cd\u5e94\u56de\u6765\u540e\u624d\u80fd\u53d1\u9001\u4e0b\u4e00\u6b21\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662fHTTP/1.1\u7684\u4e24\u4e2a\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u4e0d\u80fd\u91cd\u53e0\u3002HTTP\u5efa\u7acb\u5728TCP\u534f\u8bae\u4e4b\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4HTTP/1.1\u7684\u5355\u4e2aTCP\u8fde\u63a5\u5728\u540c\u4e00\u4e2a\u65f6\u523b\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u3002\u867d\u7136 HTTP/1.1 \u89c4\u8303\u4e2d\u89c4\u5b9a\u4e86 Pipelining \u6765\u8bd5\u56fe\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u4e2a\u529f\u80fd\u5728\u6d4f\u89c8\u5668\u4e2d\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\u3002 HTTP/2.0\u5e94\u8fd0\u800c\u751f\uff0c\u63d0\u4f9b\u4e86Multiplexing\u591a\u8def\u4f20\u8f93\u7279\u6027\uff0c\u53ef\u4ee5\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u540c\u65f6\u5b8c\u6210\u591a\u4e2a HTTP \u8bf7\u6c42\u3002 \u90a3\u4e48\u5728 HTTP/1.1 \u65f6\u4ee3\uff0c\u6d4f\u89c8\u5668\u662f\u5982\u4f55\u63d0\u9ad8\u9875\u9762\u52a0\u8f7d\u6548\u7387\u7684\u5462\uff1f\u4e3b\u8981\u6709\u4e0b\u9762\u4e24\u70b9\uff1a</p> <ol> <li>\u7ef4\u6301\u548c\u670d\u52a1\u5668\u5df2\u7ecf\u5efa\u7acb\u7684 TCP \u8fde\u63a5\uff0c\u5728\u540c\u4e00\u8fde\u63a5\u4e0a\u987a\u5e8f\u5904\u7406\u591a\u4e2a\u8bf7\u6c42\uff08 HTTP1.0\u662f\u77ed\u8fde\u63a5\uff0c\u4e00\u6b21\u8bf7\u6c42\u4e0e\u54cd\u5e94\u4e4b\u540e\u4f1a\u7acb\u523b\u65ad\u5f00\u8fde\u63a5\uff1b\u800cHTTP1.1 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5efa\u7acb TCP \u8fde\u63a5\u4e0d\u4f1a\u65ad\u5f00\uff0c\u53ea\u6709\u5728\u8bf7\u6c42\u62a5\u5934\u4e2d\u58f0\u660e Connection: close \u624d\u4f1a\u5728\u8bf7\u6c42\u5b8c\u6210\u540e\u5173\u95ed\u8fde\u63a5\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u9875\u9762\u52a0\u8f7d\u6548\u7387\uff09\u3002</li> <li>\u548c\u670d\u52a1\u5668\u5efa\u7acb\u591a\u4e2a TCP \u8fde\u63a5\u3002\u65e2\u7136\u4e00\u4e2aTCP\u8fde\u63a5\u4e2d\u4e0d\u80fd\u5e76\u884c\u8bf7\u6c42\uff0c\u90a3\u5c31\u5efa\u7acb\u591a\u4e2aTCP\u8fde\u63a5\u3002</li> </ol> <p>\u4e8c\u3001HttpServlet Http\u534f\u8bae\u7684\u8bf7\u6c42\u4e2d\u5185\u5bb9\u4f1a\u5c01\u88c5\u5230HttpRequest\u4e2d\uff0c\u6bd4\u5982\u53ef\u4ee5HttpRequest\u4e2d\u7684getMethod\u65b9\u6cd5\u62ff\u5230\u8bf7\u6c42\u884c\u4e2d\u7684\u8bf7\u6c42\u65b9\u5f0f\uff1a Text Only<pre><code>public class ServletTest04 extends GenericServlet {\n\n\u00a0\u00a0\u00a0\u00a0//\u7528\u6237\u6bcf\u6b21\u8bf7\u6c42\u65f6\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`String method = httpServletRequest.getMethod();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"GET\".equals(method)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8fd9\u662f\u4e00\u4e2aGET\u8bf7\u6c42\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (\"POST\".equals(method)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8fd9\u662f\u4e00\u4e2aPOST\u8bf7\u6c42\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5f00\u53d1\u4e2d\u9700\u8981\u5bf9Get\u8bf7\u6c42\u548cPOST\u8bf7\u6c42\u505a\u4e0d\u540c\u7684\u5904\u7406\uff0c\u663e\u7136\u4e0a\u8ff0\u4ee3\u7801\u6bcf\u6b21\u90fd\u9700\u8981\u91cd\u590d\u7f16\u5199\u4e00\u6b21\uff0c\u53ea\u662fif-else\u91cc\u7684\u5185\u5bb9\u4e0d\u540c\u800c\u5df2\uff0c\u4e8e\u662f\u53ef\u4ee5\u4f7f\u7528\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u5c06\u8fd9\u6bb5\u91cd\u590d\u7684\u4ee3\u7801\u63d0\u53d6\u51fa\u6765\uff08Tomcat\u63d0\u4f9b\u7684HttpServlet\u7684\u5b9e\u73b0\u539f\u7406\u7c7b\u4f3c\uff09\u3002 Text Only<pre><code>public class HttpServlet extends GenericServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public final void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpServletRequest httpServletRequest = (HttpServletRequest) servletRequest;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpServletResponse httpServletResponse = (HttpServletResponse) servletResponse;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String method = httpServletRequest.getMethod();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"GET\".equals(method)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0doGet(httpServletRequest, httpServletResponse);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (\"POST\".equals(method)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0doPost(httpServletRequest, httpServletResponse);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0 \u00a0 //http\u72b6\u6001\u7801405\u8868\u793a\u670d\u52a1\u5668\u4e0d\u652f\u6301\u8be5\u8bf7\u6c42\u65b9\u5f0f\uff0chttp status 405 - http nethod GET is not supported by this url\n\u00a0\u00a0\u00a0\u00a0public void doGet(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpServletResponse.setContentType(\"text/html;charset=utf-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter out = httpServletResponse.getWriter();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.println(\"405-\u8be5Servlet\u4e0d\u652f\u6301GET\u8bf7\u6c42\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"405\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void doPost(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpServletResponse.setContentType(\"text/html;charset=utf-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter out = httpServletResponse.getWriter();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.println(\"405-\u8be5Servlet\u4e0d\u652f\u6301post\u8bf7\u6c42\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"405\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8e\u662f\u4ee5\u540e\u5199Servlet\u53ef\u4ee5\u76f4\u63a5\u7ee7\u627fHttpServlet\u91cd\u5199doGet\u65b9\u6cd5\u6216\u8005doPost\u65b9\u6cd5\uff0c\u6bd4\u5982LoginHttpServlet\u3001LogoutHttpServlet\uff1a \u5411LoginHttpServlet\u53d1\u9001get\u8bf7\u6c42\u4f1a\u5411\u524d\u7aef\u8fd4\u56de\u5f02\u5e38\uff0c\u540c\u65f6\u670d\u52a1\u5668\u7aef\u4f1a\u629b\u5f02\u5e38 Text Only<pre><code>public class LoginHttpServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void doPost(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpServletResponse.setContentType(\"text/html;charset=utf-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter out = httpServletResponse.getWriter();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.println(\"200\uff0c\u767b\u5f55\u6210\u529f\uff01\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5411LogoutHttpServlet\u53d1\u9001post\u8bf7\u6c42\u4f1a\u5411\u524d\u7aef\u8fd4\u56de\u5f02\u5e38\uff0c\u540c\u65f6\u670d\u52a1\u5668\u7aef\u4f1a\u629b\u5f02\u5e38 Text Only<pre><code>public class LogoutHttpServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void doGet(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpServletResponse.setContentType(\"text/html;charset=utf-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter out = httpServletResponse.getWriter();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.println(\"200\uff0c\u9000\u51fa\u6210\u529f\uff01\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/6-%20HttpServletRequest%E6%8E%A5%E5%8F%A3%20%E5%92%8C%20HttpServletResponse%E6%8E%A5%E5%8F%A3/","title":"6- HttpServletRequest\u63a5\u53e3 \u548c HttpServletResponse\u63a5\u53e3","text":"<p> \u7ea6 1087 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 22 \u5206\u949f</p> <p>\u4e00\u3001HttpServletRequest\u63a5\u53e3 HttpServletRequest\u7ee7\u627f\u81eaServletRequest\u63a5\u53e3\uff0c\u540c\u6837\u7531Web\u5bb9\u5668\u5b9e\u73b0\u3002 Text Only<pre><code>public interface HttpServletRequest extends ServletRequest\n</code></pre> HttpServletRequest\u5bf9\u8c61\u5c01\u88c5\u4e86HTTP\u534f\u8bae\u8bf7\u6c42\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u7528\u6237\u7684\u6bcf\u4e00\u6b21\u8bf7\u6c42Tomcat\u90fd\u4f1anew\u4e00\u4e2aHttpServletRequest\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u8bf7\u6c42\u5bf9\u5e94\u7740\u4e00\u4e2aHttpServletRequest\u5bf9\u8c61\uff0c\u6240\u4ee5HttpServletRequest\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u662f\u77ed\u6682\u7684\u3002</p> <p>1\u3001\u83b7\u53d6\u8bf7\u6c42\u63d0\u4ea4\u7684\u6570\u636e \u8868\u5355\u63d0\u4ea4\u7684\u6570\u636e\u4f1a\u81ea\u52a8\u5c01\u88c5\u5230HttpServletRequest\u5bf9\u8c61\u4e2d\uff0cHttpServletRequest\u4f1a\u7528Map\u96c6\u5408\u5b58\u8fd9\u4e9b\u6570\u636e\uff0c\u5176\u4e2dvalue\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u4e00\u7ef4\u6570\u7ec4\uff0c\u56e0\u4e3a\u8868\u5355\u53ef\u4ee5\u6709\u591a\u9009\u6846\u3002 Text Only<pre><code>public class ServletTest05 extends HttpServlet{\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u83b7\u53d6\u4e00\u7ef4\u6570\u7ec4\u4e2d\u7684\u9996\u5143\u7d20\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String username = req.getParameter(\"username\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u83b7\u53d6\u4e00\u7ef4\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] sports = req.getParameterValues(\"sports\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3.\u83b7\u53d6Map\u96c6\u5408\u6240\u6709\u7684key\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Enumeration&lt;String&gt; names = req.getParameterNames();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4.\u83b7\u53d6\u6574\u4e2aMap\u96c6\u5408\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Map&lt;String, String[]&gt; map = req.getParameterMap();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2\u3001\u83b7\u53d6\u8bf7\u6c42\u7684\u4fe1\u606f Text Only<pre><code>public class ServletTest06 extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String contextPath = req.getContextPath();//\u83b7\u53d6\u4e0a\u4e0b\u6587\u8def\u5f84\uff0cwebapp\u7684\u8def\u5f84\uff0c\u4e5f\u5c31\u662f \u9879\u76ee\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String method = req.getMethod();//\u83b7\u53d6\u6d4f\u89c8\u5668\u7684\u8bf7\u6c42\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String uri = req.getRequestURI();//\u83b7\u53d6URI\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StringBuffer url = req.getRequestURL();//\u83b7\u53d6URL\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String servletPath = req.getServletPath();//\u83b7\u53d6Servlet Path\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String remoteAddr = req.getRemoteAddr();//\u83b7\u53d6\u5ba2\u6237\u7aefIP\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u7ed3\u679c\uff1a   \u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff1a \u00a0\u00a0 \u00a0req.getRequestURI() = req.getContextPath() +\u00a0req.getServletPath() \u00a0\u00a0 \u00a0uri = \u9879\u76ee\u540d + servlet\u8bf7\u6c42\u8def\u5f84(\u5728web.xml\u91cc\u9762\u914d\u7f6e\u7684\u8def\u5f84)</p> <p>3\u3001\u5411HttpServletRequest\u4e2d\u5b58\u53d6\u6570\u636e request\u8303\u56f4\uff1a\u53ea\u80fd\u5728\u540c\u4e00\u6b21\u8bf7\u6c42\u4e2d\u4f20\u9012\u6570\u636e\uff01\uff08\u8f6c\u53d1\u53ef\u4ee5\uff0c\u91cd\u5b9a\u5411\u4e0d\u884c\uff09 Text Only<pre><code>public class AServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5411request\u8303\u56f4\u5b58\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0req.setAttribute(\"name\", \"zahngsan\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4ecerequest\u8303\u56f4\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String name = (String) req.getAttribute(\"name\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4ecerequest\u8303\u56f4\u4e2d\u79fb\u9664\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0req.removeAttribute(\"name\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>4\u3001\u5728\u670d\u52a1\u5668\u7aef\u8f6c\u53d1\u8bf7\u6c42 \u5728\u670d\u52a1\u5668\u7aef\u8f6c\u53d1\u8bf7\u6c42\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684HttpServletRequest\u5bf9\u8c61\uff0c\u5373\u8c03\u7528\u65b0\u7684Servlet\u7684service\u65b9\u6cd5\u65f6\u590d\u7528\u4e4b\u524d\u7684request\u548cresponse\u5bf9\u8c61\uff0c\u6240\u4ee5\u8fd9\u59cb\u7ec8\u662f\u4e00\u6b21\u8bf7\u6c42\u4e0e\u54cd\u5e94\uff0c\u53ef\u4ee5\u4f7f\u7528getAttribute\u65b9\u6cd5\u83b7\u53d6request\u5bf9\u8c61\u4e2d\u7684\u6570\u636e\u3002 Text Only<pre><code>//\u83b7\u53d6\u8bf7\u6c42\u8f6c\u53d1\u5668\u5bf9\u8c61\nRequestDispatcher requestDispatcher = `req.getRequestDispatcher(\"/b\");`\n//\u8f6c\u53d1\u8bf7\u6c42\nrequestDispatcher.forward(req, resp);\n</code></pre></p> <p>5\u3001\u8bbe\u7f6e\u8bfb\u53d6HttpServletRequest\u5bf9\u8c61\u4e2d\u4ece\u6d4f\u89c8\u5668\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\u7684\u7f16\u7801\u683c\u5f0f Text Only<pre><code>//\u8bbe\u7f6e\u8bfb\u53d6GET\u6216\u8005POST\u8bf7\u6c42\u53d1\u9001\u8fc7\u6765\u6570\u636e\u7684\u7f16\u7801\u683c\u5f0f\n`req.setCharacterEncoding(\"UTF-8\");`\nString name = req.getParameter(\"name\");\n</code></pre></p> <p>6\u3001\u83b7\u53d6\u8bf7\u6c42\u4f53\u4e2d\u7684Cookie Text Only<pre><code>public class GetCookieServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`Cookie[] cookies = request.getCookies();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Arrays.toString(cookies));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>7\u3001\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6Session\u5bf9\u8c61 Text Only<pre><code>public class SessionServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`HttpSession session = request.getSession();`\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001HttpServletResponse\u63a5\u53e3 HttpServletResponse\u7ee7\u627f\u81eaServletResponse\uff1a Text Only<pre><code>public interface HttpServletResponse extends ServletResponse\n</code></pre> 1\u3001\u91cd\u5b9a\u5411\uff08\u91cd\u70b9\uff09 \u91cd\u5b9a\u5411\u662f\u4e24\u6b21\u8bf7\u6c42\uff0c\u5373\u670d\u52a1\u5668\u5411\u6d4f\u89c8\u5668\u53d1\u9001\u4e86\u4e00\u4e2a\u91cd\u5b9a\u5411\u54cd\u5e94\uff0c\u7136\u540e\u6d4f\u89c8\u5668\u7d27\u63a5\u7740\u53c8\u53d1\u8d77\u4e86\u4e00\u6b21\"XXX/b\"\u7684\u8bf7\u6c42\u3002 Text Only<pre><code>public class ServletTest07 extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`resp.sendRedirect(req.getContextPath() + \"/b\");`\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f6c\u53d1\u548c\u91cd\u5b9a\u5411\u90fd\u53ef\u4ee5\u5b8c\u6210\u8d44\u6e90\u8df3\u8f6c\uff0c\u4f46\u662f\u4e8c\u8005\u7684\u533a\u522b\u5341\u5206\u91cd\u8981\uff1a a. \u8f6c\u53d1\u662fRequest\u7684\u65b9\u6cd5\uff1b\u91cd\u5b9a\u5411\u662fresponse\u7684\u65b9\u6cd5\u3002 b.\u00a0\u8f6c\u53d1\u662f\u76f4\u63a5\u5728\u670d\u52a1\u5668\u7aef\u5b8c\u6210\uff0c\u81ea\u59cb\u81f3\u7ec8\u53ea\u662f\u4e00\u6b21\u8bf7\u6c42\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u7684\u5730\u5740\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff1b\u4f46\u662f\u91cd\u5b9a\u5411\u662f\u4e24\u6b21\u8bf7\u6c42\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4e0a\u5730\u5740\u4f1a\u53d1\u751f\u53d8\u5316\u3002 c.\u00a0\u56e0\u4e3a\u8f6c\u53d1\u662f\u5728\u670d\u52a1\u5668\u7aef\u5b8c\u6210\uff0c\u6240\u4ee5\u586b\u5199\u5730\u5740\u7684\u65f6\u5019\u4e0d\u7528\u52a0webapp\u6839\u8def\u5f84\uff1b\u4f46\u662f\u91cd\u5b9a\u5411\u662f\u6d4f\u89c8\u5668\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u9700\u8981\u52a0\u4e0awebapp\u6839\u8def\u5f84\u3002 d.\u00a0\u91cd\u5b9a\u5411\u53ef\u4ee5\u5b8c\u6210\u8de8app\u7684\u8d44\u6e90\u8df3\u8f6c\uff0c\u5373\u53ef\u4ee5\u8df3\u8f6c\u5230\u4efb\u610f\u5730\u5740\u3002 f.\u00a0 \u8f6c\u53d1\u5e94\u4e3a\u6d4f\u89c8\u5668\u5730\u5740\u680f\u5730\u5740\u4e0d\u53d8\uff0c\u6240\u4ee5\u4e0d\u80fd\u89e3\u51b3\u5237\u65b0\u5730\u5740\u680f\u91cd\u590d\u63d0\u4ea4\u8868\u5355\u6570\u636e\u7684\u95ee\u9898\uff1b\u4f46\u662f\u91cd\u5b9a\u5411\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u5730\u5740\u680f\u5730\u5740\u53d8\u4e86 h. \u91cd\u5b9a\u5411\u65e0\u6cd5\u8bbf\u95ee\u5230/WEB-INF\uff0c\u4f46\u662f\u8f6c\u53d1\u53ef\u4ee5\u8bbf\u95ee\u5230\u3002\u56e0\u4e3a/WEB-INF\u4e0b\u7684\u6587\u4ef6\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u4f46\u662f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u7aef\u88ab\u8bbf\u95ee\u3002</p> <p>2\u3001\u8bbe\u7f6e\u54cd\u5e94\u4f53\u6570\u636e\u7684\u7f16\u7801\u683c\u5f0f \u8fd9\u4e2a\u9700\u8981\u5728\u83b7\u53d6\u54cd\u5e94\u7684\u8f93\u51fa\u6d41\u524d\u8bbe\u7f6e Text Only<pre><code>httpServletResponse.setContentType(\"text/html;charset=utf-8\");\n</code></pre></p> <p>3\u3001\u83b7\u53d6\u54cd\u5e94\u7684\u8f93\u51fa\u6d41 Text Only<pre><code>PrintWriter out = httpServletResponse.getWriter();\nout.println(\"200\uff0c\u767b\u5f55\u6210\u529f\uff01\");\n</code></pre></p> <p>4\u3001\u5411\u54cd\u5e94\u4f53\u4e2d\u8bbe\u7f6eCookie Text Only<pre><code>public class CreateAndSendCookieToBrowserServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void doGet(HttpServletRequest request, HttpServletResponse response) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Cookie cookie1 = new Cookie(\"username\", \"zhangsan\");\n `response.addCookie(cookie1);`\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/7-Cookie/","title":"7-Cookie","text":"<p> \u7ea6 480 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>Cookie\u7528\u4e8e\u5728\u6d4f\u89c8\u5668\u7aef\u4fdd\u5b58\u4f1a\u8bdd\u72b6\u6001\uff0c\u6d4f\u89c8\u5668\u53ef\u4ee5\u5c06Cookie\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u5728\u5916\u5b58\u4e2d\uff0c\u5982\u679c\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u5219\u5173\u95ed\u6d4f\u89c8\u5668Cookie\u4e5f\u4f1a\u88ab\u5220\u9664\uff0c\u5982\u679c\u4fdd\u5b58\u5728\u5916\u5b58\u4e2d\uff0c\u6d4f\u89c8\u5668\u5173\u95edCookie\u4f9d\u7136\u5b58\u5728\uff0c\u9664\u975eCookie\u5931\u6548\u3002Cookie\u8fd9\u79cd\u673a\u5236\u662fHTTP\u534f\u8bae\u89c4\u5b9a\u7684\u3002</p> <p><code>**1\u3001\u5728\u54cd\u5e94\u4f53\u4e2d\u8bbe\u7f6eCookie**</code> \u5728\u54cd\u5e94\u4f53\u4e2d\u8bbe\u7f6eCookie\uff0c\u4ece\u800c\u8ba9\u6d4f\u89c8\u5668\u4fdd\u5b58Cookie\u3002\u6d4f\u89c8\u5668\u4fdd\u5b58Cookie\u65f6\u4f1a\u5c06\u5176\u4e0e\u4e00\u4e2a\u8bf7\u6c42\u8def\u5f84\u7ed1\u5b9a\uff0c \u4e0b\u6b21\u5411\u670d\u52a1\u5668\u53d1\u9001\u8be5\u8def\u5f84\u7684\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u6d4f\u89c8\u5668\u4f1a\u5728\u8bf7\u6c42\u4f53\u4e2d\u5e26\u4e0a\u8be5Cookie\u3002 \u5728Servlet\u89c4\u8303\u4e2d\u4e5f\u5b9a\u4e49\u4e86\u5bf9\u5e94\u7684\u7c7b\uff0c\u5373Cookie\uff08Cookie\u672c\u8eab\u5c31\u662f\u4fdd\u5b58\u5728\u6d4f\u89c8\u5668\u7aef\uff0c\u6240\u4ee5\u6d4f\u89c8\u5668\u80af\u5b9a\u63d0\u4f9b\u4e86\u53ef\u4ee5\u7528JavaScript\u64cd\u4f5cCookie\u7684\u63a5\u53e3\uff09\u3002 \u5728\u521b\u5efa\u670d\u52a1\u5668\u7aef\u7684Cookie\u5e76\u5c06\u5176\u8bbe\u7f6e\u5230HttpServletResponse\u4e2d\uff0c\u6d4f\u89c8\u5668\u63a5\u53d7\u5230\u54cd\u5e94\u4e4b\u540e\u4f1a\u8bbe\u7f6eCookie\u3002 \u9ed8\u8ba4\u7ed1\u5b9a\u7684\u8bf7\u6c42\u8def\u5f84\u662f\u521b\u5efaCookie\u65f6\u7684\u8bf7\u6c42\u7684\u4e0a\u4e00\u7ea7\u8def\u5f84\uff0c\u6bd4\u5982\uff1a CreateAndSendCookieToBrowserServlet\u7684\u8bf7\u6c42\u8def\u5f84\u662f\uff1a localhost:8080/servlet_test_Web_exploded/createCookie\uff0c\u90a3\u4e48cookie\u7ed1\u5b9a\u7684\u8def\u5f84\u662f /servlet_test_Web_exploded \u5f53\u7136\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u7684Cookie\u7684\u8bf7\u6c42\u8def\u5f84\uff1a Text Only<pre><code>public class CreateAndSendCookieToBrowserServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void doGet(HttpServletRequest request, HttpServletResponse response) {\n `Cookie cookie1 = new Cookie(\"username\", \"zhangsan\");`\n `Cookie cookie2 = new Cookie(\"password\", \"123\");`\n `cookie1.setPath(request.getContextPath() + \"/abc\");`\n `cookie2.setPath(request.getContextPath() + \"/def\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`response.addCookie(cookie1);`\n `response.addCookie(cookie2);`\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u54cd\u5e94\u4f53\uff1a  \u8bf7\u6c42\u4f53\uff1a </p> <p><code>**2\u3001\u8bbe\u7f6eCookie\u7684\u6709\u6548\u65f6\u957f**</code> MaxAge&gt;0\u4f1a\u5c06Cookie\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\uff0c\u5173\u95ed\u6d4f\u89c8\u5668\u4e5f\u4e0d\u4f1a\u5220\u9664\uff0c\u76f4\u5230\u5230\u8fbe\u6709\u6548\u65f6\u957f\u624d\u4f1a\u88ab\u5220\u9664\u3002 Text Only<pre><code>public class CreateAndSendCookieToBrowserServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void doGet(HttpServletRequest request, HttpServletResponse response) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Cookie cookie1 = new Cookie(\"username\", \"zhangsan\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Cookie cookie2 = new Cookie(\"password\", \"123\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cookie1.setPath(request.getContextPath() + \"/abc\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cookie2.setPath(request.getContextPath() + \"/def\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`cookie1.setMaxAge(60 * 60); //\u8bbe\u7f6eCookie\u6709\u6548\u65f6\u957f\u4e3a1\u4e2a\u5c0f\u65f6`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.addCookie(cookie1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.addCookie(cookie2);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> </p> <p>3\u3001\u4ece\u8bf7\u6c42\u4f53\u4e2d\u83b7\u53d6Cookie Text Only<pre><code>public class GetCookieServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `Cookie[] cookies = request.getCookies();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter writer = response.getWriter();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Cookie cookie : cookies) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(`cookie.getName()`);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.println(`cookie.getValue()`);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/8-Session/","title":"8-Session","text":"<p> \u7ea6 804 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>Cookie\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0cSession\u4e0e\u4e4b\u5bf9\u5e94\uff0c\u662f\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u7684\u4f1a\u8bdd\u4fe1\u606f\uff0c\u7531Web\u5bb9\u5668\u5b9e\u73b0\u8fd9\u4e2a\u673a\u5236\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u7ba1\u662f\u4e0d\u662fServlet\u5bb9\u5668\uff0c\u90fd\u5e94\u8be5\u5b9e\u73b0Session\u673a\u5236\uff0c\u5728Servlet\u4e2d\uff0cSession\u5bf9\u5e94\u7684\u63a5\u53e3\u662fjavax.servlet.http.HttpSession\uff08Java\u8bed\u8a00\u7684Web\u670d\u52a1\u5668\u90fd\u662f\u5b9e\u73b0Servlet\u89c4\u8303\u7684\u5bb9\u5668\uff0c\u5176\u4ed6\u8bed\u8a00\u5982Python\u7684Django\u5c31\u4e0d\u662f\u5b9e\u73b0Servlet\u89c4\u8303\uff0c\u4f46\u662f\u4e5f\u9700\u8981\u662f\u5b9e\u73b0Session\u673a\u5236\uff0cWeb\u5bb9\u5668\u6700\u57fa\u672c\u7684\u529f\u80fd \uff09\u3002</p> <p>1\u3001\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6Session\u5bf9\u8c61 \u540c\u4e00\u4e2a\u4f1a\u8bdd\u6bcf\u6b21\u8bf7\u6c42\u90fd\u662f\u7528\u4e00\u4e2asession\u5bf9\u8c61 Text Only<pre><code>public class SessionServlet extends HttpServlet {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`HttpSession session = request.getSession(); //\u6839\u636ejsessionid\u83b7\u53d6session\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u83b7\u53d6\u5230\u5219\u65b0\u5efasession\u5bf9\u8c61`\n `HttpSession session2 = request.getSession(false); //\u6839\u636ejsessionid\u83b7\u53d6session\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u83b7\u53d6\u5230\u5219\u8fd4\u56denull`\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0session.getId(); //\u62ff\u5230JSESSIONID\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0session.isNew();\u00a0 //\u662f\u5426\u9996\u6b21\u521b\u5efasession\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0session.setAttribute(\"username\", \"zhansgan\"); //\u5728session\u4e2d\u8bbe\u7f6e\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0session.getAttribute(\"username\"); //\u4eceSession\u4e2d\u83b7\u53d6\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0session.removeAttribute(\"username\");\u00a0\u00a0//\u5220\u9664session\u4e2d\u7684\u503c\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0session.getMaxInactiveInterval();\u00a0 //\u83b7\u53d6session\u7684\u8d85\u65f6\u65f6\u95f4\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0session.setMaxInactiveInterval(3);\u00a0 //\u8bbe\u7f6esession\u7684\u8d85\u65f6\u65f6\u95f4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0session.invalidate(); //\u4f7fsession\u5931\u6548\n\n  session.getServletContext(); //\u83b7\u53d6ServletContext\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2\u3001\u5b9e\u73b0\u539f\u7406 \u5b9e\u73b0\u539f\u7406\uff1aHttpSession session = request.getSession();\u6267\u884c\u65f6\uff0c\u5982\u679c\u8bf7\u6c42\u4f53\u4e2d\u6ca1\u6709\u5e26name\u4e3ajsessionid\u7684cookie\uff0c\u90a3\u4e48\u6b64\u65f6\u4f1a\u5728\u54cd\u5e94\u4f53\u4e2d\u8bbe\u7f6e\u4e00\u4e2ajsessionid\u7684cookie\uff0c\u7136\u540e\u518d\u521b\u5efa\u4e00\u4e2aSession\u5bf9\u8c61\uff0c\u6700\u540e\u5c06jsessionid\u4e0esession\u5bf9\u8c61\u653e\u5728Map\u4e2d\uff0c\u90a3\u4e48\u4e0b\u6b21\u540c\u4e00\u4e2a\u4f1a\u8bdd\u7684\u8bf7\u6c42\u90fd\u4f1a\u5e26\u4e0a\u76f8\u540c\u7684jsessionid\uff0c\u4ece\u800c\u6bcf\u6b21\u90fd\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u7aef\u62ff\u5230\u76f8\u540c\u7684session\u3002  jsessionid\u7ed1\u5b9a\u7684\u8bf7\u6c42\u8def\u5f84\u662f\u6839\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u9879\u76ee\u540d\uff0c\u6240\u4ee5\u4ee5\u540e\u540c\u4e00\u4e2a\u4f1a\u8bdd\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u5e26\u4e0a\u76f8\u540c\u7684jsessionid\u3002 \uff08\u4ece\u5b9e\u73b0\u539f\u7406\u4e0a\u770b\uff0cSession\u7684\u5b9e\u73b0\u5b8c\u5168\u4f9d\u8d56\u4e8eCookie\uff0c\u5e76\u4e0d\u4f9d\u8d56\u4e8ejsessionid\u8fd9\u4e2a\u540d\u79f0\uff0c\u4e5f\u5c31\u662fSession\u6240\u4f9d\u8d56\u7684Cookie\u7684\u540d\u79f0\u5e76\u4e0d\u662f\u975e\u5f97\u53d6jsessionid\u8fd9\u4e2a\u540d\u5b57\uff0c\u5b8c\u5168\u53ef\u4ee5\u7528\u5176\u4ed6\u540d\u5b57\uff0c\u53d6\u51b3\u4e8eWeb\u5bb9\u5668\u7684\u5b9e\u73b0\uff0cServlet\u5bb9\u5668\u5e94\u8be5\u90fd\u662f\u7528\u7684jsessionid\u8fd9\u4e2a\u540d\u5b57\u3002\uff09</p> <p>Session\u7684\u5b9e\u73b0\u5b8c\u5168\u4f9d\u8d56\u4e8eCookie\uff0c\u6240\u4ee5\u5982\u679c\u6d4f\u89c8\u5668\u7981\u7528Cookie\uff0cSession\u673a\u5236\u4e5f\u5c31\u5931\u6548\u4e86\uff0c\u5982\u679c\u4ecd\u7136\u60f3\u4f7f\u7528Session\uff0c\u53ef\u4ee5\u5728URL\u8bf7\u6c42\u4e0a\u62fc\u63a5jsessionid\uff0c\u5982\uff1a Text Only<pre><code>http://localhost:8080/servlet_test_Web_exploded/abc;JSESSIONID=A19740252EC00227055519B0954278C1\n</code></pre> \u670d\u52a1\u5668\u4ecd\u7136\u53ef\u4ee5\u4ece\u8bf7\u6c42\u8def\u5f84\u4e2d\u62ff\u5230jsessionid\uff0c\u4ece\u800c\u62ff\u5230\u5bf9\u5e94\u7684session\u5bf9\u8c61\uff0c\u6240\u4ee5\u5e76\u4e0d\u4e00\u5b9a\u662f\u6d4f\u89c8\u5668\u5173\u95ed\u4e86\uff0c\u4f1a\u8bdd\u5c31\u5b8c\u5168\u5b9e\u6548\u4e86\uff0c\u53ea\u6709\u5f53\u670d\u52a1\u5668\u7aef\u7684session\u5bf9\u8c61\u88ab\u5220\u9664\u4e86\u4f1a\u8bdd\u624d\u7b97\u662f\u5b8c\u5168\u5b9e\u6548\u4e86\u3002</p> <p>3\u3001\u8bbe\u7f6esession\u5bf9\u8c61\u7684\u8d85\u65f6\u65f6\u95f4 \u670d\u52a1\u5668\u5b9e\u6548Session\u5bf9\u8c61\u7684\u65f6\u673a\uff1asession\u5bf9\u8c61\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u8bbf\u95ee\u5219\u4f1a\u88ab\u5220\u9664\uff0c\u53ef\u4ee5\u5728web.xml\u4e2d\u8bbe\u7f6e\u3002 Text Only<pre><code>&lt;session-config&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\u9ed8\u8ba4\u662f30\u5206\u949f\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u4e3a120\u5206\u949f--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;session-timeout&gt;120&lt;/session-timeout&gt;\n&lt;/session-config&gt;\n</code></pre></p> <p>4\u3001Session\u949d\u5316\u4e0e\u6d3b\u5316 \u4e3a\u4e86\u4fdd\u8bc1\u5ba2\u6237\u7aef\u4e0d\u5173\u95ed\uff0c\u670d\u52a1\u5668\u91cd\u542f\u540e\uff0c\u4e24\u6b21\u83b7\u53d6\u7684session\u662f\u540c\u4e00\u4e2a\uff0ctomcat\u4f1a\u5bf9Session\u8fdb\u884c\u949d\u5316\u548c\u6d3b\u5316\uff1a</p> <ul> <li>session\u7684\u949d\u5316\uff1a\u5728\u670d\u52a1\u5668\u6b63\u5e38\u5173\u95ed\u4e4b\u524d\uff0c\u5c06session\u5bf9\u8c61\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e0a\uff0c\u5728tomcat\u7684\u76ee\u5f55\u4e0b\u7684work\u76ee\u5f55\u4e2d\uff0c\u4f1a\u751f\u6210SESSIONS.ser\u6587\u4ef6\u3002</li> <li>session\u7684\u6d3b\u5316\uff1a\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u4f1a\u8bfb\u53d6work\u76ee\u5f55\u4e2d\u7684SESSIONS.ser\u6587\u4ef6\uff0c\u5c06\u5176\u53cd\u5e8f\u5217\u5316\u5230\u5185\u5b58\u4e2d\u7684session\u5bf9\u8c61\uff0c\u5e76\u5220\u9664SESSIONS.ser\u6587\u4ef6\u3002</li> </ul> <p></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Servlet/9-%E6%80%BB%E7%BB%93/","title":"9-\u603b\u7ed3","text":"<p> \u7ea6 299 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u4e00\u3001Servlet\u4e2d\u7684\u91cd\u70b9\u63a5\u53e3\u548c\u7c7b\u7684\u5173\u7cfb </p> <p>\u4e8c\u3001\u6570\u636e\u57df\u7684\u53ef\u89c1\u8303\u56f4 \u4e09\u79cd\u53ef\u89c1\u8303\u56f4\uff1a\u8bf7\u6c42\u8303\u56f4\uff08HttpRequest\uff09\u3001\u4f1a\u8bdd\u8303\u56f4\uff08Session\uff09\u3001\u5e94\u7528\u8303\u56f4\uff08ServletContext\uff09\uff0c\u5206\u522b\u5bf9\u5e94\uff1aHttpRequest\u3001Session\u548cServletContext\uff0c\u90fd\u53ef\u4ee5getAttribute\u3001setAttribute\u548cremoveAttribute\uff0c\u5176\u53ef\u89c1\u8303\u56f4\u7684\u6392\u5e8f\u662f\uff1aServletContext &gt;\u00a0Session &gt;\u00a0HttpRequest\u3002</p> <p>\u4e09\u3001\u8bf7\u6c42\u8def\u5f84\u603b\u7ed3\uff1a 1\u3001\u6d4f\u89c8\u5668\u53d1\u9001\u7684\u8bf7\u6c42\u9700\u8981\u5e26\u4e0a \u201c/\u9879\u76ee\u540d\u201d\uff0c\u6bd4\u5982 1.1 JSP\u4e2d\u7684\u8bf7\u6c42\u8def\u5f84\uff1a Text Only<pre><code>&lt;a href=\"/\u9879\u76ee\u540d/\u8d44\u6e90\u8def\u5f84\"&gt;&lt;/a&gt;\n&lt;form action=\"/\u9879\u76ee\u540d/\u8d44\u6e90\u8def\u5f84\"&gt;&lt;/form&gt;\n</code></pre> 1.2\u00a0\u91cd\u5b9a\u5411\uff1a\u00a0\u00a0 \u00a0 Text Only<pre><code>response.sendRedirect(\"/\u9879\u76ee\u540d/\u8d44\u6e90\u8def\u5f84\");\n</code></pre> 1.3\u00a0Cookie\u8bbe\u7f6epath\uff0c\u8fd9\u662fServlet\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\u7684\uff0c\u4e5f\u8981\u52a0\u4e0a\u201c/\u9879\u76ee\u540d\u201d Text Only<pre><code>cookie.setPath(\"/\u9879\u76ee\u540d/\u8d44\u6e90\u8def\u5f84\");\n</code></pre> \u603b\u7ed3\uff1a\u53ea\u8981\u662f\u6d4f\u89c8\u5668\u611f\u77e5\u7684\u90fd\u8981\u52a0\u4e0a\u201c/\u9879\u76ee\u540d\u201d\uff08\u6d4f\u89c8\u5668\u53d1\u9001\u7684 \u6216\u8005\u53d1\u9001\u7ed9\u00a0\u6d4f\u89c8\u5668\u7684\uff09</p> <p>2\u3001Servlet\u4e2d\u7684\u8def\u5f84\u4e0d\u9700\u8981\u5e26\u4e0a\u201c/\u9879\u76ee\u540d\u201d\uff0c\u6bd4\u5982\uff1a 2.1\u00a0\u5728web.xml\u4e2d\u914d\u7f6e\u8bf7\u6c42\u8def\u5f84\u65f6\u4e0d\u8981\u5e26\u4e0a\u201c/\u9879\u76ee\u540d\u201d\uff0c\u4f8b\u5982 Text Only<pre><code>\u00a0\u00a0\u00a0\u00a0&lt;servlet-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;-name&gt;HelloServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/hello&lt;/url-pattern&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/servlet-mapping&gt;\n</code></pre> 2.3\u00a0\u8f6c\u53d1\uff1a Text Only<pre><code>request.getRequestDispatcher(\"/\u8d44\u6e90\u8def\u5f84\").forward(request, response);\n</code></pre> \u603b\u7ed3\uff1a\u53ea\u8981\u662fservlet\u611f\u77e5\u7684\u4e0d\u8981\u5e26\u4e0a\u201c/\u9879\u76ee\u540d\u201d <p>\u4ec0\u4e48\u662f\u201c/\u9879\u76ee\u540d\u201d\uff1f WEB-INF\u7684\u4e0a\u4e00\u7ea7\u5c31\u662f\u201c/\u9879\u76ee\u540d\u201d  </p> <p>3\u3001\u4e0b\u7684\u7684\u7f16\u5199\u65b9\u5f0f 3.1\u00a0\u53ef\u4ee5\u5199\u591a\u4e2a Text Only<pre><code>&lt;servlet-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-name&gt;ManagerOrderServlet&lt;/servlet-name&gt;\n\u00a0\u00a0\u00a0\u00a0`&lt;url-pattern&gt;/manager/orderServlet&lt;/url-pattern&gt;`\n `&lt;url-pattern&gt;/manager/orderController&lt;/url-pattern&gt;`\n&lt;/servlet-mapping&gt;\n</code></pre> <p>3.2\u00a0\u6a21\u7cca\u5339\u914d Text Only<pre><code>&lt;url-pattern&gt;/manager/orderController&lt;/url-pattern&gt;\u00a0 //\u7cbe\u51c6\u5339\u914d\n&lt;url-pattern&gt;/manager/*&lt;/url-pattern&gt;\n&lt;url-pattern&gt;*Controller&lt;/url-pattern&gt;\u00a0 //\u540e\u7f00\u5339\u914d\n&lt;url-pattern&gt;/*&lt;/url-pattern&gt;\u00a0 //\u5168\u90e8\u5339\u914d\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/1-IOC%E7%9A%84%E6%9C%AC%E8%B4%A8/","title":"1-IOC\u7684\u672c\u8d28","text":"<p> \u7ea6 555 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>IOC\uff08Inversion of Control\uff09\u662f\u4e00\u79cd\u7f16\u7a0b\u601d\u60f3\uff0c\u5373\u628a\u5bf9\u8c61\u7684\u521b\u5efa\u4e0e\u5c5e\u6027\u7684\u8d4b\u503c\u4ea4\u7ed9\u5bb9\u5668\u8fdb\u884c\u7edf\u4e00\u5904\u7406\u3002</p> <p>\u624b\u5199\u7b80\u6613\u7684IOC\u5bb9\u5668\uff1a @Bean\u6ce8\u89e3\uff1a\u6807\u6ce8\u6b64\u6ce8\u89e3\u7684\u7c7b\u4f1a\u88ab\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\u653e\u5230IOC\u5bb9\u5668\u4e2d Text Only<pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface Bean {\n}\n</code></pre></p> <p>@Di\u6ce8\u89e3\uff1a\u6309\u7167\u7c7b\u578b\u4ece\u5bb9\u5668\u4e2d\u53d6\u5bf9\u8c61\u5b9e\u4f8b\u8d4b\u503c\u7ed9\u5b9e\u4f8b\u53d8\u91cf Text Only<pre><code>@Target({ElementType.FIELD})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface Di {\n}\n</code></pre></p> <p>@ComponentScan\u6ce8\u89e3\uff1a\u6307\u660e\u9700\u8981\u626b\u63cf\u54ea\u4e9b\u5305 Text Only<pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface ComponentScan {\n\u00a0 \u00a0String[] value();\n}\n</code></pre></p> <p>ApplicationContext\u63a5\u53e3\uff1a Text Only<pre><code>public interface ApplicationContext {\n\u00a0 \u00a0Object getBean(Class clazz);\n}\n</code></pre></p> <p>AnnotationApplicationContext\uff1a Text Only<pre><code>public class AnnotationApplicationContext implements ApplicationContext {\n\n\u00a0 \u00a0//\u5b58\u50a8bean\u7684\u5bb9\u5668\n\u00a0 \u00a0private HashMap&lt;Class, Object&gt; iocContainer = new HashMap&lt;&gt;();\n\u00a0 \u00a0private int rootPathLength;\n\n\u00a0 \u00a0public AnnotationApplicationContext(Class configClass) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0ComponentScan componentScan = (ComponentScan) configClass.getAnnotation(ComponentScan.class);\n\u00a0 \u00a0 \u00a0 \u00a0for (String packagePath : componentScan.value()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0packagePath = packagePath.replace('.', '\\\\');\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String dir = Thread.currentThread().getContextClassLoader().getResource(packagePath).getFile();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0rootPathLength = dir.length() - packagePath.length();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0loadBean(new File(dir));\n\u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0di();\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u626b\u63cf\u5305\u4e2d\u6807\u6ce8\u6709@Bean\u6ce8\u89e3\u7684\u7c7b\uff0c\u521b\u5efa\u5bf9\u8c61\u653e\u5230\u5bb9\u5668\u4e2d\n\u00a0 \u00a0 */\n\u00a0 \u00a0private void loadBean(File dir) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0if (!dir.isDirectory()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return;\n\u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0for (File file : dir.listFiles()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (file.isDirectory()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0loadBean(file);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String fileName = file.getPath().substring(rootPathLength - 1);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (fileName.contains(\".class\")) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String clazz = fileName.replace(\"\\\\\", \".\").replace(\".class\", \"\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Class aClass = Class.forName(clazz);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (!aClass.isInterface()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Annotation beanAnno = aClass.getAnnotation(Bean.class);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (beanAnno != null) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Object bean = aClass.getConstructor().newInstance();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (aClass.getInterfaces().length &gt; 0) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0iocContainer.put(aClass.getInterfaces()[0], bean);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0} else {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0iocContainer.put(aClass, bean);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u7ed9\u6807\u6ce8\u6709@Di\u6ce8\u89e3\u7684\u793a\u4f8b\u53d8\u91cf\u8d4b\u503c\n\u00a0 \u00a0 */\n\u00a0 \u00a0private void di() throws IllegalAccessException {\n\u00a0 \u00a0 \u00a0 \u00a0for (Map.Entry&lt;Class, Object&gt; entry : iocContainer.entrySet()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Class aClass = entry.getKey();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Field[] fields = aClass.getDeclaredFields();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0for (Field field : fields) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Di diAnno = field.getAnnotation(Di.class);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (diAnno != null) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0field.setAccessible(true);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0field.set(entry.getValue(), iocContainer.get(field.getType()));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0}\n\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public Object getBean(Class clazz) {\n\u00a0 \u00a0 \u00a0 \u00a0return iocContainer.get(clazz);\n\u00a0 \u00a0}\n}\n</code></pre></p> <p>\u6d4b\u8bd5\uff1a \u914d\u7f6e\u7c7b\uff1a Text Only<pre><code>@ComponentScan(\"pojo\")\npublic class IocConfig {\n}\n</code></pre></p> <p>\u542f\u52a8\u7c7b\uff1a Text Only<pre><code>public class IocTest {\n\u00a0 \u00a0public static void main(String[] args) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0AnnotationApplicationContext context = new AnnotationApplicationContext(IocConfig.class);\n\u00a0 \u00a0 \u00a0 \u00a0Object bean = context.getBean(Teacher.class);\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(bean);\n\u00a0 \u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/1-IOC%E7%9A%84%E6%9C%AC%E8%B4%A8/#iocspring","title":"IoC\u5bb9\u5668\u5728Spring\u7684\u5b9e\u73b0","text":"<p>BeanFactory\uff1a \u662f IoC \u5bb9\u5668\u7684\u57fa\u672c\u5b9e\u73b0\uff0c\u662f Spring \u5185\u90e8\u4f7f\u7528\u7684\u63a5\u53e3\u3002\u9762\u5411 Spring \u672c\u8eab\uff0c\u4e0d\u63d0\u4f9b\u7ed9\u5f00\u53d1\u4eba\u5458\u4f7f\u7528\u3002 ApplicationContext\uff1a BeanFactory \u7684\u5b50\u63a5\u53e3\uff0c\u63d0\u4f9b\u4e86\u66f4\u591a\u9ad8\u7ea7\u7279\u6027\u3002\u9762\u5411 Spring \u7684\u4f7f\u7528\u8005\uff0c\u51e0\u4e4e\u6240\u6709\u573a\u5408\u90fd\u4f7f\u7528 ApplicationContext \u800c\u4e0d\u662f\u5e95\u5c42\u7684 BeanFactory\u3002 ApplicationContext\u7684\u4e3b\u8981\u5b9e\u73b0\u7c7b\uff1a </p> \u7c7b\u578b\u540d \u7b80\u4ecb ConfigurableApplicationContext ApplicationContext \u7684\u5b50\u63a5\u53e3\uff0c\u5305\u542b\u4e00\u4e9b\u6269\u5c55\u65b9\u6cd5 refresh() \u548c close() \uff0c\u8ba9 ApplicationContext \u5177\u6709\u542f\u52a8\u3001\u5173\u95ed\u548c\u5237\u65b0\u4e0a\u4e0b\u6587\u7684\u80fd\u529b\u3002 ClassPathXmlApplicationContext \u901a\u8fc7\u8bfb\u53d6\u7c7b\u8def\u5f84\u4e0b\u7684 XML \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u521b\u5efa IOC \u5bb9\u5668\u5bf9\u8c61 FileSystemXmlApplicationContext \u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\u8bfb\u53d6 XML \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u521b\u5efa IOC \u5bb9\u5668\u5bf9\u8c61 AnnotationConfigApplicationContext \u901a\u8fc7\u6ce8\u89e3\u8bfb\u53d6\u914d\u7f6e\u521b\u5efaIOC\u5bb9\u5668"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/2-XML%E9%85%8D%E7%BD%AEBean/","title":"2-XML\u914d\u7f6eBean","text":"<p> \u7ea6 1667 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 33 \u5206\u949f</p> <p>\u4e00\u3001\u521b\u5efaBean 1\u3001\u521b\u5efaBean id\u4e0d\u80fd\u91cd\u590d Text Only<pre><code>&lt;bean id=\"user01\" class=\"pojo.User\"&gt;&lt;/bean&gt;\n</code></pre> \u8fd8\u53ef\u4ee5\u521b\u5efaArrayList\u5bf9\u8c61\uff0c\u4f46\u662f\u662f\u7a7a\u7684ArrayList\u5bf9\u8c61\uff0c\u540e\u9762\u53ef\u4ee5\u83b7\u53d6\u8fd9\u4e2abean\uff0c\u7136\u540e\u5f80\u91ccadd\u5143\u7d20 Text Only<pre><code>&lt;bean id=\"aList\" class=\"java.util.ArrayList\"&gt;&lt;/bean&gt;\n</code></pre></p> <p>2\u3001\u4f9d\u8d56\u6ce8\u5165\u4e4bsetter\u6ce8\u5165 Text Only<pre><code>&lt;bean id=\"user01\" class=\"pojo.User\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- property\u6807\u7b7e\uff1a\u901a\u8fc7\u7ec4\u4ef6\u7c7b\u7684setXxx()\u65b9\u6cd5\u7ed9\u7ec4\u4ef6\u5bf9\u8c61\u8bbe\u7f6e\u5c5e\u6027 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- name\u5c5e\u6027\uff1a\u6307\u5b9a\u5c5e\u6027\u540d\uff08\u8fd9\u4e2a\u5c5e\u6027\u540d\u662fgetXxx()\u3001setXxx()\u65b9\u6cd5\u5b9a\u4e49\u7684\uff0c\u548c\u6210\u5458\u53d8\u91cf\u65e0\u5173\uff09 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- value\u5c5e\u6027\uff1a\u6307\u5b9a\u5c5e\u6027\u503c --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"id\" value=\"1001\"&gt;&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"name\" value=\"\u5f20\u4e09\"&gt;&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"age\" value=\"23\"&gt;&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"sex\" value=\"\u7537\"&gt;&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>3\u3001\u4f9d\u8d56\u6ce8\u5165\u4e4b\u6784\u9020\u5668\u6ce8\u5165 Text Only<pre><code>&lt;bean id=\"user01\" class=\"pojo.User\"&gt;\n\u00a0 \u00a0 &lt;constructor-arg value=\"1002\"&gt;&lt;/constructor-arg&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;constructor-arg value=\"\u674e\u56db\"&gt;&lt;/constructor-arg&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;constructor-arg value=\"33\"&gt;&lt;/constructor-arg&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;constructor-arg value=\"\u5973\"&gt;&lt;/constructor-arg&gt;\n&lt;/bean&gt;\n</code></pre> \u8fd8\u53ef\u4ee5\u521b\u5efaInteger\u5bf9\u8c61\uff1a Text Only<pre><code>&lt;bean id=\"aInt\" class=\"java.lang.Integer\"&gt;\n\u00a0\u00a0&lt;constructor-arg value=\"111111\"&gt;&lt;/constructor-arg&gt;\n&lt;/bean&gt;\n</code></pre> \u6ce8\u610f\uff1a constructor-arg\u6807\u7b7e\u8fd8\u6709\u4e24\u4e2a\u5c5e\u6027\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63cf\u8ff0\u6784\u9020\u5668\u53c2\u6570\uff1a * index\u5c5e\u6027\uff1a\u6307\u5b9a\u53c2\u6570\u6240\u5728\u4f4d\u7f6e\u7684\u7d22\u5f15\uff08\u4ece0\u5f00\u59cb\uff09 * name\u5c5e\u6027\uff1a\u6307\u5b9a\u53c2\u6570\u540d Text Only<pre><code>&lt;bean id=\"stu04\" class=\"pojo.Student\"&gt;\n\u00a0\u00a0&lt;constructor-arg name=\"name\" value=\"mike\"/&gt;\n\u00a0\u00a0&lt;constructor-arg name=\"id\" value=\"03\"/&gt;\n\u00a0\u00a0&lt;constructor-arg name=\"age\" value=\"23\"/&gt;\n&lt;/bean&gt;\n\n&lt;bean id=\"stu05\" class=\"pojo.Student\"&gt;\n\u00a0\u00a0&lt;constructor-arg value=\"bob\" index=\"1\"/&gt;\n\u00a0\u00a0&lt;constructor-arg value=\"04\" index=\"0\"/&gt;\n\u00a0\u00a0&lt;constructor-arg value=\"25\" index=\"2\"/&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4\u3001\u4e3a\u5f15\u7528\u7c7b\u578b\u8d4b\u503c\uff08\u4f9d\u7136\u4f7f\u7528\u7684\u662fproperty\u6807\u7b7e\uff0c\u5c5e\u4e8esetter\u6ce8\u5165\uff0c\u53ea\u4e0d\u8fc7\u4e0e\u524d\u9762\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6216\u5305\u88c5\u7c7b\u578b\u4e0d\u4e00\u6837\uff09 4.1 \u5f15\u7528\u5916\u90e8bean Text Only<pre><code>&lt;bean id=\"person01\" class=\"pojo.Person\"&gt;\n\u00a0\u00a0 \u00a0&lt;!-- ref\u8868\u793a\u5f15\u7528\u5916\u90e8\u7684bean\u5bf9\u8c61 --&gt;\n\u00a0\u00a0 \u00a0&lt;property name=\"cat\" ref=\"cat\"/&gt;\n\u00a0\u00a0 \u00a0&lt;!-- \u7ea7\u8054\u5c5e\u6027\u8d4b\u503c\uff0c\u4fee\u6539\u4e86\u4e0a\u9762\u5f15\u7528\u7684cat\u7684\u5c5e\u6027\u503c--&gt;\n\u00a0\u00a0 \u00a0&lt;property name=\"cat.color\" value=\"red\"/&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4.2\u00a0\u5185\u90e8bean Text Only<pre><code>&lt;bean id=\"person01\" class=\"pojo.Person\"&gt;\n\u00a0\u00a0 \u00a0&lt;!-- \u7ed9\u5f15\u7528\u7c7b\u578b\u8d4b\u503c --&gt;\n\u00a0\u00a0 \u00a0&lt;property name=\"dog\"&gt;\n\u00a0\u00a0\u00a0 \u00a0\u00a0&lt;!-- \u5185\u90e8bean\u7684id\u5c5e\u6027\u65e0\u6548\uff0c\u65e0\u6cd5\u901a\u8fc7id\u83b7\u53d6\u5230\u5185\u90e8bean --&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;bean class=\"pojo.Dog\"&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"name\" value=\"\u65fa\u8d22\"/&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"color\" value=\"yellow\"/&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;/bean&gt;\n\u00a0\u00a0 \u00a0&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4.3 \u4e3a\u6570\u7ec4\u7c7b\u578b\u8d4b\u503c Text Only<pre><code>&lt;bean id=\"person01\" class=\"pojo.Person\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"hobbies\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;array&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;\u62bd\u70df&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;\u559d\u9152&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;\u70eb\u5934&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/array&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4.4 \u4e3a\u96c6\u5408\u7c7b\u578b\u5c5e\u6027\u8d4b\u503c Text Only<pre><code>&lt;bean id=\"person01\" class=\"pojo.Person\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"students\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;list&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;ref bean=\"studentOne\"&gt;&lt;/ref&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;ref bean=\"studentTwo\"&gt;&lt;/ref&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0&lt;bean class=\"pojo.Student\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0&lt;property name=\"id\" value=\"1001\"&gt;&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;property name=\"name\" value=\"\u5f20\u4e09\"&gt;&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0&lt;property name=\"age\" value=\"23\"&gt;&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;property name=\"sex\" value=\"\u7537\"&gt;&lt;/property&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0&lt;/bean&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/list&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4.5\u00a0\u4e3aMap\u96c6\u5408\u7c7b\u578b\u5c5e\u6027\u8d4b\u503c Text Only<pre><code>&lt;bean id=\"person01\" class=\"pojo.Person\"&gt;\n\u00a0\u00a0 \u00a0&lt;property name=\"map\"&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;!-- \u76f8\u5f53\u4e8e map = new LinkedHashMap&lt;&gt;(); --&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;map&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0&lt;entry key=\"key01\" value=\"value01\"/&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0&lt;entry key=\"key02\" value=\"10.3\" value-type=\"java.lang.Double\"/&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0&lt;entry key=\"key03\" value-ref=\"person01\"/&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0&lt;entry key=\"key04\"&gt;\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"pojo.Book\" c:name=\"\u7ea2\u697c\u68a6\" c:author=\"\u66f9\u96ea\u82b9\" c:price=\"100.9\"/&gt;\n\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;/entry&gt;\n\u00a0\u00a0\u00a0 \u00a0\u00a0&lt;/map&gt;\n\u00a0\u00a0 \u00a0&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4.6 \u4e3aProperties\u5c5e\u6027\u8d4b\u503c Text Only<pre><code>&lt;bean id=\"person01\" class=\"pojo.Person\"&gt;\n\u00a0\u00a0 \u00a0&lt;!-- \u7ed9properties\u5c5e\u6027\u8d4b\u503c --&gt;\n\u00a0\u00a0 \u00a0&lt;property name=\"properties\"&gt;\n\u00a0\u00a0\u00a0 \u00a0\u00a0&lt;!-- properties = new Properties(); --&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;props&gt;\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0&lt;prop key=\"username\"&gt;root&lt;/prop&gt;\n\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;prop key=\"password\"&gt;123456&lt;/prop&gt;\n\u00a0\u00a0 \u00a0\u00a0\u00a0&lt;/props&gt;\n\u00a0\u00a0 \u00a0&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>4.7 \u4e3a\u7279\u6b8a\u503c\u8d4b\u503c \u8d4bnull\u503c Text Only<pre><code>&lt;property name=\"name\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;null /&gt;\n&lt;/property&gt;\n</code></pre> xml\u5b9e\u4f53 Text Only<pre><code>&lt;!-- \u5c0f\u4e8e\u53f7\u5728XML\u6587\u6863\u4e2d\u7528\u6765\u5b9a\u4e49\u6807\u7b7e\u7684\u5f00\u59cb\uff0c\u4e0d\u80fd\u968f\u4fbf\u4f7f\u7528 --&gt;\n&lt;!-- \u89e3\u51b3\u65b9\u6848\u4e00\uff1a\u4f7f\u7528XML\u5b9e\u4f53\u6765\u4ee3\u66ff --&gt;\n&lt;property name=\"expression\" value=\"a &amp;lt; b\"/&gt;\n</code></pre> CDATA\u8282 Text Only<pre><code>&lt;property name=\"expression\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u89e3\u51b3\u65b9\u6848\u4e8c\uff1a\u4f7f\u7528CDATA\u8282 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- CDATA\u4e2d\u7684C\u4ee3\u8868Character\uff0c\u662f\u6587\u672c\u3001\u5b57\u7b26\u7684\u542b\u4e49\uff0cCDATA\u5c31\u8868\u793a\u7eaf\u6587\u672c\u6570\u636e --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- XML\u89e3\u6790\u5668\u770b\u5230CDATA\u8282\u5c31\u77e5\u9053\u8fd9\u91cc\u662f\u7eaf\u6587\u672c\uff0c\u5c31\u4e0d\u4f1a\u5f53\u4f5cXML\u6807\u7b7e\u6216\u5c5e\u6027\u6765\u89e3\u6790 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6240\u4ee5CDATA\u8282\u4e2d\u5199\u4ec0\u4e48\u7b26\u53f7\u90fd\u968f\u610f --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;&lt;![CDATA[a &lt; b]]&gt;&lt;/value&gt;\n&lt;/property&gt;\n</code></pre></p> <p>5\u3001\u547d\u540d\u7a7a\u95f4</p> <ul> <li>p\u540d\u79f0\u7a7a\u95f4(property)\uff1a\u901a\u8fc7setter\u65b9\u6cd5\u8d4b\u503c\u7684\u5feb\u6377\u65b9\u5f0f</li> <li>c\u540d\u79f0\u7a7a\u95f4(constructor)\uff1a\u901a\u8fc7\u6784\u9020\u5668\u8d4b\u503c\u7684\u5feb\u6377\u65b9\u5f0f</li> <li>util\u540d\u79f0\u7a7a\u95f4\uff1a\u521b\u5efa\u96c6\u5408\u7c7b\u578b\u7684bean</li> </ul> Text Only<pre><code>&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:p=\"http://www.springframework.org/schema/p\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:c=\"http://www.springframework.org/schema/c\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:util=\"http://www.springframework.org/schema/util\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0https://www.springframework.org/schema/beans/spring-beans.xsd\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0http://www.springframework.org/schema/util\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0https://www.springframework.org/schema/util/spring-util.xsd\"&gt;\n\n&lt;!-- \u5bfc\u5165p\u540d\u79f0\u7a7a\u95f4(property)\uff0c\u901a\u8fc7setter\u65b9\u6cd5\u8d4b\u503c\u7684\u5feb\u6377\u65b9\u5f0f --&gt;\n&lt;bean id=\"stu02\" class=\"pojo.Student\" p:id=\"05\" p:name=\"jerry\" p:age=\"20\"/&gt;\n\n&lt;!-- \u5bfc\u5165c\u540d\u79f0\u7a7a\u95f4(constructor)\uff0c\u901a\u8fc7\u6784\u9020\u5668\u8d4b\u503c\u7684\u5feb\u6377\u65b9\u5f0f --&gt;\n&lt;bean id=\"stu06\" class=\"pojo.Student\" c:name=\"tom\" c:id=\"6\" c:age=\"25\"/&gt;\n\n&lt;!-- util\u540d\u79f0\u7a7a\u95f4\u521b\u5efa\u96c6\u5408\u7c7b\u578b\u7684bean --&gt;\n&lt;util:list id=\"stuList\" value-type=\"pojo.Student\" list-class=\"java.util.ArrayList\"&gt;\n\u00a0\u00a0&lt;ref bean=\"stu01\"/&gt;\n\u00a0\u00a0&lt;ref bean=\"stu02\"/&gt;\n\u00a0\u00a0&lt;ref bean=\"stu03\"/&gt;\n\u00a0\u00a0&lt;ref bean=\"stu04\"/&gt;\n\u00a0\u00a0&lt;ref bean=\"stu05\"/&gt;\n\u00a0\u00a0&lt;ref bean=\"stu06\"/&gt;\n&lt;/util:list&gt;\n\n&lt;util:map id=\"map\"&gt;\n\u00a0\u00a0&lt;entry key=\"key01\" value=\"value01\"/&gt;\n&lt;/util:map&gt;\n\n&lt;util:properties id=\"locale\"&gt;\n\u00a0\u00a0&lt;prop key=\"locale\"&gt;zh_CN&lt;/prop&gt;\n&lt;/util:properties&gt;\n\n&lt;util:set id=\"set\"&gt;\n\u00a0\u00a0&lt;value type=\"java.lang.Integer\"&gt;100&lt;/value&gt;\n&lt;/util:set&gt;\n\n&lt;/beans&gt;\n</code></pre> <p>6\u3001abstract\u5c5e\u6027\u521b\u5efa\u4e00\u4e2a\u6a21\u677fbean \u901a\u8fc7abstract\u5c5e\u6027\u521b\u5efa\u4e00\u4e2a\u6a21\u677fbean\uff0c\u901a\u8fc7\u7ee7\u627f\u5b9e\u73b0bean\u914d\u7f6e\u4fe1\u606f\u7684\u91cd\u7528 Text Only<pre><code>&lt;!-- abstract=true\u7684bean\u53ea\u80fd\u88ab\u7ee7\u627f --&gt;\n&lt;bean id=\"person02\" class=\"pojo.Person\" abstract=\"true\"&gt;\n\u00a0\u00a0&lt;property name=\"name\" value=\"\u5f20\u4e09\"/&gt;\n\u00a0\u00a0&lt;property name=\"dog\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"pojo.Dog\" c:name=\"\u5c0f\u9ed1\" c:color=\"black\"/&gt;\n\u00a0\u00a0&lt;/property&gt;\n&lt;/bean&gt;\n&lt;!-- \u7ee7\u627fid=person02\u7684bean\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u53ea\u662f\u7ee7\u627f\u914d\u7f6e\u4fe1\u606f--&gt;\n&lt;bean id=\"person03\" parent=\"person02\"/&gt;\n</code></pre></p> <p>7\u3001\u5f15\u7528\u5916\u90e8\u5c5e\u6027\u6587\u4ef6 druid.properties\u6587\u4ef6 Text Only<pre><code>#username\u662fspring\u4e2d\u7684\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u6240\u4ee5\u5f15\u7528\u5916\u90e8\u5c5e\u6027\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u7528${username}\u4f1a\u51b2\u7a81\uff0c\u4e8e\u662f\u6539\u540d\u4e3ajdbc.username\njdbc.driverClassName=com.mysql.cj.jdbc.Driver\njdbc.url=jdbc:mysql://localhost:3306/test?serverTimezone=UTC&amp;characterEncoding=utf-8&amp;rewriteBatchedStatements=true\njdbc.username=root\njdbc.password=079335\n</code></pre> \u9700\u8981\u5bfc\u5165context\u540d\u79f0\u7a7a\u95f4 Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:context=\"http://www.springframework.org/schema/context\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n\n\u00a0\u00a0&lt;!-- \u9700\u8981\u5bfc\u5165context\u540d\u79f0\u7a7a\u95f4 --&gt;\n\u00a0\u00a0&lt;context:property-placeholder location=\"classpath:druid.properties\"/&gt;\n\u00a0\u00a0&lt;!-- \u5355\u4f8b\u7684\u6570\u636e\u5e93\u8fde\u63a5\u6c60 --&gt;\n\u00a0\u00a0&lt;bean class=\"com.alibaba.druid.pool.DruidDataSource\" id=\"druidDataSource\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- username\u662fspring\u4e2d\u7684\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u6240\u4ee5\u5f15\u7528\u5916\u90e8\u5c5e\u6027\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u7528${username}\u4f1a\u51b2\u7a81\uff0c\u4e8e\u662f\u6539\u540d\u4e3ajdbc.username--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"username\" value=\"${jdbc.username}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"password\" value=\"${jdbc.password}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\u00a0\u00a0\u00a0\u00a0&lt;property name=\"url\"&gt;&lt;value&gt;&lt;![CDATA[ jdbc:mysql://localhost:3306/test?serverTimezone=UTC&amp;characterEncoding=utf-8]]&gt;&lt;/value&gt;&lt;/property&gt;--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"url\" value=\"${jdbc.url}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"driverClassName\" value=\"${jdbc.driverClassName}\"/&gt;\n\u00a0\u00a0&lt;/bean&gt;\n\n&lt;/beans&gt;\n</code></pre></p> <p>8\u3001bean\u7684\u4f5c\u7528\u57df \u901a\u8fc7\u914d\u7f6ebean\u6807\u7b7e\u7684scope\u5c5e\u6027\u6765\u6307\u5b9abean\u7684\u4f5c\u7528\u57df\u8303\u56f4\uff0c\u5404\u53d6\u503c\u542b\u4e49\u53c2\u52a0\u4e0b\u8868\uff1a</p> \u53d6\u503c \u542b\u4e49 \u521b\u5efa\u5bf9\u8c61\u7684\u65f6\u673a singleton\uff08\u9ed8\u8ba4\uff09 \u5728IOC\u5bb9\u5668\u4e2d\uff0c\u8fd9\u4e2abean\u7684\u5bf9\u8c61\u59cb\u7ec8\u4e3a\u5355\u5b9e\u4f8b IOC\u5bb9\u5668\u521d\u59cb\u5316\u65f6 prototype \u8fd9\u4e2abean\u5728IOC\u5bb9\u5668\u4e2d\u6709\u591a\u4e2a\u5b9e\u4f8b \u83b7\u53d6bean\u65f6 <p>\u5982\u679c\u662f\u5728WebApplicationContext\u73af\u5883\u4e0b\u8fd8\u4f1a\u6709\u53e6\u5916\u51e0\u4e2a\u4f5c\u7528\u57df\uff08\u4f46\u4e0d\u5e38\u7528\uff09\uff1a</p> \u53d6\u503c \u542b\u4e49 request \u5728\u4e00\u4e2a\u8bf7\u6c42\u8303\u56f4\u5185\u6709\u6548 session \u5728\u4e00\u4e2a\u4f1a\u8bdd\u8303\u56f4\u5185\u6709\u6548 Text Only<pre><code>&lt;!--\u00a0\u00a0bean\u7684\u4f5c\u7528\u57df\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u2460 singleton\uff08\u9ed8\u8ba4\uff09\uff1a\u5355\u4f8b\uff0c\u5bb9\u5668\u521b\u5efa\u65f6\u521b\u5efa\uff0c\u4efb\u4f55\u65f6\u5019\u83b7\u53d6\u7684\u90fd\u662f\u540c\u4e00\u4e2a\u5b9e\u4f8b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u2461 prototype\uff1a\u591a\u5b9e\u4f8b\uff0c\u5bb9\u5668\u521b\u5efa\u65f6\u4e0d\u521b\u5efa\uff0c\u7b49\u5230\u83b7\u53d6\u65f6\u624d\u521b\u5efa\uff0c\u6bcf\u6b21\u83b7\u53d6\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u4ee5\u4e0b\u5728web\u5e94\u7528\u4e2d\u7528\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u57fa\u672c\u4e0d\u7528\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u2462 request \u2463 session \u2464 application \u2465 websocket\n--&gt;\n&lt;bean id=\"book04\" class=\"pojo.Book\" p:name=\"book04\" scope=\"singleton\"/&gt;\n&lt;bean id=\"book05\" class=\"pojo.Book\" p:name=\"book05\" scope=\"prototype\"/&gt;\n</code></pre> <p>9\u3001\u81ea\u52a8\u88c5\u914d \u4f7f\u7528bean\u6807\u7b7e\u7684autowire\u5c5e\u6027\u8bbe\u7f6e\u81ea\u52a8\u88c5\u914d\u6548\u679c</p> <ul> <li>byType\uff1a\u6839\u636e\u7c7b\u578b\u5339\u914dIOC\u5bb9\u5668\u4e2d\u7684\u67d0\u4e2a\u517c\u5bb9\u7c7b\u578b\u7684bean\uff0c\u4e3a\u5c5e\u6027\u81ea\u52a8\u8d4b\u503c\u3002\u82e5\u5728IOC\u4e2d\uff0c\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u517c\u5bb9\u7c7b\u578b\u7684bean\u80fd\u591f\u4e3a\u5c5e\u6027\u8d4b\u503c\uff0c\u5219\u8be5\u5c5e\u6027\u4e0d\u88c5\u914d\uff0c\u5373\u503c\u4e3a\u9ed8\u8ba4\u503cnull\uff1b\u82e5\u5728IOC\u4e2d\uff0c\u6709\u591a\u4e2a\u517c\u5bb9\u7c7b\u578b\u7684bean\u80fd\u591f\u4e3a\u5c5e\u6027\u8d4b\u503c\uff0c\u5219\u629b\u51fa\u5f02\u5e38NoUniqueBeanDefinitionException\u3002</li> <li>byName\uff1a\u5c06\u81ea\u52a8\u88c5\u914d\u7684\u5c5e\u6027\u7684\u5c5e\u6027\u540d\uff0c\u4f5c\u4e3abean\u7684id\u5728IOC\u5bb9\u5668\u4e2d\u5339\u914d\u76f8\u5bf9\u5e94\u7684bean\u8fdb\u884c\u8d4b\u503c\u3002</li> </ul> <p>\u8fd9\u91cc\u7684\u81ea\u52a8\u88c5\u914d\u5176\u5b9e\u5c31\u662fSetter\u6ce8\u5165 Text Only<pre><code>&lt;!--\n\u00a0\u00a0autowire\u81ea\u52a8\u88c5\u914d\uff0c\u9ed8\u8ba4\u4e0d\u81ea\u52a8\u88c5\u914d\uff08xml\u914d\u7f6e\u7684\u81ea\u52a8\u88c5\u914d\u57fa\u672c\u4e0d\u7528\uff09\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.byName: \u6309\u7167\u5c5e\u6027\u540d\u4f5c\u4e3aid\u53bb\u5bb9\u5668\u4e2d\u627e\u5bf9\u8c61\u7136\u540e\u8d4b\u503c\uff0c\u76f8\u5f53\u4e8ebean.getBean(\"cat\")\uff0c\u627e\u4e0d\u5230\u4e0d\u4f1a\u629b\u5f02\u5e38\uff0c\u800c\u662f\u8d4bnull\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.byType: \u901a\u8fc7\u5c5e\u6027\u540d\u7684\u7c7b\u578b\u53bb\u5bb9\u5668\u4e2d\u627e\u5bf9\u8c61\u7136\u540e\u8d4b\u503c\uff0c\u76f8\u5f53\u4e8ebean.getBean(cat.class)\uff0c\u5982\u679c\u5bb9\u5668\u4e2d\u6709\u591a\u4e2a\u5c31\u629b\u5f02\u5e38\uff0c\u6ca1\u627e\u5230\u88c5\u914dnull\n--&gt;\n&lt;bean class=\"pojo.Person\" id=\"person\" autowire=\"constructor\"/&gt;\n</code></pre></p> <p>10\u3001\u901a\u8fc7\u5de5\u5382\u65b9\u6cd5\u521b\u5efabean 10.1 \u901a\u8fc7\u9759\u6001\u5de5\u5382\u65b9\u6cd5\u521b\u5efa\u7684bean Text Only<pre><code>/**\n* Book\u7684\u9759\u6001\u5de5\u5382\uff0c\u8c03\u7528 getBook() \u65b9\u6cd5\u4e4b\u524d\u4e0d\u9700\u8981\u521b\u5efa BookInstanceFactory \u7684\u5bf9\u8c61\uff0c\u76f4\u63a5BookStaticFactory.getBook()\u5373\u53ef\n*/\npublic class BookStaticFactory {\n\u00a0\u00a0\u00a0\u00a0public static Book getBook(String name){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"BookStaticFactory \u6b63\u5728\u521b\u5efa Book\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Book book = new Book();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setName(name);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setAuthor(\"anonymous\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setPrice(99.9);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return book;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>&lt;!--\u00a0\u00a0\u9759\u6001\u5de5\u5382\u521b\u5efaBook\u5bf9\u8c61--&gt;\n&lt;bean id=\"book11\" class=\"pojo.factory.BookStaticFactory\" factory-method=\"getBook\"&gt;\n\u00a0\u00a0&lt;constructor-arg value=\"\u4e09\u56fd\u6f14\u4e49\"/&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>10.2\u00a0\u901a\u8fc7\u5b9e\u4f8b\u5de5\u5382\u521b\u5efaBook\u5bf9\u8c61 Text Only<pre><code>/**\n* Book\u7684\u5b9e\u4f8b\u5de5\u5382\uff0c\u8c03\u7528 getBook() \u65b9\u6cd5\u4e4b\u524d\u9700\u8981\u521b\u5efa BookInstanceFactory \u7684\u5bf9\u8c61\n*/\npublic class BookInstanceFactory {\n\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u5b9e\u4f8b\u5de5\u5382\u88ab\u521b\u5efa\u4e86\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public Book getBook(String name){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"BookInstanceFactory \u6b63\u5728\u521b\u5efa Book\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Book book = new Book();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setName(name);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setAuthor(\"anonymous\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setPrice(99.9);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return book;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>&lt;!--\u00a0\u00a0\u5b9e\u4f8b\u5de5\u5382\u521b\u5efaBook\u5bf9\u8c61--&gt;\n&lt;bean id=\"bookInstanceFactory\" class=\"pojo.factory.BookInstanceFactory\"/&gt;\n&lt;bean id=\"book12\" class=\"pojo.Book\" scope=\"prototype\" factory-bean=\"bookInstanceFactory\" factory-method=\"getBook\"&gt;\n\u00a0\u00a0&lt;constructor-arg value=\"\u4e00\u53ea\u7279\u7acb\u72ec\u884c\u7684\u732a\"/&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>10.3\u00a0\u901a\u8fc7FactoryBean\u521b\u5efaBook\u5bf9\u8c61 FactoryBean\u662fSpring\u63d0\u4f9b\u7684\u4e00\u79cd\u6574\u5408\u7b2c\u4e09\u65b9\u6846\u67b6\u7684\u5e38\u7528\u673a\u5236\u3002\u548c\u666e\u901a\u7684bean\u4e0d\u540c\uff0c\u914d\u7f6e\u4e00\u4e2aFactoryBean\u7c7b\u578b\u7684bean\uff0c\u5728\u83b7\u53d6bean\u7684\u65f6\u5019\u5f97\u5230\u7684\u5e76\u4e0d\u662fclass\u5c5e\u6027\u4e2d\u914d\u7f6e\u7684\u8fd9\u4e2a\u7c7b\u7684\u5bf9\u8c61\uff0c\u800c\u662fgetObject()\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u3002\u901a\u8fc7\u8fd9\u79cd\u673a\u5236\uff0cSpring\u53ef\u4ee5\u5e2e\u6211\u4eec\u628a\u590d\u6742\u7ec4\u4ef6\u521b\u5efa\u7684\u8be6\u7ec6\u8fc7\u7a0b\u548c\u7e41\u7410\u7ec6\u8282\u90fd\u5c4f\u853d\u8d77\u6765\uff0c\u53ea\u628a\u6700\u7b80\u6d01\u7684\u4f7f\u7528\u754c\u9762\u5c55\u793a\u7ed9\u6211\u4eec\u3002\uff08\u6bd4\u5982\u6574\u5408Mybatis\u65f6\uff0cSpring\u5c31\u662f\u901a\u8fc7FactoryBean\u673a\u5236\u6765\u5e2e\u6211\u4eec\u521b\u5efaSqlSessionFactory\u5bf9\u8c61\u7684\u3002\uff09 Text Only<pre><code>/**\n* FactoryBean\u63a5\u53e3\u662fSpring\u7684\u5de5\u5382\u63a5\u53e3\uff0c\u7ee7\u627f\u8be5\u63a5\u53e3\u7684\u7c7b\u5728\u6ce8\u518c\uff08\u6ce8\u518c\u5373\u5728xml\u914d\u7f6e\uff09\u540e\uff0cspring\u4f1a\u9ed8\u8ba4\u8c03\u7528\u8be5\u7c7b\u7684\u65b9\u6cd5\u521b\u5efa\u5bf9\u8c61\n*/\npublic class MyFactoryBeanImpl implements FactoryBean&lt;Book&gt; {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5de5\u5382\u65b9\u6cd5\n\u00a0\u00a0\u00a0\u00a0\u00a0* @return \u521b\u5efa\u7684\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0* @throws Exception\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Book getObject() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Book book = new Book();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setName(UUID.randomUUID().toString().substring(0, 8));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setAuthor(\"anonymous\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0book.setPrice(39.3);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return book;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Class&lt;?&gt; getObjectType() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Book.class;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u63a5\u53e3\u7684\u9ed8\u8ba4\u5b9e\u73b0\u662ftrue\uff0c\u8868\u793a\u5355\u4f8b\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u4f7f\u7528FactoryBean\u521b\u5efa\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u662f\u5355\u4f8b\u8fd8\u662f\u591a\u4f8b\uff0c\u90fd\u662f\u5728\u83b7\u53d6\u5b9e\u4f8b\u7684\u65f6\u4faf\u521b\u5efa\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0* @return\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public boolean isSingleton() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>&lt;!-- MyFactoryBeanImpl\u662f\u7ee7\u627fSpring\u7684FactoryBean\u63a5\u53e3\u7684\u5de5\u5382\u7c7b\uff0c\nioc\u5bb9\u5668\u4f1a\u81ea\u52a8\u8c03\u7528MyFactoryBeanImpl\u7c7b\u7684getObject\u65b9\u6cd5\u6765\u521b\u5efabean,\n\u4e0d\u7ba1\u8be5bean\u662f\u5355\u4f8b\u7684\u8fd8\u662f\u591a\u4f8b\u7684\uff0c\u90fd\u662f\u5728\u83b7\u53d6\u65f6\u624d\u521b\u5efa\u5bf9\u8c61--&gt;\n&lt;bean id=\"book13\" class=\"pojo.factory.MyFactoryBeanImpl\"/&gt;\n</code></pre></p> <p>11\u3001bean\u751f\u547d\u5468\u671f \u751f\u547d\u5468\u671f\u8fc7\u7a0b\uff1a</p> <ol> <li>bean\u5bf9\u8c61\u521b\u5efa\uff08\u8c03\u7528\u65e0\u53c2\u6784\u9020\u5668\uff09</li> <li>\u7ed9bean\u5bf9\u8c61\u8bbe\u7f6e\u5c5e\u6027</li> <li>bean\u7684\u540e\u7f6e\u5904\u7406\u5668\uff08\u521d\u59cb\u5316\u4e4b\u524d\uff09</li> <li>bean\u5bf9\u8c61\u521d\u59cb\u5316\uff08\u9700\u5728\u914d\u7f6ebean\u65f6\u6307\u5b9a\u521d\u59cb\u5316\u65b9\u6cd5\uff09</li> <li>bean\u7684\u540e\u7f6e\u5904\u7406\u5668\uff08\u521d\u59cb\u5316\u4e4b\u540e\uff09</li> <li>\u4f7f\u7528bean\u5bf9\u8c61</li> <li>bean\u5bf9\u8c61\u9500\u6bc1\uff08\u9700\u5728\u914d\u7f6ebean\u65f6\u6307\u5b9a\u9500\u6bc1\u65b9\u6cd5\uff09</li> <li>IOC\u5bb9\u5668\u5173\u95ed</li> </ol> <p>11.1 \u521d\u59cb\u5316\u65b9\u6cd5 \u548c \u9500\u6bc1\u65b9\u6cd5 Text Only<pre><code>&lt;!-- \u4e0d\u80fd\u4f7f\u7528\u5b9e\u4f8b\u5de5\u5382\u548c\u5b9e\u73b0FactoryBean\u7684\u5de5\u5382\u6765\u521b\u5efa\u5e26\u6709\u521d\u59cb\u5316\u65b9\u6cd5\u548c\u9500\u6bc1\u65b9\u6cd5\u7684bean\u3002\n\u5e26\u6709\u521d\u59cb\u5316\u65b9\u6cd5\u548c\u9500\u6bc1\u65b9\u6cd5\u7684 \u5355\u4f8bbean \u662f\u548cioc\u5bb9\u5668\u4e00\u8d77\u521b\u5efa\u548c\u9500\u6bc1\u7684\n\u5982\u679c\u662f\u591a\u5b9e\u4f8b\u7684bean\uff0c\u5219\u662f\u5728bean\u521b\u5efa\u540e\u8c03\u7528init-method\uff0c\u5728\u5bb9\u5668\u5173\u95ed\u65f6\u4e0d\u8c03\u7528destroy-method--&gt;\n&lt;bean id=\"book21\" class=\"pojo.Book\" `init-method=\"bookInit\" destroy-method=\"bookDestroy\"`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0p:name=\"Spring\u7f16\u7a0b\"/&gt;\n</code></pre></p> <p>11.2 bean\u7684\u540e\u7f6e\u5904\u7406\u5668 bean\u7684\u540e\u7f6e\u5904\u7406\u5668\u4f1a\u5728\u751f\u547d\u5468\u671f\u7684\u521d\u59cb\u5316\u524d\u540e\u6dfb\u52a0\u989d\u5916\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u5b9e\u73b0BeanPostProcessor\u63a5\u53e3\uff0c\u4e14\u914d\u7f6e\u5230IOC\u5bb9\u5668\u4e2d\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cbean\u540e\u7f6e\u5904\u7406\u5668\u4e0d\u662f\u5355\u72ec\u9488\u5bf9\u67d0\u4e00\u4e2abean\u751f\u6548\uff0c\u800c\u662f\u9488\u5bf9IOC\u5bb9\u5668\u4e2d\u6240\u6709bean\u90fd\u4f1a\u6267\u884c\u3002 \u521b\u5efabean\u7684\u540e\u7f6e\u5904\u7406\u5668\uff1a Text Only<pre><code>public class BookPostProcessor implements BeanPostProcessor {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0*\u521d\u59cb\u5316\u4e4b\u524d\u8c03\u7528\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(beanName + \"\u7684postProcess Before Initialization\u8c03\u7528\u4e86\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return bean;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0*\u521d\u59cb\u5316\u4e4b\u540e\u8c03\u7528\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(beanName + \"\u7684postProcess After Initialization\u8c03\u7528\u4e86\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return bean;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>&lt;!-- Bean\u540e\u7f6e\u5904\u7406\u5668BeanPostProcessor\u7684\u4f5c\u7528\u662f\u5728init-method\u524d\u540e\u6267\u884c\u65b9\u6cd5,\n\u4e0d\u8fc7\u65e0\u8bba\u6709\u6ca1\u6709init-method\u65b9\u6cd5\uff0c\u540e\u7f6e\u5904\u7406\u5668\u90fd\u4f1a\u6267\u884c--&gt;\n&lt;bean class=\"pojo.beanPostProcessor.BookPostProcessor\" id=\"bookPostProcessor\"/&gt;\n</code></pre></p> <p>\u4e8c\u3001\u83b7\u53d6Bean \u4f7f\u7528getBean()\u65b9\u6cd5\u4eceIOC\u5bb9\u5668\u4e2d\u83b7\u53d6Bean 1\u3001\u6839\u636eid\u83b7\u53d6 Text Only<pre><code>public static void mian() {\n\u00a0\u00a0\u00a0\u00a0ApplicationContext applicationContext = `new ClassPathXmlApplicationContext(\"pojo.xml\", \"dao.xml\", \"service.xml\"); //\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u5f80IOC\u5bb9\u5668\u4e2d\u521b\u5efaBean\uff0c\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6`\n\u00a0\u00a0\u00a0\u00a0User\u00a0user01 = `(User) applicationContext.getBean(\"user01\"); //\u9700\u8981\u5f3a\u8f6c`\n\u00a0\u00a0\u00a0\u00a0System.out.println(user01);\n}\n</code></pre></p> <p>\u62d3\u5c55\uff1a \u521b\u5efaApplicationContext\u65f6\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u628a\u914d\u7f6e\u6587\u4ef6\u96c6\u4e2d\u5230\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u521b\u5efaApplicationContext\u65f6\u6307\u5b9a\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;\n `&lt;import resource=\"di01.xml\"/&gt;`\n\u00a0\u00a0&lt;import resource=\"ioc04.xml\"/&gt;\n\u00a0\u00a0&lt;import resource=\"dataSource.xml\"/&gt;\n&lt;/beans&gt;\n</code></pre></p> <p>2\u3001\u6839\u636e\u7c7b\u578b\u83b7\u53d6 \u6ce8\u610f\uff1a</p> <ul> <li>\u5f53\u6839\u636e\u7c7b\u578b\u83b7\u53d6bean\u65f6\uff0c\u8981\u6c42IOC\u5bb9\u5668\u4e2d\u6307\u5b9a\u7c7b\u578b\u7684bean\u6709\u4e14\u53ea\u80fd\u6709\u4e00\u4e2a</li> <li>\u53ef\u4ee5\u6839\u636e\u63a5\u53e3\u7c7b\u578b\u83b7\u53d6\u5b9e\u73b0\u7c7b\u7684\u5bf9\u8c61\uff0c\u4f46\u662f\u63a5\u53e3\u5728\u5bb9\u5668\u4e2d\u4e0d\u80fd\u6709\u591a\u4e2a\u5b9e\u73b0\u7c7b\u5bf9\u8c61</li> </ul> Text Only<pre><code>public static void mian() {\n\u00a0\u00a0\u00a0\u00a0ApplicationContext applicationContext = new ClassPathXmlApplicationContext(\"pojo.xml\", \"dao.xml\", \"service.xml\");\n\u00a0\u00a0\u00a0\u00a0User user01 = applicationContext.getBean(User.class); //\u4e0d\u9700\u8981\u5f3a\u8f6c\uff0c\u4f46\u662f\u5bb9\u5668\u4e2d\u6307\u5b9a\u7c7b\u578b\u7684bean\u6709\u4e14\u53ea\u80fd\u6709\u4e00\u4e2a\n\u00a0\u00a0\u00a0\u00a0System.out.println(user01);\n}\n</code></pre> <p>3\u3001\u6839\u636eid\u548c\u7c7b\u578b Text Only<pre><code>public static void mian() {\n\u00a0\u00a0\u00a0\u00a0ApplicationContext applicationContext = new ClassPathXmlApplicationContext(\"pojo.xml\", \"dao.xml\", \"service.xml\");\n\u00a0\u00a0\u00a0\u00a0User user01 = applicationContext.getBean(\"user01\", User.class); //\u5177\u5907\u4e0a\u8ff0\u4e24\u79cd\u65b9\u5f0f\u7684\u4f18\u70b9\n\u00a0\u00a0\u00a0\u00a0System.out.println(user01);\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/3-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AEBean/","title":"3-\u6ce8\u89e3\u914d\u7f6eBean","text":"<p> \u7ea6 2504 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 50 \u5206\u949f</p> <p>Springboot\u63d0\u4f9b\u4e86\u901a\u8fc7\u6ce8\u89e3\u914d\u7f6e\u66ff\u4ee3XML\u6587\u4ef6\u914d\u7f6e\u7684\u65b9\u5f0f\uff0c\u6781\u5927\u5730\u65b9\u4fbf\u4e86\u5f00\u53d1\u3002 \u4e00\u3001\u5f00\u542f\u7ec4\u4ef6\u626b\u63cf 1\u3001XML\u914d\u7f6e\u5f00\u542f\u7ec4\u4ef6\u626b\u63cf Spring \u9ed8\u8ba4\u4e0d\u4f7f\u7528\u6ce8\u89e3\u88c5\u914d Bean\uff0c\u9700\u8981\u5728 Spring \u7684 XML \u914d\u7f6e\u4e2d\u901a\u8fc7 context:component-scan \u5143\u7d20\u5f00\u542f Spring Beans\u7684\u81ea\u52a8\u626b\u63cf\u529f\u80fd\u3002\u5f00\u542f\u6b64\u529f\u80fd\u540e\uff0cSpring \u4f1a\u81ea\u52a8\u4ece\u626b\u63cf\u6307\u5b9a\u7684\u5305\uff08base-package \u5c5e\u6027\u8bbe\u7f6e\uff09\u53ca\u5176\u5b50\u5305\u4e0b\u7684\u6240\u6709\u7c7b\uff0c\u5982\u679c\u7c7b\u4e0a\u4f7f\u7528\u4e86 @Component \u6ce8\u89e3\uff0c\u5c31\u5c06\u8be5\u7c7b\u88c5\u914d\u5230\u5bb9\u5668\u4e2d\u3002 Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `xmlns:context=\"http://www.springframework.org/schema/context\"`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n\u00a0\u00a0\u00a0\u00a0http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\n\u00a0\u00a0\u00a0\u00a0http://www.springframework.org/schema/context\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0http://www.springframework.org/schema/context/spring-context.xsd\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\u5f00\u542f\u7ec4\u4ef6\u626b\u63cf\u529f\u80fd--&gt;\n\u00a0\u00a0\u00a0\u00a0`&lt;context:component-scan base-package=\"com.atguigu.spring6\"&gt;&lt;/context:component-scan&gt;`\n&lt;/beans&gt;\n</code></pre> \u6ce8\u610f\uff1a\u5728\u4f7f\u7528 context:component-scan \u5143\u7d20\u5f00\u542f\u81ea\u52a8\u626b\u63cf\u529f\u80fd\u524d\uff0c\u9996\u5148\u9700\u8981\u5728 XML \u914d\u7f6e\u7684\u4e00\u7ea7\u6807\u7b7e  \u4e2d\u6dfb\u52a0 context \u76f8\u5173\u7684\u7ea6\u675f\u3002 <p>1\u3001\u6700\u57fa\u672c\u7684\u626b\u63cf\u65b9\u5f0f Text Only<pre><code>&lt;context:component-scan base-package=\"dao,service,controller\"&gt;&lt;/context:component-scan&gt;\n</code></pre></p> <ul> <li>base-package\u5c5e\u6027\u6307\u5b9a\u4e00\u4e2a\u9700\u8981\u626b\u63cf\u7684\u57fa\u7c7b\u5305\uff0cSpring\u5bb9\u5668\u5c06\u4f1a\u626b\u63cf\u8fd9\u4e2a\u57fa\u7c7b\u5305\u53ca\u5176\u5b50\u5305\u4e2d\u7684\u6240\u6709\u7c7b\u3002</li> <li>\u5f53\u9700\u8981\u626b\u63cf\u591a\u4e2a\u5305\u65f6\u53ef\u4ee5\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002</li> </ul> <p>2\u3001\u6307\u5b9a\u8981\u6392\u9664\u7684\u7ec4\u4ef6 Text Only<pre><code>&lt;context:component-scan base-package=\"com.atguigu.spring6\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- context:exclude-filter\u6807\u7b7e\uff1a\u6307\u5b9a\u6392\u9664\u89c4\u5219 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type\uff1a\u8bbe\u7f6e\u6392\u9664\u6216\u5305\u542b\u7684\u4f9d\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"annotation\"\uff0c\u6839\u636e\u6ce8\u89e3\u6392\u9664\uff0cexpression\u4e2d\u8bbe\u7f6e\u8981\u6392\u9664\u7684\u6ce8\u89e3\u7684\u5168\u7c7b\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"assignable\"\uff0c\u6839\u636e\u7c7b\u578b\u6392\u9664\uff0cexpression\u4e2d\u8bbe\u7f6e\u8981\u6392\u9664\u7684\u7c7b\u578b\u7684\u5168\u7c7b\u540d\n\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;context:exclude-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--&lt;context:exclude-filter type=\"assignable\" expression=\"com.atguigu.spring6.controller.UserController\"/&gt;--&gt;\n&lt;/context:component-scan&gt;\n</code></pre></p> <p>3\u3001\u4ec5\u626b\u63cf\u6307\u5b9a\u7ec4\u4ef6 \u56e0\u4e3a\u9ed8\u8ba4\u662f\u626b\u63cf\u5168\u90e8\uff0c\u6240\u4ee5\u5982\u679c\u8981\u6307\u5b9a\u626b\u63cf\u65f6\u5305\u542b\u7684\u7c7b\u5c31\u9700\u8981\u5148\u5173\u95ed\u9ed8\u8ba4\u7684\u626b\u63cf\u89c4\u5219\uff0cuse-default-filters=\"false\" Text Only<pre><code>&lt;context:component-scan base-package=\"com.atguigu\" use-default-filters=\"false\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- context:include-filter\u6807\u7b7e\uff1a\u6307\u5b9a\u5728\u539f\u6709\u626b\u63cf\u89c4\u5219\u7684\u57fa\u7840\u4e0a\u8ffd\u52a0\u7684\u89c4\u5219 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- use-default-filters\u5c5e\u6027\uff1a\u53d6\u503cfalse\u8868\u793a\u5173\u95ed\u9ed8\u8ba4\u626b\u63cf\u89c4\u5219 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6b64\u65f6\u5fc5\u987b\u8bbe\u7f6euse-default-filters=\"false\"\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u89c4\u5219\u5373\u626b\u63cf\u6307\u5b9a\u5305\u4e0b\u6240\u6709\u7c7b --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type\uff1a\u8bbe\u7f6e\u6392\u9664\u6216\u5305\u542b\u7684\u4f9d\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"annotation\"\uff0c\u6839\u636e\u6ce8\u89e3\u6392\u9664\uff0cexpression\u4e2d\u8bbe\u7f6e\u8981\u6392\u9664\u7684\u6ce8\u89e3\u7684\u5168\u7c7b\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0type=\"assignable\"\uff0c\u6839\u636e\u7c7b\u578b\u6392\u9664\uff0cexpression\u4e2d\u8bbe\u7f6e\u8981\u6392\u9664\u7684\u7c7b\u578b\u7684\u5168\u7c7b\u540d\n\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;context:include-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--&lt;context:include-filter type=\"assignable\" expression=\"com.atguigu.spring6.controller.UserController\"/&gt;--&gt;\n&lt;/context:component-scan&gt;\n</code></pre></p> <p>2\u3001\u6ce8\u89e3\u914d\u7f6e\u5f00\u542f\u7ec4\u4ef6\u626b\u63cf \u901a\u8fc7\u914d\u7f6e\u7c7b\u4ee3\u66ff\u914d\u7f6e\u6587\u4ef6\uff1a\u5728\u7c7b\u4e0a\u52a0\u4e0a@Configuration\u6ce8\u89e3\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff0c\u7136\u540e\u901a\u8fc7@ComponentScan\u6ce8\u89e3\u6307\u660e\u9700\u8981\u626b\u63cf\u7684\u5305\uff0c\u4e0d\u6307\u5b9a\u7684\u8bdd\u5c31\u662f\u9ed8\u8ba4\u626b\u63cf\u914d\u7f6e\u7c7b\u6240\u5728\u7684\u5305\u4ee5\u53ca\u5b50\u5305\uff0c\u6307\u5b9a\u7684\u8bdd\u53ea\u626b\u63cf\u6307\u5b9a\u7684\u5305\u3002 Text Only<pre><code>@Configuration\n@ComponentScan({\"dao\", \"service\", \"controller\"})\npublic class ScanConfig {\n}\n</code></pre> @ComponentScan\u6ce8\u89e3\u4e5f\u652f\u6301 \u6392\u9664\u626b\u63cf\u6307\u5b9a\u7684\u6ce8\u89e3\u00a0\u548c \u4ec5\u626b\u63cf\u6307\u5b9a\u7ec4\u4ef6\uff0c\u4f46\u662f\u6709\u70b9\u9ebb\u70e6\uff0c\u8fd9\u4e24\u4e2a\u914d\u7f6e\u4e5f\u4e0d\u5e38\u7528\uff0c\u6240\u4ee5\u4e0d\u5c55\u5f00\u3002\u7531\u6b64\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u6ce8\u89e3\u5b8c\u5168\u53ef\u4ee5\u66ff\u4ee3XML\u914d\u7f6e\uff0c\u867d\u7136\u6211\u4eec\u5728\u4f7f\u7528\u6ce8\u89e3\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u603b\u611f\u89c9\u6ca1\u6709XML\u914d\u7f6e\u529f\u80fd\u5f3a\u5927\uff0c\u4f46\u662f\u8bdd\u53c8\u8bf4\u56de\u6765\uff0c\u4f7f\u7528\u6ce8\u89e3\u914d\u7f6e\u529f\u80fd\u867d\u7136\u7a0d\u5f31\uff0c\u4f46\u662f\u4e5f\u5b8c\u5168\u80fd\u652f\u6491\u5f00\u53d1\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5176\u5b9e\u7528\u4e0d\u5230XML\u5f88\u591a\u82b1\u91cc\u80e1\u54e8\u7684\u914d\u7f6e\u3002 \u4f7f\u7528AnnotationConfigApplicationContext\u8bfb\u53d6\u914d\u7f6e\u7c7b\u521b\u5efaIOC\u5bb9\u5668\uff1a Text Only<pre><code>ApplicationContext iocContainer01 = new AnnotationConfigApplicationContext(ScanConfig.class);\nBookServlet bookServlet = iocContainer01.getBean(\"bookServlet\", BookServlet.class);\n</code></pre> @Configuration\u7684\u5c5e\u6027 proxyBeanMethods \u6307\u660e\u5728ioc\u5bb9\u5668\u5185\u521b\u5efa\u914d\u7f6e\u7c7b\u7684\u5bf9\u8c61\uff0c\u8fd8\u662f\u521b\u5efa\u914d\u7f6e\u7c7b\u7684\u4ee3\u7406\u5bf9\u8c61\u3002</p> <ul> <li>\u5c5e\u6027 proxyBeanMethods\u9ed8\u8ba4\u4e3atrue\uff0c\u8868\u793a\u521b\u5efa\u914d\u7f6e\u7c7b\u7684\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff0c\u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528@Bean\u65b9\u6cd5\u8fd4\u56de\u7684\u59cb\u7ec8\u662f\u5355\u5b9e\u4f8bbean\uff0c\u8fd9\u662fFULL Mode\uff0c\u56e0\u4e3a\u4ee3\u7406\u7c7b\u5bf9\u8c61\u6bcf\u6b21\u90fd\u8981\u68c0\u67e5\u5bb9\u5668\u4e2d\u6709\u6ca1\u6709\u8fd9\u4e2abean\u3002</li> <li>\u6539\u4e3afalse\uff0c\u5219\u8868\u793a\u5728\u5bb9\u5668\u4e2d\u521b\u5efa\u7684\u662f\u914d\u7f6e\u7c7b\u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u6bcf\u6b21\u8c03\u7528@Bean\u65b9\u6cd5\u5c31\u53ea\u662f\u5355\u7eaf\u5730\u8c03\u7528\u65b9\u6cd5\uff0c\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\uff0c\u8fd9\u662fLite Mode\uff0c\u56e0\u4e3a\u8fd9\u662f\u76f4\u63a5\u7684\u65b9\u6cd5\u8c03\u7528\u3002</li> </ul> <p>\u914d\u7f6e\u7c7b\u7684@Bean\u65b9\u6cd5\u5728IOC\u5bb9\u5668\u521b\u5efa\u65f6\u88ab\u8c03\u7528\uff0c\u4e00\u822c\u90fd\u4e0d\u4f1a\u624b\u52a8\u901a\u8fc7\u914d\u7f6e\u7c7b\u8c03\u7528@Bean\u65b9\u6cd5\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5c5e\u6027\u5e94\u8be5\u5f88\u5c11\u7528\u3002</p> <p>\u4e8c\u3001\u521b\u5efaBean 1\u3001\u521b\u5efaBean \u4e0b\u9762\u7684\u6ce8\u89e3\u6807\u8bc6\u5728\u7c7b\u4e0a\uff0c\u7ec4\u4ef6\u626b\u63cf\u65f6\u4f1a\u5b9e\u4f8b\u5316\u7c7b\u7684\u5bf9\u8c61\u5230IOC\u5bb9\u5668\u4e2d\u3002</p> \u6ce8\u89e3 \u8bf4\u660e @Component \u666e\u901a\u7ec4\u4ef6\uff0c\u6807\u8bc6\u4e00\u4e2a\u53d7Spring IOC\u5bb9\u5668\u7ba1\u7406\u7684\u7ec4\u4ef6 @Repository \u6301\u4e45\u5316\u5c42\u7ec4\u4ef6\uff0c\u6807\u8bc6\u4e00\u4e2a\u53d7Spring IOC\u5bb9\u5668\u7ba1\u7406\u7684\u6301\u4e45\u5316\u5c42\u7ec4\u4ef6 @Service \u4e1a\u52a1\u903b\u8f91\u5c42\u7ec4\u4ef6\uff0c\u6807\u8bc6\u4e00\u4e2a\u53d7Spring IOC\u5bb9\u5668\u7ba1\u7406\u7684\u4e1a\u52a1\u903b\u8f91\u5c42\u7ec4\u4ef6 @Controller \u8868\u8ff0\u5c42\u63a7\u5236\u5668\u7ec4\u4ef6\uff0c\u6807\u8bc6\u4e00\u4e2a\u53d7Spring IOC\u5bb9\u5668\u7ba1\u7406\u7684\u8868\u8ff0\u5c42\u63a7\u5236\u5668\u7ec4\u4ef6 @Configuration \u914d\u7f6e\u7ec4\u4ef6\uff0c\u6807\u8bc6\u4e00\u4e2a\u53d7Spring IOC\u5bb9\u5668\u7ba1\u7406\u7684\u914d\u7f6e\u7ec4\u4ef6 <p>bean\u7684id\u7684\u547d\u540d\u89c4\u5219\uff1a</p> <ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528\u7ec4\u4ef6\u7684\u7b80\u5355\u7c7b\u540d\u9996\u5b57\u6bcd\u5c0f\u5199\u4f5c\u4e3abean\u7684id\u3002</li> <li>\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u7684value\u5c5e\u6027\u6307\u5b9abean\u7684id\u3002</li> </ul> <p>bean\u7684\u4f5c\u7528\u57df\uff1a\u540c\u6837\uff0c\u9ed8\u8ba4\u662f\u5355\u4f8b\uff0c\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3<code>@Scope(\"prototype\")</code>\u6307\u660e\u4e3a\u591a\u5b9e\u4f8b\u3002</p> <p>\u4f7f\u7528\u4e0a\u97624\u4e2a\u6ce8\u89e3\u521b\u5efabean\u4e0e\u4f7f\u7528XML\u521b\u5efabean\u7684\u533a\u522b\uff1a 1\u3001XML\u53ef\u4ee5\u521b\u5efa\u591a\u4e2aid\u4e0d\u540c\u7684\u5355\u5b9e\u4f8bbean\uff08\u5355\u5b9e\u4f8bbean\u6307scope=singleton\uff0c\u4e0d\u662f\u6307\u5168\u5c40\u5355\u4f8bbean\uff1b\u5305\u62ec\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u662f\u591a\u4e2a\u4e0d\u540c\u7684id\u5bf9\u5e94\u540c\u4e00\u4e2abean\uff1b\u4e8c\u662f\u591a\u4e2a\u4e0d\u540c\u7684id\u5404\u81ea\u5bf9\u5e94\u4e00\u4e2abean\uff0c\u4f46\u8fd9\u4e9bbean\u90fd\u662f\u540c\u4e00\u4e2a\u7c7b\u578b\uff09\uff0c\u4f46\u662f\u4f7f\u7528\u4ee5\u4e0a4\u4e2a\u6ce8\u89e3\u53ea\u80fd\u521b\u5efa\u4e00\u4e2aid\u7684\u5355\u5b9e\u4f8bbean\uff08\u4e00\u4e2a\u7c7b\uff0c\u4e00\u4e2aid\uff0c\u4e00\u4e2abean\uff09\uff0c\u6240\u4ee5<code>\u5982\u679c\u9700\u8981\u76f4\u63a5\u53d1\u73b0\u5e76\u6ce8\u518c\u7ec4\u4ef6\u53ef\u4ee5\u4f7f\u7528\u8fd94\u4e2a\u6ce8\u89e3</code>\u3002 2\u3001XML\u53ef\u4ee5\u521b\u5efaJDK\u5185\u7f6e\u7684\u5bf9\u8c61\u5230\u5bb9\u5668\uff0c\u4e0a\u97624\u4e2a\u6ce8\u89e3\u4e0d\u884c\u3002 \u8fd9\u4e2a\u4e24\u4e2a\u95ee\u9898\u90fd\u53ef\u4ee5\u901a\u8fc7<code>@Bean\u6ce8\u89e3</code>\u89e3\u51b3\uff0c\u6bd4\u5982\u521b\u5efa\u6709\u591a\u4e2a\u4e0d\u540cid\u7684\u5355\u5b9e\u4f8bbean\uff1a Text Only<pre><code>@Configuration //\u6ce8\u610f\uff1a\u914d\u7f6e\u7c7b\u4e2d\u7ec4\u4ef6\u7684\u6ce8\u518c\u987a\u5e8f\u5c31\u662f\u65b9\u6cd5\u58f0\u660e\u7684\u987a\u5e8f\u3002\n@ComponentScan({\"dao\", \"service\", \"controller\"})\npublic class ScanConfig {\n\u00a0\u00a0\u00a0\u00a0`@Bean({\"user1\", \"user2\", \"user3\"}) //\u4e00\u4e2abean\u591a\u4e2aid`\n\u00a0\u00a0\u00a0\u00a0User getUser01() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Random random = new Random();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new User();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Bean(\"u1\")\n\u00a0\u00a0 \u00a0@Scope(\"prototype\")\n\u00a0\u00a0\u00a0\u00a0User getUse02r() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Random random = new Random();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new User();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> @Bean\u6ce8\u89e3\u8fd8\u53ef\u4ee5\u6307\u5b9a\u00a0\u521b\u5efa\u7684bean\u662f\u5426\u81ea\u52a8\u88c5\u914dautowire\uff08\u548cXML\u914d\u7f6e\u7684\u81ea\u52a8\u6ce8\u5165\u4e00\u6837\uff0c\u672c\u8d28\u662fSetter\u6ce8\u5165\uff0c\u4f9d\u8d56Setter\u65b9\u6cd5\uff0c\u521b\u5efa\u5b8c\u5bf9\u8c61\u7acb\u5373\u8c03\u7528Setter\u65b9\u6cd5\uff09\u3001\u521d\u59cb\u5316\u65b9\u6cd5 \u548c \u9500\u6bc1\u65b9\u6cd5\u3002 \u53ef\u4ee5\u8bf4@Bean\u6ce8\u89e3\u624d\u662fXML\u914d\u7f6ebean\u7684\u5b8c\u6574\u66ff\u4ee3\uff0c\u901a\u8fc7XML\u80fd\u5b9e\u73b0\u7684\u914d\u7f6e\uff0c@Bean\u65b9\u6cd5\u90fd\u80fd\u5b9e\u73b0\uff0c\u5373<code>@Bean\u6ce8\u89e3\u548cxml\u914d\u7f6e\u4e2d\u7684bean\u6807\u7b7e\u7684\u4f5c\u7528\u662f\u4e00\u6837\u7684</code>\uff0c\u6bd4\u5982\u5982\u679c\u9700\u8981\u5f15\u7528\u5916\u90e8bean\uff0c\u76f4\u63a5\u5728@Bean\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u5bf9\u5e94\u7c7b\u578b\u7684\u53c2\u6570\u5373\u53ef\uff0cSpring\u4f1a\u7ed9@Bean\u65b9\u6cd5\u7684\u53c2\u6570\u81ea\u52a8\u6ce8\u5165\u3002 \u800c@Component\u3001@Repository\u3001@Service\u3001@Controller\u662f\u4e3a\u4e86\u65b9\u4fbf\u5b9a\u4e49\u7684\uff0c\u5f53\u7c7b\u53ea\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u5355\u5b9e\u4f8bbean\u65f6\u53ef\u4ee5\u901a\u8fc7\u8fd94\u4e2a\u6ce8\u89e3\u5feb\u901f\u5b9a\u4e49\uff0c\u7136\u800c\u4e8b\u5b9e\u4e0a\u8fd9\u79cd\u60c5\u51b5\u5360\u767e\u5206\u4e4b\u4e5d\u5341\uff0c\u6240\u4ee5\u662f\u771f\u7684\u65b9\u4fbf\u3002 \u603b\u7ed3\uff1a\u4e00\u4e2a@Configuration\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2aXML\u914d\u7f6e\u6587\u4ef6\uff0c\u4e00\u4e2a@Bean\u65b9\u6cd5\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2abean\u6807\u7b7e\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0c@Bean\u65b9\u6cd5\u4e0d\u4ec5\u53ef\u4ee5\u653e\u5728@Configuration\u7c7b\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u653e\u5728@Component\u3001@Repository\u3001@Service\u3001@Controller\u6807\u6ce8\u7684\u7c7b\u4e2d\u3002</p> <p>id\u4e0ebean\u7684\u5173\u7cfb\u603b\u7ed3\uff1a id\u4e0ebean\u662fN:1\uff0c\u5373\u00a0\u4e00\u4e2aid\u53ea\u80fd\u5bf9\u5e94\u4e00\u4e2abean\uff08scope=singleton\u7684bean\uff09\uff0c\u4e00\u4e2abean\u53ef\u4ee5\u6709\u591a\u4e2aid\u3002</p> <p>2\u3001\u4f9d\u8d56\u6ce8\u5165</p> <p>1\u3001@Autowired\u6ce8\u5165</p> <ul> <li>\u5355\u72ec\u4f7f\u7528@Autowired\u6ce8\u89e3\uff0c\u9ed8\u8ba4\u6839\u636e\u7c7b\u578b\u88c5\u914d\uff08\u9ed8\u8ba4\u662fbyType\uff09\u3002</li> <li>\u8be5\u6ce8\u89e3\u6709\u4e00\u4e2arequired\u5c5e\u6027\uff0c\u9ed8\u8ba4\u503c\u662ftrue\uff0c\u8868\u793a\u5728\u6ce8\u5165\u7684\u65f6\u5019\u8981\u6c42\u88ab\u6ce8\u5165\u7684Bean\u5fc5\u987b\u662f\u5b58\u5728\u7684\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u62a5\u9519\u3002\u5982\u679crequired\u5c5e\u6027\u8bbe\u7f6e\u4e3afalse\uff0c\u8868\u793a\u6ce8\u5165\u7684Bean\u5b58\u5728\u6216\u8005\u4e0d\u5b58\u5728\u90fd\u6ca1\u5173\u7cfb\uff0c\u5b58\u5728\u7684\u8bdd\u5c31\u6ce8\u5165\uff0c\u4e0d\u5b58\u5728\u7684\u8bdd\uff0c\u4e5f\u4e0d\u62a5\u9519\u3002</li> </ul> <p>1.1 \u5c5e\u6027\u6ce8\u5165\uff1a@Autowired\u6807\u6ce8\u5728\u5b57\u6bb5\u4e0a \u5b57\u6bb5\u88ab\u8d4b\u503c\u5728\u6784\u9020\u51fd\u6570\u6267\u884c\u4e4b\u540e\uff0c@Autowired\u65b9\u6cd5\u6267\u884c\u4e4b\u524d Text Only<pre><code>@Service\npublic class BookService {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0private BookDao bookDao;\n\n\u00a0\u00a0\u00a0\u00a0public void addBook() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"BookService\u6b63\u5728\u6dfb\u52a0\u56fe\u4e66...\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0bookDao.saveBook();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"BookService\u6dfb\u52a0\u56fe\u4e66\u5b8c\u6210\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>1.2\u00a0@Autowired\u6807\u6ce8\u5728\u6784\u9020\u5668\u4e0a \u5982\u679c\u6709\u591a\u4e2a\u6784\u9020\u5668\uff1a</p> <ul> <li>\u5f53\u6709\u4e00\u4e2a\u6784\u9020\u5668\u7684\u6807\u6ce8\u4e86\u4e00\u4e2arequired=true\u7684@Autowired\uff0c\u90a3\u4e48\u5176\u4ed6\u6784\u9020\u5668\u5219\u90fd\u4e0d\u80fd\u88ab\u6807\u8bb0@Autowired\uff08required=false\u4e5f\u4e0d\u884c\uff09\u3002</li> <li>\u591a\u4e2a\u6784\u9020\u5668\u90fd\u6807\u6ce8\u4e86required=false\u7684@Autowired\uff0c\u90a3\u4e48\u6700\u540e\u4f1a\u9009\u62e9\u80fd\u6210\u529f\u6ce8\u5165\u6700\u591a\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u5982\u679c\u6210\u529f\u6ce8\u5165\u6700\u591a\u7684\u6784\u9020\u5668\u6709\u591a\u4e2a\uff0c\u90a3\u4e48\u4f1a\u9009\u62e9\u5728\u7c7b\u4e2d\u6700\u540e\u58f0\u660e\u7684\u6784\u9020\u5668\u3002</li> <li>\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u6784\u9020\u5668\uff0c\u90a3\u4e48\u65e0\u8bba\u8fd9\u4e2a\u6784\u9020\u5668\u662f\u5426\u6807\u6709@Autowired\u6ce8\u89e3\uff0c\u8fd9\u4e2a\u6784\u9020\u5668\u90fd\u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\u3002\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u90fd\u5e0c\u671b\u7ed9\u7c7b\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u81ea\u52a8\u6ce8\u5165\uff0c\u8fd9\u65f6\u4f60\u53ea\u9700\u8981\u52a0\u4e0a\u4e00\u4e2a\u5168\u53c2\u6570\u6784\u9020\u5668\u5c31\u641e\u5b9a\u4e86\uff0c\u8fde@Autowired\u90fd\u4e0d\u7528\uff0c\u5341\u5206\u65b9\u4fbf\uff0c\u518d\u914d\u4e0alombok\u7684\u6ce8\u89e3\u76f4\u63a5\u5f15\u5165\u5168\u53c2\u6570\u6784\u9020\u5668\uff0c\u66f4\u52a0\u65b9\u4fbf\u3002</li> </ul> Text Only<pre><code>@Service\npublic class UserServiceImpl implements UserService {\n\n\u00a0\u00a0\u00a0\u00a0private UserDao userDao;\n\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0public UserServiceImpl(UserDao userDao) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.userDao = userDao;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>1.3@Autowired\u6807\u6ce8\u5728\u65b9\u6cd5\u4e0a\uff0c\u8be5\u65b9\u6cd5\u7684\u53c2\u6570\u4f1a\u88ab\u6ce8\u5165\uff0c\u5e76\u4e14\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u6784\u9020\u5668\u6267\u884c\u4e4b\u540e\u88abSpring\u81ea\u52a8\u8c03\u7528 \u5178\u578b\u7684\u4f8b\u5b50\u662f\u6807\u6ce8\u5728Setter\u65b9\u6cd5\u4e0a\uff0c\u6807\u6ce8\u4e86\u624d\u6709Setter\u6ce8\u5165\uff08\u4f7f\u7528XML\u548c@Bean\u53ef\u4ee5\u4f7f\u7528autowire\u5c5e\u6027\u76f4\u63a5\u6307\u5b9a\u5f00\u542fSetter\u6ce8\u5165\uff0c\u8fd9\u91cc\u7684\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u4e3aSetter\u65b9\u6cd5\u4e00\u4e2a\u4e00\u4e2a\u6dfb\u52a0\u6ce8\u89e3\uff09\u3002 Text Only<pre><code>@Service\npublic class UserServiceImpl implements UserService {\n\n\u00a0\u00a0\u00a0\u00a0private UserDao userDao;\n\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0public void setUserDao(UserDao userDao) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.userDao = userDao;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>1.4\u00a0@Autowired\u6807\u6ce8\u4e5f\u53ef\u4ee5\u6807\u6ce8\u5728\u65b9\u6cd5\u7684\u53c2\u6570\u4e0a\uff0c\u4f46\u662f\u8fd9\u4e2a\u7279\u6027\u53ea\u5728spring-test\u6a21\u5757\u4e0b\u7684Junit Jupiter\u4e2d\u652f\u6301</p> <p>2\u3001@Qualifier\u6ce8\u89e3 @Autowired\u6ce8\u89e3\u6839\u636e\u7c7b\u578bbyType\u6ce8\u5165\uff0c\u5f53\u5bb9\u5668\u4e2d\u5b58\u5728\u591a\u4e2a\u8be5\u7c7b\u578b\u7684\u5bf9\u8c61\u65f6\u4f1a\u62a5\u9519\uff0c\u4e8e\u662f\u5c31\u9700\u8981@Qualifier\u6307\u5b9aid\u6839\u636eid\u6ce8\u5165\u3002\u52a0\u4e0a@Qualifier\u540e\u4f1a\u76f4\u63a5\u6839\u636eid\u8fdb\u884c\u6ce8\u5165\uff0c\u627e\u4e0d\u5230\u76f4\u63a5\u62a5\u9519\u3002 Text Only<pre><code>@Service\npublic class BookService {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0 \u00a0`@Qualifier(\"bd\")`\n\u00a0\u00a0\u00a0\u00a0private BookDao bookDao;\n}\n</code></pre> @Qualifier\u4e0d\u4ec5\u53ef\u4ee5\u52a0\u4e0a\u5b57\u6bb5\u4e0a\uff0c\u8fd8\u53ef\u4ee5\u52a0\u5728\u65b9\u6cd5\u7684\u53c2\u6570\u4e0a\uff1a Text Only<pre><code>@Service\npublic class UserServiceImpl implements UserService {\n\u00a0\u00a0\u00a0\u00a0private UserDao userDao;\n\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0public void setUserDao(`@Qualifier(\"bd\") UserDao userDao`) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.userDao = userDao;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>3\u3001@Resource\u6ce8\u5165 @Resource\u6ce8\u89e3\u662fJDK\u6269\u5c55\u5305\u4e2d\u7684(JSR-250\u6807\u51c6\u4e2d\u5236\u5b9a\u7684\u6ce8\u89e3\u7c7b\u578b\uff0cJSR\u662fJava\u89c4\u8303\u63d0\u6848\uff09 \uff0c\u6240\u4ee5\u8be5\u6ce8\u89e3\u662f\u6807\u51c6\u6ce8\u89e3\uff0c\u66f4\u52a0\u5177\u6709\u901a\u7528\u6027\u3002@Resource\u6ce8\u89e3\u5c5e\u4e8eJDK\u6269\u5c55\u5305\uff0c\u6240\u4ee5\u4e0d\u5728JDK\u5f53\u4e2d\uff0c\u9700\u8981\u989d\u5916\u5f15\u5165\u4ee5\u4e0b\u4f9d\u8d56\uff08\u5982\u679c\u662fJDK8\u7684\u8bdd\u4e0d\u9700\u8981\u989d\u5916\u5f15\u5165\u4f9d\u8d56\u3002\u9ad8\u4e8eJDK11\u6216\u4f4e\u4e8eJDK8\u9700\u8981\u5f15\u5165\u4ee5\u4e0b\u4f9d\u8d56\u3002\uff09\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;jakarta.annotation&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;jakarta.annotation-api&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;2.1.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> @Resource \u548c @Autowired\u00a0\u4f5c\u7528\u4e00\u6837\uff0c\u90fd\u662f\u5b8c\u6210\u4f9d\u8d56\u6ce8\u5165\u7684\uff0c\u5dee\u522b\u4e3b\u8981\u662f\u5728\u5bb9\u5668\u4e2d\u627e\u5bf9\u8c61\u7684\u6d41\u7a0b\u4e0d\u540c\uff1a</p> <ul> <li>@Resource\u6ce8\u89e3\u9ed8\u8ba4\u5148\u6839\u636e\u7c7b\u578b\u540d\u9996\u5b57\u6bcd\u5c0f\u5199\u4f5c\u4e3aid\u627e\uff0c\u7136\u540e\u518d\u6839\u636e\u53d8\u91cf\u540d\u4f5c\u4e3aid\u627e\uff0c\u6700\u540e\u518d\u6839\u636e\u7c7b\u578b\u627e\u3002</li> <li>@Autowired\u5219\u662f\u76f4\u63a5\u6839\u636e\u7c7b\u578b\u627e\u3002</li> </ul> <p>\u6ce8\u610f\u4e0a\u9762\u7684\u5dee\u5f02\u53ef\u80fd\u968f\u7740Spring\u7684\u7248\u672c\u51fa\u73b0\u53d8\u5316</p> <p><code>\u4e0d\u7ba1\u662f@Resource\u00a0\u8fd8\u662f\u00a0@Autowired\uff0c\u53ea\u8981\u7528\u4e86@Qualifier\u6ce8\u89e3\uff0c\u4e00\u5f8b\u76f4\u63a5\u6309id\u627e\uff0c\u627e\u4e0d\u5230\u76f4\u63a5\u62a5\u9519\u3002</code></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/4-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/","title":"4-\u4ee3\u7406\u6a21\u5f0f","text":"<p> \u7ea6 1441 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 29 \u5206\u949f</p> <p>1\u3001\u9759\u6001\u4ee3\u7406 \u63a5\u53e3 Text Only<pre><code>public interface Calculator {\n\u00a0 \u00a0int add(int i, int j);\n\u00a0 \u00a0int sub(int i, int j);\n\u00a0 \u00a0int mul(int i, int j);\n\u00a0 \u00a0int div(int i, int j);\n}\n</code></pre> \u5b9e\u73b0\u7c7b Text Only<pre><code>public class CalculatorImpl implements Calculator {\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public int add(int i, int j) {\n\u00a0 \u00a0 \u00a0 \u00a0int result = i + j;\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(\"\u65b9\u6cd5\u5185\u90e8 result = \" + result);\n\u00a0 \u00a0 \u00a0 \u00a0return result;\n\u00a0 \u00a0}\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public int sub(int i, int j) {\n\u00a0 \u00a0 \u00a0 \u00a0int result = i - j;\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(\"\u65b9\u6cd5\u5185\u90e8 result = \" + result);\n\u00a0 \u00a0 \u00a0 \u00a0return result;\n\u00a0 \u00a0}\n..........\n}\n</code></pre> \u4e0a\u8ff0\u4ee3\u7801\u5df2\u7ecf\u56fa\u5316\u4e0b\u6765\u4e86\uff0c\u4e0d\u80fd\u6539\u52a8\uff08\u6bd4\u5982\u662f\u5f15\u5165\u7684jar\u5305\uff0c\u53c8\u6216\u8005\u662f\u4e3a\u4e86\u7248\u672c\u517c\u5bb9\uff0c\u65e7\u7684\u4ee3\u7801\u4e0d\u80fd\u6539\u52a8\uff09\uff0c\u4f46\u662f\u73b0\u5728\u9700\u6c42\u662f\u8981\u4e3a\u4e0a\u8ff0\u5b9e\u73b0\u7c7b\u52a0\u4e0a\u67d0\u79cd\u529f\u80fd\uff0c\u6bd4\u5982\u6253\u65e5\u5fd7\u3001\u6743\u9650\u63a7\u5236\u7b49\uff0c\u5728\u4e0d\u6539\u52a8\u539f\u6709\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u600e\u4e48\u5b9e\u73b0\uff1f \u8fd9\u65f6\u53ef\u4ee5\u60f3\u5230\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\u7684\u597d\u5904\u4e86\uff0c\u5373 \u518d\u5199\u4e00\u4e2a\u5b9e\u73b0\u8be5\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\uff0c\u540c\u65f6\u5728\u8be5\u5b9e\u73b0\u7c7b\u4e2d\u6301\u6709Calculator\u7684\u5b9e\u4f8b\u53d8\u91cf\uff1a Text Only<pre><code>public class CalculatorStaticProxy `implements Calculator`{\n\u00a0\u00a0\u00a0\u00a0// \u5c06\u88ab\u4ee3\u7406\u7684\u76ee\u6807\u5bf9\u8c61\u58f0\u660e\u4e3a\u6210\u5458\u53d8\u91cf\n\u00a0\u00a0\u00a0\u00a0`private Calculator target;`\n\n\u00a0\u00a0\u00a0\u00a0public CalculatorStaticProxy(Calculator target) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.target = target;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int add(int i, int j) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u9644\u52a0\u529f\u80fd\u7531\u4ee3\u7406\u7c7b\u4e2d\u7684\u4ee3\u7406\u65b9\u6cd5\u6765\u5b9e\u73b0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] add \u65b9\u6cd5\u5f00\u59cb\u4e86\uff0c\u53c2\u6570\u662f\uff1a\" + i + \",\" + j);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u901a\u8fc7\u76ee\u6807\u5bf9\u8c61\u6765\u5b9e\u73b0\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int addResult = target.add(i, j);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] add \u65b9\u6cd5\u7ed3\u675f\u4e86\uff0c\u7ed3\u679c\u662f\uff1a\" + addResult);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return addResult;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int sub(int i, int j) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u9644\u52a0\u529f\u80fd\u7531\u4ee3\u7406\u7c7b\u4e2d\u7684\u4ee3\u7406\u65b9\u6cd5\u6765\u5b9e\u73b0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] sub \u65b9\u6cd5\u5f00\u59cb\u4e86\uff0c\u53c2\u6570\u662f\uff1a\" + i + \",\" + j);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u901a\u8fc7\u76ee\u6807\u5bf9\u8c61\u6765\u5b9e\u73b0\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int subResult = target.sub(i, j);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] sub \u65b9\u6cd5\u7ed3\u675f\u4e86\uff0c\u7ed3\u679c\u662f\uff1a\" + subResult);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return subResult;\n\u00a0\u00a0\u00a0\u00a0}\n...........\n}\n</code></pre> \u4e4b\u540e\u901a\u8fc7\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8bbf\u95ee\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff1a Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0CalculatorImpl calculatorImpl = new CalculatorImpl();\n\u00a0\u00a0\u00a0\u00a0CalculatorStaticProxy staticProxy = new CalculatorStaticProxy(calculatorImpl);\n\u00a0\u00a0\u00a0\u00a0int res = staticProxy.add(1, 1);\n\u00a0\u00a0\u00a0\u00a0System.out.println(res);\n}\n</code></pre></p> <p>\u8fd9\u5c31\u662f\u9759\u6001\u4ee3\u7406\uff0c\u5f88\u660e\u663e\uff0c\u9759\u6001\u4ee3\u7406\u7684\u52a3\u52bf\u6709\uff1a</p> <ol> <li>\u6bcf\u4e2a\u88ab\u4ee3\u7406\u7684\u65b9\u6cd5\u90fd\u9700\u8981\u91cd\u590d\u540c\u6837\u7684\u4ee3\u7406\u529f\u80fd\uff0c\u5373\u53c8\u5927\u91cf\u7684\u91cd\u590d\u7f16\u7801\u3002</li> <li>\u5982\u679c\u6709\u591a\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u90a3\u4e48\u6bcf\u4e2a\u5b9e\u73b0\u7c7b\u90fd\u9700\u8981\u5199\u76f8\u5e94\u7684\u4ee3\u7406\u7c7b\u3002</li> </ol> <p>2\u3001\u52a8\u6001\u4ee3\u7406 \u52a8\u6001\u4ee3\u7406\u53ef\u4ee5\u89e3\u51b3\u9759\u6001\u4ee3\u7406\u9762\u4e34\u7684\u4e24\u4e2a\u95ee\u9898\uff0c\u52a8\u6001\u4ee3\u7406\u7684\u6838\u5fc3\u6709\u4e24\u70b9\uff0c\u4e00\u662f\u9700\u8981\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210\u4ee3\u7406\u7c7b\u53ca\u5176\u5bf9\u8c61\uff0c\u4e8c\u662f\u4f7f\u7528\u53cd\u5c04\u8c03\u7528\u65b9\u6cd5\u3002JDK\u63d0\u4f9b\u4e86\u52a8\u6001\u4ee3\u7406\u7684\u5b9e\u73b0\u3002</p> <p>\u9996\u5148\u662f\u5b9e\u73b0InvocationHandler\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u662f\u4e00\u4e2a\u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u4f5c\u7528\u5c31\u662f\u5c01\u88c5\u4ee3\u7406\u903b\u8f91\uff0c\u6709\u4e00\u4e2a\u7279\u522b\u7684\u70b9\u662f\uff0c<code>\u9700\u8981\u5411\u63a5\u53e3\u7684\u5b9e\u73b0\u4f20\u9012\u88ab\u4ee3\u7406\u7c7b\u7684\u5bf9\u8c61</code>\uff0c\u56e0\u4e3a\u4ee3\u7406\u903b\u8f91\u7684\u6838\u5fc3\u662f\u8c03\u7528\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u7684\u65b9\u6cd5\u3002 Text Only<pre><code>public class CalculatorLogInvocationHandler implements InvocationHandler {\n\n `Calculator calculator;`\n\n\u00a0\u00a0\u00a0\u00a0public CalculatorLogInvocationHandler(Calculator calculator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.calculator = calculator;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] \" + method.getName() + \" \u65b9\u6cd5\u5f00\u59cb\u4e86\uff0c\u53c2\u6570\u662f\uff1a\" + args[0] + \",\" + args[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object res = `method.invoke(calculator, args); //\u8c03\u7528\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u7684\u65b9\u6cd5`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] \" + method.getName() + \" \u65b9\u6cd5\u7ed3\u675f\u4e86\uff0c\u7ed3\u679c\u662f\uff1a\" + res);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return res;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u901a\u8fc7Proxy.newProxyInstance()\u65b9\u6cd5\u62ff\u5230\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff0c\u4ece\u800c\u5b9e\u73b0\u901a\u8fc7\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8bbf\u95ee\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u3002 Text Only<pre><code>public class CalculatorDynamicProxy {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CalculatorImpl calculatorImpl = new CalculatorImpl();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* `\u628a\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8fd4\u56de\u7ed9\u7528\u6237\uff0c\u4ece\u800c\u5b9e\u73b0\u901a\u8fc7\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8bbf\u95ee\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61`\n `* \u4ee3\u7406\u7c7b\u53ca\u5176\u5bf9\u8c61\u5728\u8fd0\u884c\u65f6\u4ea7\u751f\uff0c\u4ee3\u7406\u7c7b\u548c\u88ab\u4ee3\u7406\u7c7b\u90fd\u5b9e\u73b0\u4e86Calculator\u63a5\u53e3`\n `* \u4ee3\u7406\u7c7b\u91cc\u6bcf\u4e2a\u65b9\u6cd5\u7684\u5b9e\u73b0\u90fd\u76f8\u5f53\u4e8e\u662freturn calculatorLogInvocationHandler.invoke(this, method, args)`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Calculator proxyIns01 = (Calculator) Proxy.newProxyInstance(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0calculatorImpl.getClass().getClassLoader(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0calculatorImpl.getClass().getInterfaces(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new CalculatorLogInvocationHandler(calculatorImpl));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0proxyIns01.add(1, 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u56e0\u4e3a\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u4e5f\u5b9e\u73b0\u4e86Calculator\u63a5\u53e3\uff0c\u6240\u4ee5\u88ab\u4ee3\u7406\u5bf9\u8c61\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u88ab\u4ee3\u7406\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684Lambda\u8868\u8fbe\u5f0f\uff0c\u53d8\u91cfproxyIns01\u88ab\u95ed\u5305\u4e86\uff1a Text Only<pre><code>public class CalculatorDynamicProxy {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CalculatorImpl calculatorImpl = new CalculatorImpl();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u628a\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8fd4\u56de\u7ed9\u7528\u6237\uff0c\u4ece\u800c\u5b9e\u73b0\u901a\u8fc7\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8bbf\u95ee\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u4ee3\u7406\u7c7b\u53ca\u5176\u5bf9\u8c61\u5728\u8fd0\u884c\u65f6\u4ea7\u751f\uff0c\u4ee3\u7406\u7c7b\u548c\u88ab\u4ee3\u7406\u7c7b\u90fd\u5b9e\u73b0\u4e86person\u63a5\u53e3\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u4ee3\u7406\u7c7b\u91cc\u6bcf\u4e2a\u65b9\u6cd5\u7684\u5b9e\u73b0\u90fd\u76f8\u5f53\u4e8e\u662freturn calculatorLogInvocationHandler.invoke(this, method, args)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Calculator proxyIns01 = (Calculator) Proxy.newProxyInstance(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0calculatorImpl.getClass().getClassLoader(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0calculatorImpl.getClass().getInterfaces(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new CalculatorLogInvocationHandler(calculatorImpl));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0proxyIns01.add(1, 1);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"------------------------------------------------------------\");\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u56e0\u4e3a\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u4e5f\u5b9e\u73b0\u4e86Calculator\u63a5\u53e3\uff0c\u6240\u4ee5\u88ab\u4ee3\u7406\u5bf9\u8c61\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u88ab\u4ee3\u7406\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* */\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Calculator proxyIns02 = (Calculator) Proxy.newProxyInstance(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0proxyIns01.getClass().getClassLoader(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0proxyIns01.getClass().getInterfaces(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(proxy, method, args1) -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] \" + method.getName() + \" \u65b9\u6cd5\u5f00\u59cb\u4e86\uff0c\u53c2\u6570\u662f\uff1a\" + args1[0] + \",\" + args1[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object res = method.invoke(proxyIns01, args1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"[\u65e5\u5fd7] \" + method.getName() + \" \u65b9\u6cd5\u7ed3\u675f\u4e86\uff0c\u7ed3\u679c\u662f\uff1a\" + res);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return res;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0proxyIns02.add(1, 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>3\u3001\u603b\u7ed3 \u65e0\u8bba\u662f\u9759\u6001\u4ee3\u7406\u8fd8\u662f\u52a8\u6001\u4ee3\u7406\uff0c\u5728\u5b9e\u73b0\u90fd\u9075\u5faa\uff1a</p> <ul> <li>\u4ee3\u7406\u7c7b\u9700\u8981\u5b9e\u73b0\u88ab\u4ee3\u7406\u7c7b\u6240\u5b9e\u73b0\u7684\u63a5\u53e3\uff08is-a\uff09</li> <li>\u4ee3\u7406\u7c7b\u9700\u8981\u6301\u6709\u88ab\u4ee3\u7406\u7c7b\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff08has-a\uff09</li> </ul> <p>\u4f7f\u7528\u6784\u9020\u5668\u7ed9\u4ee3\u7406\u7c7b\u7c7b\u578b\u6210\u5458\u53d8\u91cf\u8d4b\u503c\uff0c\u90a3\u4e48\u8fd8\u5305\u542buse-a\u7684\u5173\u7cfb\u3002 \u7c7b\u4e4b\u524d\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a </p> <p>\u88c5\u9970\u8005\u6a21\u5f0f\u7684\u7c7b\u4e4b\u524d\u7684\u5173\u7cfb\u4e5f\u662f\u8fd9\u6837\u7684\uff0c\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u4e5f\u5b9e\u73b0\u4e86Calculator\u63a5\u53e3\uff0c\u6240\u4ee5\u88ab\u4ee3\u7406\u5bf9\u8c61\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u88ab\u4ee3\u7406\uff0c\u8fd9\u4e5f\u4f53\u73b0\u4e86\u88c5\u9970\u8005\u7684\u601d\u60f3\u3002 \u88c5\u9970\u8005\u6a21\u5f0f\u548c\u4ee3\u7406\u6a21\u5f0f\u5728\u5b9e\u73b0\u4e0a\u662f\u76f8\u540c\u7684\uff0c\u4ed6\u4fe9\u4e4b\u524d\u7684\u5dee\u5f02\u4e3b\u8981\u4f53\u73b0\u5728\u601d\u60f3\u4e0a\uff1a \u88c5\u9970\u5668\u6a21\u5f0f\u66f4\u5173\u6ce8\u4e3a\u88ab\u88c5\u9970\u7c7b\u589e\u52a0\u529f\u80fd\uff08\u6bd4\u5982JDK\u4e2d\u7684\u7f13\u5b58\u6d41\uff09\uff0c\u800c\u4ee3\u7406\u6a21\u5f0f\u5219\u66f4\u52a0\u5f3a\u8c03\u662f\u5bf9\u8bbf\u95ee\u7684\u7ba1\u63a7\uff0c\u4f7f\u5ba2\u6237\u7aef\u4e0d\u611f\u77e5\u88ab\u4ee3\u7406\u5bf9\u8c61\u7684\u5b58\u5728\u3002\u5728\u5b9e\u73b0\u4e0a\u7684\u4f53\u73b0\u662f\uff0c\u88c5\u9970\u8005\u91cd\u5199\u88ab\u88c5\u9970\u7c7b\u7684\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u65f6\uff0c\u867d\u7136\u88c5\u9970\u7684\u6838\u5fc3\u601d\u60f3\u662f\u76f8\u540c\u7684\uff0c\u4f46\u662f\u6bcf\u4e2a\u65b9\u6cd5\u4ee3\u7801\u5b9e\u73b0\u6709\u5f88\u5927\u7684\u5dee\u522b\uff0c\u6240\u4ee5\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u6709\u5fc5\u8981\u91cd\u5199\uff0c\u800c\u4ee3\u7406\u6a21\u5f0f\u5219\u4e0d\u7136\uff0c\u6240\u4ee5\u4ee3\u7406\u6a21\u5f0f\u53ef\u4ee5\u628a\u4ee3\u7406\u903b\u8f91\u90fd\u5c01\u88c5\u5728InvocationHandler\u63a5\u53e3\u91cc\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/5-AOP/","title":"5-AOP","text":"<p> \u7ea6 2960 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 59 \u5206\u949f</p> <p>\u4e00\u3001AspectJ\u3001CGLIB\u00a0\u548c JDK\u52a8\u6001\u4ee3\u7406\u00a0\u4e09\u8005\u662f\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <ul> <li>AOP\uff08Aspect Orient Programming\uff0c\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff09\u6846\u67b6\u8981\u5305\u542b\u4e24\u90e8\u5206\uff0c\u4e00\u662f\u5b9e\u73b0\u4ee3\u7406\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u662f\u5b9e\u73b0AOP\u601d\u60f3\u7684\u6838\u5fc3\uff1b\u4e8c\u662f\u4f5c\u4e3a\u6846\u67b6\u8981\u4e3a\u7528\u6237\u63d0\u4f9b\u7b80\u4fbf\u7684\u7f16\u7a0b\u6a21\u5f0f\uff0c\u6bd4\u5982\u901a\u8fc7XML\u914d\u7f6e\u6216\u8005\u901a\u8fc7\u6ce8\u89e3\u914d\u7f6e\u3002</li> <li>\u4ee3\u7406\u6a21\u5f0f\uff1a\u4ee3\u7406\u6a21\u5f0f\u5206\u4e3a\u9759\u6001\u4ee3\u7406\u548c\u52a8\u6001\u4ee3\u7406\uff0c\u5176\u4e2d \u9759\u6001 \u548c \u52a8\u6001 \u5206\u522b\u6307\u7684\u662f \u7f16\u8bd1\u65f6 \u548c \u8fd0\u884c\u65f6\uff0c\u5373\u5982\u679c\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u4ee3\u7406\u7c7b\u90a3\u4e48\u5c31\u662f\u9759\u6001\u4ee3\u7406\uff0c\u5982\u679c\u5728\u8fd0\u884c\u65f6\u624d\u751f\u4ea7\u4ee3\u7406\u7c7b\u5219\u79f0\u4e3a\u52a8\u6001\u4ee3\u7406\u3002</li> <li>AspectJ\u4fbf\u662f\u4e00\u4e2aAOP\u6846\u67b6\uff0c\u5373AspectJ\u548cSpring\u00a0AOP\u5404\u81ea\u90fd\u662f\u4e00\u5957\u72ec\u7acb\u7684\u9762\u5411\u5207\u9762\u7f16\u7a0b\u7684\u89e3\u51b3\u65b9\u6848\u3002AspectJ\u7684\u4ee3\u7406\u6a21\u5f0f\u662f\u9759\u6001\u4ee3\u7406\uff0cAspectJ\u5229\u7528\u5b83\u81ea\u5df1\u7684\u7f16\u8bd1\u5668\u5c06\u4ee3\u7406\u903b\u8f91\u7ec7\u5165\uff08weaver\uff09\u5230\u88ab\u4ee3\u7406\u7c7b\u4e2d\uff0c\u6700\u7ec8\u53ea\u751f\u6210\u4e00\u4e2aclass\u6587\u4ef6\u3002\u53c2\u89c1\uff1a https://zhuanlan.zhihu.com/p/426442535 \u4e2d\u7684\u4f8b\u5b50\u3002\u800cSpring\u4f7f\u7528\u7684\u662fCGLIB\u00a0\u548c JDK\u52a8\u6001\u4ee3\u7406\u5b9e\u73b0\u7684\u4ee3\u7406\u6a21\u5f0f\uff0c\u5b83\u4fe9\u90fd\u662f\u52a8\u6001\u4ee3\u7406\uff0c\u5e76\u6ca1\u6709\u4f7f\u7528AspectJ\u7684\u9759\u6001\u4ee3\u7406\u3002\u90a3\u4e3a\u4ec0\u4e48Spring\u4e2d\u4f1a\u51fa\u73b0AspectJ\u7684\u5b57\u6837\u5462\uff0c\u6bd4\u5982\u5bfc\u5305\u3001\u4f7f\u7528@AspectJ\u5b9a\u4e49\u5207\u9762\u7c7b\u7684\u65f6\u5019\uff1f\u8fd9\u662f\u56e0\u4e3a\u5b9e\u73b0AOP\u6846\u67b6\u7684\u7b2c\u4e8c\u4e2a\u8981\u70b9\uff0c\u5373\u4e3a\u7528\u6237\u63d0\u4f9b\u7f16\u7a0b\u6a21\u5f0f\uff0cSpring\u5e94\u8be5\u662f\u5b8c\u5168\u53c2\u8003\u4e86AspectJ\uff0c\u6bd4\u5982\u4f7f\u7528AspectJ\u7684Annotation\u5b9a\u4e49\u5207\u9762(Aspect)\u3001\u5207\u5165\u70b9(PointCut)\u7b49\u3002</li> <li>\u7531\u4e8eSpring AOP\u662f\u57fa\u4e8e\u52a8\u6001\u4ee3\u7406\u6765\u5b9e\u73b0\u7684\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u9700\u8981\u751f\u6210\u4ee3\u7406\u5b9e\u4f8b\uff0c\u5728\u65b9\u6cd5\u8c03\u7528\u4e0a\u4e5f\u4f1a\u589e\u52a0\u6808\u7684\u6df1\u5ea6\uff0c\u800cAspectJ\u5728\u5b9e\u9645\u8fd0\u884c\u4e4b\u524d\u5c31\u5b8c\u6210\u4e86\u7ec7\u5165\uff0c\u5b83\u751f\u6210\u7684\u7c7b\u662f\u6ca1\u6709\u989d\u5916\u8fd0\u884c\u65f6\u5f00\u9500\u7684\uff0c\u6240\u4ee5Spring AOP\u7684\u6027\u80fd\u8f83AspectJ\u7684\u5dee\u3002</li> <li>Spring\u00a0AOP\u4e0eCGLIB\u00a0\u548c JDK\u52a8\u6001\u4ee3\u7406\u7684\u5173\u7cfb\uff1a<ul> <li>Spring\u00a0AOP\u4f7f\u7528CGLIB\u00a0\u548c JDK\u52a8\u6001\u4ee3\u7406\u5b9e\u73b0\u4e86\u4ee3\u7406\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4f7f\u7528JDK\u52a8\u6001\u4ee3\u7406\uff08SpringBoot2.x\u9ed8\u8ba4\u4f7f\u7528cglib\u52a8\u6001\u4ee3\u7406\uff09\u3002</li> <li> \u65f6\uff0c\u5982\u679c\u76ee\u6807\u7c7b\u6709\u5b9e\u73b0\u63a5\u53e3\uff0c\u5219\u4f7f\u7528JDK\u52a8\u6001\u4ee3\u7406\uff0c\u53cd\u4e4b\u5219\u4f7f\u7528cglib\u52a8\u6001\u4ee3\u7406\u3002 \u65f6\uff0c\u76f4\u63a5\u4f7f\u7528cglib\u52a8\u6001\u4ee3\u7406\u3002</li> </ul> </li> </ul> <p>\u4e8e\u662f\uff0c\u5728Spring\u4e2d\uff0c\u5982\u679c\u4e00\u4e2a\u7c7b\u88ab\u5207\u4e86\uff08\u76ee\u6807\u7c7b\uff09\uff0c\u90a3\u4e48IOC\u5bb9\u5668\u4e2d\u5c31\u6ca1\u6709\u8fd9\u4e2a\u7c7b\u7684\u5bf9\u8c61\u4e86\uff0c\u6709\u7684\u53ea\u662f\u8fd9\u4e2a\u7c7b\u7684\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u4ee3\u7406\u7c7b\u5bf9\u8c61\u662f\uff1a \u2460 \u5982\u679c\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u4e00\u4e2a\u63a5\u53e3\uff0c\u90a3\u4e48\u4ee3\u7406\u7c7b\u5bf9\u8c61\u5c31\u662f\u8fd9\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\uff0c\u6240\u4ee5\u4e0d\u80fd\u901a\u8fc7\u8fd9\u4e2a\u7c7b\u7684\u7c7b\u578b\u62ff\u5230\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff0c\u53ea\u80fd\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u7684\u7c7b\u578b\u62ff\u5230\u3002 \u2461 \u5982\u679c\u8fd9\u4e2a\u7c7b\u6ca1\u6709\u5b9e\u73b0\u63a5\u53e3\uff0c\u90a3\u4e48\u4ee3\u7406\u7c7b\u5bf9\u8c61\u5c31\u662f\u8fd9\u4e2a\u7c7b\u7684\u5b50\u7c7b\uff0c\u6240\u4ee5\u80fd\u901a\u8fc7\u8fd9\u4e2a\u7c7b\u7684\u7c7b\u578b\u62ff\u5230\u4ee3\u7406\u7c7b\u5bf9\u8c61\u3002 \u8fd9\u4e2a\u4ee3\u7406\u7c7b\u5bf9\u8c61\u5728\u5bb9\u5668\u4e2d\u7684id\u662f\u88ab\u5207\u7684\u7c7b\uff08\u88ab\u4ee3\u7406\u7c7b\uff09\u7684\u7c7b\u540d\u9996\u5b57\u6bcd\u5c0f\u5199\uff0c\u6240\u4ee5\u901a\u8fc7\u76ee\u6807\u7c7b\u7684id\u80af\u5b9a\u80fd\u83b7\u53d6\u5230\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff0c\u7136\u540e\u518d\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u3002</p> <ul> <li>CGLIB\u00a0\u548c JDK\u52a8\u6001\u4ee3\u7406\u00a0\u90fd\u662f\u52a8\u6001\u4ee3\u7406\uff0c\u5b83\u4fe9\u5728\u5b9e\u73b0\u4e0a\u7684\u533a\u522b\u662f\uff0cCGLIB\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210\u88ab\u4ee3\u7406\u7c7b\u7684\u5b50\u7c7b\uff0c\u91cd\u5199\u88ab\u4ee3\u7406\u7c7b\u7684\u65b9\u6cd5\uff0c\u800cJDK\u52a8\u6001\u4ee3\u7406\u5219\u662f\u5b9e\u73b0\u88ab\u4ee3\u7406\u7c7b\u5b9e\u73b0\u7684\u63a5\u53e3\uff1b\u5171\u540c\u70b9\u662f\u4ee3\u7406\u7c7b\u90fd\u8981\u62ff\u5230\u88ab\u4ee3\u7406\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u56e0\u4e3a\u6838\u5fc3\u7684\u4e1a\u52a1\u903b\u8f91\u8fd8\u662f\u8981\u4ea4\u7ed9\u76ee\u6807\u7c7b\u5bf9\u8c61\u6765\u6267\u884c\uff08\u90fd\u9700\u8981\u4fdd\u6301has-a\u7684\u5173\u7cfb\uff0c\u53c2\u89c1\u00a0 https://juejin.cn/post/7042484603365359646  \u4e2d\u4f7f\u7528cglib\u751f\u4ea7\u4ee3\u7406\u7684\u4f8b\u5b50\uff09\u3002</li> <li>CGLIB\u52a8\u6001\u4ee3\u7406\u65e0\u6cd5\u4ee3\u7406\u7684\u65b9\u6cd5\uff1a<ul> <li>\u56e0\u4e3afinal\u4fee\u9970\u7684\u7c7b\u548c\u65b9\u6cd5\u4e0d\u80fd\u88ab\u7ee7\u627f\uff0c\u6240\u4ee5CGLIB\u4e0d\u80fd\u4ee3\u7406final\u4fee\u9970\u7684\u7c7b\u548c\u65b9\u6cd5\u3002</li> <li>private\u65b9\u6cd5\u53ef\u4ee5\u88ab\u7ee7\u627f\uff0c\u4f46\u662fCGLIB\u4f9d\u7136\u4e0d\u80fd\u4ee3\u7406private\u65b9\u6cd5\uff0c\u539f\u56e0\u662fprivate\u65b9\u6cd5\u6ca1\u6709\u591a\u6001\u3002\uff08\u5b50\u7c7b\u53ef\u4ee5\u91cd\u5199\u7236\u7c7b\u7684private\u65b9\u6cd5\uff0c\u5e76\u4e14\u5b50\u7c7b\u91cd\u5199\u7684\u65b9\u6cd5\u662f\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u88ab\u4ee3\u7406\u7c7b\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u800c\u53cd\u5c04\u662f\u53ef\u4ee5\u8bbf\u95eeprivate\u7684\uff0c\u6240\u4ee5CGLIB\u4e0d\u80fd\u4ee3\u7406private\u65b9\u6cd5\u7684\u539f\u56e0\u5e76\u4e0d\u662f\u56e0\u4e3a\u5b50\u7c7b\u65e0\u6cd5\u8bbf\u95ee\u7236\u7c7b\u7684private\u65b9\u6cd5\uff0c\u771f\u6b63\u7684\u539f\u56e0\u662f\u56e0\u4e3aprivate\u65b9\u6cd5\u6ca1\u6709\u591a\u6001\uff0cCGLIB\u52a8\u6001\u4ee3\u7406\u7684\u539f\u7406\u662f\u751f\u6210\u88ab\u4ee3\u7406\u7c7b\u7684\u5b50\u7c7b\uff0c\u8fd9\u4e2a\u5b50\u7c7b\u7684\u5bf9\u8c61\u4f1a\u88ab\u8d4b\u503c\u7ed9\u7236\u7c7b\u7684\u5f15\u7528\uff0c\u5982\u679c\u65b9\u6cd5\u6ca1\u6709\u591a\u6001\uff0c\u90a3\u4e48\u6700\u7ec8\u8c03\u7528\u4e0d\u5230\u4ee3\u7406\u7c7b\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u4ece\u800c\u65e0\u6cd5\u5b9e\u73b0\u4ee3\u7406\u7684\u76ee\u7684\u3002\uff09</li> <li>static\u65b9\u6cd5\u6ca1\u6709\u7ee7\u627f\u4e00\u8bf4\uff0c\u4e5f\u5c31\u6ca1\u6709\u591a\u6001\uff0c\u6240\u4ee5CGLIB\u4e0d\u80fd\u4ee3\u7406static\u65b9\u6cd5\u3002</li> </ul> </li> </ul> Text Only<pre><code>public class AClass {\n\u00a0\u00a0\u00a0\u00a0private void print() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"A\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0static public void staticPrint() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"static A\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0AClass a = new BClass();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a.print(); //\u8f93\u51fa A \uff0c\u8868\u793aprivate\u53ef\u4ee5\u88ab\u7ee7\u627f\uff0c\u4f46\u662f\u6ca1\u6709\u591a\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**************************************************/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a.staticPrint(); //\u8f93\u51fa A\uff0c\u9759\u6001\u65b9\u6cd5\u672c\u6765\u5c31\u6ca1\u6709\u7ee7\u627f\u4e00\u8bf4\uff0c\u6240\u4ee5\u66f4\u52a0\u6ca1\u6709\u591a\u6001\n\u00a0\u00a0\u00a0\u00a0}\n}\nclass BClass extends AClass {\n\u00a0\u00a0\u00a0\u00a0private void print() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"B\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0static public void staticPrint() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"static B\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <ul> <li>JDK\u52a8\u6001\u4ee3\u7406\u65e0\u6cd5\u4ee3\u7406\u7684\u65b9\u6cd5\uff1a<ul> <li>JDK\u52a8\u6001\u4ee3\u7406\u53ea\u80fd\u4ee3\u7406\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u90fd\u662fpublic\u7684\uff0c\u6240\u4ee5JDK\u52a8\u6001\u4ee3\u7406\u53ea\u80fd\u4ee3\u7406public\u65b9\u6cd5\u3002</li> <li>\u63a5\u53e3\u4e2d\u4e5f\u53ef\u4ee5\u6709static\u65b9\u6cd5\uff0c\u540c\u6837\u56e0\u4e3astatic\u65b9\u6cd5\u6ca1\u6709\u591a\u6001\uff0c\u6240\u4ee5JDK\u52a8\u6001\u4ee3\u7406\u4e0d\u80fd\u4ee3\u7406static\u65b9\u6cd5\u3002</li> </ul> </li> <li>AspectJ\u662f\u5728\u7f16\u8bd1\u9636\u6bb5\u5411\u88ab\u4ee3\u7406\u7c7b\u4e2d\u7ec7\u5165\u4ee3\u7801\uff0c\u6240\u4ee5AspectJ\u9759\u6001\u4ee3\u7406\u6ca1\u6709\u4ee5\u4e0a\u7684\u9650\u5236\uff0c\u4ec0\u4e48\u6837\u7684\u65b9\u6cd5\u90fd\u53ef\u4ee5\u4ee3\u7406\u3002AspectJ\u53ef\u4ee5\u505aSpring AOP\u5e72\u4e0d\u4e86\u7684\u4e8b\u60c5\uff0c\u5b83\u662fAOP\u7f16\u7a0b\u7684\u5b8c\u5168\u89e3\u51b3\u65b9\u6848\uff0cAspectJ\u652f\u6301\u6240\u6709\u5207\u5165\u70b9\uff0c\u4e0d\u4ec5\u4ec5\u662f\u65b9\u6cd5\u7ec7\u5165\u3002</li> </ul> <p>\u4e8c\u3001\u57fa\u4e8e\u6ce8\u89e3\u7684AOP 1\u3001\u57fa\u4e8e\u6ce8\u89e3\u7684AOP\u6b65\u9aa4\uff1a 1.\u5f00\u542f\u57fa\u4e8e\u6ce8\u89e3\u7684AOP\u6a21\u5f0f Text Only<pre><code>&lt;!-- \u5f00\u542f\u57fa\u4e8e\u6ce8\u89e3\u7684AOP\u6a21\u5f0f --&gt;\n&lt;aop:aspectj-autoproxy/&gt;\n</code></pre> 2.\u4f7f\u7528@Aspect\u6ce8\u89e3\u6ce8\u518c\u5207\u9762\u7c7b\uff0c\u5e76\u4f7f\u7528@Component\u6ce8\u89e3\u5c06\u5207\u9762\u7c7b\u6ce8\u5165\u5230IOC\u5bb9\u5668\u4e2d 3.\u914d\u7f6e\u5207\u9762\u7c7b\u4e2d\u901a\u77e5\u65b9\u6cd5\u7684\u5207\u5165\u70b9 Text Only<pre><code>@Aspect\n@Order(1)\n@Component\npublic class LogUtils {\n\n\u00a0\u00a0\u00a0\u00a0@Before(\"execution(public * aop.CalculatorImpl.*(int, int))\")\n\u00a0\u00a0\u00a0\u00a0public void before(JoinPoint joinPoint) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object[] args = joinPoint.getArgs();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u62ff\u5230\u76ee\u6807\u65b9\u6cd5\u7684\u65b9\u6cd5\u7b7e\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Signature signature = joinPoint.getSignature();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String name = signature.getName();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"==\u524d\u7f6e\u901a\u77e5 @Before\uff1a\u8c03\u7528\" + name + \"\uff0c\u53c2\u6570\uff1a\" + Arrays.toString(args)+ \"==\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* @AfterReturning\u7684 returning\u5c5e\u6027 \u6307\u660e\u7528\u4e8e\u63a5\u6536\u76ee\u6807\u65b9\u6cd5\u8fd4\u56de\u503c\u7684\u53c2\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u8fd9\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u8981\u5f80\u5927\u4e86\u5199\uff0c\u4e0d\u7136\u4e0d\u80fd\u63a5\u6536\uff0c\u6240\u4ee5\u662fObject\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@AfterReturning(value = \"execution(public * aop.CalculatorImpl.*(int, int))\", returning = \"result\")\n\u00a0\u00a0\u00a0\u00a0public void afterReturn(JoinPoint joinPoint, Object result) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Signature signature = joinPoint.getSignature();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String name = signature.getName();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"==\u8fd4\u56de\u901a\u77e5 @AfterReturn\uff1a\u8c03\u7528\" + name + \"\uff0c\u7ed3\u679c\uff1a\" + result+ \"==\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* @AfterThrowing throwing\u5c5e\u6027 \u6307\u660e\u7528\u4e8e\u63a5\u6536\u76ee\u6807\u65b9\u6cd5\u629b\u51fa\u5f02\u5e38\u7684\u53c2\u6570\uff0c\u53ea\u662f\u63a5\u6536\u5f02\u5e38\uff0c\u5e76\u4e0d\u4f1a\u541e\u6389\u5f02\u5e38\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5f02\u5e38\u7684\u7c7b\u578b\u5f80\u5927\u4e86\u5199\uff0c\u4e0d\u7136\u4e0d\u80fd\u63a5\u6536\uff0c\u6240\u4ee5\u662fException\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@AfterThrowing(value = \"execution(public * aop.CalculatorImpl.*(int, int))\", throwing = \"e\")\n\u00a0\u00a0\u00a0\u00a0public void afterThrowing(JoinPoint joinPoint, Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String name = joinPoint.getSignature().getName();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"==\u5f02\u5e38\u901a\u77e5 @AfterThrowing\uff1a\u8c03\u7528\" + name + \"\uff0c\u5f02\u5e38\uff1a\" + e+ \"==\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@After(\"execution(public * aop.CalculatorImpl.*(int, int))\")\n\u00a0\u00a0\u00a0\u00a0public void after(JoinPoint joinPoint) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String name = joinPoint.getSignature().getName();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"==\u540e\u7f6e\u901a\u77e5 @After\uff1a\u8c03\u7528\" + name + \"\uff0c\u7ed3\u675f\uff01==\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Around(\"execution(public * aop.CalculatorImpl.*(int, int))\")\n\u00a0\u00a0\u00a0\u00a0public Object aroundNotice(ProceedingJoinPoint proceedingJoinPoint) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object result = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"===\u73af\u7ed5\u901a\u77e5\u524d\u7f6e===\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object[] args = proceedingJoinPoint.getArgs();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7b49\u540c\u4e8e\u52a8\u6001\u4ee3\u7406\u4e2d\u7684 method.invoke(object, args); \u5c31\u662f\u8c03\u7528\u76ee\u6807\u65b9\u6cd5\uff0c\u653e\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//`\u53ea\u6709\u73af\u7ed5\u901a\u77e5\u653e\u884c\u4ee5\u540e\uff0c\u524d\u7f6e\u901a\u77e5\u3001\u8fd4\u56de\u901a\u77e5\u3001\u5f02\u5e38\u901a\u77e5\u548c\u540e\u7f6e\u901a\u77e5\u624d\u4f1a\u6267\u884c`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result = proceedingJoinPoint.proceed(args);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"===\u73af\u7ed5\u901a\u77e5\u8fd4\u56de===\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Throwable throwable) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"===\u73af\u7ed5\u901a\u77e5\u5f02\u5e38===\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throwable.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"===\u73af\u7ed5\u901a\u77e5\u540e\u7f6e===\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u5982\u679c\u73af\u7ed5\u901a\u77e5\u8fd4\u56de\u503c\u662fnull\uff0c\u5e76\u4e14\u76ee\u6807\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u63a5\u6536null\uff0c\u6240\u4ee5\u5c31\u4f1a\u629b\u4e0b\u9762\u7684\u5f02\u5e38\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* org.springframework.aop.AopInvocationException: Null return value from advice does not match primitive return type for:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return result;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u540d\u8bcd\u89e3\u91ca\uff1a</p> <ul> <li>\u5207\u9762\u7c7b\uff08Aspect\uff09\uff1a\u5207\u9762\u7c7b\u4e2d\u7684\u4e00\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u4ee3\u7406\u4e00\u7c7b\u65b9\u6cd5\uff0c\u6bcf\u4e2a\u88ab\u4ee3\u7406\u7684\u65b9\u6cd5\u662f\u4e00\u4e2a\u70b9\uff0c\u4e8e\u662f\u5207\u9762\u7c7b\u4e2d\u7684\u4e00\u4e2a\u65b9\u6cd5\u90fd\u53ef\u4ee5\u88ab\u770b\u4f5c\u662f\u4e00\u6761\u7ebf\uff0c\u4e00\u4e2a\u5207\u9762\u7c7b\u4e2d\u6709\u5f88\u591a\u8fd9\u6837\u7684\u7ebf\uff0c\u4e8e\u662f\u4fbf\u7ec4\u6210\u4e86\u9762\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u79f0\u4e3a\u5207\u9762\u7c7b\u3002</li> <li>\u5207\u5165\u70b9\uff08Pointcut\uff09\uff1a\u5728\u9762\u4e0a\u753b\u4e00\u6761\u7ebf\u662f\u4ece\u4e00\u4e2a\u70b9\u5f00\u59cb\u7684\uff0c\u8fd9\u4e2a\u70b9\u88ab\u79f0\u4e3a\u5207\u5165\u70b9\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u8868\u8fbe\u5f0f\u6765\u4e32\u8054\u8fd9\u6761\u7ebf\u4e0a\u7684\u6240\u6709\u70b9\u3002</li> <li>\u8fde\u63a5\u70b9\uff08JoinPoint\uff09\uff1a\u8fd9\u6761\u7ebf\u4e0a\u7684\u6bcf\u4e00\u70b9\u5c31\u662f\u4e00\u4e2a\u8fde\u63a5\u70b9\uff0c\u4e5f\u5c31\u662f\u88ab\u4ee3\u7406\u7684\u65b9\u6cd5\u3002</li> <li>\u901a\u77e5\uff08advice\uff09\uff1a\u6307\u5207\u9762\u7c7b\u4e2d\u7684\u65b9\u6cd5\u3002</li> </ul> <p>\u591a\u4e2a\u5207\u9762\u5207\u540c\u4e00\u4e2a\u76ee\u6807\u65b9\u6cd5\u65f6\uff0c\u591a\u4e2a\u5207\u9762\u6267\u884c\u7684\u987a\u5e8f\uff1a\u5207\u9762\u7c7b\u9ed8\u8ba4\u4ee5\u7c7b\u540d\u7684\u6392\u5e8f\uff0c\u7c7b\u540d\u5c0f\u7684\u4f18\u5148\u7ea7\u9ad8\uff0c\u8d8a\u9760\u8fd1\u5916\u5c42\uff1b\u53ef\u4ee5\u4f7f\u7528@Order()\u6ce8\u89e3\u4fee\u6539\uff0cvalue\u7684\u503c\u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u9ed8\u8ba4Integer.MAX_VALUE\uff0c\u5373\u6700\u540e\u6267\u884c\u3002 </p> <p>2\u3001\u4e94\u79cd\u901a\u77e5\uff1a</p> <ol> <li>@Before\uff1a\u524d\u7f6e\u901a\u77e5</li> <li>@AfterReturning\uff1a\u8fd4\u56de\u901a\u77e5</li> <li>@AfterThrowing\uff1a\u5f02\u5e38\u901a\u77e5</li> <li>@After\uff1a\u540e\u7f6e\u901a\u77e5</li> <li>@Around\uff1a\u73af\u7ed5\u901a\u77e5</li> </ol> <p>\u540c\u4e00\u4e2a\u5207\u9762\u91cc\u901a\u77e5\u65b9\u6cd5\u6267\u884c\u7684\u987a\u5e8f\uff1a Text Only<pre><code>try{\n\u00a0\u00a0\u00a0\u00a0--\u73af\u7ed5\u901a\u77e5\u524d\u7f6e--\n------------------------------\n\u00a0\u00a0\u00a0try{\n\u00a0 \u00a0 \u00a0 \u00a0 @Before\uff1a\u524d\u7f6e\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u76ee\u6807\u65b9\u6cd5\n\u00a0 \u00a0 \u00a0 \u00a0 @AfterReturning\uff1a\u8fd4\u56de\u901a\u77e5\n\u00a0\u00a0\u00a0} catch {\n\u00a0 \u00a0 \u00a0 \u00a0 @AfterThrowing\uff1a\u5f02\u5e38\u901a\u77e5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\uff08\u628a\u5f02\u5e38\u91cd\u65b0\u629b\u51fa\uff09\n\u00a0\u00a0\u00a0} finally {\n\u00a0 \u00a0 \u00a0 \u00a0 @After\uff1a\u540e\u7f6e\u901a\u77e5\n\u00a0\u00a0\u00a0}\n-------------------------------\n\u00a0\u00a0\u00a0--\u73af\u7ed5\u901a\u77e5\u8fd4\u56de\u540e\u7f6e--\n} catch {\n\u00a0\u00a0\u00a0--\u73af\u7ed5\u901a\u77e5\u5f02\u5e38--\n} finally {\n\u00a0\u00a0\u00a0--\u73af\u7ed5\u901a\u77e5\u540e\u7f6e--\n}\n</code></pre></p> <p>3\u3001\u5207\u5165\u70b9\u8868\u8fbe\u5f0f\u8bed\u6cd5  \u5207\u5165\u70b9\u8868\u8fbe\u5f0f\u7684\u5199\u6cd5\uff1a execution(\"\u76ee\u6807\u65b9\u6cd5\u7684\u58f0\u660e\") \u901a\u914d\u7b26 * \uff1a</p> <ul> <li>\u7528\u201c*\u201d\u53f7\u4ee3\u66ff\u201c\u6743\u9650\u4fee\u9970\u7b26\u201d\u548c\u201c\u8fd4\u56de\u503c\u201d\u90e8\u5206\u8868\u793a\u201c\u6743\u9650\u4fee\u9970\u7b26\u201d\u548c\u201c\u8fd4\u56de\u503c\u201d\u4e0d\u9650</li> <li>\u5728\u5305\u540d\u7684\u90e8\u5206\uff0c\u4e00\u4e2a\u201c*\u201d\u53f7\u53ea\u80fd\u4ee3\u8868\u5305\u7684\u5c42\u6b21\u7ed3\u6784\u4e2d\u7684\u4e00\u5c42\uff0c\u8868\u793a\u8fd9\u4e00\u5c42\u662f\u4efb\u610f\u7684\uff0c\u4f8b\u5982 execution(public int org.example.*.aop.CalculatorImpl.*(*, int))</li> <li>\u5728\u7c7b\u540d\u7684\u90e8\u5206\uff0c\u7c7b\u540d\u90e8\u5206\u6574\u4f53\u7528\u201c*\u201d\u53f7\u4ee3\u66ff\uff0c\u8868\u793a\u7c7b\u540d\u4efb\u610f\uff0c\u4f8b\u5982 execution(public int org.example.aop.*.*(*, int))</li> <li>\u5728\u7c7b\u540d\u7684\u90e8\u5206\uff0c\u53ef\u4ee5\u4f7f\u7528\u201c*\u201d\u53f7\u4ee3\u66ff\u7c7b\u540d\u7684\u4e00\u90e8\u5206\uff0c\u4f8b\u5982 *Service \u5339\u914d\u6240\u6709\u540d\u79f0\u4ee5Service\u7ed3\u5c3e\u7684\u7c7b\u6216\u63a5\u53e3</li> <li>\u5728\u65b9\u6cd5\u540d\u90e8\u5206\uff0c\u53ef\u4ee5\u4f7f\u7528\u201c*\u201d\u53f7\u8868\u793a\u65b9\u6cd5\u540d\u4efb\u610f\uff0c\u4f8b\u5982\u00a0execution(public int org.example.aop.CalculatorImpl.*(*, int))</li> <li>\u5728\u65b9\u6cd5\u540d\u90e8\u5206\uff0c\u53ef\u4ee5\u4f7f\u7528\u201c*\u201d\u53f7\u4ee3\u66ff\u65b9\u6cd5\u540d\u7684\u4e00\u90e8\u5206\uff0c\u4f8b\u5982 *Operation \u5339\u914d\u6240\u6709\u65b9\u6cd5\u540d\u4ee5Operation\u7ed3\u5c3e\u7684\u65b9\u6cd5</li> </ul> <p>\u901a\u914d\u7b26 .. \uff1a</p> <ul> <li>\u5728\u5305\u540d\u7684\u90e8\u5206\uff0c\u4f7f\u7528\u201c..\u201d\u8868\u793a\u5305\u540d\u4efb\u610f\u3001\u5305\u7684\u5c42\u6b21\u6df1\u5ea6\u4efb\u610f\uff0c\u4f8b\u5982 execution(public int aop..CalculatorImpl.*(..))</li> <li>\u5728\u65b9\u6cd5\u53c2\u6570\u5217\u8868\u90e8\u5206\uff0c\u4f7f\u7528(..)\u8868\u793a\u53c2\u6570\u5217\u8868\u4efb\u610f</li> <li>\u5728\u65b9\u6cd5\u53c2\u6570\u5217\u8868\u90e8\u5206\uff0c\u4f7f\u7528(int, ..)\u8868\u793a\u53c2\u6570\u5217\u8868\u4ee5\u4e00\u4e2aint\u7c7b\u578b\u7684\u53c2\u6570\u5f00\u5934</li> </ul> <p>\u5728\u65b9\u6cd5\u53c2\u6570\u5217\u8868\u90e8\u5206\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c\u5bf9\u5e94\u7684\u5305\u88c5\u7c7b\u578b\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4f8b\u5982\u5207\u5165\u70b9\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528 int \u548c\u5b9e\u9645\u65b9\u6cd5\u4e2d Integer \u662f\u4e0d\u5339\u914d\u7684</p> <p>4\u3001\u91cd\u7528\u5207\u5165\u70b9\u8868\u8fbe\u5f0f 1.\u968f\u4fbf\u58f0\u660e\u4e00\u4e2a\u7a7a\u5b9e\u73b0\u7684void\u65b9\u6cd5\uff0c\u4f7f\u7528 @Pointcut \u6ce8\u89e3 Text Only<pre><code>@Pointcut(\"execution(* com.atguigu.aop.annotation.*.*(..))\")\npublic void pointCut(){}\n</code></pre> 2.\u5728\u540c\u4e00\u4e2a\u5207\u9762\u4e2d\u4f7f\u7528 Text Only<pre><code>@Before(\"pointCut()\")\npublic void beforeMethod(JoinPoint joinPoint){\n}\n</code></pre> 3.\u5728\u4e0d\u540c\u5207\u9762\u4e2d\u4f7f\u7528 Text Only<pre><code>@Before(\"com.atguigu.aop.CommonPointCut.pointCut()\")\npublic void beforeMethod(JoinPoint joinPoint) {\n}\n</code></pre></p> <p>5\u3001\u83b7\u53d6\u8fde\u63a5\u70b9\u7684\u4fe1\u606f 1.\u8fde\u63a5\u70b9\u662f\u6307\u88ab\u4ee3\u7406\u7684\u65b9\u6cd5\uff0c\u5728\u901a\u77e5\u65b9\u6cd5\u4e0aJoinPoint\u7c7b\u578b\u7684\u53c2\u6570\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u8fde\u63a5\u70b9\u7684\u4fe1\u606f\u3002 Text Only<pre><code>@Before(\"execution(public int com.atguigu.aop.annotation.CalculatorImpl.*(..))\")\npublic void beforeMethod(JoinPoint joinPoint){\n\u00a0 \u00a0 \u00a0//\u62ff\u5230\u76ee\u6807\u65b9\u6cd5\u7684\u65b9\u6cd5\u7b7e\u540d\n\u00a0 \u00a0 \u00a0Signature signature = joinPoint.getSignature();\n\u00a0 \u00a0 \u00a0String methodName = signature.getName();\n\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u76ee\u6807\u65b9\u6cd5\u5230\u7684\u5b9e\u53c2\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0String args = Arrays.toString(joinPoint.getArgs());\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"Logger--&gt;\u524d\u7f6e\u901a\u77e5\uff0c\u65b9\u6cd5\u540d\uff1a\"+methodName+\"\uff0c\u53c2\u6570\uff1a\"+args);\n}\n</code></pre></p> <p>2.\u83b7\u53d6\u76ee\u6807\u65b9\u6cd5\u7684\u8fd4\u56de\u503c @AfterReturning\u4e2d\u7684\u5c5e\u6027returning\u7528\u6765\u6307\u660e\u8981\u5c06\u76ee\u6807\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u8d4b\u503c\u7ed9\u901a\u77e5\u65b9\u6cd5\u7684\u54ea\u4e2a\u53c2\u6570\u3002\u8fd9\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u8981\u5f80\u5927\u4e86\u5199\uff0c\u4e0d\u7136\u4e0d\u80fd\u63a5\u6536\uff0c\u6240\u4ee5\u662fObject\u3002 Text Only<pre><code>@AfterReturning(value = \"execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))\", returning = \"result\")\npublic void afterReturningMethod(JoinPoint joinPoint, Object result){\n\u00a0\u00a0\u00a0\u00a0String methodName = joinPoint.getSignature().getName();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"Logger--&gt;\u8fd4\u56de\u901a\u77e5\uff0c\u65b9\u6cd5\u540d\uff1a\"+methodName+\"\uff0c\u7ed3\u679c\uff1a\"+result);\n}\n</code></pre></p> <p>3.\u83b7\u53d6\u76ee\u6807\u65b9\u6cd5\u7684\u5f02\u5e38 @AfterThrowing\u4e2d\u7684\u5c5e\u6027throwing\u7528\u6765\u6307\u660e\u8981\u5c06\u76ee\u6807\u65b9\u6cd5\u7684\u5f02\u5e38\u8d4b\u503c\u7ed9\u901a\u77e5\u65b9\u6cd5\u7684\u54ea\u4e2a\u53c2\u6570\u3002\u5f02\u5e38\u7684\u7c7b\u578b\u5f80\u5927\u4e86\u5199\uff0c\u4e0d\u7136\u4e0d\u80fd\u63a5\u6536\uff0c\u6240\u4ee5\u662fException\u3002 Text Only<pre><code>@AfterThrowing(value = \"execution(* com.atguigu.aop.annotation.CalculatorImpl.*(..))\", throwing = \"e\")\npublic void afterThrowing(JoinPoint joinPoint, Exception e) {\n\u00a0\u00a0\u00a0\u00a0String name = joinPoint.getSignature().getName();\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"==\u5f02\u5e38\u901a\u77e5 @AfterThrowing\uff1a\u8c03\u7528\" + name + \"\uff0c\u5f02\u5e38\uff1a\" + e+ \"==\");\n}\n</code></pre></p> <p>\u4e09\u3001\u57fa\u4e8eXML\u7684AOP \u5207\u9762\u7c7b\u5199\u597d\u540e\u5728XML\u4e2d\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u5373\u53ef\u3002 Text Only<pre><code>&lt;bean class=\"aop.ValidateAspect\" id=\"validateAspect\"/&gt;\n\n&lt;!-- \u57fa\u4e8exml\u914d\u7f6eAOP --&gt;\n&lt;aop:config&gt;\n\u00a0\u00a0&lt;!-- \u6307\u5b9a\u5207\u9762\u7c7b\uff0c\u76f8\u5f53\u4e8e@Aspect --&gt;\n\u00a0\u00a0&lt;aop:aspect ref=\"validateAspect\" order=\"2\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u660e\u88ab\u5207\u65b9\u6cd5\uff08\u76ee\u6807\u65b9\u6cd5\uff09 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:pointcut id=\"calculatorImplPointcut\" expression=\"execution(public * aop.CalculatorImpl.*(..))\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u660e\u901a\u77e5\u65b9\u6cd5\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:before method=\"before\" pointcut-ref=\"calculatorImplPointcut\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:after-returning method=\"afterReturning\" pointcut-ref=\"calculatorImplPointcut\" returning=\"result\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:after-throwing method=\"afterThrowing\" pointcut-ref=\"calculatorImplPointcut\" throwing=\"e\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:after method=\"after\" pointcut-ref=\"calculatorImplPointcut\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:around method=\"aroundNotice\" pointcut-ref=\"calculatorImplPointcut\"/&gt;\n\u00a0\u00a0&lt;/aop:aspect&gt;\n&lt;/aop:config&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/6-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1/","title":"6-\u58f0\u660e\u5f0f\u4e8b\u52a1","text":"<p> \u7ea6 1156 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 23 \u5206\u949f</p> <p>\u4e00\u3001\u58f0\u660e\u5f0f\u4e8b\u52a1\u7684\u6982\u5ff5 \u7f16\u7a0b\u5f0f\u4e8b\u52a1\uff1a Text Only<pre><code>Connection conn = ...;\ntry {\n\u00a0\u00a0\u00a0\u00a0// \u5f00\u542f\u4e8b\u52a1\uff1a\u5173\u95ed\u4e8b\u52a1\u7684\u81ea\u52a8\u63d0\u4ea4\n\u00a0\u00a0\u00a0\u00a0conn.setAutoCommit(false);\n\u00a0\u00a0\u00a0\u00a0// \u6838\u5fc3\u64cd\u4f5c\n\u00a0 \u00a0 .......\n\u00a0\u00a0\u00a0\u00a0// \u63d0\u4ea4\u4e8b\u52a1\n\u00a0\u00a0\u00a0\u00a0conn.commit();\n}catch(Exception e){\n\u00a0\u00a0\u00a0\u00a0// \u56de\u6eda\u4e8b\u52a1\n\u00a0\u00a0\u00a0\u00a0conn.rollBack();\n}finally{\n\u00a0\u00a0\u00a0\u00a0// \u91ca\u653e\u6570\u636e\u5e93\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0conn.close();\n}\n</code></pre> \u7f16\u7a0b\u5f0f\u4e8b\u52a1\u7684\u5f62\u5f0f\u5c31\u662fAOP\u73af\u7ed5\u901a\u77e5\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u4ee3\u7406\u6a21\u5f0f\u62bd\u79bb\u7f16\u7a0b\u5f0f\u4e8b\u52a1\u7684\u91cd\u590d\u7f16\u7801\uff0cSpring\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1\u6b63\u662f\u5229\u7528AOP\u5c06\u4e8b\u52a1\u7684\u8fc7\u7a0b\u914d\u7f6e\u5316\uff0c\u4ece\u800c\u514d\u53bb\u91cd\u590d\u7f16\u7801\u3002</p> <p>\u4e8c\u3001\u57fa\u4e8e\u6ce8\u89e3\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1 1\u3001\u5728spring\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e8b\u52a1\u7684\u914d\u7f6e Text Only<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:context=\"http://www.springframework.org/schema/context\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:aop=\"http://www.springframework.org/schema/aop\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd\"&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;context:component-scan base-package=\"dao,service\"/&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u6570\u636e\u6e90\u914d\u7f6e\u6b65\u9aa4\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.\u5bfc\u5165\u5c5e\u6027\u914d\u7f6e\u914d\u7f6e\u6587\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.\u5c06\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u52a0\u5165ioc\u5bb9\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;context:property-placeholder location=\"classpath:druid.properties\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"com.alibaba.druid.pool.DruidDataSource\" id=\"druidDataSource\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"username\" value=\"${jdbc.username}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"password\" value=\"${jdbc.password}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"url\" value=\"${jdbc.url}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"driverClassName\" value=\"${jdbc.driverClassName}\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0`\u57fa\u4e8e\u6ce8\u89e3\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1\u914d\u7f6e\u6b65\u9aa4\uff1a`\n `1.\u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668\uff08\u4e8b\u52a1\u7ba1``\u7406\u5668\u5c31\u662f\u5207\u9762\u7c7b\uff0c\u6240\u4ee5\u9700\u8981\u5bfc\u5165AOP\u7684\u90a3\u51e0\u4e2a\u5305\uff09\uff0c\u8bbe\u7f6e``\u5176\u6570\u636e\u6e90\uff08\u5373\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff09`\n `2.\u5f00\u542f\u57fa\u4e8e\u6ce8\u89e3\u7684\u4e8b\u52a1\u63a7\u5236\u6a21\u5f0f &lt;tx:annotation-driven transaction-manager=\"\"/&gt;`\n `3.\u7ed9\u9700\u8981\u4e8b\u52a1\u63a7\u5236\u7684\u65b9\u6cd5\u52a0\u4e0a\u6ce8\u89e3@Transactional`\n\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"dataSource\" ref=\"druidDataSource\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0`1.\u5f00\u542f\u57fa\u4e8e\u6ce8\u89e3\u7684\u4e8b\u52a1\u63a7\u5236\u6a21\u5f0f\uff0c\u9700\u8981\u5f15\u5165tx\u547d\u540d\u7a7a\u95f4`\n `2.transaction-manager\u5c5e\u6027\u7684\u9ed8\u8ba4\u503c\u662ftransactionManager\uff0c\u5982\u679c\u4e8b\u52a1\u7ba1\u7406\u5668bean\u7684id\u6b63\u597d\u5c31\u662f\u8fd9\u4e2a\u9ed8\u8ba4\u503c\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u8fd9\u4e2a\u5c5e\u6027`\n\u00a0\u00a0 \u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;tx:annotation-driven transaction-manager=\"transactionManager\"/&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u914d\u7f6eJdbcTemplate\u7528\u4e8e\u64cd\u4f5c\u6570\u636e\u5e93 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"org.springframework.jdbc.core.JdbcTemplate\" id=\"jdbcTemplate\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- &lt;property name=\"dataSource\" value=\"#{druidDataSource}\"/&gt; --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"dataSource\" ref=\"druidDataSource\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n&lt;/beans&gt;\n</code></pre></p> <p>2\u3001\u4f7f\u7528\u6ce8\u89e3\u6dfb\u52a0\u4e8b\u52a1\u7684\u914d\u7f6e</p> <ol> <li>\u5728\u914d\u7f6e\u7c7b\u4e0a\u4f7f\u7528@EnableTransactionManagement\u6ce8\u89e3\u5f00\u542f\u4e8b\u52a1\u7ba1\u7406</li> <li>\u6dfb\u52a0\u4e8b\u52a1\u7ba1\u7406\u5668\uff08\u4e8b\u52a1\u7ba1\u7406\u5668\u5c31\u662f\u5207\u9762\u7c7b\uff09\uff0c\u8bbe\u7f6e\u5176\u6570\u636e\u6e90\uff08\u5373\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff09</li> </ol> Text Only<pre><code>@Configuration\n@ComponentScan(\"com.atguigu.spring6\")\n`@EnableTransactionManagement`\npublic class SpringConfig {\n\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public DataSource getDataSource(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DruidDataSource dataSource = new DruidDataSource();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataSource.setDriverClassName(\"com.mysql.cj.jdbc.Driver\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataSource.setUrl(\"jdbc:mysql://localhost:3306/spring?characterEncoding=utf8&amp;useSSL=false\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataSource.setUsername(\"root\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataSource.setPassword(\"root\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return dataSource;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Bean(name = \"jdbcTemplate\")\n\u00a0\u00a0\u00a0\u00a0public JdbcTemplate getJdbcTemplate(DataSource dataSource){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0JdbcTemplate jdbcTemplate = new JdbcTemplate();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0jdbcTemplate.setDataSource(dataSource);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return jdbcTemplate;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public `DataSourceTransactionManager` getDataSourceTransactionManager(DataSource dataSource){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataSourceTransactionManager dataSourceTransactionManager = new DataSourceTransactionManager();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataSourceTransactionManager.setDataSource(dataSource);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return dataSourceTransactionManager;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>3\u3001\u4f7f\u7528@Transactional\u6ce8\u89e3\u58f0\u660e\u4e8b\u52a1</p> <ul> <li>@Transactional\u6807\u8bc6\u5728\u65b9\u6cd5\u4e0a\uff0c\u5219\u53ea\u4f1a\u5f71\u54cd\u8be5\u65b9\u6cd5\uff08\u53ea\u5207\u8fd9\u4e00\u4e2a\u65b9\u6cd5\uff09</li> <li>@Transactional\u6807\u8bc6\u7684\u7c7b\u4e0a\uff0c\u5219\u4f1a\u5f71\u54cd\u7c7b\u4e2d\u6240\u6709\u7684\u65b9\u6cd5\uff08\u5207\u8be5\u7c7b\u7684\u6240\u6709\u65b9\u6cd5\uff09\uff1b\u4e8b\u52a1\u4e0d\u5e94\u8be5\u52a0\u5728dao\u5c42\uff0cdao\u5c42\u7684\u6bcf\u4e2a\u65b9\u6cd5\u53ea\u662f\u8d1f\u8d23\u6267\u884c\u4e00\u6761sql\u8bed\u53e5\uff0c\u4e8b\u52a1\u5e94\u8be5\u9762\u5411\u4e1a\u52a1\uff0c\u52a0\u5728service\u65b9\u6cd5\u4e2d\u3002</li> </ul> Text Only<pre><code>@Transactional(isolation = Isolation.READ_COMMITTED,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0propagation = Propagation.REQUIRED,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rollbackFor = Exception.class,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// readOnly = true,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timeout = 1)\npublic void checkout(String name, String isbn) {\n\u00a0\u00a0\u00a0\u00a0//\u67e5\u8be2\u4ef7\u683c\n\u00a0\u00a0\u00a0\u00a0int price = bookDao.getBookPrice(isbn);\n\u00a0\u00a0\u00a0\u00a0//\u51cf\u4f59\u989d\n\u00a0\u00a0\u00a0\u00a0bookDao.updateAccountBalance(name, price);\n\u00a0\u00a0\u00a0\u00a0//\u51cf\u5e93\u5b58\n\u00a0\u00a0\u00a0\u00a0bookDao.updateBookStock(isbn);\n}\n</code></pre> <p>3.1\u00a0readOnly\u5c5e\u6027\uff1areadOnly=true\u5f00\u542f\u4e00\u4e2a\u53ea\u8bfb\u4e8b\u52a1\uff0c\u9ed8\u8ba4false\u3002</p> <p>3.2\u00a0timeout\u5c5e\u6027\u8bbe\u7f6e\u4e8b\u52a1\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u8d85\u65f6\u56de\u6eda\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u9ed8\u8ba4-1\u8868\u793a\u4e0d\u4f1a\u8d85\u65f6\u3002</p> <p>3.3\u00a0\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b Text Only<pre><code>@Transactional(isolation = Isolation.DEFAULT)//\u4f7f\u7528\u6570\u636e\u5e93\u9ed8\u8ba4\u7684\u9694\u79bb\u7ea7\u522b\n@Transactional(isolation = Isolation.READ_UNCOMMITTED)//\u8bfb\u672a\u63d0\u4ea4\n@Transactional(isolation = Isolation.READ_COMMITTED)//\u8bfb\u5df2\u63d0\u4ea4\n@Transactional(isolation = Isolation.REPEATABLE_READ)//\u53ef\u91cd\u590d\u8bfb\n@Transactional(isolation = Isolation.SERIALIZABLE)//\u4e32\u884c\u5316\n</code></pre></p> <p>3.3\u00a0\u8bbe\u7f6e\u51fa\u73b0\u5f02\u5e38\u7684\u56de\u6eda\u7b56\u7565 \u9ed8\u8ba4\u53d1\u751f\u8fd0\u884c\u65f6\u5f02\u5e38\uff08\u975e\u68c0\u67e5\u5f02\u5e38\uff09\u548cError\u4f1a\u56de\u6eda\uff08\u524d\u63d0\u662f\u5f97\u628a\u5f02\u5e38\u629b\u51fa\u53bb\uff0c\u56e0\u4e3a\u4e8b\u52a1\u65b9\u6cd5\u5c31\u662faop\u7684\u76ee\u6807\u65b9\u6cd5\uff09\uff0c\u53d1\u751f\u7f16\u8bd1\u65f6\u5f02\u5e38\uff08\u53d7\u68c0\u67e5\u5f02\u5e38\uff09\u4e0d\u4f1a\u56de\u6eda\u3002 \u7528\u4e0b\u9762\u4e24\u4e2a\u5c5e\u6027\u6307\u5b9a\u4f1a\u56de\u6eda\u7684\u53d7\u68c0\u67e5\u5f02\u5e38\uff08\u975e\u68c0\u67e5\u5f02\u5e38\u4f9d\u65e7\u4f1a\u56de\u6eda\uff09\uff1a</p> <ul> <li>rollbackFor \u6307\u5b9a\u629b\u51fa\u54ea\u4e9b\u5f02\u5e38\u4f1a\u56de\u6eda</li> <li>rollbackForClassName \u6307\u5b9a\u4f1a\u56de\u6eda\u7684\u5f02\u5e38\u7684\u5168\u7c7b\u540d</li> </ul> <p>\u7528\u4e0b\u9762\u4e24\u4e2a\u5c5e\u6027\u6307\u5b9a\u4e0d\u4f1a\u56de\u6eda\u7684\u975e\u68c0\u67e5\u5f02\u5e38\uff1a</p> <ul> <li>noRollbackFor \u6307\u5b9a\u629b\u51fa\u54ea\u4e9b\u5f02\u5e38\u4e0d\u4f1a\u56de\u6eda</li> <li>noRollbackForClassName \u6307\u5b9a\u4e0d\u4f1a\u56de\u6eda\u7684\u5f02\u5e38\u7684\u5168\u7c7b\u540d</li> </ul> <p>\u4e0b\u9762\u7684\u65b9\u6cd5\u4f1a\u51fa\u73b0java.io.FileNotFoundException\uff0c\u4f46\u662f\u4e8b\u52a1\u4e0d\u4f1a\u56de\u6eda\uff0c\u56e0\u4e3aFileNotFoundException\u662f\u53d7\u68c0\u67e5\u5f02\u5e38\uff0c\u6700\u540e\u53ea\u51cf\u4e86\u4f59\u989d\uff0c\u6ca1\u6709\u6263\u5e93\u5b58\u3002 Text Only<pre><code>@Transactional\npublic void checkout(String name, String isbn) throws FileNotFoundException {\n\u00a0\u00a0\u00a0\u00a0int price = bookDao.getBookPrice(isbn);\n\u00a0\u00a0\u00a0\u00a0//\u51cf\u4f59\u989d\n\u00a0\u00a0\u00a0\u00a0bookDao.updateAccountBalance(name, price);\n\u00a0\u00a0\u00a0\u00a0new FileInputStream(\"noExistFile.txt\");\n\u00a0\u00a0\u00a0\u00a0//\u51cf\u5e93\u5b58\n\u00a0\u00a0\u00a0\u00a0bookDao.updateBookStock(isbn);\n}\n</code></pre> \u6240\u4ee5\u4e00\u822c\u4f1a\u6307\u5b9arollbackFor = Exception.class\uff0c\u8fd9\u6837\u53d1\u751f\u8fd0\u884c\u65f6\u5f02\u5e38\u548c\u53d7\u68c0\u67e5\u5f02\u5e38\u5c31\u90fd\u4f1a\u56de\u6eda\u4e86\u3002</p> <p>3.4\u00a0\u4e8b\u52a1\u7684\u4f20\u64ad\u884c\u4e3a Spring \u4e8b\u52a1\u4f20\u64ad\u673a\u5236\u662f\u6307\uff0c\u591a\u4e2a\u4e8b\u52a1\u7684\u65b9\u6cd5\u5728\u76f8\u4e92\u8c03\u7528\u65f6\uff0c\u4e8b\u52a1\u662f\u5982\u4f55\u5728\u8fd9\u4e9b\u65b9\u6cd5\u95f4\u4f20\u64ad\u7684\uff0c\u4e8b\u52a1\u4f20\u64ad\u673a\u5236\u5206\u4e3a 3 \u5927\u7c7b\uff0c\u603b\u5171 7 \u79cd\uff1a Text Only<pre><code>@Transactional(propagation = Propagation.REQUIRED)\n@Transactional(propagation = Propagation.SUPPORTS)\n@Transactional(propagation = Propagation.MANDATORY)\n@Transactional(propagation = Propagation.REQUIRES_NEW)\n@Transactional(propagation = Propagation.NOT_SUPPORTED)\n@Transactional(propagation = Propagation.NEVER)\n@Transactional(propagation = Propagation.NESTED)\n</code></pre>  NESTED\u5d4c\u5957\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u5f0f\u662fsavepoint\uff0c\u5f53\u4e00\u4e2a\u65b9\u6cd5\u88ab\u6307\u5b9a\u4e3a\u5d4c\u5957\u4e8b\u52a1\uff0c\u65b9\u6cd5\u5f00\u59cb\u65f6\u4f1a\u8bbe\u7f6e\u4e00\u4e2asavepoint\uff0c\u5f53\u65b9\u6cd5\u88ab\u56de\u6eda\u65f6\uff0c\u53ea\u4f1a\u56de\u6eda\u5230\u8be5savepoint\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5230\u6574\u4e2a\u4e8b\u52a1\u3002</p> <ul> <li>NESTED\u00a0\u4e0e\u00a0REQUIRED\u00a0\u7684\u533a\u522b\uff1a\u5171\u540c\u70b9\u662f\u5185\u5916\u5c42\u516c\u7528\u4e00\u4e2a\u4e8b\u52a1\uff1b\u4e0d\u540c\u70b9\u662f\uff0cREQUIRED\u65b9\u6cd5\u56de\u6eda\u65f6\uff0c\u4f1a\u76f4\u63a5\u56de\u6eda\u6574\u4e2a\u4e8b\u52a1\uff0c\u800cNESTED\u00a0\u53ea\u4f1a\u56de\u6eda\u5230savepoint\u3002</li> <li>NESTED\u00a0\u4e0eREQUIRED_NEW \u7684\u533a\u522b\uff1aREQUIRED_NEW \u5185\u5916\u5c42\u662f\u4e24\u4e2a\u72ec\u7acb\u7684\u4e8b\u52a1\uff0c\u5404\u81ea\u7684\u56de\u6eda\u4e0e\u63d0\u4ea4\u4e92\u4e0d\u5f71\u54cd\u3002</li> </ul> <p>SAVEPOINT\u4f7f\u7528\u4f8b\u5b50\uff1a Text Only<pre><code>mysql&gt; select * from book;\nEmpty set (0.01 sec)\n\nmysql&gt; start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; SAVEPOINT s1;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; insert into book(isbn, book_name, price) values('ISBN_001', 'book100', 100);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; SAVEPOINT s2;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; INSERT INTO book(isbn, book_name, price) VALUES('ISBN_002', 'book200', 200);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; SAVEPOINT s3;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; INSERT INTO book(isbn, book_name, price) VALUES('ISBN_003', 'book300', 300);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; rollback to SAVEPOINT s2;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; commit;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from book;\n+----------+-----------+-------+\n| isbn\u00a0\u00a0\u00a0\u00a0\u00a0| book_name | price |\n+----------+-----------+-------+\n| ISBN_001 | book100\u00a0\u00a0\u00a0|\u00a0\u00a0\u00a0100 |\n+----------+-----------+-------+\n1 row in set (0.00 sec)\n</code></pre></p> <p>\u4e09\u3001\u57fa\u4e8eXML\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1 Text Only<pre><code>&lt;!-- \u57fa\u4e8exml\u914d\u7f6e\u58f0\u660e\u5f0f\u4e8b\u52a1\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.\u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668\uff08\u4e8b\u52a1\u5207\u9762\uff09\uff0c\u8bbe\u7f6e\u5176\u6570\u636e\u6e90\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02.\u6307\u660e\u4e8b\u52a1\u65b9\u6cd5\uff08\u88ab\u5207\u65b9\u6cd5\uff09\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a03.\u914d\u7f6e\u4e8b\u52a1\u7684\u5c5e\u6027\n--&gt;\n&lt;aop:config&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u914d\u7f6e\u4e8b\u52a1\u901a\u77e5\u548c\u5207\u5165\u70b9\u8868\u8fbe\u5f0f\uff08\u8fd9\u91cc\u5207\u4e86\u4e00\u5927\u7247\uff09 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;aop:advisor advice-ref=\"txAdvice\" pointcut=\"execution(* com.atguigu.spring.tx.xml.service.impl.*.*(..))\"&gt;&lt;/aop:advisor&gt;\n&lt;/aop:config&gt;\n&lt;!-- tx:advice\u6807\u7b7e\uff1a\u914d\u7f6e\u4e8b\u52a1\u901a\u77e5 --&gt;\n&lt;!-- id\u5c5e\u6027\uff1a\u7ed9\u4e8b\u52a1\u901a\u77e5\u6807\u7b7e\u8bbe\u7f6e\u552f\u4e00\u6807\u8bc6\uff0c\u4fbf\u4e8e\u5f15\u7528 --&gt;\n&lt;!-- transaction-manager\u5c5e\u6027\uff1a\u5173\u8054\u4e8b\u52a1\u7ba1\u7406\u5668 --&gt;\n&lt;tx:advice id=\"txAdvice\" transaction-manager=\"transactionManager\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;tx:attributes&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- tx:method\u6807\u7b7e\uff1a\u914d\u7f6e\u5177\u4f53\u7684\u4e8b\u52a1\u65b9\u6cd5 --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- name\u5c5e\u6027\uff1a\u6307\u5b9a\u65b9\u6cd5\u540d\uff0c\u53ef\u4ee5\u4f7f\u7528\u661f\u53f7\u4ee3\u8868\u591a\u4e2a\u5b57\u7b26 --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;tx:method name=\"get*\" read-only=\"true\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;tx:method name=\"query*\" read-only=\"true\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;tx:method name=\"find*\" read-only=\"true\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;tx:method name=\"save*\" read-only=\"false\" rollback-for=\"java.lang.Exception\" propagation=\"REQUIRES_NEW\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;tx:method name=\"update*\" read-only=\"false\" rollback-for=\"java.lang.Exception\" propagation=\"REQUIRES_NEW\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;tx:method name=\"delete*\" read-only=\"false\" rollback-for=\"java.lang.Exception\" propagation=\"REQUIRES_NEW\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/tx:attributes&gt;\n&lt;/tx:advice&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/Spring/7-%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95%E4%B9%8B%E9%97%B4%E8%B0%83%E7%94%A8%40Transactional%E6%B3%A8%E8%A7%A3%E4%B8%8D%E7%94%9F%E6%95%88/","title":"7-\u540c\u4e00\u4e2a\u7c7b\u7684\u65b9\u6cd5\u4e4b\u95f4\u8c03\u7528@Transactional\u6ce8\u89e3\u4e0d\u751f\u6548","text":"<p> \u7ea6 478 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u901a\u8fc7insertStudent()\u8c03\u7528insert()\u65b9\u6cd5\u4f1a\u5bfc\u81f4@Transactional\u6ce8\u89e3\u4e0d\u751f\u6548\uff0c\u539f\u56e0\u662f\u58f0\u660e\u5f0f\u4e8b\u52a1\u57fa\u4e8eAOP\u5b9e\u73b0\uff0c\u53ea\u6709\u901a\u8fc7\u4ee3\u7406\u7c7b\u5bf9\u8c61\u8c03\u7528@Transactional\u65b9\u6cd5\u624d\u4f1a\u5f00\u542f\u4e8b\u52a1\u3002@Async\u6ce8\u89e3\u4e5f\u6709\u76f8\u540c\u7684\u95ee\u9898\u3002 Text Only<pre><code>public class StudentServiceImpl implements StudentService {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0private StudentMapper studentMapper;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void insertStudent() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0insert();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Transactional(rollbackFor = Exception.class)\n\u00a0\u00a0\u00a0\u00a0public void insert() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StudentDO studentDO = new StudentDO();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setName(\"\u5c0f\u660e\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setAge(22);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentMapper.insert(studentDO);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6ce8\u610f\uff1a\u9664\u4e86@Transactional\uff0c@Async\u540c\u6837\u9700\u8981\u4ee3\u7406\u7c7b\u8c03\u7528\uff0c\u5f02\u6b65\u624d\u4f1a\u751f\u6548\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\u7684\u6838\u5fc3\u662f\u62ff\u5230\u4ee3\u7406\u7c7b\u5bf9\u8c61\u4e4b\u540e\u518d\u8c03\u7528\u65b9\u6cd5\uff08\u53c2\u8003\uff1ahttps://www.jianshu.com/p/083605986c8f\uff09 \u65b9\u6cd5\u4e00\u3001\u81ea\u5df1@Autowired\u81ea\u5df1 Text Only<pre><code>@Service\npublic class StudentServiceImpl implements StudentService {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0private StudentMapper studentMapper;\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0private StudentService studentService;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void insertStudent(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentService.insert();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0@Transactional(rollbackFor = Exception.class)\n\u00a0\u00a0\u00a0\u00a0public void insert() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StudentDO studentDO = new StudentDO();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setName(\"\u5c0f\u660e\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setAge(22);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentMapper.insert(studentDO);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u65b9\u6cd5\u4e8c\u3001\u4f7f\u7528AopContext\u83b7\u53d6\u5230\u5f53\u524d\u4ee3\u7406\u7c7b\uff0c\u9700\u8981\u5728\u542f\u52a8\u7c7b\u52a0\u4e0a@EnableAspectJAutoProxy(exposeProxy = true)\u3002 Text Only<pre><code>@Service\npublic class StudentServiceImpl implements StudentService {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0private StudentMapper studentMapper;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void insertStudent(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0getService().insert();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0@Transactional(rollbackFor = Exception.class)\n\u00a0\u00a0\u00a0\u00a0public void insert() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StudentDO studentDO = new StudentDO();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setName(\"\u5c0f\u660e\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setAge(22);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentMapper.insert(studentDO);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u901a\u8fc7AopContext\u83b7\u53d6\u4ee3\u7406\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0* @return StudentService\u4ee3\u7406\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private StudentService getService(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Objects.nonNull(AopContext.currentProxy()) ? (StudentService)AopContext.currentProxy() : this;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> exposeProxy = true\u7528\u4e8e\u63a7\u5236AOP\u6846\u67b6\u516c\u5f00\u4ee3\u7406\uff0c\u516c\u5f00\u540e\u624d\u53ef\u4ee5\u901a\u8fc7AopContext\u83b7\u53d6\u5230\u5f53\u524d\u4ee3\u7406\u7c7b\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u516c\u5f00\u4ee3\u7406\uff0c\u56e0\u4e3a\u4f1a\u964d\u4f4e\u6027\u80fd\uff09\u3002 \u6ce8\u610f\uff1a\u4e0d\u80fd\u4fdd\u8bc1\u8fd9\u79cd\u65b9\u5f0f\u4e00\u5b9a\u6709\u6548\uff0c\u4f7f\u7528@Async\u65f6\uff0c\u672c\u65b9\u5f0f\u53ef\u80fd\u5931\u6548\u3002</p> <p>\u65b9\u6cd5\u4e09\uff08\u63a8\u8350\uff09\u3001\u901a\u8fc7spring\u4e0a\u4e0b\u6587\u83b7\u53d6\u5230\u5f53\u524d\u4ee3\u7406\u7c7b\uff1a \u5f53\u4e00\u4e2a\u7c7b\u5b9e\u73b0ApplicationContextAware\u63a5\u53e3\u540e\uff0c\u5c31\u53ef\u4ee5\u65b9\u4fbf\u7684\u83b7\u5f97ApplicationContext\u4e2d\u7684\u6240\u6709bean\u3002 Text Only<pre><code>@Component\npublic class SpringBeanUtil implements ApplicationContextAware {\n\n\u00a0\u00a0\u00a0\u00a0private static ApplicationContext applicationContext;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.applicationContext = applicationContext;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u901a\u8fc7class\u83b7\u53d6Bean\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return applicationContext.getBean(clazz);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>@Service\npublic class StudentServiceImpl implements StudentService {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0private StudentMapper studentMapper;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void insertStudent(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StudentService bean = SpringBeanUtil.getBean(StudentService.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (null != bean) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0bean.insert();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0@Transactional(rollbackFor = Exception.class)\n\u00a0\u00a0\u00a0\u00a0public void insert() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StudentDO studentDO = new StudentDO();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setName(\"\u5c0f\u660e\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentDO.setAge(22);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentMapper.insert(studentDO);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/0.%E5%8E%9F%E7%90%86/","title":"0.\u539f\u7406","text":"<p> \u7ea6 555 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p></p> <p>SpringApplication.run(String... args)\u7684\u6d41\u7a0b\uff1a \u521b\u5efaBootstrapContext\u5f15\u5bfc\u4e0a\u4e0b\u6587 Text Only<pre><code>DefaultBootstrapContext bootstrapContext = createBootstrapContext();\n</code></pre> \u70b9\u8fdbcreateBootstrapContext()\uff0c\u8c03\u7528bootstrapRegistryInitializer\u7684initialize\u65b9\u6cd5 Text Only<pre><code>this.bootstrapRegistryInitializers.forEach((initializer) -&gt; initializer.initialize(bootstrapContext));\n</code></pre> \u62ff\u5230\u6240\u6709\u7684SpringApplicationRunListener\uff0c\u70b9\u8fdb\u53bb\u4e3b\u8981\u662fgetSpringFactoriesInstances()\u65b9\u6cd5\uff0c\u5176\u4f5c\u7528\u662f\u901a\u8fc7spring.factories\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u5168\u7c7b\u540d\u521b\u5efaBean\uff0c\u6bd4\u5982\u627e\u5230\u6587\u4ef6\u4e2dSpringApplicationRunListener\u6307\u5b9a\u7684\u5168\u7c7b\u540d\u521b\u5efaBean\u3002 Text Only<pre><code>SpringApplicationRunListeners listeners = getRunListeners(args);\n</code></pre> Text Only<pre><code>List&lt;SpringApplicationRunListener&gt; listeners = getSpringFactoriesInstances(SpringApplicationRunListener.class,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0argumentResolver);\n</code></pre> \u8c03\u7528SpringApplicationRunListener\u7684starting(\uff09\u65b9\u6cd5 Text Only<pre><code>listeners.starting(bootstrapContext, this.mainApplicationClass);\n</code></pre> \u51c6\u5907\u73af\u5883ConfigurableEnvironment\uff0c\u8fd9\u4e00\u6b65\u662f\u628a\u542f\u52a8\u53c2\u6570\u7b49\u7ed1\u5b9a\u5230\u73af\u5883\u53d8\u91cf\u4e2d Text Only<pre><code>ConfigurableEnvironment environment = prepareEnvironment(listeners, bootstrapContext, applicationArguments);\n</code></pre> \u70b9\u8fdbprepareEnvironment()\u65b9\u6cd5\uff0c\u628a\u542f\u52a8\u53c2\u6570\u7b49\u7ed1\u5b9a\u5230\u73af\u5883\u53d8\u91cf\u540e\u4f1a\u8c03\u7528SpringApplicationRunListener\u7684environmentPrepared()\u65b9\u6cd5 Text Only<pre><code>listeners.environmentPrepared(bootstrapContext, environment);\n</code></pre> \u6253\u5370banner Text Only<pre><code>Banner printedBanner = printBanner(environment);\n</code></pre> \u521b\u5efaIOC\u5bb9\u5668\uff0c\u8fd9\u91cc\u4ec5\u4ec5\u662f\u521b\u5efa\uff0c\u5e76\u6ca1\u6709\u6ce8\u5165Bean Text Only<pre><code>context = createApplicationContext();\n</code></pre> \u51c6\u5907\u4e0a\u4e0b\u6587\uff08\u51c6\u5907IOC\u5bb9\u5668\uff09\uff0c\u8fd9\u91cc\u53ea\u662f\u5728\u52a0\u8f7d\u914d\u7f6e\uff0c\u5e76\u6ca1\u6709\u521b\u5efaBean Text Only<pre><code>prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);\n</code></pre> \u70b9\u8fdbprepareContext()\uff0c\u52a0\u8f7d\u914d\u7f6e\u540e\u5148\u8c03\u7528\u4e86ApplicationContextInitializer\u7684initialize\u65b9\u6cd5 Text Only<pre><code>applyInitializers(context);\n</code></pre> \u7136\u540e\u8c03\u7528\u4e86SpringApplicationRunListener\u7684contextPrepared()\u65b9\u6cd5 Text Only<pre><code>listeners.contextPrepared(context);\n</code></pre> \u518d\u63a5\u7740\u5173\u95ed\u4e86bootstrapContext\uff0cclose\u65b9\u6cd5\u5e7f\u64ad\u4e86BootstrapContextClosedEvent\u4e8b\u4ef6\uff08\u8fd9\u4e2a\u4e8b\u4ef6\u4e0d\u662f\u5f88\u91cd\u8981\uff09 Text Only<pre><code>bootstrapContext.close(context);\n</code></pre> \u6700\u540e\u5728\u5411IOC\u5bb9\u5668\u4e2d\u6ce8\u5165\u51e0\u4e2aSpringBoot\u7279\u522b\u6307\u5b9a\u7684Bean\u540e\u8c03\u7528SpringApplicationRunListener\u7684contextLoaded()\u65b9\u6cd5 Text Only<pre><code>listeners.contextLoaded(context);\n</code></pre> \u5237\u65b0IOC\u5bb9\u5668\uff0c\u4ecerefreshContext()\u65b9\u6cd5\u4e00\u76f4\u70b9\u8fdb\u53bb\uff0c\u662fAbstractApplicationContext.java\u7684refresh()\uff0c\u8fd9\u91cc\u662fIOC\u5bb9\u5668\u5237\u65b0\u7684\u7ecf\u5178\u65b9\u6cd5\uff0c\u6700\u540e\u4e00\u6b65finishRefresh();\u65b9\u6cd5\u4f1a\u53d1\u9001ContextRefreshedEvent\u4e8b\u4ef6 Text Only<pre><code>refreshContext(context);\n</code></pre> \u8c03\u7528SpringApplicationRunListener\u7684started()\u65b9\u6cd5 Text Only<pre><code>listeners.started(context);\n</code></pre> \u8c03\u7528ApplicationRunner\u548cCommandLineRunner\u7684run(args)\u65b9\u6cd5 Text Only<pre><code>callRunners(context, applicationArguments);\n</code></pre> \u6700\u540e\u8c03\u7528SpringApplicationRunListener\u7684ready()\u65b9\u6cd5 Text Only<pre><code>listeners.ready(context, startup.ready());\n</code></pre> \u4ee5\u4e0a\u6d41\u7a0b\u5982\u679c\u51fa\u9519\u4e86\u8c03\u7528SpringApplicationRunListener\u7684failed()\u65b9\u6cd5 Text Only<pre><code>listeners.failed(context, exception);\n</code></pre> \u6700\u540e\u5bb9\u5668\u5173\u95ed\u8c03\u7528AbstractApplicationContext.doClose()\u65b9\u6cd5\u4f1a\u5e7f\u64adContextClosedEvent\u4e8b\u4ef6</p> <p>\u4f7f\u7528SpringApplicationRunListener\u76d1\u542c\u5668\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5b9e\u73b0SpringApplicationRunListener\u63a5\u53e3\uff0c\u7136\u540e\u518d\u5728spring.factories\u6587\u4ef6\u6307\u5b9a\uff1a Text Only<pre><code>org.springframework.boot.SpringApplicationRunListener=org.example.springbootdemo.MyRunListener\n</code></pre> \u95ee\u9898\uff1a\u4e3a\u4ec0\u4e48\u8981\u6307\u5b9a\uff0c\u90fd\u5b9e\u73b0\u63a5\u53e3\u4e86\uff0c\u96be\u9053JVM\u4e0d\u80fd\u627e\u5230\u6240\u6709\u5b9e\u73b0\u67d0\u4e00\u63a5\u53e3\u7684\u5b50\u7c7b\uff1f \u7b54\uff1a\u7406\u8bba\u4e0a\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u662f\u8fd9\u9700\u8981\u628a\u7c7b\u8def\u5f84\u4e0b\u7684\u6240\u6709class\u52a0\u8f7d\u5230\u65b9\u6cd5\u533a\uff0c\u8fd9\u53ef\u80fd\u4f1a\u8ba9\u65b9\u6cd5\u533aOOM\uff0c\u5e76\u4e14\u7c7b\u52a0\u8f7d\u9700\u8981\u5b8c\u6210\u4e00\u7cfb\u5217\u6d41\u7a0b\uff08\u52a0\u8f7d\u3001\u8fde\u63a5\u3001\u521d\u59cb\u5316\uff09\uff0c\u4f1a\u4e25\u91cd\u62d6\u6162\u8fd0\u884c\u901f\u5ea6\uff0c\u6240\u4ee5\u5fc5\u987b\u6307\u5b9a\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/1.SpringBoot%E5%85%A5%E9%97%A8/","title":"1.SpringBoot\u5165\u95e8","text":"<p> \u7ea6 1742 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 35 \u5206\u949f</p> <p>\u4e00\u3001SpringBoot\u00a0WEB\u9879\u76ee\u642d\u5efa\u6b65\u9aa4 1\u3001\u6240\u6709springboot\u9879\u76ee\u90fd\u5fc5\u987b\u7ee7\u627f\u81ea spring-boot-starter-parent Text Only<pre><code>&lt;parent&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.5&lt;/version&gt;\n&lt;/parent&gt;\n</code></pre> 2\u3001\u5bfc\u5165\u573a\u666f\u542f\u52a8\u5668 Text Only<pre><code>&lt;dependencies&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- web\u5f00\u53d1\u7684\u573a\u666f\u542f\u52a8\u5668 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> 3\u3001\u4e3b\u7a0b\u5e8f Text Only<pre><code>@SpringBootApplication //\u8fd9\u662f\u4e00\u4e2aSpringBoot\u5e94\u7528\npublic class MainApplication {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringApplication.run(MainApplication.class,args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 4\u3001\u4e1a\u52a1\u63a5\u53e3 Text Only<pre><code>@RestController\npublic class HelloController {\n\u00a0\u00a0\u00a0\u00a0@GetMapping(\"/hello\")\n\u00a0\u00a0\u00a0\u00a0public String hello(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"Hello,Spring Boot 3!\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 5\u3001\u6d4b\u8bd5 \u9ed8\u8ba4\u542f\u52a8\u8bbf\u95ee\uff1a localhost:8080 6\u3001\u6253\u5305 Text Only<pre><code>&lt;!--\u00a0\u00a0\u00a0\u00a0SpringBoot\u5e94\u7528\u6253\u5305\u63d2\u4ef6--&gt;\n&lt;build&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;plugins&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/plugin&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre> mvn clean package \u628a\u9879\u76ee\u6253\u6210\u53ef\u6267\u884c\u7684jar\u5305 java -jar demo.jar \u542f\u52a8\u9879\u76ee</p> <p>\u62d3\u5c55\uff0c\u81ea\u5b9a\u4e49banner\uff1a \u7c7b\u8def\u5f84\u6dfb\u52a0 banner.txt \u6216 \u8bbe\u7f6espring.banner.location \u5c31\u53ef\u4ee5\u5b9a\u5236 banner\u3002 Text Only<pre><code>#\u6307\u5b9abanner\u6587\u4ef6\u7684\u4f4d\u7f6e\nspring.banner.location=classpath:banner.txt\n#\u6307\u5b9abanner\u6587\u4ef6\u7684\u7f16\u7801\nspring.banner.charset=utf-8\n#\u5173\u95edbanner\nspring.main.banner-mode=off\n</code></pre></p> <p>\u4e8c\u3001\u5173\u952e\u6ce8\u89e3 1\u3001@SpringBootApplication @SpringBootApplication \u662f @SpringBootConfiguration\u3001@EnableAutoConfiguration\u3001@ComponentScan \u8fd9\u4e09\u4e2a\u6ce8\u89e3\u7684\u5408\u6210\u6ce8\u89e3\u3002 @SpringBootConfiguration\u00a0\u4e0e\u00a0@Configuration\u00a0\u4f5c\u7528\u76f8\u540c\uff0c\u6240\u4ee5@SpringBootApplication\u6ce8\u89e3\u6807\u8bc6\u7684\u7c7b\u65e2\u662f\u4e3b\u7a0b\u5e8f\u7c7b\uff0c\u4e5f\u662f\u4e00\u4e2a\u914d\u7f6e\u7c7b\u3002 @SpringBootApplication\u7684\u9ed8\u8ba4\u7684\u626b\u63cf\u8303\u56f4\u5c31\u662f@ComponentScan\u7684\u626b\u63cf\u8303\u56f4\uff0c\u5373\u914d\u7f6e\u7c7b\u6240\u5728\u7684\u5305\u53ca\u5176\u6240\u6709\u5b50\u5305\uff0c\u4e5f\u53ef\u4e5f\u4ee5\u4f7f\u7528@SpringBootApplication\u7684scanBasePackages\u5c5e\u6027\u6307\u5b9a\u626b\u63cf\u7684\u5305\u3002</p> <p>2\u3001@Import \u6ce8\u89e3@Import\u7528\u4e8e\u5411ioc\u5bb9\u5668\u4e2d\u6ce8\u518c\u7ec4\u4ef6\uff0c\u8c03\u7528\u7684\u662f\u7c7b\u7684\u65e0\u53c2\u6784\u9020\u5668\uff0c\u7ec4\u4ef6\u7684id\u662f\u7c7b\u7684\u5168\u7c7b\u540d\u3002 \u5c06\u7b2c\u4e09\u65b9\u5305\u7684\u7ec4\u4ef6\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\u53ef\u4ee5\u4f7f\u7528@Bean\u65b9\u6cd5\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528@Import\uff0c@Import\u76f8\u5f53\u4e8e\u662f\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u52a0\u4fbf\u6377\u6ce8\u518c\u7ec4\u4ef6\u7684\u65b9\u5f0f\u3002 Text Only<pre><code>@Import(User.class)\n@Configuration(proxyBeanMethods = false)\npublic class MyConfig {\n}\n</code></pre> \u6b64\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u6ce8\u89e3@ImportResource\uff0c\u7528\u4e8e\u5bfc\u5165xml\u914d\u7f6e\u6587\u4ef6\u4e2dBean\uff0c\u4f7f\u7528SpringBoot\u90fd\u662f\u5168\u6ce8\u89e3\u914d\u7f6e\uff0c\u6240\u4ee5\u8fd9\u4e2a\u6ce8\u89e3\u4e00\u822c\u4e0d\u7528\u3002 Text Only<pre><code>@ImportResource(\"classpath:beans.xml\")\n@Configuration(proxyBeanMethods = false)\npublic class MyConfig {\n}\n</code></pre></p> <p>3\u3001\u6761\u4ef6\u6ce8\u89e3@ConditionalOnXxx \u6bd4\u8f83\u5e38\u89c1\u7684\uff1a</p> <ul> <li>@ConditionalOnClass\uff1a\u5982\u679c\u7c7b\u8def\u5f84\u4e2d\u5b58\u5728\u8fd9\u4e2a\u7c7b\uff0c\u5219\u89e6\u53d1\u6307\u5b9a\u884c\u4e3a</li> <li>@ConditionalOnMissingClass\uff1a\u5982\u679c\u7c7b\u8def\u5f84\u4e2d\u4e0d\u5b58\u5728\u8fd9\u4e2a\u7c7b\uff0c\u5219\u89e6\u53d1\u6307\u5b9a\u884c\u4e3a</li> <li>@ConditionalOnBean\uff1a\u5982\u679c\u5bb9\u5668\u4e2d\u5b58\u5728\u8fd9\u4e2aBean\uff08\u7ec4\u4ef6\uff09\uff0c\u5219\u89e6\u53d1\u6307\u5b9a\u884c\u4e3a</li> <li>@ConditionalOnMissingBean\uff1a\u5982\u679c\u5bb9\u5668\u4e2d\u4e0d\u5b58\u5728\u8fd9\u4e2aBean\uff08\u7ec4\u4ef6\uff09\uff0c\u5219\u89e6\u53d1\u6307\u5b9a\u884c\u4e3a</li> </ul> <p>Text Only<pre><code>@ConditionalOnRepositoryType (org.springframework.boot.autoconfigure.data)\n@ConditionalOnDefaultWebSecurity (org.springframework.boot.autoconfigure.security)\n@ConditionalOnSingleCandidate (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnWebApplication (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnWarDeployment (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnJndi (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnResource (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnExpression (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnClass (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnEnabledResourceChain (org.springframework.boot.autoconfigure.web)\n@ConditionalOnMissingClass (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnNotWebApplication (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnProperty (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnCloudPlatform (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnBean (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnMissingBean (org.springframework.boot.autoconfigure.condition)\n@ConditionalOnMissingFilterBean (org.springframework.boot.autoconfigure.web.servlet)\n@Profile (org.springframework.context.annotation)\n@ConditionalOnInitializedRestarter (org.springframework.boot.devtools.restart)\n@ConditionalOnGraphQlSchema (org.springframework.boot.autoconfigure.graphql)\n@ConditionalOnJava (org.springframework.boot.autoconfigure.condition)\n</code></pre> Text Only<pre><code>@Configuration\npublic class MyConfig {\n\u00a0\u00a0 \u00a0@ConditionalOnBean(name = \"dog01\")\n\u00a0\u00a0 \u00a0@Bean\n\u00a0\u00a0 \u00a0public Person person01(){\n\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0return new Person(\"Jackson\", 18);\n\u00a0\u00a0 \u00a0}\n}\n</code></pre></p> <p>4\u3001\u5c5e\u6027\u7ed1\u5b9a 4.1 \u7b2c\u4e00\u79cd\u65b9\u5f0f\uff1a @ConfigurationProperties +\u00a0@Component Text Only<pre><code>@ConfigurationProperties(prefix = \"person\")\n@Component\npublic class Person {\n}\n</code></pre> \u8fd9\u79cd\u65b9\u5f0f\u901a\u8fc7setter\u65b9\u6cd5\u6ce8\u5165\uff0c\u5982\u679c@Component\u6807\u6ce8\u7684\u7ec4\u4ef6\u6709\u6709\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u8fd9\u4e2a\u6784\u9020\u5668\u7684\u53c2\u6570\u4f1a\u4ece\u5bb9\u5668\u4e2d\u81ea\u52a8\u6ce8\u5165\u503c\uff0c\u4ece\u800c\u4f1a\u548csetter\u6ce8\u5165\u51b2\u7a81\uff0c\u4f46\u662f\u80af\u5b9a\u662fsetter\u6ce8\u5165\u8986\u76d6\u6784\u9020\u5668\u6ce8\u5165\u3002 4.2 \u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff1a \u5728\u5c5e\u6027\u7c7b\u4e0a\u6807\u6ce8@ConfigurationProperties\uff1a Text Only<pre><code>@ConfigurationProperties(prefix = \"pet\")\npublic class Pet {\n}\n</code></pre> \u5728\u914d\u7f6e\u7c7b\u4e0a\u4f7f\u7528@EnableConfigurationProperties\u5f00\u542f\u5c5e\u6027\u7c7b\u7684\u5c5e\u6027\u7ed1\u5b9a\uff1a Text Only<pre><code>@Configuration\n@EnableConfigurationProperties(value = Pet.class)\npublic class WebConfig {\n}\n</code></pre> \u914d\u7f6e\u6587\u4ef6\u7684\u540d\u79f0\u662f\u00a0application.properties\u00a0\u6216\u8005\u00a0application.yaml \u8fd9\u79cd\u65b9\u5f0f\u9700\u8981Bean\u6709\u5168\u53c2\u6570\u6784\u9020\u5668\u6216\u8005setter\u65b9\u6cd5\u4efb\u610f\u4e00\u79cd\u5373\u53ef\u3002 4.3\u00a0\u7b2c\u4e09\u79cd\u65b9\u5f0f\uff1a @Component +\u00a0@Value\u6807\u6ce8\u5728\u5c5e\u6027\u4e0a @Value(${name:default}) \uff0cdefault\u8868\u793a\u9ed8\u8ba4\u503c\uff0c\u5373\u5728\u914d\u7f6e\u6587\u4ef6\u53d6\u4e0d\u5230\u503c\u7684\u65f6\u5019\u53d6\u9ed8\u8ba4\u503c\u3002 Text Only<pre><code>@Component\npublic class Car {\n\u00a0\u00a0\u00a0\u00a0@Value(\"${mycar.brand:BWM}\")\n\u00a0\u00a0\u00a0\u00a0String brand;\n\u00a0\u00a0\u00a0\u00a0@Value(\"${mycar.price:19.98}\")\n\u00a0\u00a0\u00a0\u00a0Double price;\n}\n</code></pre></p> <p>\u4e09\u3001\u83b7\u53d6IOC\u5bb9\u5668\u7684\u65b9\u5f0f 1. \u5b9e\u73b0ApplicationContextAware\u63a5\u53e3 Text Only<pre><code>@Component\npublic class SpringContextUtil implements ApplicationContextAware {\n\u00a0\u00a0\u00a0\u00a0private static ApplicationContext context;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void setApplicationContext(ApplicationContext applicationContext) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context = applicationContext;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static ApplicationContext getApplicationContext() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return context;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.\u76f4\u63a5\u4f7f\u7528@Autowired\u6ce8\u5165ApplicationContext Text Only<pre><code>@Service\npublic class MyService {\n\u00a0\u00a0\u00a0\u00a0private ApplicationContext applicationContext;\n\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0public MyService(ApplicationContext applicationContext) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.applicationContext = applicationContext;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>3.\u901a\u8fc7SpringApplication\u9759\u6001\u8bbf\u95ee \u5728\u4e3b\u7c7b\u6216\u8005\u914d\u7f6e\u7c7b\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7SpringApplication.run(...)\u8fd4\u56de\u7684\u5bf9\u8c61\u6765\u8bbf\u95eeApplicationContext\u3002 Text Only<pre><code>@SpringBootApplication\npublic class MyApplication {\n\u00a0 \u00a0 public static ApplicationContext context;\n\n\u00a0 \u00a0 public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context = SpringApplication.run(MyApplication.class, args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u56db\u3001\u4f9d\u8d56\u7ba1\u7406\u548c\u81ea\u52a8\u914d\u7f6e SpringBoot\u7684\u4e24\u5927\u7279\u70b9\uff1a\u4f9d\u8d56\u7ba1\u7406 \u548c\u00a0\u81ea\u52a8\u914d\u7f6e \u3002</p> <p>4.1\u00a0\u4f9d\u8d56\u7ba1\u7406 springboot\u9879\u76ee\u5fc5\u987b\u7ee7\u627f\u81ea spring-boot-starter-parent\uff0cspring-boot-starter-parent \u7684\u7236\u9879\u76ee\u662f spring-boot-dependencies\uff0cspring-boot-dependencies \u628a\u6240\u6709\u5e38\u89c1\u7684jar\u7684\u4f9d\u8d56\u7248\u672c\u90fd\u58f0\u660e\u597d\u4e86\uff0c\u5176\u4e2d\u5305\u62ecSpringBoot\u5b98\u65b9\u7684\u573a\u666f\u542f\u52a8\u5668\uff0c\u6240\u4ee5\u6211\u4eec\u5bfc\u5165\u5b98\u65b9\u573a\u666f\u542f\u52a8\u5668\u7684\u65f6\u5019\u4e0d\u7528\u5199\u7248\u672c\u53f7\u3002\u4f46\u662f\u5728\u5f15\u5165\u7b2c\u4e09\u65b9\u573a\u666f\u542f\u52a8\u5668\u548c\u6ca1\u6709\u5728spring-boot-dependencies\u4e2d\u58f0\u660e\u7684\u4f9d\u8d56\u65f6\uff0c\u9700\u8981\u5199\u7248\u672c\u53f7\u3002</p> <ul> <li>\u5b98\u65b9\u63d0\u4f9b\u7684\u573a\u666f\uff1a\u547d\u540d\u4e3a\uff1aspring-boot-starter-*</li> <li>\u7b2c\u4e09\u65b9\u63d0\u4f9b\u573a\u666f\uff1a\u547d\u540d\u4e3a\uff1a*-spring-boot-starter</li> </ul> <p>4.2\u00a0\u81ea\u52a8\u914d\u7f6e spring-boot-starter-web\u00a0\u573a\u666f\u542f\u52a8\u5668\u4f1a\u5bfc\u5165\u00a0spring-boot-starter\uff0cspring-boot-starter\u662f\u6240\u6709starter\u7684starter\uff0c\u6700\u57fa\u7840\u6838\u5fc3starter\uff0cspring-boot-starter\u5bfc\u5165\u4e86 spring-boot-autoconfigure\uff0cspring-boot-autoconfigure\u5305\u91cc\u9762\u90fd\u6709SpringBoot\u5185\u7f6e\u7684\u5404\u79cd\u573a\u666f\u5668\u7684AutoConfiguration\u81ea\u52a8\u914d\u7f6e\u7c7b\uff0c\u867d\u7136\u5168\u573a\u666f\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u90fd\u5728 spring-boot-autoconfigure\u8fd9\u4e2a\u5305\uff0c\u4f46\u5e76\u4e0d\u662f\u5168\u90fd\u5f00\u542f\uff0c\u56e0\u4e3a\u81ea\u52a8\u914d\u7f6e\u7c7b\u4e0a\u90fd\u6709\u5404\u79cd\u6761\u4ef6\u6ce8\u89e3\uff0c\u53ea\u6709\u5728\u5bfc\u5165\u76f8\u5e94\u7684\u573a\u666f\u542f\u52a8\u5668\u4e4b\u540e\uff0c\u81ea\u52a8\u914d\u7f6e\u7c7b\u624d\u4f1a\u751f\u6548\uff0c\u4ece\u800c\u5b8c\u6210\u81ea\u52a8\u914d\u7f6e\u3002 @SpringBootApplication \u662f @SpringBootConfiguration\u3001@EnableAutoConfiguration\u3001@ComponentScan \u8fd9\u4e09\u4e2a\u6ce8\u89e3\u7684\u5408\u6210\u6ce8\u89e3\u3002@ComponentScan\u7684\u9ed8\u8ba4\u626b\u63cf\u8303\u56f4\u662f\u914d\u7f6e\u7c7b\u6240\u5728\u7684\u5305\u53ca\u5176\u6240\u6709\u5b50\u5305\uff0c\u5e76\u4e0d\u4f1a\u626b\u63cf\u5230spring-boot-autoconfigure\u5305\uff0c\u8d77\u5173\u952e\u4f5c\u7528\u7684\u662f@EnableAutoConfiguration\u6ce8\u89e3\u3002 Text Only<pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n@AutoConfigurationPackage\n@Import(AutoConfigurationImportSelector.class)\npublic @interface EnableAutoConfiguration {\n</code></pre> @EnableAutoConfiguration\u6ce8\u89e3\u4e0a\u9762\u7684@Import(AutoConfigurationImportSelector.class)\uff0cAutoConfigurationImportSelector\u7c7b\u6709\u4e2a\u65b9\u6cd5\u8868\u793a\u8fd9\u4e2a\u7ec4\u4ef6\u4f1a\u627eMETA-INF/spring.factories\u6587\u4ef6\uff08SpringBoot2.0\u662f\u8fd9\u4e2a\u6587\u4ef6\uff0c3.0\u6362\u6587\u4ef6\u540d\u4e86\uff09\uff0cspring.factories\u6587\u4ef6\u4e2d\u6307\u660e\u4e86\u81ea\u52a8\u914d\u7f6e\u7c7b\u7684\u5168\u7c7b\u540d\uff0c\u6279\u91cf\u52a0\u8f7d\u8fd9\u4e9b\u81ea\u52a8\u914d\u7f6e\u7c7b\u5c31\u53ef\u4ee5\u5b8c\u6210\u81ea\u52a8\u914d\u7f6e\u4e86\u3002  \u6240\u4ee5\u5982\u679c\u6211\u4eec\u81ea\u5df1\u4e5f\u60f3\u81ea\u52a8\u914d\u7f6e\u4e5f\u53ef\u4ee5\u5728META-INF\u76ee\u5f55\u4e0b\u6574\u4e00\u4e2aspring.factories\u6587\u4ef6  \u6bcf\u4e2a\u81ea\u52a8\u914d\u7f6e\u7c7b\u90fd\u53ef\u80fd\u6709\u8fd9\u4e2a\u6ce8\u89e3@EnableConfigurationProperties(xxxProperties.class)\uff0c\u7528\u6765\u628a\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u524d\u7f00\u7684\u5c5e\u6027\u503c\u5c01\u88c5\u5230 xxxProperties\u5c5e\u6027\u7c7b\u4e2d\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u6539\u914d\u7f6e\u6587\u4ef6\u7684\u503c\uff0c\u6838\u5fc3\u7ec4\u4ef6\u7684\u5e95\u5c42\u53c2\u6570\u90fd\u80fd\u4fee\u6539\u3002</p> <p>\u603b\u7ed3\u81ea\u52a8\u914d\u7f6e\u6d41\u7a0b\uff1a</p> <ol> <li>\u5bfc\u5165spring-boot-starter-web\u00a0\u573a\u666f\u542f\u52a8\u5668\u3002</li> <li>\u573a\u666f\u542f\u52a8\u5668\u5bfc\u5165spring-boot-starter\u3002</li> <li>spring-boot-starter\u5bfc\u5165\u4e86 spring-boot-autoconfigure\uff0cspring-boot-autoconfigure\u56ca\u62ec\u4e86\u6240\u6709\u5185\u7f6e\u573a\u666f\u5668\u7684\u6240\u6709\u914d\u7f6e\u7c7b\u3002</li> <li>@EnableAutoConfiguration\u7684@Import(AutoConfigurationImportSelector.class)\u627eMETA-INF/spring.factories\u6587\u4ef6\uff0c\u7136\u540e\u6279\u91cf\u52a0\u8f7d\u914d\u7f6e\u7c7b\u3002</li> <li>\u914d\u7f6e\u7c7b\u6839\u636e\u6761\u4ef6\u6ce8\u89e3\u548cxxxProperties\u5c5e\u6027\u7c7b\u5b8c\u6210\u914d\u7f6e\u3002</li> </ol> <p>4.3\u00a0\u81ea\u5b9a\u4e49Starter 1.\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff0c\u5e76\u4f7f\u7528@Configuration\u548c\u6761\u4ef6\u6ce8\u89e3\uff08\u5982@ConditionalOnClass\u3001@ConditionalOnMissingBean\u7b49\uff09\u6765\u6307\u5b9a\u4f55\u65f6\u5e94\u7528\u8fd9\u4e9b\u914d\u7f6e\u3002 Text Only<pre><code>@Configuration\npublic class MyServiceAutoConfiguration {\n\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0@ConditionalOnMissingBean // \u4ec5\u5728\u6ca1\u6709\u7528\u6237\u5b9a\u4e49\u7684bean\u65f6\u521b\u5efa\n\u00a0\u00a0\u00a0\u00a0public MyService myService() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new MyService();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 2.\u914d\u7f6espring.factories\uff0c\u4e3a\u4e86\u8ba9Spring Boot\u80fd\u591f\u53d1\u73b0\u4f60\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\uff0c\u9700\u8981\u5728src/main/resources/META-INF/spring.factories\u6587\u4ef6\u4e2d\u6dfb\u52a0\u76f8\u5e94\u7684\u914d\u7f6e\u3002 Text Only<pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\ com.example.MyServiceAutoConfiguration\n</code></pre> 3.\u9075\u5faaSpring Boot\u7684\u8bbe\u8ba1\u7406\u5ff5\u548c\u6700\u4f73\u5b9e\u8df5\uff0c\u521b\u5efa\u4e24\u4e2a\u6a21\u5757\uff1a\u4e00\u4e2a\u662f\u81ea\u52a8\u914d\u7f6e\u6a21\u5757\uff0c\u53e6\u4e00\u4e2a\u662fstarter\u6a21\u5757\u3002starter\u6a21\u5757\u53ea\u5305\u542bpom.xml\u6587\u4ef6\uff0c\u7528\u4e8e\u5f15\u5165\u81ea\u52a8\u914d\u7f6e\u6a21\u5757\u548c\u5176\u4ed6\u5fc5\u8981\u7684\u4f9d\u8d56\u3002 \u7406\u8bba\u4e0a\u53ef\u4ee5\u76f4\u63a5\u628a\u81ea\u52a8\u914d\u7f6e\u6a21\u5757\u5f53\u4f5cstarter\u6765\u7528\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u4f1a\u5931\u53bb\u4e0a\u8ff0\u63d0\u5230\u7684\u8bb8\u591a\u597d\u5904\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u9075\u5faaSpring Boot\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u901a\u8fc7\u521b\u5efa\u5355\u72ec\u7684starter\u6a21\u5757\u6765\u5c01\u88c5\u81ea\u52a8\u914d\u7f6e\u6a21\u5757\u53ca\u5176\u76f8\u5173\u4f9d\u8d56\uff0c\u4ece\u800c\u63d0\u9ad8\u9879\u76ee\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u7075\u6d3b\u6027\u3002 Text Only<pre><code>&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n&lt;groupId&gt;com.example&lt;/groupId&gt;\n&lt;artifactId&gt;my-spring-boot-starter&lt;/artifactId&gt;\n&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n\n&lt;dependencies&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u81ea\u52a8\u914d\u7f6e\u6a21\u5757 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;com.example&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;my-spring-boot-autoconfigure&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u5176\u4ed6\u4f9d\u8d56 --&gt;\n&lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre> 4.\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684Starter Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;com.example&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;my-spring-boot-starter&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/10.%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE-%E6%95%B4%E5%90%88MyBatis/","title":"10.\u6570\u636e\u8bbf\u95ee-\u6574\u5408MyBatis","text":"<p> \u7ea6 1126 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 23 \u5206\u949f</p> <p>\u4e00\u3001\u6574\u5408MyBatis\u7684\u6b65\u9aa4 1\u3001\u5f15\u5165\u573a\u666f\u542f\u52a8\u5668\u00a0mybatis-spring-boot-starter\u00a0\u548c\u00a0MySQL\u7684\u9a71\u52a8 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;2.1.4&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;mysql&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;scope&gt;runtime&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>2\u3001\u914d\u7f6e\u6570\u636e\u6e90 Text Only<pre><code>spring.datasource.url=jdbc:mysql://192.168.200.100:3306/demo\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\nspring.datasource.username=root\nspring.datasource.password=123456\nspring.datasource.type=com.zaxxer.hikari.HikariDataSource\n</code></pre></p> <p>3\u3001\u914d\u7f6eMyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 \u6709\u4e24\u4e2a\u9009\u62e9\uff1a</p> <ul> <li>\u521b\u5efamybatis-config.xml\u6587\u4ef6\uff0c\u50cf\u4e4b\u524d\u4e00\u6837\uff0c\u628aMyBatis\u7684\u6240\u6709\u914d\u7f6e\u90fd\u5199\u5728\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\uff1b\u53c8\u56e0\u4e3aSqlSessionFactory\u5bf9\u8c61\u7684\u521b\u5efa\u7531SpringBoot\u63a5\u7ba1\uff0c\u800c\u521b\u5efaSqlSessionFactory\u9700\u8981\u6307\u5b9aMyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u544a\u8bc9SpringBoot\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u5728SpringBoot\u7684\u914d\u7f6e\u6587\u4ef6application.yml\u6587\u4ef6\u4e2d\u6307\u5b9a\uff1a</li> </ul> Text Only<pre><code>mybatis:\n\u00a0\u00a0#\u6307\u5b9amybatis\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\n\u00a0\u00a0config-location: 'classpath:mybatis-config.xml'\n</code></pre> <ul> <li>\u76f4\u63a5\u5728SpringBoot\u7684\u914d\u7f6e\u6587\u4ef6application.yml\u4e2d\u5199MyBatis\u7684\u914d\u7f6e\uff0c\u63a8\u8350\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u8fd9\u4e2a\u624d\u662f\u6700\u4f73\u5b9e\u8df5\uff1a</li> </ul> <p>Text Only<pre><code>mybatis:\n\u00a0\u00a0#Mybatis\u7684\u5168\u5c40\u914d\u7f6e\n\u00a0\u00a0configuration:\n\u00a0\u00a0\u00a0\u00a0#\u8bbe\u7f6e\u53ef\u4ee5\u5c06\u6570\u636e\u5e93\u7684\u4e0b\u5212\u7ebf\u547d\u540d order_id \u6620\u5c04\u6210java\u7c7b\u7684\u9a7c\u5cf0\u547d\u540d orderId\n\u00a0\u00a0\u00a0\u00a0map-underscore-to-camel-case: true\n\u00a0\u00a0\u00a0\u00a0#\u5f53\u4f7f\u7528&lt;association&gt;\u65f6\uff0c\u5982\u4e0b\u4e24\u6761\u914d\u7f6e\u53ef\u4ee5\u8bbe\u7f6e\u5ef6\u8fdf\u52a0\u8f7d\n\u00a0\u00a0\u00a0\u00a0lazy-loading-enabled: true\n\u00a0\u00a0\u00a0\u00a0aggressive-lazy-loading: false\n\u00a0\u00a0\u00a0\u00a0#\u5f00\u542f\u4e8c\u7ea7\u7f13\u5b58\n\u00a0\u00a0\u00a0\u00a0cache-enabled: true\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e24\u79cd\u65b9\u5f0f\u4e0d\u80fd\u6df7\u5408\u4f7f\u7528\uff0c\u53ea\u80fd\u9009\u62e9\u5176\u4e2d\u4e00\u79cd\u3002</p> <p>4\u3001\u7f16\u5199Mapper SqlSessionFactory\u5df2\u7ecf\u88abSpringBoot\u63a5\u7ba1\uff0c\u6240\u4ee5\u8981\u60f3\u901a\u8fc7SqlSession\u62ff\u5230Mapper\u7684\u5b9e\u73b0\u7c7b\uff0c\u4e5f\u9700\u8981\u628aMapper\u63a5\u53e3\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\uff0c\u8fd9\u6837SpringBoot\u5c31\u77e5\u9053\u8981\u521b\u5efa\u54ea\u4e9bMapper\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u4e86\uff08\u5373UserMapper userMapper = session.getMapper(UserMapper.class);\u7531SpringBoot\u6765\u505a\uff0c\u663e\u7136\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u548c\u548c\u666e\u901a\u7684\u4f7f\u7528@Bean\u5411\u5bb9\u5668\u4e2d\u6ce8\u5165\u7ec4\u4ef6\u4e0d\u540c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981MyBatis\u6765\u505a\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528MyBatis\u63d0\u4f9b\u7684\u6ce8\u89e3\uff0c\u800c@Bean\u5219\u662fSpringBoot\u5c06\u7c7b\u7684\u5bf9\u8c61\u52a0\u5165\u5230\u5bb9\u5668\u4e2d\uff08\u4e0d\u80fd\u662f\u62bd\u8c61\u7c7b\u6216\u8005\u63a5\u53e3\uff09\uff09\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\u53ef\u5c06Mapper\u63a5\u53e3\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\uff1a</p> <ul> <li>\u5728\u63a5\u53e3\u4e0a\u6807\u6ce8@Mapper\u6ce8\u89e3</li> </ul> Text Only<pre><code>`@Mapper`\npublic interface UserMapper {\n\u00a0\u00a0\u00a0\u00a0User selectById(Long id);\n}\n</code></pre> <ul> <li>\u5728springboot\u4e3b\u7a0b\u5e8f\u7c7b\u4e0a\u4f7f\u7528@MapperScan\u6ce8\u89e3\uff0c\u63a8\u8350\u76f4\u63a5\u4f7f\u7528@MapperScan\u6ce8\u89e3</li> </ul> Text Only<pre><code>`@MapperScan(\"springboot.**.mapper\")`\n@SpringBootApplication\npublic class Springboot04DatasourceApplication {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringApplication.run(Springboot04DatasourceApplication.class, args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>5\u3001\u7f16\u5199SQL \u7f16\u5199SQL\u50cf\u4e4b\u524d\u4e00\u6837\u4e5f\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u5728XML\u6587\u4ef6\u4e2d\u7f16\u5199\u3002\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5982\u679c\u4f7f\u7528\u4e86MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6mybatis-config.xml\u6587\u4ef6\uff0c\u90a3\u4e48\u53ef\u4ee5\u50cf\u4e4b\u524d\u90a3\u6837\u5728mybatis-config.xml\u4e2d\u5f15\u5165XML\u6620\u5c04\u6587\u4ef6\uff1b\u5982\u679c\u6ca1\u6709\u521b\u5efaMyBatis\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u662f\u76f4\u63a5\u5728SpringBoot\u7684\u914d\u7f6e\u6587\u4ef6application.yml\u4e2d\u5199MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5728application.yml\u5f15\u5165XML\u6620\u5c04\u6587\u4ef6\u3002</li> </ul> Text Only<pre><code>mybatis:\n `#mapper\u6587\u4ef6\u4f4d\u7f6e`\n `mapper-locations: 'classpath:mapper/*.xml'`\n\n\u00a0\u00a0#Mybatis\u7684\u5168\u5c40\u914d\u7f6e\n\u00a0\u00a0configuration:\n\u00a0\u00a0\u00a0\u00a0#\u8bbe\u7f6e\u53ef\u4ee5\u5c06\u6570\u636e\u5e93\u7684\u4e0b\u5212\u7ebf\u547d\u540d order_id \u6620\u5c04\u6210java\u7c7b\u7684\u9a7c\u5cf0\u547d\u540d orderId\n\u00a0\u00a0\u00a0\u00a0map-underscore-to-camel-case: true\n\u00a0\u00a0\u00a0\u00a0#\u5f53\u4f7f\u7528&lt;association&gt;\u65f6\uff0c\u5982\u4e0b\u4e24\u6761\u914d\u7f6e\u53ef\u4ee5\u8bbe\u7f6e\u5ef6\u8fdf\u52a0\u8f7d\n\u00a0\u00a0\u00a0\u00a0lazy-loading-enabled: true\n\u00a0\u00a0\u00a0\u00a0aggressive-lazy-loading: false\n\u00a0\u00a0\u00a0\u00a0#\u5f00\u542f\u4e8c\u7ea7\u7f13\u5b58\n\u00a0\u00a0\u00a0\u00a0cache-enabled: true\n</code></pre> <ul> <li>\u5728Mapper\u63a5\u53e3\u7684\u65b9\u6cd5\u4e0a\u4f7f\u7528\u6ce8\u89e3\u3002</li> </ul> <p>\u4ee5\u4e0a\u7f16\u5199SQL\u7684\u4e24\u79cd\u65b9\u5f0f\u53ef\u4ee5\u6df7\u7528\u3002</p> <p>\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3\uff1a 1\u3001\u628aMyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u5199\u5728SpringBoot\u7684\u914d\u7f6e\u6587\u4ef6application.yml\u4e2d\uff0c\u4e0d\u8981\u4f7f\u7528XML\u7f16\u5199MyBatis\u7684\u6838\u5fc3\u914d\u7f6e\u3002 2\u3001\u5728springboot\u4e3b\u7a0b\u5e8f\u7c7b\u4e0a\u4f7f\u7528@MapperScan\u6ce8\u89e3\u628aMapper\u63a5\u53e3\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\uff0c\u8fd9\u6837\u81ea\u52a8\u6ce8\u5165\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u62ff\u5230Mapper\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u4e86\u3002 3\u3001\u4f7f\u7528\u6ce8\u89e3\u5f00\u53d1\u7f16\u5199SQL\uff0c\u5e76\u642d\u914dJava15\u7684Text Block\u8bed\u6cd5\uff0c\u5341\u5206\u4f18\u96c5\u4e14\u7f8e\u89c2\uff0c\u53ef\u5b8c\u5168\u6452\u5f03\u7f16\u5199XML\u6587\u4ef6\u7684\u65b9\u5f0f\u3002</p> <p>\u4e8c\u3001\u81ea\u52a8\u914d\u7f6e\u539f\u7406 MyBatis\u7684\u573a\u666f\u542f\u52a8\u5668\u00a0mybatis-spring-boot-starter\u00a0\u5f15\u5165\u4e86\u00a0JDBC\u573a\u666f\u542f\u52a8\u5668 spring-boot-starter-jdbc\uff0cJDBC\u573a\u666f\u542f\u52a8\u5668\u5f15\u5165\u4e86\u00a0HikariCP\u00a0\u6570\u636e\u6e90\uff0cspring-boot-starter-jdbc\u4e2d\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u6709\uff1a</p> <ul> <li>org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration\uff0c\u6570\u636e\u6e90\u7684\u81ea\u52a8\u914d\u7f6e\uff0c\u6240\u6709\u548c\u6570\u636e\u6e90\u6709\u5173\u7684\u914d\u7f6e\u90fd\u7ed1\u5b9a\u5728DataSourceProperties\uff0c\u9ed8\u8ba4\u4f7f\u7528 HikariDataSource\u3002</li> <li>org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration\uff0c\u7ed9\u5bb9\u5668\u4e2d\u653e\u4e86JdbcTemplate\u64cd\u4f5c\u6570\u636e\u5e93\u3002</li> <li>org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration</li> <li>org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration\uff0c\u57fa\u4e8eXA\u4e8c\u9636\u63d0\u4ea4\u534f\u8bae\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u6570\u636e\u6e90\u3002</li> <li>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration\uff0c\u652f\u6301\u4e8b\u52a1\u3002</li> </ul> <p>JDBC\u573a\u666f\u542f\u52a8\u5668\u5bfc\u5165\u4e4b\u540e\u5177\u6709\u7684\u5e95\u5c42\u80fd\u529b\uff1a\u6570\u636e\u6e90\u3001JdbcTemplate\u3001\u4e8b\u52a1</p> <p>mybatis-spring-boot-starter\u00a0\u662f\u7b2c\u4e09\u65b9\u7684\u573a\u666f\u542f\u52a8\u5668\uff0c\u5bfc\u4e86 mybatis-spring-boot-autoconfigure\uff08mybatis\u7684\u81ea\u52a8\u914d\u7f6e\u5305\uff09\uff0c\u5176\u4e2d\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u6709\uff1a</p> <ul> <li>org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration</li> <li>org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration<ul> <li>\u5fc5\u987b\u5728\u6570\u636e\u6e90\u914d\u7f6e\u597d\u4e4b\u540e\u624d\u914d\u7f6e\u3002</li> <li>\u6240\u6709\u914d\u7f6e\u7ed1\u5b9a\u5728MybatisProperties\u3002</li> <li>\u7ed9\u5bb9\u5668\u4e2dSqlSessionFactory\u7ec4\u4ef6\uff0c\u521b\u5efa\u548c\u6570\u636e\u5e93\u7684\u4e00\u6b21\u4f1a\u8bdd\u3002</li> <li>\u7ed9\u5bb9\u5668\u4e2dSqlSessionTemplate\u7ec4\u4ef6\uff0c\u64cd\u4f5c\u6570\u636e\u5e93\u3002</li> </ul> </li> </ul> <p>\u6bcf\u4e2aMapper\u63a5\u53e3\u7684\u4ee3\u7406\u5bf9\u8c61\u662f\u600e\u4e48\u521b\u5efa\u653e\u5230\u5bb9\u5668\u4e2d\uff0c\u8be6\u89c1@MapperScan\u539f\u7406\uff1a\u5229\u7528@Import(MapperScannerRegistrar.class)\u6279\u91cf\u7ed9\u5bb9\u5668\u4e2d\u6ce8\u518c\u7ec4\u4ef6\u3002\u89e3\u6790\u6307\u5b9a\u7684\u5305\u8def\u5f84\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u7c7b\uff0c\u4e3a\u6bcf\u4e00\u4e2aMapper\u63a5\u53e3\u7c7b\uff0c\u521b\u5efaBean\u5b9a\u4e49\u4fe1\u606f\uff0c\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/2.%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/","title":"2.\u73af\u5883\u914d\u7f6e","text":"<p> \u7ea6 1237 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 25 \u5206\u949f</p> <p>\u4e00\u3001\u901a\u8fc7SpringApplication\u914d\u7f6e\u53c2\u6570 \u542f\u52a8SpringBoot\u5e38\u7528\u7684\u5199\u6cd5\u662f\uff1a Text Only<pre><code>@SpringBootApplication\npublic class Main {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ApplicationContext applicationContext = SpringApplication.run(Main.class, args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> SpringApplication.run(Main.class, args);\u70b9\u8fdb\u53bb\u53d1\u73b0\u5176\u5b9e\u662fnew SpringApplication(Main.class);\uff0c\u6240\u4ee5\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u5199\u6cd5\uff0c\u5e76\u4e14SpringApplication\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9bsetter\u65b9\u6cd5\u7528\u4e8e\u914d\u7f6e\u542f\u52a8\u53c2\u6570 Text Only<pre><code>@SpringBootApplication\npublic class Main {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringApplication application = new SpringApplication(Main.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0application.setBannerMode(Banner.Mode.OFF);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.setProperty(\"server.port\", \"8888\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0application.setDefaultProperties(properties);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ApplicationContext applicationContext = application.run(args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8fd8\u53ef\u4ee5\u4f7f\u7528FluentBuilder API\uff08\u6d41\u5f0f\u5199\u6cd5\uff09\uff1a Text Only<pre><code>@SpringBootApplication\npublic class Main {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n  new SpringApplicationBuilder()\n\u00a0\u00a0\u00a0\u00a0  .sources(Parent.class)\n\u00a0\u00a0  \u00a0\u00a0.child(Application.class)\n\u00a0\u00a0  \u00a0\u00a0.bannerMode(Banner.Mode.OFF)\n\u00a0\u00a0\u00a0  \u00a0.run(args);\n }\n}\n</code></pre></p> <p>\u4e8c\u3001Profiles\u6587\u4ef6 2.1\u3001Profile\u914d\u7f6e\u6587\u4ef6</p> <ul> <li>application.properties\u662f\u4e3b\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u4efb\u610f\u65f6\u5019\u90fd\u751f\u6548\uff0c\u8fd8\u53ef\u4ee5\u7528 application-{profile}.properties \u6307\u5b9a\u7279\u5b9a\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u5f00\u53d1\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6application-dev.properties\uff08{profile}\u53ef\u4ee5\u4efb\u610f\u6307\u5b9a\uff0c\u4e0d\u5fc5\u975e\u5f97\u7528dev\u8868\u793a\u5f00\u53d1\u73af\u5883\uff09\u3002\u5982\u679c\u5728\u4e24\u79cd\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b58\u5728\u76f8\u540c\u7684\u914d\u7f6e\uff0c\u90a3\u4e48profile\u914d\u7f6e\u6587\u4ef6\u7684\u4f18\u5148\u7ea7\u8981\u9ad8\u4e8e\u4e3b\u914d\u7f6e\u6587\u4ef6\u3002</li> <li>\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff1aSpringBoot \u5e94\u7528\u542f\u52a8\u65f6\u4f1a\u5728 \u7c7b\u8def\u5f84\u3001\u7c7b\u8def\u5f84\u4e0b\u7684/config\u5305\u53ca\u5176\u5b50\u5305\u00a0\u4e0b\u5bfb\u627eapplication.properties\u548capplication.yaml\uff0c\u4f18\u5148\u7ea7\u662f config\u7684\u5b50\u5305 &gt;\u00a0config\u5305 &gt;\u00a0\u7c7b\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u627e\u5230\u7684\u914d\u7f6e\u8986\u76d6\u524d\u9762\u7684\u914d\u7f6e\u3002</li> <li>\u540c\u65f6\u5b58\u5728properties\u6587\u4ef6\u548cyaml\u6587\u4ef6\u65f6\uff0cproperties\u914d\u7f6e\u6587\u4ef6\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8eyaml\u914d\u7f6e\u3002</li> </ul> <p>2.2\u3001\u6fc0\u6d3b\u73af\u5883 \u5728\u4e3b\u914d\u7f6e\u6587\u4ef6\u4e2d\u6fc0\u6d3b\u6307\u5b9a\u73af\u5883\uff1a Text Only<pre><code>spring.profiles.active=dev,test\n</code></pre> SpringBoot\u7684\u9ed8\u8ba4\u73af\u5883\u53ebdefault\uff0c\u4f7f\u7528spring.profiles.active\u4e0d\u4f1a\u8986\u76d6default\u73af\u5883\uff0c\u6bd4\u5982\u589e\u52a0\u4e0a\u8ff0\u914d\u7f6e\u4e4b\u540e\u4e00\u5171\u5b58\u5728default\\dev\\test\u4e09\u79cd\u73af\u5883\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u9ed8\u8ba4\u73af\u5883\uff0c\u4f46\u662f\u4e0d\u63a8\u8350\u4f7f\u7528\uff1a Text Only<pre><code>spring.profiles.default=dev\n</code></pre> \u8fd8\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u542f\u52a8\u53c2\u6570\u4e0a\u6307\u5b9a\u6fc0\u6d3b\u73af\u5883\uff1a Text Only<pre><code>--spring.profiles.active=dev,test\n</code></pre></p> <p>2.3\u3001\u5305\u542b\u73af\u5883 \u5305\u542b\u73af\u5883\u7684\u914d\u7f6e\u53ea\u80fd\u5199\u5728\u4e3b\u914d\u7f6e\u6587\u4ef6application.properties\u4e2d\uff1b\u6fc0\u6d3b\u73af\u5883\u53ea\u4f1a\u751f\u6548\u6307\u5b9a\u7684\u73af\u5883\uff0c\u4f46\u662f\u5305\u542b\u73af\u5883\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u4f1a\u751f\u6548\u3002 Text Only<pre><code>spring.profiles.include=aaa,bbb\n</code></pre></p> <p>2.4\u3001\u73af\u5883\u5206\u7ec4 \u53ef\u4ee5\u7ed9\u591a\u4e2aprofile\u914d\u7f6e\u6587\u4ef6\u5206\u7ec4\uff0c\u7136\u540e\u6fc0\u6d3b\u6307\u5b9a\u5206\u7ec4\uff0c\u6bd4\u5982prod\u7ec4\uff1a Text Only<pre><code>spring.profiles.group.prod=db,mq\n</code></pre></p> <p>2.5\u3001@Profile\u6ce8\u89e3 @Profile\u6807\u6ce8\u5728\u7ec4\u4ef6\u4e0a\u53ef\u4ee5\u8ba9\u7ec4\u4ef6\u5728\u6307\u5b9a\u7684\u73af\u5883\u4e0b\u624d\u6ce8\u5165\u5230IOC\u5bb9\u5668\u4e2d\u3002\u8fd8\u53ef\u4ee5\u6807\u6ce8\u5728@Configuration\u7c7b\u4e0a\uff0c\u6216\u8005@Bean\u65b9\u6cd5\u4e0a\uff0c\u5373\u53ea\u5728\u6307\u5b9a\u73af\u5883\u4e0b\u914d\u7f6e\u7c7b\u624d\u751f\u6548\u3002 Text Only<pre><code>@Profile(\"dev\")\n@Component\n@ConfigurationProperties(prefix = \"mycar\")\npublic class Car {\n}\n</code></pre></p> <p>2.6\u3001\u52a0\u8f7d\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6 \u65b9\u5f0f\u4e00\uff1a@PropertySource\u52a0\u8f7d\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u9700\u8981\u6807\u6ce8\u5728@Configuration\u7c7b\u4e0a\uff09\uff0c\u914d\u7f6e\u6587\u4ef6\u7684\u540d\u5b57\u53ef\u4ee5\u4efb\u610f\uff0c\u800c\u6fc0\u6d3b\u73af\u5883\u548c\u5305\u542b\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6\u540d\u5b57\u5fc5\u987b\u5e26\u6709\u00a0application- \u524d\u7f00\u3002 Text Only<pre><code>@PropertySource(\"classpath:aaa.properties\")\n@Configuration\npublic class MyConfig {\n}\n</code></pre> \u65b9\u5f0f\u4e8c\uff1a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 spring.config.import \u5bfc\u5165\u989d\u5916\u914d\u7f6e Text Only<pre><code>spring.config.import=classpath:/aaa.properties\n</code></pre></p> <p>\u6700\u4f73\u5b9e\u6218\uff1a \u751f\u6548\u7684\u73af\u5883 = \u6fc0\u6d3b\u7684\u73af\u5883/\u9ed8\u8ba4\u73af\u5883 + \u5305\u542b\u7684\u73af\u5883 \uff1a</p> <ul> <li>\u57fa\u7840\u7684\u914d\u7f6emybatis\u3001log\u3001xxx\uff1a\u5199\u5230\u5305\u542b\u73af\u5883\u4e2d</li> <li>\u9700\u8981\u52a8\u6001\u5207\u6362\u53d8\u5316\u7684 db\u3001redis\uff1a\u5199\u5230\u6fc0\u6d3b\u7684\u73af\u5883\u4e2d</li> </ul> <p>\u4e09\u3001\u5916\u90e8\u5316\u914d\u7f6e \u5c06SpringBoot\u5e94\u7528\u6253\u6210jar\u5305\u4e4b\u540e\uff0c\u5728\u540c\u4e00\u5c42\u76ee\u5f55\u4e0b\u653e\u4e00\u4e2aapplication.properties\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u4f1a\u751f\u6548jar\u5916\u7684application.properties\uff0cjar\u5305\u5185\u7684application.properties\u4e0d\u4f1a\u751f\u6548\uff0c\u4ece\u800c\u8fbe\u5230\u4e0d\u7528\u91cd\u65b0\u6253\u5305\u5e94\u7528\u5373\u53ef\u4fee\u6539\u914d\u7f6e\u7684\u6548\u679c\uff0c\u7b80\u5316\u4e86\u8fd0\u7ef4\u3002 jar\u5305\u5916\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff1aSpringBoot \u5e94\u7528\u542f\u52a8\u65f6\u4f1a\u5728 \u5f53\u524d\u8def\u5f84\u3001\u5f53\u524d\u8def\u5f84\u4e0b\u7684/config\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55 \u4e0b\u5bfb\u627eapplication.properties\u548capplication.yaml\uff0c\u4f18\u5148\u7ea7\u662f config\u7684\u5b50\u76ee\u5f55 &gt;\u00a0config\u76ee\u5f55 &gt; \u5f53\u524d\u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u627e\u5230\u7684\u914d\u7f6e\u8986\u76d6\u524d\u9762\u7684\u914d\u7f6e\u3002</p> <p>\u56db\u3001\u547d\u4ee4\u884c\u914d\u7f6e \u6240\u6709\u53c2\u6570\u5747\u53ef\u7531\u547d\u4ee4\u884c\u4f20\u5165\uff0c\u4f7f\u7528 --\u53c2\u6570\u9879=\u53c2\u6570\u503c\uff0c\u5c06\u4f1a\u88ab\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u5e76\u4f18\u5148\u4e8e\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u4e94\u3001\u914d\u7f6e\u4f18\u5148\u7ea7 5.1\u00a0\u5404\u79cd\u914d\u7f6e\u7684\u4f18\u5148\u7ea7 \u4f18\u5148\u7ea7\u7531\u4f4e\u5230\u9ad8\uff08\u540e\u9762\u7684\u4f1a\u8986\u76d6\u524d\u9762\u7684\uff09\uff1a</p> <ol> <li>\u9ed8\u8ba4\u5c5e\u6027\uff08\u901a\u8fc7SpringApplication.setDefaultProperties\u6307\u5b9a\u7684\uff09</li> <li>@PropertySource\u6307\u5b9a\u52a0\u8f7d\u7684\u914d\u7f6e\uff08\u9700\u8981\u5199\u5728@Configuration\u7c7b\u4e0a\u624d\u53ef\u751f\u6548\uff09</li> <li>\u914d\u7f6e\u6587\u4ef6\uff08application.properties/yml\u7b49\uff09</li> <li>RandomValuePropertySource\u652f\u6301\u7684 random.* \u914d\u7f6e\uff08\u5982\uff1a@Value(\"${random.int}\")\uff09</li> <li>OS \u73af\u5883\u53d8\u91cf</li> <li>Java \u7cfb\u7edf\u5c5e\u6027\uff08System.getProperties()\uff09</li> <li>JNDI \u5c5e\u6027\uff08\u6765\u81eajava:comp/env\uff09</li> <li>ServletContext \u521d\u59cb\u5316\u53c2\u6570</li> <li>ServletConfig \u521d\u59cb\u5316\u53c2\u6570</li> <li>SPRING_APPLICATION_JSON\u5c5e\u6027\uff08\u5185\u7f6e\u5728\u73af\u5883\u53d8\u91cf\u6216\u7cfb\u7edf\u5c5e\u6027\u4e2d\u7684 JSON\uff09</li> <li>\u547d\u4ee4\u884c\u53c2\u6570</li> <li>\u6d4b\u8bd5\u5c5e\u6027\u3002(@SpringBootTest\u8fdb\u884c\u6d4b\u8bd5\u65f6\u6307\u5b9a\u7684\u5c5e\u6027)</li> <li>\u6d4b\u8bd5\u7c7b@TestPropertySource\u6ce8\u89e3</li> <li>Devtools \u8bbe\u7f6e\u7684\u5168\u5c40\u5c5e\u6027\u3002($HOME/.config/spring-boot)</li> </ol> <p>\u7ed3\u8bba\uff1a\u914d\u7f6e\u53ef\u4ee5\u5199\u5230\u5f88\u591a\u4f4d\u7f6e\uff0c\u5e38\u89c1\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\uff1a\u547d\u4ee4\u884c&gt; \u914d\u7f6e\u6587\u4ef6&gt; springapplication\u914d\u7f6e</p> <p>5.2\u00a0\u5305\u5916 &gt;\u00a0\u5305\u5185 jar\u5305\u5916\u7684application-{profile}.properties/yml &gt; jar \u5305\u5916\u7684application.properties/yml &gt;\u00a0 jar \u5305\u5185\u7684application-{profile}.properties/yml &gt; jar \u5305\u5185\u7684application.properties/yml</p> <p>\u603b\u7ed3\uff1a</p> <ul> <li>\u547d\u4ee4\u884c &gt;\u00a0\u5305\u5916 &gt;\u00a0\u5305\u5185</li> <li>profile\u914d\u7f6e &gt; \u9ed8\u8ba4\u914d\u7f6e</li> <li>properties\u914d\u7f6e &gt; yaml\u914d\u7f6e</li> </ul> <p></p> <p>\u516d\u3001\u5c5e\u6027\u5360\u4f4d\u7b26 \u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u4f7f\u7528 ${name:default}\u5f62\u5f0f\u53d6\u51fa\u4e4b\u524d\u914d\u7f6e\u8fc7\u7684\u503c\uff1a Text Only<pre><code>app.name=MyApp\napp.description=${app.name} is a Spring Boot application written by ${username:Unknown}\n</code></pre></p> <p>\u53ef\u4ee5\u4f7f\u7528@Value\u3001@ConfigurationProperties\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u503c\u7ed1\u5b9a\u5230\u7ec4\u4ef6\u7684\u5c5e\u6027\u4e2d\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/3.%E6%97%A5%E5%BF%97/","title":"3.\u65e5\u5fd7","text":"<p> \u7ea6 1638 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 33 \u5206\u949f</p> <p>\u4e00\u3001\u65e5\u5fd7\u6846\u67b6 1\u3001\u5e38\u89c1\u65e5\u5fd7\u6846\u67b6\u7684\u4ecb\u7ecd \u65e5\u5fd7\u95e8\u9762\u662f\u5b9a\u4e49\u6807\u51c6\u7684\u63a5\u53e3\uff0c\u65e5\u5fd7\u5b9e\u73b0\u662f\u63a5\u53e3\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5b83\u4fe9\u7684\u5173\u7cfb\u4e0eJDBC\u548c\u6570\u636e\u5e93\u9a71\u52a8\u7684\u5173\u7cfb\u4e00\u6837\u3002\u95e8\u9762\u6a21\u5f0f\uff08\u5916\u89c2\u6a21\u5f0f\uff09\u5c5e\u4e8e\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u7684\u4e00\u79cd\u3002</p> \u65e5\u5fd7\u95e8\u9762 \u65e5\u5fd7\u5b9e\u73b0 JCL(Jakarta Commons Logging)SLF4j(Simple Logging Facade for Java\uff09 Log4jJUL(java.util.logging)LogbackLog4j2 <p>\u53d1\u5c55\u5386\u53f2\u5982\u4e0b\uff1a</p> <ol> <li> <p>log4j\uff1aApache\u5f00\u53d1\u7684\uff0c\u6700\u65e9\u7684Java\u65e5\u5fd7\u6846\u67b6\uff0c\u73b0\u5728\u5df2\u7ecf\u4e0d\u7528\u4e86\u3002</p> </li> <li> <p>JUL\uff1asun\u516c\u53f8\u6a21\u4efflog4j\u5f00\u53d1\u7684\uff0c\u52a0\u5165\u5230\u4e86JDK\u3002</p> </li> <li>JCL(Jakarta Commons Logging)\uff1a\u4e3a\u4e86\u89e3\u8026\u65e5\u5fd7\u63a5\u53e3\u4e0e\u5b9e\u73b0\uff0cApache \u63a8\u51fa\u4e86 JCL(Jakarta Commons Logging)\uff0cJCL\u5b9a\u4e49\u4e86\u4e00\u5957\u65e5\u5fd7\u63a5\u53e3\uff0c\u5177\u4f53\u5b9e\u73b0\u5219\u7531 Log4j \u6216 JUL \u6765\u5b8c\u6210\u3002</li> <li>Slf4j&amp;Logback\uff1a\u5f00\u53d1log4j\u7684\u5927\u4f6c\u5173\u4e8eJCL\u4e0eApache\u4ea7\u751f\u5206\u6b67\u540e\u72ec\u7acb\u521b\u5efa\u4e86 Slf4j \u548c Logback \u4e24\u4e2a\u9879\u76ee\u3002Slf4j \u662f\u4e00\u4e2a\u65e5\u5fd7\u95e8\u9762\uff0c\u53ea\u63d0\u4f9b\u63a5\u53e3\uff0cLogback \u63d0\u4f9b\u4e86\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u5b83\u76f8\u8f83\u4e8e log4j \u6709\u66f4\u5feb\u7684\u6267\u884c\u901f\u5ea6\u548c\u66f4\u5b8c\u5584\u7684\u529f\u80fd\u3002</li> <li>Log4j2\uff1a\u6b64\u65f6Apache\u62e5\u6709JCL&amp;log4j\u00a0\u7684\u7ec4\u5408\uff0c\u4f46log4j\u548cJUL\u90fd\u5e72\u4e0d\u8fc7Logback\uff0c\u4e3a\u4e86\u9632\u6b62 JCL&amp;Log4j \u88ab Slf4j&amp;Logback \u7ec4\u5408\u53d6\u4ee3\uff0cApache\u63a8\u51faLog4j2\uff0c\u6027\u80fd\u4e0a\u8fdc\u8fdc\u8d85\u8fc7Log4j\u3002</li> </ol> <p>2\u3001SLF4j\u7684\u4f7f\u7528 \u5f15\u5165SLF4j\u7684\u51e0\u79cd\u4f7f\u7528\u65b9\u5f0f\uff1a</p> <ol> <li>slf4j-api.jar :\u00a0\u53ea\u4f7f\u7528\u95e8\u9762\uff0c\u65e5\u5fd7\u4f1a\u5199\u5230/dev/null\u3002</li> <li>slf4j-api.jar &amp; logback-classic.jar &amp; logback-core.jar :\u00a0\u7ecf\u5178\u7ec4\u5408\uff0c\u4e5f\u662f\u6700\u5e38\u7528\u7684\u7ec4\u5408\u3002</li> <li>slf4j-api.jar &amp; slf4j-reload4j.jar &amp; reload4j.jar :\u00a0\u65e5\u5fd7\u5b9e\u73b0\u662freload4j.jar\uff0c\u4e0d\u662f\u539f\u751f\u652f\u6301slf4j\u7684\u5b9e\u73b0\uff0c\u6240\u4ee5\u9700\u8981\u5f15\u5165\u9002\u914d\u5c42slf4j-reload4j.jar\u8f6c\u6362\u4e00\u4e0b\uff08\u9002\u914d\u5668\u6a21\u5f0f\uff09\u3002</li> <li>slf4j-api.jar &amp; slf4j-jdk14.jar :\u00a0 \u65e5\u5fd7\u5b9e\u73b0\u662fJVM\uff0c\u9700\u8981\u5f15\u5165\u9002\u914d\u5c42slf4j-jdk14.jar\u3002</li> <li>slf4j-api.jar &amp; slf4j-simple.jar :\u00a0\u65e5\u5fd7\u5b9e\u73b0\u662fslf4j-simple.jar\u3002</li> <li>slf4j-api.jar &amp; slf4j-nop.jar :\u00a0\u65e5\u5fd7\u5b9e\u73b0\u662fslf4j-nop.jar\uff0c\u76f8\u5f53\u4e8e\u6ca1\u6709\u5b9e\u73b0\u3002</li> </ol> <p> \u5f53\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u5f15\u5165\u5176\u4ed6jar\u5305\uff0c\u800c\u8fd9\u4e9bjar\u5305\u4f7f\u7528\u4e86\u5176\u4ed6\u65e5\u5fd7\u6846\u67b6\u6bd4\u5982JCL\u3001log4j\u3001JUL\uff0c\u4e3a\u4e86\u7edf\u4e00\u65e5\u5fd7\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f60\u5c31\u9700\u8981\u89e3\u51b3\u9057\u7559API\u95ee\u9898\uff08Bridging legacy APIs\uff09\uff0c\u5982\u4e0b\u56fe\uff0c\u4ee5\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e3a\u4f8b\u8bf4\u660e\uff0c\u4f60\u7684\u9879\u76ee\u4f7f\u7528\u7684\u65e5\u5fd7\u6846\u67b6\u7684\u7ec4\u5408\u662f slf4j&amp;logback\uff0c\u4f46\u662f\u5f15\u5165\u7684\u4f9d\u8d56\u5206\u522b\u4f7f\u7528\u4e86JCL\u3001log4j\u3001JUL\uff0c\u4e3a\u4e86\u5c06\u65e5\u5fd7\u5b9e\u73b0\u7edf\u4e00\u6210logback\uff0c\u90a3\u4e48\u9996\u5148\u9700\u8981\u6392\u9664JCL\u3001log4j\u3001JUL\u7684\u4f9d\u8d56\uff0c\u4f46\u662f\u6392\u9664\u4e4b\u540e\u5f15\u5165\u7684jar\u4f1a\u62a5\u9519\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u5206\u522b\u518d\u5f15\u5165jcl-over-slf4j.jar\u3001log4j-over-slf4j.jar\u3001jul-slf4j.jar\u4e09\u4e2ajar\uff0c\u8fd9\u4e09\u4e2ajar\u5728\u5b9e\u73b0\u4e0a\u662f\u8c03\u7528slf4j\u7684api\uff0c\u4ece\u800c\u5b8c\u6210\u4e86\u6865\u63a5\u3002  \u4f7f\u7528slf4j\u6253\u5370\u65e5\u5fd7\uff1a Text Only<pre><code>import org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\npublic class HelloWorld {\n\u00a0\u00a0 \u00a0public static void main(String[] args) {\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0Logger logger = LoggerFactory.getLogger(HelloWorld.class);\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0logger.info(\"Hello World\");\n\u00a0\u00a0 \u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001SpringBoot\u7684\u65e5\u5fd7 \u5927\u81f4\u7406\u89e3\uff1aSpringBoot\u4f7f\u7528slf4j\u4f5c\u4e3a\u65e5\u5fd7\u95e8\u9762\uff0clogback\u4f5c\u4e3a\u65e5\u5fd7\u5b9e\u73b0\uff1bSpring\u4f7f\u7528JCL\u4f5c\u4e3a\u95e8\u9762\uff0cspring-jcl\u4f5c\u4e3a\u65e5\u5fd7\u5b9e\u73b0\uff0cspring-jcl\u7684\u5b9e\u73b0\u6709\u4e00\u4e2aSlf4jAdapter\uff0c\u6240\u4ee5\u5b83\u4e5f\u662f\u59d4\u6258\u7ed9\u4e86slf4j\u3002  \u5728spring-boot-autoconfigure\u4e2d\u7684logging\u5305\u4e2d\u6ca1\u6709xxxAutoConfiguration\u7c7b\uff0c\u8bf4\u660e\u65e5\u5fd7\u6ca1\u6709\u81ea\u52a8\u914d\u7f6e\u7c7b\uff0c\u8fd9\u662f\u56e0\u4e3axxxAutoConfiguration\u662f\u5bb9\u5668\u521b\u5efa\u597d\u4e4b\u540e\u5f80\u5bb9\u5668\u91cc\u9762\u6ce8\u518c\u7684\u7ec4\u4ef6\uff0c\u800c\u65e5\u5fd7\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u5c31\u9700\u8981\u80fd\u7528\uff0c\u6240\u4ee5\u65e5\u5fd7\u5e76\u4e0d\u662f\u4f7f\u7528\u81ea\u52a8\u914d\u7f6e\u7c7b\u8fdb\u884c\u914d\u7f6e\uff0c\u800c\u662f\u5229\u7528\u76d1\u542c\u5668\u673a\u5236\u914d\u7f6e\u7684\u3002 \u5728SpringBoot\u4e2d\u4f7f\u7528\u65e5\u5fd7\u53ef\u4ee5\u50cf\u524d\u9762\u90a3\u6837\u7528LoggerFactory\u521b\u5efa\u4e00\u4e2aLogger\uff0c\u4e5f\u53ef\u4ee5\u5bfc\u5165lombok\uff0c\u7136\u540e\u5229\u7528@Slf4j\u6ce8\u89e3\u6807\u6ce8\u5728\u7c7b\u4e0a\uff0c\u76f8\u5f53\u4e8e\u7ed9\u7c7b\u52a0\u4e86\u4e00\u4e2a\u8fd9\u6837\u7684\u5b9e\u4f8b\u53d8\u91cf\uff1a Text Only<pre><code>Logger log = LoggerFactory.getLogger(XXX.class);\n</code></pre> \u6bd4\u5982\uff1a Text Only<pre><code>@SpringBootApplication\n@Slf4j\npublic class SpringbootDemoApplication {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringApplication.run(SpringbootDemoApplication.class, args);\n\u00a0 \u00a0 \u00a0 \u00a0\u00a0log.info(\"Hello Slf4j, \u53c2\u6570args: {}\", Arrays.toString(args));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u65e5\u5fd7\u7684\u914d\u7f6e SpringBoot\u7684\u65e5\u5fd7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4ee5logging\u5f00\u59cb\u3002\u9ed8\u8ba4\u503c\u653e\u5728spring-boot\u5305\u7684additional-spring-configuration-metadata.json\u6587\u4ef6\u4e2d\u3002 1\u3001\u65e5\u5fd7\u7684\u683c\u5f0f Text Only<pre><code>2024-05-25T14:57:15.368+08:00\u00a0\u00a0INFO 22024 --- [springboot-demo] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0main] o.e.s.SpringbootDemoApplication\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: Starting SpringbootDemoApplication using Java 22.0.1 with PID 22024 (D:\\Project\\IdeaProjects\\springboot-demo\\target\\classes started by Jmoon in D:\\Project\\IdeaProjects\\springboot-demo)\n2024-05-25T14:57:15.372+08:00\u00a0\u00a0INFO 22024 --- [springboot-demo] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0main] o.e.s.SpringbootDemoApplication\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: No active profile set, falling back to 1 default profile: \"default\"\n2024-05-25T14:57:16.101+08:00 ERROR 22024 --- [springboot-demo] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0main] o.a.catalina.core.AprLifecycleListener\u00a0\u00a0\u00a0: An incompatible version [1.2.27] of the Apache Tomcat Native library is installed, while Tomcat requires version [1.2.34]\n</code></pre> \u9ed8\u8ba4\u8f93\u51fa\u683c\u5f0f\uff1a</p> <ol> <li>\u65f6\u95f4\u548c\u65e5\u671f\uff1a\u6beb\u79d2\u7ea7\u7cbe\u5ea6</li> <li>\u65e5\u5fd7\u7ea7\u522b\uff1aERROR, WARN, INFO, DEBUG, or TRACE.</li> <li>\u8fdb\u7a0b ID</li> <li>---\uff1a \u6d88\u606f\u5206\u5272\u7b26</li> <li>\u7ebf\u7a0b\u540d\uff1a \u4f7f\u7528[]\u5305\u542b</li> <li>Logger \u540d\uff1a \u901a\u5e38\u662f\u4ea7\u751f\u65e5\u5fd7\u7684\u7c7b\u540d</li> <li>\u6d88\u606f\uff1a \u65e5\u5fd7\u8bb0\u5f55\u7684\u5185\u5bb9</li> </ol> <p>\u6ce8\u610f\uff1a logback \u6ca1\u6709FATAL\u7ea7\u522b\uff0c\u5bf9\u5e94\u7684\u662fERROR\u3002 Text Only<pre><code>#\u8bbe\u7f6e\u63a7\u5236\u53f0\u65e5\u5fd7\u7684\u683c\u5f0f\nlogging.pattern.console=\n#\u63a7\u5236\u6587\u4ef6\u4e2d\u65e5\u5fd7\u7684\u683c\u5f0f\nlogging.pattern.file=\n#\u5355\u72ec\u53ea\u8bbe\u7f6e\u65e5\u5fd7\u4e2d\u65e5\u671f\u7684\u683c\u5f0f\nlogging.pattern.dateformat=\n</code></pre></p> <p>2\u3001\u65e5\u5fd7\u7684\u7ea7\u522b \u7531\u4f4e\u5230\u9ad8\uff1aALL &lt; TRACE &lt; DEBUG &lt; INFO\u00a0&lt; WARN\u00a0&lt; ERROR &lt; FATAL &lt; OFF\uff0c\u53ea\u4f1a\u6253\u5370\u6307\u5b9a\u7ea7\u522b\u53ca\u4ee5\u4e0a\u7ea7\u522b\u7684\u65e5\u5fd7\uff0cSpringBoot\u65e5\u5fd7\u9ed8\u8ba4\u7ea7\u522b\u662f INFO\u3002</p> <ol> <li>ALL\uff1a\u6253\u5370\u6240\u6709\u65e5\u5fd7</li> <li>TRACE\uff1a\u8ffd\u8e2a\u6846\u67b6\u8be6\u7ec6\u6d41\u7a0b\u65e5\u5fd7\uff0c\u4e00\u822c\u4e0d\u4f7f\u7528</li> <li>DEBUG\uff1a\u5f00\u53d1\u8c03\u8bd5\u7ec6\u8282\u65e5\u5fd7</li> <li>INFO\uff1a\u5173\u952e\u3001\u611f\u5174\u8da3\u4fe1\u606f\u65e5\u5fd7</li> <li>WARN\uff1a\u8b66\u544a\u4f46\u4e0d\u662f\u9519\u8bef\u7684\u4fe1\u606f\u65e5\u5fd7\uff0c\u6bd4\u5982\uff1a\u7248\u672c\u8fc7\u65f6</li> <li>ERROR\uff1a\u4e1a\u52a1\u9519\u8bef\u65e5\u5fd7\uff0c\u6bd4\u5982\u51fa\u73b0\u5404\u79cd\u5f02\u5e38</li> <li>FATAL\uff1a\u81f4\u547d\u9519\u8bef\u65e5\u5fd7\uff0c\u6bd4\u5982jvm\u7cfb\u7edf\u5d29\u6e83</li> <li>OFF\uff1a\u5173\u95ed\u6240\u6709\u65e5\u5fd7\u8bb0\u5f55</li> </ol> Text Only<pre><code>#\u9ed8\u8ba4\u7ea7\u522b\nlogging.level.root=info\n#\u7cbe\u786e\u7684\u8c03\u6574\u67d0\u4e2a\u5305\u7684\u65e5\u5fd7\u7ea7\u522b\nlogging.level.com.ctyun.controller=warn\n</code></pre> <p>3\u3001\u65e5\u5fd7\u5206\u7ec4 \u5c06\u5305\u5206\u7ec4\uff0c\u7136\u540e\u7edf\u4e00\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b Text Only<pre><code># \u5206\u7ec4\nlogging.group.tomcat=org.apache.catalina,org.apache.coyote,org.apache.tomcat\n# \u8c03\u6574\u65e5\u5fd7\u7ea7\u522b\nlogging.level.tomcat=trace\n</code></pre> SpringBoot \u9884\u5b9a\u4e49\u4e24\u4e2a\u5206\u7ec4\uff0c\u53ef\u4ee5\u5206\u522b\u6307\u5b9a\u8fd9\u4e24\u4e2a\u5206\u7ec4\u7684\u65e5\u5fd7\u7ea7\u522b\uff1a</p> Name Loggers web org.springframework.core.codecorg.springframework.httporg.springframework.weborg.springframework.boot.actuate.endpoint.weborg.springframework.boot.web.servlet.ServletContextInitializerBeans sql org.springframework.jdbc.coreorg.hibernate.SQLorg.jooq.tools.LoggerListener <p>4\u3001\u65e5\u5fd7\u6587\u4ef6\u8f93\u51fa 4.1\u00a0\u8f93\u51fa\u8def\u5f84 \u9ed8\u8ba4\u53ea\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff0c\u5982\u679c\u9700\u8981\u4fdd\u5b58\u5230\u6587\u4ef6\u9700\u8981\u8fdb\u884c\u8bbe\u7f6e\uff1a Text Only<pre><code>#\u8bbe\u7f6e\u65e5\u5fd7\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\uff0c\u9ed8\u8ba4\u6587\u4ef6\u540d\u662fspring.log\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86logging.file.name\uff0c\u5219logging.file.path\u65e0\u6548\nlogging.file.path=D:\\\\\n#\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e\u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u6587\u4ef6\u540d\uff0c\u5219\u9ed8\u8ba4\u4fdd\u5b58\u5728\u9879\u76ee\u6839\u8def\u5f84\u4e0b\nlogging.file.name=mylog.log\n</code></pre></p> <p>4.2\u00a0\u6587\u4ef6\u5f52\u6863\u4e0e\u6eda\u52a8\u5207\u5272</p> <ul> <li>\u5f52\u6863\uff1a\u6bcf\u5929\u7684\u65e5\u5fd7\u5355\u72ec\u5b58\u5230\u4e00\u4e2a\u6587\u6863\u4e2d\u3002</li> <li>\u5207\u5272\uff1a\u6bcf\u4e2a\u6587\u4ef610MB\uff0c\u8d85\u8fc7\u5927\u5c0f\u5207\u5272\u6210\u53e6\u5916\u4e00\u4e2a\u6587\u4ef6\u3002</li> </ul> <p>\u6bcf\u5929\u7684\u65e5\u5fd7\u5e94\u8be5\u72ec\u7acb\u5206\u5272\u51fa\u6765\u5b58\u6863\uff0c\u5982\u679c\u4f7f\u7528logback\uff08SpringBoot \u9ed8\u8ba4\u6574\u5408\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7application.properties/yaml\u6587\u4ef6\u6307\u5b9a\u65e5\u5fd7\u6eda\u52a8\u89c4\u5219\u3002\u5982\u679c\u662f\u5176\u4ed6\u65e5\u5fd7\u7cfb\u7edf\uff0c\u9700\u8981\u81ea\u884c\u914d\u7f6e\uff08\u6dfb\u52a0log4j2.xml\u6216log4j2-spring.xml\uff09\uff0c\u652f\u6301\u7684\u6eda\u52a8\u89c4\u5219\u8bbe\u7f6e\u5982\u4e0b\uff1a</p> \u914d\u7f6e\u9879 \u63cf\u8ff0 logging.logback.rollingpolicy.file-name-pattern \u65e5\u5fd7\u5b58\u6863\u7684\u6587\u4ef6\u540d\u683c\u5f0f\uff08\u9ed8\u8ba4\u503c\uff1a${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz\uff09 logging.logback.rollingpolicy.clean-history-on-start \u5e94\u7528\u542f\u52a8\u65f6\u662f\u5426\u6e05\u9664\u4ee5\u524d\u5b58\u6863\uff08\u9ed8\u8ba4\u503c\uff1afalse\uff09 logging.logback.rollingpolicy.max-file-size \u5b58\u6863\u524d\uff0c\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\uff08\u9ed8\u8ba4\u503c\uff1a10MB\uff09 logging.logback.rollingpolicy.total-size-cap \u65e5\u5fd7\u6587\u4ef6\u88ab\u5220\u9664\u4e4b\u524d\uff0c\u53ef\u4ee5\u5bb9\u7eb3\u7684\u6700\u5927\u5927\u5c0f\uff08\u9ed8\u8ba4\u503c\uff1a0B\uff09\u3002\u8bbe\u7f6e1GB\u5219\u78c1\u76d8\u5b58\u50a8\u8d85\u8fc7 1GB \u65e5\u5fd7\u540e\u5c31\u4f1a\u5220\u9664\u65e7\u65e5\u5fd7\u6587\u4ef6 logging.logback.rollingpolicy.max-history \u65e5\u5fd7\u6587\u4ef6\u4fdd\u5b58\u7684\u6700\u5927\u5929\u6570(\u9ed8\u8ba4\u503c\uff1a7). <p>5\u3001\u81ea\u5b9a\u4e49\u914d\u7f6e \u901a\u5e38\u4fee\u6539 application.properties \u914d\u7f6e\u6587\u4ef6\u5c31\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u65e5\u5fd7\u914d\u7f6e\u9700\u6c42\uff0c\u5982\u679c\u4e0d\u591f\uff0c\u53ef\u4ee5\u7f16\u5199\u65e5\u5fd7\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u653e\u5728\u7c7b\u8def\u5f84\u4e0b\uff0c\u6bd4\u5982logback-spring.xml\uff0clog4j2-spring.xml\uff1a</p> \u65e5\u5fd7\u7cfb\u7edf \u81ea\u5b9a\u4e49 Logback logback-spring.xml, logback-spring.groovy, logback.xml, or logback.groovy Log4j2 log4j2-spring.xml or log4j2.xml JDK (Java Util Logging) logging.properties <p>\u5efa\u8bae\u65e5\u5fd7\u914d\u7f6e\u6587\u4ef6\u540d\u4e2d\u4f7f\u7528-spring\uff08\u4f8b\u5982\uff0clogback-spring.xml \u800c\u4e0d\u662f logback.xml\uff09\u3002\u76f4\u63a5\u4f7f\u7528logback.xml\uff0c\u6846\u67b6\u4f1a\u76f4\u63a5\u8bfb\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u679c\u52a0\u4e0a-spring\u5219\u4f1a\u5148\u7531SpringBoot\u8bfb\u53d6\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528Spring\u53e6\u5916\u63d0\u4f9b\u7684\u6807\u7b7e\u3002\u6700\u4f73\u5b9e\u6218\uff1a\u81ea\u5df1\u8981\u5199\u914d\u7f6e\uff0c\u914d\u7f6e\u6587\u4ef6\u540d\u52a0\u4e0a xx-spring.xml \u3002</p> <p>6\u3001\u5207\u6362\u65e5\u5fd7\u5b9e\u73b0 \u6bd4\u5982\u5207\u6362log4j2\uff0c\u505a\u6cd5\u662f\uff0c\u91cd\u65b0\u5f15\u5165spring-boot-starter\u5e76\u6392\u9664spring-boot-starter-logging\uff0c\u6309\u7167Maven\u5c31\u8fd1\u539f\u5219\uff0c\u53ea\u751f\u6548\u6211\u4eec\u5bfc\u5165\u7684\uff0c\u7136\u540e\u518d\u5bfc\u5165spring-boot-starter-log4j2\u3002 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;exclusions&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;exclusion&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/exclusion&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/exclusions&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/4.%E6%B5%8B%E8%AF%95/","title":"4.\u6d4b\u8bd5","text":"<p> \u7ea6 1451 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 29 \u5206\u949f</p> <p>\u4e00\u3001\u6574\u5408\u6d4b\u8bd5\u573a\u666f\u542f\u52a8\u5668 1\u3001\u5f15\u5165\u6d4b\u8bd5\u573a\u666f\u542f\u52a8\u5668 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> 2\u3001\u5199\u6d4b\u8bd5\u7c7b \u6d4b\u8bd5\u7c7b\u6807\u6ce8@SpringBootTest\u53ef\u4ee5\u5728\u6d4b\u8bd5\u7684\u65f6\u5019\u542f\u52a8IOC\u5bb9\u5668\uff0c\u5f53\u6d4b\u8bd5\u7c7b\u548cSpringBoot\u4e3b\u7a0b\u5e8f\u7c7b\u5728\u540c\u4e00\u4e2a\u5305\u7ed3\u6784\u4e0b\u65f6\uff1a Text Only<pre><code>@SpringBootTest\npublic class Test02 {\n\u00a0\u00a0\u00a0\u00a0@Autowired\n\u00a0\u00a0\u00a0\u00a0Person person;\n\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0void test01(@Autowired Car car) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(car);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5982\u679c\u6d4b\u8bd5\u7c7b\u548cSpringBoot\u4e3b\u7a0b\u5e8f\u7c7b\u4e0d\u5728\u540c\u4e00\u4e2a\u5305\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6307\u660e\u4e3b\u7a0b\u5e8f\u7c7b\uff1a Text Only<pre><code>@SpringBootTest(classes = Main.class)\npublic class Test01 {\n}\n</code></pre> \u6216\u8005\u4f7f\u7528@ContextConfiguration\u6ce8\u89e3\u6307\u660e\uff1a Text Only<pre><code>@SpringBootTest()\n@ContextConfiguration(classes = Main.class)\npublic class Test01 {\n}\n</code></pre></p> <p>\u4e8c\u3001JUnit5 2.1 \u5e38\u7528\u6ce8\u89e3</p> <ul> <li>@Test\uff1a\u8868\u793a\u65b9\u6cd5\u662f\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u4e0eJUnit4\u7684@Test\u4e0d\u540c\uff0c\u4ed6\u7684\u804c\u8d23\u975e\u5e38\u5355\u4e00\u4e0d\u80fd\u58f0\u660e\u4efb\u4f55\u5c5e\u6027\uff0c\u62d3\u5c55\u7684\u6d4b\u8bd5\u5c06\u4f1a\u7531Jupiter5\u63d0\u4f9b\u989d\u5916\u6ce8\u89e3\u3002</li> <li>@ParameterizedTest\uff1a\u8868\u793a\u65b9\u6cd5\u662f\u53c2\u6570\u5316\u6d4b\u8bd5\u3002</li> <li>@RepeatedTest\uff1a\u8868\u793a\u65b9\u6cd5\u53ef\u91cd\u590d\u6267\u884c\u3002</li> <li>@DisplayName\uff1a\u4e3a\u6d4b\u8bd5\u7c7b\u6216\u8005\u6d4b\u8bd5\u65b9\u6cd5\u8bbe\u7f6e\u5c55\u793a\u540d\u79f0\u3002</li> <li>@BeforeEach\uff1a\u8868\u793a\u5728\u6bcf\u4e2a\u5355\u5143\u6d4b\u8bd5\u4e4b\u524d\u6267\u884c\u3002</li> <li>@AfterEach\uff1a\u8868\u793a\u5728\u6bcf\u4e2a\u5355\u5143\u6d4b\u8bd5\u4e4b\u540e\u6267\u884c\u3002</li> <li>@BeforeAll\uff1a\u8868\u793a\u5728\u6240\u6709\u5355\u5143\u6d4b\u8bd5\u4e4b\u524d\u6267\u884c\u3002</li> <li>@AfterAll\uff1a\u8868\u793a\u5728\u6240\u6709\u5355\u5143\u6d4b\u8bd5\u4e4b\u540e\u6267\u884c\u3002</li> <li>@Tag\uff1a\u8868\u793a\u5355\u5143\u6d4b\u8bd5\u7c7b\u522b\uff0c\u7c7b\u4f3c\u4e8eJUnit4\u4e2d\u7684@Categories\u3002</li> <li>@Disabled\uff1a\u8868\u793a\u6d4b\u8bd5\u7c7b\u6216\u6d4b\u8bd5\u65b9\u6cd5\u4e0d\u6267\u884c\uff0c\u7c7b\u4f3c\u4e8eJUnit4\u4e2d\u7684@Ignore\u3002</li> <li>@Timeout\uff1a\u8868\u793a\u6d4b\u8bd5\u65b9\u6cd5\u8fd0\u884c\u5982\u679c\u8d85\u8fc7\u4e86\u6307\u5b9a\u65f6\u95f4\u5c06\u4f1a\u8fd4\u56de\u9519\u8bef\u3002</li> <li>@ExtendWith\uff1a\u4e3a\u6d4b\u8bd5\u7c7b\u6216\u6d4b\u8bd5\u65b9\u6cd5\u63d0\u4f9b\u6269\u5c55\u7c7b\u5f15\u7528\u3002</li> </ul> Text Only<pre><code>@Slf4j\nclass StandardTests {\n\u00a0 \u00a0 @BeforeAll\n\u00a0\u00a0\u00a0\u00a0static void initAll() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.info(\"\u5728\u6240\u6709\u6d4b\u8bd5\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u6267\u884c\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@BeforeEach\n\u00a0\u00a0\u00a0\u00a0void init() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.info(\"\u5728\u6bcf\u4e00\u4e2a\u6d4b\u8bd5\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u6267\u884c\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5\u65b9\u6cd5\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0void succeedingTest() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.info(\"\u6d4b\u8bd5\u65b9\u6cd5\u6267\u884c\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0void failingTest() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fail(\"a failing test\");\u00a0 //fail\u65b9\u6cd5\u76f4\u63a5\u4f7f\u5f97\u6d4b\u8bd5\u5931\u8d25\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0@Disabled(\"for demonstration purposes\")\n\u00a0\u00a0\u00a0\u00a0void skippedTest() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// not executed\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0 \u00a0 @Test\n\u00a0\u00a0\u00a0\u00a0void abortedTest() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assumeTrue(\"abc\".contains(\"Z\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fail(\"test should have been aborted\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@AfterEach\n\u00a0\u00a0\u00a0\u00a0void tearDown() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.info(\"\u5728\u6bcf\u4e00\u4e2a\u6d4b\u8bd5\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u6267\u884c\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@AfterAll\n\u00a0\u00a0\u00a0\u00a0static void tearDownAll() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.info(\"\u5728\u6240\u6709\u6d4b\u8bd5\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u6267\u884c\");\n\u00a0\u00a0\u00a0\u00a0}\n\n}\n</code></pre> <p>2.2\u00a0@ParameterizedTest\u53c2\u6570\u5316\u6d4b\u8bd5 @ParameterizedTest\u6807\u6ce8\u7684\u65b9\u6cd5\u8868\u793a\u662f\u53c2\u6570\u5316\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u652f\u6301\u7528\u4ee5\u4e0b\u6ce8\u89e3\u63d0\u4f9b\u53c2\u6570\uff1a</p> <ol> <li>@ValueSource: \u4e3a\u53c2\u6570\u5316\u6d4b\u8bd5\u6307\u5b9a\u5165\u53c2\u6765\u6e90\uff0c\u652f\u6301\u516b\u5927\u57fa\u7840\u7c7b\u4ee5\u53caString\u7c7b\u578b,Class\u7c7b\u578b</li> <li>@NullSource: \u8868\u793a\u4e3a\u53c2\u6570\u5316\u6d4b\u8bd5\u63d0\u4f9b\u4e00\u4e2anull\u7684\u5165\u53c2</li> <li>@EnumSource: \u8868\u793a\u4e3a\u53c2\u6570\u5316\u6d4b\u8bd5\u63d0\u4f9b\u4e00\u4e2a\u679a\u4e3e\u5165\u53c2</li> <li>@CsvFileSource\uff1a\u8868\u793a\u8bfb\u53d6\u6307\u5b9aCSV\u6587\u4ef6\u5185\u5bb9\u4f5c\u4e3a\u53c2\u6570\u5316\u6d4b\u8bd5\u5165\u53c2</li> <li>@MethodSource\uff1a\u8868\u793a\u8bfb\u53d6\u6307\u5b9a\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4f5c\u4e3a\u53c2\u6570\u5316\u6d4b\u8bd5\u5165\u53c2(\u6ce8\u610f\u65b9\u6cd5\u8fd4\u56de\u9700\u8981\u662f\u4e00\u4e2a\u6d41)</li> </ol> Text Only<pre><code>public class Test03 {\n\u00a0\u00a0\u00a0\u00a0@ParameterizedTest\n\u00a0\u00a0\u00a0\u00a0@ValueSource(strings = {\"one\", \"two\", \"three\", \"\"})\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u53c2\u6570\u5316\u6d4b\u8bd51\")\n\u00a0\u00a0\u00a0\u00a0public void parameterizedTest1(String string) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(string);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Assertions.assertTrue(StringUtils.isNotBlank(string));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@ParameterizedTest\n\u00a0\u00a0\u00a0\u00a0@MethodSource(\"method\")\u00a0\u00a0\u00a0\u00a0//\u6307\u5b9a\u65b9\u6cd5\u540d\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u65b9\u6cd5\u6765\u6e90\u53c2\u6570\")\n\u00a0\u00a0\u00a0\u00a0public void testWithExplicitLocalMethodSource(String name) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(name);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Assertions.assertNotNull(name);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0static Stream&lt;String&gt; method() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Stream.of(\"apple\", \"banana\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>2.3\u00a0\u5d4c\u5957\u6d4b\u8bd5 JUnit 5 \u53ef\u4ee5\u901a\u8fc7 Java \u4e2d\u7684\u5185\u90e8\u7c7b\u548c@Nested \u6ce8\u89e3\u5b9e\u73b0\u5d4c\u5957\u6d4b\u8bd5\uff0c\u4ece\u800c\u53ef\u4ee5\u66f4\u597d\u7684\u628a\u76f8\u5173\u7684\u6d4b\u8bd5\u65b9\u6cd5\u7ec4\u7ec7\u5728\u4e00\u8d77\u3002\u5728\u5185\u90e8\u7c7b\u4e2d\u53ef\u4ee5\u4f7f\u7528@BeforeEach \u548c@AfterEach \u6ce8\u89e3\uff0c\u800c\u4e14\u5d4c\u5957\u7684\u5c42\u6b21\u6ca1\u6709\u9650\u5236\u3002 Text Only<pre><code>@DisplayName(\"A stack\")\nclass TestingAStackDemo {\n\u00a0\u00a0\u00a0\u00a0Stack&lt;Object&gt; stack;\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"is instantiated with new Stack()\")\n\u00a0\u00a0\u00a0\u00a0void isInstantiatedWithNew() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Stack&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Nested\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"when new\")\n\u00a0\u00a0\u00a0\u00a0class WhenNew {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@BeforeEach\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void createNewStack() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0stack = new Stack&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"is empty\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void isEmpty() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertTrue(stack.isEmpty());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"throws EmptyStackException when popped\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void throwsExceptionWhenPopped() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertThrows(EmptyStackException.class, stack::pop);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"throws EmptyStackException when peeked\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void throwsExceptionWhenPeeked() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertThrows(EmptyStackException.class, stack::peek);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Nested\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"after pushing an element\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0class AfterPushing {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String anElement = \"an element\";\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@BeforeEach\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void pushAnElement() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0stack.push(anElement);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"it is no longer empty\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void isNotEmpty() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertFalse(stack.isEmpty());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"returns the element when popped and is empty\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void returnElementWhenPopped() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertEquals(anElement, stack.pop());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertTrue(stack.isEmpty());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@DisplayName(\"returns the element when peeked but remains not empty\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0void returnElementWhenPeeked() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertEquals(anElement, stack.peek());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertFalse(stack.isEmpty());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.4\u00a0\u65ad\u8a00 \u4ee5\u4e0b\u7684assert\u53ef\u4ee5\u6362\u6210assume\uff08assumptions\u3010\u5047\u8bbe\u3011\uff09\uff0cassume\u5047\u8bbe\u7c7b\u4f3c\u4e8eassert\u65ad\u8a00\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u4e0d\u6ee1\u8db3\u7684\u65ad\u8a00\u4f1a\u4f7f\u5f97\u6d4b\u8bd5\u65b9\u6cd5\u5931\u8d25\uff0c\u800c\u4e0d\u6ee1\u8db3assume\u5047\u8bbe\u53ea\u4f1a\u4f7f\u5f97\u6d4b\u8bd5\u65b9\u6cd5\u7684\u6267\u884c\u7ec8\u6b62\uff0c\u4e0d\u7b97\u4f5c\u5931\u8d25\uff0c\u7b97\u4f5c\u5ffd\u7565\uff0c\u610f\u601d\u5c31\u662f\u6ee1\u8db3\u8fd9\u4e2a\u6761\u4ef6\u4f60\u5c31\u5e2e\u6211\u6d4b\u4e00\u4e0b\uff0c\u4e0d\u6ee1\u8db3\u5c31\u7b97\u4e86\u3002</p> \u65b9\u6cd5 \u8bf4\u660e assertEquals \u5224\u65ad\u4e24\u4e2a\u5bf9\u8c61\u6216\u4e24\u4e2a\u539f\u59cb\u7c7b\u578b\u662f\u5426\u76f8\u7b49 assertNotEquals \u5224\u65ad\u4e24\u4e2a\u5bf9\u8c61\u6216\u4e24\u4e2a\u539f\u59cb\u7c7b\u578b\u662f\u5426\u4e0d\u76f8\u7b49 assertSame \u5224\u65ad\u4e24\u4e2a\u5bf9\u8c61\u5f15\u7528\u662f\u5426\u6307\u5411\u540c\u4e00\u4e2a\u5bf9\u8c61 assertNotSame \u5224\u65ad\u4e24\u4e2a\u5bf9\u8c61\u5f15\u7528\u662f\u5426\u6307\u5411\u4e0d\u540c\u7684\u5bf9\u8c61 assertTrue \u5224\u65ad\u7ed9\u5b9a\u7684\u5e03\u5c14\u503c\u662f\u5426\u4e3a true assertFalse \u5224\u65ad\u7ed9\u5b9a\u7684\u5e03\u5c14\u503c\u662f\u5426\u4e3a false assertNull \u5224\u65ad\u7ed9\u5b9a\u7684\u5bf9\u8c61\u5f15\u7528\u662f\u5426\u4e3a null assertNotNull \u5224\u65ad\u7ed9\u5b9a\u7684\u5bf9\u8c61\u5f15\u7528\u662f\u5426\u4e0d\u4e3a null assertArrayEquals \u6570\u7ec4\u65ad\u8a00 assertAll \u7ec4\u5408\u65ad\u8a00 assertThrows \u5f02\u5e38\u65ad\u8a00 assertTimeout \u8d85\u65f6\u65ad\u8a00 fail \u5feb\u901f\u5931\u8d25 <p>assert\u65ad\u8a00\uff1a Text Only<pre><code>@DisplayName(\"Junit5\u65ad\u8a00\u6d4b\u8bd5\")\npublic class Junit5AssertionTest02 {\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertEquals\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertEquals() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str1 = \"ab\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str2 = \"ab\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertEquals(str1, str2, \"\u65ad\u8a00str1\u4e0d\u7b49\u4e8estr2\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertNotEquals\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertNotEquals() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str1 = \"ab\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str2 = \"ab\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertNotEquals(str1, str2, \"\u65ad\u8a00str1\u7b49\u4e8estr2\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertSame\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertSame() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str1 = \"ab\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str2 = str1 + \"\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertSame(str1, str2, \"\u65ad\u8a00str1\u7b49\u4e8estr2\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertNotSame\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertNotSame() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str1 = \"ab\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String str2 = str1 + \"\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertNotSame(str1, str2, \"\u65ad\u8a00str1\u7b49\u4e8estr2\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertTrue\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertTrue() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertTrue(() -&gt; \"ab\".equals(\"ab\"), \"\u65ad\u8a00\u4e3atrue\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertFalse\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertFalse() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertFalse(() -&gt; !\"ab\".equals(\"ab\"), \"\u65ad\u8a00\u4e3afalse\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertNull\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertNull() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertNull(null, \"\u65ad\u8a00\u4e3anull\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6d4b\u8bd5assertNotNull\")\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void testAssertNotNull() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertNotNull(null, \"\u65ad\u8a00\u4e0d\u4e3anull\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"\u6570\u7ec4\u65ad\u8a00\")\n\u00a0\u00a0\u00a0\u00a0public void array() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assertArrayEquals(new int[]{1, 2}, new int[]{1, 2});\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>assume\u5047\u8bbe\uff1a Text Only<pre><code>@DisplayName(\"\u524d\u7f6e\u6761\u4ef6\")\npublic class Junit5AssumptionsTest04 {\n\u00a0\u00a0\u00a0\u00a0private final String environment = \"DEV\";\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* assumeTrue \u548c assumeFalse \u786e\u4fdd\u7ed9\u5b9a\u7684\u6761\u4ef6\u4e3a true \u6216 false\uff0c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u4f1a\u4f7f\u5f97\u6d4b\u8bd5\u6267\u884c\u7ec8\u6b62\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"simple\")\n\u00a0\u00a0\u00a0\u00a0public void simpleAssume() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assumeTrue(Objects.equals(this.environment, \"DEV0\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assumeFalse(() -&gt; Objects.equals(this.environment, \"PROD\"));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0@DisplayName(\"assume then do\")\n\u00a0\u00a0\u00a0\u00a0public void assumeThenDo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u6ee1\u8db3\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684\u6761\u4ef6\uff0c\u5c31\u6267\u884c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684 lambda\u8868\u8fbe\u5f0f\uff0c\u4e0d\u6ee1\u8db3\u5c31\u7b97\u4e86\uff0c\u7a0b\u5e8f\u7ee7\u7eed\u6267\u884c\uff0c\uff08\u8fd9\u4e0d\u5c31\u662fif\u5417\uff09\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0assumingThat(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Objects.equals(this.environment, \"DEV3\"),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0() -&gt; System.out.println(\"In DEV\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8fd9\u91cc\u59cb\u7ec8\u4f1a\u6267\u884c\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/5.Web%E5%BC%80%E5%8F%91-%E5%9C%BA%E6%99%AF%E9%85%8D%E7%BD%AE/","title":"5.Web\u5f00\u53d1-\u573a\u666f\u914d\u7f6e","text":"<p> \u7ea6 1315 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 26 \u5206\u949f</p> <p>\u5f15\u5165Web\u573a\u666f\u542f\u52a8\u5668\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> spring-boot-autoconfigure\u5305\u4e2d\u4e0eWeb\u573a\u666f\u6709\u5173\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u6709\uff1a Text Only<pre><code>org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration\norg.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration\n====\u4ee5\u4e0b\u548c\u54cd\u5e94\u5f0fweb\u573a\u666f\u6709\u5173======\norg.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration\norg.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration\n===\u4ee5\u4e0b\u662fweb\u573a\u666f\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b==========\norg.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration\norg.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration\norg.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration\norg.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration\norg.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration\norg.springframework.boot.autoconfigure.web.servlet.`WebMvcAutoConfiguration`\n</code></pre> \u8fd9\u4e9b\u81ea\u52a8\u914d\u7f6e\u7c7b\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u524d\u7f00\u662f\uff1a</p> <ul> <li>SpringMVC\u7684\u6240\u6709\u914d\u7f6e\uff1aspring.mvc</li> <li>Web\u573a\u666f\u901a\u7528\u914d\u7f6e\uff1aspring.web</li> <li>\u6587\u4ef6\u4e0a\u4f20\u914d\u7f6e\uff1aspring.servlet.multipart</li> <li>\u670d\u52a1\u5668\u7684\u914d\u7f6e\uff1aserver\uff08\u6bd4\u5982\uff1a\u7aef\u53e3\u3001\u7f16\u7801\u65b9\u5f0f\uff09</li> </ul> <p>WebMvcAutoConfiguration\u7684\u539f\u7406 Text Only<pre><code>@AutoConfiguration(after = { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class }) //\u5728\u8fd9\u4e9b\u81ea\u52a8\u914d\u7f6e\u4e4b\u540e\n@ConditionalOnWebApplication(type = Type.SERVLET) //\u5982\u679c\u662f\u666e\u901a\u7684web\u5e94\u7528\u5c31\u751f\u6548\uff0c\u7c7b\u578bSERVLET\uff0c\u800c\u4e0d\u662f\u54cd\u5e94\u5f0fweb\uff0c\u7c7b\u578bREACTIVE\u00a0\n@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class }) //\u5bfc\u5165Web\u573a\u666f\u4e4b\u540e\u5c31\u4f1a\u6709\u8fd9\u4e9b\u7c7b\n`@ConditionalOnMissingBean(WebMvcConfigurationSupport.class) //\u5bb9\u5668\u4e2d\u6ca1\u6709\u8fd9\u4e2aBean\uff0c\u624d\u751f\u6548\uff0c\u9ed8\u8ba4\u5c31\u662f\u6ca1\u6709\uff0c\u5728\u81ea\u5df1\u5199\u7684\u914d\u7f6e\u7c7b\u4e0a\u6807\u6ce8@EnableWebMvc\u6ce8\u89e3\u5c31\u4f1a\u7387\u5148\u6ce8\u5165WebMvcConfigurationSupport\u8fd9\u4e2aBean`\n@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)//\u4f18\u5148\u7ea7\n@ImportRuntimeHints(WebResourcesRuntimeHints.class)\npublic class WebMvcAutoConfiguration {\n}\n</code></pre> \u9996\u5148\u4f1a\u5411\u5bb9\u5668\u653e\u5165\u4e24\u4e2aBean\uff0c\u8fd9\u4e24\u4e2aBean\u4e0eRestful\u6709\u5173 Text Only<pre><code>@Bean\n@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)\n@ConditionalOnProperty(prefix = \"spring.mvc.hiddenmethod.filter\", name = \"enabled\")\npublic OrderedHiddenHttpMethodFilter hiddenHttpMethodFilter() {\n\u00a0\u00a0\u00a0\u00a0return new OrderedHiddenHttpMethodFilter();\n}\n@Bean\n@ConditionalOnMissingBean(FormContentFilter.class)\n@ConditionalOnProperty(prefix = \"spring.mvc.formcontent.filter\", name = \"enabled\", matchIfMissing = true)\npublic OrderedFormContentFilter formContentFilter() {\n\u00a0\u00a0\u00a0\u00a0return new OrderedFormContentFilter();\n}\n</code></pre></p> <ul> <li>HiddenHttpMethodFilter\uff1a\u8ba9\u9875\u9762\u8868\u5355\u63d0\u4ea4Restful\u8bf7\u6c42\uff08GET\u3001POST\u3001PUT\u3001DELETE\uff09</li> <li>FormContentFilter\uff1aGET\uff08\u6570\u636e\u653eURL\u540e\u9762\uff09\u3001POST\uff08\u6570\u636e\u653e\u8bf7\u6c42\u4f53\uff09\u8bf7\u6c42\u53ef\u4ee5\u643a\u5e26\u6570\u636e\uff0cPUT\u3001DELETE \u7684\u8bf7\u6c42\u4f53\u6570\u636e\u4f1a\u88ab\u5ffd\u7565\uff0c\u4f7f\u7528\u8fd9\u4e2aFilter\u53ef\u4ee5\u8ba9Tomcat\u4e0d\u5ffd\u7565\u3002</li> </ul> <p>WebMvcConfigurer\u7ec4\u4ef6 \u7136\u540e\u5f80\u5bb9\u5668\u4e2d\u6ce8\u5165\u4e86\u4e00\u4e2aWebMvcConfigurer\uff0c\u8fd9\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u4f5c\u7528\u662f\u7ed9SpringMVC\u6dfb\u52a0\u5404\u79cd\u5b9a\u5236\u529f\u80fd\uff08\u5728SpringMVC\u5168\u6ce8\u89e3\u914d\u7f6e\u4e2d\u4ecb\u7ecd\u8fc7\uff09\u3002 \u8fd8\u5f00\u542f\u4e86\u4e24\u4e2a\u5c5e\u6027\u7ed1\u5b9a\u7c7b\uff1a</p> <ol> <li>WebMvcProperties\uff1a\u524d\u7f00 spring.mvc</li> <li>WebProperties\uff1a\u524d\u7f00 spring.web</li> </ol> <p>Text Only<pre><code>`@Configuration`(proxyBeanMethods = false)\n`@Import(EnableWebMvcConfiguration.class)`\n@EnableConfigurationProperties({ WebMvcProperties.class,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0org.springframework.boot.autoconfigure.web.ResourceProperties.class, WebProperties.class })\n@Order(0)\npublic static class WebMvcAutoConfigurationAdapter implements `WebMvcConfigurer`, ServletContextAware {\n}\n</code></pre> WebMvcConfigurer\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u8868\u793a\u4e86\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7684\u54ea\u4e9b\u7ec4\u4ef6\uff1a</p> \u63d0\u4f9b\u65b9\u6cd5 \u6838\u5fc3\u53c2\u6570 \u529f\u80fd \u9ed8\u8ba4 addFormatters FormatterRegistry \u683c\u5f0f\u5316\u5668\uff1a\u652f\u6301\u5c5e\u6027\u4e0a@NumberFormat\u548c@DatetimeFormat\u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362 GenericConversionService getValidator \u65e0 \u6570\u636e\u6821\u9a8c\uff1a\u6821\u9a8c Controller \u4e0a\u4f7f\u7528@Valid\u6807\u6ce8\u7684\u53c2\u6570\u5408\u6cd5\u6027\u3002\u9700\u8981\u5bfc\u5165starter-validator \u65e0 addInterceptors InterceptorRegistry \u62e6\u622a\u5668\uff1a\u62e6\u622a\u6536\u5230\u7684\u6240\u6709\u8bf7\u6c42 \u65e0 configureContentNegotiation ContentNegotiationConfigurer \u5185\u5bb9\u534f\u5546\uff1a\u652f\u6301\u591a\u79cd\u6570\u636e\u683c\u5f0f\u8fd4\u56de\u3002\u9700\u8981\u914d\u5408\u652f\u6301\u8fd9\u79cd\u7c7b\u578b\u7684HttpMessageConverter \u652f\u6301 json configureMessageConverters List&lt;HttpMessageConverter&lt;?&gt;&gt; \u6d88\u606f\u8f6c\u6362\u5668\uff1a\u6807\u6ce8@ResponseBody\u7684\u8fd4\u56de\u503c\u4f1a\u5229\u7528MessageConverter\u76f4\u63a5\u5199\u51fa\u53bb 8 \u4e2a\uff0c\u652f\u6301byte\uff0cstring,multipart,resource\uff0cjson addViewControllers ViewControllerRegistry \u89c6\u56fe\u6620\u5c04\uff1a\u76f4\u63a5\u5c06\u8bf7\u6c42\u8def\u5f84\u4e0e\u7269\u7406\u89c6\u56fe\u6620\u5c04\u3002\u7528\u4e8e\u65e0 java \u4e1a\u52a1\u903b\u8f91\u7684\u76f4\u63a5\u89c6\u56fe\u9875\u6e32\u67d3 \u65e0 configureViewResolvers ViewResolverRegistry \u89c6\u56fe\u89e3\u6790\u5668\uff1a\u903b\u8f91\u89c6\u56fe\u8f6c\u4e3a\u7269\u7406\u89c6\u56fe ViewResolverComposite addResourceHandlers ResourceHandlerRegistry \u9759\u6001\u8d44\u6e90\u5904\u7406\uff1a\u9759\u6001\u8d44\u6e90\u8def\u5f84\u6620\u5c04\u3001\u7f13\u5b58\u63a7\u5236 ResourceHandlerRegistry configureDefaultServletHandling DefaultServletHandlerConfigurer \u9ed8\u8ba4 Servlet\uff1a\u53ef\u4ee5\u8986\u76d6 Tomcat \u7684DefaultServlet\u3002\u8ba9DispatcherServlet\u62e6\u622a/ \u65e0 configurePathMatch PathMatchConfigurer \u8def\u5f84\u5339\u914d\uff1a\u81ea\u5b9a\u4e49 URL \u8def\u5f84\u5339\u914d\u3002\u53ef\u4ee5\u81ea\u52a8\u4e3a\u6240\u6709\u8def\u5f84\u52a0\u4e0a\u6307\u5b9a\u524d\u7f00\uff0c\u6bd4\u5982 /api \u65e0 configureAsyncSupport AsyncSupportConfigurer \u5f02\u6b65\u652f\u6301\uff1a TaskExecutionAutoConfiguration addCorsMappings CorsRegistry \u8de8\u57df\uff1a \u65e0 addArgumentResolvers List \u53c2\u6570\u89e3\u6790\u5668\uff1a mvc \u9ed8\u8ba4\u63d0\u4f9b addReturnValueHandlers List \u8fd4\u56de\u503c\u89e3\u6790\u5668\uff1a mvc \u9ed8\u8ba4\u63d0\u4f9b configureHandlerExceptionResolvers List \u5f02\u5e38\u5904\u7406\u5668\uff1a \u9ed8\u8ba4 3 \u4e2aExceptionHandlerExceptionResolverResponseStatusExceptionResolverDefaultHandlerExceptionResolver getMessageCodesResolver \u65e0 \u6d88\u606f\u7801\u89e3\u6790\u5668\uff1a\u56fd\u9645\u5316\u4f7f\u7528 \u65e0 <p>WebMvcAutoConfigurationAdapter\u7ed9\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e86\u4e00\u4e2aRequestContextFilter\uff1a Text Only<pre><code>@Bean\n@ConditionalOnMissingBean({ RequestContextListener.class, RequestContextFilter.class })\n@ConditionalOnMissingFilterBean(RequestContextFilter.class)\npublic static RequestContextFilter requestContextFilter() {\n\u00a0\u00a0\u00a0\u00a0return new OrderedRequestContextFilter();\n}\n</code></pre> \u8fd9\u4e2aFilter\u5c31\u662fServlet\u4e09\u5927\u7ec4\u4ef6\u4e4b\u4e00\u7684Filter\uff0c\u4f5c\u7528\u662f\u8bf7\u6c42\u548c\u54cd\u5e94\u4fdd\u5b58\u5728RequestContextHolder\u4e2d\uff0cRequestContextHolder\u5176\u5b9e\u662f\u4e00\u4e2aThreadLocal\uff0c\u6240\u4ee5\u53ef\u4ee5<code>\u901a\u8fc7RequestContextHolder\u5728\u4efb\u610f\u4f4d\u7f6e\u76f4\u63a5\u62ff\u5230\u8bf7\u6c42\u548c\u54cd\u5e94</code>\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u7684\u65b9\u5f0f\uff08Controller\u65b9\u6cd5\u53c2\u6570\u5904\u7684HttpServletRequest\u548cHttpServletResponse\u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\uff0cService\u5c42\u7684\u65b9\u6cd5\u9700\u8981\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u624d\u80fd\u62ff\u5230\u8bf7\u6c42\u548c\u54cd\u5e94\uff09\u3002 Text Only<pre><code>ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();\nHttpServletRequest request = requestAttributes.getRequest();\nHttpServletResponse response = requestAttributes.getResponse();\n</code></pre></p> <p>\u914d\u7f6eWeb\u573a\u666f\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a</p> \u65b9\u5f0f \u7528\u6cd5 \u6548\u679c \u5168\u81ea\u52a8 \u76f4\u63a5\u7f16\u5199\u63a7\u5236\u5668\u903b\u8f91 \u5168\u90e8\u4f7f\u7528\u81ea\u52a8\u914d\u7f6e\u9ed8\u8ba4\u6548\u679c \u624b\u81ea\u4e00\u4f53 @Configuration +\u914d\u7f6eWebMvcConfigurer+\u914d\u7f6e WebMvcRegistrations \u4e0d\u8981\u6807\u6ce8@EnableWebMvc \u4fdd\u7559\u81ea\u52a8\u914d\u7f6e\u6548\u679c\u624b\u52a8\u8bbe\u7f6e\u90e8\u5206\u529f\u80fd\u5b9a\u4e49MVC\u5e95\u5c42\u7ec4\u4ef6 \u5168\u624b\u52a8 @Configuration +\u914d\u7f6eWebMvcConfigurer \u6807\u6ce8@EnableWebMvc \u7981\u7528\u81ea\u52a8\u914d\u7f6e\u6548\u679c\u5168\u624b\u52a8\u8bbe\u7f6e <p>\u63a8\u8350\u4f7f\u7528\u624b\u81ea\u4e00\u4f53\u7684\u65b9\u5f0f\uff1a Text Only<pre><code>@Configuration //\u8fd9\u662f\u4e00\u4e2a\u914d\u7f6e\u7c7b, \u7ed9\u5bb9\u5668\u4e2d\u653e\u4e00\u4e2a WebMvcConfigurer \u7ec4\u4ef6\uff0c\u5c31\u80fd\u81ea\u5b9a\u4e49\u5e95\u5c42\npublic class MyConfig implements WebMvcConfigurer {\n}\n</code></pre> \u6216\u8005 Text Only<pre><code>@Configuration //\u8fd9\u662f\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff0c\u4e0d\u5b9e\u73b0WebMvcConfigurer\uff0c\u800c\u662f\u5229\u7528@Bean\u5f80\u5bb9\u5668\u4e2d\u6dfb\u52a0\u4e00\u4e2aWebMvcConfigurer\npublic class MyConfig\u00a0\u00a0/*implements WebMvcConfigurer*/ {\n\u00a0 \u00a0 @Bean\n\u00a0\u00a0\u00a0\u00a0public WebMvcConfigurer webMvcConfigurer(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new WebMvcConfigurer() {};\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48\u6807\u6ce8@EnableWebMvc\u5c31\u53ef\u4ee5\u7981\u7528\u9ed8\u8ba4\u914d\u7f6e\uff1f \u56e0\u4e3a@EnableWebMvc\u4f1a@Import(DelegatingWebMvcConfiguration.class)\uff0c\u800cDelegatingWebMvcConfiguration\u662f\u4e00\u4e2aWebMvcConfigurationSupport\uff0c\u5728WebMvcAutoConfiguration\u4e0a\u6709\u4e00\u4e2a@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)\uff0c\u6240\u4ee5\u5982\u679c\u6211\u4eec\u5728\u67d0\u4e2a\u7c7b\u4e0a\u6807\u6ce8\u4e86@EnableWebMvc\u5c31\u4f1a\u7981\u7528\u6389\u9ed8\u8ba4\u914d\u7f6e\u3002 Text Only<pre><code>@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.TYPE)\n@Documented\n@Import(DelegatingWebMvcConfiguration.class)\npublic @interface EnableWebMvc {\n}\n</code></pre> Text Only<pre><code>@Configuration(proxyBeanMethods = false)\npublic class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {\n}\n</code></pre></p> <p>WebMvcConfigurationSupport\u7ec4\u4ef6 WebMvcAutoConfiguration\u63a5\u7740\u5411\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e86\u4e00\u4e2aWebMvcConfigurationSupport\u7ec4\u4ef6 Text Only<pre><code>//EnableWebMvcConfiguration\u00a0\u662f\u4e00\u4e2a\u00a0WebMvcConfigurationSupport \u7ec4\u4ef6\u3002\n//\u5982\u679c\u6211\u4eec\u81ea\u5df1\u653e\u4e86 WebMvcConfigurationSupport \u7ec4\u4ef6\uff0cWebMvcAutoConfiguration\u4f1a\u5931\u6548\u3002\n@Configuration(proxyBeanMethods = false)\n@EnableConfigurationProperties(WebProperties.class)\npublic static class EnableWebMvcConfiguration extends DelegatingWebMvcConfiguration implements ResourceLoaderAware {\n}\n</code></pre></p> <p>\u4e3a\u4ec0\u4e48\u5f80\u5bb9\u5668\u4e2d\u6ce8\u518cWebMvcConfigurer\u7ec4\u4ef6\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u4fdd\u7559\u539f\u6765\u7684\u914d\u7f6e\uff0c\u8fd8\u53ef\u4ee5\u65b0\u589e\u52a0\u914d\u7f6e\uff1f EnableWebMvcConfiguration\u7ee7\u627f\u81eaDelegatingWebMvcConfiguration\uff0c\u5728DelegatingWebMvcConfiguration\u4e2d\u81ea\u52a8\u6ce8\u5165\u4e86\u6240\u6709\u7684WebMvcConfigurer\uff0c\u4e5f\u5c31\u662f\u5f80\u5bb9\u5668\u4e2d\u6ce8\u518c\u7684\u6240\u6709WebMvcConfigurer\u90fd\u80fd\u751f\u6548\u3002 Text Only<pre><code>@Autowired(required = false)\npublic void setConfigurers(List&lt;WebMvcConfigurer&gt; configurers) {\n\u00a0\u00a0\u00a0\u00a0if (!CollectionUtils.isEmpty(configurers)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.configurers.addWebMvcConfigurers(configurers);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/6.Web%E5%BC%80%E5%8F%91-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99%E3%80%81%E6%AC%A2%E8%BF%8E%E9%A1%B5%E3%80%81Favicon%E3%80%81%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D%E3%80%81Thymeleaf/","title":"6.Web\u5f00\u53d1-\u9759\u6001\u8d44\u6e90\u89c4\u5219\u3001\u6b22\u8fce\u9875\u3001Favicon\u3001\u8def\u5f84\u5339\u914d\u3001Thymeleaf","text":"<p> \u7ea6 1482 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 30 \u5206\u949f</p> <p>\u4e00\u3001\u9759\u6001\u8d44\u6e90\u89c4\u5219 \u5728WebMvcAutoConfiguration\u4e2d\u7684WebMvcConfigurer\uff0c\u6dfb\u52a0\u4e86\u8d44\u6e90\u5904\u7406\u5668\uff0c\u4e13\u95e8\u7528\u4e8e\u5904\u7406\u9759\u6001\u8d44\u6e90\uff1a Text Only<pre><code>@Override\npublic void addResourceHandlers(ResourceHandlerRegistry registry) {\n\u00a0\u00a0\u00a0\u00a0if (!this.resourceProperties.isAddMappings()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"Default resource handling disabled\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0addResourceHandler(registry, \"/webjars/**\", \"classpath:/META-INF/resources/webjars/\");\n\u00a0\u00a0\u00a0\u00a0addResourceHandler(registry, this.mvcProperties.getStaticPathPattern(), (registration) -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registration.addResourceLocations(this.resourceProperties.getStaticLocations());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (this.servletContext != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServletContextResource resource = new ServletContextResource(this.servletContext, SERVLET_LOCATION);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registration.addResourceLocations(resource);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0});\n}\n</code></pre> \u9996\u5148\u5224\u65ad\u4e86\u662f\u5426\u5f00\u542f\u8d44\u6e90\u5904\u7406\u5668\uff0c\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\u5173\u95ed\uff1a Text Only<pre><code>spring.web.resources.add-mappings=false\n</code></pre> \u7136\u540e\u662f\u4e24\u6761\u8d44\u6e90\u6620\u5c04\u89c4\u5219\uff1a \u89c4\u5219\u4e00\uff1a\u8bbf\u95ee /webjars/** \u8def\u5f84\u5c31\u53bb classpath:/META-INF/resources/webjars/\u4e0b\u627e\u8d44\u6e90\u3002 \u5229\u7528Maven\u5c06js\u3001css\u6587\u4ef6\u6253\u5305\u7684\u65b9\u5f0f\u53ebwebjars\uff0c\u6253\u5305\u7684\u65f6\u5019\u4f1a\u628a\u6587\u4ef6\u653e\u5728META-INF/resources/webjars/\u76ee\u5f55\u4e0b\u3002</p> <p>\u89c4\u5219\u4e8c\uff1a\u8bbf\u95ee /** \u8def\u5f84\u4f1a\u5230\u9759\u6001\u8d44\u6e90\u9ed8\u8ba4\u7684\u56db\u4e2a\u4f4d\u7f6e\u627e\u8d44\u6e90</p> <ol> <li>classpath:/META-INF/resources/</li> <li>classpath:/resources/</li> <li>classpath:/static/</li> <li>classpath:/public/</li> </ol> <p>\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fee\u6539\u9ed8\u8ba4\u914d\u7f6e\uff1a Text Only<pre><code># \u81ea\u5b9a\u4e49\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u5939\u4f4d\u7f6e\nspring.web.resources.static-locations=classpath:/a/,classpath:/b/,classpath:/static/\n# \u81ea\u5b9a\u4e49webjars\u8def\u5f84\u524d\u7f00\nspring.mvc.webjars-path-pattern=/wj/**\n# \u9759\u6001\u8d44\u6e90\u8bbf\u95ee\u8def\u5f84\u524d\u7f00\nspring.mvc.static-path-pattern=/static/**\n</code></pre></p> <p>\u89c4\u5219\u4e09\uff1a\u9759\u6001\u8d44\u6e90\u7684\u7f13\u5b58\u7b56\u7565 \u6dfb\u52a0\u8d44\u6e90\u6620\u5c04\u5173\u7cfb\u4f7f\u7528\u7684\u662faddResourceHandler\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u4e3a\u8bf7\u6c42\u8def\u5f84\u8bbe\u7f6e\u4e86\u7f13\u5b58\u89c4\u5219\uff0c\u8fd9\u4e2a\u7f13\u5b58\u89c4\u5219\u662f\u8bbe\u7f6e\u5728\u54cd\u5e94\u5934\u91cc\u63a7\u5236\u6d4f\u89c8\u5668\u884c\u4e3a\u7684\uff0c\u5e76\u4e0d\u662f\u670d\u52a1\u5668\u7aef\u7684\u7f13\u5b58\uff0c\u4f8b\u5982\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\u4e86\u4e00\u4e2a\u9759\u6001\u8d44\u6e90 index.js\uff0c\u5982\u679c\u670d\u52a1\u8fd9\u4e2a\u8d44\u6e90\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u4e0b\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u76f4\u63a5\u8ba9\u6d4f\u89c8\u5668\u7528\u81ea\u5df1\u7f13\u5b58\u4e2d\u7684\u4e1c\u897f\uff0c\u800c\u4e0d\u7528\u7ed9\u670d\u52a1\u5668\u53d1\u8bf7\u6c42\u3002 Text Only<pre><code>private void addResourceHandler(ResourceHandlerRegistry registry, String pattern, String... locations) {\n\u00a0\u00a0\u00a0\u00a0addResourceHandler(registry, pattern, (registration) -&gt; registration.addResourceLocations(locations));\n}\n\nprivate void addResourceHandler(ResourceHandlerRegistry registry, String pattern,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Consumer&lt;ResourceHandlerRegistration&gt; customizer) {\n\u00a0\u00a0\u00a0\u00a0if (registry.hasMappingForPattern(pattern)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0ResourceHandlerRegistration registration = registry.addResourceHandler(pattern);\n\u00a0\u00a0\u00a0\u00a0customizer.accept(registration);\n `registration.setCachePeriod(getSeconds(this.resourceProperties.getCache().getPeriod()));`\n `registration.setCacheControl(this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());`\n `registration.setUseLastModified(this.resourceProperties.getCache().isUseLastModified());`\n\u00a0\u00a0\u00a0\u00a0customizeResourceHandlerRegistration(registration);\n}\n</code></pre></p> <ol> <li>cachePeriod\uff1a\u7f13\u5b58\u5468\u671f\uff0c\u5373\u591a\u4e45\u4e0d\u7528\u627e\u670d\u52a1\u5668\u8981\u65b0\u7684\uff0c \u9ed8\u8ba4\u6ca1\u6709\uff0c\u4ee5s\u4e3a\u5355\u4f4d\u3002\u6ce8\u610f\uff0c\u5f3a\u5236\u5237\u65b0\u6d4f\u89c8\u5668\u4ecd\u7136\u4f1a\u8bf7\u6c42\u670d\u52a1\u5668\u3002</li> <li>cacheControl\uff1a HTTP\u7f13\u5b58\u63a7\u5236\uff1ahttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching</li> <li>useLastModified\uff1a\u662f\u5426\u4f7f\u7528\u6700\u540e\u4e00\u6b21\u4fee\u6539\uff0c\u9ed8\u8ba4\u5f00\u542f\u3002\u6bcf\u6b21\u8bf7\u6c42\u9759\u6001\u8d44\u6e90\u7684\u65f6\u5019\u4f1a\u5148\u8bf7\u6c42\u8d44\u6e90\u7684\u6700\u540e\u4e00\u6b21\u4fee\u6539\u65f6\u95f4\uff0c\u7136\u540e\u68c0\u67e5\u65f6\u95f4\u662f\u5426\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u5982\u679c\u6700\u540e\u4fee\u6539\u65f6\u95f4\u4e0d\u4e00\u81f4\u5219\u8868\u793a\u9759\u6001\u8d44\u6e90\u53d1\u751f\u4e86\u4fee\u6539\uff0c\u90a3\u4e48\u518d\u91cd\u65b0\u8bf7\u6c42\u8d44\u6e90\u3002</li> </ol> <p>cachePeriod \u548c\u00a0useLastModified\u00a0\u642d\u914d\u4f7f\u7528\u7684\u6548\u679c\u662f\uff0c\u7f13\u5b58\u5468\u671f\u5185\u4e0d\u627e\u670d\u52a1\u5668\u8981\uff0c\u5f3a\u5236\u5237\u65b0\u6216\u8005\u8d85\u8fc7\u7f13\u5b58\u5468\u671f\u5219\u91cd\u65b0\u8bf7\u6c42\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u8fc7\u7a0b\u662f\u5148\u8bf7\u6c42\u6700\u540e\u4e00\u6b21\u4fee\u6539\u65f6\u95f4\uff0c\u7136\u540e\u518d\u51b3\u5b9a\u662f\u5426\u91cd\u65b0\u8bf7\u6c42\u8d44\u6e90\u3002\u7f13\u5b58\u7684\u8bbe\u7f6e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u524d\u7f00\u662f spring.web\uff1a Text Only<pre><code># \u8bbe\u7f6e\u7f13\u5b58\nspring.web.resources.cache.period=3600\n\n# \u4f7f\u7528\u8d44\u6e90 last-modified \u65f6\u95f4\uff0c\u6765\u5bf9\u6bd4\u670d\u52a1\u5668\u548c\u6d4f\u89c8\u5668\u7684\u8d44\u6e90\u662f\u5426\u76f8\u540c\u6ca1\u6709\u53d8\u5316\u3002\u76f8\u540c\u8fd4\u56de 304\nspring.web.resources.cache.use-last-modified=true\n\n## \u7f13\u5b58\u8be6\u7ec6\u63a7\u5236\uff0c\u4f1a\u8986\u76d6period\u914d\u7f6e\uff1a\n## \u6d4f\u89c8\u5668\u7b2c\u4e00\u6b21\u8bf7\u6c42\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u544a\u8bc9\u6d4f\u89c8\u5668\u6b64\u8d44\u6e90\u7f13\u5b587200\u79d2\uff0c7200\u79d2\u4ee5\u5185\u7684\u6240\u6709\u6b64\u8d44\u6e90\u8bbf\u95ee\u4e0d\u7528\u53d1\u7ed9\u670d\u52a1\u5668\u8bf7\u6c42\uff0c7200\u79d2\u4ee5\u540e\u53d1\u8bf7\u6c42\u7ed9\u670d\u52a1\u5668\nspring.web.resources.cache.cachecontrol.max-age=7200\n</code></pre></p> <p>\u4e0d\u4ec5\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\u4fee\u6539\u9759\u6001\u8d44\u6e90\u89c4\u5219\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u624b\u81ea\u4e00\u4f53\u7684\u65b9\u5f0f\u589e\u52a0\u5904\u7406\u89c4\u5219\uff1a Text Only<pre><code>@Configuration\npublic class MyConfig implements WebMvcConfigurer {\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0public void addResourceHandlers(ResourceHandlerRegistry registry) {\n\u00a0 \u00a0 \u00a0 \u00a0 //\u81ea\u5df1\u5199\u65b0\u7684\u89c4\u5219\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registry.addResourceHandler(\"/static/**\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.addResourceLocations(\"classpath:/a/\",\"classpath:/b/\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.setCacheControl(CacheControl.maxAge(1180, TimeUnit.SECONDS));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6216\u8005 Text Only<pre><code>@Configuration\npublic class MyConfig\u00a0\u00a0/*implements WebMvcConfigurer*/ {\n\u00a0 \u00a0 @Bean\n\u00a0\u00a0\u00a0\u00a0public WebMvcConfigurer webMvcConfigurer(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new WebMvcConfigurer() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void addResourceHandlers(ResourceHandlerRegistry registry) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registry.addResourceHandler(\"/static/**\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.addResourceLocations(\"classpath:/a/\", \"classpath:/b/\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.setCacheControl(CacheControl.maxAge(1180, TimeUnit.SECONDS));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001\u6b22\u8fce\u9875 \u5728WebMvcAutoConfiguration\u4e2d\u7684EnableWebMvcConfiguration\u5f80\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e86WelcomePageNotAcceptableHandlerMapping\uff0c\u6b22\u8fce\u9875\u7684HandlerMapping\u3002 WelcomePageHandlerMapping\uff1a\u8bbf\u95ee\u9879\u76ee\u6839\u8def\u5f84 / \uff0c\u4f1a\u5728\u524d\u9762\u7684\u56db\u4e2a\u9759\u6001\u8d44\u6e90\u8def\u5f84\u4e0b\u627eindex.html\u9875\u9762\u3002 Text Only<pre><code>@Bean\npublic WelcomePageNotAcceptableHandlerMapping welcomePageNotAcceptableHandlerMapping(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ApplicationContext applicationContext, FormattingConversionService mvcConversionService,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ResourceUrlProvider mvcResourceUrlProvider) {\n\u00a0\u00a0\u00a0\u00a0return createWelcomePageHandlerMapping(applicationContext, mvcConversionService, mvcResourceUrlProvider,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0WelcomePageNotAcceptableHandlerMapping::new);\n}\n</code></pre></p> <p>\u4e09\u3001Favicon \u5728\u9759\u6001\u8d44\u6e90\u8def\u5f84\u4e0b\u653e\u4e00\u4e2a favicon.ico\u00a0\u56fe\u6807\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u4f1a\u4f5c\u4e3a\u7f51\u7ad9\u7684\u56fe\u6807\u3002\u539f\u7406\u662f\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\u7f51\u7ad9\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u8bf7\u6c42 /favicon.ico \u3002</p> <p>\u56db\u3001\u8def\u5f84\u5339\u914d Spring5.3 \u4e4b\u524d\u53ea\u652f\u6301 AntPathMatcher \u7b56\u7565\uff0cSpring5.3 \u4e4b\u540e\u52a0\u5165 PathPatternParser \u7b56\u7565\uff0cSpringBoot\u9ed8\u8ba4\u4f7f\u7528 PathPatternParser \u7b56\u7565\u3002 1\u3001Ant\u98ce\u683c\u8def\u5f84\u7528\u6cd5 Ant \u98ce\u683c\u7684\u8def\u5f84\u6a21\u5f0f\u8bed\u6cd5\u5177\u6709\u4ee5\u4e0b\u89c4\u5219\uff1a</p> <ul> <li>*\uff1a\u8868\u793a\u4efb\u610f\u6570\u91cf\u7684\u5b57\u7b26\u3002</li> <li>?\uff1a\u8868\u793a\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u3002</li> <li>**\uff1a\u8868\u793a\u4efb\u610f\u6570\u91cf\u7684\u76ee\u5f55\u3002</li> <li>{}\uff1a\u8868\u793a\u4e00\u4e2a\u547d\u540d\u7684\u6a21\u5f0f\u5360\u4f4d\u7b26\u3002</li> <li>[]\uff1a\u8868\u793a\u5b57\u7b26\u96c6\u5408\uff0c\u4f8b\u5982[a-z]\u8868\u793a\u5c0f\u5199\u5b57\u6bcd\u3002</li> </ul> <p>\u4f8b\u5982\uff1a</p> <ul> <li>*.html \u5339\u914d\u4efb\u610f\u540d\u79f0\uff0c\u6269\u5c55\u540d\u4e3a.html\u7684\u6587\u4ef6\u3002</li> <li>/folder1/*/*.java \u5339\u914d\u5728folder1\u76ee\u5f55\u4e0b\u7684\u4efb\u610f\u4e24\u7ea7\u76ee\u5f55\u4e0b\u7684.java\u6587\u4ef6\u3002</li> <li>/folder2/**/*.jsp \u5339\u914d\u5728folder2\u76ee\u5f55\u4e0b\u4efb\u610f\u76ee\u5f55\u6df1\u5ea6\u7684.jsp\u6587\u4ef6\u3002</li> <li>/{type}/{id}.html \u5339\u914d\u4efb\u610f\u6587\u4ef6\u540d\u4e3a{id}.html\uff0c\u5728\u4efb\u610f\u547d\u540d\u7684{type}\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002</li> </ul> <p>\u6ce8\u610f\uff1aAnt \u98ce\u683c\u7684\u8def\u5f84\u6a21\u5f0f\u8bed\u6cd5\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u9700\u8981\u8f6c\u4e49\uff0c\u5982\uff1a</p> <ul> <li>\u8981\u5339\u914d\u6587\u4ef6\u8def\u5f84\u4e2d\u7684\u661f\u53f7\uff0c\u5219\u9700\u8981\u8f6c\u4e49\u4e3a\\\\*\u3002</li> <li>\u8981\u5339\u914d\u6587\u4ef6\u8def\u5f84\u4e2d\u7684\u95ee\u53f7\uff0c\u5219\u9700\u8981\u8f6c\u4e49\u4e3a\\\\?\u3002</li> </ul> <p>2\u3001PathPatternParser \u7b56\u7565 \u4e0eAntPathMatcher \u7b56\u7565\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u533a\u522b\u5728\u4e8e\uff0cPathPatternParser \u7b56\u7565\u4e0d\u652f\u6301\u5728\u8def\u5f84\u7684\u4e2d\u95f4\u4f7f\u7528\u00a0** \u8868\u793a\u4efb\u610f\u6570\u91cf\u7684\u76ee\u5f55\uff0c\u4ec5\u652f\u6301\u5728\u8def\u5f84\u7684\u672b\u5c3e\u4f7f\u7528\u3002\u4f46\u662f PathPatternParser \u5728 jmh \u57fa\u51c6\u6d4b\u8bd5\u4e0b\uff0c\u6709 6~8 \u500d\u541e\u5410\u91cf\u63d0\u5347\uff0c\u964d\u4f4e 30%~40%\u7a7a\u95f4\u5206\u914d\u7387\u3002\u6240\u4ee5\u5982\u679c\u8def\u5f84\u4e2d\u95f4\u9700\u8981\u5339\u914d\u4efb\u610f\u6570\u91cf\u7684\u76ee\u5f55\uff0c\u53ea\u80fd\u66ff\u6362\u6210ant\u98ce\u683c\u8def\u5f84\uff1a Text Only<pre><code># \u6539\u53d8\u8def\u5f84\u5339\u914d\u7b56\u7565\uff1a\n# ant_path_matcher \u8001\u7248\u7b56\u7565\uff1b\n# path_pattern_parser \u65b0\u7248\u7b56\u7565\uff1b\nspring.mvc.pathmatch.matching-strategy=ant_path_matcher\n</code></pre></p> <p>\u4e94\u3001Thymeleaf SpringBoot \u4f7f\u7528\u4e86\u5d4c\u5165\u5f0f Servlet \u5bb9\u5668, \u9ed8\u8ba4\u4e0d\u80fd\u4f7f\u7528JSP\uff0c\u5982\u679c\u9700\u8981\u670d\u52a1\u7aef\u9875\u9762\u6e32\u67d3\uff0c\u4f18\u5148\u8003\u8651\u4f7f\u7528\u6a21\u677f\u5f15\u64ce\uff0c\u6a21\u677f\u5f15\u64ce\u9875\u9762\u9ed8\u8ba4\u653e\u5728 src/main/resources/templates \u3002 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> \u81ea\u52a8\u914d\u7f6e\u539f\u7406</p> <ol> <li>\u5f00\u542f\u4e86 org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration \u81ea\u52a8\u914d\u7f6e</li> <li>\u5c5e\u6027\u7ed1\u5b9a\u5728 ThymeleafProperties \u4e2d\uff0c\u5bf9\u5e94\u914d\u7f6e\u6587\u4ef6 spring.thymeleaf \u5185\u5bb9</li> <li>\u6240\u6709\u7684\u6a21\u677f\u9875\u9762\u9ed8\u8ba4\u5728 classpath:/templates\u6587\u4ef6\u5939\u4e0b</li> <li> <p>\u9ed8\u8ba4\u6548\u679c</p> </li> <li> <p>\u6240\u6709\u7684\u6a21\u677f\u9875\u9762\u5728 classpath:/templates/\u4e0b\u9762\u627e</p> </li> <li>\u627e\u540e\u7f00\u540d\u4e3a.html\u7684\u9875\u9762</li> </ol>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/7.Web%E5%BC%80%E5%8F%91-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86/","title":"7.Web\u5f00\u53d1-\u5185\u5bb9\u534f\u5546","text":"<p> \u7ea6 521 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u5185\u5bb9\u534f\u5546\u662f\u6307\u6839\u636e\u8bf7\u6c42\u6307\u5b9a\u7684\u5185\u5bb9\u683c\u5f0f\u8fd4\u56de\u76f8\u5e94\u683c\u5f0f\u7684\u6570\u636e\u3002 </p> <p>SpringBoot\u652f\u6301\u4e24\u79cd\u5185\u5bb9\u534f\u5546\u7684\u65b9\u5f0f\uff1a 1\u3001\u57fa\u4e8e\u8bf7\u6c42\u5934\u5185\u5bb9\u534f\u5546\uff1a\uff08\u9ed8\u8ba4\u5f00\u542f\uff09 \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\uff0c\u643a\u5e26HTTP\u6807\u51c6\u7684Accept\u8bf7\u6c42\u5934\uff0cAccept: application/json\u3001text/xml\u3001text/yaml\uff0c\u670d\u52a1\u7aef\u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u671f\u671b\u7684\u6570\u636e\u7c7b\u578b\u8fd4\u56de\u76f8\u5e94\u683c\u5f0f\u7684\u6570\u636e\u3002 2\u3001\u57fa\u4e8e\u8bf7\u6c42\u53c2\u6570\u5185\u5bb9\u534f\u5546\uff1a\uff08\u9700\u8981\u5f00\u542f\uff09 \u6bd4\u5982\u53d1\u751f\u8bf7\u6c42\u00a0GET /projects/spring-boot?format=json\u00a0\u65f6\u8fd4\u56deJSON\u683c\u5f0f\u5316\u6570\u636e\uff0c\u53d1\u9001\u00a0GET /projects/spring-boot?format=xml\u00a0\u65f6\u8fd4\u56deXML\u6570\u636e\u3002 Text Only<pre><code># \u5f00\u542f\u57fa\u4e8e\u8bf7\u6c42\u53c2\u6570\u7684\u5185\u5bb9\u534f\u5546\u529f\u80fd\u3002 \u9ed8\u8ba4\u53c2\u6570\u540d\uff1aformat\u3002 \u9ed8\u8ba4\u6b64\u529f\u80fd\u4e0d\u5f00\u542f\nspring.mvc.contentnegotiation.favor-parameter=true\n# \u6307\u5b9a\u5185\u5bb9\u534f\u5546\u65f6\u4f7f\u7528\u7684\u53c2\u6570\u540d\u3002\u9ed8\u8ba4\u662f format\nspring.mvc.contentnegotiation.parameter-name=type\n</code></pre></p> <p>\u54cd\u5e94XML\u683c\u5f0f\u7684\u6570\u636e\uff1a spring-boot-starter-web\u00a0\u5df2\u7ecf\u5bfc\u5165\u4e86\u00a0spring-boot-starter-json\uff0c\u6240\u4ee5\u9ed8\u8ba4\u652f\u6301JSON\u683c\u5f0f\uff0c\u5982\u679c\u9700\u8981\u652f\u6301XML\u683c\u5f0f\uff0c\u5219\u9700\u8981\u5bfc\u5165\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> \u7136\u540e\u518d\u9700\u8981\u5e8f\u5217\u5316\u6210XML\u683c\u5f0f\u7684\u7c7b\u4e0a\u6807\u6ce8\u6ce8\u89e3\uff1a Text Only<pre><code>`@JacksonXmlRootElement\u00a0\u00a0// \u53ef\u4ee5\u5199\u51fa\u4e3axml\u6587\u6863`\n@Data\npublic class Person {\n\u00a0\u00a0\u00a0\u00a0private Long id;\n\u00a0\u00a0\u00a0\u00a0private String userName;\n}\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u5185\u5bb9\u8fd4\u56de \u6bd4\u5982\u589e\u52a0\u8fd4\u56deyaml\u683c\u5f0f\u6570\u636e\u7684\u652f\u6301 1\u3001\u5bfc\u5165yaml\u7684\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;jackson-dataformat-yaml&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> 2\u3001\u7f16\u5199\u914d\u7f6e\uff0c\u65b0\u589e\u4e00\u79cd\u5a92\u4f53\u7c7b\u578b Text Only<pre><code>#\u65b0\u589e\u4e00\u79cd\u5a92\u4f53\u7c7b\u578b\uff0ctext/yaml \u6216\u8005 application/yaml\u00a0\u90fd\u53ef\u4ee5\nspring.mvc.contentnegotiation.media-types.yaml=text/yaml\n</code></pre> 3\u3001\u81ea\u5b9a\u4e49HttpMessageConverter Text Only<pre><code>public class MyYamlHttpMessageConverter extends AbstractHttpMessageConverter&lt;Object&gt; {\n\n\u00a0\u00a0\u00a0\u00a0private ObjectMapper objectMapper = null; //\u628a\u5bf9\u8c61\u8f6c\u6210yaml\n\n\u00a0\u00a0\u00a0\u00a0public MyYamlHttpMessageConverter(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u544a\u8bc9SpringBoot\u8fd9\u4e2aMessageConverter\u652f\u6301\u54ea\u79cd\u5a92\u4f53\u7c7b\u578b\u00a0\u00a0//\u5a92\u4f53\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0super(new MediaType(\"text\", \"yaml\", Charset.forName(\"UTF-8\")));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0YAMLFactory factory = new YAMLFactory()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.disable(YAMLGenerator.Feature.WRITE_DOC_START_MARKER); //\u53bb\u6389\u6587\u6863\u5206\u9694\u7b26 ----\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.objectMapper = new ObjectMapper(factory);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected boolean supports(Class&lt;?&gt; clazz) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53ea\u8981\u662f\u5bf9\u8c61\u7c7b\u578b\uff0c\u4e0d\u662f\u57fa\u672c\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\u00a0\u00a0//@RequestBody\n\u00a0\u00a0\u00a0\u00a0protected Object readInternal(Class&lt;?&gt; clazz, HttpInputMessage inputMessage) throws IOException, HttpMessageNotReadableException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override //@ResponseBody \u628a\u5bf9\u8c61\u600e\u4e48\u5199\u51fa\u53bb\n\u00a0\u00a0\u00a0\u00a0protected void writeInternal(Object methodReturnValue, HttpOutputMessage outputMessage) throws IOException, HttpMessageNotWritableException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//try-with\u5199\u6cd5\uff0c\u81ea\u52a8\u5173\u6d41\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try(OutputStream os = outputMessage.getBody()){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.objectMapper.writeValue(os,methodReturnValue);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 4\u3001\u628a\u81ea\u5b9a\u4e49\u7684HttpMessageConverter\u901a\u8fc7webMvcConfigurer\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d Text Only<pre><code>@Bean\npublic WebMvcConfigurer webMvcConfigurer(){\n\u00a0\u00a0\u00a0\u00a0return new WebMvcConfigurer() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override //\u914d\u7f6e\u4e00\u4e2a\u80fd\u628a\u5bf9\u8c61\u8f6c\u4e3ayaml\u7684messageConverter\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0converters.add(new MyYamlHttpMessageConverter());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0};\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/8.Web%E5%BC%80%E5%8F%91-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/","title":"8.Web\u5f00\u53d1-\u9519\u8bef\u5904\u7406","text":"<p> \u7ea6 750 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>\u9519\u8bef\u5904\u7406\u7684\u81ea\u52a8\u914d\u7f6e\u90fd\u5728ErrorMvcAutoConfiguration\u4e2d\uff0c\u4e24\u5927\u6838\u5fc3\u673a\u5236\uff1a</p> <ol> <li>SpringBoot \u4f1a\u5185\u5bb9\u534f\u5546\u5904\u7406\u9519\u8bef\uff0c\u54cd\u5e94\u9875\u9762\u6216JSON\u6570\u636e\u3002</li> <li>SpringMVC\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u4f9d\u7136\u4fdd\u7559\uff0cSpringMVC\u5904\u7406\u4e0d\u4e86\uff0c\u624d\u4f1a\u4ea4\u7ed9SpringBoot\u8fdb\u884c\u5904\u7406\u3002</li> </ol> <p>SpringBoot\u5f15\u5165Web\u573a\u666f\u4e4b\u540e\u7684\u9519\u8bef\u5904\u7406\u6d41\u7a0b\u5982\u4e0b\uff1a </p> <p>\u53d1\u751f\u9519\u8bef\u4ee5\u540e\uff0cSpringMVC\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u5904\u7406\u4e0d\u4e86\u4f1a\u8f6c\u53d1/error\u8bf7\u6c42\uff0cSpringBoot\u5728\u5e95\u5c42\u5199\u597d\u4e00\u4e2a BasicErrorController\u7684\u7ec4\u4ef6\uff0c\u4e13\u95e8\u5904\u7406\u8fd9\u4e2a/error\u8bf7\u6c42\u3002 ErrorMvcAutoConfiguration\u4e2d\uff1a Text Only<pre><code>@Bean\n@ConditionalOnMissingBean(value = ErrorController.class, search = SearchStrategy.CURRENT)\npublic BasicErrorController basicErrorController(ErrorAttributes errorAttributes,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ObjectProvider&lt;ErrorViewResolver&gt; errorViewResolvers) {\n\u00a0\u00a0\u00a0\u00a0return new BasicErrorController(errorAttributes, this.serverProperties.getError(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0errorViewResolvers.orderedStream().collect(Collectors.toList()));\n}\n</code></pre> BasicErrorController\u5c31\u662f\u666e\u901a\u7684Controller\uff0c\u5b83\u6709\u4e24\u4e2a\u5173\u952e\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u8fd4\u56deHTML\u9875\u9762\u548cJSON\u683c\u5f0f\u6570\u636e\uff1a Text Only<pre><code>@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)\u00a0//\u8fd4\u56deHTML\npublic ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) {\n\u00a0\u00a0\u00a0\u00a0HttpStatus status = getStatus(request);\n\u00a0\u00a0\u00a0\u00a0Map&lt;String, Object&gt; model = Collections\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));\n\u00a0\u00a0\u00a0\u00a0response.setStatus(status.value());\n\u00a0\u00a0\u00a0 `ModelAndView modelAndView = resolveErrorView(request, response, status, model);`\n\u00a0\u00a0\u00a0 `return (modelAndView != null) ? modelAndView : new ModelAndView(\"error\", model);`\n}\n@RequestMapping\u00a0//\u8fd4\u56de ResponseEntity, JSON\npublic ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) {\n\u00a0\u00a0\u00a0\u00a0HttpStatus status = getStatus(request);\n\u00a0\u00a0\u00a0\u00a0if (status == HttpStatus.NO_CONTENT) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ResponseEntity&lt;&gt;(status);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));\n\u00a0\u00a0\u00a0\u00a0return new ResponseEntity&lt;&gt;(body, status);\n}\n</code></pre> \u8fd4\u56de\u9875\u9762\u7684\u65f6\u5019\u9700\u8981\u901a\u8fc7resolveErrorView\u65b9\u6cd5\u89e3\u6790\u5f97\u5230ModelAndView\uff0c\u800cresolveErrorView\u65b9\u6cd5\u5219\u8c03\u7528\u9519\u8bef\u89c6\u56fe\u89e3\u6790\u5668ErrorViewResolver\uff0c\u5728ErrorMvcAutoConfiguration\u4e2d\u81ea\u52a8\u914d\u7f6e\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u9519\u8bef\u89c6\u56fe\u89e3\u6790\u5668\uff1a Text Only<pre><code>@Bean\n@ConditionalOnBean(DispatcherServlet.class)\n@ConditionalOnMissingBean(ErrorViewResolver.class)\nDefaultErrorViewResolver conventionErrorViewResolver() {\n\u00a0\u00a0\u00a0\u00a0return new DefaultErrorViewResolver(this.applicationContext, this.resources);\n}\n</code></pre></p> <p>DefaultErrorViewResolver\u7684\u89e3\u6790\u89c4\u5219\u662f\uff08\u8be5\u89c4\u5219\u4e0e\u4e0a\u56fe\u5c55\u793a\u7684\u6d41\u7a0b\u5bf9\u5e94\uff09\uff1a</p> <ol> <li> <p>\u5982\u679c\u53d1\u751f\u4e86500\u3001404\u3001503\u3001403 \u8fd9\u4e9b\u9519\u8bef</p> </li> <li> <p>\u5982\u679c\u6709\u6a21\u677f\u5f15\u64ce\uff0c\u9ed8\u8ba4\u5728 classpath:/templates/error/\u7cbe\u786e\u7801.html</p> </li> <li> <p>\u5982\u679c\u6ca1\u6709\u6a21\u677f\u5f15\u64ce\uff0c\u5728\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u5939\u4e0b\u627e \u7cbe\u786e\u7801.html</p> </li> <li> <p>\u5982\u679c\u5339\u914d\u4e0d\u5230\u7cbe\u786e\u7801.html\u8fd9\u4e9b\u7cbe\u786e\u7684\u9519\u8bef\u9875\uff0c\u5c31\u53bb\u627e5xx.html\uff0c4xx.html\u6a21\u7cca\u5339\u914d</p> </li> <li> <p>\u5982\u679c\u6709\u6a21\u677f\u5f15\u64ce\uff0c\u9ed8\u8ba4\u5728 classpath:/templates/error/5xx.html</p> </li> <li>\u5982\u679c\u6ca1\u6709\u6a21\u677f\u5f15\u64ce\uff0c\u5728\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u5939\u4e0b\u627e 5xx.html</li> </ol> <p>\u6700\u540e\u5982\u679c\u6ca1\u89e3\u6790\u5230ModelAndView\uff0c\u90a3\u4e48BasicErrorController\u7684errorHtml\u65b9\u6cd5\u6700\u540e\u4e00\u884c\u4f1a\u65b0\u5efa\u4e00\u4e2aerror\u8def\u5f84\u7684ModelAndView\uff0c\u6700\u540e\u53bb\u6a21\u677f\u5f15\u64ce\u8def\u5f84templates\u4e0b\u627e error.html\u9875\u9762\uff0c\u5982\u679c\u6ca1\u6709error.html\u9875\u9762\uff0c\u90a3\u4e48\u4f7f\u7528SpringBoot\u63d0\u4f9b\u7684\u9ed8\u8ba4error\u89c6\u56fe\u3002 \u5728ErrorMvcAutoConfiguration\u4e2d\uff0cSpringBoot\u63d0\u4f9b\u7684\u9ed8\u8ba4\u767d\u9875\u529f\u80fd\uff0c\u540d\u4e3a error \u7684 view\uff1a Text Only<pre><code>@Configuration(proxyBeanMethods = false)\n@ConditionalOnProperty(prefix = \"server.error.whitelabel\", name = \"enabled\", matchIfMissing = true)\n@Conditional(ErrorTemplateMissingCondition.class)\nprotected static class WhitelabelErrorViewConfiguration {\n\u00a0\u00a0\u00a0\u00a0private final StaticView defaultErrorView = new StaticView();\n\n\u00a0\u00a0\u00a0\u00a0@Bean(name = \"error\")\n\u00a0\u00a0\u00a0\u00a0@ConditionalOnMissingBean(name = \"error\")\n\u00a0\u00a0\u00a0\u00a0public View defaultErrorView() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return this.defaultErrorView;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// If the user adds @EnableWebMvc then the bean name view resolver from\n\u00a0\u00a0\u00a0\u00a0// WebMvcAutoConfiguration disappears, so add it back in to avoid disappointment.\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0@ConditionalOnMissingBean\n\u00a0\u00a0\u00a0\u00a0public BeanNameViewResolver beanNameViewResolver() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BeanNameViewResolver resolver = new BeanNameViewResolver();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resolver.setOrder(Ordered.LOWEST_PRECEDENCE - 10);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return resolver;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u9519\u8bef\u5904\u7406\u6700\u4f73\u5b9e\u6218</p> <ul> <li>\u524d\u540e\u5206\u79bb<ul> <li>\u540e\u53f0\u53d1\u751f\u7684\u6240\u6709\u9519\u8bef\uff0c@ControllerAdvice + @ExceptionHandler\u8fdb\u884c\u7edf\u4e00\u5f02\u5e38\u5904\u7406\u3002</li> </ul> </li> <li>\u670d\u52a1\u7aef\u9875\u9762\u6e32\u67d3<ul> <li>\u4e0d\u53ef\u9884\u77e5\u7684\u4e00\u4e9b\uff0cHTTP\u7801\u8868\u793a\u7684\u670d\u52a1\u5668\u6216\u5ba2\u6237\u7aef\u9519\u8bef<ul> <li>\u7ed9classpath:/templates/error/\u4e0b\u9762\uff0c\u653e\u5e38\u7528\u7cbe\u786e\u7684\u9519\u8bef\u7801\u9875\u9762\u3002500.html\uff0c404.html</li> <li>\u7ed9classpath:/templates/error/\u4e0b\u9762\uff0c\u653e\u901a\u7528\u6a21\u7cca\u5339\u914d\u7684\u9519\u8bef\u7801\u9875\u9762\u3002 5xx.html\uff0c4xx.html</li> </ul> </li> <li>\u53d1\u751f\u4e1a\u52a1\u9519\u8bef<ul> <li>\u6838\u5fc3\u4e1a\u52a1\uff0c\u6bcf\u4e00\u79cd\u9519\u8bef\uff0c\u90fd\u5e94\u8be5\u4ee3\u7801\u63a7\u5236\uff0c\u8df3\u8f6c\u5230\u81ea\u5df1\u5b9a\u5236\u7684\u9519\u8bef\u9875\u3002</li> <li>\u901a\u7528\u4e1a\u52a1\uff0cclasspath:/templates/error.html\u9875\u9762\uff0c\u663e\u793a\u9519\u8bef\u4fe1\u606f\u3002</li> </ul> </li> </ul> </li> </ul>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringBoot/9.Web%E5%BC%80%E5%8F%91-%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8/","title":"9.Web\u5f00\u53d1-\u5d4c\u5165\u5f0f\u5bb9\u5668","text":"<p> \u7ea6 313 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u4e00\u3001\u5d4c\u5165\u5f0fTomcat\u7684\u81ea\u52a8\u914d\u7f6e\u539f\u7406 Servlet\u5bb9\u5668\uff1a\u7ba1\u7406\u3001\u8fd0\u884cServlet\u7ec4\u4ef6\uff08Servlet\u3001Filter\u3001Listener\uff09\u7684\u73af\u5883\uff0c\u4e00\u822c\u6307\u670d\u52a1\u5668\u3002SpringBoot \u9ed8\u8ba4\u5d4c\u5165Tomcat\u4f5c\u4e3aServlet\u5bb9\u5668\u3002 \u81ea\u52a8\u914d\u7f6e\u7c7b\u662fServletWebServerFactoryAutoConfiguration\uff0c\u7ed1\u5b9a\u4e86ServerProperties\u914d\u7f6e\u7c7b\uff0c\u6240\u6709\u548c\u670d\u52a1\u5668\u6709\u5173\u7684\u914d\u7f6e\u7684\u524d\u7f00\u662f server\u3002 Text Only<pre><code>@Configuration(proxyBeanMethods = false)\n@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)\n@ConditionalOnClass(ServletRequest.class)\n@ConditionalOnWebApplication(type = Type.SERVLET)\n`@EnableConfigurationProperties(ServerProperties.class)`\n`@Import({ ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,`\n `ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,`\n `ServletWebServerFactoryConfiguration.EmbeddedJetty.class,`\n `ServletWebServerFactoryConfiguration.EmbeddedUndertow.class })`\npublic class ServletWebServerFactoryAutoConfiguration {\n}\n</code></pre> ServletWebServerFactoryAutoConfiguration \u5bfc\u5165\u4e86 \u5d4c\u5165\u5f0f\u7684\u4e09\u5927\u670d\u52a1\u5668 Tomcat\u3001Jetty\u3001Undertow\uff0c\u5b83\u4eec\u90fd\u6709\u6761\u4ef6\u6ce8\u89e3\uff0c\u53ea\u6709\u5bfc\u5165\u4e86\u76f8\u5e94\u7684\u5305\u624d\u4f1a\u751f\u6548\u3002 ServletWebServerFactoryConfiguration.EmbeddedTomcat\u5411\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e86\u4e00\u4e2aTomcatServletWebServerFactory\u00a0\u7ec4\u4ef6\uff0c\u5728TomcatServletWebServerFactory\u7684getWebServer\u65b9\u6cd5\u4e2d\u4f1a\u521b\u5efaTomcat tomcat = new Tomcat();\u00a0\u800c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u88abServletWebServerApplicationContext\u5728onRefresh()\u65b9\u6cd5\u4e2d\u8c03\u7528\uff0cServletWebServerApplicationContext\u662f\u4e00\u4e2aioc\u5bb9\u5668\uff0cSpring\u5bb9\u5668\u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u9884\u7559\u4e00\u4e2a\u65f6\u673a\u5237\u65b0\u5b50\u5bb9\u5668\uff0c\u5373\u8c03\u7528\u5b50\u5bb9\u5668\u7684onRefresh()\u65b9\u6cd5\uff0c\u6240\u4ee5\u5d4c\u5165\u5f0f\u7684Tomcat\u5bb9\u5668\u4f1a\u5728ioc\u5bb9\u5668\u521b\u5efa\u65f6\u521b\u5efa\u3002 Text Only<pre><code>@Configuration(proxyBeanMethods = false)\n@ConditionalOnClass({ Servlet.class, Tomcat.class, UpgradeProtocol.class })\n@ConditionalOnMissingBean(value = ServletWebServerFactory.class, search = SearchStrategy.CURRENT)\nstatic class EmbeddedTomcat {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0TomcatServletWebServerFactory tomcatServletWebServerFactory(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ObjectProvider&lt;TomcatConnectorCustomizer&gt; connectorCustomizers,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ObjectProvider&lt;TomcatContextCustomizer&gt; contextCustomizers,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ObjectProvider&lt;TomcatProtocolHandlerCustomizer&lt;?&gt;&gt; protocolHandlerCustomizers) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0factory.getTomcatConnectorCustomizers()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.addAll(connectorCustomizers.orderedStream().collect(Collectors.toList()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0factory.getTomcatContextCustomizers()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.addAll(contextCustomizers.orderedStream().collect(Collectors.toList()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0factory.getTomcatProtocolHandlerCustomizers()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.addAll(protocolHandlerCustomizers.orderedStream().collect(Collectors.toList()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return factory;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001\u5207\u6362\u5bb9\u5668 \u5207\u6362jetty\u670d\u52a1\u5668\uff1a \u5148\u6392\u9664spring-boot-starter-tomcat\uff0c\u7136\u540e\u518d\u5f15\u5165spring-boot-starter-jetty\u3002 Text Only<pre><code>&lt;properties&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;servlet-api.version&gt;3.1.0&lt;/servlet-api.version&gt;\n&lt;/properties&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;exclusions&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- Exclude the Tomcat dependency --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;exclusion&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/exclusion&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/exclusions&gt;\n&lt;/dependency&gt;\n&lt;!-- Use Jetty instead --&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/1-RestTemplate/","title":"1-RestTemplate","text":"<p> \u7ea6 374 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>Spring \u63d0\u4f9b\u4e86\u4e00\u4e2aHttp Rest API \u7684\u5ba2\u6237\u7aef\uff0cRestTemplate\u63d0\u4f9b\u4e86\u4e0d\u540c\u5c01\u88c5\u7a0b\u5ea6\u7684\u63a5\u53e3\u8ba9\u6211\u4eec\u975e\u5e38\u65b9\u4fbf\u5730\u8fdb\u884c Rest API \u8c03\u7528\u3002 1\u3001\u521b\u5efaRestTemplate Text Only<pre><code>@Bean\npublic RestTemplate restTemplate(ClientHttpRequestFactory factory) {\n\u00a0\u00a0\u00a0\u00a0RestTemplate restTemplate = new RestTemplate(factory);\n\u00a0\u00a0\u00a0\u00a0return restTemplate;\n}\n\n@Bean\npublic ClientHttpRequestFactory simpleClientHttpRequestFactory() {\n\u00a0\u00a0\u00a0\u00a0SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();\n\u00a0\u00a0\u00a0\u00a0factory.setReadTimeout(5000);\n\u00a0\u00a0\u00a0\u00a0factory.setConnectTimeout(15000);\n\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u4ee3\u7406\n\u00a0\u00a0\u00a0\u00a0//factory.setProxy(null);\n\u00a0\u00a0\u00a0\u00a0return factory;\n}\n</code></pre></p> <p>2\u3001getForObject()\u3001getForEntity()\u3001postForObject()\u3001postForEntity()\uff0c\u8fd9\u7c7b\u65b9\u6cd5\u662f\u5e38\u89c4\u7684 Rest API\uff08GET\u3001POST\u3001DELETE \u7b49\uff09\u65b9\u6cd5\u8c03\u7528\u3002</p> Text Only<pre><code>Map&lt;String, String&gt; vars = Collections.singletonMap(\"hotel\", \"42\");\n// \u901a\u8fc7 GET \u65b9\u5f0f\u8c03\u7528\uff0c\u8fd4\u56de\u4e00\u4e2a String \u503c\uff0c\u8fd8\u53ef\u4ee5\u7ed9 URL \u53d8\u91cf\u8bbe\u7f6e\u503c\uff08\u4e5f\u53ef\u901a\u8fc7 uriTemplateHandler \u8fd9\u4e2a\u5c5e\u6027\u81ea\u5b9a\u4e49\uff09\nString result = restTemplate.getForObject(\"https://example.com/hotels/{hotel}/rooms/{hotel}\", String.class, vars);\n\nString url = \"http://127.0.0.1:8080/hello\";\nJSONObject param = new JSONObject();\n//restTemplate \u4f1a\u6839\u636e params \u7684\u5177\u4f53\u7c7b\u578b\uff0c\u8c03\u7528\u5408\u9002\u7684 HttpMessageConvert \u5c06\u8bf7\u6c42\u53c2\u6570\u5199\u5230\u8bf7\u6c42\u4f53 body \u4e2d\uff0c\u5e76\u5728\u8bf7\u6c42\u5934\u4e2d\u6dfb\u52a0\u5408\u9002\u7684 content-type\uff1b\n// \u4e5f\u4f1a\u6839\u636e responseType \u7684\u7c7b\u578b\uff08\u672c\u5217\u5b50\u4e2d\u662f JSONObject\uff09\uff0c\u8bbe\u7f6e head \u4e2d\u7684 accept \u5b57\u6bb5\uff0c\u5f53\u54cd\u5e94\u8fd4\u56de\u7684\u65f6\u5019\u518d\u8c03\u7528\u5408\u9002\u7684 HttpMessageConvert \u8fdb\u884c\u54cd\u5e94\u8f6c\u6362\nResponseEntity&lt;JSONObject&gt; responseEntity=restTemplate.postForEntity(url,params,JSONObject.class);\nint statusCodeValue = responseEntity.getStatusCodeValue();\nHttpHeaders headers = responseEntity.getHeaders();\nJSONObject body = responseEntity.getBody();\n</code></pre> <p>3\u3001exchange()\uff0c\u63a5\u6536\u4e00\u4e2a RequestEntity \u53c2\u6570\uff0c\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e HTTP method\uff0cURL\uff0cheaders \u548c body\uff0c\u8fd4\u56de ResponseEntity\u3002 Text Only<pre><code>UriComponents uriComponents = UriComponentsBuilder.fromHttpUrl(\"127.0.0.1:8080\").path(\"/test\").build(true);\nURI uri = uriComponents.toUri();\nRequestEntity&lt;JSONObject&gt; requestEntity = RequestEntity.post(uri).\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6dfb\u52a0 cookie(\u8fd9\u8fb9\u6709\u4e2a\u95ee\u9898\uff0c\u5047\u5982\u6211\u4eec\u8981\u8bbe\u7f6e cookie \u7684\u751f\u547d\u5468\u671f\uff0c\u4f5c\u7528\u57df\u7b49\u53c2\u6570\u6211\u4eec\u8981\u600e\u4e48\u64cd\u4f5c)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0header(HttpHeaders.COOKIE,\"key1=value1\").\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6dfb\u52a0 header\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0header((\"MyRequestHeader\", \"MyValue\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0accept(MediaType.APPLICATION_JSON).\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0contentType(MediaType.APPLICATION_JSON).\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0body(requestParam);\nResponseEntity&lt;JSONObject&gt; responseEntity = restTemplate.exchange(requestEntity,JSONObject.class);\n// \u54cd\u5e94\u7ed3\u679c\nJSONObject responseEntityBody = responseEntity.getBody();\n</code></pre></p> <p>\u53c2\u8003\uff1a RestTemplate \u6700\u8be6\u89e3 - \u7a0b\u5e8f\u5458\u81ea\u7531\u4e4b\u8def - \u535a\u5ba2\u56ed (cnblogs.com)</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/2-Consul/","title":"2-Consul","text":"<p> \u7ea6 831 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <p>\u4e3b\u8981\u4f7f\u7528Consul\u63d0\u4f9b\u7684 \u670d\u52a1\u53d1\u73b0\u00a0\u548c \u914d\u7f6e\u4e2d\u5fc3 \u4e24\u9879\u670d\u52a1\u3002</p> <p>\u4e00\u3001\u5b89\u88c5\u542f\u52a8Consul \u4ee5\u5f00\u53d1\u8005\u6a21\u5f0f\u542f\u52a8\uff1aconsul agent -dev \u4ee5\u670d\u52a1\u5668\u6a21\u5f0f\u542f\u52a8\u5e76\u5c06\u914d\u7f6e\u6570\u636e\u6301\u4e45\u5316\uff1aconsul\u00a0 agent -server -data-dir D:\\consul\\data \u8bbf\u95ee\uff1ahttp://localhost:8500/</p> <p>\u4e8c\u3001\u5f15\u5165SpringCloud\u5f00\u53d1\u73af\u5883 BOM \u4e0e POM\u7684\u533a\u522b\uff1f POM\u6587\u4ef6\u662fMaven\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u679cMaven\u9879\u76ee\u6307\u5b9a\u6253\u5305\u4e3aPOM\u7c7b\u578b\uff0c\u6bd4\u5982spring-boot-starter-parent\uff0c\u8fd9\u79cd\u5de5\u7a0b\u53ea\u662f\u7528\u6765\u7ba1\u7406\u4f9d\u8d56\uff0c\u4e0d\u5305\u542bjava\u4ee3\u7801\u6587\u4ef6\uff0c\u5728\u8be5POM\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528\u7ba1\u7406\u4f9d\u8d56\u7684\u7248\u672c\uff0c\u4f46\u4e0d\u5f15\u5165\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5f15\u5165\u4f9d\u8d56\uff0c\u5982\u679cPOM\u6587\u4ef6\u53ea\u5305\u542b\uff0c\u90a3\u4e48\u5c31\u79f0\u8fd9\u79cdPOM\u4e3aBOM\uff08Bill of Materials\uff0c\u7269\u6599\u6e05\u5355\uff09\u3002 Text Only<pre><code>&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n&lt;packaging&gt;pom&lt;/packaging&gt;\n&lt;name&gt;spring-boot-starter-parent&lt;/name&gt;\n</code></pre> BOM\u53ef\u4ee5\u88ab\u7ee7\u627f\uff0c\u5b50\u9879\u76ee\u7ee7\u627f\u4e86BOM\u4e2d\u7684\u6240\u6709\u5b9a\u4e49\uff0c\u4f46\u6ca1\u5b9e\u9645\u5f15\u5165\u4f9d\u8d56\uff0c Text Only<pre><code>&lt;parent&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.3.2&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n&lt;/parent&gt;\n</code></pre> \u5b50\u9879\u76ee\u53ea\u80fd\u7ee7\u627f\u4e00\u4e2aBOM\uff0c\u5982\u679c\u5b50\u9879\u76ee\u8fd8\u60f3\u5f15\u5165\u5176\u4ed6BOM\u4e2d\u7684\u6240\u6709\u5b9a\u4e49\uff0c\u5219\u5e94\u8be5\u4f7f\u7528import\uff08\u8fd9\u4e2a\u6807\u7b7e\u503c\u53ea\u80fd\u5728dependencyManagement\u6807\u7b7e\u4e0b\u4f7f\u7528\uff0c\u5e76\u4e14\u4ec5\u7528\u4e8etype\u4e3a\"pom\"\u7684dependency\uff0c\u5176\u610f\u4e49\u4e3a\u5f15\u5165\u8be5dependency\u7684pom\u4e2d\u7684\u6240\u6709\u5b9a\u4e49\u3002\uff09\uff1a Text Only<pre><code>&lt;properties&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;spring-cloud.version&gt;2023.0.2&lt;/spring-cloud.version&gt;\n&lt;/properties&gt;\n&lt;dependencyManagement&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependencies&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;${spring-cloud.version}&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;type&gt;pom&lt;/type&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `&lt;scope&gt;import&lt;/scope&gt;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependencies&gt;\n&lt;/dependencyManagement&gt;\n</code></pre> spring-cloud-dependencies \u662f\u4e00\u4e2aBOM\uff0c\u7ba1\u7406\u4e86\u6240\u6709SpringCloud\u7684\u4f9d\u8d56\uff0c\u6240\u4ee5\u9996\u5148\u9700\u8981\u5728\u4e2d\u5f15\u5165\u3002\u4e0b\u9762\u8fd9\u4e2astarter\u4f7f\u7528\u5176\u4ed6SpringCloud\u7ec4\u4ef6\u65f6\u4e00\u822c\u90fd\u88ab\u52a8\u5f15\u5165\u4e86\uff0c\u6240\u4ee5\u5728\u9879\u76ee\u4e2d\u4e0d\u5f15\u5165\u4e5f\u884c\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-starter&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> \u53c2\u8003\uff1a Maven\u4e2dpom\u6587\u4ef6\u5185scope\u6807\u7b7e\u4e2dimport\u503c\u7684\u8be6\u89e3 - \u4e4b\u4e4b\u5c0f\u4fa0 - \u535a\u5ba2\u56ed (cnblogs.com) <p>\u4e09\u3001\u670d\u52a1\u53d1\u73b0 \u670d\u52a1\u53d1\u73b0\uff1a\u628a\u670d\u52a1\u6ce8\u518c\u5230Consul\u4e2d\uff0c\u5176\u4ed6\u670d\u52a1\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u670d\u52a1\u540d\u8bbf\u95ee\u8be5\u670d\u52a1\uff08DNS\uff09\u3002 1\u3001\u5411Consul\u4e2d\u6ce8\u518c\u670d\u52a1 \u5f15\u5165\u670d\u52a1\u53d1\u73b0\u7684\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> \u542f\u52a8\u9879\u76ee\u5373\u53ef\u81ea\u52a8\u6ce8\u518c\u5230Consul\uff0cConsul\u9ed8\u8ba4\u7684\u5730\u5740\u662flocalhost:8500\uff0c\u53ef\u4ee5\u5728application.yml\u4e2d\u6539\uff1a Text Only<pre><code>spring:\n\u00a0 application:\n\u00a0 \u00a0 name: cloud-payment-service\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0consul:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0host: localhost\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0port: 8500\n</code></pre> Consul\u9700\u8981\u5bf9\u670d\u52a1\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u5f15\u5165actuator\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>2\u3001\u670d\u52a1\u53d1\u73b0 Text Only<pre><code>@Resource\npublic void serviceUrl(DiscoveryClient discoveryClient) {\n\u00a0\u00a0\u00a0\u00a0List&lt;ServiceInstance&gt; list = discoveryClient.getInstances(\"cloud-payment-service\");\n\u00a0\u00a0\u00a0\u00a0list.forEach(si -&gt; System.out.println(si.getHost() + \":\" + si.getPort()));\n}\n</code></pre></p> <p>3\u3001\u4f7f\u7528\u670d\u52a1\u53d1\u73b0\u8c03\u7528\u5176\u4ed6\u670d\u52a1 \u4f7f\u7528RestTemplate\u8fdb\u884c\u8c03\u7528\uff0c\u6240\u4ee5\u5148\u521b\u5efaRestTemplate\uff0c\u5fc5\u987b\u6dfb\u52a0@LoadBalanced\u6ce8\u89e3\uff0c\u8fd9\u4e2a\u6ce8\u89e3\u7684\u529f\u80fd\u6709\u4e24\u4e2a\uff0c\u4e00\u662f\u628a\u670d\u52a1\u540d\u8f6c\u6362\u6210ip+post\uff0c\u4e8c\u662f\u5982\u679c\u8be5\u670d\u52a1\u6709\u591a\u4e2a\uff0c\u8fd8\u80fd\u6309\u4e00\u5b9a\u7684\u7b56\u7565\u8d1f\u8f7d\u5747\u8861\u5730\u8c03\u7528\uff08\u5ba2\u6237\u7aef\u4fa7\u7684\u8d1f\u8f7d\u5747\u8861\uff09\u3002 Text Only<pre><code>@Configuration\npublic class RestTemplateConfig {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0@LoadBalanced\n\u00a0\u00a0\u00a0\u00a0public RestTemplate restTemplate() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new RestTemplate();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4f7f\u7528\u670d\u52a1\u540d\u8c03\u7528\u670d\u52a1\uff0c Text Only<pre><code>public String serviceMethod() {\n\u00a0\u00a0\u00a0\u00a0Map&lt;String, String&gt; vars = Collections.singletonMap(\"id\", \"1\");\n\u00a0\u00a0\u00a0\u00a0String res = restTemplate.getForObject(\"http://cloud-payment-service/pay/get/{id}\", String.class, vars);\n\u00a0\u00a0\u00a0\u00a0return res;\n}\n</code></pre> \u6ce8\u610f\uff0c\u5982\u679c\u88ab\u8c03\u7528\u7684\u670d\u52a1\u5982\u679c\u8fd4\u56de500\u7684http\u72b6\u6001\u5417\uff0c\u90a3\u4e48\u5728\u8c03\u7528\u8005\u8fd9\u91cc\u4f1a\u629b\u5f02\u5e38\uff0c\u4e5f\u5c06\u8fd4\u56de500\u3002</p> <p>\u56db\u3001\u914d\u7f6e\u4e2d\u5fc3 1\u3001\u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;!--SpringCloud consul config--&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>2\u3001\u6dfb\u52a0bootstrap.yml\uff0c\u5728\u7a0b\u5e8f\u542f\u52a8\u65f6\u5bb9\u5668\u521b\u5efa\u524d\u52a0\u8f7d\uff0c\u4f18\u5148\u4e8eapplication.yml Text Only<pre><code>spring:\n\u00a0\u00a0application:\n\u00a0\u00a0\u00a0\u00a0name: SpringCloudTest\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0consul:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0host: localhost\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0port: 8500\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0discovery:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0service-name: ${spring.application.name}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0enabled: true\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0profile-separator: '-' # default value is \",\"\uff0cwe update '-'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0format: YAML\n</code></pre></p> <p>3\u3001\u5728Consul\u4e2d\u6dfb\u52a0KV \u9ed8\u8ba4\u8bfb\u53d6\u914d\u7f6e\u7684\u8def\u5f84\uff1a Text Only<pre><code>config/SpringCloudTest-dev/data # \u5982\u679c\u6fc0\u6d3b\u4e86dev\u914d\u7f6e\u6587\u4ef6\nconfig/application/data\n</code></pre> </p> <p>4\u3001\u8bfb\u53d6\u914d\u7f6e Text Only<pre><code>@RequestMapping(\"/req2\")\npublic String req2(@Value(\"${infoA}\") String str) {\n\u00a0\u00a0\u00a0\u00a0return str;\n}\n</code></pre> \u5f53consul\u4e0a\u7684\u914d\u7f6e\u6539\u53d8\u4e86\uff0c\u4e0a\u9762\u4ee3\u7801\u8bfb\u5230\u7684\u7ed3\u679c\u4e5f\u4f1a\u7acb\u523b\u53d1\u751f\u6539\u53d8\uff0c\u4f46\u662f\u4e0b\u9762\u7684\u60c5\u51b5\u4e0d\u4f1a\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u914d\u7f6e\u53ea\u4f1a\u5728\u6784\u9020bean\u7684\u65f6\u5019\u8bfb\u4e00\u6b21\u3002 Text Only<pre><code>@Value(\"${infoA}\")\nprivate String info;\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/3-spring-cloud-loadbalancer/","title":"3-spring-cloud-loadbalancer","text":"<p> \u7ea6 436 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>Nginx\u662f\u670d\u52a1\u5668\u7aef\u7684\u8d1f\u8f7d\u5747\u8861\uff0cloadbalancer\u662f\u5ba2\u6237\u7aef\u7684\u8d1f\u8f7d\u5747\u8861\u3002 \u4e00\u3001\u5355\u72ec\u4f7f\u7528loadbalancer\uff0c\u4e0d\u4f7f\u7528\u670d\u52a1\u53d1\u73b0 \u5b98\u7f51\u7684\u4f8b\u5b50\uff08 Getting Started | Client-Side Load-Balancing with Spring Cloud LoadBalancer\uff09 1\u3001\u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;!--loadbalancer--&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-starter-loadbalancer&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> 2\u3001\u5728\u5ba2\u6237\u7aef\u4e0a\u52a0@LoadBalanced\u6ce8\u89e3\u5373\u53ef\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u8bbf\u95ee\u670d\u52a1\uff0c@LoadBalancerClient\u6307\u660e\u8bbf\u95ee\u670d\u52a1\u7684\u7b56\u7565\uff0c\u8fd9\u91cc\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a\u6ce8\u89e3\u6307\u660e\u670d\u52a1\u7684\u5730\u5740\uff08\u786c\u7f16\u7801\u5728\u4ee3\u7801\u91cc\uff0c\u6240\u4ee5\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u66f4\u63a8\u8350\u4f7f\u7528\u670d\u52a1\u53d1\u73b0\u7684\u65b9\u5f0f\uff09 Text Only<pre><code>@Configuration\n@LoadBalancerClient(name = \"say-hello\", configuration = SayHelloConfiguration.class)\npublic class WebClientConfig {\n\u00a0\u00a0\u00a0\u00a0@LoadBalanced\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0WebClient.Builder webClientBuilder() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return WebClient.builder();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>public class SayHelloConfiguration {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0@Primary\n\u00a0\u00a0\u00a0\u00a0ServiceInstanceListSupplier serviceInstanceListSupplier() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new DemoServiceInstanceListSuppler(\"say-hello\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n\nclass DemoServiceInstanceListSuppler implements ServiceInstanceListSupplier {\n\n\u00a0\u00a0\u00a0\u00a0private final String serviceId;\n\n\u00a0\u00a0\u00a0\u00a0DemoServiceInstanceListSuppler(String serviceId) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.serviceId = serviceId;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String getServiceId() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return serviceId;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Flux&lt;List&lt;ServiceInstance&gt;&gt; get() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Flux.just(Arrays\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.asList(new DefaultServiceInstance(serviceId + \"1\", serviceId, \"localhost\", 8090, false),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new DefaultServiceInstance(serviceId + \"2\", serviceId, \"localhost\", 9092, false),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new DefaultServiceInstance(serviceId + \"3\", serviceId, \"localhost\", 9999, false)));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001\u4f7f\u7528\u670d\u52a1\u53d1\u73b0 1\u3001\u5f15\u5165Consul\u670d\u52a1\u53d1\u73b0\u7684\u4f9d\u8d56spring-cloud-starter-consul-discovery\u4e5f\u5c31\u5f15\u5165\u4e86loadbalancer\u7684\u4f9d\u8d56\u4e86\uff0c\u53ef\u4ee5\u4e0d\u7528\u5355\u72ec\u5f15\u5165\u3002 2\u3001\u542f\u52a8\u88ab\u8bbf\u95ee\u7684\u670d\u52a1\u591a\u6b21  3\u3001\u5728\u5ba2\u6237\u7aef\u4e0a\u52a0@LoadBalanced\u6ce8\u89e3\u5373\u53ef\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u8bbf\u95ee\u670d\u52a1 Text Only<pre><code>@Configuration\npublic class RestTemplateConfig {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0@LoadBalanced //\u4f7f\u7528@LoadBalanced\u6ce8\u89e3\u8d4b\u4e88RestTemplate\u8d1f\u8f7d\u5747\u8861\u7684\u80fd\u529b\n\u00a0\u00a0\u00a0\u00a0public RestTemplate restTemplate() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new RestTemplate();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u670d\u52a1\u53d1\u73b0\u5e95\u5c42\u4f7f\u7528\u7684\u662fDiscoveryClient\u7c7b\u3002</p> <p>\u4e09\u3001\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u9009\u62e9 \u9ed8\u8ba4\u7684\u7b56\u7565\u662fRoundRobinLoadBalancer\uff08\u8f6e\u8be2\uff09\uff0c\u53ef\u4ee5\u66ff\u6362\u6210RandomLoadBalancer\uff08\u968f\u673a\uff09\uff1a Text Only<pre><code>public class CustomLoadBalancerConfiguration {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0ReactorLoadBalancer&lt;ServiceInstance&gt; randomLoadBalancer(Environment environment,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LoadBalancerClientFactory loadBalancerClientFactory) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new RandomLoadBalancer(loadBalancerClientFactory\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.getLazyProvider(name, ServiceInstanceListSupplier.class),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name);\n\u00a0\u00a0\u00a0\u00a0}\n}\n\n@Configuration\n@LoadBalancerClient(value = \"cloud-payment-service\",configuration =CustomLoadBalancerConfiguration.class)\npublic class RestTemplateConfig\n{\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0@LoadBalanced //\u4f7f\u7528@LoadBalanced\u6ce8\u89e3\u8d4b\u4e88RestTemplate\u8d1f\u8f7d\u5747\u8861\u7684\u80fd\u529b\n\u00a0\u00a0\u00a0\u00a0public RestTemplate restTemplate(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new RestTemplate();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c\u6ce8\u610f@LoadBalancerClient\u53ef\u4ee5\u6307\u5b9a\u670d\u52a1\u540d\uff0c\u4ece\u800c\u5b9e\u73b0\u8bbf\u95ee\u4e0d\u540c\u670d\u52a1\u4f7f\u7528\u4e0d\u540c\u7684\u7b56\u7565\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/4-OpenFeign/","title":"4-OpenFeign","text":"<p> \u7ea6 605 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>Feign\u662f\u4e00\u4e2a\u58f0\u660e\u5f0f\u7684Web\u5ba2\u6237\u7aef\uff08Declarative REST Client\uff09\u3002\u524d\u9762\u4f7f\u7528RestTemplate\u9700\u8981\u62fc\u4e32\u5f97\u5230URL\uff0c\u8c03\u7528\u4e5f\u6bd4\u8f83\u7e41\u7410\uff0cOpenFeign\u91c7\u7528\u63a5\u53e3\u8c03\u7528\u7684\u65b9\u5f0f\u7b80\u5316\u4e86RPC\u8c03\u7528\u7684\u65b9\u5f0f\uff0c\u56e0\u4e3aFegin\u4f1a\u52a8\u6001\u521b\u5efa\u63a5\u53e3\u7684\u5b9e\u73b0\u3002 \u4e00\u3001\u57fa\u672c\u4f7f\u7528 1\u3001\u5f15\u5165Fegin\u7684\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> 2\u3001\u5728\u4e3b\u7a0b\u5e8f\u4e0a\u4f7f\u7528@EnableFeignClients\u6ce8\u89e3 Text Only<pre><code>@SpringBootApplication\n@EnableFeignClients\npublic class Application {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringApplication.run(Application.class, args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 3\u3001\u58f0\u660e\u8fdc\u7a0b\u8c03\u7528\u7684\u63a5\u53e3 @FeignClient\u4e2d\u586b\u88ab\u8c03\u7528\u670d\u52a1\u7684\u540d\u79f0 Text Only<pre><code>@FeignClient(value = \"cloud-payment-service\")\npublic interface PayFeignApi {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6309\u7167\u4e3b\u952e\u8bb0\u5f55\u67e5\u8be2\u652f\u4ed8\u6d41\u6c34\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@GetMapping(value = \"/pay/get/{id}\")\n\u00a0\u00a0\u00a0\u00a0public ResultData getPayInfo(@PathVariable(\"id\") Integer id);\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* `openfeign\u5929\u7136\u652f\u6301\u8d1f\u8f7d\u5747\u8861\u6f14\u793a`\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@GetMapping(value = \"/pay/get/info\")\n\u00a0\u00a0\u00a0\u00a0public String mylb();\n}\n</code></pre> 4\u3001\u8c03\u7528\u670d\u52a1 Text Only<pre><code>@RestController\npublic class FeignTestController {\n\u00a0\u00a0\u00a0\u00a0@Resource\n\u00a0\u00a0\u00a0\u00a0private PayFeignApi payFeignApi;\n\n\u00a0\u00a0\u00a0\u00a0@RequestMapping(\"/feign/req1\")\n\u00a0\u00a0\u00a0\u00a0public String req1() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ResultData resultData = payFeignApi.getPayInfo(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(resultData);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return resultData.toString();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@RequestMapping(\"/feign/req2\")\n\u00a0\u00a0\u00a0\u00a0public String req2() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String mylb = payFeignApi.mylb();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(mylb);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return mylb;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6ce8\u610f\uff0c\u548cRestTemplate\u4e00\u6837\uff0c\u5982\u679c\u88ab\u8c03\u7528\u7684\u670d\u52a1\u5982\u679c\u8fd4\u56de500\u7684http\u72b6\u6001\u5417\uff0c\u90a3\u4e48\u5728\u8c03\u7528\u8005\u8fd9\u91cc\u4f1a\u629b\u5f02\u5e38\uff0c\u4e5f\u5c06\u8fd4\u56de500\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u200cFeign\u5728\u9047\u5230\u975e2xx\u7684HTTP\u72b6\u6001\u7801\u65f6\uff0c\u200c\u4f1a\u629b\u51fa\u4e00\u4e2afeign.FeignException\u3002\u200c\u8fd9\u4e2a\u5f02\u5e38\u5305\u542b\u4e86\u54cd\u5e94\u7684\u72b6\u6001\u7801\u3001\u200c\u8bf7\u6c42\u7684\u65b9\u6cd5\u3001\u200cURL\u7b49\u4fe1\u606f\uff0c\u200c\u4f46\u53ef\u80fd\u4e0d\u8db3\u4ee5\u76f4\u63a5\u53cd\u6620\u5177\u4f53\u7684\u4e1a\u52a1\u9519\u8bef\u3002\u200c\u4e3a\u4e86\u66f4\u7075\u6d3b\u5730\u5904\u7406\u5f02\u5e38\uff0c\u200c\u4f60\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684ErrorDecoder\u3002\u200cErrorDecoder\u63a5\u53e3\u5b9a\u4e49\u4e86\u4e00\u4e2adecode\u65b9\u6cd5\uff0c\u200c\u5b83\u63a5\u6536\u4e00\u4e2aResponse\u5bf9\u8c61\uff0c\u200c\u5e76\u6839\u636e\u54cd\u5e94\u7684\u72b6\u6001\u7801\u548c\u5185\u5bb9\u6765\u51b3\u5b9a\u662f\u5426\u629b\u51fa\u5f02\u5e38\uff0c\u200c\u4ee5\u53ca\u629b\u51fa\u4ec0\u4e48\u7c7b\u578b\u7684\u5f02\u5e38\u3002\u200c 5\u3001\u6700\u4f73\u5b9e\u8df5 \u5bf9\u4e8e\u591a\u4e2a\u6a21\u5757\u90fd\u8981\u8c03\u7528\u7684api\u63a5\u53e3\uff0c\u628afeign\u63a5\u53e3\u58f0\u660e\u5199\u5728common\u6a21\u5757\uff0c\u5982\u679c\u4ec5\u5728\u67d0\u4e2a\u6a21\u5757\u4e2d\u8c03\u7528\uff0c\u90a3\u5c31\u628afeign\u63a5\u53e3\u58f0\u660e\u5199\u5728\u81ea\u5df1\u6240\u5728\u7684\u6a21\u5757\u4e2d\u3002</p> <p>\u4e8c\u3001OpenFeign\u5176\u4ed6\u8bbe\u7f6e 1\u3001\u8d85\u65f6\u8bbe\u7f6e Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0openfeign:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0client:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 #\u5168\u5c40\u8bbe\u7f6e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0default:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 connectTimeout: 3000\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u8bfb\u53d6\u8d85\u65f6\u65f6\u95f4\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 readTimeout: 3000\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 #\u7ed9\u67d0\u4e2a\u670d\u52a1\u5355\u72ec\u8bbe\u7f6e\u8d85\u65f6\u8bbe\u7f6e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cloud-payment-service:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 connectTimeout: 5000\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u8bfb\u53d6\u8d85\u65f6\u65f6\u95f4\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 readTimeout: 5000\n</code></pre> 2\u3001\u5931\u8d25\u91cd\u8bd5 \u9ed8\u8ba4\u6ca1\u6709\u91cd\u8bd5\uff0c\u8c03\u7528\u4e00\u6b21\u5c31\u7ed3\u675f\uff0c\u65e0\u8bba\u5931\u8d25\u4e0e\u5426\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u91cd\u8bd5\u7b56\u7565\uff1a Text Only<pre><code>@Configuration\npublic class FeignConfig {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public Retryer myRetryer() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//return Retryer.NEVER_RETRY; //Feign\u9ed8\u8ba4\u914d\u7f6e\u662f\u4e0d\u8d70\u91cd\u8bd5\u7b56\u7565\u7684\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6700\u5927\u8bf7\u6c42\u6b21\u6570\u4e3a3(1+2)\uff0c\u521d\u59cb\u95f4\u9694\u65f6\u95f4\u4e3a100ms\uff0c\u91cd\u8bd5\u95f4\u6700\u5927\u95f4\u9694\u65f6\u95f4\u4e3a1s\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Retryer.Default(100,1,3);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/5-Resilience4j/","title":"5-Resilience4j","text":"<p> \u7ea6 2965 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 59 \u5206\u949f</p> <p>\u4e3a\u4ec0\u4e48\u8bbf\u95ee\u91cf\u5927\u4e86\u4e4b\u540e\u4f1a\u9020\u6210\u670d\u52a1\u5d29\u6e83\uff1f 1\u3001\u5185\u5b58\u8d44\u6e90\u6709\u9650\u3002\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u90fd\u7528\u5b8c\u4e86\u4e5f\u5f97\u5728\u963b\u585e\u961f\u5217\u4e0a\u5efa\u76f8\u5e94\u7684\u5bf9\u8c61\uff0c\u8fd9\u4f1a\u9020\u6210\u81f3\u5c11\u4e24\u4e2a\u95ee\u9898\uff0c\u4e00\u662f\u8bf7\u6c42\u957f\u65f6\u95f4\u65e0\u6cd5\u5f97\u5230\u5904\u7406\uff0c\u6700\u7ec8\u5bfc\u81f4\u670d\u52a1\u4e0d\u53ef\u7528\uff1b\u4e8c\u662f\u7b49\u5f85\u961f\u5217\u4e00\u76f4\u65e0\u9650\u589e\u957f\u5bfc\u81f4\u53ef\u80fd\u4f1a\u9020\u6210OOM\uff0c\u82e5\u6b64\u65f6\u5176\u4ed6\u7ebf\u7a0b\u4e5f\u9700\u8981\u7533\u8bf7\u5806\u5185\u5b58\uff0c\u90a3\u4e48\u5176\u4ed6\u7ebf\u7a0b\u4e5f\u4f1a\u56e0\u4e3a\u7533\u8bf7\u4e0d\u5230\u5185\u5b58\u800cOOM\uff0c\u751a\u81f3\u8fde\u9501\u53cd\u5e94\u5bfc\u81f4\u6574\u4e2aJVM\u7684\u9000\u51fa\u3002 2\u3001\u4e3b\u673a\u7684\u7f51\u7edc\u534f\u8bae\u6808\u6709\u5f88\u591a\u7f13\u51b2\u533a\uff0c\u6bd4\u5982\u5728\u63a5\u53d7\u6570\u636e\u7684\u65f6\u5019\u6709RingBuffer\u3001recv_buffer\uff0c\u5927\u91cf\u7684TCP\u8fde\u63a5\u7684\u9ad8\u5e76\u53d1\u8bbf\u95ee\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u51b2\u533a\u88c5\u4e0d\u4e0b\u800c\u4e22\u5305\u3002 3\u3001\u4e3b\u673a\u7684\u7f51\u5361\u6027\u80fd\u5728\u4f20\u8f93\u901f\u5ea6\u662f\u6709\u4e0a\u9650\u7684\uff0c\u5f53\u7f51\u7edc\u4f20\u8f93\u901f\u5ea6\u8fc7\u5927\uff0c\u8fbe\u5230\u7f51\u5361\u4e0a\u9650\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u4e22\u5305\u3002 4\u3001\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u7f51\u7edc\u94fe\u8def\u4e5f\u4f1a\u4e22\u5305\uff0c\u7f51\u7edc\u67b6\u6784\u4e00\u822c\u662f\u6838\u5fc3\u5c42\u3001\u6c47\u805a\u5c42 \u548c \u63a5\u5165\u5c42\uff0c\u5982\u679c\u5728\u670d\u52a1\u5668\u7aef\u63a5\u5165\u5c42\u7684\u7f51\u7edc\u8bbe\u5907\u6027\u80fd\u4e0d\u884c\u4e5f\u4f1a\u9020\u6210\u4e22\u5305\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u8003\u8651\u5347\u7ea7\u670d\u52a1\u5668\u7684\u5e26\u5bbd\u4e86\u3002 \u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4f1a\u4f9d\u6b21\u7ecf\u8fc74-&gt;3-&gt;2-&gt;1\uff0c\u6bcf\u4e2a\u73af\u8282\u90fd\u53ef\u80fd\u4f1a\u4e22\u5305\uff0c\u4e0d\u8fc7\u6700\u8981\u8fd8\u662f\u5728\u5e94\u7528\u5c42\uff0c\u5176\u5b9e\u5e94\u7528\u5c42\u4e0d\u5149\u53ea\u5185\u5b58\u8d44\u6e90\u7d27\u5f20\u4f1a\u9020\u6210\u670d\u52a1\u5d29\u6e83\uff0c\u6574\u4e2a\u5e94\u7528\u7684\u5404\u4e2a\u73af\u8282\u3001\u7ec4\u4ef6\u90fd\u53ef\u80fd\u4f1a\uff0c\u6bd4\u5982CPU\u8d44\u6e90\uff0c\u6570\u636e\u5e93\u8d44\u6e90\u7b49\u3002</p> <p>\u6b63\u662f\u56e0\u4e3a\u670d\u52a1\u5668\u53ef\u80fd\u625b\u4e0d\u4f4f\u9ad8\u5e76\u53d1\u8bf7\u6c42\uff0c\u6240\u4ee5\u9700\u8981\u5f15\u5165\u9650\u6d41\u63aa\u65bd\uff0c\u8ba9\u670d\u52a1\u5668\u5feb\u901f\u5927\u91cf\u5730\u62d2\u7edd\u8bf7\u6c42\uff0c\u4ece\u800c\u4e0d\u81f3\u4e8e\u8ba9\u670d\u52a1\u5668\u5d29\u6e83\uff08\u8ba9\u4e00\u90e8\u5206\u8bf7\u6c42\u76f4\u63a5\u6b7b\u6389\uff0c\u4ece\u800c\u8ba9\u53e6\u4e00\u90e8\u5206\u6d3b\u4e0b\u6765\uff0c\u4e0d\u81f3\u4e8e\u6240\u6709\u90fd\u6302\u4e86\uff09\u3002\u5176\u5b9e\u4e22\u5305\u4e5f\u662f\u4e00\u79cd\u9650\u6d41\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u5bf9\u7528\u6237\u5341\u5206\u4e0d\u53cb\u597d\uff0c\u56e0\u4e3a\u7528\u6237\u5f97\u4e0d\u5230\u4efb\u4f55\u63d0\u793a\uff0c\u6240\u4ee5\u5f15\u5165\u4e86\u670d\u52a1\u964d\u7ea7\u63aa\u65bd\u3002</p> <p>Resilience4j\u662f\u4e00\u4e2a\u5bb9\u9519\u6846\u67b6\uff0c\u5305\u542b\u7194\u65ad\u3001\u9650\u6d41\u7b49\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u6784\u5efa\u9ad8\u53ef\u7528\u7684\u5e94\u7528\u3002\u5b98\u7f51\uff1a resilience4j</p> <p>CircuitBreaker\u65ad\u8def\u5668 \u4e0d\u5bf9\u670d\u52a1\u8c03\u7528\u8003\u8651\u8fc7\u591a\uff0c\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\u662f\u5982\u679c\u54cd\u5e94\u4e0d\u662f2xx\u5c31\u76f4\u63a5\u629b\u5f02\u5e38\uff08\u6bd4\u5982404\u627e\u4e0d\u5230\u3001500\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef\u3001504\u8d85\u65f6\uff09\uff0c\u7136\u540e\u5728\u4ee3\u7801\u91cc\u4f7f\u7528try...catch...\u6355\u83b7\u5f02\u5e38\uff0c\u5728catch\u91cc\u5b9e\u73b0\u670d\u52a1\u964d\u7ea7\u7684\u903b\u8f91\u3002\u8fd9\u6837\u7684\u5904\u7406\u65b9\u5f0f\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u53ea\u4e0d\u8fc7\u6574\u4e2a\u5fae\u670d\u52a1\u96c6\u7fa4\u53ef\u80fd\u4e0d\u591f\u5065\u58ee\uff0c\u6bd4\u5982\u5982\u679c\u662f504\u8d85\u65f6\uff0c\u90a3\u6709\u53ef\u80fd\u662f\u88ab\u8c03\u7528\u7684\u670d\u52a1\u7e41\u5fd9\uff0c\u8fd9\u65f6\u5982\u679c\u8fd8\u6301\u7eed\u53bb\u8bf7\u6c42\uff0c\u4e00\u6765\u4f1a\u8ba9\u8c03\u7528\u8005\u5927\u91cf\u8bf7\u6c42\u7ebf\u7a0b\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u6d88\u8017\u4e3b\u673a\u8d44\u6e90\uff0c\u4e8c\u662f\u53ef\u80fd\u4f1a\u8ba9\u88ab\u8c03\u7528\u7684\u670d\u52a1\u5d29\u6e83\uff0c\u6240\u4ee5\u5e94\u8be5\u4e3b\u52a8\u53bb\u9650\u5236\u4e0d\u8ba9\u8c03\u7528\u8005\u518d\u53d1\u9001\u8bf7\u6c42\u4e86\uff1b\u518d\u6bd4\u5982404\u3001500\uff0c\u65e0\u8bba\u5728\u8fdb\u884c\u591a\u5c11\u6b21\u8bf7\u6c42\u4e5f\u8fd8\u662f\u4e00\u6837\u7684\u7ed3\u679c\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u9650\u5236\u4e0d\u8ba9\u8c03\u7528\u8005\u53d1\u9001\u8bf7\u6c42\uff0c\u4ece\u800c\u51cf\u5c11\u5bf9\u7f51\u7edc\u8d44\u6e90\u7684\u5360\u7528\u3002CircuitBreaker\u65ad\u8def\u5668\u5c31\u662f\u7528\u6765\u5e72\u8fd9\u4ef6\u4e8b\u7684\uff0c\u4f7f\u7528CircuitBreaker\u5305\u88c5\u7684\u8c03\u7528\u5982\u679c\u5931\u8d25\u7387\u6216\u8005\u8d85\u65f6\u7387\u5927\u4e8e\u63d0\u524d\u8bbe\u5b9a\u7684\u9608\u503c\uff0c\u90a3\u4e48CircuitBreaker\u4f1a\u6253\u5f00\u4ece\u800c\u8ba9\u540e\u7eed\u8c03\u7528\u76f4\u63a5\u88ab\u62d2\u7edd\u3002</p> <p>CircuitBreaker\u662fSpringCloud\u63d0\u4f9b\u7684\u6807\u51c6\u63a5\u53e3\uff0c\u5b83\u6709\u4e24\u4e2a\u4e3b\u8981\u5b9e\u73b0\uff1aResilience4J \u548c Spring Retry \u3002</p> <p>CircuitBreaker\u63d0\u4f9b\u4e86\u4e09\u79cd\u4e3b\u8981\u7684\u72b6\u6001\uff1aclosed\u3001open\u3001half_open\uff0c\u548c\u4e24\u79cd\u7279\u6b8a\u7684\u72b6\u6001\uff1aDISABLED \u548c FORCED_OPEN\u3002closed\u662f\u5141\u8bb8\u8bbf\u95ee\u72b6\u6001\uff0copen\u662f\u7981\u6b62\u8bbf\u95ee\u72b6\u6001\uff0chalf_open\u662f\u90e8\u5206\u53ef\u8bbf\u95ee\u72b6\u6001\u3002DISABLED\u662f\u59cb\u7ec8\u5141\u8bb8\u8bbf\u95ee\uff0cFORCED_OPEN\u662f\u59cb\u7ec8\u7981\u6b62\u8bbf\u95ee\u3002  CircuitBreaker\u5904\u4e8eCOLSED\uff08\u95ed\u5408\uff09\u72b6\u6001\u5141\u8bb8\u6b63\u5e38\u8bbf\u95ee\uff0c\u5f53\u5931\u8d25\u7387\u6216\u8005\u6162\u8c03\u7528\u7387\u8d85\u8fc7\u8bbe\u5b9a\u7684\u9608\u503c\u65f6\uff0cCircuitBreaker\u4f1a\u8f6c\u6362\u6210OPEN\uff08\u6253\u5f00\uff09\u72b6\u6001\uff0c\u8fd9\u65f6\u4e0d\u5141\u8bb8\u8fdb\u884c\u8bbf\u95ee\uff0c\u7b49\u5f85\u4e00\u5b9a\u7684\u65f6\u95f4\u4e4b\u540eCircuitBreaker\u8f6c\u53d8\u6210HALF_OPEN\uff08\u534a\u5f00\uff09\u72b6\u6001\uff0c\u8fd9\u65f6\u5141\u8bb8\u6307\u5b9a\u6570\u91cf\u7684\u8bf7\u6c42\u6b63\u5e38\u8bbf\u95ee\uff0c\u5982\u679c\u8fd9\u4e9b\u8bf7\u6c42\u7684\u5931\u8d25\u7387\u4ecd\u7136\u8d85\u8fc7\u9608\u503c\uff0c\u90a3\u4e48\u518d\u6b21\u8fdb\u5165OPEN\u72b6\u6001\uff0c\u5426\u5219\u8fdb\u5165CLOSED\u72b6\u6001\u3002</p> <p>\u4e3b\u8981\u7684\u914d\u7f6e\uff1a</p> \u914d\u7f6e\u9879 \u9ed8\u8ba4\u503c \u63cf\u8ff0 slidingWindowType COUNT_BASED \u6ed1\u52a8\u7a97\u53e3\u7c7b\u578b\uff0c COUNT_BASED\u57fa\u4e8e\u6b21\u6570\uff0c TIME_BASED\u57fa\u4e8e\u65f6\u95f4 slidingWindowSize 100 \u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f\uff0c\u5982\u679c\u662fCOUNT_BASED\u7c7b\u578b\u5219\u5355\u4f4d\u662f\u6b21\uff0c\u5982\u679c\u662fTIME_BASED\u7c7b\u578b\u5219\u5355\u4f4d\u662f\u79d2 minimumNumberOfCalls 100 \u8ba1\u7b97\u6ed1\u52a8\u7a97\u53e3\u5931\u8d25\u7387\u548c\u6162\u8c03\u7528\u7387\u65f6\u9700\u8981\u7684\u6700\u5c0f\u8c03\u7528\u6b21\u6570 failureRateThreshold 50 \u5931\u8d25\u8c03\u7528\u7387 slowCallRateThreshold 100 \u6162\u8c03\u7528\u7387\uff0c\u8c03\u7528\u65f6\u95f4\u8d85\u8fc7 slowCallDurationThreshold\u5219\u8ba4\u4e3a\u6162 slowCallDurationThreshold 60000 [ms] \u6162\u8c03\u7528\u9608\u503c automaticTransitionFromOpenToHalfOpenEnabled false \u662f\u5426\u81ea\u52a8\u4eceopen\u8f6c\u53d8\u5230half-open\uff0c\u5982\u679c\u662ftrue\u4f1a\u6709\u4e2a\u7ebf\u7a0b\u76d1\u63a7\uff0c\u5f53waitDurationInOpenState\u65f6\u95f4\u5230\u4e86\u5c31\u81ea\u52a8\u8f6c\u53d8\uff0c\u5982\u679c\u662ffalse\u5219\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u8c03\u7528\u624d\u53ef\u4ee5\uff08\u8c03\u7528\u7684\u65f6\u5019\u518d\u5224\u65ad\u662f\u5426\u5230waitDurationInOpenState\uff0c\u5982\u679c\u5230\u4e86\u5c31\u8f6c\u53d8\u6210half-open\uff09\u3002 waitDurationInOpenState 60000 [ms] \u4eceopen\u8f6c\u53d8\u5230half-open\u9700\u8981\u7b49\u5f85\u7684\u65f6\u95f4 maxWaitDurationInHalfOpenState 0 [ms] \u5728half-open\u7684\u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\u4f1a\u8f6c\u53d8\u6210open\u72b6\u6001 permittedNumberOfCallsInHalfOpenState 10 \u5728half-open\u65f6\u5141\u8bb8\u8c03\u7528\u7684\u6b21\u6570\uff0c\u82e5\u5931\u8d25\u7387\u548c\u6162\u8c03\u7528\u7387\u4ecd\u7136\u8d85\u8fc7\u9608\u503c\u5219\u518d\u6b21\u8fdb\u5165open\u72b6\u6001\uff0c\u5426\u5219\u8fdb\u5165close\u72b6\u6001\uff08\u76f8\u5f53\u4e8e\u5728half-open\u72b6\u6001\u662f\u4e00\u4e2a\u57fa\u4e8e\u6b21\u6570\u7684\u7a97\u53e3\uff09 <p>1\u3001\u5bfc\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;resilience4j-all&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;${resilience4jVersion}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> 2\u3001\u793a\u4f8b Text Only<pre><code>public static void main(String[] args) throws Throwable {\n\u00a0\u00a0\u00a0\u00a0// Create a custom configuration for a CircuitBreaker\n\u00a0\u00a0\u00a0\u00a0CircuitBreakerConfig circuitBreakerConfig = CircuitBreakerConfig.custom()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.slidingWindowType(CircuitBreakerConfig.SlidingWindowType.COUNT_BASED) //\u6ed1\u52a8\u7a97\u53e3\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.slidingWindowSize(5) //\u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.minimumNumberOfCalls(3) //\u8ba1\u7b97\u6ed1\u52a8\u7a97\u53e3\u5931\u8d25\u7387\u548c\u6162\u8c03\u7528\u7387\u65f6\u9700\u8981\u7684\u6700\u5c0f\u8c03\u7528\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.failureRateThreshold(50) //\u5931\u8d25\u8c03\u7528\u7387\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.slowCallRateThreshold(50) //\u6162\u8c03\u7528\u7387\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.waitDurationInOpenState(Duration.ofMillis(30000)) //\u4eceopen\u8f6c\u53d8\u5230half-open\u9700\u8981\u7b49\u5f85\u7684\u65f6\u95f4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.permittedNumberOfCallsInHalfOpenState(3) //\u5728half-open\u65f6\u5141\u8bb8\u8c03\u7528\u7684\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.build();\n\n\u00a0\u00a0\u00a0\u00a0// Create a CircuitBreakerRegistry with a custom global configuration\n\u00a0\u00a0\u00a0\u00a0CircuitBreakerRegistry circuitBreakerRegistry =\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CircuitBreakerRegistry.of(circuitBreakerConfig);\n\n\u00a0\u00a0\u00a0\u00a0// Get or create a CircuitBreaker from the CircuitBreakerRegistry\n\u00a0\u00a0\u00a0\u00a0// with a custom configuration\n\u00a0\u00a0\u00a0\u00a0CircuitBreaker circuitBreakerWithCustomConfig = circuitBreakerRegistry\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.circuitBreaker(\"name2\", circuitBreakerConfig);\n\n\u00a0\u00a0\u00a0\u00a0// When I decorate my function\n\u00a0\u00a0\u00a0\u00a0CheckedConsumer&lt;Integer&gt; checkedConsumer = CircuitBreaker.decorateCheckedConsumer(circuitBreakerWithCustomConfig,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0t -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (t == 0) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"fail\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"success\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0Scanner sc = new Scanner(System.in);\n\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int i = sc.nextInt();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0checkedConsumer.accept(i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Throwable e) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0//\u670d\u52a1\u964d\u7ea7\uff0c\u7ed9\u7528\u6237\u53cb\u597d\u63d0\u793a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\uff1a\" + e + \"\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 // \u8fd8\u53ef\u4ee5\u4f7f\u7528Vavr\u5e93\u63d0\u4f9b\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\n\u00a0 \u00a0 \u00a0 \u00a0 // Try.success(sc.nextInt()).andThen(checkedConsumer.unchecked()).failed().andThen(cause -&gt; System.out.println(\"\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\" + cause.getMessage() + \"\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\"));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8fde\u7eed\u8f93\u51650 0 1\u4e4b\u540e\u518d\u8f93\u51651\u5c31\u88ab\u7981\u6b62\u8bbf\u95ee\u4e86\uff0c\u8bf4\u660e\u5982\u679c\u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f &gt;=\u00a0minimumNumberOfCalls\uff0c\u53ea\u8981\u7a97\u53e3\u4e2d\u4fdd\u5b58\u7684\u8c03\u7528\u6b21\u6570\u8fbe\u5230minimumNumberOfCalls\u5c31\u5f00\u59cb\u89e6\u53d1\u8ba1\u7b97\u5931\u8d25\u7387\u3002\u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f &lt;\u00a0minimumNumberOfCalls\u65f6\u5219\u4ee5\u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f\u4e3a\u51c6\u3002 \u5f53\u8fbe\u5230min(\u7a97\u53e3\u5927\u5c0f\uff0cminimumNumberOfCalls)\u540e\u4f1a\u89e6\u53d1\u4e00\u6b21\u8ba1\u7b97\u5931\u8d25\u7387\uff0c\u5982\u679c\u4ecd\u7136\u5904\u4e8eCLOSED\u72b6\u6001\uff0c\u90a3\u4e48\u4ee5\u540e\u6bcf\u6b21\u8fdb\u6765\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5982\u679c\u7a97\u53e3\u5df2\u6ee1\u5c31\u4f1a\u6324\u6389\u6700\u65e7\u7684\u8bf7\u6c42\uff0c\u50cf\u961f\u5217\u90a3\u6837\uff0c\u5e76\u8ba1\u7b97\u5931\u8d25\u7387\u3002 Text Only<pre><code>0\n\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\uff1ajava.lang.RuntimeException: fail\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\n0\n\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\uff1ajava.lang.RuntimeException: fail\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\n1\nsuccess\n1\n\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\uff1aio.github.resilience4j.circuitbreaker.CallNotPermittedException: CircuitBreaker 'name2' is OPEN and does not permit further calls\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\n</code></pre> \u5f53\u4eceCLOSED\u72b6\u6001\u8f6c\u53d8\u6210OPE\uff2e\u72b6\u6001\u65f6\uff0c\u7a97\u53e3\u4e2d\u7684\u8bf7\u6c42\u4f1a\u88ab\u6e05\u7a7a\u3002 \u7b49\u5f8530s\u540e\u5904\u4e8ehalf-open\uff0c\u53ea\u5141\u8bb8\u8c03\u75283\u6b21\uff0c\u518d\u8f93\u51651 0 1\uff0c\u5931\u8d25\u7387\u5c0f\u4e8e\u9608\u503c\uff0c\u6240\u4ee5\u7b2c\u4e09\u6b21\u8fc7\u540e\u5c31\u53d8\u6210\u4e86CLOSED\u72b6\u6001\uff0c\u8fd9\u4e09\u4e2a\u8bf7\u6c42\u5e76\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u5728\u7a97\u53e3\u4e2d\u3002 Text Only<pre><code>1\nsuccess\n0\n\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u539f\u56e0\u662f\uff1ajava.lang.RuntimeException: fail\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01\n1\nsuccess\n</code></pre></p> <p>RateLimiter\u9650\u6d41\u5668</p> <p>\u5e38\u89c1\u9650\u6d41\u7b97\u6cd5\uff1a</p> <ol> <li>\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3</li> <li>\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3</li> <li>\u6f0f\u6876\u7b97\u6cd5</li> <li>\u4ee4\u724c\u6876\u7b97\u6cd5</li> </ol> <p>\u4e00\u3001\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3 \u548c\u00a0\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3 \u6eda\u52a8\u65f6\u95f4\u7a97\u53e3 \u548c\u00a0\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u00a0\u6709\u65f6\u4e5f\u88ab\u79f0\u4e3a\u00a0\u8ba1\u6570\u5668\u6cd5\u3002\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7ed9\u6bcf\u4e00\u4e2a\u65f6\u95f4\u7a97\u53e3\u8bbe\u7f6e\u4e00\u4e2a\u6700\u5927\u8bf7\u6c42\u91cf\uff0c\u5728\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u67d0\u4e2a\u65f6\u523b\u8fbe\u5230\u6700\u5927\u8bf7\u6c42\u91cf\u4e4b\u540e\uff0c\u7a97\u53e3\u5269\u4e0b\u7684\u65f6\u95f4\u4f1a\u76f4\u63a5\u62d2\u7edd\u6216\u963b\u585e\u5230\u6765\u7684\u8bf7\u6c42\uff0c\u6bcf\u4e2a\u7a97\u53e3\u4e4b\u95f4\u6ca1\u6709\u91cd\u53e0\u3002\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7b80\u5355\u7c97\u66b4\uff0c\u4f46\u5728\u4e24\u4e2a\u7a97\u53e3\u7684\u4e34\u754c\u70b9\u5904\u53ef\u80fd\u4f1a\u51fa\u73b0\u6d41\u91cf\u5c16\u5cf0\u7684\u95ee\u9898\uff0c\u6bd4\u59820.9\u79d2\u65f6\u6709100\u4e2a\u8bf7\u6c42\uff0c1.1\u79d2\u65f6\u4e5f\u6709100\u4e2a\u8bf7\u6c42\uff0c\u867d\u7136\u7b2c\u4e00\u79d2\u548c\u7b2c\u4e8c\u79d2\u786e\u5b9e\u90fd\u5728\u5404\u81ea\u7684\u65f6\u95f4\u8303\u56f4\u5185\u9650\u5236\u4e86100\u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u4ece0.5\u79d21.5\u79d2\u8fd9\u4e00\u79d2\u4e4b\u95f4\u5374\u6709200\u4e2a\u8bf7\u6c42\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\uff0c\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u66f4\u52a0\u7cbe\u7ec6\u5730\u5212\u5206\u65f6\u95f4\u7a97\u53e3\uff0c\u6bd4\u5982\u518d\u5c061\u79d2\u5212\u5206\u621010\u4e2a\u683c\u5b50\uff0c\u7136\u540e\u968f\u65f6\u95f4\u7684\u6d41\u901d\uff0c\u7a97\u53e3\u8ddf\u7740\u65f6\u95f4\u6ed1\u52a8\uff0c\u6bcf\u6b21\u90fd\u662f\u8ba1\u7b97\u6700\u8fd110\u4e2a\u683c\u5b50\u7684\u8bf7\u6c42\u91cf\uff0c\u5982\u679c\u524d9\u4e2a\u683c\u5b50\u7684\u8bf7\u6c42\u91cf\u5df2\u7ecf\u8fbe\u5230100\u4e2a\u8bf7\u6c42\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a100\u6beb\u79d2\u4f1a\u76f4\u63a5\u62d2\u7edd\u6216\u963b\u585e\u5230\u6765\u7684\u8bf7\u6c42\uff0c\u6ed1\u52a8\u7a97\u53e3\u7684\u7f3a\u70b9\u662f\uff0c\u5b58\u50a8\u548c\u8ba1\u7b97\u7684\u5f00\u9500\u66f4\u5927\u3002</p> <p>\u4e8c\u3001\u6f0f\u6876\u7b97\u6cd5 \u6f0f\u6876\u7684\u51fa\u6c34\u53e3\u5927\u5c0f\u4e00\u5b9a\uff0c\u4ece\u800c\u4fdd\u8bc1\u8bf7\u6c42\u5904\u7406\u901f\u5ea6\u6c38\u8fdc\u4e0d\u4f1a\u8d85\u8fc7\u8bbe\u5b9a\u7684\u503c\uff0c\u6700\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u4f7f\u7528\u4fe1\u53f7\u91cfSemaphore\u6765\u9650\u5236\u5e76\u53d1\u91cf\uff08\u6211\u81ea\u5df1\u8ba4\u4e3a\u7684\uff09\u3002</p> <p>\u4e09\u3001\u4ee4\u724c\u6876\u7b97\u6cd5 \u6709\u4e00\u4e2a\u56fa\u5b9a\u5bb9\u91cf\u7684\u6876\uff0c\u7136\u540e\u4ee5\u7a33\u5b9a\u7684\u901f\u7387\u751f\u6210\u4ee4\u724c\u653e\u5728\u6876\u4e2d\uff0c\u56e0\u4e3a\u6876\u7684\u5bb9\u91cf\u56fa\u5b9a\uff0c\u4ee4\u724c\u6ee1\u4e86\u5c31\u4e0d\u751f\u4ea7\u4e86\u3002\u5f53\u6709\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u83b7\u53d6\u4ee4\u724c\u624d\u80fd\u901a\u8fc7\uff0c\u6876\u4e2d\u6709\u5145\u8db3\u7684\u4ee4\u724c\u65f6\uff0c\u7a81\u53d1\u7684\u6d41\u91cf\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u4ee4\u724c\u901a\u8fc7\uff0c\u5f53\u4ee4\u724c\u53d6\u5149\u540e\uff0c\u540e\u9762\u7684\u8bf7\u6c42\u5c31\u5f97\u7b49\u751f\u6210\u4ee4\u724c\u540e\u624d\u80fd\u901a\u8fc7\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8bf7\u6c42\u901a\u8fc7\u7684\u901f\u7387\u5c31\u53d8\u5f97\u7a33\u5b9a\u4e86\u3002\u4ee4\u724c\u6876\u7684\u4f18\u70b9\u662f\u53ef\u7528\u5904\u7406\u7a81\u53d1\u6d41\u91cf\uff0c\u6240\u4ee5\u88ab\u5e7f\u6cdb\u7684\u5e94\u7528\u4e8e\u5404\u79cd\u9650\u6d41\u5de5\u5177\u4e2d\uff0c\u6bd4\u5982Guava\u7684RateLimiter\u3002</p> <p>\u53c2\u8003\uff1a \u9010\u884c\u62c6\u89e3Guava\u9650\u6d41\u5668RateLimiter - \u77e5\u4e4e</p> <p>\u4ee4\u724c\u6876\u7b97\u6cd5\u00a0\u4e0e\u00a0\u6f0f\u6876\u7b97\u6cd5\u00a0\u7684\u533a\u522b\uff1a\u6f0f\u6876\u7b97\u6cd5\u7684\u4fe1\u53f7\u91cfSemaphore\u53d6\u5b8c\u4e4b\u540e\u9700\u8981\u8fd8\u56de\u6765\u540e\u9762\u7684\u8bf7\u6c42\u624d\u80fd\u518d\u53d6\uff0c\u4f46\u662f\u4ee4\u724c\u6876\u7b97\u6cd5\u5e76\u4e0d\u9700\u8981\u628a\u4ee4\u724c\u8fd8\u56de\u6765\uff0c\u800c\u662f\u76f4\u63a5\u751f\u6210\u65b0\u7684\u4ee4\u724c\u653e\u5230\u6876\u4e2d\u3002 \u4ee4\u724c\u6876\u7b97\u6cd5\u00a0\u4e0e\u00a0\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3 \u7684\u533a\u522b\uff1a\u4ee4\u724c\u6876\u7b97\u6cd5\u5728\u65f6\u95f4\u7247\u5230\u8fbe\u7684\u751f\u6210\u4e00\u4e2a\u4ee4\u724c\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u628a\u6876\u586b\u6ee1\uff0c\u4f46\u662f\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u5c31\u662f\u6bcf\u6b21\u90fd\u76f4\u63a5\u628a\u6876\u586b\u6ee1\u3002</p> <p>Resilience4j\u7684RateLimiter\u6709\u4e24\u79cd\u5b9e\u73b0\uff1aAtomicRateLimiter\u00a0\u548c\u00a0SemaphoreBasedRateLimiter\u3002AtomicRateLimiter\u5c31\u662f\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\uff0c\u5bf9\u4e8eSemaphoreBasedRateLimiter\uff0c\u5b98\u7f51\u53ea\u7528\u4e86\u4e00\u53e5\u8bdd\u8fdb\u884c\u7b80\u5355\u4ecb\u7ecd\uff0c\u611f\u89c9\u5e94\u8be5\u662f\u548cAtomicRateLimiter\u90fd\u662f\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\uff0c\u53ea\u4e0d\u8fc7AtomicRateLimiter\u00a0\u4f7f\u7528AtomicReference\u5b9e\u73b0\uff0c\u800cSemaphoreBasedRateLimiter\u4f7f\u7528Semaphore\u5b9e\u73b0\uff0c\u533a\u522b\u662f\u4f7f\u7528AtomicReference\u5b9e\u73b0\u5bf9\u4e8e\u5355\u7ebf\u7a0b\u7684\u8fde\u7eed\u591a\u6b21\u8c03\u7528\u4e5f\u53ef\u8fdb\u884c\u6d41\u63a7\uff0c\u800c\u4f7f\u7528Semaphore\u5b9e\u73b0\u53ea\u5bf9\u591a\u7ebf\u7a0b\u8c03\u7528\u8fdb\u884c\u6d41\u63a7\uff08\u6211\u81ea\u5df1\u7684\u731c\u6d4b\uff09\u3002</p> <p>Resilience4j\u5bf9\u4e8eRateLimiter\u7684\u5185\u90e8\u5b9e\u73b0\u7684\u63cf\u8ff0\u5982\u4e0b\u56fe\uff0cRateLimiter\u7684\u4e24\u4e2a\u91cd\u8981\u7684\u53c2\u6570\uff1a limitRefreshPeriod\u8868\u793a\u5237\u65b0\u65f6\u95f4\u95f4\u9694\uff0c limitForPeriod\u8868\u793a\u6bcf\u4e2a\u65f6\u95f4\u7247\u5141\u8bb8\u901a\u8fc7\u7684\u6700\u5927\u8bf7\u6c42\u6570\uff0c\u4e0b\u56fe\u4e2d\u8bbe\u7f6e\u7684\u662f1\u3002\u7ebf\u7a0b2\u83b7\u53d6\u7684\u65f6\u5019\u5141\u8bb8\u901a\u8fc7\u7684\u6700\u5927\u8bf7\u6c42\u6570\u4e3a0\uff0c\u6240\u4ee5\u5b83\u88ab\u6302\u8d77\u4e86\uff0c\u76f4\u5230\u4e0b\u4e00\u4e2a\u65f6\u95f4\u7247\u5237\u65b0\u6700\u5927\u8bf7\u6c42\u6570\uff0c\u56fe\u4e2d\u7684-1\u65e0\u5173\u7d27\u8981\uff0c\u53ea\u662f\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u800c\u5df2\uff0c\u8868\u793a\u7ebf\u7a0b2\u6210\u529f\u4fdd\u7559\uff08reserve\uff09\u4e86\u4e00\u4e2a\u5141\u8bb8\uff08\u4ee4\u724c\uff09\uff0c\u4e0b\u4e00\u4e2a\u65f6\u95f4\u7247\u5237\u65b0\u7684\u65f6\u5019\u8981\u51cf\u53bb\u8fd9\u4e2a-1\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u7ebf\u7a0b\u7684\u6700\u5927\u7b49\u5f85\u65f6\u95f4\uff0c\u5e76\u4e14\u7ebf\u7a0b\u83b7\u53d6\u5230\u8fd9\u4e2a\u5141\u8bb8\uff08\u4ee4\u724c\uff09\u8981\u7ecf\u5386\u597d\u51e0\u4e2a\u65f6\u95f4\u7247\uff0c\u90a3\u4e48\u5b83\u5c31\u65e0\u6cd5\u4fdd\u7559\uff08reserve\uff09\u6210\u529f\uff0c\u4f1a\u76f4\u63a5\u8fd4\u56de\u5931\u8d25\uff0c\u7136\u540e\u670d\u52a1\u964d\u7ea7\u3002 \u628a\u4e0b\u9762\u8fd9\u5f20\u56fe\u7684\u903b\u8f91\u5957\u5728\u4ee4\u724c\u6876\u7b97\u6cd5\u4e0a\u4e5f\u6210\u7acb\uff0c\u56e0\u4e3a\u8fd9\u65f6\u5019\u6876\u7684\u5927\u5c0f\u662f1\uff0c\u4ee4\u724c\u6876\u7b97\u6cd5\u5728\u65f6\u95f4\u7247\u5230\u8fbe\u7684\u751f\u6210\u4e00\u4e2a\u4ee4\u724c\uff0c\u5c31\u662f\u76f4\u63a5\u628a\u6876\u586b\u6ee1\u4e86\u3002\u4f46\u662f\u5b98\u7f51\u5bf9\u4e8elimitRefreshPeriod\u00a0\u548c limitForPeriod\u7684\u8bf4\u6cd5\u662f The period of a limit refresh. After each period the rate limiter sets its permissions count back to the limitForPeriod value\uff0c\u4e5f\u662f\u5f53\u5468\u671f\u5230\u6765\u4f1a\u76f4\u63a5\u8bbe\u7f6e\u4e3alimitForPeriod\uff0c\u8fd9\u662f\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7684\u903b\u8f91\u3002  RateLimiter\u7684\u914d\u7f6e\u53c2\u6570\uff1a</p> \u914d\u7f6e\u9879 \u9ed8\u8ba4\u503c \u63cf\u8ff0 timeoutDuration 5 [s] \u7ebf\u7a0b\u6700\u5927\u7b49\u5f85\u65f6\u95f4 limitRefreshPeriod 500 [ns] \u65f6\u95f4\u7247\u957f\u5ea6\uff0c\u6bcf\u9694limitRefreshPeriod\u5237\u65b0\u4e00\u6b21\uff0c\u5c06\u5141\u8bb8\u5904\u7406\u7684\u6700\u5927\u8bf7\u6c42\u6570\u91cf\u91cd\u7f6e\u4e3alimitForPeriod\u3002 limitForPeriod 50 \u5728\u4e00\u4e2a\u65f6\u95f4\u7247\u5185\u5141\u8bb8\u6267\u884c\u7684\u6700\u5927\u8bf7\u6c42\u6570 <p>\u793a\u4f8b\uff1a Text Only<pre><code>public class main01 {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0RateLimiterConfig config = RateLimiterConfig.custom()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.limitRefreshPeriod(Duration.ofSeconds(1)) // 1\u79d2\u5237\u65b01\u6b21\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.limitForPeriod(5) //\u5237\u65b0\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u628a\u5141\u8bb8\u8c03\u7528\u7684\u6b21\u6570\u8bbe\u7f6e\u4e3a5\u6b21\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.timeoutDuration(Duration.ofMillis(25)) //\u5982\u679c\u8bf7\u6c42\u8c03\u7528\u6ca1\u6709\u83b7\u53d6\u5230\uff0c\u6700\u591a\u7b49\u5f8525\u6beb\u79d2\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.build();\n\u00a0 \u00a0 \u00a0 \u00a0 // Create registry\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0RateLimiterRegistry rateLimiterRegistry = RateLimiterRegistry.of(config);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Use registry\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0RateLimiter rateLimiterWithDefaultConfig = rateLimiterRegistry\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.rateLimiter(\"name1\");\n\u00a0 \u00a0 \u00a0 \u00a0 // Decorate your call to BackendService.doSomething()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CheckedRunnable restrictedCall = RateLimiter\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.decorateCheckedRunnable(rateLimiterWithDefaultConfig, () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"decorate CheckedRunnable\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 7; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Try.run(restrictedCall::run)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.onFailure((throwable) -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"1\u79d2\u4e4b\u540e\u624d\u5237\u65b0\uff0c\u4f46\u662f\u8bbe\u7f6e\u7684\u662f \u8bf7\u6c42\u8c03\u7528 \u6700\u591a\u7b4925\u6beb\u79d2\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8fd4\u56de\u8d85\u65f6\uff08\u662f\u5426\u8d85\u65f6\u53ef\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u7acb\u523b\u8ba1\u7b97\u5f97\u5230\uff0c\u5e76\u4e0d\u8981\u4e00\u76f4\u7b49\u5230\u8d85\u65f6\uff09\uff0cex: \" + throwable.getMessage());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 7; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Try.run(restrictedCall::run)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.onFailure((throwable) -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"1\u79d2\u4e4b\u540e\u624d\u5237\u65b0\uff0c\u4f46\u662f\u8bbe\u7f6e\u7684\u662f \u8bf7\u6c42\u8c03\u7528 \u6700\u591a\u7b4925\u6beb\u79d2\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8fd4\u56de\u8d85\u65f6\uff08\u662f\u5426\u8d85\u65f6\u53ef\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u7acb\u523b\u8ba1\u7b97\u5f97\u5230\uff0c\u5e76\u4e0d\u8981\u4e00\u76f4\u7b49\u5230\u8d85\u65f6\uff09\uff0cex: \" + throwable.getMessage());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6267\u884c\u7ed3\u679c\uff1a Text Only<pre><code>decorate CheckedRunnable\ndecorate CheckedRunnable\ndecorate CheckedRunnable\ndecorate CheckedRunnable\ndecorate CheckedRunnable\n1\u79d2\u4e4b\u540e\u624d\u5237\u65b0\uff0c\u4f46\u662f\u8bbe\u7f6e\u7684\u662f \u8bf7\u6c42\u8c03\u7528 \u6700\u591a\u7b4925\u6beb\u79d2\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8fd4\u56de\u8d85\u65f6\uff08\u662f\u5426\u8d85\u65f6\u53ef\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u7acb\u523b\u8ba1\u7b97\u5f97\u5230\uff0c\u5e76\u4e0d\u8981\u4e00\u76f4\u7b49\u5230\u8d85\u65f6\uff09\uff0cex: RateLimiter 'name1' does not permit further calls\n1\u79d2\u4e4b\u540e\u624d\u5237\u65b0\uff0c\u4f46\u662f\u8bbe\u7f6e\u7684\u662f \u8bf7\u6c42\u8c03\u7528 \u6700\u591a\u7b4925\u6beb\u79d2\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8fd4\u56de\u8d85\u65f6\uff08\u662f\u5426\u8d85\u65f6\u53ef\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u7acb\u523b\u8ba1\u7b97\u5f97\u5230\uff0c\u5e76\u4e0d\u8981\u4e00\u76f4\u7b49\u5230\u8d85\u65f6\uff09\uff0cex: RateLimiter 'name1' does not permit further calls\ndecorate CheckedRunnable\ndecorate CheckedRunnable\ndecorate CheckedRunnable\ndecorate CheckedRunnable\ndecorate CheckedRunnable\n1\u79d2\u4e4b\u540e\u624d\u5237\u65b0\uff0c\u4f46\u662f\u8bbe\u7f6e\u7684\u662f \u8bf7\u6c42\u8c03\u7528 \u6700\u591a\u7b4925\u6beb\u79d2\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8fd4\u56de\u8d85\u65f6\uff08\u662f\u5426\u8d85\u65f6\u53ef\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u7acb\u523b\u8ba1\u7b97\u5f97\u5230\uff0c\u5e76\u4e0d\u8981\u4e00\u76f4\u7b49\u5230\u8d85\u65f6\uff09\uff0cex: RateLimiter 'name1' does not permit further calls\n1\u79d2\u4e4b\u540e\u624d\u5237\u65b0\uff0c\u4f46\u662f\u8bbe\u7f6e\u7684\u662f \u8bf7\u6c42\u8c03\u7528 \u6700\u591a\u7b4925\u6beb\u79d2\uff0c\u6240\u4ee5\u8fd9\u91cc\u76f4\u63a5\u8fd4\u56de\u8d85\u65f6\uff08\u662f\u5426\u8d85\u65f6\u53ef\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u7acb\u523b\u8ba1\u7b97\u5f97\u5230\uff0c\u5e76\u4e0d\u8981\u4e00\u76f4\u7b49\u5230\u8d85\u65f6\uff09\uff0cex: RateLimiter 'name1' does not permit further calls\n</code></pre></p> <p>Bulkhead\u8231\u58c1 Bulkhead\u8bf4\u662f\u7528\u6765\u9694\u79bb\u8d44\u6e90\uff0c\u907f\u514d\u67d0\u7c7b\u8c03\u7528\u5f02\u5e38\u65f6\u800c\u5360\u7528\u6240\u6709\u8d44\u6e90\uff0c\u5bfc\u81f4\u5f71\u54cd\u6574\u4e2a\u7cfb\u7edf\uff0c\u4f46\u662f\u611f\u89c9\u5b9e\u73b0\u4e0a\u5e76\u4e0d\u662f\u8fd9\u6837\uff0c\u66f4\u50cf\u662f\u518d\u9650\u6d41\uff0c\u548cRateLimiter\u4e00\u6837\u7684\u6d41\u63a7\u5de5\u5177\uff0c\u4e0d\u8fc7\u4e0d\u91cd\u8981\uff0c\u611f\u89c9Bulkhead\u5e94\u8be5\u4e0d\u5e38\u7528\u3002Bulkhead\u6709\u4e24\u79cd\u5b9e\u73b0\uff1aSemaphoreBulkhead\u00a0\u548c\u00a0FixedThreadPoolBulkhead\u3002</p> <p>SemaphoreBulkhead\u00a0\u5c31\u50cf\u524d\u9762\u8bf4\u7684\u6f0f\u6876\u7b97\u6cd5\u4e00\u6837\uff0c\u901a\u8fc7\u4fe1\u53f7\u91cfSemaphore\u6765\u9650\u5236\u5e76\u53d1\u91cf\uff0c\u53ea\u5bf9\u591a\u7ebf\u7a0b\u6709\u6548\uff0c\u4e0d\u4f1a\u9650\u5236\u5355\u7ebf\u7a0b\u7684\u591a\u6b21\u8c03\u7528\u3002SemaphoreBulkhead\u00a0\u7684\u914d\u7f6e\u5982\u4e0b\uff1a</p> \u914d\u7f6e\u9879 \u9ed8\u8ba4\u503c \u63cf\u8ff0 maxConcurrentCalls 25 \u6700\u5927\u5e76\u53d1\u6570 maxWaitDuration 0 \u7ebf\u7a0b\u7684\u6700\u5927\u7b49\u5f85\u65f6\u95f4 <p>\u793a\u4f8b\uff1a Text Only<pre><code>public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0// Create a custom configuration for a Bulkhead\n\u00a0\u00a0\u00a0\u00a0BulkheadConfig config = BulkheadConfig.custom()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.maxConcurrentCalls(5)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.maxWaitDuration(Duration.ofMillis(1))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.build();\n\u00a0\u00a0\u00a0\u00a0// Create a BulkheadRegistry with a custom global configuration\n\u00a0\u00a0\u00a0\u00a0BulkheadRegistry bulkheadRegistry = BulkheadRegistry.of(config);\n\u00a0\u00a0\u00a0\u00a0Bulkhead bulkhead = bulkheadRegistry.bulkhead(\"name\");\n\u00a0\u00a0\u00a0\u00a0Supplier&lt;String&gt; supplier = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread.sleep(2000);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"Hello from Supplier\";\n\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0Supplier&lt;String&gt; decoratedSupplier = Bulkhead.decorateSupplier(bulkhead, supplier);\n\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(() -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String result = Try.ofSupplier(decoratedSupplier)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.recover(throwable -&gt; \"Hello from Recovery\").get();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>FixedThreadPoolBulkhead\u6ca1\u592a\u641e\u61c2\u3002</p> <p>Resilience4j\u00a0\u4e0e SpringBoot\u00a0\u7ed3\u5408\u4f7f\u7528 \u4ece\u524d\u9762\u7684\u4f8b\u5b50\u53ef\u4ee5\u770b\u5230\uff0cResilience4j\u7684\u5bb9\u9519\u5de5\u5177\u90fd\u662f\u5957\u5728\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\u4e0a\uff0c\u6240\u4ee5Resilience4j\u7684\u7528\u6cd5\u5c31\u662f\u5957\u5728\u4efb\u4f55\u4e00\u4e2a\u5bb9\u9519\u7684\u65b9\u6cd5\u4e0a\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6\u63a5\u53e3\uff0c\u4f5c\u4e3a\u8c03\u7528\u8005\uff0c\u540c\u65f6\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u53ef\u4ee5\u88ab\u5176\u4ed6\u65b9\u6cd5\u8c03\u7528\uff0c\u4f5c\u4e3a\u88ab\u8c03\u7528\u8005\u3002\u5728\u8c03\u7528\u8005\u548c\u88ab\u8c03\u7528\u8005\u4e0a\u5957\u4e0aResilience4j\u7684\u5bb9\u9519\u5de5\u5177\u65f6\u7684\u601d\u8003\u65b9\u5f0f\u6709\u70b9\u4e0d\u540c\uff0c\u6bd4\u5982\u7194\u65ad\u5668\u52a0\u5728\u8c03\u7528\u8005\u4e00\u7aef\uff0c\u90a3\u4e48\u5f53\u88ab\u8c03\u7528\u8005\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u7194\u65ad\u5668\u53ef\u4ee5\u76f4\u63a5\u963b\u6b62\u8c03\u7528\u8005\u7684\u8c03\u7528\uff0c\u4f46\u540c\u65f6\u8c03\u7528\u8005\u4e5f\u53ef\u80fd\u4f5c\u4e3a\u88ab\u8c03\u7528\u8005\u88ab\u5176\u4ed6\u670d\u52a1\u8c03\u7528\uff0c\u8fd9\u4e2a\u65f6\u5019\u53c8\u662f\u53e6\u5916\u4e00\u79cd\u601d\u8003\u65b9\u5f0f\u548c\u7406\u5ff5\u3002\u603b\u4e4b\uff0c\u6211\u4eec\u8981\u7ad9\u5728\u88ab\u8c03\u7528\u8005\u7684\u7acb\u573a\u4e0a\u7ed9\u63a5\u53e3\u548c\u65b9\u6cd5\u52a0Resilience4j\u5bb9\u9519\uff0c\u6bd4\u5982\u5982\u679c\u672c\u65b9\u6cd5\u51fa\u9519\uff0c\u5e94\u8be5\u7194\u65ad\u964d\u7ea7\uff0c\u518d\u6bd4\u5982\u672c\u65b9\u6cd5\u5341\u5206\u6d88\u8017\u7cfb\u7edf\u8d44\u6e90\uff0c\u5e94\u8be5\u88ab\u9650\u6d41\u3002</p> <p>CircuitBreaker\u65ad\u8def\u5668\u5728SpringBoot\u4e2d\u4f7f\u7528 1\u3001\u5f15\u5165\u4f9d\u8d56 2\u3001\u914d\u7f6e Text Only<pre><code>resilience4j.circuitbreaker:\n\u00a0\u00a0configs:\n\u00a0\u00a0\u00a0\u00a0default:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0slidingWindowSize: 100\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0permittedNumberOfCallsInHalfOpenState: 10\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0waitDurationInOpenState: 10000\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failureRateThreshold: 60\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0eventConsumerBufferSize: 10\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registerHealthIndicator: true\n\u00a0\u00a0\u00a0\u00a0someShared:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0slidingWindowSize: 50\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0permittedNumberOfCallsInHalfOpenState: 10\n\u00a0\u00a0instances:\n\u00a0\u00a0\u00a0\u00a0backendA:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0baseConfig: default\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0waitDurationInOpenState: 5000\n\u00a0\u00a0\u00a0\u00a0backendB:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0baseConfig: someShared\n</code></pre> 3\u3001\u4f7f\u7528@CircuitBreaker\u65ad\u8def\u5668\u88c5\u9970\u63a5\u53e3 Text Only<pre><code>@GetMapping(\"/get_user\")\n@CircuitBreaker(name = \"backendA\", fallbackMethod = \"getUserFallback\")\npublic String getUser(@RequestParam(\"id\") Integer id) {\n\u00a0\u00a0\u00a0\u00a0logger.info(\"[getUser][\u51c6\u5907\u8c03\u7528 user-service \u83b7\u53d6\u7528\u6237({})\u8be6\u60c5]\", id);\n\u00a0\u00a0\u00a0\u00a0return restTemplate.getForEntity(\"http://127.0.0.1:18080/user/get?id=\" + id, String.class).getBody();\n}\n//\u670d\u52a1\u964d\u7ea7\npublic String getUserFallback(Integer id, Throwable throwable) {\n\u00a0\u00a0\u00a0\u00a0logger.info(\"[getUserFallback][id({}) exception({})]\", id, throwable.getClass().getSimpleName());\n\u00a0\u00a0\u00a0\u00a0return \"mock:User:\" + id;\n}\n</code></pre></p> <p>RateLimiter\u9650\u6d41\u5668\u5728SpringBoot\u4e2d\u4f7f\u7528 1\u3001\u5f15\u5165\u4f9d\u8d56 2\u3001\u914d\u7f6e Text Only<pre><code>resilience4j:\n\u00a0\u00a0ratelimiter:\n\u00a0 \u00a0configs:\n\u00a0 \u00a0 \u00a0default:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0limit-for-period: 1 # \u6bcf\u4e2a\u5468\u671f\u5185\uff0c\u5141\u8bb8\u7684\u8bf7\u6c42\u6570\u3002\u9ed8\u8ba4\u4e3a 50\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0limit-refresh-period: 10s # \u6bcf\u4e2a\u5468\u671f\u7684\u65f6\u957f\uff0c\u5355\u4f4d\uff1a\u5fae\u79d2\u3002\u9ed8\u8ba4\u4e3a 500\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timeout-duration: 5s # \u88ab\u9650\u6d41\u65f6\uff0c\u963b\u585e\u7b49\u5f85\u7684\u65f6\u957f\uff0c\u5355\u4f4d\uff1a\u5fae\u79d2\u3002\u9ed8\u8ba4\u4e3a 5s\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0register-health-indicator: true # \u662f\u5426\u6ce8\u518c\u5230\u5065\u5eb7\u76d1\u6d4b\n\u00a0\u00a0instances:\n\u00a0\u00a0\u00a0\u00a0backendB:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0baseConfig: default\n</code></pre> 3\u3001\u4f7f\u7528@RateLimiter\u9650\u6d41\u5668\u88c5\u9970\u63a5\u53e3 Text Only<pre><code>@GetMapping(\"/get_user\")\n@RateLimiter(name = \"backendB\", fallbackMethod = \"getUserFallback\")\npublic String getUser(@RequestParam(\"id\") Integer id) {\n\u00a0\u00a0\u00a0\u00a0return \"User:\" + id;\n}\n//\u670d\u52a1\u964d\u7ea7\npublic String getUserFallback(Integer id, Throwable throwable) {\n\u00a0\u00a0\u00a0\u00a0logger.info(\"[getUserFallback][id({}) exception({})]\", id, throwable.getClass().getSimpleName());\n\u00a0\u00a0\u00a0\u00a0return \"mock:User:\" + id;\n}\n</code></pre> \u5728\u8bf7\u6c42\u88ab\u9650\u6d41\u65f6\uff0cResilience4j \u4e0d\u4f1a\u6267\u884c #getUser(Integer id) \u65b9\u6cd5\uff0c\u800c\u662f\u76f4\u63a5\u629b\u51fa RequestNotPermitted \u5f02\u5e38\uff0c\u7136\u540e\u5c31\u8fdb\u5165 fallback \u964d\u7ea7\u5904\u7406\u3002@RateLimiter \u6ce8\u89e3\u7684 fallbackMethod \u5c5e\u6027\u5bf9\u5e94\u7684 fallback \u65b9\u6cd5\uff0c\u4e0d\u4ec5\u4ec5\u5904\u7406\u88ab\u9650\u6d41\u65f6\u629b\u51fa\u7684 RequestNotPermitted \u5f02\u5e38\uff0c\u4e5f\u5904\u7406 #getUser(Integer id) \u65b9\u6cd5\u6267\u884c\u65f6\u7684\u666e\u901a\u5f02\u5e38\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/6-Micrometer%20Tracing%20%2B%20Zipkin/","title":"6-Micrometer Tracing + Zipkin","text":"<p> \u7ea6 200 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>Micrometer\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u63a7\u5de5\u5177\uff0c\u5176\u6709\u4e09\u5927\u53ef\u89c2\u6d4b\u6027\u652f\u67f1\uff1aMetrics\u3001Tracing\u3001Logging\uff0cTracing\u53ea\u662f\u5176\u4e2d\u4e00\u4e2a\u7528\u4e8e\u5168\u94fe\u8def\u8ffd\u8e2a\u7684\u95e8\u9762\uff0cZipkin\u5c31\u662f\u8fd9\u4e2a\u95e8\u9762\u7684\u5b9e\u73b0\uff0c\u5e76\u63d0\u4f9b\u4e86\u53ef\u89c6\u5316\u754c\u9762\u3002</p> <p>Micrometer Tracing\u4e3b\u8981\u672f\u8bed\uff1a</p> <ul> <li>Trace id\uff1a\u6574\u4e2a\u8c03\u7528\u94fe\u4f7f\u7528\u540c\u4e00\u4e2aTrace id</li> <li>Span id\uff1a\u6bcf\u5230\u4e00\u5904\u751f\u6210\u4e00\u4e2aSpan id\uff0c\u5e76\u628a\u4e0a\u6e38\u4f20\u9012\u4e0b\u6765\u7684Span id\u3001\u6b64\u6b21\u751f\u6210\u7684Span id \u4ee5\u53ca\u00a0Trace id\u4e0a\u62a5\uff0c\u901a\u8fc7Trace id\u3001Span id\u3001parent\u00a0Span id\u5c31\u53ef\u4ee5\u628a\u6574\u6761\u8c03\u7528\u94fe\u53ef\u89c6\u5316\u4e86\u3002</li> </ul> <p>Micrometer\u662f\u65e0\u4fb5\u5165\u7684\uff0c\u4f7f\u7528\u65b9\u5f0f\u5f88\u7b80\u5355\uff1a 1\u3001\u5f15\u5165Micrometer\u4f9d\u8d56 2\u3001\u4e0b\u8f7dZipkin 3\u3001\u542f\u52a8Zipkin\uff0c\u8bbf\u95eehttp://localhost:9411/zipkin/</p> <p>\u540c\u7c7b\u578b\u7684\u4ea7\u54c1\u8fd8\u6709\uff1aSkyWalking\u3001PinPoint</p> <p>SkyWalking\uff1a40 \u5f20\u56fe\u641e\u61c2\u5206\u5e03\u5f0f\u65e5\u5fd7\u8ffd\u8e2a\uff0c\u5f3a\u5927\u7684traceId</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/7-Gateway/","title":"7-Gateway","text":"<p> \u7ea6 2050 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 41 \u5206\u949f</p> <p>\u4ee5\u524d\u4e24\u4e2a\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u5f88\u76f4\u63a5\uff0c\u73b0\u5728\u51fa\u4e8e\u5b89\u5168\u3001\u76d1\u63a7\u3001\u65b9\u4fbf\u7edf\u4e00\u7ba1\u7406\u7b49\u9700\u6c42\uff0c\u4e0d\u518d\u5141\u8bb8\u76f4\u63a5\u8c03\u7528\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u5fc5\u987b\u7ecf\u8fc7\u7f51\u5173\uff0c\u7531\u7f51\u5173\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\uff0c\u8fd9\u5c31Spring Cloud Gateway\u7684\u76ee\u7684\u3002 \u53c2\u8003\u5b98\u7f51\uff1a Spring Cloud Gateway \u4ee5\u524d\u662f\u901a\u8fc7Feign\u76f4\u63a5\u8c03\u76ee\u6807\u5fae\u670d\u52a1\uff1a Text Only<pre><code>@FeignClient(value = \"\")\npublic interface PayFeignApi {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u65b0\u589e\u4e00\u6761\u652f\u4ed8\u76f8\u5173\u6d41\u6c34\u8bb0\u5f55\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@PostMapping(value = \"/pay/add\")\n\u00a0\u00a0\u00a0\u00a0public ResultData addPay(@RequestBody PayDTO payDTO);\n}\n</code></pre> \u73b0\u5728\u6539\u6210\u8c03Gateway\uff0c\u518d\u7531Gateway\u8f6c\u53d1\u5230cloud-payment-service Text Only<pre><code>@FeignClient(value = \"cloud-gateway\")\npublic interface PayFeignApi {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u65b0\u589e\u4e00\u6761\u652f\u4ed8\u76f8\u5173\u6d41\u6c34\u8bb0\u5f55\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@PostMapping(value = \"/pay/add\")\n\u00a0\u00a0\u00a0\u00a0public ResultData addPay(@RequestBody PayDTO payDTO);\n}\n</code></pre> \u5e76\u975e\u4e00\u5b9a\u8981\u7528Feign\u8c03\uff0c\u76f4\u63a5\u5411\u7f51\u5173\u53d1\u9001http\u8bf7\u6c42\u4e5f\u53ef\u4ee5\u88ab\u7f51\u5173\u8f6c\u53d1\uff0c\u6240\u4ee5\u5728\u9879\u76ee\u4e2d\u52a0\u5165Gateway\u4e4b\u540e\u6240\u6709\u7684\u8bf7\u6c42\u5e94\u8be5\u90fd\u5148\u5230\u7f51\u5173\u3002 Nginx\u548cSpring Cloud Gateway\u90fd\u662f\u5728\u505a\u8bf7\u6c42\u8f6c\u53d1\u7684\u5de5\u4f5c\uff0c\u53ea\u4e0d\u8fc7\u4e8c\u8005\u7684\u4fa7\u91cd\u70b9\u4e0d\u540c\uff0cNginx\u8d1f\u8d23\u627f\u63a5\u5916\u90e8\u8fdb\u6765\u7684\u8bf7\u6c42\uff0cGateway\u4e3b\u8981\u8d1f\u8d23\u5fae\u670d\u52a1\u4e4b\u95f4\u8bf7\u6c42\uff0c\u5f53\u7136\u5916\u90e8\u8fdb\u6765\u7684\u8bf7\u6c42\u4e5f\u8981\u5148\u5230Gateway\u3002</p> <p>Spring Cloud Gateway\u7684\u4e09\u4e2a\u91cd\u8981\u672f\u8bed\uff1a</p> <ul> <li>Route\uff08\u8def\u7531\uff09\uff1a\u7531\u4e00\u4e2aID\u3001\u76ee\u7684URI\u3001\u4e00\u7cfb\u5217Predicate\u3001\u4e00\u7cfb\u5217Filter\u00a0\u7ec4\u6210\uff0c\u4e5f\u5c31\u662fRoute\u5305\u542bPredicate\u548cFilter\u3002</li> <li>Predicate\uff08\u65ad\u8a00\uff09\uff1a\u5339\u914d\u6761\u4ef6\u3002</li> <li>Filter\uff08\u8fc7\u6ee4\u5668\uff09\uff1a\u5339\u914d\u6210\u529f\u4e4b\u540e\uff0c\u5728\u8bf7\u6c42\u4e4b\u524d\u548c\u54cd\u5e94\u4e4b\u540e\u505a\u4e00\u4e9b\u52a8\u4f5c\uff0c\u6bd4\u5982\u53ef\u4ee5\u4fee\u6539\u8bf7\u6c42\u5934\u548c\u54cd\u5e94\u5934\u3002</li> </ul> <p><code>Gateway\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a\u5148\u68c0\u67e5Predicate\uff0c\u6240\u6709Predicate\u90fd\u5339\u914d\u4e4b\u540e\u5c31\u505aFilter\u4e2d\u7684\u52a8\u4f5c\uff0c\u6700\u540e\u62fc\u63a5\u4e0auri\u7136\u540e\u53d1\u9001\u8bf7\u6c42\u5230\u76ee\u6807\u5fae\u670d\u52a1\u3002</code>\u53ef\u4ee5\u770b\u5230\uff0cGateway\u5c06\u6240\u6709\u5fae\u670d\u52a1\u7684\u63a5\u53e3\u90fd\u96c6\u4e2d\u5728\u4e00\u8d77\u4e86\uff0c\u6240\u4ee5Predicate\u4e2d\u7684Path\u5f88\u91cd\u8981\uff0c\u6240\u6709\u5fae\u670d\u52a1\u4e4b\u95f4\u4e0d\u80fd\u6709\u91cd\u590d\u7684Path\uff0c\u4fdd\u8bc1\u8fd9\u4e00\u70b9\u4e5f\u5f88\u7b80\u5355\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u6709\u7279\u5b9a\u7684\u540d\u5b57\uff0c\u628a\u8fd9\u4e2a\u540d\u5b57\u4f5c\u4e3aPath\u7684\u524d\u7f00\u3002 </p> <p>uri uri: lb://cloud-payment-service\uff0clb\u8868\u793aloadbanlance\uff0ccloud-payment-service\u662f\u5728\u6ce8\u518c\u4e2d\u5fc3\u6ce8\u518c\u7684\u5fae\u670d\u52a1\u3002</p> <p>Predicate Spring Cloud Gateway\u6709\u5f88\u591a\u5185\u7f6e\u7684\u65ad\u8a00\uff0c\u5982\u4e0b\uff0c\u65b9\u4fbf\u76f4\u63a5\u914d\u7f6e\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u3002</p> <ul> <li>The After Request Predicate\uff1a\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u53d1\u751f\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u4e4b\u540e\uff0c\u5426\u5219\u4e0d\u653e\u884c</li> <li>The Before Request Predicate\uff1a\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u53d1\u751f\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u4e4b\u524d\uff0c\u5426\u5219\u4e0d\u653e\u884c</li> <li>The Between Request Predicate\uff1a\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u53d1\u751f\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u4e4b\u95f4\uff0c\u5426\u5219\u4e0d\u653e\u884c</li> <li>The Cookie Request Predicate\uff1a\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684cookie</li> <li>The Header Request Predicate\uff1a\u8868\u793a\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684\u8bf7\u6c42\u5934</li> <li>The Host Request Predicate\uff1a\u8868\u793a\u8bf7\u6c42\u5934\u4e2d\u7684Host\u5fc5\u987b\u662f\u6307\u5b9a\u7684\u5f62\u5f0f\uff08\u6b63\u5219\u8868\u8fbe\u5f0f\uff09</li> <li>The Method Request Predicate\uff1a\u8bf7\u6c42\u65b9\u5f0f\u5fc5\u987b\u662f\u6307\u5b9a\u7684\u65b9\u5f0f</li> <li><code>The Path Request Predicate\uff1a\u8bf7\u6c42\u7684\u8def\u5f84</code></li> <li>The Query Request Predicate\uff1a\u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684\u67e5\u8be2\u53c2\u6570</li> <li>The RemoteAddr Route Predicate Factory</li> <li>The Weight Request Predicate\uff1a\u53ef\u4ee5\u7ed9\u4e0d\u540c\u7684\u8def\u7531\u5206\u7ec4\uff0c\u5e76\u6307\u5b9a\u6743\u91cd\u503c\uff0c\u6743\u91cd\u503c\u51b3\u5b9a\u4e86\u6d41\u91cf\u7684\u5927\u5c0f\u3002</li> <li>The XForwarded Remote Addr Route Predicate Factory</li> </ul> <p>The After Request Predicate\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u53d1\u751f\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u4e4b\u540e\uff0c\u5426\u5219\u4e0d\u653e\u884c\u3002 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: after_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- After=2017-01-20T17:42:47.789-07:00[America/Denver]\n</code></pre> The Cookie Request Predicate\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684cookie\uff0ccookie\u662f\u952e\u503c\u5bf9\uff0c\u503c\u4e0d\u80fd\u7701\u7565\u3002 Spring Cloud Gateway\u6709\u4e24\u79cd\u914d\u7f6e\u98ce\u683c\uff1aShortcut Configuration\uff08\u5feb\u6377\u914d\u7f6e\uff09\u00a0\u548c Fully Expanded Arguments\uff08\u5b8c\u5168\u914d\u7f6e\uff09\uff0c\u4e0b\u9762\u5168\u90e8\u4f7f\u7528Shortcut Configuration\u3002 \u5bf9\u4e8e\u952e\u503c\u5bf9\uff0cShortcut Configuration\u7684\u914d\u7f6e\u98ce\u683c\u662f\uff1a 1\u3001\u952e\u548c\u503c\u914d\u7f6e\u7684\u65f6\u5019\u4ee5\u9017\u53f7\u5206\u9694\uff0c\u503c\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5f62\u5f0f\u3002 2\u3001\u5982\u679c\u503c\u53ef\u4ee5\u7701\u7565\uff0c\u914d\u7f6e\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u5305\u542b\u503c\uff0c\u8868\u793a\u53ea\u8981\u6c42\u53ea\u5305\u542b\u8be5\u952e\uff0c\u5bf9\u503c\u6ca1\u6709\u8981\u6c42\u3002 3\u3001\u5982\u679c\u6709\u591a\u4e2acookie\u5219\u4ee5\u5217\u8868\u5f62\u5f0f\u914d\u7f6e\u3002 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: cookie_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Cookie=chocolate2, ch.p\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Cookie=chocolate3, xxxx\n</code></pre> The Header Request Predicate\u8868\u793a\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684\u8bf7\u6c42\u5934\uff0c\u548ccookie\u4e00\u6837\u4ee5\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u914d\u7f6e\u3002 The Host Request Predicate\u8868\u793a\u8bf7\u6c42\u5934\u4e2d\u7684Host\u5fc5\u987b\u662f\u6307\u5b9a\u7684\u5f62\u5f0f\uff08\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\uff0c\u8fd9\u4e2aHost\u65ad\u8a00\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u591a\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u4ee5\u9017\u53f7\u5206\u9694 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: host_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Host=**.somehost.org,**.anotherhost.org\n</code></pre> The Method Request Predicate\uff1a\u8bf7\u6c42\u65b9\u5f0f\u5fc5\u987b\u662f\u6307\u5b9a\u7684\u65b9\u5f0f\uff0c\u548cHost\u65ad\u8a00\u4e00\u6837\u662f\u4e00\u4e2a\u5217\u8868 The Path Request Predicate\u5339\u914d\u8bf7\u6c42\u7684\u8def\u5f84\uff0c\u4e5f\u662f\u4e00\u4e2a\u5217\u8868\uff0c{segment}\u662f\u8def\u5f84\u53d8\u91cf\uff0c\u53ef\u4ee5\u5339\u914d\u4efb\u610f\u503c\uff0c\u8fd9\u4e2a\u53d8\u91cf\u53ef\u4ee5\u5728Filter\u4e2d\u4f7f\u7528\u3002 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: path_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Path=/red/{segment},/blue/{segment}\n</code></pre> The Query Request Predicate\uff1a\u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u6307\u5b9a\u7684\u67e5\u8be2\u53c2\u6570\uff0c\u67e5\u8be2\u53c2\u6570\u65ad\u8a00\u662f\u952e\u503c\u5bf9\uff0c\u503c\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u503c\u53ef\u4ee5\u7701\u7565\uff0c\u914d\u7f6e\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u5305\u542b\u503c\uff0c\u8868\u793a\u53ea\u8981\u6c42\u53ea\u5305\u542b\u8be5\u952e\uff0c\u5bf9\u503c\u6ca1\u6709\u8981\u6c42\u3002 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: query_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Query=green\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Query=red, gree.\n</code></pre> The Weight Request Predicate\uff1a\u53ef\u4ee5\u7ed9\u4e0d\u540c\u7684\u8def\u7531\u5206\u7ec4\uff0c\u5e76\u6307\u5b9a\u6743\u91cd\u503c\uff0c\u6743\u91cd\u503c\u51b3\u5b9a\u4e86\u6d41\u91cf\u7684\u5927\u5c0f\u3002\u4e0b\u9762\u7684\u914d\u7f6e\u4f1a\u5c0680%\u7684\u6d41\u91cf\u7ed9https://weighthigh.org\u3002 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: weight_high\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://weighthigh.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Weight=group1, 8\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: weight_low\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://weightlow.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Weight=group1, 2\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u65ad\u8a00 1\u3001\u521b\u5efa\u7c7b\u540d\u4ee5RoutePredicateFactory\u7ed3\u5c3e\u7684\u7c7b\uff0c\u6bd4\u5982MyRoutePredicateFactory\uff0c\u524d\u7f00My\u5c06\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u9879 2\u3001\u65b0\u5efa\u9759\u6001\u5185\u90e8\u7c7bMyRoutePredicateFactory.Config\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u7684\u503c\u4f1a\u8d4b\u503c\u7ed9Config\u4e2d\u7684\u53d8\u91cf 3\u3001\u7ee7\u627fAbstractRoutePredicateFactory 4\u3001\u7a7a\u53c2\u6784\u9020\u65b9\u6cd5\uff0c\u5185\u90e8\u8c03\u7528super 5\u3001\u91cd\u5199\u7236\u7c7b\u7684shortcutFieldOrder()\u65b9\u6cd5\uff0c\u7528\u4e8e\u5feb\u6377\u914d\u7f6e 6\u3001\u91cd\u5199apply\u65b9\u6cd5\uff0c\u65ad\u8a00\u7684\u903b\u8f91\u5c01\u88c5\u5728apply\u65b9\u6cd5\u91cc \u6bd4\u5982\u4e0b\u9762\u65ad\u8a00\u8868\u793a\u8bf7\u6c42\u53c2\u6570\u4e2d\u5fc5\u987b\u8981\u6709\u4e00\u4e2a\"userType\"\u53c2\u6570\u4e14\u4e0e\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7684\u4e00\u81f4 Text Only<pre><code>@Component\npublic class MyRoutePredicateFactory extends AbstractRoutePredicateFactory&lt;MyRoutePredicateFactory.Config&gt; {\n\u00a0\u00a0\u00a0\u00a0public MyRoutePredicateFactory() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0super(MyRoutePredicateFactory.Config.class);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u8fd9\u4e2aConfig\u7c7b\u5c31\u662f\u6211\u4eec\u7684\u8def\u7531\u65ad\u8a00\u89c4\u5219\uff0c\u91cd\u8981\n\u00a0\u00a0\u00a0\u00a0@Validated\n\u00a0\u00a0\u00a0\u00a0public static class Config {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Setter\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Getter\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@NotEmpty\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private String userType; //\u94bb/\u91d1/\u94f6\u548cyml\u914d\u7f6e\u7684\u4f1a\u5458\u7b49\u7ea7\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public List&lt;String&gt; shortcutFieldOrder() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Collections.singletonList(\"userType\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Predicate&lt;ServerWebExchange&gt; apply(MyRoutePredicateFactory.Config config) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Predicate&lt;ServerWebExchange&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean test(ServerWebExchange serverWebExchange) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u68c0\u67e5request\u7684\u53c2\u6570\u91cc\u9762\uff0cuserType\u662f\u5426\u4e3a\u6307\u5b9a\u7684\u503c\uff0c\u7b26\u5408\u914d\u7f6e\u5c31\u901a\u8fc7\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//http://localhost:9527/pay/gateway/get/1?userType=diamond\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String userType = serverWebExchange.getRequest().getQueryParams().getFirst(\"userType\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (userType == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u8bf4\u53c2\u6570\u5b58\u5728\uff0c\u5c31\u548cconfig\u7684\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (userType.equalsIgnoreCase(config.getUserType())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5feb\u6377\u914d\u7f6e\u65b9\u5f0f\uff1a Text Only<pre><code>spring:\n\u00a0\u00a0application:\n\u00a0\u00a0\u00a0\u00a0name: cloud-gateway #\u4ee5\u5fae\u670d\u52a1\u6ce8\u518c\u8fdbconsul\u6216nacos\u670d\u52a1\u5217\u8868\u5185\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: pay_routh1 #pay_routh1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u8def\u7531\u7684ID(\u7c7b\u4f3cmysql\u4e3b\u952eID)\uff0c\u6ca1\u6709\u56fa\u5b9a\u89c4\u5219\u4f46\u8981\u6c42\u552f\u4e00\uff0c\u5efa\u8bae\u914d\u5408\u670d\u52a1\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: lb://cloud-payment-service\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u5339\u914d\u540e\u63d0\u4f9b\u670d\u52a1\u7684\u8def\u7531\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Path=/pay/gateway/get/**\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u65ad\u8a00\uff0c\u8def\u5f84\u76f8\u5339\u914d\u7684\u8fdb\u884c\u8def\u7531\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- My=gold\n</code></pre> \u5b8c\u5168\u914d\u7f6e\u65b9\u5f0f\uff1a Text Only<pre><code>spring:\n application:\n name: cloud-gateway #\u4ee5\u5fae\u670d\u52a1\u6ce8\u518c\u8fdbconsul\u6216nacos\u670d\u52a1\u5217\u8868\u5185\n cloud:\n gateway:\n routes:\n - id: pay_routh1 #pay_routh1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u8def\u7531\u7684ID(\u7c7b\u4f3cmysql\u4e3b\u952eID)\uff0c\u6ca1\u6709\u56fa\u5b9a\u89c4\u5219\u4f46\u8981\u6c42\u552f\u4e00\uff0c\u5efa\u8bae\u914d\u5408\u670d\u52a1\u540d\n uri: lb://cloud-payment-service\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u5339\u914d\u540e\u63d0\u4f9b\u670d\u52a1\u7684\u8def\u7531\u5730\u5740\n predicates:\n - Path=/pay/gateway/get/**\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# \u65ad\u8a00\uff0c\u8def\u5f84\u76f8\u5339\u914d\u7684\u8fdb\u884c\u8def\u7531\n - name: My\n args:\n userType: diamond\n</code></pre> <p>Filter Filter\u540c\u6837\u4e5f\u6709\u5f88\u591a\u5185\u7f6e\u7684\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u5185\u7f6e\u7684\u5927\u81f4\u53ef\u4ee5\u5206\u6210\u4e00\u4e0b\u51e0\u7c7b\uff1a \u4fee\u6539\u8bf7\u6c42\u5934\uff1a</p> <ul> <li>AddRequestHeader GatewayFilter Factory</li> <li>RemoveRequestHeader GatewayFilter Factory</li> <li>SetRequestHeader GatewayFilter Factory</li> </ul> <p>\u4fee\u6539\u8bf7\u6c42\u53c2\u6570\uff1a</p> <ul> <li>AddRequestParameter GatewayFilter Factory</li> <li>RemoveRequestParameter GatewayFilter Factory</li> </ul> <p>\u4fee\u6539\u54cd\u5e94\u5934\uff1a</p> <ul> <li>AddResponseHeader GatewayFilter Factory</li> <li>RemoveResponseHeader GatewayFilter Factory</li> <li>SetResponseHeader GatewayFilter Factory</li> </ul> <p>Path\u76f8\u5173\uff1a</p> <ul> <li>PrefixPath GatewayFilter Factory</li> <li>SetPath GatewayFilter Factory</li> <li>RedirectTo GatewayFilter Factory</li> </ul> <p>\u9ed8\u8ba4Filter</p> <ul> <li>Default Filters</li> </ul> <p>AddRequestHeader GatewayFilter Factory\uff0c\u6dfb\u52a0\u8bf7\u6c42\u5934\uff0c\u5982\u4e0b\u914d\u7f6e\u5728\u8bf7\u6c42\u5934\u4e2d\u6dfb\u52a0X-Request-Red=Blue-{segment}\uff0c\u5176\u4e2d\u7684{segment}\u4fbf\u662fURL\u4e2d\u8def\u5f84\u53d8\u91cf\u3002 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: add_request_header_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Path=/red/{segment}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0filters:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- AddRequestHeader=X-Request-Red, Blue-{segment}\n</code></pre> PrefixPath GatewayFilter Factory\uff0c\u65ad\u8a00\u5339\u914d\u4e4b\u540e\u4f1a\u7ed9\u8bf7\u6c42\u8def\u5f84\u52a0\u4e0a\u4e00\u4e2a\u524d\u7f00\uff0c\u6bd4\u5982\u4e0b\u9762\u5411\u7f51\u5173\u53d1\u9001/hello\u8bf7\u6c42\uff0c\u6700\u540e\u7f51\u5173\u8f6c\u53d1\u7684\u8bf7\u6c42\u7684\u8def\u5f84\u662fhttps://example.org/mypath/hello Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: prefixpath_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0filters:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- PrefixPath=/mypath\n</code></pre> SetPath GatewayFilter Factory\uff0c\u7f51\u5173\u8f6c\u53d1\u7684\u65f6\u5019\u76f4\u63a5\u628a\u8bf7\u6c42\u8def\u5f84\u5b8c\u5168\u66ff\u6362\u6389\uff0c\u6bd4\u5982\u4e0b\u9762\u53d1\u9001\u7ed9\u7f51\u5173\u8bf7\u6c42\u662f/red/a\uff0c\u7f51\u5173\u8f6c\u53d1\u7684\u8def\u5f84\u662fhttps://example.org/xx Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: setpath_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0predicates:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Path=/red/a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0filters:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- SetPath=/xx\n</code></pre> RedirectTo GatewayFilter Factory\uff0c\u7f51\u5173\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u91cd\u5b9a\u5411\u54cd\u5e94 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0routes:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- id: prefixpath_route\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uri: https://example.org\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0filters:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- RedirectTo=302, https://acme.org\n</code></pre> Default Filters\u662f\u4e00\u4e2a\u4e00\u7cfb\u5217Filter\u7684\u5217\u8868\uff0c\u9ed8\u8ba4\u4f5c\u7528\u4e8e\u6240\u6709routes\u8def\u7531 Text Only<pre><code>spring:\n\u00a0\u00a0cloud:\n\u00a0\u00a0\u00a0\u00a0gateway:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0default-filters:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- AddResponseHeader=X-Response-Default-Red, Default-Blue\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- PrefixPath=/httpbin\n</code></pre></p> <p>\u81ea\u5b9a\u4e49Filter 1\u3001\u81ea\u5b9a\u4e49GatewayFilter\uff0c\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u9488\u5bf9\u5355\u4e00route 2\u3001\u81ea\u5b9a\u4e49GlobalFilter\uff0c\u548cDefault Filters\u4e00\u6837\uff0c\u9488\u5bf9\u6240\u6709routes</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringCloud/8-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E4%B8%8ESeata/","title":"8-\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e0eSeata","text":"<p> \u7ea6 4240 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 85 \u5206\u949f</p> <p>\u5206\u5e03\u5f0f\u4e8b\u52a1\u7406\u8bba \u591a\u4e2a\u8282\u70b9\u8fbe\u6210\u5171\u8bc6\u7684\u573a\u666f\uff1a</p> <ul> <li>\u9886\u5bfc\u9009\u4e3e</li> <li>\u539f\u5b50\u63d0\u4ea4</li> </ul> <p>\u5171\u8bc6\u7684\u4e00\u822c\u5f62\u5f0f\u662f\uff0c\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u53ef\u4ee5\u63d0\u8bae\uff0c\u5141\u8bb8\u5c31\u4efb\u610f\u4e00\u4e2a\u53c2\u4e0e\u8005\u63d0\u51fa\u7684\u5019\u9009\u503c\u8fbe\u6210\u4e00\u81f4\u3002\u4f46\u539f\u5b50\u63d0\u4ea4\u7684\u5f62\u5f0f\u5316\u4e0e\u5171\u8bc6\u7a0d\u6709\u4e0d\u540c\uff0c\u53ea\u6709\u4e00\u4e2a\u4e3b\u8282\u70b9\u53ef\u4ee5\u63d0\u8bae\uff0c\u5e76\u4e14\u53ea\u6709\u5728\u6240\u6709\u53c2\u4e0e\u8005\u6295\u7968\u63d0\u4ea4\u7684\u60c5\u51b5\u4e0b\u624d\u80fd\u63d0\u4ea4\uff0c\u5982\u679c\u6709\u4efb\u4f55\u53c2\u4e0e\u8005\u9700\u8981\u4e2d\u6b62\uff0c\u5219\u5fc5\u987b\u4e2d\u6b62\u3002\u7136\u800c\uff0c\u539f\u5b50\u63d0\u4ea4\u548c\u5171\u8bc6\u53ef\u4ee5\u76f8\u4e92\u7b80\u5316\u4e3a\u5bf9\u65b9\u3002 \u89e3\u51b3\u539f\u5b50\u63d0\u4ea4\u7684\u5171\u8bc6\u7b97\u6cd5\u662f\u4e24\u9636\u6bb5\u63d0\u4ea4\uff082PC, two-phase commit\uff09\u7b97\u6cd5\u30022PC\u6709\u4e24\u79cd\u89d2\u8272\uff1a\u534f\u8c03\u8005\uff08coordinator\uff09\uff08\u4e5f\u79f0\u4e3a\u4e8b\u52a1\u7ba1\u7406\u5668\uff08transaction manager\uff09\uff09\u00a0\u548c\u00a0\u53c2\u4e0e\u8005\uff08participants\uff09\u3002\u534f\u8c03\u8005\u901a\u5e38\u5728\u8bf7\u6c42\u4e8b\u52a1\u7684\u76f8\u540c\u5e94\u7528\u8fdb\u7a0b\u4e2d\u4ee5\u5e93\u7684\u5f62\u5f0f\u5b9e\u73b0\uff08\u4f8b\u5982\uff0c\u5d4c\u5165\u5728Java EE\u5bb9\u5668\u4e2d\uff09\uff0c\u4f46\u4e5f\u53ef\u4ee5\u662f\u5355\u72ec\u7684\u8fdb\u7a0b\u6216\u670d\u52a1\u3002 \u4e24\u9636\u6bb5\u5206\u522b\u6307\u00a0\u51c6\u5907\u9636\u6bb5\u00a0\u548c\u00a0\u63d0\u4ea4\u9636\u6bb5\uff1a</p> <ol> <li>\u51c6\u5907\u9636\u6bb5\uff1a\u534f\u8c03\u8005\u53d1\u9001\u4e00\u4e2a\u51c6\u5907\uff08prepare\uff09\u8bf7\u6c42\u5230\u6bcf\u4e2a\u53c2\u4e0e\u8005\uff0c\u8be2\u95ee\u5b83\u4eec\u662f\u5426\u80fd\u591f\u63d0\u4ea4\u3002</li> <li>\u63d0\u4ea4\u9636\u6bb5\uff1a<ul> <li>\u5982\u679c\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u56de\u7b54\u201c\u662f\u201d\uff0c\u8868\u793a\u5b83\u4eec\u5df2\u7ecf\u51c6\u5907\u597d\u63d0\u4ea4\uff0c\u90a3\u4e48\u534f\u8c03\u8005\u5728\u9636\u6bb5 2 \u53d1\u51fa\u63d0\u4ea4\uff08commit\uff09\u8bf7\u6c42\uff0c\u7136\u540e\u63d0\u4ea4\u771f\u6b63\u53d1\u751f\u3002</li> <li>\u5982\u679c\u4efb\u610f\u4e00\u4e2a\u53c2\u4e0e\u8005\u56de\u590d\u4e86\u201c\u5426\u201d\uff0c\u5219\u534f\u8c03\u8005\u5728\u9636\u6bb52 \u4e2d\u5411\u6240\u6709\u8282\u70b9\u53d1\u9001\u4e2d\u6b62\uff08abort\uff09\u8bf7\u6c42\u3002</li> </ul> </li> </ol> <p> 2PC\u770b\u4e0a\u53bb\u5f88\u7b80\u5355\uff0c\u4ee5\u81f3\u4e8e\u4f60\u53ef\u80fd\u4f1a\u8d28\u7591\u8be5\u7b97\u6cd5\u6b63\u786e\u6027\uff0c\u6bd4\u5982\u5982\u679c\u5728\u7b2c2\u9636\u6bb5\u5411\u6240\u6709\u53c2\u4e0e\u8005\u53d1\u9001\u63d0\u4ea4\uff08commit\uff09\u8bf7\u6c42\uff0c\u4f46\u662f\u5c31\u5728\u6b64\u65f6Database2\u6302\u4e86\uff0c\u6216\u8005\u7f51\u7edc\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u4ee5\u81f3\u4e8e\u63d0\u4ea4\u8bf7\u6c42\u65e0\u6cd5\u5230\u8fbeDatabase2\uff0c\u800cDatabase1\u5374\u5df2\u7ecf\u6536\u5230\u63d0\u4ea4\u8bf7\u6c42\u5b8c\u6210\u4e86\u63d0\u4ea4\uff0c\u90a3\u4e48Database1\u548cDatabase2\u4e0d\u5c31\u51fa\u73b0\u4e86\u4e0d\u4e00\u81f4\u3002 \u7406\u89e32PC\u7684\u5173\u952e\u5728\u4e8e\uff1a \u534f\u8c03\u8005\u53d1\u9001\u51c6\u5907\u8bf7\u6c42\uff0c\u518d\u6536\u5230\u6240\u6709\u53c2\u4e0e\u8005\u7684\u56de\u590d\u4e4b\u540e\uff0c\u4f1a\u5c31\u63d0\u4ea4\u6216\u4e2d\u6b62\u4e8b\u52a1\u4f5c\u51fa\u660e\u786e\u7684\u51b3\u5b9a\uff08\u53ea\u6709\u5728\u6240\u6709\u53c2\u4e0e\u8005\u6295\u8d5e\u6210\u7968\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u63d0\u4ea4\uff09\uff0c\u534f\u8c03\u8005\u5fc5\u987b\u628a\u8fd9\u4e2a\u51b3\u5b9a\u5199\u5230\u78c1\u76d8\uff0c\u8fd9\u88ab\u79f0\u4e3a\u63d0\u4ea4\u70b9\uff08commit point\uff09\uff0c\u4e00\u65e6\u534f\u8c03\u8005\u7684\u51b3\u5b9a\u843d\u76d8\uff0c\u5c31\u6ca1\u6709\u56de\u5934\u8def\u4e86\uff0c\u4e00\u5b9a\u8981\u5c06\u63d0\u4ea4\u6216\u56de\u6eda\u7684\u51b3\u5b9a\u53d1\u9001\u7ed9\u6240\u6709\u53c2\u4e0e\u8005\uff0c\u5982\u679c\u8fd9\u4e2a\u8bf7\u6c42\u5931\u8d25\u6216\u8d85\u65f6\uff08\u6bd4\u5982\u53c2\u4e0e\u8005\u5728\u6b64\u671f\u95f4\u5d29\u6e83\uff0c\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\u7b49\uff09\uff0c\u534f\u8c03\u8005\u5fc5\u987b\u6c38\u8fdc\u4fdd\u6301\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\uff08\u53ef\u4ee5\u662f\u6545\u969c\u81ea\u52a8\u6062\u590d\uff0c\u5b9e\u5728\u4e0d\u884c\u5c31\u4eba\u4e3a\u4ecb\u5165\u89e3\u51b3\u95ee\u9898\uff0c\u53cd\u6b63\u6700\u540e\u4e00\u5b9a\u8981\u80fd\u63d0\u4ea4\uff09\u3002 \u8fd8\u6709\u4e00\u70b9\uff0c\u5982\u679c\u53c2\u4e0e\u8005\u5728\u51c6\u5907\u9636\u6bb5\u56de\u590d\u4e86\u201c\u662f\u201d\uff0c\u90a3\u4e48\u6700\u7ec8\u51b3\u5b9a\u5982\u679c\u662f\u201c\u63d0\u4ea4\u201d\uff0c\u53c2\u4e0e\u8005\u5fc5\u987b\u786e\u4fdd\u5728\u4efb\u610f\u60c5\u51b5\u4e0b\u53ef\u4ee5\u63d0\u4ea4\u4e8b\u52a1\uff0c\u8fd9\u5305\u62ec\u5c06\u6240\u6709\u4e8b\u52a1\u6570\u636e\u5199\u5165\u78c1\u76d8\uff08\u51fa\u73b0\u6545\u969c\uff0c\u7535\u6e90\u6545\u969c\uff0c\u6216\u786c\u76d8\u7a7a\u95f4\u4e0d\u8db3\u90fd\u4e0d\u80fd\u662f\u7a0d\u540e\u62d2\u7edd\u63d0\u4ea4\u7684\u7406\u7531\uff09\u4ee5\u53ca\u68c0\u67e5\u662f\u5426\u5b58\u5728\u4efb\u4f55\u51b2\u7a81\u6216\u8fdd\u53cd\u7ea6\u675f\u3002 \u6240\u4ee52pc\u534f\u8bae\u5305\u542b\u4e24\u4e2a\u5173\u952e\u7684\u201c\u4e0d\u5f52\u8def\u201d\u70b9\uff0c\u8fd9\u4e24\u4e2a\u627f\u8bfa\u4fdd\u8bc1\u4e862PC\u7684\u539f\u5b50\u6027\uff0c\u4e5f\u662f\u7406\u89e3\u8be5\u534f\u8bae\u7684\u5173\u952e\u70b9\uff1a</p> <ul> <li>\u5f53\u53c2\u4e0e\u8005\u6295\u7968\u201c\u662f\u201d\u65f6\uff0c\u5b83\u627f\u8bfa\u5b83\u7a0d\u540e\u80af\u5b9a\u80fd\u591f\u63d0\u4ea4\uff08\u5c3d\u7ba1\u534f\u8c03\u8005\u53ef\u80fd\u4ecd\u7136\u9009\u62e9\u653e\u5f03\uff09\u3002</li> <li>\u4e00\u65e6\u534f\u8c03\u8005\u505a\u51fa\u51b3\u5b9a\uff0c\u8fd9\u4e00\u51b3\u5b9a\u662f\u4e0d\u53ef\u64a4\u9500\u7684\u3002\u534f\u8c03\u8005\u628a\u6700\u7ec8\u7684\u51b3\u5b9a\u5199\u5230\u78c1\u76d8\u8fd9\u4e00\u52a8\u4f5c\u548c\u6570\u636e\u5e93\u5e38\u89c4\u7684\u5355\u70b9\u4e8b\u52a1\u63d0\u4ea4\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u5c31\u662f\u8bf42PC\u7684\u63d0\u4ea4\u70b9\u5f52\u7ed3\u4e3a\u534f\u8c03\u8005\u4e0a\u7684\u5e38\u89c4\u5355\u8282\u70b9\u539f\u5b50\u63d0\u4ea4\u3002</li> </ul> <p>\u6240\u4ee5\u4e0a\u8ff0\u8d28\u7591\u7b97\u6cd5\u6b63\u786e\u6027\u63d0\u51fa\u95ee\u98982pc\u5176\u5b9e\u5df2\u7ecf\u89e3\u51b3\u4e86\u3002</p> <p>2pc\u534f\u8bae\u552f\u4e00\u5b58\u5728\u7684\u95ee\u9898\u662f\u534f\u8c03\u8005\u7684\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u5982\u679c\u534f\u8c03\u8005\u5728\u51c6\u5907\u9636\u6bb5\u6302\uff0c\u90a3\u4e9b\u8fd8\u6ca1\u6709\u56de\u590d\u662f\u5426\u51c6\u5907\u597d\u7684\u53c2\u4e0e\u8005\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8d85\u65f6\u56de\u6eda\u4e8b\u52a1\uff0c\u4f46\u662f\u90a3\u4e9b\u5df2\u7ecf\u56de\u590d\u53ef\u4ee5\u63d0\u4ea4\u7684\u53c2\u4e0e\u8005\u5219\u56e0\u4e3a\u4e0d\u77e5\u9053\u6700\u7ec8\u7684\u51b3\u5b9a\u800c\u4e0d\u5f97\u4e0d\u4e00\u76f4\u963b\u585e\uff0c\u65e2\u4e0d\u80fd\u63d0\u4ea4\u4e5f\u4e0d\u80fd\u56de\u6eda\u3002\u5982\u679c\u534f\u8c03\u8005\u5728\u63d0\u4ea4\u9636\u6bb5\u6302\uff0c\u5219\u6240\u6709\u6ca1\u6709\u6536\u5230\u6700\u7ec8\u51b3\u5b9a\u7684\u53c2\u4e0e\u4e5f\u5fc5\u987b\u4e00\u76f4\u963b\u585e\uff0c\u65e2\u4e0d\u80fd\u63d0\u4ea4\u4e5f\u4e0d\u80fd\u56de\u6eda\u3002\u603b\u7684\u6765\u8bf4\u5c31\u662f\uff0c\u4efb\u4f55\u51c6\u5907\u597d\u4e86\u4f46\u672a\u63d0\u4ea4\u7684\u53c2\u4e0e\u8005\u90fd\u4f1a\u5728\u7591\u8651\u4e2d\u5361\u6b7b\u30022pc\u4f9d\u8d56\u672c\u5730\u4e8b\u52a1\uff0c\u8fd9\u79cd\u5b58\u7591\u7684\u672c\u5730\u4e8b\u52a1\u4e00\u76f4\u65e0\u6cd5\u63d0\u4ea4\u4f1a\u4f7f\u7cfb\u7edf\u6027\u80fd\u4e25\u91cd\u4e0b\u964d\u7684\u539f\u56e0\u5c31\u662f\u957f\u4e8b\u52a1\u7684\u5371\u5bb3\uff0c\u957f\u4e8b\u52a1\u4f1a\u5bfc\u81f4\u9501\u5f97\u4e0d\u5230\u91ca\u653e\uff0cundo log\u65e0\u6cd5\u91ca\u653e\u7b49\u3002\u552f\u4e00\u65b9\u6cd5\u662f\u7b49\u5f85\u534f\u8c03\u8005\u6062\u590d\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u534f\u8c03\u8005\u5fc5\u987b\u5728\u5411\u53c2\u4e0e\u8005\u53d1\u9001\u63d0\u4ea4\u6216\u4e2d\u6b62\u8bf7\u6c42\u4e4b\u524d\uff0c\u5c06\u5176\u63d0\u4ea4\u6216\u4e2d\u6b62\u51b3\u5b9a\u5199\u5165\u78c1\u76d8\u4e0a\u7684\u4e8b\u52a1\u65e5\u5fd7\uff1a\u534f\u8c03\u8005\u6062\u590d\u540e\uff0c\u901a\u8fc7\u8bfb\u53d6\u5176\u4e8b\u52a1\u65e5\u5fd7\u6765\u786e\u5b9a\u6240\u6709\u5b58\u7591\u4e8b\u52a1\u7684\u72b6\u6001\u3002\u4efb\u4f55\u5728\u534f\u8c03\u8005\u65e5\u5fd7\u4e2d\u6ca1\u6709\u63d0\u4ea4\u8bb0\u5f55\u7684\u4e8b\u52a1\u90fd\u4f1a\u4e2d\u6b62\u3002\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u4f7f\u7528Paxos\u3001Raft\u7b49\u534f\u8bae\u5b9e\u73b0\u534f\u8c03\u8005\u7684\u9ad8\u53ef\u7528\u3002</p> <p>\u5173\u4e8e\u7ebf\u6027\u4e00\u81f4\u6027\uff1a \u7ebf\u6027\u4e00\u81f4\u6027\u5206\u4e3a\u5199\u4e00\u81f4\u548c\u8bfb\u4e00\u81f4\uff0c\u53ea\u6709\u5b9e\u73b0\u4e86\u8bfb\u5199\u4e00\u81f4\u6027\u624d\u80fd\u7b97\u5b9e\u73b0\u4e86\u7ebf\u6027\u4e00\u81f4\u6027\u3002\u6570\u636e\u5e93\u4f1a\u5bf9\u5199\u52a0\u9501\uff0c\u4fdd\u8bc1\u4e0d\u51fa\u73b0\u810f\u5199\uff0c\u6240\u4ee5\u5199\u4e00\u81f4\u6027\u4fdd\u8bc1\u4e86\uff0c\u4f46\u662f\u8bfb\u4e00\u81f4\u6027\u53ea\u5728\u4e32\u884c\u5316\u7ea7\u522b\u624d\u80fd\u4fdd\u8bc1\uff0c\u5728\u8bfb\u5df2\u63d0\u4ea4\u6216\u8005\u5feb\u7167\u8bfb\u7ea7\u522b\u4e0b\u662f\u4e0d\u6ee1\u8db3\u8bfb\u4e00\u81f4\u6027\u7684\u3002\u57282pc\u4e2d\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p>2pc\u7684\u5b9e\u73b0 Seata\u5bf9\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u533a\u5206\uff1a</p> <ul> <li>\u5168\u5c40\u4e8b\u52a1\uff08Global Transaction\uff09\uff1a\u4e5f\u5c31\u662f\u6574\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002</li> <li>\u5206\u652f\u4e8b\u52a1\uff08Branch Transaction\uff09\uff1a\u6bcf\u4e00\u4e2a\u53c2\u4e0e\u8005\u7684\u4e8b\u52a1\uff0c\u4e5f\u88ab\u79f0\u4e3a\u672c\u5730\u4e8b\u52a1\u3002</li> </ul> <p>Seata\u4e2d\u7684\u89d2\u8272\uff1a</p> <ul> <li>\u4e8b\u52a1\u534f\u8c03\u8005\uff08Transaction Coordinator\uff0cTC\uff09\uff1a\u7ef4\u62a4\u5168\u5c40\u548c\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u9a71\u52a8\u5168\u5c40\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002</li> <li>\u4e8b\u52a1\u7ba1\u7406\u8005\uff08Transaction Manager\uff0cTM\uff09\uff1a\u5b9a\u4e49\u5168\u5c40\u4e8b\u52a1\u7684\u8303\u56f4\uff1a\u5f00\u59cb\u5168\u5c40\u4e8b\u52a1\u3001\u63d0\u4ea4\u6216\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u3002</li> <li>\u8d44\u6e90\u7ba1\u7406\u8005\uff08Resource Manager\uff0cRM\uff09\uff1a\u7ba1\u7406\u5206\u652f\u4e8b\u52a1\u5904\u7406\u7684\u8d44\u6e90\uff0c\u4e0eTC\u4ea4\u8c08\u4ee5\u6ce8\u518c\u5206\u652f\u4e8b\u52a1\u548c\u62a5\u544a\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u5e76\u9a71\u52a8\u5206\u652f\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002</li> </ul> <p>Seata\u7ba1\u7406\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6d41\u7a0b\uff1a</p> <ol> <li>TM\u544a\u8bc9TC\u5f00\u542f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0cTC\u751f\u6210\u4e00\u4e2a\u4ee3\u8868\u5168\u5c40\u4e8b\u52a1\u7684XID</li> <li>\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u5f00\u59cb\u8c03\u7528\u5e76\u4f20\u9012XID</li> <li>RM\u6536\u5230XID\u4e4b\u540e\u5411TC\u6ce8\u518c\u672c\u5730\u4e8b\u52a1</li> <li>TM\u544a\u8bc9TC\u53ef\u4ee5\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u4e86\uff08\u610f\u601d\u662f\u524d\u9762\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u5df2\u7ecf\u505a\u5b8c\u4e86\uff0c\u73b0\u5728\u544a\u8bc9TC\u53ef\u4ee5\u5f00\u59cb\u4e24\u9636\u6bb5\u63d0\u4ea4\u4e86\u3002@GlobalTransactional\u6ce8\u89e3\u6807\u6ce8\u7684\u65b9\u6cd5\u6b63\u5e38\u7ed3\u675f\u7684\u8bdd\u5c31\u53ef\u4ee5\u544a\u8bc9TC\u53ef\u4ee5\u63d0\u4ea4\u4e86\uff0c\u81f3\u4e8e\u6700\u7ec8\u662f\u5426\u53ef\u4ee5\u63d0\u4ea4\u8fd8\u8981\u770b\u63a5\u4e0b\u6765\u4e24\u9636\u6bb5\u7684\u7ed3\u679c\uff0c\u5982\u679c\u65b9\u6cd5\u53d1\u751f\u5f02\u5e38\uff0c\u90a3\u80af\u5b9a\u662f\u76f4\u63a5\u544a\u8bc9TC\u53ef\u4ee5\u56de\u6eda\u4e86\uff09</li> <li>TC\u9a71\u52a8\u6240\u6709\u5206\u652f\u4e8b\u52a1\u63d0\u4ea4\u6216\u8005\u56de\u6eda\uff08TC\u5148\u8be2\u95ee\u6240\u6709\u53c2\u4e0e\u8005\u662f\u5426\u51c6\u5907\u597d\u4e86\uff0c\u7136\u540e\u518d\u51b3\u5b9a\u63d0\u4ea4\u6216\u8005\u56de\u6eda\uff09</li> </ol> <p>\u603b\u7ed3\u6765\u8bf4\uff0cSeata\u628a2pc\u7684\u534f\u8c03\u8005\u5206\u6210\u4e86\u4e24\u4e2a\u89d2\u8272\uff0cTM\u548cTC\uff0c\u72ec\u7acbTC\u7684\u8fdb\u7a0b\u65b9\u4fbf\u4f7f\u7528Paxos\u7b49\u5171\u8bc6\u7b97\u6cd5\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u63d0\u4ea4\u70b9\u80af\u5b9a\u662f\u6301\u4e45\u5316\u5728TC\u4e2d\u3002  1\u3001XA X/Open XA\uff08\u6269\u5c55\u67b6\u6784\uff08eXtended Architecture\uff09\u7684\u7f29\u5199\uff09\u662f\u8de8\u5f02\u6784\u6280\u672f\u5b9e\u73b0\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u6807\u51c6\u3002\u8bb8\u591a\u4f20\u7edf\u5173\u7cfb\u6570\u636e\u5e93\uff08\u5305\u62ecPostgreSQL\uff0cMySQL\uff0cDB2\uff0cSQL Server\u548cOracle\uff09\u548c\u6d88\u606f\u4ee3\u7406\uff08\u5305\u62ecActiveMQ\uff0cHornetQ\uff0cMSMQ\u548cIBM MQ\uff09 \u90fd\u652f\u6301XA\u3002\u7b80\u5355\u7406\u89e3\uff0cXA\u662f\u53c2\u4e0e\u8005\u5b9e\u73b0\u7684\u534f\u8bae\uff0c\u5f02\u6784\u7cfb\u7edf\u53ea\u8981\u5b9e\u73b0\u4e86XA\u534f\u8bae\uff0c\u5c31\u80fd\u88ab\u7ec4\u5408\u5728\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\u3002\u534f\u8c03\u8005\u7531\u5e94\u7528\u5b9e\u73b0\uff0c\u6bd4\u5982Seata\u6846\u67b6\u3002 \u793a\u4f8b\uff1a \u7528\u6237\u8d2d\u4e70\u5546\u54c1\u7684\u4e1a\u52a1\u903b\u8f91\u3002\u6574\u4e2a\u4e1a\u52a1\u903b\u8f91\u7531 3 \u4e2a\u5fae\u670d\u52a1\u63d0\u4f9b\u652f\u6301\uff1a</p> <ol> <li>\u4ed3\u50a8\u670d\u52a1\uff1a\u5bf9\u7ed9\u5b9a\u7684\u5546\u54c1\u6263\u9664\u4ed3\u50a8\u6570\u91cf\u3002</li> <li>\u8ba2\u5355\u670d\u52a1\uff1a\u6839\u636e\u91c7\u8d2d\u9700\u6c42\u521b\u5efa\u8ba2\u5355\u3002</li> <li>\u5e10\u6237\u670d\u52a1\uff1a\u4ece\u7528\u6237\u5e10\u6237\u4e2d\u6263\u9664\u4f59\u989d\u3002</li> </ol> <p> 1\u3001\u4ece https://github.com/apache/incubator-seata/releases,\u4e0b\u8f7d\u670d\u52a1\u5668\u8f6f\u4ef6\u5305\uff0c\u5c06\u5176\u89e3\u538b\u7f29\uff0c\u542f\u52a8TC\uff1a Text Only<pre><code>sh seata-server.sh -p 8091 -h 127.0.0.1 -m file\n</code></pre> 2\u3001application.properties Text Only<pre><code>seata.application-id=springboot-feign-seata-business\nseata.tx-service-group=my_test_tx_group\n</code></pre> \u4e0b\u9762\u662fSeata\u76f8\u5173\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5177\u4f53\u542b\u4e49\u89c1\u5b98\u7f51 3\u3001file.conf 4\u3001registry.conf 5\u3001@EnableAutoDataSourceProxy(dataSourceProxyMode = \"XA\") Text Only<pre><code>@SpringBootApplication\n@EnableFeignClients\n@EnableAutoDataSourceProxy(dataSourceProxyMode = \"XA\")\npublic class SpringbootFeignSeataBusinessApplication\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringApplication.run(SpringbootFeignSeataBusinessApplication.class, args);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 6\u3001\u5206\u5e03\u5f0f\u4e8b\u52a1\u53d1\u8d77\u7684\u5730\u65b9\u52a0\u4e0a\u5168\u5c40\u4e8b\u52a1\u7684\u6ce8\u89e3@GlobalTransactional(timeoutMills = 300000, name = \"springboot-feign-seata-xa\") Text Only<pre><code>@GlobalTransactional(timeoutMills = 300000, name = \"springboot-feign-seata-xa\")\npublic void purchase(String userId, String commodityCode, int orderCount, boolean forceRollback) {\n\u00a0\u00a0\u00a0\u00a0LOGGER.info(\"purchase begin ... xid: \" + RootContext.getXID());\n\u00a0\u00a0\u00a0\u00a0stockFeignClient.deduct(commodityCode, orderCount);\n\u00a0\u00a0\u00a0\u00a0orderFeignClient.create(userId, commodityCode, orderCount);\n\u00a0\u00a0\u00a0\u00a0if (forceRollback) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"force rollback!\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 5\u3001\u5728\u5206\u652f\u4e8b\u52a1\u4e0a\u52a0\u4e0a\u666e\u901a\u7684\u4e8b\u52a1\u6ce8\u89e3@Transactional Text Only<pre><code>@Transactional\npublic void deduct(String commodityCode, int count) {\n\u00a0\u00a0\u00a0\u00a0LOGGER.info(\"Stock Service Begin ... xid: \" + RootContext.getXID());\n\u00a0\u00a0\u00a0\u00a0LOGGER.info(\"Deducting inventory SQL: update stock_tbl set count = count - {} where commodity_code = {}\", count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0commodityCode);\n\u00a0\u00a0\u00a0\u00a0jdbcTemplate.update(\"update stock_tbl set count = count - ? where commodity_code = ?\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count, commodityCode);\n\u00a0\u00a0\u00a0\u00a0LOGGER.info(\"Stock Service End ... \");\n}\n</code></pre> XA\u662f\u5f3a\u4e00\u81f4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u6848\uff0c\u5728\u6ca1\u6709\u6536\u5230\u7b2c\u4e8c\u9636\u6bb5\u7684\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u8bf7\u6c42\u4e4b\u524d\u672c\u5730\u4e8b\u52a1\u4e0d\u4f1a\u7ed3\u675f\uff0c\u5404\u4e2a\u53c2\u4e0e\u8005\u5bf9\u672c\u5730\u8d44\u6e90\u4e00\u76f4\u5360\u6709\uff0c\u4e0d\u4f1a\u91ca\u653e\uff0c\u6027\u80fd\u8f83\u4f4e\uff0c\u4e8e\u662f\u51fa\u73b0\u727a\u7272\u90e8\u5206\u4e00\u81f4\u6027\u6362\u53d6\u66f4\u9ad8\u6027\u80fd\u7684\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\u7684\u5b9e\u73b0\u65b9\u5f0f\u5f88\u6734\u7d20\uff0c\u90a3\u5c31\u662f\u5728\u51c6\u5907\u9636\u6bb5\u76f4\u63a5\u63d0\u4ea4\u672c\u5730\u4e8b\u52a1\uff0c\u540e\u7eed\u7b2c\u4e8c\u9636\u6bb5\u5982\u679c\u9700\u8981\u56de\u6eda\uff0c\u90a3\u5c31\u518d\u4f7f\u7528\u53e6\u5916\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u8fdb\u884c\u8865\u507f\uff0c\u6240\u4ee5\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\u4e5f\u79f0\u4e3a\u8865\u507f\u6027\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u5141\u8bb8\u51fa\u73b0\u4e2d\u95f4\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u7cfb\u7edf\u6700\u7ec8\u8981\u8fbe\u5230\u4e00\u81f4\u72b6\u6001\u3002\uff08\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ed3\u679c\u6709\u53ef\u80fd\u901a\u8fc7\u4e8b\u540e\u6267\u884c\u53e6\u4e00\u4e2a\u8865\u507f\u4e8b\u52a1\u6765\u53d6\u6d88\uff0c\u4f46\u4ece\u6570\u636e\u5e93\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u4e8b\u52a1\uff0c\u56e0\u6b64\u4efb\u4f55\u5173\u4e8e\u8de8\u4e8b\u52a1\u6b63\u786e\u6027\u7684\u4fdd\u8bc1\u90fd\u662f\u5e94\u7528\u81ea\u5df1\u7684\u95ee\u9898\u3002\uff09XA\u534f\u8bae\u4f9d\u8d56\u6570\u636e\u5e93\u5c42\u7684\u5b9e\u73b0\uff0c\u4f46\u662f\u8865\u507f\u6027\u5206\u5e03\u5f0f\u4e8b\u52a1\u5219\u5b8c\u5168\u4f9d\u8d56\u5e94\u7528\u5c42\u7684\u5b9e\u73b0\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u4e8b\u52a1\u7684\u5178\u578b\u4ee3\u8868\u662fTCC\u3002</p> <p>2\u3001TCC\u6a21\u5f0f TCC\u6307Try-Confirm-Cancel\uff1a</p> <ol> <li>Try\uff1a\u5bf9\u4e1a\u52a1\u8d44\u6e90\u7684\u68c0\u67e5\u5e76\u9884\u7559\uff1b</li> <li>Confirm\uff1a\u5bf9\u4e1a\u52a1\u5904\u7406\u8fdb\u884c\u63d0\u4ea4\uff0c\u5373 commit \u64cd\u4f5c\uff0c\u53ea\u8981 Try \u6210\u529f\uff0c\u90a3\u4e48\u8be5\u6b65\u9aa4\u4e00\u5b9a\u6210\u529f\uff1b</li> <li>Cancel\uff1a\u5bf9\u4e1a\u52a1\u5904\u7406\u8fdb\u884c\u53d6\u6d88\uff0c\u5373\u56de\u6eda\u64cd\u4f5c\uff0c\u8be5\u6b65\u9aa4\u56de\u5bf9 Try \u9884\u7559\u7684\u8d44\u6e90\u8fdb\u884c\u91ca\u653e\u3002</li> </ol> <p>TCC\u6709\u4e09\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u7a7a\u56de\u6eda\uff1aTry\u8fd8\u6ca1\u6267\u884c\u5374\u6267\u884c\u4e86Cancel\u3002</li> <li>\u60ac\u6302\uff1aCancel\u90fd\u6267\u884c\u4e86\u5374\u53c8\u6267\u884c\u4e86\u8fdf\u5230\u7684Try\u3002</li> <li>\u5e42\u7b49\uff1aTry\u3001Confirm\u3001Cancel\u4e09\u4e2a\u9636\u6bb5\u90fd\u6709\u53ef\u80fd\u91cd\u590d\u6267\u884c\u3002</li> </ol> <p>\u89e3\u51b3\u8fd9\u4e09\u4e2a\u95ee\u9898\u7684\u5171\u540c\u601d\u60f3\u662f\uff0c\u4e09\u4e2a\u65b9\u6cd5\u90fd\u4f5c\u4e3a\u672c\u5730\u4e8b\u52a1\u65b9\u6cd5\uff0c\u5728\u4e8b\u52a1\u5373\u5c06\u7ed3\u675f\u7684\u65f6\u5019\u5411\u6570\u636e\u5e93\u65e5\u5fd7\u8868\u4e2d\u63d2\u5165\u4e00\u6761\u6570\u636e\u8868\u793a\u672c\u65b9\u6cd5\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\uff0c\u5728\u4e8b\u52a1\u5f00\u59cb\u7684\u65f6\u5019\u9996\u5148\u68c0\u67e5\u65b9\u6cd5\u6709\u6ca1\u6709\u6267\u884c\u8fc7\u3002</p> <ol> <li>\u9488\u5bf9\u7a7a\u56de\u6eda\u95ee\u9898\uff1aCancel\u65b9\u6cd5\u5f00\u59cb\u65f6\u68c0\u67e5Try\u65b9\u6cd5\u6709\u6ca1\u6709\u6267\u884c\u8fc7\uff0c\u5982\u679c\u6570\u636e\u5e93\u4e2d\u5b58\u5728\u76f8\u540cXID\u7684Try\u65b9\u6cd5\u65e5\u5fd7\uff0c\u5c31\u8868\u793a\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\uff0c\u6b64\u65f6Cancel\u65b9\u6cd5\u76f4\u63a5\u8fd4\u56de\uff0c\u4ece\u800c\u907f\u514d\u7a7a\u56de\u6eda\u3002</li> <li>\u9488\u5bf9\u60ac\u6302\u95ee\u9898\uff1aTry\u65b9\u6cd5\u5f00\u59cb\u65f6\u68c0\u67e5Cancel\u65b9\u6cd5\u6709\u6ca1\u6709\u6267\u884c\u8fc7\uff0c\u5982\u679c\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u907f\u514dTry\u9501\u5b9a\u7684\u8d44\u6e90\u6c38\u5f97\u4e0d\u5230\u91ca\u653e\uff0c\u4e5f\u5373\u60ac\u6302\u3002</li> <li>\u9488\u5bf9\u5e42\u7b49\u95ee\u9898\uff1aTry\u3001Confirm\u3001Cancel\u4e09\u4e2a\u65b9\u6cd5\u5728\u5f00\u59cb\u65f6\u68c0\u67e5\u81ea\u5df1\u6709\u6ca1\u6709\u6267\u884c\u8fc7\uff0c\u5982\u679c\u6267\u884c\u8fc7\u5c31\u76f4\u63a5\u8fd4\u56de\uff0c\u4ece\u800c\u5b9e\u73b0\u5e42\u7b49\u3002</li> </ol> <p>Seata\u7684TCC\u6a21\u5f0f\uff1a 1\u3001\u5168\u5c40\u4e8b\u52a1\u52a0@GlobalTransactional Text Only<pre><code>@GlobalTransactional\npublic String doTransactionCommit() {\n\u00a0\u00a0\u00a0\u00a0//\u7b2c\u4e00\u4e2aTCC \u4e8b\u52a1\u53c2\u4e0e\u8005\n\u00a0\u00a0\u00a0\u00a0boolean result = tccActionOne.prepare(null, 1);\n\u00a0\u00a0\u00a0\u00a0if (!result) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"TccActionOne failed.\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0List&lt;String&gt; list = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0list.add(\"c1\");\n\u00a0\u00a0\u00a0\u00a0list.add(\"c2\");\n\u00a0\u00a0\u00a0\u00a0result = tccActionTwo.prepare(null, \"two\", list);\n\u00a0\u00a0\u00a0\u00a0if (!result) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"TccActionTwo failed.\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return RootContext.getXID();\n}\n</code></pre> 2\u3001\u5206\u652f\u4e8b\u52a1\u4f7f\u7528@TwoPhaseBusinessAction\uff0cTccActionOne\u662f\u81ea\u5b9a\u4e49\u7684\u63a5\u53e3\uff0c\u4e0d\u662fSeata\u00a0TCC\u6a21\u5f0f\u6240\u5fc5\u987b\u7684 Text Only<pre><code>public class TccActionOneImpl implements TccActionOne {\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0@TwoPhaseBusinessAction(name = \"DubboTccActionOne\", commitMethod = \"commit\", rollbackMethod = \"rollback\")\n\u00a0\u00a0\u00a0\u00a0public boolean prepare(BusinessActionContext actionContext,@BusinessActionContextParameter(paramName = \"a\") int a) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String xid = actionContext.getXid();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"TccActionOne prepare, xid:\" + xid + \", a:\" + a);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0public boolean commit(BusinessActionContext actionContext) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String xid = actionContext.getXid();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Assert.isTrue(actionContext.getActionContext(\"a\") != null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"TccActionOne commit, xid:\" + xid + \", a:\" + actionContext.getActionContext(\"a\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ResultHolder.setActionOneResult(xid, \"T\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0public boolean rollback(BusinessActionContext actionContext) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String xid = actionContext.getXid();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Assert.isTrue(actionContext.getActionContext(\"a\") != null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"TccActionOne rollback, xid:\" + xid + \", a:\" + actionContext.getActionContext(\"a\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ResultHolder.setActionOneResult(xid, \"R\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u9488\u5bf9\u7a7a\u56de\u6eda\u3001\u60ac\u6302\u3001\u5e42\u7b49\u4e09\u4e2a\u95ee\u9898\uff0cSeata\u5df2\u7ecf\u81ea\u52a8\u89e3\u51b3\u4e86\u3002</p> <p>3\u3001AT\u6a21\u5f0f TCC\u7684\u8865\u507f\u4e8b\u52a1\u9700\u8981\u7528\u6237\u7f16\u5199\uff0cAT\u6a21\u5f0f\u5219\u662f\u81ea\u52a8\u751f\u6210\u56de\u6edaSQL\uff0c\u4e0d\u8fc7\u81ea\u52a8\u751f\u6210\u4e5f\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff0c\u5e76\u4e0d\u662f\u6240\u6709DML\u8bed\u53e5\u90fd\u53ef\u4ee5\u751f\u6210\u76f8\u5e94\u7684\u56de\u6edaSQL\u3002AT\u6a21\u5f0f\u662fSeata\u4e3b\u63a8\u7684\u65b9\u5f0f\u3002 AT\u6a21\u5f0f\u751f\u6210\u7684\u56de\u6edaSQL\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u9700\u8981\u7528\u6237\u81ea\u5df1\u521b\u5efa\uff1a \u56de\u6eda\u65e5\u5fd7\u8868 Text Only<pre><code>-- \u6ce8\u610f\u6b64\u59040.7.0+ \u589e\u52a0\u5b57\u6bb5 context\nCREATE TABLE `undo_log` (\n\u00a0\u00a0`id` bigint(20) NOT NULL AUTO_INCREMENT,\n\u00a0\u00a0`branch_id` bigint(20) NOT NULL,\n\u00a0\u00a0`xid` varchar(100) NOT NULL,\n\u00a0\u00a0`context` varchar(128) NOT NULL,\n\u00a0\u00a0`rollback_info` longblob NOT NULL,\n\u00a0\u00a0`log_status` int(11) NOT NULL,\n\u00a0\u00a0`log_created` datetime NOT NULL,\n\u00a0\u00a0`log_modified` datetime NOT NULL,\n\u00a0\u00a0PRIMARY KEY (`id`),\n\u00a0\u00a0UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\n</code></pre> AT\u6a21\u5f0f\u548cTCC\u4e00\u6837\uff0c\u4e5f\u662fTry-Cancel-Confirm\uff1a</p> <ul> <li>\u4e00\u9636\u6bb5\uff1a\u5c06\u4e1a\u52a1\u6570\u636e\u7684\u4fee\u6539\u548c\u751f\u6210\u7684 UNDO LOG\u00a0\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u3002</li> <li>\u4e8c\u9636\u6bb5-\u56de\u6eda\uff1a1.\u6536\u5230 TC \u7684\u5206\u652f\u56de\u6eda\u8bf7\u6c42\uff0c\u5f00\u542f\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\uff0c2.\u901a\u8fc7 XID \u548c Branch ID \u67e5\u627e\u5230\u76f8\u5e94\u7684 UNDO LOG \u8bb0\u5f55\uff0c\u6267\u884c\u56de\u6edaSQL\u548c\u5220\u9664 UNDO LOG \u8bb0\u5f55\uff0c\u63d0\u4ea4\u672c\u5730\u4e8b\u52a1\uff0c3.\u5e76\u628a\u672c\u5730\u4e8b\u52a1\u7684\u6267\u884c\u7ed3\u679c\uff08\u5373\u5206\u652f\u4e8b\u52a1\u56de\u6eda\u7684\u7ed3\u679c\uff09\u4e0a\u62a5\u7ed9 TC\u3002</li> <li>\u4e8c\u9636\u6bb5-\u63d0\u4ea4\uff1a1. \u6536\u5230 TC \u7684\u5206\u652f\u63d0\u4ea4\u8bf7\u6c42\uff0c\u628a\u8bf7\u6c42\u653e\u5165\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\u7684\u961f\u5217\u4e2d\uff0c\u9a6c\u4e0a\u8fd4\u56de\u63d0\u4ea4\u6210\u529f\u7684\u7ed3\u679c\u7ed9 TC\u30022. \u5f02\u6b65\u4efb\u52a1\u6279\u91cf\u5730\u5220\u9664\u76f8\u5e94 UNDO LOG \u8bb0\u5f55\u3002</li> </ul> <p>XA \u6a21\u5f0f\u4f7f\u7528\u8d77\u6765\u4e0e AT \u6a21\u5f0f\u57fa\u672c\u4e00\u81f4\uff0c\u4f7f\u7528SpringBoot\u7684\u8bdd\u628a\u542f\u52a8\u7c7b\u4e0a\u7684@EnableAutoDataSourceProxy(dataSourceProxyMode = \"XA\")\u6539\u6210\"AT\"\u6216\u8005\u4e0d\u5199\u5c31\u884c\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u503c\u5c31\u662fAT\u3002 \u4f7f\u7528\u5b98\u7f51\u6700\u666e\u901a\u7684AT\u793a\u4f8b\uff08at-api\u6a21\u5757\uff09\u505a\u5982\u4e0b\u5b9e\u9a8c\uff0c\u5728\u5168\u5c40\u4e8b\u52a1\u4e2d\u95f4\u6253\u65ad\u70b9\uff0c\u00a0\u4f7f\u5176\u53ea\u6267\u884c\u4e00\u4e2a\u5206\u652f\u4e8b\u52a1\uff0c  \u7136\u540e\u76f4\u63a5\u505c\u6b62\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u65f6\u5019Seata\u7684\u63a7\u5236\u53f0\u4f1a\u4e00\u76f4\u5faa\u73af\u6253\u5370error\u65e5\u5fd7\uff0c\u63d0\u793a\u91cd\u8bd5\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u5931\u8d25 Text Only<pre><code>19:55:45.261 ERROR --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [server.coordinator.DefaultCore] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0error]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : Rollback branch transaction exception, xid = 10.55.120.139:8091:588106398957589 ,branchId = 588106398957590 ,retrying=true ,exception = rm client is not connected. dbkey:jdbc:mysql://127.0.0.1:3306/seata,clientId:api:127.0.0.1:14805, global rollback failed\n19:55:45.262 ERROR --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [coordinator.DefaultCoordinator] [leRetryRollbacking$2]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : Failed to retry rollbacking [10.55.120.139:8091:588106398957589] Unknown java.lang.RuntimeException: rm client is not connected. dbkey:jdbc:mysql://127.0.0.1:3306/seata,clientId:api:127.0.0.1:14805\n19:55:46.261\u00a0\u00a0INFO --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [.core.rpc.netty.ChannelManager] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0getChannel]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : No channel is available for resource[jdbc:mysql://127.0.0.1:3306/seata] as alternative of api:127.0.0.1:14805\n19:55:46.261 ERROR --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [server.coordinator.DefaultCore] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0error]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : Rollback branch transaction exception, xid = 10.55.120.139:8091:588106398957589 ,branchId = 588106398957590 ,retrying=true ,exception = rm client is not connected. dbkey:jdbc:mysql://127.0.0.1:3306/seata,clientId:api:127.0.0.1:14805, global rollback failed\n19:55:46.262 ERROR --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [coordinator.DefaultCoordinator] [leRetryRollbacking$2]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : Failed to retry rollbacking [10.55.120.139:8091:588106398957589] Unknown java.lang.RuntimeException: rm client is not connected. dbkey:jdbc:mysql://127.0.0.1:3306/seata,clientId:api:127.0.0.1:14805\n19:55:47.261\u00a0\u00a0INFO --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [.core.rpc.netty.ChannelManager] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0getChannel]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : No channel is available for resource[jdbc:mysql://127.0.0.1:3306/seata] as alternative of api:127.0.0.1:14805\n19:55:47.261 ERROR --- [\u00a0\u00a0\u00a0\u00a0\u00a0RetryRollbacking_1_1] [server.coordinator.DefaultCore] [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0error]\u00a0\u00a0[10.55.120.139:8091:588106398957589] : Rollback branch transaction exception, xid = 10.55.120.139:8091:588106398957589 ,branchId = 588106398957590 ,retrying=true ,exception = rm client is not connected. dbkey:jdbc:mysql://127.0.0.1:3306/seata,clientId:api:127.0.0.1:14805, global rollback failed\n</code></pre> \u8fd9\u4e2a\u65f6\u5019\u6570\u636e\u5e93\u5904\u4e8e\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\uff1a\u5e93\u5b58\u5df2\u7ecf\u6263\u9664\uff0cUNDO LOG\u8868\u4fdd\u5b58\u7740\u5e93\u5b58\u6263\u9664\u7684\u56de\u6edaSQL\uff0c\u8ba2\u5355\u8868\u6ca1\u6709\u65b0\u589e\u8bb0\u5f55\u3002\u6b64\u65f6\u518d\u6b21\u91cd\u542f\u7a0b\u5e8f\uff08\u6ce8\u610f\u6ce8\u91ca\u6389\u91cd\u7f6e\u6570\u636e\u7684\u4ee3\u7801\uff09\uff0c\u8fd9\u65f6TM\u548cRM\u91cd\u65b0\u5411TC\u6ce8\u518c\uff0c\u7136\u540e\u5f00\u59cb\u9a71\u52a8\u4e8b\u52a1\u7684\u56de\u6eda\uff0c\u4ece\u800c\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u5f97\u4ee5\u5b9e\u73b0\u3002\u8fd9\u4e2a\u5c0f\u5b9e\u9a8c\u8bf4\u660e\u4e86\u9664\u975e\u534f\u8c03\u8005\u628a\u201c\u63d0\u4ea4\u201d\u7684\u51b3\u5b9a\u5199\u5230\u78c1\u76d8\uff0c\u5176\u4ed6\u60c5\u51b5\u53d1\u751f\u610f\u5916\u4e00\u5f8b\u56de\u6eda\u4e8b\u52a1\u3002</p> <p>4\u3001\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027 \u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\u662f\u591a\u4e2a\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7\u6d88\u606f\u961f\u5217\u4f20\u9012\u8fdc\u7a0b\u8c03\u7528\u7684\u6d88\u606f\uff0c\u8fd9\u79cd\u65b9\u6848\u80fd\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u6838\u5fc3\u539f\u7406\u662f\u6d88\u606f\u961f\u5217\u4e3a\u670d\u52a1\u8c03\u7528\u63d0\u4f9b\u4e86\u4e00\u79cd\u53ef\u9760\u7684\u901a\u4fe1\u65b9\u5f0f\uff08\u4fdd\u8bc1\u8fdc\u7a0b\u8c03\u7528\u4e00\u5b9a\u80fd\u4f20\u9012\u5230\uff09\uff0c\u800c\u8fd9\u79cd\u53ef\u9760\u901a\u4fe1\u7684\u5b9e\u73b0\u539f\u7406\u5176\u5b9e\u662f\u6d88\u606f\u961f\u5217\u5229\u75282pc\u534f\u8bae\u5b8c\u6210\u4e86\u751f\u4ea7\u8005\u548c\u6d88\u606f\u961f\u5217\u4e4b\u95f4 \u4ee5\u53ca\u00a0\u6d88\u8d39\u8005\u548c\u6d88\u606f\u961f\u5217\u00a0\u4e4b\u95f4\u00a0\u7684\u539f\u5b50\u6027\u3002 \u53ef\u80fd\u6709\u4e9b\u6d88\u606f\u961f\u5217\u65e2\u5b9e\u73b0\u4e86XA\u534f\u8bae\u53c8\u5b9e\u73b0\u4e86\u534f\u8c03\u8005\u7684\u529f\u80fd\uff0c\u5982\u679c\u6ca1\u6709\u5b9e\u73b0\u534f\u8c03\u8005\u529f\u80fd\uff0c\u4e5f\u53ef\u4ee5\u501f\u52a9Seata\u5b8c\u6210\u3002</p> <p>5\u3001\u6700\u5927\u52aa\u529b\u901a\u77e5 \u6700\u5927\u52aa\u529b\u901a\u77e5\u7684\u4f8b\u5b50\uff1a\u4e8b\u52a1A\u6267\u884c\u5b8c\u4e4b\u540e\u901a\u77e5\u4e8b\u52a1B\u6267\u884c\uff0c\u4e8b\u52a1B\u6700\u597d\u80fd\u6267\u884c\u6210\u529f\uff0c\u5373\u4f7f\u5931\u8d25\u4e86\u4e5f\u4e0d\u8981\u7d27\uff0c\u4e8b\u52a1A\u4e5f\u4e0d\u5fc5\u56de\u6eda\u3002\u6240\u4ee5\u6211\u611f\u89c9\u6700\u5927\u52aa\u529b\u901a\u77e5\u8fd9\u79cd\u65b9\u6848\u5e94\u8be5\u4e0d\u80fd\u7b97\u4f5c\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u6848\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/1-%E7%90%86%E8%A7%A3SpringMVC/","title":"1-\u7406\u89e3SpringMVC","text":"<p> \u7ea6 1310 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 26 \u5206\u949f</p> <p>1\u3001\u7406\u89e3MVC MVC\u662f\u6784\u5efaWeb\u5e94\u7528\u7684\u4e00\u79cd\u8f6f\u4ef6\u67b6\u6784\uff0c\u662f\u4e00\u79cd\u601d\u60f3\uff0c\u8131\u79bb\u4e8e\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u5b83\u5c06\u8f6f\u4ef6\u6309\u7167Model\uff08\u6a21\u578b\uff09\u3001View\uff08\u89c6\u56fe\uff09\u3001Controller\uff08\u63a7\u5236\u5668\uff09\u6765\u5212\u5206\uff1a</p> <ul> <li>M\uff1aModel\uff0c\u6a21\u578b\u5c42\uff0c\u6307\u627f\u8f7d\u6570\u636e\u7684JavaBean\u3002</li> <li>V\uff1aView\uff0c\u89c6\u56fe\u5c42\uff0c\u6307html\u6216jsp\u7b49\u9875\u9762\uff0c\u4f5c\u7528\u662f\u4e0e\u7528\u6237\u4ea4\u4e92\uff0c\u52a8\u6001\u5730\u5c55\u793aModel\u4e2d\u7684\u6570\u636e\u3002</li> <li>C\uff1aController\uff0c\u63a7\u5236\u5c42\uff0c\u4f5c\u7528\u662f\u63a5\u6536\u8bf7\u6c42\u548c\u54cd\u5e94\u6d4f\u89c8\u5668\u3002</li> </ul> <p>\u7b80\u5355\u6765\u8bb2\uff0cMVC\u662f\u6307Controller\u5c06Model\u53d1\u9001\u7ed9View\u5c55\u793a\uff0c\u5177\u4f53\u5b9e\u65bd\u65f6\u6709\u7740\u4e0d\u540c\u7684\u5b9e\u73b0\u5f62\u5f0f\u3002 \u901a\u8fc7\u539f\u59cbServlet API\u6784\u5efaWeb\u5e94\u7528\u65f6\uff1a</p> <ul> <li>M\uff1a\u4ecd\u7136\u662f\u6307\u627f\u8f7d\u6570\u636e\u7684JavaBean\uff08\u6216\u8005\u8bf4\u662f\u5f80Request\u57df\u4e2d\u6dfb\u52a0\u7684\u6570\u636e\uff09\u3002</li> <li>V\uff1a\u662fjsp\u9875\u9762\uff0c\u4f5c\u7528\u662f\u52a8\u6001\u5730\u5c55\u793aModel\u4e2d\u7684\u6570\u636e\uff08\u901a\u8fc7\u8f6c\u53d1\u7684\u65b9\u5f0f\u5b9e\u73b0\uff09\u3002</li> <li>C\uff1a\u6307Servlet\u3002</li> </ul> <p>Controller\u901a\u8fc7\u8f6c\u53d1\u7684\u65b9\u5f0f\u5c06Model\u53d1\u9001\u7ed9View\uff0c\u4e3b\u8981\u662f\u5f80Request\u57df\u4e2d\u6dfb\u52a0\u6570\u636e\u3002 SpringMVC\u4e2d\u7684MVC\u4e5f\u662f\u540c\u6837\u7684\u610f\u601d\uff0c\u53ea\u4e0d\u8fc7\u5728\u5177\u4f53\u7684\u5b9e\u73b0\u5f62\u5f0f\u4e0e\u539f\u59cb\u7684Servlet\u6709\u4e86\u4e9b\u8bb8\u7684\u533a\u522b\uff1a</p> <ul> <li>M\uff1a\u6307ModelAndView\u4e2d\u7684Model\uff0c\u540c\u6837\u662f\u627f\u8f7d\u6570\u636e\u7684JavaBean\uff0c\u5f80Model\u4e2d\u6dfb\u52a0\u6570\u636e\u5c31\u662f\u5728\u5f80Request\u57df\u4e2d\u6dfb\u52a0\u6570\u636e\u3002</li> <li>V\uff1a\u6307ModelAndView\u4e2d\u7684View\uff0cJSP\u9875\u9762\u6216\u8005Thymeleaf\u9875\u9762\uff0c\u4f5c\u7528\u662f\u52a8\u6001\u5730\u5c55\u793aModel\u4e2d\u7684\u6570\u636e\u3002</li> <li>C\uff1a\u6307Controller\u3002</li> </ul> <p>Controller\u540c\u6837\u662f\u901a\u8fc7\u8f6c\u53d1\u5c06Model\u9001\u7ed9View\u3002 \u76f8\u6bd4\u4e8e\u4f7f\u7528\u539f\u59cb\u7684Servlet API\uff0c\u5229\u7528SpringMVC\u6784\u5efaWeb\u5e94\u7528\u66f4\u52a0\u65b9\u4fbf\u5feb\u6377\uff0c\u4f46\u4ed6\u4eec\u90fd\u662f\u5b9e\u73b0MVC\u7684\u4f20\u7edf\u67b6\u6784\uff0c\u5728\u524d\u540e\u7aef\u5206\u79bb\u67b6\u6784\u7684\u80cc\u666f\u4e0bMVC\u6709\u4e86\u65b0\u7684\u5f62\u5f0f\uff1a</p> <ul> <li>M\uff1a\u4ecd\u7136\u662f\u6307\u627f\u8f7d\u6570\u636e\u7684JavaBean\uff0c\u4f46\u4e0d\u662f\u5c06\u6570\u636e\u6dfb\u52a0\u5230Request\u57df\u8f6c\u53d1\u7ed9View\uff0c\u800c\u662f\u5c06JavaBean\u5e8f\u5217\u5316\u6210JSON\u683c\u5f0f\u5199\u5230Response\u7ed9View\u5c55\u793a\u3002</li> <li>V\uff1aMVC\u4f20\u7edf\u67b6\u6784\u4e0b\uff0cView\u5728\u540e\u7aef\u670d\u52a1\u5668\u901a\u8fc7Java\u7b49\u540e\u7aef\u7f16\u7a0b\u8bed\u8a00\u52a8\u6001\u751f\u6210\uff0c\u7136\u540e\u5199\u5230Response\uff0c\u800c\u5728\u524d\u540e\u7aef\u5206\u79bb\u67b6\u6784\u4e2d\uff0cView\u7531\u524d\u7aef\u670d\u52a1\u5668\u901a\u8fc7JavaScript\u8bed\u8a00\u52a8\u6001\u751f\u6210\u54cd\u5e94\u7ed9\u6d4f\u89c8\u5668\u3002</li> <li>C\uff1a\u4ecd\u7136\u662fSpringMVC\u4e2dController\u3002</li> </ul> <p>Controller\u5c06Model\u5e8f\u5217\u5316\u6210JSON\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u901a\u8fc7HttpResponse\u53d1\u9001\u7ed9View\u3002</p> <p>2\u3001\u5229\u7528SpringMVC\u6784\u5efaWeb\u5de5\u7a0b 2.1 \u5f15\u5165\u4f9d\u8d56</p> <ul> <li>SpringMVC\u57fa\u4e8eSpring\uff0c\u5f15\u5165spring-webmvc\u5de5\u4ef6\u4e4b\u540e\u4f1a\u5f15\u5165Spring\u7684\u4f9d\u8d56\u3002</li> <li>SpringMVC\u53ea\u662f\u5728Servlet\u57fa\u7840\u4e4b\u4e0a\u505a\u4e86\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u5f15\u5165Servlet API\u3002</li> <li>thymeleaf\u6a21\u7248\u5f15\u64ce\u4e0d\u5728spring-webmvc\u91cc\uff0c\u9700\u8981\u53e6\u5916\u5f15\u5165\uff08SpringMVC\u53ea\u662f\u4fdd\u7559\u4e86\u6a21\u7248\u5f15\u64ce\u7684\u8c03\u7528\uff0c\u5e76\u6ca1\u6709\u5f3a\u884c\u7ed1\u5b9a\u4efb\u4f55\u4e00\u79cd\u6a21\u677f\u5f15\u64ce\u7684\u5b9e\u73b0\uff0c\u6240\u4ee5\u9700\u8981\u53e6\u5916\u5f15\u5165\uff0c\u6b64\u5916\u524d\u540e\u7aef\u5206\u79bb\u9879\u76ee\u5e76\u4e0d\u9700\u8981\u6a21\u7248\u5f15\u64ce\u8fd9\u4e2a\u529f\u80fd\uff09\u3002</li> </ul> Text Only<pre><code>&lt;dependencies&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- SpringMVC --&gt;\n\u00a0\u00a0 \u00a0&lt;!-- `SpringMVC\u57fa\u4e8eSpring\uff0c\u5f15\u5165spring-webmvc\u5de5\u4ef6\u4e4b\u540e\u81ea\u7136\u4f1a\u5f15\u5165Spring\u7684\u4f9d\u8d56\u3002`--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;5.3.1&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- ServletAPI --&gt;\n\u00a0\u00a0 \u00a0&lt;!-- SpringMVC\u53ea\u662f\u5728Servlet\u57fa\u7840\u4e4b\u4e0a\u505a\u4e86\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u5f15\u5165Servlet API\u3002--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.1.0&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;scope&gt;provided&lt;/scope&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- Spring5\u548cThymeleaf\u6574\u5408\u5305 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;thymeleaf-spring5&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.12.RELEASE&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> <p>2.2\u00a0\u914d\u7f6eWeb\u5de5\u7a0b SpringMVC\u5e76\u4e0d\u662fWeb\u5bb9\u5668\uff0c\u5b83\u4e5f\u6ca1\u6709\u50cf\u540e\u6765\u7684SpringBoot\u90a3\u6837\u76f4\u63a5\u96c6\u6210\u4e00\u4e2aWeb\u5bb9\u5668\uff0c\u6240\u4ee5\u5229\u7528SpringMVC\u6784\u5efaWeb\u5de5\u7a0b\u8fd8\u9700\u8981\u50cf\u4f20\u7edf\u7684Web\u9879\u76ee\u90a3\u6837\u914d\u7f6e\u597dWeb\u5bb9\u5668\u3002 </p> <p>2.3\u00a0\u914d\u7f6eweb.xml SpringMVC\u5982\u4f55\u5728Servlet\u57fa\u7840\u7684\u5c01\u88c5\uff1f\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u628a\u5904\u7406\u8bf7\u6c42\u7684\u903b\u8f91\u5c01\u88c5\u5728\u4e86\u4e00\u4e2aServlet\u4e2d\uff0c\u5373DispatcherServlet\uff0c\u6240\u4ee5\u4f7f\u7528SpringMVC\u4e4b\u540e\u552f\u4e00\u9700\u8981\u5728web.xml\u91cc\u914d\u7f6e\u7684\u662f DispatcherServlet \u7684\u8bf7\u6c42\u8def\u5f84\u3002</p> <ul> <li>\u4e5f\u53ef\u4ee5\u5728web.xml\u4e2d\u914d\u7f6e\u5176\u4ed6\u7684Servlet\uff0c\u8fd9\u65f6DispatcherServlet\u548c\u5176\u4ed6\u7684Servlet\u662f\u5e76\u5217\u7684\u5173\u7cfb\uff0c\u5728Tomcat\u4e2d\u7684\u5730\u4f4d\u76f8\u540c\uff08\u6216\u8005\u8bf4\u90fd\u5728Tomcat\u7684Map\u4e2d\uff09\u3002</li> <li>DispatcherServlet\u5bf9\u8c61\u521d\u59cb\u5316\u65f6\u4f1a\u521d\u59cb\u5316IOC\u5bb9\u5668\uff0c\u6240\u4ee5\u9700\u8981\u6307\u5b9aSpring\u7684\u914d\u7f6e\u6587\u4ef6\uff0cSpring\u914d\u7f6e\u6587\u4ef6\u4e2d\u81f3\u5c11\u5e94\u8be5\u6307\u5b9a\u5305\u626b\u63cf\u7684\u8def\u5f84\uff0c\u8fd9\u6837\u624d\u80fd\u8ba9IOC\u5bb9\u5668\u987a\u5229\u521d\u59cb\u5316\u3002</li> </ul> Text Only<pre><code>&lt;!-- \u914d\u7f6e\u524d\u7aef\u63a7\u5236\u5668 --&gt;\n&lt;servlet&gt;\n\u00a0\u00a0&lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;\n\u00a0\u00a0&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n\u00a0\u00a0&lt;!--\n\u00a0\u00a01.\u6307\u5b9aspring\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff08ioc\u3001aop\u548cspringmvc\u6709\u5173\u7684\u914d\u7f6e\u4fe1\u606f\uff09\uff0c\n\u00a0\u00a0\u00a0\u00a0\u5982\u679c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u4f1a\u627e /WEB-INF/(&lt;servlet-name&gt;)-servlet.xml\n\u00a0\u00a0\u00a0\u00a0ioc\u5bb9\u5668\u7684\u521d\u59cb\u5316\u662f\u5728DispatcherServlet\u7684\u6784\u9020\u5668\u4e2d\u8c03\u7528\u7684\uff0cSpringMVC\u4e5d\u5927\u7ec4\u4ef6\u7684\u521d\u59cb\u5316\u90fd\u4f9d\u8d56ioc\u5bb9\u5668\n\u00a0\u00a0--&gt;\n\u00a0\u00a0&lt;init-param&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;\n\u00a0\u00a0&lt;/init-param&gt;\n\u00a0\u00a0&lt;!--\n\u00a0\u00a02.tomcat\u542f\u52a8\u65f6\u521b\u5efa\u8be5servlet\u5bf9\u8c61\uff0c\u503c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\n\u00a0\u00a0\u00a0\u00a0\u5982\u679c\u4e0d\u914d\u7f6e\uff0c\u5219\u4f1a\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8bf7\u6c42\u8def\u5f84\u65f6\u521b\u5efaservlet\uff0c\u4e25\u91cd\u5f71\u54cd\u7b2c\u4e00\u8bbf\u95ee\u7684\u901f\u5ea6\n\u00a0\u00a0--&gt;\n\u00a0\u00a0&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n&lt;/servlet&gt;\n&lt;servlet-mapping&gt;\n\u00a0\u00a0&lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;\n\u00a0\u00a0&lt;!--\n\u00a0 3.\u8bbe\u7f6e\u8bbf\u95ee DispatcherServlet\u00a0\u7684\u8bf7\u6c42\u8def\u5f84\n\u00a0\u00a0\u2460 / \u62e6\u622a\u9664 *.jsp \u4ee5\u5916\u7684\u6240\u6709\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662f\u5f53\u8bbf\u95ee\u5730\u5740\u662f\u4ee5.jsp\u7ed3\u5c3e\u65f6\uff0c\u4f1a\u7531tomcat\u76f4\u63a5\u8fd4\u56de\uff08\u5373\u7531tomcat\u9ed8\u8ba4\u7684JspServlet\u5904\u7406\u8fd4\u56de\uff09\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u800c\u5f53\u8bbf\u95ee\u5176\u5b83\u4e0d\u662f\u4ee5.jsp\u7ed3\u5c3e\u7684\u5730\u5740\u65f6\uff0ctomcat\u4f1a\u5c06\u8bf7\u6c42\u4ea4\u7ed9DispatcherServlet\n\u00a0\u00a0\u2461 /* \u62e6\u622a\u6240\u6709\u8bf7\u6c42\uff0c*.jsp\u7684\u8bf7\u6c42\u4e5f\u4f1a\u4ea4\u7ed9DispatcherServlet\u5904\u7406\n\u00a0\u00a0--&gt;\n\u00a0\u00a0&lt;url-pattern&gt;/&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;\n</code></pre> <p>2.4 SpringMVC\u914d\u7f6e\u6587\u4ef6 \u5728SpringMVC\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u8981\u626b\u63cf\u54ea\u4e9b\u5305\uff0c\u5e76\u5411IOC\u5bb9\u5668\u4e2d\u6ce8\u5165Thymeleaf\u89c6\u56fe\u89e3\u6790\u5668ThymeleafViewResolver\u3002 Text Only<pre><code>&lt;!-- \u81ea\u52a8\u626b\u63cf\u5305 --&gt;\n&lt;context:component-scan base-package=\"com.atguigu.mvc.controller\"/&gt;\n\n&lt;!-- \u914d\u7f6eThymeleaf\u89c6\u56fe\u89e3\u6790\u5668 --&gt;\n&lt;bean id=\"viewResolver\" class=\"org.thymeleaf.spring5.view.ThymeleafViewResolver\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"order\" value=\"1\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"characterEncoding\" value=\"UTF-8\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"templateEngine\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"org.thymeleaf.spring5.SpringTemplateEngine\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"templateResolver\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- \u89c6\u56fe\u524d\u7f00 --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"prefix\" value=\"/WEB-INF/templates/\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- \u89c6\u56fe\u540e\u7f00 --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"suffix\" value=\".html\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"templateMode\" value=\"HTML5\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"characterEncoding\" value=\"UTF-8\" /&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n&lt;/bean&gt;\n\n&lt;!--\n\u00a0 \u00a0 DispatcherServlet\u65e0\u6cd5\u5904\u7406\u7684\u8d44\u6e90\u4ea4\u7ed9Tomcat\u9ed8\u8ba4\u7684Servlet\u5904\u7406\uff0c\u6bd4\u5982\u5904\u7406\u9759\u6001\u8d44\u6e90\uff1ahtml\u3001js\u3001css\u3001jpg\uff08\u4e0d\u80fd\u653e\u5728/WEB-INF\uff09\u3002\n\u00a0 \u00a0 \u82e5\u53ea\u8bbe\u7f6e\u8be5\u6807\u7b7e\uff0c\u5219\u53ea\u80fd\u8bbf\u95ee\u9759\u6001\u8d44\u6e90\uff0c\u5176\u4ed6\u8bf7\u6c42\u5219\u65e0\u6cd5\u8bbf\u95ee\uff0c\u5fc5\u987b\u540c\u65f6\u8bbe\u7f6e&lt;mvc:annotation-driven/&gt;\u89e3\u51b3\u95ee\u9898\u3002\n--&gt;\n&lt;mvc:default-servlet-handler/&gt;\n</code></pre> /WEB-INF\u4e0b\u7684\u6587\u4ef6\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u4f46\u662f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u7aef\u88ab\u8bbf\u95ee\u3002\u6bd4\u5982\u91cd\u5b9a\u5411\u65e0\u6cd5\u8bbf\u95ee\u5230/WEB-INF\uff0c\u4f46\u662f\u8f6c\u53d1\u53ef\u4ee5\u8bbf\u95ee\u5230\u3002</p> <p>2.5 \u521b\u5efaController</p> <ul> <li>@Controller\u6ce8\u89e3\uff1a\u6807\u8bc6\u7c7b\u4e3a\u4e00\u4e2a\u63a7\u5236\u5c42\u7ec4\u4ef6\u3002</li> <li>@RequestMapping\u6ce8\u89e3\uff1a\u5904\u7406\u8bf7\u6c42\u548c\u63a7\u5236\u5668\u65b9\u6cd5\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002</li> </ul> <p>\u6d4f\u89c8\u5668\u8bf7\u6c42 localhost:8080/\u9879\u76ee\u540d/\u00a0\u4f1a\u8df3\u8f6c\u5230 index.html\u00a0\u9875\u9762\u3002 Text Only<pre><code>@Controller\npublic class HelloController {\n\u00a0\u00a0\u00a0\u00a0/*\n\u00a0\u00a0\u00a0\u00a0\u00a0*\u00a0\u00a0@RequestMapping\u6ce8\u89e3\uff1a\u5904\u7406\u8bf7\u6c42\u548c\u63a7\u5236\u5668\u65b9\u6cd5\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\n\u00a0\u00a0\u00a0\u00a0\u00a0*\u00a0\u00a0@RequestMapping\u6ce8\u89e3\u7684value\u5c5e\u6027\u7528\u4e8e\u914d\u7f6e\u8bf7\u6c42\u5730\u5740\uff0c/ \u8868\u793a\u7684\u5f53\u524d\u5de5\u7a0b\u7684\u4e0a\u4e0b\u6587\u8def\u5f84\uff0c\u5373 localhost:8080/\u9879\u76ee\u540d/\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@RequestMapping(\"/\")\n\u00a0\u00a0\u00a0\u00a0public String index() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u89c6\u56fe\u540d\u79f0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"index\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.6\u00a0\u8fd0\u884c\u6d41\u7a0b\u603b\u7ed3</p> <ol> <li>\u5728\u542f\u52a8Tomcat\u7684\u65f6\u5019\u4f1a\u521d\u59cb\u5316DispatcherServlet\uff0c\u5728DispatcherServlet\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u4e2d\u4f1a\u6839\u636eSpring\u7684\u914d\u7f6e\u6587\u4ef6\u521d\u59cb\u5316IOC\u5bb9\u5668\uff0c\u63a5\u7740\u8fd8\u4f1a\u5c06@RequestMapping\u6ce8\u89e3\u7684value\u5c5e\u6027\u503c\u4e0e\u65b9\u6cd5\u653e\u5230Map\u4e2d\u3002</li> <li>\u5f53Tomcat\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5c31\u4f1a\u627e\u5230DispatcherServlet\uff0c\u7136\u540e\u901a\u8fc7Map\u627e\u5230\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u4e4b\u540e\u8c03\u7528\u65b9\u6cd5\u62ff\u5230\u8fd4\u56de\u503c\uff0c\u4e5f\u5c31\u662f\u89c6\u56fe\u540d\u79f0\uff0c\u4e4b\u540e\u89c6\u56fe\u540d\u79f0\u4f1a\u88ab\u89c6\u56fe\u89e3\u6790\u5668\u89e3\u6790\uff0c\u89e3\u6790\u7684\u8fc7\u7a0b\u662f\uff0c\u89c6\u56fe\u540d\u79f0\u52a0\u4e0a\u524d\u7f00\u548c\u540e\u7f00\u7ec4\u6210\u89c6\u56fe\u7684\u8def\u5f84\uff0c\u901a\u8fc7\u8be5\u8def\u5f84\u627e\u5230\u6587\u4ef6\uff0c\u7136\u540e\u50cf\u6a21\u677f\u5f15\u64ce\u4f1a\u50cfTomcat\u89e3\u6790JSP\u9875\u9762\u90a3\u6837\u89e3\u6790\u9875\u9762\uff0c\u6700\u540e\u5c06\u89e3\u6790\u597d\u4e86\u7684\u9875\u9762\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\u5c55\u793a\u3002</li> </ol>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/10-%E5%85%A8%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AESpringMVC/","title":"10-\u5168\u6ce8\u89e3\u914d\u7f6eSpringMVC","text":"<p> \u7ea6 576 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u4f7f\u7528\u914d\u7f6e\u7c7b\u548c\u6ce8\u89e3\u4ee3\u66ffweb.xml\u548cSpringMVC\u914d\u7f6e\u6587\u4ef6\u7684\u529f\u80fd\u3002 1\u3001\u521b\u5efa\u521d\u59cb\u5316\u7c7b\uff0c\u4ee3\u66ffweb.xml \u5728Servlet3.0\u73af\u5883\u4e2d\uff0c\u5bb9\u5668\u4f1a\u5728\u7c7b\u8def\u5f84\u4e2d\u67e5\u627e\u5b9e\u73b0javax.servlet.ServletContainerInitializer\u63a5\u53e3\u7684\u7c7b\uff0c\u5982\u679c\u627e\u5230\u7684\u8bdd\u5c31\u7528\u5b83\u6765\u914d\u7f6eServlet\u5bb9\u5668\u3002 Spring\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u540d\u4e3aSpringServletContainerInitializer\uff0c\u8fd9\u4e2a\u7c7b\u53cd\u8fc7\u6765\u53c8\u4f1a\u67e5\u627e\u5b9e\u73b0WebApplicationInitializer\u7684\u7c7b\u5e76\u5c06\u914d\u7f6e\u7684\u4efb\u52a1\u4ea4\u7ed9\u5b83\u4eec\u6765\u5b8c\u6210\u3002Spring3.2\u5f15\u5165\u4e86\u4e00\u4e2a\u4fbf\u5229\u7684WebApplicationInitializer\u57fa\u7840\u5b9e\u73b0\uff0c\u540d\u4e3aAbstractAnnotationConfigDispatcherServletInitializer\uff0c\u5f53\u6211\u4eec\u7684\u7c7b\u6269\u5c55\u4e86AbstractAnnotationConfigDispatcherServletInitializer\u5e76\u5c06\u5176\u90e8\u7f72\u5230Servlet3.0\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u5bb9\u5668\u4f1a\u81ea\u52a8\u53d1\u73b0\u5b83\uff0c\u5e76\u7528\u5b83\u6765\u914d\u7f6eServlet\u4e0a\u4e0b\u6587\u3002 Text Only<pre><code>public class WebInit extends AbstractAnnotationConfigDispatcherServletInitializer {\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u6307\u5b9aspring\u7684\u914d\u7f6e\u7c7b\n\u00a0 \u00a0 * @return\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0protected Class&lt;?&gt;[] getRootConfigClasses() {\n\u00a0 \u00a0 \u00a0 \u00a0return new Class[]{SpringConfig.class};\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u6307\u5b9aSpringMVC\u7684\u914d\u7f6e\u7c7b\n\u00a0 \u00a0 * @return\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0protected Class&lt;?&gt;[] getServletConfigClasses() {\n\u00a0 \u00a0 \u00a0 \u00a0return new Class[]{WebConfig.class};\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u6307\u5b9aDispatcherServlet\u7684\u6620\u5c04\u89c4\u5219\uff0c\u5373url-pattern\n\u00a0 \u00a0 * @return\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0protected String[] getServletMappings() {\n\u00a0 \u00a0 \u00a0 \u00a0return new String[]{\"/\"};\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * \u6dfb\u52a0\u8fc7\u6ee4\u5668\n\u00a0 \u00a0 * @return\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0protected Filter[] getServletFilters() {\n\u00a0 \u00a0 \u00a0 \u00a0CharacterEncodingFilter encodingFilter = new CharacterEncodingFilter();\n\u00a0 \u00a0 \u00a0 \u00a0encodingFilter.setEncoding(\"UTF-8\");\n\u00a0 \u00a0 \u00a0 \u00a0encodingFilter.setForceRequestEncoding(true);\n\u00a0 \u00a0 \u00a0 \u00a0HiddenHttpMethodFilter hiddenHttpMethodFilter = new HiddenHttpMethodFilter();\n\u00a0 \u00a0 \u00a0 \u00a0return new Filter[]{encodingFilter, hiddenHttpMethodFilter};\n\u00a0 \u00a0}\n}\n</code></pre></p> <p>2\u3001\u521b\u5efaSpringConfig\u914d\u7f6e\u7c7b\uff0c\u4ee3\u66ffspring\u7684\u914d\u7f6e\u6587\u4ef6 Text Only<pre><code>@Configuration\npublic class SpringConfig {\n\u00a0\u00a0\u00a0\u00a0//spring\u7684\u914d\u7f6e\u4fe1\u606f\u5199\u5728\u6b64\u7c7b\u4e2d\n}\n</code></pre></p> <p>3\u3001\u521b\u5efaWebConfig\u914d\u7f6e\u7c7b\uff0c\u4ee3\u66ffSpringMVC\u7684\u914d\u7f6e\u6587\u4ef6 Text Only<pre><code>@Configuration\n//\u626b\u63cf\u7ec4\u4ef6\n@ComponentScan(\"com.atguigu.mvc.controller\")\n//\u5f00\u542fMVC\u6ce8\u89e3\u9a71\u52a8\n@EnableWebMvc\npublic class WebConfig implements WebMvcConfigurer {\n\n\u00a0\u00a0\u00a0\u00a0//\u4f7f\u7528\u9ed8\u8ba4\u7684servlet\u5904\u7406\u9759\u6001\u8d44\u6e90\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0configurer.enable();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u914d\u7f6e\u6587\u4ef6\u4e0a\u4f20\u89e3\u6790\u5668\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public CommonsMultipartResolver multipartResolver(){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new CommonsMultipartResolver();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u914d\u7f6e\u62e6\u622a\u5668\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void addInterceptors(InterceptorRegistry registry) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registry.addInterceptor(new CheckLoginInterceptor())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.addPathPatterns(\"/**\") //\u62e6\u622a\u6240\u6709\u8bf7\u6c42\uff0c\u8bbf\u95eestatic\u4e0b\u7684\u9759\u6001\u8d44\u6e90\u4e5f\u4f1a\u62e6\u622a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.excludePathPatterns(\"/\", \"/login\", \"/css/**\", \"/fonts/**\", \"/images/**\", \"/js/**\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u914d\u7f6e\u89c6\u56fe\u63a7\u5236\n\n\u00a0\u00a0\u00a0\u00a0/*@Override\n\u00a0\u00a0\u00a0\u00a0public void addViewControllers(ViewControllerRegistry registry) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registry.addViewController(\"/\").setViewName(\"index\");\n\u00a0\u00a0\u00a0\u00a0}*/\n\n\u00a0\u00a0\u00a0\u00a0//\u914d\u7f6e\u5f02\u5e38\u6620\u5c04\n\u00a0\u00a0\u00a0\u00a0/*@Override\n\u00a0\u00a0\u00a0\u00a0public void configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SimpleMappingExceptionResolver exceptionResolver = new SimpleMappingExceptionResolver();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties prop = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0prop.setProperty(\"java.lang.ArithmeticException\", \"error\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u5f02\u5e38\u6620\u5c04\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exceptionResolver.setExceptionMappings(prop);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u5171\u4eab\u5f02\u5e38\u4fe1\u606f\u7684\u952e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exceptionResolver.setExceptionAttribute(\"ex\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resolvers.add(exceptionResolver);\n\u00a0\u00a0\u00a0\u00a0}*/\n\n\u00a0\u00a0\u00a0\u00a0//\u914d\u7f6e\u751f\u6210\u6a21\u677f\u89e3\u6790\u5668\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public ITemplateResolver templateResolver() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0WebApplicationContext webApplicationContext = ContextLoader.getCurrentWebApplicationContext();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// ServletContextTemplateResolver\u9700\u8981\u4e00\u4e2aServletContext\u4f5c\u4e3a\u6784\u9020\u53c2\u6570\uff0c\u53ef\u901a\u8fc7WebApplicationContext \u7684\u65b9\u6cd5\u83b7\u5f97\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ServletContextTemplateResolver templateResolver = new ServletContextTemplateResolver(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0webApplicationContext.getServletContext());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0templateResolver.setPrefix(\"/WEB-INF/templates/\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0templateResolver.setSuffix(\".html\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0templateResolver.setCharacterEncoding(\"UTF-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0templateResolver.setTemplateMode(TemplateMode.HTML);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return templateResolver;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u751f\u6210\u6a21\u677f\u5f15\u64ce\u5e76\u4e3a\u6a21\u677f\u5f15\u64ce\u6ce8\u5165\u6a21\u677f\u89e3\u6790\u5668\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public SpringTemplateEngine templateEngine(ITemplateResolver templateResolver) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SpringTemplateEngine templateEngine = new SpringTemplateEngine();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0templateEngine.setTemplateResolver(templateResolver);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return templateEngine;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u751f\u6210\u89c6\u56fe\u89e3\u6790\u5668\u5e76\u4e3a\u89c6\u56fe\u89e3\u6790\u5668\u6ce8\u5165\u6a21\u677f\u5f15\u64ce\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public ViewResolver viewResolver(SpringTemplateEngine templateEngine) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ThymeleafViewResolver viewResolver = new ThymeleafViewResolver();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0viewResolver.setCharacterEncoding(\"UTF-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0viewResolver.setTemplateEngine(templateEngine);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return viewResolver;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/11-SpringMVC%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/","title":"11-SpringMVC\u7684\u6267\u884c\u6d41\u7a0b","text":"<p> \u7ea6 2028 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 41 \u5206\u949f</p> <p>\u4e00\u3001DispatcherServlet\u521d\u59cb\u5316\u6d41\u7a0b DispatcherServlet\u672c\u8eab\u5c31\u662f\u4e00\u4e2aServlet\uff0c\u9075\u5faaServlet\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u3002  HttpServletBean\u7684init()\u65b9\u6cd5 Text Only<pre><code>public final void init() throws ServletException {\n\u00a0 \u00a0// Set bean properties from init parameters.\n//\u521d\u59cb\u5316\u53c2\u6570\u6bd4\u5982SpringMVC\u7684\u914d\u7f6e\u6587\u4ef6contextConfigLocation\u53c2\u6570\u5728ServletConfig\u4e2d\n\u00a0 \u00a0PropertyValues pvs = new ServletConfigPropertyValues(`getServletConfig()`, this.requiredProperties);\n\u00a0 \u00a0if (!pvs.isEmpty()) {\n\u00a0 \u00a0 \u00a0 try {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(this);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0ResourceLoader resourceLoader = new ServletContextResourceLoader(getServletContext());\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0bw.registerCustomEditor(Resource.class, new ResourceEditor(resourceLoader, getEnvironment()));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0initBeanWrapper(bw);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0bw.setPropertyValues(pvs, true);\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 catch (BeansException ex) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (logger.isErrorEnabled()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 logger.error(\"Failed to set bean properties on servlet '\" + getServletName() + \"'\", ex);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0throw ex;\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0}\n\u00a0 \u00a0// Let subclasses do whatever initialization they like.\n\u00a0 \u00a0initServletBean();\n}\n</code></pre> FrameworkServlet\u7684initServletBean\u65b9\u6cd5 Text Only<pre><code>protected final void initServletBean() throws ServletException {\n\u00a0\u00a0\u00a0\u00a0getServletContext().log(\"Initializing Spring \" + getClass().getSimpleName() + \" '\" + getServletName() + \"'\");\n\u00a0\u00a0\u00a0\u00a0if (logger.isInfoEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.info(\"Initializing Servlet '\" + getServletName() + \"'\");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0long startTime = System.currentTimeMillis();\n\n\u00a0\u00a0\u00a0\u00a0try {\n`//\u521b\u5efaIOC\u5bb9\u5668`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`this.webApplicationContext = initWebApplicationContext();` \n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0initFrameworkServlet();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0catch (ServletException | RuntimeException ex) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.error(\"Context initialization failed\", ex);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw ex;\n\n\u00a0\u00a0\u00a0\u00a0if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String value = this.enableLoggingRequestDetails ?\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"shown which may lead to unsafe logging of potentially sensitive data\" :\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"masked to prevent unsafe logging of potentially sensitive data\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"enableLoggingRequestDetails='\" + this.enableLoggingRequestDetails +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"': request parameters and headers will be \" + value);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0if (logger.isInfoEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.info(\"Completed initialization in \" + (System.currentTimeMillis() - startTime) + \" ms\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> FrameworkServlet\u7684initWebApplicationContext\u65b9\u6cd5 Text Only<pre><code>protected WebApplicationContext initWebApplicationContext() {\n\u00a0\u00a0\u00a0\u00a0WebApplicationContext rootContext =\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0WebApplicationContextUtils.getWebApplicationContext(getServletContext());\n\u00a0\u00a0\u00a0\u00a0WebApplicationContext wac = null;\n\n\u00a0\u00a0\u00a0\u00a0if (this.webApplicationContext != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// A context instance was injected at construction time -&gt; use it\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wac = this.webApplicationContext;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (wac instanceof ConfigurableWebApplicationContext) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) wac;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!cwac.isActive()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// The context has not yet been refreshed -&gt; provide services such as\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// setting the parent context, setting the application context id, etc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (cwac.getParent() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// The context instance was injected without an explicit parent -&gt; set\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// the root application context (if any; may be null) as the parent\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cwac.setParent(rootContext);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0configureAndRefreshWebApplicationContext(cwac);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0if (wac == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// No context instance was injected at construction time -&gt; see if one\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// has been registered in the servlet context. If one exists, it is assumed\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// that the parent context (if any) has already been set and that the\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// user has performed any initialization such as setting the context id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wac = findWebApplicationContext();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0if (wac == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// No context instance is defined for this servlet -&gt; create a local one\n`//\u521b\u5efaIOC\u5bb9\u5668`\n\u00a0\u00a0\u00a0 `wac = createWebApplicationContext(rootContext);`\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0if (!this.refreshEventReceived) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Either the context is not a ConfigurableApplicationContext with refresh\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// support or the context injected at construction time had already been\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// refreshed -&gt; trigger initial onRefresh manually here.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (this.onRefreshMonitor) {\n`//\u7b49IOC\u5bb9\u5668\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\u5237\u65b0DispatcherServlet\u7684\u5b9e\u4f8b\u53d8\u91cf`\n `onRefresh(wac);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0if (this.publishContext) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Publish the context as a servlet context attribute.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String attrName = getServletContextAttributeName();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0getServletContext().setAttribute(attrName, wac);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0return wac;\n}\n</code></pre> FrameworkServlet\u7684createWebApplicationContext\u65b9\u6cd5 Text Only<pre><code>protected WebApplicationContext createWebApplicationContext(@Nullable ApplicationContext parent) {\n\u00a0\u00a0\u00a0\u00a0Class&lt;?&gt; contextClass = getContextClass();\n\u00a0\u00a0\u00a0\u00a0if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new ApplicationContextException(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"Fatal initialization error in servlet with name '\" + getServletName() +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"': custom WebApplicationContext class [\" + contextClass.getName() +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"] is not of type ConfigurableWebApplicationContext\");\n\u00a0\u00a0\u00a0\u00a0}\n`//\u5b9e\u4f8b\u5316IOC\u5bb9\u5668\uff0c\u5176\u4e2d\u7684Bean\u8fd8\u6ca1\u6709\u88ab\u521b\u5efa`\n `ConfigurableWebApplicationContext wac =`\n `(ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);`\n\n\u00a0\u00a0\u00a0\u00a0wac.setEnvironment(getEnvironment());\n`//\u4e0eSpring\u7684IOC\u5408\u5e76`\n `wac.setParent(parent);`\n`//SpringMVC\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e`\n `String configLocation = getContextConfigLocation();`\n\u00a0\u00a0\u00a0\u00a0if (configLocation != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wac.setConfigLocation(configLocation);\n\u00a0\u00a0\u00a0\u00a0}\n`//\u521b\u5efa\u5e76\u521d\u59cb\u5316Bean`\n `configureAndRefreshWebApplicationContext(wac);`\n\n\u00a0\u00a0\u00a0\u00a0return wac;\n}\n</code></pre> FrameworkServlet\u7684configureAndRefreshWebApplicationContext\u65b9\u6cd5 Text Only<pre><code>protected void configureAndRefreshWebApplicationContext(ConfigurableWebApplicationContext wac) {\n\u00a0\u00a0\u00a0\u00a0if (ObjectUtils.identityToString(wac).equals(wac.getId())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// The application context id is still set to its original default value\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// -&gt; assign a more useful id based on available information\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (this.contextId != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wac.setId(this.contextId);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Generate default id...\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0wac.setId(ConfigurableWebApplicationContext.APPLICATION_CONTEXT_ID_PREFIX +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ObjectUtils.getDisplayString(getServletContext().getContextPath()) + '/' + getServletName());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n`//\u5f80IOC\u5bb9\u5668\u91cc\u6dfb\u52a0ServletContext\u5bf9\u8c61\u3001ServletConfig\u5bf9\u8c61\u7b49\uff0c\u8fd9\u5c31\u662fWeb\u7684IOC\u5bb9\u5668\u4e0eSpring\u7684IOC\u5bb9\u5668\u6700\u5927\u533a\u522b`\n `wac.setServletContext(getServletContext());`\n `wac.setServletConfig(getServletConfig());`\n `wac.setNamespace(getNamespace());`\n `wac.addApplicationListener(new SourceFilteringListener(wac, new ContextRefreshListener()));`\n\n\u00a0\u00a0\u00a0\u00a0// The wac environment's #initPropertySources will be called in any case when the context\n\u00a0\u00a0\u00a0\u00a0// is refreshed; do it eagerly here to ensure servlet property sources are in place for\n\u00a0\u00a0\u00a0\u00a0// use in any post-processing or initialization that occurs below prior to #refresh\n\u00a0\u00a0\u00a0\u00a0ConfigurableEnvironment env = wac.getEnvironment();\n\u00a0\u00a0\u00a0\u00a0if (env instanceof ConfigurableWebEnvironment) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((ConfigurableWebEnvironment) env).initPropertySources(getServletContext(), getServletConfig());\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0postProcessWebApplicationContext(wac);\n\u00a0\u00a0\u00a0\u00a0applyInitializers(wac);\n`////\u521b\u5efa\u5e76\u521d\u59cb\u5316Bean`\n `wac.refresh();`\n}\n</code></pre> DispatcherServlet\u7684onRefresh\u65b9\u6cd5\u8d1f\u8d23\u7ed9\u4ece\u5bb9\u5668\u4e2d\u627e\u5230\u4e5d\u5927\u7ec4\u4ef6\u7136\u540e\u7ed9\u5b9e\u4f8b\u53d8\u91cf\u8d4b\u503c Text Only<pre><code>protected void onRefresh(ApplicationContext context) {\n\u00a0\u00a0\u00a0\u00a0initStrategies(context);\n}\n\nprotected void initStrategies(ApplicationContext context) {\n\u00a0\u00a0\u00a0\u00a0initMultipartResolver(context);\n\u00a0\u00a0\u00a0\u00a0initLocaleResolver(context);\n\u00a0\u00a0\u00a0\u00a0initThemeResolver(context);\n\u00a0\u00a0\u00a0\u00a0initHandlerMappings(context);\n\u00a0\u00a0\u00a0\u00a0initHandlerAdapters(context);\n\u00a0\u00a0\u00a0\u00a0initHandlerExceptionResolvers(context);\n\u00a0\u00a0\u00a0\u00a0initRequestToViewNameTranslator(context);\n\u00a0\u00a0\u00a0\u00a0initViewResolvers(context);\n\u00a0\u00a0\u00a0\u00a0initFlashMapManager(context);\n}\n</code></pre> \u6bd4\u5982initMultipartResolver\u65b9\u6cd5\u7ed9multipartResolver\u8d4b\u503c Text Only<pre><code>private void initMultipartResolver(ApplicationContext context) {\n\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.multipartResolver = context.getBean(MULTIPART_RESOLVER_BEAN_NAME, MultipartResolver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isTraceEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.trace(\"Detected \" + this.multipartResolver);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"Detected \" + this.multipartResolver.getClass().getSimpleName());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0catch (NoSuchBeanDefinitionException ex) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Default is no multipart resolver.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.multipartResolver = null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isTraceEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.trace(\"No MultipartResolver '\" + MULTIPART_RESOLVER_BEAN_NAME + \"' declared\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e8c\u3001DispatcherServlet\u7684\u6267\u884c\u6d41\u7a0b Servlet\u7684service\u65b9\u6cd5\u6700\u540e\u4f1a\u6267\u884c\u5230DispatcherServlet\u7684doDispatch\u65b9\u6cd5 Text Only<pre><code>protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {\n\u00a0\u00a0\u00a0\u00a0HttpServletRequest processedRequest = request;\n`//\u5904\u7406\u5668\u6267\u884c\u94fe\uff0c\u5305\u62ec\u4e09\u4e2a\u5b9e\u4f8b\u53d8\u91cf\uff1aHandlerMethod handler\u3001 List&lt;HandlerInterceptor&gt; interceptorList\u3001int interceptorIndex = -1;`\n`//\u4f5c\u7528\u662f\uff0c\u8c03\u7528\u76ee\u6807\u65b9\u6cd5\u6267\u884c\u00a0\u548c\u00a0\u8c03\u7528\u62e6\u622a\u5668\u6267\u884c`\n `HandlerExecutionChain mappedHandler = null;`\n\u00a0\u00a0\u00a0\u00a0boolean multipartRequestParsed = false;\n\u00a0\u00a0\u00a0\u00a0WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n\n\u00a0\u00a0\u00a0\u00a0try {\n `ModelAndView mv = null;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Exception dispatchException = null;\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0processedRequest = checkMultipart(request);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0multipartRequestParsed = (processedRequest != request);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Determine handler for the current request.\n`//\u4eceHandlerMapping\u4e2d\u627e\u5230\u8bf7\u6c42\u5bf9\u5e94\u7684HandlerExecutionCha``in\uff0cHandlerMapping``\u7684\u4f5c\u7528\u5c31\u662f\u4fdd\u5b58\u8bf7\u6c42\u4e0eController\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb`\n `mappedHandler = getHandler(processedRequest);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (mappedHandler == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0noHandlerFound(processedRequest, response);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n`//\u627e\u5230HandlerMethod\u5bf9\u5e94\u7684\u5904\u7406\u5668\u9002\u914d\u5668\uff0c\u6700\u5e38\u89c1\u7684\u662fRequestMappingHandlerAdapter`\n `// Determine handler adapter for the current request.`\n `HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Process last-modified header, if supported by the handler.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String method = request.getMethod();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean isGet = \"GET\".equals(method);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isGet || \"HEAD\".equals(method)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long lastModified = ha.getLastModified(request, mappedHandler.getHandler());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n`//\u901a\u8fc7\u5904\u7406\u5668\u6267\u884c\u94fe\u8c03\u7528\u62e6\u622a\u5668\u7684preHandle\u65b9\u6cd5`\n `if (!mappedHandler.applyPreHandle(processedRequest, response)) {`\n `return;`\n `}`\n\n`//\u6838\u5fc3\u6b65\u9aa4\uff0c\u901a\u8fc7\u5904\u7406\u5668\u9002\u914d\u5668\u8c03\u7528\u76ee\u6807\u65b9\u6cd5\uff0c\u6838\u5fc3\u662f\u53cd\u5c04\u8c03\u7528\u76ee\u6807\u65b9\u6cd5\uff0c\u5173\u952e\u89e3\u51b3\u7684\u95ee\u9898\u662f\u6570\u636e\u7ed1\u5b9a\uff0c\u5373\u5982\u4f55\u4e3a\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u53c2\u6570\u8d4b\u503c\uff0c\u6bd4\u5982\u5c06\u8bf7\u6c42\u53c2\u6570\u8f6c\u6362\u6210Jav``a\u5bf9\u8c61\uff08\u53c2\u6570\u662f\u5426\u6807\u6709\u6ce8\u89e3``\uff09\u3001``\u539f\u751fSer``vlet\u5bf9\u8c61\u8d4b\u503c\u3001\u4eceRequest\u57df\u6216\u8005Session\u57df\u4e2d\u83b7\u53d6\u503c\u3001Model\u5bf9\u8c61\u8d4b\u503c\u7b49\u3002`\n `// Actually invoke the handler.`\n `mv = ha.handle(processedRequest, response, mappedHandler.getHandler());`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (asyncManager.isConcurrentHandlingStarted()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0applyDefaultViewName(processedRequest, mv);\n`//\u901a\u8fc7\u5904\u7406\u5668\u6267\u884c\u94fe\u8c03\u7528\u62e6\u622a\u5668\u7684postHandle\u65b9\u6cd5`\n `mappedHandler.applyPostHandle(processedRequest, response, mv);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0catch (Exception ex) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dispatchException = ex;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0catch (Throwable err) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// As of 4.3, we're processing Errors thrown from handler methods as well,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// making them available for @ExceptionHandler methods and other scenarios.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dispatchException = new NestedServletException(\"Handler dispatch failed\", err);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n`//\u901a\u8fc7ModelAndView\u6e32\u67d3\u89c6\u56fe`\n `processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0catch (Exception ex) {\n`//\u901a\u8fc7\u5904\u7406\u5668\u6267\u884c\u94fe\u8c03\u7528\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5`\n `triggerAfterCompletion(processedRequest, response, mappedHandler, ex);`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0catch (Throwable err) {\n`//\u901a\u8fc7\u5904\u7406\u5668\u6267\u884c\u94fe\u8c03\u7528\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5`\n `triggerAfterCompletion(processedRequest, response, mappedHandler,`\n `new NestedServletException(\"Handler processing failed\", err));`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0finally {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (asyncManager.isConcurrentHandlingStarted()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Instead of postHandle and afterCompletion\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (mappedHandler != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Clean up any resources used by a multipart request.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (multipartRequestParsed) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cleanupMultipart(processedRequest);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u4eceHandlerMapping\u4e2d\u627e\u5230\u8bf7\u6c42URL\u5bf9\u5e94\u7684HandlerExecutionChain\uff08\u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684HandlerExecutionChain\u5bf9\u8c61\uff09\u3002HandlerMapping\u7684\u4f5c\u7528\u5c31\u662f\u4fdd\u5b58\u8bf7\u6c42\u4e0eController\u65b9\u6cd5\u7684\u6620\u5c04\u5173\u7cfb\uff0cHandlerMapping\u6700\u5e38\u89c1\u7684\u5b9e\u73b0\u7c7b\u662fRequestMappingHandlerMapping\u3002 Text Only<pre><code>protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {\n\u00a0\u00a0\u00a0\u00a0if (this.handlerMappings != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (HandlerMapping mapping : this.handlerMappings) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HandlerExecutionChain handler = mapping.getHandler(request);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (handler != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return handler;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return null;\n}\n</code></pre></p> <p>\u603b\u7ed3\uff1a doDispatcher\u6d89\u53ca\u7684\u6838\u5fc3\u7ec4\u4ef6\u6709\uff1a 1\u3001HandlerExecutionChain\uff0c\u5904\u7406\u5668\u6267\u884c\u94fe\uff0c\u5305\u62ec\u5904\u7406\u5668\u65b9\u6cd5\u5bf9\u8c61\u548c\u62e6\u622a\u5668\u5217\u8868\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>public class HandlerExecutionChain {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5904\u7406\u5668\u65b9\u6cd5\uff1a\u5b9e\u9645\u4e0a\u5e95\u5c42\u5bf9\u8c61\u662f HandlerMethod\u5bf9\u8c61\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private Object handler;\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u672c\u6b21\u8bf7\u6c42\u9700\u8981\u6267\u884c\u7684\u62e6\u622a\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private List&lt;HandlerInterceptor&gt; interceptors;\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5f53\u524d\u62e6\u622a\u5668\u6267\u884c\u5230\u54ea\u4e2a\u62e6\u622a\u5668\u4e86\uff0c\u5f53\u524d\u62e6\u622a\u5668\u7684\u4e0b\u6807\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private int interceptorIndex = -1;\n\n\u00a0 \u00a0 boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {}\n\u00a0 \u00a0 public void applyPostHandle(HttpServletRequest request, HttpServletResponse response, ModelAndView mv) throws Exception {}\n\u00a0 \u00a0 public void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, Object o) throws Exception {}\n}\n</code></pre> 2\u3001HandlerMapping\uff0c\u5904\u7406\u5668\u6620\u5c04\u5668\uff0c\u901a\u8fc7\u8bf7\u6c42\u62ff\u5230\u5bf9\u5e94\u7684\u5904\u7406\u5668\u6267\u884c\u94fe\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>public class RequestMappingHandlerMapping implements HandlerMapping {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5904\u7406\u5668\u6620\u5c04\u5668\uff0c\u4e3b\u8981\u5c31\u662f\u901a\u8fc7\u4ee5\u4e0b\u7684map\u96c6\u5408\u8fdb\u884c\u6620\u5c04\uff0c\u4ee5\u4fbf\u901a\u8fc7\u8bf7\u6c42\u62ff\u5230\u5bf9\u5e94\u7684\u63a7\u5236\u5668\u65b9\u6cd5\u5bf9\u8c61\uff0c\u6700\u540e\u4e0e\u62e6\u622a\u5668\u4e00\u8d77\u5c01\u88c5\u6210\u5904\u7406\u5668\u6267\u884c\u94fe\u8fd4\u56de\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0* key\u662f\uff1a\u8bf7\u6c42\u4fe1\u606f\uff0cRequestMappingInfo\uff0c\u5305\u62ec\u8bf7\u6c42URL\u548c\u8bf7\u6c42\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0* value\u662f\uff1a\u8be5\u8bf7\u6c42\u5bf9\u5e94\u8981\u6267\u884c\u7684\u5904\u7406\u5668\u65b9\u6cd5\u5bf9\u8c61\uff0c\u53ef\u7b80\u5355\u770b\u4f5c\u662fjava.lang.reflect.Method\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private Map&lt;RequestMappingInfo, HandlerMethod&gt; map;\n\n\u00a0 \u00a0 //\u627e\u5230\u8bf7\u6c42\u5bf9\u5e94\u7684HandlerExecutionChain\n\u00a0 \u00a0 @Override\n\u00a0 \u00a0 public HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {}\n}\n</code></pre> 3\u3001HandlerMethod\uff0c\u5904\u7406\u5668\u65b9\u6cd5\uff0c\u65b9\u4fbf\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>public class HandlerMethod {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0*\u00a0\u63a7\u5236\u5668\u5bf9\u8c61\uff0cController\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private Object bean;\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u63a7\u5236\u5668\u65b9\u6cd5\uff0cController\u7684\u65b9\u6cd5\uff0cjava.lang.reflect.Method\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private Method method;\n}\n</code></pre> 4\u3001HandlerAdapter\uff0c\u5904\u7406\u5668\u9002\u914d\u5668\uff0c\u8d1f\u8d23\u8c03\u7528\u63a7\u5236\u5668\u65b9\u6cd5\uff0c\u6838\u5fc3\u662f\u53cd\u5c04\u8c03\u7528\u76ee\u6807\u65b9\u6cd5\uff0c\u5173\u952e\u89e3\u51b3\u7684\u95ee\u9898\u662f\u6570\u636e\u7ed1\u5b9a\uff0c\u5373\u5982\u4f55\u4e3a\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u53c2\u6570\u8d4b\u503c\uff0c\u6bd4\u5982\u5c06\u8bf7\u6c42\u53c2\u6570\u8f6c\u6362\u6210Java\u5bf9\u8c61\uff08\u53c2\u6570\u662f\u5426\u6807\u6709\u6ce8\u89e3\uff09\u3001\u539f\u751fServlet\u5bf9\u8c61\u8d4b\u503c\u3001\u4eceRequest\u57df\u6216\u8005Session\u57df\u4e2d\u83b7\u53d6\u503c\u3001Model\u5bf9\u8c61\u8d4b\u503c\u7b49\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>//HandlerMethod\u5bf9\u5e94\u7684\u5904\u7406\u5668\u9002\u914d\u5668HandlerAdapter\npublic class RequestMappingHandlerAdapter implements HandlerAdapter {\n\u00a0 \u00a0 //\u8c03\u7528\u5904\u7406\u5668\u65b9\u6cd5\uff08\u5e95\u5c42\u4f1a\u771f\u6b63\u7684\u8c03\u7528\u5904\u7406\u5668\u65b9\u6cd5\uff0c\u6267\u884c\u6838\u5fc3\u4e1a\u52a1\u3002\uff09\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {}\n}\n</code></pre> 5\u3001ViewResolver\uff0c\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u5c06viewName\u8f6c\u6362\u4e3aView\u5bf9\u8c61\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>public class InternalResourceViewResolver implements ViewResolver {\n\u00a0\u00a0\u00a0\u00a0private String prefix;\n\u00a0\u00a0\u00a0\u00a0private String suffix;\n\u00a0 \u00a0 //\u89c6\u56fe\u89e3\u6790\uff0c\u5c06viewName\u8f6c\u6362\u4e3aView\u5bf9\u8c61\u3002\n\u00a0 \u00a0\u00a0View resolveViewName(String viewName, Locale locale) throws Exception{}\n}\n</code></pre> 6\u3001View\uff0c\u89c6\u56fe\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>public class InternalResourceView implements View {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u54cd\u5e94\u7684\u5185\u5bb9\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private String contentType;\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u83b7\u53d6\u5185\u5bb9\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0String getContentType();\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6e32\u67d3\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0void render(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception;\n}\n</code></pre> 7\u3001ModelAndView\uff0c\u7b80\u5316\u6a21\u578b\u5982\u4e0b\uff1a Text Only<pre><code>public class ModelAndView {\n\u00a0\u00a0\u00a0\u00a0/** View instance or view name String. */\n\u00a0\u00a0\u00a0\u00a0@Nullable\n\u00a0\u00a0\u00a0\u00a0private Object view;\n\u00a0\u00a0\u00a0\u00a0/** Model Map. */\n\u00a0\u00a0\u00a0\u00a0@Nullable\n\u00a0\u00a0\u00a0\u00a0private ModelMap model;\n\u00a0\u00a0\u00a0\u00a0/** Optional HTTP status for the response. */\n\u00a0\u00a0\u00a0\u00a0@Nullable\n\u00a0\u00a0\u00a0\u00a0private HttpStatus status;\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/2-%40RequestMapping%E6%B3%A8%E8%A7%A3/","title":"2-@RequestMapping\u6ce8\u89e3","text":"<p> \u7ea6 738 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>\u4e00\u3001@RequestMapping\u6ce8\u89e3 @RequestMapping\u6ce8\u89e3\u7684\u529f\u80fd\u548c\u4f4d\u7f6e \u529f\u80fd\uff1a@RequestMapping\u6ce8\u89e3\u7684\u4f5c\u7528\u662f\u5c06\u8bf7\u6c42\u548c\u5904\u7406\u8bf7\u6c42\u7684\u65b9\u6cd5\u5173\u8054\u8d77\u6765\u3002 \u4f4d\u7f6e\uff1a</p> <ul> <li>@RequestMapping \u6807\u6ce8\u5728\u7c7b\u4e0a\u4e3a\u6240\u6709\u65b9\u6cd5\u6307\u5b9a\u4e00\u4e2a\u57fa\u51c6\u8def\u5f84\u3002</li> <li>@RequestMapping \u6807\u6ce8\u5728\u65b9\u6cd5\u4e0a\u4e3a\u65b9\u6cd5\u6307\u5b9a\u4e00\u4e2a\u8bbf\u95ee\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u4e0e\u65b9\u6cd5\u540d\u6ca1\u6709\u5173\u7cfb\u3002</li> </ul> <p>1\u3001 value\u5c5e\u6027 value\u5c5e\u6027\u8bbe\u7f6e\u8bf7\u6c42\u8def\u5f84\uff0c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u8868\u793a\u80fd\u591f\u5339\u914d\u591a\u4e2a\u8bf7\u6c42\u5730\u5740\u3002 \u652f\u6301ant\u98ce\u683c\u7684\u6a21\u7cca\u5339\u914d\u8def\u5f84\uff1a</p> <ul> <li>? \u66ff\u4ee3\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26</li> <li>* \u66ff\u4ee3\u4efb\u610f\u591a\u4e2a\u5b57\u7b26\uff0c\u6216\u8005\u662f\u4e00\u5c42\u8def\u5f84</li> <li>** \u66ff\u4ee3\u591a\u5c42\u8def\u5f84</li> </ul> Text Only<pre><code>@RequestMapping(\"/handler?\")\n@RequestMapping(\"/handler*\") //* \u66ff\u4ee3\u4efb\u610f\u591a\u4e2a\u5b57\u7b26\n@RequestMapping(\"/*/handler06\")\u00a0 //* \u66ff\u4ee3\u4e00\u5c42\u8def\u5f84\n@RequestMapping(\"/**/handler07\")\n</code></pre> <p>\u8def\u5f84\u4e2d\u652f\u6301\u5360\u4f4d\u7b26\uff0c\u5e38\u7528\u4e8eRESTful\u98ce\u683c\u7684URL\u5730\u5740\uff0c\u4f7f\u7528@PathVariable\u6ce8\u89e3\u5c06\u5360\u4f4d\u7b26\u6240\u8868\u793a\u7684\u6570\u636e\u8d4b\u503c\u7ed9\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u5f62\u53c2\uff1a Text Only<pre><code>@RequestMapping(\"/user/{id}\")\npublic String pathVariableTest(@PathVariable(\"id\") String id){\n\u00a0\u00a0\u00a0\u00a0System.out.println(id);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>2\u3001 method\u5c5e\u6027 method\uff1a\u9650\u5b9a\u8bf7\u6c42\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u63a5\u53d7\u6240\u6709\u7c7b\u578b\u7684\u8bf7\u6c42\u3002HTTP\u534f\u8bae\u4e2d\u7684\u6240\u6709\u8bf7\u6c42\u65b9\u5f0f\uff1aGET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE\u3002 \u5bf9\u4e8e\u5904\u7406\u6307\u5b9a\u8bf7\u6c42\u65b9\u5f0f\u7684\u63a7\u5236\u5668\u65b9\u6cd5\uff0cSpringMVC\u4e2d\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684@RequestMapping\u6d3e\u751f\u6ce8\u89e3\uff1a</p> <ul> <li>\u5904\u7406get\u8bf7\u6c42\u7684\u6620\u5c04--&gt;@GetMapping</li> <li>\u5904\u7406post\u8bf7\u6c42\u7684\u6620\u5c04--&gt;@PostMapping</li> <li>\u5904\u7406put\u8bf7\u6c42\u7684\u6620\u5c04--&gt;@PutMapping</li> <li>\u5904\u7406delete\u8bf7\u6c42\u7684\u6620\u5c04--&gt;@DeleteMapping</li> </ul> <p>\u82e5\u5f53\u524d\u8bf7\u6c42\u7684\u8bf7\u6c42\u5730\u5740\u6ee1\u8db3\u8bf7\u6c42\u6620\u5c04\u7684value\u5c5e\u6027\uff0c\u4f46\u662f\u8bf7\u6c42\u65b9\u5f0f\u4e0d\u6ee1\u8db3method\u5c5e\u6027\uff0c\u5219\u62a5\u9519405\uff0c\u6bd4\u5982405\uff1aRequest method 'POST' not supported\u3002</p> <p>3\u3001 params\u5c5e\u6027\uff08\u4e86\u89e3\uff09 params\uff1a\u89c4\u5b9a\u8bf7\u6c42\u53c2\u6570\uff0c\u53ea\u54cd\u5e94\u8bf7\u6c42\u53c2\u6570\u7b26\u5408\u8981\u6c42\u7684\u8bf7\u6c42\u3002</p> <ul> <li>param1: \u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u540d\u4e3a param1 \u7684\u8bf7\u6c42\u53c2\u6570\u3002</li> <li>!param1: \u8868\u793a\u8bf7\u6c42\u4e0d\u80fd\u5305\u542b\u540d\u4e3a param1 \u7684\u8bf7\u6c42\u53c2\u6570\u3002</li> <li>param1 != value1: \u8868\u793a\u8bf7\u6c42\u5305\u542b\u540d\u4e3a param1 \u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u4f46\u5176\u503c\u4e0d\u80fd\u4e3a value1\u3002</li> <li>{\u201cparam1=value1\u201d, \u201cparam2\u201d}: \u8bf7\u6c42\u5fc5\u987b\u5305\u542b\u540d\u4e3a param1 \u548c param2 \u7684\u4e24\u4e2a\u8bf7\u6c42\u53c2\u6570\uff0c\u4e14 param1 \u53c2\u6570\u7684\u503c\u5fc5\u987b\u4e3a value1\u3002</li> </ul> <p>Text Only<pre><code>@RequestMapping(value = \"/handler02\", params = {\"username\", \"password!=123456\"})\npublic String handler02(){\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> \u5f53\u4e0d\u6ee1\u8db3params\u5c5e\u6027\uff0c\u6b64\u65f6\u9875\u9762\u56de\u62a5\u9519400\uff1aParameter conditions \"username, password!=123456\" not met for actual request parameters: username={admin}, password={123456}</p> <p>4\u3001 headers\u5c5e\u6027\uff08\u4e86\u89e3\uff09 headers\uff1a\u89c4\u5b9a\u8bf7\u6c42\u5934\uff0c\u53ea\u54cd\u5e94\u8bf7\u6c42\u5934\u7b26\u5408\u8981\u6c42\u7684\u8bf7\u6c42\uff0c\u683c\u5f0f\u540cparams\u5c5e\u6027\u3002</p> <ul> <li>\"header\"\uff1a\u8981\u6c42\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26header\u8bf7\u6c42\u5934\u4fe1\u606f</li> <li>\"!header\"\uff1a\u8981\u6c42\u8bf7\u6c42\u4e0d\u80fd\u643a\u5e26header\u8bf7\u6c42\u5934\u4fe1\u606f</li> <li>\"header=value\"\uff1a\u8981\u6c42\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26header\u8bf7\u6c42\u5934\u4fe1\u606f\u4e14header=value</li> <li>\"header!=value\"\uff1a\u8981\u6c42\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26header\u8bf7\u6c42\u5934\u4fe1\u606f\u4e14header!=value</li> </ul> <p>\u5f53\u524d\u8bf7\u6c42\u6ee1\u8db3@RequestMapping\u6ce8\u89e3\u7684value\u548cmethod\u5c5e\u6027\uff0c\u4f46\u662f\u4e0d\u6ee1\u8db3headers\u5c5e\u6027\uff0c\u6b64\u65f6\u9875\u9762\u663e\u793a404\u9519\u8bef\uff0c\u5373\u8d44\u6e90\u672a\u627e\u5230\u3002 Text Only<pre><code>@RequestMapping(value = \"/handler03\", headers = \"User-Agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36\")\npublic String handler03(){\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>5\u3001 consumes\u5c5e\u6027\uff08\u4e86\u89e3\uff09 \u89c4\u5b9a\u8bf7\u6c42\u5934\u4e2d\u7684Content-Type\u3002</p> <p>6\u3001 produces\u5c5e\u6027\uff08\u4e86\u89e3\uff09 \u8bbe\u7f6e\u54cd\u5e94\u5934\u7684Content-Type\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/3-RESTful%20%E4%B8%8E%20%E8%BF%87%E6%BB%A4%E5%99%A8/","title":"3-RESTful \u4e0e \u8fc7\u6ee4\u5668","text":"<p> \u7ea6 722 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>\u4e00\u3001RESTful REST \u98ce\u683c\u63d0\u5021 URL \u5730\u5740\u4f7f\u7528\u7edf\u4e00\u7684\u98ce\u683c\u8bbe\u8ba1\uff0c\u4ece\u524d\u5230\u540e\u5404\u4e2a\u5355\u8bcd\u4f7f\u7528\u659c\u6760\u5206\u5f00\uff0c\u4e0d\u4f7f\u7528\u95ee\u53f7\u952e\u503c\u5bf9\u65b9\u5f0f\u643a\u5e26\u8bf7\u6c42\u53c2\u6570\uff0c\u800c\u662f\u5c06\u8981\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684\u6570\u636e\u4f5c\u4e3a URL \u5730\u5740\u7684\u4e00\u90e8\u5206\uff0c\u4ee5\u4fdd\u8bc1\u6574\u4f53\u98ce\u683c\u7684\u4e00\u81f4\u6027\u3002\u5e76\u4f7f\u7528\u8bf7\u6c42\u65b9\u5f0f\u660e\u786e\u610f\u56fe\uff1aGET \u7528\u6765\u83b7\u53d6\u8d44\u6e90\uff0cPOST \u7528\u6765\u65b0\u5efa\u8d44\u6e90\uff0cPUT \u7528\u6765\u66f4\u65b0\u8d44\u6e90\uff0cDELETE \u7528\u6765\u5220\u9664\u8d44\u6e90\u3002</p> \u64cd\u4f5c \u4f20\u7edf\u65b9\u5f0f REST\u98ce\u683c \u67e5\u8be2\u64cd\u4f5c getUserById?id=1 user/1--&gt;get\u8bf7\u6c42\u65b9\u5f0f \u4fdd\u5b58\u64cd\u4f5c saveUser user--&gt;post\u8bf7\u6c42\u65b9\u5f0f \u5220\u9664\u64cd\u4f5c deleteUser?id=1 user/1--&gt;delete\u8bf7\u6c42\u65b9\u5f0f \u66f4\u65b0\u64cd\u4f5c updateUser user--&gt;put\u8bf7\u6c42\u65b9\u5f0f <p>\u53d1\u9001put\u548cdelete\u8bf7\u6c42\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u65b9\u5f0f\u4e00\uff1aPOST\u8bf7\u6c42\u643a\u5e26\u8bf7\u6c42\u53c2\u6570_method\uff0c\u670d\u52a1\u5668\u7aef\u914d\u7f6e\u8fc7\u6ee4\u5668org.springframework.web.filter.HiddenHttpMethodFilter\uff0cHiddenHttpMethodFilter\u4f1a\u5c06\u8bf7\u6c42\u7684\u8bf7\u6c42\u65b9\u5f0f\u8f6c\u6362\u4e3a\u8bf7\u6c42\u53c2\u6570_method\u7684\u503c\u3002 1\u3001web.xml\u4e2d\u914d\u7f6eHiddenHttpMethodFilter\u8fc7\u6ee4\u5668\uff1a Text Only<pre><code>&lt;filter&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/*&lt;/url-pattern&gt;\u00a0&lt;!--\u62e6\u622a\u6240\u6709\u8bf7\u6c42--&gt;\n&lt;/filter-mapping&gt;\n</code></pre> 2\u3001\u8bf7\u6c42\u5fc5\u987b\u662fPOST\u4e14\u643a\u5e26_method\u53c2\u6570\uff08_method\u4e0d\u4e00\u5b9a\u5fc5\u987b\u653e\u5728\u8bf7\u6c42\u4f53\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u653e\u5728\u8bf7\u6c42\u5934\u7684URL\u540e\u9762\uff09\uff1a \u8868\u5355\uff1a Text Only<pre><code>&lt;!-- \u4f5c\u7528\uff1a\u901a\u8fc7\u8d85\u94fe\u63a5\u63a7\u5236\u8868\u5355\u7684\u63d0\u4ea4\uff0c\u5c06post\u8bf7\u6c42\u8f6c\u6362\u4e3adelete\u8bf7\u6c42 --&gt;\n&lt;form id=\"delete_form\" method=\"post\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- HiddenHttpMethodFilter\u8981\u6c42\uff1a\u5fc5\u987b\u4f20\u8f93_method\u8bf7\u6c42\u53c2\u6570\uff0c\u5e76\u4e14\u503c\u4e3a\u6700\u7ec8\u7684\u8bf7\u6c42\u65b9\u5f0f --&gt;\n\u00a0\u00a0\u00a0\u00a0`&lt;input type=\"hidden\" name=\"_method\" value=\"delete\"/&gt;`\n&lt;/form&gt;\n</code></pre> Ajax\u8bf7\u6c42\uff1a Text Only<pre><code>$.ajax({\n\u00a0\u00a0\u00a0\u00a0url:\"${pageContext.request.contextPath}/emp/\" + id,\n\u00a0\u00a0\u00a0\u00a0type:\"POST\",\n\u00a0\u00a0\u00a0\u00a0data:$(\"#empModal form\").serialize() + \"`&amp;_method=PUT`\",\n\u00a0\u00a0\u00a0\u00a0success:function (result) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\n\u00a0\u00a0\u00a0\u00a0}\n});\n</code></pre></p> <p>HiddenHttpMethodFilter\u7684\u6838\u5fc3\u903b\u8f91\u5728doFilterInternal\u65b9\u6cd5\u4e2d\uff0c\u5176\u4e2d\u7684this.methodParam\u7684\u503c\u5c31\u662f\"_method\"\uff1a Text Only<pre><code>protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0HttpServletRequest requestToUse = request;\n\u00a0\u00a0\u00a0\u00a0if (\"POST\".equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String paramValue = request.getParameter(`this.methodParam`);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (StringUtils.hasLength(paramValue)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String method = paramValue.toUpperCase(Locale.ENGLISH);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (ALLOWED_METHODS.contains(method)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0requestToUse = new HttpMethodRequestWrapper(request, method);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0filterChain.doFilter(requestToUse, response);\n}\n</code></pre></p> <p>\u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528Ajax\u76f4\u63a5\u53d1\u9001put\u548cdelete\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u7aef\u914d\u7f6e\u8fc7\u6ee4\u5668org.springframework.web.filter.HttpPutFormContentFilter 1\u3001web.xml\u4e2d\u914d\u7f6eHttpPutFormContentFilter\u8fc7\u6ee4\u5668\uff1a Text Only<pre><code>&lt;filter&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;httpPutFormContentFilter&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-class&gt;org.springframework.web.filter.HttpPutFormContentFilter&lt;/filter-class&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;filter-name&gt;httpPutFormContentFilter&lt;/filter-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;\n</code></pre> 2\u3001\u4f7f\u7528Ajax\u76f4\u63a5\u53d1\u9001put\u548cdelete\u8bf7\u6c42\uff1a Text Only<pre><code>$.ajax({\n\u00a0\u00a0\u00a0\u00a0url:\"${pageContext.request.contextPath}/emp/\" + id,\n\u00a0\u00a0\u00a0\u00a0`type:\"PUT\",`\n\u00a0\u00a0\u00a0\u00a0data:$(\"#empModal form\").serialize(),\n\u00a0\u00a0\u00a0\u00a0success:function (result) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\n\u00a0\u00a0\u00a0\u00a0}\n});\n</code></pre></p> Text Only<pre><code>$.ajax({\n\u00a0\u00a0\u00a0\u00a0url:\"${pageContext.request.contextPath}/emp/\" + id,\n\u00a0\u00a0\u00a0\u00a0type:\"DELETE\",\n\u00a0\u00a0\u00a0\u00a0data:$(\"#empModal form\").serialize(),\n\u00a0\u00a0\u00a0\u00a0success:function (result) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\n\u00a0\u00a0\u00a0\u00a0}\n});\n</code></pre> <p>\u4e8c\u3001\u8fc7\u6ee4\u5668 \u8fd9\u91cc\u7684\u8fc7\u6ee4\u5668\u6307\u539f\u751fServlet\u4e2d\u7684\u4e09\u5927\u7ec4\u4ef6\u4e4b\u4e00\u7684\u8fc7\u6ee4\u5668\uff0cSpringMVC\u4e2d\u63d0\u4f9b\u4e86\u4e24\u79cd\u6709\u7528\u7684\u8fc7\u6ee4\u5668\uff0c\u4e00\u4e2a\u662f\u524d\u9762\u5904\u7406 put\u548cdelete\u8bf7\u6c42\u7684\u8fc7\u6ee4\u5668\uff1b\u53e6\u5916\u4e00\u4e2a\u662f\u89e3\u51b3\u5b57\u7b26\u7f16\u7801\u7684\u8fc7\u6ee4\u5668org.springframework.web.filter.CharacterEncodingFilter\u3002 web.xml\u4e2d\u914d\u7f6eCharacterEncodingFilter\u8fc7\u6ee4\u5668\uff1a Text Only<pre><code>&lt;filter&gt;\n\u00a0\u00a0&lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;\n\u00a0\u00a0&lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;\n\u00a0\u00a0&lt;init-param&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;param-name&gt;encoding&lt;/param-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;param-value&gt;utf-8&lt;/param-value&gt;\n\u00a0\u00a0&lt;/init-param&gt;\n\u00a0\u00a0&lt;init-param&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;param-name&gt;forceEncoding&lt;/param-name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;param-value&gt;true&lt;/param-value&gt;\n\u00a0\u00a0&lt;/init-param&gt;\n&lt;/filter&gt;\n&lt;filter-mapping&gt;\n\u00a0\u00a0&lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;\n\u00a0\u00a0&lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;\n</code></pre> \u5728web.xml\u4e2d\u6ce8\u518c\u65f6\uff0c\u5fc5\u987b\u5148\u6ce8\u518cCharacterEncodingFilter\uff0c\u518d\u6ce8\u518cHiddenHttpMethodFilter\uff0c\u56e0\u4e3a\u5728 CharacterEncodingFilter \u4e2d\u901a\u8fc7 request.setCharacterEncoding(encoding) \u65b9\u6cd5\u8bbe\u7f6e\u5b57\u7b26\u96c6\u65f6\uff0c\u8981\u6c42\u524d\u9762\u4e0d\u80fd\u6709\u4efb\u4f55\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\u7684\u64cd\u4f5c\uff0c\u5426\u5219\u8bbe\u7f6e\u7f16\u7801\u65e0\u6548\uff0c\u800c HiddenHttpMethodFilter\u9700\u8981\u83b7\u53d6\u8bf7\u6c42\u65b9\u5f0fString paramValue = request.getParameter(this.methodParam);\u3002</p> <p>CharacterEncodingFilter\u7684\u6838\u5fc3\u903b\u8f91\u5728doFilterInternal\u65b9\u6cd5\u4e2d\uff1a Text Only<pre><code>@Override\nprotected void doFilterInternal(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throws ServletException, IOException {\n\u00a0\u00a0\u00a0\u00a0String encoding = getEncoding();\n\u00a0\u00a0\u00a0\u00a0if (encoding != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isForceRequestEncoding() || request.getCharacterEncoding() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0request.setCharacterEncoding(encoding);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isForceResponseEncoding()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setCharacterEncoding(encoding);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0filterChain.doFilter(request, response);\n}\n</code></pre> \u6807\u7b7e\u4e2d\u8bbe\u7f6e\u7684\u6b63\u662fCharacterEncodingFilter\u7684\u8fd9\u4e09\u4e2a\u5b9e\u4f8b\u53d8\u91cf\u7684\u503c\uff1a Text Only<pre><code>private String encoding;\nprivate boolean forceRequestEncoding = false;\nprivate boolean forceResponseEncoding = false;\n</code></pre> Text Only<pre><code>public void setEncoding(@Nullable String encoding) {\n\u00a0\u00a0\u00a0\u00a0this.encoding = encoding;\n}\n</code></pre> Text Only<pre><code>public void setForceEncoding(boolean forceEncoding) {\n\u00a0\u00a0\u00a0\u00a0this.forceRequestEncoding = forceEncoding;\n\u00a0\u00a0\u00a0\u00a0this.forceResponseEncoding = forceEncoding;\n}\n</code></pre>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/4-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF/","title":"4-\u83b7\u53d6\u8bf7\u6c42\u4e2d\u7684\u4fe1\u606f","text":"<p> \u7ea6 942 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>\u4e00\u3001\u83b7\u53d6\u8bf7\u6c42\u4f53\u4e2d\u7684\u53c2\u6570 1\u3001\u901a\u8fc7ServletAPI\u83b7\u53d6 \u5c06HttpServletRequest\u4f5c\u4e3a\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u5f62\u53c2\uff0cDispatcherServlet\u4f1a\u81ea\u52a8\u7ed9\u53c2\u6570\u8d4b\u503c\u3002 Text Only<pre><code>@RequestMapping(\"/testParam\")\npublic String testParam(HttpServletRequest request){\n\u00a0\u00a0\u00a0\u00a0String username = request.getParameter(\"username\");\n\u00a0\u00a0\u00a0\u00a0String password = request.getParameter(\"password\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"username:\"+username+\",password:\"+password);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>2\u3001\u901a\u8fc7\u5f62\u53c2\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570</p> <ul> <li>\u63a7\u5236\u5668\u65b9\u6cd5\u8bbe\u7f6e\u548c\u8bf7\u6c42\u53c2\u6570\u540c\u540d\u7684\u5f62\u53c2\uff0cDispatcherServlet\u4f1a\u81ea\u52a8\u5c06\u8bf7\u6c42\u53c2\u6570\u8d4b\u503c\u7ed9\u540c\u540d\u7684\u5f62\u53c2\u3002</li> <li>\u8bf7\u6c42\u53c2\u6570\u4e2d\u6709\u591a\u4e2a\u540c\u540d\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u53ef\u8bbe\u7f6e\u5b57\u7b26\u4e32\u6570\u7ec4\u63a5\u6536\uff0c\u6b64\u65f6\u53c2\u6570\u7684\u6570\u7ec4\u4e2d\u5305\u542b\u4e86\u6bcf\u4e00\u4e2a\u6570\u636e\uff0c\u4e5f\u53ef\u4f7f\u7528\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u5f62\u53c2\uff0c\u6b64\u65f6\u5b57\u7b26\u4e32\u4e3a\u6bcf\u4e2a\u6570\u636e\u4f7f\u7528\u9017\u53f7\u62fc\u63a5\u7684\u7ed3\u679c\u3002</li> </ul> <p>Text Only<pre><code>http://localhost:8080/01_hello_springmvc_war_exploded/testParam?username=admin&amp;hobby=basketball&amp;hobby=football\n</code></pre> Text Only<pre><code>@RequestMapping(\"/testParam\")\npublic String testParam(String username, String[] hobby) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"username:\" + username + \",hobby:\" + Arrays.toString(hobby)); //\u00a0username:admin,hobby:[basketball, football]\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>3\u3001@RequestParam \u82e5\u5f62\u53c2\u4e0e\u8bf7\u6c42\u7684\u53c2\u6570\u4e0d\u540c\u540d\u5219\u65e0\u6cd5\u63a5\u6536\uff0c\u6b64\u65f6\u9700\u8981\u4f7f\u7528@RequestParam\u6307\u660e\u3002 @RequestParam\u6ce8\u89e3\u4e00\u5171\u6709\u4e09\u4e2a\u5c5e\u6027\uff1a</p> <ul> <li>value\uff1a\u6307\u5b9a\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\u540d\u3002</li> <li>required\uff1a\u9ed8\u8ba4\u503c\u4e3atrue\uff0c\u8868\u793a\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26\u8be5\u53c2\u6570\uff0c\u5426\u5219\u62a5\u9519400\uff1aRequired String parameter 'xxx' is not present\uff1b\u82e5\u8bbe\u7f6e\u4e3afalse\uff0c\u5219\u4e0d\u5fc5\u987b\u4f20\u8f93\u8bf7\u6c42\u53c2\u6570\uff0c\u82e5\u6ca1\u4f20\u8f93\uff0c\u5219\u6ce8\u89e3\u6240\u6807\u8bc6\u7684\u5f62\u53c2\u7684\u503c\u4e3anull\u3002</li> <li>defaultValue\uff1a\u4e0d\u7ba1required\u5c5e\u6027\u503c\u4e3atrue\u6216false\uff0c\u5f53value\u6240\u6307\u5b9a\u7684\u8bf7\u6c42\u53c2\u6570\u6ca1\u6709\u4f20\u8f93\u6216\u4f20\u8f93\u4e3a\"\"\u65f6\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c\u4e3a\u5f62\u53c2\u8d4b\u503c\u3002</li> </ul> Text Only<pre><code>@RequestMapping(\"/reqParam02\")\npublic String getParameter02(@RequestParam(\"username\") String username) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(username);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> <p>5\u3001\u901a\u8fc7\u5b9e\u4f53\u7c7b\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570 \u81ea\u52a8\u5c06\u8bf7\u6c42\u53c2\u6570\u7684key=value\u6ce8\u5165\u5230\u5bf9\u8c61\u4e2d\uff0c\u7ea7\u8054\u5c5e\u6027\u4e5f\u53ef\u4ee5\uff0c\u89e3\u6790\u5f97\u5230\u7684\u5bf9\u8c61\u4f1a\u81ea\u52a8\u4fdd\u5b58\u5230Model\u4e2d\u3002POST\u8bf7\u6c42\u4e2d\u7684Content-Type\u5fc5\u987b\u662fapplication/x-www-form-urlencoded\u3002\u5982\u679c\u8bf7\u6c42\u4f53\u4e0d\u80fd\u7ed9\u81ea\u5b9a\u4e49\u5b9e\u4f53\u7c7b\u5bf9\u8c61\u8d4b\u503c\uff0c\u5219\u8fd8\u4f1a\u5728Model\u4e2d\u518d\u627e\u4e00\u627e\u3002 Text Only<pre><code>@RequestMapping(\"/addBook\")\npublic String addBook(Book book) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(book);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> \u8bf7\u6c42\uff1a Text Only<pre><code>GET http://127.0.0.1:8080/01_hello_springmvc_war_exploded/addBook?id=1&amp;bookName=\u897f\u6e38\u8bb0&amp;author=\u5434\u627f\u6069&amp;address.province=\u5e7f\u4e1c\u7701&amp;address.city=\u5e7f\u5dde\u5e02&amp;price=8.8\n</code></pre> Text Only<pre><code>POST http://127.0.0.1:8080/01_hello_springmvc_war_exploded/addBook\nContent-Type: application/x-www-form-urlencoded\n\nid=1&amp;bookName=\u897f\u6e38\u8bb0&amp;author=\u5434\u627f\u6069&amp;address.province=\u5e7f\u4e1c\u7701&amp;address.city=\u5e7f\u5dde\u5e02&amp;price=8.8\n</code></pre></p> <p>4\u3001@RequestBody @RequestBody\u6807\u6ce8\u5728\u5f62\u53c2\u4e0a\uff0cSpringMVC\u4e0d\u518d\u4f1a\u4f7f\u7528\u4e0a\u9762\u7684\u903b\u8f91\u89e3\u6790\u8bf7\u6c42\uff0c\u800c\u662f\u4f1a\u5c06\u8bf7\u6c42\u4f53\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u4f5c\u4e3a\u4e00\u6574\u4e2a\u5b57\u7b26\u4e32\u8d4b\u503c\u7ed9\u6807\u6709@RequestBody\u6ce8\u89e3\u7684\u53c2\u6570\u4e0a\uff0c\u6240\u4ee5\u4f7f\u7528@RequestBody\u8981\u6ce8\u610f\uff1a</p> <ul> <li>\u5fc5\u987b\u662fPOST\u8bf7\u6c42</li> <li>String\u7c7b\u578b\u7684\u53c2\u6570</li> </ul> <p>\u5982\u679c\u4e0d\u662fString\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5219\u8868\u793a\u8981\u5c06\u8bf7\u6c42\u4f53\u8f6c\u6362\u6210\u4e00\u4e2a\u975e\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u6bd4\u5982\u81ea\u5b9a\u4e49\u7684pojo\u5bf9\u8c61\uff0c\u6216\u8005Map\u5bf9\u8c61\uff0c\u8fd9\u65f6SpringMVC\u4f1a\u91c7\u7528JSON\u683c\u5f0f\u5bf9\u6574\u4e2a\u8bf7\u6c42\u4f53\u8fdb\u884c\u89e3\u6790\uff08\u5e95\u5c42\u901a\u8fc7HttpMessageConverter\u5b8c\u6210\uff09\uff0c\u5fc5\u987b\u8981\u6ce8\u610f\u7684\u662f\uff1a</p> <ul> <li>POST\u8bf7\u6c42\u5934\u5fc5\u987b\u8bbe\u7f6e\u00a0Content-Type: application/json\u3002</li> <li>\u5728SpringMVC\u5de5\u7a0b\u4f7f\u7528@RequestBody\u9700\u8981\u5148\u5f15\u5165\u89e3\u6790JSON\u7684\u4f9d\u8d56\u3002</li> </ul> <p>Text Only<pre><code>POST http://127.0.0.1:8080/01_hello_springmvc_war_exploded/addBook02\nContent-Type: application/json\n\n{\n\u00a0\u00a0\"id\": 1,\n\u00a0\u00a0\"bookName\": \"\u897f\u6e38\u8bb0\",\n\u00a0\u00a0\"author\": \"\u5434\u627f\u6069\",\n\u00a0\u00a0\"address\": {\n\u00a0\u00a0\u00a0\u00a0\"province\": \"\u5e7f\u4e1c\u7701\",\n\u00a0\u00a0\u00a0\u00a0\"city\": \"\u5e7f\u5dde\u5e02\"\n\u00a0\u00a0},\n\u00a0\u00a0\"price\": 8.8\n}\n</code></pre> Text Only<pre><code>@RequestMapping(value = \"/addBook02\")\npublic String addBook02(`@RequestBody` Book book) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(book);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>\u4e8c\u3001\u83b7\u53d6\u8bf7\u6c42\u5934\u4e2d\u7684\u4fe1\u606f 1\u3001@RequestHeader \u83b7\u53d6\u8bf7\u6c42\u5934\u4e2d\u7684\u4fe1\u606f\uff0c@RequestHeader\u6ce8\u89e3\u4e00\u5171\u6709\u4e09\u4e2a\u5c5e\u6027\uff1a</p> <ul> <li>value\uff1a\u6307\u5b9a\u8981\u83b7\u53d6\u7684\u8bf7\u6c42\u5934\u4e2d\u7684key\u3002</li> <li>required\uff1a\u9ed8\u8ba4\u503c\u4e3atrue\uff0c\u8868\u793a\u8bf7\u6c42\u5934\u5fc5\u987b\u643a\u5e26\u3002</li> <li>defaultValue\uff1a\u6307\u5b9a\u9ed8\u8ba4\u503c\u3002</li> </ul> Text Only<pre><code>@RequestMapping(\"/reqHeader01\")\npublic String getHeader01(@RequestHeader(\"User-Agent\") String userAgent) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(userAgent);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> <p>2\u3001@CookieValue \u83b7\u53d6\u8bf7\u6c42\u5934\u4e2d\u6307\u5b9acookie\u7684\u503c\uff0c@CookieValue\u6ce8\u89e3\u4e00\u5171\u6709\u4e09\u4e2a\u5c5e\u6027\uff1avalue\u3001required\u3001defaultValue\uff0c\u7528\u6cd5\u540c@RequestParam\u3002 Text Only<pre><code>@RequestMapping(\"/cookie\")\npublic String getCookie(@CookieValue(\"JSESSIONID\") String jsessionid) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(jsessionid);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>\u4e09\u3001\u83b7\u53d6\u6574\u4e2a\u8bf7\u6c42\uff08\u5305\u62ec\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\uff09</p> <p>\u4f7f\u7528HttpEntity\u6216\u8005RequestEntity\u4f5c\u4e3a\u5f62\u53c2\u53ef\u4ee5\u83b7\u53d6\u6574\u4e2a\u8bf7\u6c42\uff0c\u5305\u62ec\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u4f53\u3002 Text Only<pre><code>@RequestMapping(\"/httpEntity\")\npublic String httpEntityTest(HttpEntity&lt;String&gt; httpEntity) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"httpEntityHeader:\"+httpEntity.getHeaders());\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"httpEntityBody:\"+httpEntity.getBody());\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> Text Only<pre><code>@RequestMapping(\"/testRequestEntity\")\npublic String testRequestEntity(RequestEntity&lt;String&gt; requestEntity){\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"requestHeader:\"+requestEntity.getHeaders());\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"requestBody:\"+requestEntity.getBody());\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/5-ModelAndView%EF%BC%88%E5%9F%9F%E5%AF%B9%E8%B1%A1%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%20%E4%B8%8E%20%E8%A7%86%E5%9B%BE%EF%BC%89/","title":"5-ModelAndView\uff08\u57df\u5bf9\u8c61\u5171\u4eab\u6570\u636e \u4e0e \u89c6\u56fe\uff09","text":"<p> \u7ea6 3325 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 66 \u5206\u949f</p> <p>\u4e00\u3001\u57df\u5bf9\u8c61\u5171\u4eab\u6570\u636e\uff08Model\uff09 1\u3001\u5411request\u57df\u4e2d\u5bf9\u8c61\u5171\u4eab\u6570\u636e 1.1 \u4f7f\u7528ServletAPI\u5411request\u57df\u5171\u4eab\u6570\u636e\uff08\u4e0d\u5e38\u7528\uff09 Text Only<pre><code>@RequestMapping(\"/testServletAPI\")\npublic String testServletAPI(HttpServletRequest request){\n\u00a0\u00a0\u00a0\u00a0request.setAttribute(\"testScope\", \"hello,servletAPI\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> 1.2 \u4f7f\u7528Model\u5411request\u57df\u5171\u4eab\u6570\u636e Text Only<pre><code>@RequestMapping(\"/testModel\")\npublic String testModel(Model model){\n\u00a0\u00a0\u00a0\u00a0model.addAttribute(\"testScope\", \"hello,Model\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> 1.3 \u4f7f\u7528map\u5411request\u57df\u5171\u4eab\u6570\u636e Text Only<pre><code>@RequestMapping(\"/testMap\")\npublic String testMap(Map&lt;String, Object&gt; map){\n\u00a0\u00a0\u00a0\u00a0map.put(\"testScope\", \"hello,Map\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> 1.4 \u4f7f\u7528ModelMap\u5411request\u57df\u5171\u4eab\u6570\u636e Text Only<pre><code>@RequestMapping(\"/testModelMap\")\npublic String testModelMap(ModelMap modelMap){\n\u00a0\u00a0\u00a0\u00a0modelMap.addAttribute(\"testScope\", \"hello,ModelMap\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> 1.5 \u4f7f\u7528ModelAndView\u5411request\u57df\u5171\u4eab\u6570\u636e Text Only<pre><code>@RequestMapping(\"/testModelAndView\")\npublic ModelAndView testModelAndView(){\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* ModelAndView\u6709Model\u548cView\u7684\u529f\u80fd\n\u00a0\u00a0\u00a0\u00a0\u00a0* Model\u7528\u4e8e\u5411\u8bf7\u6c42\u57df\u5171\u4eab\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0* View\u7528\u4e8e\u8bbe\u7f6e\u89c6\u56fe\uff0c\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0ModelAndView mav = new ModelAndView();\n\u00a0\u00a0\u00a0\u00a0//\u5411\u8bf7\u6c42\u57df\u5171\u4eab\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0mav.addObject(\"testScope\", \"hello,ModelAndView\");\n\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u89c6\u56fe\uff0c\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\n\u00a0\u00a0\u00a0\u00a0mav.setViewName(\"success\");\n\u00a0\u00a0\u00a0\u00a0return mav;\n}\n</code></pre> 1.6\u00a0\u4f7f\u7528@ModelAndAttribute\u5411request\u57df\u5171\u4eab\u6570\u636e \u88ab @ModelAttribute \u6ce8\u89e3\u6807\u6ce8\u7684\u65b9\u6cd5\u4f1a\u5148\u4e8e\u540c\u4e00\u7c7b\u4e2d\u5176\u4ed6@RequestMapping\u65b9\u6cd5\u6267\u884c\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5411Model\u4e2d\u6dfb\u52a0\u6570\u636e\u5c31\u662f\u5728\u5411request\u57df\u5171\u4eab\u6570\u636e\uff0c\u5e76\u4e14\u8be5\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4e5f\u4f1a\u88ab\u5171\u4eab\u5230request\u57df\u3002 Text Only<pre><code>@ModelAttribute\npublic void queryBook(ModelMap modelMap){\n\u00a0\u00a0\u00a0\u00a0Book book = new Book(1, \"\u897f\u6e38\u8bb0\", \"\u5434\u627f\u6069\", null, 99.9);\n\u00a0\u00a0\u00a0\u00a0modelMap.put(\"book\", book);\n}\n</code></pre> Text Only<pre><code>@ModelAttribute\npublic Book queryBook02(){\n\u00a0\u00a0\u00a0\u00a0return new Book(1, \"\u897f\u6e38\u8bb0\", \"\u5434\u627f\u6069\", null, 99.9);\n}\n</code></pre></p> <p>\u5f53\u4f7f\u7528Model\u3001Map\u3001ModelMap\u5411request\u57df\u5171\u4eab\u6570\u636e\u65f6\uff0c\u4f20\u5165\u7684\u53c2\u6570\u7684\u5b9e\u9645\u7c7b\u578b\u5176\u5b9e\u662fBindingAwareModelMap\uff0c\u7136\u540e\u5728\u65b9\u6cd5\u4e2d\u5411BindingAwareModelMap\u6dfb\u52a0\u6570\u636e\uff0c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4f5c\u4e3aView\uff0c\u4e4b\u540eDispatcherServlet\u4f1a\u5c06BindingAwareModelMap\u548cView\u7ec4\u5408\u6210ModelAndView\u5b9e\u73b0\u6570\u636e\u7684\u5c55\u793a\uff0c\u4e0e\u6700\u540e\u4f7f\u7528ModelAndView\u5411request\u57df\u5171\u4eab\u6570\u636e\u7684\u65b9\u5f0f\u4e0d\u8c0b\u800c\u5408\u3002  2\u3001\u5411session\u57df\u5171\u4eab\u6570\u636e 2.1 \u4f7f\u7528ServletAPI\u5411session\u57df\u5171\u4eab\u6570\u636e Text Only<pre><code>@RequestMapping(\"/testSession\")\npublic String testSession(HttpSession session){\n\u00a0\u00a0\u00a0\u00a0session.setAttribute(\"testSessionScope\", \"hello,session\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>2.2 \u4f7f\u7528@SessionAttributes\u6ce8\u89e3\uff08\u4e0d\u5e38\u7528\uff09 @SessionAttributes\u6ce8\u89e3\u9700\u8981\u6807\u6ce8@Controller\u7c7b\u4e0a\uff0cSpringMVC\u4f1a\u628aModel\u4e2d\u6570\u636e\u5728Session\u4e2d\u4e5f\u4fdd\u5b58\u4e00\u4efd\uff08\u53ea\u662f\u6682\u65f6\u4fdd\u5b58\u5728Session\u4e2d\uff08\u5b58\u5165sessionAttributeStore\uff09\uff0c\u4e0d\u662f\u957f\u671f\u4fdd\u5b58\uff0c\u5728Session\u4e2d\u957f\u671f\u4fdd\u5b58\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff09\u3002@SessionAttributes\u6709\u4e24\u4e2a\u5c5e\u6027\uff1a</p> <ul> <li>value\uff1a\u628aModel\u4e2d\u7279\u5b9a\u5c5e\u6027\u540d\u7684\u6570\u636e\u5b58\u5230Session\u4e2d\u3002</li> <li>type\uff1a\u628aModel\u4e2d\u7279\u5b9a\u7c7b\u578b\u7684\u6570\u636e\u5b58\u5230Session\u4e2d\u3002</li> <li>value\u548ctype\u4e4b\u95f4\u662f\u5e76\u96c6\u5173\u7cfb</li> </ul> <p>\u4f8b\u5982\uff1a</p> <ul> <li>@SessionAttributes(types=User.class)\u4f1a\u5c06model\u4e2d\u6240\u6709\u7c7b\u578b\u4e3a User\u7684\u5c5e\u6027\u6dfb\u52a0\u5230\u4f1a\u8bdd\u4e2d\u3002</li> <li>@SessionAttributes(value={\u201cuser1\u201d, \u201cuser2\u201d}) \u4f1a\u5c06model\u4e2d\u5c5e\u6027\u540d\u4e3auser1\u548cuser2\u7684\u5c5e\u6027\u6dfb\u52a0\u5230\u4f1a\u8bdd\u4e2d\u3002</li> <li>@SessionAttributes(types={User.class, Dept.class}) \u4f1a\u5c06model\u4e2d\u6240\u6709\u7c7b\u578b\u4e3a User\u548cDept\u7684\u5c5e\u6027\u6dfb\u52a0\u5230\u4f1a\u8bdd\u4e2d\u3002</li> <li>@SessionAttributes(value={\u201cuser1\u201d,\u201cuser2\u201d}, types={Dept.class})\u4f1a\u5c06model\u4e2d\u5c5e\u6027\u540d\u4e3auser1\u548cuser2\u4ee5\u53ca\u7c7b\u578b\u4e3aDept\u7684\u5c5e\u6027\u6dfb\u52a0\u5230\u4f1a\u8bdd\u4e2d\u3002</li> </ul> Text Only<pre><code>@Controller\n@SessionAttributes(value={\"user\"})\npublic class UserController {\n\u00a0\u00a0\u00a0\u00a0@RequestMapping(\"/testSessionAttributes\")\n\u00a0\u00a0\u00a0\u00a0public String testSessionAttributes(Model model){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0User user = new User(\"jack\",\"123456\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0model.addAttribute(\"user\", user); //\u540c\u65f6\u4f1a\u88ab\u653e\u5230Session\u57df\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"success\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>3\u3001\u5411application\u57df\u5171\u4eab\u6570\u636e\uff08\u4e0d\u5e38\u7528\uff09 Text Only<pre><code>@RequestMapping(\"/testApplication\")\npublic String testApplication(HttpSession session){\n\u00a0\u00a0\u00a0\u00a0ServletContext application = session.getServletContext();\n\u00a0\u00a0\u00a0\u00a0application.setAttribute(\"testApplicationScope\", \"hello,application\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>\u4e8c\u3001\u83b7\u53d6\u57df\u5bf9\u8c61\u4e2d\u7684\u6570\u636e 1\u3001@ModelAttribute \u88ab @ModelAttribute \u6ce8\u89e3\u6807\u6ce8\u7684\u5f62\u53c2\u53ef\u4ee5\u83b7\u53d6Model\u4e2d\u6307\u5b9a\u7684\u6570\u636e\uff0c\u4e0d\u6307\u5b9a@ModelAttribute \u6ce8\u89e3\u7684value\u503c\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7c7b\u540d\u9996\u5b57\u6bcd\u5c0f\u5199\u540e\u4f5c\u4e3akey\u4eceModel\u4e2d\u83b7\u53d6\u6570\u636e\u3002 Text Only<pre><code>@RequestMapping(\"/ModelAndView\")\npublic String modelAndViewTest(@ModelAttribute(\"book\") Book book, Model model){\n\u00a0 \u00a0\u00a0System.out.println(book);\n\u00a0\u00a0\u00a0\u00a0return\u00a0\"success\";\n}\n</code></pre> \u6ce8\u610f\uff1a</p> <ul> <li>\u4e0d\u4f7f\u7528@ModelAttribute \u6ce8\u89e3\uff0c\u5982\u679c\u8bf7\u6c42\u4f53\u4e0d\u80fd\u7ed9\u81ea\u5b9a\u4e49\u5b9e\u4f53\u7c7b\u5bf9\u8c61\u8d4b\u503c\uff0c\u5219\u4e5f\u4f1a\u5728Model\u4e2d\u518d\u627e\u4e00\u627e\uff0c\u5982\u679c\u4f7f\u7528\u4e86@ModelAttribute\u5219\u76f4\u63a5\u5728Model\u4e2d\u627e\u3002</li> <li>\u4ece\u4e00\u4e2aController\u65b9\u6cd5\u4ee5\u8f6c\u53d1\u7684\u65b9\u5f0f\u8bbf\u95ee\u53e6\u5916\u4e00\u4e2aController\u65b9\u6cd5\uff0c\u5e76\u4e0d\u4f1a\u4f20\u9012Model\uff0c\u56e0\u4e3a\u5728\u8f6c\u53d1\u4e4b\u524dModel\u628a\u6570\u636e\u8bbe\u7f6e\u5230\u4e86Request\u4e2d\u4e4b\u540eModelAndView\u5c31\u9500\u6bc1\u4e86\uff0c\u7136\u540e\u6bcf\u6b21\u8bf7\u6c42\u7ecf\u5386\u5230doDispatch\u65b9\u6cd5\u90fd\u4f1a\u518d\u91cd\u65b0\u521b\u5efaModelAndView\uff0c\u6240\u4ee5@ModelAttribute\u6ce8\u89e3\u6807\u6ce8\u5728\u5f62\u53c2\u4e0a\u4ec5\u4ec5\u662f\u7528\u6765\u4e0e@ModelAttribute\u6807\u6ce8\u5728\u65b9\u6cd5\u4e0a\u4e00\u8d77\u4f7f\u7528\u7684\u3002</li> </ul> <p>2\u3001@SessionAttribute @SessionAttribute\u6ce8\u89e3\u6807\u6ce8\u5728\u5f62\u53c2\u4e0a\u7528\u4e8e\u83b7\u53d6Session\u57df\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u6307\u5b9a@SessionAttribute\u6ce8\u89e3\u7684value\u503c\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7c7b\u540d\u9996\u5b57\u6bcd\u5c0f\u5199\u540e\u4f5c\u4e3akey\u4eceSession\u57dfl\u4e2d\u83b7\u53d6\u6570\u636e\u3002 Text Only<pre><code>@RequestMapping(\"/addBook02\")\npublic String addBook02(@SessionAttribute(\"book\") Book book) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(book);\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p> <p>\u4e09\u3001\u89c6\u56fe\uff08View\uff09 1\u3001InternalResourceViewResolver SpringMVC\u9ed8\u8ba4\u4f7f\u7528InternalResourceViewResolver\uff0c\u5728springmvc.xml\u4e2d\u914d\u7f6eInternalResourceViewResolver\u7684\u524d\u540e\u7f00\uff08\u4e0d\u914d\u7f6e\u4e5f\u4f1a\u6709\u8fd9\u4e2aBean\uff0c\u53ea\u4e0d\u8fc7\u6ca1\u6709\u524d\u540e\u7f00\uff09\u3002 Text Only<pre><code>&lt;!-- \u914d\u7f6e\u8bd5\u56fe\u89e3\u91ca\u5668\uff0c\u5e2e\u6211\u4eec\u62fc\u63a5\u5730\u5740 --&gt;\n&lt;bean id=\"internalResourceViewResolver\" class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"&gt;\n\u00a0\u00a0&lt;property name=\"prefix\" value=\"/WEB-INF/pages/\"/&gt;\n\u00a0\u00a0&lt;property name=\"suffix\" value=\".jsp\"/&gt;\n&lt;/bean&gt;\n</code></pre> \u7136\u540eController\u65b9\u6cd5\u4e2d\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u4f1a\u4f5c\u4e3aviewName\uff0c\u4e5f\u5c31\u662fjsp\u9875\u9762\u7684\u540d\u5b57\uff0c\u89c6\u56fe\u89e3\u6790\u5668\u4f1a\u62fc\u63a5\u524d\u540e\u7f00\u5f97\u5230jsp\u9875\u9762\u7684\u8def\u5f84\uff0c\u5373/WEB-INF/pages/viewName.jsp\uff0c\u6700\u540e\u628aModel\u4e2d\u7684\u6570\u636e\u6e32\u67d3\u5230view\u4e0a\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\u3002 Text Only<pre><code>@RequestMapping(\"/hello\")\npublic String hello(){\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"hello springmvc....\");\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre> \u5982\u679c\u00a0Controller\u65b9\u6cd5\u4ec5\u4ec5\u662f\u7528\u6765\u8fdb\u884c\u9875\u9762\u8df3\u8f6c\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528view-controller\u6807\u7b7e\u8fdb\u884c\u8868\u793a\uff1a Text Only<pre><code>&lt;!--\n\u00a0\u00a0\u00a0\u00a0path\uff1a\u8bbe\u7f6e\u5904\u7406\u7684\u8bf7\u6c42\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0view-name\uff1a\u8bbe\u7f6e\u8bf7\u6c42\u5730\u5740\u6240\u5bf9\u5e94\u7684\u89c6\u56fe\u540d\u79f0\n--&gt;\n&lt;mvc:view-controller path=\"/hello\" view-name=\"success\"&gt;&lt;/mvc:view-controller&gt;\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53SpringMVC\u4e2d\u8bbe\u7f6e\u4efb\u4f55\u4e00\u4e2aview-controller\u65f6\uff0c\u5176\u5b83Controller\u4e2d\u7684\u8bf7\u6c42\u6620\u5c04\u5c06\u5168\u90e8\u5931\u6548\uff0c\u6b64\u65f6\u9700\u8981\u5728SpringMVC\u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5f00\u542fmvc\u6ce8\u89e3\u9a71\u52a8\u7684\u6807\u7b7e\uff1a Text Only<pre><code>&lt;mvc:annotation-driven/&gt;\n</code></pre> jsp\u9875\u9762\u653e\u5728WEB-INF\u76ee\u5f55\u662f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7684\uff0c\u4e0d\u7528\u914d\u7f6eURL\u4e0e\u8d44\u6e90\u8def\u5f84\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4f46\u662f\u4e0d\u8fd9\u6837\u505a\uff0c\u53cd\u800c\u628ajsp\u9875\u9762\u653e\u5728WEB-INF\u76ee\u5f55\u4e0b\uff0c\u5fc5\u987b\u7ecf\u8fc7DispatcherServlet\u7684\u8f6c\u53d1\uff0c\u8fd9\u6837\u505a\u7684\u539f\u56e0\u662f\uff0c\u672c\u6765\u5c31\u4e0d\u5e94\u8be5\u76f4\u63a5\u8bbf\u95eejsp\u9875\u9762\uff0c\u56e0\u4e3ajsp\u662f\u52a8\u6001\u9875\u9762\uff0c\u7528\u6765\u52a8\u6001\u5730\u5c55\u793a\u6570\u636e\uff0c\u76f4\u63a5\u8bbf\u95ee\u6ca1\u6709\u643a\u5e26\u6570\u636e\uff0cjsp\u9875\u9762\u5c31\u4e71\u4e86\uff0c\u6240\u4ee5\u5728\u76f4\u63a5\u4f7f\u7528Servlet\u5f00\u53d1\u7684\u65f6\u5019\uff0c\u4f1a\u8ba9index.jsp\u9875\u9762\u8f6c\u53d1\u8bf7\u6c42\u5230servlet\u4e2d\uff0c\u73b0\u5728\u5728SpringMVC\u4e2d\u6211\u4eec\u5c31\u6362\u4e86\u4e00\u79cd\u601d\u8def\uff0c\u628ajsp\u9875\u9762\u653e\u5728WEB-INF\u76ee\u5f55\u4e0b\uff0c\u4e0d\u8ba9\u76f4\u63a5\u8bbf\u95ee\uff0c\u5fc5\u987b\u7ecf\u8fc7DispatcherServlet\u7684\u8f6c\u53d1\uff0c\u8f6c\u53d1\u4e00\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u4e86\uff0c\u4e8c\u662f\u53ef\u4ee5\u8bbf\u95eeWEB-INF\u76ee\u5f55\u4e0b\u7684\u8d44\u6e90\u3002 \u5982\u679c\u8981\u8f6c\u53d1\u8bf7\u6c42\uff0c\u5219\u4e3a\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u52a0\u4e0a\u524d\u7f00forward: Text Only<pre><code>/**\n* \u524d\u7f00 forward: \u8bf7\u6c42\u8f6c\u53d1\uff0c\u4e0d\u4f1a\u62fc\u4e32\uff0c\u4ece\u5de5\u7a0b\u8def\u5f84\u6839\u5f00\u59cb\n*/\n@RequestMapping(\"/forward01\")\npublic String forward01(){\n\u00a0\u00a0\u00a0\u00a0return \"forward:/WEB-INF/pages/success.jsp\";\n}\n</code></pre> \u5982\u679c\u8981\u91cd\u5b9a\u5411\uff0c\u5219\u4e3a\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u52a0\u4e0a\u524d\u7f00forward: Text Only<pre><code>/**\n* \u524d\u7f00 redirect: \u8bf7\u6c42\u91cd\u5b9a\u5411\uff0c\u4e0d\u4f1a\u62fc\u4e32\uff0c\u4e5f\u662f\u4ece\u5de5\u7a0b\u8def\u5f84\u6839\u5f00\u59cb\n*/\n@RequestMapping(\"/redirect01\")\npublic String redirect01(){\n\u00a0\u00a0\u00a0\u00a0return \"redirect:/hello\";\n}\n</code></pre> DispatcherServlet 1360\u884c\u7684render\u65b9\u6cd5\uff0c\u9996\u5148\u4f1a\u89e3\u6790viewName\u5f97\u5230View\uff0c\u7136\u540e\u8c03\u7528View\u7684render\u65b9\u6cd5\u8fdb\u884c\u6e32\u67d3\u3002 Text Only<pre><code>protected void render(`ModelAndView mv`, HttpServletRequest request, HttpServletResponse response) throws Exception {\n\u00a0\u00a0\u00a0\u00a0// Determine locale for request and apply it to the response.\n\u00a0\u00a0\u00a0\u00a0Locale locale =\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(this.localeResolver != null ? this.localeResolver.resolveLocale(request) : request.getLocale());\n\u00a0\u00a0\u00a0\u00a0response.setLocale(locale);\n\n\u00a0\u00a0\u00a0\u00a0View view;\n\u00a0\u00a0\u00a0\u00a0`String viewName = mv.getViewName();`\n\u00a0\u00a0\u00a0\u00a0if (viewName != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// We need to resolve the view name.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`view = resolveViewName(viewName, mv.getModelInternal(), locale, request); //\u89e3\u6790viewName\u83b7\u5f97View`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new ServletException(\"Could not resolve view with name '\" + mv.getViewName() +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"' in servlet with name '\" + getServletName() + \"'\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// No need to lookup: the ModelAndView object contains the actual View object.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view = mv.getView();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new ServletException(\"ModelAndView [\" + mv + \"] neither contains a view name nor a \" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"View object in servlet with name '\" + getServletName() + \"'\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// Delegate to the View object for rendering.\n\u00a0\u00a0\u00a0\u00a0if (logger.isTraceEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.trace(\"Rendering view [\" + view + \"] \");\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (mv.getStatus() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setStatus(mv.getStatus().value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`view.render(mv.getModelInternal(), request, response); //\u8c03\u7528View\u7684render\u65b9\u6cd5\u8fdb\u884c\u6e32\u67d3\uff08\u6e32\u67d3\u7684\u610f\u601d\u662f\u6307\u751f\u6210HTML\u9875\u9762\uff09`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0catch (Exception ex) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"Error rendering view [\" + view + \"]\", ex);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw ex;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> resolveViewName\u65b9\u6cd5\u5728DispatcherServlet\u76841429\u884c\uff0c\u5faa\u73af\u8c03\u7528ViewResolver\u7684resolveViewName\u65b9\u6cd5\u89e3\u6790viewName\u5f97\u5230View Text Only<pre><code>protected View resolveViewName(String viewName, @Nullable Map&lt;String, Object&gt; model,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Locale locale, HttpServletRequest request) throws Exception {\n\u00a0\u00a0\u00a0\u00a0if (this.viewResolvers != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ViewResolver viewResolver : this.viewResolvers) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `View view = viewResolver.resolveViewName(viewName, locale);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return view;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return null;\n}\n</code></pre> resolveViewName\u65b9\u6cd5\u5148\u5728\u7f13\u5b58\u91cc\u627eView\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u627e\u5230\u5c31\u521b\u5efa\uff0c\u521b\u5efa\u5b8c\u4e4b\u540e\u8fd8\u4f1a\u653e\u5230\u7f13\u5b58\u91cc\u3002 Text Only<pre><code>public View resolveViewName(String viewName, Locale locale) throws Exception {\n\u00a0\u00a0\u00a0\u00a0if (!isCache()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return createView(viewName, locale);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object cacheKey = getCacheKey(viewName, locale);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0View view = this.viewAccessCache.get(cacheKey);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0synchronized (this.viewCreationCache) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view = this.viewCreationCache.get(cacheKey);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Ask the subclass to create the View object.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`view = createView(viewName, locale);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view == null &amp;&amp; this.cacheUnresolved) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view = UNRESOLVED_VIEW;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (view != null &amp;&amp; this.cacheFilter.filter(view, viewName, locale)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.viewAccessCache.put(cacheKey, view);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.viewCreationCache.put(cacheKey, view);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isTraceEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.trace(formatKey(cacheKey) + \"served from cache\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return (view != UNRESOLVED_VIEW ? view : null);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u521b\u5efaView\u7684\u5173\u952e\u903b\u8f91\uff0c\u5982\u679c\u4ee5\"redirect:\"\u5f00\u5934\u5219\u6700\u540e\u521b\u5efa\u7684\u662fRedirectView\uff0c\u5982\u679c\u4ee5\"forward:\"\u5f00\u5934\uff0c\u6700\u540e\u521b\u5efa\u7684\u662fInternalResourceView\uff0cURL\u5730\u5740\u5c31\u662f\u53bb\u6389\u524d\u7f00\u4e4b\u540e\u7684\u5730\u5740\u3002\u5982\u679c\u90fd\u4e0d\u662f\uff0c\u7ee7\u7eedcreateView\u3002 Text Only<pre><code>protected View createView(String viewName, Locale locale) throws Exception {\n\u00a0\u00a0\u00a0\u00a0// If this resolver is not supposed to handle the given view,\n\u00a0\u00a0\u00a0\u00a0// return null to pass on to the next resolver in the chain.\n\u00a0\u00a0\u00a0\u00a0if (!canHandle(viewName, locale)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// Check for special \"redirect:\" prefix.\n\u00a0\u00a0\u00a0\u00a0if (viewName.startsWith(REDIRECT_URL_PREFIX)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String redirectUrl = viewName.substring(REDIRECT_URL_PREFIX.length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`RedirectView view = new RedirectView(redirectUrl,`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isRedirectContextRelative(), isRedirectHttp10Compatible());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] hosts = getRedirectHosts();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (hosts != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view.setHosts(hosts);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return applyLifecycleMethods(REDIRECT_URL_PREFIX, view);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// Check for special \"forward:\" prefix.\n\u00a0\u00a0\u00a0\u00a0if (viewName.startsWith(FORWARD_URL_PREFIX)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String forwardUrl = viewName.substring(FORWARD_URL_PREFIX.length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`InternalResourceView view = new InternalResourceView(forwardUrl);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return applyLifecycleMethods(FORWARD_URL_PREFIX, view);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// Else fall back to superclass implementation: calling loadView.\n\u00a0\u00a0\u00a0\u00a0return super.createView(viewName, locale);\n}\n</code></pre> createView\u65b9\u6cd5\u9996\u5148\u521b\u5efa\u4e86\u4e00\u4e2aView\uff0cInternalResourceViewResolver\u521b\u5efa\u7684\u662fInternalResourceView\uff0c\u7136\u540eURL\u5730\u5740\u662fviewName\u52a0\u4e0a\u524d\u540e\u7f00\u7684\u7ed3\u679c\u3002 Text Only<pre><code>protected AbstractUrlBasedView buildView(String viewName) throws Exception {\n\u00a0\u00a0\u00a0\u00a0`AbstractUrlBasedView view = instantiateView();`\n\u00a0\u00a0\u00a0\u00a0`view.setUrl(getPrefix() + viewName + getSuffix());`\n\u00a0\u00a0\u00a0\u00a0view.setAttributesMap(getAttributesMap());\n\n\u00a0\u00a0\u00a0\u00a0String contentType = getContentType();\n\u00a0\u00a0\u00a0\u00a0if (contentType != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view.setContentType(contentType);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0String requestContextAttribute = getRequestContextAttribute();\n\u00a0\u00a0\u00a0\u00a0if (requestContextAttribute != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view.setRequestContextAttribute(requestContextAttribute);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0Boolean exposePathVariables = getExposePathVariables();\n\u00a0\u00a0\u00a0\u00a0if (exposePathVariables != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view.setExposePathVariables(exposePathVariables);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0Boolean exposeContextBeansAsAttributes = getExposeContextBeansAsAttributes();\n\u00a0\u00a0\u00a0\u00a0if (exposeContextBeansAsAttributes != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view.setExposeContextBeansAsAttributes(exposeContextBeansAsAttributes);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0String[] exposedContextBeanNames = getExposedContextBeanNames();\n\u00a0\u00a0\u00a0\u00a0if (exposedContextBeanNames != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0view.setExposedContextBeanNames(exposedContextBeanNames);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0return view;\n}\n</code></pre> DispatcherServlet1393\u884c\u8c03\u7528View\u7684render\u65b9\u6cd5\u8fdb\u884c\u6e32\u67d3\u3002InternalResourceView\u9996\u5148\u662f\u5408\u5e76HttpServletRequest\u548cModel\u4e2d\u7684\u6570\u636e\uff0c\u7136\u540e\u5c31\u662f\u5c06\u5408\u5e76\u540e\u7684\u6570\u636emergedModel\u5728view\u4e2d\u5c55\u793a\u3002 Text Only<pre><code>public void render(@Nullable Map&lt;String, ?&gt; model, HttpServletRequest request,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpServletResponse response) throws Exception {\n\n\u00a0\u00a0\u00a0\u00a0if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"View \" + formatViewName() +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", model \" + (model != null ? model : Collections.emptyMap()) +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(this.staticAttributes.isEmpty() ? \"\" : \", static attributes \" + this.staticAttributes));\n\u00a0\u00a0\u00a0\u00a0}\n\n `Map&lt;String, Object&gt; mergedModel = createMergedOutputModel(model, request, response); //\u5408\u5e76HttpServletRequest\u548cModel\u4e2d\u7684\u6570\u636e`\n\u00a0\u00a0\u00a0\u00a0prepareResponse(request, response);\n\u00a0\u00a0\u00a0 `renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);\u00a0 //\u5c06\u5408\u5e76\u540e\u7684\u6570\u636emergedModel\u5728view\u4e2d\u5c55\u793a`\n}\n</code></pre> InternalResourceView\u5c06\u6570\u636e\u5c55\u793a\u5230view\u4e2d\u7684\u903b\u8f91\u662f\uff0c\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u62fc\u63a5\u5f97\u5230\u7684URL\u5730\u5740\u3002\u8fd9\u91cc\u662f\u91cd\u70b9\uff0c\u8f6c\u53d1\u4e4b\u540e\u4f1a\u91cd\u65b0\u8d70Tomcat\u7684servlet-mapping\uff0c\u56e0\u4e3aDispatcherServlet\u4e0d\u4f1a\u62e6\u622a.jsp\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5\u4f1a\u9ed8\u8ba4\u4ea4\u7ed9Tomcat\u7684JspServlet\u5904\u7406\uff0c\u4e8e\u662f\u5c31\u6b63\u786e\u5730\u54cd\u5e94\u4e86JSP\u9875\u9762\u3002\u76f8\u5e94\u5730\uff0cRedirectView\u7684\u6e32\u67d3\u903b\u8f91\u5c31\u662f\u91cd\u5b9a\u5411\u3002 Text Only<pre><code>@Override\nprotected void renderMergedOutputModel(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception {\n\n\u00a0\u00a0\u00a0\u00a0// Expose the model object as request attributes.\n\u00a0\u00a0\u00a0\u00a0exposeModelAsRequestAttributes(model, request);\n\n\u00a0\u00a0\u00a0\u00a0// Expose helpers as request attributes, if any.\n\u00a0\u00a0\u00a0\u00a0exposeHelpers(request);\n\n\u00a0\u00a0\u00a0\u00a0// Determine the path for the request dispatcher.\n\u00a0\u00a0\u00a0\u00a0String dispatcherPath = prepareForRendering(request, response);\n\n\u00a0\u00a0\u00a0\u00a0// Obtain a RequestDispatcher for the target resource (typically a JSP).\n `RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);`\n\u00a0\u00a0\u00a0\u00a0if (rd == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new ServletException(\"Could not get RequestDispatcher for [\" + getUrl() +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"]: Check that the corresponding file exists within your web application archive!\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// If already included or response already committed, perform include, else forward.\n\u00a0\u00a0\u00a0\u00a0if (useInclude(request, response)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setContentType(getContentType());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"Including [\" + getUrl() + \"]\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`rd.include(request, response);`\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Note: The forwarded resource is supposed to determine the content type itself.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"Forwarding to [\" + getUrl() + \"]\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`rd.forward(request, response);`\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2\u3001ThymeleafViewResolver \u5f15\u5165thymeleaf\u89c6\u56fe\u524d\u9700\u8981\u5bfc\u5165Thymeleaf\u7684\u5305\uff0c\u56e0\u4e3aThymeleaf\u89c6\u56fe\u662f\u7b2c\u4e09\u65b9\u7684\uff0c\u4e0d\u662fSpringMVC\u81ea\u5e26\u7684\uff1a Text Only<pre><code>&lt;dependencies&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!-- Spring5\u548cThymeleaf\u6574\u5408\u5305 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;thymeleaf-spring5&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.12.RELEASE&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre> \u914d\u7f6eThymeleaf\u89c6\u56fe\u89e3\u6790\u5668 Text Only<pre><code>&lt;!-- \u914d\u7f6eThymeleaf\u89c6\u56fe\u89e3\u6790\u5668 --&gt;\n&lt;bean id=\"viewResolver\" class=\"org.thymeleaf.spring5.view.ThymeleafViewResolver\"&gt;\n\u00a0\u00a0&lt;property name=\"order\" value=\"1\"/&gt;\n\u00a0\u00a0&lt;property name=\"characterEncoding\" value=\"UTF-8\"/&gt;\n\u00a0\u00a0&lt;property name=\"templateEngine\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"org.thymeleaf.spring5.SpringTemplateEngine\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"templateResolver\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;bean class=\"org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- \u89c6\u56fe\u524d\u7f00 --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"prefix\" value=\"/WEB-INF/templates/\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!-- \u89c6\u56fe\u540e\u7f00 --&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"suffix\" value=\".html\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"templateMode\" value=\"HTML5\"/&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;property name=\"characterEncoding\" value=\"UTF-8\" /&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/bean&gt;\n\u00a0\u00a0&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre> ThymeleafViewResolver\u7684createView\u65b9\u6cd5\u5982\u679c\u4ee5\"redirect:\"\u5f00\u5934\u5219\u6700\u540e\u521b\u5efa\u7684\u662fRedirectView\uff0c\u5982\u679c\u4ee5\"forward:\"\u5f00\u5934\uff0c\u6700\u540e\u521b\u5efa\u7684\u662fInternalResourceView\uff0cURL\u5730\u5740\u662f\u53bb\u6389\u524d\u7f00\u4e4b\u540e\u7684\u5730\u5740\u3002\u5982\u679c\u90fd\u4e0d\u662f\u5219loadView\u521b\u5efaThymeleafView\u3002\u6700\u540e\u6e32\u67d3\u89c6\u56fe\u4f7f\u7528\u7684\u662fThymeleafView\u7684render\u65b9\u6cd5\uff08\u548cjsp\u9875\u9762\u7684\u89e3\u6790\u4e00\u6837\uff0c\u4f46\u662f\u4ece\u6e90\u7801\u4e0a\u770b\u8fd9\u91cc\u6ca1\u6709\u4f7f\u7528\u8f6c\u53d1\u7684\u65b9\u5f0f\uff0c\u800c\u662f\u76f4\u63a5\u62ffModel\u4e2d\u7684\u6570\u636e\u6e32\u67d3\uff0c\u4e0e\u8f6c\u53d1\u7684\u65b9\u5f0f\u7684\u533a\u522b\u5728\u4e8e\uff0c\u8f6c\u53d1\u76f8\u5f53\u4e8e\u5728\u670d\u52a1\u5668\u5185\u4e8c\u6b21\u8bf7\u6c42\u4e86\uff0c\u901a\u8fc7Request\u5bf9\u8c61\u4f20\u9012\u6570\u636e\u3002\uff09 Text Only<pre><code>@Override\nprotected View createView(final String viewName, final Locale locale) throws Exception {\n\u00a0\u00a0\u00a0\u00a0// First possible call to check \"viewNames\": before processing redirects and forwards\n\u00a0\u00a0\u00a0\u00a0if (!this.alwaysProcessRedirectAndForward &amp;&amp; !canHandle(viewName, locale)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vrlogger.trace(\"[THYMELEAF] View \\\"{}\\\" cannot be handled by ThymeleafViewResolver. Passing on to the next resolver in the chain.\", viewName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0// Process redirects (HTTP redirects)\n\u00a0\u00a0\u00a0\u00a0if (viewName.startsWith(REDIRECT_URL_PREFIX)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vrlogger.trace(\"[THYMELEAF] View \\\"{}\\\" is a redirect, and will not be handled directly by ThymeleafViewResolver.\", viewName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0final String redirectUrl = viewName.substring(REDIRECT_URL_PREFIX.length(), viewName.length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`final RedirectView view = new RedirectView(redirectUrl, isRedirectContextRelative(), isRedirectHttp10Compatible());`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return (View) getApplicationContext().getAutowireCapableBeanFactory().initializeBean(view, REDIRECT_URL_PREFIX);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0// Process forwards (to JSP resources)\n\u00a0\u00a0\u00a0\u00a0if (viewName.startsWith(FORWARD_URL_PREFIX)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// The \"forward:\" prefix will actually create a Servlet/JSP view, and that's precisely its aim per the Spring\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// documentation. See http://docs.spring.io/spring-framework/docs/4.2.4.RELEASE/spring-framework-reference/html/mvc.html#mvc-redirecting-forward-prefix\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vrlogger.trace(\"[THYMELEAF] View \\\"{}\\\" is a forward, and will not be handled directly by ThymeleafViewResolver.\", viewName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0final String forwardUrl = viewName.substring(FORWARD_URL_PREFIX.length(), viewName.length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`return new InternalResourceView(forwardUrl);`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0// Second possible call to check \"viewNames\": after processing redirects and forwards\n\u00a0\u00a0\u00a0\u00a0if (this.alwaysProcessRedirectAndForward &amp;&amp; !canHandle(viewName, locale)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0vrlogger.trace(\"[THYMELEAF] View \\\"{}\\\" cannot be handled by ThymeleafViewResolver. Passing on to the next resolver in the chain.\", viewName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0vrlogger.trace(\"[THYMELEAF] View {} will be handled by ThymeleafViewResolver and a \" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"{} instance will be created for it\", viewName, getViewClass().getSimpleName());\n\u00a0\u00a0\u00a0\u00a0return `loadView(viewName, locale);`\n}\n</code></pre></p> <p>3\u3001\u81ea\u5b9a\u4e49\u89c6\u56fe\u89e3\u6790\u5668 \u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u89c6\u56fe\uff08View\uff09\u548c\u89c6\u56fe\u89e3\u6790\u5668\uff08ViewResolver\uff09 Text Only<pre><code>/**\n* \u81ea\u5b9a\u4e49\u89c6\u56fe\u89e3\u6790\u5668MyViewResolver\u89e3\u6790\u81ea\u5b9a\u4e49\u7684\u524d\u7f00\uff0c\u521b\u5efa\u81ea\u5b9a\u4e49\u89c6\u56feMyView\n*/\npublic class MyViewResolver implements ViewResolver, Ordered {\n\n\u00a0\u00a0\u00a0\u00a0Integer order;\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u89e3\u6790\u81ea\u5b9a\u4e49\u7684\u524d\u7f00\n\u00a0\u00a0\u00a0\u00a0\u00a0* @param viewName \u89c6\u56fe\u540d\uff0c\u4f20\u8fdb\u6765\u7684\u662fModelAndView\u7684view\uff0c\u4e5f\u5c31\u662f\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public View resolveViewName(String viewName, Locale locale) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (viewName.startsWith(\"myPrefix:\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String url = viewName.substring(\"myPrefix:\".length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new MyView(url);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u8fd9\u4e2a\u89c6\u56fe\u89e3\u6790\u5668\u4e0d\u80fd\u5904\u7406viewName\uff0c\u5c31\u8fd4\u56denull\uff0c\u524d\u7aef\u63a7\u5236\u5668\u7684processDispatchResult()\u4f1a\u8ba9\u4e0b\u4e00\u4e2a\u89c6\u56fe\u89e3\u6790\u5668\u5c1d\u8bd5\u7740\u7ee7\u7eed\u89e3\u6790\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//setter\u65b9\u6cd5\u662f\u5728\u5c06\u8fd9\u4e2a\u89c6\u56fe\u89e3\u6790\u5668\u653e\u8fdbioc\u5bb9\u5668\u4e2d\u65f6\u65b9\u4fbf\u8bbe\u7f6e\u503c\n\u00a0\u00a0\u00a0\u00a0public void setOrder(Integer order) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.order = order;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0 \u00a0 /**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u89c6\u56fe\u89e3\u6790\u5668\u7684\u4f18\u5148\u7ea7\uff0c\u8981\u60f3\u524d\u7aef\u63a7\u5236\u5668\u80fd\u5f97\u5230\u89c6\u56fe\u89e3\u6790\u5668\u7684\u4f18\u5148\u7ea7\uff0c\u5fc5\u987b\u5b9e\u73b0Ordered\u63a5\u53e3\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u9ed8\u8ba4\u7684InternalResourceViewResolver\u7684order\u662fInteger.MAX_VALUE\uff0c\u5373\u4f18\u5148\u7ea7\u6700\u4f4e\u7684\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5\u53ea\u8981\u8fd9\u4e2a\u89c6\u56fe\u89e3\u6790\u5668\u7684order\u5c0f\u4e8eInteger.MAX_VALUE\u5373\u53ef\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int getOrder() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return order;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>/**\n* \u81ea\u5b9a\u4e49\u89c6\u56feMyView\u5b9e\u73b0\u81ea\u5df1\u60f3\u8981\u7684\u6e32\u67d3\u903b\u8f91\n*/\npublic class MyView implements View {\n\u00a0\u00a0\u00a0\u00a0String url;\n\n\u00a0\u00a0\u00a0\u00a0public MyView(String url) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.url = url;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void render(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object value1 = model.get(\"key1\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0request.setAttribute(\"key1\", model.get(\"key1\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0request.getRequestDispatcher(\"/WEB-INF/pages/\" + url + \".jsp\").forward(request, response);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/*response.setContentType(\"text/html\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintWriter writer = response.getWriter();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.write(\"&lt;h1&gt;\u6e32\u67d3\u7ed3\u679c\uff1a&lt;/h1\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0writer.write(\"&lt;h1&gt;\"+ value1 +\"&lt;/h1\");*/\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String getContentType() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"text/html\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>/**\n* \u81ea\u5b9a\u4e49\u89c6\u56fe\u548c\u89c6\u56fe\u89e3\u6790\u5668\u6b65\u9aa4\uff1a\n*\u00a0\u00a01.\u81ea\u5b9a\u4e49\u89c6\u56fe\u5b9e\u73b0 View\u63a5\u53e3\uff0c\u4e3b\u8981\u662frender()\u65b9\u6cd5\u7684\u903b\u8f91\n*\u00a0\u00a02.\u81ea\u5b9a\u89c6\u56fe\u89e3\u6790\u5668\u5b9e\u73b0 ViewResolver\u63a5\u53e3 \u548c Ordered\u63a5\u53e3\uff0c\u4e3b\u8981\u662f\u5b9e\u73b0 ViewResolver\u63a5\u53e3\u7684 resolveViewName\u65b9\u6cd5\uff0c\u5373\u5982\u4f55\u89e3\u6790\u89c6\u56fe\u540d\uff0c\u7136\u540e\u521b\u5efaView\u5bf9\u8c61\u5e76\u8fd4\u56de\n*\u00a0\u00a03.\u5c06\u81ea\u5b9a\u4e49\u89c6\u56fe\u89e3\u6790\u5668\u52a0\u5165\u5230ioc\u5bb9\u5668\u4e2d\n*/\n@Controller\npublic class MyViewAndViewResolverTest {\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u4f7f\u7528\u81ea\u5b9a\u4e49\u89c6\u56fe\u89e3\u6790\u5668\u89e3\u6790\u81ea\u5df1\u5b9a\u4e49\u7684\u524d\u7f00\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@RequestMapping(\"/customView\")\n\u00a0\u00a0\u00a0\u00a0public String customView(Model model){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0model.addAttribute(\"key1\", \"value1\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"myPrefix:viewpage\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>&lt;!--\u5c06\u81ea\u5b9a\u4e49\u89c6\u56fe\u89e3\u6790\u5668\u653e\u5230ioc\u5bb9\u5668\u4e2d\uff0c\u8fd9\u6837\u524d\u7aef\u63a7\u5236\u5668\u624d\u80fd\u62ff\u5230--&gt;\n&lt;bean id=\"myViewResolver\" class=\"view.MyViewResolver\"&gt;\n\u00a0\u00a0&lt;property name=\"order\" value=\"1\"/&gt;\n&lt;/bean&gt;\n</code></pre></p> <p>5\u3001\u603b\u7ed3 \u89c6\u56fe\u89e3\u6790\u5668\uff08ViewResolver\uff09\u89e3\u6790viewName\u521b\u5efa\u76f8\u5e94\u7684View\uff0c\u6bcf\u79cdView\u90fd\u6709\u81ea\u5df1\u7684render\u903b\u8f91\u3002\u5176\u4e2dInternalResourceViewResolver\u3001InternalResourceView\u3001RedirectView\u90fd\u662fSpringMVC\u5185\u7f6e\u7684\uff0c InternalResourceView\u7684\u6e32\u67d3\u903b\u8f91\u5c31\u662f\u8f6c\u53d1\uff0cRedirectView\u7684\u6e32\u67d3\u903b\u8f91\u662f\u91cd\u5b9a\u5411\uff08\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u4ed6\u4fe9\u6839\u672c\u5c31\u6ca1\u6e32\u67d3\uff0c\u53ea\u662f\u628a\u751f\u6210\u9875\u9762\u7684\u4efb\u52a1\u4ea4\u7ed9\u4e86\u540e\u9762\u7684\u65b9\u6cd5\u5904\u7406\uff09\u3002ThymeleafViewResolver\u548cThymeleafView\u90fd\u662f\u7b2c\u4e09\u65b9\u63d0\u4f9b\u7684\u3002 InternalResourceViewResolver\uff1a</p> <ul> <li>forward\u524d\u7f00\uff1aInternalResourceView</li> <li>redirect\u524d\u7f00\uff1aRedirectView</li> <li>\u6ca1\u6709\u524d\u7f00\uff1aInternalResourceView</li> </ul> <p>ThymeleafViewResolver\uff1a</p> <ul> <li>forward\u524d\u7f00\uff1aInternalResourceView</li> <li>redirect\u524d\u7f00\uff1aRedirectView</li> <li>\u6ca1\u6709\u524d\u7f00\uff1aThymeleafView</li> </ul>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/6-%E5%BE%80%E5%93%8D%E5%BA%94%E4%BD%93%E4%B8%AD%E5%86%99%E6%95%B0%E6%8D%AE/","title":"6-\u5f80\u54cd\u5e94\u4f53\u4e2d\u5199\u6570\u636e","text":"<p> \u7ea6 326 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>1\u3001\u4f7f\u7528\u539f\u751fServletAPI \u53ef\u4ee5\u5f80\u54cd\u5e94\u6d41\u91cc\u9762\u5199\u4efb\u4f55\u5185\u5bb9 Text Only<pre><code>@RequestMapping(\"/writeToResponse\")\npublic void writeToResponse(HttpServletResponse response) throws IOException {\n\u00a0\u00a0\u00a0\u00a0String body = \"&lt;h1&gt;success&lt;/h1&gt;\";\n\u00a0\u00a0\u00a0\u00a0response.getWriter().write(body);\n}\n</code></pre></p> <p>2\u3001\u4f7f\u7528@ResponseBody @ResponseBody\u6ce8\u89e3\u6807\u6ce8\u5728\u65b9\u6cd5\u4e0a\uff0c\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5c06\u4e0d\u518d\u88ab\u5c01\u88c5\u6210ModelAndView\uff0c\u800c\u662f\u76f4\u63a5\u4f5c\u4e3a\u54cd\u5e94\u4f53\u7684\u5185\u5bb9\uff0c\u800c\u54cd\u5e94\u4f53\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u5f53\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4e0d\u662f\u5b57\u7b26\u4e32\u7684\u65f6\u5019\u9700\u8981\u5bfc\u5165\u8f6c\u6362\u6210JSON\u7684\u4f9d\u8d56\uff08\u8f6c\u6362\u8fc7\u7a0b\u7528\u5230\u4e86HttpMessageConverter\uff0c\u548c@RequestBody\u6ce8\u89e3\u4e00\u6837\uff09\uff0c\u5c06\u5bf9\u8c61\u5e8f\u5217\u5316\u6210JSON\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff08\u4e0d\u662f\u8c03\u7528toString\u65b9\u6cd5\uff09\u3002 Text Only<pre><code>@Controller\n@RequestMapping(value = \"/addBook04\")\n`@ResponseBody`\npublic Book addBook04(@RequestBody Book book) {\n\u00a0\u00a0\u00a0\u00a0System.out.println(book);\n\u00a0\u00a0\u00a0\u00a0return book;\n}\n</code></pre> @ResponseBody\u6ce8\u89e3\u6807\u6ce8\u5728\u7c7b\u4e0a\u76f8\u5f53\u4e8e\u4e3a\u7c7b\u7684\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u52a0\u4e0a\u4e86@ResponseBody</p> <p>3\u3001@RestController\u6ce8\u89e3 @RestController\u6ce8\u89e3\u6807\u6ce8\u662f@Controller\u548c@ResponseBody\u6ce8\u89e3\u7684\u7ed3\u5408\uff0c\u4f5c\u7528\u662f\u6807\u6ce8\u4e00\u4e2a\u7c7b\u662f\u63a7\u5236\u5668\u7c7b\uff0c\u7c7b\u4e2d\u7684\u6bcf\u4e2a\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u76f4\u63a5\u4f5c\u4e3a\u54cd\u5e94\u4f53\u3002 Text Only<pre><code>@RestController\n@RequestMapping(\"/employee\")\npublic class EmployeeController {\n}\n</code></pre></p> <p>4\u3001ResponseEntity ResponseEntity\u4f5c\u4e3a\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u7c7b\u578b\uff0c\u5c31\u662f\u54cd\u5e94\u4f53\u3002 Text Only<pre><code>@RequestMapping(\"/respEntity\")\npublic ResponseEntity&lt;String&gt; responseBody() {\n\u00a0\u00a0\u00a0\u00a0String body = \"&lt;h1&gt;success&lt;/h1&gt;\";\n\u00a0\u00a0\u00a0\u00a0MultiValueMap&lt;String, String&gt; headers = new HttpHeaders();\n\u00a0\u00a0\u00a0\u00a0headers.add(\"Set-Cookie\", \"password=123456\");\n\u00a0\u00a0\u00a0\u00a0return new ResponseEntity&lt;String&gt;(body, headers, HttpStatus.OK);\n}\n</code></pre></p> <p>@RequestBody\u6ce8\u89e3\u3001@ResponseBody\u6ce8\u89e3\u3001RequestEntity\u3001ResponseEntity\u90fd\u662f\u5728\u76f4\u63a5\u5904\u7406\u539f\u59cb\u7684\u8bf7\u6c42\uff08\u6216\u8bf7\u6c42\u4f53\uff09\u548c\u54cd\u5e94\uff08\u6216\u54cd\u5e94\u4f53\uff09\uff0c\u5e95\u5c42\u90fd\u662f\u7531HttpMessageConverter\u5904\u7406\u3002</p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/7%E3%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8E%E4%B8%8B%E8%BD%BD/","title":"7\u3001\u6587\u4ef6\u7684\u4e0a\u4f20\u4e0e\u4e0b\u8f7d","text":"<p> \u7ea6 272 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>\u4e00\u3001\u6587\u4ef6\u4e0b\u8f7d \u6587\u4ef6\u4e0b\u8f7d\u53ef\u4ee5\u4f7f\u7528HttpServletResponse.getWriter().write();\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528ResponseEntity\u3002 Text Only<pre><code>@RequestMapping(\"/download\")\npublic void download02(HttpServletResponse response) throws IOException {\n\u00a0\u00a0\u00a0\u00a0InputStream resourceAsStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(\"springmvc.xml\");\n\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (resourceAsStream != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int length = resourceAsStream.available();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0byte[] bytes = new byte[length];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resourceAsStream.read(bytes);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resourceAsStream.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setHeader(\"Content-Disposition\", \"attachment;filename=springmvc.xml\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.getOutputStream().write(bytes);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6216\u8005 Text Only<pre><code>@RequestMapping(\"/download\")\npublic ResponseEntity&lt;byte[]&gt; download(){\n\u00a0\u00a0\u00a0\u00a0InputStream resourceAsStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(\"springmvc.xml\");\n\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (resourceAsStream != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int length = resourceAsStream.available();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0byte[] bytes = new byte[length];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resourceAsStream.read(bytes);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resourceAsStream.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HttpHeaders httpHeaders = new HttpHeaders();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpHeaders.add(\"Content-Disposition\", \"attachment;filename=springmvc.xml\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5c06byte[]\u8bbe\u7f6e\u5230 ResponseEntity \u7684body\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ResponseEntity&lt;&gt;(bytes, httpHeaders, HttpStatus.OK);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0return null;\n}\n</code></pre></p> <p>\u4e8c\u3001\u6587\u4ef6\u4e0a\u4f20 SpringMVC\u4e2d\u5c06\u4e0a\u4f20\u7684\u6587\u4ef6\u5c01\u88c5\u5230MultipartFile\u5bf9\u8c61\u4e2d\uff0c\u9700\u8981\u5728SpringMVC\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6eCommonsMultipartResolver\uff1a Text Only<pre><code>&lt;!--\u5fc5\u987b\u901a\u8fc7\u6587\u4ef6\u89e3\u6790\u5668\u7684\u89e3\u6790\u624d\u80fd\u5c06\u6587\u4ef6\u8f6c\u6362\u4e3aMultipartFile\u5bf9\u8c61--&gt;\n&lt;bean id=\"multipartResolver\" class=\"org.springframework.web.multipart.commons.CommonsMultipartResolver\"&gt;&lt;/bean&gt;\n</code></pre> \u800c\u4e14\u8fd8\u9700\u8981\u6dfb\u52a0\u4f9d\u8d56\uff1a Text Only<pre><code>&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.3.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> \u00a0\u6700\u540e\u5728\u65b9\u6cd5\u4e2d\u4f7f\u7528MultipartFile\u7c7b\u578b\u7684\u5f62\u53c2\uff1a Text Only<pre><code>@RequestMapping(\"/testUp\")\npublic String testUp(MultipartFile photo, HttpSession session) throws IOException {\n\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u6587\u4ef6\u540d\n\u00a0\u00a0\u00a0\u00a0String fileName = photo.getOriginalFilename();\n\u00a0\u00a0\u00a0\u00a0//\u5904\u7406\u6587\u4ef6\u91cd\u540d\u95ee\u9898\n\u00a0\u00a0\u00a0\u00a0String hzName = fileName.substring(fileName.lastIndexOf(\".\"));\n\u00a0\u00a0\u00a0\u00a0fileName = UUID.randomUUID().toString() + hzName;\n\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u670d\u52a1\u5668\u4e2dphoto\u76ee\u5f55\u7684\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0ServletContext servletContext = session.getServletContext();\n\u00a0\u00a0\u00a0\u00a0String photoPath = servletContext.getRealPath(\"photo\");\n\u00a0\u00a0\u00a0\u00a0File file = new File(photoPath);\n\u00a0\u00a0\u00a0\u00a0if(!file.exists()){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0file.mkdir();\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0String finalPath = photoPath + File.separator + fileName;\n\u00a0\u00a0\u00a0\u00a0//\u5b9e\u73b0\u4e0a\u4f20\u529f\u80fd\n\u00a0\u00a0\u00a0\u00a0photo.transferTo(new File(finalPath));\n\u00a0\u00a0\u00a0\u00a0return \"success\";\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/8-%E6%8B%A6%E6%88%AA%E5%99%A8/","title":"8-\u62e6\u622a\u5668","text":"<p> \u7ea6 989 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>\u4e00\u3001\u62e6\u622a\u5668\u7684\u4f7f\u7528 \u62e6\u622a\u5668\u662fSpringMVC\u63d0\u4f9b\u7684\u673a\u5236\uff0c\u7528\u4e8e\u62e6\u622a\u63a7\u5236\u5668\u65b9\u6cd5\u7684\u6267\u884c\uff0c\u62e6\u622a\u5668\u7684\u4f7f\u7528\u6d41\u7a0b\uff1a</p> <ul> <li>\u9700\u8981\u5b9e\u73b0HandlerInterceptor\u63a5\u53e3</li> <li>\u5728SpringMVC\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u914d\u7f6e</li> </ul> <p>1\u3001HandlerInterceptor\u63a5\u53e3\u7684\u4e09\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li>preHandle\uff1a\u63a7\u5236\u5668\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u6267\u884cpreHandle()\uff0c\u5176boolean\u7c7b\u578b\u7684\u8fd4\u56de\u503c\u8868\u793a\u662f\u5426\u62e6\u622a\u6216\u653e\u884c\uff0c\u8fd4\u56detrue\u4e3a\u653e\u884c\uff0c\u5373\u8c03\u7528\u63a7\u5236\u5668\u65b9\u6cd5\uff1b\u8fd4\u56defalse\u8868\u793a\u62e6\u622a\uff0c\u5373\u4e0d\u8c03\u7528\u63a7\u5236\u5668\u65b9\u6cd5</li> <li>postHandle\uff1a\u63a7\u5236\u5668\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u6267\u884cpostHandle()</li> <li>afterComplation\uff1a\u5904\u7406\u5b8c\u89c6\u56fe\u548c\u6a21\u578b\u6570\u636e\uff0c\u6e32\u67d3\u89c6\u56fe\u5b8c\u6bd5\u4e4b\u540e\u6267\u884cafterComplation()</li> </ul> <p>Text Only<pre><code>/**\n* \u4e00\u4e2a\u62e6\u622a\u5668\u7684\u8fd0\u884c\u6d41\u7a0b\uff1a\n* \u00a0 \u00a0 \u00a0MyFirstInterceptor----preHandle\n* \u00a0 \u00a0 \u00a0.....\u76ee\u6807\u65b9\u6cd5\u6267\u884c....\n* \u00a0 \u00a0 \u00a0MyFirstInterceptor----postHandle\n* \u00a0 \u00a0 \u00a0.....\u9875\u9762\u6e32\u67d3...\n* \u00a0 \u00a0 \u00a0MyFirstInterceptor----afterCompletion\n*/\npublic class MyFirstInterceptor implements HandlerInterceptor {\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * preHandle\u5728\u76ee\u6807\u65b9\u6cd5\u6267\u884c\u524d\u6267\u884c\uff0creturn false\u8868\u793a\u4e0d\u653e\u884c\uff0creturn true\u8868\u793a\u653e\u884c\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public boolean preHandle(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, Object handler) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(\"MyFirstInterceptor----preHandle\");\n\u00a0 \u00a0 \u00a0 \u00a0return true;\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * postHandle\u5728\u76ee\u6807\u65b9\u6cd5\u6267\u884c\u540e\u6267\u884c\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public void postHandle(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(\"MyFirstInterceptor----postHandle\");\n\u00a0 \u00a0}\n\n\u00a0 \u00a0/**\n\u00a0 \u00a0 * afterCompletion\u5728\u89c6\u56fe\u6e32\u67d3\u4e4b\u540e\u6267\u884c\n\u00a0 \u00a0 */\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public void afterCompletion(javax.servlet.http.HttpServletRequest request, javax.servlet.http.HttpServletResponse response, Object handler, Exception ex) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0System.out.println(\"MyFirstInterceptor----afterCompletion\");\n\u00a0 \u00a0}\n}\n</code></pre> 2\u3001\u914d\u7f6e\u62e6\u622a\u5668\uff1a Text Only<pre><code>&lt;!-- \u6ce8\u518c\u591a\u4e2a\u62e6\u622a\u5668\uff0c\u591a\u4e2a\u62e6\u622a\u5668\u7684\u6267\u884c\u987a\u5e8f\u548c\u914d\u7f6e\u987a\u5e8f\u6709\u5173 --&gt;\n&lt;mvc:interceptors&gt;\n\u00a0&lt;!-- \u9ed8\u8ba4\u62e6\u622a\u6240\u6709\u8bf7\u6c42 --&gt;\n\u00a0&lt;bean id=\"firstInterceptor\" class=\"interceptor.MyFirstInterceptor\"/&gt; &lt;!--\u7b2c\u4e00\u4e2a\u62e6\u622a\u5668--&gt;\n\u00a0&lt;!-- \u5982\u4e0b\u914d\u7f6e\u62e6\u622a\u6307\u5b9a\u7684\u8bf7\u6c42 --&gt;\n\u00a0&lt;mvc:interceptor&gt;\n\u00a0 \u00a0&lt;mvc:mapping path=\"/**\"/&gt; &lt;!--mvc:mapping\u8bbe\u7f6e\u9700\u8981\u62e6\u622a\u7684\u8bf7\u6c42--&gt;\n\u00a0 \u00a0&lt;mvc:exclude-mapping path=\"/testRequestEntity\"/&gt; &lt;!--mvc:exclude-mapping\u8bbe\u7f6e\u9700\u8981\u6392\u9664\u7684\u8bf7\u6c42\uff0c\u5373\u4e0d\u9700\u8981\u62e6\u622a\u7684\u8bf7\u6c42--&gt;\n\u00a0 \u00a0&lt;bean id=\"secondInterceptor\" class=\"interceptor.MySecondInterceptor\"/&gt;\u00a0 &lt;!--\u7b2c\u4e8c\u4e2a\u62e6\u622a\u5668--&gt;\n\u00a0&lt;/mvc:interceptor&gt;\n&lt;/mvc:interceptors&gt;\n</code></pre> 3\u3001\u591a\u4e2a\u62e6\u622a\u5668\u7684\u6267\u884c\u987a\u5e8f\uff1a \u6240\u6709\u62e6\u622a\u5668\u7684preHandle()\u90fd\u8fd4\u56detrue\u7684\u8fd0\u884c\u6d41\u7a0b\uff1a Text Only<pre><code>MyFirstInterceptor----preHandle\nMySecondInterceptor----preHandle\n\u76ee\u6807\u65b9\u6cd5\u6267\u884c.........\nMySecondInterceptor----postHandle\nMyFirstInterceptor----postHandle\n\u9875\u9762\u6e32\u67d3...\nMySecondInterceptor----afterCompletion\nMyFirstInterceptor----afterCompletion\n</code></pre> \u82e5\u67d0\u4e2a\u62e6\u622a\u5668\u7684preHandle()\u8fd4\u56de\u4e86false\uff0c\u5219preHandle()\u8fd4\u56defalse\u548c\u5b83\u4e4b\u524d\u7684\u62e6\u622a\u5668\u7684preHandle()\u90fd\u4f1a\u6267\u884c\uff0cpostHandle()\u90fd\u4e0d\u6267\u884c\uff0c\u8fd4\u56defalse\u7684\u62e6\u622a\u5668\u4e4b\u524d\u7684\u62e6\u622a\u5668\u7684afterComplation()\u4f1a\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u53ea\u8981\u62e6\u622a\u5668\u7684preHandle\u8fd4\u56detrue\u4e86\uff0c\u8be5\u62e6\u622a\u5668\u7684afterCompletion\u4e5f\u4f1a\u6267\u884c\uff1a Text Only<pre><code>MyFirstInterceptor----preHandle\nMySecondInterceptor----preHandle\nMyFirstInterceptor----afterCompletion\n</code></pre> \u76ee\u6807\u65b9\u6cd5\u8fd0\u884c\u629b\u5f02\u5e38\u7684\u8fd0\u884c\u6d41\u7a0b\uff1a Text Only<pre><code>MyFirstInterceptor----preHandle\nMySecondInterceptor----preHandle\n\u76ee\u6807\u65b9\u6cd5\u6267\u884c.........\nMySecondInterceptor----afterCompletion\nMyFirstInterceptor----afterCompletion\n</code></pre></p> <p>\u4e8c\u3001\u62e6\u622a\u5668\u7684\u539f\u7406 doDispatch\u4e2dHandlerExecutionChain\u5904\u7406\u5668\u6267\u884c\u94fe\u8d1f\u8d23\u8c03\u7528\u62e6\u622a\u5668\u7684\u65b9\u6cd5 Text Only<pre><code>protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {\n\u00a0 \u00a0HttpServletRequest processedRequest = request;\n\u00a0 \u00a0HandlerExecutionChain mappedHandler = null;\n\u00a0 \u00a0boolean multipartRequestParsed = false;\n\u00a0 \u00a0WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);\n\n\u00a0 \u00a0try {\n\u00a0 \u00a0 \u00a0 ModelAndView mv = null;\n\u00a0 \u00a0 \u00a0 Exception dispatchException = null;\n\n\u00a0 \u00a0 \u00a0 try {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0processedRequest = checkMultipart(request);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0multipartRequestParsed = (processedRequest != request);\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// Determine handler for the current request.\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0mappedHandler = getHandler(processedRequest);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (mappedHandler == null) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 noHandlerFound(processedRequest, response);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// Determine handler adapter for the current request.\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// Process last-modified header, if supported by the handler.\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0String method = request.getMethod();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0boolean isGet = \"GET\".equals(method);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (isGet || \"HEAD\".equals(method)) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 long lastModified = ha.getLastModified(request, mappedHandler.getHandler());\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n`//\u6267\u884c\u62e6\u622a\u5668\u7684preHandle\u65b9\u6cd5\uff0c\u8fd4\u56defalse\u5c06\u76f4\u63a5\u8fd4\u56de\uff0c\u8fbe\u5230\u62e6\u622a\u8bf7\u6c42\u7684\u76ee\u7684`\n `if (!mappedHandler.applyPreHandle(processedRequest, response)) {`\n `return;`\n `}`\n\n`//\u8c03\u7528\u76ee\u6807\u65b9\u6cd5`\n `// Actually invoke the handler.`\n `mv = ha.handle(processedRequest, response, mappedHandler.getHandler());`\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (asyncManager.isConcurrentHandlingStarted()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0applyDefaultViewName(processedRequest, mv);\n`//\u6267\u884c\u62e6\u622a\u5668\u7684postHandle\u65b9\u6cd5`\n `mappedHandler.applyPostHandle(processedRequest, response, mv);`\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 catch (Exception ex) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0dispatchException = ex;\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 catch (Throwable err) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// As of 4.3, we're processing Errors thrown from handler methods as well,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// making them available for @ExceptionHandler methods and other scenarios.\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0dispatchException = new NestedServletException(\"Handler dispatch failed\", err);\n\u00a0 \u00a0 \u00a0 }\n`//\u6e32\u67d3\u89c6\u56fe`\n `processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);`\n\u00a0 \u00a0}\n\u00a0 \u00a0catch (Exception ex) {\n`//\u6267\u884c\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5`\n `triggerAfterCompletion(processedRequest, response, mappedHandler, ex);`\n\u00a0 \u00a0}\n\u00a0 \u00a0catch (Throwable err) {\n`//\u6267\u884c\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5`\n `triggerAfterCompletion(processedRequest, response, mappedHandler,`\n `new NestedServletException(\"Handler processing failed\", err));`\n\u00a0 \u00a0}\n\u00a0 \u00a0finally {\n\u00a0 \u00a0 \u00a0 if (asyncManager.isConcurrentHandlingStarted()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// Instead of postHandle and afterCompletion\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (mappedHandler != null) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 else {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0// Clean up any resources used by a multipart request.\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0if (multipartRequestParsed) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 cleanupMultipart(processedRequest);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0}\n}\n</code></pre> processDispatchResult\u65b9\u6cd5 Text Only<pre><code>private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,\n\u00a0 \u00a0 \u00a0 @Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv,\n\u00a0 \u00a0 \u00a0 @Nullable Exception exception) throws Exception {\n\u00a0 \u00a0boolean errorView = false;\n\n\u00a0 \u00a0if (exception != null) {\n\u00a0 \u00a0 \u00a0 if (exception instanceof ModelAndViewDefiningException) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0logger.debug(\"ModelAndViewDefiningException encountered\", exception);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0mv = ((ModelAndViewDefiningException) exception).getModelAndView();\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 else {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0mv = processHandlerException(request, response, handler, exception);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0errorView = (mv != null);\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0}\n\n\u00a0 \u00a0// Did the handler return a view to render?\n\u00a0 \u00a0if (mv != null &amp;&amp; !mv.wasCleared()) {\n`//\u6e32\u67d3\u89c6\u56fe`\n `render(mv, request, response);`\n\u00a0 \u00a0 \u00a0 if (errorView) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0WebUtils.clearErrorRequestAttributes(request);\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0}\n\u00a0 \u00a0else {\n\u00a0 \u00a0 \u00a0 if (logger.isTraceEnabled()) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0logger.trace(\"No view rendering, null ModelAndView returned.\");\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0}\n\n\u00a0 \u00a0if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {\n\u00a0 \u00a0 \u00a0 // Concurrent handling started during a forward\n\u00a0 \u00a0 \u00a0 return;\n\u00a0 \u00a0}\n\n\u00a0 \u00a0if (mappedHandler != null) {\n`//\u6267\u884c\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5\uff0c\u6709\u5f02\u5e38\u629b\u51fa\u7684\u8bddafterCompletion\u65b9\u6cd5\u65e9\u6267\u884c\u4e86\uff0c\u4e0d\u4f1a\u7b49\u5230\u8fd9\u91cc\u6267\u884c`\n `// Exception (if any) is already handled..`\n `mappedHandler.triggerAfterCompletion(request, response, null);`\n\u00a0 \u00a0}\n}\n</code></pre> mappedHandler.applyPreHandle(processedRequest, response)\u987a\u5e8f\u6267\u884c\u62e6\u622a\u5668\u7684preHandle\u65b9\u6cd5\uff0c\u8fd4\u56defalse\u5c06\u76f4\u63a5\u6267\u884c\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5 Text Only<pre><code>boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {\n\u00a0 \u00a0for (int i = 0; i &lt; this.interceptorList.size(); i++) {\n\u00a0 \u00a0 \u00a0 HandlerInterceptor interceptor = this.interceptorList.get(i);\n\u00a0 \u00a0 \u00a0 if (!interceptor.preHandle(request, response, this.handler)) {\n `triggerAfterCompletion(request, response, null);`\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0return false;\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 this.interceptorIndex = i;\n\u00a0 \u00a0}\n\u00a0 \u00a0return true;\n}\n</code></pre> mappedHandler.applyPostHandle(processedRequest, response, mv);\u9006\u5e8f\u6267\u884c\u62e6\u622a\u5668\u7684postHandle\u65b9\u6cd5 Text Only<pre><code>void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv)\n\u00a0 \u00a0 \u00a0 throws Exception {\n\u00a0 \u00a0for (int i = this.interceptorList.size() - 1; i &gt;= 0; i--) {\n\u00a0 \u00a0 \u00a0 HandlerInterceptor interceptor = this.interceptorList.get(i);\n\u00a0 \u00a0 \u00a0 interceptor.postHandle(request, response, this.handler, mv);\n\u00a0 \u00a0}\n}\n</code></pre> triggerAfterCompletion(processedRequest, response, mappedHandler, ex);\u9006\u5e8f\u6267\u884c\u62e6\u622a\u5668\u7684afterCompletion\u65b9\u6cd5 Text Only<pre><code>void triggerAfterCompletion(HttpServletRequest request, HttpServletResponse response, @Nullable Exception ex) {\n\u00a0 \u00a0for (int i = this.interceptorIndex; i &gt;= 0; i--) {\n\u00a0 \u00a0 \u00a0 HandlerInterceptor interceptor = this.interceptorList.get(i);\n\u00a0 \u00a0 \u00a0 try {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0interceptor.afterCompletion(request, response, this.handler, ex);\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 catch (Throwable ex2) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0logger.error(\"HandlerInterceptor.afterCompletion threw exception\", ex2);\n\u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0}\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringMVC/9-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8/","title":"9-\u5f02\u5e38\u5904\u7406\u5668","text":"<p> \u7ea6 596 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u4e00\u3001\u5f02\u5e38\u5904\u7406\u5668\u7528\u6cd5 1\u3001\u57fa\u4e8eXML\u914d\u7f6e\u7684\u5f02\u5e38\u5904\u7406 \u63a7\u5236\u5668\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u5f02\u5e38\u5c06\u7531HandlerExceptionResolver\u63a5\u53e3\u89e3\u51b3\uff0c\u5b9e\u73b0\u7c7b\u6709\uff1aDefaultHandlerExceptionResolver\u3001SimpleMappingExceptionResolver\u3001ResponseStatusExceptionResolver\u548cExceptionHandlerExceptionResolver\uff0c\u4e4b\u524d\u5728\u524d\u7aef\u9875\u9762\u770b\u5230\u7684\u9519\u8bef\u6b63\u662f\u7531DefaultHandlerExceptionResolver\u5904\u7406\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528SimpleMappingExceptionResolver\u6765\u81ea\u5b9a\u4e49\u51fa\u73b0\u5f02\u5e38\u65f6\u7684\u5904\u7406\u903b\u8f91\u3002 Text Only<pre><code>&lt;bean class=\"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"exceptionMappings\"&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;props&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties\u7684\u952e\u8868\u793a\u5904\u7406\u5668\u65b9\u6cd5\u6267\u884c\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u5f02\u5e38\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties\u7684\u503c\u8868\u793a\u82e5\u51fa\u73b0\u6307\u5b9a\u5f02\u5e38\u65f6\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u65b0\u7684\u89c6\u56fe\u540d\u79f0\uff0c\u8df3\u8f6c\u5230\u6307\u5b9a\u9875\u9762\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;prop key=\"java.lang.ArithmeticException\"&gt;error&lt;/prop&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/props&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;!--\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exceptionAttribute\u5c5e\u6027\u8bbe\u7f6e\u4e00\u4e2a\u5c5e\u6027\u540d\uff0c\u5c06\u51fa\u73b0\u7684\u5f02\u5e38\u4ee5\u8be5\u5c5e\u6027\u540d\u4f5c\u4e3akey\u5728\u8bf7\u6c42\u57df\u4e2d\u8fdb\u884c\u5171\u4eab\n\u00a0\u00a0\u00a0\u00a0--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property name=\"exceptionAttribute\" value=\"ex\"&gt;&lt;/property&gt;\n&lt;/bean&gt;\n</code></pre> error.jsp\u9875\u9762\uff1a Text Only<pre><code>&lt;%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %&gt;\n&lt;html&gt;\n&lt;head&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;title&gt;\u81ea\u5b9a\u4e49\u7684\u9519\u8bef\u9875\u9762&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;\u51fa\u9519\u4e86\uff01&lt;/h1&gt;\n&lt;h2&gt;\u5f02\u5e38\u662f${ex}&lt;/h2&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p> <p>2\u3001\u57fa\u4e8e\u6ce8\u89e3\u7684\u5f02\u5e38\u5904\u7406 \u57fa\u4e8e\u6ce8\u89e3\u7684\u5f02\u5e38\u5904\u7406\u8d70ExceptionHandlerExceptionResolver\u3002 @ControllerAdvice\u5c06\u4e00\u4e2a\u7c7b\u5b9a\u4e49\u4e3a\u5168\u5c40\u7684\u5f02\u5e38\u5904\u7406\u7c7b\uff1a Text Only<pre><code>//@ControllerAdvice\u5c06\u5f53\u524d\u7c7b\u6807\u8bc6\u4e3a\u5f02\u5e38\u5904\u7406\u7684\u7ec4\u4ef6\n`@ControllerAdvice`\npublic class ExceptionController {\n\n\u00a0\u00a0\u00a0\u00a0//@ExceptionHandler\u7528\u4e8e\u8bbe\u7f6e\u6240\u6807\u8bc6\u65b9\u6cd5\u5904\u7406\u7684\u5f02\u5e38\n\u00a0\u00a0\u00a0\u00a0`@ExceptionHandler(ArithmeticException.class)`\n\u00a0\u00a0\u00a0\u00a0//ex\u8868\u793a\u5f53\u524d\u8bf7\u6c42\u5904\u7406\u4e2d\u51fa\u73b0\u7684\u5f02\u5e38\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0public String handleArithmeticException(Exception ex, Model model){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0model.addAttribute(\"ex\", ex);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"error\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> @ExceptionHandler\u8fd8\u53ef\u4ee5\u6807\u6ce8\u5728@Controller\u7c7b\u91cc\u7684\u65b9\u6cd5\u4e0a\uff0c\u8be5\u65b9\u6cd5\u53ea\u4f1a\u89e3\u51b3\u672c\u7c7b\u53d1\u751f\u7684\u5f02\u5e38\uff0c\u5373\u53ea\u8981\u8be5\u7c7b\u7684@RequestMapping\u65b9\u6cd5\u53d1\u751f\u4e86@ExceptionHandler\u65b9\u6cd5\u80fd\u89e3\u51b3\u7684\u5f02\u5e38\uff0c\u90fd\u4f1a\u8df3\u5230\u8fd9\u4e2a\u65b9\u6cd5\u3002 \u65b9\u6cd5\u53c2\u6570\u4e0a\u53ea\u80fd\u4f7f\u7528Exception ex\u62ff\u5230\u8be5\u5f02\u5e38\uff0c\u6ca1\u6709\u4fdd\u5b58\u5728Model\u4e2d\uff0c\u6240\u4ee5\u5982\u679c\u9700\u8981\u643a\u5e26\u5f02\u5e38\u4fe1\u606f\u5230\u9519\u8bef\u9875\u9762\uff0c\u8981\u4f7f\u7528ModelAndView\u5bf9\u8c61\u3002 \u6709\u591a\u4e2a\u5f02\u5e38\u5904\u7406\u5668\u80fd\u5904\u7406\u8fd9\u4e2a\u5f02\u5e38\uff0c\u7cbe\u786e\u7684\u4f18\u5148\uff1b\u4e0e\u5168\u5c40\u7684\u5f02\u5e38\u5904\u7406\u7c7b\u76f8\u6bd4\uff0c\u672c\u7c7b\u7684\u5f02\u5e38\u5904\u7406\u5668\u4f18\u5148\u3002 Text Only<pre><code>`@ExceptionHandler(ArithmeticException.class)`\npublic ModelAndView exceptionHandler01(Exception ex){\n\u00a0\u00a0\u00a0\u00a0System.out.println(\"ExceptionHandlerTest\u7c7b\u7684\u5f02\u5e38\u5904\u7406\u5668---&gt;\u53d1\u751f\u4e86\u5f02\u5e38\uff1a\" + ex);\n\u00a0\u00a0\u00a0\u00a0ModelAndView mv = new ModelAndView();\n\u00a0\u00a0\u00a0\u00a0mv.setViewName(\"error\");\n\u00a0\u00a0\u00a0\u00a0mv.addObject(\"ex\", ex);\n\u00a0\u00a0\u00a0\u00a0return mv;\n}\n</code></pre></p> <p>3\u3001\u81ea\u5b9a\u4e49\u5f02\u5e38 \u4f7f\u7528@ResponseStatus\u6ce8\u89e3\u81ea\u5b9a\u4e49\u5f02\u5e38\uff0c\u5f53\u629b\u51fa\u8be5\u81ea\u5b9a\u4e49\u5f02\u5e38\u540e\uff0c\u4f1a\u7531ResponseStatusExceptionResolver\u5904\u7406\uff0c\u72b6\u6001\u7801\u548c\u6d88\u606f\u5c31\u662f\u5728@ResponseStatus\u6ce8\u89e3\u6307\u5b9a\u7684\u3002 Text Only<pre><code>@ResponseStatus(reason = \"\u63d0\u4ea4\u5f02\u5e38\", value = HttpStatus.BAD_REQUEST)\npublic class SubmitException extends Exception {\n\u00a0\u00a0\u00a0\u00a0public SubmitException() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this(\"\u63d0\u4ea4\u51fa\u9519\u4e86\uff01\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public SubmitException(String message) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0super(message);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> </p> <p>\u4e8c\u3001\u539f\u7406 \u5faa\u73af\u5224\u65ad\u5f02\u5e38\u5904\u7406\u5668\u80fd\u5426\u89e3\u6790\u5f97\u5230ModelAndView Text Only<pre><code>protected ModelAndView processHandlerException(HttpServletRequest request, HttpServletResponse response,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Nullable Object handler, Exception ex) throws Exception {\n\n\u00a0\u00a0\u00a0\u00a0// Success and error responses may use different content types\n\u00a0\u00a0\u00a0\u00a0request.removeAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);\n\n\u00a0\u00a0\u00a0\u00a0// Check registered HandlerExceptionResolvers...\n\u00a0\u00a0\u00a0\u00a0ModelAndView exMv = null;\n `if (this.handlerExceptionResolvers != null) {`\n `for (HandlerExceptionResolver resolver : this.handlerExceptionResolvers) {`\n `exMv = resolver.resolveException(request, response, handler, ex);`\n `if (exMv != null) {`\n `break;`\n `}`\n `}`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0if (exMv != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (exMv.isEmpty()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0request.setAttribute(EXCEPTION_ATTRIBUTE, ex);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// We might still need view name translation for a plain error model...\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!exMv.hasView()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String defaultViewName = getDefaultViewName(request);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (defaultViewName != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0exMv.setViewName(defaultViewName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (logger.isTraceEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.trace(\"Using resolved error view: \" + exMv, ex);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else if (logger.isDebugEnabled()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.debug(\"Using resolved error view: \" + exMv);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0WebUtils.exposeErrorRequestAttributes(request, ex, getServletName());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return exMv;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0throw ex;\n}\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringSecurity/SpringSecurity%E5%85%A5%E9%97%A8/","title":"SpringSecurity\u5165\u95e8","text":"<p> \u7ea6 2813 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 56 \u5206\u949f</p> <p>\u4e00\u3001\u5728spring-boot-starter-web\u4e2d\u5f15\u5165SpringSecurity 1\u3001\u5f15\u5165SpringSecurity\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre> 2\u3001\u542f\u52a8\uff0c\u8bbf\u95eehttp://localhost:8080/\u4f1a\u81ea\u52a8\u91cd\u5b9a\u5411\u81f3http://localhost:8080/login\uff0c\u5373\u672a\u8ba4\u8bc1\u65f6\u90fd\u4f1a\u88ab\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875  \u9ed8\u8ba4\u7528\u6237\u540d\uff1auser\uff0c\u9ed8\u8ba4\u5bc6\u7801\u6253\u5370\u5728\u63a7\u5236\u53f0  \u8ba4\u8bc1\u6210\u529f\u540e\u4e5f\u4f1a\u88ab\u91cd\u5b9a\u5411\uff0c\u91cd\u5b9a\u5411\u7684\u903b\u8f91\u662f\uff1a</p> <ol> <li>\u5982\u679c\u6700\u5f00\u59cb\u8bbf\u95ee\u7684\u662fhttp://localhost:8080/login\uff0c\u90a3\u4e48\u91cd\u5b9a\u5411\u7684URL\u662fhttp://localhost:8080</li> <li>\u5982\u679c\u6700\u5f00\u59cb\u8bbf\u95ee\u7684\u662fhttp://localhost:8080/\uff0c\u90a3\u4e48\u91cd\u5b9a\u5411\u7684URL\u662fhttp://localhost:8080/?continue</li> <li>\u5982\u679c\u6700\u5f00\u59cb\u8bbf\u95ee\u7684\u662fhttp://localhost:8080/hello\uff0c\u90a3\u4e48\u91cd\u5b9a\u5411\u7684URL\u662fhttp://localhost:8080/hello?continue</li> </ol> <p>\u5176\u5b9e\u7b2c\u4e8c\u79cd\u548c\u7b2c\u4e09\u79cd\u662f\u540c\u4e00\u79cd\u60c5\u51b5\uff0c\u6700\u521d\u8bbf\u95ee\u7684\u90fd\u662f\u975e\u767b\u5f55\u9875\u3002 \u767b\u5f55\u5931\u8d25\u540e\u5219\u4f1a\u88ab\u91cd\u5b9a\u5411\u81f3http://localhost:8080/login?error\uff0c\u4e5f\u5c31\u662f\u88ab\u91cd\u5b9a\u5411\u5230\u4e86\u4e00\u4e2a\u76f8\u540c\u7684\u9875\u9762\uff0c\u4f46\u662f\u989d\u5916\u5e26\u4e86\u4e00\u4e2a\u6ca1\u6709\u88ab\u8d4b\u503c\u7684error\u53c2\u6570\uff0c\u901a\u8fc7\u5224\u65ad\u6709\u6ca1\u6709error\u53c2\u6570\u6765\u51b3\u5b9a\u662f\u5426\u663e\u793a\u201c\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\u201d\u3002  3\u3001\u9000\u51fa\u767b\u5f55\u8bbf\u95eehttp://localhost:8080/logout </p> <p>\u4e8c\u3001\u8ba4\u8bc1\u6d41\u7a0b SpringSecurity\u7684\u5b9e\u73b0\u7b80\u5355\u8bb2\u5c31\u662f\u4e00\u7cfb\u5217\u7684\u62e6\u622a\u5668\uff0c\u5f53\u8bbf\u95eehttp://localhost:8080/\u65f6\uff0c\u5728\u62e6\u622a\u5668\u91cc\u68c0\u67e5\u6709\u6ca1\u6709Session\uff0c\u6ca1\u6709\u5c31\u91cd\u5b9a\u5411\u5230http://localhost:8080/login\uff0c\u5e76\u8bbe\u7f6eCookie\uff1b\u70b9\u51fbSign in\u6309\u94ae\u4f1a\u4ee5Post\u65b9\u5f0f\u63d0\u4ea4\u81f3http://localhost:8080/login\uff0c\u7136\u540e\u8fdb\u5165\u8ba4\u8bc1\u6d41\u7a0b\uff1a 1\u3001\u9996\u5148\u8fdb\u5165<code>FilterChainProxy</code>.doFilter()\u65b9\u6cd5 2\u3001\u7136\u540e\u5230FilterChainProxy.VirtualFilterChain.doFilter()\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u4f1a\u4e00\u6b21\u6267\u884cadditionalFilters\u5217\u8868\u4e2d\u768416\u4e2a\u8fc7\u6ee4\u5668 3\u3001\u8d70\u5230\u7b2c8\u4e2a\u8fc7\u6ee4\u5668<code>UsernamePasswordAuthenticationFilter</code>\uff0c\u8be5\u7c7b\u7ee7\u627f\u4e86\u62bd\u8c61\u7c7bAbstractAuthenticationProcessingFilter\uff0c\u6267\u884cdoFilter()\u65b9\u6cd5 4\u3001\u6267\u884c<code>UsernamePasswordAuthenticationFilter.attemptAuthentication()</code>\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u9996\u5148\u83b7\u53d6\u8bf7\u6c42\u4e2d\u7684\"username\"\u548c\"password\"\uff0c\u5305\u88c5\u6210<code>UsernamePasswordAuthenticationToken</code>\uff0c\u7136\u540e\u8c03\u7528ProviderManager\u7684authenticate()\u65b9\u6cd5\uff0cProviderManager\u5b9e\u73b0\u4e86AuthenticationManager\u63a5\u53e3 5\u3001\u6267\u884c<code>DaoAuthenticationProvider.authenticate()</code>\u65b9\u6cd5\uff0cDaoAuthenticationProvider\u7ee7\u627f\u81ea\u62bd\u8c61\u7c7bAbstractUserDetailsAuthenticationProvider\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u8c03\u7528retrieveUser()\u65b9\u6cd5\uff0c\u63a5\u7740\u8c03\u7528<code>InMemoryUserDetailsManager\u7684loadUserByUsername()\u65b9\u6cd5</code>\uff0cInMemoryUserDetailsManager\u5b9e\u73b0\u4e86<code>UserDetailsManager</code>\u63a5\u53e3\uff0cInMemoryUserDetailsManager\u7684loadUserByUsername()\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u901a\u8fc7\"username\"\u83b7\u53d6\u4fdd\u5b58\u5728\u5185\u5b58\u4e2dUserDetails\uff0c\u5305\u542b\u7528\u6237\u540d\u3001\u5bc6\u7801\u3001\u6743\u9650\u7b49\u3002 6\u3001\u63a5\u7740\u5728DaoAuthenticationProvider.authenticate()\u65b9\u6cd5\u5c06\u4ece\u5185\u5b58\u4e2d\u83b7\u53d6\u7684User\u548c\u4ece\u8bf7\u6c42\u4e2d\u5f97\u5230\u7684UsernamePasswordAuthenticationToken\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u8ba4\u8bc1\u5931\u8d25\u5c31\u629b\u5f02\u5e38\u3002 7\u3001\u56de\u5230UsernamePasswordAuthenticationFilter\u7684doFilter()\u65b9\u6cd5\uff0c\u8ba4\u8bc1\u6210\u529f\u6267\u884c<code>successfulAuthentication(</code>)\u65b9\u6cd5\uff0c\u8ba4\u8bc1\u5931\u8d25\u6267\u884c<code>unsuccessfulAuthentication()</code>\u65b9\u6cd5\uff0c\u6210\u529f\u548c\u5931\u8d25\u540e\u7684\u91cd\u5b9a\u5411\u903b\u8f91\u5206\u522b\u5728\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u91cc\u3002 \u518d\u6b21\u8bbf\u95eehttp://localhost:8080/\u65f6\uff0c\u62e6\u622a\u5668\u68c0\u67e5Session\uff0c\u5982\u679c\u6709\u5e76\u4e14\u901a\u8fc7\u8ba4\u8bc1\u90a3\u4e48\u4e0d\u4f1a\u518d\u8df3\u5230/login\u3002</p> <p>\u4e09\u3001\u81ea\u5b9a\u4e49\u7528\u6237\u540d\u548c\u5bc6\u7801 \u65b9\u5f0f\u4e00\uff1a\u5728 application.properties \u914d\u7f6e Text Only<pre><code>spring.security.user.name=admin\nspring.security.user.password=123\n</code></pre></p> <p>\u65b9\u5f0f\u4e8c\uff1a\u57fa\u4e8e\u5185\u5b58\u7684\u7528\u6237\u8ba4\u8bc1 \u5411\u5bb9\u5668\u4e2d\u6ce8\u5165InMemoryUserDetailsManager\u7ec4\u4ef6 Text Only<pre><code>@Configuration\n//@EnableWebSecurity //\u5982\u679c\u662fSpringBoot\u9879\u76ee\u53ef\u4ee5\u4e0d\u52a0\u8fd9\u4e2a\u6ce8\u89e3\uff0c\u56e0\u4e3aspring-boot-starter-security\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u6709\u52a0\u8fd9\u4e2a\u6ce8\u89e3\npublic class WebSecurityConfig {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public UserDetailsService userDetailsService() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0InMemoryUserDetailsManager inMemoryUserDetailsManager = new InMemoryUserDetailsManager();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0inMemoryUserDetailsManager.createUser(User.withDefaultPasswordEncoder().username(\"admin\").password(\"admin\").roles(\"ADMIN\").build());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0inMemoryUserDetailsManager.createUser(User.withDefaultPasswordEncoder().username(\"jack\").password(\"jack\").roles(\"ADMIN\").build());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return inMemoryUserDetailsManager;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5176\u5b9e\u7b2c\u4e00\u79cd\u65b9\u6cd5\u4e5f\u4f7f\u7528\u7684\u662fInMemoryUserDetailsManager\u3002</p> <p>\u65b9\u5f0f\u4e09\uff1a\u57fa\u4e8e\u6570\u636e\u5e93\u7684\u7528\u6237\u8ba4\u8bc1 \u5982\u679c\u9700\u8981\u5c06\u7528\u6237\u4fe1\u606f\u653e\u5728\u6570\u636e\u5e93\u5219\u9700\u8981\u5b9e\u73b0UserDetailsService\u63a5\u53e3\u7684loadUserByUsername\u65b9\u6cd5\u3002 Text Only<pre><code>@Component\npublic class DBUserDetailsManager implements UserDetailsManager, UserDetailsPasswordService {\n\u00a0\u00a0\u00a0\u00a0UserDao userDao;\n\u00a0\u00a0\u00a0\u00a0public DBUserDetailsManager(UserDao userDao) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.userDao = userDao;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public UserDetails updatePassword(UserDetails user, String newPassword) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void createUser(UserDetails user) {\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void updateUser(UserDetails user) {\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void deleteUser(String username) {\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void changePassword(String oldPassword, String newPassword) {\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public boolean userExists(String username) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0User user = userDao.getUserByName(username);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (user == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new UsernameNotFoundException(username);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Collection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new org.springframework.security.core.userdetails.User(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user.getUsername(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user.getPassword(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user.getEnabled(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0true, //\u7528\u6237\u8d26\u53f7\u662f\u5426\u8fc7\u671f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0true, //\u7528\u6237\u51ed\u8bc1\u662f\u5426\u8fc7\u671f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0true, //\u7528\u6237\u662f\u5426\u672a\u88ab\u9501\u5b9a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0authorities); //\u6743\u9650\u5217\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u56db\u3001\u914d\u7f6eSpringSecurity 4.1\u00a0SpringSecurity\u7684\u9ed8\u8ba4\u914d\u7f6e \u5728\u914d\u7f6e\u7c7b\u4e2d\u91cd\u65b0\u5f80\u5bb9\u5668\u4e2d\u6ce8\u5165SecurityFilterChain\uff0cSpringSecurity\u7684\u9ed8\u8ba4\u914d\u7f6e\u76f8\u5f53\u4e8e\u662f\u8fd9\u4e2aSecurityFilterChain\u7684\u914d\u7f6e\u3002 Text Only<pre><code>@Configuration\n//@EnableWebSecurity\npublic class WebSecurityConfig {\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0http\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//authorizeRequests()\uff1a\u5f00\u542f\u6388\u6743\u4fdd\u62a4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.authorizeRequests(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0authorize -&gt; authorize\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//anyRequest()\uff1a\u5bf9\u6240\u6709\u8bf7\u6c42\u5f00\u542f\u6388\u6743\u4fdd\u62a4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.anyRequest()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//authenticated()\uff1a\u5df2\u8ba4\u8bc1\u8bf7\u6c42\u4f1a\u81ea\u52a8\u88ab\u6388\u6743\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.authenticated()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.formLogin(withDefaults())//\u8868\u5355\u6388\u6743\u65b9\u5f0f\uff0c\u524d\u9762\u770b\u5230\u7684\u9ed8\u8ba4\u7684\u767b\u5f55\u9875\u6b63\u662f\u8868\u5355\u6388\u6743\u65b9\u5f0f\uff0c\u6ce8\u91ca\u6389\u8fd9\u4e00\u884c\u8868\u793a\u5173\u95ed\u9ed8\u8ba4\u7684\u8868\u5355\u767b\u5f55\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.httpBasic(withDefaults());//\u57fa\u672c\u6388\u6743\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return http.build();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>4.2 CSRF\u653b\u51fb SpringSecurity\u9ed8\u8ba4\u5f00\u542f\u9632\u5fa1csrf\u653b\u51fb\uff0c\u4e5f\u5c31\u662f\u5f3a\u5236POST\u8bf7\u6c42\u5fc5\u987b\u643a\u5e26_csrf\u53c2\u6570\u3002\u5982\u679c\u9879\u76ee\u4e2d\u4f7f\u7528\u4e86Thymeleaf\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8868\u5355\uff0c SpringSecurity\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u85cf\u7684\uff0c\u53ef\u4ee5\u914d\u7f6e\u5173\u95edcsrf\u653b\u51fb\u9632\u5fa1\u3002  Text Only<pre><code>//\u5173\u95edcsrf\u653b\u51fb\u9632\u5fa1\nhttp.csrf((csrf) -&gt; {\n\u00a0 \u00a0 csrf.disable();\n});\n</code></pre></p> <p>\u4e94\u3001\u5bc6\u7801\u52a0\u5bc6\u5668 5.1 \u5bc6\u7801\u76f8\u5173\u6982\u5ff5</p> <ul> <li>Hash\u7b97\u6cd5\uff1a\u5bf9\u5bc6\u7801\u5355\u5411\u8f6c\u6362\u9700\u8981\u7528\u5230\u54c8\u5e0c\u7b97\u6cd5\uff0c\u4f8b\u5982MD5\u3001SHA-256\u3001SHA-512\u7b49\uff0c\u54c8\u5e0c\u7b97\u6cd5\u662f\u5355\u5411\u7684\uff0c\u53ea\u80fd\u52a0\u5bc6\uff0c\u4e0d\u80fd\u89e3\u5bc6\u3002</li> <li>\u5f69\u8679\u8868\uff1a\u5f69\u8679\u8868\u5c31\u662f\u4e00\u4e2a\u5e9e\u5927\u7684\u3001\u9488\u5bf9\u5404\u79cd\u53ef\u80fd\u7684\u5b57\u6bcd\u7ec4\u5408\u9884\u5148\u751f\u6210\u7684\u54c8\u5e0c\u503c\u96c6\u5408\uff0c\u6709\u4e86\u5b83\u53ef\u4ee5\u5feb\u901f\u7834\u89e3\u5404\u7c7b\u5bc6\u7801\u3002\u8d8a\u662f\u590d\u6742\u7684\u5bc6\u7801\uff0c\u9700\u8981\u7684\u5f69\u8679\u8868\u5c31\u8d8a\u5927\uff0c\u4e3b\u6d41\u7684\u5f69\u8679\u8868\u90fd\u662f100G\u4ee5\u4e0a\uff0c\u76ee\u524d\u4e3b\u8981\u7684\u7b97\u6cd5\u6709LM, NTLM, MD5, SHA1, MYSQLSHA1, HALFLMCHALL, NTLMCHALL, ORACLE-SYSTEM, MD5-HALF\u3002</li> <li>\u52a0\u76d0\u5bc6\u7801\uff1a\u4e3a\u6bcf\u4e2a\u7528\u6237\u7684\u5bc6\u7801\u751f\u6210\u968f\u673a\u5b57\u8282\uff08\u79f0\u4e3a\u76d0\uff09\u3002\u76d0\u548c\u7528\u6237\u7684\u5bc6\u7801\u5c06\u4e00\u8d77\u7ecf\u8fc7\u54c8\u5e0c\u51fd\u6570\u8fd0\u7b97\uff0c\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u54c8\u5e0c\uff0c\u76d0\u5c06\u4ee5\u660e\u6587\u5f62\u5f0f\u4e0e\u7528\u6237\u7684\u5bc6\u7801\u4e00\u8d77\u5b58\u50a8\uff0c\u7136\u540e\u5f53\u7528\u6237\u5c1d\u8bd5\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u76d0\u548c\u7528\u6237\u8f93\u5165\u7684\u5bc6\u7801\u4e00\u8d77\u7ecf\u8fc7\u54c8\u5e0c\u51fd\u6570\u8fd0\u7b97\uff0c\u518d\u4e0e\u5b58\u50a8\u7684\u5bc6\u7801\u8fdb\u884c\u6bd4\u8f83\u3002\u552f\u4e00\u7684\u76d0\u610f\u5473\u7740\u5f69\u8679\u8868\u4e0d\u518d\u6709\u6548\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a\u76d0\u548c\u5bc6\u7801\u7684\u7ec4\u5408\uff0c\u54c8\u5e0c\u90fd\u662f\u4e0d\u540c\u7684\u3002</li> <li>\u81ea\u9002\u5e94\u5355\u5411\u51fd\u6570\uff1a\u968f\u7740\u786c\u4ef6\u7684\u4e0d\u65ad\u53d1\u5c55\uff0c\u52a0\u76d0\u54c8\u5e0c\u4e5f\u4e0d\u518d\u5b89\u5168\u3002\u5f00\u53d1\u4eba\u5458\u5f00\u59cb\u4f7f\u7528\u81ea\u9002\u5e94\u5355\u5411\u51fd\u6570\u6765\u5b58\u50a8\u5bc6\u7801\u3002\u4f7f\u7528\u81ea\u9002\u5e94\u5355\u5411\u51fd\u6570\u9a8c\u8bc1\u5bc6\u7801\u65f6\uff0c\u6545\u610f\u5360\u7528\u8d44\u6e90\uff08\u6545\u610f\u4f7f\u7528\u5927\u91cf\u7684CPU\u3001\u5185\u5b58\u6216\u5176\u4ed6\u8d44\u6e90\uff09\u3002\u81ea\u9002\u5e94\u5355\u5411\u51fd\u6570\u5141\u8bb8\u914d\u7f6e\u4e00\u4e2a\u201c\u5de5\u4f5c\u56e0\u5b50\u201d\uff0c\u968f\u7740\u786c\u4ef6\u7684\u6539\u8fdb\u800c\u589e\u52a0\u3002\u6211\u4eec\u5efa\u8bae\u5c06\u201c\u5de5\u4f5c\u56e0\u5b50\u201d\u8c03\u6574\u5230\u7cfb\u7edf\u4e2d\u9a8c\u8bc1\u5bc6\u7801\u9700\u8981\u7ea6\u4e00\u79d2\u949f\u7684\u65f6\u95f4\u3002\u8fd9\u79cd\u6743\u8861\u662f\u4e3a\u4e86\u8ba9\u653b\u51fb\u8005\u96be\u4ee5\u7834\u89e3\u5bc6\u7801\u3002\u81ea\u9002\u5e94\u5355\u5411\u51fd\u6570\u5305\u62ecbcrypt\u3001PBKDF2\u3001scrypt\u548cargon2\u3002</li> </ul> <p>5.2 PasswordEncoder SpringSecurity\u7684PasswordEncoder\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u6709\uff1a</p> <ul> <li>BCryptPasswordEncoder\uff1a \u4f7f\u7528\u5e7f\u6cdb\u652f\u6301\u7684bcrypt\u7b97\u6cd5\u6765\u5bf9\u5bc6\u7801\u8fdb\u884c\u54c8\u5e0c\u3002\u4e3a\u4e86\u589e\u52a0\u5bf9\u5bc6\u7801\u7834\u89e3\u7684\u62b5\u6297\u529b\uff0cbcrypt\u6545\u610f\u8bbe\u8ba1\u5f97\u8f83\u6162\u3002\u548c\u5176\u4ed6\u81ea\u9002\u5e94\u5355\u5411\u51fd\u6570\u4e00\u6837\uff0c\u5e94\u8be5\u8c03\u6574\u5176\u53c2\u6570\uff0c\u4f7f\u5176\u5728\u60a8\u7684\u7cfb\u7edf\u4e0a\u9a8c\u8bc1\u4e00\u4e2a\u5bc6\u7801\u5927\u7ea6\u9700\u89811\u79d2\u7684\u65f6\u95f4\u3002BCryptPasswordEncoder\u7684\u9ed8\u8ba4\u5b9e\u73b0\u4f7f\u7528\u5f3a\u5ea610\u3002\u5efa\u8bae\u60a8\u5728\u81ea\u5df1\u7684\u7cfb\u7edf\u4e0a\u8c03\u6574\u548c\u6d4b\u8bd5\u5f3a\u5ea6\u53c2\u6570\uff0c\u4ee5\u4fbf\u9a8c\u8bc1\u5bc6\u7801\u65f6\u5927\u7ea6\u9700\u89811\u79d2\u7684\u65f6\u95f4\u3002</li> <li>Argon2PasswordEncoder</li> <li>Pbkdf2PasswordEncoder</li> <li>SCryptPasswordEncoder</li> </ul> <p>\u6d4b\u8bd5BCryptPasswordEncoder Text Only<pre><code>@Test\nvoid testPassword() {\n\u00a0\u00a0\u00a0\u00a0// \u5de5\u4f5c\u56e0\u5b50\uff0c\u9ed8\u8ba4\u503c\u662f10\uff0c\u6700\u5c0f\u503c\u662f4\uff0c\u6700\u5927\u503c\u662f31\uff0c\u503c\u8d8a\u5927\u8fd0\u7b97\u901f\u5ea6\u8d8a\u6162\n\u00a0\u00a0\u00a0\u00a0PasswordEncoder encoder = new BCryptPasswordEncoder(31);\n\u00a0\u00a0\u00a0\u00a0//\u660e\u6587\uff1a\"password\"\n\u00a0\u00a0\u00a0\u00a0//\u5bc6\u6587\uff1aresult\uff0c\u5373\u4f7f\u660e\u6587\u5bc6\u7801\u76f8\u540c\uff0c\u6bcf\u6b21\u751f\u6210\u7684\u5bc6\u6587\u4e5f\u4e0d\u4e00\u81f4\n\u00a0\u00a0\u00a0\u00a0String result = encoder.encode(\"password\");\n\u00a0\u00a0\u00a0\u00a0System.out.println(result);\n\u00a0\u00a0\u00a0\u00a0//\u5bc6\u7801\u6821\u9a8c\n\u00a0\u00a0\u00a0\u00a0Assert.isTrue(encoder.matches(\"password\", result), \"\u5bc6\u7801\u4e0d\u4e00\u81f4\");\n}\n</code></pre></p> <p>5.3\u00a0DelegatingPasswordEncoder SpringSecurity\u6821\u9a8c\u5bc6\u7801\u7528\u7684 DelegatingPasswordEncoder\u7684matches()\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u9996\u5148\u4f1a\u63d0\u53d6\u5b58\u50a8\u7684\u5bc6\u7801\u7684\u524d\u7f00\uff0c\u5f62\u5f0f\u662f{xxx}\uff0c\u6bd4\u5982\u5982\u679c\u7528\u7684\u662fbcrypt\uff0c\u90a3\u4e48\u5b58\u50a8\u7684\u5bc6\u7801\u662f {bcrypt}\\(2a\\)10$GRLdNijSQMUvl/au9ofL.eDwmoohzzS7.rmNSJZ.0FxO/BTk76klW \uff0c\u7136\u540e\u6839\u636e\u524d\u7f00\u627e\u5230\u5bf9\u5e94\u7684\u52a0\u5bc6\u5668BCryptPasswordEncoder\uff0c\u6700\u540e\u5c06\u7528\u6237\u63d0\u4ea4\u7684\u5bc6\u7801\u52a0\u5bc6\u540e\u4e0e\u5b58\u50a8\u7684\u5bc6\u7801\u6bd4\u8f83\u3002\u4fdd\u5b58\u5bc6\u7801\u65f6\u52a0\u4e0a\u524d\u7f00\u7684\u76ee\u7684\u662f\u65b9\u4fbf\u4f7f\u7528\u4e0d\u540c\u7684\u5bc6\u7801\u52a0\u5bc6\u5668\u3002 </p> <p>\u516d\u3001\u81ea\u5b9a\u4e49\u767b\u5f55\u9875\u9762 \u8bbe\u7f6e\u4f7f\u7528\u8868\u5355\u6388\u6743\u65b9\u5f0f\uff1a Text Only<pre><code>@Configuration\npublic class WebSecurityConfig {\n\u00a0 \u00a0 @Bean\n\u00a0\u00a0\u00a0\u00a0public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0http\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//authorizeRequests()\uff1a\u5f00\u542f\u6388\u6743\u4fdd\u62a4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.authorizeRequests(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0authorize -&gt; authorize\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//anyRequest()\uff1a\u5bf9\u6240\u6709\u8bf7\u6c42\u5f00\u542f\u6388\u6743\u4fdd\u62a4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.anyRequest()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//authenticated()\uff1a\u5df2\u8ba4\u8bc1\u8bf7\u6c42\u4f1a\u81ea\u52a8\u88ab\u6388\u6743\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.authenticated()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0)\n `.formLogin(form -&gt; {`\n `form``.loginPage(\"/login\").permitAll() //\u6307\u5b9a\u81ea\u5b9a\u4e49\u767b\u5f55\u9875\u9762\u7684\u5730\u5740\uff0c\u5e76\u8bbe\u7f6e\u767b\u5f55\u9875\u9762\u65e0\u9700\u6388\u6743\u5373\u53ef\u8bbf\u95ee`\n `.usernameParameter(\"username\") //\u81ea\u5b9a\u4e49\u8868\u5355\u7528\u6237\u540d\u53c2\u6570\uff0c\u9ed8\u8ba4\u662fusername`\n `.passwordParameter(\"password\") //\u81ea\u5b9a\u4e49\u8868\u5355\u5bc6\u7801\u53c2\u6570\uff0c\u9ed8\u8ba4\u662fpassword`\n `.failureUrl(\"/login?error\") //\u767b\u5f55\u5931\u8d25\u7684\u8fd4\u56de\u5730\u5740\uff0c\u8fd9\u4e2a\u5c31\u662f\u9ed8\u8ba4\u767b\u5f55\u5931\u8d25\u7684\u5730\u5740\uff0c\u5e26\u4e86\u4e00\u4e2a\u6ca1\u6709\u8d4b\u503c\u7684error\u53c2\u6570`\n `//.failureUrl(\"/failure.html\") //\u767b\u5f55\u5931\u8d25\u7684\u8fd4\u56de\u5730\u5740`\n `;`\n `}); //\u4f7f\u7528\u8868\u5355\u6388\u6743\u65b9\u5f0f`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return http.build();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u521b\u5efa\u767b\u5f55Controller Text Only<pre><code>@Controller\npublic class LoginController {\n\u00a0\u00a0\u00a0\u00a0@GetMapping(\"/login\")\n\u00a0\u00a0\u00a0\u00a0public String login() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"login\";\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u521b\u5efa\u767b\u5f55\u9875\u9762 resources/templates/login.html Text Only<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html xmlns:th=\"https://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;title&gt;\u767b\u5f55&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;\u767b\u5f55&lt;/h1&gt;\n&lt;div th:if=\"${param.error}\"&gt;\u9519\u8bef\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801.&lt;/div&gt;\n`&lt;!--method\u5fc5\u987b\u4e3a\"post\"\uff0c\u56e0\u4e3aGet\u83b7\u53d6\u7684\u662f\u5f53\u524d\u7684login.html--&gt;`\n&lt;!--th:action=\"@{/login}\" \uff0c\u4f7f\u7528\u52a8\u6001\u53c2\u6570\u7684\u4f5c\u7528\uff1a\n`1\u3001\u81ea\u52a8\u5728\u8def\u5f84\u524d\u9762\u6dfb\u52a0\u914d\u7f6e\u7684server.servlet.context-path=spring-security-demo\uff0c\u5373\u81ea\u52a8\u6dfb\u52a0 http:/localhost:8080/spring-security-demo`\n`2\u3001\u8868\u5355\u4e2d\u4f1a\u81ea\u52a8\u751f\u6210_csrf\u9690\u85cf\u5b57\u6bb5\uff0c\u7528\u4e8e\u9632\u6b62csrf\u653b\u51fb`\n--&gt;\n&lt;form th:action=\"@{/login}\" method=\"post\"&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;div&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--name\u5fc5\u987b\u4e3a\"username\"--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;input type=\"text\" name=\"username\" placeholder=\"\u7528\u6237\u540d\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/div&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;div&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--name\u5fc5\u987b\u4e3a\"password\"--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;input type=\"password\" name=\"password\" placeholder=\"\u5bc6\u7801\"/&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/div&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;input type=\"submit\" value=\"\u767b\u5f55\" /&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p> <p>\u4e03\u3001\u524d\u540e\u7aef\u5206\u79bb 7.1\u00a0\u8ba4\u8bc1\u6210\u529f\u548c\u5931\u8d25\u540e\u7684\u54cd\u5e94 \u5728\u524d\u9762\uff0c\u8ba4\u8bc1\u6210\u529f\u6216\u8005\u5931\u8d25\u4e4b\u540e\u4f1a\u90fd\u4f1a\u88ab\u91cd\u5b9a\u5411\u5230\u65b0\u7684URL\uff0c\u800c\u5728\u524d\u540e\u5206\u79bb\u5f00\u53d1\u4e2d\uff0c\u9875\u9762\u7684\u8df3\u8f6c\u903b\u8f91\u7531\u524d\u7aef\u5b9e\u73b0\uff0c\u6240\u4ee5\u4e0d\u80fd\u8fd4\u56de302\u7684\u91cd\u5b9a\u5411\u54cd\u5e94\uff0c\u800c\u662f\u9700\u8981\u8fd4\u56deJSON\u683c\u5f0f\u7684\u767b\u5f55\u6210\u529f\u6216\u8005\u5931\u8d25\u7684\u4fe1\u606f\u3002 \u5728UsernamePasswordAuthenticationFilter\u7684doFilter()\u65b9\u6cd5\u91cc\uff0c\u8ba4\u8bc1\u6210\u529f\u4f1a\u6267\u884csuccessfulAuthentication()\u65b9\u6cd5\uff0c\u8ba4\u8bc1\u5931\u8d25\u4f1a\u6267\u884cunsuccessfulAuthentication()\u65b9\u6cd5\uff0c\u6267\u884c\u6d41\u7a0b\u5982\u56fe\u6240\u793a\uff1a  \u91cd\u5b9a\u5411\u7684\u903b\u8f91\u90fd\u5728\u6700\u540e\u4e00\u6b65\uff0c\u8ba4\u8bc1\u6210\u529f\u662fAuthenticationSuccessHandler\u7684onAuthenticationSuccess()\u65b9\u6cd5\uff0c\u8ba4\u8bc1\u5931\u8d25\u662fAuthenticationFailureHandler\u7684onAuthenticationFailure()\u65b9\u6cd5\uff0c\u6240\u4ee5\u8981\u60f3\u8fd4\u56deJSON\uff0c\u5c31\u8981\u5206\u522b\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u63a5\u53e3\u7684\u65b9\u6cd5\u3002 Text Only<pre><code>public class MyAuthenticationSuccessHandler implements AuthenticationSuccessHandler {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object principal = authentication.getPrincipal();//\u83b7\u53d6\u7528\u6237\u7684\u4fe1\u606f\n//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object credentials = authentication.getCredentials(); //\u83b7\u53d6\u7528\u6237\u7684\u51ed\u8bc1\uff0c\u8d26\u53f7\u5bc6\u7801\u767b\u5f55\u7684\u65b9\u5f0f\u5c31\u662f\u5bc6\u7801\uff0c\u4f46\u662f\u5728\u8ba4\u8bc1\u6210\u529f\u4e4b\u540e\u5c31\u88ab\u64e6\u9664\u4e86\n//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities(); //\u83b7\u53d6\u7528\u7684\u6743\u9650\u5217\u8868\uff0c\u5176\u5b9ePrincipal\u4e2d\u5df2\u7ecf\u5305\u542b\u4e86authorities\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u7ed3\u679c\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap result = new HashMap();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"code\", 0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"message\", \"\u767b\u5f55\u6210\u529f\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"principal\", principal);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8f6c\u6362\u6210json\u5b57\u7b26\u4e32\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String json = JSON.toJSONString(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd4\u56de\u54cd\u5e94\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setContentType(\"application/json;charset=UTF-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.getWriter().println(json);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>public class MyAuthenticationFailureHandler implements AuthenticationFailureHandler {\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u9519\u8bef\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String localizedMessage = exception.getLocalizedMessage();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u7ed3\u679c\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap result = new HashMap();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"code\", -1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"message\", localizedMessage);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8f6c\u6362\u6210json\u5b57\u7b26\u4e32\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String json = JSON.toJSONString(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd4\u56de\u54cd\u5e94\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setContentType(\"application/json;charset=UTF-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.getWriter().println(json);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u7136\u540e\u8bbe\u7f6e\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684Handler\uff1a Text Only<pre><code>http.formLogin(\n\u00a0\u00a0\u00a0\u00a0form -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0form.loginPage(\"/login\").permitAll() //\u6307\u5b9a\u81ea\u5b9a\u4e49\u767b\u5f55\u9875\u9762\u7684\u5730\u5740\uff0c\u5e76\u8bbe\u7f6e\u767b\u5f55\u9875\u9762\u65e0\u9700\u6388\u6743\u5373\u53ef\u8bbf\u95ee\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.usernameParameter(\"username\") //\u81ea\u5b9a\u4e49\u8868\u5355\u7528\u6237\u540d\u53c2\u6570\uff0c\u9ed8\u8ba4\u662fusername\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.passwordParameter(\"password\") //\u81ea\u5b9a\u4e49\u8868\u5355\u5bc6\u7801\u53c2\u6570\uff0c\u9ed8\u8ba4\u662fpassword\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.failureUrl(\"/login?error\") //\u767b\u5f55\u5931\u8d25\u7684\u8fd4\u56de\u5730\u5740\uff0c\u8fd9\u4e2a\u5c31\u662f\u9ed8\u8ba4\u767b\u5f55\u5931\u8d25\u7684\u5730\u5740\uff0c\u5e26\u4e86\u4e00\u4e2a\u6ca1\u6709\u8d4b\u503c\u7684error\u53c2\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//.failureUrl(\"/failure.html\") //\u767b\u5f55\u5931\u8d25\u7684\u8fd4\u56de\u5730\u5740)//\u8868\u5355\u6388\u6743\u65b9\u5f0f\uff0c\u524d\u9762\u770b\u5230\u7684\u9ed8\u8ba4\u7684\u767b\u5f55\u9875\u6b63\u662f\u8868\u5355\u6388\u6743\u65b9\u5f0f\uff0c\u6ce8\u91ca\u6389\u8fd9\u4e00\u884c\u8868\u793a\u5173\u95ed\u9ed8\u8ba4\u7684\u8868\u5355\u767b\u5f55\n `.successHandler(new MyAuthenticationSuccessHandler()); //\u8ba4\u8bc1\u6210\u529f\u65f6\u7684\u5904\u7406`\n `.failureHandler(new MyAuthenticationFailureHandler()) //\u8ba4\u8bc1\u5931\u8d25\u65f6\u7684\u5904\u7406`\n\u00a0\u00a0\u00a0\u00a0});\n</code></pre></p> <p>7.2\u00a0\u6ce8\u9500\u7684\u54cd\u5e94 \u9000\u51fa\u767b\u5f55\u8bbf\u95eehttp://localhost:8080/logout\u4f1a\u5f39\u7a97\u63d0\u793a\u662f\u5426\u786e\u8ba4\u6ce8\u9500\uff0c\u800c\u4e0d\u662f\u54cd\u5e94JSON\uff0c\u5982\u679c\u60f3\u8fd4\u56deJSON\u5219\u9700\u8981\u5b9e\u73b0LogoutSuccessHandler\u63a5\u53e3\uff1a Text Only<pre><code>public class MyLogoutSuccessHandler implements LogoutSuccessHandler {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u7ed3\u679c\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HashMap result = new HashMap();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"code\", 0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0result.put(\"message\", \"\u6ce8\u9500\u6210\u529f\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8f6c\u6362\u6210json\u5b57\u7b26\u4e32\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String json = JSON.toJSONString(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd4\u56de\u54cd\u5e94\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.setContentType(\"application/json;charset=UTF-8\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0response.getWriter().println(json);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u7136\u540e\u914d\u7f6e\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684LogoutSuccessHandler\uff1a Text Only<pre><code>http.logout(logout -&gt; {\n\u00a0\u00a0\u00a0\u00a0logout.logoutSuccessHandler(new MyLogoutSuccessHandler()); //\u6ce8\u9500\u6210\u529f\u65f6\u7684\u5904\u7406\n});\n</code></pre></p>"},{"location":"Web%E5%BC%80%E5%8F%91/SpringSecurity/%E8%B7%A8%E5%9F%9F/","title":"\u8de8\u57df","text":"<p> \u7ea6 2928 \u4e2a\u5b57  8 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 59 \u5206\u949f</p> <p>\u4e00\u3001\u4ec0\u4e48\u662f\u8de8\u57df\uff1f \u4e24\u4e2aurl\u7684\u534f\u8bae\u3001\u57df\u540d\u3001\u7aef\u53e3\u4e09\u8005\u90fd\u76f8\u540c\u624d\u80fd\u79f0\u4e4b\u4e3a\u540c\u4e00\u4e2a\u57df\uff0c\u53ea\u8981\u4e09\u8005\u4e4b\u95f4\u6709\u4efb\u610f\u4e00\u4e2a\u76f8\u540c\u5373\u4e3a\u8de8\u57df\u3002\u6bd4\u5982\uff1a  \u6bd4\u5982\uff0c\u8bbf\u95ee\u540c\u4e00\u4e2a\u7f51\u7ad9\u65f6\u7684Cookie\u6709\u4e0d\u540c\u7684\u57df\uff1a  \u8bbf\u95ee\u540c\u4e00\u4e2a\u7f51\u7ad9\u65f6\u6709\u4e0d\u540c\u57df\u7684\u8d44\u6e90\uff1a  \u6d4f\u89c8\u5668\u4e2d\u7684JavaScript\u811a\u672c\u53ef\u4ee5\u64cd\u4f5cDOM\u3001Cookie\u3001\u53d1\u9001Http\u8bf7\u6c42\uff0c\u5982\u679c\u4e00\u4e2a\u57df\u7684JavaScript\u811a\u672c\u53ef\u4ee5\u4efb\u610f\u64cd\u4f5c\u5176\u4ed6\u57df\u7684\u8d44\u6e90\u80af\u5b9a\u4f1a\u5e26\u6765\u5f88\u591a\u5b89\u5168\u95ee\u9898\uff0c\u6240\u4ee5\u6d4f\u89c8\u5668\u9488\u5bf9JavaScript\u811a\u672c\u7684\u8de8\u57df\u64cd\u4f5c\u505a\u4e86\u9650\u5236\uff0c\u7b80\u5355\u6765\u8bb2\uff0c\u6d4f\u89c8\u5668\u7981\u6b62\u4e00\u4e2a\u57df\u7684JavaScript\u811a\u672c\u4e0e\u53e6\u4e00\u4e2a\u57df\u7684\u8d44\u6e90\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ece\u800c\u9632\u6b62\u6076\u610f\u7f51\u7ad9\u901a\u8fc7\u4e00\u4e2a\u57df\u7684\u7f51\u9875\u8bbf\u95ee\u53e6\u4e00\u4e2a\u57df\u7684\u654f\u611f\u6570\u636e\uff0c\u8fd9\u4fbf\u662f\u6d4f\u89c8\u5668\u7684\u8de8\u57df\u7b56\u7565\uff08\u6bd4\u8f83\u5b98\u65b9\u7684\u89e3\u91ca\u662f\uff0c\u540c\u6e90\u7b56\u7565\uff08Same Origin Policy\uff09\u662fWeb\u4f53\u7cfb\u7684\u4e00\u79cd\u57fa\u672c\u7684\u5b89\u5168\u534f\u8bae\uff0c\u8de8\u57df\uff08Cross-Origin\uff09\u662f\u6d4f\u89c8\u5668\u5b9e\u73b0\u540c\u6e90\u7b56\u7565\u7684\u4e00\u90e8\u5206\uff09\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u8de8\u57df\u4ec5\u4ec5\u662f\u9488\u5bf9\u4e8e\u6d4f\u89c8\u5668\u6267\u884cJavaScript\u811a\u672c\u8fd9\u4e00\u4e2a\u573a\u666f\u800c\u8a00\u7684\uff0c\u6d4f\u89c8\u5668\u7981\u6b62\u4e00\u4e2a\u57df\u7684JavaScript\u811a\u672c\u8bbf\u95ee\u53e6\u4e00\u4e2a\u57df\u7684\u8d44\u6e90\uff0c\u4ece\u800c\u5c31\u65e0\u6cd5\u5b9e\u73b0\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u8fdb\u800c\u4fdd\u8bc1\u4e86\u5b89\u5168\uff1a</p> <ul> <li>\u65e0\u6cd5\u8bbf\u95ee\u6765\u81ea\u4e0d\u540c\u6e90\u7f51\u9875\u7684Cookie\u3001LocalStorage\u548cIndexedDB\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u540c\u6e90\u7684\u7f51\u9875\u4e4b\u95f4\u4e0d\u80fd\u5171\u4eab\u5b58\u50a8\u6570\u636e\u3002</li> <li>\u65e0\u6cd5\u64cd\u4f5c\u4e0d\u540c\u6e90\u7f51\u9875\u7684DOM\u3002\u6bcf\u4e2a\u7f51\u9875\u7684DOM\u53ea\u80fd\u7531\u5176\u81ea\u5df1\u7684\u811a\u672c\u8bbf\u95ee\uff0c\u4e0d\u80fd\u88ab\u5176\u4ed6\u6e90\u7684\u811a\u672c\u64cd\u4f5c\u3002</li> <li>\u65e0\u6cd5\u5411\u4e0d\u540c\u6e90\u5730\u5740\u53d1\u8d77AJAX\u8bf7\u6c42\uff08\u539f\u751f\u7684XMLHttpRequest\u8bf7\u6c42\uff09\u3002\u8fd9\u9650\u5236\u4e86\u7f51\u9875\u4e0e\u4e0d\u540c\u6e90\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6570\u636e\u4ea4\u4e92\u3002</li> </ul> <p>\u7b2c\u4e09\u70b9\uff0c\u6bd4\u5982\u5728www.a.com\u7684\u57df\u4e0b\u4e0d\u80fd\u4f7f\u7528JavaScript\u53d1\u9001b.com\u7684\u8bf7\u6c42\u3002\u4f46\u662f\u6b63\u5982\u4e0a\u56fe\uff0c\u5728\u8bbf\u95ee\u4e00\u4e2a\u7ad9\u70b9\u65f6\u5c31\u662f\u4f1a\u8de8\u57df\u8bbf\u95ee\uff0c\u90a3\u600e\u4e48\u529e\u5462\uff0c\u6240\u4ee5\uff0c\u6d4f\u89c8\u5668\u7684\u8de8\u57df\u7b56\u7565\u867d\u7136\u786e\u4fdd\u4e86Web\u5e94\u7528\u7684\u5b89\u5168\u6027\uff0c\u9632\u6b62\u6076\u610f\u7f51\u7ad9\u8bbf\u95ee\u5176\u4ed6\u7f51\u7ad9\u7684\u654f\u611f\u6570\u636e\uff0c\u4f46\u540c\u65f6\u4e5f\u7ed9\u5f00\u53d1\u8de8\u57dfWeb\u5e94\u7528\u5e26\u6765\u4e86\u6311\u6218\uff0c\u9700\u8981\u91c7\u53d6\u76f8\u5e94\u7684\u8de8\u57df\u89e3\u51b3\u65b9\u6848\u3002 \u6ce8\u610f\uff1a 1\u3001\u70b9\u51fb\u6d4f\u89c8\u5668\u9875\u9762\u6307\u5411\u5176\u4ed6\u7f51\u7ad9\u7684\u8d85\u94fe\u63a5\u4e0d\u662f\u8de8\u57df\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u4e0d\u662f\u901a\u8fc7\u6267\u884cJavaScript\u811a\u672c\u53d1\u9001\u8bf7\u6c42\u3002 2\u3001\u5728Node.js\u91cc\u6267\u884cJavaScript\u53d1\u9001\u8bf7\u6c42\u4e0d\u662f\u8de8\u57df\uff0c\u56e0\u4e3aNode.js\u6267\u884c\u7684JavaScript\u811a\u672c\u4e0d\u662f\u670d\u52a1\u5668\u53d1\u9001\u8fc7\u7684\uff0c\u53ea\u6709\u5728\u6d4f\u89c8\u5668\u91cc\u6267\u884cJavaScript\u624d\u6709\u8de8\u57df\u9650\u5236\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u662f\u5ba2\u6237\u7aef\u624d\u4f1a\u9762\u4e34\u8fd9\u79cd\u5b89\u5168\u95ee\u9898\uff0c\u624d\u5fc5\u987b\u505a\u8fd9\u79cd\u9650\u5236\u3002 \u5b9e\u9a8c\uff1a\u542f\u52a8\u4e24\u4e2a\u670d\u52a1\uff0cA\uff1ahttp://localhost:8081/\uff0cB\uff1ahttp://localhost:8080/\uff0c\u6d4f\u89c8\u5668\u9650\u5236\u4e86\u4ece\u811a\u672c\u5185\u53d1\u8d77\u7684\u8de8\u6e90 HTTP \u8bf7\u6c42\uff0c\u4f8b\u5982 XMLHttpRequest \u548c Fetch API \u90fd\u662f\u9075\u5faa\u7684\u540c\u6e90\u7b56\u7565\uff0c\u5f53\u5728A\u7684\u9875\u9762\u63a7\u5236\u53f0\u8bbf\u95eeB\uff0c\u51fa\u73b0\u4e0b\u9762\u7684\u9519\u8bef\uff0c\u63d0\u793a\u8de8\u57df\u8bf7\u6c42\u5931\u8d25\u3002 </p> <p>\u4e8c\u3001\u8de8\u57df\u89e3\u51b3\u65b9\u6848 2.1 JSONP \u6d4f\u89c8\u5668\u5141\u8bb8 link\u3001img\u3001script \u7b49\u6807\u7b7e\u4e0aurl\u8bf7\u6c42\u8de8\u57df\uff0cjsonp \u7684\u5b9e\u73b0\u539f\u7406\u5c31\u662f\u5728 script \u6807\u7b7e\u91cc\u6307\u5b9a\u4e00\u4e2a\u8de8\u57df\u94fe\u63a5\u53bb\u8bbf\u95ee\u670d\u52a1\u5668\u3002\u8be5\u65b9\u5f0f\u53ea\u652f\u6301get\u8bf7\u6c42\uff0c\u4e0d\u652f\u6301post\u8bf7\u6c42\u3002 Text Only<pre><code>&lt;script src=\"http://test.com/data.php?callback=dosomething\"&gt;&lt;/script&gt; // \u5411\u670d\u52a1\u5668test.com\u53d1\u51fa\u8bf7\u6c42\uff0c\u8be5\u8bf7\u6c42\u7684\u67e5\u8be2\u5b57\u7b26\u4e32\u6709\u4e00\u4e2acallback\u53c2\u6570\uff0c\u7528\u6765\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u7684\u540d\u5b57\uff0c\u5904\u7406\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\n&lt;script type=\"text/javascript\"&gt;\n\u00a0 \u00a0function dosomething(res){\n\u00a0 \u00a0 \u00a0 \u00a0// \u5904\u7406\u83b7\u5f97\u7684\u6570\u636e\n\u00a0 \u00a0 \u00a0 \u00a0console.log(res.data)\n\u00a0 \u00a0}\n&lt;/script&gt;\n</code></pre></p> <p>2.1 CORS (Cross-Origin Resource Sharing\uff0c\u8de8\u57df\u8d44\u6e90\u5206\u4eab\uff09 CORS\u662f W3C \u6807\u51c6\uff0c\u5b83\u5141\u8bb8\u6d4f\u89c8\u5668\u5411\u8de8\u6e90\u670d\u52a1\u5668\u53d1\u51faXMLHttpRequest\u8bf7\u6c42\uff0c\u4f46\u5982\u679c\u4ec5\u4ec5\u662f\u6d4f\u89c8\u5668\u653e\u5f00\u4e86\u8fd9\u4e2a\u9650\u5236\u6765\u89e3\u51b3\u8de8\u57df\uff0c\u90a3\u670d\u52a1\u5668\u80af\u5b9a\u8981\u906d\u6b83\uff0c\u6240\u4ee5\u653e\u5f00\u8fd9\u4e2a\u9650\u5236\u7684\u540c\u65f6\u5fc5\u987b\u5728\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e24\u7aef\u8bbe\u7f6e\u4e00\u4e9b\u7b56\u7565\u6765\u89e3\u51b3\u6076\u610f\u8bbf\u95ee\u7684\u95ee\u9898\u3002 \u5728\u6d4f\u89c8\u5668\u7aef\uff1a \u6d4f\u89c8\u5668\u5c06 CORS \u8bf7\u6c42\u5206\u6210\u4e24\u7c7b\uff1a\u7b80\u5355\u8bf7\u6c42 \u548c \u975e\u7b80\u5355\u8bf7\u6c42\uff08not-so-simple request\uff09\u3002 \u82e5\u6ee1\u8db3\u4e0b\u8ff0\u6240\u6709\u6761\u4ef6\uff0c\u5219\u8be5\u8bf7\u6c42\u53ef\u89c6\u4e3a\u7b80\u5355\u8bf7\u6c42\uff1a</p> <ul> <li>\u8bf7\u6c42\u65b9\u6cd5\u662f\u4ee5\u4e0b\u4e09\u79cd\u4e4b\u4e00\uff1a<ul> <li>HEAD</li> <li>GET</li> <li>POST</li> </ul> </li> <li>HTTP \u7684\u5934\u4fe1\u606f\u4e0d\u8d85\u51fa\u4ee5\u4e0b\u51e0\u79cd\u5b57\u6bb5\uff1a<ul> <li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Content-Type</li> <li>DPR</li> <li>Downlink</li> <li>Save-Data</li> <li>Viewport-Width</li> <li>Width</li> </ul> </li> <li>Content-Type \u7684\u503c\u4ec5\u9650\u4e8e\u4ee5\u4e0b\u4e09\u79cd\u4e4b\u4e00<ul> <li>text/plain</li> <li>multipart/form-data</li> <li>application/x-www-form-urlencoded</li> </ul> </li> <li>\u8bf7\u6c42\u4e2d\u7684\u4efb\u610f XMLHttpRequestUpload \u5bf9\u8c61\u5747\u6ca1\u6709\u6ce8\u518c\u4efb\u4f55\u4e8b\u4ef6\u76d1\u542c\u5668\u3002</li> <li>\u8bf7\u6c42\u4e2d\u6ca1\u6709\u4f7f\u7528 ReadableStream \u5bf9\u8c61\u3002</li> </ul> <p>\u51e1\u662f\u4e0d\u540c\u65f6\u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\uff0c\u5747\u5c5e\u4e8e\u975e\u7b80\u5355\u8bf7\u6c42\u3002 \u7b80\u5355\u8bf7\u6c42\u7684\u8bf7\u6c42\u8fc7\u7a0b\uff1a 1\u3001\u6d4f\u89c8\u5668\u53d1\u9001\u8bf7\u6c42fetch('http://localhost:8080/springboot-demo/test') HTTP\u8bf7\u6c42\u5934\u4e2d\u5305\u542b\u4e86Origin: http://localhost:8081 Text Only<pre><code>GET /springboot-demo/test HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate, br, zstd\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6\nConnection: keep-alive\nHost: localhost:8080\n`Origin: http://localhost:8081`\nReferer: http://localhost:8081/\nSec-Fetch-Dest: empty\nSec-Fetch-Mode: cors\nSec-Fetch-Site: same-site\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0\nsec-ch-ua: \"Not/A)Brand\";v=\"8\", \"Chromium\";v=\"126\", \"Microsoft Edge\";v=\"126\"\nsec-ch-ua-mobile: ?0\nsec-ch-ua-platform: \"Windows\"\n</code></pre> 2\u3001\u670d\u52a1\u5668\u6b63\u5e38\u54cd\u5e94\uff0c\u670d\u52a1\u5668\u4f1a\u5b8c\u6574\u6267\u884c\u4e86\u4e00\u6b21\u8bf7\u6c42\uff08\u6240\u4ee5\u540c\u6e90\u7b56\u7565\u5e76\u4e0d\u80fd\u9632\u6b62DDos\uff0c\u56e0\u4e3a\u8de8\u57df\u7684Ajax\u8bf7\u6c42\u4f1a\u88ab\u6d4f\u89c8\u5668\u53d1\u51fa\uff09 \u5982\u679c\u670d\u52a1\u5668\u7aef\u6ca1\u6709\u4efb\u4f55\u8de8\u57df\u8bbe\u7f6e\uff0c\u54cd\u5e94\u5934\u4e2d\u4e0d\u4f1a\u5305\u542b\u4efb\u4f55\u4e0e\u8de8\u57df\u76f8\u5173\u7684\u4fe1\u606f Text Only<pre><code>HTTP/1.1 200\nContent-Type: text/plain;charset=UTF-8\nContent-Length: 20\nDate: Sun, 23 Jun 2024 10:46:11 GMT\nKeep-Alive: timeout=60\nConnection: keep-alive\n</code></pre> \u5982\u679c\u5728Controller\u65b9\u6cd5\u4e0a\u6dfb\u52a0\u4e86@CrossOrigin\u6ce8\u89e3\uff0c\u6b64\u65f6\u54cd\u5e94\u5934\u4e2d\u4f1a\u6709Access-Control-Allow-Origin: *\uff0c Text Only<pre><code>HTTP/1.1 200\nVary: Origin\nVary: Access-Control-Request-Method\nVary: Access-Control-Request-Headers\n`Access-Control-Allow-Origin: *`\nContent-Type: text/plain;charset=UTF-8\nContent-Length: 20\nDate: Sun, 23 Jun 2024 12:08:43 GMT\nKeep-Alive: timeout=60\nConnection: keep-alive\n</code></pre> 3\u3001\u6d4f\u89c8\u5668\u63a5\u6536\u5230\u54cd\u5e94\u4e4b\u540e\u68c0\u67e5\u54cd\u5e94\u5934\u91cc\u6709\u6ca1\u6709 Access-Control-Allow-Origin\u00a0 \u6ca1\u6709\u6216\u8005\u5176\u503c\u4e0e\u8bf7\u6c42URL\u4e0d\u5339\u914d\uff0c\u90a3\u4e48\u6d4f\u89c8\u5668\u5c31\u4f1a\u4e22\u5f03\u54cd\u5e94\uff08\u6216\u8005\u8bf4\u5176\u5b9e\u54cd\u5e94\u6570\u636e\u5176\u5b9e\u5df2\u7ecf\u5230\u4e86\u6d4f\u89c8\u5668\uff0c\u53ea\u4e0d\u8fc7\u6d4f\u89c8\u5668\u5c06\u6570\u636e\u9690\u85cf\u8d77\u6765\u4e86\uff09\uff0c\u5373\u4f7f\u54cd\u5e94\u72b6\u6001\u7801\u662f200\uff1a   \u6709Access-Control-Allow-Origin\u00a0\u4e14\u4e0e\u8bf7\u6c42URL\u5339\u914d\u5219\u4e00\u5207\u6b63\u5e38\u3002</p> <p>\u975e\u7b80\u5355\u8bf7\u6c42\u7684\u8bf7\u6c42\u8fc7\u7a0b\uff1a \u4ece\u524d\u9762\u53ef\u4ee5\u770b\u5230\uff0c\u7b80\u5355\u8bf7\u6c42\u53d1\u9001\u5230\u670d\u52a1\u5668\uff0c\u5176\u5b9e\u670d\u52a1\u5668\u4f1a\u5b8c\u6574\u6267\u884c\u4e00\u6b21\uff0c\u7b80\u5355\u8bf7\u6c42\u7684\u5b9a\u4e49\u6709\u9650\u5236\uff0c\u5982\u679c\u670d\u52a1\u5668\u7684API\u8bbe\u8ba1\u9075\u5b88HTTP\u89c4\u8303\uff0c\u5927\u6982\u4e0d\u4f1a\u5f15\u53d1\u5b89\u5168\u95ee\u9898\uff0c\u4f46\u662f\u975e\u7b80\u5355\u8bf7\u6c42\u6bd4\u7b80\u5355\u8bf7\u6c42\u66f4\u52a0\u590d\u6742\uff0c\u5982\u679c\u4ecd\u7136\u76f4\u63a5\u5c06\u8de8\u57df\u8bf7\u6c42\u53d1\u9001\u5230\u670d\u52a1\u5668\u5f88\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff0c\u6240\u4ee5\u975e\u7b80\u5355\u8bf7\u6c42\u4f1a\u5148\u53d1\u9001\u4e00\u4e2a\u9884\u68c0\u8bf7\u6c42\uff0c\u5982\u679c\u9884\u68c0\u8bf7\u6c42\u7684\u54cd\u5e94\u4f1a\u8fd4\u56deAccess-Control-Allow-Origin\u00a0\u7b49\uff0c\u8fd9\u65f6\u6d4f\u89c8\u5668\u518d\u51b3\u5b9a\u662f\u5426\u53ef\u4ee5\u53d1\u9001\u5b9e\u9645\u7684\u8de8\u57df\u8bf7\u6c42\u3002 1\u3001\u6d4f\u89c8\u5668\u53d1\u9001\u8bf7\u6c42fetch('http://localhost:8080/springboot-demo/put', {method: 'PUT'}) \u9884\u68c0\u8bf7\u6c42\u7684\u8bf7\u6c42\u65b9\u5f0f\u662fOPTIONS\uff0c\u8bf7\u6c42\u5934\u4f1a\u5e26\u4e0aOrigin: http://localhost:8081 Text Only<pre><code>OPTIONS /springboot-demo/put HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate, br, zstd\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6\n`Access-Control-Request-Method: PUT`\nConnection: keep-alive\nHost: localhost:8080\n`Origin: http://localhost:8081`\nReferer: http://localhost:8081/\nSec-Fetch-Dest: empty\nSec-Fetch-Mode: cors\nSec-Fetch-Site: same-site\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0\n</code></pre> \u9664\u4e86 Origin\uff0c\u201c\u9884\u68c0\u8bf7\u6c42\u201d\u7684\u5934\u4fe1\u606f\u8fd8\u53ef\u4ee5\u5305\u62ec\u4e24\u4e2a\u7279\u6b8a\u5b57\u6bb5\uff1a</p> <ul> <li>Access-Control-Request-Method\uff1a\u8fd9\u4e2a\u5b57\u6bb5\u662f\u5fc5\u987b\u7684\uff0c\u7528\u6765\u5217\u51fa\u6d4f\u89c8\u5668\u7684 CORS \u8bf7\u6c42\u4f1a\u7528\u5230\u54ea\u4e9b HTTP \u65b9\u6cd5\uff0c\u4e0a\u9762\u793a\u4f8b\u662f PUT\u3002</li> <li>Access-Control-Request-Headers\uff1a\u8fd9\u4e2a\u5b57\u6bb5\u662f\u4e00\u4e2a\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\uff0c\u6307\u5b9a\u6d4f\u89c8\u5668 CORS \u8bf7\u6c42\u4f1a\u989d\u5916\u53d1\u9001\u7684\u5934\u4fe1\u606f\u5b57\u6bb5\uff0c\u4e0a\u9762\u793a\u4f8b\u662f X-Custom-Header\u3002</li> </ul> <p>2\u3001\u670d\u52a1\u5668\u54cd\u5e94\u9884\u68c0\u8bf7\u6c42\uff0c\u6b64\u65f6\u670d\u52a1\u5668\u5e76\u4e0d\u4f1a\u771f\u6b63\u6267\u884cController\u65b9\u6cd5 \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u8de8\u57df\uff0c\u90a3\u4e48\u8fd4\u56de403\u00a0Forbidden  \u5982\u679c\u5728Controller\u65b9\u6cd5\u4e0a\u6dfb\u52a0\u4e86@CrossOrigin\u6ce8\u89e3\uff0c\u6b64\u65f6\u54cd\u5e94\u5934\u4e2d\u4f1a\u6709\u4ee5 Access-Control- \u5f00\u5934\u4e0e CORS \u8bf7\u6c42\u76f8\u5173\u7684\u5934\u4fe1\u606f\u5b57\u6bb5\uff08Access-Control-Allow-Origin\u3001Access-Control-Allow-Credentials\u3001Access-Control-Expose-Headers \uff09\uff1a Text Only<pre><code>HTTP/1.1 200\nVary: Origin\nVary: Access-Control-Request-Method\nVary: Access-Control-Request-Headers\n`Access-Control-Allow-Origin: *`\n`Access-Control-Allow-Methods: PUT`\n`Access-Control-Max-Age: 1800`\nAllow: GET, HEAD, POST, PUT, DELETE, OPTIONS, PATCH\nContent-Length: 0\nDate: Sun, 23 Jun 2024 12:36:52 GMT\nKeep-Alive: timeout=60\nConnection: keep-alive\n</code></pre></p> <ul> <li>Access-Control-Allow-Origin\uff1a\u8fd9\u4e2a\u5b57\u6bb5\u662f\u5fc5\u987b\u7684\u3002\u5b83\u7684\u503c\u8981\u4e48\u662f\u8bf7\u6c42\u65f6 Origin \u5b57\u6bb5\u7684\u503c\uff0c\u8981\u4e48\u662f\u4e00\u4e2a *\uff0c\u8868\u793a\u63a5\u53d7\u4efb\u610f\u7684\u6e90\uff08\u57df\u540d\uff09\u7684\u8bf7\u6c42\u3002</li> <li>Access-Control-Allow-Methods\uff1a\u8fd9\u4e2a\u5b57\u6bb5\u662f\u5fc5\u987b\u7684\uff0c\u5b83\u7684\u503c\u662f\u9017\u53f7 , \u5206\u9694\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8868\u660e\u670d\u52a1\u5668\u652f\u6301\u7684\u6240\u6709\u8de8\u57df\u8bf7\u6c42\u3002\u6ce8\u610f\uff0c\u8fd4\u56de\u7684\u662f\u6240\u6709\u652f\u6301\u7684\u65b9\u6cd5\uff0c\u800c\u4e0d\u5355\u662f\u6d4f\u89c8\u5668\u8bf7\u6c42\u7684\u90a3\u4e2a\u65b9\u6cd5\u3002\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u591a\u6b21\u201c\u9884\u68c0\u8bf7\u6c42\u201d\u3002(\u672c\u793a\u4f8b\u4ec5\u8bbe\u7f6e\u4e86\u4e00\u4e2a PUT \u65b9\u6cd5\u3002)</li> <li>Access-Control-Allow-Headers\uff1a\u5982\u679c\u6d4f\u89c8\u5668\u8bf7\u6c42\u5305\u62ec Access-Control-Request-Headers \u5b57\u6bb5\uff0c\u5219 Access-Control-Allow-Headers \u5b57\u6bb5\u662f\u5fc5\u987b\u7684\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u9017\u53f7 , \u5206\u9694\u7684\u5b57\u7b26\u4e32\uff0c\u8868\u660e\u670d\u52a1\u5668\u652f\u6301\u7684\u6240\u6709\u5934\u4fe1\u606f\u5b57\u6bb5\uff0c\u4e0d\u9650\u4e8e\u6d4f\u89c8\u5668\u5728\u201c\u9884\u68c0\u8bf7\u6c42\u201d\u7684\u5b57\u6bb5\u3002</li> <li>Access-Control-Allow-Credentials\uff1a<ul> <li>\u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\uff0c\u5b83\u7684\u503c\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u662f\u5426\u5141\u8bb8\u53d1\u9001 Cookie\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cCookie \u4e0d\u5305\u62ec\u5728 CORS \u8bf7\u6c42\u4e4b\u4e2d\uff0c\u8bbe\u4e3a true\u8868\u793a\u670d\u52a1\u5668\u660e\u786e\u8bb8\u53ef\uff0cCookie \u53ef\u4ee5\u5305\u542b\u5728\u8bf7\u6c42\u4e2d\uff0c\u4e00\u8d77\u53d1\u7ed9\u670d\u52a1\u5668\u3002\u8fd9\u4e2a\u503c\u4e5f\u53ea\u80fd\u8bbe\u4e3a true\uff0c\u5982\u679c\u670d\u52a1\u5668\u4e0d\u8981\u6d4f\u89c8\u5668\u53d1\u9001 Cookie\uff0c\u5220\u9664\u8be5\u5b57\u6bb5\u5373\u53ef\u3002</li> <li>\u5982\u679cAccess-Control-Allow-Origin: *\uff0cAccess-Control-Allow-Credentials\u4e0d\u80fd\u662ftrue\u3002</li> <li>\u5141\u4e0d\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u643a\u5e26Cookie\u662f\u9700\u8981\u5f88\u614e\u91cd\u7684\uff0c\u4e0d\u643a\u5e26Cookie\uff0c\u8bf7\u6c42\u53d1\u9001\u5230\u670d\u52a1\u5668\u80af\u5b9a\u5904\u4e8e\u672a\u767b\u5f55\u72b6\u6001\uff0c\u662f\u5b89\u5168\u7684\uff0c\u53cd\u4e4b\u5982\u679c\u5141\u8bb8\u643a\u5e26Cookie\uff0c\u8bf7\u6c42\u53ef\u80fd\u5904\u4e8e\u767b\u5f55\u72b6\u6001\u3002</li> <li>fetch\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u7ba1\u662f\u540c\u57df\u8fd8\u662f\u8de8\u57dfajax\u8bf7\u6c42\u90fd\u4e0d\u4f1a\u5e26\u4e0acookie\uff0c\u53ea\u6709\u5f53\u8bbe\u7f6e\u4e86 credentials \u65f6\u624d\u4f1a\u5e26\u4e0a\u8be5ajax\u8bf7\u6c42\u6240\u5728\u57df\u7684cookie\uff08xhr.withCredentials = true\uff09\uff0c\u8de8\u57df\u7684\u65f6\u5019\uff0c\u989d\u5916\u8fd8\u9700\u8981\u670d\u52a1\u7aef\u54cd\u5e94\u9884\u68c0\u8bf7\u6c42Access-Control-Allow-Credentials: true\uff0c\u5426\u5219\u6d4f\u89c8\u5668\u4f1a\u56e0\u4e3a\u5b89\u5168\u9650\u5236\u800c\u62a5\u9519\u62ff\u4e0d\u5230\u54cd\u5e94\u3002\u8fd8\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u670d\u52a1\u5668\u8bbe\u7f6e\u7684Cookie\u662fHttpOnly\uff0cJavaScript\u662f\u8bfb\u4e0d\u5230\u6b64Cookie\u7684\uff0c\u4e5f\u5c31\u662ffetch/XHR\u8bf7\u6c42\u90fd\u5e26\u4e0d\u4e0a\u6b64Cookie\u3002</li> </ul> </li> <li>Access-Control-Expose-Headers\uff1a\u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u3002CORS \u8bf7\u6c42\u65f6\uff0cXMLHttpRequest \u5bf9\u8c61\u7684 getResponseHeader() \u65b9\u6cd5\u53ea\u80fd\u62ff\u5230 6 \u4e2a\u57fa\u672c\u5b57\u6bb5\uff1a Cache-Control\u3001Content-Language\u3001Content-Type\u3001Expires\u3001Last-Modified\u3001Pragma\u3002\u5982\u679c\u60f3\u8981\u62ff\u5230\u5176\u4ed6\u5b57\u6bb5\uff0c\u5c31\u5fc5\u987b\u5728 Access-Control-Expose-Headers \u91cc\u9762\u6307\u5b9a\u3002\uff08\u4f46\u7531\u4e8e W3C \u7684\u9650\u5236\uff0c\u4e0d\u6307\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u7684\u503c\u53ef\u80fd\u4e3a null\uff09\u4f8b\u5982\uff0c\u670d\u52a1\u7aef\u5c06 Access-Control-Expose-Headers \u6307\u5b9a\u4e3a \"Date,Access-Control-Allow-Origin\"\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 XMLHttpRequest \u5bf9\u8c61\u7684 getResponseHeader() \u65b9\u6cd5\u83b7\u53d6\u5bf9\u5e94\u5b57\u6bb5\u7684\u503c\u3002</li> <li>Access-Control-Max-Age\uff1a\u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\uff0c\u7528\u6765\u6307\u5b9a\u672c\u6b21\u9884\u68c0\u8bf7\u6c42\u7684\u6709\u6548\u671f\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002</li> </ul> <p>3\u3001\u6d4f\u89c8\u5668\u63a5\u7740\u518d\u5b8c\u6210\u4e00\u6b21\u7b80\u5355\u8bf7\u6c42 \u4e00\u65e6\u670d\u52a1\u5668\u901a\u8fc7\u4e86\u201c\u9884\u68c0\u8bf7\u6c42\u201d\uff0c\u4ee5\u540e\u6bcf\u6b21\u6d4f\u89c8\u5668\u6b63\u5e38\u7684 CORS \u8bf7\u6c42\u3002</p> <p>\u975e\u7b80\u5355\u8bf7\u6c42\u793a\u610f\u56fe </p> <p>\u4e0e JSONP \u7684\u6bd4\u8f83 CORS \u4e0e JSONP \u7684\u4f7f\u7528\u76ee\u7684\u76f8\u540c\uff0c\u4f46\u662f\u6bd4 JSONP \u66f4\u5f3a\u5927\u3002JSONP \u53ea\u652f\u6301 GET \u8bf7\u6c42\uff0cCORS \u652f\u6301\u6240\u6709\u7c7b\u578b\u7684 HTTP \u8bf7\u6c42\u3002JSONP \u7684\u4f18\u52bf\u5728\u4e8e\u652f\u6301\u8001\u5f0f\u6d4f\u89c8\u5668\uff0c\u4ee5\u53ca\u53ef\u4ee5\u5411\u4e0d\u652f\u6301 CORS \u7684\u7f51\u7ad9\u8bf7\u6c42\u6570\u636e\u3002</p> <p>\u670d\u52a1\u5668\u7aef\uff1a 1\u3001\u6ce8\u89e3@CrossOrigin \u6807\u6ce8\u5728\u7c7b\u6216\u8005\u65b9\u6cd5\u4e0a\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4ee5\u4e0b\u5c5e\u6027\uff1a</p> <ul> <li>origins\u00a0\u548c\u00a0value\u00a0\u5c5e\u6027\uff1a\u5bf9\u5e94\u4e8eHTTP\u54cd\u5e94\u5934\u4e2d\u7684Access-Control-Allow-Origin\uff0c\u6307\u5b9a\u6240\u652f\u6301\u57df\u7684\u96c6\u5408\uff0c\u9ed8\u8ba4\u503c\u4e3a*\u3002</li> <li>allowedHeaders\uff1a\u5bf9\u5e94\u4e8eHTTP\u54cd\u5e94\u5934\u4e2d\u7684Access-Control-Allow-OriginAccess-Control-Allow-Headers</li> <li>exposedHeaders\uff1a\u5bf9\u5e94\u4e8eHTTP\u54cd\u5e94\u5934\u4e2d\u7684Access-Control-Expose-Headers</li> <li>methods\uff1a\u5bf9\u5e94\u4e8eHTTP\u54cd\u5e94\u5934\u4e2d\u7684Access-Control-Allow-Methods</li> <li>allowCredentials\uff1a\u5bf9\u5e94\u4e8eHTTP\u54cd\u5e94\u5934\u4e2d\u7684Access-Control-Allow-Credentials</li> <li>maxAge\uff1a\u5bf9\u5e94\u4e8eHTTP\u54cd\u5e94\u5934\u4e2d\u7684Access-Control-Max-Age</li> </ul> <p>2\u3001\u5b9e\u73b0WebMvcConfigurer\u63a5\u53e3 Text Only<pre><code>@Configuration\npublic class WebConfigurer implements WebMvcConfigurer {\n\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0public void addCorsMappings(CorsRegistry registry) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e3aurl\u6dfb\u52a0\u6620\u5c04\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0registry.addMapping(\"/**\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u5141\u8bb8\u7684\u57df\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.allowedOrigins(\"*\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u5141\u8bb8\u8bf7\u6c42\u7684\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.allowedMethods(\"*\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u5141\u8bb8\u7684header\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.allowedHeaders(\"*\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u662f\u5426\u53d1\u9001cookie\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.allowCredentials(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 3\u3001\u5b9e\u73b0\u8fc7\u6ee4\u5668 CorsFilter\u662fSpring\u5b9e\u73b0\u7684Servlet\u7684Filter Text Only<pre><code>@Configuration\npublic class CorsConfig {\n\u00a0\u00a0\u00a0\u00a0public CorsConfig() {\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Bean\n\u00a0\u00a0\u00a0\u00a0public CorsFilter corsFilter() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1. \u6dfb\u52a0cors\u914d\u7f6e\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CorsConfiguration config = new CorsConfiguration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config.addAllowedOrigin(\"http://localhost:8080\");\n\u00a0 \u00a0 \u00a0 \u00a0 config.addAllowedOrigin(\"http://localhost:8081\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config.addAllowedOrigin(\"http://localhost:8082\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config.addAllowedOrigin(\"*\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u662f\u5426\u53d1\u9001cookie\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config.setAllowCredentials(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u5141\u8bb8\u8bf7\u6c42\u7684\u65b9\u5f0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config.addAllowedMethod(\"*\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6e\u5141\u8bb8\u7684header\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0config.addAllowedHeader(\"*\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2. \u4e3aurl\u6dfb\u52a0\u6620\u5c04\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0UrlBasedCorsConfigurationSource corsSource = new UrlBasedCorsConfigurationSource();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0corsSource.registerCorsConfiguration(\"/**\", config);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3. \u8fd4\u56de\u91cd\u65b0\u5b9a\u4e49\u597d\u7684corsSource\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new CorsFilter(corsSource);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/0-Flink%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/","title":"0-Flink\u601d\u7ef4\u5bfc\u56fe","text":"<p> \u7ea6 41 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>\u6211\u89c9\u5f97Flink\u7684\u5185\u5bb9\u5e94\u8be5\u6309\u4e0b\u9762\u7684\u7ed3\u6784\u8bb2\u89e3\uff0c\u4e3b\u8981\u662fwatermark\u7684\u5b89\u6392\uff0c\u4e0d\u5e94\u8be5\u548c\u65f6\u95f4\u7a97\u53e3\u63c9\u5728\u4e00\u8d77\u3002 </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/1-Flink%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/","title":"1-Flink\u5feb\u901f\u4e0a\u624b","text":"<p> \u7ea6 2031 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 41 \u5206\u949f</p> <p>Flink vs Spark Streaming Flink\u662f\u771f\u6b63\u9762\u5411\u6d41\u7684\uff0c\u5373\u4f7f\u662f\u5904\u7406\u6279\u91cf\u6570\u636e\u4e5f\u662f\u5f53\u4f5c\u6d41\uff0c\u5373\u6709\u754c\u6d41\u3002\u800cSparkStreaming\u5219\u662f\u9762\u5411\u6279\u91cf\u6570\u636e\u7684\uff0c\u5373\u4f7f\u662f\u5b9e\u65f6\u6570\u636e\u4e5f\u662f\u5f53\u4f5c\u6279\u91cf\u6570\u636e\u5904\u7406\uff0c\u5373\u5fae\u6279\u3002\u56e0\u4e3aFlink\u662f\u9762\u5411\u6d41\u7684\uff0c\u6240\u4ee5Flink\u662f\u6ca1\u6709stage\u5212\u5206\u7684\uff0c\u56e0\u4e3a\u6570\u636e\u662f\u6e90\u6e90\u4e0d\u65ad\u7684\u8fc7\u6765\uff0c\u6240\u4ee5\u4e0d\u53ef\u80fd\u7b49\u524d\u4e00\u4e2a\u9636\u6bb5\u5b8c\u6210\u4e86\u624d\u5f00\u59cb\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684\u8ba1\u7b97\uff0cFlink\u662f\u6765\u4e00\u6761\u6570\u636e\u5c31\u5f00\u59cb\u8fdb\u884c\u8ba1\u7b97\u3002</p> <p>IDEA\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u4e0b\u7684WordCount \u4f9d\u8d56\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;flink-java&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;flink-streaming-java_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- \u5982\u679c\u60f3\u6253\u5370\u65e5\u5fd7\uff0c\u53ef\u4ee5\u5f15\u5165slf4j-simple--&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.7.30&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> words.txt\u6587\u4ef6\uff1a Text Only<pre><code>hello world\nhello Flink\nhello spark\n</code></pre> \u6279\u5904\u7406 Java\u4e2d\u6ca1\u6709\u5143\u7ec4\u7c7b\u578b\uff0c\u9700\u8981\u4f7f\u7528Flink Java\u7248\u63d0\u4f9b\u7684\u5143\u7ec4\u7c7b Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0 \u00a0//1.\u521b\u5efa\u6279\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0 \u00a0ExecutionEnvironment env = `ExecutionEnvironment`.getExecutionEnvironment();\n\u00a0 \u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0 \u00a0`DataSource`&lt;String&gt; ds = env.readTextFile(\"words.txt\");\n\u00a0 \u00a0//3.\u6279\u91cf\u8ba1\u7b97\n\u00a0 \u00a0ds.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String[] words = value.split(\" \");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0for (String word : words) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0out.collect(`new Tuple2&lt;&gt;(word, 1)`);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.groupBy(0) \u00a0// \u6309\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\u5206\u7ec4\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.sum(1) \u00a0// \u5bf9\u7b2c\u4e8c\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\u6c42\u548c\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.print();\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>(world,1)\n(Flink,1)\n(hello,3)\n(spark,1)\n</code></pre></p> <p>\u6d41\u5904\u7406 \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0 \u00a0 \u00a0 \u00a0StreamExecutionEnvironment env = `StreamExecutionEnvironment`.getExecutionEnvironment();\n\u00a0 \u00a0 \u00a0 \u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0 \u00a0 \u00a0 \u00a0`DataStreamSource`&lt;String&gt; dss = env.readTextFile(\"words.txt\");\n\u00a0 \u00a0 \u00a0 \u00a0//3.\u6d41\u5f0f\u8ba1\u7b97\n\u00a0 \u00a0 \u00a0 \u00a0dss.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String[] words = value.split(\" \");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0for (String word : words) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0out.collect(new Tuple2&lt;&gt;(word, 1));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.keyBy(0)\u00a0 // \u6309\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\u5206\u7ec4\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.sum(1) \u00a0// \u5bf9\u7b2c\u4e8c\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\u6c42\u548c\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.print();\n\u00a0 \u00a0 \u00a0 `//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97`\n `env.execute();`\n\u00a0 \u00a0}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u7b2c\u4e00\u4e2a\u6570\u5b57\u662fslot\u7684\u7f16\u53f7\uff0c\u6bcf\u4e2aslot\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u7ebf\u7a0b\uff0cslot\u7f16\u53f7\u7684\u8f93\u51fa\u53ea\u4e0eprint()\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u6709\u5173\uff0c\u5982\u679cprint()\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e3a1\uff0c\u90a3\u4e48print\u7b97\u5b50\u53ea\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\uff0c\u4e8e\u662f\u5c31\u4e0d\u4f1a\u8f93\u51faslot\u7684\u7f16\u53f7\u3002\u5728IDEA\u7684\u672c\u5730\u6d4b\u8bd5\u73af\u5883\u4e0b\uff0c\u53ea\u6709\u4e00\u4e2ataskmanager\uff0c\u8be5taskmanager\u7684slot\u6570\u7b49\u4e8e\u672c\u673acpu\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\uff0c\u90a3\u4e48\u6bcf\u4e2a\u7b97\u5b50\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\u4e5f\u7b49\u4e8e\u672c\u673acpu\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002 \u8fd8\u53ef\u4ee5\u770b\u5230\u5728\u6d41\u5f0f\u8ba1\u7b97\u7684\u65b9\u5f0f\u4e0b\uff0c\u6bcf\u8bfb\u53d6\u4e00\u884c\u6570\u636e\u5c31\u505a\u4e00\u6b21\u8ba1\u7b97\uff0c\u5e76\u4e14\u540e\u9762\u7684\u8ba1\u7b97\u57fa\u4e8e\u524d\u9762\u8ba1\u7b97\u7684\u7ed3\u679c\uff0c\u524d\u9762\u8ba1\u7b97\u7684\u7ed3\u679c\u79f0\u4e3a\u72b6\u6001\u3002 Text Only<pre><code>9&gt; (world,1)\n5&gt; (hello,1)\n1&gt; (spark,1)\n5&gt; (hello,2)\n16&gt; (Flink,1)\n5&gt; (hello,3)\n</code></pre></p> <p>\u5728\u4ee3\u7801\u4e2d\u8bbe\u7f6e\u6574\u4e2a\u6267\u884c\u73af\u5883\u7684\u5e76\u884c\u5ea6\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0 \u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0 \u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n `//\u8bbe\u7f6e\u5e76\u884c\u5ea6`\n `env.setParallelism(1);`\n\u00a0 \u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0 \u00a0DataStreamSource&lt;String&gt; dss = env.readTextFile(\"words.txt\");\n\u00a0 \u00a0//3.\u6d41\u5f0f\u8ba1\u7b97\n\u00a0 \u00a0dss.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String[] words = value.split(\" \");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0for (String word : words) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0out.collect(new Tuple2&lt;&gt;(word, 1));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.keyBy(0)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.sum(1)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.print();\n\u00a0 \u00a0//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97\n\u00a0 \u00a0env.execute();\n}\n</code></pre> \u6b64\u65f6print()\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e3a1\uff0c\u4e8e\u662f\u5c31\u4e0d\u4f1a\u8f93\u51fa\u7ebf\u7a0bid\u4e86\uff1a Text Only<pre><code>(hello,1)\n(world,1)\n(hello,2)\n(Flink,1)\n(hello,3)\n(spark,1)\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u76f4\u63a5\u8bbe\u7f6e\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\uff0c\u76f4\u63a5\u8bbe\u7f6e\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4f1a\u8986\u76d6\u6574\u4e2a\u6267\u884c\u73af\u5883\u8bbe\u7f6e\u7684\u5e76\u884c\u5ea6\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0 \u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0 \u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0 \u00a0 `//\u8bbe\u7f6e\u5e76\u884c\u5ea6`\n `env.setParallelism(1);`\n\u00a0 \u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0 \u00a0DataStreamSource&lt;String&gt; dss = env.readTextFile(\"words.txt\");\n\u00a0 \u00a0//3.\u6d41\u5f0f\u8ba1\u7b97\n\u00a0 \u00a0dss.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String[] words = value.split(\" \");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0for (String word : words) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0out.collect(new Tuple2&lt;&gt;(word, 1));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.keyBy(0)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.sum(1)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0`.print().setParallelism(2);`\n\u00a0 \u00a0//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97\n\u00a0 \u00a0env.execute();\n}\n</code></pre> \u6b64\u65f6print()\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e3a2\uff0c\u6240\u4ee5\u4f1a\u8f93\u51fa\u7ebf\u7a0bid\uff1a Text Only<pre><code>2&gt; (hello,1)\n2&gt; (hello,2)\n1&gt; (world,1)\n2&gt; (hello,3)\n1&gt; (Flink,1)\n1&gt; (spark,1)\n</code></pre></p> <p>Standalone\u6a21\u5f0f \u4f7f\u7528Flink\u81ea\u5e26\u7684\u8d44\u6e90\u7ba1\u7406\u5668\u90e8\u7f72Flink\u96c6\u7fa4\uff0cStandaloneSessionClusterEntrypoint\u7c7b\u4f3c\u4e8eyarn\u7684ResourceManager\uff0cTaskManagerRunner\u7c7b\u4f3c\u4e8eyarn\u7684NodeManager \u96c6\u7fa4\u89c4\u5212\uff1a  1.\u89e3\u538b Text Only<pre><code>tar -zxvf /opt/software/flink-1.10.1-bin-scala_2.12.tgz -C /opt/module/\n</code></pre> 2.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u4fee\u6539/opt/module/flink-1.10.1/conf/flink-conf.yaml Text Only<pre><code># jobmanager\u7684rpc\u901a\u4fe1\u5730\u5740\njobmanager.rpc.address: hadoop102\n# \u6bcf\u4e2ataskmanager\u7684slot\u6570\uff0cslot\u6570\u5c31\u662ftaskmanager\u80fd\u542f\u52a8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\ntaskmanager.numberOfTaskSlots: 2\n# \u5728\u4e0d\u6307\u5b9a\u7b97\u5b50\u5e76\u884c\u5ea6\u65f6\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff0c\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u6307\u7684\u662f\u8be5\u7b97\u5b50\u4f1a\u5728\u591a\u5c11\u4e2aslot\u4e0a\u5f00\u542f\u8ba1\u7b97\u4efb\u52a1\nparallelism.default: 1\n</code></pre> \u4fee\u6539/opt/module/flink-1.10.1/conf/masters Text Only<pre><code>hadoop102:8081\n</code></pre> \u4fee\u6539/opt/module/flink-1.10.1/conf/slaves Text Only<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> 3.\u5206\u53d1 Text Only<pre><code>xsync flink-1.10.1/\n</code></pre> 4.\u542f\u52a8 Text Only<pre><code>bin/start-cluster.sh\n</code></pre>  5.webui\u67e5\u770b\u96c6\u7fa4\u7684\u8fd0\u884c\u60c5\u51b5 Text Only<pre><code>http://hadoop102:8081\n</code></pre> 6.\u505c\u6b62 Text Only<pre><code>bin/stop-cluster.sh\n</code></pre> 7.\u63d0\u4ea4\u4efb\u52a1\u5230\u96c6\u7fa4 7.1 webui\u4e0a\u63d0\u4ea4job 7.2 \u547d\u4ee4\u884c\u63d0\u4ea4job\uff0c-p\u53c2\u6570\u6307\u5b9a\u5e76\u884c\u5ea6 Text Only<pre><code>bin/flink run -c wordcount.StreamWordCount02 -p 2 /opt/software/Flink-1.0-SNAPSHOT.jar --host 192.168.10.1 --port 7777\n</code></pre> 8.\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684job Text Only<pre><code>bin/flink list\n</code></pre> \u67e5\u770b\u6240\u6709\u5df2\u7ecf\u63d0\u4ea4\u7684job Text Only<pre><code>bin/flink list -a\n</code></pre> 9.\u53d6\u6d88\u6b63\u5728\u8fd0\u884c\u7684\u4efb\u52a1\uff08\u7528\u4e0a\u9762\u7684\u90a3\u4e2a\u547d\u4ee4\u5148\u5f97\u5230JobID\uff09 Text Only<pre><code>bin/flink cancel 0329a7f45692a7e4e2118c27102d846c\n</code></pre></p> <p>conf/flink-conf.yaml\u914d\u7f6e\u6587\u4ef6\uff1a Text Only<pre><code># jobmanager\u7684rpc\u901a\u4fe1\u5730\u5740\njobmanager.rpc.address: hadoop102\n\n# jobmanager\u7684rpc\u901a\u4fe1\u7aef\u53e3\njobmanager.rpc.port: 6123\n\n# jobmanager\u7684\u5806\u5185\u5b58\njobmanager.heap.size: 1024m\n\n# taskmanager\u5806\u5185\u5b58\u548c\u5806\u5916\u5185\u5b58\u4e4b\u548c\uff0cFlink\u7684\u72b6\u6001\u662f\u653e\u5728taskmanager\u7684\u5806\u5916\u5185\u5b58\u4e0a\ntaskmanager.memory.process.size: 1728m\uff0c\n\n# \u6bcf\u4e2ataskmanager\u7684slot\u6570\uff0cslot\u6570\u5c31\u662ftaskmanager\u80fd\u542f\u52a8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u6240\u4ee5\u8fd9\u4e2a\u53ea\u4e00\u822c\u8bbe\u7f6e\u4e3acpu\u7684\u7ebf\u7a0b\u6570\ntaskmanager.numberOfTaskSlots: 1\n\n# \u4e00\u4e2a\u7b97\u5b50\u6ca1\u6709\u660e\u786e\u6307\u51fa\u5e76\u884c\u5ea6\u65f6\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff0c\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u5c31\u662f\u5b50\u4efb\u52a1\u7684\u6570\u91cf\nparallelism.default: 1\n</code></pre></p> <p>Yarn\u6a21\u5f0f 1.\u89e3\u538b\u5e76\u91cd\u547d\u540d Text Only<pre><code>tar -zxvf /opt/software/flink-1.10.1-bin-scala_2.12.tgz -C /opt/module/\n</code></pre> Text Only<pre><code>mv flink-1.10.1 flink-yarn\n</code></pre> 2.\u4e0b\u8f7dflink-shaded-hadoop-2-uber-2.8.3-10.0.jar\uff0c\u5e76\u5c06\u5176\u653e\u5230/opt/module/flink-yarn/lib\u4e0b</p> <p>Flink \u63d0\u4f9b\u4e86\u4e24\u79cd\u5728 yarn \u4e0a\u8fd0\u884c\u7684\u6a21\u5f0f\uff0c\u5206\u522b\u4e3a Session-Cluster \u548c Per-Job-Cluster\u6a21\u5f0f\u3002 Session-Cluster\u6a21\u5f0f Session-Cluster\u6a21\u5f0f\u662f\u5148\u5728 yarn \u4e2d\u521d\u59cb\u5316\u4e00\u4e2a flink \u96c6\u7fa4\uff08yarn\u7684\u4e00\u4e2aapplication\uff09\uff0c\u5f00\u8f9f\u6307\u5b9a\u7684\u8d44\u6e90\uff0c\u4ee5\u540e\u63d0\u4ea4\u4efb\u52a1\u90fd\u5411\u8fd9\u91cc\u63d0\u4ea4\uff0c\u8fd9\u4e2a flink \u96c6\u7fa4\u4f1a\u5e38\u9a7b\u5728 yarn \u96c6\u7fa4\u4e2d\uff0c \u9664\u975e\u624b\u5de5\u505c\u6b62\uff08\u4e0estandalone\u6a21\u5f0f\u5f88\u7c7b\u4f3c\uff09\u3002Session-Cluster\u6a21\u5f0f\u9700\u8981\u5148\u521d\u59cb\u5316 flink \u96c6\u7fa4\u5e76\u6307\u5b9a\u8d44\u6e90\u7684\u6570\u91cf\uff0c\u5982\u679c\u4e0d\u80fd\u6ee1\u8db3\u4e0b\u4e00\u4e2a\u4f5c\u4e1a\u6240\u9700\u8981\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u8be5\u4f5c\u4e1a\u5c31\u65e0\u6cd5\u63d0\u4ea4\uff0c\u53ea\u80fd\u7b49\u5230\u524d\u9762\u7684\u4f5c\u4e1a\u6267\u884c\u5b8c\u6210\u540e\uff0c \u91ca\u653e\u4e86\u8d44\u6e90\uff0c \u8be5\u4f5c\u4e1a\u624d\u4f1a\u80fd\u63d0\u4ea4\u6210\u529f\u3002\u6240\u4ee5\u5728Session-Cluster\u6a21\u5f0f\u4e0b\uff0c\u6240\u6709\u4f5c\u4e1a\u5171\u4eab\u8d44\u6e90\uff0c\u9002\u5408\u89c4\u6a21\u5c0f\u6267\u884c\u65f6\u95f4\u77ed\u7684\u4f5c\u4e1a\u3002 1.\u542f\u52a8hadoop\u96c6\u7fa4 2.\u542f\u52a8 yarn-session Text Only<pre><code>bin/yarn-session.sh -n 2 -s 2 -jm 1024 -tm 1024 -nm flink-cluster -d\n</code></pre> yarn-session.sh\u7684\u53c2\u6570\uff1a Text Only<pre><code>-n,--container &lt;arg&gt; \u8868\u793a\u5206\u914d\u5bb9\u5668\u7684\u6570\u91cf\uff08\u4e5f\u5c31\u662f TaskManager \u7684\u6570\u91cf\uff09\u3002\n-D &lt;arg&gt; \u52a8\u6001\u5c5e\u6027\u3002\n-d,--detached \u5728\u540e\u53f0\u72ec\u7acb\u8fd0\u884c\u3002\n-jm,--jobManagerMemory &lt;arg&gt;\uff1a\u8bbe\u7f6e JobManager \u7684\u5185\u5b58\uff0c\u5355\u4f4d\u662f MB\u3002\n-nm,--name\uff1a\u5728 YARN \u4e0a\u4e3a\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5e94\u7528\u8bbe\u7f6e\u4e00\u4e2a\u540d\u5b57\u3002\n-q,--query\uff1a\u663e\u793a YARN \u4e2d\u53ef\u7528\u7684\u8d44\u6e90\uff08\u5185\u5b58\u3001cpu \u6838\u6570\uff09\u3002\n-qu,--queue &lt;arg&gt;\uff1a\u6307\u5b9a YARN \u961f\u5217\u3002\n-s,--slots &lt;arg&gt;\uff1a\u6bcf\u4e2a TaskManager \u7684 Slot \u6570\u91cf\uff0c\u9ed8\u8ba4\u6bcf\u4e2ataskmanager \u7684 slot \u7684\u4e2a\u6570\u4e3a 1\u3002\n-tm,--taskManagerMemory &lt;arg&gt;\uff1a\u6bcf\u4e2a TaskManager \u7684\u5185\u5b58\uff0c\u5355\u4f4d\u662f MB\u3002\n-z,--zookeeperNamespace &lt;arg&gt;\uff1a\u9488\u5bf9 HA \u6a21\u5f0f\u5728 ZooKeeper \u4e0a\u521b\u5efa NameSpace\u3002\n-id,--applicationId &lt;yarnAppId&gt;\uff1a\u6307\u5b9a YARN \u96c6\u7fa4\u4e0a\u7684\u4efb\u52a1 ID\uff0c\u9644\u7740\u5230\u4e00\u4e2a\u540e\u53f0\u72ec\u7acb\u8fd0\u884c\u7684 yarn session \u4e2d\u3002\n</code></pre> 3.\u63d0\u4ea4job Text Only<pre><code>bin/flink run -c wordcount.StreamWordCount02 -p 2 /opt/software/Flink-1.0-SNAPSHOT.jar --host 192.168.10.1 --port 7777\n</code></pre> 4.\u53d6\u6d88yarn-session\uff0c\u4e5f\u5c31\u662f\u76f4\u63a5\u6740\u6b7byarn\u5e94\u7528 Text Only<pre><code>yarn application --kill application_1577588252906_0001\n</code></pre></p> <p>Per-Job-Cluster\u6a21\u5f0f \u6bcf\u6b21\u63d0\u4ea4\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 flink \u96c6\u7fa4\uff0c\u4efb\u52a1\u4e4b\u95f4\u4e92\u76f8\u72ec\u7acb\uff0c\u4e92\u4e0d\u5f71\u54cd\uff0c\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u521b\u5efa\u7684\u96c6\u7fa4\u4e5f\u4f1a\u6d88\u5931\u3002 Per-Job-Cluster\u6a21\u5f0f\u4e0b\uff0c\u4e00\u4e2a Job \u4f1a\u5bf9\u5e94\u4e00\u4e2a\u96c6\u7fa4\uff0c\u6bcf\u63d0\u4ea4\u4e00\u4e2a\u4f5c\u4e1a\u4f1a\u6839\u636e\u81ea\u8eab\u7684\u60c5\u51b5\uff0c\u90fd\u4f1a\u5355\u72ec\u5411 yarn \u7533\u8bf7\u8d44\u6e90\uff0c\u76f4\u5230\u4f5c\u4e1a\u6267\u884c\u5b8c\u6210\uff0c\u4e00\u4e2a\u4f5c\u4e1a\u7684\u5931\u8d25\u4e0e\u5426\u5e76\u4e0d\u4f1a\u5f71\u54cd\u4e0b\u4e00\u4e2a\u4f5c\u4e1a\u7684\u6b63\u5e38\u63d0\u4ea4\u548c\u8fd0\u884c\uff0c\u9002\u5408\u89c4\u6a21\u5927\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4f5c\u4e1a\u3002 1.\u542f\u52a8hadoop\u96c6\u7fa4 2.\u4e0d\u9700\u8981\u542f\u52a8yarn-session\uff0c\u76f4\u63a5\u63d0\u4ea4job\u5373\u53ef Text Only<pre><code>bin/flink run -m yarn-cluster -ynm flink-Per-Job-Cluster -c wordcount.StreamWordCount02 /opt/software/Flink-1.0-SNAPSHOT.jar --host 192.168.10.1 --port 7777\n</code></pre> bin/flink run\u7684\u53c2\u6570\uff1a Text Only<pre><code>-yn,--container &lt;arg&gt; \u8868\u793a\u5206\u914d\u5bb9\u5668\u7684\u6570\u91cf\uff0c\u4e5f\u5c31\u662f TaskManager \u7684\u6570\u91cf\u3002\n-d,--detached\uff1a\u8bbe\u7f6e\u5728\u540e\u53f0\u8fd0\u884c\u3002\n-yjm,--jobManagerMemory&lt;arg&gt;:\u8bbe\u7f6e JobManager \u7684\u5185\u5b58\uff0c\u5355\u4f4d\u662f MB\u3002\n-ytm\uff0c--taskManagerMemory&lt;arg&gt;:\u8bbe\u7f6e\u6bcf\u4e2a TaskManager \u7684\u5185\u5b58\uff0c\u5355\u4f4d\u662f MB\u3002\n-ynm,--name:\u7ed9\u5f53\u524d Flink application \u5728 Yarn \u4e0a\u6307\u5b9a\u540d\u79f0\u3002\n-yq,--query\uff1a\u663e\u793a yarn \u4e2d\u53ef\u7528\u7684\u8d44\u6e90\uff08\u5185\u5b58\u3001cpu \u6838\u6570\uff09\n-yqu,--queue&lt;arg&gt; :\u6307\u5b9a yarn \u8d44\u6e90\u961f\u5217\n-ys,--slots&lt;arg&gt; :\u6bcf\u4e2a TaskManager \u4f7f\u7528\u7684 Slot \u6570\u91cf\u3002\n-yz,--zookeeperNamespace&lt;arg&gt;:\u9488\u5bf9 HA \u6a21\u5f0f\u5728 Zookeeper \u4e0a\u521b\u5efa NameSpace\n-yid,--applicationID&lt;yarnAppId&gt; : \u6307\u5b9a Yarn \u96c6\u7fa4\u4e0a\u7684\u4efb\u52a1 ID,\u9644\u7740\u5230\u4e00\u4e2a\u540e\u53f0\u72ec\u7acb\u8fd0\u884c\u7684 Yarn Session \u4e2d\u3002\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/10-Sink/","title":"10-Sink","text":"<p> \u7ea6 420 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>Sink\u5c31\u662f\u5c06\u6570\u636e\u8f93\u51fa\uff0c\u901a\u7528\u7684\u6dfb\u52a0Sink\u7684\u65b9\u6cd5\u662fDataStream\u7684addSink\u65b9\u6cd5\uff0caddSink\u65b9\u6cd5\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u5b9e\u73b0\u4e86SinkFunction\u63a5\u53e3\u7684\u7c7b\uff0c\u4e3b\u8981\u662f\u5b9e\u73b0SinkFunction\u63a5\u53e3\u7684invoke\u65b9\u6cd5\u3002 1.print print\u5176\u5b9e\u662faddSink(new PrintSinkFunction&lt;&gt;())\uff0cPrintSinkFunction\u7ee7\u627f\u81ea\u62bd\u8c61\u7c7bRichSinkFunction\uff0cRichSinkFunction\u5b9e\u73b0\u4e86SinkFunction\u63a5\u53e3\uff0cRichSinkFunction\u662f\u6bd4SinkFunction\u63a5\u53e3\u529f\u80fd\u66f4\u4e30\u5bcc\u7684\u5bcc\u51fd\u6570\u3002 Text Only<pre><code>@PublicEvolving\npublic DataStreamSink&lt;T&gt; print() {\n\u00a0\u00a0\u00a0PrintSinkFunction&lt;T&gt; printFunction = new PrintSinkFunction&lt;&gt;();\n\u00a0\u00a0\u00a0return addSink(printFunction).name(\"Print to Std. Out\");\n}\n</code></pre></p> <p>2.writeToSocket writeToSocket\u5176\u5b9e\u662faddSink(new SocketClientSink&lt;&gt;(hostName, port, schema) Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.fromElements(1, 2, 3)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.broadcast()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(Object::toString)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.writeToSocket(\"hadoop102\", 7777, new SimpleStringSchema());\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>\u5c06\u6570\u636e\u8f93\u51fa\u5230\u5916\u90e8\u7cfb\u7edf\u53ef\u4ee5\u81ea\u5b9a\u4e49Sink\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5bfc\u5165\u5b98\u65b9\u5df2\u7ecf\u5199\u597d\u7684\u4f9d\u8d56 3.Kafka Sink \u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;flink-connector-kafka-0.11_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.fromElements(1, 2, 3, 4, 5, 6, 7, 8, 9)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(Objects::toString)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`.addSink(new FlinkKafkaProducer011&lt;&gt;(\"hadoop102:9092\", \"flink-topic\", new SimpleStringSchema()));`\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> <p>4.\u81ea\u5b9a\u4e49Sink \u6bd4\u5982\u81ea\u5b9a\u4e49Sink\u5c06\u6570\u636e\u5199\u5230MySQL\uff0c\u7ee7\u627fRichSinkFunction\u53ef\u4ee5\u5728open\u65b9\u6cd5\u4e2d\u56de\u53bbMySQL\u7684\u8fde\u63a5\uff0copen\u65b9\u6cd5\u53ea\u4f1a\u5728Sink\u7684\u6bcf\u4e2a\u5b50\u4efb\u52a1\u5f00\u59cb\u65f6\u6267\u884c\u4e00\u6b21\uff0c\u800cinvoke\u65b9\u6cd5\u4f1a\u5728\u6bcf\u4e00\u6761\u6570\u636e\u5230\u6765\u7684\u65f6\u5019\u6267\u884c\u3002 Text Only<pre><code>public class MySQLSink extends RichSinkFunction&lt;Tuple3&lt;Integer, String, Integer&gt;&gt; {\n\u00a0 \u00a0 // \u58f0\u660e\u8fde\u63a5\u548c\u9884\u7f16\u8bd1\u8bed\u53e5\n\u00a0\u00a0\u00a0\u00a0Connection connection = null;\n\u00a0\u00a0\u00a0\u00a0PreparedStatement preStmt = null;\n\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0connection = DriverManager.getConnection(\"jdbc:mysql://localhost:3306/test?serverTimezone=UTC&amp;characterEncoding=utf-8\", \"root\", \"079335\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt = connection.prepareStatement(`\"insert into user (id, name, age) values (?, ?, ?) on DUPLICATE KEY UPDATE name=?, age=?\"`);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0connection.close();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void invoke(Tuple3&lt;Integer, String, Integer&gt; value, Context context) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.setInt(1, value.f0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.setString(2, value.f1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.setInt(3, value.f2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.setString(4, value.f1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.setInt(5, value.f2);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0preStmt.execute();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6d4b\u8bd5\uff0c\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u5982\u679c\u4e3b\u952e\u91cd\u590d\u5219\u66f4\u65b0\u6570\u636e\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.fromElements(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Tuple3&lt;&gt;(1, \"zhangsan\", 18),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Tuple3&lt;&gt;(2, \"lisi\", 19),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Tuple3&lt;&gt;(3, \"wangwu\", 20)\n\u00a0\u00a0\u00a0\u00a0)`.addSink(new MySQLSink());`\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/11-window%E7%9A%84%E7%A7%8D%E7%B1%BB%20%E5%92%8C%20%E6%97%B6%E9%97%B4%E8%AF%AD%E4%B9%89/","title":"11-window\u7684\u79cd\u7c7b \u548c \u65f6\u95f4\u8bed\u4e49","text":"<p> \u7ea6 888 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 18 \u5206\u949f</p> <p>\u7a97\u53e3\u53ef\u4ee5\u628a\u65e0\u9650\u7684\u6570\u636e\u6d41\u8fdb\u884c\u5207\u5206\u5f97\u5230\u6709\u9650\u7684\u6570\u636e\u96c6\u8fdb\u884c\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u5c06\u65e0\u754c\u6d41\u5212\u5206\u6210\u6709\u754c\u6d41\u8fdb\u884c\u5904\u7406\u3002 window\u7684\u53ef\u5206\u6210\u4e24\u7c7b\uff1a\u65f6\u95f4\u7a97\u53e3 \u548c\u00a0\u8ba1\u6570\u7a97\u53e3\u3002\u65f6\u95f4\u7a97\u53e3\u662f\u6307\u6309\u65f6\u95f4\u95f4\u9694\u5212\u5206\u7a97\u53e3\uff0c\u800c\u8ba1\u6570\u7a97\u53e3\u662f\u6307\u6309\u6307\u5b9a\u7684\u6570\u636e\u4e2a\u6570\u5212\u5206\u7a97\u53e3\u3002 \u5176\u4e2d\u65f6\u95f4\u7a97\u53e3\uff08 Time Window\uff09\u53c8\u53ef\u5206\u4e3a\uff1a</p> <ul> <li>\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3</li> <li>\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3</li> <li>\u4f1a\u8bdd\u7a97\u53e3</li> </ul> <p>\u8ba1\u6570\u7a97\u53e3\uff08 Count Window\uff09\u53c8\u53ef\u5206\u4e3a\uff1a</p> <ul> <li>\u6eda\u52a8\u8ba1\u6570\u7a97\u53e3</li> <li>\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3</li> </ul> <p>\u6eda\u52a8\u7a97\u53e3\u662f\u6307\u4e0d\u4f1a\u51fa\u73b0\u7a97\u53e3\u91cd\u53e0\u7684\u7a97\u53e3\uff0c\u53ea\u9700\u8981\u6307\u5b9a\u7a97\u53e3\u7684\u5927\u5c0f\u3002  \u800c\u6ed1\u52a8\u7a97\u53e3\u9700\u8981\u6307\u5b9a \u7a97\u53e3\u5927\u5c0f \u548c \u6ed1\u52a8\u6b65\u957f\uff0c\u4f1a\u91cd\u73b0\u7a97\u53e3\u91cd\u53e0\u3002\u6eda\u52a8\u7a97\u53e3\u53ef\u4ee5\u770b\u4f5c\u662f\u6ed1\u52a8\u6b65\u957f\u7b49\u4e8e\u7a97\u53e3\u5927\u5c0f\u7684\u6ed1\u52a8\u7a97\u53e3\u3002  \u53ea\u6709\u65f6\u95f4\u7a97\u53e3\u6709\u4f1a\u8bdd\u7a97\u53e3\u7c7b\u578b\uff0c\u4f1a\u8bdd\u7a97\u53e3\u6307\u7684\u662f\u5982\u679c\u8d85\u8fc7\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u6ca1\u6709\u6536\u5230\u6570\u636e\uff0c\u90a3\u4e48\u524d\u9762\u63a5\u6536\u5230\u7684\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u7a97\u53e3\u5185\u6570\u636e\uff0c\u63a5\u4e0b\u6765\u63a5\u6536\u5230\u7684\u6570\u636e\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u7a97\u53e3\u7684\u6570\u636e\u3002 </p> <p>\u65f6\u95f4\u7a97\u53e3\u9700\u8981\u7ed3\u5408\u65f6\u95f4\u8bed\u4e49\u6765\u4f7f\u7528\uff0c\u8ba1\u6570\u7a97\u53e3\u5e76\u4e0d\u9700\u8981\uff0c\u5728Flink\u5206\u5e03\u5f0f\u6d41\u5f0f\u6570\u636e\u5904\u7406\u7684\u67b6\u6784\u4e2d\u67093\u79cd\u65f6\u95f4\u8bed\u4e49\uff1aEvent Time\u3001Ingestion Time\u3001Window Processing Time\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a </p> <ul> <li>Event Time\u6307\u7684\u662f\u6570\u636e\u4ea7\u751f\u7684\u65f6\u95f4\uff0c\u8fd9\u9700\u8981\u5916\u90e8\u6570\u636e\u6e90\u5728\u4ea7\u751f\u6570\u636e\u65f6\u5e26\u4e0a\u65f6\u95f4\u6233\u3002</li> <li>Ingestion Time\u6307\u7684\u662f\u6570\u636e\u5230\u8fbeFlink\u7684Source\u65f6\u7684\u65f6\u95f4\u3002</li> </ul> <p>\u4ece\u4ea7\u751f\u6570\u636e\u7684\u6570\u636e\u6e90\u5230Flink\u7cfb\u7edf\uff0c\u4e2d\u95f4\u4f1a\u7ecf\u8fc7\u6d88\u606f\u4e2d\u95f4\u4ef6\u5982Kafka\uff0c\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u6d88\u606f\u4e2d\u95f4\u4ef6\u5462\uff1f\u56e0\u4e3a\u4ea7\u751f\u6570\u636e\u7684\u6570\u636e\u6e90\u4f1a\u6709\u591a\u4e2a\uff0c\u53d1\u9001\u7684\u6570\u636e\u91cf\u5f88\u5927\uff0cFlink\u63a5\u6536\u548c\u5904\u7406\u6570\u636e\u7684\u80fd\u529b\u5e76\u4e0d\u80fd\u652f\u6491\u5982\u6b64\u5927\u7684\u6570\u636e\u91cf\uff0c\u6240\u4ee5\u8fd9\u4e2d\u95f4\u5fc5\u987b\u5f15\u5165\u6d88\u606f\u4e2d\u95f4\u4ef6\u6765\u7f13\u51b2\u4e00\u4e0b\uff0cFlink\u518d\u7ed3\u5408\u81ea\u8eab\u7684\u6d88\u8d39\u80fd\u529b\u6765\u63a5\u6536\u6570\u636e\u3002 \u56e0\u4e3a\u4ea7\u751f\u6570\u636e\u7684\u6570\u636e\u6e90\u6709\u5f88\u591a\u4e2a\uff0c\u6240\u4ee5\u6570\u636e\u5230\u8fbe\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u65f6\u95f4\u987a\u5e8f\u80af\u5b9a\u4e0d\u662f\u6570\u636e\u4ea7\u751f\u65f6\u7684\u65f6\u95f4\u987a\u5e8f\uff0c\u5e76\u4e14Flink\u5728\u591a\u4e2aslot\u4e2d\u5e76\u884c\u63a5\u6536\u6570\u636e\u7684Source\u4f1a\u540c\u65f6\u6d88\u8d39Kafka\u540c\u4e00topic\u7684\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\uff0c\u6211\u4eec\u77e5\u9053Kafka\u4e0d\u540c\u5206\u533a\u4e4b\u95f4\u7684\u6570\u636e\u662f\u65e0\u5e8f\u7684\uff0c\u6240\u4ee5Flink\u63a5\u6536\u5230\u6570\u636e\u7684\u65f6\u95f4\u987a\u5e8f\u5c31\u66f4\u52a0\u4e0d\u53ef\u80fd\u4fdd\u6301\u6570\u636e\u4ea7\u751f\u65f6\u7684\u65f6\u95f4\u987a\u5e8f\u4e86\uff0c\u6240\u4ee5\u6bcf\u6761\u6570\u636e\u5c31\u4f1a\u4e00\u4e2aIngestion Time\uff0c\u8868\u793a\u6570\u636e\u5230\u8fbeFlink\u7684Source\u65f6\u7684\u65f6\u95f4\u3002</p> <ul> <li>Window Processing Time\u662f\u6307\u5230\u8fbe\u7a97\u53e3\u7684\u65f6\u95f4\u3002</li> </ul> <p>\u56e0\u4e3aFlink\u662f\u5206\u5e03\u5f0f\u6d41\u5904\u7406\u67b6\u6784\uff0c\u6570\u636e\u4ece\u4e0a\u6e38\u7b97\u5b50\u7684\u5b50\u4efb\u52a1 \u5230 \u4e0b\u6e38\u7b97\u5b50\u7684\u5b50\u4efb\u52a1 \u53ef\u80fd\u9700\u8981\u8de8\u8d8a\u4e0d\u540c\u7684slot\uff0c\u6570\u636e\u5728\u4e0d\u540c\u7684slot\u4e4b\u95f4\u4f20\u9012\u9700\u8981\u7ecf\u8fc7\u7f51\u7edc\u4f20\u8f93\uff0c\u6240\u4ee5\u8fd9\u4e2d\u95f4\u6570\u636e\u4e5f\u4f1a\u4e71\u5e8f\uff0c\u4e5f\u5c31\u6570\u636e\u5230\u8fbe\u7a97\u53e3\u7684\u65f6\u95f4\u4f1a\u4e0eIngestion Time\u4e0d\u540c\u3002</p> <p>\u6ce8\u610f\uff1a\u65f6\u95f4\u8bed\u4e49\u5e76\u4e0d\u662f\u65f6\u95f4\u7a97\u53e3\u72ec\u6709\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u5728\u6574\u4e2aFlink\u5e94\u7528\u5904\u7406\u6d41\u7a0b\u4e2d\uff0c\u51e1\u662f\u6d89\u53ca\u5230\u65f6\u95f4\u7684\u64cd\u4f5c\uff0c\u5176\u4f9d\u636e\u7684\u65f6\u95f4\u6807\u51c6\u90fd\u7531\u65f6\u95f4\u8bed\u4e49\u6765\u51b3\u5b9a\uff0c\u6bd4\u5982\u65f6\u95f4\u7a97\u53e3\u7684\u5f00\u542f\u4e0e\u5173\u95ed\u3001ProcessFunction\u4e2d\u5b9a\u65f6\u5668\u7684\u89e6\u53d1\uff0c\u628a\u65f6\u95f4\u8bed\u4e49\u653e\u5728\u8fd9\u91cc\u8bb2\uff0c\u53ea\u662f\u56e0\u4e3a\u65f6\u95f4\u7a97\u53e3\u662f\u6700\u5e38\u7528\u7684\u6d89\u53ca\u5230\u65f6\u95f4\u7684\u64cd\u4f5c\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/12-Window%20API%20%E4%B9%8B%20%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3/","title":"12-Window API \u4e4b \u521b\u5efa\u7a97\u53e3","text":"<p> \u7ea6 1020 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>DataStream\u6570\u636e\u6d41\u5e76\u4e0d\u5bf9\u6570\u636e\u8fdb\u884c\u533a\u5206\uff0c\u6240\u4ee5\u5982\u679c\u5bf9DataStream\u5f00\u7a97\uff0c\u90a3\u4e48\u5728\u5bf9\u7a97\u53e3\u8fdb\u884c\u8ba1\u7b97\u65f6\uff0c\u5fc5\u987b\u8981\u6c42\u6240\u6709\u6570\u636e\u90fd\u5230\u8fd9\u4e2a\u7a97\u53e3\u4e2d\u6765\uff0c\u4e8e\u662fDataStream\u53ea\u6709windowAll()\u3001timeWindowAll()\u3001countWindowAll()\u4e09\u4e2a\u65b9\u6cd5\uff0c\u5373\u6240\u6709\u6570\u636e\u90fd\u5230\u540c\u4e00\u4e2a\u7a97\u53e3\u4e2d\uff0c\u4e5f\u5c31\u662f\u63a5\u4e0b\u6765\u57fa\u4e8e\u7a97\u53e3\u7684\u8ba1\u7b97\u4f1a\u5c06\u6240\u6709\u6570\u636e\u6c47\u805a\u5230\u4e00\u4e2aslot\u7684\u4efb\u52a1\u4e2d\u53bb\u3002 windowAll()\u662f\u521b\u5efa\u7a97\u53e3\u7684\u901a\u7528\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f\u7528windowAll()\u521b\u5efa\u65f6\u95f4\u7a97\u53e3\u548c\u8ba1\u6570\u7a97\u53e3\uff0ctimeWindowAll() \u548c countWindowAll() \u662f\u5bf9 windowAll()\u7684\u5c01\u88c5\uff0c\u65b9\u4fbf\u8c03\u7528\u76f4\u63a5\u521b\u5efa \u65f6\u95f4\u7a97\u53e3 \u548c \u8ba1\u6570\u7a97\u53e3\u3002 \u53ea\u6709\u7ecf\u8fc7keyBy\u7b97\u5b50\u5c06DataStream\u8f6c\u6362\u6210KeyedStream\u4e4b\u540e\uff0c\u624d\u80fd\u5728\u4e0d\u540c\u7684\u7a97\u53e3\u91cc\u5bf9\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u800c\u4e0d\u662f\u5c06\u6240\u6709\u6570\u636e\u6c47\u805a\u5230\u4e00\u4e2a\u7a97\u53e3\u4e2d\u53bb\uff0c\u56e0\u4e3akeyBy\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u7ec4\uff0c\u6240\u4ee5\u5bf9KeyedStream\u5f00\u7a97\u540e\uff0c\u540c\u4e00\u4e2a\u7a97\u53e3\u91cc\u9762\u90fd\u662f\u540c\u4e00\u7ec4\u6570\u636e\uff0c\u4e0d\u540c\u7ec4\u7684\u6570\u636e\u4f1a\u8fdb\u5165\u5230\u4e0d\u540c\u7a97\u53e3\u4e2d\u53bb\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7ec4\u4f1a\u6709\u4e00\u4e2a\u7a97\u53e3\uff08\u5e76\u4e0d\u662f\u6307\u5f00\u7a97\u540e\u4e0b\u4e00\u6b65\u5bf9\u7a97\u53e3\u8ba1\u7b97\u7684\u7b97\u5b50\u7684\u4e00\u4e2a\u5b50\u4efb\u52a1\u91cc\u9762\u53ea\u6709\u4e00\u4e2a\u7a97\u53e3\uff0c\u4e8b\u5b9e\u4e0a\u4e00\u4e2a\u5b50\u4efb\u52a1\u4e2d\u53ef\u6709\u591a\u4e2a\u7a97\u53e3\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5b50\u4efb\u52a1\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u7ec4\u7684\u6570\u636e\uff09\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u5efa\u8bae\u76f4\u63a5\u5bf9DataStream\u5f00\u7a97\uff0c\u800c\u5e94\u8be5\u5bf9KeyedStream\u8fdb\u884c\u5f00\u7a97\u3002 KeyedStream\u6709window()\u3001countWindow() \u548c timeWindow() \u4e09\u4e2a\u65b9\u6cd5\u7528\u4e8e\u5f00\u7a97\uff0cwindow()\u662f\u521b\u5efa\u7a97\u53e3\u7684\u901a\u7528\u65b9\u6cd5\uff0c timeWindow() \u548c countWindow() \u662f\u5bf9 window()\u7684\u5c01\u88c5\uff0c\u65b9\u4fbf\u8c03\u7528\u76f4\u63a5\u521b\u5efa \u65f6\u95f4\u7a97\u53e3 \u548c \u8ba1\u6570\u7a97\u53e3\u3002</p> <p>KeyedStream\u7684window()\u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\uff0c\u9700\u8981\u4f20\u5165\u62bd\u8c61\u7c7bWindowAssigner\uff08 \u7a97\u53e3\u5206\u914d\u5668\uff09\u7684\u4e00\u4e2a\u5b50\u7c7b\u5bf9\u8c61\u3002 Text Only<pre><code>public &lt;W extends Window&gt; WindowedStream&lt;T, KEY, W&gt; window(`WindowAssigner`&lt;? super T, W&gt; assigner) {\n\u00a0\u00a0\u00a0return new WindowedStream&lt;&gt;(this, assigner);\n}\n</code></pre> \u62bd\u8c61\u7c7bWindowAssigner\u4e3b\u8981\u67097\u4e2a\u5177\u4f53\u7684\u5b50\u7c7b\uff1a</p> <ul> <li>SlidingProcessingTimeWindows</li> <li>SlidingEventTimeWindows</li> <li>TumblingEventTimeWindows</li> <li>TumblingProcessingTimeWindows</li> <li>ProcessingTimeSessionWindows</li> <li>EventTimeSessionWindows</li> <li>GlobalWindows</li> </ul> <p>\u524d\u97624\u4e2a\u662f\u7528\u6765\u521b\u5efa\u65f6\u95f4\u7a97\u53e3\u7684\uff0c\u5176\u4e2dSliding\u8868\u793a\u6ed1\u52a8\u7a97\u53e3\uff0cTumbling\u8868\u793a\u6eda\u52a8\u7a97\u53e3\uff0cProcessingTime\u8868\u793a\u7a97\u53e3\u7684\u65f6\u95f4\u8bed\u4e49\u662f\u6570\u636e\u5230\u8fbe\u7a97\u53e3\u7684\u65f6\u95f4\uff0cEventTime\u8868\u793a\u7a97\u53e3\u7684\u65f6\u95f4\u8bed\u4e49\u662f\u6570\u636e\u4ea7\u751f\u65f6\u7684\u65f6\u95f4\u3002\u7b2c5\u4e2a\u548c\u7b2c6\u4e2a\u662f\u7528\u6765\u521b\u5efa\u4f1a\u8bdd\u7a97\u53e3\u7684\u3002\u6700\u540e\u4e00\u4e2aGlobalWindows\u662f\u7528\u6765\u521b\u5efa\u8ba1\u6570\u7a97\u53e3\u7684\u3002</p> <p>\u6bd4\u5982\u521b\u5efa \u6eda\u52a8\u65f6\u95f4\u7a97\u53e3 \u548c \u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\uff0c\u6eda\u52a8\u7a97\u53e3\u9700\u8981\u4f20\u90121\u4e2a\u53c2\u6570\uff0c\u6ed1\u52a8\u7a97\u53e3\u9700\u8981\u4f20\u90122\u4e2a\u53c2\u6570\u3002 Text Only<pre><code>//\u65f6\u95f4\u95f4\u9694\u4e3a10s\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\nkeyedStream.window(`TumblingProcessingTimeWindows.of(Time.seconds(10))`);\nkeyedStream.window(`TumblingEventTimeWindows.of(Time.seconds(10))`);\n//\u65f6\u95f4\u95f4\u9694\u4e3a10s\uff0c\u6b65\u957f\u4e3a5s\u7684\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\nkeyedStream.window(`SlidingProcessingTimeWindows.of(Time.seconds(10), Time.seconds(5))`);\nkeyedStream.window(`SlidingEventTimeWindows.of(Time.seconds(10), Time.seconds(5))`);\n</code></pre></p> <p>\u521b\u5efa\u4f1a\u8bdd\u7a97\u53e3\uff1a Text Only<pre><code>//\u65f6\u95f4\u95f4\u9694\u4e3a10s\u7684\u4f1a\u8bdd\u7a97\u53e3\nkeyedStream.window(`EventTimeSessionWindows.withGap(Time.seconds(10))`);\nkeyedStream.window(`ProcessingTimeSessionWindows.withGap(Time.seconds(10))`);\n</code></pre></p> <p>\u521b\u5efa\u6eda\u52a8\u8ba1\u6570\u7a97\u53e3 \u548c\u00a0\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3 Text Only<pre><code>//\u8ba1\u6570\u4e3a10\u7684\u6eda\u52a8\u8ba1\u6570\u7a97\u53e3\nkeyedStream.window(`GlobalWindows.create()`).`trigger(PurgingTrigger.of(CountTrigger.of(10)))`;\n//\u8ba1\u6570\u4e3a10\uff0c\u6b65\u957f\u4e3a5\u7684\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3\nkeyedStream.window(`GlobalWindows.create()`).`evictor(CountEvictor.of(10))`.`trigger(CountTrigger.of(5))`;\n</code></pre></p> <p>\u76f4\u63a5\u4f7f\u7528KeyedStream\u7684window()\u65b9\u6cd5\u6765\u521b\u5efa\u7a97\u53e3\u6bd4\u8f83\u7e41\u7410\uff0c\u6240\u4ee5\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528 timeWindow() \u548c countWindow() \u6765\u521b\u5efa \u65f6\u95f4\u7a97\u53e3 \u548c \u8ba1\u6570\u7a97\u53e3\u3002\u6ce8\u610f\u4f1a\u8bdd\u7a97\u53e3\u867d\u7136\u5c5e\u4e8e\u65f6\u95f4\u7a97\u53e3\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u4f7f\u7528timeWindow()\u521b\u5efa\uff0c\u53ea\u80fd\u4f7f\u7528window()\u65b9\u6cd5\u521b\u5efa\u3002 \u6bd4\u5982\u521b\u5efa \u6eda\u52a8\u65f6\u95f4\u7a97\u53e3 \u548c \u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\uff1a Text Only<pre><code>//\u65f6\u95f4\u95f4\u9694\u4e3a10s\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\nkeyedStream.`timeWindow(Time.seconds(10));`\n//\u65f6\u95f4\u95f4\u9694\u4e3a10s\uff0c\u6b65\u957f\u4e3a5s\u7684\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\nkeyedStream.`timeWindow(Time.seconds(10), Time.seconds(5))`;\n</code></pre> \u5728\u4f7f\u7528 timeWindow() \u521b\u5efa\u7a97\u53e3\u65f6\uff0c\u65e0\u6cd5\u76f4\u63a5\u6307\u5b9a\u662fProcessingTime \u8fd8\u662f\u00a0EventTime\uff0c\u8fd9\u9700\u8981\u5728\u5728\u8fd0\u884c\u73af\u5883\u4e2d\u6307\u5b9a\uff0c\u9ed8\u8ba4\u662fTimeCharacteristic.ProcessingTime\uff0c\u5373\u4ee5\u6570\u636e\u5230\u8fbe\u7a97\u53e3\u7684\u65f6\u95f4\u4e3a\u51c6\u3002 Text Only<pre><code>StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nenv.setStreamTimeCharacteristic(`TimeCharacteristic.EventTime`);\nenv.setStreamTimeCharacteristic(`TimeCharacteristic.ProcessingTime`);\n</code></pre> \u56e0\u4e3atimeWindow()\u4f1a\u6839\u636e\u73af\u5883\u7684\u65f6\u95f4\u5c5e\u6027\u6765\u521b\u5efa\u5bf9\u5e94\u7684\u7c7b\u578b\u7a97\u53e3\uff0ctimeWindow()\u7684\u6e90\u7801\uff1a Text Only<pre><code>public WindowedStream&lt;T, KEY, TimeWindow&gt; timeWindow(Time size) {\n\u00a0\u00a0\u00a0if (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return window(TumblingProcessingTimeWindows.of(size));\n\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return window(TumblingEventTimeWindows.of(size));\n\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u521b\u5efa \u6eda\u52a8\u8ba1\u6570\u7a97\u53e3 \u548c\u00a0\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3\uff1a Text Only<pre><code>//\u8ba1\u6570\u4e3a10\u7684\u6eda\u52a8\u8ba1\u6570\u7a97\u53e3\nkeyedStream`.countWindow(10);`\n//\u8ba1\u6570\u4e3a10\uff0c\u6b65\u957f\u4e3a5\u7684\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3\nkeyedStream`.countWindow(10, 5);`\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/13-1-Window%20API%20%E4%B9%8B%20%E8%81%9A%E5%90%88%E7%AE%97%E5%AD%90/","title":"13-1-Window API \u4e4b \u805a\u5408\u7b97\u5b50","text":"<p> \u7ea6 1696 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 34 \u5206\u949f</p> <p>KeyedStream\u8c03\u7528window()\u3001countWindow() \u548c\u00a0timeWindow()\u65b9\u6cd5\u5f00\u7a97\u4e4b\u540e\u5c31\u53d8\u6210\u4e86WindowedStream\uff0cWindowedStream\u5e76\u4e0d\u7ee7\u627f\u81eaKeyedStream\uff0c\u6240\u4ee5WindowedStream\u4e0e KeyedStream \u548c\u00a0DataStream \u5e76\u6ca1\u6709\u7ee7\u627f\u5173\u7cfb\u3002WindowedStream \u548c\u00a0KeyedStream \u4e00\u6837\u6709sum()\u3001min()\u3001max()\u3001minBy()\u3001maxBy() \u4ee5\u53ca reduce() \u8fd9\u4e9b\u805a\u5408\u7b97\u5b50\uff0c\u5b83\u4eec\u529f\u80fd\u90fd\u662f\u76f8\u4f3c\u7684\uff0c\u4f46\u662f\u57fa\u4e8e\u4e24\u4e2a\u6d41\u5404\u81ea\u7684\u7279\u70b9\uff0c\u6240\u4ee5\u8fd9\u4e9b\u805a\u5408\u7b97\u5b50\u90fd\u662f\u5728\u5404\u81ea\u7c7b\u4e2d\u72ec\u7acb\u5b9e\u73b0\u3002\u5e76\u4e14\u7531\u4e8e\u53ea\u6709 DataStream \u53ca\u5176\u5b50\u7c7b\u5982\u00a0KeyedStream \u624d\u6709Sink\uff0c\u6240\u4ee5WindowedStream\u5fc5\u987b\u8c03\u7528\u805a\u5408\u7b97\u5b50\u505a\u805a\u5408\u8fd0\u7b97\u8f6c\u6362\u6210\u00a0DataStream \u4e4b\u540e\u624d\u53ef\u4ee5\u8f93\u51fa\u7ed3\u679c\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f00\u7a97\u7684\u552f\u4e00\u76ee\u7684\u5c31\u662f\u505a\u805a\u5408\u8fd0\u7b97\u3002 WindowedStream\u7684\u805a\u5408\u7b97\u5b50\u9700\u8981\u4f20\u5165\u7684\u51fd\u6570\u5206\u4e3a\u4e24\u7c7b\uff1a \u589e\u91cf\u805a\u5408\u51fd\u6570\uff08 incremental aggregation functions\uff09\u548c \u5168\u7a97\u53e3\u51fd\u6570\uff08 full window functions\uff09\u3002 \u589e\u91cf\u805a\u5408\u51fd\u6570\u5305\u62ec\uff1aReduceFunction \u548c AggregateFunction\u3002\u589e\u91cf\u805a\u5408\u7684\u610f\u601d\u662f\uff0c\u7a97\u53e3\u4e2d\u6bcf\u6765\u4e00\u6761\u6570\u636e\uff0c\u7b97\u5b50\u5c31\u4f1a\u8c03\u7528\u589e\u91cf\u805a\u5408\u51fd\u6570\u5bf9\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u8ba1\u7b97\uff0c\u6bcf\u6b21\u8ba1\u7b97\u90fd\u4f1a\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c\uff0c\u8fd9\u4e2a\u4e2d\u95f4\u7ed3\u679c\u79f0\u4e3a\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u8ba1\u7b97\u5176\u5b9e\u662f\u5bf9\u8be5\u72b6\u6001\u7684\u66f4\u65b0\u3002 \u5168\u7a97\u53e3\u51fd\u6570\u5305\u62ec\uff1aProcessWindowFunction \u548c WindowFunction\u3002\u5168\u7a97\u53e3\u805a\u5408\u7684\u610f\u601d\u662f\uff0c\u7a97\u53e3\u4e2d\u6bcf\u6765\u4e00\u6761\u6570\u636e\uff0c\u7b97\u5b50\u5e76\u4e0d\u4f1a\u7acb\u5373\u8fdb\u884c\u8ba1\u7b97\uff0c\u800c\u662f\u5148\u628a\u7a97\u53e3\u5185\u7684\u6240\u6709\u6570\u636e\u6536\u96c6\u8d77\u6765\uff0c\u7b49\u5230\u7a97\u53e3\u5173\u95ed\u65f6\u518d\u8c03\u7528\u5168\u7a97\u53e3\u51fd\u6570\u904d\u5386\u6240\u6709\u6570\u636e\u4e00\u6b21\u6027\u5730\u8ba1\u7b97\uff0c\u7c7b\u4f3c\u4e8e\u6279\u5904\u7406\u3002\u5168\u7a97\u53e3\u51fd\u6570\u6ca1\u6709\u589e\u91cf\u805a\u5408\u51fd\u6570\u8ba1\u7b97\u6548\u7387\u9ad8\uff0c\u56e0\u4e3a\u5168\u7a97\u53e3\u51fd\u6570\u8981\u7b49\u5230\u7a97\u53e3\u5185\u7684\u6570\u636e\u90fd\u5230\u9f50\u4e86\u4e4b\u540e\u624d\u8ba1\u7b97\uff0c\u4f46\u662f\u4f7f\u7528\u5168\u7a97\u53e3\u51fd\u6570\u53ef\u4ee5\u62ff\u5230\u7a97\u53e3\u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u5e76\u4e14\u6709\u4e9b\u9700\u6c42\u53ea\u80fd\u4f7f\u7528\u5168\u7a97\u53e3\u51fd\u6570\u6765\u89e3\u51b3\u3002\u800c\u4e14ProcessWindowFunction\u5c5e\u4e8eProcessFunctionAPI\uff0c\u4e0d\u4ec5\u7ee7\u627f\u81eaRichFunction\uff0c\u8fd8\u63d0\u4f9b\u5176\u5b83\u5f88\u591a\u529f\u80fd\u3002</p> <p>reduce()\u9700\u8981\u4f20\u5165ReduceFunction\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u4f7f\u7528reduce\u7b97\u5b50\u5b9e\u73b0sum\u7684\u529f\u80fd\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = dataStream.map(new MapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(split[0], Integer.parseInt(split[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).keyBy(0);\n\u00a0\u00a0\u00a0\u00a0//\u65f6\u95f4\u95f4\u9694\u4e3a3s\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\n\u00a0\u00a0\u00a0\u00a0WindowedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple, TimeWindow&gt; timeWindow = keyedStream.timeWindow(Time.seconds(3));\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; result = timeWindow.reduce(`new ReduceFunction&lt;Tuple2&lt;String, Integer&gt;&gt;() {`\n `@Override`\n `public Tuple2&lt;String, Integer&gt; reduce(Tuple2&lt;String, Integer&gt; value1, Tuple2&lt;String, Integer&gt; value2) throws Exception {`\n `return new Tuple2&lt;&gt;(value1.f0, value1.f1 + value2.f1);`\n `}`\n `}`);\n\u00a0\u00a0\u00a0\u00a0result.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>aggregate()\u9700\u8981\u4f20\u5165AggregateFunction \u63a5\u53e3\u7684\u5b9e\u73b0\uff0cAggregateFunction\u7684\u4e09\u4e2a\u6cdb\u578b\u53c2\u6570\u662f\u8f93\u5165\u6570\u636e\u7684\u7c7b\u578b\uff0c\u4e2d\u95f4\u72b6\u6001\u7684\u7c7b\u578b\uff0c\u8f93\u51fa\u6570\u636e\u7684\u7c7b\u578b\u3002aggregate() \u548c reduce() \u90fd\u662f\u589e\u91cf\u805a\u5408\uff0c\u4f46\u662f aggregate() \u56e0\u4e3a\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e2d\u95f4\u72b6\u6001\uff0c\u6240\u4ee5\u8f93\u51fa\u7c7b\u578b\u53ef\u4ee5\u4e0e\u8f93\u5165\u7c7b\u578b\u4e0d\u540c\uff0c\u800creduce()\u4e0d\u80fd\u81ea\u5b9a\u4e49\u4e2d\u95f4\u72b6\u6001\uff0c\u4e8e\u662f\u8f93\u51fa\u7c7b\u578b\u5fc5\u987b\u4e0e\u8f93\u5165\u7c7b\u578b\u76f8\u540c\uff0c\u4e5f\u5c31\u662f\u8bf4aggregate() \u6bd4\u00a0reduce()\u66f4\u7075\u6d3b\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u867d\u7136reduce()\u4e0d\u80fd\u81ea\u5b9a\u4e49\u4e2d\u95f4\u72b6\u6001\uff0c\u4f46\u662f\u5b83\u4e5f\u662f\u6709\u4e2d\u95f4\u72b6\u6001\u7684\uff0c\u56e0\u4e3a\u5b83\u4e5f\u662f\u589e\u91cf\u805a\u5408\uff0c\u5176reduce\u7684\u8fd4\u56de\u503c\u5c31\u662f\u5b83\u7684\u4e2d\u95f4\u72b6\u6001\u3002 \u4f7f\u7528aggregate()\u8ba1\u7b97\u8f93\u5165\u6570\u636e\u7684\u5e73\u5747\u503c\uff1a Text Only<pre><code>// \u4e2d\u95f4\u72b6\u6001\npublic class AverageAccumulator {\n\u00a0\u00a0\u00a0\u00a0public String id;\n\u00a0\u00a0\u00a0\u00a0public Integer count = 0;\n\u00a0\u00a0\u00a0\u00a0public Integer sum = 0;\n}\n</code></pre> \u6bcf\u4e00\u4e2a\u5206\u7ec4\u4e00\u4e2a\u7a97\u53e3\uff0c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u6bcf\u4e2a\u5206\u7ec4\u7684\u7a97\u53e3\u5728\u4e0d\u65ad\u5730\u5f00\u542f\u548c\u5173\u95ed\uff0c\u7a97\u53e3\u5f00\u542f\u65f6\u4f1a\u8c03\u7528createAccumulator()\u65b9\u6cd5\u521b\u5efa\u6b64\u7a97\u53e3\u7684\u4e2d\u95f4\u72b6\u6001\uff0c\u7a97\u53e3\u5173\u95ed\u65f6\u4f1a\u8c03\u7528getResult()\u65b9\u6cd5\u8fd4\u56de\u7ed3\u679c\u3002\u8fd9\u4e2a\u4e2d\u95f4\u72b6\u6001\u4e0e\u952e\u63a7\u72b6\u6001\u6709\u4e00\u70b9\u7c7b\u4f3c\uff0c\u5373\u5b83\u4eec\u90fd\u5bf9\u5e94\u4e8e\u6bcf\u4e2a\u5206\u7ec4\uff0c\u4f46\u662f\u7a97\u53e3\u805a\u5408\u51fd\u6570\u7684\u8fd9\u4e2a\u4e2d\u95f4\u72b6\u6001\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u5728checkpoint\uff0c\u56e0\u4e3aWindowedStream\u7684\u6bcf\u4e2a\u7a97\u53e3\u89c6\u4e3a\u4e00\u4e2a\u6709\u754c\u6d41\u4e2d\uff0c\u8fd9\u4e2a\u4e2d\u95f4\u72b6\u6001\u53ea\u4e3a\u805a\u5408\u672c\u7a97\u53e3\u5185\u6570\u636e\u800c\u5b58\u5728\uff0c\u5b83\u4f1a\u968f\u7740\u8fd9\u4e2a\u5206\u7ec4\u7684\u7a97\u53e3\u7684\u5f00\u542f\u4e0e\u5173\u95ed\u800c\u521b\u5efa\u548c\u9500\u6bc1\uff1b\u800c\u952e\u63a7\u72b6\u6001\u53ef\u4ee5\u4fdd\u5b58\u5728checkpoint\u4e2d\uff0c\u56e0\u4e3a\u952e\u63a7\u72b6\u6001\u53ea\u80fd\u7528\u4e8eKeyedStream\uff0cKeyedStream\u662f\u65e0\u754c\u6d41\uff0c\u952e\u63a7\u72b6\u6001\u9700\u8981\u5728\u6574\u4e2a\u5e94\u7528\u8ba1\u7b97\u671f\u95f4\u6709\u6548\u3002\u6ce8\u610faggregate()\u4e0d\u80fd\u4f20\u5165RichAggregateFunction\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0// k1,1\n\u00a0\u00a0\u00a0\u00a0// k1,2\n\u00a0\u00a0\u00a0\u00a0// k1,3\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = dataStream.map(new MapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(split[0], Integer.parseInt(split[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).keyBy(0);\n\u00a0\u00a0\u00a0\u00a0//\u65f6\u95f4\u95f4\u9694\u4e3a5s\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\n\u00a0\u00a0\u00a0\u00a0WindowedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple, TimeWindow&gt; timeWindow = keyedStream.timeWindow(Time.seconds(5));\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;String, Double&gt;&gt; result = timeWindow.aggregate(new AggregateFunction&lt;Tuple2&lt;String, Integer&gt;, AverageAccumulator, Tuple2&lt;String, Double&gt;&gt;() {\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u65b0\u5f00\u542f\u4e00\u4e2a\u7a97\u53e3\u65f6\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\u521b\u5efa\u4e2d\u95f4\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public AverageAccumulator createAccumulator() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new AverageAccumulator();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7d2f\u52a0\uff0c\u5373\u589e\u91cf\u805a\u5408\uff0c\u7a97\u53e3\u4e2d\u6bcf\u6765\u4e00\u6761\u6570\u636e\u5c31\u4f1a\u8c03\u7528\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public AverageAccumulator add(Tuple2&lt;String, Integer&gt; value, AverageAccumulator acc) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0acc.id = value.f0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0acc.count++;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0acc.sum += value.f1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return acc;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7a97\u53e3\u7684\u5173\u95ed\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u8fd4\u56de\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Double&gt; getResult(AverageAccumulator acc) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(acc.id, acc.sum * 1.0 / acc.count);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5408\u5e76\u4e24\u4e2a\u4e2d\u95f4\u72b6\u6001\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u5728\u4f1a\u8bdd\u7a97\u53e3\u4e2d\u4f1a\u88ab\u8c03\u7528\uff0c\u5176\u5b83\u7c7b\u578b\u7684\u7a97\u53e3\u4e0d\u9700\u8981\u5408\u5e76\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56denull\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4f1a\u8bdd\u7a97\u53e3\u4f1a\u4e3a\u6bcf\u4e00\u6279\u76f8\u90bb\u4e24\u6761\u6570\u636e\u6ca1\u6709\u5927\u4e8e\u6307\u5b9a\u95f4\u9694\u65f6\u95f4\u7684\u6570\u636emerge\u5230\u4ee5\u4e00\u8d77\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public AverageAccumulator merge(AverageAccumulator a, AverageAccumulator b) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a.sum += b.sum;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a.count += b.count;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return a;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0result.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> aggregate()\u4f20\u5165\u589e\u91cf\u805a\u5408\u51fd\u6570AggregateFunction\u7684\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f20\u5165\u5168\u7a97\u53e3\u51fd\u6570ProcessWindowFunction \u6216 WindowFunction\u3002\u5176\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff0c\u7a97\u53e3\u5173\u95ed\u65f6\uff0cAggregateFunction\u589e\u91cf\u805a\u5408\u7684\u7ed3\u679c\u4f1a\u4f5c\u4e3a\u5168\u7a97\u53e3\u51fd\u6570\u7684\u8f93\u5165\uff08\u5728\u4e00\u4e2a\u7a97\u53e3\u5185\u8fdb\u884c\uff0c\u4e0d\u662f\u6240\u6709\u7a97\u53e3\u589e\u91cf\u805a\u5408\u7684\u7ed3\u679c\u5168\u90e8\u8f93\u5165\u5230\u4e00\u4e2a\u5168\u7a97\u53e3\u51fd\u6570\u4e2d\uff0c\u6240\u4ee5\u6b64\u65f6AggregateFunction\u7684apply\u65b9\u6cd5\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570Iterable\u91cc\u9762\u4e00\u5b9a\u662f\u53ea\u6709\u4e00\u4e2a\u5143\u7d20\uff09\uff0c\u7136\u540e\u518d\u7531\u5168\u7a97\u53e3\u51fd\u6570\u5904\u7406\u540e\u8f93\u51fa\u5230DataStream\u3002\u6240\u4ee5\u4f7f\u7528\u4f20\u4e24\u4e2a\u53c2\u6570\u7684aggregate()\u4e0d\u4ec5\u6709\u589e\u91cf\u805a\u5408\u51fd\u6570\u5b9e\u65f6\u8ba1\u7b97\u548c\u5360\u7528\u5185\u5b58\u4f4e\u7684\u4f18\u70b9\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u5728\u8ba1\u7b97\u7684\u7b2c\u4e8c\u6b65\u4e2d\u901a\u8fc7\u5168\u7a97\u53e3\u51fd\u6570\u62ff\u5230\u7a97\u53e3\u5bf9\u8c61\u7b49\u5176\u5b83\u5f88\u591a\u6709\u7528\u7684\u4fe1\u606f\u3002 WindowedStream\u5176\u5b83\u805a\u5408\u7b97\u5b50\uff1asum()\u3001min()\u3001max()\u3001minBy()\u3001maxBy() \u7684\u5b9e\u73b0\u90fd\u662f\u76f4\u63a5\u8c03\u7528aggregate()\uff0c\u53ea\u662f\u4f20\u9012\u7684\u53c2\u6570\u4e0d\u540c\u3002</p> <p>apply()\u9700\u8981\u4f20\u5165 WindowFunction\u63a5\u53e3\u7684\u5b9e\u73b0\uff0cWindowFunction\u76844\u4e2a\u6cdb\u578b\u53c2\u6570\u5206\u522b\u662f\uff1a\u8f93\u5165\u6570\u636e\u7684\u7c7b\u578b\u3001\u8f93\u51fa\u6570\u636e\u7684\u7c7b\u578b\u3001\u5206\u7ec4key\u7684\u7c7b\u578b\u3001\u7a97\u53e3\u7684\u7c7b\u578b\u3002\u4ee5\u4e0b\u4f7f\u7528apply()\u8ba1\u7b97\u5e73\u5747\u503c\uff0c\u5e76\u5e26\u4e0a\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = dataStream.map(new MapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(split[0], Integer.parseInt(split[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).keyBy(0);\n\u00a0\u00a0\u00a0\u00a0//\u65f6\u95f4\u95f4\u9694\u4e3a5s\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\n\u00a0\u00a0\u00a0\u00a0WindowedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple, TimeWindow&gt; timeWindow = keyedStream.timeWindow(Time.seconds(5));\n\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;Tuple3&lt;String, String, Double&gt;&gt; result = timeWindow.apply(new WindowFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple3&lt;String, String, Double&gt;, Tuple, TimeWindow&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void apply(Tuple key, TimeWindow window, Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; input, Collector&lt;Tuple3&lt;String, String, Double&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sum = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int count = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Tuple2&lt;String, Integer&gt; tuple2 : input) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum += tuple2.f1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count++;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0double avg = sum * 1.0 / count;\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0//\u5206\u7ec4\u5b57\u6bb5,\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4,\u5e73\u5747\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple3&lt;&gt;(key.getField(0), String.valueOf`(window.getStart()`), avg));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0result.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/13-2-Window%20API%20%E4%B9%8B%20Trigger%20%E5%92%8C%20Evictor/","title":"13-2-Window API \u4e4b Trigger \u548c Evictor","text":"<p> \u7ea6 511 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u6211\u4eec\u77e5\u9053\u5f00\u7a97\u7684\u552f\u4e00\u76ee\u7684\u5c31\u662f\u5bf9\u7a97\u53e3\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0ctrigger() \u548c\u00a0evictor() \u662f\u00a0AllWindowedStream \u548c\u00a0WindowedStream\u4e2d\u7684\u65b9\u6cd5\uff0c\u5728\u5f00\u7a97\u4e4b\u540e\uff0c\u4f7f\u7528\u7a97\u53e3\u805a\u5408\u7b97\u5b50\u4e4b\u524d\u4f7f\u7528\u3002 trigger() \u53ef\u4ee5\u51b3\u5b9a\u7a97\u53e3\u805a\u5408\u7b97\u5b50\u4ec0\u4e48\u65f6\u5019\u88ab\u8c03\u7528\uff0c\u6bd4\u5982apply()\u4f20\u5165\u7684WindowFunction\u9ed8\u8ba4\u662f\u5168\u7a97\u53e3\u805a\u5408\uff0c\u4f46\u662f\u5728apply()\u4e4b\u524d\u4f7f\u7528trigger()\u53ef\u4ee5\u6539\u53d8\u7a97\u53e3\u805a\u5408\u51fd\u6570\u8c03\u7528\u7684\u65f6\u673a\uff0c\u6bd4\u5982\u6bcf\u6765\u4e00\u6761\u6570\u636e\u5c31\u8c03\u7528\u4e00\u6b21\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple&gt; keyedStream = dataStream.map(new MapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(split[0], Integer.parseInt(split[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).keyBy(0);\n\u00a0\u00a0\u00a0\u00a0//\u65f6\u95f4\u95f4\u9694\u4e3a5s\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\n\u00a0\u00a0\u00a0\u00a0WindowedStream&lt;Tuple2&lt;String, Integer&gt;, Tuple, TimeWindow&gt; timeWindow = keyedStream.timeWindow(Time.seconds(5));\n\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;Tuple3&lt;String, String, Integer&gt;&gt; result = timeWindow\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.trigger(new Trigger&lt;Tuple2&lt;String, Integer&gt;, TimeWindow&gt;() {\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u7a97\u53e3\u4e2d\u6bcf\u6765\u4e00\u6761\u5143\u7d20\u5c31\u4f1a\u8c03\u7528`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public TriggerResult onElement(Tuple2&lt;String, Integer&gt; element, long timestamp, TimeWindow window, TriggerContext ctx) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return TriggerResult.FIRE;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u4f7f\u7528TriggerContext\u7684registerProcessingTimeTimer()\u6ce8\u518c\u7684\u5b9a\u65f6\u5668\u89e6\u53d1\u65f6\u4f1a\u8c03\u7528`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public TriggerResult onProcessingTime(long time, TimeWindow window, TriggerContext ctx) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return TriggerResult.CONTINUE;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u4f7f\u7528TriggerContext\u7684registerEventTimeTimer()\u6ce8\u518c\u7684\u5b9a\u65f6\u5668\u89e6\u53d1\u65f6\u4f1a\u8c03\u7528`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public TriggerResult onEventTime(long time, TimeWindow window, TriggerContext ctx) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return TriggerResult.CONTINUE;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u6e05\u7406\u89e6\u53d1\u5668\u6301\u6709\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u5220\u9664\u4f7f\u7528TriggerContext.registerEventTimeTimer(long)Trigger.TriggerContext.registerProcessingTimeTimer(long)\u8bbe\u7f6e\u7684\u5b9a\u65f6\u5668`\n `//\u6216\u8005\u4f7f\u7528TriggerContext.getPartitionedState(StateDescriptor)\u83b7\u5f97\u7684\u72b6\u6001`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void clear(TimeWindow window, TriggerContext ctx) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.apply(new WindowFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple3&lt;String, String, Integer&gt;, Tuple, TimeWindow&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void apply(Tuple key, TimeWindow window, Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; input, Collector&lt;Tuple3&lt;String, String, Integer&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sum = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Tuple2&lt;String, Integer&gt; tuple2 : input) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum += tuple2.f1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple3&lt;&gt;(key.getField(0), String.valueOf(window.getStart()), sum));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0result.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> TriggerResult\u662f\u4e00\u4e2a\u679a\u4e3e\u7c7b\uff0c\u67094\u4e2a\u53d6\u503c\uff1a Text Only<pre><code>public enum TriggerResult {\n\n\u00a0 \u00a0//\u4e0d\u89e6\u53d1\u7a97\u53e3\u805a\u5408\n\u00a0\u00a0\u00a0CONTINUE(false, false),\n\n\u00a0 \u00a0//\u89e6\u53d1\u7a97\u53e3\u805a\u5408\u5e76\u6e05\u9664\u7a97\u53e3\u4e2d\u7684\u6570\u636e\n\u00a0\u00a0\u00a0FIRE_AND_PURGE(true, true),\n\n\u00a0 \u00a0//\u89e6\u53d1\u7a97\u53e3\u805a\u5408\n\u00a0\u00a0\u00a0FIRE(true, false),\n\n\u00a0 \u00a0//\u6e05\u9664\u7a97\u53e3\u4e2d\u7684\u6570\u636e\n\u00a0\u00a0\u00a0PURGE(false, true);\n}\n</code></pre></p> <p>evictor()\u65b9\u6cd5\u4f20\u5165\u7684Evictor\u63a5\u53e3\u5b9e\u73b0\u7684\u4e24\u4e2a\u65b9\u6cd5\u5206\u522b\u5728\u7a97\u53e3\u51fd\u6570\u8c03\u7528\u524d\u540e\u6267\u884c\uff0c\u7528\u4e8e\u8fc7\u6ee4\u6570\u636e\uff0c\u5728\u7a97\u53e3\u51fd\u6570\u6267\u884c\u540e\u6267\u884c\u7684\u76ee\u7684\u5e94\u8be5\u662f\u56e0\u4e3a\u5728\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u5185\u5230\u6765\u7684\u6570\u636e\u4f1a\u8c03\u7528\u7a97\u53e3\u51fd\u6570\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/14-%E6%95%B0%E6%8D%AE%E6%B5%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%80%BB%E7%BB%93/","title":"14-\u6570\u636e\u6d41\u7c7b\u578b\u8f6c\u6362\u603b\u7ed3","text":"<p> \u7ea6 366 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>\u6570\u636e\u6d41\u7c7b\u578b\u7684\u8f6c\u6362\u5173\u7cfb\uff1a  1. KeyedStream \u548c SplitStream \u90fd\u662f\u7ee7\u627f\u81ea DataStream\uff0c\u800cConnectedStreams\u3001 WindowedStream\u3001 AllWindowedStream\u90fd\u662f\u72ec\u7acb\u7684\u7c7b\uff0c\u5e76\u4e0d\u7ee7\u627f\u81ea DataStream\u3002 2.\u53ea\u6709 DataStream \u53ca\u5176\u5b50\u7c7b\u624d\u6709keyBy\u3001shuffle\u3001broadcast\u3001rebalance \u548c global \u8fd9\u4e9b\u4f1a\u6253\u4e71\u6570\u636e\u7684\u7b97\u5b50\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u662f\u5728DataStream\u5b9a\u4e49\u7684\uff0c\u5176\u5b83Stream\u5e76\u6ca1\u6709\u5b9a\u4e49\u8fd9\u4e9b\u65b9\u6cd5\u3002 3.\u53ea\u6709 DataStream \u53ca\u5176\u5b50\u7c7b\u624d\u6709 Sink\uff0c\u6240\u4ee5 WindowedStream\u3001AllWindowedStream\u90fd\u5fc5\u987b\u8c03\u7528\u5982\u805a\u5408\u7b97\u5b50 \u4ee5\u53ca ConnectedStream \u5fc5\u987b\u8c03\u7528coMap\u7b97\u5b50 \u8f6c\u6362\u6210DataStream\u624d\u80fd\u8f93\u51fa\u7ed3\u679c\uff0c\u4e8e\u662f\u4e5f\u5c31\u6709\u4e0a\u56fe\u4e2d\u7684 DataStream \u8f6c\u6362\u6210\u5176\u5b83\u00a0Stream \u540e\u90fd\u4f1a\u518d\u8f6c\u6362\u6210 DataStream \u7684\u5de5\u4f5c\u6d41\u3002 4.\u6240\u6709\u6d41\u7684\u7b97\u5b50\u57fa\u672c\u4e0a\u90fd\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\u7c7b\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u7684\u540d\u5b57\u90fd\u662f\u4ee5Function\u7ed3\u5c3e\uff0c\u90fd\u7ee7\u627f\u81eaFunction\u63a5\u53e3\uff0c\u8fd9\u662f\u56e0\u4e3aJava\u4e0d\u50cfScala\u53ef\u4ee5\u76f4\u63a5\u5c06\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\uff0cJava\u53ea\u80fd\u628a\u62bd\u8c61\u65b9\u6cd5\uff08\u5373\u53ea\u6709\u65b9\u6cd5\u7684\u58f0\u660e\uff0c\u7c7b\u4f3c\u4e8eScala\u51fd\u6570\u7684\u7c7b\u578b\uff09\u5c01\u88c5\u5728\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\uff0c\u7136\u540e\u4ee5\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\u7c7b\u7684\u5bf9\u8c61\u6765\u4f20\u9012\u65b9\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\u3002\u8fd9\u4e9b\u540d\u5b57\u4ee5Function\u7ed3\u5c3e\u7684\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u7684\u5b9a\u4e49\u662f\u53ef\u4ee5\u5728\u5404\u79cd\u6d41\u5b9a\u4e49\u7684\u7b97\u5b50\u4e2d\u590d\u7528\u7684\uff0c\u6bd4\u5982KeyedStream\u7684reduce\u65b9\u6cd5 \u548c\u00a0WindowedStream\u7684reduce\u65b9\u6cd5 \u90fd\u9700\u8981\u4f20\u4e00\u4e2aReduceFunction\u63a5\u53e3\u7684\u5177\u4f53\u5b9e\u73b0\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/15-watermark/","title":"15-watermark","text":"<p> \u7ea6 2334 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 47 \u5206\u949f</p> <p>\u6211\u4eec\u77e5\u9053Event Time\u662f\u6570\u636e\u7684\u4ea7\u751f\u65f6\u95f4\uff0c\u90a3\u5982\u4f55\u5b9e\u73b0\u6574\u4e2a\u6570\u636e\u6d41\u5904\u7406\u8fc7\u7a0b\u4e2d\u7684\u65f6\u95f4\u4e0eEvent Time\u6709\u5173\u5462\uff0c\u7b54\u6848\u5c31\u662fwatermark\u3002\u518d\u6b21\u5f3a\u8c03\uff0c\u65f6\u95f4\u8bed\u4e49\u5e76\u4e0d\u662f\u65f6\u95f4\u7a97\u53e3\u72ec\u6709\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u5728\u6574\u4e2aFlink\u5e94\u7528\u5904\u7406\u6d41\u7a0b\u4e2d\uff0c\u51e1\u662f\u6d89\u53ca\u5230\u65f6\u95f4\u7684\u64cd\u4f5c\uff0c\u5176\u4f9d\u636e\u7684\u65f6\u95f4\u6807\u51c6\u90fd\u7531\u65f6\u95f4\u8bed\u4e49\u6765\u51b3\u5b9a\uff0c\u6bd4\u5982\u65f6\u95f4\u7a97\u53e3\u7684\u5f00\u542f\u4e0e\u5173\u95ed\u3001ProcessFunction\u4e2d\u5b9a\u65f6\u5668\u7684\u89e6\u53d1\u3002watermark\u662fEventTime\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5982\u679cProcessFunction\u4e2d\u7684\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u8bed\u4e49\u662fEventTime\uff0c\u90a3\u4e48\u5b83\u89e6\u53d1\u7684\u4f9d\u636e\u5c31\u662fwatermark\u4e2d\u7684\u65f6\u95f4\uff0c\u5982\u679c\u5b9a\u4e49\u7684\u65f6\u95f4\u7a97\u53e3\u7684\u8bed\u4e49\u662fEventTime\uff0c\u90a3\u4e48\u8be5\u7a97\u53e3\u7684\u5f00\u542f\u4e0e\u5173\u95ed\u7684\u4f9d\u636e\u4e5f\u662fwatermark\u4e2d\u7684\u65f6\u95f4\u3002\u56e0\u4e3a\u65f6\u95f4\u7a97\u53e3\u662f\u6700\u5e38\u7528\u7684\u6d89\u53ca\u65f6\u95f4\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e0b\u9762\u901a\u8fc7\u8bf4\u660ewatermark\u662f\u5982\u4f55\u4f5c\u7528\u4e8e\u65f6\u95f4\u7a97\u53e3\u7684\u5f00\u542f\u4e0e\u5173\u95ed\u7684\u8fc7\u7a0b\u6765\u8bf4\u660ewatermark\u7684\u539f\u7406\u3002</p> <p>\u9996\u5148\u8ba1\u6570\u7a97\u53e3\u6ca1\u6709\u65f6\u95f4\u7684\u6982\u5ff5\uff0c\u53ea\u6709\u65f6\u95f4\u7a97\u53e3\u624d\u4e0e\u65f6\u95f4\u8bed\u4e49\u6709\u5173\uff0c\u5176\u6b21\u5bf9\u4e8e\u65f6\u95f4\u7a97\u53e3\u800c\u8a00\uff0cProcessTime\u6ca1\u6709\u8fdf\u5230\u7684\u6982\u5ff5\uff0c\u53ea\u6709EventTime\u624d\u6709\u8fdf\u5230\u7684\u6982\u5ff5\u3002 \u56e0\u4e3a\u5bf9\u4e8eProcessTime\u6765\u8bf4\uff0cFlink\u5bf9\u7a97\u53e3\u8ba1\u65f6\u7684\u65f6\u95f4\u5c31\u662f\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u6574\u4e2aFlink\u96c6\u7fa4\u7684\u540c\u6b65\u65f6\u95f4\uff0cProcessTime\u7a97\u53e3\u5904\u7406\u6570\u636e\u65f6\u5e76\u4e0d\u5173\u5fc3\u6570\u636e\u4ea7\u751f\u7684\u65f6\u95f4\uff0c\u6240\u4ee5ProcessTime\u7a97\u53e3\u6ca1\u6709\u8fdf\u5230\u7684\u6982\u5ff5\uff0c\u6bd4\u5982\u5bf9\u4e8e\u5927\u5c0f\u4e3a5s\u7684ProcessTime\u7a97\u53e3\uff0c\u90a3\u5c31\u771f\u7684\u662f\u7cfb\u7edf\u65f6\u95f4\u8d705s\u4e4b\u540e\u7a97\u53e3\u5173\u95ed\u3002 \u4f46\u662f\u5bf9\u4e8eEventTime\u6765\u8bf4\uff0cFlink\u5bf9\u7a97\u53e3\u8ba1\u65f6\u7684\u65f6\u95f4\u53d6\u51b3\u4e8e\u6570\u636e\u4e2d\u7684\u65f6\u95f4\u6233\uff0c\u4e0e\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u95f4\u6ca1\u6709\u5173\u7cfb\uff0cFlink\u4f1a\u628a\u6570\u636e\u4e2d\u7684\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u4f5c\u4e3a\u5f53\u524d\u65f6\u95f4\uff0c\u5982\u679c\u67d0\u4e2a\u7a97\u53e3\u7684\u622a\u6b62\u65f6\u95f4\u5c0f\u4e8ewatermark\uff0c\u90a3\u4e48\u8be5\u7a97\u53e3\u5c31\u4f1a\u88ab\u5173\u95ed\u3002\u6b63\u662f\u56e0\u4e3aEventTime\u7a97\u53e3\u7684\u5f53\u524d\u65f6\u95f4\u4e0e\u53d6\u51b3\u4e8e\u6570\u636e\u7684\u65f6\u95f4\u6233\uff0c\u6240\u4ee5 EventTime\u7a97\u53e3\u6709\u8fdf\u5230\u7684\u6982\u5ff5\u3002\u4e5f\u6b63\u662f\u56e0\u4e3aEventTime\u7a97\u53e3\u5173\u5fc3\u7684\u662f\u6570\u636e\u4ea7\u751f\u7684\u65f6\u95f4\uff0c\u6240\u4ee5\u7edd\u5927\u591a\u6570Flink\u4e1a\u52a1\u90fd\u4f1a\u4f7f\u7528EventTime\u7a97\u53e3\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cwatermark\u662fEventTime\u7a97\u53e3\u7684\u5f53\u524d\u65f6\u95f4\uff0c\u5b83\u53d6\u51b3\u4e8e\u6570\u636e\u7684\u65f6\u95f4\u6233\uff0c\u67d0\u4e2a\u7a97\u53e3\u7684\u622a\u6b62\u65f6\u95f4\u5c0f\u4e8ewatermark\uff0c\u90a3\u4e48\u8be5\u7a97\u53e3\u5c31\u4f1a\u88ab\u5173\u95ed\u3002\u90a3watermark\u662f\u5982\u4f55\u53d6\u51b3\u4e8e\u6570\u636e\u7684\u65f6\u95f4\u6233\u5462\uff0c\u6362\u8a00\u4e4b\uff0cwatermark\u662f\u5982\u4f55\u901a\u8fc7\u6570\u636e\u7684\u65f6\u95f4\u6233\u8ba1\u7b97\u5f97\u5230\u7684\u5462\uff0c\u662fFlink\u76f4\u63a5\u628a\u6536\u5230\u6570\u636e\u7684\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u5417\uff1f\u7b54\u6848\u662f\u6ca1\u8fd9\u4e48\u7b80\u5355\uff0c\u4f46\u4e5f\u6ca1\u90a3\u4e48\u590d\u6742\uff0c\u5c06\u6570\u636e\u7684\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u7684\u5177\u4f53\u7b56\u7565\u53d6\u51b3\u4e8e\u9700\u6c42\u3002</p> <p>\u9996\u5148\u8981\u8bbe\u7f6e\u65f6\u95f4\u8bed\u4e49\u4e3aEventTime\uff0c\u56e0\u4e3a\u53ea\u6709\u65f6\u95f4\u8bed\u4e49\u662fEventTime\u7684\u65f6\u95f4\u7a97\u53e3\u624d\u6709watermark\uff0c\u624d\u6709\u8fdf\u5230\u6570\u636e\u7684\u6982\u5ff5\uff0c\u624d\u80fd\u8fdb\u884c\u4e0b\u9762\u7684\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u3002\u6ce8\u610fWatermark\u662f\u4e00\u4e2a\u7c7b\uff0c\u5b83\u91cc\u9762\u4fdd\u5b58\u7684\u65f6\u95f4\u6233\u662f\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002 Text Only<pre><code>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n</code></pre> \u7136\u540e\u8981\u901a\u8fc7DataStream\u7684assignTimestampsAndWatermarks()\u65b9\u6cd5\u8bbe\u7f6e\u5c06\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u7684\u7b56\u7565\uff0cassignTimestampsAndWatermarks()\u65b9\u6cd5\u9700\u8981\u4f20\u5165AssignerWithPeriodicWatermarks\u63a5\u53e3 \u6216\u8005\u00a0AssignerWithPunctuatedWatermarks \u63a5\u53e3\u7684\u5b50\u7c7b\u5b9e\u73b0\uff0c\u8fd9\u4e24\u4e2a\u63a5\u53e3\u5747\u662f\u7ee7\u627f\u81eaTimestampAssigner\u63a5\u53e3\uff0c TimestampAssigner\u63a5\u53e3\u6709\u4e00\u4e2aextractTimestamp()\u65b9\u6cd5\uff0c\u8868\u793a\u5982\u4f55\u4ece\u6570\u636e\u4e2d\u63d0\u53d6\u65f6\u95f4\u6233\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u9700\u8981\u7528\u6237\u5b9e\u73b0\uff0c\u7136\u540eTimestampAssigner\u63a5\u53e3\u7684\u8fd9\u4e24\u4e2a\u5b50\u63a5\u53e3\u4e2d\u53c8\u5404\u81ea\u6709\u81ea\u5df1\u5c06\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u7684\u7b56\u7565\uff0c\u5373AssignerWithPeriodicWatermarks\u63a5\u53e3\u7684getCurrentWatermark()\u65b9\u6cd5 \u548c AssignerWithPunctuatedWatermarks\u63a5\u53e3\u7684checkAndGetNextWatermark()\u65b9\u6cd5\uff0c\u90a3\u8fd9\u4e24\u4e2a\u63a5\u53e3\u53c8\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u533a\u522b\u5c31\u5728\u4e8eFlink\u4f1a\u5468\u671f\u6027\u5730\u8c03\u7528AssignerWithPeriodicWatermarks\u63a5\u53e3\u7684getCurrentWatermark()\u65b9\u6cd5\u6765\u751f\u6210watermark\uff0c\u800c\u5bf9\u4e8eAssignerWithPunctuatedWatermarks \u63a5\u53e3\uff0cFlink\u6bcf\u63a5\u6536\u4e00\u6761\u6570\u636e\u90fd\u4f1a\u8c03\u7528\u8fd9\u4e2a\u63a5\u53e3\u7684checkAndGetNextWatermark\u65b9\u6cd5\u6765\u751f\u6210watermark\uff0c\u53ef\u4ee5\u4ece\u4e24\u4e2a\u63a5\u53e3\u7684\u540d\u5b57\u4e2d\u770b\u5230\u8fd9\u4e00\u70b9\u3002</p> <p><code>\u5982\u679c\u4f7f\u7528\u7684\u662f``AssignerWithPeriodicWatermarks\u63a5\u53e3\uff0cFlink\u4f1a\u5468\u671f\u6027\u5730\u751f\u6210watermark\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u7ba1\u6709\u6ca1\u6709\u6570\u636e\u5230\u6765\uff0cFlink\u90fd\u4f1a\u5728\u4f7f\u7528``assignTimestampsAndWatermarks``()\u65b9\u6cd5\u7684\u5730\u65b9\u5468\u671f\u6027\u5730\u751f\u6210watermark\u5411\u4e0b\u6e38\u4f20\u9012``\uff0c\u56e0\u4e3a\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u89e6\u53d1\u57fa\u4e8eEventTime\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u7a97\u53e3\u7684\u5173\u95ed \u548c ProcessFunction\u4e2dEventTime\u5b9a\u65f6\u5668\u3002</code>\u8fd9\u4e2a\u5468\u671f\u7684\u9ed8\u8ba4\u503c\u662f200ms\uff0c\u8fd9\u4e2a\u65f6\u95f4\u662f\u7cfb\u7edf\u65f6\u95f4\uff0c\u5373\u65f6\u95f4\u8bed\u4e49\u662fProcessTime\uff0c\u5728setStreamTimeCharacteristic()\u65b9\u6cd5\u91cc\u88ab\u8bbe\u7f6e\u7684\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u662f\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\u65f6\u95f4\u8bed\u4e49\u7684\u65b9\u6cd5\uff1a Text Only<pre><code>@PublicEvolving\npublic void setStreamTimeCharacteristic(TimeCharacteristic characteristic) {\n\u00a0\u00a0\u00a0this.timeCharacteristic = Preconditions.checkNotNull(characteristic);\n\u00a0\u00a0\u00a0if (characteristic == TimeCharacteristic.ProcessingTime) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`getConfig().setAutoWatermarkInterval(0);`\n\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`getConfig().setAutoWatermarkInterval(200);`\n\u00a0\u00a0\u00a0}\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\u5f53\u65f6\u95f4\u8bed\u4e49\u662fProcessingTime\u65f6\uff0c\u5468\u671f\u6027\u751f\u6210watermark\u7684\u65f6\u95f4\u662f0ms\uff0c\u4e5f\u5c31\u662f\u5e76\u4e0d\u4f1a\u751f\u6210watermark\u3002 \u4e5f\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u5468\u671f\uff0c\u5355\u4f4d\u662fms\uff0c\u8fd9\u4e2a\u503c\u8bbe\u7f6e\u5927\u70b9\u5bf9\u8ba1\u7b97\u7ed3\u679c\u5e94\u8be5\u6ca1\u4ec0\u4e48\u5f71\u54cd\uff0c\u53ea\u662f\u7a97\u53e3\u5173\u95ed\u5f97\u4f1a\u6162\u70b9\uff0c\u4e5f\u5c31\u662f\u5f97\u5230\u8ba1\u7b97\u7ed3\u679c\u7684\u5ef6\u65f6\u4f1a\u9ad8\u70b9\u3002 Text Only<pre><code>env.getConfig().setAutoWatermarkInterval(200);\n</code></pre></p> <p>Flink\u63d0\u4f9b\u4e86AssignerWithPeriodicWatermarks\u63a5\u53e3\u7684\u4e24\u4e2a\u5b50\u62bd\u8c61\u7c7b\u5b9e\u73b0\uff0c\u5373AscendingTimestampExtractor \u548c\u00a0BoundedOutOfOrdernessTimestampExtractor\uff0c\u5b83\u4fe9\u5747\u5b9e\u73b0\u4e86getCurrentWatermark()\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u4f7f\u7528\uff0c\u4e0d\u8fc7\u8fd8\u9700\u8981\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u62bd\u8c61\u7c7b\u4eceTimestampAssigner\u63a5\u53e3\u7ee7\u627f\u6765\u7684extractTimestamp\u65b9\u6cd5\u5373\u53ef\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6cd5\u4e0e\u7528\u6237\u6570\u636e\u6709\u5173\uff0c\u6240\u4ee5\u5fc5\u987b\u7531\u7528\u6237\u81ea\u5b9a\u4e49\u3002 \u90a3AscendingTimestampExtractor \u548c\u00a0BoundedOutOfOrdernessTimestampExtractor \u7684\u00a0getCurrentWatermark()\u65b9\u6cd5\u6709\u4ec0\u4e48\u533a\u522b\u5417\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd9\u4e24\u4e2a\u5b50\u7c7b\u5c06\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u7684\u7b56\u7565\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f</p> <p>\u9996\u5148\u5728\u4e24\u4e2a\u7c7b\u4e2d\u90fd\u6709\u4e00\u4e2a\u5f53\u524d\u65f6\u95f4\u6233\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\u662f\u5f53\u524dFlink\u7cfb\u7edf\u6536\u5230\u7684\u6570\u636e\u4e2d\u7684\u6700\u5927\u65f6\u95f4\u6233\uff0c\u56e0\u4e3aFlink\u6536\u5230\u6570\u636e\u7684\u987a\u5e8f\u5e76\u4e0d\u4e00\u5b9a\u662f\u6570\u636e\u4e2d\u65f6\u95f4\u6233\u5347\u5e8f\u7684\u987a\u5e8f\uff0c\u6240\u4ee5Flink\u9700\u8981\u59cb\u7ec8\u4fdd\u7559\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233\uff0c\u7136\u540e\u4ee5\u8fd9\u4e2a\u65f6\u95f4\u6233\u8ba1\u7b97\u5f97\u5230watermark\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u4e86watermark\u503c\u53ea\u4f1a\u589e\u52a0\uff0c\u4e0d\u4f1a\u51cf\u5c11\uff0c\u56e0\u4e3awatermark\u4f5c\u4e3a\u5f53\u524d\u65f6\u95f4\u4e0d\u80fd\u540e\u9000\u3002 \u5176\u6b21\u5c31\u662f\u8fd9\u4e24\u4e2a\u5b50\u7c7b\u7684\u5177\u4f53\u662f\u5982\u4f55\u901a\u8fc7\u6700\u5927\u65f6\u95f4\u6233\u8ba1\u7b97\u5f97\u5230watermark\u7684\uff0c\u4e5f\u5c31\u5b83\u4eec\u7684getCurrentWatermark()\u65b9\u6cd5\u6709\u4ec0\u4e48\u533a\u522b\uff1f AscendingTimestampExtractor \u7684\u00a0getCurrentWatermark()\u65b9\u6cd5\uff1a Text Only<pre><code>@Override\npublic final Watermark getCurrentWatermark() {\n\u00a0\u00a0\u00a0return new Watermark(currentTimestamp == Long.MIN_VALUE ? Long.MIN_VALUE : `currentTimestamp - 1`);\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230 AscendingTimestampExtractor \u76f4\u63a5\u5c06\u6700\u5927\u65f6\u95f4\u6233-1\u8d4b\u503c\u7ed9\u4e86watermark\uff0c\u4e5f\u5c31\u662fwatermark\u662f\u5f53\u524dFlink\u63a5\u6536\u5230\u7684\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233-1ms\uff0c\u8fd91ms\u5ffd\u7565\u4e0d\u8ba1\uff1a  \u6bd4\u5982\u7a97\u53e3\u5927\u5c0f\u662f5s\uff0c\u56e0\u4e3a\u7a97\u53e3\u5de6\u95ed\u53f3\u5f00\u7684\u533a\u95f4\uff0c\u6240\u4ee5\u7b2c\u4e00\u4e2a\u7a97\u53e3\u662f[0ms, 5000ms)\uff0c\u4e5f\u5c31\u662f\u5f53Flink\u6536\u5230\u7684\u6700\u5927\u65f6\u95f4\u6233\u4e3a5000ms\u65f6\uff0c watermark=5000ms\uff08\u90a31ms\u5ffd\u7565\uff09\uff0c\u56e0\u4e3a\u5f53\u7a97\u53e3\u7684\u622a\u6b62\u65f6\u95f4\u5c0f\u4e8ewatermark\u65f6\uff0c\u8be5\u7a97\u53e3\u4f1a\u88ab\u5173\u95ed\uff0c\u6240\u4ee5\u6b64\u65f6\u7b2c\u4e00\u4e2a\u7a97\u53e3\u4f1a\u88ab\u5173\u95ed\u3002 \u4e5f\u5c31\u662f\u8bf4\u91c7\u7528AscendingTimestampExtractor\u751f\u6210 watermark\u7684\u7b56\u7565\uff0c\u7a97\u53e3\u5e76\u4e0d\u4f1a\u7b49\u8fdf\u5230\u7684\u6570\u636e\uff0c\u5373\u7b2c\u4e00\u4e2a\u7a97\u53e3[0ms, 5000ms)\u4e2d\u7684\u6570\u636e\u5fc5\u987b\u5728\u65f6\u95f4\u6233\u4e3a5000+ms\u7684\u6570\u636e\u4e4b\u524d\u5230\uff085000+\u8868\u793a5000\u53ca\u4ee5\u4e0a\uff09\uff0c\u4e0d\u7136\u7a97\u53e3\u5c31\u5173\u95ed\u4e86\u3002\u8fd9\u79cd\u7b56\u7565\u9002\u5408\u7a97\u53e3\u6536\u5230\u6570\u636e\u7684\u987a\u5e8f\u7b49\u4e8e\u6570\u636e\u751f\u6210\u7684\u987a\u5e8f\uff0c\u5373\u7a97\u53e3\u4ee5\u6570\u636e\u65f6\u95f4\u6233\u5347\u5e8f\u7684\u5f62\u5f0f\u63a5\u6536\u6570\u636e\u7684\u60c5\u51b5\uff0c\u4eceAscendingTimestampExtractor \u7684\u540d\u5b57\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u70b9\u3002 \u901a\u8fc7DataStream\u7684assignTimestampsAndWatermarks()\u65b9\u6cd5\u8bbe\u7f6ewatermark\u7684\u751f\u6210\u7b56\u7565\u4e3aAscendingTimestampExtractor \uff1a Text Only<pre><code>dataStream.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;Tuple3&lt;String, Long, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(Tuple3&lt;String, Long, Integer&gt; element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.f1;\n\u00a0\u00a0\u00a0\u00a0}\n});\n</code></pre></p> <p>BoundedOutOfOrdernessTimestampExtractor \u7684\u00a0getCurrentWatermark()\u65b9\u6cd5\uff1a Text Only<pre><code>@Override\npublic final Watermark getCurrentWatermark() {\n\u00a0\u00a0\u00a0// this guarantees that the watermark never goes backwards.\n\u00a0\u00a0\u00a0long potentialWM = `currentMaxTimestamp - maxOutOfOrderness`;\n\u00a0\u00a0\u00a0if (potentialWM &gt;= lastEmittedWatermark) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lastEmittedWatermark = potentialWM;\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0return new Watermark(lastEmittedWatermark);\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230BoundedOutOfOrdernessTimestampExtractor \u4f1a\u5c06\u6700\u5927\u65f6\u95f4\u6233\u51cf\u53bb maxOutOfOrderness \u540e\u8d4b\u7ed9 watermark\uff0cmaxOutOfOrderness \u662f\u6700\u5927\u4e71\u5e8f\u7a0b\u5ea6\u7684\u610f\u601d\uff0c\u662f\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u6bd4\u5982maxOutOfOrderness=2\uff1a  \u518d\u6bd4\u5982\u7a97\u53e3\u5927\u5c0f\u4e3a5s\uff0cmaxOutOfOrderness\u5927\u5c0f\u4e3a2s\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u7a97\u53e3\u662f[0ms, 5000ms)\uff0c\u5f53Flink\u6536\u5230\u7684\u6700\u5927\u65f6\u95f4\u6233\u4e3a5000ms\u65f6\uff0c\u6b64\u65f6watermark\u662f5000ms-2000ms=3000ms\uff0c\u4e5f\u5c31\u662f\u8bf4\u6b64\u65f6\u5e76\u4e0d\u4f1a\u5173\u95ed[0ms, 5000ms)\u7a97\u53e3\uff0c\u53ea\u6709\u5f53Flink\u6536\u5230\u7684\u6700\u5927\u65f6\u95f4\u6233\u4e3a7000+ms\u65f6\uff0cwatermark=5000+ms\uff0c\u6b64\u65f6\u624d\u4f1a\u5173\u95ed\u7b2c\u4e00\u4e2a\u7a97\u53e3\u3002 \u4e5f\u5c31\u662f\u8bf4\u91c7\u7528\u00a0BoundedOutOfOrdernessTimestampExtractor \u751f\u6210 watermark\u7684\u7b56\u7565\uff0c\u7a97\u53e3\u4f1a\u7b49\u8fdf\u5230\u7684\u6570\u636e\uff0c\u5373\u7b2c\u4e00\u4e2a\u7a97\u53e3[0ms, 5000ms)\u4e2d\u7684\u6570\u636e\u5728\u65f6\u95f4\u6233\u4e3a7000+ms\u7684\u6570\u636e\u4e4b\u524d\u5230\u90fd\u884c\uff0c\u90fd\u4f1a\u8fdb\u5230\u7b2c\u4e00\u4e2a\u7a97\u53e3\u4e2d\uff0c\u4f46\u662f\u4e0d\u80fd\u5728\u65f6\u95f4\u6233\u4e3a7000+ms\u7684\u6570\u636e\u4e4b\u540e\u5230\uff0c\u56e0\u4e3a\u53ea\u8981\u65f6\u95f4\u6233\u4e3a7000+ms\u7684\u6570\u636e\u4e00\u5230\uff0c\u7b2c\u4e00\u4e2a\u7a97\u53e3\u5c31\u4f1a\u5173\u95ed\u3002 \u518d\u6bd4\u5982\u7a97\u53e3\u5927\u5c0f\u4e3a5\uff0cmaxOutOfOrderness\u4e3a2\uff0c\u6570\u636e\u4ee5\u4e0b\u9762\u7684\u987a\u5e8f\u8fdb\u5165\u5230\u7a97\u53e3  \u5f535\u5230\u7684\u65f6\u5019\uff0cwatermark=3\uff0c\u6b64\u65f6\u7a97\u53e3\u4e2d\u6570\u636e\u5982\u4e0b\uff1a  \u5f537\u5230\u7684\u65f6\u5019\uff0cwatermark=5\uff0c\u6b64\u65f6\u7a97\u53e3[0,5)\u4f1a\u88ab\u5173\u95ed\uff0c4\u5c5e\u4e8e\u8fdf\u5230\u6570\u636e\u4e0d\u4f1a\u8fdb\u5165\u5230\u7a97\u53e3[0,5)\u4e2d\uff1a  \u8bbe\u7f6ewatermark\u7684\u751f\u6210\u7b56\u7565\u4e3aBoundedOutOfOrdernessTimestampExtractor \uff0c\u901a\u8fc7\u533f\u540d\u5185\u90e8\u7c7b\u8c03\u7528\u7236\u7c7b\u6784\u9020\u65b9\u6cd5\u4f20\u5165maxOutOfOrderness\u7684\u503c\uff1a Text Only<pre><code>dataStream.assignTimestampsAndWatermarks(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new BoundedOutOfOrdernessTimestampExtractor&lt;Tuple3&lt;String, Long, Integer&gt;&gt;(`Time.seconds(2)`) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractTimestamp(Tuple3&lt;String, Long, Integer&gt; element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.f1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n</code></pre></p> <p>Flink\u6ca1\u6709\u81ea\u5e26\u7684 AssignerWithPunctuatedWatermarks \u63a5\u53e3\u7684\u5b9e\u73b0\u5b50\u62bd\u8c61\u7c7b\uff0c\u56e0\u4e3aFlink\u6bcf\u63a5\u6536\u4e00\u6761\u6570\u636e\u90fd\u4f1a\u8c03\u7528\u8fd9\u4e2a\u63a5\u53e3\u7684checkAndGetNextWatermark\u65b9\u6cd5\u6765\u751f\u6210watermark\uff0c\u800cwatermark\u4f1a\u4f5c\u4e3a\u4e00\u6761\u7279\u6b8a\u7684\u6570\u636e\u4ece\u4e0a\u6e38\u4efb\u52a1\u4f20\u5230\u4e0b\u6e38\u4efb\u52a1\u4e2d\uff0c\u5982\u679c\u6bcf\u6765\u4e00\u6761\u6570\u636e\u90fd\u751f\u6210\u4e00\u4e2awatermark\u7684\u8bdd\uff0c\u90a3\u4e48\u4f20\u8f93\u7684\u6570\u636e\u91cf\u5c06\u4f1a\u7ffb\u500d\uff0c\u7cfb\u7edf\u7684\u6548\u7387\u5c06\u4f1a\u964d\u4f4e\u3002\u6709\u9700\u8981\u53ef\u4ee5\u81ea\u5b9a\u4e49AssignerWithPunctuatedWatermarks \u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u5305\u62ec\u53ef\u4ee5\u81ea\u5b9a\u4e49AssignerWithPeriodicWatermarks\u63a5\u53e3\u7684\u5b9e\u73b0\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/16-watermark%E7%9A%84%E4%BC%A0%E9%80%92/","title":"16-watermark\u7684\u4f20\u9012","text":"<p> \u7ea6 807 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u5f53\u65f6\u95f4\u8bed\u4e49\u8bbe\u7f6e\u4e3aEventTime\u540e\uff0c\u7a97\u53e3\u7684\u65f6\u95f4\u5c31\u4e0e\u6570\u636e\u7684\u65f6\u95f4\u6233\u6709\u5173\u4e86\uff0c\u4f46\u662f\u5728Flink\u7684\u5206\u5e03\u5f0f\u6d41\u5904\u7406\u4e2d\uff0c\u6570\u636e\u4f1a\u88ab\u5206\u6563\u5230\u5404\u6761\u5e76\u884c\u6d41\u4e2d\u5904\u7406\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u6bcf\u6761\u6d41\u611f\u77e5\u5230\u65f6\u95f4\u4e0d\u4e00\u6837\uff0c\u4f46\u662f\u6211\u4eec\u8981\u6c42\u6240\u6709\u7a97\u53e3\u611f\u77e5\u5230\u65f6\u95f4\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u5c31\u662fkeyBy\u4e4b\u540e\u7684\u6bcf\u4e2a\u5206\u7ec4\u7684\u7a97\u53e3\u611f\u77e5\u5230\u7684watermark\u9700\u8981\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u6240\u6709\u5206\u7ec4\u7684\u7a97\u53e3\u540c\u65f6\u5173\u95ed\u7136\u540e\u8ba1\u7b97\u8f93\u51fa\u7ed3\u679c\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u7684\uff0c\u4e8b\u5b9e\u4e0awatermark\u5b9e\u9645\u4e0a\u4e5f\u662f\u4e00\u6761\u6570\u636e\uff0c\u4ece\u8c03\u7528assignTimestampsAndWatermarks()\u6307\u5b9a\u5982\u4f55\u751f\u6210watermark\u5f00\u59cb\uff0cwatermark\u4f1a\u4e0e\u4e1a\u52a1\u6570\u636e\u4e00\u8d77\u4ece\u4e0a\u6e38\u5411\u4e0b\u6e38\u4f20\u9012\u3002  watermark\u80fd\u4f5c\u4e3a\u6570\u636e\u4e0e\u4e1a\u52a1\u6570\u636e\u4e00\u8d77\u5411\u4e0b\u6e38\u4f20\u9012\u662f\u56e0\u4e3aWatermark\u662f\u4e00\u4e2a\u7c7b\uff08\u91cc\u9762\u53ea\u6709\u4e00\u4e2a\u65f6\u95f4\u6233\uff09\uff0c\u4e0e\u666e\u901a\u7684\u4e1a\u52a1\u6570\u636eStreamRecord\u90fd\u7ee7\u627f\u81eaStreamElement\u62bd\u8c61\u7c7b\u3002  \u4f46\u662f\u4e0eStreamRecord\u6709\u4e00\u70b9\u4e0d\u540c\uff0c\u5f53\u6570\u636e\u53d1\u751fRedistributing\uff08\u4e0d\u662fone-to-one\uff09\u65f6\uff0cwatermark\u4f1a\u4ee5\u5e7f\u64ad\u7684\u65b9\u5f0f\u5411\u4e0b\u6e38\u5206\u533a\u4f20\u9012\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u6240\u6709Redistributing\u540e\u7684\u4e0b\u6e38\u5206\u533a\u63a5\u6536\u5230\u76f8\u540c\u7684watermark\u3002\u4e5f\u5c31\u662f\u8bf4\u4ece\u8c03\u7528assignTimestampsAndWatermarks()\u6307\u5b9a\u5982\u4f55\u751f\u6210watermark\u8d77\uff0c\u6570\u636e\u4ee5one-to-one\u6a21\u5f0f\u4f20\u9012\u65f6\uff0c\u6bcf\u6761\u5e76\u884c\u6d41\u4e2d\u7684watermark\u5e76\u4e0d\u76f8\u540c\uff0c\u5f53\u6570\u636e\u53d1\u751f\u7b2c\u4e00\u6b21Redistributing\u65f6\uff0cRedistributing\u540e\u7684\u7b2c\u4e00\u4e2a\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u4f1a\u63a5\u6536\u5230\u76f8\u540c\u7684watermark\uff0c\u7136\u540e\u8be5\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u4f1a\u9009\u51fa\u6700\u5c0f\u7684\u90a3\u4e2awatermark\u518d\u5411\u4e0b\u6e38\u4f20\u9012\u3002\u518d\u4ed4\u7ec6\u4e00\u60f3\uff0c\u5f53\u53d1\u751f\u7b2c\u4e00\u6b21Redistributing\u540e\uff0c\u540e\u9762\u4e0d\u7ba1\u662fone-to-one\u8fd8\u662f\u518d\u53d1\u751fRedistributing\uff0c\u6240\u6709\u5e76\u884c\u6d41\u4e2dwatermark\u90fd\u4f1a\u662f\u76f8\u540c\u7684\uff0c\u56e0\u4e3a\u7b2c\u4e00\u6b21Redistributing\u540e\u7684\u7b2c\u4e00\u4e2a\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u5411\u4e0b\u6e38\u53d1\u9001\u7684\u662f\u76f8\u540c\u7684watermark\uff08rescale()\u7684Redistributing\u53ef\u80fd\u4f8b\u5916\uff09\u3002\u53c8\u56e0\u4e3a\u5f00\u7a97\u4e4b\u524d\u4e00\u5b9a\u4f1a\u8fdb\u884c\u4e00\u6b21Redistributing\uff08\u5982\u679c\u662fDataStream\u5f00\u7a97\uff0c\u5219\u6240\u6709\u6570\u636e\u8fdb\u5165\u4e00\u4e2a\u7a97\u53e3\u4e2d\uff1b\u5982\u679c\u662fKeyedStream\u5f00\u7a97\uff0c\u5219\u4f1a\u5148\u8fdb\u884c\u4e00\u6b21keyBy\uff09\uff0c\u6240\u4ee5\u6240\u6709\u7a97\u53e3\u611f\u77e5\u5230watermark\u4e00\u5b9a\u662f\u76f8\u540c\u7684\u3002</p> <p>\u4e0b\u56fe\u5c55\u793a\u4e86\u5f53\u4e00\u4e2a\u4e0b\u6e38\u5206\u533a\u6536\u5230\u591a\u4e2a\u4e0a\u6e38\u5206\u533a\u7684\u6570\u636e\u65f6\uff0c\u8fd9\u4e2a\u4e0b\u6e38\u5206\u533a\u4f1a\u5148\u4fdd\u5b58\u6240\u6709\u4e0a\u6e38\u5206\u533a\u53d1\u9001\u8fc7\u6765\u7684watermark\uff0c\u7136\u540e\u4ece\u4e2d\u9009\u51fa\u6700\u5c0f\u7684\u90a3\u4e2awatermark\u518d\u5411\u4e0b\u6e38\u4f20\u9012\uff0c\u4ee5\u540e\u6bcf\u5f53\u6709\u4e00\u4e2a\u4e0a\u6e38\u5206\u533a\u53d1\u9001\u8fc7\u6765\u65b0\u7684watermark\uff0c\u8fd9\u4e2a\u4e0b\u6e38\u5206\u533a\u5c31\u4f1a\u5148\u66f4\u65b0\u5bf9\u5e94\u5206\u533a\u7684watermark\uff0c\u4e4b\u540e\u518d\u9009\u51fa\u6700\u5c0f\u7684watermark\uff0c\u5982\u679c\u8fd9\u6b21\u9009\u51fa\u7684watermark\u4e0e\u4e0a\u6b21\u53d1\u9001watermark\u4e0d\u540c\uff08\u4e0d\u540c\u7684\u8bdd\u4e00\u5b9a\u662f\u6bd4\u4e0a\u6b21\u53d1\u9001\u7684watermark\u5927\uff09\uff0c\u5219\u5c06\u6b21watermark\u5411\u4e0b\u6e38\u53d1\u9001\uff0c\u5982\u679c\u76f8\u540c\u5219\u4e0d\u8fdb\u884c\u53d1\u9001\uff1a  \u4ece\u4e0b\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u7a97\u53e3\u4e4b\u524d\u7684\u5404\u6761\u5e76\u884c\u6d41\u4e2d\u7684watermark\u53ef\u4ee5\u4e0d\u540c\uff0c\u4f46\u662f\u6240\u6709\u7a97\u53e3\u611f\u77e5\u5230\u7684watermark\u5c31\u662f\u4e00\u6837\u3002\u8fd9\u662f\u56e0\u4e3a\u5728window\u4e4b\u524d\u6709keyBy\uff0ckeyBy\u4f1a\u53d1\u751fRedistributing\uff0c\u6240\u4ee5map\u7684\u5b50\u4efb\u52a1\u4f1a\u5e7f\u64adwatermark\u5230\u4e0b\u6e38\u7a97\u53e3\u6240\u5728\u7684\u6240\u6709\u5b50\u4efb\u52a1\u4e2d\uff0c\u7136\u540e\u6240\u6709\u5b50\u4efb\u52a1\u53d6\u6700\u5c0f\u7684watermark\u4f5c\u4e3a\u5f53\u524d\u7684watermark\uff0c\u4e8e\u662f\u6240\u6709\u7a97\u53e3\u611f\u77e5\u5230\u7684watermark\u5c31\u662f\u4e00\u6837\u7684\u4e86\u3002 </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/17-Window%20API%20%E4%B9%8B%20%E5%A4%84%E7%90%86%E8%BF%9F%E5%88%B0%E6%95%B0%E6%8D%AE/","title":"17-Window API \u4e4b \u5904\u7406\u8fdf\u5230\u6570\u636e","text":"<p> \u7ea6 1593 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 32 \u5206\u949f</p> <p>\u6211\u4eec\u77e5\u9053\u622a\u6b62\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524dwatermark\u7684\u7a97\u53e3\u90fd\u4f1a\u88ab\u5173\u95ed\uff0c\u90a3\u8fdf\u5230\u4e86\u7684\u6570\u636e\u5e94\u8be5\u600e\u4e48\u5904\u7406\u5462\u3002\u6bd4\u5982\u4e0b\u56fe\uff0c\u7a97\u53e3\u5927\u5c0f\u4e3a5\uff0cmaxOutOfOrderness\u4e3a2\uff0c\u56e0\u4e3a\u5df2\u63a5\u53d7\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233\u662f7\uff0c\u6240\u4ee5\u6b64\u65f6watermark=5\uff0c\u7a97\u53e3[0,5)\u4f1a\u88ab\u5173\u95ed\uff0c4\u548c3\u5c5e\u4e8e\u8fdf\u5230\u6570\u636e\u4e0d\u4f1a\u8fdb\u5165\u5230\u7a97\u53e3[0,5)\u4e2d\u3002  \u90a34\u548c3\u8be5\u600e\u4e48\u5904\u7406\u5462\uff0c\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528WindowedStream\u7684allowedLateness()\u65b9\u6cd5\u8bbe\u7f6e\u4e00\u4e2a\u5141\u8bb8\u8fdf\u5230\u7684\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u4ecd\u662f\u4ee5watermark\u4e3a\u51c6\uff0c\u6bd4\u5982allowedLateness(Time.seconds(2))\u8868\u793a\u5141\u8bb8\u6570\u636e\u8fdf\u52302s\u3002\u8bbe\u7f6e\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u4e4b\u540e\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff0c\u5728\u7a97\u53e3\u5173\u95ed\u65f6\uff0c\u4f1a\u5bf9\u7a97\u53e3\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u8ba1\u7b97\u7136\u540e\u8f93\u51fa\u7ed3\u679c\uff0c\u5728\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u5185\u6765\u7684\u8fdf\u5230\u6570\u636e\uff0c\u6bcf\u6765\u4e00\u6761\u90fd\u4f1a\u4e0e\u5df2\u5173\u95ed\u7a97\u53e3\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u505a\u4e00\u6b21\u8ba1\u7b97\u5f97\u5230\u7ed3\u679c\uff0c\u7136\u540e\u8f93\u51fa\u8fd9\u4e2a\u7ed3\u679c\u3002\u6bd4\u5982\u4e0a\u56fe\u4e2d\u7a97\u53e3[0,5)\u9996\u5148\u4f1a\u57fa\u4e8e(2,1,0)\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u7ed3\u679c\u8f93\u51fa\uff0c\u7136\u540e\u6570\u636e4\u6765\u4e86\uff0c\u6b64\u65f6\u7684watermark\u4ecd\u7136\u7b49\u4e8e5\uff0c\u6ca1\u6709\u8d85\u8fc7\u6700\u5927\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\uff0c\u4e8e\u662f\u5728\u57fa\u4e8e(4,3,2,1,0)\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u7ed3\u679c\u8f93\u51fa\uff08\u5177\u4f53\u600e\u4e48\u7b97\u8981\u770b\u662f\u589e\u91cf\u805a\u5408\u51fd\u6570\u8fd8\u662f\u5168\u7a97\u53e3\u51fd\u6570\uff09\u3002 \u7136\u540e8\u548c9\u6765\u4e86\uff0c\u6b64\u65f6watermark=7\uff0c\u56e0\u4e3a\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u5230\u4e86\uff0c\u6240\u4ee53\u6765\u4e86\u4e0d\u4f1a\u518d\u4e0e\u7a97\u53e3\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u505a\u4e00\u6b21\u8ba1\u7b97\u3002  \u90a33\u8be5\u600e\u4e48\u5904\u7406\u5462\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528WindowedStream\u7684sideOutputLateData()\u65b9\u6cd5\u8bbe\u7f6e\u4fa7\u8f93\u51fa\u6d41\uff0c\u5bf9\u4e8e\u5728\u5141\u8bb8\u65f6\u95f4\u4e4b\u540e\u8fdf\u5230\u7684\u6570\u636e\u76f4\u63a5\u6254\u8fdb\u4fa7\u8f93\u51fa\u6d41\u4e2d\uff0c\u518d\u5728\u4fa7\u8f93\u51fa\u6d41\u4e2d\u505a\u5904\u7406\uff0c\u6bd4\u5982\uff0c\u56e0\u4e3a\u6b64\u65f6\u4e3b\u8f93\u51fa\u6d41\u5df2\u5173\u95ed\u7684\u7a97\u53e3\u5df2\u7ecf\u5c06\u8ba1\u7b97\u7ed3\u679c\u4fdd\u5b58\u5728\u5916\u90e8\u7cfb\u7edf\u4e2d\u4e86\u5982MySQL\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u7ed3\u679c\u53d6\u51fa\u6765\u518d\u4e0e\u4fa7\u8f93\u51fa\u6d41\u4e2d\u7684\u6570\u636e\u805a\u5408\u3002</p> <p>\u6d4b\u8bd5\u7a0b\u5e8f\uff0c\u6ce8\u610f\uff1a 1.socketTextStream\u8bfb\u53d6\u6570\u636e\u65f6\u4e0d\u4f1a\u4ea7\u751fwatermark\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u6709\u8c03\u7528assignTimestampsAndWatermarks()\u6307\u5b9a\u5982\u4f55\u751f\u6210watermark\u3002socketTextStream\u5e76\u884c\u5ea6\u59cb\u7ec8\u4e3a1\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6eenv.setParallelism(1)\uff0c\u90a3\u4e48map\u7684\u5e76\u884c\u5ea6\u7b49\u4e8ecpu\u7ebf\u7a0b\u6570\uff0c\u6240\u4ee5\u4e2d\u95f4\u4f1a\u53d1\u751fRedistributing\uff0c\u9ed8\u8ba4\u662frebalance\uff0c\u5373\u5c06\u6570\u636e\u8f6e\u8be2\u5730\u53d1\u5f80\u6bcf\u4e2amap\u5b50\u4efb\u52a1\uff0c\u8fd9\u4e2d\u95f4\u6ca1\u6709watermark\u7684\u5e7f\u64ad\u3002 2.\u5fc5\u987b\u8bbe\u7f6eenv.setParallelism(1)\uff0c\u56e0\u4e3a\u5982\u679c\u4e0d\u8bbe\u7f6eenv.setParallelism(1)\uff0c\u90a3\u4e48map\u7684\u5e76\u884c\u5ea6\u7b49\u4e8ecpu\u7ebf\u7a0b\u6570\uff0c\u5728\u5e76\u884c\u6d41\u4e2d\u4e0b\u6e38\u7684\u7a97\u53e3\u53d6\u7684\u662f\u4e0a\u6e38\u7684\u4f20\u9012\u8fc7\u6765\u7684\u6700\u5c0f\u7684watermark\uff0c\u6240\u4ee5\u53ea\u6709\u8f93\u5165\u5927\u91cf\u6570\u636e\u8ba9\u6bcf\u6761map\u6d41\u4e2d\u7684watermark\u66f4\u65b0\uff0c\u624d\u80fd\u8ba9\u4e0b\u6e38\u7a97\u53e3\u7684watermark\u66f4\u65b0\uff0c\u4e8e\u662f\u624d\u80fd\u8f93\u51fa\u6bd4\u8f83\u9760\u524d\u7684\u7a97\u53e3\u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u8fd9\u6837\u5c31\u4e0d\u5229\u4e8e\u6d4b\u8bd5\u4e86\u3002 3.\u5f97\u5230\u4fa7\u8f93\u51fa\u6d41\u7684getSideOutput()\u65b9\u6cd5\u5728SingleOutputStreamOperator\u7c7b\u4e2d\uff0c\u8fd9\u4e2a\u7c7b\u662fDataStream\u7684\u5b50\u7c7b\u3002 4. \u5fc5\u987b\u521b\u5efa\u7684\u662fOutputTag\u7684\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61new OutputTag&lt;&gt;(\"late-data\") {}; \u8fd9\u662f\u7531\u4e8eJava\u6cdb\u578b\u64e6\u9664\u5f15\u8d77\u7684\u95ee\u9898\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0`env.setParallelism(1);`\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.getConfig().setAutoWatermarkInterval(100);\n\u00a0\u00a0\u00a0 `OutputTag&lt;Tuple3&lt;String, Long, Integer&gt;&gt; outputTag = new OutputTag&lt;&gt;(\"late-data\") {};`\n\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;Tuple3&lt;String, Long, Integer&gt;&gt; singleOutputStreamOperator = env.socketTextStream(\"localhost\", 7777)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(new MapFunction&lt;String, Tuple3&lt;String, Long, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple3&lt;String, Long, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple3&lt;&gt;(split[0], Long.parseLong(split[1]), Integer.parseInt(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`.assignTimestampsAndWatermarks(`\n `new BoundedOutOfOrdernessTimestampExtractor&lt;Tuple3&lt;String, Long, Integer&gt;&gt;(Time.seconds(2)) {`\n `@Override`\n `public long extractTimestamp(Tuple3&lt;String, Long, Integer&gt; element) {`\n `return element.f1;`\n `}`\n `})`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`.timeWindow(Time.seconds(5))`\n `.allowedLateness(Time.seconds(2))`\n `.sideOutputLateData(outputTag)`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.maxBy(2);\n\n\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.print();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple3&lt;String, Long, Integer&gt;&gt; sideOutput = singleOutputStreamOperator.getSideOutput(outputTag);\n\u00a0\u00a0\u00a0\u00a0sideOutput.print(\"late-data\");\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>\u4ee5\u4e0a\u6d4b\u8bd5\u7a0b\u5e8f\uff0c\u7a97\u53e3\u5927\u5c0f\u4e3a5s\uff0cmaxOutOfOrderness\u4e3a2s\uff0c\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u4e3a2s\uff0c\u6709\u4fa7\u8f93\u51fa\u6d41\u3002</p> <p>\u8f93\u5165\u5982\u4e0b\u6570\u636e\uff1a Text Only<pre><code>k1,1633947551000,1\nk1,1633947552000,2\nk1,1633947553000,3\nk1,1633947554000,4\nk1,1633947554999,5\nk1,1633947555000,5\nk1,1633947556000,6\nk1,1633947557000,7\n</code></pre> \u51fa\u73b0\u7b2c\u4e00\u6761\u7ed3\u679c\uff1a Text Only<pre><code>(k1,1633947554999,5)\n</code></pre> \u53ef\u89c1\u7b2c\u4e00\u4e2a\u7a97\u53e3\u662f[1633947550000\uff0c1633947555000)\uff0c\u4e3a\u4ec0\u4e48\u7b2c\u4e00\u4e2a\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u4e0d\u662f1633947551000\u5462\uff1f \u65f6\u95f4\u8bed\u4e49\u662fEventTime\u7684\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7684\u7a97\u53e3\u5206\u914d\u89c4\u5219\u662fTumblingEventTimeWindows\u7c7b\u7684assignWindows()\u65b9\u6cd5\uff1a Text Only<pre><code>@Override\npublic Collection&lt;TimeWindow&gt; assignWindows(Object element, long timestamp, WindowAssignerContext context) {\n\u00a0\u00a0\u00a0if (timestamp &gt; Long.MIN_VALUE) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Long.MIN_VALUE is currently assigned when no timestamp is present\n `long start = TimeWindow.getWindowStartWithOffset(timestamp, offset, size);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Collections.singletonList(new TimeWindow(start, start + size));\n\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new RuntimeException(\"Record has Long.MIN_VALUE timestamp (= no timestamp marker). \" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"Is the time characteristic set to 'ProcessingTime', or did you forget to call \" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"'DataStream.assignTimestampsAndWatermarks(...)'?\");\n\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8d77\u59cb\u65f6\u95f4\u7684\u8ba1\u7b97\u903b\u8f91getWindowStartWithOffset()\u65b9\u6cd5\u5728TimeWindow\u7c7b\u4e2d\uff1a Text Only<pre><code>public static long getWindowStartWithOffset(long timestamp, long offset, long windowSize) {\n\u00a0\u00a0\u00a0return `timestamp - (timestamp - offset + windowSize) % windowSize;`\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679coffset\u8bbe\u7f6e\u4e3a0\uff0c\u90a3\u4e48\u8be5\u6570\u636e\u6240\u5728\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u5c31\u662f\u7a97\u53e3\u5927\u5c0f\u7684\u6574\u6570\u500d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2a\u7a97\u53e3\u7684\u65f6\u95f4\u8303\u56f4\u5728\u7a97\u53e3\u5927\u5c0f\u7ed9\u5b9a\u65f6\u5c31\u5df2\u7ecf\u786e\u5b9a\u4e86\uff0c\u6bcf\u6765\u4e00\u6761\u6570\u636e\u90fd\u53ea\u662f\u6839\u636e\u5176\u65f6\u95f4\u6233\u8ba1\u7b97\u5176\u5c5e\u4e8e\u54ea\u4e2a\u7a97\u53e3\u3002\u6240\u4ee5\u5bf9\u4e8eEventTime\u65f6\u95f4\u7a97\u53e3\u800c\u8a00\uff0c\u65e0\u8bba\u662f\u6eda\u52a8\u8fd8\u662f\u6ed1\u52a8\u7a97\u53e3\uff0c\u5176\u5b9e\u7ed9\u5b9a\u7a97\u53e3\u5927\u5c0f\u548c\u6ed1\u52a8\u6b65\u957f\u4e4b\u540e\uff0c\u6240\u6709\u7a97\u53e3\u5c31\u5df2\u7ecf\u786e\u5b9a\uff0c<code>\u5373\u7a97\u53e3\u7684\u8d77\u59cb\u65f6\u95f4\u5c31\u662f\u7a97\u53e3\u5927\u5c0f\u7684\u6574\u6570\u500d</code>\uff0cFlink\u5bf9\u63a5\u4e0b\u6765\u5230\u6765\u7684\u6570\u636e\u6240\u9700\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\uff0c<code>\u6bcf\u5230\u4e00\u6761\u6570\u636e\u5c31\u5148\u8ba1\u7b97\u51fa\u5b83\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u7a97\u53e3\uff0c\u7136\u540e\u66f4\u65b0watermark\uff0c\u518d\u770b\u9700\u8981\u5173\u95ed\u54ea\u4e9b\u7a97\u53e3</code>\u3002 offset\u53ef\u4ee5\u5728\u4f7f\u7528window()\u65b9\u6cd5\u521b\u5efa\u7a97\u53e3\u65f6\u7684\u7a97\u53e3\u5206\u914d\u5668\u4e2d\u6307\u5b9a\uff0c\u7528\u4e8e\u504f\u79fb\u7a97\u53e3\u7684\u8d77\u59cb\u503c\uff0c\u8fd9\u4e2a\u4e00\u822c\u7528\u4e8e\u8c03\u6574\u6570\u636e\u6e90\u548cFlink\u6240\u5728\u65f6\u533a\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u662f[1633947555000\uff0c1633947560000)\uff0c\u53c8maxOutOfOrderness\u4e3a2s\uff0c\u6240\u4ee5\u8f93\u5165\u65f6\u95f4\u6233\u4e3a1633947562000\u624d\u4f1a\u8f93\u51fa\u7b2c\u4e8c\u7a97\u53e3\u7684\u7ed3\u679c\uff1a Text Only<pre><code>k1,1633947562000,8\n</code></pre> \u8f93\u51fa\u7b2c\u4e8c\u7a97\u53e3\u7684\u7ed3\u679c\uff1a Text Only<pre><code>(k1,1633947557000,7)\n</code></pre> \u6b64\u65f6\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u5df2\u7ecf\u5173\u95ed\uff0c\u4f46\u56e0\u4e3a\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u4e3a2s\uff0c\u6240\u4ee5\u4e0b\u9762\u6bcf\u8f93\u5165\u4e00\u6761\u5c5e\u4e8e\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u8f93\u51fa\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u7684\u4e00\u4e2a\u805a\u5408\u7ed3\u679c \u8f93\u5165\uff1a Text Only<pre><code>k1,1633947558000,9\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(k1,1633947558000,9)\n</code></pre> \u8f93\u5165\uff1a Text Only<pre><code>k1,1633947559000,0\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(k1,1633947558000,9)\n</code></pre></p> <p>\u6b64\u65f6\u8f93\u5165\u65f6\u95f4\u6233\u4e3a1633947564000\u7684\u6570\u636e\uff0c\u5bfc\u81f4\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u5931\u6548 Text Only<pre><code>k1,1633947564000,10\n</code></pre> \u518d\u8f93\u5165\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u7684\u6570\u636e\uff0c\u90a3\u4e48\u8be5\u6570\u636e\u4f1a\u8fdb\u5165\u4fa7\u8f93\u51fa\u6d41\uff1a \u8f93\u5165\uff1a Text Only<pre><code>k1,1633947558500,12\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>late-data&gt; (k1,1633947558500,12)\n</code></pre></p> <p>\u7efc\u4e0a\uff0c\u5bf9\u4e8e\u4e71\u5e8f\u8fdf\u5230\u6570\u636e\uff0cEventTime\u65f6\u95f4\u7a97\u53e3\u67093\u79cd\u4f9d\u6b21\u9012\u8fdb\u7684\u7b56\u7565\uff1a 1.watermark\u8bbe\u7f6emaxOutOfOrderness 2.allowedLateness\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4 3.sideOutputLateData\u4fa7\u8f93\u51fa\u6d41</p> <p>\u4e8e\u662fFlink\u7684Window API\u8c03\u7528\u987a\u5e8f\u5982\u4e0b\uff0c\u52a0\u65b9\u62ec\u53f7\u7684\u8868\u793a\u662f\u53ef\u9009API\u8c03\u7528\uff0c\u6ca1\u6709\u52a0\u65b9\u62ec\u53f7\u7684\u8868\u793a\u662f\u5fc5\u987b\u88ab\u8c03\u7528\u7684API\u3002 </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/18-%E5%B9%B6%E8%A1%8C%E6%B5%81watermark%E4%BC%A0%E9%80%92%E6%B5%8B%E8%AF%95/","title":"18-\u5e76\u884c\u6d41watermark\u4f20\u9012\u6d4b\u8bd5","text":"<p> \u7ea6 503 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u8bbe\u7f6e\u5e76\u884c\u5ea6\u4e3a4\uff0c\u4e8e\u662fmap\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4f1a\u662f4\uff0csocketTextStream\u56fa\u5b9a\u662f1\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0`env.setParallelism(4);`\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.getConfig().setAutoWatermarkInterval(100);\n\u00a0\u00a0\u00a0\u00a0OutputTag&lt;Tuple3&lt;String, Long, Integer&gt;&gt; outputTag = new OutputTag&lt;&gt;(\"late-data\") {};\n\u00a0\u00a0\u00a0\u00a0env.socketTextStream(\"localhost\", 7777)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(new MapFunction&lt;String, Tuple3&lt;String, Long, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple3&lt;String, Long, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple3&lt;&gt;(split[0], Long.parseLong(split[1]), Integer.parseInt(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).assignTimestampsAndWatermarks(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new BoundedOutOfOrdernessTimestampExtractor&lt;Tuple3&lt;String, Long, Integer&gt;&gt;(Time.seconds(2)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractTimestamp(Tuple3&lt;String, Long, Integer&gt; element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.f1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.timeWindow(Time.seconds(5))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.maxBy(2)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> socketTextStream\u4f1a\u8f6e\u8be2\u5730\u5411map\u7684\u5b50\u4efb\u52a1\u53d1\u6570\u636e\uff0cmap\u7684\u6bcf\u4e2a\u5b50\u4efb\u52a1\u4f1a\u6839\u636e\u6536\u5230\u6570\u636e\u7684\u65f6\u95f4\u6233\u4ea7\u751fwatermark\uff0c\u7136\u540e\u5e7f\u64ad\u5230\u4e0b\u6e38\u7684\u6bcf\u4e2a\u7a97\u53e3\uff0c\u56e0\u4e3amap\u7684\u6bcf\u4e2a\u5b50\u4efb\u52a1\u63a5\u6536\u5230\u7684\u6570\u636e\u4e0d\u540c\uff0c\u6240\u4ee5\u4ea7\u751f\u7684watermark\u4e5f\u4e0d\u540c\uff0c\u4e0d\u8fc7\u8fd9\u4e9bwatermark\u4e0b\u6e38\u7684\u6240\u6709\u7a97\u53e3\u90fd\u4f1a\u6536\u5230\uff0c\u7136\u540e\u6240\u6709\u7a97\u53e3\u4f1a\u9009\u53d6\u6700\u5c0fwatermark\uff1a  \u4e8e\u662f\u8f93\u5165\u5982\u4e0b\u6570\u636e\u624d\u4f1a\u8f93\u51fa\u7b2c\u4e00\u4e2a\u7a97\u53e3[1633947550000,1633947555000)\u7684\u7ed3\u679c\uff1a Text Only<pre><code>k1,1633947551000,1\nk1,1633947552000,2\nk1,1633947553000,3\nk1,1633947554000,4\nk1,1633947557000,5\nk1,1633947557000,5\nk1,1633947557000,5\nk1,1633947557000,5\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>1&gt; (k1,1633947554000,4)\n</code></pre></p> <p>\u53ef\u4ee5\u628aassignTimestampsAndWatermarks\u653e\u5728Source\u540e\u9762\uff0c\u8fd9\u6837\u5728socketTextStream\u8bfb\u53d6\u6570\u636e\u540e\u5c31\u4f1a\u4ea7\u751fwatermark\uff0c\u56e0\u4e3asocketTextStream\u548cmap\u4e4b\u95f4\u6709Redistributing\uff0c\u6240\u4ee5socketTextStream\u4f1a\u5e7f\u64adwatermark\u5230map\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u4e2d\uff0cmap\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u4e0d\u5b58\u5728\u9009\u53d6\u6700\u5c0fwatermark\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u4e0a\u6e38\u5206\u533a\uff0c\u7136\u540emap\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u5e7f\u64adwatermark\u5230\u6240\u6709\u7a97\u53e3\u4e2d\uff0c\u7a97\u53e3\u4f1a\u9009\u53d6\u6700\u5c0fwatermark\uff0c\u4f46\u662f\u4e0a\u6e38\u6bcf\u4e2a\u5206\u533a\u53d1\u9001\u8fc7\u6765\u7684 watermark\u90fd\u4e00\u6837\uff0c\u6240\u4ee5\u7a97\u53e3\u7684watermark\u4e5f\u662f\u5b9e\u65f6\u66f4\u65b0\u7684\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(4);\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.getConfig().setAutoWatermarkInterval(100);\n\u00a0\u00a0\u00a0\u00a0OutputTag&lt;Tuple3&lt;String, Long, Integer&gt;&gt; outputTag = new OutputTag&lt;&gt;(\"late-data\") {};\n\u00a0\u00a0\u00a0\u00a0env.socketTextStream(\"localhost\", 7777)\n `.assignTimestampsAndWatermarks(`\n `new BoundedOutOfOrdernessTimestampExtractor&lt;String&gt;(Time.seconds(2)) {`\n `@Override`\n `public long extractTimestamp(String element) {`\n `return Long.parseLong(element.split(\",\")[1]);`\n `}`\n `})`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(new MapFunction&lt;String, Tuple3&lt;String, Long, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple3&lt;String, Long, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple3&lt;&gt;(split[0], Long.parseLong(split[1]), Integer.parseInt(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.timeWindow(Time.seconds(5))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.maxBy(2)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u4e8e\u662f\u8f93\u5165\u5982\u4e0b\u6570\u636e\u5c31\u4f1a\u8f93\u51fa\u7b2c\u4e00\u4e2a\u7a97\u53e3[1633947550000,1633947555000)\u7684\u7ed3\u679c\uff1a Text Only<pre><code>k1,1633947551000,1\nk1,1633947552000,2\nk1,1633947553000,3\nk1,1633947554000,4\nk1,1633947557000,5\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>1&gt; (k1,1633947554000,4)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/19-%E7%8A%B6%E6%80%81%E7%BC%96%E7%A8%8B%20%E4%B8%8E%20%E7%8A%B6%E6%80%81%E5%90%8E%E7%AB%AF/","title":"19-\u72b6\u6001\u7f16\u7a0b \u4e0e \u72b6\u6001\u540e\u7aef","text":"<p> \u7ea6 2382 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 48 \u5206\u949f</p> <p>\u6d41\u5f0f\u8ba1\u7b97\u5206\u4e3a\u65e0\u72b6\u6001\u548c\u6709\u72b6\u6001\u4e24\u79cd\u60c5\u51b5\u3002\u72b6\u6001\u662f\u6307\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\u3002\u65e0\u72b6\u6001\u4e0d\u4f1a\u4fdd\u5b58\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\uff0c\u6570\u636e\u6765\u4e00\u6761\u5904\u7406\u4e00\u6761\uff0c\u6bd4\u5982map\u7b97\u5b50\uff1b\u6709\u72b6\u6001\u4f1a\u4fdd\u5b58\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\uff0c\u6570\u636e\u6765\u4e00\u6761\u5c31\u4f1a\u57fa\u4e8e\u4e4b\u524d\u4fdd\u5b58\u7684\u72b6\u6001\u8ba1\u7b97\u4e00\u4e2a\u7ed3\u679c\uff0c\u5e76\u628a\u8fd9\u4e2a\u7ed3\u679c\u66f4\u65b0\u5230\u72b6\u6001\u4e2d\uff08\u5982\u4e0b\u56fe\u6240\u793a\uff09\uff0c\u6bd4\u5982\u805a\u5408\u7b97\u5b50\u5c31\u662f\u6709\u72b6\u6001\u7684\u8ba1\u7b97\u3002\u5728Flink\u4e2d\uff0c\u805a\u5408\u7b97\u5b50\u56e0\u4e3a\u5176\u8ba1\u7b97\u7279\u70b9\uff0c\u672c\u8eab\u5c31\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u72b6\u6001\uff0c\u800cmap\u7b49\u7b80\u5355\u8f6c\u6362\u7b97\u5b50\u672c\u8eab\u662f\u6ca1\u6709\u72b6\u6001\u7684\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5728\u7b97\u5b50\u4e3a\u5176\u5b9a\u4e49\u72b6\u6001\u3002 </p> <p>\u72b6\u6001\u53c8\u5206\u4e3a\u7c7b\u578b\uff1a</p> <ul> <li>\u7b97\u5b50\u72b6\u6001\uff08 Operator State\uff09</li> <li>\u952e\u63a7\u72b6\u6001\uff08 Keyed State\uff09</li> </ul> <p>\u9996\u5148\u65e0\u8bba\u662f\u7b97\u5b50\u72b6\u6001\u8fd8\u662f\u952e\u63a7\u72b6\u6001\uff0c\u72b6\u6001\u90fd\u662f\u5728\u7b97\u5b50\u4e2d\u5b9a\u4e49\u3002 \u7b97\u5b50\u72b6\u6001\uff1a\u56e0\u4e3a\u540c\u4e00\u4e2a\u7b97\u5b50\u4f1a\u6709\u591a\u4e2a\u5e76\u884c\u5b50\u4efb\u52a1\uff0c\u6240\u4ee5\u5982\u679c\u662f\u6709\u72b6\u6001\u7684\u7b97\u5b50\uff0c\u90a3\u4e48\u8be5\u7b97\u5b50\u7684\u6bcf\u4e00\u4e2a\u5b50\u4efb\u52a1\u90fd\u4f1a\u6709\u81ea\u5df1\u72b6\u6001\uff0c\u7b97\u5b50\u72b6\u6001\u6b63\u662f\u6307\u7684\u8fd9\u79cd\u60c5\u51b5\uff0c\u5373\u7b97\u5b50\u7684\u6bcf\u4e00\u4e2a\u5b50\u4efb\u52a1\u90fd\u4f1a\u7ef4\u62a4\u4e00\u4efd\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u4e92\u4e0d\u5e72\u6270\u3002  \u952e\u63a7\u72b6\u6001\uff1a\u5bf9\u6d41keyBy\u5206\u7ec4\u4e4b\u540e\uff0c\u6bcf\u4e00\u7ec4\u6570\u636e\u90fd\u4f1a\u6709\u4e00\u4e2a\u72b6\u6001\uff0c\u4e92\u4e0d\u5e72\u6270\uff0c\u8fd9\u5c31\u662f\u952e\u63a7\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u5206\u7ec4\u64cd\u4f5c\u7684\u6709\u72b6\u6001\u7b97\u5b50\u7684\u6bcf\u4e00\u4e2a\u5b50\u4efb\u52a1\u90fd\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a\u952e\u63a7\u72b6\u6001\uff0c\u56e0\u4e3a\u6bcf\u4e00\u4e2a\u5b50\u4efb\u52a1\u53ef\u80fd\u4f1a\u5904\u7406\u591a\u4e2a\u5206\u7ec4\u7684\u6570\u636e\u3002 </p> <p>\u7b97\u5b50\u72b6\u6001 \u4e3amap\u7b97\u5b50\u5b9a\u4e49\u4e00\u4e2a\u7b97\u5b50\u72b6\u6001\uff0c\u7528\u4e8e\u7edf\u8ba1\u6d41\u7ecf\u6bcf\u4e2a\u5b50\u4efb\u52a1\u6570\u636e\u7684\u4e2a\u6570\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0`env.setParallelism(2);`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0dataStream.map(new MapFunction&lt;String, Integer&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `// \u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf\u4f5c\u4e3a\u7b97\u5b50\u72b6\u6001`\n `private int count = 0;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Integer map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return ++count;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8fd9\u91cc\u662f\u76f4\u63a5\u5728\u533f\u540d\u5185\u90e8\u7c7b\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b57\u6bb5\u4f5c\u4e3a\u7b97\u5b50\u72b6\u6001\uff0c\u8fd9\u662f\u53ef\u4ee5\u7684\uff0c\u56e0\u4e3a\u8be5\u533f\u540d\u5185\u90e8\u7c7b\u7684\u5bf9\u8c61\u4f1a\u5728JobManager\u4e0a\u5b9e\u4f8b\u5316\uff0c\u7136\u540e\u88ab\u5e8f\u5217\u5316\u53d1\u9001\u5230\u6bcf\u4e2amap\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u4e0a\uff0c\u6bcf\u4e2a\u5b50\u4efb\u52a1\u53cd\u5e8f\u5217\u5316\u4e4b\u540e\u90fd\u4f1a\u72ec\u7acb\u5730\u62e5\u6709\u4e00\u4efd\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u4e8e\u662f\u6bcf\u4e2a\u5b50\u4efb\u52a1\u5c31\u90fd\u62e5\u6709\u4e86\u4e00\u4e2a\u72b6\u6001\uff0c\u53ea\u4e0d\u8fc7Flink\u5e76\u4e0d\u77e5\u9053\u8fd9\u4e2a\u7b97\u5b50\u72b6\u6001\uff0c\u6240\u4ee5\u8be5\u72b6\u6001\u4e0d\u80fd\u88ab\u4fdd\u5b58\u5728checkpoint\u91cc\uff0c\u4e5f\u5c31\u65e0\u6cd5\u4f7f\u7528\u5230Flink\u63d0\u4f9b\u7684\u6545\u969c\u6062\u590d\u673a\u5236\u548c\u72b6\u6001\u4e00\u81f4\u6027\u3002 \u8981\u60f3\u7b97\u5b50\u72b6\u6001\u4f7f\u7528\u5230Flink\u63d0\u4f9b\u7684\u6545\u969c\u6062\u590d\u673a\u5236\u548c\u72b6\u6001\u4e00\u81f4\u6027\u4fdd\u969c\uff0c\u5c31\u9700\u8981\u5b9e\u73b0ListCheckpointed\u63a5\u53e3\uff0c\u6307\u5b9a\u5982\u4f55\u4fdd\u5b58\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u7b97\u5b50\u72b6\u6001\uff1a Text Only<pre><code>static class MyCountState implements MapFunction&lt;String, Integer&gt;, `ListCheckpointed`&lt;Integer&gt; {\n\u00a0\u00a0\u00a0\u00a0private int count = 0;\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return ++count;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public List&lt;Integer&gt; snapshotState(long checkpointId, long timestamp) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return\u00a0Collections.singletonList(count);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void restoreState(List&lt;Integer&gt; state) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Integer cnt : state) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count += cnt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(2);\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0dataStream.map(new MyCountState()).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> snapshotState()\u65b9\u6cd5\u4f1a\u5728\u751f\u6210checkpoint\u65f6\u8c03\u7528\uff0c\u7528\u4e8e\u4fdd\u5b58\u72b6\u6001\u5230checkpoint\u4e2d\uff0c\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u8868\u793a\u4e00\u4e2a\u5b50\u4efb\u52a1\u53ef\u4ee5\u4fdd\u5b58\u591a\u4e2a\u72b6\u6001\u3002\u6545\u969c\u6062\u590d\u65f6\u4f1a\u8c03\u7528restoreState()\u65b9\u6cd5\u6062\u590d\u5b50\u4efb\u52a1\u7684\u72b6\u6001\uff0c\u4f20\u5165\u7684\u4e5f\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a\u72b6\u6001\u5206\u914d\u5230\u8fd9\u4e2a\u5b50\u4efb\u52a1\u4e0a\uff0c\u8fd9\u65f6\u9700\u8981\u5bf9\u72b6\u6001\u8fdb\u884c\u5408\u5e76\u3002 \u6545\u969c\u6062\u590d\u65f6\uff0c\u5982\u679c\u5e76\u884c\u5ea6\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u6bcf\u4e2a\u5b50\u4efb\u52a1\u4ececheckpoint\u4e2d\u5206\u914d\u5230\u7684\u72b6\u6001\u7684\u6570\u91cf\u5c31\u4f1a\u4e0e\u53d1\u751f\u6545\u969c\u4e4b\u524d\u7684\u72b6\u6001\u6570\u91cf\u4e0d\u540c\uff1a \u6bd4\u5982\u53d1\u751f\u6545\u969c\u4e4b\u524d\u5e76\u884c\u5ea6\u4e3a3\uff0c3\u4e2a\u5b50\u4efb\u52a1\u5206\u522b\u67092\u30012\u30011\u4e2a\u72b6\u6001\uff1a  \u6545\u969c\u6062\u590d\u4e4b\u540e\u5e76\u884c\u5ea6\u53d8\u4e3a5\uff0c\u4e8e\u662f\u72b6\u6001\u91cd\u65b0\u5206\u914d\uff1a  \u6216\u8005\u6545\u969c\u6062\u590d\u4e4b\u540e\u5e76\u884c\u5ea6\u53d8\u4e3a2\uff1a </p> <p>\u952e\u63a7\u72b6\u6001 \u5982\u679c\u76f4\u63a5\u5bf9KeyedStream\u4f7f\u7528\u533f\u540d\u5185\u90e8\u7c7b\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b57\u6bb5\u7684\u65b9\u5f0f\u5b9a\u4e49\u72b6\u6001\uff0c\u90a3\u8fd9\u4e2a\u72b6\u6001\u4ecd\u662f\u7b97\u5b50\u72b6\u6001\uff0c\u66f4\u65b0\u8fd9\u4e2a\u72b6\u6001\u7684\u503c\u65f6\u4e0e\u5206\u7ec4\u7684key\u65e0\u5173\uff0c\u6bcf\u6765\u4e00\u6761\u6570\u636e\u90fd\u4f1a\u66f4\u65b0\u5b57\u6bb5\u7684\u503c\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(2);\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0dataStream.keyBy(v -&gt; v)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/`/\u4e00\u4e2a\u5b50\u4efb\u52a1\u53ea\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u6709\u4e00\u4e2aMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0c`\n `//\u6240\u4ee5\u5373\u4f7fkeyBy\u5206\u7ec4\u4e4b\u540e\uff0c\u53ea\u8981\u5206\u7ec4\u5728\u4e00\u4e2a\u5206\u533a(\u5b50\u4efb\u52a1)\u4e0a\uff0c\u90a3\u4e48\u90fd\u662f\u901a\u8fc7\u8fd9\u4e2a\u7ebf\u7a0b\u8c03\u7528\u8fd9\u4e2a\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c`\n `//\u6240\u4ee5\u5904\u4e8e\u540c\u4e00\u4e2a\u5206\u533a\u7684\u5206\u7ec4\u4f1a\u662f\u5171\u4eab\u7b97\u5b50\u7684\u72b6\u6001\uff08\u5373count\u53d8\u91cf\uff09`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(new MapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`private int count = 0;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(value, ++count);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>\u5982\u679c\u60f3\u6bcf\u4e2a\u5206\u7ec4\u4e00\u4e2a\u72b6\u6001\u9700\u8981\u4f7f\u7528\u952e\u63a7\u72b6\u6001\u63a5\u53e3\uff0c\u4ee5\u4e0b\u952e\u63a7\u72b6\u6001\u63a5\u53e3\u5747\u7ee7\u627f\u81eaState\u63a5\u53e3\uff1a</p> <ul> <li>\u503c\u72b6\u6001\uff08 Value state\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u5355\u4e2a\u7684\u503c</li> </ul> <p>ValueState\u4fdd\u5b58\u5355\u4e2a\u7684\u503c\uff0c\u503c\u7684\u7c7b\u578b\u4e3a T\uff0c\u5176\u57fa\u672c\u64cd\u4f5c\u5982\u4e0b\uff1a ValueState.value()\uff0c\u5373get \u64cd\u4f5c ValueState.update(T value)\uff0c\u5373set \u64cd\u4f5c <ul> <li>\u5217\u8868\u72b6\u6001\uff08 List state\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u4e00\u7ec4\u6570\u636e\u7684\u5217\u8868</li> </ul> <p>ListState\u4fdd\u5b58\u4e00\u4e2a\u5217\u8868\uff0c\u5217\u8868\u5143\u7d20\u7684\u6570\u636e\u7c7b\u578b\u4e3aT\uff0c\u5176\u57fa\u672c\u64cd\u4f5c\u5982\u4e0b\uff1a ListState.add(T value) ListState.addAll(List values) ListState.get()\uff0c\u8fd4\u56deIterable ListState.update(List values) <ul> <li>\u6620\u5c04\u72b6\u6001\uff08 Map state\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u4e00\u7ec4 Key-Value \u5bf9</li> </ul> <p>MapState\u4fdd\u5b58 Key-Value \u5bf9\uff0c\u5176\u57fa\u672c\u64cd\u4f5c\u5982\u4e0b\uff1a MapState.get(UK key) MapState.put(UK key, UV value) MapState.contains(UK key) MapState.remove(UK key) <ul> <li>\u805a\u5408\u72b6\u6001\uff08 Reducing state &amp; Aggregating State\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u4e00\u4e2a\u7528\u4e8e\u805a\u5408\u64cd\u4f5c\u7684\u5217\u8868</li> </ul> <p>ReducingState AggregatingState State.clear()\u662f\u6240\u6709\u72b6\u6001\u90fd\u6709\u7684\u6e05\u7a7a\u64cd\u4f5c\uff0c\u76f4\u63a5\u5c06\u5206\u7ec4\u5bf9\u5e94\u7684\u72b6\u6001\u503c\u7f6e\u4e3anull\u3002 <p>\u4f7f\u7528\u952e\u63a7\u72b6\u6001\u5fc5\u987b\u5b9e\u73b0\u5bcc\u51fd\u6570\uff0c\u56e0\u4e3a\u952e\u63a7\u72b6\u6001\u9700\u8981\u4ece\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u4e2d\u83b7\u53d6\uff0c\u800c\u4e14\u952e\u63a7\u72b6\u6001\u7684\u8d4b\u503c\u53ea\u80fd\u5728open()\u65b9\u6cd5\u4e2d\u8fdb\u884c\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5b50\u4efb\u52a1\u7684\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u662f\u4e0d\u540c\u7684\u3002\u4f7f\u7528ValueState\u7edf\u8ba1\u6bcf\u4e2a\u5206\u7ec4\u6570\u636e\u7684\u6570\u91cf\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(2);\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.socketTextStream(\"localhost\", 7777);\n\u00a0\u00a0\u00a0\u00a0dataStream.keyBy(v -&gt; v)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// KeyedStream\u4f7f\u7528Keyed state\u952e\u63a7\u72b6\u6001\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u4f20\u8fdb\u6765\u5143\u7d20\u7684\u5206\u7ec4\u5b57\u6bb5\u627e\u5230\u5bf9\u5e94\u7684\u952e\u63a7\u72b6\u6001`\n `// valueState.value()\u662f\u83b7\u53d6\u952e\u63a7\u72b6\u6001\u7684\u503c\uff0cvalueState.update()\u662f\u66f4\u65b0\u952e\u63a7\u72b6\u6001\u7684\u503c\uff0c`\n `// \u6240\u4ee5\u6bcf\u4e2a\u7ec4\u90fd\u4f1a\u6709\u4e00\u4e2a\u952e\u63a7\u72b6\u6001\uff0c\u8fd9\u4e0e\u662f\u4e0d\u662fmap\u7b97\u5b50\u65e0\u5173\uff0c\u952e\u63a7\u72b6\u6001\u53ea\u80fd\u7528\u5728KeyedStream\u4e2d\u4f7f\u7528\u3002`\n `//\uff08\u5176\u5b9e\u5c31\u662fHashMap\u901a\u8fc7key\u627evalue\uff0c\u56e0\u4e3a\u53cd\u5e8f\u5217\u5316\u4e4b\u540e\uff0c\u6bcf\u4e2a\u5b50\u4efb\u52a1\u90fd\u6709\u4e14\u53ea\u6709\u4e00\u4efdvalueState\uff0c`\n `// \u4f46\u662f\u4e00\u4e2a\u5b50\u4efb\u52a1\u4f1a\u6709\u591a\u4e2a\u5904\u7406\u591a\u4e2akey\uff0c\u6240\u4ee5\u5b50\u4efb\u52a1\u5728\u5904\u7406\u6bcf\u4e00\u4e2akey\uff0c\u90fd\u662f\u53bbvalueState\u91cc\u901a\u8fc7key\u627e\u5bf9\u5e94\u7684\u503c\uff09\uff0c`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new RichMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `private ValueState&lt;Integer&gt; valueState;`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`@Override`\n `public void open(Configuration parameters) throws Exception {`\n `valueState = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;(\"count\", Integer.class));`\n `}`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;String, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/`/\u952e\u63a7\u72b6\u6001\u7b2c\u4e00\u6b21\u83b7\u53d6\u503c\u65f6\u4e3anull`\n `Integer count = valueState.value();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count = count == null ? 1 : count + 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`valueState.update(count);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(value, count);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void close() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0valueState.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u5728\u751f\u6210checkpoint\u65f6\uff0cFlink\u4f1a\u81ea\u52a8\u4fdd\u5b58\u4f60\u4ece\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u4e2d\u751f\u6210\u7684\u952e\u63a7\u72b6\u6001\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u867d\u7136\u952e\u63a7\u72b6\u6001\u548c\u7b97\u5b50\u72b6\u6001\u4e00\u6837\u4f1a\u88ab\u4fdd\u5b58\u5728checkpoint\u4e2d\uff0c\u4f46\u662f\u952e\u63a7\u72b6\u6001\u5728\u6545\u969c\u6062\u590d\u4e0d\u9700\u8981\u6307\u5b9a\u5982\u4f55\u5408\u5e76\u72b6\u6001\uff0c\u56e0\u4e3a\u952e\u63a7\u72b6\u6001\u662f\u548c\u5206\u7ec4\u7ed1\u5b9a\u5728\u4e00\u8d77\uff0c\u53d1\u751f\u6545\u969c\u524d\u6709\u51e0\u4e2a\u5206\u7ec4\uff0c\u6545\u969c\u6062\u590d\u4e4b\u540e\u8fd8\u662f\u90a3\u51e0\u4e2a\u5206\u7ec4\uff0c\u4e0e\u5e76\u884c\u5ea6\u65e0\u5173\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u5408\u5e76\u3002 \u6ce8\u610f\uff1aKeyed state\u53ea\u80fd\u7528\u4e8eKeyedStream\uff0c\u4e0d\u80fd\u7528\u4e8eDataStream\u3001WindowedStream\u7b49\u5176\u5b83\u6d41\uff0c\u56e0\u4e3aDataStream\u6ca1\u6709key\uff0cWindowedStream\u867d\u7136\u6709key\uff0c\u4f46\u5b83\u89c6\u4e3a\u6709\u754c\u6d41\u4e0d\u9700\u8981\u4e00\u76f4\u7ef4\u62a4\u4e00\u4e2a\u4e2d\u95f4\u72b6\u6001\uff0cWindowedStream\u7684\u589e\u91cf\u805a\u5408\u51fd\u6570\u548c\u5168\u7a97\u53e3\u805a\u5408\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u6574\u4e2a\u7a97\u53e3\u7684\u805a\u5408\u7ed3\u679c\u3002</p> <p>\u72b6\u6001\u540e\u7aef \u72b6\u6001\u540e\u7aef\u4e3b\u8981\u8d1f\u8d23\u4e24\u4ef6\u4e8b\uff1a\u4e00\u662f\u7ef4\u62a4\u672c\u5730\u72b6\u6001\uff08\u5c31\u662f\u5bf9\u952e\u63a7\u72b6\u6001\u7684\u7ef4\u62a4\uff0c\u4ece\u952e\u63a7\u72b6\u6001\u4e2d\u53d6\u503c\u548c\u66f4\u65b0\u952e\u63a7\u72b6\u6001\u7684\u503c\uff09\uff0c\u4e8c\u662f\u751f\u6210checkpoint\u5e76\u5199\u5230\u8fdc\u7a0b\u5b58\u50a8\u4e2d\u3002Flink\u63d0\u4f9b\u4e863\u79cd\u72b6\u6001\u540e\u7aef\u53ef\u4f9b\u9009\u62e9\uff1a</p> <ul> <li>MemoryStateBackend\uff1a\u5185\u5b58\u7ea7\u7684\u72b6\u6001\u540e\u7aef\uff0c\u4f1a\u5c06\u72b6\u6001\u653e\u5728 TaskManager \u7684 JVM \u5806\u5185\u5b58\u4e2d\u4f5c\u4e3a\u5bf9\u8c61\u8fdb\u884c\u7ba1\u7406\uff0c\u800c\u5c06 checkpoint \u5b58\u50a8\u5728 JobManager \u7684\u5185\u5b58\u4e2d\u3002\u4f18\u70b9\u662f\u5feb\u901f\u3001\u4f4e\u5ef6\u8fdf\uff0c\u7f3a\u70b9\u662f\u4e0d\u53ef\u9760\uff0c\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u3002</li> <li>FsStateBackend\uff1a\u5c06 checkpoint \u5b58\u5230\u8fdc\u7a0b\u7684\u6301\u4e45\u5316\u6587\u4ef6\u7cfb\u7edf\uff08 FileSystem\uff09 \u4e0a\uff0c \u6bd4\u5982HDFS\uff0c\u800c\u5bf9\u4e8e\u672c\u5730\u72b6\u6001\uff0c \u8ddf MemoryStateBackend \u4e00\u6837\uff0c\u653e\u5728 TaskManager \u7684 JVM \u5806\u4e0a\uff0c\u6b64\u79cd\u65b9\u5f0f\u540c\u65f6\u62e5\u6709\u5185\u5b58\u7ea7\u7684\u672c\u5730\u8bbf\u95ee\u901f\u5ea6\uff0c\u5bf9\u4e8echeckpoint\u4e5f\u6709\u5bb9\u9519\u4fdd\u8bc1\uff0c\u751f\u4ea7\u73af\u5883\u9996\u9009\u3002</li> <li>RocksDBStateBackend\uff1a\u672c\u5730\u72b6\u6001\u4e00\u90e8\u5206\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u4e00\u90e8\u5206\u5e8f\u5217\u5316\u540e\u5b58\u5165 RocksDB\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514dOOM\uff0ccheckpoint\u53ef\u4ee5\u6301\u4e45\u5316\u5230HDFS\u4e0a\u3002</li> </ul> <p>\u8bbe\u7f6e\u72b6\u6001\u540e\u7aef 1.\u5728conf/flink-conf.yaml\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6eFlink\u96c6\u7fa4\u4f7f\u7528\u7684\u72b6\u6001\u540e\u7aef\uff1a Text Only<pre><code># state.backend: filesystem\n# state.checkpoints.dir: hdfs://namenode-host:port/flink-checkpoints\n</code></pre></p> <p>2.\u4ee3\u7801\u4e2d\u8bbe\u7f6e\uff0c\u8fd9\u6837\u6bcf\u4e2a\u4f5c\u4e1a\u5c31\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u72b6\u6001\u540e\u7aef\u4e86 Text Only<pre><code>env.setStateBackend(new MemoryStateBackend());\nenv.setStateBackend(new FsStateBackend(\"\"));\n/*\nRocksDBStateBackend\u72b6\u6001\u540e\u7aef\u9700\u8981\u5f15\u5165\u4f9d\u8d56\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;flink-statebackend-rocksdb_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n*/\nenv.setStateBackend(new RocksDBStateBackend(\"\"));\n</code></pre> \u4e0a\u9762\u63d0\u5230\u7684 StateBackend\u662f\u9762\u5411\u7528\u6237\u7684\uff0c\u5728Flink\u5185\u90e83\u79cd State \u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u5728\u8fd0\u884c\u65f6\uff0cMemoryStateBackend \u548c FSStateBackend \u672c\u5730\u7684 State \u90fd\u4fdd\u5b58\u5728TaskManager\u7684\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u5176\u5e95\u5c42\u90fd\u4f9d\u8d56\u4e8eHeapKeyedStateBackend\u3002HeapKeyedStateBackend\u9762\u5411Flink \u5f15\u64ce\u5185\u90e8\uff0c\u4f7f\u7528\u8005\u65e0\u987b\u611f\u77e5\u3002 </p> <p>\u53c2\u8003\uff1a \u53f2\u4e0a\u6700\u5168\u5e72\u8d27\uff01Flink\u9762\u8bd5\u5927\u5168\u603b\u7ed3\uff08\u5168\u65876\u4e07\u5b57\u3001110\u4e2a\u77e5\u8bc6\u70b9\u3001160\u5f20\u56fe\uff09</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/2-Flink%E8%BF%90%E8%A1%8C%E6%9E%B6%E6%9E%84/","title":"2-Flink\u8fd0\u884c\u67b6\u6784","text":"<p> \u7ea6 1243 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 25 \u5206\u949f</p> <p>\u4e00\u3001Flink \u8fd0\u884c\u65f6\u7684\u7ec4\u4ef6 Flink \u8fd0\u884c\u65f6\u67b6\u6784\u4e3b\u8981\u5305\u62ec\u56db\u4e2a\u4e0d\u540c\u7684\u7ec4\u4ef6\uff1a \u4f5c\u4e1a\u7ba1\u7406\u5668\uff08JobManager\uff09\u3001\u8d44\u6e90\u7ba1\u7406\u5668\uff08ResourceManager\uff09\u3001\u4efb\u52a1\u7ba1\u7406\u5668\uff08TaskManager\uff09\uff0c \u4ee5\u53ca\u5206\u53d1\u5668\uff08Dispatcher\uff09\u3002\u56e0\u4e3a Flink \u662f\u7528 Java \u548c Scala \u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6240\u6709\u7ec4\u4ef6\u90fd\u4f1a\u8fd0\u884c\u5728Java \u865a\u62df\u673a\u4e0a\u3002</p> <p>1.\u4f5c\u4e1a\u7ba1\u7406\u5668\uff08 JobManager \uff09 JobManager\u662f\u63a7\u5236\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6267\u884c\u7684\u4e3b\u8fdb\u7a0b\uff08\u7c7b\u4f3c\u4e8eSpark\u7684Driver\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u5411Flink\u63d0\u4ea4\u4e00\u4e2ajob\u5c31\u4f1a\u542f\u52a8\u4e00\u4e2aJobManager\u6765\u63a7\u5236\u6574\u4e2a\u4f5c\u4e1a\u7684\u6267\u884c\u3002</p> <p>2.\u4efb\u52a1\u7ba1\u7406\u5668\uff08 TaskManager \uff09 TaskManager\u662fFlink\u4e2d\u7684\u5de5\u4f5c\u8fdb\u7a0b\uff08\u7c7b\u4f3c\u4e8eSpark\u7684Executor\uff09\u3002 \u901a\u5e38\u5728Flink\u96c6\u7fa4\u4e2d\u4f1a\u6709\u591a\u4e2aTaskManager\u8fd0\u884c\uff0c\u6bcf\u4e00\u4e2aTaskManager\u90fd\u5305\u542b\u4e86\u4e00\u5b9a\u6570\u91cf\u7684\u63d2\u69fd\uff08 slots\uff09\uff0c\u63d2\u69fd\u6570\u5c31\u662fTaskManager\u53ef\u4ee5\u542f\u52a8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u7528\u6765\u6267\u884c\u4e00\u4e2a\u6216\u591a\u4e2a\u4efb\u52a1\uff0c\u6240\u4ee5\u63d2\u69fd\u7684\u6570\u91cf\u9650\u5236\u4e86TaskManager\u80fd\u591f\u6267\u884c\u7684\u4efb\u52a1\u6570\u91cf\u3002 TaskManager\u7531ResourceManager\u63a7\u5236\u542f\u52a8\uff0c TaskManager\u542f\u52a8\u4e4b\u540e\uff0c\u4f1a\u5411 ResourceManager\u6ce8\u518c\u5b83\u7684\u63d2\u69fd\u3002TaskManager\u6536\u5230 ResourceManager\u7684\u6307\u4ee4\u540e\uff0cTaskManager \u5c31\u4f1a\u5c06\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u63d2\u69fd\u63d0\u4f9b\u7ed9 JobManager \u8c03\u7528\uff0c\u4e8e\u662fJobManager \u5c31\u53ef\u4ee5\u5411\u63d2\u69fd\u5206\u914d\u4efb\u52a1\uff08tasks\uff09\u3002\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a TaskManager \u53ef\u4ee5\u548c\u540c\u4e00\u5e94\u7528\u7a0b\u5e8f\u7684\u5176\u5b83 TaskManager \u4ea4\u6362\u6570\u636e\u3002</p> <p>3.\u8d44\u6e90\u7ba1\u7406\u5668\uff08 ResourceManager \uff09 ResourceManager\u4e3b\u8981\u8d1f\u8d23\u7ba1\u7406 TaskManager \u7684\u63d2\u69fd\uff08slot\uff09\uff0c\u5f53 JobManager \u7533\u8bf7slot\u8d44\u6e90\u65f6\uff0cResourceManager \u4f1a\u5c06\u6709\u7a7a\u95f2\u63d2\u69fd\u7684 TaskManager \u5206\u914d\u7ed9 JobManager\u3002 \u00a0Flink \u4e3a\u4e0d\u540c\u7684\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\u90fd\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684ResourceManager\uff0c\u6bd4\u5982YARN\u3001Mesos\u3001K8s\uff0c\u4ee5\u53ca standalone\u6a21\u5f0f\u3002\u5982\u679c ResourceManager \u6ca1\u6709\u8db3\u591f\u7684\u63d2\u69fd\u6765\u6ee1\u8db3 JobManager \u7684\u8bf7\u6c42\uff0c\u5b83\u8fd8\u53ef\u4ee5\u5411\u8d44\u6e90\u63d0\u4f9b\u5e73\u53f0\u53d1\u8d77\u4f1a\u8bdd\uff0c\u7533\u8bf7\u63d0\u4f9b\u542f\u52a8 TaskManager \u8fdb\u7a0b\u7684\u5bb9\u5668\u3002\u53e6\u5916\uff0cResourceManager \u8fd8\u8d1f\u8d23\u7ec8\u6b62\u7a7a\u95f2\u7684 TaskManager\uff0c\u91ca\u653e\u8ba1\u7b97\u8d44\u6e90\u3002</p> <p>4.\u5206\u53d1\u5668\uff08 Dispatcher \uff09 Dispatcher\u7528\u4e8e\u63a5\u6536\u5e76\u63d0\u4ea4\u4f5c\u4e1a\u3002\u7528\u6237\u4e0d\u4ec5\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u63d0\u4ea4\u4f5c\u4e1a\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7Dispatcher\u63d0\u4f9b\u7684\u7528\u4e8e\u63a5\u6536\u4f5c\u4e1a\u7684REST\u63a5\u53e3\u6765\u63d0\u4ea4\u4f5c\u4e1a\uff0c\u7531\u4e8e\u662f REST \u63a5\u53e3\uff0c\u6240\u4ee5 Dispatcher \u53ef\u4ee5\u4f5c\u4e3a\u96c6\u7fa4\u7684\u4e00\u4e2a HTTP \u63a5\u5165\u70b9\uff0c\u8fd9\u6837\u5c31\u80fd\u591f\u4e0d\u53d7\u9632\u706b\u5899\u963b\u6321\u3002 Dispatcher\u63a5\u6536\u5230\u4f5c\u4e1a\u4e4b\u540e\u5c31\u9700\u8981\u5411JobManager\u63d0\u4ea4\u4f5c\u4e1a\uff0c\u8fd9\u65f6Dispatcher\u4f1a\u5148\u542f\u52a8\u4e00\u4e2a JobManager\uff0c\u7136\u540e\u5c06\u5e94\u7528\u63d0\u4ea4\u7ed9JobManager\u3002 Dispatcher \u8fd8\u4f1a\u542f\u52a8\u4e00\u4e2aWeb UI\uff0c\u7528\u6765\u65b9\u4fbf\u5730\u5c55\u793a\u548c\u76d1\u63a7\u4f5c\u4e1a\u6267\u884c\u7684\u4fe1\u606f\u3002 Dispatcher \u5728\u67b6\u6784\u4e2d\u53ef\u80fd\u5e76\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u8fd9\u53d6\u51b3\u4e8e\u5e94\u7528\u63d0\u4ea4\u8fd0\u884c\u7684\u65b9\u5f0f\u3002</p> <p>\u4e8c\u3001\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b \u4e0d\u8003\u8651\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\uff0cFlink\u4f5c\u4e1a\u63d0\u4ea4\u6d41\u7a0b\u5982\u4e0b\uff1a </p> <ol> <li>\u5411Dispatcher\u63d0\u4ea4\u4f5c\u4e1a\uff0c\u6216\u8005\u8bf4\u5e94\u7528\uff0c\u4f5c\u4e1a\u548c\u5e94\u7528\u662f\u4e00\u4e2a\u610f\u601d\uff0c\u4f46\u4efb\u52a1\u662f\u4f5c\u4e1a\u7684\u4e00\u90e8\u5206</li> <li>Dispatcher\u542f\u52a8\u4e00\u4e2a JobManager\uff0c\u7136\u540e\u5c06\u5e94\u7528\u63d0\u4ea4\u7ed9JobManager</li> <li>JobManager\u5411ResourceManager\u8bf7\u6c42slots</li> <li>ResourceManager\u542f\u52a8TaskManager</li> <li>TaskManager\u5411ResourceManager\u6ce8\u518c\u81ea\u5df1\u62e5\u6709\u7684slot\u6570\u91cf</li> <li>ResourceManager\u5411TaskManager\u53d1\u9001\u547d\u4ee4\uff0c\u8981\u6c42TaskManager\u5411JobManager\u63d0\u4f9bslot</li> <li>TaskManager\u5411JobManager\u63d0\u4f9bslots</li> <li>JobManager\u5411slot\u63d0\u4ea4\u4efb\u52a1</li> <li>TaskManager\u5f00\u542f\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u5177\u6709\u5148\u540e\u987a\u5e8f\u7684\u4efb\u52a1\u4f1a\u5728\u6267\u884c\u65f6\u4ea4\u6362\u6570\u636e</li> </ol> <p>\u5728 YARN Per-Job-Cluster\u6a21\u5f0f\u4e0b\u7684\u4efb\u52a1\u63d0\u4ea4\u6d41\u7a0b\uff1a  Flink \u4efb\u52a1\u63d0\u4ea4\u540e\uff0cClient \u5411 HDFS \u4e0a\u4f20 Flink \u7684 Jar \u5305\u548c\u914d\u7f6e\uff0c \u4e4b\u540e\u5411 Yarn ResourceManager \u63d0\u4ea4\u4efb\u52a1\uff0c ResourceManager \u5206\u914d Container \u8d44\u6e90\u5e76\u901a\u77e5\u5bf9\u5e94\u7684NodeManager \u542f\u52a8 ApplicationMaster\uff0c ApplicationMaster \u542f\u52a8\u540e\u52a0\u8f7d Flink \u7684 Jar \u5305\u548c\u914d\u7f6e\u6784\u5efa\u73af\u5883\uff0c\u7136\u540e\u542f\u52a8 JobManager\uff0c\u4e4b\u540e ApplicationMaster \u5411 ResourceManager \u7533\u8bf7\u8d44\u6e90\u542f\u52a8 TaskManager\uff0cResourceManager \u5206\u914d Container \u8d44 \u6e90 \u540e \uff0c \u7531ApplicationMaster \u901a \u77e5 \u8d44 \u6e90 \u6240 \u5728 \u8282 \u70b9 \u7684 NodeManager \u542f\u52a8 TaskManager\uff0cNodeManager \u52a0\u8f7d Flink \u7684 Jar \u5305\u548c\u914d\u7f6e\u6784\u5efa\u73af\u5883\u5e76\u542f\u52a8 TaskManager\uff0cTaskManager \u542f\u52a8\u540e\u5411 JobManager \u53d1\u9001\u5fc3\u8df3\u5305\uff0c \u5e76\u7b49\u5f85 JobManager \u5411\u5176\u5206\u914d\u4efb\u52a1\u3002</p> <p>\u4e09\u3001\u4efb\u52a1\u8c03\u5ea6  \u5f53Flink\u96c6\u7fa4\u542f\u52a8\u540e\uff0c\u9996\u5148\u4f1a\u542f\u52a8\u4e00\u4e2a JobManger \u548c \u4e00\u4e2a\u6216\u591a\u4e2a\u7684TaskManager\uff0c\u63a5\u7740\u7531 Client \u63d0\u4ea4\u4efb\u52a1\u7ed9 JobManager\uff0cJobManager \u518d\u8c03\u5ea6\u4efb\u52a1\u5230\u5404\u4e2aTaskManager \u53bb\u6267\u884c\uff0c \u7136\u540e TaskManager \u5c06\u5fc3\u8df3\u548c\u7edf\u8ba1\u4fe1\u606f\u6c47\u62a5\u7ed9 JobManager\u3002TaskManager \u4e4b\u95f4\u4ee5\u6d41\u7684\u5f62\u5f0f\u8fdb\u884c\u6570\u636e\u7684\u4f20\u8f93\u3002 Client\u3001JobManger\u3001TaskManager\u5747\u4e3a\u72ec\u7acb\u7684 JVM \u8fdb\u7a0b\uff1a</p> <ul> <li>Client \u4e3a\u63d0\u4ea4 Job \u7684\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u662f\u8fd0\u884c\u5728\u4efb\u4f55\u673a\u5668\u4e0a\uff08 \u4e0e JobManager \u73af\u5883\u8fde\u901a\u5373\u53ef\uff09\u3002Client\u4e0d\u662f\u5206\u5e03\u5f0f\u8ba1\u7b97\u7a0b\u5e8f\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u7528\u4e8e\u51c6\u5907\u5e76\u53d1\u9001dataflow(JobGraph)\u7ed9 Master(JobManager)\uff0c\u63d0\u4ea4 Job \u540e\uff0c Client \u53ef\u4ee5\u7ed3\u675f\u8fdb\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u7ed3\u675f\u5e76\u7b49\u5f85\u7ed3\u679c\u8fd4\u56de\u3002</li> <li>JobManager \u4e3b\u8981\u8d1f\u8d23\u8c03\u5ea6\u4efb\u52a1\u5e76\u534f\u8c03 TaskManager \u505a checkpoint \u3002JobManager \u4ece Client \u5904\u63a5\u6536\u5230 Job \u548c JAR \u5305\u7b49\u8d44\u6e90\u540e\uff0c\u4f1a\u751f\u6210\u4f18\u5316\u540e\u7684\u6267\u884c\u8ba1\u5212\uff0c\u5e76\u5c06\u4efb\u52a1\u8c03\u5ea6\u5230\u5404\u4e2a TaskManager \u53bb\u6267\u884c\u3002</li> <li>TaskManager \u5728\u542f\u52a8\u7684\u65f6\u5019\u5c31\u8bbe\u7f6e\u597d\u4e86\u69fd\u4f4d\u6570\uff08slot\uff09\uff0cslot\u6570\u5c31\u662fTaskManager\u80fd\u542f\u52a8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002TaskManager \u4ece JobManager \u5904\u63a5\u6536\u4efb\u52a1\u540e\uff0c\u5c31\u4f1a\u542f\u52a8\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u5904\u4e8e\u4e0d\u540c\u7ebf\u7a0b\u4e0a\u7684\u4efb\u52a1\u4f1a\u4e0e\u81ea\u5df1\u7684\u4e0a\u6e38\u4efb\u52a1\u5efa\u7acb Netty \u8fde\u63a5\uff0c\u7528\u4e8e\u63a5\u6536\u5e76\u5904\u7406\u6570\u636e\u3002</li> </ul>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/20-Flink%E5%AE%B9%E9%94%99%E6%9C%BA%E5%88%B6/","title":"20-Flink\u5bb9\u9519\u673a\u5236","text":"<p> \u7ea6 2163 \u4e2a\u5b57  10 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 43 \u5206\u949f</p> <p>\u5bb9\u9519\u673a\u5236\u6307\u7684\u662f\u96c6\u7fa4\u7684\u5de5\u4f5c\u8282\u70b9\u5b95\u673a\u4e4b\u540e\u5982\u4f55\u91cd\u65b0\u6062\u590d\u8ba1\u7b97\u7684\u65b9\u6cd5\u3002Flink\u7684\u5bb9\u9519\u673a\u5236\u662f\u5b9a\u671f\u751f\u6210\u68c0\u67e5\u70b9checkpoint\uff0ccheckpoint\u4e2d\u4fdd\u5b58\u7684\u662f\u72b6\u6001\uff0c\u5f53\u8fdb\u884c\u6545\u969c\u6062\u590d\u65f6\uff0c\u53ea\u9700\u52a0\u8f7d\u6700\u8fd1\u4e00\u6b21\u7684checkpoint\uff0c\u7136\u540e\u4ececheckpoint\u5904\u6062\u590d\u8ba1\u7b97\uff0c\u8fd9\u6837\u5c31\u65e0\u9700\u4ece\u5934\u5f00\u59cb\u8ba1\u7b97\uff08\u65e0\u72b6\u6001\u7684\u5b50\u4efb\u52a1\u4e0d\u9700\u8981\u8003\u8651\u6545\u969c\u6062\u590d\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e2d\u95f4\u7ed3\u679c\u9700\u8981\u4fdd\u5b58\uff0c\u5b50\u4efb\u52a1\u6302\u4e86\u5c31\u6302\u4e86\uff0c\u6570\u636e\u8d70\u5176\u5b83\u5b50\u4efb\u52a1\u5c31\u597d\uff09\u3002 \u6bd4\u5982\u6709\u4e00\u4e2a\u5206\u522b\u8ba1\u7b97\u6570\u636e\u4e2d\u7684\u5947\u6570\u4e4b\u548c\u548c\u5076\u6570\u4e4b\u548c\u7684\u4f5c\u4e1a\uff1a  \u6b64\u65f6source\u4efb\u52a1\u4e2d\u7684\u72b6\u6001\u662f5\uff0c\u8868\u793a\u8bfb\u5b8c\u4e861,2,3,4,5\uff0c\u8fd9\u91cc\u76845\u65e2\u662f\u6570\u636e5\uff0c\u53c8\u662f\u4f4d\u7f6e5\uff0c\u4f46source\u4fdd\u5b58\u5728checkpoint\u4e2d\u7684\u72b6\u6001\u662f\u4f4d\u7f6e5\u3002\u4e5f\u5c31\u662fsource\u4e2d\u4fdd\u5b58\u7684\u72b6\u6001\u5e94\u8be5\u662f\u4ece\u6570\u636e\u6e90\u8bfb\u53d6\u6570\u636e\u7684\u4f4d\u7f6e\uff08\u6bd4\u5982\u5f53\u6570\u636e\u6e90\u662fKafka\u65f6\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u5c31\u662foffset\uff09\uff0c\u8fd9\u6837\u624d\u80fd\u77e5\u9053\u5728\u6545\u969c\u6062\u590d\u540e\u8be5\u4ece\u6570\u636e\u6e90\u7684\u54ea\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u3002 sum_even\u7684\u72b6\u6001\u662f6\uff0c\u8868\u793a\u5904\u7406\u5b8c2+4\u3002sum_odd\u7684\u72b6\u6001\u662f9\uff0c\u8868\u793a\u5904\u7406\u5b8c1+3+5\u3002\u5b83\u95e8\u6b64\u523b\u7684\u72b6\u6001\u90fd\u7531\u72b6\u6001\u540e\u7aef\u4fdd\u5b58\u5728\u4e86\u5916\u90e8\u5b58\u50a8\u4e0a\uff0c\u8fd9\u4e2a\u5916\u90e8\u5b58\u50a8\u53ef\u80fd\u662fJobManager\u7684\u5185\u5b58\u6216\u8005\u662fHDFS\u3002</p> <p>\u4ece\u4e0a\u9762\u53ef\u4ee5\u77e5\u9053\uff0c\u6bcf\u4e2a\u6709\u72b6\u6001\u7684\u5b50\u4efb\u52a1\u751f\u6210checkpoint\u7684\u65f6\u95f4\u70b9\u5e94\u8be5\u662f\u5728\u5904\u7406\u5b8csource\u72b6\u6001\u5bf9\u5e94\u90a3\u6761\u6570\u636e\u4e4b\u540e\uff0c\u5728\u5904\u7406\u4e0b\u4e00\u6761\u6570\u636e\u4e4b\u524d\uff0c\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u5728\u6545\u969c\u6062\u590d\u65f6\uff0c\u4fdd\u8bc1source\u8bfb\u8fdb\u6765\u7684\u6570\u636e\u90fd\u662f\u6240\u6709\u5b50\u4efb\u52a1\u7684\u72b6\u6001\u6ca1\u6709\u5904\u7406\u8fc7\u6570\u636e\uff0c\u8fd9\u6837\u7684\u68c0\u67e5\u70b9\u4e5f\u79f0\u4e3a\u4e00\u81f4\u6027\u68c0\u67e5\u70b9\uff0c\u4e00\u81f4\u6027\u68c0\u67e5\u70b9\u4e2d\u4fdd\u5b58\u7684\u72b6\u6001\u4e5f\u79f0\u4e3a\u4e00\u81f4\u6027\u72b6\u6001\u3002 \u60f3\u5b9e\u73b0\u4e00\u81f4\u6027\u68c0\u67e5\u70b9\u6709\u4e24\u79cd\u601d\u8def\uff0c\u4e00\u662f\u5728source\u751f\u6210\u68c0\u67e5\u70b9\u540e\uff0c\u5c31\u4e0d\u518d\u5411\u4e0b\u6e38\u53d1\u9001\u6570\u636e\u4e86\uff0c\u53ea\u6709\u7b49\u5230\u4e0b\u6e38\u6240\u6709\u6709\u72b6\u6001\u5b50\u4efb\u52a1\u90fd\u4fdd\u5b58\u5b8c\u68c0\u67e5\u70b9\u540e\uff0c\u518d\u7531JobManager\u901a\u77e5Source\u5411\u4e0b\u6e38\u53d1\u9001\u6570\u636e\u3002\u56e0\u4e3a\u6240\u6709\u5b50\u4efb\u52a1\u90fd\u9700\u8981\u7b49\u5f85\u5176\u5b83\u6709\u72b6\u6001\u5b50\u4efb\u52a1\u4fdd\u5b58\u5b8ccheckpoint\u624d\u80fd\u7ee7\u7eed\u8fdb\u884c\u4e0b\u4e00\u6761\u6570\u636e\u7684\u8ba1\u7b97\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u79cd\u540c\u6b65\u4fdd\u5b58checkpoint\u7684\u65b9\u5f0f\uff0c\u5176\u597d\u5904\u662f\u5b9e\u73b0\u7b80\u5355\uff0c\u574f\u5904\u662f\u6548\u7387\u4f4e\u3002 \u7b2c\u4e8c\u79cd\u601d\u8def\u4e0ewatermark\u7c7b\u4f3c\uff0c\u5c31\u662f\u5728source\u751f\u6210\u68c0\u67e5\u70b9\u7684\u90a3\u6761\u6570\u636e\u4e4b\u540e\u52a0\u4e0a\u4e00\u6761\u7279\u6b8a\u6570\u636e\uff0c\u5f53\u4e0b\u6e38\u6709\u72b6\u6001\u5b50\u4efb\u52a1\u6536\u5230\u8fd9\u6761\u6570\u636e\u4e4b\u540e\u5c31\u4f1a\u4fdd\u5b58checkpoint\uff0c\u8fd9\u6761\u6570\u636e\u7684\u4f20\u9012\u548cwatermark\u4e00\u6837\uff0c\u5f53\u53d1\u751f\u6570\u636e\u7684Redistributing\uff0c\u5c31\u4f1a\u4ee5\u5e7f\u64ad\u7684\u65b9\u5f0f\u4f20\u9012\u5230\u4e0b\u6e38\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e0b\u6e38\u7684\u6240\u6709\u5b50\u4efb\u52a1\u90fd\u4f1a\u6536\u5230\u8fd9\u6761\u6570\u636e\u3002\u5728\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u6bcf\u4e2a\u5b50\u4efb\u52a1\u90fd\u4e0d\u7528\u7b49\u5f85\u5176\u5b83\u6709\u72b6\u6001\u5b50\u4efb\u52a1\uff08\u800c\u4e14\u8fd8\u53ef\u4ee5\u5f02\u6b65\u5730\u4fdd\u5b58checkpoint\uff0c\u5373\u5c06\u6b64\u65f6\u7684\u72b6\u6001\u590d\u5236\u4e00\u4efd\u540e\u7acb\u523b\u5904\u7406\u4e0b\u4e00\u6761\u6570\u636e\uff0c\u7136\u540e\u518d\u65b0\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u4fdd\u5b58\u539f\u6765\u7684\u72b6\u6001\u5230checkpoint\uff09\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u79cd\u5f02\u6b65\u4fdd\u5b58checkpoint\u7684\u65b9\u5f0f\u3002\u00a0</p> <p>\u56e0\u4e3aFlink\u7684\u76ee\u6807\u662f\u4f4e\u5ef6\u65f6\uff0c\u6240\u4ee5\u5f53\u7136\u4f1a\u9009\u62e9\u7b2c\u4e8c\u79cd\u4fdd\u5b58checkpoint\u7684\u601d\u8def\uff0c\u4e5f\u79f0\u4e3a\u57fa\u4e8e Chandy-Lamport \u7b97\u6cd5\u7684\u5206\u5e03\u5f0f\u5feb\u7167\u3002\u90a3\u6761\u7279\u6b8a\u7684\u6570\u636e\u5728Flink\u4e2d\u79f0\u4e3a \u68c0\u67e5\u70b9\u5206\u754c\u7ebf\uff08 Checkpoint Barrier\uff09\u3002 \u5728\u6709\u72b6\u6001\u5b50\u4efb\u52a1\u4e2d\uff0c\u5206\u754c\u7ebf\u4e4b\u524d\u5230\u6765\u7684\u6570\u636e\u5bfc\u81f4\u7684\u72b6\u6001\u66f4\u6539\uff0c\u90fd\u4f1a\u88ab\u5305\u542b\u5728\u5f53\u524d\u5206\u754c\u7ebf\u6240\u5c5e\u7684\u68c0\u67e5\u70b9\u4e2d\uff1b\u800c\u57fa\u4e8e\u5206\u754c\u7ebf\u4e4b\u540e\u7684\u6570\u636e\u5bfc\u81f4\u7684\u6240\u6709\u66f4\u6539\uff0c\u5c31\u4f1a\u88ab\u5305\u542b\u5728\u65b0\u7684\u7684\u68c0\u67e5\u70b9\u4e2d\u3002</p> <p>Flink\u4fdd\u5b58\u72b6\u6001\u5230\u68c0\u67e5\u70b9\u7684\u5177\u4f53\u8fc7\u7a0b\uff1a 1. JobManager \u4f1a\u5411\u6bcf\u4e2asource\u5b50\u4efb\u52a1\u53d1\u9001\u4e00\u6761\u5e26\u6709\u65b0\u68c0\u67e5\u70b9 ID \u7684\u6d88\u606f\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u542f\u52a8\u751f\u6210\u68c0\u67e5\u70b9\u3002 </p> <p>2. \u72b6\u6001\u540e\u7aef\u4f1a\u5148\u5c06source\u7684\u72b6\u6001\u5199\u5165\u68c0\u67e5\u70b9\uff0c\u5199\u5165\u5b8c\u6210\u540e\u4f1a\u901a\u77e5source\uff0c\u4e4b\u540esource\u00a0\u5411 JobManager \u53d1\u9001\u68c0\u67e5\u70b9\u4fdd\u5b58\u5b8c\u6210\u7684\u786e\u8ba4\u6d88\u606f\uff0c\u5e76\u5411\u4e0b\u6e38\u5e7f\u64adCheckpoint Barrier\u3002 </p> <p>3.\u5f53\u4e00\u4e2a\u4e0b\u6e38\u5b50\u4efb\u52a1\u4f1a\u6536\u5230\u591a\u4e2a\u4e0a\u6e38\u5b50\u4efb\u52a1\u7684\u6570\u636e\u65f6\uff0c\u4e5f\u5c31\u4f1a\u6536\u5230\u591a\u4e2abarrier\uff0c\u4e0ewatermark\u53d6\u6700\u5c0f\u503c\u4e0d\u540c\u7684\u662f\uff0c\u6b64\u65f6\u4e0b\u6e38\u5b50\u4efb\u52a1\u4f1a\u7b49\u6240\u6709source\u7684barrier\u5230\u9f50\u4e4b\u540e\u624d\u5f00\u59cb\u4fdd\u5b58\u72b6\u6001\u5230checkpoint\uff08\u79f0\u4e3abarrier\u5bf9\u9f50\uff09\uff0c\u8fd9\u662f\u56e0\u4e3abarrier\u542b\u4e49\u662f\u6240\u6709barrier\u4e4b\u524d\u7684\u6570\u636e\u90fd\u5e94\u8be5\u662f\u5df2\u7ecf\u5904\u7406\u5b8c\u4fdd\u5b58\u5728\u72b6\u6001\u4e2d\u4e86\uff0c\u800cbarrier\u4e4b\u540e\u7684\u6570\u636e\u5e94\u8be5\u4fdd\u5b58\u5728\u4e0b\u4e00\u4e2a\u72b6\u6001\u4e2d\uff0c\u6240\u4ee5\u5728barrier\u5c1a\u672a\u5230\u9f50\u4e4b\u524d\uff0c\u5bf9\u4e8ebarrier\u5df2\u7ecf\u5230\u8fbe\u7684\u5206\u533a\uff0c\u7ee7\u7eed\u5230\u8fbe\u7684\u6570\u636e\u4f1a\u88ab\u7f13\u5b58\uff0c \u800cbarrier\u5c1a\u672a\u5230\u8fbe\u7684\u5206\u533a\uff0c\u6570\u636e\u4f1a\u88ab\u6b63\u5e38\u5904\u7406\u3002 </p> <p>4.\u5728\u4e0b\u6e38\u5b50\u4efb\u52a1\u6536\u5230\u6240\u6709\u4e0a\u6e38\u8f93\u5165\u5206\u533a\u7684barrier\u540e\uff0c \u8be5\u5b50\u4efb\u52a1\u5c31\u5c06\u5176\u72b6\u6001\u4fdd\u5b58\u5230checkpoint\u4e2d\uff0c\u7136\u540e\u5c06barrier\u7ee7\u7eed\u5411\u4e0b\u6e38\u53d1\u9001\u3002 </p> <p>5. \u5411\u4e0b\u6e38\u8f6c\u53d1\u68c0\u67e5\u70b9 barrier \u540e\uff0c\u4efb\u52a1\u7ee7\u7eed\u6b63\u5e38\u7684\u6570\u636e\u5904\u7406 </p> <p>6. sink\u4efb\u52a1\u6536\u5230barrier\u4e4b\u540e\uff0c\u4f1a\u5411JobManager\u786e\u8ba4\u72b6\u6001\u4fdd\u5b58\u5230checkpoint\u5b8c\u6bd5\uff0csink\u4efb\u52a1\u672c\u8eab\u6ca1\u6709\u72b6\u6001\u9700\u8981\u4fdd\u5b58\u5230checkpoint\u3002 \u5f53\u6240\u6709sink\u4efb\u52a1\u90fd\u5df2\u5411JobManager\u53d1\u9001\u786e\u8ba4\u6d88\u606f\u540e\uff0c\u68c0\u67e5\u70b9\u624d\u7b97\u771f\u6b63\u4fdd\u5b58\u5b8c\u6210\u4e86\u3002 </p> <p>Flink\u4ece\u68c0\u67e5\u70b9\u4e2d\u6062\u590d\u8ba1\u7b97\u7684\u8fc7\u7a0b\uff1a \u5982\u679c\u53d1\u751f\u6545\u969c\uff0c Flink \u4f1a\u4f7f\u7528\u6700\u8fd1\u7684\u68c0\u67e5\u70b9\u6765\u4e00\u81f4\u6062\u590d\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\uff0c\u5e76\u91cd\u65b0\u542f\u52a8\u5904\u7406\u6d41\u7a0b\uff0c\u8fd9\u4e2a\u5e94\u8be5\u662f\u7531Flink\u96c6\u7fa4\u81ea\u52a8\u5b8c\u6210\uff0c\u5e76\u4e0d\u662f\u4eba\u4e3a\u624b\u52a8\u5730\u53bb\u91cd\u65b0\u63d0\u4ea4\u5e94\u7528\uff1a 1.\u53d1\u751f\u6545\u969c  2. \u91cd\u542f\u5e94\u7528  3. \u4ece\u68c0\u67e5\u70b9\u4e2d\u6062\u590d\u72b6\u6001 \u4ece\u68c0\u67e5\u70b9\u91cd\u65b0\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u540e\uff0c\u5176\u5185\u90e8\u72b6\u6001\u4e0e\u68c0\u67e5\u70b9\u5b8c\u6210\u65f6\u7684\u72b6\u6001\u5b8c\u5168\u76f8\u540c\uff08\u5e76\u884c\u5ea6\u53d1\u751f\u53d8\u5316\u4f1a\u9020\u6210\u7b97\u5b50\u72b6\u6001\u7684\u5408\u5e76\uff0c\u4f46\u5408\u5e76\u524d\u540e\u72b6\u6001\u662f\u4e00\u81f4\u7684\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4source\u4f1a\u4ece\u68c0\u67e5\u70b9\u4e2d\u4fdd\u5b58\u7684\u504f\u79fb\u91cf\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u6e90\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4f1a\u6709\u91cd\u590d\u6d88\u8d39\u6570\u636e\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u56e0\u4e3a\u4ece\u68c0\u67e5\u70b9\u4e2d\u6062\u590d\u7684\u72b6\u6001\u5e76\u6ca1\u6709\u5305\u542b\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u6240\u4ee5\u5e76\u4e0d\u4f1a\u9020\u6210\u5f71\u54cd\uff0c \u8fd9\u79cd\u68c0\u67e5\u70b9\u7684\u4fdd\u5b58\u548c\u6062\u590d\u673a\u5236\u53ef\u4ee5\u4e3a\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u63d0\u4f9b\u201c\u7cbe\u786e\u4e00\u6b21\u201d\uff08 exactly-once\uff09\u7684\u4e00\u81f4\u6027\u4fdd\u969c\u3002 </p> <p>\u4ee5\u4e0a\u662f\u53d1\u751f\u6545\u969c\u540e\u4ee5\u91cd\u542f\u6574\u4e2a\u5e94\u7528\u7684\u65b9\u5f0f\u6765\u6062\u590d\u8ba1\u7b97\uff0c\u73b0\u5728\u4ee5\u9ed8\u8ba4\u5f00\u542f\u533a\u57df\u5316\u91cd\u65b0\u542f\u52a8\uff0c\u5373\u5f53\u67d0\u4e2a\u5b50\u4efb\u52a1\u5931\u8d25\u540e\u53ef\u4ee5\u81ea\u52a8\u91cd\u65b0\u542f\u52a8\uff08\u5e76\u4e0d\u662f\u5f88\u6e05\u695a\u533a\u57df\u5316\u91cd\u65b0\u542f\u52a8\u7684\u8fc7\u7a0b\uff0c\u5982\u679c\u76f4\u63a5\u91cd\u542f\u8fd9\u4e2a\u4efb\u52a1\uff0c\u7136\u540e\u4ececheckpoint\u4e2d\u8bfb\u53d6\u4e4b\u524d\u72b6\u6001\u7ee7\u7eed\u8ba1\u7b97\u4f1a\u9020\u6210\u6570\u636e\u7684\u4e22\u5931\u554a\uff0c\u56e0\u4e3a\u53ea\u8981source\u4e0d\u91cd\u65b0\u4ececheckpoint\u4e2d\u6062\u590d\u72b6\u6001\uff0c\u5c31\u4f1a\u4e0d\u4f1a\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff09\uff0cconf/flink-conf.yaml\u914d\u7f6e\u6587\u4ef6\uff1a Text Only<pre><code>jobmanager.execution.failover-strategy: region\n</code></pre></p> <p>\u4fdd\u5b58\u70b9\uff08Savepoints\uff09 \u4fdd\u5b58\u70b9\u4e0e\u68c0\u67e5\u70b9\u539f\u7406\u4e00\u6837\uff0c\u4e5f\u53ef\u7528\u4e8e\u6062\u590d\u7a0b\u5e8f\u3002\u4fdd\u5b58\u70b9\u4e0e\u68c0\u67e5\u70b9\u4e0d\u540c\u4e4b\u5904\u5c31\u5728\u4e8e\uff1a 1.\u4fdd\u5b58\u70b9\u9700\u8981\u4eba\u4e3a\u624b\u52a8\u5730\u89e6\u53d1\uff0c\u800c\u68c0\u67e5\u70b9\u662f\u7531Flink\u5468\u671f\u6027\u5730\u751f\u6210\u3002 2.\u4ece\u4fdd\u5b58\u70b9\u4e2d\u6062\u590d\u7a0b\u5e8f\u9700\u8981\u5728\u63d0\u4ea4\u5e94\u7528\u65f6\u6307\u5b9a\u4fdd\u5b58\u70b9\u7684\u4f4d\u7f6e\uff0c\u800c\u68c0\u67e5\u70b9\u662f\u7528\u4e8e\u6545\u969c\u6062\u590d\u7684\uff0c\u5176\u6062\u590d\u8fc7\u7a0b\u7531Flink\u81ea\u52a8\u8fdb\u884c\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u5f00\u542fcheckpoint\uff0c\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u914d\u7f6e\u5f00\u542fcheckpoint\uff0c\u4ee5\u53ca\u76f8\u5173\u7b56\u7565\uff1a Text Only<pre><code>// 1.\u5f00\u542f\u68c0\u67e5\u70b9\u914d\u7f6e\uff0c\u6bcf300ms\u89e6\u53d1\u4e00\u6b21\u4fdd\u5b58\nenv.enableCheckpointing(300);\n\n// 2.\u9ad8\u7ea7\u9009\u9879\n// checkpoint\u7684\u6a21\u5f0f\uff0cEXACTLY_ONCE \u6216 AT_LEAST_ONCE\nenv.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);\n// checkpoint\u7684\u4fdd\u5b58\u7684\u8d85\u65f6\u65f6\u95f4\nenv.getCheckpointConfig().setCheckpointTimeout(60000L);\n// \u6700\u591a\u540c\u65f6\u8fdb\u884c\u4e24\u4e2acheckpoint\u7684\u4fdd\u5b58\nenv.getCheckpointConfig().setMaxConcurrentCheckpoints(2);\n// \u524d\u4e00\u4e2acheckpoint\u4fdd\u5b58\u7ed3\u675f\u5230\u540e\u4e00\u4e2acheckpoint\u5f00\u59cb\u4e4b\u95f4\u7684\u6700\u5c0f\u95f4\u9694\u7684\u65f6\u95f4\uff0c\n// \u914d\u7f6e\u8fd9\u4e2a\u4e4b\u540e\u4f1a\u548c\u89e6\u53d1\u68c0\u67e5\u70b9\u4fdd\u5b58\u7684\u65f6\u95f4\u95f4\u9694\u5171\u540c\u51b3\u5b9a\u4e0b\u4e00\u6b21\u68c0\u67e5\u70b9\u7684\u5f00\u59cb\u65f6\u95f4\uff0c\u5373\u53d6\u4e8c\u8005\u4e2d\u7684\u5927\u8005\nenv.getCheckpointConfig().setMinPauseBetweenCheckpoints(100L);\n// \u503e\u5411\u4e8e\u4ece\u68c0\u67e5\u70b9\u4e2d\u6062\u590d\u5e94\u7528\uff0c\u800c\u4e0d\u662f\u4ece\u4fdd\u5b58\u70b9\uff0c\u8bbe\u7f6e\u4e3afalse\u4e4b\u540e\u4f1a\u9009\u4e8c\u8005\u4e2d\u66f4\u8fd1\u7684\u90a3\u4e00\u6b21\nenv.getCheckpointConfig().setPreferCheckpointForRecovery(true);\n// \u5141\u8bb8\u5bb9\u5fcdcheckpoint\u4fdd\u5b58\u5931\u8d25\u591a\u5c11\u6b21\nenv.getCheckpointConfig().setTolerableCheckpointFailureNumber(0);\n\n// 3. \u6545\u969c\u6062\u590d\u7684\u91cd\u542f\u7b56\u7565\n// \u4ea4\u7ed9\u8d44\u6e90\u7ba1\u7406\u5e73\u53f0\u5904\u7406\uff0c\u6bd4\u5982yarn\nenv.setRestartStrategy(RestartStrategies.fallBackRestart());\n// \u6700\u591a\u5c1d\u8bd5\u91cd\u542f3\u6b21\uff0c\u6bcf\u6b21\u91cd\u542f\u95f4\u969410s\uff0c3\u6b21\u4e4b\u5185\u91cd\u542f\u5931\u8d25\u5c31\u7b97\u4e86\nenv.setRestartStrategy(RestartStrategies.fixedDelayRestart(3, 10000L));\n// 10\u5206\u949f\u4e4b\u5185\u6700\u591a\u5c1d\u8bd5\u91cd\u542f3\u6b21\uff0c\u6bcf\u6b21\u91cd\u542f\u95f4\u96941\u5206\u949f\uff0c\u6700\u8981\u662f\u8003\u8651\u5230\u4e86\u91cd\u542f\u7684\u65f6\u95f4\u6d88\u8017\nenv.setRestartStrategy(RestartStrategies.failureRateRestart(3, Time.minutes(10), Time.minutes(1)));\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/21-%E7%8A%B6%E6%80%81%E4%B8%80%E8%87%B4%E6%80%A7/","title":"21-\u72b6\u6001\u4e00\u81f4\u6027","text":"<p> \u7ea6 864 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <p>\u72b6\u6001\u4e00\u81f4\u6027\u5e76\u4e0d\u662fFlink\u7279\u6709\u7684\u6982\u5ff5\uff0c\u5bf9\u4e8e\u5206\u5e03\u5f0f\u5e94\u7528\u800c\u8a00\uff0c\u4efb\u4f55\u4e00\u4e2a\u73af\u8282\u51fa\u73b0\u5f02\u5e38\u90fd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u7684\u91cd\u590d\u8ba1\u7b97\uff0c\u4ece\u800c\u9020\u6210\u7ed3\u679c\u9519\u8bef\u3002\u6bd4\u5982\u56e0\u4e3a\u7cfb\u7edf\u7684\u5361\u987f\u9020\u6210\u7528\u6237\u7684\u8bf7\u6c42\u88ab\u63d0\u4ea4\u4e86\u4e24\u6b21\uff0c\u90a3\u4e48\u5c31\u53ef\u80fd\u4f1a\u5411\u6570\u636e\u5e93\u4e2d\u63d2\u5165\u4e24\u6761\u91cd\u590d\u8bb0\u5f55\uff1b\u518d\u6bd4\u5982\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u751f\u4ea7\u8005\u53ef\u80fd\u4f1a\u91cd\u590d\u53d1\u9001\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u4e5f\u53ef\u80fd\u4f1a\u91cd\u590d\u6d88\u8d39\u6d88\u606f\uff0c\u8fd9\u90fd\u4f1a\u9020\u6210\u6570\u636e\u91cd\u590d\uff0c\u4ece\u800c\u5f15\u53d1\u7ed3\u679c\u9519\u8bef\u3002 \u4e00\u81f4\u6027\u53ef\u5206\u4e3a3\u4e2a\u7b49\u7ea7\uff1a</p> <ul> <li>at-most-once\uff1a\u6570\u636e\u6700\u591a\u88ab\u6d88\u8d39\u4e00\u6b21</li> <li>at-least-once\uff1a\u6570\u636e\u6700\u5c11\u6d88\u8d39\u4e00\u6b21</li> <li>exactly-once\uff1a\u6570\u636e\u6070\u597d\u88ab\u6d88\u8d39\u4e00\u6b21</li> </ul> <p>\u5bf9\u4e8eFlink\u800c\u8a00\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u91cd\u590d\u8ba1\u7b97\u7684\u56e0\u7d20\u5c31\u662f\u6545\u969c\u6062\u590d\uff0c\u56e0\u4e3aFlink\u7684source\u72b6\u6001\u6062\u590d\u540e\u4f1a\u4ece\u4e0a\u6b21\u4fdd\u5b58\u5728\u68c0\u67e5\u70b9\u4e2d\u7684\u504f\u79fb\u91cf\u5f00\u59cb\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff0c\u800cFlink\u7684checkpoint\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u5185\u90e8\u72b6\u6001\u7684exactly-once\uff0c\u4f46\u6574\u4e2a\u5904\u7406\u6d41\u7a0b\u7684\u4e00\u81f4\u6027\u7ea7\u4e0d\u5149\u53d6\u51b3\u4e8eFlink\u5185\u90e8\uff0c\u8fd8\u53d6\u51b3\u4e8eFlink\u7684source\u4e0esink\u8fde\u63a5\u7684\u5916\u90e8\u7cfb\u7edf\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u6574\u4e2a\u7cfb\u7edf\u7684\u4e00\u81f4\u6027\u7ea7\u522b\u53d6\u51b3\u4e8e\u6240\u6709\u7ec4\u4ef6\u4e2d\u4e00\u81f4\u6027\u6700\u5f31\u7684\u90a3\u4e00\u4e2a\uff0c\u8fd9\u4e5f\u88ab\u79f0\u4e3a\u7aef\u5230\u7aef\uff08end-to-end\uff09\u72b6\u6001\u4e00\u81f4\u6027\u3002 Flink source\u7aef\u4e00\u81f4\u6027\u7ea7\u522b\u53d6\u51b3\u4e8e\u5916\u90e8\u7cfb\u7edf\u53ef\u4e0d\u53ef\u4ee5\u91cd\u8bbe\u6570\u636e\u7684\u8bfb\u53d6\u4f4d\u7f6e\uff0c\u5982socket\u4e0d\u53ef\u4ee5\u91cd\u8bbe\u8bfb\u53d6\u4f4d\u7f6e\uff0c\u90a3\u4e48source\u7aef\u4e00\u81f4\u6027\u7ea7\u522b\u5c31\u662fat-most-once\uff0cKafka\u53ef\u4ee5\u8bbe\u7f6eoffset\uff0c\u90a3\u4e48source\u7aef\u5c31\u662fexactly-once\u3002</p> <p>\u8981\u4fdd\u8bc1sink\u7aef\u7684exactly-once\uff0c\u5c31\u9700\u8981\u4fdd\u8bc1\u4ece\u6545\u969c\u6062\u590d\u65f6\uff0c\u6570\u636e\u4e0d\u4f1a\u91cd\u590d\u5199\u5165\u5916\u90e8\u7cfb\u7edf\uff0c\u5177\u4f53\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff1a\u5e42\u7b49\uff08Idempotent\uff09\u5199\u5165\u548c\u4e8b\u52a1\u6027\uff08Transactional\uff09\u5199\u5165\u3002</p> <p>\u6240\u8c13\u5e42\u7b49\u5199\u5165\uff0c\u5c31\u662f\u6307\u5916\u90e8\u7cfb\u7edf\u5bf9\u4e8e\u91cd\u590d\u7684\u5199\u5165\u64cd\u4f5c\u53ea\u4f1a\u4fdd\u7559\u4e00\u6b21\u7ed3\u679c\u3002\u6bd4\u5982\u6570\u636e\u5e93\u7684\u552f\u4e00\u4e3b\u952e\u53ef\u4ee5\u963b\u6b62\u91cd\u590d\u7684\u63d2\u5165\u64cd\u4f5c\uff0cRedis\u7684setnx\u547d\u4ee4\u7684\u8bed\u4e49\u672c\u4e8b\u5c31\u5177\u6709\u5e42\u7b49\u6027\uff0c\u4f46\u662f\u5bf9\u4e8emap\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5728Flink\u6545\u969c\u6062\u590d\u4e4b\u540e\u7684\u91cd\u65b0\u8ba1\u7b97\u53ef\u80fd\u4f1a\u5f15\u8d77\u77ed\u6682\u5730\u7ed3\u679c\u56de\u9000\uff0c\u4f46\u662f\u6700\u7ec8\u8fd8\u662f\u53ef\u4ee5\u8fbe\u5230\u72b6\u6001\u4e00\u81f4\u6027\u3002</p> <p>\u4e8b\u52a1\u6027\u5199\u5165\u9700\u8981\u6784\u5efa\u4e8b\u52a1\u6765\u5199\u5165\u5916\u90e8\u7cfb\u7edf\uff0c\u5177\u6709\u4e8b\u52a1\u7684\u7279\u70b9\uff0c\u5373\u8981\u4e48\u5168\u90e8\u5199\u5165\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u4e0d\u4f1a\u91cd\u590d\u6570\u636e\u3002\u4e8b\u52a1\u7684\u5f00\u59cb\u5bf9\u5e94\u7740\u4fdd\u5b58checkpoint\u7684\u5f00\u59cb\uff0ccheckpoint\u771f\u6b63\u5b8c\u6210\u65f6\u4e8b\u52a1\u7ed3\u675f\uff0c\u8fd9\u65f6\u624d\u628a\u6240\u6709\u7ed3\u679c\u63d0\u4ea4\u5230sink\u6240\u8fde\u63a5\u7684\u5916\u90e8\u7cfb\u7edf\u4e2d\u3002 \u5bf9\u4e8e\u4e8b\u52a1\u6027\u5199\u5165\uff0c\u5177\u4f53\u53c8\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff1a\u9884\u5199\u65e5\u5fd7\uff08WAL\uff09\u548c\u4e24\u9636\u6bb5\u63d0\u4ea4\uff082PC\uff09\u3002DataStream API \u63d0\u4f9b\u4e86 GenericWriteAheadSink \u62bd\u8c61\u7c7b \u548c TwoPhaseCommitSinkFunction \u63a5\u53e3\uff0c\u7528\u6237\u53ea\u9700\u8981\u5b9e\u73b0\u6570\u636e\u5982\u4f55\u8f93\u51fa\uff0c\u5373\u53ef\u5f88\u65b9\u4fbf\u5730\u5b9e\u73b0\u8fd9\u4e24\u79cd\u4e8b\u52a1\u6027\u5199\u5165\u5916\u90e8\u7cfb\u7edf\u3002</p> <p>\u4e24\u9636\u6bb5\u63d0\u4ea4\uff082PC\uff09\u9700\u8981\u5916\u90e8\u7cfb\u7edf\u652f\u6301\u4e8b\u52a1\uff0c\u4e24\u9636\u6bb5\u63d0\u4ea4\uff082PC\uff09\u7684\u610f\u601d\u662f\uff0c\u5148\u5c06\u8fd9\u4e9b\u6570\u636e\u5199\u5165\u5916\u90e8 sink \u7cfb\u7edf\uff0c\u4f46\u4e0d\u63d0\u4ea4\u5b83\u4eec\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u9884\u63d0\u4ea4\uff0c \u5f53\u5b83\u6536\u5230 checkpoint \u5b8c\u6210\u7684\u901a\u77e5\u65f6\uff0c\u5b83\u624d\u6b63\u5f0f\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5b8c\u6210\u5199\u5165\u3002</p> <p>\u4e0d\u540c Source \u548c Sink \u7684\u4e00\u81f4\u6027\u4fdd\u8bc1\uff1a </p> <p>Kafka\u4f5c\u4e3asource\u652f\u6301offset\uff0c\u4f5c\u4e3asink\u652f\u6301\u4e8b\u52a1\uff0c\u6240\u4ee5Flink\u7684source\u548csink\u5747\u4e3aKafka\u65f6\u652f\u6301exactly-once\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/22-ProcessFunction%20API/","title":"22-ProcessFunction API","text":"<p> \u7ea6 1624 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 32 \u5206\u949f</p> <p>Flink\u63d0\u4f9b\u7684API\u7684\u62bd\u8c61\u5c42\u7ea7\u89c1\u4e0b\u56fe\uff0c\u8d8a\u5f80\u4e0b\u9650\u5236\u8d8a\u5c0f\uff0c\u4f7f\u7528\u8d8a\u7075\u6d3b\uff0c\u80fd\u5b9e\u73b0\u7684\u529f\u80fd\u8d8a\u591a\uff0c\u4f46\u7f16\u7a0b\u7684\u96be\u5ea6\u8d8a\u5927\u3002\u524d\u9762\u6240\u4f7f\u7528\u7684API\u5c5e\u4e8eFlink\u7684Core APIs\uff0c\u80fd\u5b9e\u73b0\u7edd\u5927\u591a\u6570\u9700\u6c42\uff0cFlink\u8fd8\u63d0\u4f9b\u66f4\u52a0\u5e95\u5c42\u7684API\uff0c\u5373Stateful Stream Processing\uff0c\u5b83\u5c31\u662f\u6bcf\u4e00\u79cd\u6d41\uff08DataStream\u3001KeyedStream\u7b49\uff09\u91cc\u9762\u63d0\u4f9b\u7684process()\u65b9\u6cd5\uff0cprocess()\u65b9\u6cd5\u90fd\u9700\u8981\u4f20\u4e00\u4e2a\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\uff0c\u8fd9\u4e9b\u62bd\u8c61\u7c7b\u7684\u540d\u5b57\u4e2d\u5e26\u6709ProcessFunction\uff0c\u6240\u4ee5\u4e5f\u79f0\u6700\u5e95\u5c42\u7684API\u4e3aProcessFunction API\uff0cFlink SQL \u5c31\u662f\u4f7f\u7528ProcessFunction \u5b9e\u73b0\u7684\u3002 </p> <p>Flink\u91cc\u6709\u5982\u4e0b8\u4e2aProcess Function\uff0c\u5b9e\u73b0\u7279\u5b9a\u9700\u6c42\u7684\u4e3b\u8981\u4efb\u52a1\u5c31\u662f\u7ed9\u5982\u4e0b\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\uff0c\u7136\u540e\u4f20\u7ed9\u5bf9\u5e94\u6d41\u7684process()\u65b9\u6cd5\u3002</p> <ul> <li>ProcessFunction</li> <li>KeyedProcessFunction</li> <li>CoProcessFunction</li> <li>ProcessJoinFunction</li> <li>BroadcastProcessFunction</li> <li>KeyedBroadcastProcessFunction</li> <li>ProcessWindowFunction</li> <li>ProcessAllWindowFunction</li> </ul> <p>ProcessFunction\u90fd\u7ee7\u627f\u81eaRichFunction\u63a5\u53e3\uff0c\u6240\u4ee5\u5b83\u80fd\u83b7\u53d6\u5230RuntimeContext\u3002\u4e0d\u6b62\u662fRuntimeContext\uff0cProcessFunction\u8fd8\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u7684watermark\u548cProcessingTime\u7b49\u4fe1\u606f\uff0c\u8fd8\u53ef\u8bbe\u7f6e\u5b9a\u65f6\u5668\uff0c\u4ee5\u53ca\u81ea\u7531\u7684\u5c06\u6570\u636e\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41\uff0c\u6240\u4ee5ProcessFunction\u529f\u80fd\u8981\u6bd4\u5bcc\u51fd\u6570\u7684\u63d0\u4f9b\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\u3002ProcessFunction\u5904\u7406\u6570\u636e\u7684\u8fc7\u7a0b\u7c7b\u4f3c\u4e8eflatMap\uff0c\u5373\u4e00\u6761\u6570\u636e\u7684\u8f93\u5165\u53ef\u4ee5\u6620\u5c04\u6210\u96f6\u6761\u3001\u4e00\u6761\u3001\u6216\u591a\u6761\u6570\u636e\u7684\u8f93\u51fa\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0env.socketTextStream(\"localhost\", 7777)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(new MapFunction&lt;String, Tuple3&lt;String, Long, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Tuple3&lt;String, Long, Integer&gt; map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple3&lt;&gt;(split[0], Long.parseLong(split[1]), Integer.parseInt(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor&lt;Tuple3&lt;String, Long, Integer&gt;&gt;(`Time.seconds(2)`) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractTimestamp(Tuple3&lt;String, Long, Integer&gt; element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.f1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(`new MyKeyedProcessFunction()`)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u4f7f\u7528ProcessFunction\u83b7\u53d6Keyed State\u3001watermark\u3001ProcessingTime \u548c \u8bbe\u7f6e\u5b9a\u65f6\u5668\u7684\u793a\u4f8b\u7a0b\u5e8f\u5982\u4e0b\u3002\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662fprocessElement()\u548conTimer()\u4e2d\u62ff\u5230\u7684watermark\u5e76\u4e0d\u76f8\u7b49\uff0c\u8fd9\u662f\u56e0\u4e3a\u6570\u636e\u6765\u4e86\u4e4b\u540e\u4f1a\u7acb\u5373\u5411\u4e0b\u6e38\u4f20\u9012\uff0c\u6b64\u65f6\u5728processElement()\u5904\u7406\u8be5\u6570\u636e\u65f6\u62ff\u5230\u7684watermark\u8fd8\u662f\u4e4b\u524d\u7684watermark\uff0c\u5e76\u4e0d\u662f\u57fa\u4e8e\u6b64\u6761\u6570\u636e\u7b97\u51fa\u6765\u7684watermark\uff1b\u4e4b\u540e\u751f\u6210watermark\u7684\u5468\u671f\u5230\u4e86\uff0c\u6b64\u65f6\u66f4\u65b0watermark\u5411\u4e0b\u6e38\u4f20\u9012\uff0c\u4e8e\u662f\u5b9a\u65f6\u5668\u89e6\u53d1\uff0c\u6240\u4ee5\u5728onTimer()\u4e2d\u62ff\u5230\u7684watermark\u4e00\u5b9a\u662f\u6700\u65b0\u7684\u3002\u6240\u4ee5\u4e0d\u80fd\u5728processElement()\u65b9\u6cd5\u4e2d\u901a\u8fc7\u5b9a\u65f6\u5668\u6709\u6ca1\u6709\u89e6\u53d1\u8fd9\u4e00\u6761\u4ef6\uff0c\u6765\u5224\u65ad\u672c\u6761\u6570\u636e\u4e0e\u4e0a\u4e00\u6761\u8bbe\u7f6e\u8be5\u5b9a\u65f6\u5668\u65f6\u5904\u7406\u7684\u6570\u636e\u4e4b\u95f4\u7684\u65f6\u95f4\u95f4\u9694\u6709\u6ca1\u6709\u8fbe\u5230\u5b9a\u65f6\u5668\u89e6\u53d1\u5ef6\u65f6\u3002 Text Only<pre><code>static class MyKeyedProcessFunction `extends KeyedProcessFunction`&lt;Tuple, Tuple3&lt;String, Long, Integer&gt;, String&gt; {\n\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Long&gt; tsTimerState;\n\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tsTimerState = getRuntimeContext().getState(new ValueStateDescriptor&lt;Long&gt;(\"ts-timer\", Long.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(Tuple3&lt;String, Long, Integer&gt; value, Context ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//getRuntimeContext()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// \u901a\u8fc7Context\u5bf9\u8c61\u62ff\u5230\u65f6\u95f4\u6233\uff0c\u8fd9\u4e2a\u503c\u5c31\u662f\u6570\u636e\u4e2d\u7684\u65f6\u95f4\u6233\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f20\u8fdb\u6765\u7684\u6570\u636evalue\u62ff\u5230\uff0c`\n `// \u4f7f\u7528ctx.timestamp()\u62ff\u5230\u65f6\u95f4\u6233\u7684\u8981\u6c42\u662f\u65f6\u95f4\u8bed\u4e49\u5f97\u662fEventTime\uff0c\u4e0d\u7136\u83b7\u53d6\u5230\u7684\u5c31\u662fnull`\n `Long ctxTimestamp = ctx.timestamp();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Tuple currentKey = ctx.getCurrentKey();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimerService timerService = ctx.timerService();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long processingTime = timerService.currentProcessingTime();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `// \u8fd9\u65f6\u62ff\u5230\u7684watermark\u5e76\u4e0d\u662f\u57fa\u4e8e\u8fd9\u6761\u6570\u636e\u751f\u6210\u7684watermark\uff0c`\n `// \u56e0\u4e3a\u6570\u636e\u6765\u7684\u65f6\u5019\u5e76\u4e0d\u4f1a\u7acb\u5373\u751f\u6210watermark\uff0c\u800c\u662f\u8981\u7b49\u5230\u751f\u6210watermark\u7684\u5468\u671f\u5230\u4e86\u4e4b\u540e\u624d\u4f1a\u751f\u6210\uff0c`\n `// \u4e5f\u5c31\u662f\u6570\u636e\u6765\u4e86\u4e4b\u540e\u4f1a\u7acb\u5373\u5411\u4e0b\u6e38\u4f20\u9012\uff0c\u800cwatermark\u9700\u8981\u7b49\u5f85\u5468\u671f\u5230\u4e86\u751f\u6210\u4e4b\u540e\u624d\u4f1a\u5411\u4e0b\u6e38\u4f20\u9012`\n `long watermark = timerService.currentWatermark();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(\"processingTime=\" + processingTime +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", currentKey=\" + currentKey +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", ctxTimestamp=\" + ctxTimestamp +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", watermark=\" + watermark);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5c06\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u653e\u5728\u952e\u63a7\u72b6\u6001\u4e2d\uff0c\u4ee5\u4fbf\u540e\u9762\u53ef\u4ee5\u53d6\u6d88\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tsTimerState.update(processingTime + 1000L); //\u5f53\u524dprocessingTime\u540e1s\u89e6\u53d1\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timerService.registerProcessingTimeTimer(tsTimerState.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6839\u636e\u5b9a\u65f6\u5668\u8bbe\u7f6e\u7684\u65f6\u95f4\u70b9\u53d6\u6d88\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//timerService.deleteProcessingTimeTimer(tsTimerState.value());\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0//\u5b9a\u65f6\u5668\u89e6\u53d1\u6240\u6267\u884c\u7684\u65b9\u6cd5\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//\u8fd9\u65f6\u5019\u62ff\u5230\u7684watermark\u624d\u662f\u6700\u65b0\u7684watermark\uff08\u57fa\u4e8e\u524d\u9762\u90a3\u6761\u6570\u636e\u7b97\u51fa\u6765\u7684watermark\uff09`\n `long watermark = ctx.timerService().currentWatermark();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeDomain timeDomain = ctx.timeDomain();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Tuple currentKey = ctx.getCurrentKey();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(\"\u5b9a\u65f6\u5668\u89e6\u53d1\" +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", timestamp=\" + timestamp +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", currentKey=\" + currentKey +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\",timeDomain=\" + timeDomain +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", watermark=\" + watermark);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tsTimerState.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0super.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f93\u5165\uff1a Text Only<pre><code>k1,1633947870000,1\nk1,1633947872000,1\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>processingTime=1634526697096, currentKey=(k1), ctxTimestamp=1633947870000, `watermark=-9223372036854775808`\n\u5b9a\u65f6\u5668\u89e6\u53d1, timestamp=1634526698096, currentKey=(k1),timeDomain=PROCESSING_TIME, `watermark=1633947868000`\nprocessingTime=1634526708474, currentKey=(k1), ctxTimestamp=1633947872000, `watermark=1633947868000`\n\u5b9a\u65f6\u5668\u89e6\u53d1, timestamp=1634526709474, currentKey=(k1),timeDomain=PROCESSING_TIME, `watermark=1633947870000`\n</code></pre></p> <p>\u4f7f\u7528ProcessFunction\u5b9e\u73b0\u5206\u6d41\u7684\u64cd\u4f5c\uff0c\u7c7b\u4f3c\u4e8eDataStream\u7684split \u548c select\uff0cDataStream\u7684split \u548c select\u5df2\u7ecf\u5f03\u7528\uff0c\u63a8\u8350\u4f7f\u7528ProcessFunction\u5b9e\u73b0\u5206\u6d41\uff0c\u5b9e\u73b0\u65b9\u5f0f\u662f\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41\u4e2d\u3002 \u4ee5a\u5f00\u5934\u7684\u6570\u636e\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41aStream\u4e2d\uff0c\u4ee5b\u5f00\u5934\u7684\u6570\u636e\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41bStream\u4e2d\uff0c\u5269\u4e0b\u7684\u4fdd\u7559\u5728\u4e3b\u6d41\u4e2d\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0OutputTag&lt;String&gt; aStreamTag = new OutputTag&lt;&gt;(\"a-stream\") {};\n\u00a0\u00a0\u00a0\u00a0OutputTag&lt;String&gt; bStreamTag = new OutputTag&lt;&gt;(\"b-stream\") {};\n\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;String&gt; mainStream = env.socketTextStream(\"localhost\", 7777)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new ProcessFunction&lt;String, String&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void processElement(String value, Context ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (value.startsWith(\"a\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(aStreamTag, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (value.startsWith(\"b\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(bStreamTag, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0mainStream.print(\"main-stream\");\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; aStream = mainStream.getSideOutput(aStreamTag);\n\u00a0\u00a0\u00a0\u00a0aStream.print(\"a-stream\");\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; bStream = mainStream.getSideOutput(bStreamTag);\n\u00a0\u00a0\u00a0\u00a0bStream.print(\"b-stream\");\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u5165\uff1a Text Only<pre><code>aaa\nbbb\nddd\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>a-stream&gt; aaa\nb-stream&gt; bbb\nmain-stream&gt; ddd\n</code></pre></p> <p>\u6848\u4f8b\uff1a\u76d1\u63a7\u6e29\u5ea6\u4f20\u611f\u5668\u7684\u6e29\u5ea6\u503c\uff0c\u5982\u679c\u6e29\u5ea6\u503c\u5728 10 \u79d2\u949f\u4e4b\u5185\u8fde\u7eed\u4e0a\u5347\uff0c \u5219\u62a5\u8b66\u3002 \u5206\u6790\uff1a\u4f7f\u7528\u6eda\u52a8\u7a97\u53e3\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u5982\u679c\u4f7f\u7528\u6ed1\u52a8\u7a97\u53e3\u90a3\u4e48\u9700\u8981\u5c06\u6ed1\u52a8\u6b65\u957f\u8bbe\u7f6e\u4e3a1ms\uff0c\u6548\u7387\u592a\u4f4e\uff0c\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u5b9a\u65f6\u5668\u5b8c\u6210\u8fd9\u4e2a\u9700\u6c42\uff0c10s\u7684\u65f6\u95f4\u8bed\u4e49\u65e2\u53ef\u4ee5\u662fEventTime\u4e5f\u53ef\u4ee5\u662fProcessingTime\u3002 Text Only<pre><code>// \u4f20\u611f\u5668\u7c7b\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\n@ToString\npublic class SensorReading {\n\u00a0\u00a0\u00a0\u00a0// \u5c5e\u6027\uff1aid\uff0c\u65f6\u95f4\u6233\uff0c\u6e29\u5ea6\u503c\n\u00a0\u00a0\u00a0\u00a0private String id;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n\u00a0\u00a0\u00a0\u00a0private Double temperature;\n}\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0env.socketTextStream(\"localhost\", 7777)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new SensorReading(fields[0], Long.parseLong(fields[1]), Double.parseDouble(fields[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(\"id\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new MyProcess())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> Text Only<pre><code>// \u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684ProcessFunction\u51fd\u6570\nstatic class MyProcess extends KeyedProcessFunction&lt;Tuple, SensorReading, String&gt; {\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Double&gt; temperatureState;\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Long&gt; timerState;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0temperatureState = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;(\"temperature-state\", Double.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timerState = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;(\"timer-state\", Long.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(SensorReading value, Context ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e0a\u4e00\u6b21\u7684\u6e29\u5ea6\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Double lastTemperature = temperatureState.value();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u73b0\u5728\u7684\u6e29\u5ea6\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Double nowTemperature = value.getTemperature();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u65e0\u8bba\u600e\u6837\u90fd\u8981\u628a\u672c\u6b21\u6e29\u5ea6\u8bb0\u5f55\u5230\u952e\u63a7\u72b6\u6001\u4e2d\uff0c\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u7684\u4e0a\u4e00\u6b21\u6e29\u5ea6\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0temperatureState.update(nowTemperature);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u662f\u7cfb\u7edf\u521a\u542f\u52a8\uff0c\u90a3\u4e48\u7b2c\u4e00\u6b21\u6ca1\u6709\u4e0a\u4e00\u6b21\u6e29\u5ea6\u503c\uff0c\u76f4\u63a5\u8fd4\u56de\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (lastTemperature == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0double diffTemperature = nowTemperature - lastTemperature;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u6e29\u5ea6\u4e0a\u5347\u4e86\u5e76\u4e14\u6ca1\u6709\u6ce8\u518c\u5b9a\u65f6\u5668\uff0c\u90a3\u4e48\u8868\u793a\u8fd9\u662f\u7b2c\u4e00\u6b21\u4e0a\u5347\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6240\u4ee5\u8981\u6ce8\u518c\u4ee5\u5f53\u524dProcessingTime\u4e3a\u8d77\u59cb\u768410s\u540e\u89e6\u53d1\u7684\u5b9a\u65f6\u5668\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c10s\u5185\u8be5\u5b9a\u65f6\u5668\u6ca1\u6709\u88ab\u5220\u9664\u5c31\u8868\u793a\u6e29\u5ea6\u8fde\u7eed7\u00a0 \u00a0 \u00a0 \u00a0 //\u5982\u679c\u8fd9\u65f6\u6e29\u5ea6\u4e0b\u964d\u4e86\uff0c\u5e76\u4e14\u8fd8\u6709\u5b9a\u65f6\u5668\uff0c\u5219\u8868\u793a\u8fd9\u662f10s\u5185\u7b2c\u4e00\u6b21\u4e0b\u964d\uff0c\u6240\u4ee5\u672c\u6b21\u9700\u8981\u5220\u9664\u5b9a\u65f6\u5668\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (diffTemperature &lt; 0 &amp;&amp; timerState.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().deleteProcessingTimeTimer(timerState.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timerState.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(ctx.getCurrentKey() + \"\u4f20\u611f\u5668\uff1a\" + timestamp + \" - \" + (timestamp + 10 * 1000L) + \"\u5185\u6e29\u5ea6\u8fde\u7eed\u4e0a\u5347\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timerState.clear();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timerState.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0temperatureState.clear();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f93\u5165\uff1a Text Only<pre><code>sensor_1,1633947870000,1\nsensor_1,1633947870000,2\nsensor_1,1633947870000,0\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(sensor_1)\u4f20\u611f\u5668\uff1a1634178742772 - 1634178752772\u5185\u6e29\u5ea6\u8fde\u7eed\u4e0a\u5347\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/23-%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%88%E7%BB%9F%E8%AE%A1%EF%BC%89%EF%BC%9A%E7%83%AD%E9%97%A8%E9%A1%B5%E9%9D%A2/","title":"23-\u6848\u4f8b\u4e00\uff08\u7edf\u8ba1\uff09\uff1a\u70ed\u95e8\u9875\u9762","text":"<p> \u7ea6 607 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u9700\u6c42\uff1a\u6bcf5s\u7edf\u8ba1\u4e00\u6b21\u6700\u8fd110\u5206\u949f\u7684\u70ed\u95e8\u9875\u9762\uff0c\u8981\u6c42\u5141\u8bb8\u6570\u636e\u8fdf\u52301\u5206\u949f\uff0c\u5bf9\u4e8e\u8fdf\u5230\u4e00\u5206\u949f\u4ee5\u4e0a\u7684\u6570\u636e\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41 \u6570\u636e\uff1a  pojo\uff1a \u65e5\u5fd7\uff1a Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class ApacheLogEvent {\n\u00a0\u00a0\u00a0\u00a0private String ip;\n\u00a0\u00a0\u00a0\u00a0private String userId;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n\u00a0\u00a0\u00a0\u00a0private String method;\n\u00a0\u00a0\u00a0\u00a0private String url;\n}\n</code></pre> \u4e2d\u95f4\u7ed3\u679c\uff1a Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class PageViewCount {\n\u00a0\u00a0\u00a0\u00a0private String url;\n\u00a0\u00a0\u00a0\u00a0private Long windowEnd;\n\u00a0\u00a0\u00a0\u00a0private Long count;\n}\n</code></pre></p> Text Only<pre><code>public class HotPages {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//DataStream&lt;String&gt; inputStream = env.readTextFile(\"Data/apache.log\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; inputStream = env.socketTextStream(\"localhost\", 7777);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataStream&lt;ApacheLogEvent&gt; dataStream = inputStream\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\" \");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SimpleDateFormat simpleDateFormat = new SimpleDateFormat(\"dd/MM/yyyy:HH:mm:ss\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Long timestamp = simpleDateFormat.parse(fields[3]).getTime();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ApacheLogEvent(fields[0], fields[1], timestamp, fields[5], fields[6]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;ApacheLogEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(ApacheLogEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fc7\u6ee4get\u8bf7\u6c42\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.filter(new FilterFunction&lt;ApacheLogEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean filter(ApacheLogEvent value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String regex = \"^((?!\\\\.(css|js|png|ico)$).)*$\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"GET\".equals(value.getMethod()) &amp;&amp; Pattern.matches(regex, value.getUrl());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// dataStream.print(\"data\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5b9a\u4e49\u4e00\u4e2a\u4fa7\u8f93\u51fa\u6d41\u6807\u7b7e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0OutputTag&lt;ApacheLogEvent&gt; lateTag = new OutputTag&lt;ApacheLogEvent&gt;(\"late\") {};\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;PageViewCount&gt; windowAggStream = dataStream\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6309\u7167url\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(ApacheLogEvent::getUrl)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6bcf5s\u7edf\u8ba1\u4e00\u6b21\u6700\u8fd110\u5206\u949f\u7684\u70ed\u95e8\u9875\u9762\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.timeWindow(Time.minutes(10), Time.seconds(5))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5141\u8bb8\u8fdf\u52301\u5206\u949f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.allowedLateness(Time.minutes(1))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fdf\u52301\u5206\u949f\u7684\u6570\u636e\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41\u4e2d\u53bb\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.sideOutputLateData(lateTag)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u805a\u5408\u5f97\u5230\u7a97\u53e3\u5185\u6bcf\u4e2a\u9875\u9762\u7684\u8bbf\u95ee\u91cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.aggregate(new PageCountAgg(), new PageCountResult());\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// windowAggStream.print(\"agg\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0windowAggStream.getSideOutput(lateTag).print(\"late\");\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6309\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\u805a\u5408\uff0c\u6392\u5e8f\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0windowAggStream.keyBy(PageViewCount::getWindowEnd)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new TopNHotPages(3))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.execute(\"hot pages job\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0static class PageCountAgg implements AggregateFunction&lt;ApacheLogEvent, Long, Long&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Long createAccumulator() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 0L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Long add(ApacheLogEvent value, Long accumulator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return ++accumulator;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Long getResult(Long accumulator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return accumulator;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Long merge(Long a, Long b) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0static class PageCountResult implements WindowFunction&lt;Long, PageViewCount, String, TimeWindow&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void apply(String key, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;PageViewCount&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new PageViewCount(key, window.getEnd(), input.iterator().next()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static class TopNHotPages extends KeyedProcessFunction&lt;Long, PageViewCount, String&gt; {\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private final Integer topSize;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public TopNHotPages(Integer topSize) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.topSize = topSize;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private MapState&lt;String, Long&gt; mapState;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mapState = getRuntimeContext().getMapState(new MapStateDescriptor&lt;String, Long&gt;(\"hot-pages-count\", String.class, Long.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void processElement(PageViewCount value, Context ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4f7f\u7528Map\u7ed3\u6784\u53ef\u4ee5\u5bf9\u8fdf\u5230\u6570\u636e\u66f4\u65b0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mapState.put(value.getUrl(), value.getCount());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7b49\u6570\u636e\u5230\u9f50\u4e4b\u540e\u89e6\u53d1\u5b9a\u65f6\u5668\u6392\u5e8f\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53ea\u5141\u8bb8\u7a97\u53e3\u5185\u7684\u6570\u636e\u8fdf\u5230\u4e00\u5206\u949f\uff0c\u4e00\u5206\u949f\u4e4b\u540e\u4e0d\u518d\u5bf9\u6b64\u7a97\u53e3\u7684\u6570\u636e\u805a\u5408\uff0c\u6240\u4ee5\u9700\u8981\u8bbe\u7f6e\u5b9a\u65f6\u5668\u6e05\u7406\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + 60 * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (timestamp == ctx.getCurrentKey() + 60 * 1000L) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0mapState.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6392\u5e8f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ArrayList&lt;Map.Entry&lt;String, Long&gt;&gt; arrayList = Lists.newArrayList(mapState.entries().iterator());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0arrayList.sort((a, b) -&gt; (int) (b.getValue() - a.getValue()));\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u53d6\u524d3\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StringBuilder resultBuilder = new StringBuilder();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resultBuilder.append(\"===================================\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resultBuilder.append(\"\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\uff1a\").append(new Timestamp(timestamp - 1)).append(\"\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; Math.min(topSize, arrayList.size()); i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Map.Entry&lt;String, Long&gt; entry = arrayList.get(i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resultBuilder.append(\"NO \").append(i + 1).append(\":\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.append(\" \u9875\u9762URL = \").append(entry.getKey())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.append(\" \u6d4f\u89c8\u91cf = \").append(entry.getValue())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.append(\"\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(resultBuilder.toString());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0resultBuilder.append(\"===============================\\n\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/24-%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%88%E7%BB%9F%E8%AE%A1%EF%BC%89%EF%BC%9A%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E5%BA%94%E7%94%A8/","title":"24-\u6848\u4f8b\u4e8c\uff08\u7edf\u8ba1\uff09\uff1a\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5e94\u7528","text":"<p> \u7ea6 1930 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 39 \u5206\u949f</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668 \u4e00\u5171\u670910\u4ebf\u6761\u4e0d\u540c\u7684\u6570\u636e\uff0c\u6bcf\u6761\u6570\u636e\u53604\u4e2a\u5b57\u8282\uff0c\u60f3\u8981\u7cbe\u786e\u5730\u5224\u65ad\u67d0\u4e00\u4e2a\u6570\u636e\u5728\u4e0d\u5728\u8fd9\u4e2a10\u4ebf\u6761\u6570\u636e\u4e2d\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u4e00\u662f\u628a10\u4ebf\u6761\u6570\u636e\u5168\u653e\u5728set\u4e2d\uff0c\u6b64\u65f6\u9700\u8981\u5360\u7528\u5185\u5b5840\u4ebf\u5b57\u8282\uff0c\u7ea6\u4e3a4GB\u3002 \u4e8c\u662f\u4f7f\u7528\u4f4d\u56fe\uff0c\u5c06\u6570\u636e\u6620\u5c04\u6210\u6570\u5b57\u4e4b\u540e\uff0c\u53d6\u503c\u8303\u56f4\u5927\u7ea6\u4e3a0-40\u4ebf\uff0c\u4f7f\u7528\u4e0e\u53d6\u503c\u8303\u56f4\u76f8\u540c\u7684bit\u4f4d\uff0c40\u4ebfbit\u4f4d\u4e3a512MB\uff0c\u5c31\u53ef\u4ee5\u7cbe\u786e\u5730\u8868\u8fbe40\u4ebf\u6761\u6570\u636e\u4e2d\u6709\u54ea10\u4ebf\u6761\u6570\u636e\uff0c\u537310\u4ebf\u6761\u6570\u636e\u5bf9\u5e94\u7684bit\u4f4d\u4e3a1\uff0c\u5176\u5b83\u4e3a0\u3002 \u53ef\u89c1\u7b2c\u4e00\u79cd\u65b9\u6cd5\u7684set\u96c6\u5408\u7684\u5927\u5c0f\u53ea\u4e0e\u6570\u636e\u7684\u4e2a\u6570\u6709\u5173\uff1b\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u7684\u4f4d\u56fe\u5927\u5c0f\u53ea\u4e0e\u6570\u636e\u7684\u53d6\u503c\u8303\u56f4\u6709\u5173\uff0c\u4e0e\u6570\u636e\u4e2a\u6570\u6ca1\u6709\u5173\u7cfb\u3002\u6240\u4ee5\u7b2c\u4e00\u79cd\u65b9\u6cd5\u9002\u5408\u5728\u5c0f\u91cf\u6570\u636e\u7684\u573a\u666f\u4e0b\u4f7f\u7528\uff0c\u800c\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u9002\u5408\u5927\u91cf\u6570\u636e\uff0c\u6bd4\u5982\u6570\u636e\u6620\u5c04\u6210\u6570\u5b57\u4e4b\u540e\uff0c\u53d6\u503c\u8303\u56f4\u4e3a0-40\u4ebf\uff0c\u4f46\u662f\u4e0d\u540c\u6570\u636e\u53ea\u6709100\u6761\uff0c\u8981\u5224\u65ad\u4e00\u4e2a\u6570\u636e\u5728\u4e0d\u5728\u8fd9\u4e2a100\u6761\u6570\u636e\u4e2d\uff0c\u90a3\u4e48\u80af\u5b9a\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u6cd5\u66f4\u5212\u7b97\u3002</p> <p>\u4f4d\u56fe\u7684\u5927\u5c0f\u53ea\u4e0e\u6570\u636e\u7684\u53d6\u503c\u8303\u56f4\u6709\u5173\uff0c\u5982\u679c\u60f3\u8981\u7cbe\u786e\u5730\u5224\u65ad\u67d0\u4e00\u4e2a\u6570\u636e\u5728\u4e0d\u5728\u6570\u636e\u96c6\u4e2d\uff0c\u5f53\u6570\u636e\u7684\u53d6\u503c\u8303\u56f4\u5f88\u5927\u65f6\uff0c\u4f4d\u56fe\u4e5f\u4f1a\u5f88\u5927\uff0c\u76f4\u63a5\u653e\u5728\u5185\u5b58\u8fd8\u662f\u5f88\u96be\u4ee5\u63a5\u6536\u3002\u5982\u679c\u6211\u4eec\u964d\u4f4e\u8fd9\u4e2a\u6807\u51c6\uff0c\u53ea\u8981\u8fd1\u4f3c\u5730\u5224\u65ad\u4e00\u4e2a\u6570\u636e\u5728\u4e0d\u5728\u6570\u636e\u96c6\u4e2d\uff0c\u90a3\u4e48\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u65b9\u6cd5\u5c31\u4f1a\u5927\u5927\u51cf\u5c11\u4f4d\u56fe\u7684\u5927\u5c0f\u3002 \u5e03\u9686\u8fc7\u6ee4\u5668\u5c31\u662f\u7528\u5c0f\u4f4d\u56fe\u8868\u793a\u5927\u53d6\u503c\u8303\u56f4\u65f6\uff0c\u8fd1\u4f3c\u51c6\u786e\u5730\u5224\u65ad\u4e00\u6761\u6570\u636e\u5728\u4e0d\u5728\u6570\u636e\u96c6\u7684\u4e00\u79cd\u7b97\u6cd5\u3002\u6bd4\u5982\u53d6\u503c\u8303\u56f4\u4e3a0-40\u4ebf\uff0c\u5982\u679c\u60f3\u51c6\u786e\u5730\u5224\u65ad\u4e00\u4e2a\u6570\u5728\u4e0d\u5728\u6570\u636e\u96c6\u4e2d\uff0c\u5c31\u9700\u8981512MB\u5927\u5c0f\u7684\u4f4d\u56fe\uff0c\u4f46\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u7b97\u53ef\u80fd\u53ea\u9700\u898116MB\u5927\u5c0f\u7684\u4f4d\u56fe\u5c31\u53ef\u4ee5\u767e\u5206\u4e4b\u767e\u7684\u544a\u8bc9\u4f60\u8fd9\u6761\u6570\u636e\u4e0d\u5728\u6570\u636e\u96c6\u4e2d\uff0c\u548c\u4ee5\u767e\u5206\u4e4b\u4e5d\u5341\u51e0\u7684\u6982\u7387\u544a\u8bc9\u4f60\u8fd9\u6761\u6570\u636e\u53ef\u80fd\u5728\u6570\u636e\u96c6\u4e2d\uff0c\u5373\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u53ef\u4ee5\u544a\u8bc9\u67d0\u6761\u6570\u636e\u4e00\u5b9a\u4e0d\u5b58\u5728\u6216\u8005\u67d0\u6761\u6570\u636e\u53ef\u80fd\u5b58\u5728\u3002\u6bd4\u5982\u628a\u8fd910\u4ebf\u6761\u6570\u636e\u6620\u5c04\u5230\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u4f4d\u56fe\u4e0a\u540e\uff0c\u8fd910\u4ebf\u6761\u6570\u636e\u7684\u6bcf\u4e00\u6761\u6570\u636e\u901a\u8fc7\u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65ad\uff0c\u90fd\u4e0d\u80fd\u767e\u5206\u4e4b\u767e\u544a\u8bc9\u4f60\u8fd9\u6761\u6570\u636e\u572810\u4ebf\u6761\u6570\u636e\u4e2d\uff0c\u5269\u4e0b30\u4ebf\u6761\u6570\u636e\u6709\u767e\u5206\u4e4b\u4e5d\u5341\u7684\u6570\u636e\u6570\u636e\u901a\u8fc7\u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65ad\u662f\u53ef\u4ee5\u544a\u8bc9\u4f60\u8fd9\u6761\u6570\u636e\u4e00\u5b9a\u4e0d\u572810\u4ebf\u6761\u6570\u636e\u4e2d\uff0c\u800c\u5269\u4e0b\u767e\u5206\u4e4b\u5341\u4f1a\u544a\u8bc9\u4f60\u8fd9\u6761\u6570\u636e\u53ef\u80fd\u572810\u4ebf\u6761\u6570\u636e\u4e2d\u3002</p> <p>\u51c6\u786e\u5730\u8fdb\u884c\u5224\u65ad\u9700\u8981\u5c06\u6240\u6709\u53ef\u80fd\u7684\u6570\u636e\u6620\u5c04\u4e0d\u540c\u6570\u5b57\uff0c\u8fd9\u662f\u4e00\u79cd\u5168\u91cf\u7684\u4e00 \u4e00\u5bf9\u5e94\u5173\u7cfb\uff0c\u800c\u5e03\u9686\u8fc7\u6ee4\u5668\u4e0d\u80fd\u51c6\u786e\u5730\u8fdb\u884c\u5224\u65ad\u5c31\u662f\u56e0\u4e3a\u5b83\u6ca1\u6709\u8fdb\u884c\u5168\u91cf\u7684\u6620\u5c04\uff0c\u5176\u505a\u6cd5\u5c31\u662f\u4f7f\u7528\u591a\u4e2a\u54c8\u5e0c\u51fd\u6570\u5bf9\u6570\u636e\u6620\u5c04\uff0c\u4e8e\u662f\u53ef\u80fd\u51fa\u73b0\u4e0d\u540c\u7684\u6570\u636e\u6620\u5c04\u5230\u76f8\u540c\u7684\u6570\u5b57\u4e0a\uff0c\u4f46\u6b63\u662f\u56e0\u4e3a\u4f7f\u7528\u591a\u4e2a\u597d\u7684\u54c8\u5e0c\u51fd\u6570\u624d\u4f7f\u5f97\u8bef\u5224\u7387\u80fd\u5927\u5927\u964d\u4f4e\u3002\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5177\u4f53\u7b97\u6cd5\u8fc7\u7a0b\u8bf7\u53c2\u8003\uff1ahttps://zhuanlan.zhihu.com/p/43263751</p> <p>\u56e0\u4e3a\u4ece\u4f4d\u56fe\u4e2d\u6211\u4eec\u8fd8\u53ef\u4ee5\u77e5\u9053\u5b83\u5305\u542b\u4e86\u591a\u5c11\u6761\u4e0d\u540c\u6570\u636e\uff0c\u6240\u4ee5\u5efa\u6784\u4f4d\u56fe\u4e0d\u5149\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u6570\u636e\u5728\u4e0d\u5728\u6570\u636e\u96c6\u4e2d\uff0c\u8fd8\u6c42\u6709\u91cd\u590d\u6570\u636e\u7684\u6570\u636e\u96c6\u5305\u542b\u591a\u5c11\u6761\u4e0d\u76f8\u540c\u7684\u6570\u636e\u3002\u4e5f\u5c31\u662f\u8bf4\u901a\u8fc7\u6784\u5efa\u4e0e\u53d6\u503c\u8303\u56f4\u76f8\u540c\u7684\u4f4d\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u7cbe\u786e\u5730\u77e5\u9053\u6570\u636e\u96c6\u4e2d\u6709\u591a\u5c11\u6761\u4e0d\u540c\u7684\u6570\u636e\uff0c\u6216\u8005\u6784\u5efa\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u8fd1\u4f3c\u5730\u77e5\u9053\u6709\u591a\u5c11\u6761\u4e0d\u540c\u7684\u6570\u636e\u3002 \u6848\u4f8b\u4e8c\uff1a\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u8fd1\u4f3c\u5730\u7edf\u8ba1\u4e00\u4e2a\u5c0f\u65f6\u5185\u6709\u591a\u5c11\u4e0d\u540c\u7684\u7528\u6237\u8bbf\u95ee\u8fc7 \u6570\u636e\uff1a </p> <p>Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0//\u5e76\u884c\u5ea6\u4e3a4\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(4);\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.readTextFile(\"Data/UserBehavior.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6570\u636e\u6e90\u4f1a\u5c06\u6570\u636e\u8f6e\u8be2\u5730\u53d1\u9001\u5230\u6bcf\u4e00\u4e2amap\u5b50\u4efb\u52a1\uff0c\u56e0\u4e3a\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e0d\u540c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.flatMap(new RichFlatMapFunction&lt;String, Tuple3&lt;Integer, String, Long&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private int key;\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5206\u7ec4key\u7b49\u4e8e\u5f53\u524d\u5b50\u4efb\u52a1\u7f16\u53f7\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u4e0b\u6b21keyBy\u5206\u7ec4\u4e0d\u7528\u5728\u4e0d\u540c\u5b50\u4efb\u52a1\u4e4b\u95f4\u53d1\u9001\u6570\u636e\uff0c\u5206\u7ec4\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u80fd\u5e76\u884c\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0key = getRuntimeContext().getIndexOfThisSubtask();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void flatMap(String value, Collector&lt;Tuple3&lt;Integer, String, Long&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53ea\u7edf\u8ba1pv\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"pv\".equals(fields[3])) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//(\u5206\u7ec4key, userId, \u65f6\u95f4\u6233)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple3&lt;&gt;(key, fields[0], Long.valueOf(fields[4])));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5206\u914dwatermark\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;Tuple3&lt;Integer, String, Long&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(Tuple3&lt;Integer, String, Long&gt; element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.f2 * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u4e0a\u9762\u6307\u5b9a\u7684key\u5206\u7ec4\uff0c\u6570\u636e\u5e76\u4e0d\u9700\u8981\u5728\u4e0d\u540c\u7684slot\u95f4\u4f20\u9012\uff0c\u56e0\u4e3a\u6bcf\u4e2aslot\u4e2d\u7684\u6570\u636e\u7684key\u5c31\u662fslot\u7684\u7f16\u53f7\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(v -&gt; v.f0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e00\u4e2a\u5c0f\u65f6\u7684\u6eda\u52a8\u7a97\u53e3\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.timeWindow(Time.hours(1))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u805a\u5408\uff0c\u7edf\u8ba1\u4e00\u4e2a\u5c0f\u65f6\u5185\u4e0d\u540c\u7528\u6237\u7684\u6570\u91cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.aggregate(new UVAggregateFunction(), new UVWindowFunction())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u7a97\u53e3\u5206\u7ec4\uff0c\u8fd9\u91cc\u662f\u4e3a\u4e86\u628a\u524d\u9762\u4e0d\u540c\u5b50\u4efb\u52a1\u4e0a\u76f8\u540c\u7684\u7a97\u53e3\u4e2d\u6570\u636e\u6c47\u805a\u5230\u4e00\u4e2aslot\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(v -&gt; v.f0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u628a\u76f8\u540c\u7a97\u53e3\u7edf\u8ba1\u7684\u6570\u636e\u7d2f\u52a0\u5c31\u5f97\u5230\u4e86\u6700\u540e\u8be5\u7a97\u53e3\u7684\u7ed3\u679c\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new UVKeyedProcessFunction())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute(\"UniqueVisitor count with bloom filter job\");\n}\n</code></pre> Text Only<pre><code>private static class UVAggregateFunction implements AggregateFunction&lt;Tuple3&lt;Integer, String, Long&gt;, Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt;, Integer&gt; {\n\u00a0\u00a0\u00a0\u00a0// \u5fc5\u987b\u5728createAccumulator\u65b9\u6cd5\u91cc\u521b\u5efa\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u56e0\u4e3a\u4e00\u4e2a\u5206\u7ec4\u524d\u540e\u4e0d\u540c\u7684\u7a97\u53e3\u9700\u8981\u5404\u81ea\u7edf\u8ba1\u5404\u81ea\u7684\uff0c\n\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u4f5c\u4e3a\u7c7b\u7684\u5b57\u6bb5\uff0c\u5c31\u5c5e\u4e8e\u7b97\u5b50\u72b6\u6001\u4e86\uff0c\u6240\u6709\u8be5\u5b50\u4efb\u52a1\u4e0a\u7684\u5206\u7ec4\u5171\u7528\uff0c\u4e00\u4e2a\u5206\u7ec4\u524d\u540e\u4e0d\u540c\u7684\u7a97\u53e3\u4e5f\u5171\u7528\uff0c\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; createAccumulator() {\n\u00a0\u00a0 \u00a0\u00a0 \u00a0 //\u00a0org.apache.flink.shaded.guava18.com.google.common.hash.BloomFilter\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521d\u59cb\u5316\u4e00\u4e2a\u5b58\u50a8string\u6570\u636e\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u9884\u8ba1\u4f1a\u63d2\u5165\u4e00\u767e\u4e07\u6761\u4e0d\u540c\u7684\u6570\u636e\uff0c\u671f\u671b\u9519\u8bef\u7387\u4e3a0.1%\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0d\u7528\u8003\u8651\u6570\u636e\u7684\u53d6\u503c\u8303\u56f4\u662f\u591a\u5c11\uff0c\u53ea\u8981\u6307\u51fa\u9884\u8ba1\u4f1a\u63d2\u5165\u591a\u5c11\u6761\u4e0d\u540c\u7684\u6570\u636e \u548c \u671f\u671b\u7684\u9519\u8bef\u7387\u5373\u53ef\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5bf9\u4e8e\u7528\u4e8e\u6784\u5efa\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u90a3\u4e00\u767e\u4e07\u6761\u6570\u636e\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u4e0d\u786e\u5b9a\u5b83\u4eec\u5728\u4e0d\u5728\uff0cmightContain\u8fd4\u56detrue\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5bf9\u4e8e\u4e0d\u662f\u90a3\u4e00\u767e\u4e07\u6761\u6784\u5efa\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u6570\u636e\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5176\u4e2d99.9%\u7684\u6570\u636e\u5e03\u9686\u8fc7\u6ee4\u5668\u4f1a\u80af\u5b9a\u5b83\u4eec\u4e0d\u5728\uff0c\u5373mightContain()\u65b9\u6cd5\u4f1a\u8fd4\u56defalse\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5269\u4e0b0.1%\u7684\u6570\u636e\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u4e0d\u786e\u5b9a\u5b83\u4eec\u5728\u4e0d\u5728\uff0cmightContain\u8fd4\u56detrue\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BloomFilter&lt;String&gt; bloomFilter = BloomFilter.create(Funnels.stringFunnel(Charsets.UTF_8), 1_000_000, 0.001);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new Tuple2&lt;&gt;(bloomFilter, 0);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; add(Tuple3&lt;Integer, String, Long&gt; value, Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; accumulator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BloomFilter&lt;String&gt; bloomFilter = accumulator.f0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!bloomFilter.mightContain(value.f1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0bloomFilter.put(value.f1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0accumulator.f1++;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return accumulator;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer getResult(Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; accumulator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return accumulator.f1;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; merge(Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; a, Tuple2&lt;BloomFilter&lt;String&gt;, Integer&gt; b) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>private static class UVWindowFunction implements WindowFunction&lt;Integer, Tuple2&lt;Long, Integer&gt;, Integer, TimeWindow&gt; {\n\u00a0\u00a0\u00a0\u00a0//\u5c31\u662f\u4e3a\u4e86\u628a\u524d\u9762\u7684\u7ed3\u679c\u52a0\u4e0a\u4e00\u4e2a\u7a97\u53e3\u7ed3\u675f\u65f6\u95f4\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void apply(Integer key, TimeWindow window, Iterable&lt;Integer&gt; input, Collector&lt;Tuple2&lt;Long, Integer&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple2&lt;&gt;(window.getEnd(), input.iterator().next()));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>private static class UVKeyedProcessFunction extends KeyedProcessFunction&lt;Long, Tuple2&lt;Long, Integer&gt;, String&gt; {\n\n\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Integer&gt; uv;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uv = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;(\"uv\", Integer.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(Tuple2&lt;Long, Integer&gt; value, Context ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u628a\u524d\u9762\u6240\u6709\u5e76\u884c\u4efb\u52a1\u8ba1\u7b97\u7684\u76f8\u540c\u65f6\u95f4\u7684\u7a97\u53e3\u7684\u7ed3\u679c\u7d2f\u52a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (uv.value() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uv.update(value.f1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uv.update(uv.value() + value.f1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u4e00\u4e2a1ms\u7684\u5b9a\u65f6\u5668\u662f\u4e3a\u4e86\u7b49\u5230\u524d\u9762\u76f8\u540c\u7a97\u53e3\u7684\u6240\u6709\u6570\u636e\u90fd\u5230\u9f50\uff0c\u4e3a\u4ec0\u4e48\u80fd\u7b49\u5230\uff0c\u56e0\u4e3a\u65f6\u95f4\u8bed\u4e49\u662fEventTime\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(ctx.getCurrentKey() + 1);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;String&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5b9a\u65f6\u5668\u89e6\u53d1\u5c31\u6253\u5370\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(ctx.getCurrentKey() + \": \" + uv.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5e76\u6e05\u7a7a\u952e\u63a7\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0uv.clear();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u53c2\u8003\uff1a \u8be6\u89e3\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u539f\u7406\uff0c\u4f7f\u7528\u573a\u666f\u548c\u6ce8\u610f\u4e8b\u9879 - \u77e5\u4e4e</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/25-%E6%A1%88%E4%BE%8B%E4%B8%89%EF%BC%88%E9%A3%8E%E6%8E%A7%EF%BC%89%EF%BC%9A%E6%A3%80%E6%B5%8B%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E4%BA%8B%E4%BB%B6/","title":"25-\u6848\u4f8b\u4e09\uff08\u98ce\u63a7\uff09\uff1a\u68c0\u6d4b\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6","text":"<p> \u7ea6 1291 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 26 \u5206\u949f</p> <p>\u9700\u6c42\uff1a\u68c0\u6d4b2\u79d2\u5185\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u8d85\u8fc72\u6b21\u7684\u4e8b\u4ef6 \u65f6\u95f4\u6233\u4e0d\u5b58\u5728\u4e71\u5e8f\u7684\u6570\u636e\uff1a Text Only<pre><code>1035,83.149.9.216,fail,1558430842\n1035,83.149.9.216,fail,1558430843\n1035,83.149.24.26,fail,1558430844\n</code></pre>  pojo: \u767b\u5f55\u4e8b\u4ef6 Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class LoginEvent {\n\u00a0\u00a0\u00a0\u00a0private Long userId;\n\u00a0\u00a0\u00a0\u00a0private String ip;\n\u00a0\u00a0\u00a0\u00a0private String loginState;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class LoginFailWarning {\n\u00a0\u00a0\u00a0\u00a0private Long userId;\n\u00a0\u00a0\u00a0\u00a0private Long firstFailTime;\n\u00a0\u00a0\u00a0\u00a0private Long lastFailTime;\n\u00a0\u00a0\u00a0\u00a0private String warningMsg;\n}\n</code></pre></p> <p>\u505a\u6cd5\u4e00\uff1a\u65f6\u95f4\u8bed\u4e49\u4e3aEventTime\u76842s\u5b9a\u65f6\u5668\uff0c\u5728\u5b9a\u65f6\u5668\u5185\u6e05\u7a7a\u72b6\u6001 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.readTextFile(\"Data/LoginLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new LoginEvent(Long.valueOf(fields[0]), fields[1], fields[2], Long.valueOf(fields[3]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new AscendingTimestampExtractor&lt;LoginEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(LoginEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u7528\u6237id\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(LoginEvent::getUserId)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u68c0\u6d4b\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new LoginFailDetectWarning(2, 2))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute(\"login fail detect job\");\n}\n</code></pre> Text Only<pre><code>private static class LoginFailDetectWarning extends KeyedProcessFunction&lt;Long, LoginEvent, LoginFailWarning&gt; {\n\u00a0\u00a0\u00a0\u00a0// \u591a\u5c11\u79d2\u5185\n\u00a0\u00a0\u00a0\u00a0private final int timeInterval;\n\u00a0\u00a0\u00a0\u00a0// \u6700\u5927\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0private final int maxFailTimes;\n\n\u00a0\u00a0\u00a0\u00a0public LoginFailDetectWarning(int timeInterval, int maxFailTimes) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.timeInterval = timeInterval;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.maxFailTimes = maxFailTimes;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// timeInterval\u79d2\u540e\u89e6\u53d1\u7684\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Long&gt; onTimer;\n\u00a0\u00a0\u00a0\u00a0// timeInterval\u79d2\u5185\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Integer&gt; failCount;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer = getRuntimeContext().getState(new ValueStateDescriptor&lt;Long&gt;(\"onTimer\", Long.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount = getRuntimeContext().getState(new ValueStateDescriptor&lt;Integer&gt;(\"login-fail-count\", Integer.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(LoginEvent value, Context ctx, Collector&lt;LoginFailWarning&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u767b\u5f55\u5931\u8d25\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"fail\".equals(value.getLoginState())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u7b2c\u4e00\u6b21\u767b\u5f55 \u6216\u8005 \u5b9a\u65f6\u5668\u89e6\u53d1\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (onTimer.value() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.update(ctx.timestamp() + timeInterval * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(onTimer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(failCount.value() + 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u767b\u5f55\u6210\u529f\uff0c\u5220\u9664\u5b9a\u65f6\u5668\uff0c\u6e05\u7a7a\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (onTimer.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().deleteEventTimeTimer(onTimer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;LoginFailWarning&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u767b\u5f55\u5931\u8d25\u6b21\u6570\u5927\u4e8e\u6700\u5927\u5141\u8bb8\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (failCount.value() &gt;= maxFailTimes) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8f93\u51fa\u62a5\u8b66\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new LoginFailWarning(ctx.getCurrentKey(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timestamp / 1000L - timeInterval,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timestamp / 1000L,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"\u8fde\u7eed\" + failCount.value() + \"\u6b21\u767b\u5f55\u5931\u8d25\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6e05\u7a7a\u72b6\u6001\u91cd\u65b0\u8ba1\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>LoginFailWarning(userId=1035, firstFailTime=1558430842, lastFailTime=1558430844000, warningMsg=\u8fde\u7eed3\u6b21\u767b\u5f55\u5931\u8d25)\n</code></pre></p> <p>\u505a\u6cd5\u4e8c\uff1a\u505a\u6cd5\u4e00\u5728\u5b9a\u65f6\u5668\u5185\u6e05\u7a7a\u72b6\u6001\u4f1a\u5bfc\u81f4\u53ef\u4ee52s\u5185\u5c1d\u8bd5\u767b\u5f55\u5c3d\u53ef\u80fd\u591a\u7684\u6b21\u6570\uff0c\u53ea\u8981\u6709\u4e00\u6b21\u6210\u529f\u5c31\u884c\u4e86\uff0c\u8fd9\u5e76\u4e0d\u7b26\u5408\u5b89\u5168\u8981\u6c42\u3002\u5982\u679c\u5728\u5904\u7406\u6bcf\u6761\u6570\u636e\u65f6\u68c0\u6d4b\u5931\u8d25\u6b21\u6570\u662f\u5426\u5927\u4e8e2\u6b21\uff0c\u5728\u5b9a\u65f6\u5668\u4e2d\u6e05\u9664\u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u9650\u52362s\u5185\u6700\u591a\u8fde\u7eed\u5931\u8d252\u6b21\u3002 \u4e3b\u7a0b\u5e8f\u4e0d\u53d8\uff1a Text Only<pre><code>private static class LoginFailDetectWarning extends KeyedProcessFunction&lt;Long, LoginEvent, LoginFailWarning&gt; {\n\u00a0\u00a0\u00a0\u00a0// \u591a\u5c11\u79d2\u5185\n\u00a0\u00a0\u00a0\u00a0private final int timeInterval;\n\u00a0\u00a0\u00a0\u00a0// \u6700\u5927\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0private final int maxFailTimes;\n\n\u00a0\u00a0\u00a0\u00a0public LoginFailDetectWarning(int timeInterval, int maxFailTimes) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.timeInterval = timeInterval;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.maxFailTimes = maxFailTimes;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// timeInterval\u79d2\u540e\u89e6\u53d1\u7684\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Long&gt; onTimer;\n\u00a0\u00a0\u00a0\u00a0// timeInterval\u79d2\u5185\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Integer&gt; failCount;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer = getRuntimeContext().getState(new ValueStateDescriptor&lt;Long&gt;(\"onTimer\", Long.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount = getRuntimeContext().getState(new ValueStateDescriptor&lt;Integer&gt;(\"login-fail-count\", Integer.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(LoginEvent value, Context ctx, Collector&lt;LoginFailWarning&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u767b\u5f55\u5931\u8d25\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"fail\".equals(value.getLoginState())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u7b2c\u4e00\u6b21\u767b\u5f55 \u6216\u8005 \u5b9a\u65f6\u5668\u89e6\u53d1\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (onTimer.value() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.update(ctx.timestamp() + timeInterval * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(onTimer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(failCount.value() + 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u52a01\u540e\u5982\u679c\u767b\u5f55\u6b21\u6570\u8fbe\u5230\u6700\u5927\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (failCount.value() &gt;= maxFailTimes) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8f93\u51fa\u62a5\u8b66\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new LoginFailWarning(value.getUserId(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.value() / 1000L - timeInterval,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0value.getTimestamp(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"\u8fde\u7eed\" + maxFailTimes + \"\u6b21\u767b\u5f55\u5931\u8d25\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/*\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8f93\u51fa\u62a5\u8b66\u540e\uff0c\u5982\u679c\u60f3\u91cd\u65b0\u5f00\u59cb\u8ba1\u6570\u5c31\u4e0d\u6ce8\u91ca\u8fd9\u4e24\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u767b\u5f55\u6210\u529f\uff0c\u5220\u9664\u5b9a\u65f6\u5668\uff0c\u6e05\u7a7a\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (onTimer.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().deleteEventTimeTimer(onTimer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, KeyedProcessFunction&lt;Long, LoginEvent, LoginFailWarning&gt;.OnTimerContext ctx, Collector&lt;LoginFailWarning&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u5b9a\u65f6\u5668\u89e6\u53d1\uff0c\u6e05\u7a7a\u72b6\u6001\u91cd\u65b0\u8ba1\u6570`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>LoginFailWarning(userId=1035, firstFailTime=1558430842, lastFailTime=1558430843, warningMsg=\u8fde\u7eed2\u6b21\u767b\u5f55\u5931\u8d25)\nLoginFailWarning(userId=1035, firstFailTime=1558430842, lastFailTime=1558430844, warningMsg=\u8fde\u7eed2\u6b21\u767b\u5f55\u5931\u8d25)\n</code></pre></p> <p>\u505a\u6cd5\u4e09\uff1a\u4e0d\u4f7f\u7528\u5b9a\u65f6\u5668\uff0c\u952e\u63a7\u72b6\u6001\u4e2d\u8bb0\u5f55\u7b2c\u4e00\u6b21\u5931\u8d25\u7684\u6570\u636e\uff0c\u7136\u540e\u53ea\u8981\u518d\u6765\u4e00\u6b21\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\u5c31\u5224\u65ad\u4e0e\u7b2c\u4e00\u6b21\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\u4e4b\u95f4\u7684\u65f6\u95f4\u95f4\u9694\u662f\u5426\u5927\u4e8e2s\uff0c\u5e76\u4e14\u5224\u65ad\u52a0\u4e0a\u672c\u6b21\u767b\u5f55\u5931\u8d25\u662f\u5426\u5931\u8d25\u6b21\u6570\u5df2\u7ecf\u5230\u8fbe2\u6b21\uff1a \u6b64\u505a\u6cd5\u5e76\u4e0d\u9700\u8981watermark\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.readTextFile(\"Data/LoginLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new LoginEvent(Long.valueOf(fields[0]), fields[1], fields[2], Long.valueOf(fields[3]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(LoginEvent::getUserId)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u68c0\u6d4b\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new LoginFailDetectWarning(2, 2))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0\u00a0\u00a0\u00a0env.execute(\"login fail detect job\");\n}\n</code></pre> Text Only<pre><code>private static class LoginFailDetectWarning extends KeyedProcessFunction&lt;Long, LoginEvent, LoginFailWarning&gt; {\n\u00a0\u00a0\u00a0\u00a0// \u591a\u5c11\u79d2\u5185\n\u00a0\u00a0\u00a0\u00a0private final int timeInterval;\n\u00a0\u00a0\u00a0\u00a0// \u6700\u5927\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0private final int maxFailTimes;\n\n\u00a0\u00a0\u00a0\u00a0public LoginFailDetectWarning(int timeInterval, int maxFailTimes) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.timeInterval = timeInterval;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.maxFailTimes = maxFailTimes;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// timeInterval\u79d2\u5185\u7b2c\u4e00\u6b21\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;LoginEvent&gt; firstLoginFailEvent;\n\u00a0\u00a0\u00a0\u00a0// timeInterval\u79d2\u5185\u767b\u5f55\u5931\u8d25\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0ValueState&lt;Integer&gt; failCount;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0firstLoginFailEvent = getRuntimeContext().getState(new ValueStateDescriptor&lt;LoginEvent&gt;(\"first-Login-fail-event\", LoginEvent.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount = getRuntimeContext().getState(new ValueStateDescriptor&lt;Integer&gt;(\"login-fail-count\", Integer.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0// \u4ee5\u767b\u5f55\u4e8b\u4ef6\u4f5c\u4e3a\u5224\u65ad\u62a5\u8b66\u7684\u89e6\u53d1\u6761\u4ef6\uff0c\u4e0d\u518d\u6ce8\u518c\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(LoginEvent value, Context ctx, Collector&lt;LoginFailWarning&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679c\u767b\u5f55\u5931\u8d25\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"fail\".equals(value.getLoginState())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7b2c\u4e00\u6b21\u767b\u5f55\u5931\u8d25\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (failCount.value() == null || firstLoginFailEvent.value() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0firstLoginFailEvent.update(value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u672c\u6b21\u767b\u5f55\u5931\u8d25\u7684\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u767b\u5f55\u5931\u8d25\u7684\u65f6\u95f4\u4e4b\u5dee\u5c0f\u4e8etimeInterval\uff0c\u90a3\u4e48\u767b\u5f55\u5931\u8d25\u6b21\u6570\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (value.getTimestamp() - firstLoginFailEvent.value().getTimestamp() &lt;= timeInterval) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(failCount.value() + 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u52a01\u540e\u5982\u679c\u767b\u5f55\u6b21\u6570\u8fbe\u5230\u6700\u5927\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (failCount.value() &gt;= maxFailTimes) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8f93\u51fa\u62a5\u8b66\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new LoginFailWarning(value.getUserId(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0firstLoginFailEvent.value().getTimestamp(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0value.getTimestamp(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"\u8fde\u7eed\" + maxFailTimes + \"\u6b21\u767b\u5f55\u5931\u8d25\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/*\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8f93\u51fa\u62a5\u8b66\u540e\uff0c\u5982\u679c\u60f3\u91cd\u65b0\u5f00\u59cb\u8ba1\u6570\u5c31\u4e0d\u6ce8\u91ca\u8fd9\u4e24\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0firstLoginFailEvent.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5426\u5219\u8868\u793a\u672c\u6b21\u767b\u5f55\u5931\u8d25\u4e0e\u4e0a\u6b21\u767b\u5f55\u5931\u8d25\u7684\u65f6\u95f4\u95f4\u9694\u76f8\u5deetimeInterval\u4ee5\u4e0a\uff0c\u5e94\u8be5\u91cd\u65b0\u8ba1\u6570\uff0c\u4ee5\u672c\u6b21\u767b\u5f55\u5931\u8d25\u4e3a\u7b2c\u4e00\u6b21\u5f00\u59cb\u8ba1\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0firstLoginFailEvent.update(value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.update(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u767b\u5f55\u6210\u529f\uff0c\u6e05\u7a7a\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0failCount.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0firstLoginFailEvent.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>LoginFailWarning(userId=1035, firstFailTime=1558430842, lastFailTime=1558430843, warningMsg=\u8fde\u7eed2\u6b21\u767b\u5f55\u5931\u8d25)\nLoginFailWarning(userId=1035, firstFailTime=1558430842, lastFailTime=1558430844, warningMsg=\u8fde\u7eed2\u6b21\u767b\u5f55\u5931\u8d25)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/26-%E6%A1%88%E4%BE%8B%E5%9B%9B%EF%BC%88%E9%A3%8E%E6%8E%A7%2B%E7%BB%9F%E8%AE%A1%EF%BC%89%EF%BC%9A%E8%BF%87%E6%BB%A4%E5%BC%82%E5%B8%B8%E7%82%B9%E5%87%BB%E8%A1%8C%E4%B8%BA%20%E5%92%8C%20%E7%BB%9F%E8%AE%A1%E5%B9%BF%E5%91%8A%E7%82%B9%E5%87%BB%E6%AC%A1%E6%95%B0/","title":"26-\u6848\u4f8b\u56db\uff08\u98ce\u63a7+\u7edf\u8ba1\uff09\uff1a\u8fc7\u6ee4\u5f02\u5e38\u70b9\u51fb\u884c\u4e3a \u548c \u7edf\u8ba1\u5e7f\u544a\u70b9\u51fb\u6b21\u6570","text":"<p> \u7ea6 764 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>\u9700\u6c42\uff1a\u6bcf10\u79d2\u7edf\u8ba1\u4e00\u6b21\u6700\u8fd110\u5206\u949f\u6bcf\u4e2a\u7701\u4efd\u6bcf\u4e2a\u5e7f\u544a\u7684\u70b9\u51fb\u6b21\u6570\uff0c\u5982\u679c\u4e00\u4e2a\u7528\u6237\u5728\u4e00\u5206\u949f\u4e4b\u5185\u70b9\u51fb\u67d0\u4e2a\u5e7f\u544a\u7684\u6b21\u6570\u8fbe\u5230\u4e8620\u6b21\uff0c\u5c31\u628a\u8be5\u7528\u6237\u4ee5\u540e\u7684\u6240\u6709\u5e7f\u544a\u70b9\u51fb\u5c4f\u853d\uff0c\u4e0d\u8ba1\u5165\u7edf\u8ba1\uff0c\u5e76\u5c06\u8be5\u7528\u6237\u8f93\u51fa\u62a5\u8b66,\uff0c\u4e00\u5929\u540e\u89e3\u9664\u5c4f\u853d\u3002 \u6570\u636e\uff1a  pojo\u7c7b\uff1a \u70b9\u51fb\u8bb0\u5f55 Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class AdClick {\n\u00a0\u00a0\u00a0\u00a0String userId;\n\u00a0\u00a0\u00a0\u00a0String adId;\n\u00a0\u00a0\u00a0\u00a0String province;\n\u00a0\u00a0\u00a0\u00a0String city;\n\u00a0\u00a0\u00a0\u00a0Long timestamp;\n}\n</code></pre> \u7edf\u8ba1\u7ed3\u679c Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class AdClickByProvince {\n\u00a0\u00a0\u00a0\u00a0private String windowEnd;\n\u00a0\u00a0\u00a0\u00a0private String province;\n\u00a0\u00a0\u00a0\u00a0private String adId;\n\u00a0\u00a0\u00a0\u00a0private Integer count;\n}\n</code></pre></p> Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0OutputTag&lt;String&gt; outputTag = new OutputTag&lt;&gt;(\"BlockList\") {};\n\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;AdClick&gt; singleOutputStreamOperator = env.readTextFile(\"Data/AdClickLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(new MapFunction&lt;String, AdClick&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public AdClick map(String value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new AdClick(split[0], split[1], split[2], split[3], Long.valueOf(split[4]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;AdClick&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(AdClick element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u7528\u6237id\u5206\u7ec4\uff0c\u4ee5\u4fbf\u7edf\u8ba1\u6bcf\u4e2a\u7528\u6237\u70b9\u51fb\u5e7f\u544a\u7684\u60c5\u51b5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(AdClick::getUserId)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u4e00\u4e2a\u7528\u6237\u5728\u4e00\u5206\u949f\u4e4b\u5185\u70b9\u51fb\u67d0\u4e2a\u5e7f\u544a\u7684\u6b21\u6570\u8fbe\u5230\u4e8620\u6b21\uff0c\u5c31\u628a\u8be5\u7528\u6237\u5c4f\u853d\uff0c\u5e76\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41\u4e2d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new MaliciousClickFilter(20, outputTag));\n\u00a0\u00a0\u00a0\u00a0//\u8f93\u51fa\u4fa7\u8f93\u51fa\u6d41\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.getSideOutput(outputTag).print(\"BlockList\");\n\n\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u7701\u4efd\u548c\u5e7f\u544aid\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(\"province\", \"adId\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6bcf10\u79d2\u7edf\u8ba1\u4e00\u6b21\u6700\u8fd110\u5206\u949f\u6bcf\u4e2a\u7701\u4efd\u6bcf\u4e2a\u5e7f\u544a\u7684\u70b9\u51fb\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.timeWindow(Time.minutes(10), Time.seconds(10))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u805a\u5408\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.aggregate(new AdClickAggregateFunction(), new AdClickWindowFunction())\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print();\n\u00a0 \u00a0 env.execute();\n}\n</code></pre> Text Only<pre><code>private static class MaliciousClickFilter extends KeyedProcessFunction&lt;String, AdClick, AdClick&gt; {\n\n\u00a0\u00a0\u00a0\u00a0private final Integer threshold;\n\u00a0\u00a0\u00a0\u00a0private final OutputTag&lt;String&gt; outputTag;\n\n\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Long&gt; oneMinuteTimer;\n\u00a0\u00a0\u00a0\u00a0private MapState&lt;String, Integer&gt; clickCountMap;\n\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Boolean&gt; isBlocked;\n\n\u00a0\u00a0\u00a0\u00a0public MaliciousClickFilter(Integer threshold, OutputTag&lt;String&gt; outputTag) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.threshold = threshold;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.outputTag = outputTag;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0clickCountMap = getRuntimeContext().getMapState(new MapStateDescriptor&lt;String, Integer&gt;(\"click-count\", String.class, Integer.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oneMinuteTimer = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;(\"on-timer\", Long.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isBlocked = getRuntimeContext().getState(new ValueStateDescriptor&lt;&gt;(\"isBlocked\", Boolean.class));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void processElement(AdClick value, Context ctx, Collector&lt;AdClick&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u7528\u6237\u5df2\u7ecf\u88ab\u5217\u5165\u9ed1\u540d\u5355\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isBlocked.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u7b2c\u4e00\u6761\u6570\u636e\u6765\uff0c\u6216\u8005\u5b9a\u65f6\u5668\u5df2\u7ecf\u89e6\u53d1\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (oneMinuteTimer.value() == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long oneMinute = 60 * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oneMinuteTimer.update(oneMinute);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u4e00\u5206\u949f\u7684\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(ctx.timestamp() + oneMinute);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5f53\u524d\u5e7f\u544aid \u548c \u5df2\u7ecf\u88ab\u70b9\u51fb\u7684\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String adId = value.getAdId();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Integer clickCount = clickCountMap.get(adId);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (clickCount == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0clickCountMap.put(adId, 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u4e00\u5206\u949f\u5185\u8fde\u7eed\u70b9\u51fb\u67d0\u4e2a\u5e7f\u544a\u8d85\u8fc720\u6b21\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (clickCount &gt;= threshold) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5220\u9664\u4e00\u5206\u949f\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().deleteEventTimeTimer(oneMinuteTimer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oneMinuteTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u4e3atrue\u4e4b\u540e\uff0c\u8be5\u7528\u6237\u4e4b\u540e\u70b9\u51fb\u5e7f\u544a\u65e0\u6548\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isBlocked.update(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e00\u5929\u7684\u5b9a\u65f6\u5668\uff0c\u660e\u5929\u518d\u6e05\u7a7aisBlocked\u7684\u72b6\u6001\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerProcessingTimeTimer(ctx.timestamp() + (24 * 60 * 60 * 1000));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(outputTag, \"\u7528\u6237\uff1a \" + ctx.getCurrentKey() + \"\u4e00\u5206\u949f\u5185\u8fde\u7eed\u70b9\u51fb\u5e7f\u544a\uff1a\" + adId + \" \u8d85\u8fc720\u6b21\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0clickCountMap.put(adId, clickCount + 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(value);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;AdClick&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isBlocked.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u91cc\u6267\u884c\u80af\u5b9a\u662f\u7b2c\u4e8c\u5929\u4e86\uff0c\u56e0\u4e3a\u5f53\u8bbe\u7f6eisBlocked.update(true);\u4e4b\u540e\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// processElement\u5c31\u4e0d\u4f1a\u5728\u8bbe\u7f6e\u5b9a\u65f6\u5668\u4e86\uff0c\u6240\u4ee5\u4e5f\u5c31\u53ea\u6709\u90a3\u4e2a\u4e00\u5929\u7684\u5b9a\u65f6\u5668\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isBlocked.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6e05\u9664\u5b9a\u65f6\u5668\u6807\u5fd7\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0oneMinuteTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6e05\u7a7a\u8ba1\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0clickCountMap.clear();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>private static class AdClickAggregateFunction implements AggregateFunction&lt;AdClick, Integer, Integer&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer createAccumulator() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 0;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer add(AdClick value, Integer accumulator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return accumulator + 1;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer getResult(Integer accumulator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return accumulator;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Integer merge(Integer a, Integer b) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return null;\n\u00a0\u00a0\u00a0\u00a0}\n}\n\nprivate static class AdClickWindowFunction implements WindowFunction&lt;Integer, AdClickByProvince, Tuple, TimeWindow&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void apply(Tuple key, TimeWindow window, Iterable&lt;Integer&gt; input, Collector&lt;AdClickByProvince&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new AdClickByProvince(new Timestamp(window.getEnd()).toString(), key.getField(0), key.getField(1), input.iterator().next()));\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/27-CEP/","title":"27-CEP","text":"<p> \u7ea6 1681 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 34 \u5206\u949f</p> <p>CEP\uff08Complex Event Processing\uff0c\u590d\u6742\u4e8b\u4ef6\u5904\u7406\uff0c\u4e8b\u4ef6\u5c31\u662f\u6570\u636e\uff0c\u56e0\u4e3a\u4e8b\u4ef6\u4f1a\u4ea7\u751f\u6570\u636e\uff0c\u6240\u4ee5\u7ecf\u5e38\u628a\u4e8b\u4ef6\u7b49\u4ef7\u4e8e\u6570\u636e\uff09\u662fFlink\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u7684\u4e00\u4e2a\u5305\uff0c\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u7c7b\u4f3c\uff0c\u4f7f\u7528CEP\u53ef\u4ee5\u628a\u7b26\u5408\u5339\u914d\u89c4\u5219\u7684\u6570\u636e\u63d0\u53d6\u51fa\u6765\u3002 CEP\u7684\u4f9d\u8d56\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0 \u00a0&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n\u00a0 \u00a0&lt;artifactId&gt;flink-cep_2.12&lt;/artifactId&gt;\n\u00a0 \u00a0&lt;version&gt;1.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> \u7b80\u5355\u4f8b\u5b50\uff1a \u6570\u636e\uff1a Text Only<pre><code>a,1633947551\nb,1633947552\nb,1633947553\na,1633947555\nc,1633947554\nb,1633947555\nb,1633947556\nf,1633947557\nc,1633947558\n</code></pre> pojo\u7c7b Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Event {\n\u00a0 \u00a0private String field;\n\u00a0 \u00a0private Long timestamp;\n}\n</code></pre> \u627e\u51fa5s\u5185\u7b26\u5408abb..c\u76844\u6761\u6570\u636e\uff0c\u5176\u4e2dabb\u8981\u7d27\u6328\u7740\uff0cc\u53ef\u4ee5\u4e0d\u7d27\u6328\u7740b\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0 \u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0 \u00a0env.setParallelism(1);\n\u00a0 \u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0 \u00a0DataStream&lt;Event&gt; inputStream = env.readTextFile(\"Data/Event.csv\")\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.map(new MapFunction&lt;String, Event&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public Event map(String value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0String[] split = value.split(\",\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return new Event(split[0], Long.valueOf(split[1]));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.assignTimestampsAndWatermarks(\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0new BoundedOutOfOrdernessTimestampExtractor&lt;Event&gt;(Time.seconds(3)) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public long extractTimestamp(Event element) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return element.getTimestamp() * 1000L;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0});\n\n\u00a0 \u00a0//1.\u6784\u5efa\u5339\u914d\u6a21\u5f0f\n\u00a0 \u00a0Pattern&lt;Event, Event&gt; pattern = Pattern.\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0&lt;Event&gt;begin(\"a\").where(new SimpleCondition&lt;Event&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public boolean filter(Event value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return value.getField().equals(\"a\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.next(\"b\").where(new SimpleCondition&lt;Event&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public boolean filter(Event value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return value.getField().equals(\"b\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}).times(2).consecutive()\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.followedBy(\"c\").where(new SimpleCondition&lt;Event&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0public boolean filter(Event value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return value.getField().equals(\"c\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0})\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0.within(Time.seconds(5));\n\n\u00a0 \u00a0//2.\u628a\u5339\u914d\u6a21\u5f0f\u5e94\u7528\u5230DataStream\u4e0a\n\u00a0 \u00a0PatternStream&lt;Event&gt; patternStream = CEP.pattern(inputStream, pattern);\n\n\u00a0 \u00a0//3.\u8f93\u51fa\u5339\u914d\u7684\u7ed3\u679c\n\u00a0 \u00a0SingleOutputStreamOperator&lt;String&gt; singleOutputStreamOperator = patternStream.select(new PatternSelectFunction&lt;Event, String&gt;() {\n\u00a0 \u00a0 \u00a0 \u00a0@Override\n\u00a0 \u00a0 \u00a0 \u00a0public String select(Map&lt;String, List&lt;Event&gt;&gt; map) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0StringBuilder sb = new StringBuilder();\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0List&lt;Event&gt; aList = map.get(\"a\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0sb.append(aList.iterator().next().toString()).append(\" | \");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0List&lt;Event&gt; bList = map.get(\"b\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0bList.forEach(e -&gt; sb.append(e.toString()).append(\" | \"));\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0List&lt;Event&gt; cList = map.get(\"c\");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0sb.append(cList.iterator().next().toString()).append(\" | \");\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0return sb.toString();\n\u00a0 \u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0});\n\u00a0 \u00a0singleOutputStreamOperator.print();\n\u00a0 \u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>Event(field=a, timestamp=1633947551) | Event(field=b, timestamp=1633947552) | Event(field=b, timestamp=1633947553) | Event(field=c, timestamp=1633947554) |\nEvent(field=a, timestamp=1633947555) | Event(field=b, timestamp=1633947555) | Event(field=b, timestamp=1633947556) | Event(field=c, timestamp=1633947558) |\n</code></pre></p> <p>1.\u6784\u5efa\u6a21\u5f0f Pattern\u7684\u4e09\u4e2a\u6982\u5ff5\uff1a</p> <ul> <li>\u4e2a\u4f53\u6a21\u5f0f\uff08Individual Patterns\uff09\uff1a\u4ee5begin()\u3001next()\u3001followedBy()\u3001 followedByAny()\u65b9\u6cd5\u6253\u5934\u7684\u4e00\u4e2a\u5339\u914d\u89c4\u5219\uff0c\u8fd94\u4e2a\u65b9\u6cd5\u4f20\u9012\u7684\u5b57\u7b26\u4e32\u662f\u4e3a\u4e86\u65b9\u4fbf\u80fd\u62ff\u5230\u5339\u914d\u7ed3\u679c\u3002</li> <li>\u7ec4\u5408\u6a21\u5f0f\uff08 Combining Patterns\uff0c\u4e5f\u53eb\u6a21\u5f0f\u5e8f\u5217\uff09\uff1a\u4e2a\u4f53\u6a21\u5f0f\u7ec4\u5408\u8d77\u6765\u79f0\u4e3a\u6a21\u5f0f\u5e8f\u5217\uff0c\u6a21\u5f0f\u5e8f\u5217\u5fc5\u987b\u4ee5\u201c\u521d\u59cb\u6a21\u5f0f\u201d\u5f00\u59cb\uff0c\u5373\u5fc5\u987b\u4ee5begin()\u5f00\u59cb</li> <li>\u6a21\u5f0f\u7ec4\uff08 Groups of patterns\uff09\uff1a\u5c06\u4e00\u4e2a\u6a21\u5f0f\u5e8f\u5217\u4f5c\u4e3a\u6761\u4ef6\u5d4c\u5957\u5728\u4e2a\u4f53\u6a21\u5f0f\u91cc\uff0c\u6210\u4e3a\u4e00\u7ec4\u6a21\u5f0f\uff0c\u592a\u590d\u6742\u4e86\uff0c\u7528\u7684\u5c11\u3002</li> </ul> <p>\u4e2a\u4f53\u6a21\u5f0f \u4e2a\u4f53\u6a21\u5f0f\u53ef\u4ee5\u5305\u62ec\u201c\u5355\u4f8b\uff08 singleton\uff09\u6a21\u5f0f\u201d\u548c\u201c\u5faa\u73af\uff08 looping\uff09\u6a21\u5f0f\u201d:</p> <ul> <li>\u5355\u4f8b\u6a21\u5f0f\u662f\u5339\u914d\u7ed3\u679c\u53ea\u6709\u4e00\u4e2a\u4e8b\u4ef6\u7684\u4e2a\u4f53\u6a21\u5f0f\uff0c\u6bd4\u5982\u4e0a\u9762\u5339\u914d \"a\" \u548c \"c\" \u7684\u6a21\u5f0f\u3002</li> <li>\u5faa\u73af\u6a21\u5f0f\u662f\u5339\u914d\u7ed3\u679c\u6709\u591a\u4e2a\u4e8b\u4ef6\u7684\u4e2a\u4f53\u6a21\u5f0f\uff0c\u6bd4\u5982\u4e0a\u9762\u5339\u914d \"b\" \u7684\u6a21\u5f0f\u3002\u6240\u4ee5\u6700\u540e\u83b7\u53d6\u7ed3\u679c\u65f6\uff0cselect()\u65b9\u6cd5\u7684\u53c2\u6570Map\u7684Value\u662f\u4e00\u4e2aList\u3002</li> </ul> <p>\u91cf\u8bcd\uff08 Quantifier\uff09 \u53ef\u4ee5\u5728\u4e2a\u4f53\u6a21\u5f0f\u540e\u8ffd\u52a0\u91cf\u8bcd\uff0c\u8868\u793a\u8be5\u6761\u4ef6\u9700\u8981\u5339\u914d\u7684\u6b21\u6570\uff0c\u91cf\u8bcd\u6709times()\u3001optional()\u3001greedy()\u3001oneOrMore()\u3001timesOrMore()\uff0c\u642d\u914d\u8d77\u6765\u7528\u7684\u542b\u4e49\u5982\u4e0b\uff1a  \u6ce8\u610f\uff1atimes()\u662f\u975e\u4e25\u683c\u8fd1\u90bb\uff0c\u4f7f\u7528consecutive()\u53ef\u4ee5\u4f7ftimes\u8868\u793a\u4e25\u683c\u8fd1\u90bb\u3002</p> <p>\u6761\u4ef6\uff08 Condition\uff09 \u6bcf\u4e2a\u4e2a\u4f53\u6a21\u5f0f\u90fd\u9700\u8981\u4f7f\u7528 where()\u3001or() \u548c until() \u6765\u6307\u5b9a\u6761\u4ef6\u6307\u5b9a\u5339\u914d\u6761\u4ef6\uff0c\u6709\u5982\u4e0b\u7c7b\u578b\u7684\u6761\u4ef6\uff1a</p> <ul> <li>\u7b80\u5355\u6761\u4ef6\uff08 Simple Condition\uff09</li> </ul> <p>where() \u65b9\u6cd5\u901a\u8fc7\u5bf9\u4e8b\u4ef6\u7684\u5b57\u6bb5\u8fdb\u884c\u5224\u65ad\uff0c\u51b3\u5b9a\u8be5\u4e8b\u4ef6\u662f\u5426\u5339\u914d\uff1a Text Only<pre><code>.where(new SimpleCondition&lt;Event&gt;() {\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public boolean filter(Event value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0return value.getField().equals(\"a\");\n\u00a0 \u00a0}\n})\n</code></pre></p> <ul> <li>\u7ec4\u5408\u6761\u4ef6\uff08 Combining Condition\uff09</li> </ul> <p>\u8fde\u7eed\u5bf9\u7b80\u5355\u6761\u4ef6\u7684\u8c03\u7528\u79f0\u4e3a\u7ec4\u5408\u6761\u4ef6\uff0c where()\u8868\u793a\u903b\u8f91AND\uff0cor()\u8868\u793a\u903b\u8f91\u6216\uff0c\u6bd4\u5982\u8be5\u4e8b\u4ef6\u7684\u5b57\u6bb5\u662f \"a\" \u6216\u8005 \"m\"\uff08\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u5168\u5199\u5230\u4e00\u4e2awhere\u91cc\uff09\uff1a Text Only<pre><code>.where(new SimpleCondition&lt;Event&gt;() {\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public boolean filter(Event value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0return value.getField().equals(\"a\");\n\u00a0 \u00a0}\n}).or(new SimpleCondition&lt;Event&gt;() {\n\u00a0 \u00a0@Override\n\u00a0 \u00a0public boolean filter(Event value) throws Exception {\n\u00a0 \u00a0 \u00a0 \u00a0return value.getField().equals(\"m\");\n\u00a0 \u00a0}\n})\n</code></pre></p> <ul> <li>\u7ec8\u6b62\u6761\u4ef6\uff08 Stop Condition\uff09\uff1a\u5982\u679c\u4f7f\u7528\u4e86 oneOrMore \u6216\u8005 oneOrMore.optional\uff0c\u5efa\u8bae\u4f7f\u7528 .until() \u4f5c\u4e3a\u7ec8\u6b62\u6761\u4ef6\uff0c\u4ee5\u4fbf\u6e05\u7406\u72b6\u6001\u3002</li> <li>\u8fed\u4ee3\u6761\u4ef6\uff08 Iterative Condition\uff09\uff1a\u5728where\u4e2d\u76f4\u63a5\u4f7f\u7528IterativeCondition\uff08SimpleCondition\u662fIterativeCondition\u7684\u5b50\u7c7b\uff09\u53ef\u4ee5\u5bf9\u4e4b\u524d\u4e2a\u4f53\u6a21\u5f0f\u6240\u6709\u5339\u914d\u7684\u4e8b\u4ef6\u8fdb\u884c\u5904\u7406\u3002</li> </ul> <p>\u6a21\u5f0f\u5e8f\u5217 \u4e2a\u4f53\u6a21\u5f0f\u4ee5begin()\u3001next()\u3001followedBy()\u3001 followedByAny()\u4f5c\u4e3a\u8d77\u59cb\uff0c\u5176\u4e2dbegin()\u5f00\u5934\u7684\u4e2a\u4f53\u6a21\u5f0f\u662f\u4e00\u4e2aPattern\u7684\u5f00\u59cb\uff0cnext()\u3001followedBy()\u3001 followedByAny()\u58f0\u660e\u7684\u4e2a\u4f53\u6a21\u5f0f\u63a5\u5728\u540e\u9762\uff0c\u7ec4\u5408\u8d77\u6765\u79f0\u4e3a\u4e00\u4e2a\u6a21\u5f0f\u5e8f\u5217\u3002next()\u3001followedBy()\u3001 followedByAny()3\u4e2a\u65b9\u6cd5\u7684\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li>next()\u662f\u4e25\u683c\u8fd1\u90bb\uff08Strict Contiguity\uff09\uff0c\u5373\u6240\u6709\u4e8b\u4ef6\u9700\u8981\u4e25\u683c\u6309\u7167\u987a\u5e8f\u51fa\u73b0\uff0c\u4e2d\u95f4\u4e0d\u80fd\u6709\u4efb\u4f55\u4e0d\u5339\u914d\u7684\u4e8b\u4ef6\uff0c \u5982 a next b\uff0c\u4e8b\u4ef6\u5e8f\u5217 [a, c, b, b] \u6ca1\u6709\u5339\u914d\u3002</li> <li>followedBy()\u662f\u5bbd\u677e\u8fd1\u90bb\uff08Relaxed Contiguity\uff09\uff0c\u5373\u5141\u8bb8\u4e2d\u95f4\u51fa\u73b0\u4e0d\u5339\u914d\u7684\u4e8b\u4ef6\uff0c \u5982\u5bf9\u4e8e\u6a21\u5f0fa followedBy b\uff0c\u4e8b\u4ef6\u5e8f\u5217 [a, c, b, b] \u5339\u914d\u4e3a {a, b}\u3002</li> <li>followedByAny()\u662f \u975e\u786e\u5b9a\u6027\u5bbd\u677e\u8fd1\u90bb\uff08Non-Deterministic Relaxed Contiguity\uff09\uff0c\u5373\u8fdb\u4e00\u6b65\u653e\u5bbd\u6761\u4ef6\uff0c\u4e4b\u524d\u5df2\u7ecf\u5339\u914d\u8fc7\u7684\u4e8b\u4ef6\u4e5f\u53ef\u4ee5\u518d\u6b21\u4f7f\u7528\uff0c \u5982a followedByAny b\uff0c\u4e8b\u4ef6\u5e8f\u5217 [a, c, b, b] \u5339\u914d\u4e3a {a, b}\uff0c{a, b}\u3002</li> </ul> <p>\u4ee5\u4e0b\u6570\u636e\uff0cab\u4e25\u683c\u8fd1\u90bb\uff1a Text Only<pre><code>b,1633947553\nc,1633947554\na,1633947551\n</code></pre> \u4f46\u662f\u8fd9\u6837ab\u5c31\u4e0d\u662f\u4e25\u683c\u8fd1\u90bb\u4e86\uff0c\u800c\u662f\u5bbd\u677e\u8fd1\u90bb Text Only<pre><code>b,1633947553\nc,1633947552\na,1633947551\n</code></pre></p> <p>\u9664\u4ee5\u4e0a\u6a21\u5f0f\u5e8f\u5217\u5916\uff0c\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u201c\u4e0d\u5e0c\u671b\u51fa\u73b0\u67d0\u79cd\u8fd1\u90bb\u5173\u7cfb\u201d\uff1a</p> <ul> <li>notNext()\uff1a\u4e0d\u60f3\u8ba9\u67d0\u4e2a\u4e8b\u4ef6\u4e25\u683c\u7d27\u90bb\u524d\u4e00\u4e2a\u4e8b\u4ef6\u53d1\u751f</li> <li>notFollowedBy()\uff1a\u4e0d\u60f3\u8ba9\u67d0\u4e2a\u4e8b\u4ef6\u5728\u4e24\u4e2a\u4e8b\u4ef6\u4e4b\u95f4\u53d1\u751f</li> </ul> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u6240\u6709\u6a21\u5f0f\u5e8f\u5217\u5fc5\u987b\u4ee5 .begin() \u5f00\u59cb</li> <li>\u6a21\u5f0f\u5e8f\u5217\u4e0d\u80fd\u4ee5 .notFollowedBy() \u7ed3\u675f</li> <li>not \u7c7b\u578b\u7684\u6a21\u5f0f\u4e0d\u80fd\u88ab optional \u6240\u4fee\u9970</li> </ul> <p>\u6b64\u5916\u8fd8\u53ef\u4ee5\u4e3a\u6a21\u5f0f\u6307\u5b9a\u65f6\u95f4\u7ea6\u675f.within(Time.seconds(5))\uff0c\u7528\u6765\u8981\u6c42\u5728\u591a\u957f\u65f6\u95f4\u5185\u5339\u914d\u6709\u6548\uff0c\u8fd9\u4e2a\u65f6\u95f4\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u65f6\u95f4\u8bed\u4e49\u3002</p> <p>2.\u5c06\u6a21\u5f0f\u5e94\u7528\u5728DataStream\u4e0a \u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u4e2aPatternStream Text Only<pre><code>//2.\u628a\u5339\u914d\u6a21\u5f0f\u5e94\u7528\u5230DataStream\u4e0a\nPatternStream&lt;Event&gt; patternStream = CEP.pattern(inputStream, pattern);\n</code></pre></p> <p>3.\u83b7\u53d6\u5339\u914d\u7684\u7ed3\u679c \u4f7f\u7528 select() \u6216\u8005 flatselect() \u65b9\u6cd5\u5c31\u53ef\u4ee5\u4ecePatternStream \u4e2d\u83b7\u53d6\u5230\u5339\u914d\u7684\u7ed3\u679c\u4e86\uff0c\u5339\u914d\u7684\u7ed3\u679c\u8fd8\u662fDataStream\uff0c\u53ea\u4e0d\u8fc7DataStream\u4e2d\u5168\u90e8\u90fd\u662f\u7b26\u5408Pattern\u7684\u6570\u636e\u3002 select() \u65b9\u6cd5\u9700\u8981\u8f93\u5165\u4e00\u4e2a PatternSelectFunction\u4f5c\u4e3a\u53c2\u6570\uff0c\u6bcf\u4e2a\u6210\u529f\u5339\u914d\u7684\u4e8b\u4ef6\u5e8f\u5217\u90fd\u4f1a\u8c03\u7528\u5b83\u7684select()\u65b9\u6cd5\u3002flatselect() \u65b9\u6cd5\u9700\u8981\u8f93\u5165\u4e00\u4e2aPatternFlatSelectFunction\u4f5c\u4e3a\u53c2\u6570\uff0c\u4e0eselect()\u65b9\u6cd5\u53ea\u80fd\u8fd4\u56de\u4e00\u4e2a\u503c\u4f5c\u4e3a\u6574\u4e2a\u5339\u914d\u5e8f\u5217\u7684\u7ed3\u679c\u4e0d\u540c\uff0cflatselect()\u65b9\u6cd5\u53ef\u4ee5\u5c06\u6574\u4e2a\u5339\u914d\u5e8f\u5217\u8f6c\u5316\u591a\u4e2a\u503c\u7528out.collect()\u8f93\u51fa\u3002 select()\uff1a Text Only<pre><code>patternStream.select(new PatternSelectFunction&lt;Event, String&gt;() {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public `String` select(Map&lt;String, List&lt;Event&gt;&gt; map) throws Exception {\n\u00a0\u00a0\u00a0\u00a0}\n});\n</code></pre> flatselect()\uff1a Text Only<pre><code>patternStream.flatSelect(new PatternFlatSelectFunction&lt;Event, String&gt;() {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void flatSelect(Map&lt;String, List&lt;Event&gt;&gt; map, `Collector&lt;String&gt; out`) throws Exception {\n\u00a0\u00a0\u00a0\u00a0}\n});\n</code></pre></p> <p>\u8d85\u65f6\u4e8b\u4ef6\u7684\u63d0\u53d6 \u5728within\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u53ea\u5339\u914d\u5230\u4e86\u524d\u9762\u90e8\u5206\u4e2a\u4f53\u6a21\u5f0f\u7684\u8bdd\uff0c\u4f7f\u7528\u53ea\u4f20\u4e00\u4e2a\u53c2\u6570\u7684select()\u662f\u62ff\u4e0d\u5230\u8fd9\u90e8\u5206\u6570\u636e\u7684\uff0c\u4e5f\u5c31\u662f\u8fd9\u90e8\u5206\u6570\u636e\u4f1a\u88ab\u4e22\u5f03\uff0c\u5c5e\u4e8e\u672a\u5339\u914d\u6210\u529f\u7684\u60c5\u51b5\uff0c\u5982\u679c\u5148\u62ff\u5230\u53ea\u5339\u914d\u4e86\u524d\u9762\u90e8\u5206\u4e2a\u4f53\u6a21\u5f0f\u7684\u6570\u636e\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u4f20\u90123\u4e2a\u53c2\u6570\u7684select()\u65b9\u6cd5\u4e86\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u4f1a\u88ab\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41\u4e2d\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u8d85\u65f6\u4e8b\u4ef6\u63d0\u53d6\u3002 </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/28-%E6%A1%88%E4%BE%8B%E4%BA%94%EF%BC%88%E9%A3%8E%E6%8E%A7%EF%BC%89%EF%BC%9ACEP%E7%9A%84%E5%BA%94%E7%94%A8%E4%B9%8B%E6%A3%80%E6%B5%8B%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E4%BA%8B%E4%BB%B6/","title":"28-\u6848\u4f8b\u4e94\uff08\u98ce\u63a7\uff09\uff1aCEP\u7684\u5e94\u7528\u4e4b\u68c0\u6d4b\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6","text":"<p> \u7ea6 402 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 8 \u5206\u949f</p> <p>CEP\u7279\u522b\u9002\u5408\u7528\u4e8e\u590d\u6742\u7684\u98ce\u63a7\u4e1a\u52a1\uff0c\u6bd4\u5982\u524d\u9762\u7684\u6848\u4f8b\u4e09\u68c0\u6d4b\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\u5904\u7406\u7684\u6570\u636e\u7684\u65f6\u95f4\u6233\u662f\u5347\u5e8f\u7684\uff0c\u5982\u679c\u662f\u4e71\u5e8f\uff0c\u76f4\u63a5\u4f7f\u7528\u5b9a\u65f6\u5668\u5b9e\u73b0\u7684\u8bdd\uff0c\u903b\u8f91\u4f1a\u7279\u522b\u590d\u6742\uff0c\u800c\u8fd9\u79cd\u4e1a\u52a1\u672c\u8eab\u5c31\u662f\u4e00\u79cd\u6a21\u5f0f\u5339\u914d\uff0c\u5373\u68c0\u6d4b\u4e00\u6bb5\u65f6\u95f4\u5185\u51fa\u73b0\u7b26\u5408\u6761\u4ef6\u7684\u5e8f\u5217\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u4f7f\u7528CEP\u6765\u5904\u7406\u3002 \u6570\u636e\uff1a Text Only<pre><code>1035,83.149.9.216,fail,1558430843\n1035,83.149.9.216,success,1558430841\n1035,83.149.9.216,fail,1558430842\n1035,83.149.24.26,fail,1558430844\n</code></pre>  pojo: \u767b\u5f55\u4e8b\u4ef6 Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class LoginEvent {\n\u00a0\u00a0\u00a0\u00a0private Long userId;\n\u00a0\u00a0\u00a0\u00a0private String ip;\n\u00a0\u00a0\u00a0\u00a0private String loginState;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u7c7b Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class LoginFailWarning {\n\u00a0\u00a0\u00a0\u00a0private Long userId;\n\u00a0\u00a0\u00a0\u00a0private Long firstFailTime;\n\u00a0\u00a0\u00a0\u00a0private Long lastFailTime;\n\u00a0\u00a0\u00a0\u00a0private String warningMsg;\n}\n</code></pre> \u68c0\u6d4b2s\u5185\u8fde\u7eed\u4e24\u6b21\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;LoginEvent, Long&gt; keyedStream = env.readTextFile(\"Data/LoginLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new LoginEvent(Long.valueOf(fields[0]), fields[1], fields[2], Long.valueOf(fields[3]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new BoundedOutOfOrdernessTimestampExtractor&lt;LoginEvent&gt;(Time.seconds(2)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractTimestamp(LoginEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u7528\u6237id\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(LoginEvent::getUserId);\n\n\u00a0\u00a0\u00a0\u00a0//1.\u6784\u5efa\u5339\u914d\u6a21\u5f0f\uff0c\u68c0\u6d4b\u8fde\u7eed\u767b\u5f55\u5931\u8d25\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0Pattern&lt;LoginEvent, LoginEvent&gt; pattern = Pattern.&lt;LoginEvent&gt;begin(\"two-times-fail-login\").where(new SimpleCondition&lt;LoginEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean filter(LoginEvent value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return value.getLoginState().equals(\"fail\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).times(2).within(Time.seconds(2));\n\n\u00a0\u00a0\u00a0\u00a0//2.\u628a\u5339\u914d\u6a21\u5f0f\u5e94\u7528\u5230 keyedStream \u4e0a\n\u00a0\u00a0\u00a0\u00a0PatternStream&lt;LoginEvent&gt; patternStream = CEP.pattern(keyedStream, pattern);\n\n\u00a0\u00a0\u00a0\u00a0//3.\u8f93\u51fa\u5339\u914d\u7684\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0patternStream.select(new PatternSelectFunction&lt;LoginEvent, LoginFailWarning&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public LoginFailWarning select(Map&lt;String, List&lt;LoginEvent&gt;&gt; map) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;LoginEvent&gt; events = map.get(\"two-times-fail-login\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LoginEvent first = events.get(0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LoginEvent second = events.get(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new LoginFailWarning(first.getUserId(), first.getTimestamp(), second.getTimestamp(), \"\u8fde\u7eed\u4e24\u6b21\u767b\u5f55\u5931\u8d25\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).print();\n\n\u00a0\u00a0\u00a0\u00a0env.execute(\"login fail detect job\");\n}\n</code></pre></p> <p>\u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>LoginFailWarning(userId=1035, firstFailTime=1558430842, lastFailTime=1558430843, warningMsg=\u8fde\u7eed\u4e24\u6b21\u767b\u5f55\u5931\u8d25)\nLoginFailWarning(userId=1035, firstFailTime=1558430843, lastFailTime=1558430844, warningMsg=\u8fde\u7eed\u4e24\u6b21\u767b\u5f55\u5931\u8d25)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/29-%E6%A1%88%E4%BE%8B%E5%85%AD%EF%BC%9ACEP%E6%A3%80%E6%B5%8B%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98%E8%B6%85%E6%97%B6/","title":"29-\u6848\u4f8b\u516d\uff1aCEP\u68c0\u6d4b\u8ba2\u5355\u652f\u4ed8\u8d85\u65f6","text":"<p> \u7ea6 875 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 18 \u5206\u949f</p> <p>\u9700\u6c42\uff1a\u8ba2\u5355\u521b\u5efa\u4e4b\u540e\uff0c\u5982\u679c15\u5206\u949f\u5185\u6ca1\u6709\u652f\u4ed8\uff0c\u90a3\u4e48\u652f\u4ed8\u8d85\u65f6\u8f93\u51fa\u62a5\u8b66  \u6570\u636e\uff1a Text Only<pre><code>34756,create,,1558430913\n34767,create,,1558430949\n34731,pay,35jue34we,1558430849\n34731,create,,1558430846\n34767,pay,sdafen9932,1558432021\n</code></pre></p> <p>pojo\u7c7b\uff1a \u8ba2\u5355 Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class OrderEvent {\n\u00a0\u00a0\u00a0\u00a0private Long orderId;\n\u00a0\u00a0\u00a0\u00a0private String eventType;\n\u00a0\u00a0\u00a0\u00a0private String txId;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u7c7b\uff1a Text Only<pre><code>@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class OrderResult {\n\u00a0\u00a0\u00a0\u00a0private Long orderId;\n\u00a0\u00a0\u00a0\u00a0private String resultState;\n}\n</code></pre> \u9700\u8981\u7528CEP\u5339\u914d\u8d85\u65f6\u6570\u636e\u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u5982\u679c\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u53ea\u5339\u914d\u5230\u4e86\u524d\u9762\u4e00\u90e8\u5206\u7ed3\u679c\u7684\u8bdd\uff0c\u5c31\u5c06\u8fd9\u4e00\u90e8\u5206\u7ed3\u679c\u8f93\u51fa\u5230\u4fa7\u8f93\u51fa\u6d41\uff0c\u6b63\u597d\u7b26\u5408\u5339\u914d\u8ba2\u5355\u652f\u4ed8\u8d85\u65f6\u7684\u9700\u6c42\uff0c\u56e0\u4e3a\u8ba2\u5355\u652f\u4ed8\u8d85\u65f6\u4e5f\u5c31\u610f\u5473\u7740\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u53ea\u4f1a\u5339\u914d\u5230create\u4e8b\u4ef6\uff0c\u4e0d\u4f1a\u5339\u914d\u540e\u9762\u7684\u4e8b\u4ef6\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0//1.\u6309\u8ba2\u5355\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;OrderEvent, Long&gt; keyedStream = env.readTextFile(\"Data/OrderLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new OrderEvent(Long.valueOf(fields[0]), fields[1], fields[2], Long.valueOf(fields[3]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;OrderEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(OrderEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(OrderEvent::getOrderId);\n\n\u00a0\u00a0\u00a0\u00a0//2.\u521b\u5efa\u6a21\u5f0f\n\u00a0\u00a0\u00a0\u00a0Pattern&lt;OrderEvent, OrderEvent&gt; pattern = Pattern\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.&lt;OrderEvent&gt;begin(\"create\").where(new SimpleCondition&lt;OrderEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean filter(OrderEvent value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"create\".equals(value.getEventType());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.followedBy(\"pay\").where(new SimpleCondition&lt;OrderEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public boolean filter(OrderEvent value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return \"pay\".equals(value.getEventType());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.within(Time.minutes(15));\n\n\u00a0\u00a0\u00a0\u00a0//3.\u5e94\u7528\u6a21\u5f0f\n\u00a0\u00a0\u00a0\u00a0PatternStream&lt;OrderEvent&gt; patternStream = CEP.pattern(keyedStream, pattern);\n\u00a0\u00a0\u00a0\u00a0//4.\u62ff\u5230\u5339\u914d\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0OutputTag&lt;OrderResult&gt; timeoutOrderOutputTag = new OutputTag&lt;&gt;(\"Timeout Order\") {};\n\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;OrderResult&gt; singleOutputStreamOperator = patternStream.select(timeoutOrderOutputTag, new OrderTimeoutFunction(), new OrderPayFunction());\n\u00a0\u00a0\u00a0\u00a0//4.1 \u5b8c\u6574\u5339\u914d\u7684\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.print(\"normal\");\n\u00a0\u00a0\u00a0\u00a0//4.2 \u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u672a\u5b8c\u6574\u5339\u914d\uff0c\u4e5f\u5c31\u662f\u53ea\u5339\u914d\u5230\u524d\u9762\u4e00\u90e8\u5206\u7684\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.getSideOutput(timeoutOrderOutputTag).print(\"timeout\");\n\n\u00a0\u00a0\u00a0\u00a0env.execute(\"order timeout detect job\");\n}\n\n//\u5904\u7406\u5339\u914d\u8d85\u65f6\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u572815\u5206\u949f\u5185\u53ea\u5339\u914d\u5230\u4e86\u4e00\u4e2acreate\u4e8b\u4ef6\uff0c\u8fdf\u8fdf\u6ca1\u6709\u7b49\u5230pay\u4e8b\u4ef6\u7684\u6570\u636e\nprivate static class OrderTimeoutFunction implements PatternTimeoutFunction&lt;OrderEvent, OrderResult&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public OrderResult timeout(Map&lt;String, List&lt;OrderEvent&gt;&gt; map, long timeoutTimestamp) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;OrderEvent&gt; events = map.get(\"create\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Long orderId = events.iterator().next().getOrderId();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new OrderResult(orderId, \"timeout, create time=\" + (timeoutTimestamp / 1000 - 15 * 60));\n\u00a0\u00a0\u00a0\u00a0}\n}\n\n//\u5904\u7406\u6b63\u5e38\u5339\u914d\u7684\u6570\u636e\nprivate static class OrderPayFunction implements PatternSelectFunction&lt;OrderEvent, OrderResult&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public OrderResult select(Map&lt;String, List&lt;OrderEvent&gt;&gt; map) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Long orderId = map.get(\"create\").iterator().next().getOrderId();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Long payTime = map.get(\"pay\").iterator().next().getTimestamp();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new OrderResult(orderId, \"pay, pay time=\" + payTime);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>timeout&gt; OrderResult(orderId=34756, resultState=timeout, create time=1558430913)\nnormal&gt; OrderResult(orderId=34731, resultState=pay, pay time=1558430849)\ntimeout&gt; OrderResult(orderId=34767, resultState=timeout, create time=1558430949)\n</code></pre></p> <p>\u5982\u679c\u4e0d\u7528CEP\uff0c\u76f4\u63a5\u7528\u5b9a\u65f6\u5668\u5b8c\u6210\u8fd9\u4e2a\u9700\u6c42\uff1a Text Only<pre><code>public class OrderPayTimeout {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0OutputTag&lt;OrderResult&gt; exceptionOrderOutputTag = new OutputTag&lt;&gt;(\"Exception Order\") {};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0OutputTag&lt;OrderResult&gt; timeoutOrderOutputTag = new OutputTag&lt;&gt;(\"Timeout Order\") {};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;OrderResult&gt; singleOutputStreamOperator = env.readTextFile(\"Data/OrderLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new OrderEvent(Long.valueOf(fields[0]), fields[1], fields[2], Long.valueOf(fields[3]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;OrderEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(OrderEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(OrderEvent::getOrderId)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.process(new OrderPayTimeoutKeyedProcessFunction(exceptionOrderOutputTag, timeoutOrderOutputTag));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.print(\"Normal Order\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.getSideOutput(exceptionOrderOutputTag).print(\"Exception Order\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.getSideOutput(timeoutOrderOutputTag).print(\"Timeout Order\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.execute(\"order timeout detect job\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0private static class OrderPayTimeoutKeyedProcessFunction extends KeyedProcessFunction&lt;Long, OrderEvent, OrderResult&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0OutputTag&lt;OrderResult&gt; exceptionOrderOutputTag;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0OutputTag&lt;OrderResult&gt; timeoutOrderOutputTag;\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public OrderPayTimeoutKeyedProcessFunction(OutputTag&lt;OrderResult&gt; exceptionOrderOutputTag, OutputTag&lt;OrderResult&gt; timeoutOrderOutputTag) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.exceptionOrderOutputTag = exceptionOrderOutputTag;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.timeoutOrderOutputTag = timeoutOrderOutputTag;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Boolean&gt; isPay;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Boolean&gt; isCreate;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Long&gt; onTimer;\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer = getRuntimeContext().getState(new ValueStateDescriptor&lt;Long&gt;(\"timeOutEvent\", Long.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isPay = getRuntimeContext().getState(new ValueStateDescriptor&lt;Boolean&gt;(\"Pay event has already come\", Boolean.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isCreate = getRuntimeContext().getState(new ValueStateDescriptor&lt;Boolean&gt;(\"Create event has already come\", Boolean.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void processElement(OrderEvent value, Context ctx, Collector&lt;OrderResult&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6765\u4e86\u4e00\u4e2acreate\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"create\".equals(value.getEventType())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6709pay\u4e8b\u4ef6\u5148\u5230\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isPay.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new OrderResult(value.getOrderId(), \"pay\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else { //\u6ca1\u6709pay\u4e8b\u4ef6\u5148\u5230\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6ce8\u518c\u4e00\u4e2a15\u5206\u949f\u7684\u8d85\u65f6\u5b9a\u65f6\u5668\u7b49\u5f85pay\u4e8b\u4ef6\u5230\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isCreate.update(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.update((value.getTimestamp() + 15 * 60) * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(ctx.timestamp() + 15 * 60 * 1000);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (\"pay\".equals(value.getEventType())) { //\u6765\u4e86\u4e00\u4e2apay\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6709create\u4e8b\u4ef6\u5148\u5230\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isCreate.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u672a\u8d85\u65f6\uff0c\u8fd9\u91cc\u5fc5\u987b\u8fd9\u6837\u5224\u65ad\uff0c\u4e0d\u80fd\u4f7f\u7528\u5224\u65ad\u5b9a\u65f6\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (value.getTimestamp() * 1000 &lt; onTimer.value()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new OrderResult(value.getOrderId(), \"pay\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else { //\u652f\u4ed8\u8d85\u65f6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(timeoutOrderOutputTag,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new OrderResult(ctx.getCurrentKey(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"timeout, create time: \" + (onTimer.value() / 1000 - 15 * 60)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isCreate.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isPay.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else { //\u6ca1\u6709create\u4e8b\u4ef6\u5148\u5230\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6ce8\u518c\u4e00\u4e2a\u5b9a\u65f6\u5668\u7b49create\u4e8b\u4ef6\u7684\u5230\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8fd9\u4e2a\u5b9a\u65f6\u5668\u4e8b\u4ef6\u53ef\u4ee5\u8bbe\u7f6e\u77ed\u4e00\u70b9\uff0c\u56e0\u4e3a\u5b9e\u9645\u60c5\u51b5\u662f\u5148create\u518dpay\uff0cpay\u90fd\u6765\u4e86\uff0ccreate\u5e94\u8be5\u5f88\u5feb\u4f1a\u5230\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isPay.update(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.update((value.getTimestamp() + 2) * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(onTimer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;OrderResult&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (isPay.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//15\u5206\u949f\u4e4b\u5185\uff0ccreate\u4e8b\u4ef6\u6ca1\u6709\u7b49\u5230pay\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(timeoutOrderOutputTag,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new OrderResult(ctx.getCurrentKey(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"timeout, create time: \" + (timestamp / 1000 - 15 * 60)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (isCreate.value() != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//pay\u4e8b\u4ef6\u6ca1\u6709\u7b49\u5230create\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(exceptionOrderOutputTag,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new OrderResult(ctx.getCurrentKey(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"exception \u6ca1\u6709create\u4e8b\u4ef6\u5c31\u76f4\u63a5pay\u4e86, pay time: \" + timestamp));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isCreate.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0isPay.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0onTimer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/3-slot%E3%80%81%E5%B9%B6%E8%A1%8C%E5%BA%A6%E4%B8%8E%E4%BB%BB%E5%8A%A1/","title":"3-slot\u3001\u5e76\u884c\u5ea6\u4e0e\u4efb\u52a1","text":"<p> \u7ea6 1596 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 32 \u5206\u949f</p> <p>spark\u9762\u5411\u6279\u6570\u636e\uff0c\u5728\u8ba1\u7b97\u524d\u5148\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u533a\uff0c\u5e76\u884c\u5ea6\u4e0e\u5206\u533a\u7684\u7ed3\u679c\u6709\u5173\uff1b\u4f46flink\u9762\u5411\u6d41\u6570\u636e\uff0c\u65e0\u6cd5\u9884\u5148\u6839\u636e\u5206\u533a\u6765\u51b3\u5b9a\u5e76\u884c\u5ea6\uff0c\u53ea\u80fd\u63d0\u524d\u8bbe\u7f6e\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u3002spark\u7684\u6bcf\u4e2a\u9636\u6bb5\u7684\u5e76\u884c\u5ea6\u90fd\u53ef\u4ee5\u4e0d\u540c\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u9636\u6bb5\u7684\u5206\u533a\u6570\u53ef\u4ee5\u4e0d\u540c\uff0c\u91cd\u70b9\u662fspark\u6bcf\u4e2a\u9636\u6bb5\u7684\u4efb\u52a1\u4f1a\u7ed3\u675f\uff0c\u53ea\u6709\u524d\u4e00\u4e2a\u9636\u6bb5\u7684\u4efb\u52a1\u7ed3\u675f\u4e86\u624d\u4f1a\u5f00\u542f\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684\u4efb\u52a1\uff1b\u4f46\u662fFlink\u7684\u6240\u6709\u4efb\u52a1\u90fd\u4e0d\u4f1a\u7ed3\u675f\uff0c\u5f00\u542f\u4e4b\u540e\u4f1a\u4e00\u76f4\u8fd0\u884c\uff0c\u6240\u4ee5\u9700\u8981\u63d0\u524d\u51b3\u5b9a\u6bcf\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u3002\u5f52\u6839\u7ed3\u5e95\u5c31\u662f\u6279\u6570\u636e\u4e0e\u6d41\u6570\u636e\u7684\u7279\u70b9\u4e0d\u540c\u3002</p> <p>\u5e76\u884c\u5ea6\uff1a\u4e00\u4e2a\u7b97\u5b50\u4f1a\u5728\u4e0d\u540c\u7ebf\u7a0b\u4e0a\u6267\u884c\uff0c\u5177\u4f53\u4f1a\u88ab\u5206\u914d\u5230\u591a\u5c11\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u5c31\u662f\u8fd9\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u3002\u6574\u4e2a\u4f5c\u4e1a\u7684\u5e76\u884c\u5ea6\u6307\u7684\u662f\u6240\u6709\u7b97\u5b50\u4e2d\u6700\u5927\u7684\u5e76\u884c\u5ea6\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7b97\u5b50\u5e76\u884c\u5ea6\u4e4b\u548c\u3002 \u8bbe\u7f6e\u5e76\u884c\u5ea6\u7684\u4f18\u5148\u7ea7\u7531\u9ad8\u5230\u4f4e\uff1a 1.\u8bbe\u7f6e\u6bcf\u4e00\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\uff1a\u6bcf\u4e2a\u7b97\u5b50\u7684setParallelism(2)\u65b9\u6cd5 2.\u6267\u884c\u73af\u5883\u4e2d\u8bbe\u7f6e\u6240\u6709\u7b97\u5b50\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff1aenv.setParallelism(4); 3.\u63d0\u4ea4\u4f5c\u4e1a\u65f6\u5728\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u6307\u5b9a\u5e76\u884c\u5ea6\uff1a-p\u53c2\u6570 4.\u914d\u7f6e\u6587\u4ef6flink-conf.yaml\u4e2d\u7684\u8bbe\u7f6e\u7684\u6240\u6709\u7b97\u5b50\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff1aparallelism.default: 1</p> <p>slot\u3001\u5e76\u884c\u5ea6\u4e0e\u4efb\u52a1\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a 1.TaskManager \u5728\u542f\u52a8\u524d\u5c31\u8bbe\u7f6e\u597d\u4e86\u69fd\u4f4d\u6570\uff08slot\uff09\uff0cslot\u6570\u5c31\u662fTaskManager\u80fd\u542f\u52a8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u6240\u4ee5TaskManager\u7684slot\u6570\u63a8\u8350\u8bbe\u7f6e\u4e3acpu\u7684\u7ebf\u7a0b\u6570\uff0cTaskManager \u4ece JobManager \u5904\u63a5\u6536\u4efb\u52a1\u540e\uff0c\u5c31\u4f1a\u542f\u52a8\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u3002</p> <p>2.\u4e00\u4e2a\u4f5c\u4e1a\u7531\u8bb8\u591a\u7b97\u5b50\u6784\u6210\u4e00\u4e2a\u6570\u636e\u6d41\u56fe\uff0c\u4e00\u4e2a\u7b97\u5b50\u4f1a\u88ab\u5305\u88c5\u6210\u8bb8\u591a\u76f8\u540c\u7684\u4efb\u52a1\uff0c\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e0a\u6267\u884c\uff0c\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u4efb\u52a1\u79f0\u4e3a\u8fd9\u4e2a\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\uff0c\u5b50\u4efb\u52a1\u6570\u91cf\u4e5f\u5c31\u662f\u8fd9\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u3002 \u540c\u4e00\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u5fc5\u987b\u5728\u4e0d\u540c\u7684slot\u4e0a\u6267\u884c\uff0c\u4e0d\u540c\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u4e0d\u7ba1\u662f\u5426\u5177\u6709\u5148\u540e\u5173\u7cfb\u90fd\u53ef\u4ee5\u5728\u540c\u4e00\u4e2aslot\u4e0a\u6267\u884c\uff08\u8fd9\u53eb\u5171\u4eabslot\uff0c\u524d\u63d0\u662f\u7b97\u5b50\u7684slotSharingGroup\u76f8\u540c\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u76f8\u540c\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u5fc5\u987b\u5728\u4e0d\u540c\u7684slot\u4e0a\u6267\u884c\uff0c\u4e0d\u540c\u7b97\u5b50\u7684\u5177\u6709\u5148\u540e\u987a\u5e8f\u7684\u5b50\u4efb\u52a1\u4f1a\u88ab\u5206\u914d\u5230\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u4e0d\u540c\u7b97\u5b50\u7684\u4e0d\u5177\u5907\u5148\u540e\u987a\u5e8f\u7684\u5b50\u4efb\u52a1\u4e5f\u53ef\u4ee5\u5728\u540c\u4e00\u4e2aslot\u4e0a\u6267\u884c\uff0c\u5982A\u548cC\uff0c\u8fd9\u6837\uff0c\u4e00\u4e2a slot \u5c31\u53ef\u4ee5\u4fdd\u5b58\u4f5c\u4e1a\u7684\u6574\u4e2a\u7ba1\u9053\uff08\u6574\u4e2a\u7ba1\u9053\u7684\u610f\u601d\u662f\u5305\u542b\u4e86\u6570\u636e\u6d41\u7684\u4ece\u5934\u81f3\u5c3e\u7684\u6240\u6709\u64cd\u4f5c\uff09\u3002 </p> <p>3.\u56e0\u4e3a\u540c\u4e00\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u5fc5\u987b\u5728\u4e0d\u540c\u7684slot\u4e0a\u6267\u884c\uff0c\u6240\u4ee5\u4e00\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e0d\u80fd\u8d85\u8fc7\u6240\u6709TaskManager\u603b\u7684slot\u6570\uff0c\u4e0d\u7136\u5c31\u65e0\u6cd5\u6ee1\u8db3\u4f5c\u4e1a\u6267\u884c\u7684\u6700\u5c11\u8d44\u6e90\u3002</p> <p>4.\u5982\u679c\u6ca1\u6709\u7ed9\u7b97\u5b50\u8bbe\u7f6eslotSharingGroup\uff0c\u90a3\u4e48\u8be5\u7b97\u5b50\u9ed8\u8ba4\u4e0e\u524d\u4e00\u4e2a\u7b97\u5b50\u5904\u4e8e\u540c\u4e00\u4e2aslotSharingGroup\uff0c\u6240\u4ee5\u5982\u679c\u6240\u6709\u7b97\u5b50\u90fd\u6ca1\u6709\u8bbe\u7f6eslotSharingGroup\uff0c\u90a3\u4e48\u5b83\u4eec\u5c31\u5c5e\u4e8e\u76f8\u540c\u7684\u4e00\u4e2a\u9ed8\u8ba4\u7684slotSharingGroup\uff0c\u53ea\u6709\u5904\u4e8e\u540c\u4e00\u4e2aslotSharingGroup\u7684\u7b97\u5b50\u624d\u80fd\u5206\u914d\u5230\u540c\u4e00\u4e2aslot\u4e2d\u3002</p> <p>5.\u5982\u679c\u76f8\u90bb\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u5e76\u4e14\u5904\u4e8e\u540c\u4e00\u4e2aslotSharingGroup\uff0c\u800c\u4e14\u4e2d\u95f4\u7684\u6570\u636e\u8fd8\u4e0d\u4f1a\u88ab\u6253\u4e71\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u7b97\u5b50\u5c31\u53ef\u88ab\u5408\u5e76\u5230\u4e00\u4e2a\u4efb\u52a1\u4e4b\u4e2d\uff0c\u53ef\u89c1\u4e00\u4e2a\u4f5c\u4e1a\u7684\u4efb\u52a1\u6570 \u5e76\u4e0d\u7b49\u4e8e \u6240\u6709\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e4b\u548c\u3002 \u5982\u4e0b\u4e24\u5f20\u56fe\u8868\u793a\u76f8\u90bb\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u5de6\u56fe\u6570\u636e\u6ca1\u6709\u88ab\u6253\u4e71\uff0c\u800c\u53f3\u56fe\u6570\u636e\u88ab\u6253\u4e71\u4e86\uff0c\u6240\u4ee5\u5de6\u56fe\u7684\u4e24\u4e2a\u7b97\u5b50\u53ef\u4ee5\u88ab\u5408\u5e76\u5230\u540c\u4e00\u4e2a\u4efb\u52a1\u4e4b\u4e2d\u3002 \u5de6\u56fe\u5728Flink\u4e2d\u53eb one-to-one \u6216\u8005 forwarding \u6570\u636e\u4f20\u8f93\u6a21\u5f0f\uff0c\u7c7b\u4f3c\u4e8espark\u7684\u7a84\u4f9d\u8d56\uff1b\u53f3\u56fe\u5728Flink\u4e2d\u53ebRedistributing\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\uff0c\u7c7b\u4f3c\u4e8espark\u7684\u5bbd\u4f9d\u8d56\uff0c\u4e0d\u8fc7Flink\u6ca1\u6709shuffle\u7684\u6982\u5ff5\uff0c\u4f46\u662fFlink\u6709shuffle\u7b97\u5b50\uff0c\u00a0Flink\u7684shuffle\u7b97\u5b50\u4f1a\u5f15\u8d77Redistributing\uff0c\u9664shuffle\u7b97\u5b50\u5916broadcast\u7b97\u5b50\u3001rebalance\u7b97\u5b50\u548ckeyBy\u7b97\u5b50\u4e5f\u4f1aRedistributing\u3002   \u6240\u4ee5\u591a\u4e2a\u7b97\u5b50\u80fd\u88ab\u5408\u5e76\u5230\u540c\u4e00\u4e2a\u4efb\u52a1\u4e4b\u4e2d\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\uff1a\u5e76\u884c\u5ea6\u76f8\u540c\u3001forwarding\u3001\u540c\u4e00\u4e2aslotSharingGroup\u3002\u5728Flink\u4e2d\uff0c\u5c06\u591a\u4e2a\u7b97\u5b50\u5408\u5e76\u5230\u540c\u4e00\u4e2a\u4efb\u52a1\u4e2d\u7684\u6280\u672f\u79f0\u4e3a\u4efb\u52a1\u94fe\uff08Operator Chains\uff09\uff0c \u4efb\u52a1\u94fe\u4f18\u5316\u6280\u672f\u53ef\u4ee5\u51cf\u5c11\u901a\u4fe1\u5f00\u9500\u3002 \u6bd4\u5982\u4ee5\u4e0b\u7a0b\u5e8f Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u63d0\u4ea4\u65f6\u5c06\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u6267\u884c\u56fe\u5982\u4e0b\uff0c\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u5e76\u4e14\u6ee1\u8db3\u53e6\u5916\u4e24\u4e2a\u6761\u4ef6\uff0c\u6240\u4ee5\u4e24\u4e2a\u7b97\u5b50\u4f1a\u5408\u5e76\u5230\u4e00\u4e2a\u4efb\u52a1\u4e2d\u3002  \u63d0\u4ea4\u65f6\u5c06\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a2\u65f6\uff0c\u56e0\u4e3a\u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\u7684source\u7684\u5e76\u884c\u5ea6\u59cb\u7ec8\u4e3a1\uff0c\u4e0d\u4f1a\u53d7\u5230\u8bbe\u7f6e\u7684\u5f71\u54cd\uff0c\u6240\u4ee5\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e0d\u540c\uff0c\u4e8e\u662f\u5c31\u4e0d\u80fd\u5408\u5e76\u6210\u4e00\u4e2a\u4efb\u52a1\u3002\u56e0\u4e3a\u4e24\u4e2a\u4efb\u52a1\u7684\u5e76\u884c\u5ea6\u4e0d\u540c\uff0c\u6240\u4ee5\u4e0a\u6e38\u6570\u636e\u5230\u4e0b\u6e38\u6570\u636e\u7684\u8fc7\u7a0b\u5c31\u4e0d\u662fone-to-one\u7684\u6a21\u5f0f\uff0c\u6570\u636e\u5728\u4e2d\u95f4\u80af\u5b9a\u4f1a\u6709Redistributing\uff0c\u9ed8\u8ba4\u7684Redistributing\u6a21\u5f0f\u662frebalance\uff0c\u5373\u8f6e\u8be2\u4f20\u5230\u4e0b\u6e38\u7684\u6bcf\u4e2a\u5b50\u4efb\u52a1\u4e2d\u3002 </p> <p>\u5728\u591a\u4e2a\u7b97\u5b50\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\u662fforwarding\uff0c\u800c\u4e14\u8fd8\u5728\u540c\u4e00\u4e2aslotSharingGroup\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4e0d\u60f3\u5408\u5e76\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u53ef\u4ee5\u8ba9\u4e0d\u8fdb\u884c\u5408\u5e76\u7684\u7b97\u5b50\u8c03\u7528disableChaining()\u65b9\u6cd5\u53d6\u6d88\u4efb\u52a1\u94fe\u3002\u5982\u679c\u60f3\u76f4\u63a5\u5168\u5c40\u7981\u7528\u4efb\u52a1\u94fe\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u73af\u5883\u4e0a\u8c03\u7528env.disableOperatorChaining()\u3002\u8c03\u7528\u7b97\u5b50\u7684disableChaining()\u65b9\u6cd5\u4f1a\u5bfc\u81f4\u8be5\u7b97\u5b50\u4e0d\u4f1a\u88ab\u5408\u5e76\u5230\u524d\u540e\u7684\u4efb\u52a1\u4e2d\uff0c\u5982\u679c\u53ea\u662f\u60f3\u8be5\u7b97\u5b50\u4e0d\u5408\u5e76\u5230\u524d\u4e00\u4e2a\u4efb\u52a1\uff0c\u800c\u4f1a\u5408\u5e76\u5230\u540e\u4e00\u4e2a\u4efb\u52a1\u4e2d\uff0c\u53ef\u4ee5\u8c03\u7528\u8be5\u7b97\u5b50\u7684startNewChain()\u65b9\u6cd5\u3002</p> Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0 `//\u8bbe\u7f6e\u5e76\u884c\u5ea6`\n `env.setParallelism(1);`\n\u00a0\u00a0 `//\u5173\u95ed\u4efb\u52a1\u94fe`\n `env.disableOperatorChaining();`\n\u00a0\u00a0\u00a0\u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStreamSource&lt;String&gt; dss = env.readTextFile(\"D:\\\\Project\\\\IdeaProjects\\\\Flink\\\\src\\\\main\\\\resources\\\\words.txt\");\n\u00a0\u00a0\u00a0\u00a0//3.\u6d41\u5f0f\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0dss.flatMap(new FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void flatMap(String value, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] words = value.split(\" \");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (String word : words) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple2&lt;&gt;(word, 1));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})`.shuffle().rebalance().broadcast()`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.sum(1)`.slotSharingGroup(\"group1\").disableChaining().startNewChain()`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.print()`.setParallelism(2);`\n\u00a0\u00a0\u00a0\u00a0//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/30-%E6%A1%88%E4%BE%8B%E4%B8%83-%E5%AF%B9%E8%B4%A6/","title":"30-\u6848\u4f8b\u4e03-\u5bf9\u8d26","text":"<p> \u7ea6 501 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u9700\u6c42\uff1a\u8ba2\u5355\u652f\u4ed8\u6210\u529f\u540e5s\u5185\u8d26\u5355\u65e5\u5fd7\u4e0a\u8981\u6709\u76f8\u5e94\u7684\u8bb0\u5f55\uff0c\u6bd4\u5982\uff1a \u8ba2\u5355\u65e5\u5fd7OrderLog.csv\uff1a  \u8d26\u5355\u65e5\u5fd7ReceiptLog.csv\uff1a  \u8ba2\u5355\u65e5\u5fd7\u548c\u8d26\u5355\u65e5\u5fd7\u4e0a\u90fd\u6709\u652f\u4ed8\u6d41\u6c34\u53f7sdafen9932\uff0c\u5219\u8868\u793a\u8fd9\u7b14\u4ea4\u6613\u6b63\u5e38\uff0c\u53cd\u4e4b\u4e0d\u6b63\u5e38\u3002</p> <p>\u6d89\u53ca\u5230\u4e24\u6761\u6d41\u7684\u64cd\u4f5c\u53ef\u4ee5\u7528DataStream\u7684connect()\u65b9\u6cd5\u5f97\u5230ConnectedStreams\u6765\u89e3\u51b3 Text Only<pre><code>public class PayMatch {\n\u00a0\u00a0\u00a0\u00a0// \u5b9a\u4e49\u4fa7\u8f93\u51fa\u6d41\u6807\u7b7e\n\u00a0\u00a0\u00a0\u00a0private final static OutputTag&lt;OrderEvent&gt; unmatchedPays = new OutputTag&lt;OrderEvent&gt;(\"unmatched-pays\") {};\n\u00a0\u00a0\u00a0\u00a0private final static OutputTag&lt;ReceiptEvent&gt; unmatchedReceipts = new OutputTag&lt;ReceiptEvent&gt;(\"unmatched-receipts\") {};\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bfb\u53d6\u8ba2\u5355\u652f\u4ed8\u4e8b\u4ef6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;OrderEvent, String&gt; orderEventKeyedStream = env.readTextFile(\"Data/OrderLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new OrderEvent(Long.valueOf(fields[0]), fields[1], fields[2], Long.valueOf(fields[3]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;OrderEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(OrderEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5fc5\u987b\u662fpay\u4e8b\u4ef6\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.filter(data -&gt; \"pay\".equals(data.getEventType()))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(OrderEvent::getTxId);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bfb\u53d6\u5230\u8d26\u4e8b\u4ef6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;ReceiptEvent, String&gt; receiptEventKeyedStream = env.readTextFile(\"Data/ReceiptLog.csv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.map(line -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ReceiptEvent(fields[0], fields[1], Long.valueOf(fields[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;ReceiptEvent&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public long extractAscendingTimestamp(ReceiptEvent element) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return element.getTimestamp() * 1000L;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.keyBy(ReceiptEvent::getTxId);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConnectedStreams&lt;OrderEvent, ReceiptEvent&gt; connectedStreams = orderEventKeyedStream.connect(receiptEventKeyedStream);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SingleOutputStreamOperator&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; singleOutputStreamOperator = connectedStreams.process(new PayMatchKeyedCoProcessFunction());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.print(\"normal\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.getSideOutput(unmatchedPays).print(\"unmatchedPays\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0singleOutputStreamOperator.getSideOutput(unmatchedReceipts).print(\"unmatchedReceipts\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.execute(\"tx match detect job\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0private static class PayMatchKeyedCoProcessFunction extends KeyedCoProcessFunction&lt;String, OrderEvent, ReceiptEvent, Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private ValueState&lt;ReceiptEvent&gt; receiptEvent;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private ValueState&lt;OrderEvent&gt; orderEvent;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0private ValueState&lt;Long&gt; timer;\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0receiptEvent = getRuntimeContext().getState(new ValueStateDescriptor&lt;ReceiptEvent&gt;(\"ReceiptEvent\", ReceiptEvent.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderEvent = getRuntimeContext().getState(new ValueStateDescriptor&lt;OrderEvent&gt;(\"OrderEvent\", OrderEvent.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timer = getRuntimeContext().getState(new ValueStateDescriptor&lt;Long&gt;(\"onTimer\", Long.class));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//orderEventKeyedStream\u6765\u4e86\u4e00\u4e2aOrderEvent\u4f1a\u8c03\u8fd9\u4e2a\u65b9\u6cd5`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void processElement1(OrderEvent pay, Context ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ReceiptEvent receipt = receiptEvent.value();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (receipt != null) { //\u5982\u679cReceiptEvent\u6765\u8fc7\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple2&lt;&gt;(pay, receipt));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().deleteEventTimeTimer(timer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0receiptEvent.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else { //\u6ca1\u6765\u8fc7\u5c31\u6ce8\u518c\u4e00\u4e2a5s\u5b9a\u65f6\u5668\u7b49ReceiptEvent\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderEvent.update(pay);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timer.update((pay.getTimestamp() + 5) * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(timer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//receiptEventKeyedStream\u6765\u4e86\u4e00\u4e2aReceiptEvent\u4f1a\u8c03\u8fd9\u4e2a\u65b9\u6cd5`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void processElement2(ReceiptEvent receipt, Context ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0OrderEvent pay = orderEvent.value();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (pay != null) { //\u5982\u679cOrderEvent\u6765\u8fc7\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.collect(new Tuple2&lt;&gt;(pay, receipt));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().deleteEventTimeTimer(timer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderEvent.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else { //\u6ca1\u6765\u8fc7\u5c31\u6ce8\u518c\u4e00\u4e2a5s\u5b9a\u65f6\u5668\u7b49OrderEvent\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0receiptEvent.update(receipt);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timer.update((receipt.getTimestamp() + 5) * 1000L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.timerService().registerEventTimeTimer(timer.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void onTimer(long timestamp, OnTimerContext ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8fd9\u4e2a\u5b9a\u65f6\u5668\u89e6\u53d1\u65f6\u80af\u5b9a\u662f\u6709\u4e00\u4e2a\u4e8b\u4ef6\u6ca1\u6709\u6765\uff0c\u5bfc\u81f4\u8d26\u5bf9\u4e0d\u4e0a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (orderEvent.value() != null) { //\u5982\u679c\u662forderEvent\u6ca1\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(unmatchedPays, orderEvent.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (receiptEvent.value() != null) { //\u5982\u679c\u662freceiptEvent\u6ca1\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ctx.output(unmatchedReceipts, receiptEvent.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0receiptEvent.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderEvent.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0timer.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/4-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E7%9A%84%E6%96%B9%E5%BC%8F/","title":"4-\u6570\u636e\u4f20\u8f93\u7684\u65b9\u5f0f","text":"<p> \u7ea6 973 \u4e2a\u5b57  10 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>DataStream\u4e2dkeyBy\u3001shuffle\u3001broadcast\u3001rebalance \u548c global \u5e76\u4e0d\u662f\u505a\u8ba1\u7b97\u7684\u7b97\u5b50\uff0c\u800c\u662f\u5bf9\u4e24\u4e2a\u7b97\u5b50\u4e4b\u95f4\u6570\u636e\u8fdb\u884c\u91cd\u65b0\u5206\u533a\u7684\u64cd\u4f5c\uff0c\u6240\u8c13\u7684\u6570\u636e\u91cd\u65b0\u5206\u533a\u662f\u6307\u975eone-to-one\u7684\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\u3002 \u6240\u8c13one-to-one\u7684\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\u662f\u6307\u524d\u4e00\u4e2a\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u53ea\u5411\u540e\u4e00\u4e2a\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u4f20\u8f93\u6570\u636e\uff0c one-to-one\u4e5f\u79f0\u4e3aforwarding\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a  \u975e one-to-one \u7684\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\uff0c\u662f\u6307\u524d\u4e00\u4e2a\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u7684\u6570\u636e\u4f1a\u88ab\u6253\u4e71\u4f20\u5411\u540e\u4e00\u4e2a\u7b97\u5b50\u7684\u591a\u4e2a\u5b50\u4efb\u52a1\u4e2d\uff0c\u975e one-to-one \u7684\u6570\u636e\u4f20\u8f93\u6a21\u5f0f\u79f0\u4e3aRedistributing\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a  </p> <p>1.forward forward\u7b97\u5b50\u5c31\u662fone-to-one\u7684\u4f20\u8f93\u6a21\u5f0f\uff0c\u5982\u679c\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u5e76\u4e14\u6ca1\u6709\u8c03\u7528\u4e0b\u9762\u7684\u7b97\u5b50\u5c06\u6570\u636e\u6253\u4e71\uff0c\u90a3\u4e48\u9ed8\u8ba4\u5c31\u662fforward\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u4f1a\u8c03\u7528\u8fd9\u4e2a\u7b97\u5b50\u3002\u5982\u679c\u8c03\u7528\u8fd9\u4e2a\u7b97\u5b50\uff0c\u90a3\u4e48\u8981\u6c42\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u5fc5\u987b\u76f8\u540c\u3002</p> <p>2.rebalance \u5f53\u4e0b\u6e38\u7b97\u5b50\u6709\u591a\u4e2a\u5b50\u4efb\u52a1\u65f6\uff0c rebalance\u4f1a\u8f6e\u8be2\u5730\u5c06\u6570\u636e\u53d1\u5230\u4e0b\u6e38\u5b50\u4efb\u52a1\u4e2d\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u63d0\u4ea4\u65f6\u5c06\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a2\u65f6\uff0c\u56e0\u4e3a\u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\u7684source\u7684\u5e76\u884c\u5ea6\u59cb\u7ec8\u4e3a1\uff0c\u4e0d\u4f1a\u53d7\u5230\u8bbe\u7f6e\u7684\u5f71\u54cd\uff0c\u6240\u4ee5\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e0d\u540c\uff0c\u4e8e\u662f\u5c31\u4e0d\u80fd\u5408\u5e76\u6210\u4e00\u4e2a\u4efb\u52a1\u3002\u56e0\u4e3a\u4e24\u4e2a\u4efb\u52a1\u7684\u5e76\u884c\u5ea6\u4e0d\u540c\uff0c\u6240\u4ee5\u4e0a\u6e38\u6570\u636e\u5230\u4e0b\u6e38\u6570\u636e\u7684\u8fc7\u7a0b\u5c31\u4e0d\u662fone-to-one\u7684\u6a21\u5f0f\uff0c\u6570\u636e\u5728\u4e2d\u95f4\u80af\u5b9a\u4f1a\u6709Redistributing\uff0c<code>\u9ed8\u8ba4\u7684Redistributing\u6a21\u5f0f\u662frebalance</code>\uff0c\u5373\u8f6e\u8be2\u4f20\u5230\u4e0b\u6e38\u7684\u6bcf\u4e2a\u5b50\u4efb\u52a1\u4e2d\u3002 </p> <p>\u6216\u8005\u660e\u786e\u6307\u51fa\u6570\u636e\u9700\u8981rebalance Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.`rebalance`().print(\"rebalance\");\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u5373\u4f7f\u63d0\u4ea4\u65f6\u6307\u5b9a\u5e76\u884c\u5ea6\u4e3a1\uff0c\u90a3\u4e48\u4e24\u4e2a\u7b97\u5b50\u4e5f\u4e0d\u80fd\u5408\u5e76\uff0c\u56e0\u4e3a\u4e2d\u95f4\u6709rebalance\u7684\u8fc7\u7a0b\u3002 </p> <p>3.keyBy keyBy\u7684\u4f5c\u7528\u662f\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u533a\u3002keyBy\u4f1a\u6309\u5206\u7ec4\u5b57\u6bb5\u7684hashcode\u503c\u5bf9\u4e0b\u6e38\u5b50\u4efb\u52a1\u6570\u91cf\u53d6\u4f59\uff0c\u5c06\u6570\u636e\u53d1\u5f80\u4e0d\u540c\u7684\u5b50\u4efb\u52a1\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u7ec4\u7684\u6570\u636e\u53d1\u5f80\u540c\u4e00\u4e2a\u5b50\u4efb\u52a1\uff08\u6216\u8005\u8bf4\u5206\u533a\uff09\uff0c\u5f53\u7136\u540c\u4e00\u4e2a\u5b50\u4efb\u52a1\u4e0a\u53ef\u4ee5\u6709\u4e0d\u540c\u7ec4\u7684\u6570\u636e\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0 \u00a0 DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.`keyBy(value -&gt; value)`.print(\"keyBy\");\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u63d0\u4ea4\u65f6\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a2\uff0c\u6267\u884c\u56fe\u5982\u4e0b\uff0c\u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\u7684source\u7684\u5e76\u884c\u5ea6\u59cb\u7ec8\u4e3a1\u3002 </p> <p>4.shuffle \u5f53\u4e0b\u6e38\u7b97\u5b50\u6709\u591a\u4e2a\u5b50\u4efb\u52a1\u65f6\uff0cshuffle\u4f1a\u5c06\u6570\u636e\u968f\u673a\u5206\u914d\u5230\u4e0b\u6e38\u5b50\u4efb\u52a1\u4e2d\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.`shuffle`().print(\"shuffle\");\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u63d0\u4ea4\u65f6\u5e76\u884c\u5ea6\u8bbe\u7f6e\u4e3a1\uff0c\u5373\u4f7f\u4e0b\u6e38\u7b97\u5b50\u5e76\u884c\u5ea6\u4e3a1\u4e5f\u4f1a\u6709shuffle\u7684\u8fc7\u7a0b\uff0c\u4e24\u4e2a\u7b97\u5b50\u4e0d\u80fd\u5408\u5e76\uff0ckeyBy\u4e5f\u662f\u4e00\u6837\u3002 </p> <p>5.broadcast \u5f53\u4e0b\u6e38\u7b97\u5b50\u6709\u591a\u4e2a\u5b50\u4efb\u52a1\u65f6\uff0c broadcast\u4f1a\u5c06\u6bcf\u4e2a\u6570\u636e\u53d1\u5230\u4e0b\u6e38\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u4e2d\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.`broadcast`().print(\"broadcast\").setParallelism(2);;\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre>  \u8f93\u51fa\uff1a Text Only<pre><code>broadcast:2&gt; 1\nbroadcast:1&gt; 1\nbroadcast:2&gt; 2\nbroadcast:1&gt; 2\nbroadcast:1&gt; 3\nbroadcast:2&gt; 3\n</code></pre></p> <p>6.global global\u4f1a\u5c06\u4e0a\u6e38\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u7684\u6570\u636e\u6c47\u805a\u4e0b\u6e38\u7b97\u5b50\u7684\u4e00\u4e2a\u5b50\u4efb\u52a1\u4e2d\u53bb\uff0c\u4e0b\u6e38\u7b97\u5b50\u7684\u5176\u5b83\u5b50\u4efb\u52a1\u5c06\u4f1a\u6ca1\u6709\u6570\u636e\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3);\n\u00a0\u00a0\u00a0\u00a0dataStream.`global`().print(\"global\");\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> </p> <p>7.rescale \u5c06\u4e0a\u6e38\u7b97\u5b50\u7684\u90e8\u5206\u5b50\u4efb\u52a1\u7684\u6570\u636e\u8f6e\u8be2\u5730\u53d1\u9001\u7ed9\u4e0b\u6e38\u7b97\u5b50\u7684\u90e8\u5206\u5b50\u4efb\u52a1\uff0c\u6bd4\u5982\u4e0a\u6e38\u7b97\u5b50\u67092\u4e2a\u5b50\u4efb\u52a1\uff0c\u4e0b\u6e38\u7b97\u5b50\u67094\u4e2a\u5b50\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u4f1a1\u5bf92\u7684\u8f6e\u8be2\u53d1\u9001\u6570\u636e\uff1a  \u5982\u679c\u4e0a\u6e38\u7b97\u5b50\u67094\u4e2a\u5b50\u4efb\u52a1\uff0c\u4e0b\u6e38\u7b97\u5b50\u67092\u4e2a\u5b50\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u4f1a2\u5bf91\u5730\u53d1\u9001\u6570\u636e\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/5-Flink%E7%A8%8B%E5%BA%8F%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%B5%81/","title":"5-Flink\u7a0b\u5e8f\u4e0e\u6570\u636e\u6d41","text":"<p> \u7ea6 273 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>Flink\u7a0b\u5e8f\u4e0e\u6570\u636e\u6d41\uff08 DataFlow\uff09 \u6240\u6709\u7684Flink\u7a0b\u5e8f\u90fd\u662f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\u7684\uff1a Source \u3001 Transformation \u548c Sink\u3002 Source \u8d1f\u8d23\u8bfb\u53d6\u6570\u636e\u6e90\uff0c Transformation \u5229\u7528\u5404\u79cd\u7b97\u5b50\u8fdb\u884c\u5904\u7406\u52a0\u5de5\uff0c Sink\u8d1f\u8d23\u8f93\u51fa\u3002\u00a0\u6bcf\u4e00\u4e2adataflow\u4ee5\u4e00\u4e2a\u6216\u591a\u4e2asources\u5f00\u59cb\u4ee5\u4e00\u4e2a\u6216\u591a\u4e2asinks\u7ed3\u675f\uff0c dataflow\u7c7b\u4f3c\u4e8e\u4efb\u610f\u7684\u6709\u5411\u65e0\u73af\u56fe\uff08 DAG\uff09\u3002 Flink\u7a0b\u5e8f\u4ece\u63d0\u4ea4\u5230\u8fd0\u884c\uff0c\u6574\u4e2adataflow\u9700\u8981\u7ecf\u53864\u4e2a\u56fe\u7684\u53d8\u5316\u8fc7\u7a0b\uff1a StreamGraph -&gt; JobGraph -&gt;ExecutionGraph -&gt; \u7269\u7406\u6267\u884c\u56fe\u3002</p> <ul> <li>StreamGraph\uff1a\u662f\u6839\u636e\u7528\u6237\u901a\u8fc7 Stream API \u7f16\u5199\u7684\u4ee3\u7801\u751f\u6210\u7684\u6700\u521d\u7684\u56fe\u3002\u7528\u6765\u8868\u793a\u7a0b\u5e8f\u7684\u62d3\u6251\u7ed3\u6784\u3002</li> <li>JobGraph\uff1a StreamGraph\u7ecf\u8fc7\u4f18\u5316\u540e\u751f\u6210\u4e86 JobGraph\uff0c\u63d0\u4ea4\u7ed9 JobManager\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e3b\u8981\u7684\u4f18\u5316\u4e3a\uff0c\u5c06\u591a\u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u8282\u70b9\u5408\u5e76\u4e3a\u4e00\u4e2a\u8282\u70b9\u3002</li> <li>ExecutionGraph\uff1a JobManager \u6839\u636e JobGraph \u751f\u6210ExecutionGraph\u3002ExecutionGraph\u662fJobGraph\u7684\u5e76\u884c\u5316\u7248\u672c\uff0c\u662f\u8c03\u5ea6\u5c42\u6700\u6838\u5fc3\u7684\u6570\u636e\u7ed3\u6784\u3002</li> <li>\u7269\u7406\u6267\u884c\u56fe\uff1a JobManager \u6839\u636e ExecutionGraph \u5bf9 Job \u8fdb\u884c\u8c03\u5ea6\u540e\uff0c\u5728\u5404\u4e2aTaskManager \u4e0a\u90e8\u7f72 Task \u540e\u5f62\u6210\u7684\u201c\u56fe\u201d \uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u6570\u636e\u7ed3\u6784\u3002</li> </ul> <p></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/6-Source/","title":"6-Source","text":"<p> \u7ea6 999 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>source\u5c31\u662f\u8bfb\u53d6\u6570\u636e\uff0c\u6dfb\u52a0source\u7684\u901a\u7528\u65b9\u6cd5\u662fDataStream\u7684addSource\u65b9\u6cd5\uff0caddSource\u65b9\u6cd5\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u5b9e\u73b0\u4e86SourceFunction\u63a5\u53e3\u7684\u7c7b\uff0c\u4e3b\u8981\u662f\u5b9e\u73b0SourceFunction\u63a5\u53e3\u7684run\u65b9\u6cd5 \u548c cancel\u65b9\u6cd5\u3002\u4ece\u96c6\u5408\u3001\u6587\u4ef6\u7b49\u5176\u5b83\u6570\u636e\u6e90\u4e2d\u8bfb\u53d6\u6570\u636e\u5176\u5b9e\u90fd\u662faddSource\u4e86\u4e00\u4e2a\u5b9e\u73b0\u4e86SourceFunction\u63a5\u53e3\u7684\u7c7b\u5b9e\u4f8b\u3002 1.\u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e java bean\u7c7b\uff0c\u4f7f\u7528\u4e86lombok Text Only<pre><code>// \u4f20\u611f\u5668\u7c7b\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\n@ToString\npublic class SensorReading {\n\u00a0\u00a0\u00a0\u00a0// \u5c5e\u6027\uff1aid\uff0c\u65f6\u95f4\u6233\uff0c\u6e29\u5ea6\u503c\n\u00a0\u00a0\u00a0\u00a0private String id;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n\u00a0\u00a0\u00a0\u00a0private Double temperature;\n}\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws Exception{\n\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u6d41\u5f0f\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0// \u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = `env.fromCollection(`Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_7\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_10\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0// \u76f4\u63a5\u8bfb\u53d6\u5143\u7d20\u7684\u96c6\u5408\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDataStream = `env.fromElements(`1, 2, 4, 67, 189);\n\u00a0 \u00a0 // \u6253\u5370\u8f93\u51fa\uff0c\u53c2\u6570\u4e3a\u6253\u5370\u65f6\u7684\u524d\u7f00\n\u00a0\u00a0\u00a0\u00a0dataStream.print(\"SensorReading\");\n\u00a0\u00a0\u00a0\u00a0integerDataStream.print(\"Integer\");\n\u00a0 \u00a0 // \u6267\u884c\uff0c\u53c2\u6570\u662fjobName\uff0c\u5373\u7ed9\u4f5c\u4e1a\u53d6\u7684\u4e00\u4e2a\u540d\u5b57\n\u00a0\u00a0\u00a0\u00a0env.execute(\"SourceTest1_Collection\");\n}\n</code></pre> \u8f93\u51fa\u5982\u4e0b\uff0c\u56e0\u4e3aprint\u7684\u5e76\u884c\u5ea6\u7b49\u4e8ecpu\u7684\u7ebf\u7a0b\u6570\uff0c\u6240\u4ee5\u662f\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6253\u5370\uff0c\u5b8c\u5168\u4e71\u5e8f\u3002 Text Only<pre><code>Integer:9&gt; 4\nSensorReading:8&gt; SensorReading(id=sensor_1, timestamp=1547718199, temperature=35.8)\nSensorReading:10&gt; SensorReading(id=sensor_7, timestamp=1547718202, temperature=6.7)\nSensorReading:9&gt; SensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading:11&gt; SensorReading(id=sensor_10, timestamp=1547718205, temperature=38.1)\nInteger:7&gt; 1\nInteger:8&gt; 2\nInteger:11&gt; 189\nInteger:10&gt; 67\n</code></pre> \u7528\u4e8e\u8bfb\u53d6\u6570\u636e\u7684 env.fromCollection \u548c env.fromElements \u7684\u5e76\u884c\u5ea6\u4e3a1\uff0cprint\u7684\u5e76\u884c\u5ea6\u7b49\u4e8ecpu\u7684\u7ebf\u7a0b\u6570\uff0c\u6240\u4ee5\u4efb\u52a1\u6267\u884c\u60c5\u51b5\u5982\u4e0b\uff1a </p> <p>\u5982\u679c\u8bbe\u7f6e\u5176\u4e2d\u4e00\u4e2aprint\u7684\u5e76\u884c\u5ea6\u4e3a1 Text Only<pre><code>public static void main(String[] args) throws Exception{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u6d41\u5f0f\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_7\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_10\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u76f4\u63a5\u8bfb\u53d6\u5143\u7d20\u7684\u96c6\u5408\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDataStream = env.fromElements(1, 2, 4, 67, 189);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6253\u5370\u8f93\u51fa\uff0c\u53c2\u6570\u4e3a\u6253\u5370\u65f6\u7684\u524d\u7f00\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dataStream.print(\"SensorReading\")`.setParallelism(1);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0integerDataStream.print(\"Integer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6267\u884c\uff0c\u53c2\u6570\u662fjobName\uff0c\u5373\u7ed9\u4f5c\u4e1a\u53d6\u7684\u4e00\u4e2a\u540d\u5b57\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.execute(\"SourceTest1_Collection\");\n\u00a0\u00a0\u00a0\u00a0}\n</code></pre> \u90a3\u4e48\u5e76\u884c\u5ea6\u4e3a1\u7684print\u7684\u8f93\u51fa\u5c31\u4f1a\u4fdd\u6301\u8bfb\u53d6\u6570\u636e\u65f6\u7684\u987a\u5e8f\uff1a Text Only<pre><code>SensorReading&gt; SensorReading(id=sensor_1, timestamp=1547718199, temperature=35.8)\nSensorReading&gt; SensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading&gt; SensorReading(id=sensor_7, timestamp=1547718202, temperature=6.7)\nSensorReading&gt; SensorReading(id=sensor_10, timestamp=1547718205, temperature=38.1)\nInteger:8&gt; 4\nInteger:6&gt; 1\nInteger:10&gt; 189\nInteger:7&gt; 2\nInteger:9&gt; 67\n</code></pre> \u8fd9\u4e2a\u65f6\u5019\u4efb\u52a1\u6267\u884c\u7684\u60c5\u51b5\u662f\uff1a </p> <p>\u5982\u679c\u76f4\u63a5\u8bbe\u7f6e\u6267\u884c\u73af\u5883\u7684\u5e76\u884c\u5ea6\u4e3a1\uff0c\u8fd9\u4e24\u4e2aprint\u7684\u5e76\u884c\u5ea6\u90fd\u4e3a1\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception{\n\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u6d41\u5f0f\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u5e76\u884c\u5ea6\u4e3a1\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0// \u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_7\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_10\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0// \u76f4\u63a5\u8bfb\u53d6\u5143\u7d20\u7684\u96c6\u5408\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDataStream = env.fromElements(1, 2, 4, 67, 189);\n\u00a0\u00a0\u00a0\u00a0// \u6253\u5370\u8f93\u51fa\uff0c\u53c2\u6570\u4e3a\u6253\u5370\u65f6\u7684\u524d\u7f00\n\u00a0\u00a0\u00a0\u00a0dataStream.print(\"SensorReading\");\n\u00a0\u00a0\u00a0\u00a0integerDataStream.print(\"Integer\");\n\u00a0\u00a0\u00a0\u00a0// \u6267\u884c\uff0c\u53c2\u6570\u662fjobName\uff0c\u5373\u7ed9\u4f5c\u4e1a\u53d6\u7684\u4e00\u4e2a\u540d\u5b57\n\u00a0\u00a0\u00a0\u00a0env.execute(\"SourceTest1_Collection\");\n}\n</code></pre> \u5219\u4e24\u4e2aprint\u7684\u8f93\u51fa\u90fd\u4f1a\u4fdd\u6301\u8bfb\u53d6\u6570\u636e\u65f6\u7684\u987a\u5e8f\uff1a Text Only<pre><code>Integer&gt; 1\nInteger&gt; 2\nInteger&gt; 4\nInteger&gt; 67\nInteger&gt; 189\nSensorReading&gt; SensorReading(id=sensor_1, timestamp=1547718199, temperature=35.8)\nSensorReading&gt; SensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading&gt; SensorReading(id=sensor_7, timestamp=1547718202, temperature=6.7)\nSensorReading&gt; SensorReading(id=sensor_10, timestamp=1547718205, temperature=38.1)\n</code></pre> \u6b64\u65f6\u4efb\u52a1\u6267\u884c\u7684\u60c5\u51b5\u662f\uff1a </p> <p>2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e Text Only<pre><code>public static void main(String[] args) throws Exception{\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0// \u4ece\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = `env.readTextFile`(\"words.txt\");\n\u00a0\u00a0\u00a0\u00a0// \u6253\u5370\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0dataStream.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>3.\u4ecekafka\u4e2d\u8bfb\u53d6\u6570\u636e \u5f15\u5165 kafka \u8fde\u63a5\u5668\u7684\u4f9d\u8d56\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;flink-connector-kafka-0.11_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws Exception{\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0properties.setProperty(\"bootstrap.servers\", \"hadoop102:9092,hadoop103:9092,hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0properties.setProperty(\"group.id\", \"consumer-group\");\n\u00a0\u00a0\u00a0\u00a0properties.setProperty(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0properties.setProperty(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0properties.setProperty(\"auto.offset.reset\", \"latest\");\n\u00a0\u00a0\u00a0\u00a0// \u4ecekafka\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;String&gt; dataStream = env.`addSource(new FlinkKafkaConsumer011&lt;&gt;(\"flink-topic01\", new SimpleStringSchema(), properties));`\n\u00a0\u00a0\u00a0\u00a0// \u6253\u5370\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0dataStream.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>4.\u81ea\u5b9a\u4e49Source \u81ea\u5b9a\u4e49\u7684Source\u9700\u8981\u5b9e\u73b0SourceFunction\u63a5\u53e3\uff1a Text Only<pre><code>// \u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684SourceFunction\npublic static class MySource `implements SourceFunction&lt;Double&gt;` {\n\u00a0\u00a0\u00a0\u00a0// \u5b9a\u4e49\u4e00\u4e2a\u6807\u8bc6\u4f4d\uff0c\u7528\u6765\u63a7\u5236\u6570\u636e\u7684\u4ea7\u751f\n\u00a0\u00a0\u00a0\u00a0private boolean flag = true;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void run(SourceContext&lt;Double&gt; sourceContext) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5b9a\u4e49\u4e00\u4e2a\u968f\u673a\u6570\u53d1\u751f\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Random random = new Random();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (flag) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sourceContext.collect(random.nextGaussian() * 20);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u63a7\u5236\u8f93\u51fa\u9891\u7387\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void cancel() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0flag = false;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0// \u4ece\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Double&gt; dataStream = `env.addSource(new MySource());`\n\u00a0\u00a0\u00a0\u00a0// \u6253\u5370\u8f93\u51fa\n\u00a0\u00a0\u00a0\u00a0dataStream.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u5982\u679c\u60f3\u8981\u5728\u81ea\u5b9a\u4e49Source\u4e2d\u83b7\u53d6\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u53ef\u4ee5\u5b9e\u73b0SourceFunction\u63a5\u53e3\u5b50\u62bd\u8c61\u7c7bRichSourceFunction\uff0c\u5982\u679c\u60f3\u8981\u5e76\u884c\u7684\u83b7\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u5b9e\u73b0ParallelSourceFunction\u63a5\u53e3\u6216\u8005RichParallelSourceFunction\u63a5\u53e3\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/7-DataStream%20%E7%9A%84%20Transform%20%E7%AE%97%E5%AD%90/","title":"7-DataStream \u7684 Transform \u7b97\u5b50","text":"<p> \u7ea6 1593 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 32 \u5206\u949f</p> <p>1.map \u4e00\u5bf9\u4e00\u7684\u8f6c\u6362  Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStreamSource&lt;String&gt; dss = env.readTextFile(\"words.txt\");\n\u00a0\u00a0\u00a0\u00a0//3.map\n\u00a0\u00a0\u00a0\u00a0dss`.map(String::length)`.print(\"map\");\n\u00a0\u00a0\u00a0\u00a0//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>2.flatMap \u53ef\u4ee5\u4e00\u5bf9\u96f6\uff0c\u4e00\u5bf9\u4e00\uff0c\u8fd8\u53ef\u4ee5\u4e00\u5bf9\u591a\uff0c\u770bout.collect()\u4e2d\u5177\u4f53\u7ed9\u7684\u662f\u4ec0\u4e48\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStreamSource&lt;String&gt; dss = env.readTextFile(\"words.txt\");\n\u00a0\u00a0\u00a0\u00a0//3.flatMap\n\u00a0\u00a0\u00a0\u00a0dss`.flatMap(new FlatMapFunction&lt;String, String&gt;() {`\n `@Override`\n `public void flatMap(String value, Collector&lt;String&gt; out) throws Exception {`\n `String[] split = value.split(\" \");`\n `for (String str : split) {`\n `out.collect(str);`\n `}`\n `}`\n `})`.print(\"FlatMap\");\n\u00a0\u00a0\u00a0\u00a0//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>3.filter \u8fc7\u6ee4  Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0//1.\u521b\u5efa\u6d41\u5904\u7406\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0//2.\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStreamSource&lt;String&gt; dss = env.readTextFile(\"words.txt\");\n\u00a0\u00a0\u00a0\u00a0//3.filter\n\u00a0\u00a0\u00a0\u00a0`dss.filter(value -&gt; value.startsWith(\"hello\"))`.print(\"filter\");\n\u00a0\u00a0\u00a0\u00a0//4.\u542f\u52a8\u6d41\u5f0f\u8ba1\u7b97\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre></p> <p>4.keyBy \u4f7f\u7528Flink\u7684\u805a\u5408\u7b97\u5b50\u505a\u805a\u5408\u65f6\u5fc5\u987b\u5148\u5206\u7ec4\uff0c\u4f7f\u7528keyBy\u53ef\u4ee5\u5bf9\u6d41\u6570\u636e\u6309\u6307\u5b9a\u7684\u5b57\u6bb5\u5206\u7ec4\uff0ckeyBy\u4f1a\u5c06DataStream\u8f6c\u6362\u6210KeyedStream\uff0c\u53ea\u6709KeyedStream\u4e2d\u624d\u6709\u805a\u5408\u7b97\u5b50\uff0c\u4e0d\u8fc7KeyedStream\u4e5f\u662f\u7ee7\u627f\u81eaDataStream\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u76f4\u63a5\u5bf9DataStream\u505a\u805a\u5408\u5462\uff1f\u56e0\u4e3a\u6d41\u6570\u636e\u7684\u7279\u70b9\u662f\u6570\u636e\u6e90\u6e90\u4e0d\u65ad\u5730\u6765\uff0c\u6ca1\u6709\u5c3d\u5934\uff0c\u6240\u4ee5\u65e0\u6cd5\u505a\u5230\u50cfspark\u6279\u5904\u7406\u90a3\u6837\u53ef\u4ee5\u5148\u5c06\u6570\u636e\u5212\u5206\u5230\u4e0d\u540c\u7684\u5206\u533a\u505a\u9884\u805a\u5408\uff0c\u518d\u5bf9\u9884\u805a\u5408\u7684\u7ed3\u679c\u518d\u505a\u805a\u5408\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u76f4\u63a5\u5bf9DataStream\u505a\u805a\u5408\u7684\u8bdd\u5c31\u8981\u6c42\u6240\u6709\u6570\u636e\u90fd\u5230\u4e00\u4e2a\u4efb\u52a1\u4e2d\u505a\u8ba1\u7b97\uff0c\u8fd9\u5c31\u4e0d\u662f\u5206\u5e03\u5f0f\u6d41\u8ba1\u7b97\u4e86\u3002\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u5148\u5bf9\u6570\u636e\u5206\u7ec4\uff0c\u628a\u6bcf\u4e00\u7ec4\u7684\u6570\u636e\u5206\u5230\u4e0d\u540cslot\u7684\u5b50\u4efb\u52a1\u4e0a\uff0c\u518d\u5bf9\u6bcf\u4e00\u7ec4\u7684\u6570\u636e\u505a\u805a\u5408\u3002\uff08\u5982\u679c\u60f3\u76f4\u63a5\u5bf9\u6240\u6709\u6570\u636e\u505a\u805a\u5408\uff0c\u53ef\u4ee5\u5148map\u52a0\u4e0a\u4e00\u4e2a\u76f8\u540c\u7684\u5206\u7ec4\u5b57\u6bb5\u7136\u540e\u805a\u5408\uff09 \u56e0\u4e3akeyBy\u5206\u7ec4\u540e\u4f1a\u628a\u6570\u636e\u53d1\u9001\u5230\u4e0d\u540cslot\u7684\u4e0b\u6e38\u5b50\u4efb\u52a1\u4e0a\uff0c\u6240\u4ee5keyBy\u4f1a\u53d1\u751f\u6570\u636e\u7684Redistributing\uff0c\u5176\u91cd\u5206\u533a\u7684\u5177\u4f53\u505a\u6cd5\u662f\uff0ckeyBy\u4f1a\u6309\u5206\u7ec4\u5b57\u6bb5\u7684hashcode\u503c\u5bf9\u4e0b\u6e38\u5b50\u4efb\u52a1\u6570\u91cf\u53d6\u4f59\uff0c\u5c06\u6570\u636e\u53d1\u5f80\u4e0d\u540c\u7684\u5b50\u4efb\u52a1\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u7ec4\u7684\u6570\u636e\u53d1\u5f80\u540c\u4e00\u4e2a\u5b50\u4efb\u52a1\uff08\u6216\u8005\u8bf4\u5206\u533a\uff09\uff0c\u5f53\u7136\u540c\u4e00\u4e2a\u5b50\u4efb\u52a1\u4e0a\u53ef\u4ee5\u6709\u4e0d\u540c\u7ec4\u7684\u6570\u636e\u3002  keyBy\u6709\u4e09\u4e2a\u91cd\u8f7d\u7684\u65b9\u6cd5\uff0c\u8fd4\u56de\u503c\u5747\u662fKeyedStream\uff0c\u7b2c\u4e00\u4e2a\u6cdb\u578b\u53c2\u6570\u662fDataStream\u4e2d\u6570\u636e\u7c7b\u578b\uff0c\u7b2c\u4e8c\u4e2a\u6cdb\u578b\u53c2\u6570\u662f\u6307\u5b9a\u7684\u5206\u7ec4\u5b57\u6bb5\u7684\u7c7b\u578b\u3002 \u6b64\u65b9\u6cd5\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u51fd\u6570\u5f0f\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u8be5\u51fd\u6570\u5f0f\u63a5\u53e3\u7684\u5b9e\u73b0\u7528\u4e8e\u6307\u660e\u5206\u7ec4\u7684\u5b57\u6bb5 Text Only<pre><code>KeyedStream&lt;T, K&gt; keyBy(KeySelector&lt;T, K&gt; key)\n</code></pre> \u6b64\u65b9\u6cd5\u9700\u8981\u4f20\u9012\u5206\u7ec4\u5b57\u6bb5\u5728\u5143\u7ec4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u8be5\u65b9\u6cd5\u53ea\u9002\u7528\u4e8eDataStream\u4e2d\u7684\u6570\u636e\u662f\u5143\u7ec4\u7c7b\u578b\uff0c\u7531\u4e8e\u5206\u7ec4\u7684\u5b57\u6bb5\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u6240\u4ee5KeyedStream\u7684\u7b2c\u4e8c\u4e2a\u6cdb\u578b\u53c2\u6570\u662f\u4e00\u4e2a\u5143\u7ec4\u7c7b\u578b Text Only<pre><code>KeyedStream&lt;T, Tuple&gt; keyBy(int... fields)\n</code></pre> \u6b64\u65b9\u6cd5\u9700\u8981\u4f20\u9012Pojo\u7c7b\u5b57\u6bb5\u7684\u540d\u5b57\uff0ckeyBy\u4f1a\u4ee5pojo\u7c7b\u5b57\u6bb5\u7684\u503c\u6765\u5206\u7ec4\uff0c\u6240\u4ee5\u6b64\u65b9\u6cd5\u53ea\u9002\u7528\u4e8eDataStream\u4e2d\u7684\u6570\u636e\u662fpojo\u7c7b\u578b\uff0c\u540c\u6837\u7531\u4e8e\u5206\u7ec4\u7684\u5b57\u6bb5\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u6240\u4ee5KeyedStream\u7684\u7b2c\u4e8c\u4e2a\u6cdb\u578b\u53c2\u6570\u662f\u4e00\u4e2a\u5143\u7ec4\u7c7b\u578b Text Only<pre><code>KeyedStream&lt;T, Tuple&gt; keyBy(String... fields)\n</code></pre> <p>\u4ee5\u4e0b\u805a\u5408\u7b97\u5b50\u90fd\u662f KeyedStream \u7c7b\u4e2d\u7684\u65b9\u6cd5\uff0c\u53ea\u6709KeyedStream\u624d\u53ef\u4ee5\u4f7f\u7528\uff0cKeyedStream\u662fDataStream\u7684\u5b50\u7c7b\u3002 5.\u6eda\u52a8\u805a\u5408\u7b97\u5b50 \u6eda\u52a8\u805a\u5408\u7b97\u5b50\u53ef\u4ee5\u5bf9 KeyedStream \u7684\u6bcf\u4e00\u4e2a\u652f\u6d41\uff08\u5373\u6bcf\u4e00\u7ec4\uff09\u505a\u805a\u5408\u3002</p> <ul> <li>sum()</li> <li>min()</li> <li>max()</li> <li>minBy()</li> <li>maxBy()</li> </ul> <p>max\u7b97\u5b50\u6709\u4e24\u4e2a\u91cd\u8f7d\u7684\u65b9\u6cd5\uff1a \u7b2c\u4e00\u4e2a\u5bf9\u6307\u5b9a\u7684pojo\u7c7b\u7684\u5b57\u6bb5\u505a\u805a\u5408 Text Only<pre><code>SingleOutputStreamOperator&lt;T&gt; max(String field)\n</code></pre> \u7b2c\u4e8c\u4e2a\u65b9\u6cd5\u5bf9\u6307\u5b9a\u7684\u5143\u7ec4\u5143\u7d20\u7684\u4f4d\u7f6e\u505a\u805a\u5408 Text Only<pre><code>SingleOutputStreamOperator&lt;T&gt; max(int positionToMax)\n</code></pre></p> <p>pojo\u7c7b Text Only<pre><code>// \u4f20\u611f\u5668\u7c7b\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\n@ToString\npublic class SensorReading {\n\u00a0\u00a0\u00a0\u00a0// \u5c5e\u6027\uff1aid\uff0c\u65f6\u95f4\u6233\uff0c\u6e29\u5ea6\u503c\n\u00a0\u00a0\u00a0\u00a0private String id;\n\u00a0\u00a0\u00a0\u00a0private Long timestamp;\n\u00a0\u00a0\u00a0\u00a0private Double temperature;\n}\n</code></pre> \u6309pojo\u7c7b\u7684id\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5bf9pojo\u7c7b\u7684temperature\u5b57\u6bb5\u505a\u805a\u5408\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u6d41\u5f0f\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0//KeyedStream&lt;SensorReading, String&gt; keyedStream = dataStream.keyBy(SensorReading::getId);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;SensorReading, Tuple&gt; keyedStream = `dataStream.keyBy(\"id\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; maxSensorReading = `keyedStream.max(\"temperature\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0maxSensorReading.print();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0env.execute();\n\u00a0\u00a0\u00a0\u00a0}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>SensorReading(id=sensor_1, timestamp=`1547718199`, temperature=35.8)\nSensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading(id=sensor_1, timestamp=1547718199, temperature=35.8)\nSensorReading(id=sensor_1, timestamp=`1547718199`, temperature=38.1)\n</code></pre> \u4ece\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\uff1a 1.\u6d41\u5f0f\u8ba1\u7b97\u662f\u6765\u4e00\u6761\u6570\u636e\u5c31\u505a\u4e00\u6b21\u8ba1\u7b97\uff0c\u6240\u4ee5\u67094\u6761\u6570\u636e\u5c31\u4f1a\u67094\u4e2a\u8f93\u51fa 2.max\u662f\u5bf9pojo\u7c7b\u7684temperature\u5b57\u6bb5\u505a\u805a\u5408\uff0c\u6240\u4ee5\u5f53\u5c5e\u4e8e\u540c\u4e00\u7ec4\u7684\u6570\u636e\u8fc7\u6765\u505a\u8ba1\u7b97\u65f6\uff0cmax\u7b97\u5b50\u53ea\u4f1a\u6539\u53d8\u72b6\u6001\u7684temperature\u5b57\u6bb5\uff0c\u4e0d\u4f1a\u6539\u53d8\u72b6\u6001\u7684timestamp\u7b49\u5176\u5b83\u5b57\u6bb5\u7684\u503c\u3002Flink\u662f\u57fa\u4e8e\u72b6\u6001\u66f4\u65b0\u505a\u6d41\u5f0f\u8ba1\u7b97\u7684\uff0c\u8fd9\u91cc\u7684\u72b6\u6001\u5c31\u662f\u6307\u524d\u4e00\u6b21\u7684\u805a\u5408\u7684\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5728taskManager\u7684\u5185\u5b58\u4e2d\u3002</p> <p>\u540c\u6837\uff0csum\u7b97\u5b50\u548cmin\u7b97\u5b50\u4e5f\u53ea\u4f1a\u6539\u53d8\u72b6\u6001\u4e2d\u6307\u5b9a\u505a\u805a\u5408\u5b57\u6bb5\u7684\u503c\uff0c\u5e76\u4e0d\u4f1a\u6539\u53d8\u72b6\u6001\u4e2d\u5176\u5b83\u5b57\u6bb5\u7684\u503c\uff0c\u4f46\u662f\uff0cminBy\u7b97\u5b50\u548cmaxBy\u7b97\u5b50\u4f1a\u6539\u53d8\u72b6\u6001\u4e2d\u5176\u5b83\u5b57\u6bb5\u7684\u503c\uff0c\u4e5f\u5c31minBy\u548cmaxBy\u4f1a\u76f4\u63a5\u7528\u7b26\u5408\u8981\u6c42\u7684\u6574\u4e2a\u6570\u636e\u66ff\u6362\u4e4b\u524d\u7684\u72b6\u6001\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u6d41\u5f0f\u6267\u884c\u73af\u5883\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0// \u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;SensorReading, String&gt; keyedStream = dataStream`.keyBy(SensorReading::getId);`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; maxSensorReading = keyedStream`.maxBy(\"temperature\");`\n\u00a0\u00a0\u00a0\u00a0maxSensorReading.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>SensorReading(id=sensor_1, timestamp=`1547718199`, temperature=35.8)\nSensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading(id=sensor_1, timestamp=1547718199, temperature=35.8)\nSensorReading(id=sensor_1, timestamp=`1547718205`, temperature=38.1)\n</code></pre></p> <p>6.reduce sum\u7b97\u5b50\u53ea\u4f1a\u6539\u53d8\u72b6\u6001\u4e2d\u505a\u805a\u5408\u7684\u5b57\u6bb5\u7684\u503c\uff0c\u4e0d\u4f1a\u6539\u53d8\u72b6\u6001\u5176\u5b83\u5b57\u6bb5\u7684\u503c\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;SensorReading, String&gt; keyedStream = dataStream.`keyBy(SensorReading::getId);`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; maxSensorReading = keyedStream.`sum(\"temperature\");`\n\u00a0\u00a0\u00a0\u00a0maxSensorReading.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>SensorReading(id=sensor_1, timestamp=`1547718199`, temperature=35.8)\nSensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading(id=sensor_1, timestamp=`1547718199`, temperature=42.5)\nSensorReading(id=sensor_1, timestamp=`1547718199`, temperature=80.6)\n</code></pre></p> <p>\u5982\u679c\u60f3\u8981\u5728\u805a\u5408\u65f6\u4f1a\u6539\u53d8\u72b6\u6001\u4e2d\u5176\u5b83\u5b57\u6bb5\u7684\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528\u66f4\u901a\u7528\u7684\u805a\u5408\u64cd\u4f5creduce\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718199L, 35.8),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_6\", 1547718201L, 15.4),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718202L, 6.7),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new SensorReading(\"sensor_1\", 1547718205L, 38.1)\n\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0KeyedStream&lt;SensorReading, String&gt; keyedStream = dataStream.keyBy(SensorReading::getId);\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;SensorReading&gt; maxSensorReading = `keyedStream.reduce((v1, v2) -&gt; new SensorReading(v2.getId(), v2.getTimestamp(), v1.getTemperature() + v2.getTemperature()));`\n\u00a0\u00a0\u00a0\u00a0maxSensorReading.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>SensorReading(id=sensor_1, timestamp=`1547718199`, temperature=35.8)\nSensorReading(id=sensor_6, timestamp=1547718201, temperature=15.4)\nSensorReading(id=sensor_1, timestamp=`1547718202`, temperature=42.5)\nSensorReading(id=sensor_1, timestamp=`1547718205`, temperature=80.6)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/8-DataStream%20%E7%9A%84%20Transform%20%E7%AE%97%E5%AD%90%EF%BC%88%E7%BB%AD%EF%BC%89/","title":"8-DataStream \u7684 Transform \u7b97\u5b50\uff08\u7eed\uff09","text":"<p> \u7ea6 700 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>\u4ee5\u4e0b\u7b97\u5b50\u5747\u662f\u5bf9\u591a\u6761\u6d41\u7684\u64cd\u4f5c\uff1aSplit \u548c Select\u3001Connect \u548c CoMap\u3001Union</p> <p>7.Split \u548c Select split\u7b97\u5b50 \u548c SplitStream\u7684select\u7b97\u5b50 \u642d\u914d\u4f7f\u7528\u53ef\u4ee5\u5b9e\u73b0\u5206\u6d41\u7684\u6548\u679c\u3002split\u7b97\u5b50\u6309\u6761\u4ef6\u7ed9\u6d41\u7684\u6bcf\u4e00\u4e2a\u6570\u636e\u6253\u4e0a\u6807\u7b7e\uff0c\u4e00\u4e2a\u6570\u636e\u53ef\u4ee5\u6709\u591a\u4e2a\u6807\u7b7e\uff0c\u7528\u96c6\u5408\u8868\u793a\uff1b\u7136\u540e\u4f7f\u7528SplitStream\u7684select\u7b97\u5b50\u62ff\u5230\u6807\u7b7e\u5bf9\u5e94\u7684\u6d41\u3002split\u7b97\u5b50\u4f1a\u5c06DataStream\u8f6c\u5316\u6210SplitStream\uff0cSplitStream\u662fDataStream\u7684\u5b50\u7c7b\uff0cSplitStream\u7684select\u7b97\u5b50\u4f1a\u5c06SplitStream\u8f6c\u6362\u6210DataStream\uff0cSplitStream\u53ea\u6709select\u8fd9\u4e00\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u8c03\u7528\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; tuple2DataStream = env.fromCollection(Arrays.asList(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Tuple2&lt;&gt;('a', 1), new Tuple2&lt;&gt;('b', 2), new Tuple2&lt;&gt;('c', 3),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Tuple2&lt;&gt;('d', 4), new Tuple2&lt;&gt;('e', 5), new Tuple2&lt;&gt;('f', 6)\n\u00a0\u00a0\u00a0\u00a0));\n\u00a0\u00a0\u00a0\u00a0`SplitStream`&lt;Tuple2&lt;Character, Integer&gt;&gt; splitStream = `tuple2DataStream.split(tuple2 -&gt; {`\n `if (tuple2.f1 &lt;= 2) {`\n `return List.of(\"one\", \"&lt;=2\");`\n `} else if (tuple2.f1 &lt;= 4) {`\n `return List.of(\"two\", \"&gt;2 &amp;&amp; &lt;=4\");`\n `} else {`\n `return List.of(\"three\", \"&gt;4\");`\n `}`\n `});`\n\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; oneStream = splitStream`.select(\"one\");`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; twoStream = splitStream`.select(\"two\");`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; threeStream = splitStream`.select(\"three\");`\n\u00a0\u00a0\u00a0\u00a0oneStream.print(\"oneStream\");\n\u00a0\u00a0\u00a0\u00a0twoStream.print(\"twoStream\");\n\u00a0\u00a0\u00a0\u00a0threeStream.print(\"threeStream\");\n\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; stream01 = splitStream`.select(\"&lt;=2\");`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; stream02 = splitStream`.select(\"&gt;2 &amp;&amp; &lt;=4\");`\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Tuple2&lt;Character, Integer&gt;&gt; stream03 = splitStream`.select(\"&gt;4\");`\n\u00a0\u00a0\u00a0\u00a0stream01.print(\"stream01\");\n\u00a0\u00a0\u00a0\u00a0stream02.print(\"stream02\");\n\u00a0\u00a0\u00a0\u00a0stream03.print(\"stream03\");\n\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>oneStream:14&gt; (a,1)\ntwoStream:13&gt; (d,4)\nthreeStream:1&gt; (e,5)\ntwoStream:12&gt; (c,3)\noneStream:15&gt; (b,2)\nthreeStream:2&gt; (f,6)\nstream01:10&gt; (a,1)\nstream01:11&gt; (b,2)\nstream02:8&gt; (c,3)\nstream02:9&gt; (d,4)\nstream03:14&gt; (f,6)\nstream03:13&gt; (e,5)\n</code></pre></p> <p>8.Connect \u548c CoMap Connect\u7b97\u5b50 \u548c ConnectedStreams\u7684map\u7b97\u5b50 \u642d\u914d\u4f7f\u7528\u53ef\u4ee5\u5b9e\u73b0\u5408\u6d41\u7684\u6548\u679c\u3002Connect\u7684\u4e24\u4e2aDataStream\u7684\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u4e0d\u540c\uff0c\u4e24\u4e2aDataStream\u5728\u8c03\u7528Connect\u4e4b\u540e\u5c31\u53d8\u6210\u4e86ConnectedStreams\uff0c\u5b9e\u73b0\u4e86\u5f62\u5f0f\u4e0a\u7684\u5408\u6d41\uff0c\u6240\u8c13\u5f62\u5f0f\u4e0a\u7684\u5408\u6d41\uff0c\u5c31\u662f\u5728\u8c03\u7528ConnectedStreams\u7684\u7b97\u5b50\u65f6\u8fd8\u662f\u5206\u522b\u5bf9ConnectedStreams\u4e2d\u4e24\u6761\u6d41\u5728\u8fdb\u884c\u8ba1\u7b97\uff0c\u53ea\u6709\u5728\u8c03\u7528ConnectedStreams\u7684map\u7b97\u5b50\u5c06\u4e24\u4e2aDataStream\u4e2d\u7684\u6570\u636e\u8f6c\u6362\u6210\u4e00\u79cd\u6570\u636e\u6570\u636e\u7c7b\u578b\u540e\u624d\u771f\u6b63\u5730\u5b9e\u73b0\u5408\u6d41\u7684\u6548\u679c\u3002 Connect\u7b97\u5b50\u4f1a\u5c06DataStream\u8f6c\u6362\u6210ConnectedStreams\uff0cConnectedStreams\u4e0d\u662fDataStream\u7684\u5b50\u7c7b\uff0cConnectedStreams\u7684map\u7b97\u5b50\u4f1a\u5c06 ConnectedStreams\u8f6c\u6362\u6210DataStream\uff0cConnectedStreams\u9664map\u7b97\u5b50\u5916\u8fd8\u6709\u8bb8\u591a\u5176\u5b83\u7684\u7b97\u5b50\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u90fd\u662f\u5206\u522b\u5bf9 ConnectedStreams\u4e2d\u7684\u4e24\u6761\u6d41\u8fdb\u884c\u8ba1\u7b97\uff0c\u5305\u62ecmap\u7b97\u5b50\u4e5f\u662f\u5206\u522b\u5bf9\u4e24\u6761\u6d41\u8fdb\u884c\u8ba1\u7b97\u3002map\u7684\u53c2\u6570CoMapFunction\u7684\u4e09\u4e2a\u6cdb\u578b\u53c2\u6570\u5206\u522b\u662f\uff0cConnectedStreams\u4e2d\u7684\u4e24\u6761\u6d41\u7684\u6570\u636e\u7c7b\u578b \u548c \u8f6c\u6362\u4e4b\u540e\u7684\u6570\u636e\u7c7b\u578b\u3002 \u5982\u4e0b\u7a0b\u5e8f\u5c06\u4e24\u6761\u6d41\u5408\u5e76\u6210ConnectedStreams\u540e\uff0c\u518d\u5c06ConnectedStreams\u4e2d\u7684\u4e24\u6761\u6d41\u7684\u6570\u636e\u8f6c\u6362\u6210String\u7c7b\u578b Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0env.setParallelism(1);\n\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDS = env.fromCollection(Arrays.asList(1, 2, 3, 4, 5, 6));\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Character&gt; characterDS = env.fromCollection(Arrays.asList('a', 'b', 'c', 'd', 'e', 'f'));\n\n\u00a0\u00a0\u00a0\u00a0`ConnectedStreams`&lt;Integer, Character&gt; connectedStreams = `integerDS.connect(characterDS);`\n\u00a0\u00a0\u00a0\u00a0`DataStream`&lt;String&gt; coStream = `connectedStreams.map(new CoMapFunction&lt;Integer, Character, String&gt;() {`\n `@Override`\n `public String map1(Integer value) throws Exception {`\n `return value.toString();`\n `}`\n `@Override`\n `public String map2(Character value) throws Exception {`\n `return value.toString();`\n `}`\n `});`\n\n\u00a0\u00a0\u00a0\u00a0coStream.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>1\na\n2\nb\n3\nc\n4\nd\n5\ne\n6\nf\n</code></pre></p> <p>9.Union union\u7b97\u5b50\u53ef\u4ee5\u5408\u5e76\u591a\u6761\u6570\u636e\u7c7b\u578b\u76f8\u540c\u7684\u6d41\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDS1 = env.fromCollection(Arrays.asList(1, 2, 3));\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDS2 = env.fromCollection(Arrays.asList(4, 5, 6));\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; integerDS3 = env.fromCollection(Arrays.asList(7, 8, 9));\n\n\u00a0\u00a0\u00a0 `DataStream&lt;Integer&gt; unionDS = integerDS1.union(integerDS2, integerDS3);`\n\n\u00a0\u00a0\u00a0\u00a0unionDS.print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>1&gt; 1\n8&gt; 5\n7&gt; 4\n9&gt; 6\n2&gt; 7\n3&gt; 8\n4&gt; 9\n3&gt; 3\n2&gt; 2\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/9-%E5%AF%8C%E5%87%BD%E6%95%B0%28RichFunction%29/","title":"9-\u5bcc\u51fd\u6570(RichFunction)","text":"<p> \u7ea6 1458 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 29 \u5206\u949f</p> <p>\u5728Fink\u7684JavaAPI\u4e2d\uff0c\u6240\u6709\u7684Source\u3001Transform\u3001Sink\u7b97\u5b50\u90fd\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\u7c7b\u7684\u5bf9\u8c61\uff08\u5982\u679c\u662fFlink\u7684ScalaAPI\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u4f20\u9012\u51fd\u6570\uff0c\u800c\u56e0\u4e3aJava\u5e76\u4e0d\u652f\u6301\u76f4\u63a5\u4f20\u9012\u51fd\u6570\uff0c\u6240\u4ee5\u5fc5\u987b\u4ee5\u63a5\u53e3\u6216\u7c7b\u4f5c\u4e3a\u65b9\u6cd5\u7684\u8f7d\u4f53\uff09\uff0c\u53ef\u4ee5\u662f\u8fd9\u4e2a\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u7684\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0c\u5982\u679c\u662f\u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f20\u9012lambda\u8868\u8fbe\u5f0f\u3002\u8fd9\u4e9b\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u7684\u540d\u5b57\u90fd\u4ee5Function\u7ed3\u5c3e\uff0c\u90fd\u7ee7\u627f\u81eaFunction\u63a5\u53e3\uff0c\u6240\u4ee5\u5728Flink\u91cc\u9762\u8fd9\u4e9b\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u4e5f\u79f0\u4e3a\u51fd\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u76ee\u7684\u5c31\u662f\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u65b9\u6cd5\u3002\u5e76\u4e14\u8fd9\u4e9b\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u90fd\u6709\u4e00\u4e2a\u4ee5Rich\u5f00\u5934\u4ee5Function\u7ed3\u5c3e\u7684\u62bd\u8c61\u5b50\u7c7b\uff0c\u4e8e\u662f\u79f0\u4e3a\u5bcc\u51fd\u6570\uff0c\u5b83\u63d0\u4f9b\u4e86\u6bd4\u539f\u6709\u63a5\u53e3\u548c\u62bd\u8c61\u7c7b\u66f4\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u53ef\u4ee5\u83b7\u53d6\u8fd0\u884c\u73af\u5883\u7684\u4e0a\u4e0b\u6587\uff0c\u5e76\u62e5\u6709\u4e00\u4e9b\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5b9e\u73b0\u66f4\u590d\u6742\u7684\u529f\u80fd\u3002\u603b\u7ed3\u5230\u4e00\u70b9\u5c31\u662fOperator\uff08\u7b97\u5b50\uff09\u9700\u8981\u4f20\u5165Function\uff08\u51fd\u6570\uff09\u3002 </p> <p>\u6bd4\u5982DataStream\u7684map\u7b97\u5b50\u9700\u8981\u4f20\u5165\u4e00\u4e2aMapFunction Text Only<pre><code>public &lt;R&gt; SingleOutputStreamOperator&lt;R&gt; map(MapFunction&lt;T, R&gt; mapper)\n</code></pre> MapFunction\u7ee7\u627f\u81eaFunction\uff0c\u662f\u4e00\u4e2a\u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f20\u5165MapFunction\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165lambda\u8868\u8fbe\u5f0f\uff1a Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3, 4, 5, 6);\n\u00a0\u00a0\u00a0\u00a0dataStream.map(new MapFunction&lt;Integer, Integer&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0v = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getId() + \" | \" + Thread.currentThread().getName() + \" | \" + v);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Integer map(Integer value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0++v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getId() + \" | \" + Thread.currentThread().getName() + \" | \" + v);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return value * 2;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>1 | main | 0\n100 | Map -&gt; Sink: Print to Std. Out (6/16) `| 1`\n95 | Map -&gt; Sink: Print to Std. Out (3/16) `| 1`\n101 | Map -&gt; Sink: Print to Std. Out (7/16) `| 1`\n3&gt; 2\n102 | Map -&gt; Sink: Print to Std. Out (8/16) `| 1`\n97 | Map -&gt; Sink: Print to Std. Out (5/16) `| 1`\n5&gt; 6\n96 | Map -&gt; Sink: Print to Std. Out (4/16) `| 1`\n8&gt; 12\n7&gt; 10\n6&gt; 8\n4&gt; 4\n</code></pre> \u4ece\u8f93\u51fa\u7684\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5b9e\u4f8b\u53ea\u5728\u4e3b\u7ebf\u7a0b\uff08JobManager\uff09\u4e0a\u5b9e\u4f8b\u5316\u4e00\u6b21\uff0c\u7136\u540e\u88ab\u5e8f\u5217\u5316\u4f20\u9001\u5230\u6bcf\u4e00\u4e2amap\u7b97\u5b50\u5b50\u4efb\u52a1\u6240\u5728\u7684slot\u4e2d\uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u6709\u4e00\u4efdMapFunction\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0c\u4e8e\u662f\u5bf9\u5b9e\u4f8b\u5b57\u6bb5v\u7684\u66f4\u65b0\u5c31\u4e92\u4e0d\u5e72\u6270\u3002</p> <p>RichFunction \u6709\u4e24\u4e2a\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff1a open()\u65b9\u6cd5\u662f RichFunction \u5b50\u7c7b\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u65f6\u4f1a\u8c03\u7528\u7684\u65b9\u6cd5\u3002 close()\u65b9\u6cd5\u662fRichFunction \u5b50\u7c7b\u5bf9\u8c61\u9500\u6bc1\u65f6\u8c03\u7528\u7684\u65b9\u6cd5\uff0c\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\u3002 \u6bd4\u5982\u7ed9DataStream\u7684map\u7b97\u5b50\u4f20\u5165\u4e00\u4e2aRichMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0cRichMapFunction\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u7ee7\u627f\u81eaMapFunction\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3, 4, 5, 6);\n\u00a0\u00a0\u00a0\u00a0dataStream.map(new RichMapFunction&lt;Integer, Integer&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0v = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getId() + \" | \" + Thread.currentThread().getName() + \" | \" + v);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void open(Configuration parameters) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getId() + \" | \" + Thread.currentThread().getName() + \" | open\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void close() throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getId() + \" | \" + Thread.currentThread().getName() + \" | close\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Integer map(Integer value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0++v;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getId() + \" | \" + Thread.currentThread().getName() + \" | \" + v);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return value * 3;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\u5982\u4e0b\uff0c\u4ece\u8f93\u51fa\u7684\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cRichMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5b9e\u4f8b\u53ea\u5728\u4e3b\u7ebf\u7a0b\uff08JobManager\uff09\u4e0a\u5b9e\u4f8b\u5316\u4e00\u6b21\uff0c\u7136\u540e\u88ab\u5e8f\u5217\u5316\u4f20\u9001\u5230\u6bcf\u4e00\u4e2amap\u7b97\u5b50\u5b50\u4efb\u52a1\u6240\u5728\u7684slot\u4e2d\uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u6709\u4e00\u4efdRichMapFunction\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0c\u4e8e\u662f\u5bf9\u5b9e\u4f8b\u5b57\u6bb5v\u7684\u66f4\u65b0\u5c31\u4e92\u4e0d\u5e72\u6270\u3002\u5e76\u4e14\u5f53taskManager\u7684slot\u53cd\u5e8f\u5217\u5316RichMapFunction\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\u65f6\u8fd8\u4f1a\u8c03\u7528open()\u65b9\u6cd5\uff0c\u56e0\u4e3amap\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u7b49\u4e8ecpu\u7684\u7ebf\u7a0b\u657016\uff0c\u6240\u4ee5map\u7b97\u5b50\u670916\u4e2a\u5b50\u4efb\u52a1\uff0c\u6bcf\u4e2a\u5b50\u4efb\u52a1\u90fd\u4f1a\u53cd\u5e8f\u5217\u5316\u4e00\u4efdRichMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\uff0c\u4e8e\u662f\u5c31\u4f1a\u8f93\u51fa16\u6267\u884c16\u6b21open\u65b9\u6cd5\uff0c\u5f53\u4efb\u52a1\u7ed3\u675f\u65f6\uff0c\u8fd8\u4f1a\u8c03\u7528close()\u65b9\u6cd5\uff0c\u56e0\u4e3a\u53ea\u67096\u4e2amap\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u4f1a\u63a5\u6536\u5230\u6570\u636e\uff0c\u6240\u4ee5RichMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\u7684map\u65b9\u6cd5\u53ea\u4f1a\u6267\u884c6\u6b21\u3002 Text Only<pre><code>1 | main | 0\n102 | Map -&gt; Sink: Print to Std. Out (8/16) | open\n93 | Map -&gt; Sink: Print to Std. Out (1/16) | open\n96 | Map -&gt; Sink: Print to Std. Out (4/16) | open\n106 | Map -&gt; Sink: Print to Std. Out (12/16) | open\n110 | Map -&gt; Sink: Print to Std. Out (13/16) | open\n101 | Map -&gt; Sink: Print to Std. Out (7/16) | open\n107 | Map -&gt; Sink: Print to Std. Out (15/16) | open\n100 | Map -&gt; Sink: Print to Std. Out (6/16) | open\n97 | Map -&gt; Sink: Print to Std. Out (5/16) | open\n95 | Map -&gt; Sink: Print to Std. Out (3/16) | open\n103 | Map -&gt; Sink: Print to Std. Out (9/16) | open\n94 | Map -&gt; Sink: Print to Std. Out (2/16) | open\n109 | Map -&gt; Sink: Print to Std. Out (14/16) | open\n105 | Map -&gt; Sink: Print to Std. Out (11/16) | open\n108 | Map -&gt; Sink: Print to Std. Out (16/16) | open\n104 | Map -&gt; Sink: Print to Std. Out (10/16) | open\n`104 | Map -&gt; Sink: Print to Std. Out (10/16) | 1`\n`103 | Map -&gt; Sink: Print to Std. Out (9/16) | 1`\n`105 | Map -&gt; Sink: Print to Std. Out (11/16) | 1`\n`10&gt; 6`\n`106 | Map -&gt; Sink: Print to Std. Out (12/16) | 1`\n`109 | Map -&gt; Sink: Print to Std. Out (14/16) | 1`\n`14&gt; 18`\n`110 | Map -&gt; Sink: Print to Std. Out (13/16) | 1`\n`12&gt; 12`\n`9&gt; 3`\n`11&gt; 9`\n`13&gt; 15`\n93 | Map -&gt; Sink: Print to Std. Out (1/16) | close\n96 | Map -&gt; Sink: Print to Std. Out (4/16) | close\n106 | Map -&gt; Sink: Print to Std. Out (12/16) | close\n103 | Map -&gt; Sink: Print to Std. Out (9/16) | close\n107 | Map -&gt; Sink: Print to Std. Out (15/16) | close\n95 | Map -&gt; Sink: Print to Std. Out (3/16) | close\n109 | Map -&gt; Sink: Print to Std. Out (14/16) | close\n100 | Map -&gt; Sink: Print to Std. Out (6/16) | close\n97 | Map -&gt; Sink: Print to Std. Out (5/16) | close\n108 | Map -&gt; Sink: Print to Std. Out (16/16) | close\n101 | Map -&gt; Sink: Print to Std. Out (7/16) | close\n94 | Map -&gt; Sink: Print to Std. Out (2/16) | close\n104 | Map -&gt; Sink: Print to Std. Out (10/16) | close\n105 | Map -&gt; Sink: Print to Std. Out (11/16) | close\n110 | Map -&gt; Sink: Print to Std. Out (13/16) | close\n102 | Map -&gt; Sink: Print to Std. Out (8/16) | close\n</code></pre></p> <p>RichMapFunction\u7ee7\u627f\u81eaAbstractRichFunction\uff0cAbstractRichFunction\u4e2d\u6709\u53ef\u4ee5\u83b7\u53d6\u8fd0\u884c\u73af\u5883\u7684\u4e0a\u4e0b\u6587\u7684\u65b9\u6cd5\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u5bcc\u51fd\u6570\u83b7\u53d6\u8fd0\u884c\u73af\u5883\u7684\u4e0a\u4e0b\u6587\uff0c\u4ece\u800c\u5b9e\u73b0\u4e00\u4e9b\u66f4\u52a0\u590d\u6742\u7684\u529f\u80fd\u3002 getRuntimeContext().getIndexOfThisSubtask()\u5f97\u5230\u7684\u662f\u8be5\u7b97\u5b50\u5f53\u524d\u5b50\u4efb\u52a1\u7684\u7f16\u53f7\u3002 Text Only<pre><code>public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\u00a0\u00a0\u00a0\u00a0DataStream&lt;Integer&gt; dataStream = env.fromElements(1, 2, 3, 4, 5, 6);\n\u00a0\u00a0\u00a0\u00a0dataStream.map(new RichMapFunction&lt;Integer, Integer&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Integer map(Integer value) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Subtask: \" + `getRuntimeContext().getIndexOfThisSubtask()` + \" &gt; \" + value * 3);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return value * 3;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).print();\n\u00a0\u00a0\u00a0\u00a0env.execute();\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>Subtask: 10 &gt; 18\n11&gt; 18\nSubtask: 5 &gt; 3\n6&gt; 3\nSubtask: 8 &gt; 12\n9&gt; 12\nSubtask: 9 &gt; 15\n10&gt; 15\nSubtask: 7 &gt; 9\n8&gt; 9\nSubtask: 6 &gt; 6\n7&gt; 6\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/1-HBase%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","title":"1-HBase\u5b89\u88c5\u914d\u7f6e","text":"<p> \u7ea6 257 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>1.\u542f\u52a8HDFS\u548czookeeper Text Only<pre><code>start-dfs.sh\nzk.sh start\n</code></pre> 2.\u4e0b\u8f7d\u5e76\u89e3\u538bHBase Text Only<pre><code>tar -zxvf hbase-1.4.13-bin.tar.gz -C /opt/module/\n</code></pre> 3.\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 3.1 \u5728 /opt/module/hbase-1.4.13/conf/regionservers \u91cc\u6dfb\u52a0regionserver\u7684\u4e3b\u673a\u5730\u5740\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u67d0\u4e00\u53f0\u4e3b\u673a\u4e0a\u7fa4\u8d77regionservers Text Only<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> 3.2 \u53ef\u9009\uff1aHMaster\u9ad8\u53ef\u7528\u914d\u7f6e \u7b2c\u4e00\u79cd\u65b9\u5f0f\uff1a\u76f4\u63a5\u5728\u5176\u5b83\u4e3b\u673a\u542f\u52a8HMaster \u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff1a\u5728/opt/module/hbase-1.4.13/conf/\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a backup-masters\u6587\u4ef6\uff0c\u7136\u540e\u586b\u5165\u5907\u4efdHMaster\u7684\u4e3b\u673a\u5730\u5740 Text Only<pre><code>hadoop103\nhadoop104\n</code></pre> 3.3 \u4fee\u6539/opt/module/hbase-1.4.13/conf/hbase-env.sh \u91cc\u7684 HBASE_MANAGES_ZK=false\uff0c\u4e0d\u7136HBase\u5c31\u4f1a\u4f7f\u7528\u81ea\u5df1\u96c6\u6210\u7684zookeeper\uff0c\u8fd8\u6709JAVA_HOME \uff0c\u5176\u5b83\u914d\u7f6e\u6ce8\u91ca\u6389\u3002 Text Only<pre><code>export JAVA_HOME=/opt/module/jdk1.8.0_301\nexport HBASE_MANAGES_ZK=false\n</code></pre> 3.4 \u4fee\u6539 /opt/module/hbase-1.4.13/conf/hbase-site.xml Text Only<pre><code>&lt;configuration&gt;\u00a0\n\n\u00a0 &lt;!-- \u5f00\u542f\u5206\u5e03\u5f0f\u96c6\u7fa4\u6a21\u5f0f --&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.cluster.distributed&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;true&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0&lt;!-- HBase\u5728HDFS\u4e0a\u7684\u6570\u636e\u5b58\u50a8\u76ee\u5f55 --&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.rootdir&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hdfs://hadoop102:8020/HBase&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0&lt;!-- Mater\u7684\u670d\u52a1\u901a\u4fe1\u7aef\u53e3 --&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.master.port&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;16000&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0&lt;!-- Master\u7684WebUI\u7aef\u53e3\uff0c\u8bbe\u7f6e\u4e3a-1\u5c31\u662f\u4e0d\u8fd0\u884cWebUI\u5b9e\u4f8b --&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.master.info.port&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;16010&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0&lt;!-- zookeeper\u96c6\u7fa4\u7684\u5730\u5740 --&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop102,hadoop103,hadoop104&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0&lt;!-- zookeeper\u6570\u636e\u5b58\u653e\u7684\u76ee\u5f55 --&gt;\n\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;/opt/module/zookeeper-3.5.7/zkData&lt;/value&gt;\n\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>4. \u8f6f\u8fde\u63a5 hadoop \u914d\u7f6e\u6587\u4ef6\u5230 HBase\uff08\u5982\u679c\u914d\u7f6e\u597d\u4e86HADOOP_HOME\u672c\u6b65\u9aa4\u53ef\u4ee5\u8df3\u8fc7\uff09 Text Only<pre><code>ln -s /opt/module/hadoop-3.3.1/etc/hadoop/core-site.xml /opt/module/hbase-1.4.13/conf/core-site.xml\nln -s /opt/module/hadoop-3.3.1/etc/hadoop/hdfs-site.xml /opt/module/hbase-1.4.13/conf/hdfs-site.xml\n</code></pre></p> <p>5.\u542f\u52a8 \u5355\u8282\u70b9\u542f\u52a8/\u505c\u6b62\u547d\u4ee4\uff1a Text Only<pre><code>bin/hbase-daemon.sh start master\nbin/hbase-daemon.sh stop master\nbin/hbase-daemon.sh start regionserver\nbin/hbase-daemon.sh stop regionserver\n</code></pre> \u7fa4\u8d77/\u7fa4\u5173\u547d\u4ee4\uff08\u8f93\u5165\u7fa4\u8d77\u547d\u4ee4\u7684\u4e3b\u673a\u5c31\u662fMaster\uff09\uff1a Text Only<pre><code>bin/start-hbase.sh\nbin/stop-hbase.sh\n</code></pre> master\u7684WebUI\u5730\u5740 Text Only<pre><code>http://hadoop102:16010\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/10-DDL%20%E4%B8%8E%20DML%20%E6%93%8D%E4%BD%9C%E7%9A%84API/","title":"10-DDL \u4e0e DML \u64cd\u4f5c\u7684API","text":"<p> \u7ea6 1386 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 28 \u5206\u949f</p> <p>1.\u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hbase&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hbase-client&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.4.13&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;junit&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;junit&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;4.13.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>2.DDL\u64cd\u4f5c\u7684API \u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684\u521b\u5efa\u5220\u9664\u7b49ddl\u64cd\u4f5c\u5747\u662f\u901a\u8fc7Admin\u5bf9\u8c61\u5b8c\u6210\uff0c\u53ef\u4ee5\u770b\u5230HBase\u7684\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u8fde\u63a5zookeeper\u5373\u53ef\uff0c\u5e76\u4e14HBase\u6570\u636e\u5e93\u5e76\u4e0d\u50cfMySQL\u90a3\u6837\u9700\u8981\u5bc6\u7801\uff0cRedis\u9ed8\u8ba4\u4e5f\u662f\u6ca1\u6709\u5bc6\u7801\u7684\u3002 Text Only<pre><code>public class DDLTest {\n\u00a0\u00a0\u00a0\u00a0private Connection connection;\n\u00a0\u00a0\u00a0\u00a0//\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684\u521b\u5efa\u5220\u9664\u7b49ddl\u64cd\u4f5c\u5747\u662f\u901a\u8fc7Admin\u5bf9\u8c61\u5b8c\u6210\n\u00a0\u00a0\u00a0\u00a0private Admin admin;\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5efa\u7acb\u8fde\u63a5 \u548c \u83b7\u53d6Admin\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Before\n\u00a0\u00a0\u00a0\u00a0public void connection() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u8bbe\u7f6e\u914d\u7f6e\u4fe1\u606f\u7684\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = HBaseConfiguration.create();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//HBase\u7684\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u8fde\u63a5zookeeper\u5373\u53ef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0conf.set(\"hbase.zookeeper.quorum\", \"hadoop102,hadoop103,hadoop104\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0connection = ConnectionFactory.createConnection(conf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6Admin\u5bf9\u8c61\uff0c\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684\u521b\u5efa\u5220\u9664\u7b49ddl\u64cd\u4f5c\u5747\u662f\u901a\u8fc7Admin\u5bf9\u8c61\u5b8c\u6210\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin = connection.getAdmin();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5173\u95ed\u8d44\u6e90\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@After\n\u00a0\u00a0\u00a0\u00a0public void close() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0connection.close();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u521b\u5efa\u547d\u540d\u7a7a\u95f4\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void createNameSpace() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u53ea\u80fd\u901a\u8fc7NamespaceDescriptor\u7684create()\u65b9\u6cd5\u62ff\u5230NamespaceDescriptor\u7684\u9759\u6001\u5185\u90e8\u7c7bBuilder\u7684\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u7136\u540e\u901a\u8fc7Builder\u5bf9\u8c61\u521b\u5efaNamespaceDescriptor\u7684\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin.createNamespace(NamespaceDescriptor.create(\"bigdata\").build());\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5224\u65ad\u8868\u662f\u5426\u5b58\u5728\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void isTableExist() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableName tableName = TableName.valueOf(\"student\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(admin.tableExists(tableName));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u521b\u5efa\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void createTable() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableName tableName = TableName.valueOf(\"test\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8868\u63cf\u8ff0\u7b26\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HTableDescriptor descriptor = new HTableDescriptor(tableName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6dfb\u52a0\u5217\u65cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0descriptor.addFamily(new HColumnDescriptor(\"info1\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0descriptor.addFamily(new HColumnDescriptor(\"info2\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin.createTable(descriptor);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void deleteTable() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableName tableName = TableName.valueOf(\"test\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5148disable\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin.disableTable(tableName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u518d\u5220\u9664\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0admin.deleteTable(tableName);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>3.DML\u64cd\u4f5c\u7684API \u5bf9\u8868\u6570\u636e\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u5747\u662f\u901a\u8fc7Table\u5bf9\u8c61\u5b8c\u6210\uff0c\u91cd\u70b9\u5173\u6ce8\u5220\u9664\u7684\u65b9\u6cd5 Text Only<pre><code>public class DMLTest {\n\u00a0\u00a0\u00a0\u00a0private Connection connection;\n\u00a0\u00a0\u00a0\u00a0private Table studentTable;\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u521b\u5efa\u8fde\u63a5 \u548c \u83b7\u53d6Table\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Before\n\u00a0\u00a0\u00a0\u00a0public void connection() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u8bbe\u7f6e\u914d\u7f6e\u4fe1\u606f\u7684\u5bf9\u8c61\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = HBaseConfiguration.create();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//HBase\u7684\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u8fde\u63a5zookeeper\u5373\u53ef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0conf.set(\"hbase.zookeeper.quorum\", \"hadoop102,hadoop103,hadoop104\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0connection = ConnectionFactory.createConnection(conf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6Table\u5bf9\u8c61\uff0c\u5bf9\u8868\u6570\u636e\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u5747\u662f\u901a\u8fc7Table\u5bf9\u8c61\u5b8c\u6210\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable = connection.getTable(TableName.valueOf(\"student\"));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5173\u95ed\u8d44\u6e90\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@After\n\u00a0\u00a0\u00a0\u00a0public void close() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0connection.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.close();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5411\u8868\u4e2dput\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void put() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1005\";//RowKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Put put = new Put(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnFamily = \"info1\";//\u5217\u65cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String column = \"name\";//\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String value = \"zhangsan\";//\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0put.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(column), System.currentTimeMillis(), Bytes.toBytes(value));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.put(put);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6253\u5370\u4e00\u884c\u6570\u636e\u7684\u65b9\u6cd5\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0private void printRow(Cell cell) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"------------------------\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"RowKey: \" + Bytes.toString(CellUtil.cloneRow(cell)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"ColumnFamily: \" + Bytes.toString(CellUtil.cloneFamily(cell)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Column: \" + Bytes.toString(CellUtil.cloneQualifier(cell)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"value: \" + Bytes.toString(CellUtil.cloneValue(cell)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"Timestamp: \" + new Date(cell.getTimestamp()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"------------------------\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u83b7\u53d6\u4e00\u884c\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void getRow() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1001\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Get get = new Get(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u8fc7RowKey\u62ff\u5230\u4e00\u884c\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Result result = studentTable.get(get);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u4e00\u884c\u6570\u636e\u6709\u8bb8\u591acell\uff0c\u4e5f\u5c31\u662f\u6709\u6570\u636e\u7684\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Cell[] cells = result.rawCells();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Cell cell : cells) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printRow(cell);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u83b7\u53d6\u67d0\u4e00\u884c\u6307\u5b9a\u201c\u5217\u65cf:\u5217\u201d\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void getRowQualifier() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1001\";//RowKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Get get = new Get(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnFamily = \"info1\";//\u5217\u65cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnQualifier = \"name\";//\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0get.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(columnQualifier));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u901a\u8fc7RowKey\u62ff\u5230\u4e00\u884c\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Result result = studentTable.get(get);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//byte[] value = result.getValue(Bytes.toBytes(columnFamily), Bytes.toBytes(columnQualifier));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//System.out.println(new String(value));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Cell cell = result.rawCells()[0];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printRow(cell);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u83b7\u53d6\u6240\u6709\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void scanTable() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Scan scan = new Scan();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ResultScanner results = studentTable.getScanner(scan);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6bcf\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Result result : results) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6bcf\u4e00\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Cell cell : result.rawCells()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printRow(cell);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u67d0\u4e2aRowKey\u7684\u67d0\u4e2a\u5217\u65cf\u7684\u67d0\u4e00\u5217\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u53ea\u5220\u9664\u4e00\u5217\u6307\u5b9a\u7684\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0ctype=delete\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u7248\u672c\u5c31\u662f\u5220\u9664\u6700\u8fd1\u7684\u4e00\u4e2a\u7684\u7248\u672c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5220\u9664\u6570\u636e\u4f1a\u9020\u6210\u4e00\u4e2a\u95ee\u9898\uff1a\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6bd4\u5982\uff0c\u5217\u65cf\u8bbe\u7f6e\u53ea\u4fdd\u7559\u4e00\u4e2a\u7248\u672c\u7684\u989d\u6570\u636e\uff0c\u7136\u540eput\u4e00\u4e2a\u6570\u636e\u4e24\u6b21\u4e4b\u540e\uff0c\u4f7f\u7528delete\u4e4b\u540e\uff0c\u4f1a\u8fd4\u56de\u7b2c\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u8fd9\u6ca1\u95ee\u9898\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u4f46\u662f\u5982\u679cput\u4e00\u4e2a\u6570\u636e\u4e24\u6b21\u4e4b\u540e\uff0cHBase\u53d1\u751f\u4e86flush\uff0c\u8fd9\u65f6\u4f7f\u7528delete\u4e4b\u540e\uff0c\u5c31\u4e0d\u4f1a\u8fd4\u56de\u6570\u636e\u4e86\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u4e0a\u8ff0\u4e24\u4e2a\u8fc7\u7a0b\u90fd\u662f\u7528\u6237\u6240\u505a\u7684\u64cd\u4f5c\u662f\u4e00\u6837\u7684\uff0c\u5373put\u4e24\u6b21\u3001delete\u4e00\u6b21\uff0c\u4f46\u662f\u8fd4\u56de\u7684\u7ed3\u679c\u5374\u4e0d\u4e00\u81f4\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u5220\u9664\u6570\u636e\u9700\u8981\u614e\u91cd\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void deleteColumn() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1001\";//RowKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Delete delete = new Delete(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnFamily = \"info1\";//\u5217\u65cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnQualifier = \"age\";//\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5220\u9664\u4e00\u5217\u6700\u8fd1\u7684\u4e00\u4e2a\u7248\u672c\uff0ctype=delete\uff0c\u8be5\u64cd\u4f5c\u7684timestamp\u7b49\u4e8e\u4e0a\u4e00\u4e2a\u7248\u672c\u7684timestamp\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e5f\u5c31\u662f type=delete \u7684\u610f\u601d\u662f\u5220\u9664\u6307\u5b9a\u7248\u672c\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//delete.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(columnQualifier));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5220\u9664\u6307\u5b9a\u7248\u672c\u7684\u6570\u636e\uff0ctype=delete\uff0c\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u4e0a\u9762\u7684timestamp\u662fHBase\u627e\u5230\u6700\u8fd1\u7684\u4e00\u4e2a\u7248\u672c\u540e\u6dfb\u52a0\u7684\uff0c\u7136\u800c\u8fd9\u91cc\u662f\u4f60\u6307\u5b9a\u7684\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0delete.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(columnQualifier),1631586501750L);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.delete(delete);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u67d0\u4e2aRowKey\u7684\u67d0\u4e2a\u5217\u65cf\u7684\u67d0\u4e00\u5217\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u4e00\u5217\u6240\u6709\u7248\u672c\uff0ctype=DeleteColumn\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void deleteColumns() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1001\";//RowKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Delete delete = new Delete(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnFamily = \"info1\";//\u5217\u65cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnQualifier = \"age\";//\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5220\u9664\u4e00\u5217\u6240\u6709\u7248\u672c\uff0ctype=DeleteColumn\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0delete.addColumns(Bytes.toBytes(columnFamily), Bytes.toBytes(columnQualifier));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.delete(delete);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u67d0\u4e2aRowKey\u7684\u67d0\u4e2a\u5217\u65cf\u7684\u5168\u90e8\u6570\u636e\uff0ctype=deleteFamily\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void deleteColumnFamily() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1001\";//RowKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Delete delete = new Delete(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String columnFamily = \"info1\";//\u5217\u65cf\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5220\u9664\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e\uff0ctype=deleteFamily\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0delete.addFamily(Bytes.toBytes(columnFamily));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.delete(delete);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u4e00\u884c\u6570\u636e\uff0c\u5177\u4f53\u8fc7\u7a0b\u662f\u5206\u522b\u5220\u9664\u6bcf\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void delete() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String rowKey = \"1002\";//RowKey\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5220\u9664\u4e00\u884c\u6570\u636e\uff0c\u5177\u4f53\u8fc7\u7a0b\u662f\u5206\u522b\u5220\u9664\u6bcf\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Delete delete = new Delete(Bytes.toBytes(rowKey));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.delete(delete);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5220\u9664\u591a\u884c\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Test\n\u00a0\u00a0\u00a0\u00a0public void deleteMultiRow() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ArrayList&lt;Delete&gt; deletes = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0deletes.add(new Delete(Bytes.toBytes(\"1003\")));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0deletes.add(new Delete(Bytes.toBytes(\"1005\")));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0studentTable.delete(deletes);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u603b\u7ed3\u5220\u9664\u6570\u636e\uff1a \u5220\u9664\u6570\u636e\u7684type\u6709\u4e09\u79cd\u7c7b\u578b\uff1adelete\u3001deleteColumn\u3001deleteFamily type=delete\uff1a\u5220\u9664\u4e00\u5217\u6307\u5b9a\u7684\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u5982\u679c\u5728api\u5728\u6ca1\u6709\u6307\u5b9a\u7248\u672c\u5c31\u662f\u5220\u9664\u6700\u8fd1\u7684\u4e00\u4e2a\u7684\u7248\u672c type=deleteColumn\uff1a\u5220\u9664\u4e00\u5217\u6240\u6709\u7248\u672c\u7684\u6570\u636e type=deleteFamily\uff1a\u5220\u9664\u5217\u65cf\u7684\u5168\u90e8\u6570\u636e \u5220\u9664\u4e00\u884c\u6570\u636e\uff0c\u5177\u4f53\u8fc7\u7a0b\u662f\u5206\u522b\u5220\u9664\u6bcf\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/11-HBase%20%E4%B8%8E%20MR%E4%BA%A4%E4%BA%92/","title":"11-HBase \u4e0e MR\u4ea4\u4e92","text":"<p> \u7ea6 775 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u9700\u6c42\u4e00\uff1a\u5c06HDFS\u4e0a\u7684\u6587\u4ef6\u7684\u6570\u636e\u5bfc\u5165\u5230HBase\u7684\u8868\u4e2d 1.\u65b0\u5efa fruit.tsv \u6587\u4ef6\uff0c\u5e76\u4e0a\u4f20\u5230HDFS Text Only<pre><code>1001\u00a0\u00a0\u00a0\u00a0Apple\u00a0\u00a0\u00a0\u00a0Red\n1002\u00a0\u00a0\u00a0\u00a0Pear\u00a0\u00a0\u00a0\u00a0Yellow\n1003\u00a0\u00a0\u00a0\u00a0Pineapple\u00a0\u00a0\u00a0\u00a0Yellow\n</code></pre> Text Only<pre><code>hdfs dfs -mkdir /input_fruit\nhdfs dfs -put fruit.tsv /input_fruit/\n</code></pre> 2.\u65b0\u5efaHBase\u8868 Text Only<pre><code>create 'fruit','info'\n</code></pre> 3.pom\u6587\u4ef6\uff0c\u5e26\u7b2c\u4e09\u65b9jar\u5305\u6253\u5305 Text Only<pre><code>&lt;dependencies&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hbase&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hbase-client&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.4.13&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hbase&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hbase-server&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.4.13&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.3.1&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;plugins&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.6.1&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;source&gt;1.8&lt;/source&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;target&gt;1.8&lt;/target&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.3.0&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;archive&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;manifest&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;addClasspath&gt;true&lt;/addClasspath&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u6307\u5b9a\u4e3b\u7c7b--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;mainClass&gt;MapReduce.FruitDriver&lt;/mainClass&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/manifest&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/archive&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;descriptorRefs&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/descriptorRefs&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;executions&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;execution&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;id&gt;make-assembly&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;phase&gt;package&lt;/phase&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;goals&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;goal&gt;single&lt;/goal&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/goals&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/execution&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/executions&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/plugin&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre></p> <p>4.mapper\u7c7b\u76f4\u63a5\u8f93\u51fa\u8fd9\u4e00\u884c\u5373\u53ef Text Only<pre><code>public class FruitMapper extends Mapper&lt;LongWritable, Text, LongWritable, Text&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, LongWritable, Text&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(key, value);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>5.reducer\u7c7b\u7ee7\u627fTableReducer\uff0cTableReducer\u7ee7\u627f\u81ea Reducer\uff0cTableReducer\u7c7b\u7684\u8f93\u51favalue\u662fMutation\uff0cPut\u7c7b\u662fMutation\u7684\u5b50\u7c7b\uff0c\u6240\u4ee5\u5982\u679c\u8981\u5f80HBase\u8868\u4e2d\u63d2\u5165\u6570\u636e\uff0c\u76f4\u63a5\u8f93\u51faPut\u5bf9\u8c61\u5373\u53ef\u3002 Text Only<pre><code>public class FruitReducer extends TableReducer&lt;LongWritable, Text, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(LongWritable key, Iterable&lt;Text&gt; values, Reducer&lt;LongWritable, Text, NullWritable, Mutation&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Text value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] splits = value.toString().split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Put put = new Put(Bytes.toBytes(splits[0]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0put.addColumn(Bytes.toBytes(\"info\"), Bytes.toBytes(\"name\"), Bytes.toBytes(splits[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0put.addColumn(Bytes.toBytes(\"info\"), Bytes.toBytes(\"color\"), Bytes.toBytes(splits[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(NullWritable.get(), put);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>6.Driver\u7c7b\uff0c\u5b9e\u73b0Tool\u63a5\u53e3 Text Only<pre><code>public class FruitDriver implements Tool {\n\u00a0\u00a0\u00a0\u00a0private Configuration configuration = null;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int run(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u521b\u5efa Job \u4efb\u52a1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(configuration);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u8bbe\u7f6ejar\u5305\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(FruitDriver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3.\u8bbe\u7f6e Mapper\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(FruitMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(LongWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4.\u8bbe\u7f6e Reducer\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8f93\u51fa\u8def\u5f84\uff0c\u5373HBase\u4e0a\u7684\u8868\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableMapReduceUtil.initTableReducerJob(args[1], FruitReducer.class, job);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//5.\u8bbe\u7f6e\u8f93\u5165\u8def\u5f84\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5373HDFS\u4e0a\u6587\u4ef6\u7684\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(args[0]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//6.\u63d0\u4ea4\u4efb\u52a1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return job.waitForCompletion(true) ? 0 : 1;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void setConf(Configuration configuration) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.configuration = configuration;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Configuration getConf() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return configuration;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration configuration = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ToolRunner.run(configuration, new FruitDriver(), args);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>7.\u6253\u5305\u4e4b\u540e\u4e0a\u4f20\u5230Linux\uff0c\u7136\u540e\u4f7f\u7528yarn\u6765\u8fd0\u884c\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u5165\u8def\u5f84\uff0c\u5373HDFS\u4e0a\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8f93\u51fa\u8def\u5f84\uff0c\u5373HBase\u4e0a\u7684\u8868\u540d Text Only<pre><code>yarn jar HBase-1.0-SNAPSHOT-jar-with-dependencies.jar /input_fruit/fruit.tsv fruit\n</code></pre> \u4ee5\u4e0a\u4ee3\u7801\u4e2d\u5e76\u6ca1\u6709\u8fde\u63a5hbase\u90e8\u5206\uff0c\u4f46\u662f\u4e5f\u80fd\u64cd\u4f5chbase\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u53ef\u80fd\u73af\u5883\u53d8\u91cf\u7684\u7f18\u6545\uff0c\u56e0\u4e3a\u8fd9\u662f\u5728\u628aLinux\u4e0a\u8fd0\u884c\uff0c\u5982\u679c\u76f4\u63a5\u5728Windows\u4e0a\u8fd0\u884c\u5c31\u9700\u8981\u8fde\u63a5hbase\u4e86\u3002</p> <p>\u9700\u6c42\u4e8c\uff1a\u5c06\u4e0a\u9762\u7684fruit\u8868\u7684\u6570\u636e\u5bfc\u5165\u5230HBase\u7684\u53e6\u4e00\u5f20\u8868fruit2\u4e0a\uff0c\u8981\u6c42\u662f\u53ea\u4fdd\u7559name\u5217\u7684\u6570\u636e 1.\u521b\u5efafruit2\u8868 Text Only<pre><code>create 'fruit2','info'\n</code></pre> 2.Mapper\uff0cImmutableBytesWritable\u5c31\u662fRowKey Text Only<pre><code>public class Fruit2Mapper extends TableMapper&lt;ImmutableBytesWritable, Put&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(ImmutableBytesWritable key, Result value, Mapper&lt;ImmutableBytesWritable, Result, ImmutableBytesWritable, Put&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u904d\u5386\u4e00\u884c\u7684\u6bcf\u4e00\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Cell cell : value.rawCells()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u8fd9\u4e00\u5217\u662fname\u5217\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"name\".equals(Bytes.toString(CellUtil.cloneQualifier(cell)))) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Put put = new Put(key.get());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0put.add(cell);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(key, put);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 3.Reducer Text Only<pre><code>public class Fruit2Reducer extends TableReducer&lt;ImmutableBytesWritable, Put, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Reducer&lt;ImmutableBytesWritable, Put, NullWritable, Mutation&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Put put : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(NullWritable.get(), put);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> 4.Driver Text Only<pre><code>public class Fruit2Driver implements Tool {\n\u00a0\u00a0\u00a0\u00a0private Configuration configuration = null;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int run(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//1.\u521b\u5efa Job \u4efb\u52a1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(configuration);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//2.\u8bbe\u7f6ejar\u5305\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(Fruit2Driver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//3.\u8bbe\u7f6e Mapper,\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u5165\u8def\u5f84\uff0c\u5373HBase\u4e0a\u7684\u8868\u540d\uff0c\u7b2c\u4e8c\u53c2\u6570\u8bbe\u7f6e\u626b\u63cf\u8868\u7684\u8303\u56f4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u8bbe\u7f6emap\u7c7b\uff0c\u7b2c\u56db\u3001\u4e94\u4e2a\u53c2\u6570\u662fmap\u7684\u8f93\u51fakey\u548cvalue\u7684\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableMapReduceUtil.initTableMapperJob(\"fruit\",\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Scan(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Fruit2Mapper.class,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ImmutableBytesWritable.class,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Put.class,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//4.\u8bbe\u7f6e Reducer\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u51fa\u8def\u5f84\uff0c\u5373HBase\u4e0a\u7684\u8868\u540d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableMapReduceUtil.initTableReducerJob(\"fruit2\", Fruit2Reducer.class, job);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//6.\u63d0\u4ea4\u4efb\u52a1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return job.waitForCompletion(true) ? 0 : 1;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void setConf(Configuration configuration) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.configuration = configuration;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Configuration getConf() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return configuration;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration configuration = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ToolRunner.run(configuration, new Fruit2Driver(), args);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/2-HBase%E7%9A%84shell%E5%91%BD%E4%BB%A4/","title":"2-HBase\u7684shell\u547d\u4ee4","text":"<p> \u7ea6 709 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>\u4e00\u3001\u57fa\u672c\u64cd\u4f5c \u8fdb\u5165 HBase \u5ba2\u6237\u7aef\u547d\u4ee4\u884c Text Only<pre><code>bin/hbase shell\n</code></pre> \u67e5\u770b\u5e2e\u52a9\u547d\u4ee4 Text Only<pre><code>help\n</code></pre> \u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u6709\u54ea\u4e9b\u8868 Text Only<pre><code>list\n</code></pre> \u4e0d\u77e5\u9053\u54ea\u4e2a\u547d\u4ee4\u7684\u7528\u6cd5\uff0c\u76f4\u63a5\u8f93\u5165\u8be5\u547d\u4ee4\uff0c\u4f1a\u6709\u7528\u6cd5\u7684\u4f8b\u5b50</p> <p>\u4e8c\u3001\u8868\u7684\u64cd\u4f5c DDL \u521b\u5efa\u8868\uff0c\u4e0d\u6307\u5b9anamespace\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u7684namespace\uff0c\u5373default Text Only<pre><code>create 'namespace:\u8868\u540d','\u5217\u65cf1','\u5217\u65cf2','\u5217\u65cf3'\n</code></pre> Text Only<pre><code>create 'student','info1','info2'\n</code></pre></p> <p>\u5220\u9664\u8868 \u00a0 \u9996\u5148\u9700\u8981\u5148\u8ba9\u8be5\u8868\u4e3a disable \u72b6\u6001\uff1a Text Only<pre><code>disable 'student\n</code></pre> \u00a0 \u7136\u540e\u624d\u80fd drop \u8fd9\u4e2a\u8868\uff1a Text Only<pre><code>drop 'student'\n</code></pre></p> <p>\u53d8\u66f4\u8868\u4fe1\u606f \u4fee\u6539student\u8868\u7684 info \u5217\u65cf\u5b58\u653e 3 \u4e2a\u7248\u672c\uff08\u8be5\u64cd\u4f5c\u4f1a\u9020\u6210flush\uff09\uff1a Text Only<pre><code>alter 'student',{NAME=&gt;'info',VERSIONS=&gt;3}\n</code></pre></p> <p>\u67e5\u770b\u8868\u7ed3\u6784 Text Only<pre><code>describe 'student'\n</code></pre></p> <p>DML \u63d2\u5165 \u6216 \u66f4\u65b0 \u90fd\u662fput\u547d\u4ee4 Text Only<pre><code>put 'namespace:\u8868\u540d','rowkey','\u5217\u65cf:\u5217','\u503c'\n</code></pre> Text Only<pre><code>put 'student','1001','info1:sex','male'\n</code></pre> \u00a0 \u6307\u5b9a\u65f6\u95f4\u6233\u7684put Text Only<pre><code>put 'student','1001','info1:name','zhaoliu',1631445905050\n</code></pre></p> <p>\u67e5\u770b\u8868\u6570\u636e Text Only<pre><code>scan 'student'\n</code></pre> \u00a0 \u6307\u660erowkey\u7684\u8303\u56f4\uff0c\u5de6\u95ed\u53f3\u5f00 Text Only<pre><code>scan 'student',{STARTROW =&gt; '1001', STOPROW =&gt; '1003'}\n</code></pre> Text Only<pre><code>scan 'student',{STARTROW =&gt; '1001'}\n</code></pre> \u00a0 \u67e5\u770b10\u4e2a\u7248\u672c\u5185\u7684\u6570\u636e Text Only<pre><code>scan 'student', {RAW =&gt; true, VERSIONS =&gt; 10}\n</code></pre></p> <p>\u67e5\u770b\u6307\u5b9a\u884c\uff0c\u4e5f\u5c31\u662f\u6307\u5b9arowkey\u7684\u6570\u636e Text Only<pre><code>get 'student','1001'\n</code></pre> \u67e5\u770b\u6307\u5b9a\u201c\u5217\u65cf\u201d\u7684\u6570\u636e Text Only<pre><code>get 'student','1001','info1'\n</code></pre> \u67e5\u770b\u6307\u5b9a\u201c\u5217\u65cf:\u5217\u201d\u7684\u6570\u636e Text Only<pre><code>get 'student','1001','info1:name'\n</code></pre> \u67e5\u770b\u6307\u5b9a\u201c\u5217\u65cf:\u5217\u201d\u7684\u5386\u53f2\u7248\u672c\u6570\u636e\uff0c\u6ce8\u610f\u8868\u7684\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u8bbe\u7f6e\u7684\u662f\u591a\u5c11\uff0c\u901a\u8fc7get\u547d\u4ee4\u6700\u591a\u4e5f\u5c31\u53ea\u80fd\u67e5\u51fa\u591a\u5c11\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u8fd9\u4e0escan\u547d\u4ee4\u4e0d\u540c\uff0cscan\u547d\u4ee4\u53ef\u4ee5\u67e5\u51fa\u6240\u6709\u7248\u672c\u7684\u6570\u636e\uff08scan\u5728\u5237\u5199\u4e4b\u540e\u5c31\u4e0d\u4e00\u5b9a\u4e86\uff0c\u56e0\u4e3a\u5237\u5199\u4e4b\u540eHFile\u53ea\u4f1a\u4fdd\u5b58\u5217\u65cf\u7684VERSIONS\u8bbe\u7f6e\u7684\u4e2a\u6570\uff0c\u4e0d\u8fc7\u5e76\u4e0d\u662f\u8bf4\u8be5\u5217\u7684\u6570\u636e\u5728\u6240\u6709HFile\u4e2d\u6700\u591a\u4fdd\u5b58\u4e86\u5217\u65cfVERSIONS\u8bbe\u7f6e\u7684\u4e2a\u6570\uff0c\u8981\u7b49\u5230\u6240\u6709HFile\u6587\u4ef6\u5408\u5e76\u4e4b\u540e\u624d\u6562\u8bf4\u5217\u7684\u6570\u636e\u6700\u591a\u53ea\u4fdd\u5b58\u4e86\u5217\u65cfVERSIONS\u8bbe\u7f6e\u7684\u4e2a\u6570\uff09 Text Only<pre><code>get 'student','1002',{COLUMN =&gt; 'info1:sex',VERSIONS =&gt; 4}\n</code></pre></p> <p>\u7edf\u8ba1\u8868\u6570\u636e\u884c\u6570 Text Only<pre><code>count 'student'\n</code></pre></p> <p>\u5220\u9664\u6570\u636e \u00a0 \u5220\u9664\u67d0\u4e2a rowkey \u7684\u67d0\u4e00\u5217\u7684\u6700\u65b0\u4e00\u4e2a\u7248\u672c\u7684\u6570\u636e\uff08 type=Delete\uff09\uff1a Text Only<pre><code>delete 'student','1002','info1:sex'\n</code></pre> \u00a0\u5220\u9664\u67d0\u4e2a rowkey \u7684\u67d0\u4e00\u5217\u7684\u6240\u6709\u7248\u672c\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u628a\u8be5rowkey\u7684\u8fd9\u4e00\u5217\u7ed9\u5220\u9664\u4e86\uff08type=DeleteColumn\uff09: Text Only<pre><code>deleteall 'student','1002','info1:sex'\n</code></pre> \u00a0\u5220\u9664\u67d0\u4e2a rowkey \u4e00\u4e2a\u5217\u65cf\u7684\u6240\u6709\u6570\u636e\uff08type=DeleteFamily\uff09\uff0c\u4f46\u662fshell\u547d\u4ee4\u91cc\u9762\u6ca1\u6709\u5355\u72ec\u5220\u9664\u4e00\u4e2a\u5217\u65cf\u6570\u636e\u7684\u547d\u4ee4\uff0cAPI\u91cc\u9762\u6709\uff0c\u53ea\u80fd\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u4e00\u4e0b\u5b50\u5220\u9664\u67d0 rowkey \u7684\u5168\u90e8\u6570\u636e\uff0c\u5220\u9664\u7684\u8fc7\u7a0b\u662f\u4f9d\u6b21\u5220\u9664\u8be5rowkey\u7684\u6bcf\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e\u3002 Text Only<pre><code>deleteall 'student','1001'\n</code></pre> </p> <p>\u6e05\u7a7a\u8868\u6570\u636e Text Only<pre><code>truncate 'student'\n</code></pre></p> <p>\u4e09\u3001\u547d\u540d\u7a7a\u95f4\u7684\u64cd\u4f5c \u547d\u540d\u7a7a\u95f4\u7c7b\u4f3c\u4e8eMySQL\u4e2d\u7684\u6570\u636e\u5e93\u540d \u521b\u5efa\u547d\u540d\u7a7a\u95f4 Text Only<pre><code>create_namespace 'bigdata'\n</code></pre> \u67e5\u770b\u6709\u54ea\u4e9b\u547d\u540d\u7a7a\u95f4 Text Only<pre><code>list_namespace\n</code></pre> \u67e5\u770b\u547d\u540d\u7a7a\u95f4\u4e0b\u6709\u54ea\u4e9b\u8868 Text Only<pre><code>list_namespace_tables 'default'\n</code></pre> \u5220\u9664\u547d\u540d\u7a7a\u95f4\uff0c\u524d\u63d0\u662f\u547d\u540d\u7a7a\u95f4\u4e0b\u6ca1\u6709\u8868 Text Only<pre><code>drop_namespace 'bigdata'\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/3-HBase%E8%A1%A8%E7%9A%84%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84%20%E5%92%8C%20%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/","title":"3-HBase\u8868\u7684\u903b\u8f91\u7ed3\u6784 \u548c \u7269\u7406\u5b58\u50a8\u7ed3\u6784","text":"<p> \u7ea6 1128 \u4e2a\u5b57  11 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 23 \u5206\u949f</p> <p>HBase\u8868\u7684\u903b\u8f91\u7ed3\u6784\uff1a </p> <ul> <li>RowKey\uff1a\u6bcf\u4e00\u884c\u6570\u636e\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684RowKey\uff0c\u7c7b\u4f3c\u4e8eMySQL\u7684\u4e3b\u952e\uff0c\u4f46\u662f\uff0cHBase\u7684RowKey\u5728\u5efa\u8868\u65f6\u4e0d\u9700\u8981\u6307\u5b9a\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u5c31\u5fc5\u987b\u8981\u6709\uff0c\u63d2\u5165\u6570\u636e\u65f6\u5fc5\u987b\u7ed9\u51fa\uff0c\u53ef\u4ee5\u662f\u4efb\u610f\u5b57\u7b26\u4e32(\u6700\u5927\u957f\u5ea6\u662f 64KB\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u957f\u5ea6\u4e00\u822c\u4e3a10-100bytes)\u3002 \u6570\u636e\u662f\u6309\u7167 RowKey\u7684\u5b57\u5178\u987a\u5e8f\u5b58\u50a8\u7684\uff0c\u5e76\u4e14\u67e5\u8be2\u6570\u636e\u65f6\u53ea\u80fd\u6839\u636e RowKey \u8fdb\u884c\u68c0\u7d22\uff0c\u6240\u4ee5 RowKey \u7684\u8bbe\u8ba1\u5341\u5206\u91cd\u8981\u3002</li> <li>\u5217\u65cf\uff1aHBase\u7684\u5217\u65cf\u7c7b\u4f3c\u4e8eMySQL\u7684\u5217\uff0c\u5217\u65cf\u5728\u5efa\u8868\u65f6\u5fc5\u987b\u7ed9\u51fa\uff0c\u5217\u65cf\u4e0b\u9762\u53ef\u4ee5\u8bb8\u591a\u5217\u3002</li> <li>\u5217\uff1a\u5217\u65cf\u4e0b\u9762\u7684\u5217\u662f\u52a8\u6001\u7684\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u52a8\u6001\u589e\u51cf\uff0c\u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u6240\u4ee5\u8bf4HBase\u8868\u5177\u6709\u7a00\u758f\u6027\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u5355\u5143\u683c\u90fd\u6709\u6570\u636e\u3002</li> </ul> <p></p> <ul> <li>Region\uff1aRegion\u5c31\u662f\u5c06\u8868\u6a2a\u5411\u5207\u5206\u7684\u4e00\u6bb5\uff0c\u521a\u5f00\u59cb\u65f6\u53ea\u6709\u4e00\u4e2aRegion\uff0c\u6570\u636e\u91cf\u5927\u4e86\u4e4b\u540e\u624d\u4f1a\u5207\u5206\u6210\u591a\u4e2aRegion\uff0c\u6bcf\u4e2aRegion\u7531\u4e00\u4e2aHRegionServer\u6765\u7ef4\u62a4\u3002</li> <li>store\uff1a\u5c31\u662f\u4e00\u4e2aRegion\u7684\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e\uff0c\u662f\u6570\u636e\u5b58\u50a8\u5728HDFS\u4e0a\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u4e5f\u53ebStoreFile\u6216HFile\u3002</li> </ul> <p>\u547d\u540d\u7a7a\u95f4\uff1a\u7c7b\u4f3c\u4e8eMySQL\u4e2d\u7684\u6570\u636e\u5e93\uff0c\u8868\u9700\u8981\u5efa\u5728\u547d\u540d\u7a7a\u95f4\u4e0b\u3002HBase\u6709\u4e24\u4e2a\u9ed8\u8ba4\u5b58\u5728\u7684\u547d\u540d\u7a7a\u95f4\uff0chbase\u548cdefault\u3002hbase\u547d\u540d\u7a7a\u95f4\u4e0b\u6709\u4e24\u5f20\u8868hbase:meta\u548chbase:namespace\uff0chbase:meta\u4e2d\u5b58\u7684\u662f\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\u4ee5\u53ca\u8868\u7684HRegion\u6b63\u5728\u88ab\u54ea\u4e9bHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\uff0chbase:namespace\u4e2d\u5b58\u7684\u662f\u6240\u6709\u7684\u547d\u540d\u7a7a\u95f4\u7684\u4fe1\u606f\u3002\u7528\u6237\u5efa\u8868\u65f6\u4e0d\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\uff0c\u8868\u5c31\u4f1a\u5728default\u547d\u540d\u7a7a\u95f4\u4e0b\u3002</p> <p>\u4ee5\u4e0a\u6982\u5ff5\u5728HDFS\u4e0a\u5b58\u50a8\u65f6\u7684\u7269\u7406\u7ed3\u6784\uff1a  </p> <p>HBase\u7684\u7269\u7406\u5b58\u50a8\u7ed3\u6784\uff1a </p> <ul> <li>\u5728\u8868\u7684\u903b\u8f91\u7ed3\u6784\u4e2d\uff0c\u901a\u8fc7 rowkey+\u5217\u65cf+\u5217 \u786e\u5b9a\u7684\u4e00\u4e2a\u5355\u5143\u683ccell\u5728\u7269\u7406\u5b58\u50a8\u65f6\u4f1a\u4fdd\u5b58\u6210\u4e00\u884c\u6570\u636e\uff0c\u8fd9\u884c\u6570\u636e\u5305\u542b\u4e86RowKey\u3001\u5217\u65cf\u3001\u5217\u9650\u5b9a\u7b26\u3001\u65f6\u95f4\u6233\u3001\u64cd\u4f5c\u7c7b\u578b\u3001\u503c\u3002</li> <li>\u65f6\u95f4\u6233\uff08timestamp\uff09\uff1a\u5728\u903b\u8f91\u7ed3\u6784\u4e2d\u901a\u8fc7 rowkey+\u5217\u65cf+\u5217 \u786e\u5b9a\u7684\u4e00\u4e2a\u5355\u5143\u683c\u4f1a\u4fdd\u5b58\u591a\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u6bcf\u4e2a\u7248\u672c\u90fd\u6709\u81ea\u5df1\u7684\u65f6\u95f4\u6233\uff0c\u65f6\u95f4\u6233\u6700\u5927\u7684\u4e3a\u6570\u636e\u7684\u6700\u65b0\u7248\u672c\u3002\u65f6\u95f4\u6233\u7684\u7c7b\u578b\u662f 64 \u4f4d\u6574\u578b\uff0c\u7cbe\u786e\u5230\u6beb\u79d2\uff0c\u53ef\u4ee5\u5728\u6570\u636e\u5199\u5165\u65f6\u81ea\u52a8\u8d4b\u503c\uff0c\u4e5f\u53ef\u4ee5\u7531\u5ba2\u6237\u663e\u5f0f\u8d4b\u503c\u3002</li> <li>\u903b\u8f91\u7ed3\u6784\u4e2d\u7684\u5355\u5143\u683c\u9700\u8981\u4fdd\u7559\u591a\u5c11\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u5efa\u8868\u65f6\u901a\u8fc7\u6307\u5b9a\u8be5\u5355\u5143\u683c\u6240\u5728\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u7684\u503c\u6765\u786e\u5b9a\uff0c\u9ed8\u8ba4\u53ea\u4fdd\u7559\u4e00\u4e2a\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u5728\u5efa\u8868\u4ee5\u540e\u4fee\u6539\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u7684\u503c\uff0c\u6bcf\u4e2a\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u7684\u503c\u53ef\u4ee5\u4e0d\u540c\u3002</li> </ul> <p>\u6bcf\u4e2a\u5217\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff08\u4e0b\u9762\u663e\u793a\u7684\u7ed3\u679c\u662f1 row(s)\uff0c\u8fd9\u662f\u56e0\u4e3a\u5728\u4f7f\u7528HBase\u65f6\u5e94\u8be5\u8003\u8651\u7684\u662f\u6570\u636e\u7684\u903b\u8f91\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2aRowKey\u4ee3\u8868\u7740\u4e00\u884c\u6570\u636e\uff09\uff1a \u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0 \u67d0\u4e2aRowKey\u7684\u67d0\u4e2a\u5217\u7684\u6240\u6709\u7248\u672c\u6570\u636e\uff1a \u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0</p> <ul> <li>\u64cd\u4f5c\u7c7b\u578b\uff08Type\uff09\uff1a\u63d2\u5165\u6216\u66f4\u65b0\u6570\u636e\u4e3aput\uff08\u67e5\u8be2\u65f6\u4e0d\u4f1a\u663e\u793a\uff09\uff0c\u5220\u9664\u6570\u636e\u6839\u636e\u5220\u9664\u7684\u8303\u56f4\u4e0d\u540c\u5206\u4e3a3\u79cd\u7c7b\u578b\uff1aDelete\u3001DeleteColumn\u3001DeleteFamily\uff0cDelete\u8868\u793a\u5220\u9664\u67d0\u4e2aRowKey\u7684\u67d0\u4e2a\u5217\u7684\u6700\u65b0\u4e00\u4e2a\u7248\u672c\uff0cDeleteColumn\u8868\u793a\u5220\u9664\u67d0\u4e2aRowKey\u7684\u67d0\u4e2a\u5217\u7684\u6240\u6709\u7248\u672c\uff0c\u5373\u5220\u9664\u8be5RowKey\u7684\u8be5\u5217\uff0cDeleteFamily\u8868\u793a\u5220\u9664\u8be5RowKey\u6574\u4e2a\u5217\u65cf\u7684\u6570\u636e\u3002</li> </ul> <p></p> <ul> <li>\u7269\u7406\u5b58\u50a8\u65f6\u7684value\u662f\u6ca1\u6709\u6570\u636e\u7c7b\u578b\u7684\uff0c\u4ee5\u5b57\u8282\u6570\u7ec4\u7684\u5f62\u5f0f\u5b58\u50a8\u3002</li> <li>\u4ece HBase \u7684\u5e95\u5c42\u7269\u7406\u5b58\u50a8\u7ed3\u6784\u6765\u770b\uff0cHBase \u66f4\u50cf\u662f\u4e00\u4e2a\u5bf9\u7ef4\u5ea6\u7684K-V\u6570\u636e\u5e93\u3002\u901a\u8fc7RowKey\u53ef\u4ee5\u67e5\u51fa\u8be5\u884c\u6240\u6709\u5217\u65cf\u7684\u6570\u636e\uff0c\u901a\u8fc7\u5217\u65cf\u53ef\u4ee5\u67e5\u51fa\u8be5\u884c\u8be5\u5217\u65cf\u4e0b\u6240\u6709\u5217\u7684\u6570\u636e\uff0c\u901a\u8fc7\u5217\u53ef\u4ee5\u67e5\u51fa\u591a\u4e2a\u7248\u672c\u7684value\u3002</li> </ul> <p>\u603b\u7ed3\uff0c\u5355\u7eaf\u4f7f\u7528HBase\u5b58\u53d6\u6570\u636e\u7684\u65f6\u5019\u601d\u8003\u7684\u662f\u903b\u8f91\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u8fd9\u51e0\u4e2a\u6982\u5ff5\uff1aRowKey\u3001\u5217\u65cf\u3001\u5217\u3001timestamp\u3002\u7531 RowKey + \u5217\u65cf + \u5217 \u786e\u5b9a\u4e00\u4e2a\u5355\u5143\u683c\uff0c\u4e00\u4e2a\u5355\u5143\u683c\u6709\u591a\u4e2a\u7248\u672c\u7684\u5386\u53f2\u6570\u636e\uff0c\u9760timestamp\u6807\u8bc6\u3002</p> <p>\u8003\u8651HBase\u539f\u7406\u7684\u65f6\u5019\u601d\u8003\u7684\u662f\u7269\u7406\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u8fd9\u51e0\u4e2a\u6982\u5ff5\uff1aRegion\u3001\u5217\u65cf\u3001store\u3001StoreFile\u3002\u7531Region\u548c\u5217\u65cf\u5212\u5206\u51fastroe\uff0c\u7269\u7406\u5b58\u50a8\u65f6\u7684\u5355\u4f4d\u5c31\u662fstore\uff0c\u5728HDFS\u4e0a\u901a\u8fc7Region+\u5217\u65cf\u5b9a\u4f4d\u5230\u7684\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5c31\u662fstore\u7684\u6570\u636e\uff0c\u6bcf\u4e2a\u6587\u4ef6\u79f0\u4e3aStoreFile\u6216HFile\uff0cStoreFile\u7684\u6570\u91cf\u89c6\u5237\u5199\u548c\u5408\u5e76\u60c5\u51b5\u800c\u5b9a\u3002HRegionServer\u7ef4\u62a4\u8868\u7684\u5355\u4f4d\u662fRegion\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/4-HBase%E6%9E%B6%E6%9E%84/","title":"4-HBase\u67b6\u6784","text":"<p> \u7ea6 1774 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 35 \u5206\u949f</p> <p>HBase\u67b6\u6784\uff1a </p> <p>HMaster\uff1a 1.\u5904\u7406\u5ba2\u6237\u7aef\u5bf9\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684ddl\u64cd\u4f5c \u5904\u7406\u5ba2\u6237\u7aef\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684\u521b\u5efa\u548c\u5220\u9664\u8bf7\u6c42\u3002HMaster\u4f1a\u628a\u547d\u540d\u7a7a\u95f4\u7684\u5143\u6570\u636e\u5199\u5230hbase:namespace\u8868\uff0c\u628a\u8868\u7684\u5143\u6570\u636e\u5199\u5230hbase:meta\u8868\u4e2d\uff0chbase:meta\u4e2d\u4e0d\u4ec5\u4fdd\u5b58\u7740\u8868\u7684\u5143\u6570\u636e\uff0c\u8fd8\u4fdd\u5b58\u7740\u8fd9\u5f20\u8868\u7684\u6240\u6709HRegion\u6b63\u5728\u88ab\u54ea\u4e9bHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u3002hbase:namespace\u8868\u548chbase:meta\u8868\u4e0e\u7528\u6237\u521b\u5efa\u7684\u8868\u4e00\u6837\uff0c\u540c\u6837\u4e5f\u9700\u8981\u88abHRegionServer\u7ef4\u62a4\u7684\uff0c\u6240\u4ee5HMaster\u662f\u4f5c\u4e3aHRegionServer\u7684\u5ba2\u6237\u7aef\u5c06\u5143\u6570\u636e\u4fe1\u606f\u5199\u5230\u7cfb\u7edf\u8868\u3002 2.\u76d1\u63a7\u548c\u7ba1\u7406\u7740HRegionServer\u96c6\u7fa4 HMaster\u4f1a\u5c06\u6240\u6709\u8868\u7684HRegion\u5206\u644a\u5230\u6bcf\u4e2aHRegionServer\u4e2d\u8fdb\u884c\u7ef4\u62a4\uff0c\u5b9e\u73b0HRegionServer\u96c6\u7fa4\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u63a5\u7740HMaster\u8fd8\u4f1a\u628a\u8868\u7684\u8fd9\u4e9bHRegion\u6b63\u5728\u88ab\u54ea\u4e9bHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u5199\u5230hbase:meta\u8868\u4e2d\uff0c\u6700\u540eHMaster\u4f1a\u628ahbase:meta\u8868\u6b63\u5728\u88ab\u54ea\u4e2aHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u5199\u5230zookeeper\u4e2d\uff0c\u6ce8\u610f\uff0chbase:meta\u8868\u7684\u7ef4\u62a4\u4efb\u52a1\u53ea\u4f1a\u4ea4\u7ed9\u4e00\u4e2aHRegionServer\uff0c\u662f\u56e0\u4e3ahbase:meta\u8868\u5b58\u7684\u662f\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6240\u4ee5hbase:meta\u8868\u7684\u6570\u636e\u91cf\u5e76\u4e0d\u4f1a\u8fbe\u5230\u5212\u5206HRegion\u7684\u7a0b\u5ea6\uff0c\u4e5f\u5c31\u662fhbase:meta\u8868\u53ea\u4f1a\u6709\u4e00\u4e2aHRegion\u3002 \u8fd8\u6709\u5c31\u662f\u5f53\u6709HRegionServer\u6302\u6389\u4e86\uff0cHMaster\u4f1a\u628a\u6302\u6389\u7684HRegionServer\u6240\u7ef4\u62a4\u7684HRegion\u7684\u4efb\u52a1\u5206\u7ed9\u5176\u5b83\u7684\u5b58\u6d3b\u7684HRegionServer\uff0c\u63a5\u7740HMaster\u4f1a\u4fee\u6539hbase:meta\u8868\u4e2d\u5173\u4e8eHRegion\u6b63\u5728\u88ab\u54ea\u4e9bHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u3002</p> <p>zookeeper\uff1a zookeeper\u7684\u6570\u636e\u5b58\u50a8\u670d\u52a1\uff1azookeeper\u4fdd\u5b58\u4e86hbase:meta\u8868\u6b63\u5728\u88ab\u54ea\u4e2aHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5176\u5b83\u5f88\u591a\u4fe1\u606f\uff0c\u6bd4\u5982master\u548c/backup-masters\u6240\u5728\u7684\u4e3b\u673a\uff1b  zookeeper\u7684\u76d1\u542c\u901a\u77e5\u670d\u52a1\uff1amaster\u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u4e5f\u4f9d\u8d56\u4e8ezookeeper\uff0c\u6240\u6709HMaster\u4f1a\u5728zookeeper\u4e0a\u521b\u5efa\u4e34\u65f6\u8282\u70b9\uff0c\u5f53\u4e3bHMaster\u6302\u6389\u4e4b\u540e\uff0c\u5176\u5b83\u5907\u4efdMaster\u5c31\u4f1a\u6536\u5230\u901a\u77e5\uff0c\u6b63\u5982Kafka\u96c6\u7fa4controller\u7684\u9009\u4e3e\u4e00\u6837\uff0c\u8fd9\u91cc\u7684\u5907\u4efdHMaster\u4e5f\u5e94\u8be5\u662f\u4e89\u62a2\u7740\u521b\u5efa\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u8c01\u521b\u5efa\u6210\u529f\u5c31\u4f1a\u79f0\u6210\u4e3a\u4e3bHMaster\u3002\uff08HMaster\u6536\u5230HRegionServer\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf\u7684\u901a\u77e5\u53ef\u80fd\u4e5f\u662f\u57fa\u4e8ezookeeper\u7684\u4e34\u65f6\u8282\u70b9\u673a\u5236\u3002\uff09</p> <p>Client\uff1a HBase\u7684\u5ba2\u6237\u7aef\u5e76\u4e0d\u9700\u8981\u4e0eHMaster\u8fde\u63a5\uff0c\u56e0\u4e3aHMaster\u5df2\u7ecf\u5c06Client\u6240\u9700\u8981\u7684\u96c6\u7fa4\u7684\u4fe1\u606f\u5b58\u5230zookeeper\u4e86\uff0c\u6240\u4ee5HBase\u7684\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u4e0ezookeeper\u5efa\u7acb\u8fde\u63a5\u5373\u53ef\uff0cClient\u4f1a\u4ecezookeeper\u4e2d\u83b7\u53d6\u5230\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u7136\u540e\u518d\u4e0e\u5177\u4f53\u7684\u4e3b\u673a\u8fde\u63a5\u5b8c\u6210\u8bf7\u6c42\u3002 \u6bd4\u5982\uff0c\u5982\u679c\u662f\u5bf9\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684ddl\u64cd\u4f5c\uff0c\u90a3\u4e48Client\u4f1a\u4ecezookeeper\u4e2d\u4f1a\u627e\u5230HMaster\u7684\u4fe1\u606f\uff0c\u7136\u540e\u4e0eHMaster\u8fde\u63a5\u5e76\u53d1\u9001\u8bf7\u6c42\uff0c\u6240\u4ee5\u5f53HMaster\u6302\u6389\u4e4b\u540e\u5bf9\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684ddl\u64cd\u4f5c\u5c06\u4e0d\u80fd\u8fdb\u884c\uff0c\u89c1\u4e0b\u56fe\u3002   \u5982\u679c\u662f\u8bfb\u5199\u6570\u636e\u7684\u8bf7\u6c42\uff0cClient\u4f1a\u5148\u5728zookeeper\u4e2d\u627e\u5230hbase:meta\u8868\u6240\u5728\u7684HRegionServer\uff0c\u7136\u540e\u518d\u4e0e\u8be5HRegionServer\u8fde\u63a5\uff0c\u4ece hbase:meta\u8868\u4e2d\u627e\u5230\u8981\u67e5\u7684\u6570\u636e\u6240\u5728\u7684HRegion\uff08\u901a\u8fc7RowKey\u4e0eHRegion\u7684Start Key\u548cEnd Key\u4e00\u6bd4\u8f83\u5c31\u77e5\u9053\u4e86\uff09\uff0c\u4ee5\u53ca\u8be5HRegion\u6240\u5728HRegionServer\uff0c\u6700\u540e\u518d\u4e0e\u8fd9\u4e2aHRegionServer\u8fde\u63a5\u5e76\u5b8c\u6210\u6570\u636e\u67e5\u8be2\uff0c\u8bfb\u5199\u6570\u636e\u7684\u8be6\u7ec6\u6d41\u7a0b\u89c17\u548c9\u4e24\u7bc7\u7b14\u8bb0\u3002</p> <p>HRegionServer\uff1a HRegionServer\u662f\u7ef4\u62a4\u8868\u7684Region\u7684\u8fdb\u7a0b\uff0c\u6240\u6709\u7684HRegionServer\u8fdb\u7a0b\u5c31\u7ec4\u6210\u4e86HRegionServer\u96c6\u7fa4\uff0c\u7ef4\u62a4\u7684\u610f\u601d\u662f\u6307\u7531HRegionServer\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u5bf9\u8be5HRegion\u7684\u8bfb\u5199\u8bf7\u6c42\u3002\u6bcf\u4e00\u5f20\u8868\u90fd\u662f\u4ee5Region\u4e3a\u5355\u4f4d\u5212\u5206\u4e4b\u540e\u518d\u4ea4\u7ed9\u540c\u4e00\u4e2a\u6216\u8005\u4e0d\u540c\u7684HRegionServer\u8fdb\u884c\u7ef4\u62a4\u7684\uff0c\u4e00\u4e2aHRegionServer\u53ef\u4ee5\u7ef4\u62a4\u8bb8\u591a\u6765\u81ea\u4e0d\u540c\u8868\u7684Region\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u662f\u540c\u4e00\u5f20\u8868\u7684\u4e0d\u540cRegion\u3002 \uff08\u6ce8\uff1aHRegion\u4e0eRegion\u6307\u7684\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\uff0c\u786c\u8981\u505a\u533a\u5206\u7684\u8bdd\uff0cRegion\u662f\u5bf9\u4e8e\u8868\u7684\u903b\u8f91\u7ed3\u6784\u6765\u8bf4\uff0cHRegion\u662f\u5bf9\u4e8e\u7a0b\u5e8f\u6216\u8005\u8bf4\u5bf9\u4e8eHRegionServer\u8fdb\u7a0b\u6765\u8bf4\u7684\uff09 \u5982\u4e0b\u56fe\u6240\u793a\u7cfb\u7edf\u8868hbase:meta\u548chbase:namespace\u90fd\u53ea\u6709\u4e00\u4e2aRegion\uff0c\u5206\u522b\u5728hadoop104\u548chadoop102\u4e0a\uff0c\u7528\u6237\u8868student\u4e5f\u53ea\u6709\u4e00\u4e2aRegion\uff0c\u5728hadoop103\u4e0a\uff0c\u53ef\u4ee5\u5c06hadoop103\u4e0a\u7684 HRegionServer\u8fdb\u7a0b\u6740\u6b7b\uff0c\u8fd9\u65f6\u5728HMaster\u7684\u8c03\u5ea6\u4e0b\u8be5HRegion\u7684\u7ef4\u62a4\u4efb\u52a1\u5c31\u4f1a\u8f6c\u79fb\u5230hadoop104\u6216\u8005hadoop102\u4e0a\uff0c\u76f4\u63a5\u5c06HRegionServer\u8fdb\u7a0b\u6740\u6b7b\u5e76\u4e0d\u4f1a\u9020\u6210\u6570\u636e\u7684\u4e22\u5931\uff0cHRegionServer\u53ef\u4ee5\u6839\u636eWAL\u548cHDFS\u4e0a\u7684HFile\u8fd8\u539f\u6570\u636e\u3002 </p> <p>HRegion\uff1a \u6bcf\u4e00\u5f20\u8868\u90fd\u662f\u4ee5Region\u4e3a\u5355\u4f4d\u5212\u5206\u4e4b\u540e\u518d\u4ea4\u7ed9\u540c\u4e00\u4e2a\u6216\u8005\u4e0d\u540c\u7684HRegionServer\u8fdb\u884c\u7ef4\u62a4\u7684\u3002\u4e00\u4e2aRegion\u91cc\u9762\u6709\u591a\u4e2aStore\uff0cStore\u7684\u6570\u91cf\u53d6\u51b3\u4e8eRegion\u5bf9\u5e94\u7684\u8868\u6709\u591a\u5c11\u4e2a\u5217\u65cf\uff0c\u4e00\u4e2aStore\u5bf9\u5e94\u4e8eHRegion\u4e2d\u7684\u4e00\u4e2aMemStore\uff0c\u6240\u4ee5\u4e5f\u4e00\u4e2aHRegion\u91cc\u9762\u6709\u591a\u4e2aMemStore\u3002</p> <p>Store\uff1a Store\u662f\u8868\u7684\u903b\u8f91\u7ed3\u6784\u4e2d\u7684\u6982\u5ff5\uff0c\u4e00\u4e2aRegion\u7684\u4e00\u4e2a\u5217\u65cf\u5c31\u662f\u4e00\u4e2aStore\uff0c\u5bf9\u5e94\u5230\u5b9e\u9645\u5b58\u50a8\u5c31\u662f\uff0c\u5185\u5b58\u4e2d\u7684Mem Store \u548c HDFS\u4e0a\u7684HFile\u3002</p> <p>MemStore\uff1a \u8868\u7684Store\u7684\u6570\u636e\u5728\u5185\u5b58\u4e2d\u5c31\u662fMemStore\uff0c\u5ba2\u6237\u7aef\u5728\u8be5 Store\u4e0a\u7684\u5199\u8bf7\u6c42\u4f1a\u5148\u5411\u5199\u5230HDFS\u4e0a\u7684WAL\u4e2d\uff0c\u5982\u679c\u6210\u529f\u5730\u5c06\u5199\u8bf7\u6c42\u65e5\u5fd7\u5199\u5165WAL\uff0c\u90a3\u4e48\u63a5\u7740\u4f1a\u5728MemStore\u8bb0\u5f55\u4e0b\u8fd9\u6761\u6570\u636e\uff0c\u7136\u540e\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u5199\u5165\u6210\u529f\uff0c\u63a5\u7740\u6570\u636e\u4f1a\u5728MemStore\u6309RowKey\u6392\u5e8f\uff0c\u6240\u4ee5Mem Store\u91cc\u9762\u5b58\u653e\u7684\u662f\u8fd8\u6ca1\u6709\u5237\u5199\u5230HDFS\u4e0a\u6570\u636e\u3002</p> <p>HLog\uff1a \u4e5f\u5c31\u662fHBase\u7684WAL\uff08Write Ahead Log\uff0c\u9884\u5199\u65e5\u5fd7\uff09\uff0c\u4e3a\u4fdd\u8bc1\u6301\u4e45\u6027\uff0c\u6bcf\u6b21\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\u4f1a\u5148\u8bb0\u5f55\u5230HDFS\u4e0a\u7684WAL\u4e2d\uff0c\u7136\u540e\u518d\u4fee\u6539Mem Store\u4e2d\u7684\u6570\u636e\uff0c\u5982\u679c\u8fd9\u4e24\u6b65\u6210\u529f\u4e86\uff0c\u5c31\u76f4\u63a5\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u6210\u529f\uff0c\u4e0d\u5fc5\u7b49\u5230Mem Store\u4e2d\u7684\u6570\u636e\u5237\u5199\u5230HDFS\u4e0a\uff0c\u56e0\u4e3a\u5c06\u4fee\u6539\u64cd\u4f5c\u5148\u8bb0\u5f55\u5230HDFS\u4e0a\u7684WAL\u7684\u8fc7\u7a0b\u662f\u987a\u5e8f\u5199\uff0c\u800c\u4e14\u6570\u636e\u91cf\u5c0f\uff0c\u6bd4\u8d77\u6bcf\u6b21\u76f4\u63a5\u5c06Mem Store\u4e2d\u7684\u6570\u636e\u5237\u5199\u5230HDFS\u4e0a\u8981\u5feb\u5f97\u591a\u3002\u66f4\u591a\u5173\u4e8eWAL\u7684\u5185\u5bb9\u89c1\u7b2c6\u7bc7\u7b14\u8bb0\u3002 WAL\u5728HDFS\u7684/HBase/WALs\u76ee\u5f55\u4e0b\uff0c\u524d\u9762\u8bf4\u7528\u6237\u8868student\u7684Region\u5728hadoop103\u4e0a\uff0c\u6240\u4ee5\u5f80student\u589e\u5220\u6539\u7684\u64cd\u4f5c\u90fd\u9996\u5148\u4f1a\u8bb0\u5f55\u5728/HBase/WALs\u76ee\u5f55\u4e0b\u7684hadoop103\u7684WAL\u4e0a\uff0c\u901a\u8fc7\u5b9e\u9a8c\u9a8c\u8bc1\u786e\u5b9e\u662f\u8fd9\u6837\u7684\uff0chadoop103\u7684WAL\u4f1a\u8ffd\u52a0\u4e00\u6bb5\u5185\u5bb9\uff0c\u4f46\u662f/HBase/data/default/student/20a75113377ff8a87e089b93684a856c/info1\u4e0b\u7684HFile\u5e76\u6ca1\u6709\u53d8\u5316\uff0c\u56e0\u4e3aHFile\u53ea\u5728\u5237\u5199Mem Store \u6216\u8005 \u5408\u5e76 \u6216\u8005 \u5207\u5206 \u65f6\u624d\u4f1a\u53d8\u5316\u3002</p> <p>StoreFile\u4e0eHFile\uff1a StoreFile\u4e0eHFile\u53ef\u4ee5\u8bf4\u662f\u540c\u4e00\u79cd\u4e1c\u897f\uff0c\u786c\u8981\u533a\u5206\u7684\u8bdd\uff0cStoreFile\u4ee5HFile\u7684\u683c\u5f0f\u4fdd\u5b58\u5728HDFS\u4e0a\u3002MemStore\u91cc\u9762\u8bb0\u5f55\u7684\u662f\u6240\u6709\u7248\u672c\u7684\u6570\u636e\uff0c\u5237\u5199\u5230HDFS\u4e0a\u65f6\uff0c\u53ea\u4f1a\u4fdd\u5b58\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS\u4e2a\u7248\u672c\uff0c\u5c06MemStore\u5237\u5199\u5230HDFS\u4e0a\u5c31\u6210\u4e86HFile\u3002\u56e0\u4e3aMemStore\u53ef\u80fd\u4f1a\u7ecf\u5386\u8bb8\u591a\u6b21\u5237\u5199\uff0c\u6240\u4ee5\u56fe\u4e0a\u5c31\u753b\u4e86\u591a\u4e2aStoreFile\u548cHFile\uff0c\u4e8e\u662f\u8868\u7684Store\uff08\u4e00\u4e2aRegion\u7684\u4e00\u4e2a\u5217\u65cf\uff09\u5728HDFS\u4e0a\u4f1a\u6709\u591a\u4e2aHFile\uff0c\u4e0d\u8fc7\u4e0d\u7528\u62c5\u5fc3\uff0c\u6240\u6709\u7684HFile\u5408\u5e76\u4e4b\u540e\u624d\u662f\u8be5\u8868\u7684\u8fd9\u4e2aStore\u7684\u6700\u7ec8\u6570\u636e\u3002\u56e0\u4e3a\u5408\u5e76\u5e76\u4e0d\u662f\u7b80\u5355\u628a\u6587\u4ef6\u62fc\u63a5\u8d77\u6765\uff0c\u5728HBase\u4e2d\u6570\u636e\u662f\u5b58\u5728\u591a\u4e2a\u7248\u672c\u7684\uff0c\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS\u662f\u6700\u591a\u4fdd\u7559\u591a\u5c11\u4e2a\u7248\u672c\uff0c\u6240\u4ee5\u5408\u5e76\u5176\u5b9e\u662f\u4f1a\u5220\u9664\u4e0d\u8981\u7684\u7248\u672c\u7684\u6570\u636e\u3002</p> <p>HDFS\uff1a HBase\u662f\u4f9d\u8d56\u4e8eHDFS\u6765\u5b58\u50a8\u8868\u4e2d\u7684\u6570\u636e\u7684\uff0cHDFS\u4e3aHBase\u63d0\u4f9b\u4e86\u9ad8\u53ef\u9760\u7684\u6570\u636e\u5b58\u50a8\u670d\u52a1\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/5-%E9%A2%84%E5%88%86%E5%8C%BA%20%E4%B8%8E%20RowKey%E8%AE%BE%E8%AE%A1/","title":"5-\u9884\u5206\u533a \u4e0e RowKey\u8bbe\u8ba1","text":"<p> \u7ea6 937 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>\u9884\u5206\u533a\u9700\u8981\u5728\u521b\u5efa\u8868\u65f6\u6307\u5b9a\uff0c\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a 1.\u76f4\u63a5\u6307\u5b9a\uff0c\u6307\u5b9a4\u4e2a\u5206\u533a\u952e\u5c31\u4f1a\u67095\u4e2a\u8303\u56f4\uff0c\u4e8e\u662f\u5c31\u67095\u4e2aRegion Text Only<pre><code>create 'staff1','cf1','cf2',SPLITS =&gt; ['1000','2000','3000','4000']\n</code></pre> 5\u4e2aRegion\u88ab\u5206\u6563\u5728HRegionServer\u96c6\u7fa4\u4e2d\u8fdb\u884c\u7ef4\u62a4\uff0c\u63d2\u5165\u6570\u636e\u65f6RowKey\u4f1a\u4e0eRegion\u7684StartKey\u548cEndKey\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ece\u800c\u5c06\u6570\u636e\u4f1a\u6563\u843d\u5728\u4e0d\u540c\u7684Region\u4e2d\u3002   Region\u548cRegionServer\u7684\u5173\u7cfb\uff1a </p> <p>2. \u751f\u6210 16 \u8fdb\u5236\u5e8f\u5217\u9884\u5206\u533a Text Only<pre><code>create 'staff2','cf1','cf2',{NUMREGIONS =&gt; 15, SPLITALGO =&gt; 'HexStringSplit'}\n</code></pre> </p> <p>3. \u6309\u7167\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u89c4\u5219\u9884\u5206\u533a \u521b\u5efa splits.txt \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a Text Only<pre><code>aaaa\nbbbb\ncccc\ndddd\n</code></pre> \u7136\u540e\u6267\u884c\uff1a Text Only<pre><code>create 'staff3','cf1','cf2',SPLITS_FILE =&gt; 'splits.txt'\n</code></pre> </p> <p>RowKey\u8bbe\u8ba1\uff1a RowKey\u7684\u8bbe\u8ba1\u8981\u4e0e\u9884\u5206\u533a\u7ed3\u5408\u8d77\u6765\u8003\u8651\uff0c\u56e0\u4e3a\u63d2\u5165\u6570\u636e\u65f6\u7684RowKey\u4f1a\u4e0eRegion\u7684StartKey\u548cEndKey\u8fdb\u884c\u6bd4\u8f83\uff0c\u6bd4\u8f83\u89c4\u5219\u662f\u6309\u4f4d\u6bd4\u8f83\uff0c\u6709\u6bd4\u6ca1\u6709\u5927\uff0c\u4ece\u800c\u6570\u636e\u4f1a\u843d\u5728\u4e0d\u540c\u7684Region\u4e2d\uff0c\u6240\u4ee5RowKey\u7684\u8bbe\u8ba1\u5c31\u975e\u5e38\u91cd\u8981\u4e86\u3002RowKey\u7684\u8bbe\u8ba1\u7684\u76ee\u6807\u4e3b\u8981\u5173\u6ce8\u4e24\u70b9\uff0c\u6563\u5217\u6027\u548c\u96c6\u4e2d\u6027\u3002\u6563\u5217\u6027\u662f\u6307\u4e0d\u540c\u7c7b\u7684\u6570\u636e\u5c3d\u91cf\u5747\u5300\u7684\u5206\u6563\u5728\u4e0d\u540c\u7684Region\u4e2d\uff1b\u96c6\u4e2d\u6027\u662f\u6307\u540c\u4e00\u7c7b\u6570\u636e\u8981\u653e\u5728\u540c\u4e00\u4e2aRegion\u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528 STARTROW \u548c STOPROW \u5feb\u901f\u67e5\u51fa\u540c\u4e00\u7c7b\u6570\u636e\u4e86\u3002\u81f3\u4e8e\u540c\u4e00\u7c7b\u548c\u4e0d\u540c\u7c7b\u5177\u4f53\u6307\u7684\u662f\u4ec0\u4e48\u8981\u7ed3\u5408\u4e1a\u52a1\u6765\u5206\u6790\u3002</p> <p>\u6848\u4f8b\uff1a\u7535\u4fe1\u516c\u53f8\u6709\u5982\u4e0b\u901a\u8bdd\u6570\u636e\uff0c\u4e3a\u4e86\u65b9\u4fbf\u540e\u7eed\u6570\u636e\u5206\u6790\uff0c\u9700\u8981\u5c06\u6570\u636e\u5b58\u5230HBase\uff0c\u8bf7\u8bbe\u8ba1RowKey </p> <p>\u5206\u533a\u952e\u7684\u8bbe\u8ba1\u6bd4\u8f83\u56fa\u5b9a\uff0c\u5047\u8bbe\u8bbe\u7f6e300\u4e2a\u9884\u5206\u533a\uff0c\u90a3\u4e48\u5206\u533a\u952e\u5982\u4e0b\uff0c\u540e\u9762\u52a0\u4e00\u4e2a\u7ad6\u6760\u662f\u56e0\u4e3a\u7ad6\u6760\u7684ascii\u7801\u503c\u5927\uff0c\u5728\u8bbe\u8ba1RowKey\u7684\u65f6\u5019\u4f1a\u4ee5\u4e09\u4e2a\u6570\u5b57\u52a0\u4e00\u4e2a\u4e0b\u5212\u7ebf_\u5f00\u5934\uff0c\u8fd9\u6837\u5206\u533a\u952e\u7684\u7ad6\u6760\u5c31\u53ef\u4ee5\u8d77\u5230\u4e00\u4e2a\u62e6\u622a\u7684\u4f5c\u7528\uff0c\u5373\u4ee5000_\u5f00\u5934\u7684RowKey\u5c31\u4e00\u5b9a\u4f1a\u8fdb\u5165\u5230\u7b2c\u4e00\u4e2aRegion\uff0c\u4e0d\u7136\u5f53\u5206\u533a\u952e\u662f000\uff0cRowKey\u662f0001\u5c31\u4f1a\u8fdb\u5230\u7b2c\u4e8c\u4e2aRegion\uff0c\u56e0\u4e3a\u6709\u6bd4\u6ca1\u6709\u5927\u3002 Text Only<pre><code>000|\n001|\n...\n298|\n</code></pre> \u8003\u8651\u96c6\u4e2d\u6027\uff1a \u6839\u636e\u4e1a\u52a1\u573a\u666f\u6765\u770b\uff0c\u56e0\u4e3a\u6709\u7684\u4e00\u4e2a\u624b\u673a\u53f7\u4e00\u5e74\u7684\u901a\u8bdd\u8bb0\u5f55\u53ef\u80fd\u975e\u5e38\u591a\uff0c\u6709\u7684\u5374\u975e\u5e38\u5c11\uff0c\u6240\u4ee5\u5982\u679c\u5c06\u4e00\u4e2a\u4e3b\u53eb\u53f7\u4e00\u5e74\u6570\u636e\u653e\u8fdb\u4e00\u4e2aRegion\u53ef\u80fd\u4f1a\u4ea7\u751f\u6570\u636e\u503e\u659c\uff0c\u5373\u6709\u7684Region\u6570\u636e\u975e\u5e38\u591a\uff0c\u6709\u7684\u975e\u5e38\u5c11\uff1b\u5982\u679c\u5c06\u4e00\u4e2a\u4e3b\u53eb\u53f7\u4e00\u5929\u7684\u6570\u636e\u653e\u8fdb\u4e00\u4e2aRegion\u53c8\u4e0d\u65b9\u4fbf\u540e\u671f\u8fdb\u884c\u7edf\u8ba1\uff1b\u7efc\u4e0a\uff0c\u6240\u4ee5\u9009\u62e9\u628a\u4e00\u4e2a\u4e3b\u53eb\u53f7\u7684\u4e00\u4e2a\u6708\u7684\u6570\u636e\u653e\u8fdb\u4e00\u4e2aRegion\u3002 \u8003\u8651\u6563\u5217\u6027\uff1a \u56e0\u4e3a\u8981\u628a\u4e00\u4e2a\u4e3b\u53eb\u53f7\u4e00\u4e2a\u6708\u7684\u6570\u636e\u653e\u8fdb\u4e00\u4e2aRegion\uff0c\u6240\u4ee5\u8981\u628a\u4e00\u4e2a\u4e3b\u53eb\u53f7\u4e0d\u540c\u6708\u7684\u6570\u636e\u6563\u5217\u5230\u4e0d\u540c\u7684Region\u4e2d\u3002 \u7efc\u4e0a\u4e24\u70b9\u8003\u8651\uff0cRowKey\u8fd9\u6837\u8bbe\u8ba1\uff0c\u62ff\u7b2c\u4e00\u6761\u6570\u636e\u4e3e\u4f8b\uff0c\u5176RowKey\u4e3a\uff1axxx_<code>13412341234\\_202106</code>06121212 xxx\u6839\u636ehash(<code>13412341234\\_202106</code>)%300\u5f97\u5230\uff0c\u56e0\u4e3a\u8ba1\u7b97\u7684\u662f\u4e00\u4e2a\u624b\u673a\u53f7\u67d0\u4e2a\u6708\u7684hash\u503c\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u4e3b\u53eb\u53f7\u540c\u4e00\u4e2a\u6708\u7684\u6570\u636e\u4f1a\u8fdb\u5230\u540c\u4e00Region\uff0c\u8fd9\u5c31\u662f\u96c6\u4e2d\u6027\uff1b\u53c8\u56e0\u4e3a\u53d6\u7684hash\u503c\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u4e3b\u53eb\u53f7\u4e0d\u540c\u6708\u7684\u6570\u636e\u7684hash\u503c\u4e0d\u540c\uff0c\u8fdb\u800c\u53d6\u4f59\u5c31\u4e0d\u540c\uff0c\u6240\u4ee5\u4f1a\u8fdb\u5230\u4e0d\u540cRegion\u4e2d\uff0c\u8fd9\u5c31\u662f\u6563\u5217\u6027\uff08\u4e0d\u8fc7\u6563\u5217\u503c\u548c\u53d6\u4f59\u64cd\u4f5c\u53ea\u80fd\u5c3d\u91cf\u4fdd\u8bc1\u7ed3\u679c\u4e0d\u540c\uff09\u3002 \u540e\u9762\u53d6\u4e00\u4e2a\u624b\u673a\u53f7\u540c\u4e00\u4e2a\u6708\u7684\u6240\u4ee5\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u4ee5\u7528\u76f8\u540c\u7684\u7b97\u6cd5\u5f97\u5230\u524d\u4e09\u4f4d\u6570\u5b57\uff0c\u7136\u540e\u62fc\u63a5\u624b\u673a\u53f7\u548c\u5e74\u6708\uff0c\u518d STARTROW\u00a0\u548c STOPROW\u00a0\u5c31\u53ef\u4ee5\u62ff\u5230\u8be5\u624b\u673a\u53f7\u8fd9\u4e2a\u6708\u7684\u6570\u636e\u4e86\uff0c\u6bd4\u5982\u62ff13412341234\u76842021-06\u6708\u4efd\u7684\u6570\u636e\uff0c\u5047\u8bbehash(13412341234_202106)%300=000\uff0c\u4e8e\u662f\uff1b Text Only<pre><code>scan 'call',{STARTROW =&gt; '000_13412341234_202106', STOPROW =&gt; '000_13412341234_202106|'}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/6-WAL/","title":"6-WAL","text":"<p> \u7ea6 1159 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 23 \u5206\u949f</p> <p>\u6570\u636e\u5e93\u5c06\u4fee\u6539\u8fc7\u540e\u7684\u6570\u636e\u5237\u5199\u5230\u78c1\u76d8\u662f\u968f\u673a\u5199\u64cd\u4f5c\uff0c\u5f88\u6162\uff0c\u5982\u679c\u6570\u636e\u5e93\u662f\u5728\u5185\u5b58\u5bf9\u6570\u636e\u4fee\u6539\u8fc7\u540e\u5c31\u76f4\u63a5\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\uff0c\u7136\u540e\u518d\u7b49\u5230\u5408\u9002\u7684\u65f6\u673a\u518d\u5237\u5199\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u5feb\u662f\u5feb\u4e86\uff0c\u4f46\u662f\u6ca1\u6709\u4fdd\u8bc1\u6301\u4e45\u6027\uff0c\u65e2\u7136\u4f60\u6570\u636e\u5e93\u8fd4\u56de\u6210\u529f\u4e86\uff0c\u90a3\u5c31\u5e94\u8be5\u8bf4\u5230\u505a\u5230\uff0c\u4e0d\u7136\u5c31\u522b\u8fd4\u56de\u4fee\u6539\u6210\u529f\u3002\u90a3\u5982\u679c\u7b49\u5230\u6bcf\u6b21\u5c06\u4fee\u6539\u8fc7\u540e\u7684\u6570\u636e\u843d\u76d8\u4e4b\u540e\u518d\u8fd4\u56de\u4fee\u6539\u6210\u529f\u5462\uff0c\u8fd9\u6837\u867d\u7136\u4fdd\u8bc1\u4e86\u6301\u4e45\u6027\uff0c\u4f46\u662f\u6b63\u5982\u524d\u9762\u6240\u8bf4\uff0c\u592a\u6162\u4e86\u3002\u4e3a\u4e86\u5230\u8fbe\u65e2\u80fd\u5feb\u901f\u7684\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\uff0c\u53c8\u80fd\u4fdd\u8bc1\u6301\u4e45\u6027\uff0cWAL\u5c31\u51fa\u73b0\u4e86\uff0c\u6301\u4e45\u6027\u662f\u80af\u5b9a\u8981\u4fdd\u8bc1\u7684\uff0c\u6240\u4ee5WAL\u89e3\u51b3\u7684\u5c31\u662f\u76f4\u63a5\u5c06\u6bcf\u6b21\u4fee\u6539\u8fc7\u540e\u7684\u6570\u636e\u5237\u5199\u5230\u78c1\u76d8\u7684\u7684\u65f6\u95f4\u4ee3\u4ef7\u592a\u5927\u7684\u95ee\u9898\u3002 WAL\uff08Write Ahead Log\uff0c\u9884\u5199\u65e5\u5fd7\uff09\uff0c\u5373\u5148\u5199\u65e5\u5fd7\uff0c\u518d\u5199\u78c1\u76d8\uff0c\u4e5f\u5c31\u662f\u5148\u628a\u4fee\u6539\u64cd\u4f5c\u8ffd\u52a0\u5199\u5230\u78c1\u76d8\u4e0a\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u987a\u5e8f\u5199\uff0c\u64cd\u4f5c\u6548\u7387\u9ad8\uff0c\u7136\u540e\u518d\u66f4\u65b0\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u7ed9\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\u3002 \u4e3a\u4ec0\u4e48WAL\u53ef\u4ee5\u505a\u5230\u5feb\u901f\u5b8c\u6210\u66f4\u65b0\uff0c\u53c8\u80fd\u4fdd\u8bc1\u6301\u4e45\u6027\u5462\uff1f 1.\u56e0\u4e3a\u4f7f\u7528WAL\u5e76\u4e0d\u9700\u8981\u771f\u6b63\u7b49\u5230\u5185\u5b58\u4e2d\u5df2\u4fee\u6539\u7684\u6570\u636e\u5237\u5199\u5230\u78c1\u76d8\u540e\u624d\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\uff0c\u800c\u662f\u53ea\u9700\u8981\u7b49\u5230\u66f4\u65b0\u64cd\u4f5c\u843d\u76d8\u548c\u5185\u5b58\u4e2d\u6570\u636e\u4fee\u6539\u5b8c\u6210\u5373\u53ef\u5411\u7528\u6237\u8fd4\u56de\u6210\u529f\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u6548\u7387\u90fd\u5f88\u9ad8\uff0c\u6240\u4ee5\u53ef\u4ee5\u505a\u5230\u5feb\u901f\u5b8c\u6210\u66f4\u65b0\u3002 2.\u5373\u4f7f\u6ca1\u6709\u5c06\u771f\u6b63\u4fee\u6539\u7684\u6570\u636e\u843d\u76d8\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u6301\u4e45\u6027\uff0c\u8fd9\u662f\u56e0\u4e3a\u66f4\u65b0\u64cd\u4f5c\u5df2\u7ecf\u843d\u76d8\u4e86\uff0c\u6240\u4ee5\u5373\u4f7f\u5185\u5b58\u5d29\u6e83\u4e86\u4e5f\u4e0d\u7528\u6015\uff0c\u56e0\u4e3a\u53ef\u4ee5\u901a\u8fc7\u539f\u59cb\u6570\u636e\u548c\u5df2\u7ecf\u843d\u76d8\u7684\u66f4\u65b0\u64cd\u4f5c\u91cd\u53d1\u5f97\u5230\u6700\u65b0\u7684\u6570\u636e\u3002 WAL\u7684\u4f18\u5316\u63aa\u65bd\uff1a 1.\u6bcf\u4e00\u6761\u65e5\u5fd7\u6570\u636e\u91cf\u5c0f\uff0c\u6240\u4ee5\u5bf9\u4e8e\u77ed\u65f6\u95f4\u5185\u7684\u5927\u91cf\u66f4\u65b0\u64cd\u4f5c\u53ef\u4ee5\u5148\u7f13\u5b58\u5230\u7f13\u51b2\u533a\uff0c\u7136\u540e\u518d\u6279\u91cf\u5199\u5165\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6548\u7387\u3002\u4f60\u53ef\u80fd\u4f1a\u8bf4\u4e0d\u662f\u6765\u4e00\u6761\u5199\u6761\uff0c\u800c\u662f\u7f13\u5b58\u5728\u5185\u5b58\uff0c\u8fd9\u6837\u5b89\u5168\u6027\u4e0d\u9ad8\uff0c\u6211\u89c9\u5f97\u5427\uff0c\u662f\u5b89\u5168\u6027\u4e0d\u9ad8\uff0c\u4f46\u662f\u5728\u65e5\u5fd7\u843d\u76d8\u4e4b\u524d\u4e5f\u5e76\u6ca1\u6709\u5411\u7528\u6237\u8fd4\u56de\u6210\u529f\uff0c\u5982\u679c\u5d29\u6e83\u4e86\uff0c\u90a3\u5c31\u662f\u4fee\u6539\u5931\u8d25\uff0c\u800c\u5bf9\u4e8e\u5df2\u7ecf\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\u7684\u64cd\u4f5c\uff0c\u4fee\u6539\u64cd\u4f5c\u5df2\u7ecf\u8bb0\u5f55\u5728\u65e5\u5fd7\u6587\u4ef6\u5e76\u843d\u76d8\u6210\u529f\u4e86\uff0c\u8fd9\u65f6\u5019\u5df2\u7ecf\u4e0d\u7528\u6015\u6570\u636e\u5e93\u5d29\u6e83\u4e86\uff0c\u56e0\u4e3a\u6b64\u65f6\u867d\u7136\u6570\u636e\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u4fee\u6539\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u65e5\u5fd7\u6587\u4ef6\u6062\u590d\uff0c\u6240\u4ee5\u6570\u636e\u5e76\u6ca1\u6709\u4e22\u5931\uff0c\u6ca1\u6709\u8fdd\u80cc\u6570\u636e\u5e93\u8bf4\u5230\u505a\u7684\u627f\u8bfa\u3002 2.\u5f53\u7136\u5bf9\u4e8e\u5e76\u975e\u6279\u91cf\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u6570\u636e\u5e93\u80af\u5b9a\u4e0d\u4f1a\u975e\u5f97\u7b49\u5230\u65e5\u5fd7\u7f13\u51b2\u533a\u6ee1\u4e86\u624d\u4f1a\u5c06\u65e5\u5fd7\u5199\u5230\u78c1\u76d8\uff0c\u6bd4\u5982\uff0c\u53ea\u6709\u4e00\u6761\u4fee\u6539\u64cd\u4f5c\uff0c\u80af\u5b9a\u4e5f\u662f\u4f1a\u8d76\u7d27\u5148\u5c06\u65e5\u5fd7\u5199\u5230\u78c1\u76d8\uff0c\u7136\u540e\u4fee\u6539\u5185\u5b58\uff0c\u6700\u540e\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\u7684\u6d88\u606f\u3002\u6211\u89c9\u5f97\u5427\uff0c\u8fd9\u4e2d\u95f4\u6709\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\uff0c\u5f88\u591a\u7cfb\u7edf\u90fd\u662f\u8fd9\u79cd\u8bbe\u8ba1\uff0c\u7f13\u51b2\u533a\u6ee1\u6216\u8005\u65f6\u95f4\u5230\u4e86\uff0c\u90fd\u4f1a\u89e6\u53d1\u5199\u64cd\u4f5c\uff0c\u6240\u4ee5\u5f53\u5982\u679c\u6709\u5f88\u591a\u5e76\u53d1\u4fee\u6539\u64cd\u4f5c\u65f6\uff0c\u5c31\u80af\u5b9a\u662f\u89e6\u53d1\u7f13\u51b2\u533a\u6ee1\u8fd9\u4e2a\u6761\u4ef6\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u6216\u8005\u51e0\u4e2a\u4fee\u6539\u64cd\u4f5c\uff0c\u90a3\u80af\u5b9a\u662f\u89e6\u53d1\u8d85\u65f6\u7684\u6761\u4ef6\uff0c\u8fd9\u6837\u624d\u80fd\u53ca\u65f6\u5411\u7528\u6237\u8fd4\u56de\u7ed3\u679c\u3002</p> <p>\u771f\u6b63\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u8fc7\u7a0b\uff1f \u9996\u5148\u4ecb\u7ecd\u4e00\u4e2a\u6982\u5ff5\uff0c\u810f\u9875\uff1a\u5185\u5b58\u4e2d\u88ab\u4fee\u6539\u4e86\uff0c\u4f46\u662f\u8fd8\u6ca1\u843d\u76d8\u7684\u6570\u636e\u9875\u3002\u7b49\u5230\u5408\u9002\u7684\u65f6\u673a\uff0c\u6570\u636e\u5e93\u4f1a\u5c06\u5185\u5b58\u4e2d\u7684\u810f\u9875\u5237\u5199\u5230\u78c1\u76d8\uff0c\u7136\u540e\u6e05\u9664\u65e5\u5fd7\u6587\u4ef6\uff0c\u6216\u8005\u5f53\u6570\u636e\u5e93\u5d29\u6e83\u518d\u6b21\u91cd\u542f\u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u8bfb\u53d6\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u6587\u4ef6\u548c\u65e5\u5fd7\u6587\u4ef6\uff0c\u7136\u540e\u5728\u5185\u5b58\u4e0a\u91cd\u653e\u65e5\u5fd7\u6587\u4ef6\u4e2d\u7684\u64cd\u4f5c\uff0c\u6700\u540e\u628a\u66f4\u65b0\u5b8c\u7684\u6570\u636e\u5237\u5199\u78c1\u76d8\u5e76\u6e05\u9664\u65e5\u5fd7\u6587\u4ef6\u3002</p> <p>MySQL\u5237\u5199\u810f\u9875\u7684\u65f6\u673a\uff1a 1.InnoDB \u7684 redo log \u5199\u6ee1\u4e86\uff0c\u8fd9\u65f6\u5019\u7cfb\u7edf\u4f1a\u505c\u6b62\u6240\u6709\u66f4\u65b0\u64cd\u4f5c 2.\u5f53\u9700\u8981\u65b0\u7684\u5185\u5b58\u9875\uff0c\u800c\u5185\u5b58\u4e0d\u591f\u7528\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4f7f\u7528\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7b56\u7565\u6dd8\u6c70\u4e00\u4e9b\u6570\u636e\u9875\uff0c\u5982\u679c\u6dd8\u6c70\u7684\u662f\u201c\u810f\u9875\u201d\uff0c\u5c31\u8981\u5148\u5c06\u810f\u9875\u5199\u5230\u78c1\u76d8\u3002 3.MySQL \u8ba4\u4e3a\u7cfb\u7edf\u201c\u7a7a\u95f2\u201d\u7684\u65f6\u5019 4.MySQL \u6b63\u5e38\u5173\u95ed\u7684\u60c5\u51b5</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/7-HBase%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B%20%E4%BB%A5%E5%8F%8A%20MemStore%E7%9A%84%E5%88%B7%E5%86%99%E6%97%B6%E6%9C%BA/","title":"7-HBase\u5199\u6570\u636e\u6d41\u7a0b \u4ee5\u53ca MemStore\u7684\u5237\u5199\u65f6\u673a","text":"<p> \u7ea6 547 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>HBase\u5199\u6570\u636e\u6d41\u7a0b\uff1a </p> <ol> <li>Client \u5148\u8bbf\u95ee zookeeper\uff0c\u83b7\u53d6 hbase:meta \u8868\u4f4d\u4e8e\u54ea\u4e2a HRegionServer\uff0c\u5e76\u5c06 meta \u8868\u7684\u4f4d\u7f6e\u4fe1\u606f\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u8bbf\u95ee\u5bf9\u5e94\u7684 HRegionServer\uff0c\u83b7\u53d6 hbase:meta \u8868\uff0c\u6839\u636e\u8bfb\u8bf7\u6c42\u7684 namespace:table/rowkey\uff0c\u67e5\u8be2\u51fa\u76ee\u6807\u6570\u636e\u4f4d\u4e8e\u54ea\u4e2a HRegionServer \u4e2d\u7684\u54ea\u4e2a HRegion \u4e2d\u3002\u5e76\u5c06\u8be5 table \u7684 region \u4fe1\u606f\uff08meta\u8868\u4e2d\u7684\u6570\u636e\uff09\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u5c06\u5199\u8bf7\u6c42\u53d1\u9001\u5230\u76ee\u6807 HRegionServer\u3002</li> <li>HRegionServer \u5c06\u5199\u8bf7\u6c42\u987a\u5e8f\u5199\u5165\uff08\u8ffd\u52a0\uff09\u5230 WAL\u4e2d\u3002</li> <li>HRegionServer \u6839\u636e\u5217\u65cf\u5c06\u6570\u636e\u5199\u5165\u5bf9\u5e94Store\u7684 MemStore\uff0c\u6570\u636e\u4f1a\u5728 MemStore \u8fdb\u884c\u6392\u5e8f\u3002</li> <li>\u5411\u5ba2\u6237\u7aef\u53d1\u9001 ack\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\u5df2\u7ecf\u5b8c\u6210\uff0c\u4f46\u4fee\u6539\u7684\u6570\u636e\u6ca1\u6709\u4fdd\u5b58\u5230HDFS\u4e2d\uff0c\u56e0\u4e3a\u8981\u7b49\u5230 MemStore \u7684\u5237\u5199\uff0c\u624d\u4f1a\u5c06\u6570\u636e\u5199\u5230 HFile\u3002</li> </ol> <p>MemStore\u7684\u5237\u5199\uff1a \u5207\u8bb0\uff0c\u4e00\u4e2aHRegionServer\u6709\u591a\u4e2aHRegion\uff0c\u4e00\u4e2aRegion\u6709\u591a\u4e2aStore\uff0c\u4e8e\u662f\u4e00\u4e2aHRegionServer\u6709\u591a\u4e2aMemStore\u3002\u6bcf\u4e2aMemStore\u4f1a\u7ecf\u5386\u591a\u6b21\u5237\u5199\uff0c\u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u5c06MemStore\u4e2d\u7684\u6570\u636e\u53ea\u4fdd\u7559\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS\u4e2a\u7248\u672c\uff0c\u7136\u540e\u5c06\u6570\u636e\u5199\u5230HDFS\u4e0a\u5373HFile\uff0c\u6700\u540e\u6e05\u7a7aMemStore\u3002  MemStore Flush \u7684\u65f6\u673a\uff1a</p> <ol> <li>\u5f53\u00a0HRegionServer \u4e2d MemStore \u7684\u603b\u5927\u5c0f\u8fbe\u5230 java_heapsize *\u00a0 hbase.regionserver.global.memstore.size.lower.limit\uff08\u4f4e\u6c34\u4f4d\uff0c\u9ed8\u8ba4\u503c 0.45\uff09\u65f6\uff0cHRegionServer\u5c06\u5bf9\u6240\u6709 MemStore \u7684\u6309\u7531\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u5237\u5199\u3002\u5982\u679cMemStore \u7684\u603b\u5927\u5c0f\u5927\u4e8e java_heapsize *\u00a0hbase.regionserver.global.memstore.size\uff08\u9ad8\u6c34\u4f4d\uff0c\u9ed8\u8ba4\u503c 0.95\uff09\uff0c\u90a3\u4e48HRegionServer\u5c06\u4f1a\u963b\u585e\u7528\u6237\u7684\u5199\u8bf7\u6c42\u5e76\u5237\u5199\uff0c\u76f4\u5230MemStore \u7684\u603b\u5927\u5c0f\u964d\u5230\u9ad8\u6c34\u4f4d\u4ee5\u4e0b\u3002</li> <li>\u5f53\u67d0\u4e2aMemStore\u7684\u5927\u5c0f\u8fbe\u5230\u4e86 hbase.hregion.memstore.flush.size\uff08\u9ed8\u8ba4\u503c 128M\uff09\uff0c\u90a3\u4e48\u5176\u6240\u5728HRegion\u7684\u6240\u6709MemStore\u90fd\u4f1a\u5237\u5199\u3002</li> <li>\u8ddd\u79bbMemStore\u5199\u5165\u7684\u6700\u540e\u4e00\u6761\u6570\u636e\u7684\u65f6\u95f4\u95f4\u9694\u5230\u8fbe\u8bbe\u7f6e\u7684\u81ea\u52a8\u5237\u5199\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u4e5f\u4f1a\u89e6\u53d1 memstore flush\u3002\u8bbe\u7f6e\u81ea\u52a8\u5237\u5199\u7684\u65f6\u95f4\u95f4\u9694\u7684\u53c2\u6570\u662f hbase.regionserver.optionalcacheflushinterval\uff08\u9ed8\u8ba4 1 \u5c0f\u65f6\uff09\u3002</li> <li>\u5f53 WAL \u6587\u4ef6\u7684\u6570\u91cf\u8d85\u8fc7 hbase.regionserver.max.logs\uff0c region \u4f1a\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u5237\u5199\uff0c\u76f4\u5230 WAL \u6587\u4ef6\u6570\u91cf\u51cf\u5c0f\u5230 hbase.regionserver.max.logs \u4ee5\u4e0b\uff08\u8be5\u5c5e\u6027\u73b0\u5df2\u4e0d\u80fd\u624b\u52a8\u8bbe\u7f6e\uff0c \u9ed8\u8ba4\u4e3a 32\uff09\u3002</li> </ol> <p>\u8fd8\u53ef\u4ee5\u624b\u52a8\u5237\u5199\uff0c\u547d\u4ee4\u662fflush\uff0c\u5982\u5237\u5199\u4e00\u5f20\u8868\u7684\u6240\u6709\u6570\u636e\uff1a Text Only<pre><code>flush 'studennt'\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/8-StoreFile%20Compaction%20%E5%92%8C%20Region%20Split/","title":"8-StoreFile Compaction \u548c Region Split","text":"<p> \u7ea6 853 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <p>StoreFile Compaction\uff1a \u5373HFile\u7684\u5408\u5e76\uff0c \u7531\u4e8ememstore\u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684HFile\uff0c\u4e8e\u662f\u903b\u8f91\u7ed3\u6784\u4e00\u4e2a\u5355\u5143\u683c\u7684\u4e0d\u540c\u7248\u672c\uff08timestamp\uff09\u548c\u4e0d\u540c\u7c7b\u578b\uff08Put/Delete\uff09\u7684\u8bb0\u5f55\u6709\u53ef\u80fd\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u7684 HFile \u4e2d\uff0c\u56e0\u6b64\u67e5\u8be2\u65f6\u9700\u8981\u904d\u5386\u6240\u6709\u7684 HFile\u3002 \u4e3a\u4e86\u51cf\u5c11 HFile \u7684\u4e2a\u6570\uff0c\u4ee5\u53ca\u6e05\u7406\u6389 \u8fc7\u671f(\u8d85\u8fc7\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS) \u548c \u5220\u9664(type=Delete) \u7684\u6570\u636e\uff0c\u4f1a\u8fdb\u884c StoreFile Compaction\u3002Compaction \u5206\u4e3a\u4e24\u79cd\uff0c\u5206\u522b\u662f Minor Compaction \u548c Major Compaction\u3002Minor Compaction\u53ea\u662f\u5355\u7eaf\u5730\u5c06\u4e34\u8fd1\u7684\u82e5\u5e72\u4e2a\u8f83\u5c0f\u7684 HFile \u5408\u5e76\u6210\u4e00\u4e2a\u8f83\u5927\u7684 HFile\uff0c\u4e0d\u4f1a\u6e05\u7406\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\u3002Major Compaction \u4f1a\u5c06\u4e00\u4e2a Store \u4e0b\u7684\u6240\u6709\u7684 HFile \u5408\u5e76\u6210\u4e00\u4e2a\u5927 HFile\uff0c\u5e76\u4e14\u4f1a\u6e05\u7406\u6389\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\u3002\u56e0\u4e3aHDFS\u4e0d\u652f\u6301\u968f\u673a\u5199\u64cd\u4f5c\uff0c\u6240\u4ee5\u5408\u5e76\u7684\u8fc7\u7a0b\u4e00\u5b9a\u662f\u5148\u628a\u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765\u4e4b\u540e\uff0c\u7136\u540e\u5408\u5e76\u518d\u4e0a\u4f20\u3002 </p> <p>\u624b\u52a8\u5408\u5e76\u7684\u547d\u4ee4\u662fcompact\u548cmajor_compact\uff0c\u5982\u5bf9\u4e00\u5f20\u8868\u7684\u6240\u6709HFile\u8fdb\u884cMinor Compaction\u5408\u5e76\uff1a Text Only<pre><code>compact 'student'\n</code></pre> \u8fd8\u53ef\u4ee5\u624b\u52a8\u5730\u6307\u5b9a\u5bf9\u4e00\u5f20\u8868\u7684\u67d0\u4e2aRegion\u8fdb\u884c\u5408\u5e76\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5bf9\u4e00\u5f20\u8868\u7684\u5217\u65cf\u7684\u8fdb\u884c\u5408\u5e76\uff0c\u8fd8\u53ef\u4ee5\u6307\u5b9a\u5bf9\u4e00\u5f20\u8868\u7684\u67d0\u4e2aRegion\u7684\u67d0\u4e2a\u5217\u65cf\u8fdb\u884c\u5408\u5e76\u3002</p> <p>\u81ea\u52a8\u5408\u5e76\u7684\u53c2\u6570\uff1a 1.hbase.hregion.majorcompaction\uff0c\u9ed8\u8ba4\u4e3a 604800000\uff0c\u53737\u5929\u8fdb\u884c\u4e00\u6b21major compact\u3002 2.hbase.hstore.compactionThreshold\uff0c\u9ed8\u8ba4\u4e3a3\uff0c\u610f\u601d\u662fHfile\u8d85\u8fc73\u4e2a\u5c31\u4f1a\u81ea\u52a8\u5408\u5e76\u62101\u4e2a\uff0c\u5982\u679c\u662f\u624b\u52a8\u89e6\u53d1\u5408\u5e76\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u5f97compact\u53d8\u6210major compact\u3002</p> <p>\u603b\u7ed3\uff1a\u4f55\u65f6\u4f1a\u6e05\u7406\u6389 \u8fc7\u671f(\u8d85\u8fc7\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS) \u548c \u5220\u9664(type=Delete) \u7684\u6570\u636e\uff1f 1.flush\u7684\u65f6\u5019 2.compact\u7684\u65f6\u5019 \u6d4b\u8bd5\uff1a \u5148\u591a\u6b21\u4fee\u6539\u540c\u4e00\u6761\u6570\u636e Text Only<pre><code>put 'stu','1001','info:name','zhangsan'\nput 'stu','1001','info:name','lisi'\n</code></pre> \u7136\u540escan\u53ef\u4ee5\u770b\u5230\u591a\u4e2a\u7248\u672c\u7684\u6570\u636e Text Only<pre><code>scan 'stu', {RAW =&gt; true, VERSIONS =&gt; 10}\n</code></pre> \u63a5\u7740flush\uff0cflush\u4f1a\u5148\u6e05\u7406\u6389MemStore\u4e2d \u8fc7\u671f(\u8d85\u8fc7\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS) \u548c \u5220\u9664(type=Delete) \u7684\u6570\u636e\uff0c\u7136\u540e\u5728\u5199\u5230HDFS\u4e0a Text Only<pre><code>flush 'stu'\n</code></pre> \u6700\u540escan\uff0c\u53ea\u53ef\u4ee5\u770b\u52301\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u5217\u65cf\u9ed8\u8ba4\u53ea\u4fdd\u7559\u4e00\u4e2a\u7248\u672c Text Only<pre><code>scan 'stu', {RAW =&gt; true, VERSIONS =&gt; 10}\n</code></pre> \u63a5\u7740\u518d\u4fee\u6539\u4e00\u6b21 Text Only<pre><code>put 'stu','1001','info:name','wangwu'\n</code></pre> \u7136\u540eflush Text Only<pre><code>flush 'stu'\n</code></pre> \u518dscan\uff0c\u4f1a\u770b\u52302\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u6bcf\u6b21flush\u90fd\u4f1a\u751f\u6210\u4e00\u4e2aHFile\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u6570\u636e\u7684\u4e24\u4e2a\u7248\u672c\u5728\u4e0d\u540c\u7684HFile\u4e2d Text Only<pre><code>scan 'stu', {RAW =&gt; true, VERSIONS =&gt; 10}\n</code></pre> \u8fd9\u65f6\u53ea\u6709major_compact\u624d\u80fd\u6e05\u9664\uff0c\u4f46\u662f\u56e0\u4e3a\u8fd9\u65f6\u53ea\u67092\u4e2aHFile\uff0c\u6240\u4ee5\u4f7f\u7528compact\u5e76\u4e0d\u4f1a\u89e6\u53d1HFile\u7684\u5408\u5e76\uff0c\u53ea\u6709\u5927\u4e8e\u7b49\u4e8e3\u4e2a\u65f6\uff0c\u4f7f\u7528compact\u624d\u80fd\u89e6\u53d1HFile\u7684\u5408\u5e76\uff0c\u5e76\u4e14Minor Compaction\u5e76\u4e0d\u4f1a\u5220\u9664\u6570\u636e\uff0c\u6240\u4ee5\u8fd9\u91cc\u5e94\u8be5\u4f7f\u7528major_compact Text Only<pre><code>major_compact 'stu'\n</code></pre> \u518dscan\uff0c\u53ea\u80fd\u770b\u52301\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u7a0d\u7b49\u4e24\u5206\u949f\u540e\uff0cHDFS\u4e0a\u7684HFile\u4e5f\u5c31\u53ea\u6709\u4e00\u4e2a\u4e86\u3002 \u540c\u6837\uff0c\u5982\u679c\u662ftype=Delete\u7684\u5220\u9664\u6570\u636e\uff0cflush\u4e4b\u540e\u4f1a \u5220\u9664\u6570\u636e \u4f1a\u4fdd\u5b58\u5728HFile\u4e2d\uff0c\u4f46\u5728major_compact\u4e4b\u540e\u5c31\u6ca1\u6709\u8fd9\u6761 \u5220\u9664\u6570\u636e \u7684\u8bb0\u5f55\u4e86</p> <p>Region Split\uff1a \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a Table \u8d77\u521d\u53ea\u6709\u4e00\u4e2a Region\uff0c\u968f\u7740\u6570\u636e\u7684\u4e0d\u65ad\u5199\u5165\uff0cRegion \u4f1a\u81ea\u52a8\u8fdb\u884c\u62c6\u5206\u3002\u521a\u62c6\u5206\u65f6\uff0c\u4e24\u4e2a\u5b50 HRegion \u90fd\u4f4d\u4e8e\u5f53\u524d\u7684HRegionServer\uff0c\u4f46\u5904\u4e8e\u8d1f\u8f7d\u5747\u8861\u7684\u8003\u8651\uff0cHMaster \u6709\u53ef\u80fd\u4f1a\u5c06\u67d0\u4e2a HRegion \u8f6c\u79fb\u7ed9\u5176\u4ed6\u7684 HRegionServer\u3002 Region Split \u65f6\u673a\uff1a\u9ed8\u8ba4\u6240\u6709\u8868\u7684\u67d0\u4e00\u4e2aRegion\u8d85\u8fc710G\uff08 hbase.hregion.max.filesize\uff09\u5c31\u4f1a\u5207\u5206\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/HBase/9-HBase%E8%AF%BB%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B/","title":"9-HBase\u8bfb\u6570\u636e\u6d41\u7a0b","text":"<p> \u7ea6 191 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>HBase\u8bfb\u6570\u636e\u6d41\u7a0b\uff1a </p> <ol> <li>Client \u5148\u8bbf\u95ee zookeeper\uff0c\u83b7\u53d6 hbase:meta \u8868\u4f4d\u4e8e\u54ea\u4e2a HRegionServer\uff0c\u5e76\u5c06 meta \u8868\u7684\u4f4d\u7f6e\u4fe1\u606f\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u8bbf\u95ee\u5bf9\u5e94\u7684 HRegionServer\uff0c\u83b7\u53d6 hbase:meta \u8868\uff0c\u6839\u636e\u8bfb\u8bf7\u6c42\u7684 namespace:table/rowkey\uff0c\u67e5\u8be2\u51fa\u76ee\u6807\u6570\u636e\u4f4d\u4e8e\u54ea\u4e2a HRegionServer \u4e2d\u7684\u54ea\u4e2a HRegion \u4e2d\u3002\u5e76\u5c06\u8be5 table \u7684 region \u4fe1\u606f\uff08meta\u8868\u4e2d\u7684\u6570\u636e\uff09\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u5c06\u8bfb\u6570\u636e\u8bf7\u6c42\u53d1\u9001\u5230\u76ee\u6807 HRegionServer\u3002</li> <li>HRegionServer \u5148\u4ece MemStore \u627e\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u518d\u5230 BlockCache \u91cc\u9762\u8bfb\uff0cBlockCache \u8fd8\u6ca1\u6709\uff0c\u518d\u5230 StoreFile \u4e0a\u8bfb\u3002\u5982\u679c\u662f\u4ece StoreFile \u91cc\u9762\u8bfb\u53d6\u7684\u6570\u636e\uff0c\u5219\u5c06\u67e5\u8be2\u5230\u7684\u6570\u636e\u7f13\u5b58\u5230 Block Cache\uff08Block\uff0cHFile \u7684\u5b58\u50a8\u5355\u5143\uff0c\u9ed8\u8ba4\u5927\u5c0f\u4e3a 64KB\uff09\u3002</li> <li>\u5c06\u67e5\u8be2\u5230\u7684\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ol>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/1-Hadoop%E7%9A%84%E7%90%86%E8%A7%A3/","title":"1-Hadoop\u7684\u7406\u89e3","text":"<p> \u7ea6 359 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>Hadoop2.x \u548c Hadoop3.x \u7684\u7ec4\u6210\uff1a  HDFS ( Hadoop Distributed File System ) \u662f\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u8d1f\u8d23\u7ec4\u7ec7\u7ba1\u7406\u6587\u4ef6 YARN ( Yet Another Resource Negotiator ) \u662f Hadoop \u7684\u8d44\u6e90\u534f\u8c03\u8005\uff0c\u8d1f\u8d23\u8c03\u5ea6MapReduce\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u8fbe\u5230\u5408\u7406\u5730\u7ba1\u7406\u7cfb\u7edf\u8ba1\u7b97\u8d44\u6e90\u7684\u76ee\u7684\u3002</p> <p>HDFS\u548cYARN\u90fd\u662f\u4ee5\u8fdb\u7a0b\u7684\u5f62\u5f0f\u5b58\u5728\u6765\u7ba1\u7406\u6587\u4ef6\u548c\u7cfb\u7edf\u8d44\u6e90\uff0c\u5c31\u50cfRedis\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u4e00\u6837\uff0c\u6211\u4eec\u9700\u8981\u4ee5\u5ba2\u6237\u7aef\u7684\u5f62\u5f0f\u4e0e\u8fd9\u79cd\u8f6f\u4ef6\u8fdb\u884c\u4ea4\u4e92\uff0c\u800cMapReduce\u548cCommon\u90fd\u662fjar\u5305\uff0c\u662f\u7a0b\u5e8f\u6240\u4f9d\u8d56\u7684\uff0c\u5b83\u4eec\u662f\u9759\u6001\u7684\uff0c\u9700\u8981\u4e0e\u7528\u6237\u7a0b\u5e8f\u7ed3\u5408\u5728\u4e00\u8d77\u7ec4\u6210\u5b8c\u6574\u7684\u7a0b\u5e8f\u624d\u80fd\u4ee5\u8fdb\u7a0b\u7684\u5f62\u5f0f\u8fd0\u884c\u8d77\u6765\u3002</p> <p>\u6846\u67b6\u4e0e\u4e2d\u95f4\u4ef6\u7684\u533a\u522b\u6216\u8bb8\u5c31\u662f\uff1a\u6846\u67b6\u4e0d\u662f\u53ef\u76f4\u63a5\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u5b83\u662f\u4ee5\u7a0b\u5e8f\u4f9d\u8d56\u7684\u5f62\u5f0f\u7684\u5b58\u5728\uff0c\u9700\u8981\u4e0e\u4e1a\u52a1\u4ee3\u7801\u7ed3\u5408\u624d\u80fd\u5f62\u6210\u5b8c\u6574\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u6846\u67b6\u89e3\u51b3\u7684\u91cd\u590d\u7f16\u7801\u7684\u95ee\u9898\uff0c\u6216\u8005\u8bf4\u662f\u5bf9\u95ee\u9898\u89e3\u51b3\u65b9\u6cd5\u7684\u516c\u5171\u90e8\u5206\u7684\u62bd\u53d6\u3002\u800c\u4e2d\u95f4\u4ef6\u662f\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u9700\u8981\u7528\u5ba2\u6237\u7aef\u4e0e\u4e4b\u4ea4\u4e92\u3002\u603b\u7ed3\u4e3a\u4e00\u53e5\u8bdd\u5c31\u662f\uff0c \u6846\u67b6\u662f\u4e00\u4e2a\u534a\u6210\u54c1\u8f6f\u4ef6\uff0c\u800c\u4e2d\u95f4\u4ef6\u662f\u4e00\u4e2a\u6210\u54c1\u8f6f\u4ef6\uff0c\u6240\u4ee5\u6846\u67b6\u7684\u4f7f\u7528\u65b9\u5f0f\u662f\u5bfcjar\u5305\uff0c\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528\u65b9\u5f0f\u662f\u542f\u52a8\u8f6f\u4ef6\uff0c\u7136\u540e\u4e0e\u5b83\u4ea4\u4e92\uff0c\u4f7f\u7528\u5b83\u63d0\u4f9b\u7684\u670d\u52a1\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/10-MapReduce%E4%B9%8BCombiner%E5%90%88%E5%B9%B6/","title":"10-MapReduce\u4e4bCombiner\u5408\u5e76","text":"<p> \u7ea6 293 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>Combiner\u672c\u8d28\u4e0a\u5176\u5b9e\u5c31\u662f\u5728MapTask\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u4e00\u4e2aReduce\u4efb\u52a1\uff0c\u76ee\u7684\u662f\u5bf9MapTask\u4efb\u52a1\u7684\u8f93\u51fa\u8fdb\u884c\u5c40\u90e8\u6c47\u603b\uff0c\u51cf\u5c11\u7f51\u7edc\u4f20\u8f93\u3002\uff08Combiner\u8fd0\u884c\u5728Shuffle\u9636\u6bb5\uff0c\u8fd0\u884c\u7684\u65f6\u673a\u662f\u5728\u6bcf\u6b21\u6392\u5e8f\u751f\u6210\u6587\u4ef6\u65f6\uff0c\u5305\u62ec\u6ea2\u5199\u65f6\u7684\u6392\u5e8f\u548c\u5f52\u5e76\u4e3a\u4e00\u4e2a\u6587\u4ef6\u65f6\u6392\u5e8f\uff09 \u5f15\u7528Combiner\u7684\u524d\u63d0\u662f\u4e0d\u80fd\u5f71\u54cd\u6700\u7ec8\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u6bd4\u5982\u6c42\u5e73\u5747\u503c\uff0c\u5148\u5728Combiner\u4e0a\u5e73\u5747\u4e00\u6b21\uff0c\u7136\u540e\u518d\u5728Reducer\u4e0a\u5e73\u5747\u4e00\u6b21\uff0c\u4e0e\u53ea\u5728Reducer\u4e0a\u8fdb\u884c\u4e00\u6b21\u5e73\u5747\uff0c\u4e24\u79cd\u60c5\u51b5\u7684\u7ed3\u679c\u662f\u4e0d\u540c\u7684\u3002\u518d\u6bd4\u5982\u5982\u679c\u662f\u6c42\u548c\u7684\u4e1a\u52a1\uff0c\u90a3\u4e48Combiner\u5c31\u6ca1\u6709\u5f71\u54cd\u3002  \u81ea\u5b9a\u4e49 Combiner \u7684\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u81ea\u5b9a\u4e49\u4e00\u4e2a Combiner \u7ee7\u627f Reducer\uff0c\u91cd\u5199 Reduce \u65b9\u6cd5</p> </li> <li> <p>\u5728\u9a71\u52a8\u7c7b\u4e2d\u8bbe\u7f6e\uff1a job.setCombinerClass(WordCountCombiner.class);</p> </li> </ol> <p>\u901a\u5e38\u6765\u8bf4Combiner\u7684\u4e1a\u52a1\u903b\u8f91\u5176\u5b9e\u548cReducer\u7684\u4e1a\u52a1\u903b\u8f91\u4e00\u81f4\uff0c\u6240\u4ee5\u4e00\u822c\u76f4\u63a5 job.setCombinerClass(WordCountReducer.class);</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u8bbe\u7f6e\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\u4e3a0\uff0c\u5373job.setNumReduceTasks(0); \u90a3\u4e48\u5c06\u53ea\u4f1a\u6709Map\u9636\u6bb5\uff0c\u6ca1\u6709Reduce\u9636\u6bb5\uff0cShuffle\u9636\u6bb5\u4e5f\u4f1a\u8ddf\u7740\u5c31\u6ca1\u6709\u4e86\uff0cShuffle\u9636\u6bb5\u6ca1\u6709\u4e86\u90a3\u4e48 Combiner \u4e5f\u5c31\u4e0d\u4f1a\u6709\u4e86\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/11-MapReduce%E4%B9%8BOutputFormat/","title":"11-MapReduce\u4e4bOutputFormat","text":"<p> \u7ea6 639 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>OutputFormat\u662fMapReduce\u8f93\u51fa\u7684\u57fa\u7c7b\uff0c\u5176\u6709\u4f17\u591a\u5b50\u7c7b\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u662fTextOutputFormat\uff0c\u7528 \\t \u4f5c\u4e3a\u5206\u9694\u7b26\u6309\u884c\u5c06key-value\u5199\u5230\u6587\u4ef6\u4e2d\u3002 </p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49OutputFormat\u4ee5\u6ee1\u8db3\u6211\u4eec\u8f93\u51fa\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u8f93\u51fa\u6570\u636e\u5230MySQL\u3001HBase\u3001Elasticsearch\u4e2d\u3002 \u81ea\u5b9a\u4e49OutputFormat\u6b65\u9aa4\uff1a</p> <ol> <li>\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627fFileOutputFormat\uff0c\u91cd\u5199getRecordWriter()\u65b9\u6cd5</li> <li>\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627fRecordWriter\uff0c\u91cd\u5199write()\u65b9\u6cd5\u548cclose()\u65b9\u6cd5</li> <li>Driver\u9700\u8981\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684Outputformat\u7c7b\uff0c\u548c_SUCCESS\u6587\u4ef6\u7684\u8f93\u51fa\u76ee\u5f55</li> </ol> <p>\u6848\u4f8b\uff1a \u8fc7\u6ee4\u8f93\u5165\u7684 log \u65e5\u5fd7\uff0c\u5305\u542b atguigu \u7684\u7f51\u7ad9\u8f93\u51fa\u5230atguigu.log\uff0c\u4e0d\u5305\u542b atguigu \u7684\u7f51\u7ad9\u8f93\u51fa\u5230other.log\u3002 </p> <p>Map\u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u76f4\u63a5\u5c06\u8f93\u5165\u7684value\u4f5c\u4e3akey\u8f93\u51fa\uff0c\u8f93\u51fa\u7684value\u76f4\u63a5\u4f7f\u7528NullWritable Text Only<pre><code>public class LogMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0d\u505a\u4efb\u4f55\u5904\u7406\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(value, NullWritable.get());\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Reduce\u4e5f\u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u76f4\u63a5\u5c06\u8f93\u5165\u4f5c\u4e3a\u8f93\u51fa\uff0c\u4e0d\u8fc7\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u5177\u6709\u76f8\u540ckey\u7684\u8bb0\u5f55\u4f1a\u4f5c\u4e3a\u4e00\u7ec4\u8fdb\u5165reduce()\u65b9\u6cd5\uff0c\u6240\u4ee5\u9700\u8981\u7528while\u5faa\u73af\u5199\u51fa Text Only<pre><code>public class LogReducer extends Reducer&lt;Text, NullWritable, Text, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(Text key, Iterable&lt;NullWritable&gt; values, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u9632\u6b62\u6709\u76f8\u540c\u6570\u636e\uff0c\u4e22\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (NullWritable value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(key, NullWritable.get());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627fFileOutputFormat\uff0c\u91cd\u5199getRecordWriter()\u65b9\u6cd5 Text Only<pre><code>public class LogOutputFormat extends FileOutputFormat&lt;`Text, NullWritable`&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public RecordWriter&lt;Text, NullWritable&gt; getRecordWriter(TaskAttemptContext job) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new LogRecordWriter(job);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627fRecordWriter\uff0c\u91cd\u5199write()\u65b9\u6cd5\u548cclose()\u65b9\u6cd5 Text Only<pre><code>public class LogRecordWriter extends RecordWriter&lt;Text, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0private FSDataOutputStream atguiguOut;\n\u00a0\u00a0\u00a0\u00a0private FSDataOutputStream otherOut;\n\n\u00a0\u00a0\u00a0\u00a0public LogRecordWriter(TaskAttemptContext job) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileSystem fs = FileSystem.get(job.getConfiguration());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0atguiguOut = fs.create(new Path(\"D:\\\\hadoop\\\\atguigu.log\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0otherOut = fs.create(new Path(\"D:\\\\hadoop\\\\other.log\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void write(Text key, NullWritable value) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String log = key.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5177\u4f53\u5199\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (log.contains(\"atguigu\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0atguiguOut.writeBytes(log + \"\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0otherOut.writeBytes(log + \"\\n\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close(TaskAttemptContext context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5173\u6d41\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IOUtils.closeStream(atguiguOut);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IOUtils.closeStream(otherOut);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Driver\u9700\u8981\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684Outputformat\u7c7b\uff0c\u548c_SUCCESS\u6587\u4ef6\u7684\u8f93\u51fa\u76ee\u5f55 Text Only<pre><code>public class LogDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(LogDriver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(LogMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(LogReducer.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(NullWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(NullWritable.class);\n\n\u00a0 `//\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684outputformat`\n `job.setOutputFormatClass(LogOutputFormat.class);`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(\"D:\\\\input\\\\inputoutputformat\"));\n `//\u800c FileOutputFormat \u8981\u8f93\u51fa\u4e00\u4e2a _SUCCESS \u6587\u4ef6\uff0c\u6b64\u5904\u5b9a\u4e49\u7684\u662f _SUCCESS \u7684\u8f93\u51fa\u76ee\u5f55`\n `FileOutputFormat.setOutputPath(job, new Path(\"D:\\\\hadoop\\\\output1111\"));`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean b = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(b ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u7efc\u5408 InputFormat\u3001 Map\u3001Reduce\u3001 OutputFormat \u4ee5\u53ca Context \u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u5927\u81f4\u662f\u8fd9\u6837\u7684\uff1a </p> <p>\u7531Context\u4e0a\u4e0b\u6587\u4e32\u8054\u8d77\u6574\u4e2a\u6d41\u7a0b\u3002 InputFormat\u548cOutputFormat\u5f53\u7136\u4e0d\u662f\u53ea\u5728\u6700\u5f00\u8bfb\u6587\u4ef6\u548c\u6700\u672b\u5c3e\u5199\u6587\u4ef6\u7684\u7528\u5230\uff0c\u5b83\u4fe9\u5728MapReduce\u6574\u4e2a\u6d41\u7a0b\u4e2d\u53ea\u8981\u662f\u6d89\u53ca\u8bfb\u5199\u5730\u65b9\u90fd\u6709\u7528\u5230\uff0c\u6bd4\u5982Shuffle\u9636\u6bb5\u4ece\u7f13\u51b2\u533a\u5411\u6587\u4ef6\u4e2d\u5199\uff0c\u5408\u5e76\u6587\u4ef6\u65f6\u9700\u8981\u5148\u5c06\u6587\u4ef6\u8bfb\u5230\u5185\u5b58\u4e2d\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/12-MapReduce%20%E6%BA%90%E7%A0%81%E4%B9%8B%20MapTask%20%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6/","title":"12-MapReduce \u6e90\u7801\u4e4b MapTask \u5de5\u4f5c\u673a\u5236","text":"<p> \u7ea6 762 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>  \uff081\uff09Read\u9636\u6bb5\uff1aMapTask\u901a\u8fc7InputFormat\u83b7\u5f97\u7684RecordReader\uff0c\u4ece\u8f93\u5165InputSplit\u4e2d\u89e3\u6790\u51fa\u4e00\u4e2a\u4e2akey/value\u3002 \uff082\uff09Map\u9636\u6bb5\uff1a\u8be5\u8282\u70b9\u4e3b\u8981\u662f\u5c06\u89e3\u6790\u51fa\u7684key/value\u4ea4\u7ed9\u7528\u6237\u7f16\u5199map()\u51fd\u6570\u5904\u7406\uff0c\u5e76\u4ea7\u751f\u4e00\u7cfb\u5217\u65b0\u7684key/value\u3002 \uff083\uff09Collect\u6536\u96c6\u9636\u6bb5\uff1a\u5728\u7528\u6237\u7f16\u5199map()\u51fd\u6570\u4e2d\uff0c\u5f53\u6570\u636e\u5904\u7406\u5b8c\u6210\u540e\uff0c\u4e00\u822c\u4f1a\u8c03\u7528OutputCollector.collect()\u8f93\u51fa\u7ed3\u679c\u3002\u5728\u8be5\u51fd\u6570\u5185\u90e8\uff0c\u5b83\u4f1a\u5c06\u751f\u6210\u7684key/value\u5206\u533a\uff08\u8c03\u7528Partitioner\uff09\uff0c\u5e76\u5199\u5165\u4e00\u4e2a\u73af\u5f62\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\u3002 \uff084\uff09Spill\u9636\u6bb5\uff1a\u5373\u201c\u6ea2\u5199\u201d\uff0c\u5f53\u73af\u5f62\u7f13\u51b2\u533a\u6ee1\u540e\uff08\u5f53\u8f93\u5165\u6570\u636e\u91cf\u672c\u8eab\u5c31\u6bd4\u8f83\u5c0f\uff0cCollect\u9636\u6bb5\u7ed3\u675f\u540e\u73af\u5f62\u7f13\u51b2\u533a\u6ca1\u6ee1\u4e5f\u4f1a\u6ea2\u5199\uff09\uff0cMapReduce\u4f1a\u5c06\u6570\u636e\u5199\u5230\u672c\u5730\u78c1\u76d8\u4e0a\uff0c\u751f\u6210\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c06\u6570\u636e\u5199\u5165\u672c\u5730\u78c1\u76d8\u4e4b\u524d\uff0c\u5148\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u672c\u5730\u6392\u5e8f\uff0c\u5982\u679c\u6709\u8bbe\u7f6e\u5408\u5e76\u64cd\u4f5c\uff0c\u8fd8\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u5408\u5e76\u3002 \u00a0\u00a0\u00a0\u00a0\u6ea2\u5199\u9636\u6bb5\u8be6\u60c5\uff1a \u00a0\u00a0\u00a0\u00a0\u6b65\u9aa41\uff1a\u5229\u7528\u5feb\u901f\u6392\u5e8f\u7b97\u6cd5\u5bf9\u7f13\u5b58\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u6392\u5e8f\u65b9\u5f0f\u662f\uff0c\u5148\u6309\u7167\u5206\u533a\u7f16\u53f7Partition\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u6309\u7167key\u8fdb\u884c\u6392\u5e8f\u3002\u8fd9\u6837\uff0c\u7ecf\u8fc7\u6392\u5e8f\u540e\uff0c\u6570\u636e\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u805a\u96c6\u5728\u4e00\u8d77\uff0c\u4e14\u540c\u4e00\u5206\u533a\u5185\u6240\u6709\u6570\u636e\u6309\u7167key\u6709\u5e8f\u3002 \u00a0\u00a0\u00a0\u00a0\u6b65\u9aa42\uff1a\u6309\u7167\u5206\u533a\u7f16\u53f7\u7531\u5c0f\u5230\u5927\u4f9d\u6b21\u5c06\u6bcf\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u5199\u5165\u4efb\u52a1\u5de5\u4f5c\u76ee\u5f55\u4e0b\u7684\u4e34\u65f6\u6587\u4ef6output/spillN.out\uff08N\u8868\u793a\u5f53\u524d\u6ea2\u5199\u6b21\u6570\uff09\u4e2d\u3002\u5982\u679c\u7528\u6237\u8bbe\u7f6e\u4e86Combiner\uff0c\u5219\u5199\u5165\u6587\u4ef6\u4e4b\u524d\uff0c\u5bf9\u6bcf\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u805a\u96c6\u64cd\u4f5c\u3002 \u00a0\u00a0\u00a0\u00a0\u6b65\u9aa43\uff1a\u5c06\u5206\u533a\u6570\u636e\u7684\u5143\u4fe1\u606f\u5199\u5230\u5185\u5b58\u7d22\u5f15\u6570\u636e\u7ed3\u6784SpillRecord\u4e2d\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5206\u533a\u7684\u5143\u4fe1\u606f\u5305\u62ec\u5728\u4e34\u65f6\u6587\u4ef6\u4e2d\u7684\u504f\u79fb\u91cf\u3001\u538b\u7f29\u524d\u6570\u636e\u5927\u5c0f\u548c\u538b\u7f29\u540e\u6570\u636e\u5927\u5c0f\u3002\u5982\u679c\u5f53\u524d\u5185\u5b58\u7d22\u5f15\u5927\u5c0f\u8d85\u8fc71MB\uff0c\u5219\u5c06\u5185\u5b58\u7d22\u5f15\u5199\u5230\u6587\u4ef6output/spillN.out.index\u4e2d\u3002 \uff085\uff09Merge\u9636\u6bb5\uff1a\u5f53\u6240\u6709\u6570\u636e\u5904\u7406\u5b8c\u6210\u540e\uff0cMapTask\u5bf9\u6240\u6709\u4e34\u65f6\u6587\u4ef6\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f\u548c\u5408\u5e76\uff0c\u4ee5\u786e\u4fdd\u6700\u7ec8\u53ea\u4f1a\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u3002 \u5f53\u6240\u6709\u6570\u636e\u5904\u7406\u5b8c\u540e\uff0cMapTask\u4f1a\u5c06\u6240\u6709\u4e34\u65f6\u6587\u4ef6\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u6587\u4ef6\uff0c\u5e76\u4fdd\u5b58\u5230\u6587\u4ef6output/file.out\u4e2d\uff0c\u540c\u65f6\u751f\u6210\u76f8\u5e94\u7684\u7d22\u5f15\u6587\u4ef6output/file.out.index\u3002 \u5728\u8fdb\u884c\u6587\u4ef6\u5408\u5e76\u8fc7\u7a0b\u4e2d\uff0cMapTask\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u8fdb\u884c\u5408\u5e76\u3002\u5bf9\u4e8e\u67d0\u4e2a\u5206\u533a\uff0c\u5b83\u5c06\u91c7\u7528\u591a\u8f6e\u9012\u5f52\u5408\u5e76\u7684\u65b9\u5f0f\u3002\u6bcf\u8f6e\u5408\u5e76mapreduce.task.io.sort.factor\uff08\u9ed8\u8ba410\uff09\u4e2a\u6587\u4ef6\uff0c\u5e76\u5c06\u4ea7\u751f\u7684\u6587\u4ef6\u91cd\u65b0\u52a0\u5165\u5f85\u5408\u5e76\u5217\u8868\u4e2d\uff0c\u5bf9\u6587\u4ef6\u6392\u5e8f\u540e\uff0c\u91cd\u590d\u4ee5\u4e0a\u8fc7\u7a0b\uff0c\u76f4\u5230\u6700\u7ec8\u5f97\u5230\u4e00\u4e2a\u5927\u6587\u4ef6\u3002 \u8ba9\u6bcf\u4e2aMapTask\u6700\u7ec8\u53ea\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u907f\u514d\u540c\u65f6\u6253\u5f00\u5927\u91cf\u6587\u4ef6\u548c\u540c\u65f6\u8bfb\u53d6\u5927\u91cf\u5c0f\u6587\u4ef6\u4ea7\u751f\u7684\u968f\u673a\u8bfb\u53d6\u5e26\u6765\u7684\u5f00\u9500\uff0c\u5e76\u4e14\u5728map\u7aef\u5bf9\u540c\u4e00\u5206\u533a\u6570\u636e\u6392\u5e8f\u540e\uff0c\u53ef\u4ee5\u51cf\u5c11reduce\u7aef\u6392\u5e8f\u7684\u5de5\u4f5c\u91cf\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/13-MapReduce%20%E6%BA%90%E7%A0%81%E4%B9%8B%20ReduceTask%20%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6/","title":"13-MapReduce \u6e90\u7801\u4e4b ReduceTask \u5de5\u4f5c\u673a\u5236","text":"<p> \u7ea6 174 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p> <p> </p> <p>\uff081\uff09 Copy\u9636\u6bb5\uff1aReduceTask\u4ece\u5404\u4e2aMapTask\u4e0a\u8fdc\u7a0b\u62f7\u8d1d\u5c5e\u4e8e\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u5982\u679c\u5176\u5927\u5c0f\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u5426\u5219\u76f4\u63a5\u653e\u5230\u5185\u5b58\u4e2d\u3002 \uff082\uff09Sort\u9636\u6bb5\uff1a\u5728\u8fdc\u7a0b\u62f7\u8d1d\u6570\u636e\u7684\u540c\u65f6\uff0cReduceTask\u542f\u52a8\u4e86\u4e24\u4e2a\u540e\u53f0\u7ebf\u7a0b\u5bf9\u5185\u5b58\u548c\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u4ee5\u9632\u6b62\u5185\u5b58\u4f7f\u7528\u8fc7\u591a\u6216\u78c1\u76d8\u4e0a\u6587\u4ef6\u8fc7\u591a\u3002\u7531\u4e8e\u5404\u4e2aMapTask\u5df2\u7ecf\u5b9e\u73b0\u5bf9\u81ea\u5df1\u7684\u5904\u7406\u7ed3\u679c\u8fdb\u884c\u4e86\u5c40\u90e8\u6392\u5e8f\uff0c\u56e0\u6b64\uff0cReduceTask\u53ea\u9700\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f\u5373\u53ef\u3002 \uff083\uff09Reduce\u9636\u6bb5\uff1areduce()\u51fd\u6570\u5c06\u8ba1\u7b97\u7ed3\u679c\u5199\u5230HDFS\u4e0a\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/14-MapReduce%20%E4%B9%8B%20Reduce%20Join/","title":"14-MapReduce \u4e4b Reduce Join","text":"<p> \u7ea6 1372 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 27 \u5206\u949f</p> <p>\u6848\u4f8b\uff1a\u5b9e\u73b0SQL\u4e2d\u7684join\u6548\u679c \u8f93\u5165\u6570\u636e\uff1a  \u8f93\u51fa\u6570\u636e\uff1a </p> <p>\u5206\u6790\uff1a\u8f93\u5165\u6587\u4ef6\u4e24\u4e2a\uff0c\u5177\u6709\u4e0d\u540c\u7684\u683c\u5f0f\uff0c\u90a3\u662f\u4e0d\u662f\u9700\u8981\u5199\u4e24\u4e2amap\u65b9\u6cd5\u6765\u5904\u7406\u5462\uff0c\u5904\u7406\u5b8c\u6210\u4e4b\u540e\u518d\u628a\u7ed3\u679c\u90fd\u53d1\u9001\u5230\u540c\u4e00\u4e2areduce\u65b9\u6cd5\u5904\u7406\uff1f\u663e\u7136\u8fd9\u662f\u884c\u4e0d\u901a\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2aMapReduce\u53ea\u80fd\u6709\u4e00\u4e2amap\u65b9\u6cd5\u548c\u4e00\u4e2areduce\u65b9\u6cd5\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e2amap\u65b9\u6cd5\u548creduce\u65b9\u6cd5\u5728\u4e0d\u540c\u7684\u4e3b\u673a\u4e0a\u521b\u5efaMapTask\u548cReduceTask\uff0c\u8fd9\u4e9bMapTask\u662f\u90fd\u662f\u6839\u636e\u540c\u4e00\u4e2amap\u65b9\u6cd5\u521b\u5efa\u7684\uff0c\u53ea\u662f\u5206\u5e03\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u6267\u884c\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u540c\u800c\u5df2\uff0cReduceTask\u4e5f\u662f\u4e00\u6837\uff0c\u53ea\u63a5\u53d7\u4e0e\u5b83\u914d\u5957\u7684\u90a3\u4e00\u4e2amap\u7684\u8f93\u51fa\uff08\u5f53\u7136ReduceTask\u7684\u8f93\u5165\u662f\u7ecf\u8fc7Shuffle\u9636\u6bb5\u7684\u5206\u533a\u3001\u6392\u5e8f\u3001\u5408\u5e76\u7b49\u64cd\u4f5c\u5904\u7406\u7684\uff09\u3002\u603b\u7ed3\u4e00\u70b9\u5c31\u662f\uff0c\u4e0d\u80fd\u6709\u4e24\u4e2amap\u65b9\u6cd5\u4e00\u4e2areduce\u65b9\u6cd5\uff0c\u8fd9\u70b9\u4eceDriver\u7c7bjob.setMapperClass()\u548cjob.setReducerClass()\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u4f46\u662f\u53ef\u4ee5\u5c06MapReduce\u6d41\u7a0b\u4e32\u8054\u8d77\u6765\u5de5\u4f5c\uff0c\u6bd4\u5982\u524d\u9762\u5bf9\u624b\u673a\u53f7\u603b\u6d41\u91cf\u7684\u6392\u5e8f\u7684\u9700\u6c42\u5c31\u662f\u4e24\u4e2aMapReduce\uff0c\u524d\u4e00\u4e2aReduce\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2aMap\u7684\u8f93\u5165\u3002 </p> <p>\u4f46\u662f\u5c06\u4e24\u4e2aMapReduce\u4e32\u8054\u8d77\u6765\u7684\u89e3\u51b3\u65b9\u6848\u5e76\u4e0d\u80fd\u89e3\u51b3\u672c\u4f8b\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u8fd8\u662f\u5f97\u53ea\u7528\u4e00\u4e2aMapReduce\uff0c\u5177\u4f53\u89e3\u51b3\u65b9\u6848\u662f\uff1a\u5c06\u4e24\u79cd\u4e0d\u540c\u7684\u683c\u5f0f\u7684\u6570\u636e\u5c01\u88c5\u5230\u4e00\u4e2abean\u7c7b\uff0c\u7136\u540emap\u7684\u8f93\u51fa\u4ee5pid\u4f5c\u4e3akey\uff0cbean\u5bf9\u8c61\u4f5c\u4e3avalue\uff0c\u8fd9\u6837\u5230reduce\u65b9\u6cd5\u65f6\uff0c\u5904\u7406\u7684\u6570\u636e\u5c31\u662f\u5177\u6709\u76f8\u540cpid\u7684bean\u5bf9\u8c61\u3002\u65e2\u7136\u662f\u5728\u540c\u4e00\u4e2amap\u65b9\u6cd5\u4e2d\u5904\u7406\uff0c\u90a3\u5982\u4f55\u533a\u5206\u4e24\u79cd\u4e0d\u540c\u683c\u5f0f\u7684\u6570\u636e\u5462\uff1f\u65b9\u6cd5\u4e00\u662f\u5c06\u4e00\u884c\u6570\u636e\u5206\u5272\u540e\u5224\u65ad\u5b57\u7b26\u4e32\u7684\u4e2a\u6570\uff0c\u8fd9\u8981\u6c42\u4e24\u8868\u5217\u7684\u6570\u76ee\u4e0d\u4e00\u81f4\uff0c\u672c\u4f8b\u5c31\u662f\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff1b\u65b9\u6cd5\u4e8c\u662f\u4f7f\u7528TextInputFormat\uff0c\u56e0\u4e3aTextInputFormat\u7684\u5206\u7247\u662f\u5bf9\u5355\u4e2a\u6587\u4ef6\u8fdb\u884c\u7684\uff0c\u53c8\u6bcf\u4e2a\u5206\u7247\u90fd\u4f1a\u542f\u52a8\u4e00\u4e2aMapTask\u6765\u5904\u7406\uff0c\u6240\u4ee5\u4e00\u4e2aMapTask\u7684\u8f93\u5165\uff08\u4e5f\u5c31\u662f\u540c\u4e00\u4e2a\u5206\u7247\u7684\u5185\u5bb9\uff09\u4e00\u5b9a\u662f\u6765\u81ea\u540c\u4e00\u4e2a\u6587\u4ef6\u7684\uff0c\u8fd9\u6837\u5728\u53ea\u9700\u8981\u5728Mapper\u7684setUp()\u65b9\u6cd5\u91cc\u5411\u5224\u65ad\u4e00\u4e0b\u5206\u7247\u662f\u6765\u81ea\u54ea\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u5728map()\u65b9\u6cd5\u91cc\u505a\u6267\u884c\u5bf9\u5e94\u7684\u5c01\u88c5\u903b\u8f91\u5373\u53ef\uff0c\u4e0d\u50cfCombineFileInputFormat\u4f1a\u628a\u591a\u4e2a\u6587\u4ef6\u770b\u4f5c\u662f\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u5206\u7247\uff0c\u8fd9\u6837\u4e00\u4e2aMapTask\u7684\u8f93\u5165\uff08\u4e5f\u5c31\u662f\u540c\u4e00\u4e2a\u5206\u7247\u7684\u5185\u5bb9\uff09\u5c31\u53ef\u80fd\u662f\u6765\u81ea\u4e0d\u540c\u6587\u4ef6\uff0c\u5224\u65ad\u5206\u7247\u662f\u6765\u81ea\u54ea\u4e00\u4e2a\u6587\u4ef6\u7684\u65b9\u6cd5\u5c31\u4e0d\u594f\u6548\u4e86\u3002\u6240\u4ee5\u65b9\u6cd5\u4e00\u4e0d\u7ba1\u4f7f\u7528TextInputFormat\uff0c\u8fd8\u662f\u4f7f\u7528CombineFileInputFormat\u90fd\u884c\u3002</p> <p>\u65b9\u6cd5\u4e8c\u7684\u4ee3\u7801\u5982\u4e0b\uff1a \u81ea\u5b9a\u4e49bean\u7c7b\u5b9e\u73b0Writable\u63a5\u53e3\uff0c\u4e24\u79cd\u683c\u5f0f\u7684\u6570\u636e\u90fd\u5c01\u88c5\u5728\u8fd9\u4e2abean\u7c7b\u4e2d Text Only<pre><code>public class TableBean implements Writable {\n\n\u00a0\u00a0\u00a0\u00a0private String id; // \u8ba2\u5355id\n\u00a0\u00a0\u00a0\u00a0private String pid; // \u5546\u54c1id\n\u00a0\u00a0\u00a0\u00a0private int amount; // \u5546\u54c1\u6570\u91cf\n\u00a0\u00a0\u00a0\u00a0private String pname;// \u5546\u54c1\u540d\u79f0\n\u00a0\u00a0\u00a0\u00a0private String flag; // \u6807\u8bb0\u662f\u4ec0\u4e48\u8868 order pd\n\n\u00a0\u00a0\u00a0\u00a0// \u7a7a\u53c2\u6784\u9020\n\u00a0\u00a0\u00a0\u00a0public TableBean() {\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public String getId() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return id;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setId(String id) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.id = id;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public String getPid() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return pid;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setPid(String pid) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.pid = pid;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public int getAmount() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return amount;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setAmount(int amount) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.amount = amount;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public String getPname() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return pname;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setPname(String pname) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.pname = pname;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public String getFlag() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return flag;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setFlag(String flag) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.flag = flag;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void write(DataOutput out) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeUTF(id);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeUTF(pid);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeInt(amount);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeUTF(pname);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeUTF(flag);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void readFields(DataInput in) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.id = in.readUTF();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.pid = in.readUTF();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.amount = in.readInt();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.pname = in.readUTF();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.flag = in.readUTF();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String toString() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return\u00a0\u00a0id + \"\\t\" +\u00a0\u00a0pname + \"\\t\" + amount ;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>setup()\u65b9\u6cd5\u4e0d\u5728run()\u65b9\u6cd5\u7684while\u5faa\u73af\u4e2d\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff0c\u5e76\u4e14\u5728map\u65b9\u6cd5\u4e4b\u524d\u6267\u884c\uff0c\u6240\u4ee5\u5224\u65ad\u8f93\u5165\u5207\u7247\u6765\u81ea\u54ea\u4e00\u4e2a\u6587\u4ef6\u53ef\u4ee5\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u8fdb\u884c\uff0c\u7136\u540e\u5728map()\u65b9\u6cd5\u4e2d\u6839\u636e\u6570\u636e\u6765\u81ea\u7684\u6587\u4ef6\u7684\u4e0d\u540c\u505a\u4e0d\u540c\u7684\u5c01\u88c5\u3002 Text Only<pre><code>public class TableMapper extends Mapper&lt;LongWritable, Text, Text, TableBean&gt; {\n\u00a0\u00a0\u00a0\u00a0private String fileName;\n\u00a0\u00a0\u00a0\u00a0private Text outK\u00a0\u00a0= new Text();\n\u00a0\u00a0\u00a0\u00a0private TableBean outV = new TableBean();\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void setup(Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521d\u59cb\u5316\u00a0\u00a0order\u00a0\u00a0pd\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileSplit split = (FileSplit) context.getInputSplit();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fileName = split.getPath().getName();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = line.split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u5224\u65ad\u662f\u54ea\u4e2a\u6587\u4ef6\u7684\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (fileName.contains(\"order\")){// \u5904\u7406\u7684\u662f\u8ba2\u5355\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5k\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.set(split[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5v\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setId(split[0]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setPid(split[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setAmount(Integer.parseInt(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setPname(\"\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setFlag(\"order\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}else {// \u5904\u7406\u7684\u662f\u5546\u54c1\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5k\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.set(split[0]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5v\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setId(\"\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setPid(split[0]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setAmount(0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setPname(split[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setFlag(\"product\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(outK, outV);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u6bcf\u6b21\u8fdb\u5165\u5230reduce\u65b9\u6cd5\u65f6\u6240\u63a5\u6536\u5230\u6570\u636e\u662f\u5177\u6709\u76f8\u540cpid\u7684\u7684\u96c6\u5408\uff0c\u663e\u7136bean\u5bf9\u8c61\u4e2d\u53ea\u6709\u4e00\u6761\u6765\u81ea\u4ea7\u54c1\u8868\uff0c\u5176\u5b83\u591a\u4e2a\u6765\u81ea\u8ba2\u5355\u8868\u3002 Text Only<pre><code>public class TableReducer extends Reducer&lt;Text, TableBean, TableBean, NullWritable&gt; {\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(Text key, Iterable&lt;TableBean&gt; values, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u51c6\u5907\u521d\u59cb\u5316\u96c6\u5408\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ArrayList&lt;TableBean&gt; orderBeans = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableBean pdBean = new TableBean();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5faa\u73af\u904d\u5386\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (TableBean value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (\"order\".equals(value.getFlag())) {// \u8ba2\u5355\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TableBean tmp = new TableBean();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BeanUtils.copyProperties(tmp, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderBeans.add(tmp);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {// \u5546\u54c1\u8868\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BeanUtils.copyProperties(pdBean, value);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5faa\u73af\u904d\u5386orderBeans\uff0c\u8d4b\u503c pdname\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (TableBean orderBean : orderBeans) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderBean.setPname(pdBean.getPname());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(orderBean, NullWritable.get());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>Driver\u7c7b\u6ce8\u610f\u4e00\u70b9\uff0c\u8f93\u5165\u8def\u5f84\u662f\u4e00\u4e2a\u76ee\u5f55\uff0c\u91cc\u9762\u5305\u542border.txt\u548cproduct.txt Text Only<pre><code>public class TableDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(new Configuration());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(TableDriver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(TableMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(TableReducer.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(TableBean.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(TableBean.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(NullWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(classPath + \"/input/join\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output222\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean b = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(b ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4f18\u5316\u65b9\u6cd5\uff1aHash join\uff0c\u5373\u5bf9\u8fde\u63a5\u5b57\u6bb5\u4f7f\u7528hash\u5206\u533a\uff0c\u8fd9\u6837\u5177\u6709\u76f8\u540cpid\u7684\u6570\u636e\u5c31\u4f1a\u8fdb\u5230\u540c\u4e00\u4e2aReduce\u4e2d\uff0c\u4ece\u800c\u4e0d\u4f1a\u5f71\u54cd\u8fde\u63a5\u7ed3\u679c\u7684\u6b63\u786e\u6027\uff0c\u6b64\u65b9\u6cd5\u53ef\u4ee5\u907f\u514d\u53ea\u4f7f\u7528\u4e00\u4e2aReduce\u9020\u6210\u7684\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u540c\u65f6\u4e5f\u52a0\u5feb\u4e86\u8fd0\u7b97\u901f\u5ea6\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/15-MapReduce%20%E4%B9%8B%20Map%20Join/","title":"15-MapReduce \u4e4b Map Join","text":"<p> \u7ea6 626 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>\u5728Reduce Join\u4e2d\uff0c\u5408\u5e76\u7684\u64cd\u4f5c\u662f\u5728 Reduce \u9636\u6bb5\u5b8c\u6210\uff0c Reduce \u7aef\u7684\u5904\u7406\u538b\u529b\u592a\u5927\uff0c Map\u8282\u70b9\u7684\u8fd0\u7b97\u8d1f\u8f7d\u6bd4Reduce\u8282\u70b9\u7684\u8d1f\u8f7d\u8981\u4f4e\u5f97\u591a\uff0c\u6240\u4ee5Reduce \u9636\u6bb5\u6781\u6613\u4ea7\u751f\u6570\u636e\u503e\u659c\u3002\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u5728 Map \u7aef\u5b9e\u73b0\u6570\u636e\u5408\u5e76\uff0c\u5177\u4f53\u505a\u6cd5\u662f\uff0c \u5728 Driver \u9a71\u52a8\u7c7b\u4f7f\u7528 job.addCacheFile()\u65b9\u6cd5\u8bbe\u7f6ejob\u5148\u5c06\u5546\u54c1\u8868pd.txt\u7684\u6570\u636e\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5728setUp()\u65b9\u6cd5\u4e2d\u8bfb\u53d6pd.txt\u7684\u6570\u636e\uff0c\u5206\u5272\u540e\u653e\u5230HashMap\u4e2d\uff0c\u6700\u540e\u5728Map()\u65b9\u6cd5\u4e2d\u5b8c\u6210join\u7684\u64cd\u4f5c\u3002\u8fd9\u79cd Map Join \u7684\u65b9\u5f0f\u9002\u7528\u4e8e\u4e00\u5f20\u8868\u5341\u5206\u5c0f\u3001\u4e00\u5f20\u8868\u5f88\u5927\u7684\u573a\u666f\uff0c\u56e0\u4e3a\u6bcf\u4e2aMap\u8282\u70b9\u90fd\u8981\u5728map\u65b9\u6cd5\u5f00\u59cb\u4e4b\u524d\u7f13\u5b58\u6574\u5f20\u5c0f\u8868\u5230\u5185\u5b58\u4e2d\uff0c\u5927\u8868\u7684\u6570\u636e\u53ea\u9700\u8981\u8bfb\u53d6\u5728\u672cMap\u8282\u70b9\u4e0a\u7684\u5206\u7247\u5373\u53ef\u3002</p> <p>Driver \u9a71\u52a8\u7c7b\u4e2d\u8bbe\u7f6e\u7f13\u5b58\uff0c\u5982\u679c\u6709\u9700\u8981\u5c06\u591a\u4e2amap\u7684\u7ed3\u679c\u5408\u5e76\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6eReduceTask\u7684\u4e2a\u6570\u4e3a1\u5e76\u51991\u4e2areduce\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5199\u4e86\uff0c\u76f4\u63a5\u8bbe\u7f6eReduceTask\u7684\u4e2a\u6570\u4e3a0\uff0c\u5c06map\u7684\u7ed3\u679c\u4f5c\u4e3a\u8f93\u51fa\u3002 Text Only<pre><code>public class MapJoinDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, URISyntaxException, ClassNotFoundException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6e\u52a0\u8f7djar\u5305\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(MapJoinDriver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(MapJoinMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6eMap\u8f93\u51faKV\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(NullWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51faKV\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(NullWritable.class);\n\n `String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();`\n `// \u52a0\u8f7d\u7f13\u5b58\u6570\u636e`\n `job.addCacheFile(new URI(\u00a0\u00a0\"file://\" + classPath + \"input/join/product.txt\"));`\n `// Map\u7aefJoin\u7684\u903b\u8f91\u4e0d\u9700\u8981Reduce\u9636\u6bb5\uff0c\u8bbe\u7f6ereduceTask\u6570\u91cf\u4e3a0`\n `job.setNumReduceTasks(0);`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\n `FileInputFormat.setInputPaths(job, new Path(classPath + \"/input/join/order.txt\"));`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output666\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean b = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(b ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5148\u5728setUp()\u65b9\u6cd5\u4e2d\u8bfb\u53d6pd.txt\u7684\u6570\u636e\uff0c\u5206\u5272\u540e\u653e\u5230HashMap\u4e2d\uff0c\u6700\u540e\u5728Map()\u65b9\u6cd5\u4e2d\u5b8c\u6210join\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e0d\u6d89\u53camap\u5411reduce\u4f20\u8f93\u6570\u636e\uff0c\u6240\u4ee5\u4e0d\u5fc5\u5b9a\u4e49bean\uff0c\u76f4\u63a5\u4f7f\u7528Text\u5c06\u6587\u672c\u5199\u51fa\u5373\u53ef\u3002 Text Only<pre><code>public class MapJoinMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0private HashMap&lt;String, String&gt; pdMap = new HashMap&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0private Text outK = new Text();\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void setup(Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u83b7\u53d6\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u5e76\u628a\u6587\u4ef6\u5185\u5bb9\u5c01\u88c5\u5230\u96c6\u5408 pd.txt\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0URI[] cacheFiles = context.getCacheFiles();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileSystem fs = FileSystem.get(context.getConfiguration());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FSDataInputStream fis = fs.open(new Path(cacheFiles[0]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4ece\u6d41\u4e2d\u8bfb\u53d6\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BufferedReader reader = new BufferedReader(new InputStreamReader(fis, \"UTF-8\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (StringUtils.isNotEmpty(line = reader.readLine())) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5207\u5272\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8d4b\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0pdMap.put(fields[0], fields[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5173\u6d41\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IOUtils.closeStream(reader);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5904\u7406 order.txt\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u6839\u636epid\u83b7\u53d6pname\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String pname = pdMap.get(fields[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.set(fields[0] + \"\\t\" + pname + \"\\t\" + fields[2]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(outK, NullWritable.get());\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/16-MapReduce%20%E4%B9%8B%20ETL/","title":"16-MapReduce \u4e4b ETL","text":"<p> \u7ea6 262 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 5 \u5206\u949f</p> <p>ETL\uff0c\u662f\u82f1\u6587 Extract-Transform-Load \u7684\u7f29\u5199\uff0c\u7528\u6765\u63cf\u8ff0\u5c06\u6570\u636e\u4ece\u6765\u6e90\u7aef\u7ecf\u8fc7\u62bd\u53d6\uff08Extract\uff09\u3001\u8f6c\u6362\uff08Transform\uff09\u3001\u52a0\u8f7d\uff08Load\uff09\u81f3\u76ee\u7684\u7aef\u7684\u8fc7\u7a0b\uff0c\u76ee\u7684\u662f\u8fdb\u884c\u6570\u636e\u6e05\u6d17\u3002 ETL \u4e00\u8bcd\u8f83\u5e38\u7528\u5728\u6570\u636e\u4ed3\u5e93\uff0c\u4f46\u5176\u5bf9\u8c61\u5e76\u4e0d\u9650\u4e8e\u6570\u636e\u4ed3\u5e93\u3002\u4f7f\u7528 MapReduce \u8fdb\u884c\u6570\u636e\u6e05\u7406\u5f80\u5f80\u53ea\u9700\u8981\u8fd0\u884c Mapper \u7a0b\u5e8f\uff0c\u4e0d\u9700\u8981\u8fd0\u884c Reduce \u7a0b\u5e8f\u3002</p> <p>\u6848\u4f8b\uff1a </p> <p>Map Text Only<pre><code>public class LogMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 ETL\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] fields = line.split(\" \");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (fields.length &gt; 11){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(value, NullWritable.get());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Driver Text Only<pre><code>public class LogDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8f93\u5165\u8f93\u51fa\u8def\u5f84\u9700\u8981\u6839\u636e\u81ea\u5df1\u7535\u8111\u4e0a\u5b9e\u9645\u7684\u8f93\u5165\u8f93\u51fa\u8def\u5f84\u8bbe\u7f6e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0args = new String[]{\"D:/input/inputlog\", \"D:/hadoop/output11111\"};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u52a0\u8f7djar\u5305\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(LogDriver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054map\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(WebLogMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51fa\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(NullWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u8bbe\u7f6ereducetask\u4e2a\u6570\u4e3a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setNumReduceTasks(0);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u8f93\u5165\u548c\u8f93\u51fa\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(args[0]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(args[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 6 \u63d0\u4ea4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean b = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(b ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/17-%E5%8E%8B%E7%BC%A9/","title":"17-\u538b\u7f29","text":"<p> \u7ea6 324 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u538b\u7f29\u65b9\u5f0f\u9009\u62e9\u65f6\u91cd\u70b9\u8003\u8651\uff1a \u538b\u7f29/\u89e3\u538b\u7f29\u901f\u5ea6\u3001\u538b\u7f29\u7387\uff08\u538b\u7f29\u540e\u5b58\u50a8\u5927\u5c0f\uff09\u3001\u538b\u7f29\u540e\u662f\u5426\u53ef\u4ee5\u652f\u6301\u5207\u7247\u3002 </p> <p>MR \u652f\u6301\u7684\u538b\u7f29\u7f16\u7801</p> \u538b\u7f29\u683c\u5f0f \u7b97\u6cd5 \u6587\u4ef6\u6269\u5c55\u540d \u662f\u5426\u53ef\u5207\u5206 DEFLATE DEFLATE .deflate \u5426 Gzip DEFLATE .gz \u5426 bzip2 bzip2 .bz2 \u662f LZO LZO .lzo \u662f Snappy Snappy .snappy \u5426 <p>\u538b\u7f29\u683c\u5f0f\u5bf9\u5e94\u7684\u7f16\u7801/\u89e3\u7801\u5668</p> \u538b\u7f29\u683c\u5f0f \u5bf9\u5e94\u7684\u7f16\u7801/\u89e3\u7801\u5668 DEFLATE org.apache.hadoop.io.compress.DefaultCodec gzip org.apache.hadoop.io.compress.GzipCodec bzip2 org.apache.hadoop.io.compress.BZip2Codec LZO com.hadoop.compression.lzo.LzopCodec Snappy org.apache.hadoop.io.compress.SnappyCodec <p>\u538b\u7f29\u6027\u80fd\u7684\u6bd4\u8f83\uff1a</p> \u538b\u7f29\u7b97\u6cd5 \u539f\u59cb\u6587\u4ef6\u5927\u5c0f \u538b\u7f29\u6587\u4ef6\u5927\u5c0f \u538b\u7f29\u901f\u5ea6 \u89e3\u538b\u901f\u5ea6 gzip 8.3GB 1.8GB 17.5MB/s 58MB/s bzip2 8.3GB 1.1GB 2.4MB/s 9.5MB/s LZO 8.3GB 2.9GB 49.3MB/s 74.6MB/s <p>\u8981\u5728 Hadoop \u4e2d\u542f\u7528\u538b\u7f29\uff0c\u53ef\u4ee5\u914d\u7f6e\u5982\u4e0b\u53c2\u6570\uff08mapred-site.xml \u6587\u4ef6\u4e2d\uff09\uff1a</p> \u53c2\u6570 \u9ed8\u8ba4\u503c \u9636\u6bb5 \u542b\u4e49 io.compression.codecs\uff08\u5728 core-site.xml \u4e2d\u914d\u7f6e\uff09 org.apache.hadoop.io.compress.DefaultCodec, org.apache.hadoop.io.compress.GzipCodec, org.apache.hadoop.io.compress.BZip2Codec,org.apache.hadoop.io.compress.Lz4Codec \u8f93\u5165\u538b\u7f29 Hadoop \u4f7f\u7528\u6587\u4ef6\u6269\u5c55\u540d\u5224\u65ad\u662f\u5426\u652f\u6301\u67d0\u79cd \u7f16\u89e3\u7801\u5668 mapreduce.map.output.compress false mapper \u8f93\u51fa \u8fd9\u4e2a\u53c2\u6570\u8bbe\u4e3a true \u542f \u7528\u538b\u7f29 mapreduce.map.output.compress.codec org.apache.hadoop.io.compress.DefaultCodec mapper \u8f93\u51fa \u4f7f\u7528 LZO\u3001LZ4 \u6216 snappy \u7f16\u89e3\u7801\u5668\u5728\u6b64 \u9636\u6bb5\u538b\u7f29\u6570\u636e mapreduce.output.fileoutputformat.compress false reducer \u8f93\u51fa \u8fd9\u4e2a\u53c2\u6570\u8bbe\u4e3a true \u542f \u7528\u538b\u7f29 mapreduce.output.fileoutputformat.compress.codec org.apache.hadoop.io.compress. DefaultCodec reducer \u8f93\u51fa \u4f7f\u7528\u6807\u51c6\u5de5\u5177\u6216\u8005\u7f16 \u89e3\u7801\u5668\uff0c\u5982 gzip \u548c bzip2 mapreduce.output.fileoutputformat.compress.type RECORD reducer \u8f93\u51fa SequenceFile \u8f93\u51fa\u4f7f\u7528\u7684\u538b\u7f29\u7c7b\u578b\uff1aNONE \u00a0\u548c BLOCK"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/18-Yarn/","title":"18-Yarn","text":"<p> \u7ea6 823 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>Yarn\u662f\u4e00\u4e2a\u8d44\u6e90\u8c03\u5ea6\u5e73\u53f0\uff0c\u8d1f\u8d23\u4e3aMapReduce\u7a0b\u5e8f\u5206\u914d\u7cfb\u7edf\u8d44\u6e90\u3002 YARN \u4e3b\u8981\u7531 ResourceManager\u3001 NodeManager\u3001 ApplicationMaster\u548c Container \u7b49\u7ec4\u4ef6\u6784\u6210\u3002 ResourceManager\uff08RM\uff09\u4e3b\u8981\u4f5c\u7528\u5982\u4e0b\uff1a \uff081\uff09\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42 \uff082\uff09\u76d1\u63a7NodeManager \uff083\uff09\u542f\u52a8\u6216\u76d1\u63a7ApplicationMaster \uff084\uff09\u8d44\u6e90\u7684\u5206\u914d\u4e0e\u8c03\u5ea6 NodeManager\uff08NM\uff09\u4e3b\u8981\u4f5c\u7528\u5982\u4e0b\uff1a \uff081\uff09\u7ba1\u7406\u5355\u4e2a\u8282\u70b9\u4e0a\u7684\u8d44\u6e90 \uff082\uff09\u5904\u7406\u6765\u81eaResourceManager\u7684\u547d\u4ee4 \uff083\uff09\u5904\u7406\u6765\u81eaApplicationMaster\u7684\u547d\u4ee4 ApplicationMaster\uff08 AM\uff09\u4f5c\u7528\u5982\u4e0b\uff1a \uff081\uff09\u4e3aMapTask\u548cReduceTask\u7533\u8bf7\u8d44\u6e90 \uff082\uff09\u4efb\u52a1\u7684\u76d1\u63a7\u4e0e\u5bb9\u9519 Container\u662f YARN\u4e2d\u7684\u8d44\u6e90\u62bd\u8c61\uff0c \u5b83\u5c01\u88c5\u4e86\u67d0\u4e2a\u8282\u70b9\u4e0a\u7684\u591a\u7ef4\u5ea6\u8d44\u6e90\uff0c \u5982\u5185\u5b58\u3001 CPU\u3001 \u78c1\u76d8\u3001\u7f51\u7edc\u7b49\u3002 \u8fd9\u56db\u4e2a\u7ec4\u4ef6\u6240\u5904\u7684\u4f4d\u7f6e\u548c\u5927\u81f4\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a </p> <p>Yarn\u7684\u5177\u4f53\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a  1. MR\u7a0b\u5e8f\u63d0\u4ea4\u5230\u5ba2\u6237\u7aef\u6240\u5728\u7684\u8282\u70b9\u3002 2. YarnRunner\u5411ResourceManager\u7533\u8bf7\u4e00\u4e2aApplication\u3002 3. ResourceManager\u5c06\u8be5\u5e94\u7528\u7a0b\u5e8f\u7684\u8d44\u6e90\u8def\u5f84\u8fd4\u56de\u7ed9YarnRunner\u3002 4. \u8be5\u7a0b\u5e8f\u5c06\u8fd0\u884c\u7684\u8d44\u6e90\u63d0\u4ea4\u5230HDFS\u4e0a\u3002 5. \u7a0b\u5e8f\u8d44\u6e90\u63d0\u4ea4\u5b8c\u6bd5\u540e\uff0c\u7533\u8bf7\u8fd0\u884cMRAppMaster\u3002 6. ResourceManager\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u521d\u59cb\u5316\u6210\u4e00\u4e2aTask\uff0c\u5e76\u5c06Task\u52a0\u5165\u5230\u8c03\u5ea6\u961f\u5217\u4e2d\u3002 \uff08ResourceManager\u4e2d\u7684\u4efb\u52a1Task\u5e94\u8be5\u53ea\u662f\u4e00\u4e2a\u7528\u6765\u6392\u961f\u88ab\u8c03\u5ea6\u7684\u6570\u636e\u7ed3\u6784\uff0c\u91cc\u9762\u5b58\u50a8\u7684\u662f\u8fd9\u4e2a\u4efb\u52a1\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u4efb\u52a1\u7684application_id\u4ee5\u53caJob.split\u3001Job.xml\u548cwc.jar\u8fd9\u4e09\u4e2a\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e0d\u662f\u771f\u6b63\u8981\u88ab\u8fd0\u884c\u7684MR\u7a0b\u5e8f\uff0c\u5728\u540e\u9762\u51e0\u6b65\u4e2d\uff0cNodeManager\u9886\u53d6\u5230\u4efb\u52a1\u4e4b\u540e\uff0c\u4f1a\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u53bbHDFS\u4e0a\u4e0b\u8f7d\u8fd0\u884c\u4efb\u52a1\u6240\u9700\u8981\u7684\u8d44\u6e90\uff09 7. \u5176\u4e2d\u4e00\u4e2aNodeManager\u9886\u53d6\u5230Task\u4efb\u52a1\u3002 8. \u8be5NodeManager\u521b\u5efa\u5bb9\u5668Container\uff0c\u5e76\u4ea7\u751fMRAppMaster\u3002 9. Container\u4eceHDFS\u4e0a\u62f7\u8d1d\u8d44\u6e90\u5230\u672c\u5730\u3002 10. MRAppMaster\u5411ResourceManager\u7533\u8bf7\u8fd0\u884cMapTask\u8d44\u6e90\u3002 \uff08Map\u4efb\u52a1\u540c\u6837\u5e94\u8be5\u4f1a\u88abResourceManager\u521d\u59cb\u5316\u6210\u4e00\u4e2aTask\uff0c\u4e00\u4e2a\u7528\u6765\u6392\u961f\u88ab\u8c03\u5ea6\u7684\u6570\u636e\u7ed3\u6784\uff0c\u91cc\u9762\u5b58\u50a8\u7684\u662f\u8fd9\u4e2a\u4efb\u52a1\u7684\u4fe1\u606f\uff09 11. ResourceManager\u5c06Map\u4efb\u52a1\u521d\u59cb\u5316\u6210\u4e00\u4e2aTask\uff0c\u7136\u540e\u53e6\u5916\u4e24\u4e2aNodeManager\u5206\u522b\u9886\u53d6\u4efb\u52a1\u5e76\u521b\u5efa\u5bb9\u5668\u3002 12. MRAppMaster\u5411\u4e24\u4e2a\u63a5\u6536\u5230\u4efb\u52a1\u7684NodeManager\u53d1\u9001\u7a0b\u5e8f\u542f\u52a8\u811a\u672c\uff0c\u8fd9\u4e24\u4e2aNodeManager\u5206\u522b\u542f\u52a8MapTask\uff0cMapTask\u5bf9\u6570\u636e\u5206\u533a\u6392\u5e8f\u3002 \uff08\u8fd9\u4e2a\u7a0b\u5e8f\u542f\u52a8\u811a\u672c\u5e94\u8be5\u5c31\u662f\u771f\u6b63\u7684Map\u7a0b\u5e8f\uff0c\u662fMRAppMaster\u6839\u636eJob.split\u3001Job.xml\u548cwc.jar\u751f\u6210\u7684\uff09 13. MRAppMaster\u7b49\u5f85\u6240\u6709MapTask\u8fd0\u884c\u5b8c\u6bd5\u540e\uff0c\u5411ResourceManager\u7533\u8bf7\u5bb9\u5668\uff0c\u8fd0\u884cReduceTask\u3002 \uff0813\u548c14\u6b65\u4e4b\u95f4\u5e94\u8be5\u8fd8\u6709\u4e00\u4e9b\u6b65\u9aa4\uff0c\u5c31\u662fResourceManager\u5c06Reduce\u4efb\u52a1\u521d\u59cb\u5316\u6210\u4e00\u4e2aTask\u7b49\u5f85NodeManager\u6765\u9886\u53d6\u4efb\u52a1\uff0cNodeManager\u9886\u53d6\u5230\u4efb\u52a1\u4e4b\u540e\u521b\u5efaContainer\uff0cMRAppMaster\u5411\u63a5\u6536\u5230ReduceTask\u7684NodeManager\u53d1\u9001\u7a0b\u5e8f\u542f\u52a8\u811a\u672c\uff0c\u4e8e\u662fReduceTask\u5c31\u8fd0\u884c\u8d77\u6765\u4e86\uff09 14. ReduceTask\u5411MapTask\u83b7\u53d6\u76f8\u5e94\u5206\u533a\u7684\u6570\u636e\u3002 15. \u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6bd5\u540e\uff0cMRAppMaster\u4f1a\u5411ResourceManager\u7533\u8bf7\u6ce8\u9500\u81ea\u5df1\u3002</p> <p>\u4ece\u4e0a\u9762\u6d41\u7a0b\u53ef\u4ee5\u770b\u5230Yarn\u7684\u8c03\u5ea6\u961f\u5217\u4e2d\u6709\u4e09\u79cd\u4efb\u52a1\uff0c\u7b2c\u4e00\u79cd\u662f\u8fd0\u884cMRAppMaster\u7684\u4efb\u52a1\uff0c\u7b2c\u4e8c\u79cd\u662fMapTask\u4efb\u52a1\uff0c\u7b2c\u4e09\u79cd\u662fReduceTask\u4efb\u52a1\u3002\u6bcf\u4e00\u79cd\u4efb\u52a1\u90fd\u4f1a\u88ab\u653e\u5230Yarn\u7684\u8c03\u5ea6\u961f\u5217\u4e2d\uff0c\u6709NodeManager\u9886\u53d6\u4efb\u52a1\u7136\u540e\u542f\u52a8Container\u8fd0\u884c\u4efb\u52a1\u3002\u8fd9\u4e09\u79cd\u4efb\u52a1\u7684\u8fd0\u884c\u662f\u6709\u5148\u540e\u987a\u5e8f\u7684\uff0c\u6700\u5148\u8fd0\u884cMRAppMaster\uff0c\u7136\u540e\u7531 MRAppMaster\u63a7\u5236\u7740MapTask\u548cReduceTask\u7684\u4ea7\u751f\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/19-%E6%80%BB%E7%BB%93/","title":"19-HDFS\u3001 YARN\u3001 MapReduce\u4e09\u8005\u5173\u7cfb \u4ee5\u53ca MapReduce\u63d0\u4ea4\u5e76\u6267\u884c\u7684\u6574\u4e2a\u6d41\u7a0b","text":"<p> \u7ea6 518 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>HDFS\u3001 YARN\u3001 MapReduce\u4e09\u8005\u5173\u7cfb </p> <p>\u4f5c\u4e1a\u63d0\u4ea4\u5e76\u6267\u884c\u7684\u5168\u8fc7\u7a0b\uff1a \uff081\uff09\u4f5c\u4e1a\u63d0\u4ea4 \u7b2c1\u6b65\uff1a\u8c03\u7528job.waitForCompletion\u65b9\u6cd5\uff0c\u4e0eYarn\u5efa\u7acb\u8fde\u63a5\u3002 \u7b2c2\u6b65\uff1a\u901a\u8fc7YarnClient\u5411ResourceManager\u7533\u8bf7\u4e00\u4e2a\u4f5c\u4e1aid\u3002 \u7b2c3\u6b65\uff1aResourceManager\u7ed9YarnClient\u8fd4\u56de\u8be5job\u8d44\u6e90\u7684\u63d0\u4ea4\u8def\u5f84\u548c\u4f5c\u4e1aid\u3002 \u7b2c4\u6b65\uff1a\u901a\u8fc7HDFSClient\u5411HDFS\u63d0\u4ea4jar\u5305\u3001\u5207\u7247\u4fe1\u606f\u548c\u914d\u7f6e\u6587\u4ef6\u5230\u6307\u5b9a\u7684\u8d44\u6e90\u63d0\u4ea4\u8def\u5f84\u3002 \u7b2c5\u6b65\uff1a\u5411RM\u7533\u8bf7\u8fd0\u884cMRAppMaster\u3002 \uff082\uff09\u4f5c\u4e1a\u521d\u59cb\u5316 \u7b2c6\u6b65\uff1a\u5f53ResourceManager\u6536\u5230YarnClient\u7684\u8bf7\u6c42\u540e\uff0c\u5c06\u8be5job\u6dfb\u52a0\u5230\u5bb9\u91cf\u8c03\u5ea6\u5668\u4e2d\u3002 \u7b2c7\u6b65\uff1a\u67d0\u4e00\u4e2a\u7a7a\u95f2\u7684NodeManager\u9886\u53d6\u5230\u8be5Job\u3002 \u7b2c8\u6b65\uff1a\u8be5NodeManager\u521b\u5efaContainer\uff0c\u5e76\u4ea7\u751fMRAppMaster\u3002 \u7b2c9\u6b65\uff1a\u901a\u8fc7HDFSClient\u4e0b\u8f7dJob\u8d44\u6e90\u5230\u672c\u5730\u3002 \uff083\uff09\u4efb\u52a1\u5206\u914d \u7b2c10\u6b65\uff1aMRAppMaster\u5411ResourceManager\u7533\u8bf7\u8fd0\u884c\u591a\u4e2aMapTask\u4efb\u52a1\u8d44\u6e90\u3002 \u7b2c11\u6b65\uff1aResourceManager\u5c06\u8fd0\u884cMapTask\u4efb\u52a1\u5206\u914d\u7ed9\u53e6\u5916\u4e24\u4e2aNodeManager\uff0c\u53e6\u4e24\u4e2aNodeManager\u5206\u522b\u9886\u53d6\u4efb\u52a1\u5e76\u521b\u5efa\u5bb9\u5668\u3002 \uff084\uff09\u4efb\u52a1\u8fd0\u884c \u7b2c12\u6b65\uff1aMRAppMaster\u5411\u4e24\u4e2a\u63a5\u6536\u5230\u4efb\u52a1\u7684NodeManager\u53d1\u9001\u7a0b\u5e8f\u542f\u52a8\u811a\u672c\uff0c\u8fd9\u4e24\u4e2aNodeManager\u5206\u522b\u542f\u52a8MapTask\uff0cMapTask\u5bf9\u6570\u636e\u5206\u533a\u6392\u5e8f\u3002 \u7b2c13\u6b65\uff1aMrAppMaster\u7b49\u5f85\u6240\u6709MapTask\u8fd0\u884c\u5b8c\u6bd5\u540e\uff0c\u5411ResourceManager\u7533\u8bf7\u5bb9\u5668\uff0c\u8fd0\u884cReduceTask\u3002 \u7b2c14\u6b65\uff1aReduceTask\u5411MapTask\u83b7\u53d6\u76f8\u5e94\u5206\u533a\u7684\u6570\u636e\u3002 \u7b2c15\u6b65\uff1a\u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6bd5\u540eMRAppMaster\u4f1a\u5411ResourceManager\u7533\u8bf7\u6ce8\u9500\u81ea\u5df1\u3002 \uff085\uff09\u8fdb\u5ea6\u548c\u72b6\u6001\u66f4\u65b0 YARN\u4e2d\u7684\u4efb\u52a1\u5c06\u5176\u8fdb\u5ea6\u548c\u72b6\u6001(\u5305\u62eccounter)\u8fd4\u56de\u7ed9\u5e94\u7528\u7ba1\u7406\u5668, \u5ba2\u6237\u7aef\u6bcf\u79d2(\u901a\u8fc7mapreduce.client.progressmonitor.pollinterval\u8bbe\u7f6e)\u5411\u5e94\u7528\u7ba1\u7406\u5668\u8bf7\u6c42\u8fdb\u5ea6\u66f4\u65b0, \u5c55\u793a\u7ed9\u7528\u6237\u3002 \uff086\uff09\u4f5c\u4e1a\u5b8c\u6210 \u9664\u4e86\u5411\u5e94\u7528\u7ba1\u7406\u5668\u8bf7\u6c42\u4f5c\u4e1a\u8fdb\u5ea6\u5916, \u5ba2\u6237\u7aef\u6bcf5\u79d2\u90fd\u4f1a\u901a\u8fc7\u8c03\u7528waitForCompletion()\u6765\u68c0\u67e5\u4f5c\u4e1a\u662f\u5426\u5b8c\u6210\u3002\u65f6\u95f4\u95f4\u9694\u53ef\u4ee5\u901a\u8fc7mapreduce.client.completion.pollinterval\u6765\u8bbe\u7f6e\u3002\u4f5c\u4e1a\u5b8c\u6210\u4e4b\u540e, \u5e94\u7528\u7ba1\u7406\u5668\u548cContainer\u4f1a\u6e05\u7406\u5de5\u4f5c\u72b6\u6001\u3002\u4f5c\u4e1a\u7684\u4fe1\u606f\u4f1a\u88ab\u4f5c\u4e1a\u5386\u53f2\u670d\u52a1\u5668\u5b58\u50a8\u4ee5\u5907\u4e4b\u540e\u7528\u6237\u6838\u67e5\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/2-Hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/","title":"2-Hadoop\u96c6\u7fa4\u642d\u5efa","text":"<p> \u7ea6 1573 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 31 \u5206\u949f</p> <p>centos8\u5b89\u88c5\u65f6\u8bbe\u7f6e\u5b89\u88c5\u6e90\uff1a Text Only<pre><code>https://mirrors.aliyun.com/centos/8-stream/BaseOS/x86_64/os/\n</code></pre></p> <p>\u4fee\u6539\u4e3b\u673a\u540d vim /etc/hostname</p> <p>\u5b89\u88c5epel-release yum install -y epel-release</p> <p>\u5b89\u88c5ifconfig yum install -y net-tools</p> <p>\u5b89\u88c5vim yum install -y vim</p> <p>\u5173\u95ed\u9632\u706b\u5899 systemctl stop firewalld systemctl disable firewalld.service</p> <p>\u914d\u7f6eVMWare\u7684\u865a\u62df\u7f51\u7edc\u8bbe\u7f6e</p> <p>\u914d\u7f6e\u9759\u6001ip vim /etc/sysconfig/network-scripts/ifcfg-ens33 Text Only<pre><code>BOOTPROTO=\"static\"\n#IP\u5730\u5740\nIPADDR=192.168.10.100\u00a0\u00a0\n#\u7f51\u5173\nGATEWAY=192.168.10.2\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n#\u57df\u540d\u89e3\u6790\u5668\nDNS1=192.168.10.2\n</code></pre></p> <p>\u4fee\u6539Linux\u7684hosts\u6587\u4ef6 vim /etc/hosts Text Only<pre><code>192.168.10.100 hadoop100\n192.168.10.101 hadoop101\n192.168.10.102 hadoop102\n192.168.10.103 hadoop103\n192.168.10.104 hadoop104\n</code></pre></p> <p>\u540c\u4e0a\uff0c\u4fee\u6539Windows\u7684hosts\u6587\u4ef6\u00a0C:\\Windows\\System32\\drivers\\etc</p> <p>\u91cd\u542fLinux reboot</p> <p>\u67e5\u770b\u4e3b\u673a\u540d hostname</p> <p>\u521b\u5efa\u65b0\u7528\u6237 useradd jmoon passwd jmoon</p> <p>\u914d\u7f6ejmoon\u7528\u6237\u5177\u6709root\u6743\u9650\uff0c\u65b9\u4fbf\u540e\u671f\u52a0sudo\u6267\u884croot\u6743\u9650\u7684\u547d\u4ee4 vim /etc/sudoers Text Only<pre><code>root\u00a0\u00a0\u00a0\u00a0ALL=(ALL)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ALL\n\n## Allows members of the 'sys' group to run networking, software,\n## service management apps and more.\n# %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS\n\n## Allows people in group wheel to run all commands\n%wheel\u00a0\u00a0ALL=(ALL)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ALL\n\njmoon\u00a0\u00a0\u00a0ALL=(ALL)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0NOPASSWD:ALL\n</code></pre></p> <p>\u5207\u6362\u7528\u6237 su jmoon</p> <p>\u521b\u5efa\u6587\u4ef6\u5939\uff0c\u4ee5\u540e\u7684\u8d44\u6e90\u653e\u5728\u91cc\u9762\u7edf\u4e00\u7ba1\u7406 sudo mkdir /opt/module sudo mkdir /opt/software</p> <p>\u4fee\u6539\u6587\u4ef6\u5939\u6240\u5c5e\u7528\u6237\u548c\u7ec4 sudo chown jmoon:jmoon /opt/module/ /opt/software/</p> <p>\u5728root\u7528\u6237\u4e0b\u5378\u8f7dOpenJDK\uff08\u5982\u679c\u662f\u6700\u5c0f\u5b89\u88c5\u65e0\u9700\u8fdb\u884c\u6b64\u6b65\uff09 rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps</p> <ul> <li>rpm -qa\uff1a\u8868\u793a\u67e5\u8be2\u6240\u6709\u5df2\u7ecf\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305</li> <li>grep -i\uff1a\u8868\u793a\u8fc7\u6ee4\u65f6\u4e0d\u533a\u5206\u5927\u5c0f\u5199</li> <li>xargs -n1\uff1a\u8868\u793a\u4e00\u6b21\u83b7\u53d6\u4e0a\u6b21\u6267\u884c\u7ed3\u679c\u7684\u4e00\u4e2a\u503c</li> <li>rpm -e --nodeps\uff1a\u8868\u793a\u5378\u8f7d\u8f6f\u4ef6</li> </ul> <p>\u4e0b\u8f7dJDK8\u540e\u4e0a\u4f20\u5230/opt/software\u7136\u540e\u89e3\u538b\u5230/opt/module tar -zxvf\u00a0/opt/software/jdk-8u301-linux-x64.tar.gz -C /opt/module/</p> <p>\u4e0b\u8f7dhadoop\u540e\u4e0a\u4f20\u5230/opt/software\u7136\u540e\u89e3\u538b\u5230/opt/module tar -zxvf /opt/software/hadoop-3.3.1.tar.gz -C /opt/module/</p> <p>\u914d\u7f6e\u73af\u5883\u53d8\u91cf sudo vim /etc/profile.d/my_env.sh Text Only<pre><code>#JAVA_HOME\nexport JAVA_HOME=/opt/module/jdk-11.0.12\nexport PATH=$PATH:$JAVA_HOME/bin\n\n#HADOOP_HOME\nexport HADOOP_HOME=/opt/module/hadoop-3.3.1\nexport PATH=$PATH:$HADOOP_HOME/bin\nexport PATH=$PATH:$HADOOP_HOME/sbin\n</code></pre> $HADOOP_HOME/bin\u76ee\u5f55\u4e0b\u662fhadoop\u3001hdfs\u3001yarn\u3001mapreduce\u7684\u64cd\u4f5c\u547d\u4ee4 $HADOOP_HOME/sbin\u76ee\u5f55\u4e0b\u662f\u542f\u52a8\u505c\u6b62hadoop\u3001yarn\u7684\u547d\u4ee4</p> <p>\u4f7f\u73af\u5883\u53d8\u91cf\u751f\u6548 source /etc/profile</p> <p>\u6d4b\u8bd5 java -version hadoop version</p> <p>\u5b89\u88c5rsync sudo yum install -y rsync</p> <p>\u5728/home/jmoon\u76ee\u5f55\u4e0b\u521b\u5efabin\u76ee\u5f55\uff08/home/jmoon/bin\u5df2\u88ab\u6dfb\u52a0\u5230\u7528\u6237jmoon\u7684\u73af\u5883\u53d8\u91cf\u4e2d\u4e86\uff0c\u6240\u4ee5\u76f4\u63a5\u521b\u5efa\u8fd9\u6837\u4e00\u4e2a\u76ee\u5f55\uff0c\u5728\u4e0b\u9762\u7f16\u5199\u811a\u672c\u5c31\u4e0d\u7528\u518d\u53e6\u5916\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u4e86\uff09\uff0c\u7136\u540e\u7f16\u5199\u540c\u6b65\u5206\u53d1\u811a\u672c vim xsync Text Only<pre><code>#!/bin/bash\n\n#1. \u5224\u65ad\u53c2\u6570\u4e2a\u6570\nif [ $# -lt 1 ]\nthen\n\u00a0\u00a0\u00a0\u00a0echo Not Enough Arguement!\n\u00a0\u00a0\u00a0\u00a0exit;\nfi\n\n#2. \u904d\u5386\u96c6\u7fa4\u6240\u6709\u673a\u5668\nfor host in hadoop102 hadoop103 hadoop104\ndo\n\u00a0\u00a0\u00a0\u00a0echo ====================\u00a0\u00a0$host\u00a0\u00a0====================\n\u00a0\u00a0\u00a0\u00a0#3. \u904d\u5386\u6240\u6709\u76ee\u5f55\uff0c\u6328\u4e2a\u53d1\u9001\n\u00a0\u00a0\u00a0\u00a0for file in $@\n\u00a0\u00a0\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#4. \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if [ -e $file ]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0then\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#5. \u83b7\u53d6\u7236\u76ee\u5f55\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0pdir=$(cd -P $(dirname $file); pwd)\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#6. \u83b7\u53d6\u5f53\u524d\u6587\u4ef6\u7684\u540d\u79f0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fname=$(basename $file)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh $host \"mkdir -p $pdir\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rsync -av $pdir/$fname $host:$pdir\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0else\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo $file does not exists!\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fi\n\u00a0\u00a0\u00a0\u00a0done\ndone\n</code></pre></p> <p>\u7ed9xsync\u589e\u52a0\u53ef\u6267\u884c\u6743\u9650 chmod +x xsync</p> <p>\u7ec8\u7aef\u914d\u8272\uff1a \u5728~/.bashrc\u4e2d\u6dfb\u52a0 Text Only<pre><code>PS1=\"\\[\\e[33m\\][\\[\\e[35m\\]\\u\\[\\e[33m\\]@\\[\\e[36m\\]\\h \\[\\e[32m\\]\\W\\[\\e[33m\\]]\\\\$\\[\\e[0m\\] \"\n</code></pre> \u7136\u540e source .bashrc</p> <p>\u53d6\u6d88 SELINUX \uff1a \u4fee\u6539/etc/selinux/config \u4e2d\u7684 SELINUX=disabled Text Only<pre><code>sudo vim /etc/selinux/config\n</code></pre> Text Only<pre><code>SELINUX=disabled\n</code></pre></p> <p>\u514b\u9686\u4e09\u53f0hadoop\u4e3b\u673a\uff1ahadoop102\u3001hadoop103\u3001hadoop104\uff0c\u4fee\u6539\u4e3b\u673a\u540d\u548c\u9759\u6001ip\u5730\u5740\u8bbe\u7f6e\u4e4b\u540e\u91cd\u542f</p> <p>\u914d\u7f6e\u514d\u5bc6\u767b\u5f55\uff1a \u5728\u4e09\u53f0\u4e3b\u673a\u4e0a\u6267\u884cssh-keygen -t rsa\uff0c\u7136\u540e\u5728\u4e09\u53f0\u4e3b\u673a\u4e0a\u6267\u884c ssh-copy-id hadoop102\uff0c\u63a5\u7740\u628aWindows\uff08\u5bbf\u4e3b\u673a\uff09\u7684\u516c\u94a5\u590d\u5236\u5230~/.ssh/authorized_keys\uff0c\u6700\u540e\u5728hadoop102\u4e0a\u6267\u884c xsync ~/.ssh/authorized_keys</p> <p>\u96c6\u7fa4\u90e8\u7f72\u89c4\u5212 \u00a0\u00a0\u6ce8\u610f\uff1a \u00a0\u00a0\u00a0\u00a0NameNode\u548cSecondaryNameNode\u4e0d\u8981\u5b89\u88c5\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668 \u00a0\u00a0\u00a0\u00a0ResourceManager\u4e5f\u5f88\u6d88\u8017\u5185\u5b58\uff0c\u4e0d\u8981\u548cNameNode\u3001SecondaryNameNode\u914d\u7f6e\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u3002  </p> <p>\u6309\u4ee5\u4e0a\u89c4\u5212\u4fee\u6539hadoop102\u4e0a\u7684$HADOOP_HOME/etc/hadoop\u8def\u5f84\u4e0b\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6 core-site.xml\u3001 hdfs-site.xml\u3001 yarn-site.xml\u3001 mapred-site.xml \u914d\u7f6e core-site.xml vim $HADOOP_HOME/etc/hadoop/core-site.xml Text Only<pre><code>&lt;configuration&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u5b9a NameNode \u7684\u5730\u5740 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;fs.defaultFS&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hdfs://hadoop102:8020&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u5b9a hadoop \u6570\u636e\u7684\u5b58\u50a8\u76ee\u5f55 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;/opt/module/hadoop-3.3.1/data&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u914d\u7f6e HDFS \u7f51\u9875\u767b\u5f55\u4f7f\u7528\u7684\u9759\u6001\u7528\u6237\u4e3a jmoon\uff0c\u4e0d\u914d\u7f6e\u65e0\u6cd5\u5728\u7f51\u9875\u7aef\u5220\u9664\u6587\u4ef6 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;jmoon&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>\u914d\u7f6e hdfs-site.xml vim $HADOOP_HOME/etc/hadoop/hdfs-site.xml Text Only<pre><code>&lt;configuration&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- nn web \u7aef\u8bbf\u95ee\u5730\u5740--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;dfs.namenode.http-address&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop102:9870&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- 2nn web \u7aef\u8bbf\u95ee\u5730\u5740--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop104:9868&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>\u914d\u7f6e yarn-site.xml vim $HADOOP_HOME/etc/hadoop/yarn-site.xml Text Only<pre><code>&lt;configuration&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u5b9a MR \u8d70 shuffle --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;mapreduce_shuffle&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u5b9a ResourceManager \u7684\u5730\u5740--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop103&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0 \u00a0 &lt;!-- \u73af\u5883\u53d8\u91cf\u7684\u7ee7\u627f\uff0c\u4e0d\u914d\u7f6e\u6ca1\u6cd5\u8fd0\u884cmapreduce\u7a0b\u5e8f\uff0c\u63d0\u793a\u627e\u4e0d\u5230\u7c7b--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>\u914d\u7f6e mapred-site.xml vim $HADOOP_HOME/etc/hadoop/mapred-site.xml Text Only<pre><code>&lt;configuration&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u6307\u5b9a MapReduce \u7a0b\u5e8f\u8fd0\u884c\u5728 Yarn \u4e0a --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;mapreduce.framework.name&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;yarn&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>\u914d\u7f6e workers vim $HADOOP_HOME/etc/hadoop/workers Text Only<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre></p> <p>\u5c06\u4fee\u6539\u597d\u7684\u914d\u7f6e\u6587\u4ef6\u4ecehadoop102\u5206\u53d1\u5230hadoop103\u3001hadoop104 xsync $HADOOP_HOME/etc/hadoop/</p> <p>\u7b2c\u4e00\u6b21\u542f\u52a8\u96c6\u7fa4\uff0c\u9700\u8981\u5728 hadoop102 \u8282\u70b9\u683c\u5f0f\u5316 NameNode hdfs namenode -format \u683c\u5f0f\u5316\u5b8c\u6bd5\u4e4b\u540e\uff0c\u4f1a\u5728Hadoop\u7684\u5b89\u88c5\u76ee\u5f55\u4e0b\u591a\u51fadata\u548clogs\u76ee\u5f55 \uff08\u6ce8\u610f\uff1a\u683c\u5f0f\u5316 NameNode\uff0c\u4f1a\u4ea7\u751f\u65b0\u7684\u96c6\u7fa4 id\uff0c\u5bfc\u81f4 NameNode \u548c DataNode \u7684\u96c6\u7fa4 id \u4e0d\u4e00\u81f4\uff0c\u96c6\u7fa4\u627e\u4e0d\u5230\u5df2\u5f80\u6570\u636e\u3002 \u5982\u679c\u96c6\u7fa4\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u62a5\u9519\uff0c\u9700\u8981\u91cd\u65b0\u683c\u5f0f\u5316 NameNode \u7684\u8bdd\uff0c \u4e00\u5b9a\u8981\u5148\u505c\u6b62 namenode \u548c datanode \u8fdb\u7a0b\uff0c \u5e76\u4e14\u8981\u5220\u9664\u6240\u6709\u673a\u5668\u7684 data \u548c logs \u76ee\u5f55\uff0c\u7136\u540e\u518d\u8fdb\u884c\u683c\u5f0f\u5316\u3002\uff09</p> <p>\u5728\u4efb\u4f55\u4e00\u53f0\u4e3b\u673a\u4e0a\u8f93\u5165 start-dfs.sh \u547d\u4ee4 \u5c31\u53ef\u4ee5\u7fa4\u542f\u52a8hdfs\uff0c\u7fa4\u8d77\u7684\u524d\u63d0\u662f\u9700\u8981\u914d\u7f6eworkers\u548c\u4e3b\u673a\u4e4b\u95f4\u7684\u514d\u5bc6\u767b\u5f55\uff08\u5f85\u9a8c\u8bc1\uff09\uff1a start-dfs.sh <code>\u67e5\u770bhdfs\uff1ahadoop102:9870</code> \u5355\u8282\u70b9\u542f\u52a8\u547d\u4ee4\uff1a hdfs --daemon start datanode hdfs --daemon start namenode</p> <p>\u5728hadoop103\u4e0a\u8f93\u5165 start-yarn.sh \u547d\u4ee4 \u53ef\u4ee5\u5728hadoop103\u4e0a\u542f\u52a8ResourceManager\uff0c\u5e76\u4e14\u7fa4\u8d77\u6240\u6709\u4e3b\u673a\u4e0a\u7684NodeManager\uff08\u5982\u679c\u5728\u5176\u5b83\u4e3b\u673a\u4e0a\u8f93\u5165start-yarn.sh \u547d\u4ee4\u53ea\u80fd\u7fa4\u8d77\u6240\u6709\u4e3b\u673a\u4e0a\u7684NodeManager\uff0c\u4e0d\u80fd\u542f\u52a8Hadoop103\u7684ResourceManager\uff0c\u8fd9\u4e0ehdfs\u7fa4\u8d77\u4e0d\u540c\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff09 start-yarn.sh <code>\u67e5\u770byarn\uff1ahadoop103:8088</code> \u5355\u8282\u70b9\u542f\u52a8\u547d\u4ee4\uff1a yarn --daemon start\u00a0resourcemanager yarn --daemon start\u00a0nodemanager</p> <p>\u4e0a\u4f20\u6587\u4ef6\u5230hdfs \u521b\u5efa\u76ee\u5f55\uff1ahadoop fs -mkdir /input \u4e0a\u4f20\uff1ahadoop fs -put ~/word.txt /input</p> <p>\u4e0b\u8f7d hadoop fs -get /input/word.txt ./</p> <p>\u6267\u884c wordcount \u7a0b\u5e8f\u6d4b\u8bd5yarn hadoop jar\u00a0$HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar\u00a0wordcount /input /output</p> <p>\u5220\u9664\u6587\u4ef6 hadoop fs -rm -r /output</p> <p>\u505c\u6b62\u96c6\u7fa4 stop-all.sh</p> <p>\u914d\u7f6e\u5386\u53f2\u670d\u52a1\u5668 vim $HADOOP_HOME/etc/hadoop/mapred-site.xml Text Only<pre><code>&lt;!-- \u5386\u53f2\u670d\u52a1\u5668\u7aef\u5730\u5740 --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop102:10020&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u5386\u53f2\u670d\u52a1\u5668 web \u7aef\u5730\u5740 --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop102:19888&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> \u5206\u53d1\u914d\u7f6e xsync\u00a0$HADOOP_HOME/etc/hadoop/mapred-site.xml</p> <p>\u56e0\u4e3a\u914d\u7f6e\u7684\u662f\u5728hadoop102\uff0c\u6240\u4ee5\u8981\u5728 hadoop102 \u542f\u52a8\u5386\u53f2\u670d\u52a1\u5668 mapred --daemon start historyserver</p> <p><code>\u67e5\u770bhistoryserver\uff1ahadoop102:19888/jobhistory</code></p> <p>\u5f00\u542f\u65e5\u5fd7\u805a\u96c6\u529f\u80fd vim $HADOOP_HOME/etc/hadoop/yarn-site.xml Text Only<pre><code>&lt;!-- \u5f00\u542f\u65e5\u5fd7\u805a\u96c6\u529f\u80fd --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;true&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u8bbe\u7f6e\u65e5\u5fd7\u805a\u96c6\u670d\u52a1\u5668\u5730\u5740 --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.log.server.url&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;http://hadoop102:19888/jobhistory/logs&lt;/value&gt;\n&lt;/property&gt;\n&lt;!-- \u8bbe\u7f6e\u65e5\u5fd7\u4fdd\u7559\u65f6\u95f4\u4e3a 7 \u5929 --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;604800&lt;/value&gt;\n&lt;/property&gt;\n</code></pre></p> <p>\u5206\u53d1\u914d\u7f6e xsync $HADOOP_HOME/etc/hadoop/yarn-site.xml</p> <p>\u5173\u95ed NodeManager \u3001 ResourceManager \u548c HistoryServer stop-yarn.sh mapred --daemon stop</p> <p>\u542f\u52a8 NodeManager \u3001 ResourceManage \u548c HistoryServer start-yarn.sh mapred --daemon start historyserver</p> <p>\u811a\u672c\u542f\u52a8\u548c\u505c\u6b62\u96c6\u7fa4 \u4e0exsync\u4e00\u6837\u653e\u5728/home/jmoon/bin\u4e0b vim cluster.sh Text Only<pre><code>#!/bin/bash\n\nif [ $# -lt 1 ]\nthen\n\u00a0\u00a0\u00a0\u00a0echo \"No Args Input...\"\n\u00a0\u00a0\u00a0\u00a0exit ;\nfi\n\ncase $1 in\n\"start\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" =================== \u542f\u52a8 hadoop\u96c6\u7fa4 ===================\"\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" --------------- \u542f\u52a8 hdfs ---------------\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh hadoop102 \"/opt/module/hadoop-3.3.1/sbin/start-dfs.sh\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" --------------- \u542f\u52a8 yarn ---------------\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh hadoop103 \"/opt/module/hadoop-3.3.1/sbin/start-yarn.sh\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" --------------- \u542f\u52a8 historyserver ---------------\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh hadoop102 \"/opt/module/hadoop-3.3.1/bin/mapred --daemon start historyserver\"\n;;\n\"stop\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" =================== \u5173\u95ed hadoop\u96c6\u7fa4 ===================\"\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" --------------- \u5173\u95ed historyserver ---------------\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh hadoop102 \"/opt/module/hadoop-3.3.1/bin/mapred --daemon stop historyserver\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" --------------- \u5173\u95ed yarn ---------------\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh hadoop103 \"/opt/module/hadoop-3.3.1/sbin/stop-yarn.sh\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo \" --------------- \u5173\u95ed hdfs ---------------\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh hadoop102 \"/opt/module/hadoop-3.3.1/sbin/stop-dfs.sh\"\n;;\n*)\n\u00a0\u00a0\u00a0\u00a0echo \"Input Args Error...\"\n;;\nesac\n</code></pre></p> <p>\u53ef\u6267\u884c\u6743\u9650\uff1achmod +x ~/bin/cluster.sh \u5206\u53d1\uff1axsync ~/bin/cluster.sh</p> <p>\u67e5\u770b\u6240\u6709\u4e3b\u673a\u7684jps vim ~/bin/jpsall Text Only<pre><code>#!/bin/bash\n\nfor host in hadoop102 hadoop103 hadoop104\ndo\n\u00a0\u00a0\u00a0\u00a0echo =============== $host ===============\n\u00a0\u00a0\u00a0\u00a0ssh $host jps\ndone\n</code></pre> chmod +x ~/bin/jpsall xsync ~/bin/jpsall</p> <p>\u9762\u8bd5\u9898\uff1a</p> <ol> <li>\u5e38\u7528\u7aef\u53e3\u53f7 hadoop3.x</li> </ol> <p>HDFS NameNode \u670d\u52a1\u7aef\u53e3\uff1a<code>8020</code>/9000/9820\u00a0web\u7aef\u53e3\uff1a<code>9870</code> \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Yarn\u00a0\u670d\u52a1\u7aef\u53e3\uff1a8032 web\u7aef\u53e3\uff1a<code>8088</code> \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u5386\u53f2\u670d\u52a1\u5668historyserver web\u7aef\u53e3\uff1a<code>19888</code></p> <ol> <li>\u5e38\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u00a0hadoop3.x</li> </ol> <p>core-site.xml\u00a0\u00a0hdfs-site.xml\u00a0\u00a0yarn-site.xml\u00a0\u00a0mapred-site.xml workers</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/20-Yarn%20%E8%B0%83%E5%BA%A6%E5%99%A8%E5%92%8C%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/","title":"20-Yarn \u8c03\u5ea6\u5668\u548c\u8c03\u5ea6\u7b97\u6cd5","text":"<p> \u7ea6 148 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 3 \u5206\u949f</p> <p>Hadoop \u4f5c\u4e1a\u8c03\u5ea6\u5668\u4e3b\u8981\u6709\u4e09\u79cd\uff1a FIFO\u3001 \u5bb9\u91cf\uff08Capacity Scheduler\uff09 \u548c\u516c\u5e73\uff08Fair\u00a0Scheduler\uff09 \u3002 Apache Hadoop3.1.3 \u9ed8\u8ba4\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\u662f Capacity Scheduler\u3002 CDH \u6846\u67b6\u9ed8\u8ba4\u8c03\u5ea6\u5668\u662f Fair Scheduler\u3002 \u8c03\u5ea6\u5668\u7684\u8c03\u5ea6\u7b97\u6cd5\u5728\u903b\u8f91\u4e0a\u662f\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\uff0c\u50cf\u8fd9\u6837\uff1a   \u9ed8\u8ba4\u53ea\u6709\u4e00\u4e2adefault\u961f\u5217\uff0c\u53ea\u6709\u6811\u7684\u53f6\u5b50\u8282\u70b9\u624d\u662f\u771f\u6b63\u53ef\u4ee5\u5bb9\u7eb3\u4f5c\u4e1a\u7684\u961f\u5217\uff0c\u8d44\u6e90\u5206\u914d\u7684\u6d41\u7a0b\u662f\uff0c\u5148\u7ed9\u961f\u5217\u5206\u914d\u8d44\u6e90\uff0c\u518d\u628a\u961f\u5217\u5206\u5f97\u7684\u8d44\u6e90\u5206\u7ed9\u4f5c\u4e1a\uff0c\u518d\u628a\u4f5c\u4e1a\u5206\u5f97\u7684\u8d44\u6e90\u5206\u7ed9\u5bb9\u5668\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/3-HDFS/","title":"3-HDFS","text":"<p> \u7ea6 2313 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 46 \u5206\u949f</p> <p>HDFS\uff08Hadoop Distributed File System\uff09\u662f\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e0eRedis\u90a3\u6837\u7684\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u4e0d\u540c\uff0cRedis\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u53ef\u4ee5\u4e00\u6761\u6570\u636e\u4e00\u6761\u6570\u636e\u7684\u589e\u5220\u6539\u67e5\uff0c\u6240\u4ee5Redis\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\u5982\u4f55\u5c06\u6570\u636e\u5747\u5300\u7684\u6563\u5217\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\uff0c\u4f46\u662fHDFS\u5219\u5b8c\u5168\u4e0d\u540c\uff0c\u5b83\u662f\u9488\u5bf9\u6587\u4ef6\u7684\u5b58\u50a8\uff0c\u5e76\u4e0d\u80fd\u5b9e\u65f6\u7684\u8fdb\u884c\u6539\u548c\u67e5\u3002\u5b83\u4eec\u4fe9\u9762\u5bf9\u7684\u95ee\u9898\u4e0d\u540c\uff0c\u5c31\u50cf\u6570\u636e\u5e93\u548c\u672c\u5730\u7535\u8111\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u4e00\u6837\uff0c\u4e5f\u786e\u5b9e\u662f\uff0c\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u672c\u6765\u548c\u6570\u636e\u5e93\u89e3\u51b3\u7684\u95ee\u9898\u4e0d\u540c\uff0c \u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u5347\u7ea7\u6210\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5c31\u6210\u4e86HDFS\uff0c\u5355\u673a\u6570\u636e\u5e93\u5347\u7ea7\u5c31\u6210\u4e86\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u3002 \u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u548cHDFS\u9488\u5bf9\u662f\u6587\u4ef6\uff0c\u6570\u636e\u5e93\u548c\u5206\u5e03\u5f0f\u6570\u636e\u5e93\u9488\u5bf9\u7684\u662f\u4e00\u6761\u4e00\u6761\u7684\u6570\u636e\u3002</p> <p>HDFS\u7684\u4f18\u70b9\uff1a</p> <ol> <li>\u9ad8\u5bb9\u9519\u6027</li> </ol> <p>\u2460 \u6570\u636e\u81ea\u52a8\u4fdd\u5b58\u591a\u4e2a\u526f\u672c \u2461 \u526f\u672c\u4e22\u5931\u4e4b\u540e\u81ea\u52a8\u6062\u590d\u5230\u6307\u5b9a\u7684\u6570\u91cf</p> <ol> <li>\u9002\u5408\u5904\u7406\u5927\u6570\u636e</li> </ol> <p>\u2460 \u6570\u636e\u91cf\u53ef\u8fbePB\u7ea7\u522b \u00a0\u00a0 \u00a0\u00a0 \u00a0 \u2461 \u6587\u4ef6\u6570\u91cf\u53ef\u8fbe\u767e\u4e07\u7ea7\u522b</p> <ol> <li>\u53ef\u6784\u5efa\u5728\u5ec9\u4ef7\u7684\u673a\u5668\u4e0a</li> </ol> <p>HDFS\u7684\u7f3a\u70b9\uff1a </p> <p>HDFS \u7ec4\u6210\u67b6\u6784  HDFS\u91c7\u7528\u4e3b\u4ece\uff08Master/Slave\uff09\u67b6\u6784\uff0c\u7531HDFSClient\u3001NameNode\u3001DataNode\u548cSecondaryNameNode\u56db\u90e8\u5206\u7ec4\u6210\u3002</p> <p>NameNode\uff08 nn\uff09\uff1a\u5373Master\uff0cnamenode\u7ba1\u7406\u7740\u6587\u4ef6\u7cfb\u7edf\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u7ef4\u62a4\u7740\u6574\u68f5\u6587\u4ef6\u7cfb\u7edf\u6811\uff0c\u8fd9\u4e9b\u4fe1\u606f\u79f0\u4e3a\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\uff0cnamenode\u5c06\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u56e0\u6b64\u6587\u4ef6\u7cfb\u7edf\u6240\u80fd\u5b58\u50a8\u7684\u6587\u4ef6\u603b\u6570\u53d7\u9650\u4e8enamenode\u7684\u5185\u5b58\u5bb9\u91cf\uff0c\u6bcf\u4e2a\u6587\u4ef6\u3001\u76ee\u5f55\u548c\u6570\u636e\u5757\u7684\u5b58\u50a8\u4fe1\u606f\u5927\u7ea6\u5360150\u4e2a\u5b57\u8282\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u5f53\u7136\u4e0d\u80fd\u4ec5\u4ec5\u53ea\u628a\u5143\u6570\u636e\u653e\u5728\u5185\u5b58\u4e2d\uff0cnamenode\u8fd8\u4f1a\u628a\u5143\u6570\u636e\u4fe1\u606f\u4ee5\u4e24\u4e2a\u6587\u4ef6\u7684\u5f62\u5f0f\u6c38\u4e45\u5730\u4fdd\u5b58\u672c\u5730\u78c1\u76d8\u4e0a\uff1a\u547d\u540d\u7a7a\u95f4\u955c\u50cf\u6587\u4ef6fsimage \u548c \u7f16\u8f91\u65e5\u5fd7\u6587\u4ef6edits\u3002namenode\u4e5f\u8bb0\u5f55\u7740\u6bcf\u4e2a\u6587\u4ef6\u5404\u4e2a\u5757\u6240\u5728\u7684\u6570\u636e\u8282\u70b9\u4fe1\u606f\uff0c\u4f46\u5b83\u5e76\u4e0d\u6c38\u4e45\u7684\u4fdd\u5b58\u5757\u7684\u4f4d\u7f6e\u4fe1\u606f\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4fe1\u606f\u7531datanode\u4fdd\u5b58\uff0c\u5728\u96c6\u7fa4\u542f\u52a8\u65f6\u4ee5\u53ca\u542f\u52a8\u540e\u7684\u6bcf60\u5206\u949f\uff0cdatanode\u4f1a\u50cfnamenode\u6c47\u62a5\u8fd9\u4e9b\u4fe1\u606f\u3002namenode\u8fd8\u6709\u4e00\u4e2a\u804c\u8d23\u5c31\u662f\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bfb\u5199\u8bf7\u6c42\u3002</p> <p>DataNode\uff1a\u5373Slave\uff0cdatanode\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u5de5\u4f5c\u8282\u70b9\uff0c \u6267\u884c\u6570\u636e\u5757\u7684\u8bfb/\u5199\u64cd\u4f5c\u3002datanode\u6839\u636e\u9700\u8981\u5b58\u50a8\u5e76\u68c0\u7d22\u6570\u636e\u5757\uff08\u53d7\u5ba2\u6237\u7aef\u6216namenode\u8c03\u5ea6\uff09\uff0c\u5e76\u5b9a\u671f\u5411namenode\u53d1\u9001\u6240\u5b58\u50a8\u7684\u5757\u7684\u5217\u8868\u3002</p> <p>Client\uff1a\u5c31\u662f\u5ba2\u6237\u7aef\uff0c\u8d1f\u8d23\uff1a</p> <ol> <li>\u6587\u4ef6\u5207\u5206\uff0c\u6587\u4ef6\u4e0a\u4f20HDFS\u7684\u65f6\u5019\uff0cClient\u5c06\u6587\u4ef6\u5207\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684Block\uff0c\u7136\u540e\u8fdb\u884c\u4e0a\u4f20</li> <li>\u4e0eNameNode\u4ea4\u4e92\uff0c \u83b7\u53d6\u6587\u4ef6\u7684\u4f4d\u7f6e\u4fe1\u606f</li> <li>\u4e0eDataNode\u4ea4\u4e92\uff0c \u8bfb\u53d6\u6216\u8005\u5199\u5165\u6570\u636e</li> </ol> <p>SecondaryNameNode\uff082NN\uff09\uff1a \u8f85\u52a9NameNode\uff0c \u5206\u62c5\u5176\u5de5\u4f5c\u91cf\uff0c\u5373\u5b9a\u671f\u5408\u5e76Fsimage\u548cEdits\uff0c \u5e76\u63a8\u9001\u7ed9NameNode \u3002SecondaryNameNode\u5e76\u975eNameNode\u7684\u70ed\u5907\uff0c\u5f53NameNode\u6302\u6389\u7684\u65f6\u5019\uff0c\u5b83\u5e76\u4e0d\u80fd\u9a6c\u4e0a\u66ff\u6362NameNode\u5e76\u63d0\u4f9b\u670d\u52a1\uff0c\u4e0d\u8fc7\u5728\u7d27\u6025\u60c5\u51b5\u4e0b\uff0c \u53ef\u8f85\u52a9\u6062\u590dNameNode\u3002</p> <p>HDFS \u6587\u4ef6\u5757\u5927\u5c0f\u5728Hadoop2.x/3.x\u7248\u672c\u4e2d\u9ed8\u8ba4\u662f128M\uff0c\u4e3a\u4ec0\u4e48\u5757\u7684\u5927\u5c0f\u4e0d\u80fd\u8bbe\u7f6e\u592a\u5c0f\uff0c\u4e5f\u4e0d\u80fd\u8bbe\u7f6e\u592a\u5927\uff1f \u56e0\u4e3aHDFS\u7684\u5757\u8bbe\u7f6e\u592a\u5c0f\uff0c \u4f1a\u589e\u52a0\u5bfb\u5740\u65f6\u95f4\uff1b\u7531\u4e8eMapReduce\u4efb\u52a1\u7684\u5207\u7247\u5927\u5c0f\u9ed8\u8ba4\u7b49\u4e8e\u5757\u5927\u5c0f\uff0c\u6240\u4ee5\u4e00\u4e2amap\u4efb\u52a1\u901a\u5e38\u53ea\u5904\u7406\u4e00\u4e2a\u5757\u4e2d\u7684\u6570\u636e\uff0c\u5982\u679c\u5757\u8bbe\u7f6e\u592a\u5927\uff0c\u4f1a\u5bfc\u81f4map\u4efb\u52a1\u6570\u592a\u5c11\uff0c\u4f5c\u4e1a\u8fd0\u884c\u6548\u7387\u5c31\u53d8\u4f4e\u4e86\u3002</p> <p>HDFS \u7684 Shell \u64cd\u4f5c \u57fa\u672c\u8bed\u6cd5\uff1a hadoop fs \u5177\u4f53\u547d\u4ee4 \u6216\u8005 hdfs dfs \u5177\u4f53\u547d\u4ee4</p> <p>\u4e0a\u4f20\uff1a</p> <ol> <li>-moveFromLocal\uff1a\u4ece\u672c\u5730\u526a\u5207\u7c98\u8d34\u5230 HDFS</li> </ol> Text Only<pre><code>hadoop fs -moveFromLocal ./shuguo.txt /sanguo\n</code></pre> <ol> <li>-copyFromLocal\uff1a\u4ece\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e2d\u62f7\u8d1d\u6587\u4ef6\u5230 HDFS \u8def\u5f84\u53bb</li> </ol> <p>Text Only<pre><code>hadoop fs -copyFromLocal weiguo.txt /sanguo\n</code></pre> \u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u7b49\u540c\u4e8e -put Text Only<pre><code>hadoop fs -put ./wuguo.txt /sanguo\n</code></pre></p> <ol> <li>-appendToFile\uff1a\u8ffd\u52a0\u4e00\u4e2a\u6587\u4ef6\u5230\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u672b\u5c3e</li> </ol> Text Only<pre><code>hadoop fs -appendToFile liubei.txt /sanguo/shuguo.txt\n</code></pre> <p>\u4e0b\u8f7d\uff1a \u00a0\u00a0 \u00a0\u00a0-copyToLocal\uff1a\u4ece HDFS \u62f7\u8d1d\u5230\u672c\u5730 Text Only<pre><code>\u00a0\u00a0hadoop fs -copyToLocal /sanguo/shuguo.txt ./\n</code></pre> \u00a0\u00a0 \u00a0\u00a0\u7b49\u540c\u4e8e-get\uff1a Text Only<pre><code>hadoop fs -get /sanguo/shuguo.txt ./shuguo2.txt\n</code></pre></p> <p>\u5176\u5b83\uff1a</p> <ol> <li>-mkdir \u521b\u5efa\u6587\u4ef6\u5939\uff1a hadoop fs -mkdir /sanguo</li> <li>-ls \u663e\u793a\u76ee\u5f55\u4fe1\u606f\uff1a hadoop fs -ls /sanguo</li> <li>-cat \u663e\u793a\u6587\u4ef6\u5185\u5bb9\uff1a hadoop fs -cat /sanguo/shuguo.txt</li> <li>-chgrp\u3001 -chmod\u3001 -chown\uff1a Linux \u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u7528\u6cd5\u4e00\u6837\uff0c\u4fee\u6539\u6587\u4ef6\u6240\u5c5e\u6743\u9650</li> </ol> <p>hadoop fs\u00a0-chmod 666 \u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0hadoop fs -chown jmoon:jmoon /sanguo/shuguo.txt</p> <ol> <li>-cp \u4ece HDFS \u7684\u4e00\u4e2a\u8def\u5f84\u62f7\u8d1d\u5230 HDFS \u7684\u53e6\u4e00\u4e2a\u8def\u5f84\uff1ahadoop fs -cp /sanguo/shuguo.txt /jinguo</li> <li>-mv \u5728 HDFS \u76ee\u5f55\u4e2d\u79fb\u52a8\u6587\u4ef6\uff1a hadoop fs -mv /sanguo/wuguo.txt /jinguo</li> <li>-tail \u663e\u793a\u4e00\u4e2a\u6587\u4ef6\u7684\u672b\u5c3e 1kb \u7684\u6570\u636e\uff1a hadoop fs -tail /jinguo/shuguo.txt</li> <li>-rm \u5220\u9664\u6587\u4ef6\u6216\u6587\u4ef6\u5939\uff1a hadoop fs -rm /sanguo/shuguo.txt</li> <li>-rm -r \u9012\u5f52\u5220\u9664\u76ee\u5f55\u53ca\u76ee\u5f55\u91cc\u9762\u5185\u5bb9\uff1a hadoop fs -rm -r /sanguo</li> <li>-du \u7edf\u8ba1\u6587\u4ef6\u5939\u7684\u5927\u5c0f\u4fe1\u606f\uff1a hadoop fs -du -s -h /jinguo</li> </ol> <p>\u7ed3\u679c\uff1a27 81 /jinguo\u00a0 27 \u8868\u793a\u6587\u4ef6\u5927\u5c0f\uff1b 81 \u8868\u793a 27*3 \u4e2a\u526f\u672c\uff1b /jinguo \u8868\u793a\u67e5\u770b\u7684\u76ee\u5f55</p> <ol> <li>-setrep \u8bbe\u7f6e HDFS \u4e2d\u6587\u4ef6\u7684\u526f\u672c\u6570\u91cf\uff1a hadoop fs -setrep 10 /jinguo/shuguo.txt</li> </ol> <p>HDFS \u5199\u6570\u636e\u6d41\u7a0b  \uff081\uff09\u5ba2\u6237\u7aef\u901a\u8fc7Distributed FileSystem\u6a21\u5757\u5411NameNode\u8bf7\u6c42\u4e0a\u4f20\u6587\u4ef6\u3002 \uff082\uff09NameNode\u68c0\u67e5\u76ee\u6807\u6587\u4ef6\u662f\u5426\u5df2\u5b58\u5728\uff0c\u7236\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0cNameNode\u8fd4\u56de\u662f\u5426\u53ef\u4ee5\u4e0a\u4f20\u3002 \uff083\uff09\u5ba2\u6237\u7aef\u8bf7\u6c42\u7b2c\u4e00\u4e2a Block\u4e0a\u4f20\u5230\u54ea\u51e0\u4e2aDataNode\u670d\u52a1\u5668\u4e0a\u3002 \uff084\uff09NameNode\u8fd4\u56de3\u4e2aDataNode\u8282\u70b9\uff0c\u5206\u522b\u4e3adn1\u3001dn2\u3001dn3\u3002 \uff085\uff09\u5ba2\u6237\u7aef\u901a\u8fc7FSDataOutputStream\u6a21\u5757\u8bf7\u6c42dn1\u4e0a\u4f20\u6570\u636e\uff0cdn1\u6536\u5230\u8bf7\u6c42\u4f1a\u7ee7\u7eed\u8c03\u7528dn2\uff0c\u7136\u540edn2\u8c03\u7528dn3\uff0c\u5c06\u8fd9\u4e2a\u901a\u4fe1\u7ba1\u9053\u5efa\u7acb\u5b8c\u6210\u3002 \uff086\uff09dn1\u3001dn2\u3001dn3\u9010\u7ea7\u5e94\u7b54\u5ba2\u6237\u7aef\u3002 \uff087\uff09\u5ba2\u6237\u7aef\u5f00\u59cb\u5f80dn1\u4e0a\u4f20\u7b2c\u4e00\u4e2aBlock\uff08\u5148\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u653e\u5230\u4e00\u4e2a\u672c\u5730\u5185\u5b58\u7f13\u5b58\uff09\uff0c\u4ee5Packet\u4e3a\u5355\u4f4d\uff0cdn1\u6536\u5230\u4e00\u4e2aPacket\u5c31\u4f1a\u4f20\u7ed9dn2\uff0cdn2\u4f20\u7ed9dn3\uff1bdn1\u6bcf\u4f20\u4e00\u4e2apacket\u4f1a\u653e\u5165\u4e00\u4e2a\u5e94\u7b54\u961f\u5217\u7b49\u5f85\u5e94\u7b54\u3002 \uff088\uff09\u5f53\u4e00\u4e2aBlock\u4f20\u8f93\u5b8c\u6210\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6b21\u8bf7\u6c42NameNode\u4e0a\u4f20\u7b2c\u4e8c\u4e2aBlock\u7684\u670d\u52a1\u5668\u3002\uff08\u91cd\u590d\u6267\u884c3-7\u6b65\uff09\u3002</p> <p>HDFS \u8bfb\u6570\u636e\u6d41\u7a0b  \uff081\uff09\u5ba2\u6237\u7aef\u901a\u8fc7DistributedFileSystem\u5411NameNode\u8bf7\u6c42\u4e0b\u8f7d\u6587\u4ef6\uff0cNameNode\u901a\u8fc7\u67e5\u8be2\u5143\u6570\u636e\uff0c\u627e\u5230\u6587\u4ef6\u5757\u6240\u5728\u7684DataNode\u5730\u5740\u3002 \uff082\uff09\u6311\u9009\u4e00\u53f0DataNode\uff08\u5c31\u8fd1\u539f\u5219\uff0c\u7136\u540e\u968f\u673a\uff09\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u8bfb\u53d6\u6570\u636e\u3002 \uff083\uff09DataNode\u5f00\u59cb\u4f20\u8f93\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\uff08\u4ece\u78c1\u76d8\u91cc\u9762\u8bfb\u53d6\u6570\u636e\u8f93\u5165\u6d41\uff0c\u4ee5Packet\u4e3a\u5355\u4f4d\u6765\u505a\u6821\u9a8c\uff09\u3002 \uff084\uff09\u5ba2\u6237\u7aef\u4ee5Packet\u4e3a\u5355\u4f4d\u63a5\u6536\uff0c\u5148\u5728\u672c\u5730\u7f13\u5b58\uff0c\u7136\u540e\u5199\u5165\u76ee\u6807\u6587\u4ef6\u3002</p> <p>NN \u548c 2NN \u5de5\u4f5c\u673a\u5236 NameNode\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u7740\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bcf\u6b21\u63a5\u6536\u589e\u5220\u7684\u8bf7\u6c42\u4f1a\u76f4\u63a5\u4fee\u6539\u5185\u5b58\u4e2d\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u4f46\u4e0d\u53ef\u80fd\u5728\u6bcf\u6b21\u4fee\u6539\u8fc7\u540e\u90fd\u5c06\u5143\u6570\u636e\u4fe1\u606f\u76f4\u63a5\u4fdd\u5b58\u5230\u672c\u5730\u78c1\u76d8\u4e0a\uff0c\u56e0\u4e3a\u8fd9\u6837\u9020\u6210\u7684\u78c1\u76d8IO\u4ee3\u4ef7\u592a\u5927\u4e86\uff0c\u4f46\u662f\u53c8\u5fc5\u987b\u628a\u4fee\u6539\u540e\u7684\u4fe1\u606f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\uff0c\u600e\u4e48\u529e\u5462\uff0cNameNode\u91c7\u53d6\u7684\u505a\u6cd5\u662f\u8ffd\u52a0\u5199\u7684\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u5c06\u4fee\u6539\u64cd\u4f5c\u8ffd\u52a0\u5199\u5230\u78c1\u76d8\u4e2d\uff0c\u4f46\u8fd9\u6837\u53c8\u4f1a\u5e26\u6765\u4e00\u4e2a\u95ee\u9898\uff0c\u4e00\u76f4\u8ffd\u52a0\u5199\u4f1a\u5bfc\u81f4\u78c1\u76d8\u4e0a\u7684\u8fd9\u4e2a\u6587\u4ef6\u53d8\u5f97\u7279\u522b\u5927\uff0c\u5982\u679c\u4e0b\u6b21\u91cd\u542fNameNode\u5c06\u4f1a\u82b1\u8d39\u5927\u91cf\u65f6\u95f4\u6765\u5408\u5e76\u539f\u59cb\u5143\u6570\u636e\u6587\u4ef6\u548c\u8ffd\u52a0\u5199\u6587\u4ef6\uff0c\u5982\u679cNameNode\u91c7\u7528\u9694\u4e00\u6bb5\u65f6\u95f4\u5c31\u5408\u5e76\u4e00\u6b21\u53c8\u4f1a\u9020\u6210NameNode\u8282\u70b9\u8d1f\u62c5\u592a\u91cd\uff0c\u4e8e\u662f\u8fd9\u65f6\u5c31\u5f15\u51faSecondaryNameNode\u4e86\uff0c\u6bcf\u5f53NN\u8ffd\u52a0\u5199\u65f6\u5c06\u4fee\u6539\u64cd\u4f5c\u4fdd\u5b58\u5230edits_inprogress\u6587\u4ef6\u4e2d\uff0c\u5f53edits_inprogress\u8fbe\u52301kb\u505c\u6b62\u5f80\u8fd9\u4e2a\u6587\u4ef6\u4e0a\u5199\uff0c\u628a\u8fd9\u4e2aedits_inprogress\u66f4\u540d\u4e3aedits\uff0c\u7136\u540e\u518d\u5f00\u542f\u53e6\u5916\u4e00\u4e2aedits_inprogress\u7ee7\u7eed\u8ffd\u52a0\u5199\uff0c2NN\u8d1f\u8d23\u62c9\u53d6NN\u4e0a\u7684edits\u4e0e\u81ea\u5df1\u4e4b\u524d\u7684fsimage\u5408\u5e76\uff0c\u5408\u5e76\u5b8c\u4e4b\u540e\u518d\u628afsimage\u4f20\u9001\u7ed9NN\u3002</p> <p>\u5177\u4f53\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u7b2c\u4e00\u9636\u6bb5\uff1aNameNode\u542f\u52a8 \uff081\uff09\u7b2c\u4e00\u6b21\u542f\u52a8NameNode\u683c\u5f0f\u5316\u540e\uff0c\u521b\u5efaFsimage\u548cEdits\u6587\u4ef6\u3002\u5982\u679c\u4e0d\u662f\u7b2c\u4e00\u6b21\u542f\u52a8\uff0c\u76f4\u63a5\u52a0\u8f7d\u7f16\u8f91\u65e5\u5fd7\u548c\u955c\u50cf\u6587\u4ef6\u5230\u5185\u5b58\u3002 \uff082\uff09\u5ba2\u6237\u7aef\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u7684\u8bf7\u6c42\u3002 \uff083\uff09NameNode\u8bb0\u5f55\u64cd\u4f5c\u65e5\u5fd7\uff0c\u66f4\u65b0\u6eda\u52a8\u65e5\u5fd7\u3002 \uff084\uff09NameNode\u5728\u5185\u5b58\u4e2d\u5bf9\u5143\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff1aSecondary NameNode\u5de5\u4f5c \uff081\uff09Secondary NameNode\u8be2\u95eeNameNode\u662f\u5426\u9700\u8981CheckPoint\u3002\u76f4\u63a5\u5e26\u56deNameNode\u662f\u5426\u68c0\u67e5\u7ed3\u679c\u3002 \uff082\uff09Secondary NameNode\u8bf7\u6c42\u6267\u884cCheckPoint\u3002 \uff083\uff09NameNode\u6eda\u52a8\u6b63\u5728\u5199\u7684Edits\u65e5\u5fd7\u3002 \uff084\uff09\u5c06\u6eda\u52a8\u524d\u7684\u7f16\u8f91\u65e5\u5fd7\u548c\u955c\u50cf\u6587\u4ef6\u62f7\u8d1d\u5230Secondary NameNode\u3002 \uff085\uff09Secondary NameNode\u52a0\u8f7d\u7f16\u8f91\u65e5\u5fd7\u548c\u955c\u50cf\u6587\u4ef6\u5230\u5185\u5b58\uff0c\u5e76\u5408\u5e76\u3002 \uff086\uff09\u751f\u6210\u65b0\u7684\u955c\u50cf\u6587\u4ef6fsimage.chkpoint\u3002 \uff087\uff09\u62f7\u8d1dfsimage.chkpoint\u5230NameNode\u3002 \uff088\uff09NameNode\u5c06fsimage.chkpoint\u91cd\u65b0\u547d\u540d\u6210fsimage\u3002</p> <p>DataNode\u5de5\u4f5c\u673a\u5236  \uff081\uff09\u4e00\u4e2a\u6570\u636e\u5757\u5728DataNode\u4e0a\u4ee5\u6587\u4ef6\u5f62\u5f0f\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\uff0c\u5305\u62ec\u4e24\u4e2a\u6587\u4ef6\uff0c\u4e00\u4e2a\u662f\u6570\u636e\u672c\u8eab\uff0c\u4e00\u4e2a\u662f\u5143\u6570\u636e\u5305\u62ec\u6570\u636e\u5757\u7684\u957f\u5ea6\uff0c\u5757\u6570\u636e\u7684\u6821\u9a8c\u548c\uff0c\u4ee5\u53ca\u65f6\u95f4\u6233\u3002 \uff082\uff09DataNode\u542f\u52a8\u540e\u5411NameNode\u6ce8\u518c\uff0c\u901a\u8fc7\u540e\uff0c\u5468\u671f\u6027\uff086\u5c0f\u65f6\uff09\u7684\u5411NameNode\u4e0a\u62a5\u6240\u6709\u7684\u5757\u4fe1\u606f\u3002 \uff083\uff09\u5fc3\u8df3\u662f\u6bcf3\u79d2\u4e00\u6b21\uff0c\u5fc3\u8df3\u8fd4\u56de\u7ed3\u679c\u5e26\u6709NameNode\u7ed9\u8be5DataNode\u7684\u547d\u4ee4\u5982\u590d\u5236\u5757\u6570\u636e\u5230\u53e6\u4e00\u53f0\u673a\u5668\uff0c\u6216\u5220\u9664\u67d0\u4e2a\u6570\u636e\u5757\u3002\u5982\u679c\u8d85\u8fc710\u5206\u949f\u6ca1\u6709\u6536\u5230\u67d0\u4e2aDataNode\u7684\u5fc3\u8df3\uff0c\u5219\u8ba4\u4e3a\u8be5\u8282\u70b9\u4e0d\u53ef\u7528\u3002 \uff084\uff09\u96c6\u7fa4\u8fd0\u884c\u4e2d\u53ef\u4ee5\u5b89\u5168\u52a0\u5165\u548c\u9000\u51fa\u4e00\u4e9b\u673a\u5668\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/4-MapReduce%E4%B9%8BWordCount/","title":"4-MapReduce\u4e4bWordCount","text":"<p> \u7ea6 1353 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 27 \u5206\u949f</p> <p>\u5b98\u65b9WordCount\u6848\u4f8b\u4f4d\u7f6e\uff1a/opt/module/hadoop-3.3.1/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar</p> <p>\u4ee5\u672c\u5730WordCount\u4e3a\u4f8b\u89e3\u91caMapReduce\u6846\u67b6\uff0c\u8fd9\u91cc\u4e0d\u6d89\u53ca\u4e0ehdfs\u4e0eyarn\u7684\u4ea4\u4e92\uff1a</p> <p>1.Windows\u73af\u5883\u4e0b\u4f7f\u7528MapReduce\u6846\u67b6\u9996\u5148\u8981\u914d\u7f6e\u597dwinutils\u4f9d\u8d56 \u4e0b\u8f7d\u5730\u5740\uff1ahttps://gitee.com/shockingblue/winutils \uff0c\u4e0b\u8f7d\u4e00\u4e2a\u4e0e\u81ea\u5df1\u5b89\u88c5\u7684Hadoop\u7248\u672c\u76f8\u8fd1\u7684 \u4e0b\u8f7d\u4e4b\u540e\u50cf\u4e0b\u9762\u8fd9\u6837\u7ec4\u7ec7\u597d\u76ee\u5f55\u7ed3\u6784  \u63a5\u7740\u914d\u7f6e\u73af\u5883\u53d8\u91cf HADOOP_HOME \u548c PATH  </p> <p>2.\u4ee3\u7801</p> <p>\u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.3.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>MapReduce \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u8fd0\u7b97\u7a0b\u5e8f\u7684\u7f16\u7a0b\u6846\u67b6\uff0c\u65e2\u7136\u662f\u6846\u67b6\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u6211\u4eec\u53ea\u9700\u8981\u7ee7\u627f\u67d0\u4e9b\u7c7b\uff0c\u7136\u540e\u7528\u4e1a\u52a1\u903b\u8f91\u91cd\u5199\u5176\u4e2d\u7684\u65b9\u6cd5\uff0c\u5373\u53ef\u5b8c\u6210\u5206\u5e03\u5f0f\u8fd0\u7b97\uff0c\u8fd9\u4e5f\u5c31\u662f\u6846\u67b6\u4e4b\u6240\u4ee5\u53eb\u6846\u67b6\u7684\u539f\u56e0\uff0c\u6700\u5927\u9650\u5ea6\u7684\u7b80\u5316\u7f16\u7a0b\uff0c\u8ba9\u7a0b\u5e8f\u5458\u53ea\u9700\u8981\u5173\u6ce8\u4e1a\u52a1\u903b\u8f91\u5373\u53ef\uff0c\u5176\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f\u5c31\u662f\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u3002</p> <p>Map\u9636\u6bb5\uff1a WordCountMapper\u9700\u8981\u7ee7\u627fMapper\uff0c\u7136\u540e\u91cd\u5199map()\u65b9\u6cd5\u3002</p> <p>\u5728Mapper\u7c7b\u4e2d\uff0c\u6a21\u677f\u65b9\u6cd5\u662frun()\u65b9\u6cd5 Text Only<pre><code>public void run(Context context) throws IOException, InterruptedException {\n\u00a0\u00a0setup(context);\n\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0while (context.nextKeyValue()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`map(context.getCurrentKey(), context.getCurrentValue(), context);`\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0cleanup(context);\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5728\u6267\u884crun\u65b9\u6cd5\u4e4b\u524d\uff0c\u6846\u67b6\u5df2\u7ecf\u5c06\u6211\u4eec\u6307\u5b9a\u7684\u6587\u4ef6\u4ee5\u884c\u4e3a\u5355\u4f4d\u5206\u5272\u6210k-v\u952e\u503c\u5bf9\u4f5c\u4e3a\u8f93\u5165\uff0c\u5176\u4e2dk\u662f\u884c\u7684\u8d77\u59cb\u504f\u79fb\u91cf\uff0cv\u662f\u8be5\u884c\u7684\u5185\u5bb9\uff0cMapper\u7684\u524d\u4e24\u4e2a\u6cdb\u578b\u53c2\u6570\u5c31\u662fk\u548cv\u7684\u7c7b\u578b\uff0c\u7136\u540ek-v\u8fd9\u4e24\u4e2a\u503c\u4f1a\u4f20\u9012\u7ed9map()\u65b9\u6cd5\uff0cmap()\u65b9\u6cd5\u518d\u4f9d\u636e\u4e1a\u52a1\u7684\u903b\u8f91\u6765\u5904\u7406\u8fd9\u4e00\u884c\u7684\u6570\u636e\u3002\u4ece\u4e0a\u9762\u7684while\u5faa\u73af\u4e5f\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u70b9\uff0c\u5148\u4ececontenxt\u5bf9\u8c61\u4e2d\u8bfb\u7684\u4e00\u884c\u6570\u636e\uff0c\u518d\u8c03\u7528map()\u65b9\u6cd5\u5904\u7406\u8fd9\u4e00\u884c\u6570\u636e\uff0c\u4e5f\u5c31\u662f<code>\u6bcf\u4e00\u884c\u90fd\u4f1a\u8c03\u7528map()\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u6709\u591a\u5c11\u884c\u5c31\u4f1a\u8c03\u7528\u591a\u5c11\u6b21map()\u65b9\u6cd5</code>\u3002\u8fd9\u4e2acontext\u5bf9\u8c61\u53ef\u4ee5\u770b\u6210\u6574\u4e2aMapReduce\u6846\u67b6\u7684\u4e0a\u4e0b\u6587\uff0c\u9760\u5b83\u6765\u4e32\u8054\u8d77\u6574\u4e2aMapReduce\u7684\u6d41\u7a0b\u3002</p> <p>WordCount\u5355\u8bcd\u7edf\u8ba1\u7684Map\u9636\u6bb5\u7684\u903b\u8f91\u662f\u628a\u6bcf\u4e00\u884c\u6570\u636e\u5206\u5272\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u5355\u8bcd\uff0c\u7136\u540e\u4ee4\u6bcf\u4e2a\u5355\u8bcd\u7684\u8ba1\u6570\u4e3a1\uff0c\u5355\u8bcd\u5c31\u662fkey\uff0c\u8ba1\u6570\u5c31\u662fvalue\uff0c\u8fd9\u5c31\u662fmapper\u7684\u8f93\u51fa\u2014\u2014k-v\u952e\u503c\u5bf9\uff0c\u8f93\u51fa\u65f6\u9700\u8981\u8c03\u7528context.write()\u3002</p> <p>WordCountMapper Text Only<pre><code>public class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0private Text outK = new Text();\n\u00a0\u00a0\u00a0\u00a0private IntWritable outV = new IntWritable(1);\n\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0 \u00a0 \u00a0 \u00a0 // 2 \u5207\u5272\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] words = line.split(\" \");\n\u00a0 \u00a0 \u00a0 \u00a0 // 3 \u5faa\u73af\u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (String word : words) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5outk\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.set(word);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(outK, outV);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u7136\u540e\u5c31\u662fReduce\u9636\u6bb5\uff1a WordCountReducer\u9700\u8981\u7ee7\u627fReducer\u7c7b\uff0c\u7136\u540e\u91cd\u5199Reduce()\u65b9\u6cd5</p> <p>Reducer\u7c7b\u4e0eMapper\u7c7b\u7684\u7ed3\u6784\u4e00\u6837\uff0c\u6a21\u677f\u65b9\u6cd5\u4e5f\u662frun()\u65b9\u6cd5 Text Only<pre><code>public void run(Context context) throws IOException, InterruptedException {\n\u00a0\u00a0setup(context);\n\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0while (context.nextKey()) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`reduce(context.getCurrentKey(), context.getValues(), context);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// If a back up store is used, reset it\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Iterator&lt;VALUEIN&gt; iter = context.getValues().iterator();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(iter instanceof ReduceContext.ValueIterator) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0((ReduceContext.ValueIterator&lt;VALUEIN&gt;)iter).resetBackupStore();\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0} finally {\n\u00a0\u00a0\u00a0\u00a0cleanup(context);\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5728\u6267\u884crun()\u65b9\u6cd5\u4e4b\u524d\uff0c\u6846\u67b6\u4f1a\u5bf9Map\u9636\u6bb5\u7684\u8f93\u51fa\u7ed3\u679c\u8fdb\u884c\u6574\u7406\uff0c\u8fd9\u70b9\u548cMap\u9636\u6bb5\u6267\u884crun()\u65b9\u6cd5\u4e4b\u524d\u6846\u67b6\u4f1a\u5148\u5c06\u6587\u4ef6\u5185\u5bb9\u4ee5\u884c\u4e3a\u5355\u4f4d\u5206\u5272\u6210k-v\u952e\u503c\u5bf9\u4f5c\u4e3a\u8f93\u5165\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u6574\u7406\u7684\u7ed3\u679c\u4e5f\u662fk-v\u952e\u503c\u5bf9\uff0c\u4e0d\u8fc7key\u662f\u5355\u8bcd\uff0cvalue\u662f\u76f8\u540c\u5355\u8bcd\u7684\u8ba1\u6570\u7684\u96c6\u5408\uff0c\u6bd4\u5982\uff0cMap\u9636\u6bb5\u7684\u8f93\u51fa\u662f(a,1)(b,1)(a,1)\uff0c\u90a3\u4e48\u6574\u7406\u7684\u7ed3\u679c\u662f(a,1)(a,1)(b,1)\uff0c\u6574\u7406\u7684\u7ed3\u679c\u4f1a\u6392\u5e8f\uff0c\u8fd9\u4e2a\u6574\u7406\u7684\u8fc7\u7a0b\u88ab\u79f0\u4e3ashuffle\u3002\u4e0a\u9762run()\u65b9\u6cd5\u7684while\u5faa\u73af\u4ececontext\u5bf9\u8c61\u4e2d\u8bfb\u51fa\u6765\u5c31\u662f\u8fd9\u4e2a\u6574\u7406\u7ed3\u679c\uff0c<code>\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u7684\u5355\u8bcd\u5c31\u4f1a\u8c03\u7528\u591a\u5c11\u6b21reduce()\u65b9\u6cd5</code>\u3002</p> <p>WordCount\u5355\u8bcd\u7edf\u8ba1\u7684Reduce\u9636\u6bb5\u7684\u903b\u8f91\u662f\u5c31\u662f\u628a\u5355\u8bcd\u8ba1\u6570\u7684\u96c6\u5408\u7d2f\u52a0\u8d77\u6765\uff0c\u7136\u540e\u628a\u5355\u8bcd\u4f5c\u4e3akey\uff0c\u7d2f\u52a0\u548c\u4f5c\u4e3avalue\uff0c\u4ee5k-v\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u8f93\u51fa\u3002\u8f93\u51fa\u65f6\u540c\u6837\u9700\u8981\u8c03\u7528context.write()\u3002</p> <p>WordCountReducer Text Only<pre><code>public class WordCountReducer extends Reducer&lt;Text, IntWritable,Text,IntWritable&gt; {\n\u00a0\u00a0\u00a0\u00a0private IntWritable outV = new IntWritable();\n\n\u00a0 \u00a0 @Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException {\n\u00a0 \u00a0 \u00a0 \u00a0 int sum = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//(a,1)(a,1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u7d2f\u52a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (IntWritable value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum += value.get();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.set(sum);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(key,outV);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u6700\u540e\u662fDriver\u7c7b\uff0c\u8bbe\u7f6e\u4e00\u4e9b\u5fc5\u8981\u7684\u4fe1\u606f</p> <p>WordCountDriver Text Only<pre><code>public class WordCountDriver{\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n\u00a0 \u00a0 \u00a0 \u00a0 // 1 \u83b7\u53d6job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6ejar\u5305\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(WordCountDriver.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper\u548creducer\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(WordCountMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(WordCountReducer.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6emap\u8f93\u51fa\u7684kv\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(IntWritable.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51fa\u7684kV\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(IntWritable.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u7c7b\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(classPath);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 6 \u8bbe\u7f6e\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(classPath + \"/input/word.txt\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output\"));\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean result = job.waitForCompletion(true);\n\n\u00a0 \u00a0 \u00a0 \u00a0 System.exit(result ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5728Hadoop\u96c6\u7fa4\u4e0a\u8fd0\u884c\u8fd9\u4e2aWordCount\u7a0b\u5e8f 1.\u4fee\u6539WordCountDriver Text Only<pre><code>public class WordCountDriver{\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6ejar\u5305\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(WordCountDriver.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper\u548creducer\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(WordCountMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(WordCountReducer.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6emap\u8f93\u51fa\u7684kv\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(IntWritable.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51fa\u7684kV\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(IntWritable.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// 6 \u8bbe\u7f6e\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84`\n `FileInputFormat.setInputPaths(job, new Path(args[0]));`\n `FileOutputFormat.setOutputPath(job, new Path(args[1]));`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean result = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(result ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.\u4fee\u6539\u4f9d\u8d56\uff0cHadoop\u4e3b\u673a\u4e0a\u5df2\u7ecf\u6709\u76f8\u5173\u4f9d\u8d56\u4e86\uff0c\u6240\u4ee5\u8bbe\u7f6e\u6210provided\uff0c\u524d\u9762\u662f\u5728\u672c\u5730\u8fd0\u884cWordCount\u7a0b\u5e8f\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u6210provided Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.3.1&lt;/version&gt;\n `&lt;scope&gt;provided&lt;/scope&gt;`\n&lt;/dependency&gt;\n</code></pre></p> <p>\u53ef\u9009\uff1a\u52a0\u4e0a\u65e5\u5fd7\u4f9d\u8d56\uff0c\u7136\u540e\u5e26\u4f9d\u8d56\u6253\u5305\u5e76\u6307\u5b9a\u4e3b\u7c7b Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.7.30&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;build&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;plugins&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.6.1&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;source&gt;1.8&lt;/source&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;target&gt;1.8&lt;/target&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;plugin&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.3.0&lt;/version&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;archive&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;manifest&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;addClasspath&gt;true&lt;/addClasspath&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;!--\u6307\u5b9a\u4e3b\u7c7b--&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;mainClass&gt;wordcount.WordCountDriver&lt;/mainClass&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/manifest&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/archive&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;descriptorRefs&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/descriptorRefs&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/configuration&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;executions&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;execution&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;id&gt;make-assembly&lt;/id&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;phase&gt;package&lt;/phase&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;goals&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;goal&gt;single&lt;/goal&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/goals&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/execution&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/executions&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;/plugin&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre></p> <p>3.\u6253\u5305\u540e\u4f20\u5230Linux\u4e3b\u673a\u4e0a\uff0c\u7136\u540e\u5728Hadoop\u4e0a\u8fd0\u884c\uff0c/input\u548c/output\u90fd\u662fHDFS\u4e0a\u7684\u8def\u5f84 Text Only<pre><code>hadoop jar MapReduce-1.0-SNAPSHOT-jar-with-dependencies.jar /input /output\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/5-MapReduce%E4%B9%8B%E5%BA%8F%E5%88%97%E5%8C%96/","title":"5-MapReduce\u4e4b\u5e8f\u5217\u5316","text":"<p> \u7ea6 970 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>\u6848\u4f8b\uff1a \u7edf\u8ba1\u6bcf\u4e00\u4e2a\u624b\u673a\u53f7\u8017\u8d39\u7684\u603b\u4e0a\u884c\u6d41\u91cf\u3001 \u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf   \uff082\uff09\u8f93\u5165\u6570\u636e\u683c\u5f0f\uff1a  \uff083\uff09\u671f\u671b\u8f93\u51fa\u6570\u636e\u683c\u5f0f </p> <p>\u5206\u6790\uff1a\u4ece\u671f\u671b\u8f93\u51fa\u6570\u636e\u683c\u5f0f\u53ef\u4ee5\u770b\u51fa\uff0c\u8f93\u51fa\u6570\u636e\u7684key\u662f\u624b\u673a\u53f7\u7801\uff0c\u800cvalue\u5e76\u4e0d\u80fd\u50cfWordCount\u90a3\u6837\u662f\u4e00\u4e2a\u5355\u4e2a\u7684\u503c\uff0c\u5fc5\u987b\u7684\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5176\u4e2d\u5305\u542b\u8be5\u624b\u673a\u53f7\u7801\u7684\u603b\u4e0a\u884c\u6d41\u91cf\u3001 \u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf\u3002</p> <p>\u56e0\u4e3aMapReduce\u7a0b\u5e8f\u5c06\u6765\u662f\u8981\u5728Hadoop\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\uff0c\u8fd9\u6d89\u53ca\u5230\u4e0d\u540c\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4e5f\u5c31\u662fMap\u7684\u7ed3\u679c\u4f1a\u4f20\u7ed9\u53e6\u4e00\u53f0\u4e3b\u673a\u4e0a\u7684Reduce\u7a0b\u5e8f\u4f5c\u4e3a\u8f93\u5165\uff0c\u6570\u636e\u5728\u4e0d\u540c\u4e3b\u673a\u4e4b\u95f4\u7684\u4f20\u9012\u5c31\u6d89\u53ca\u5230\u5e8f\u5217\u5316\uff0c\u800c\u76f4\u63a5\u4f7f\u7528Java\u7684\u5e8f\u5217\u5316\u673a\u5236\u5f00\u9500\u592a\u5927\uff0c\u6240\u4ee5Hadoop\u6709\u81ea\u5df1\u7684\u4e00\u5957\u5e8f\u5217\u5316\u673a\u5236\u3002</p> <p>Hadoop\u7684\u57fa\u672c\u5e8f\u5217\u5316\u7c7b\u578b\uff1a </p> <p>\u57fa\u672c\u7684\u5e8f\u5217\u5316\u7c7b\u578b\u53ef\u4ee5\u5e94\u5bf9\u53ea\u9700\u8981\u4f7f\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u573a\u666f\uff0c\u524d\u9762\u7684WordCount\u7a0b\u5e8f\u7684map()\u65b9\u6cd5\u548creduce()\u65b9\u6cd5\u7684\u8f93\u5165\u8f93\u51fa\u5c31\u662f\u8fd9\u6837\u3002\u800c\u5bf9\u4e8e\u672c\u6848\u4f8b\u800c\u8a00\uff0c\u57fa\u672c\u5e8f\u5217\u5316\u7c7b\u578b\u5c31\u6ee1\u8db3\u4e0d\u4e86\u9700\u6c42\u4e86\u3002\u5fc5\u987b\u81ea\u5b9a\u4e49\u53ef\u5e8f\u5217\u7684\u5bf9\u8c61\uff0c\u4f7f\u7528Hadoop\u7684\u5e8f\u5217\u5316\u673a\u5236\u9700\u8981\u5b9e\u73b0 Writable \u63a5\u53e3\uff0c\u4e0a\u9762\u7684\u57fa\u672c\u5e8f\u5217\u5316\u7c7b\u578b\u90fd\u662f\u5b9e\u73b0\u4e86 Writable \u63a5\u53e3\u3002</p> <p>\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u7c7b\u9700\u8981\u4ee5\u4e0b7\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u5fc5\u987b\u5b9e\u73b0 Writable \u63a5\u53e3</li> <li>\u5fc5\u987b\u6709\u7a7a\u53c2\u6784\u9020\uff0c\u56e0\u4e3a\u53cd\u5e8f\u5217\u5316\u65f6\u9700\u8981\u53cd\u5c04\u8c03\u7528\u7a7a\u53c2\u6784\u9020\u51fd\u6570</li> <li>\u5fc5\u987b\u91cd\u5199\u5e8f\u5217\u5316\u65b9\u6cd5 public void write(DataOutput out) throws IOException</li> <li>\u5fc5\u987b\u91cd\u5199\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5\u00a0 public void readFields(DataInput in) throws IOException</li> <li>\u53cd\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u548c\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u9700\u8981\u5b8c\u5168\u4e00\u81f4</li> <li>\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u9700\u8981toString()\u65b9\u6cd5\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u5199toString()\u65b9\u6cd5\uff0c \u53ef\u7528\"\\t\"\u5206\u9694\u6bcf\u4e2a\u5b57\u6bb5</li> <li>\u5982\u8be5\u5e8f\u5217\u5316\u5bf9\u8c61\u662fmap\u8f93\u51fa\u7ed3\u679c\u7684key\uff0c\u90a3\u4e48 \u8fd8\u9700\u8981\u5b9e\u73b0 Comparable \u63a5\u53e3\uff0c\u56e0\u4e3aMapReduce \u6846\u67b6\u4e2d\u7684 Shuffle \u8fc7\u7a0b\u8981\u6c42\u5bf9 key \u5fc5\u987b\u80fd\u6392\u5e8f</li> </ol> <p>\u5b9a\u4e49\u5305\u542b\u4e0a\u884c\u6d41\u91cf\u3001 \u4e0b\u884c\u6d41\u91cf\u548c\u603b\u6d41\u91cf\u7684\u5e8f\u5217\u5316\u7c7b Text Only<pre><code>/**\n* 1\u3001\u5b9a\u4e49\u7c7b\u5b9e\u73b0writable\u63a5\u53e3\n* 2\u3001\u91cd\u5199\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5\n* 3\u3001\u91cd\u5199\u7a7a\u53c2\u6784\u9020\n* 4\u3001toString\u65b9\u6cd5\n*/\npublic class FlowBean implements Writable {\n\u00a0\u00a0\u00a0\u00a0private long upFlow; // \u4e0a\u884c\u6d41\u91cf\n\u00a0\u00a0\u00a0\u00a0private long downFlow; // \u4e0b\u884c\u6d41\u91cf\n\u00a0\u00a0\u00a0\u00a0private long sumFlow; // \u603b\u6d41\u91cf\n\n\u00a0\u00a0\u00a0\u00a0// \u7a7a\u53c2\u6784\u9020\n\u00a0\u00a0\u00a0\u00a0public FlowBean() {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getUpFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return upFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setUpFlow(long upFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.upFlow = upFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public long getDownFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setDownFlow(long downFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.downFlow = downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public long getSumFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public void setSumFlow(long sumFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u5e8f\u5217\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void write(DataOutput out) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(upFlow);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(downFlow);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(sumFlow);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u53cd\u5e8f\u5217\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void readFields(DataInput in) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.upFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.downFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String toString() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Map Text Only<pre><code>public class FlowMapper extends Mapper&lt;LongWritable, Text, Text, `FlowBean`&gt; {\n\n\u00a0\u00a0\u00a0\u00a0private Text outK = new Text();\n\u00a0\u00a0\u00a0\u00a0private FlowBean outV = new FlowBean();\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u5207\u5272\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = line.split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u6293\u53d6\u60f3\u8981\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String phone = split[1];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String up = split[split.length - 3];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String down = split[split.length - 2];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4\u5c01\u88c5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.set(phone);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setUpFlow(Long.parseLong(up));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setDownFlow(Long.parseLong(down));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setSumFlow(Long.parseLong(up) + Long.parseLong(down));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(outK, outV);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Reduce Text Only<pre><code>public class FlowReducer extends Reducer&lt;Text, `FlowBean`, Text, `FlowBean`&gt; {\n\u00a0\u00a0\u00a0\u00a0private FlowBean outV = new FlowBean();\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(Text key, Iterable&lt;FlowBean&gt; values, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u904d\u5386\u96c6\u5408\u7d2f\u52a0\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long totalUp = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0long totalDown = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (FlowBean value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0totalUp += value.getUpFlow();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0totalDown += value.getDownFlow();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u5c01\u88c5outk, outv\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setUpFlow(totalUp);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setDownFlow(totalDown);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.setSumFlow(totalUp + totalDown);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(key, outV);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Driver Text Only<pre><code>public class FlowDriver {\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6ejar\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(FlowDriver.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper \u548cReducer\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(FlowMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(FlowReducer.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6emapper \u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(FlowBean.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u6570\u636e\u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(FlowBean.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u7c7b\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(classPath);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 6 \u8bbe\u7f6e\u6570\u636e\u7684\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(classPath + \"/input/phone_data.txt\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output\"));\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean result = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(result ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/6-MapReduce%E4%B9%8B%E4%BB%BB%E5%8A%A1%E6%8F%90%E4%BA%A4%E5%8F%8AInputFormat/","title":"6-MapReduce\u4e4b\u4efb\u52a1\u63d0\u4ea4\u53caInputFormat","text":"<p> \u7ea6 2028 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 41 \u5206\u949f</p> <p>\u57fa\u4e8eMapReduce\u6846\u67b6\u7f16\u5199\u597dMapReduce\u7a0b\u5e8f\u4e4b\u540e\uff0c\u9700\u8981\u5c06\u4efb\u52a1\u63d0\u4ea4\u7ed9YARN\u6765\u8c03\u5ea6\u8fd0\u884c\u3002\u5728\u4efb\u52a1\u63d0\u4ea4\u524d\u9700\u8981\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\uff0c\u6700\u4e3b\u8981\u662f\u63d0\u4ea4jar\u5305\u5230\u96c6\u7fa4\u3001\u521b\u5efa\u5207\u7247\u8ba1\u5212 \u548c \u751f\u6210job\u7684XML\u914d\u7f6e\u6587\u4ef6\u3002 \u5176\u4e2d\u6700\u91cd\u8981\u7684\u662f\u8ba1\u7b97\u5207\u7247\u8ba1\u5212\uff0c\u56e0\u4e3a MapTask \u5e76\u884c\u5ea6\u5b8c\u5168\u7531\u5207\u7247\u4e2a\u6570\u51b3\u5b9a\uff0c \u4e00\u4e2a\u5207\u7247\u4f1a\u5bf9\u5e94\u542f\u52a8\u4e00\u4e2a MapTask\u6765\u5904\u7406\uff0c\u800c\u5207\u7247\u4e2a\u6570\u7531\u8f93\u5165\u6587\u4ef6\u548c\u5207\u7247\u89c4\u5219\u51b3\u5b9a\u3002  \u7b80\u5316\u6d41\u7a0b\uff1a </p> <p>\u4efb\u52a1\u63d0\u4ea4\u7684\u6d41\u7a0b\uff1a 1.\u5728Driver\u7c7b\u4e2d\u524d6\u6b65\u662f\u8bbe\u7f6eJob\u548c\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84\uff0c\u6700\u540e\u4e00\u6b65\u624d\u662f\u63d0\u4ea4\u4efb\u52a1\uff1ajob.waitForCompletion(true); 2.\u7b2c\u4e8c\u6b65\u6267\u884c org.apache.hadoop.mapreduce.Job \u7684 submit()\u65b9\u6cd5 Text Only<pre><code>public void submit()\n\u00a0 \u00a0 \u00a0 throws IOException, InterruptedException, ClassNotFoundException {\n`//\u68c0\u67e5\u4efb\u52a1\u72b6\u6001`\n `ensureState(JobState.DEFINE);`\n`//\u8bbe\u7f6e\u65b0API\uff0c\u517c\u5bb9Hadoop1.x`\n `setUseNewAPI();`\n`//\u8fde\u63a5\uff0c\u5982\u679c\u662f\u672c\u5730\u6a21\u5f0f\u8fd0\u884cMapReduce\u5219\u4f7f\u7528LocalClientProtocolProvider\uff0c\u5982\u679c\u662f\u5728Hadoop\u96c6\u7fa4\u4e0a\u8fd0\u884c\u5219\u4f7f\u7528YarnClientProtocolProvider`\n `connect();`\n\u00a0final JobSubmitter submitter =\n\u00a0 \u00a0 \u00a0getJobSubmitter(cluster.getFileSystem(), cluster.getClient());\n\u00a0status = ugi.doAs(new PrivilegedExceptionAction&lt;JobStatus&gt;() {\n\u00a0 \u00a0public JobStatus run() throws IOException, InterruptedException,\n\u00a0 \u00a0ClassNotFoundException {\n`//\u63d0\u4ea4\u4efb\u52a1`\n `return submitter.submitJobInternal(Job.this, cluster);`\n\u00a0 \u00a0}\n\u00a0});\n\u00a0state = JobState.RUNNING;\n\u00a0LOG.info(\"The url to track the job: \" + getTrackingURL());\n}\n</code></pre> connect()\u65b9\u6cd5\u7684\u5173\u952e\u6b65\u9aa4\uff1a 1540\u884c return new Cluster(getConfiguration()); org.apache.hadoop.mapreduce.Cluster 109\u884c initialize(jobTrackAddr, conf); 115\u884c initProviderList();</p> <p>3.submitter.submitJobInternal(Job.this, cluster);\u624d\u662f\u771f\u6b63\u7684\u5b8c\u6574\u7684\u63d0\u4ea4\u6d41\u7a0b\uff0c\u8be5\u65b9\u6cd5\u4f4d\u4e8eorg.apache.hadoop.mapreduce.JobSubmitter\u7c7b\u4e2d</p> <p>3.1 143\u884c checkSpecs(job);\u00a0 \u68c0\u67e5\u8f93\u51fa\u8def\u5f84\u662f\u5426\u5408\u6cd5\uff0c\u70b9\u8fdb\u53bb\uff0c227\u884coutput.checkOutputSpecs(job);\u8c03\u7528\u7684\u662fOutputFormat\u7684checkOutputSpecs()\u65b9\u6cd5</p> <p>3.2 148\u884c Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf); \u00a0 \u521b\u5efa\u7ed9\u96c6\u7fa4\u63d0\u4ea4\u6570\u636e\u7684 Stag \u8def\u5f84 /tmp/hadoop/mapred/staging/Jmoon403907232/.staging</p> <p>3.3 157\u884c JobID jobId = submitClient.getNewJobID();\u00a0 \u83b7\u53d6 jobid\uff0c\u540e\u9762\u4f1a\u6839\u636e\u8fd9\u4e2ajobid\u5728Stag\u8def\u5f84\u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u5c31\u662f\u8fd9\u6837/tmp/hadoop/mapred/staging/Jmoon403907232/.staging/job_local403907232_0001</p> <p>3.4 194\u884c\u00a0copyAndConfigureFiles(job, submitJobDir);\u00a0 \u62f7\u8d1d jar \u5305\u5230\u96c6\u7fa4\uff0c\u5982\u679c\u662fLocalClientProtocolProvider\u5c31\u4e0d\u7528\u62f7\u8d1d</p> <p>3.5 200\u884c int maps = writeSplits(job, submitJobDir);\u00a0 \u8ba1\u7b97\u5207\u7247\uff0c\u751f\u6210\u5207\u7247\u89c4\u5212\u6587\u4ef6\uff0c\u5b83\u7684\u8c03\u7528\u6d41\u7a0b\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u6b65\u9aa4\u662f\uff1a \u00a0 \u00a0 \u00a0 327\u884c\u00a0maps = writeNewSplits(job, jobSubmitDir); \u00a0 \u00a0 \u00a0 310\u884c\u00a0List splits = input.getSplits(job);\u8fd9\u6b65\u624d\u662f\u771f\u6b63\u7684\u8ba1\u7b97\u5207\u7247\u3002 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0input\u662f\u62bd\u8c61\u7c7bInputFormat\u7684\u5f15\u7528\uff0cInputFormat\u7684getSplits()\u65b9\u6cd5\u662f\u62bd\u8c61\u65b9\u6cd5\uff0cInputFormat\u6709\u4f17\u591a\u7684\u5b50\u7c7b\uff0c\u6bd4\u8f83\u91cd\u8981\u7684\u5b50\u7c7b\u662f\u62bd\u8c61\u7c7bFileInputFormat\uff0cFileInputFormat\u5b9e\u73b0\u4e86getSplits()\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u5207\u7247\u8ba1\u7b97\u903b\u8f91\u4e3b\u8981\u662f\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u8fdb\u884c\u5207\u7247\uff0cFileInputFormat\u6bd4\u8f83\u91cd\u8981\u7684\u5b50\u7c7b\u6709TextInputFormat\u548c\u62bd\u8c61\u7c7bCombineFileInputFormat\uff0cCombineFileInputFormat\u91cd\u5199\u4e86FileInputFormat\u7684getSplits()\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u5207\u7247\u8ba1\u7b97\u903b\u8f91\u4e3b\u8981\u662f\u5c06\u5c0f\u6587\u4ef6\u5408\u5e76\u4e4b\u540e\u4e00\u8d77\u5207\uff0cCombineFileInputFormat\u6bd4\u8f83\u91cd\u8981\u7684\u5b50\u7c7b\u662fCombineTextInputFormat\u3002 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u5207\u7247\u8ba1\u7b97\u7684\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5728Stag \u8def\u5f84\u4e0b\uff0c\u5207\u7247\u53ea\u662f\u903b\u8f91\u4e0a\u7684\uff0c\u610f\u601d\u662fgetSplits()\u65b9\u6cd5\u53ea\u662f\u8ba1\u7b97\u5f97\u5230\u4e86MaskTask\u8fd0\u884c\u65f6\u7684\u8bfb\u53d6\u6570\u636e\u7684\u8ba1\u5212\uff0cMaskTask\u5728\u8fd0\u884c\u65f6\u4f1a\u6309\u7167\u5207\u7247\u8ba1\u7b97\u7684\u7ed3\u679c\u8bfb\u53d6\u6570\u636e\u3002 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 FileInputFormat\u7684getSplits()\u65b9\u6cd5\u7684404\u884cList files = listStatus(job);\u4f1a\u5f97\u5230\u8f93\u5165\u8def\u5f84\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u7136\u540e\u5728408\u884c\u7684for\u5faa\u73af\u4e4b\u4e2d\u5904\u7406\u6bcf\u4e00\u4e2a\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u5982\u679c\u662f\u76ee\u5f55\u4e0d\u505a\u5904\u7406\u76f4\u63a5continue\u5230\u4e0b\u4e00\u4e2a\u6587\u4ef6\uff0c\u5982\u679c\u662f\u6587\u4ef6\u5219\u4f1a\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\u8ba1\u7b97\u5206\u7247\uff0c<code>\u8fd9\u91cc\u53ef\u4ee5\u8bf4\u660eFileInputFormat\u662f\u9488\u5bf9\u6bcf\u4e00\u4e2a\u6587\u4ef6\u5355\u72ec\u5207\u7247</code>\u3002 <p>3.6 245\u884c\u00a0writeConf(conf, submitJobFile); \u4fdd\u5b58Job\u4efb\u52a1\u7684 XML \u914d\u7f6e\u6587\u4ef6\u5230Stag \u8def\u5f84\u4e0b</p> <p>3.7 251\u884c\u00a0status = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials());\u00a0 \u51c6\u5907\u5de5\u4f5c\u5df2\u7ecf\u505a\u5b8c\uff0c\u73b0\u5728\u771f\u6b63\u5411Yarn\u6216\u8005Local\u63d0\u4ea4Job\uff0c\u8fd4\u56destatus</p> <p>\u4ece\u4e0a\u8ff0\u6d41\u7a0b\u53ef\u4ee5\u770b\u51faInputFormat\u548cOutputFormat\u5728\u4efb\u52a1\u63d0\u4ea4\u9636\u6bb5\u90fd\u6709\u6d89\u53ca\uff0cOutputFormat\u68c0\u67e5\u8f93\u51fa\u8def\u5f84\u662f\u5426\u5408\u6cd5\uff0cInputFormat\u7528\u4e8e\u8ba1\u7b97\u5207\u7247\u8ba1\u5212\uff0c\u5728getSplits()\u65b9\u6cd5\u4e2d\u4f1a\u8c03\u7528FileInputFormat\u7684isSplitable()\u65b9\u6cd5\u68c0\u67e5\u6587\u4ef6\u662f\u5426\u652f\u6301\u5207\u7247\uff0c\u6bd4\u5982\u538b\u7f29\u6587\u4ef6\u53ef\u80fd\u5c31\u4e0d\u652f\u6301\uff0cisSplitable()\u9700\u8981\u7531\u5b50\u7c7b\u91cd\u5199\u3002</p> <p>InputFormat\u8fd8\u4f1a\u5728\u540e\u7eedMapTask\u4efb\u52a1\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u65f6\u7528\u5230\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u662fTextInputFormat\uff0c\u5148\u8c03\u7528TextInputFormat\u7684 createRecordReader()\u65b9\u6cd5\u521b\u5efa\u4e00\u4e2aRecordReader\uff0c\u7136\u540e\u7531RecordReader\u6309\u884c\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\uff0ckey\u662f\u884c\u8d77\u59cb\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\uff0cvalue\u662f\u8be5\u884c\u7684\u5185\u5bb9\uff0c\u524d\u9762\u7684WordCount\u7a0b\u5e8f\u7528\u7684\u5c31\u662fTextInputFormat\u3002</p> <p>\u603b\u7ed3\uff0cInputFormat\u62bd\u8c61\u7c7b\u662f\u6700\u9876\u7ea7\u7684\u62bd\u8c61\u7c7b\uff0c\u5b83\u4e00\u5171\u4e5f\u5c31\u53ea\u5b9a\u4e49\u4e86\u4e24\u4e2a\u62bd\u8c61\u65b9\u6cd5getSplits()\u548ccreateRecordReader()\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u9700\u8981\u7531\u5176\u5b50\u7c7b\u90fd\u5b9e\u73b0\u3002getSplits()\u5728\u4efb\u52a1\u63d0\u4ea4\u524d\u8ba1\u7b97\u5206\u7247\u4ee5\u4fbf\u51b3\u5b9aMapTask\u7684\u5e76\u884c\u5ea6\uff1bcreateRecordReader()\u521b\u5efaRecordReader\uff0c\u7528\u4e8e\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u3002 </p> <p>MapTask \u5e76\u884c\u5ea6\u7531\u5207\u7247\u4e2a\u6570\u51b3\u5b9a\uff0c\u5207\u7247\u4e2a\u6570\u7531\u8f93\u5165\u6587\u4ef6\u548c\u5207\u7247\u89c4\u5219\u51b3\u5b9a\u3002\u4e0a\u9762\u6ca1\u6709\u5177\u4f53\u5c55\u5f00FileInputFormat \u548c CombineFileInputFormat\u7684getSplits()\u7684\u5207\u7247\u89c4\u5219\uff0cTextInputFormat \u548c CombineTextInputFormat\u7684\u5207\u7247\u89c4\u5219\u5206\u522b\u7ee7\u627f\u81ea\u8fd9\u4e24\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4e0b\u9762\u5177\u4f53\u8bf4\u660e\u5b83\u4fe9\u7684\u5207\u7247\u8ba1\u7b97\u903b\u8f91\u3002</p> <p>TextInputFormat\u7684getSplits()\u65b9\u6cd5\u7ee7\u627f\u81eaFileInputFormat\uff0c\u5b83\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff1a \uff081\uff09\u7a0b\u5e8f\u5148\u627e\u5230\u4f60\u6570\u636e\u5b58\u50a8\u7684\u76ee\u5f55\u3002 \uff082\uff09\u5f00\u59cb\u904d\u5386\u5904\u7406\uff08\u89c4\u5212\u5207\u7247\uff09\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e00\u4e2a\u6587\u4ef6 \uff083\uff09\u904d\u5386\u7b2c\u4e00\u4e2a\u6587\u4ef6ss.txt \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a. \u83b7\u53d6\u6587\u4ef6\u5927\u5c0ffs.sizeOf(ss.txt) \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0b. \u8ba1\u7b97\u5207\u7247\u5927\u5c0f\uff0c<code>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5207\u7247\u5927\u5c0f=blocksize=128M</code> \uff0c\u8ba1\u7b97\u8fc7\u7a0b\u662f \uff1a  computeSplitSize(Math.max(minSize,Math.min(maxSize,blocksize)))=blocksize=128M\uff08424\u884c\uff09 \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0c. \u5f00\u59cb\u5207\uff0c\u5f62\u6210\u7b2c1\u4e2a\u5207\u7247\uff1a ss.txt\u20140:128M \u7b2c2\u4e2a\u5207\u7247ss.txt\u2014128:256M \u7b2c3\u4e2a\u5207\u7247ss.txt\u2014256M:300M \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\uff08 \u6bcf\u6b21\u5207\u7247\u65f6\uff0c\u90fd\u8981\u5224\u65ad\u5207\u5b8c\u5269\u4e0b\u7684\u90e8\u5206\u662f\u5426\u5927\u4e8e\u5757\u76841.1\u500d\uff0c\u4e0d\u5927\u4e8e1.1\u500d\u7684\u8bdd\u5c31\u4e0d\u5207\uff0c\u5f62\u6210\u4e00\u6574\u5757\u5207\u7247\uff0c\u5927\u4e8e\u7684\u8bdd\u5c31\u5207\u7247\uff0c\u7b2c\u4e00\u7247128M\uff0c\u5269\u4f59\u4f5c\u4e3a\u4e00\u4e2a\u5207\u7247\u518d\u6b21\u5224\u65ad\u662f\u5426\u8981\u5207\u7247\uff09 \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0d. \u5c06\u5207\u7247\u4fe1\u606f\u5199\u5230\u4e00\u4e2a\u5207\u7247\u89c4\u5212\u6587\u4ef6\u4e2d\uff0c\u53ea\u8bb0\u5f55\u4e86\u5207\u7247\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bd4\u5982\u8d77\u59cb\u4f4d\u7f6e\u3001\u957f\u5ea6\u4ee5\u53ca\u6240\u5728\u7684\u8282\u70b9\u5217\u8868\u7b49\u3002 </p> <p>TextInputFormat \u5207\u7247\u673a\u5236\u662f\u5bf9\u4efb\u52a1\u6309\u6587\u4ef6\u89c4\u5212\u5207\u7247\uff0c\u4e0d\u7ba1\u6587\u4ef6\u591a\u5c0f\uff0c\u90fd\u4f1a\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u5207\u7247\uff0c \u90fd\u4f1a\u4ea4\u7ed9\u4e00\u4e2a MapTask\uff0c \u8fd9\u6837\u5982\u679c\u6709\u5927\u91cf\u5c0f\u6587\u4ef6\uff0c \u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684MapTask\uff0c \u5904\u7406\u6548\u7387\u4f4e\u3002\u800cCombineTextInputFormat \u7528\u4e8e\u5c0f\u6587\u4ef6\u8fc7\u591a\u7684\u573a\u666f\uff0c \u5b83\u53ef\u4ee5\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u4ece\u903b\u8f91\u4e0a\u89c4\u5212\u5230\u4e00\u4e2a\u5207\u7247\u4e2d\uff0c \u8fd9\u6837\u591a\u4e2a\u5c0f\u6587\u4ef6\u5c31\u53ef\u4ee5\u4ea4\u7ed9\u4e00\u4e2a MapTask \u5904\u7406\u3002</p> <p>CombineTextInputFormat\u7684\u5207\u7247\u5305\u62ec\u4e24\u4e2a\u8fc7\u7a0b\uff1a \u865a\u62df\u5b58\u50a8\u8fc7\u7a0b\u3001\u5207\u7247\u8fc7\u7a0b 1.\u865a\u62df\u5b58\u50a8\u8fc7\u7a0b\uff1a \u00a0\u00a0\u00a0\u00a0\u5c06\u8f93\u5165\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u5927\u5c0f\uff0c \u4f9d\u6b21\u548c\u8bbe\u7f6e\u7684 setMaxInputSplitSize \u503c\u6bd4\u8f83\uff0c \u5982\u679c\u4e0d\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u503c\uff0c \u903b\u8f91\u4e0a\u5212\u5206\u4e00\u4e2a\u5757\u3002\u5982\u679c\u8f93\u5165\u6587\u4ef6\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e14\u5927\u4e8e\u4e24\u500d\uff0c\u90a3\u4e48\u4ee5\u6700\u5927\u503c\u5207\u5272\u4e00\u5757\uff1b \u5f53\u5269\u4f59\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e14\u4e0d\u5927\u4e8e\u6700\u5927\u503c 2 \u500d\uff0c\u6b64\u65f6\u5c06\u6587\u4ef6\u5747\u5206\u6210 2 \u4e2a\u865a\u62df\u5b58\u50a8\u5757\uff08\u9632\u6b62\u51fa\u73b0\u592a\u5c0f\u5207\u7247\uff09 \u3002\u4f8b\u5982 setMaxInputSplitSize \u503c\u4e3a 4M\uff0c \u8f93\u5165\u6587\u4ef6\u5927\u5c0f\u4e3a 8.02M\uff0c\u5219\u5148\u903b\u8f91\u4e0a\u5206\u6210\u4e00\u4e2a4M\u3002 \u5269\u4f59\u7684\u5927\u5c0f\u4e3a 4.02M\uff0c\u5982\u679c\u6309\u7167 4M \u903b\u8f91\u5212\u5206\uff0c\u5c31\u4f1a\u51fa\u73b0 0.02M \u7684\u5c0f\u7684\u865a\u62df\u5b58\u50a8\u6587\u4ef6\uff0c \u6240\u4ee5\u5c06\u5269\u4f59\u7684 4.02M \u6587\u4ef6\u5207\u5206\u6210\uff082.01M \u548c 2.01M\uff09\u4e24\u4e2a\u6587\u4ef6\u3002</p> <p>2.\u5207\u7247\u8fc7\u7a0b\uff1a \u00a0\u00a0\u00a0\u00a0\uff08a\uff09 \u5224\u65ad\u865a\u62df\u5b58\u50a8\u7684\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e setMaxInputSplitSize \u503c\uff0c\u5927\u4e8e\u7b49\u4e8e\u5219\u5355\u72ec\u5f62\u6210\u4e00\u4e2a\u5207\u7247\u3002 \u00a0\u00a0\u00a0\u00a0\uff08b\uff09 \u5982\u679c\u4e0d\u5927\u4e8e\u5219\u8ddf\u4e0b\u4e00\u4e2a\u865a\u62df\u5b58\u50a8\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u5171\u540c\u5f62\u6210\u4e00\u4e2a\u5207\u7247\u3002 \u00a0\u00a0\u00a0\u00a0\uff08c\uff09 \u6d4b\u8bd5\u4e3e\u4f8b\uff1a\u6709 4 \u4e2a\u5c0f\u6587\u4ef6\u5927\u5c0f\u5206\u522b\u4e3a 1.7M\u3001 5.1M\u3001 3.4M \u4ee5\u53ca 6.8M \u8fd9\u56db\u4e2a\u5c0f\u6587\u4ef6\uff0c\u5219\u865a\u62df\u5b58\u50a8\u4e4b\u540e\u5f62\u6210 6 \u4e2a\u6587\u4ef6\u5757\uff0c\u5927\u5c0f\u5206\u522b\u4e3a\uff1a1.7M\uff0c\uff082.55M\u3001 2.55M\uff09\uff0c3.4M \u4ee5\u53ca\uff083.4M\u30013.4M\uff09\u6700\u7ec8\u4f1a\u5f62\u6210 3 \u4e2a\u5207\u7247\uff0c\u5927\u5c0f\u5206\u522b\u4e3a\uff1a\uff081.7+2.55\uff09 M\uff0c\uff082.55+3.4\uff09M\uff0c\uff083.4+3.4\uff09M</p> <p></p> <p>CombineTextInputFormat \u6848\u4f8b\uff1a  \u5b9e\u73b0\u8fc7\u7a0b\uff1a 1.\u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u8fd0\u884c\u6700\u5f00\u59cb\u7684 WordCount \u6848\u4f8b\u7a0b\u5e8f\uff0c\u67e5\u770b\u6253\u5370\u65e5\u5fd7\uff0c\u5207\u7247\u4e2a\u6570\u4e3a 4\uff1a number of splits:4 2. \u5728 WordcountDriver \u4e2d\u589e\u52a0\u5982\u4e0b\u4ee3\u7801\uff1a Text Only<pre><code>// \u5982\u679c\u4e0d\u8bbe\u7f6e InputFormat\uff0c\u5b83\u9ed8\u8ba4\u7528\u7684\u662f TextInputFormat.class\njob.setInputFormatClass(CombineTextInputFormat.class);\n//\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e 4m\nCombineTextInputFormat.setMaxInputSplitSize(job, 4194304);\n</code></pre> \u67e5\u770b\u6253\u5370\u65e5\u5fd7\uff0c\u5207\u7247\u4e2a\u6570\u4e3a 3\uff1a number of splits:3 3.\u5c06\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e 20m Text Only<pre><code>// \u5982\u679c\u4e0d\u8bbe\u7f6e InputFormat\uff0c\u5b83\u9ed8\u8ba4\u7528\u7684\u662f TextInputFormat.class\njob.setInputFormatClass(CombineTextInputFormat.class);\n//\u865a\u62df\u5b58\u50a8\u5207\u7247\u6700\u5927\u503c\u8bbe\u7f6e 20m\nCombineTextInputFormat.setMaxInputSplitSize(job, 20971520);\n</code></pre> \u67e5\u770b\u6253\u5370\u65e5\u5fd7\uff0c\u5207\u7247\u4e2a\u6570\u4e3a 1\uff1a number of splits:1</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/7-MapReduce%E4%B9%8BShuffle/","title":"7-MapReduce\u4e4bShuffle","text":"<p> \u7ea6 730 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p></p> <p>Yarn\u6839\u636e\u4efb\u52a1\u63d0\u4ea4\u4e0a\u6765\u7684\u5207\u7247\u8ba1\u5212\uff0c\u5c06Map\u4efb\u52a1\u5206\u5728Hadoop01 \u548c\u00a0Hadoop02 \u4e0a\uff0cReduce\u4efb\u52a1\u5206\u5728Hadoop03 \u3001Hadoop04 \u548c Hadoop05\u4e0a\u3002</p> <p>Map\u7684\u7ed3\u679c\u4f1a\u5148\u5199\u5230\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u5199\u7684\u8fc7\u7a0b\u5305\u542b\u4e86 \u5206\u533a \u64cd\u4f5c\u3002\u5f53\u73af\u5f62\u7f13\u51b2\u533a\u6ee1\u4e86\u4e4b\u540e\u4f1a\u5199\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\u4fdd\u5b58\uff0c\u8fd9\u4e2a\u5199\u7684\u8fc7\u7a0b\u5305\u542b \u6392\u5e8f \u64cd\u4f5c\u3002\u5206\u533a\u5c31\u662f\u5982\u679c\u4e00\u4e2akey-value\u952e\u503c\u5bf9\u6839\u636e\u67d0\u4e2a\u89c4\u5219\u8ba1\u7b97\u6709\u76f8\u540c\u7684\u7ed3\u679c\uff0c\u90a3\u4e48\u5728\u5199\u5230\u78c1\u76d8\u65f6\u4f1a\u628a\u8fd9\u4e9bk-v\u952e\u503c\u5bf9\u4fdd\u5b58\u5230\u540c\u4e00\u4e2a\u5206\u533a\u4e2d\uff1b\u6392\u5e8f\u5c31\u662f\u4fdd\u5b58\u5230\u6587\u4ef6\u65f6\u4f1a\u5728\u5206\u533a\u5185\u6839\u636ekey\u7684\u6bd4\u8f83\u89c4\u5219\u8fdb\u884c\u6392\u5e8f\uff0c\u5982\u679c\u7528\u6237\u6709\u5b9a\u4e49\u5408\u5e76\u64cd\u4f5c\uff0c\u90a3\u4e48\u5728\u6ea2\u5199\u65f6\u8fd8\u4f1a\u8fdb\u884c\u5408\u5e76\uff0c\u4e00\u6b21\u6ea2\u5199\u53ea\u4f1a\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u6240\u6709\u5206\u533a\u90fd\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\uff0c\u9760\u7d22\u5f15\u6587\u4ef6\u6765\u8bb0\u5f55\u5206\u533a\u7684\u4fe1\u606f\u3002\u6574\u4e2aMap\u9636\u6bb5\u53ef\u80fd\u4f1a\u7ecf\u5386\u4e86\u591a\u6b21\u6ea2\u5199\uff0c\u4e5f\u5c31\u662f\u4f1a\u4ea7\u751f\u591a\u4e2a\u6ea2\u5199\u6587\u4ef6\uff0c\u8fd9\u65f6\u8fd8\u9700\u8981\u5bf9\u591a\u4e2a\u6ea2\u5199\u6587\u4ef6\u7684\u6bcf\u4e2a\u5206\u533a\u8fdb\u884c\u5f52\u5e76\u6392\u5e8f\u751f\u6210\u4e00\u4e2a\u5927\u7684\u6392\u597d\u5e8f\u7684\u6587\u4ef6\uff0c\u8fd9\u6b65\u4e5f\u4f1a\u8fdb\u884c\u5408\u5e76\uff0c\u6240\u6709\u7684\u5206\u533a\u4e5f\u90fd\u662f\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\uff0c\u540c\u6837\u4e5f\u662f\u9760\u7d22\u5f15\u6587\u4ef6\u8bb0\u5f55\u5206\u533a\u4fe1\u606f\u3002\u8ba9\u6bcf\u4e2aMapTask\u6700\u7ec8\u53ea\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u907f\u514d\u540c\u65f6\u6253\u5f00\u5927\u91cf\u6587\u4ef6\u548c\u540c\u65f6\u8bfb\u53d6\u5927\u91cf\u5c0f\u6587\u4ef6\u4ea7\u751f\u7684\u968f\u673a\u8bfb\u53d6\u5e26\u6765\u7684\u5f00\u9500\u3002\u4e0a\u8ff0\u8fc7\u7a0b\u6839\u636eMapTask\u7684\u6570\u91cf\u53ef\u80fd\u4f1a\u5728\u591a\u53f0Hadoop\u4e3b\u673a\u4e0a\u8fdb\u884c\uff0cReduce\u65f6\u6bcf\u4e2aReduceTask\u8d1f\u8d23\u4e00\u4e2a\u5206\u533a\uff0c\u6240\u4ee5\u5982\u679c\u6709\u591a\u4e2a\u5206\u533a\uff0cReduceTask\u4e5f\u6709\u53ef\u80fd\u5206\u5e03\u5728\u591a\u53f0\u4e3b\u673a\u4e0a\u8fdb\u884c\uff0cReduceTask\u7684Shuffle\u9636\u6bb5\u9996\u5148\u4f1a\u4ece\u5404\u53f0Map\u4e3b\u673a\u4e0a\u62c9\u53d6\u540c\u4e00\u5206\u533a\u7684\u6587\u4ef6\uff0c\u7136\u540e\u5f52\u5e76\u6392\u5e8f\uff08\u5982\u679c\u5185\u5b58\u4e0d\u80fd\u5b58\u5f97\u4e0b\u5f52\u5e76\u540e\u7684\u6587\u4ef6\uff0c\u90a3\u4e48\u8fd8\u9700\u501f\u52a9\u78c1\u76d8\u5b58\u50a8\uff09\uff0c\u6392\u5b8c\u5e8f\u540e\u518d\u8fdb\u884cReduce\u3002 \u6240\u4ee5\uff0cMapTask\u4e3b\u673a\u548cReduceTask\u4e3b\u673a\u90fd\u6709shuffle\u9636\u6bb5\uff0cShuffle\u9636\u6bb5\u5f97\u4e3b\u8981\u4efb\u52a1\u5c31\u662f\u5206\u533a\u548c\u6392\u5e8f\uff0c\u7531\u4e8e\u5728MapTask\u4e3b\u673a\u548cReduceTask\u4e3b\u673a\u4e4b\u95f4\u6d89\u53ca\u6570\u636e\u5f97\u4f20\u8f93\uff0c\u6240\u4ee5MapTask\u4e3b\u673a\u7684Shuffle\u9636\u6bb5\u7684\u6700\u540e\u53ef\u80fd\u8fd8\u6d89\u53ca\u5bf9\u5f52\u5e76\u540e\u6587\u4ef6\u7684\u538b\u7f29\uff0c\u56e0\u4e3a\u6587\u4ef6\u538b\u7f29\u53ef\u4ee5\u63d0\u9ad8\u4f20\u8f93\u6548\u7387\uff0cReduceTask\u4e3b\u673a\u7684Shuffle\u9636\u6bb5\u7684\u5f00\u59cb\u53ef\u80fd\u8fd8\u6d89\u53ca\u5bf9\u4f20\u8f93\u8fc7\u6765\u7684\u6587\u4ef6\u7684\u89e3\u538b\u7f29\u3002</p> <p>\u6ce8\u610f\uff1a</p> <ol> <li>\u73af\u5f62\u7f13\u51b2\u533a\u5de6\u53f3\u4e24\u90e8\u5206\u5206\u522b\u5b58\u50a8\u7684\u662f \u5143\u6570\u636e \u548c  \uff0c\u5f53\u5230\u8fbe80%\u4e4b\u540e\u5c31\u4f1a\u76f4\u63a5\u4ece\u4e2d\u95f4\u5411\u4e24\u8fb9\u5f00\u59cb\u53cd\u5411\u5199\uff0c\u6240\u4ee5\u79f0\u4e3a\u73af\u5f62\u7f13\u51b2\u533a\u3002 <li>\u7f13\u51b2\u533a\u5927\u5c0f\u4f1a\u5f71\u54cd\u5230 MapReduce \u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\uff0c\u539f\u5219\u4e0a\u8bf4\uff0c\u7f13\u51b2\u533a\u8d8a\u5927\uff0c\u78c1\u76d8 io \u7684\u6b21\u6570\u8d8a\u5c11\uff0c\u6267\u884c\u901f\u5ea6\u5c31\u8d8a\u5feb\u3002</li> <li>\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u8c03\u6574\uff0c\u5373\uff1amapreduce.task.io.sort.mb \u9ed8\u8ba4 100M\u3002</li>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/8-Shuffle%E4%B9%8B%E5%88%86%E5%8C%BA/","title":"8-Shuffle\u4e4b\u5206\u533a","text":"<p> \u7ea6 1022 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>\u5982\u679c\u4e0d\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u6b64\u65f6\u5206\u533a\u4e5f\u5c31\u53ea\u6709\u4e00\u4e2a\u3002</p> <p>MapTask\u7c7b\u7684706\u884c\u662f\u5185\u90e8\u7c7b\u73af\u5f62\u7f13\u51b2\u533a\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u8be5\u6784\u9020\u65b9\u6cd5\u4f1a\u5148\u4e8e\u81ea\u5b9a\u4e49\u7684map()\u65b9\u6cd5\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u73af\u5f62\u7f13\u51b2\u7684\u521b\u5efa\u5148\u4e8emap()\u65b9\u6cd5\u7684\u6267\u884c\uff08MapTask\u7c7b\u7684runNewMapper()\u65b9\u6cd5\u4e2d\uff0c783\u884c\u4f1a\u5148new NewOutputCollector()\uff0c\u7136\u540e\u6267\u884c800\u884cmapper.run(mapperContext);\uff0c\u8fd9\u4e2amapper.run()\u5c31\u662fMapper\u7c7b\u7684run\u65b9\u6cd5\uff0c\u524d\u9762\u8bb2\u8fc7\u8fd9\u4e2arun()\u65b9\u6cd5\u662fMapReduce\u7684Map\u9636\u6bb5\u7684\u6a21\u677f\u65b9\u6cd5\uff0c\u7531run\u65b9\u6cd5\u8c03\u7528map()\u65b9\u6cd5\uff09\uff0c\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u7684712\u884c\u662f\u6839\u636eReduceTask\u7684\u6570\u91cf\u51b3\u5b9a\u5206\u533a\u6570\u91cf\uff0c\u7136\u540e\u518d\u6839\u636e\u5206\u533a\u6570\u91cf\u51b3\u5b9apartitioner\uff0cpartitioner\u7684getPartition()\u65b9\u6cd5\u5c31\u662f\u51b3\u5b9a\u5206\u533a\u65f6\u8c03\u7528\u7684\u65b9\u6cd5\u3002\u81ea\u5b9a\u4e49\u7684map()\u65b9\u6cd5\u6700\u540e\u7684context.write()\u4f1a\u8c03\u7528partitioner\u7684getPartition()\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u5206\u533a\u662f\u5728Map\u5411\u73af\u5f62\u7f13\u51b2\u533a\u5199\u6570\u636e\u65f6\u5c31\u5df2\u7ecf\u8ba1\u7b97\u597d\uff0c\u800c\u4e0d\u662f\u7b49\u5230\u6ea2\u5199\u518d\u8ba1\u7b97\u3002</p> <p>\u5982\u679c\u4e0d\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u6b64\u65f6\u5206\u533a\u4e5f\u5c31\u53ea\u6709\u4e00\u4e2a\uff0c\u56e0\u4e3apartitioner\u5c31\u662felse\u4e2d\u7684\u533f\u540d\u5185\u90e8\u7c7b\uff0cgetPartition()\u65b9\u6cd5\u6c38\u8fdc\u8fd4\u56de0\u3002\u6240\u4ee5\u5f53ReduceTask\u53ea\u67091\u4e2a\u65f6\uff0c\u5373\u4f7f\u4f60\u5728Driver\u91cc\u8bbe\u7f6e\u4e86\u5206\u533a\u65b9\u6cd5\u6240\u5728\u7684\u7c7bjob.setPartitionerClass(); partitioner\u4e5f\u4e0d\u4f1a\u662f\u4f60\u81ea\u5b9a\u4e49\u7684\u7c7b\uff0c\u800c\u662f\u8fd9\u4e2a\u533f\u540d\u5185\u90e8\u7c7b\uff0c\u5206\u533a\u6c38\u8fdc\u53ea\u67091\u4e2a\u3002 Text Only<pre><code>NewOutputCollector(org.apache.hadoop.mapreduce.JobContext jobContext,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0JobConf job,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TaskUmbilicalProtocol umbilical,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TaskReporter reporter\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0) throws IOException, ClassNotFoundException {\n\u00a0\u00a0collector = createSortingCollector(job, reporter);\n `partitions = jobContext.getNumReduceTasks();`\n\u00a0\u00a0if (partitions &gt; 1) {\n\u00a0\u00a0\u00a0\u00a0partitioner = (org.apache.hadoop.mapreduce.Partitioner&lt;K,V&gt;)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ReflectionUtils.newInstance(`jobContext.getPartitionerClass()`, job);\n\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0partitioner = new org.apache.hadoop.mapreduce.Partitioner&lt;K,V&gt;() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public int getPartition(K key, V value, int numPartitions) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return partitions - 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5728Driver\u7c7b\u4e2d\u53ef\u4ee5\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\uff0c\u6bd4\u5982\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\u4e3a2\uff1ajob.setNumReduceTasks(2); \u90a3\u4e48\u5206\u533a\u7684\u6570\u91cf\u4e5f\u662f2\uff0c\u4e8e\u662f\u5c31\u4f1a\u8d70NewOutputCollector()\u65b9\u6cd5\u4e2d\u7684else\uff0cnew\u5f97\u5230\u7684partitioner\u5176\u5b9e\u662f\u9ed8\u8ba4\u7684HashPartitioner\u7684\u5b9e\u4f8b\uff0cHashPartitioner\u7684getPartition()\u65b9\u6cd5\u5982\u4e0b\uff0c\u8fd9\u662f\u5f53ReduceTask\u6570\u91cf\u5927\u4e8e1\u65f6\u9ed8\u8ba4\u7684\u8ba1\u7b97\u5206\u533a\u7684\u65b9\u6cd5\uff0c\u8ba1\u7b97\u903b\u8f91\u662f\u7528HashCode\u5bf9numReduceTasks\u53d6\u4f59\u3002 Text Only<pre><code>public int getPartition(K key, V value,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int numReduceTasks) {\n\u00a0\u00a0return (key.hashCode() &amp; Integer.MAX_VALUE) % numReduceTasks;\n}\n</code></pre></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u8ba1\u7b97\u5206\u533a\u7684\u65b9\u6cd5\uff0c\u5728\u81ea\u5b9a\u4e49\u5206\u533a\u65b9\u6cd5\u4e2d\uff0c\u53ef\u4ee5\u4efb\u610f\u6307\u5b9a\u5206\u533a\u8ba1\u7b97\u7684\u89c4\u5219\uff0c\u4e0d\u4e00\u5b9a\u975e\u5f97\u6309key\u6765\u8ba1\u7b97\uff0c\u8fd8\u53ef\u4ee5\u6309value\u6765\u8ba1\u7b97\u3002\u81ea\u5b9a\u4e49\u5b8c\u540e\uff0c\u9700\u8981\u8bbe\u7f6e\u5206\u533a\u65b9\u6cd5\u6240\u5728\u7684\u7c7b job.setPartitionerClass()\uff0c\u8fd9\u6837NewOutputCollector()\u65b9\u6cd5\u4e2d\u7684else\u6240new\u7684Partitioner\u5c31\u662f\u6211\u4eec\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e86\u3002   \u4e0e MapTask \u7684\u5e76\u53d1\u6570\u7531\u5207\u7247\u6570\u51b3\u5b9a\u4e0d\u540c\uff0c ReduceTask \u6570\u91cf\u662f\u624b\u52a8\u8bbe\u7f6e\u51b3\u5b9a\u7684\uff0cReduceTask\u6570\u91cf\u4e00\u822c\u8981\u4e0e\u5206\u533a\u6570\u91cf\u8bbe\u7f6e\u76f8\u540c\uff0c\u6240\u4ee5\u53ef\u4ee5\u8bf4ReduceTask\u7684\u5e76\u884c\u5ea6\u662f\u7531\u5206\u533a\u6570\u91cf\u51b3\u5b9a\u7684\uff08\u5f53\u7136\u53ef\u4ee5\u628aReduceTask \u6570\u91cf\u8bbe\u7f6e\u6210\u4e0e\u5206\u533a\u6570\u91cf\u4e0d\u4e00\u81f4\uff0c\u4f46\u8fd9\u6837\u51fa\u73b0\u4e0a\u9762\u8bf4\u7684\u95ee\u9898\uff09\u3002</p> <p>\u6848\u4f8b\uff1a\u7ee7\u7eed\u524d\u9762\u7684\u7edf\u8ba1\u624b\u673a\u53f7\u6d41\u91cf\u7684\u4f8b\u5b50\u3002 \u7edf\u8ba1\u6bcf\u4e00\u4e2a\u624b\u673a\u53f7\u8017\u8d39\u7684\u603b\u4e0a\u884c\u6d41\u91cf\u3001 \u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf\uff1b\u5e76\u6309\u624b\u673a\u53f7\u7684\u5f52\u5c5e\u5730\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\u53bb\u3002</p> <p>\u81ea\u5b9a\u4e49\u5206\u533a\u65b9\u6cd5\uff1a Text Only<pre><code>public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int getPartition(Text text, FlowBean flowBean, int numPartitions) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// text \u662f\u624b\u673a\u53f7\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String phone = text.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String prePhone = phone.substring(0, 3);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int partition ;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0switch (prePhone) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"136\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0partition = 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"137\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0partition = 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"138\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0partition = 2;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"139\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0partition = 3;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0default:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0partition = 4;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return partition;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4fee\u6539Driver\u7c7b\uff0c\u4e3b\u8981\u662f\u8bbe\u7f6e\u5206\u533a\u7684\u7c7b job.setPartitionerClass(ProvincePartitioner.class); \u548c\u00a0ReduceTask\u7684\u6570\u91cf job.setNumReduceTasks(5); \uff0cReduceTask\u7684\u6570\u91cf\u5fc5\u987b\u8981\u4e0e\u5206\u533a\u6570\u4e00\u81f4\u3002 Text Only<pre><code>public class FlowDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6ejar\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(FlowDriver.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper \u548cReducer\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(FlowMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(FlowReducer.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6emapper \u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(FlowBean.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u6570\u636e\u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(FlowBean.class);\n\n `//\u8bbe\u7f6e\u5206\u533a\u65b9\u6cd5\u6240\u5728\u7684\u7c7b`\n `job.setPartitionerClass(ProvincePartitioner.class);`\n `//\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf`\n `job.setNumReduceTasks(5);`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u7c7b\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(classPath);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 6 \u8bbe\u7f6e\u6570\u636e\u7684\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(classPath + \"/input/phone_data.txt\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output\"));\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean result = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(result ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Map\u3001Reduce\u3001\u81ea\u5b9a\u4e49\u7684\u5e8f\u5217\u5316\u5bf9\u8c61 \u7684\u4ee3\u7801 \u548c\u4e4b\u524d\u7edf\u8ba1\u624b\u673a\u6d41\u91cf\u7684\u4f8b\u5b50\u4e00\u6837\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/9-Shuffle%E4%B9%8B%E6%8E%92%E5%BA%8F/","title":"9-Shuffle\u4e4b\u6392\u5e8f","text":"<p> \u7ea6 2120 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 42 \u5206\u949f</p> <p>\u6392\u5e8f\u662fMapReduce\u6846\u67b6\u6700\u91cd\u8981\u7684\u64cd\u4f5c\u4e4b\u4e00\uff0cMapTask \u548c ReduceTask \u7684 Shuffle\u9636\u6bb5\u90fd\u4f1a\u5bf9k-v\u952e\u503c\u5bf9\u6309k\u7684\u5927\u5c0f\u8fdb\u884c\u6392\u5e8f\uff0c\u6240\u4ee5\u4f5c\u4e3akey\u7684\u5bf9\u8c61\u9664\u4e86\u5fc5\u987b\u5b9e\u73b0Hadoop\u7684\u5e8f\u5217\u5316\u4e4b\u5916\uff0c\u8fd8\u5fc5\u987b\u8981\u6c42\u80fd\u6bd4\u8f83\u5927\u5c0f\uff0c\u800c\u4f5c\u4e3avalue\u7684\u5bf9\u8c61\u53ea\u8981\u6c42\u5b9e\u73b0\u5e8f\u5217\u5316\u3002\u53ef\u4ee5\u770b\u51fa\u5e8f\u5217\u5316\u662fkey\u548cvalue\u90fd\u5fc5\u987b\u5b9e\u73b0\uff0c\u800c\u6bd4\u8f83\u5927\u5c0f\u53ea\u662fkey\u5fc5\u987b\u5b9e\u73b0\uff0c\u6240\u4ee5\u81ea\u5b9a\u4e49\u5bf9\u8c61\u65f6\uff0c\u4f5c\u4e3akey\u7684\u7c7b\u5fc5\u987b\u5b9e\u73b0WritableCompare\u63a5\u53e3\uff0c\u4f5c\u4e3avalue\u7684\u7c7b\u53ef\u4ee5\u53ea\u5b9e\u73b0Writable\u63a5\u53e3\u3002</p> <p>\u6848\u4f8b\uff1a\u5728\u524d\u9762\u8bb2\u5e8f\u5217\u5316\u65f6\u7edf\u8ba1\u4e86\u6bcf\u4e00\u4e2a\u624b\u673a\u53f7\u8017\u8d39\u7684\u603b\u4e0a\u884c\u6d41\u91cf\u3001 \u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf\uff0c\u672c\u6848\u4f8b\u7684\u8981\u6c42\u662f\u6309\u6bcf\u4e2a\u624b\u673a\u53f7\u7684\u603b\u6d41\u91cf\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u8f93\u51fa\u3002 \u5206\u6790\uff1a1.\u672c\u6848\u4f8b\u53ea\u80fd\u57fa\u4e8e\u4e0a\u4e00\u4e2a\u6848\u4f8b\u7684\u7ed3\u679c\u4f5c\u4e3a\u8f93\u5165\uff0c\u5e76\u4e0d\u80fd\u4e00\u6b65\u5230\u4f4d\uff0c\u53ea\u7528\u4e00\u4e2aMapReduce\u8fc7\u7a0b\u89e3\u51b3\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 2.\u9700\u8981\u6309\u603b\u6d41\u91cf\u7684\u5927\u5c0f\u6392\u5e8f\uff0c\u6240\u4ee5\u5e94\u8be5\u628a\u5305\u542b\u603b\u6d41\u91cf\u7684bean\u5bf9\u8c61\u4f5c\u4e3akey</p> <p>\u81ea\u5b9a\u4e49\u7684bean\u5bf9\u8c61\u7684\u7c7b\u9700\u8981\u5b9e\u73b0WritableComparable\u63a5\u53e3\uff0c\u91cd\u5199compareTo\u65b9\u6cd5 Text Only<pre><code>public class FlowBean implements WritableComparable&lt;FlowBean&gt; {\n\u00a0\u00a0\u00a0\u00a0private long upFlow; // \u4e0a\u884c\u6d41\u91cf\n\u00a0\u00a0\u00a0\u00a0private long downFlow; // \u4e0b\u884c\u6d41\u91cf\n\u00a0\u00a0\u00a0\u00a0private long sumFlow; // \u603b\u6d41\u91cf\n\n\u00a0\u00a0\u00a0\u00a0// \u7a7a\u53c2\u6784\u9020\n\u00a0\u00a0\u00a0\u00a0public FlowBean() {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getUpFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return upFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setUpFlow(long upFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.upFlow = upFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getDownFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setDownFlow(long downFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.downFlow = downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getSumFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setSumFlow(long sumFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setSumFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = this.upFlow + this.downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void write(DataOutput out) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(upFlow);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(downFlow);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(sumFlow);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void readFields(DataInput in) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.upFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.downFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String toString() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n `@Override`\n `public int compareTo(FlowBean o) {`\n `// \u603b\u6d41\u91cf\u7684\u5012\u5e8f\u6392\u5e8f`\n `if (this.sumFlow &gt; o.sumFlow) {`\n `return -1;`\n `} else if (this.sumFlow &lt; o.sumFlow) {`\n `return 1;`\n `} else {`\n `return 0;`\n `}`\n `}`\n}\n</code></pre></p> <p>Map\u7684\u8f93\u51fa\u9700\u8981\u5c06bean\u5bf9\u8c61\u4f5c\u4e3akey\uff0c\u5c06\u624b\u673a\u53f7\u4f5c\u4e3avalue\uff0c\u4e0e\u7edf\u8ba1\u4e0a\u4e2a\u6848\u4f8b\u4e2d\u7edf\u8ba1\u6bcf\u4e2a\u624b\u673a\u53f7\u603b\u6d41\u91cf\u65f6\u6b63\u597d\u76f8\u53cd Text Only<pre><code>public class FlowMapper extends Mapper&lt;LongWritable, Text, FlowBean, Text&gt; {\n\n\u00a0\u00a0\u00a0\u00a0private FlowBean outK = new FlowBean();\n\u00a0\u00a0\u00a0\u00a0private Text outV = new Text();\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u83b7\u53d6\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5207\u5272\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = line.split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.set(split[0]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.setUpFlow(Long.parseLong(split[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.setDownFlow(Long.parseLong(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.setSumFlow();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(outK, outV);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Reduce\u7684\u8f93\u5165\u5df2\u7ecf\u662fShuffle\u9636\u6bb5\u6392\u597d\u5e8f\u7684\u7ed3\u679c\uff0c\u4ecd\u8981\u4ee5\u624b\u673a\u53f7\u3001\u603b\u4e0a\u884c\u6d41\u91cf\u3001 \u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf\u7684\u683c\u5f0f\u8f93\u51fa\u7684\u8bdd\uff0c\u90a3\u4e48Reduce\u7684\u4efb\u52a1\u5c31\u662f\u5c06\u8f93\u5165k-v\u4e92\u6362\u4f4d\u7f6e\u3002 Text Only<pre><code>public class FlowReducer extends Reducer&lt;FlowBean, Text, Text, FlowBean&gt; {\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(FlowBean key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Text value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(value, key);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u70b9\u7684\u662f\uff0c\u5728\u524d\u9762\u8bb2WordCount\u65f6\uff0c\u6211\u4eec\u8bf4map\u7684\u8f93\u51fa\u7ed3\u679c\u662f (a,1)\u3001(b,1)\u3001(a,1)\uff0c\u7ecf\u8fc7Shuffle\u6392\u5e8f\u4e4b\u540e\uff0cReduce\u7684\u8f93\u5165\u53d8\u6210\u4e86 (a, (1,1))\u3001(b,1) \u662f\u4e0d\u5bf9\u7684\uff0c\u5176\u5b9e\u662f\u8fd9\u6837\u7684(a,1)\u3001(a,1)\u3001(b,1)\uff0c\u5177\u6709\u76f8\u540ckey\u7684k-v\u952e\u503c\u5bf9\u4f1a\u4f5c\u4e3a\u4e00\u7ec4\u8fdb\u5165reduce()\u65b9\u6cd5\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u76f8\u540c\u7684key\uff0c\u5e76\u4e0d\u662f\u8bf4key\u5b8c\u5168\u4e00\u6a21\u4e00\u6837\uff0c\u800c\u662f\u8bf4\u5728compareTo\u7684\u6bd4\u8f83\u89c4\u5219\u4e0b\u4e00\u6837\uff0c\u4e4b\u540e\u5728for\u5faa\u73af\u91cc\u5904\u7406\u65f6\uff0c\u770b\u4f3c\u53ea\u662f\u6539\u53d8\u4e86value\uff0c\u5176\u5b9ekey\u4e5f\u8ddf\u5728\u5728\u4e00\u8d77\u53d8\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u53ea\u9700\u8981\u5728for\u5faa\u73af\u91cc\u5c06value\u548ckey\u4e92\u6362\u4f4d\u7f6e\u5373\u53ef\u8f93\u51fa\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <p>\u90a3\u4e3a\u4ec0\u4e48key\u4e5f\u4f1a\u8ddf\u7740\u4e00\u8d77\u53d8\u5462\uff1f\u8ffd\u6eaf\u6e90\u7801\u5c31\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e86\u3002</p> <p>\u9996\u5148Reducer\u7684\u6a21\u677f\u65b9\u6cd5run\u91cc\u7684\u00a0while (context.nextKey()) \uff0ccontext\u662f\u62bd\u8c61\u5185\u90e8\u7c7bContext\u7684\u5f15\u7528\uff0cContext\u6709\u4e2a\u5b50\u7c7b\u662fWrappedReducer\u7684\u5185\u90e8\u7c7bContext\uff0c\u6240\u4ee5context.nextKey()\u6700\u7ec8\u8c03\u7528\u7684\u662fWrappedReducer\u7684\u5185\u90e8\u7c7bContext\u7684\u65b9\u6cd5\uff0c\u800cWrappedReducer::Context\u7684\u65b9\u6cd5\u90fd\u662f\u59d4\u6258\u7ed9\u4e86ReduceContext\u7684\u65b9\u6cd5\uff0cReduceContext\u53ea\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5b83\u7684\u5b9e\u73b0\u7c7b\u662fReduceContextImpl\uff0c\u6240\u4ee5\u6700\u7ec8\u90fd\u662f\u8c03\u7528\u7684ReduceContextImpl\u7684\u65b9\u6cd5\u3002key\u548cvalue\u662fReduceContextImpl\u7684\u6210\u5458\u53d8\u91cf\uff0c\u5f53\u8c03\u7528\u5176nextKey()\u65b9\u6cd5\u65f6\uff0c\u5982\u679c\u8fd8\u6709\u4e0b\u4e00\u4e2a\uff0c\u5c31\u4f1a\u8c03\u7528nextKeyValue()\u65b9\u6cd5\u5e76\u8fd4\u56detrue\uff0c\u5728nextKeyValue()\u65b9\u6cd5\u7684142\u884ckey = keyDeserializer.deserialize(key);\u548c146\u884cvalue = valueDeserializer.deserialize(value);\u662f\u53cd\u5e8f\u5217k-v\u5230\u5185\u5b58\u4e2d\u5e76\u8d4b\u7ed9ReduceContextImpl\u7684\u6210\u5458\u53d8\u91cfkey\u548cvalue\uff0c\u81f3\u6b64context.nextKey()\u5c31\u6267\u884c\u5b8c\u4e86\u3002\u7136\u540e\u8c03\u7528reduce(context.getCurrentKey(), context.getValues(), context);\u62ff\u5230ReduceContextImpl\u7684\u6210\u5458\u53d8\u91cfkey\u548cvalue\u8fdb\u5165\u81ea\u5b9a\u4e49\u7684reduce()\u65b9\u6cd5\u3002</p> <p>reduce()\u65b9\u6cd5\u4e2d\u7684\u589e\u5f3afor\u5faa\u73af\u7f16\u8bd1\u7684\u7ed3\u679c\u5176\u5b9e\u662f\u4f7f\u7528\u8fed\u4ee3\u5668\u5b8c\u6210\u904d\u5386\uff0cvalues\u7684\u8fd4\u56de\u7684\u8fed\u4ee3\u5668\u662f ReduceContextImpl\u7684\u5185\u90e8\u7c7bValueIterator\uff0c\u904d\u5386\u7684\u8fc7\u7a0b\u5c31\u662f\u8c03\u7528ValueIterator\u7684hasNext()\u65b9\u6cd5\u5224\u65ad\u6709\u6ca1\u6709\u4e0b\u4e00\u4e2a\uff0c\u8c03\u7528next()\u65b9\u6cd5\u62ff\u5230\u4e0b\u4e00\u4e2a\uff0c\u5728next()\u65b9\u6cd5\u7684239\u884c\u8c03\u7528\u4e86nextKeyValue()\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4ReduceContextImpl\u7684\u6210\u5458\u53d8\u91cfkey\u548cvalue\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u53cd\u5e8f\u5217\u5316\u8d4b\u4e88\u4e86\u65b0\u7684\u503c\uff0c\u867d\u7136\u5728reduce()\u65b9\u6cd5\u7684for\u5faa\u73af\u91cc\u6ca1\u6709\u8c03\u7528\u91cd\u65b0\u8c03\u7528context.getCurrentKey(), context.getValues()\u62ff\u5230\u6210\u5458\u53d8\u91cfkey\u548cvalue\uff0c\u4f46\u6211\u60f3\u662f\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5\u5176\u5b9e\u5e76\u6ca1\u6709\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\uff0c\u800c\u53ea\u662f\u4fee\u6539\u4e86\u539f\u6765\u7684\u5bf9\u8c61\u7684\u503c\uff0c\u6240\u4ee5\u867d\u7136key\u548cvalue\u7684\u5f15\u7528\u503c\u6ca1\u6709\u6539\u53d8\uff0c\u4f46\u662f\u5f15\u7528\u7684\u5bf9\u8c61\u4e2d\u7684\u5185\u5bb9\u5374\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u8fd9\u5c31\u662f<code>\u4f7f\u7528\u8fed\u4ee3\u5668\u904d\u5386\u7684\u4f18\u52bf\u548c\u7279\u70b9\u2014\u2014\u53d6\u4e0b\u4e00\u4e2a\u503c\u7684\u903b\u8f91\u90fd\u5c01\u88c5\u5728\u4e86next()\u65b9\u6cd5\u4e2d</code>\u3002</p> <p>\u603b\u7ed3\u4e00\u53e5\u8bdd\uff0c\u5728reduce()\u65b9\u6cd5\u4e2dkey\u548cvalue\u7684\u503c\u81ea\u59cb\u81f3\u7ec8\u90fd\u6ca1\u6709\u6539\u53d8\uff0c\u6539\u53d8\u7684\u662f\u5b83\u4eec\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u3002</p> <p>\u6700\u540e\u7684Driver\u7c7b\u53ea\u9700\u8981\u628a\u8f93\u5165\u8def\u5f84\u6539\u6210\u4e0a\u4e00\u4e2a\u6848\u4f8b\u8f93\u51fa\u7684\u6587\u4ef6\uff0c\u628a\u8f93\u51fa\u8def\u5f84\u6539\u6210\u65b0\u6587\u4ef6\u5939\u5373\u53ef\u3002 Text Only<pre><code>public class FlowDriver {\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6ejar\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(FlowDriver.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper \u548cReducer\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(FlowMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(FlowReducer.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6emapper \u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(FlowBean.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(Text.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u6570\u636e\u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(FlowBean.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\n `// 6 \u8bbe\u7f6e\u6570\u636e\u7684\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84`\n `FileInputFormat.setInputPaths(job, new Path(classPath + \"/output/part-r-00000\"));`\n `FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output2\"));`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean result = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(result ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p><code>\u5206\u533a\u6392\u5e8f\u7efc\u5408\u6848\u4f8b</code>\uff1a\u6309\u624b\u673a\u53f7\u7684\u5f52\u5c5e\u5730\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\uff0c\u6bcf\u4e2a\u6587\u4ef6\u4e2d\u7684\u8bb0\u5f55\u6309\u6bcf\u4e2a\u624b\u673a\u53f7\u7684\u603b\u6d41\u91cf\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u5982\u679c\u603b\u6d41\u91cf\u76f8\u540c\u5219\u6309\u4e0b\u884c\u6d41\u91cf\u6392\u5e8f\uff0c\u5982\u679c\u4e0b\u884c\u6d41\u91cf\u76f8\u540c\u5219\u6309\u4e0a\u884c\u6d41\u91cf\u6392\u5e8f\u3002 \u81ea\u5b9a\u4e49\u7684bean\u5bf9\u8c61\u7684\u7c7b\u9700\u8981\u5b9e\u73b0WritableComparable\u63a5\u53e3\uff0c\u91cd\u5199write()\u65b9\u6cd5\u3001readFields()\u65b9\u6cd5\u3001compareTo\u65b9\u6cd5 Text Only<pre><code>public class FlowBean implements WritableComparable&lt;FlowBean&gt; {\n\u00a0\u00a0\u00a0\u00a0private long upFlow; // \u4e0a\u884c\u6d41\u91cf\n\u00a0\u00a0\u00a0\u00a0private long downFlow; // \u4e0b\u884c\u6d41\u91cf\n\u00a0\u00a0\u00a0\u00a0private long sumFlow; // \u603b\u6d41\u91cf\n\n\u00a0\u00a0\u00a0\u00a0// \u7a7a\u53c2\u6784\u9020\n\u00a0\u00a0\u00a0\u00a0public FlowBean() {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getUpFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return upFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setUpFlow(long upFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.upFlow = upFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getDownFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setDownFlow(long downFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.downFlow = downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public long getSumFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setSumFlow(long sumFlow) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void setSumFlow() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = this.upFlow + this.downFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void write(DataOutput out) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(upFlow);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(downFlow);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeLong(sumFlow);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void readFields(DataInput in) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.upFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.downFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.sumFlow = in.readLong();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String toString() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return upFlow + \"\\t\" + downFlow + \"\\t\" + sumFlow;\n\u00a0\u00a0\u00a0\u00a0}\n\n `@Override`\n `public int compareTo(FlowBean o) {`\n `// \u603b\u6d41\u91cf\u4ece\u5927\u5230\u5c0f\u6392\u5e8f`\n `int result =\u00a0\u00a0Long.compare(this.sumFlow, o.sumFlow);`\n `if (result == 0) {`\n `// \u4e0b\u884c\u6d41\u91cf\u4ece\u5927\u5230\u5c0f\u6392\u5e8f`\n `result = Long.compare(this.downFlow, o.downFlow);`\n `if (result == 0) {`\n `// \u4e0a\u884c\u6d41\u91cf\u4ece\u5927\u5230\u5c0f\u6392\u5e8f`\n `result = Long.compare(this.upFlow, o.upFlow);`\n `}`\n `}`\n `return -result;`\n `}`\n}\n</code></pre></p> <p>\u8be5\u6848\u4f8b\u8fd8\u662f\u9700\u8981\u57fa\u4e8e\u7edf\u8ba1\u6bcf\u4e00\u4e2a\u624b\u673a\u53f7\u8017\u8d39\u7684\u603b\u4e0a\u884c\u6d41\u91cf\u3001 \u603b\u4e0b\u884c\u6d41\u91cf\u3001\u603b\u6d41\u91cf\u7684\u6848\u4f8b\u7684\u7ed3\u679c map\u7684\u8f93\u51fa\u9700\u8981\u5c06bean\u5bf9\u8c61\u4f5c\u4e3akey\uff0c\u5c06\u624b\u673a\u53f7\u4f5c\u4e3avalue Text Only<pre><code>public class FlowMapper extends Mapper&lt;LongWritable, Text, `FlowBean, Text`&gt; {\n\u00a0\u00a0\u00a0\u00a0private FlowBean outK = new FlowBean();\n\u00a0\u00a0\u00a0\u00a0private Text outV = new Text();\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u83b7\u53d6\u4e00\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = value.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5207\u5272\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = line.split(\"\\t\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5c01\u88c5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outV.set(split[0]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.setUpFlow(Long.parseLong(split[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.setDownFlow(Long.parseLong(split[2]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0outK.setSumFlow();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5199\u51fa\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(outK, outV);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5206\u533a\u65b9\u6cd5\u4ee5map\u8f93\u51fa\u7684value\u4f5c\u4e3a\u5206\u533a\u7684\u4f9d\u636e\uff0c\u8fd9\u4e5f\u662f\u4e0e\u524d\u9762\u4ee5key\u4f5c\u4e3a\u5206\u533a\u4f9d\u636e\u7684\u4e0d\u540c Text Only<pre><code>public class ProvincePartitioner extends Partitioner&lt;`FlowBean, Text`&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int getPartition(`FlowBean flowBean, Text text`, int numPartitions) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// text \u662f\u624b\u673a\u53f7\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String phone = text.toString();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String prePhone = phone.substring(0, 3);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0switch (prePhone) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"136\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 0;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"137\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"138\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 2;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"139\":\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 3;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0default:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 4;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Reduce\u7684\u4efb\u52a1\u662f\u5c06Map\u8f93\u51fa\u7684k-v\u7684\u4f4d\u7f6e\u8fdb\u884c\u4e92\u6362\uff0c\u4ee5\u6ee1\u8db3\u8f93\u51fa\u683c\u5f0f\u7684\u8981\u6c42 Text Only<pre><code>public class FlowReducer extends Reducer&lt;FlowBean, Text, Text, FlowBean&gt; {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(FlowBean key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Text value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(value,key);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>Driver\u7c7b\u9700\u8981\u8bbe\u7f6e\u5206\u533a\u65b9\u6cd5\u6240\u5728\u7684\u7c7b job.setPartitionerClass(ProvincePartitioner.class); \u548c\u00a0ReduceTask\u7684\u6570\u91cf job.setNumReduceTasks(5); \u6ce8\u610fReduceTask\u7684\u6570\u91cf\u5fc5\u987b\u8981\u4e0e\u5206\u533a\u6570\u4e00\u81f4\u3002 Text Only<pre><code>public class FlowDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Configuration conf = new Configuration();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(conf);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u8bbe\u7f6ejar\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(FlowDriver.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u5173\u8054mapper \u548cReducer\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(FlowMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(FlowReducer.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 4 \u8bbe\u7f6emapper \u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(FlowBean.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(Text.class);\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 5 \u8bbe\u7f6e\u6700\u7ec8\u6570\u636e\u8f93\u51fa\u7684key\u548cvalue\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(Text.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(FlowBean.class);\n\n `//\u8bbe\u7f6e\u5206\u533a\u65b9\u6cd5\u6240\u5728\u7684\u7c7b`\n `job.setPartitionerClass(ProvincePartitioner.class);`\n `//\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf`\n `job.setNumReduceTasks(5);`\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 6 \u8bbe\u7f6e\u6570\u636e\u7684\u8f93\u5165\u8def\u5f84\u548c\u8f93\u51fa\u8def\u5f84\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(classPath + \"/output/part-r-00000\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/output3\"));\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 7 \u63d0\u4ea4job\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean result = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(result ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/1-Hive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","title":"1-Hive\u5b89\u88c5\u914d\u7f6e","text":"<p> \u7ea6 2024 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 40 \u5206\u949f</p> <p>1.\u4e0b\u8f7d\u5730\u5740 https://dlcdn.apache.org/hive/hive-3.1.2/\u00a0 \uff0c\u76ee\u524d\u8fd9\u4e2a\u7248\u672c\u4e0d\u652f\u6301jdk8\u4ee5\u4e0b\u7684\u7248\u672c\uff0c\u6240\u4ee5\u8fd8\u662f\u5b89\u88c5jdk8\u7a33\u59a5\u3002 2.\u89e3\u538b tar -zxvf /opt/software/apache-hive-3.1.2-bin.tar.gz -C /opt/module/ 3.\u91cd\u547d\u540d mv /opt/module/apache-hive-3.1.2-bin /opt/module/hive-3.1.2 4. \u4fee\u6539/etc/profile.d/my_env.sh\uff0c \u6dfb\u52a0\u73af\u5883\u53d8\u91cf \u00a0 \u00a0 sudo vim /etc/profile.d/my_env.sh Text Only<pre><code>#HIVE_HOME\nexport HIVE_HOME=/opt/module/hive-3.1.2\nexport PATH=$PATH:$HIVE_HOME/bin\n</code></pre> 5. \u89e3\u51b3\u65e5\u5fd7 Jar \u5305\u51b2\u7a81 \u00a0 \u00a0mv $HIVE_HOME/lib/log4j-slf4j-impl-2.10.0.jar $HIVE_HOME/lib/log4j-slf4j-impl-2.10.0.bak 6. \u521d\u59cb\u5316\u5143\u6570\u636e\u5e93 schematool -dbType derby -initSchema \u00a0\u00a0 \u00a0\u8fd9\u91cc\u4f7f\u7528\u7684\u662fhive\u81ea\u5e26\u7684\u9ed8\u8ba4\u6570\u636e\u5e93 derby\uff0c\u540e\u9762\u4f1a\u6539\u6210\u4f7f\u7528mysql\uff0c\u4f7f\u7528 derby \u521d\u59cb\u5316\u5143\u6570\u636e\u5e93\uff0c\u4f1a\u5728\u5f53\u524d\u6267\u884c\u7684\u8fd9\u6761\u547d\u4ee4\u7684\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2aderby.log\u6587\u4ef6\u548c\u4e00\u4e2ametastore_db\u76ee\u5f55\uff0c\u4ee5\u540e\u53ea\u80fd\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u8f93\u5165hive\u6765\u542f\u52a8Hive\uff0c\u5e76\u4e14\u53ea\u80fd\u5f00\u542f\u4e00\u4e2aHive\uff0c\u56e0\u4e3a derby \u4e0d\u652f\u6301\u591a\u4e2a\u5ba2\u6237\u7aef\u8bbf\u95ee\uff0c\u5982\u679c\u60f3\u5f00\u542f\u591a\u4e2aHive\uff0c\u90a3\u5c31\u518d\u53bb\u5176\u5b83\u76ee\u5f55\u91cd\u65b0\u521d\u59cb\u5316\u5143\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u6b21\u8f93\u5165hive\u547d\u4ee4\u6765\u542f\u52a8Hive\u3002</p> <p>7.\u5728\u53e6\u4e00\u4e2a\u7ec8\u7aef\u4e2dtail -f /tmp/jmoon/hive.log \u5b9e\u65f6\u67e5\u770bHive \u7684\u65e5\u5fd7\uff0c\u6bd4\u5982\u63a5\u4e0b\u6765\u542f\u52a8Hive\u65f6\u5c31\u4f1a\u5411\u8fd9\u4e2a\u65e5\u5fd7\u6587\u4ef6\u4e2d\u5199\u6570\u636e\uff0c\u65e5\u5fd7\u6587\u4ef6\u7684\u4f4d\u7f6e\u53ef\u4ee5\u4fee\u6539\u3002</p> <p>8.\u542f\u52a8Hive\u7684\u547d\u4ee4\u662fhive\uff0c\u7136\u540e\u5c31\u8fdb\u5165\u5230\u4e86Hive\u7684\u547d\u4ee4\u884c\uff0c\u5982\u679c\u9000\u51fa\u8fd9\u4e2a\u547d\u4ee4\u884c\u4e5f\u5c31\u5173\u95ed\u4e86Hive\uff0c\u4ece\u8fd9\u70b9\u53ef\u4ee5\u770b\u51faHive\u9ed8\u8ba4\u7684\u542f\u52a8\u65b9\u5f0f\u5e76\u4e0d\u662f\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u8f93\u5165hive\u547d\u4ee4\u4e4b\u540e\u5e76\u6ca1\u6709\u5728\u540e\u53f0\u542f\u52a8\u4e00\u4e2aHive\u670d\u52a1\uff0c\u8fdb\u5165\u7684\u547d\u4ee4\u884c\u4e5f\u4e0d\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5ba2\u6237\u7aef\u8fdb\u7a0b\uff0c\u6b64\u65f6\u7684Hive\u53ea\u662f\u4e00\u4e2a\u7b49\u5f85\u6807\u51c6\u8f93\u5165\u7684\u524d\u53f0\u8fdb\u7a0b\uff0c\u9000\u51fa\u8fd9\u4e2a\u524d\u53f0\u8fdb\u7a0b\u4e5f\u5c31\u5173\u95ed\u4e86Hive\u3002\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3Hive\u9ed8\u8ba4\u7684\u8fd9\u4e2a\u547d\u4ee4\u884c\u53ea\u662f\u4e00\u4e2a\u7b49\u5f85\u6807\u51c6\u8f93\u5165\u7684scanner\u3002\u4e0d\u50cf\u5176\u5b83\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u67b6\u6784\u7684\u8f6f\u4ef6\uff0c\u5728\u5176\u5b83\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u67b6\u6784\u7684\u8f6f\u4ef6\u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u662f\u5206\u79bb\u7684\u4e24\u4e2a\u8f6f\u4ef6\uff08\u8fd0\u884c\u8d77\u6765\u53eb\u8fdb\u7a0b\uff09\uff0c\u9760\u7f51\u7edc\u6216\u5176\u5b83\u65b9\u5f0f\u8fdb\u884c\u901a\u4fe1\u3002 \u62ff\u6700\u5e38\u7528\u7684\u7f51\u7edc\u901a\u4fe1\u65b9\u5f0f\u6765\u8bf4\uff0c\u670d\u52a1\u5668\u4e00\u822c\u4e0d\u4f5c\u4e3a\u524d\u53f0\u8fdb\u7a0b\uff0c\u800c\u662f\u4f5c\u4e3a\u540e\u53f0\u8fdb\u7a0b\u4e00\u76f4\u76d1\u542c\u7f51\u7edcIO\uff0c\u5ba2\u6237\u7aef\u4f5c\u4e3a\u524d\u53f0\u8fdb\u7a0b\u542f\u52a8\uff0c\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u63a5\u6536\u6570\u636e\u7136\u540e\u5904\u7406\u3002\u6216\u8005\u4f7f\u7528\u672c\u5730\u7ba1\u9053\u8fdb\u884c\u901a\u4fe1\uff0c\u8fd9\u65f6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u90fd\u5e94\u8fd0\u884c\u5728\u540c\u4e00\u53f0\u4e3b\u673a\u4e0a\uff0c\u7136\u540e\u670d\u52a1\u5668\u4ecd\u662f\u4ee5\u540e\u53f0\u8fdb\u7a0b\u7684\u5f62\u5f0f\u4e00\u76f4\u76d1\u542c\u672c\u5730\u5185\u5b58\u4e2d\u7684\u7ba1\u9053\u6587\u4ef6\uff0c\u5ba2\u6237\u7aef\u8f6f\u4ef6\u4ee5\u524d\u53f0\u8fdb\u7a0b\u7684\u5f62\u5f0f\u542f\u52a8\uff0c\u7136\u540e\u5411\u672c\u5730\u5185\u5b58\u4e2d\u7684\u7ba1\u9053\u5199\u6570\u636e\uff0c\u670d\u52a1\u5668\u8fd9\u65f6\u5c31\u4f1a\u63a5\u6536\u5230\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c\u5904\u7406\u3002\uff08\u7ba1\u9053\u5e94\u8be5\u4e0d\u7b97\u662f\u672c\u5730io\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u56e0\u4e3aio\u7684\u610f\u601d\u662f\u8bfb\u5199\u5916\u90e8\u6587\u4ef6\uff0c\u53ea\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u6570\u636e\u7684\u8bfb\u5199\u4e0d\u7b97io\uff0c\u8bfb\u5199\u78c1\u76d8\u6216\u8005\u7f51\u7edc\u4e2d\u7684\u6587\u4ef6\u624d\u7b97io\uff09\u3002\u670d\u52a1\u5176\u5b9e\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u524d\u53f0\u8fdb\u7a0b\u5f00\u542f\uff0c\u53ea\u4e0d\u8fc7\u4f60\u628a\u524d\u53f0\u5173\u95ed\u4e86\u4e4b\u540e\u670d\u52a1\u4e5f\u5c31\u5173\u95ed\u4e86\uff0c\u670d\u52a1\u4e4b\u6240\u4ee5\u79f0\u4e4b\u4e3a\u670d\u52a1\uff0c\u662f\u56e0\u4e3a\u53ef\u4ee5\u5904\u7406\u5176\u5b83\u8fdb\u7a0b\u53d1\u8fc7\u6765\u7684\u8bf7\u6c42\uff08\u4e0d\u4e00\u5b9a\u8981\u5148\u5efa\u7acb\u8fde\u63a5\uff0c\u6bd4\u5982DNS\u670d\u52a1\uff0cDHCP\u670d\u52a1\uff09\u3002 \u5b9e\u73b0\u4e0a\u53ef\u4ee5\u8ba9Hive\u5f00\u542f\u4e00\u4e2a\u670d\u52a1\uff0c\u7b49\u5f85\u63a5\u6536\u5e76\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u3002\u4e0d\u8fc7\u4eceHive\u6240\u505a\u7684\u5de5\u4f5c\u6765\u770b\uff0c\u542f\u52a8\u670d\u52a1\u786e\u5b9e\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u56e0\u4e3aHive\u5b57\u662f\u4e00\u4e2a\u7ffb\u8bd1SQL\u7684\uff0c\u6570\u636e\u7531HDFS\u7ba1\uff0c\u5143\u6570\u636e\u7531\u6570\u636e\u5e93\u7ba1\uff0c\u5b83\u7684\u5de5\u4f5c\u53ea\u662f\u63a5\u6536\u4e00\u6761SQL\uff0c\u7136\u540e\u67e5\u6570\u636e\u5e93\u4e2d\u7684\u5143\u6570\u636e\uff0c\u7136\u540e\u7ffb\u8bd1\u6210MR\u7a0b\u5e8f\uff0c\u6700\u540e\u4ea4\u7ed9Yarn\u8c03\u5ea6\u8fd0\u884c\uff0c\u6240\u4ee5\u5982\u679c\u7528\u6237\u53ea\u662f\u60f3\u6267\u884c\u4e00\u6761sql\u7684\u8bdd\uff0c\u76f4\u63a5\u5728\u524d\u53f0\u63d0\u4ea4\u7ed9Hive\u5c31\u597d\u4e86\uff0c\u4f46\u5982\u679c\u60f3\u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u4e0eHive\u4ea4\u4e92\u90a3\u5c31\u5fc5\u987b\u8ba9Hive\u542f\u52a8\u670d\u52a1\u4e86\u3002</p> <p>9.\u4fee\u6539Hive\u65e5\u5fd7\u5b58\u653e\u7684\u4f4d\u7f6e Hive \u7684\u65e5\u5fd7\u9ed8\u8ba4\u5b58\u653e\u5728/tmp/jmoon \u5373\u7528\u6237\u76ee\u5f55\u4e0b\uff0c \u53ef\u4ee5\u628a\u65e5\u5fd7\u4fee\u6539\u5230 /opt/module/hive-3.1.2/logs \u76ee\u5f55\u4e0b\uff1a 9.1 \u5c06/opt/module/hive-3.1.2/conf/hive-log4j2.properties.template \u6587\u4ef6\u540d\u6539\u6210\u4e3ahive-log4j2.properties Text Only<pre><code>mv /opt/module/hive-3.1.2/conf/hive-log4j2.properties.template\u00a0\u00a0/opt/module/hive-3.1.2/conf/hive-log4j2.properties\n</code></pre> 9.2\u00a0 \u5728 hive-log4j2.properties \u6587\u4ef6\u4e2d\u4fee\u6539 log \u5b58\u653e\u4f4d\u7f6e Text Only<pre><code>hive.log.dir=/opt/module/hive-3.1.2/logs\n</code></pre></p> <p>Hive \u5143\u6570\u636e\u914d\u7f6e\u5230 MySQL\uff1a 1.\u5728linux\u4e2d\u5b89\u88c5mysql\uff0c\u6216\u8005\u4f7f\u7528Windows\u4e2d\u5df2\u7ecf\u5b89\u88c5\u597d\u7684mysql\uff0c\u672c\u6b21\u4f7f\u7528\u7684\u662fWindows\u4e2d\u7684mysql 2.\u4fee\u6539 mysql \u5e93\u4e0b\u7684 user \u8868\u4e2d\u7684 root \u7528\u6237\u5141\u8bb8\u4efb\u610f ip \u8fde\u63a5 Text Only<pre><code>update mysql.user set host='%' where user='root';\nflush privileges;\n</code></pre> 3.\u5c06 MySQL \u7684 JDBC \u9a71\u52a8\u62f7\u8d1d\u5230 Hive \u7684 lib \u76ee\u5f55\u4e0b 4.\u5728mysql\u4e2d\u65b0\u5efa Hive\u7684\u5143\u6570\u636e\u5e93 create database metastore; 5.\u5728$HIVE_HOME/conf \u76ee\u5f55\u4e0b\u65b0\u5efa hive-site.xml \u6587\u4ef6\u5e76\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff0chive\u662f\u901a\u8fc7javax.jdo.option.ConnectionURL\u53c2\u6570\u8fde\u63a5\u6570\u636e\u5e93\u7684\uff0c\u9ed8\u8ba4\u662fjdbc:derby:;databaseName=metastore_db;create=true\uff0c\u4e5f\u5c31\u662f derby \u00a0 \u00a0vim $HIVE_HOME/conf/hive-site.xml Text Only<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n\n\u00a0 \u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 URL --&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;jdbc:mysql://192.168.10.1:3306/metastore?serverTimezone=UTC&amp;amp;characterEncoding=utf-8&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 Driver--&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 username--&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;root&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 password --&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;123456&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0&lt;!-- Hive \u5143\u6570\u636e\u5b58\u50a8\u7248\u672c\u7684\u9a8c\u8bc1 --&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0&lt;!-- \u5143\u6570\u636e\u5b58\u50a8\u6388\u6743 --&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0&lt;!-- Hive \u9ed8\u8ba4\u5728 HDFS \u7684\u5de5\u4f5c\u76ee\u5f55 --&gt;\n\u00a0 \u00a0&lt;property&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;\n\u00a0 \u00a0 \u00a0 \u00a0&lt;value&gt;/user/hive/warehouse&lt;/value&gt;\n\u00a0 \u00a0&lt;/property&gt;\n\n\u00a0 \u00a0 &lt;!-- \u547d\u4ee4\u884c\u63d0\u793a\u7b26\u6253\u5370\u5f53\u524d\u5e93\u540d --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.cli.print.header&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;true&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u67e5\u8be2\u7ed3\u679c\u6253\u5370\u8868\u540d --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.cli.print.current.db&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;true&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre></p> <p>6. \u521d\u59cb\u5316 Hive \u5143\u6570\u636e\u5e93 \u00a0 \u00a0schematool -initSchema -dbType mysql -verbose 7. \u518d\u6b21\u542f\u52a8 Hive \u00a0 \u00a0 hive 8.Hive\u7684\u7b80\u5355\u64cd\u4f5c Hive\u547d\u4ee4\u884c\u7684\u7b80\u5355\u64cd\u4f5c\uff1a show databases; show tables; create table test(id int); \u521b\u5efa\u8868\u53ea\u662f\u5411mysql\u4e2d\u7684\u5143\u6570\u636e\u5e93\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u4e0d\u8d70MR\u3002 insert into test values(1); \u63d2\u5165\u4e00\u53f0\u6570\u636e\u4f1a\u8d70MR\u7136\u540e\u628a\u6570\u636e\u5199\u5230HDFS\u91cc\uff0c\u5e76\u4e14\u4e5f\u4f1a\u5411\u5143\u6570\u636e\u5e93\u66f4\u65b0\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982\u8868\u4e2d\u6709\u591a\u5c11\u884c\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u5143\u6570\u636e\u4fe1\u606f\u548cHDFS\u4e2d\u7684\u6570\u636e\u5176\u5b9e\u662f\u5206\u79bb\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5hdfs dfs -put\u5411HDFS\u4e2d\u5199\u6570\u636e\uff0c\u4f46\u8fd9\u6837\u5143\u6570\u636e\u4e0d\u4f1a\u66f4\u65b0\u3002 hive -e\u00a0 \u53ef\u4ee5\u4e0d\u8fdb\u5165 hive \u7684\u4ea4\u4e92\u7a97\u53e3\u6267\u884c sql \u8bed\u53e5\uff0c\u6bd4\u5982\uff1ahive -e \"select id from student;\" hive -f\u00a0 \u6267\u884c\u811a\u672c\u4e2d sql \u8bed\u53e5 \u67e5\u770b\u5728 hive \u4e2d\u8f93\u5165\u7684\u6240\u6709\u5386\u53f2\u547d\u4ee4\uff1a cat ~/hivehistory</p> <p>\u5f00\u542fHive\u7684\u670d\u52a1\uff0c\u5141\u8bb8\u5176\u5b83\u8fdb\u7a0b\u8fdb\u884c\u8bbf\u95ee\uff1a 1.\u914d\u7f6e metastore \u670d\u52a1\uff0cmetastore \u670d\u52a1\u5c31\u662f\u63d0\u4f9b\u5143\u6570\u636e\u4fe1\u606f\u7684\u670d\u52a1\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u901a\u8fc7\u8be5\u670d\u52a1\u83b7\u53d6Hive\u4e2d\u521b\u5efa\u7684\u90a3\u4e9b\u8868\u7684\u4fe1\u606f\uff0c\u8be5\u670d\u52a1\u7684\u901a\u4fe1\u662f\u57fa\u4e8e thrift \u7684\uff0cthrift\u662f\u4e00\u4e2aRPC\u6846\u67b6\u3002\u914d\u7f6emetastore \u670d\u52a1\u540e\u5fc5\u987b\u5f00\u542f\u8be5\u670d\u52a1\uff0c\u4e0d\u7136\u4f7f\u7528hive\u547d\u4ee4\u5c31\u4f1a\u542f\u52a8\u62a5\u9519\u3002 \u6b65\u9aa4\uff1a \u5728 hive-site.xml \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u4fe1\u606f Text Only<pre><code>&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.uris&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;thrift://hadoop102:9083&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> \u542f\u52a8\uff1a hive --service metastore \uff0c\u9ed8\u8ba4\u662f\u524d\u53f0\u542f\u52a8\uff0c\u53ef\u4ee5\u4f7f\u7528 hive --service metastore &amp; \u5728\u540e\u53f0\u542f\u52a8\u670d\u52a1</p> <p>2.\u5f00\u542f hiveserver2 \u670d\u52a1\uff0c\u5f00\u542f hiveserver2 \u540e\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u4f7f\u7528hive\u81ea\u5df1\u7684jdbc\u9a71\u52a8\uff08\u5e94\u8be5\u5c31\u662f\u8fd9\u4e2a/opt/module/hive-3.1.2/jdbc/hive-jdbc-3.1.2-standalone.jar\uff09\u6765\u8fde\u63a5\u5230 hiveserver2 \u3002  \u6b65\u9aa4\uff1a Text Only<pre><code>&lt;!-- \u6307\u5b9a hiveserver2 \u7ed1\u5b9a\u7684 host --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hadoop102&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;!-- \u6307\u5b9a hiveserver2 \u7ed1\u5b9a\u7684\u7aef\u53e3\u53f7 --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.server2.thrift.port&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;10000&lt;/value&gt;\n&lt;/property&gt;\n\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.server2.enable.doAs&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;description&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Setting this property to true will have HiveServer2 execute\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Hive operations as the user making the calls to it.\n\u00a0\u00a0\u00a0\u00a0&lt;/description&gt;\n&lt;/property&gt;\n</code></pre></p> <p>\u542f\u52a8\uff1a hive --service hiveserver2 \uff0c\u540c\u6837\u9ed8\u8ba4\u662f\u524d\u53f0\u542f\u52a8\uff0c\u53ef\u4ee5\u4f7f\u7528 hive --service hiveserver2 &amp; \u5728\u540e\u53f0\u542f\u52a8\u670d\u52a1</p> <p>\u8fd9\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528beeline\u5ba2\u6237\u7aef\u8fde\u63a5hiveserver2 \u4e86\uff0c\u4e0d\u8fc7\u518d\u8fde\u63a5\u4e4b\u524d\u9700\u8981\u591a\u7b49\u4e00\u4f1a\uff0c\u7136\u540e\u624d\u80fd\u8fde\u63a5\u6210\u529f Text Only<pre><code>beeline -u jdbc:hive2://hadoop102:10000\n</code></pre></p> <p>\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a\u811a\u672chiveservices.sh\u6765\u5b8c\u6210\u4ee5\u4e0a\u4e24\u4e2a\u670d\u52a1\u7684\u542f\u52a8\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u5982\u679c\u5728windows\u4e0b\u7f16\u8f91\u7684\u8bdd\u8981\u628a\u6362\u884c\u7b26\u8c03\u6210Linux\u7684\u6362\u884c\u7b26LF\uff0c\u7136\u540e\u518d\u4e0a\u4f20\u5230~/bin/\u4e0b\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528hiveservices.sh start\u6765\u542f\u52a8\u4e86 Text Only<pre><code>#!/bin/bash\n\nHIVE_LOG_DIR=$HIVE_HOME/logs\n\nif [ ! -d $HIVE_LOG_DIR ]\nthen\n\u00a0\u00a0\u00a0\u00a0mkdir -p $HIVE_LOG_DIR\nfi\n\n#\u68c0\u67e5\u8fdb\u7a0b\u662f\u5426\u8fd0\u884c\u6b63\u5e38\uff0c\u53c2\u6570 1 \u4e3a\u8fdb\u7a0b\u540d\uff0c\u53c2\u6570 2 \u4e3a\u8fdb\u7a0b\u7aef\u53e3\nfunction check_process()\n{\n\u00a0\u00a0\u00a0\u00a0pid=$(ps -ef 2&gt;/dev/null | grep -v grep | grep -i $1 | awk '{print $2}')\n\u00a0\u00a0\u00a0\u00a0ppid=$(netstat -nltp 2&gt;/dev/null | grep $2 | awk '{print $7}' | cut -d '/' -f 1)\n\u00a0\u00a0\u00a0\u00a0echo $pid\n\u00a0\u00a0\u00a0\u00a0[[ \"$pid\" =~ \"$ppid\" ]] &amp;&amp; [ \"$ppid\" ] &amp;&amp; return 0 || return 1\n}\n\nfunction hive_start()\n{\n\u00a0\u00a0\u00a0\u00a0metapid=$(check_process HiveMetastore 9083)\n\u00a0\u00a0\u00a0\u00a0cmd=\"nohup hive --service metastore &gt;$HIVE_LOG_DIR/metastore.log 2&gt;&amp;1 &amp;\"\n\u00a0\u00a0\u00a0\u00a0[ -z \"$metapid\" ] &amp;&amp; eval $cmd || echo \"Metastroe \u670d\u52a1\u5df2\u542f\u52a8\"\n\u00a0\u00a0\u00a0\u00a0server2pid=$(check_process HiveServer2 10000)\n\u00a0\u00a0\u00a0\u00a0cmd=\"nohup hiveserver2 &gt;$HIVE_LOG_DIR/hiveServer2.log 2&gt;&amp;1 &amp;\"\n\u00a0\u00a0\u00a0\u00a0[ -z \"$server2pid\" ] &amp;&amp; eval $cmd || echo \"HiveServer2 \u670d\u52a1\u5df2\u542f\u52a8\"\n}\n\nfunction hive_stop()\n{\n\u00a0\u00a0\u00a0\u00a0metapid=$(check_process HiveMetastore 9083)\n\u00a0\u00a0\u00a0\u00a0[ \"$metapid\" ] &amp;&amp; kill $metapid || echo \"Metastore \u670d\u52a1\u672a\u542f\u52a8\"\n\u00a0\u00a0\u00a0\u00a0server2pid=$(check_process HiveServer2 10000)\n\u00a0\u00a0\u00a0\u00a0[ \"$server2pid\" ] &amp;&amp; kill $server2pid || echo \"HiveServer2 \u670d\u52a1\u672a\u542f\u52a8\"\n}\n\ncase $1 in\n\"start\")\n\u00a0\u00a0\u00a0\u00a0hive_start\n\u00a0\u00a0\u00a0\u00a0;;\n\"stop\")\n\u00a0\u00a0\u00a0\u00a0hive_stop\n\u00a0\u00a0\u00a0\u00a0;;\n\"restart\")\n\u00a0\u00a0\u00a0\u00a0hive_stop\n\u00a0\u00a0\u00a0\u00a0sleep 2\n\u00a0\u00a0\u00a0\u00a0hive_start\n\u00a0\u00a0\u00a0\u00a0;;\n\"status\")\n\u00a0\u00a0\u00a0\u00a0check_process HiveMetastore 9083 &gt;/dev/null &amp;&amp; echo \"Metastore \u670d\u52a1\u8fd0\u884c\u6b63\u5e38\" || echo \"Metastore \u670d\u52a1\u8fd0\u884c\u5f02\u5e38\"\n\u00a0\u00a0\u00a0\u00a0check_process HiveServer2 10000 &gt;/dev/null &amp;&amp; echo \"HiveServer2 \u670d\u52a1\u8fd0\u884c\u6b63\u5e38\" || echo \"HiveServer2 \u670d\u52a1\u8fd0\u884c\u5f02\u5e38\"\n\u00a0\u00a0\u00a0\u00a0;;\n*)\n\u00a0\u00a0\u00a0\u00a0echo Invalid Args!\n\u00a0\u00a0\u00a0\u00a0echo 'Usage: '$(basename $0)' start|stop|restart|status'\n;;\nesac\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/10-UDAF%E5%87%BD%E6%95%B0/","title":"10-UDAF\u51fd\u6570","text":"<p> \u7ea6 196 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>\u5e38\u7528\u7684UDAF\u51fd\u6570\u6709\uff1acount\u3001max\u3001min\u3001sum\u3001avg\uff0c\u8fd8\u6709\u4e24\u4e2a\uff1a COLLECT_SET(col)\uff1a\u662f\u4e00\u4e2a\u805a\u96c6\u51fd\u6570\uff0c\u4f5c\u7528\u662f\u628agroup by \u5206\u7ec4\u540e\u7684\u4e00\u4e2a\u5217\u7684\u6240\u6709\u503c\u53bb\u91cd\u6c47\u603b\u5f62\u6210\u4e00\u4e2aARRAY\u3002 COLLECT_LIST(col)\uff1a\u4e0eCOLLECT_SET()\u4e00\u6837\u662f\u4e00\u4e2a\u805a\u96c6\u51fd\u6570\uff0c\u552f\u4e00\u7684\u533a\u522b\u5728\u4e8e\u4e0d\u53bb\u91cd\u3002</p> <p>\u6848\u4f8b\uff1a \u8868\uff1a Text Only<pre><code>create table person_info(\n\u00a0\u00a0\u00a0\u00a0name string,\n\u00a0\u00a0\u00a0\u00a0constellation string,\n\u00a0\u00a0\u00a0\u00a0blood_type string\n)row format delimited fields terminated by \"\\t\";\n</code></pre> \u6570\u636e\uff1a Text Only<pre><code>\u5b59\u609f\u7a7a\u00a0\u00a0\u00a0\u00a0\u767d\u7f8a\u5ea7\u00a0\u00a0\u00a0\u00a0A\n\u5927\u6d77\u00a0\u00a0\u00a0\u00a0\u5c04\u624b\u5ea7\u00a0\u00a0\u00a0\u00a0A\n\u5b8b\u5b8b\u00a0\u00a0\u00a0\u00a0\u767d\u7f8a\u5ea7\u00a0\u00a0\u00a0\u00a0B\n\u732a\u516b\u6212\u00a0\u00a0\u00a0\u00a0\u767d\u7f8a\u5ea7\u00a0\u00a0\u00a0\u00a0A\n\u51e4\u59d0\u00a0\u00a0\u00a0\u00a0\u5c04\u624b\u5ea7\u00a0\u00a0\u00a0\u00a0A\n\u82cd\u8001\u5e08\u00a0\u00a0\u00a0\u00a0\u767d\u7f8a\u5ea7\u00a0\u00a0\u00a0\u00a0B\n</code></pre> \u5bfc\u5165\u5230hive Text Only<pre><code>load data local inpath \"/opt/module/data/person_info.txt\" into table\u00a0person_info;\n</code></pre> \u9700\u6c42\uff1a\u628a\u661f\u5ea7\u548c\u8840\u578b\u4e00\u6837\u7684\u4eba\u5f52\u7c7b\u5230\u4e00\u8d77\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a  HQL\uff1a Text Only<pre><code>select concat(constellation, ',', blood_type), concat_ws('|', `collect_set`(name))\nfrom person_info\ngroup by constellation,blood_type;\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/11-UTDF%20%E4%B9%8B%20explode%E5%87%BD%E6%95%B0%20%E5%92%8C%20LATERAL%20VIEW/","title":"11-UTDF \u4e4b explode\u51fd\u6570 \u548c LATERAL VIEW","text":"<p> \u7ea6 1376 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 28 \u5206\u949f</p> <p>EXPLODE(col)\uff1a\u628aarray\u7c7b\u578b\u7684\u6570\u636e\u62c6\u5206\u6210\u591a\u884c\uff0c\u628amap\u7c7b\u578b\u7684\u6570\u636e\u62c6\u5206\u6210\u591a\u884c\u591a\u5217\uff0c \u6bd4\u5982array\u7c7b\u578b\u7684\u6570\u636e\uff1a  Text Only<pre><code>select explode(friends) from test;\n</code></pre> </p> <p>\u6bd4map\u7c7b\u578b\u7684\u6570\u636e\uff1a  Text Only<pre><code>select explode(children) from test;\n</code></pre> </p> <p>explode\u6848\u4f8b1\uff1a\u5b8c\u6210wordcount \u6570\u636e Text Only<pre><code>a\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a\nb\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0b\nc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ccc\n</code></pre> \u8868\uff1a Text Only<pre><code>create table word(key string);\n</code></pre> HQL\uff1a Text Only<pre><code>insert overwrite local directory '/opt/module/data/wordcount'\nselect t.w,count(*)\nfrom(select explode(split(key,'\\t')) w from word) t\ngroup by t.w;\n</code></pre></p> <p>explode\u6848\u4f8b2\uff1a\u628a\u4ee5\u4e0b\u6570\u636e\u6309\u6307\u5b9a\u683c\u5f0f\u8f93\u51fa \u6570\u636e Text Only<pre><code>bigdata,hive:bigdata,hive\nbigdata,spark\n</code></pre> \u8f93\u51fa\u683c\u5f0f\uff1a  \u5efa\u8868\uff1a Text Only<pre><code>create table word(key string);\n</code></pre> HQL\uff1a Text Only<pre><code>select split(t.w,',')[0] word1, split(t.w,',')[1] word2\nfrom (select explode(split(key,':')) w from word) t;\n</code></pre></p> <p>LATERAL VIEW EXPLODE \u7136\u800c\u8fd8\u6709\u5f88\u591a\u9700\u6c42\u5728\u4f7f\u7528explode\u7684\u540c\u65f6\u9700\u8981\u8f93\u51fa\u5176\u5b83\u5217\uff0c\u4f46explode\u4e4b\u540e\u884c\u5c31\u53d8\u591a\u4e86\uff0c\u800c\u5176\u5b83\u5217\u7684\u884c\u6570\u5e76\u6ca1\u6709\u53d8\uff0c\u8fd8\u662f\u4e00\u884c\uff0c\u8fd9\u65f6\u5c31\u9700\u8981 lateral view \u5b50\u53e5\u6765\u5e2e\u5fd9\uff08lateral view\u5b50\u53e5\u662f\u4e13\u95e8\u7528\u6765\u5e2e\u52a9explode\uff0c\u5e94\u8be5\u4e0d\u80fd\u5355\u72ec\u4f7f\u7528\uff09\u3002 \u4fa7\u9762\u89c6\u56fe\u7684\u8bed\u6cd5\uff1a LATERAL VIEW udtf(expression) tableAlias AS columnAlias \u56e0\u4e3aUDTF\u51fd\u6570\u70b8\u88c2\u7684\u7ed3\u679c\u5305\u542b\u591a\u884c\u591a\u5217\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7ed3\u679c\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u5f20\u8868\uff0ctableAlias\u5c31\u662f\u8fd9\u4e2a\u8868\u7684\u522b\u540d\uff0ccolumnAlias\u5c31\u8fd9\u5f20\u8868\u7684\u6bcf\u4e00\u5217\u7684\u522b\u540d\uff0c\u6240\u4ee5\u5982\u679c\u7ed3\u679c\u6709\u591a\u5217\uff0c\u90a3\u4e48columnAlias\u5c31\u9700\u8981\u5199\u591a\u4e2a\uff0c\u5982\u679c\u4e0d\u5199columnAlias\uff0c\u90a3\u4e48\u5c31\u662f\u9ed8\u8ba4\u7684\u5217\u540d\uff08\u81ea\u5b9a\u4e49UDTF\u5728initialize\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u4e2d\u6307\u5b9a\u4e86\uff09\u3002</p> <p>\u6bd4\u5982\u8fd9\u4e2a\u6848\u4f8b\uff1a \u6709\u5982\u4e0b\u6570\u636e\uff0c\u7535\u5f71\u540d\u53ca\u5176\u5bf9\u5e94\u7684\u7c7b\u578b\uff1a Text Only<pre><code>\u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\n\u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\n\u300a\u6218\u72fc 2\u300b\u00a0\u00a0\u00a0\u00a0\u6218\u4e89,\u52a8\u4f5c,\u707e\u96be\n</code></pre> \u8868\u521b\u5efa\u7684\u8bed\u53e5\u5982\u4e0b\uff0c\u6ce8\u610f\u7535\u5f71\u7684\u7c7b\u578b\u4e0d\u662farray\uff1a Text Only<pre><code>create table movie_info(\n\u00a0\u00a0\u00a0\u00a0movie string,\n\u00a0\u00a0\u00a0\u00a0category string\n)row format delimited fields terminated by \"\\t\";\n</code></pre> \u9700\u8981\u5c06\u6570\u636e\u5c55\u5f00\u6210\u8fd9\u6837\uff0c\u65b9\u4fbf\u5bf9\u6bcf\u4e00\u79cd\u7c7b\u578b\u7684\u7535\u5f71\u8fdb\u884c\u7edf\u8ba1\uff1a Text Only<pre><code>\u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u60ac\u7591\n\u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u52a8\u4f5c\n\u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u79d1\u5e7b\n\u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u5267\u60c5\n\u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u60ac\u7591\n\u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u8b66\u532a\n\u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u52a8\u4f5c\n\u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u5fc3\u7406\n\u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u5267\u60c5\n\u300a\u6218\u72fc 2\u300b\u00a0\u00a0\u00a0\u00a0\u6218\u4e89\n\u300a\u6218\u72fc 2\u300b\u00a0\u00a0\u00a0\u00a0\u52a8\u4f5c\n\u300a\u6218\u72fc 2\u300b\u00a0\u00a0\u00a0\u00a0\u707e\u96be\n</code></pre> \u7531\u4e8e\u4e0d\u4ec5\u9700\u8981\u5c06category\u5c55\u5f00\uff0c\u8fd8\u8981\u4e0emovie\u5217\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u8fd9\u65f6\u5c31\u9700\u8981lateral view \u6765\u5e2e\u5fd9\u4e86\uff1a Text Only<pre><code>select movie, category_name\nfrom movie_info\nlateral view explode(split(category,\",\")) category_lateral as category_name;\n</code></pre></p> <p>\u5982\u679c Text Only<pre><code>select *\nfrom movie_info\nlateral view explode(split(category,\",\")) category_lateral as category_name\nwhere movie != '\u300a\u6218\u72fc 2\u300b';\n</code></pre> \u7ed3\u679c\u662f\u8fd9\u6837\u7684\uff0c\u6ce8\u610f\u5217\u540d\uff0c\u4e0d\u8981\u60f3\u7740lateral view explode\u628a\u8868\u539f\u6765\u7684\u90a3\u4e00\u5217\u70b8\u5f00\u4e86\uff0c\u800c\u5e94\u8be5\u8fd9\u6837\u601d\u8003\uff0clateral view explode\u662f\u5f62\u6210\u4e86\u4e00\u5f20\u65b0\u8868\uff0c\u7136\u540e\u4e0e\u539f\u6765\u7684\u8868\u505a\u8fde\u63a5\uff0c\u539f\u6765\u8868\u7684\u5217\u6ca1\u6709\u53d8\u5316\uff0c\u65b0\u8868\u4e5f\u6709\u81ea\u5df1\u7684\u5217\u3002 Text Only<pre><code>+-------------------+----------------------+---------------------------------+\n| movie_info.movie\u00a0\u00a0| movie_info.category\u00a0\u00a0| category_lateral.category_name\u00a0\u00a0|\n+-------------------+----------------------+---------------------------------+\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u8b66\u532a\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5fc3\u7406\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300aLie to me\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u8b66\u532a,\u52a8\u4f5c,\u5fc3\u7406,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n+-------------------+----------------------+---------------------------------+\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u8fde\u7eed\u4f7f\u7528lateral view explode\uff0c\u56e0\u4e3a\u662f\u539f\u8868\u4e0e\u65b0\u8868\u505a\u8fde\u63a5\uff0c\u6240\u4ee5\u51fd\u6570\u4f1a\u6210\u500d\u589e\u52a0\uff1a Text Only<pre><code>select *\nfrom movie_info\nlateral view explode(split(category,\",\")) e1 as col1\nlateral view explode(split(category,\",\")) e2 as col2\nwhere movie == '\u300a\u7591\u72af\u8ffd\u8e2a\u300b';\n</code></pre> Text Only<pre><code>+-------------------+----------------------+----------+----------+\n| movie_info.movie\u00a0\u00a0| movie_info.category\u00a0\u00a0| e1.col1\u00a0\u00a0| e2.col2\u00a0\u00a0|\n+-------------------+----------------------+----------+----------+\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u52a8\u4f5c\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u79d1\u5e7b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n| \u300a\u7591\u72af\u8ffd\u8e2a\u300b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u60ac\u7591,\u52a8\u4f5c,\u79d1\u5e7b,\u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| \u5267\u60c5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n+-------------------+----------------------+----------+----------+\n</code></pre></p> <p>LATERAL VIEW POSEXPLODE \u5c06\u6570\u7ec4\u6216Map\u7684\u6bcf\u4e2a\u5143\u7d20\u5c55\u5f00\u4e3a\u4e00\u884c\uff0c\u540c\u65f6\u8f93\u51fa\u5143\u7d20\u503c\u548c\u5176\u5728\u539f\u6570\u7ec4\u4e2d\u7684\u4e0b\u6807\uff08\u4ece0\u5f00\u59cb\uff09\u3002\u4e0eEXPLODE\u7684\u533a\u522b\u662f\uff0cEXPLODE\u4ec5\u5c55\u5f00\u5143\u7d20\u503c\uff0c\u800cPOSEXPLODE\u989d\u5916\u63d0\u4f9b\u4f4d\u7f6e\u4fe1\u606f\u3002 Text Only<pre><code>-- \u539f\u59cb\u8868\u7ed3\u6784\uff1aid INT, items ARRAY&lt;STRING&gt;\nSELECT id, itemIndex, item\nFROM array_table\nLATERAL VIEW POSEXPLODE(items) e AS itemIndex, item;\n</code></pre> Text Only<pre><code>id | itemIndex | item\n1\u00a0\u00a0| 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| apple\n1\u00a0\u00a0| 1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| banana\n2\u00a0\u00a0| 0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0| watermelon\n...\n</code></pre> \u6240\u4ee5\u5982\u679c\u9700\u8981\u540c\u65f6\u62c6\u5206\u591a\u4e2a\u5217\u5e76\u4fdd\u6301\u5143\u7d20\u5bf9\u5e94\u5173\u7cfb\uff0c\u90a3\u4e48\u5c31\u8981\u7528POSEXPLODE\uff08\u5e26\u7d22\u5f15\u7684\u62c6\u5206\uff09\u5e76\u5173\u8054\u7d22\u5f15\uff1a Text Only<pre><code>SELECT t1_col, t2_col\nFROM main_tbl\nLATERAL VIEW POSEXPLODE(array1) t1 AS idx1, t1_col\nLATERAL VIEW POSEXPLODE(array2) t2 AS idx2, t2_col\nWHERE idx1 = idx2;\n</code></pre></p> <p>LATERAL VIEW OUTER \u5904\u7406\u7a7a\u503c\uff1a\u5f53\u88ab\u62c6\u5206\u7684\u5217\u4e3a\u7a7a\uff08NULL\u6216\u7a7a\u6570\u7ec4\uff09\u65f6\uff0c\u9ed8\u8ba4LATERAL VIEW\u4f1a\u4e22\u5f03\u8be5\u884c\u3002\u4f7f\u7528OUTER\u5173\u952e\u5b57\u53ef\u4fdd\u7559\u539f\u884c\uff0c\u62c6\u5206\u540e\u7684\u5b57\u6bb5\u503c\u4e3aNULL\u3002 Text Only<pre><code>SELECT id, item\nFROM array_table\nLATERAL VIEW OUTER EXPLODE(items) tmp AS item;\n</code></pre> \u6b64\u65f6\u5373\u4f7fitems\u4e3a\u7a7a\uff0cid\u4ecd\u4f1a\u51fa\u73b0\u5728\u7ed3\u679c\u4e2d\uff0citem\u4e3aNULL\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/12-%E5%85%B6%E5%AE%83%E5%87%BD%E6%95%B0/","title":"12-\u5176\u5b83\u51fd\u6570","text":"<p> \u7ea6 95 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 2 \u5206\u949f</p> <p>\u5176\u5b83\u51fd\u6570\u5728Hive\u7684\u5b98\u65b9\u6587\u6863\u4e2d\u53ebMisc. Functions\u3002\u5e38\u7528\u7684\u6709\uff1a md5(string/binary) Text Only<pre><code>&gt; select md5('ABC');\n902fbdd2b1df0c4f70b4a5d23525e932\n</code></pre> sha1(string/binary) Text Only<pre><code>&gt; select sha1('ABC');\n3c01bdbb26f358bab27f267924aa2c9a03fcfdb8\n</code></pre> hash(a1[, a2...]) Text Only<pre><code>&gt; select hash('a', 'b');\n3105\n</code></pre> crc32(string/binary) Text Only<pre><code>&gt; select crc32('ABC');\n2743272264\n</code></pre></p> <p>get_json_object Text Only<pre><code>&gt; select get_json_object('{\"name\":\"zhangsan\",\"sex\":\"\u7537\",\"age\":\"25\"}', '$.name');\nzhangsan\n</code></pre> Text Only<pre><code>&gt; select get_json_object('[{\"name\":\"zhangsan\",\"sex\":\"\u7537\"},{\"name\":\"lisi\",\"sex\":\"\u7537\"}]', '$[1]');\n{\"name\":\"lisi\",\"sex\":\"\u7537\"}\n</code></pre> Text Only<pre><code>&gt; select get_json_object('[{\"name\":\"zhangsan\",\"sex\":\"\u7537\"},{\"name\":\"lisi\",\"sex\":\"\u7537\"}]', '$[1].name');\nlisi\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/13-%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/","title":"13-\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p> \u7ea6 804 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u5f53 Hive \u63d0\u4f9b\u7684\u5185\u7f6e\u51fd\u6570\u65e0\u6cd5\u6ee1\u8db3\u4f60\u7684\u4e1a\u52a1\u5904\u7406\u9700\u8981\u65f6\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u4e86\uff0c\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u6b65\u9aa4\uff1a \uff081\uff09\u7ee7\u627f Hive \u63d0\u4f9b\u7684\u7c7b org.apache.hadoop.hive.ql.udf.generic.GenericUDF \u6216\u00a0org.apache.hadoop.hive.ql.udf.generic.GenericUDTF \u6216 org.apache.hadoop.hive.ql.udf.generic.GenericUDAF \uff082\uff09\u5b9e\u73b0\u7c7b\u4e2d\u7684\u62bd\u8c61\u65b9\u6cd5 \uff083\uff09\u6dfb\u52a0 jar\uff08\u6216\u8005\u76f4\u63a5\u62d6\u5230Hive\u7684lib\u76ee\u5f55\u4e0b\uff0c\u5c31\u4e0d\u9700\u8981\u6307\u5b9a jar\u5305\u7684\u5177\u4f53\u8def\u5f84\u4e86\uff09\uff0c\u53ef\u4ee5\u4e0a\u4f20\u5230\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e5f\u53ef\u4ee5\u4e0a\u4f20\u5230HDFS\u4e0a add jar linux_jar_path \uff084\uff09\u5728 hive \u7684\u547d\u4ee4\u884c\u7a97\u53e3\u521b\u5efa\u51fd\u6570 create [temporary] function [dbname.]function_name AS 'class_name'; \u4e0d\u8981\u4e86\uff0c\u4e5f\u53ef\u4ee5\u5728 hive \u7684\u547d\u4ee4\u884c\u7a97\u53e3\u5220\u9664\u51fd\u6570 drop [temporary] function [if exists] [dbname.]function_name; \u6ce8\u610f\u521b\u5efa\u51fd\u6570\u9700\u8981\u6307\u5b9a\u6570\u636e\u5e93\u540d\uff0c\u548c\u8868\u4e00\u6837Hive\u7684\u81ea\u5b9a\u4e49\u51fd\u6570\u5c5e\u4e8e\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u662f\u5f53\u524d\u5e93\u3002 \uff085\uff09\u7b2c3\u6b65\u548c\u7b2c4\u6b65\u53ef\u4ee5\u5408\u5e76\u5230\u4e00\u8d77 create [temporary] function [dbname.]function_name as class_name using jar 'jar_path';</p> <p>\u4f8b\u5982\u81ea\u5b9a\u4e49UDTF\u51fd\u6570\u70b8\u88c2JSON\u6570\u7ec4\uff1a 1.\u7ee7\u627forg.apache.hadoop.hive.ql.udf.generic.GenericUDAF\uff0c\u5e76\u5b9e\u73b0 initialize\u3001process\u3001close\u65b9\u6cd5\u3002initialize\u5728\u53ea\u5728\u5f00\u59cb\u65f6\u8c03\u7528\u4e00\u6b21\uff0c\u7528\u4e8e\u68c0\u67e5UDTF\u51fd\u6570\u8f93\u5165\u53c2\u6570\u7684\u4e2a\u6570\u548c\u7c7b\u578b\u7684\u5408\u6cd5\u6027\uff0c\u4ee5\u53ca\u58f0\u660eUDTF\u51fd\u6570\u8f93\u51fa\u7ed3\u679c\u7684\u6240\u6709\u7684\u5217\u7684 \u5217\u540d \u548c \u5217\u7684\u7c7b\u578b\u3002process\u65b9\u6cd5\u4f1a\u5904\u7406\u8f93\u5165\u7684\u6bcf\u4e00\u884c\u6570\u636e\uff0c\u6709\u591a\u5c11\u884c\u6570\u636e\u5c31\u4f1a\u8c03\u7528\u591a\u5c11\u6b21\u3002close\u5728\u6240\u6709\u884c\u5904\u7406\u5b8c\u540e\u8c03\u7528\u3002 Text Only<pre><code>public class ExplodeJSONArray extends GenericUDTF {\n\n\u00a0\u00a0\u00a0\u00a0private PrimitiveObjectInspector inputOI;\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() throws HiveException {}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* argOIs\u662fUDTF\u51fd\u6570\u8f93\u5165\u53c2\u6570\u7684\u5bf9\u8c61\u68c0\u67e5\u5668\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6bd4\u5982 udtf_explode(col, \",\") \uff0c\u90a3\u4e48\u81ea\u5b9a\u4e49UDTF\u51fd\u6570udtf_explode\u6709\u4e24\u4e2a\u8f93\u5165\u53c2\u6570\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u4e8e\u662fargOIs\u6570\u7ec4\u7684\u957f\u5ea6\u4e3a2\uff0cargOIs[0]\u662fcol\u5217\u7684\u6570\u636e\u7c7b\u578b\u7684ObjectInspector\uff0cargOIs[1]\u662f\",\"\u7684ObjectInspector\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u8fd4\u56de\u503c StructObjectInspector \u662f\u81ea\u5b9a\u4e49UDTF\u51fd\u6570\u8fd4\u56de\u7684\u5217\u7684 \u5217\u540d \u548c \u6570\u636e\u7c7b\u578b\uff0c\u56e0\u4e3aUDTF\u51fd\u6570\u53ef\u4ee5\u6709\u591a\u4e2a\u5217\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5 \u5217\u540d \u548c \u5217\u7684\u6570\u636e\u7c7b\u578b \u90fd\u662f\u653e\u5728List\u96c6\u5408\u4e2d\u7684\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public StructObjectInspector initialize(ObjectInspector[] argOIs) throws UDFArgumentException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(argOIs.length!=1){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new UDFArgumentException(\"explode_json_array\u51fd\u6570\u53ea\u80fd\u63a5\u65361\u4e2a\u53c2\u6570\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ObjectInspector argOI = argOIs[0];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(argOI.getCategory()!=ObjectInspector.Category.PRIMITIVE){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new UDFArgumentException(\"explode_json_array\u51fd\u6570\u53ea\u80fd\u63a5\u6536\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53c2\u6570\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrimitiveObjectInspector primitiveOI\u00a0\u00a0= (PrimitiveObjectInspector) argOI;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0inputOI=primitiveOI;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(primitiveOI.getPrimitiveCategory()!=PrimitiveObjectInspector.PrimitiveCategory.STRING){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new UDFArgumentException(\"explode_json_array\u51fd\u6570\u53ea\u80fd\u63a5\u6536STRING\u7c7b\u578b\u7684\u53c2\u6570\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ArrayList&lt;String&gt; fieldNames = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ArrayList&lt;ObjectInspector&gt; fieldOIs = new ArrayList&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fieldNames.add(\"item\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fieldOIs.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return ObjectInspectorFactory.getStandardStructObjectInspector(fieldNames, fieldOIs);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* args\u662fUDTF\u51fd\u6570\u7684\u8f93\u5165\u53c2\u6570\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6bd4\u5982 udtf_explode(col, \",\") \uff0c\u90a3\u4e48args[0]\u662fcol\u5217\u7684\u6570\u636e\uff0cargs[1]\u662f\",\"\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0* forward\u4f20\u9012\u7684\u53c2\u6570\u662fUDTF\u51fd\u6570\u7684\u7ed3\u679c\u4e2d\u7684\u4e00\u884c\u6570\u636e\uff0c\u56e0\u4e3aUDTF\u51fd\u6570\u7684\u7ed3\u679c\u53ef\u4ee5\u662f\u591a\u4e2a\u5217\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5\u4f20\u9012\u7684\u5fc5\u987b\u662f\u4e00\u4e2a\u6570\u7ec4\u6216\u8005List\u96c6\u5408\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void process(Object[] args) throws HiveException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Object arg = args[0];\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String jsonArrayStr = PrimitiveObjectInspectorUtils.getString(arg, inputOI);\n\u00a0\u00a0 \u00a0\u00a0 \u00a0 //hive\u5185\u7f6e\u7684JSONArray\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0JSONArray jsonArray = new JSONArray(jsonArrayStr);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; jsonArray.length(); i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String json = jsonArray.getString(i);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] result = {json};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0forward(result);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.\u6dfb\u52a0 jar Text Only<pre><code>add jar /opt/software/Hive-1.0-SNAPSHOT.jar;\n</code></pre> \u6216\u8005\uff1a Text Only<pre><code>add jar\u00a0hdfs://hadoop102:8020/user/hive/jars/Hive-1.0-SNAPSHOT.jar;\n</code></pre></p> <p>3.\u5728 hive \u7684\u547d\u4ee4\u884c\u7a97\u53e3\u521b\u5efa\u51fd\u6570 Text Only<pre><code>create temporary function explodeJSONArray AS \"CustomUTDF.ExplodeJSONArray\";\n</code></pre></p> <p>\u7b2c2\u30013\u6b65\u5408\u5e76\u7684\u64cd\u4f5c\u547d\u4ee4\uff1a Text Only<pre><code>create temporary function explodeJSONArray AS \"CustomUTDF.ExplodeJSONArray\"\u00a0using jar 'hdfs://hadoop102:8020/user/hive/jars/Hive-1.0-SNAPSHOT.jar';\n</code></pre></p> <p>\u67e5\u770b\u662f\u5426\u521b\u5efa\u6210\u529f\uff1a Text Only<pre><code>show functions like '*json*';\n</code></pre></p> <p>4.\u521b\u5efa\u8868 Text Only<pre><code>create table json(line string);\n</code></pre> 5.\u5bfc\u5165\u6570\u636e Text Only<pre><code>[{\"name\": \"zhangsan\",\"age\": 18},{\"name\": \"lisi\",\"age\": 20}]\n</code></pre> 6.\u4f7f\u7528\u81ea\u5b9a\u4e49UDTF\u51fd\u6570 Text Only<pre><code>select explodeJSONArray(line) from json;\n</code></pre> \u7ed3\u679c\uff1a Text Only<pre><code>item\n{\"name\":\"zhangsan\",\"age\":18}\n{\"name\":\"lisi\",\"age\":20}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/14-%E7%AA%97%E5%8F%A3/","title":"14-\u7a97\u53e3","text":"<p> \u7ea6 1924 \u4e2a\u5b57  13 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 38 \u5206\u949f</p> <p>SQL\u8bed\u53e5\u6267\u884c\u7684\u8fc7\u7a0b\u662f\uff1a Text Only<pre><code>1.from\n2.where\n3.group by\n4.having\n5.select\n6.order by\n7.limit\n</code></pre> select\u4e2d\u7684\u5f00\u7a97\u53ef\u4ee5\u5bf9where\u6216\u8005having\u8fc7\u6ee4\u4e4b\u540e\u7684\u6570\u636e\u518d\u6b21\u8fdb\u884c\u7edf\u8ba1\u3002</p> <p>\u5f00\u7a97\u7684\u51fd\u6570\u662fover()\uff0c\u6ca1\u6709\u5f00\u7a97\u7684\u65f6\u5019\uff0c\u5728\u6ca1\u6709\u5206\u7ec4\u7684\u60c5\u51b5\u4e0b\uff0cselect\u540e\u9762\u805a\u96c6\u51fd\u6570\u662f\u4e0d\u80fd\u548c\u975e\u5206\u7ec4\u5b57\u6bb5\u5728\u4e00\u8d77\u7684\uff0c\u4f46\u662f\u4f7f\u7528\u5f00\u7a97\u51fd\u6570\u4e4b\u540e\u5c31\u4e0d\u662f\u4e86\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u6bcf\u4e00\u884c\uff0c\u805a\u96c6\u51fd\u6570\u90fd\u4f1a\u5728\u5f00\u7a97\u91cc\u8ba1\u7b97\u4e00\u4e2a\u7ed3\u679c\u3002 over\u89c1\u540d\u77e5\u610f\uff0c\u5728\uff0c\u805a\u96c6\u51fd\u6570\u5728\u7a97\u53e3\u91cc\u9762\u8ba1\u7b97\u7ed3\u679c\uff0c\u5176\u5b9eover\u524d\u9762\u4e0d\u5149\u53ef\u4ee5\u662f\u805a\u96c6\u51fd\u6570\uff0c\u4e5f\u53ef\u662f\u5176\u5b83\u529f\u80fd\u7684\u51fd\u6570\uff1a \u7b2c\u4e00\u79cd\u662f\u805a\u5408\u51fd\u6570</p> <ul> <li>COUNT()</li> <li>SUM()</li> <li>MIN()</li> <li>MAX()</li> <li>AVG()</li> </ul> <p>\u7b2c\u4e8c\u79cd\u662f\u7a97\u53e3\u51fd\u6570</p> <ul> <li>LAG(col,n,default_val)\uff1a\u5f80\u524d\u7b2c n \u884c\u7684col\u5217\u7684\u6570\u636e\uff0c\u6ca1\u6709\u5c31\u662fdefault_val</li> <li>LEAD(col,n, default_val)\uff1a\u5f80\u540e\u7b2c n \u884c\u7684col\u5217\u7684\u6570\u636e\uff0c\u6ca1\u6709\u5c31\u662fdefault_val</li> <li>FIRST_VALUE(col,[boolean])\uff1a\u9009\u62e9col\u5217\u7684\u7b2c\u4e00\u4e2a\u6570\u636e\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u53ef\u9009\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u8868\u793a\u4e0d\u8df3\u8fc7null\u503c\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u8868\u793a\u8df3\u8fc7null\u503c</li> <li>LAST_VALUE(col,[boolean])\uff1a\u9009\u62e9col\u5217\u7684\u6700\u540e\u4e00\u4e2a\u6570\u636e\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u53ef\u9009\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u8868\u793a\u4e0d\u8df3\u8fc7null\u503c\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u8868\u793a\u8df3\u8fc7null\u503c</li> </ul> <p>\u7b2c\u4e09\u79cd\u662f\u5206\u6790\u51fd\u6570</p> <ul> <li>RANK()\uff1a\u6392\u5e8f\u76f8\u540c\u65f6\u4f1a\u91cd\u590d\uff0c\u603b\u6570\u4e0d\u4f1a\u53d8</li> <li>DENSE_RANK()\uff1a\u6392\u5e8f\u76f8\u540c\u65f6\u4f1a\u91cd\u590d\uff0c\u603b\u6570\u4f1a\u51cf\u5c11</li> <li>ROW_NUMBER()\uff1a\u6309\u884c\u6570\u8ba1\u7b97</li> <li>NTILE(n)\uff1a\u628a\u5206\u533a\u4e2d\u7684\u6570\u636e\u5206\u6210n\u7b49\u5206\uff0c\u7136\u540e\u8fd4\u56de\u5f53\u524d\u884c\u5728\u54ea\u4e00\u7b49\u5206\u4e2d</li> </ul> <p>\u5176\u4e2d\uff0c\u7b2c\u4e8c\u79cd\u548c\u7b2c\u4e09\u79cd\u53ea\u80fd\u548c\u5f00\u7a97\u4e00\u8d77\u4f7f\u7528\u3002</p> <p>over\u4e2d\u7684\u8bed\u53e5\u53ef\u4ee5\u6709\u5982\u4e0b\u51e0\u79cd\uff0c\u4efb\u610f\u642d\u914d\u6709\u4e0d\u540c\u7684\u6548\u679c\uff1a</p> <ul> <li>partition by</li> <li>order by</li> <li>rows between xxx and xxx</li> </ul> <p>\u5176\u4e2drows between xxx and xxx \u7684xxx\u53ef\u4ee5\u662f</p> <ul> <li>CURRENT ROW\uff1a\u5f53\u524d\u884c</li> <li>n PRECEDING\uff1a\u5f80\u524d n \u884c\u5230\u5f53\u524d\u884c\u7684\u6570\u636e</li> <li>n FOLLOWING\uff1a\u5f53\u524d\u884c\u5230\u5f80\u540e n \u884c\u7684\u6570\u636e</li> <li>UNBOUNDED PRECEDING\u00a0\u00a0\u6700\u524d\u9762\u7684\u8d77\u70b9</li> <li>UNBOUNDED FOLLOWING \u6700\u540e\u9762\u7684\u7ec8\u70b9</li> </ul> <p>\u6ce8\uff1aover()\u4e2d\u4e5f\u53ef\u4ee5\u4f7f\u7528distribute by \u548c sort by\uff0c\u4e0d\u8fc7distribute by\u53ea\u80fd\u548c sort by\u5728\u4e00\u8d77\u7528\uff0c\u4e0d\u80fd\u6709distribute by order by \u548c\u00a0partition by sort by \u8fd9\u6837\u7684\u642d\u914d\u3002</p> <p>\u6bd4\u5982\u5e38\u89c1\u5178\u578b\u7528\u6cd5\uff1a</p> <ul> <li>over()\uff1awhere\u6216\u8005having\u8fc7\u6ee4\u4e4b\u540e\u7684\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u5206\u533a\uff0c\u4e0b\u9762\u5c31\u90fd\u4e0d\u63d0where\u6216\u8005having\u8fc7\u6ee4\u7684\u4e8b\u4e86\uff0c\u56e0\u4e3a\u5f00\u7a97\u672c\u6765\u5c31\u662fselect\u4e2d\u6267\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u5728where\u548chaving\u8fc7\u6ee4\u4e4b\u540e\u7684\u6570\u636e\u4e2d\u6267\u884c\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u628awhere\u6216\u8005having\u8fc7\u6ee4\u540e\u7684\u6570\u636e\u79f0\u4e3a\u6574\u5f20\u8868</li> <li>over(order by)\uff1a\u6574\u5f20\u8868\u6392\u5e8f\u4e4b\u540e\u4f5c\u4e3a\u4e00\u4e2a\u5206\u533a\uff0c\u4f7f\u7528\u805a\u96c6\u51fd\u6570\u65f6\u662f\u4e00\u79cd\u7d2f\u52a0\u7684\u6548\u679c\uff0c\u56e0\u4e3a\u4e0d\u52a0 rows between and \u9ed8\u8ba4\u662f rows between unbounded preceeding and current row\uff0c\u4e5f\u5c31\u662f\u8d77\u59cb\u884c\u5230\u5f53\u524d\u884c\u4e3a\u4e00\u7ec4</li> <li>over(partition by)\uff1a\u628a\u6574\u5f20\u8868\u518d\u6b21\u5206\u533a</li> <li>over(rows between xxx and xxx)\uff1a\u6574\u5f20\u8868\u4f5c\u4e3a\u4e00\u4e2a\u5206\u533a\uff0c\u8ba1\u7b97\u65f6\u662f\u4ee5\u5f53\u524d\u884c \u4e3a\u57fa\u51c6\u7684\u524d\u540exxx\u884c</li> <li>over(partition by order by)\uff1a\u5206\u533a\u5e76\u6392\u5e8f</li> <li>over(partition by rows between xxx and xxx)\uff1a\u5206\u533a\u540e\uff0c\u8ba1\u7b97\u65f6\u662f\u4ee5\u5f53\u524d\u884c \u4e3a\u57fa\u51c6\u7684\u524d\u540exxx\u884c</li> <li>over(partition by order by rows between xx and xx)\uff1a\u5206\u533a\u6392\u5e8f\u540e\uff0c\u8ba1\u7b97\u65f6\u662f\u4ee5\u5f53\u524d\u884c \u4e3a\u57fa\u51c6\u7684\u524d\u540exxx\u884c</li> </ul> <p>\u603b\u7ed3\u4e00\u4e0b\uff1a</p> <ul> <li>over()\u524d\u9762\u7684\u5f00\u7a97\u51fd\u6570\u8ba1\u7b97\u7684\u8303\u56f4\u662f\u5f53\u524d\u884c\u6240\u5728\u5206\u533a\u7684rows between xxx and xxx</li> <li>\u4e0d\u52a0partition by \u7b49\u4e8e\u6574\u5f20\u8868\u4f5c\u4e3a\u4e00\u4e2a\u5206\u533a\uff0c\u4e5f\u662f\u6574\u5f20\u8868\u4f5c\u4e3a\u4e00\u7ec4\uff1b</li> <li>\u52a0\u4e86partition by \u4e0d\u52a0 order by \u548c\u00a0rows between and\uff0c\u6574\u5f20\u8868\u88ab\u5206\u6210\u591a\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u4f5c\u4e3a\u4e00\u7ec4\u8ba1\u7b97\uff0c\u56e0\u4e3a\u4e0d\u52a0 order by \u548c\u00a0rows between and\u7684\u6548\u679c\u9ed8\u8ba4\u662f\u5728\u5206\u533a\u5185rows between unbounded preceeding and\u00a0unbounded following</li> <li>\u52a0\u4e86partition by \u548c order by\uff0c\u4e0d\u52a0 rows between and\uff0c\u6574\u5f20\u8868\u88ab\u5206\u6210\u591a\u4e2a\u5206\u533a\uff0c\u5206\u533a\u5185\u662f\u8d77\u59cb\u884c\u5230\u5f53\u524d\u884c\u4e3a\u4e00\u7ec4\u8ba1\u7b97\uff0c\u56e0\u4e3a\u53ea\u52a0order by\u4e0d\u52a0rows between and\u7684\u9ed8\u8ba4\u6548\u679c\u662f\u5728\u5206\u533a\u5185rows between unbounded preceeding and current row\uff0c\u4e5f\u5c31\u662f\u8d77\u59cb\u884c\u5230\u5f53\u524d\u884c\u4e3a\u4e00\u7ec4\u3002</li> <li>\u52a0\u4e86rows between and\uff0c\u5c31\u662frows between and\uff0c\u4f60\u6307\u5b9a\u7684\u8303\u56f4\u4f5c\u4e3a\u4e00\u7ec4\u3002</li> </ul> <p>over()\u91cc\u9762\u7684\u5206\u533a\u6392\u5e8f\u5bf9\u6700\u540e\u7684\u7ed3\u679c\u6709\u5f71\u54cd\uff0c\u610f\u601d\u662f\u5982\u679cover()\u91cc\u9762\u6709partition by\u6216\u8005order by\uff0c\u90a3\u4e48\u6700\u540e\u7684\u8f93\u51fa\u7684\u7ed3\u679c\u4e5f\u88ab\u5206\u533a\u548c\u6392\u5e8f\u4e86\uff0cover()\u524d\u9762\u7684\u51fd\u6570\u5c31\u662f\u5728\u8fd9\u4e2a\u7ed3\u679c\u4e0a\u8ba1\u7b97\u5f97\u5230\u7684\u3002</p> <p>\u603b\u7ed3\uff1a</p> <ul> <li>\u53ea\u52a0order by\u4e0d\u52a0rows between and\u7684\u9ed8\u8ba4\u6548\u679c\u662f\u5728\u5206\u533a\u5185rows between unbounded preceeding and current row\uff0c\u4e5f\u5c31\u662f\u8d77\u59cb\u884c\u5230\u5f53\u524d\u884c\u4e3a\u4e00\u7ec4\u3002</li> <li>\u4e0d\u52a0order by\u4e0d\u52a0rows between and\u662f\u6574\u4e2a\u5206\u533a\u3002</li> <li>\u52a0rows between and\u5c31\u662f\u4f60\u8868\u8fbe\u7684\u610f\u601d\u3002</li> </ul> <p>\u6848\u4f8b\uff1a \u6570\u636e\uff1a Text Only<pre><code>jack,2017-01-01,10\ntony,2017-01-02,15\njack,2017-02-03,23\ntony,2017-01-04,29\njack,2017-01-05,46\njack,2017-04-06,42\ntony,2017-01-07,50\njack,2017-01-08,55\nmart,2017-04-08,62\nmart,2017-04-09,68\nneil,2017-05-10,12\nmart,2017-04-11,75\nneil,2017-06-12,80\nmart,2017-04-13,94\n</code></pre> \u8868\uff1a Text Only<pre><code>create table business(\n\u00a0\u00a0\u00a0\u00a0name string,\n\u00a0\u00a0\u00a0\u00a0orderdate string,\n\u00a0\u00a0\u00a0\u00a0cost int\n)ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';\n</code></pre></p> <p>\u9700\u6c42 \uff081\uff09\u67e5\u8be2\u5728 2017 \u5e74 4 \u6708\u4efd\u8d2d\u4e70\u8fc7\u7684\u987e\u5ba2\u53ca\u603b\u4eba\u6570\uff08\u4e0d\u662f\u8be5\u987e\u5ba2\u7684\u6d88\u8d39\u6b21\u6570\uff09 Text Only<pre><code>select name,count(*) over()\nfrom business\nwhere substr(orderdate,1,7)='2017-04'\ngroup by name;\n</code></pre> \u7ed3\u679c\uff0c\u6709mart\u548cjack\u4e24\u4e2a\u4eba\uff0c\u6240\u4ee5\u7ed3\u679c\u662f2\uff0c\u5e76\u4e0d\u662f\u6307\u6bcf\u4e2a\u4eba\u6d88\u8d39\u7684\u603b\u8bb0\u5f55\u6570\uff0c\u5e76\u4e14\u4ece\u7ed3\u679c\u4e2d\u53ef\u4ee5\u77e5\u9053\uff0cgroup by\u4e4b\u540e\u4f7f\u7528\u5f00\u7a97\u5e76\u4e0d\u662f\u5728group by\u7684\u5206\u7ec4\u91cc\u8ba1\u7b97\uff0c\u800c\u662f\u5728select\u4e86group by\u7684\u7ed3\u679c\u4e4b\u540e\uff0c\u5728\u518d\u6b64\u7ed3\u679c\u4e0a\u5f00\u7a97\uff1a </p> <p>\u4e0d\u8fc7\u53ef\u4ee5\u67e5\u8be2\u4e00\u4e0b2017 \u5e74 4 \u6708\u4efd\u8d2d\u4e70\u8fc7\u7684\u987e\u5ba2\u53ca\u5176\u6d88\u8d39\u7684\u603b\u8bb0\u5f55\u6570\uff1a Text Only<pre><code>SELECT NAME,COUNT(*) AS '\u6d88\u8d39\u6b21\u6570'\nFROM business\nWHERE SUBSTR(orderdate,1,7)='2017-04'\nGROUP BY NAME;\n</code></pre>  MySQL\u4e2d\u540c\u6837\u652f\u6301\u5f00\u7a97\uff0c\u5982\u679c\u7528\u5f00\u7a97\u7684\u6548\u679c\uff1a Text Only<pre><code>SELECT NAME,COUNT(*) OVER(PARTITION BY NAME) AS '\u6d88\u8d39\u6b21\u6570'\nFROM business\nWHERE SUBSTR(orderdate,1,7)='2017-04'\n</code></pre> \u53ef\u89c1\u5f00\u7a97\u662f\u5728select\u7684\u6bcf\u4e00\u884c\u7ed3\u679c\u4e0a\u505a\u805a\u5408\u8ba1\u7b97\uff1a </p> <p>\uff082\uff09\u67e5\u8be2\u987e\u5ba2\u7684\u8d2d\u4e70\u660e\u7ec6\u53ca\u6bcf\u4e2a\u6708\u7684\u8d2d\u4e70\u603b\u989d Text Only<pre><code>SELECT NAME,orderdate,cost,SUM(cost) OVER(PARTITION BY NAME,MONTH(orderdate)) AS '\u5f53\u6708\u7684\u6d88\u8d39\u603b\u989d'\nFROM business;\n</code></pre> </p> <p>\uff083\uff09\u4e0a\u8ff0\u7684\u573a\u666f,\u00a0\u00a0\u5c06\u6bcf\u4e2a\u987e\u5ba2\u7684 cost \u6309\u7167\u65e5\u671f\u8fdb\u884c\u7d2f\u52a0 Text Only<pre><code>SELECT name,cost,SUM(cost) OVER(PARTITION BY name ORDER BY (orderdate))\nFROM business\n</code></pre> </p> <p>\uff084\uff09\u67e5\u8be2\u6bcf\u4e2a\u987e\u5ba2\u4e0a\u6b21\u7684\u8d2d\u4e70\u65f6\u95f4 Text Only<pre><code>SELECT NAME,orderdate,cost,LAG(orderdate,1,NULL) OVER(PARTITION BY NAME ORDER BY orderdate) AS '\u4e0a\u6b21\u8d2d\u4e70\u7684\u65e5\u671f'\nFROM business;\n</code></pre> </p> <p>\uff085\uff09\u67e5\u8be2\u524d 20%\u65f6\u95f4\u7684\u8ba2\u5355\u4fe1\u606f \u5148\u628a\u6570\u636e\u5206\u62105\u7b49\u5206\uff1a Text Only<pre><code>SELECT NAME,orderdate,cost,NTILE(5) OVER(ORDER BY orderdate) AS '\u7b2c\u51e0\u7b49\u5206'\nFROM business;\n</code></pre>  \u7136\u540e\u53d6\u7b2c\u4e00\u7b49\u5206\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u524d20%\u7684\u6570\u636e\uff1a Text Only<pre><code>SELECT t.name,t.orderdate,t.cost\nFROM (\n\u00a0\u00a0\u00a0\u00a0SELECT NAME,orderdate,cost,NTILE(5) OVER(ORDER BY orderdate) AS portion\n\u00a0\u00a0\u00a0\u00a0FROM business\n) t\nWHERE t.portion=1\n</code></pre> </p> <p>\u7136\u540e\u662f\u4ee5\u4e0b\u4e09\u4e2a\u884c\u6570\u7684\u6848\u4f8b\uff1a</p> <ul> <li>RANK()\uff1a\u6392\u5e8f\u76f8\u540c\u65f6\u4f1a\u91cd\u590d\uff0c\u603b\u6570\u4e0d\u4f1a\u53d8</li> <li>DENSE_RANK()\uff1a\u6392\u5e8f\u76f8\u540c\u65f6\u4f1a\u91cd\u590d\uff0c\u603b\u6570\u4f1a\u51cf\u5c11</li> <li>ROW_NUMBER()\uff1a\u6309\u884c\u6570\u8ba1\u7b97</li> </ul> <p>\u6570\u636e\uff1a Text Only<pre><code>\u5b59\u609f\u7a7a\u00a0\u00a0\u00a0\u00a0\u8bed\u6587\u00a0\u00a0\u00a0\u00a087\n\u5b59\u609f\u7a7a\u00a0\u00a0\u00a0\u00a0\u6570\u5b66\u00a0\u00a0\u00a0\u00a095\n\u5b59\u609f\u7a7a\u00a0\u00a0\u00a0\u00a0\u82f1\u8bed\u00a0\u00a0\u00a0\u00a068\n\u5927\u6d77\u00a0\u00a0\u00a0\u00a0\u8bed\u6587\u00a0\u00a0\u00a0\u00a094\n\u5927\u6d77\u00a0\u00a0\u00a0\u00a0\u6570\u5b66\u00a0\u00a0\u00a0\u00a056\n\u5927\u6d77\u00a0\u00a0\u00a0\u00a0\u82f1\u8bed\u00a0\u00a0\u00a0\u00a084\n\u5b8b\u5b8b\u00a0\u00a0\u00a0\u00a0\u8bed\u6587\u00a0\u00a0\u00a0\u00a064\n\u5b8b\u5b8b\u00a0\u00a0\u00a0\u00a0\u6570\u5b66\u00a0\u00a0\u00a0\u00a086\n\u5b8b\u5b8b\u00a0\u00a0\u00a0\u00a0\u82f1\u8bed\u00a0\u00a0\u00a0\u00a084\n\u5a77\u5a77\u00a0\u00a0\u00a0\u00a0\u8bed\u6587\u00a0\u00a0\u00a0\u00a065\n\u5a77\u5a77\u00a0\u00a0\u00a0\u00a0\u6570\u5b66\u00a0\u00a0\u00a0\u00a085\n\u5a77\u5a77\u00a0\u00a0\u00a0\u00a0\u82f1\u8bed\u00a0\u00a0\u00a0\u00a078\n</code></pre> \u8868\uff1a Text Only<pre><code>create table score(\n\u00a0\u00a0\u00a0\u00a0name string,\n\u00a0\u00a0\u00a0\u00a0subject string,\n\u00a0\u00a0\u00a0\u00a0score int\n)row format delimited fields terminated by \"\\t\";\n</code></pre></p> <p>\u9700\u6c42\uff1a\u6309\u6210\u7ee9\u6392\u5e8f Text Only<pre><code>SELECT *,RANK() OVER(PARTITION BY `subject` ORDER BY score desc) AS '\u5355\u79d1\u6392\u540d'\nFROM score;\n</code></pre> Text Only<pre><code>SELECT *, DENSE_RANK() OVER(PARTITION BY `subject` ORDER BY score DESC) AS '\u5355\u79d1\u6392\u540d'\nFROM score;\n</code></pre> Text Only<pre><code>SELECT *, ROW_NUMBER() OVER(PARTITION BY `subject` ORDER BY score DESC) AS '\u5355\u79d1\u6392\u540d'\nFROM score;\n</code></pre> </p> <p>\u6c42\u51fa\u6bcf\u95e8\u5b66\u79d1\u524d\u4e09\u540d\u7684\u5b66\u751f Text Only<pre><code>SELECT *\nFROM(\n\u00a0\u00a0\u00a0\u00a0SELECT *, ROW_NUMBER() OVER(PARTITION BY `subject` ORDER BY score DESC) AS `rank`\n\u00a0\u00a0\u00a0\u00a0FROM score\n) t\nWHERE t.rank&lt;=3;\n</code></pre> </p> <p>\u6ce8\u610f\uff1a\u6570\u636e\u76f8\u540c\u884c\u5f00\u7a97\u7684\u7ed3\u679c\u76f8\u540c \u4ee5\u4e0b\u6570\u636e Text Only<pre><code>CREATE TABLE test(num INT);\n</code></pre> Text Only<pre><code>1\n2\n3\n3\n4\n5\n</code></pre> \u7136\u540e Text Only<pre><code>select sum(num) over(order by num)\nfrom test;\n</code></pre> \u5f00\u7a97\u7684\u7ed3\u679c\u662f  \u4e5f\u5c31\u662f\u8bf4\u76f8\u540c\u884c\u5f00\u7a97\u8ba1\u7b97\u7684\u7ed3\u679c\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/15-grouping%20sets%E5%AD%90%E5%8F%A5/","title":"15-grouping sets\u5b50\u53e5","text":"<p> \u7ea6 186 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>\u4e0d\u5e38\u7528\uff0c\u4e0d\u91cd\u8981\u3002 grouping sets\uff1a\u5728group by \u540e\u9762\u4f7f\u7528grouping_set\uff0c\u7b49\u4ef7\u4e8e\u5c06\u591a\u4e2agroup by\u7684\u7ed3\u679cunion\u8d77\u6765 </p> <p>\u6848\u4f8b\uff1a \u8868\uff1a Text Only<pre><code>create table staff(\n\u00a0 \u00a0id int,\n\u00a0 \u00a0name string,\n\u00a0 \u00a0sex string,\n\u00a0 \u00a0deptid int\n)row format delimited fields terminated by \",\";\n</code></pre> \u6570\u636e\uff1a Text Only<pre><code>1001,zhangsan,male,10\n1002,lisi,female,10\n1003,wangwu,male,20\n1004,zhaoliu,male,20\n1005,tianqi,male,30\n1006,sunba,female,30\n1007,qianjiu,male,30\n</code></pre></p> <p>\u67e5\u8be2\u6bcf\u4e2a\u90e8\u95e8\u4e24\u79cd\u6027\u522b\u5404\u6709\u591a\u5c11\u4eba\uff08\u6309\u90e8\u95e8\u548c\u6027\u522b\u5206\u7ec4\uff09\uff0c\u6240\u6709\u90e8\u95e8\u4e2d\u4e24\u79cd\u6027\u522b\u5404\u6709\u591a\u5c11\u4eba\uff08\u6309\u6027\u522b\u5206\u7ec4\uff09\uff0c\u6bcf\u4e2a\u90e8\u95e8\u6709\u591a\u5c11\u4eba\uff08\u6309\u90e8\u95e8\u5206\u7ec4\uff09\uff0c\u4e00\u5171\u6709\u591a\u5c11\u4eba\uff08\u4e0d\u5206\u7ec4\uff0c\u6216\u8005\u8bf4\u6240\u6709\u90e8\u95e8\u4f5c\u4e3a\u4e00\u7ec4\uff09\u3002\u4e00\u4e2aSQL\u67e5\u8be2\u5f97\u5230\u7ed3\u679c\uff1a Text Only<pre><code>select deptid,sex,count(*) num\nfrom staff\ngroup by deptid,sex\ngrouping sets((deptid,sex),sex,deptid,());\n</code></pre> </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/16-%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/","title":"16-\u6587\u4ef6\u683c\u5f0f","text":"<p> \u7ea6 728 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>\u6587\u4ef6\u683c\u5f0f\uff1a Hive \u652f\u6301\u7684\u5b58\u50a8\u6570\u636e\u7684\u683c\u5f0f\u4e3b\u8981\u6709\uff1aTEXTFILE \u3001SEQUENCEFILE\u3001ORC\u3001PARQUET\u3002</p> <p>TEXTFILE\u3001ORC\u3001PARQUET\u4e09\u79cd\u6587\u4ef6\u683c\u5f0f\u7684\u5bf9\u6bd4\u5b9e\u9a8c\uff1a \u6d4b\u8bd5\u6570\u636e\u662f\u4e00\u4e2atxt\u6587\u672c\u6587\u4ef6\u5927\u5c0f\u4e3a18M</p> <p>1. TEXTFILE \u5efa\u8868\uff0c\u9ed8\u8ba4\u7684\u5b58\u50a8\u6570\u636e\u683c\u5f0f\u5c31\u662fTEXTFILE\uff0c\u53ef\u4ee5\u4e0d\u6307\u5b9a\uff1a Text Only<pre><code>create table log_text (\n\u00a0 \u00a0track_time string,\n\u00a0 \u00a0url string,\n\u00a0 \u00a0session_id string,\n\u00a0 \u00a0referer string,\n\u00a0 \u00a0ip string,\n\u00a0 \u00a0end_user_id string,\n\u00a0 \u00a0city_id string\n)row format delimited fields terminated by '\\t'\nstored as textfile;\n</code></pre> \u5bfc\u5165\u6570\u636e Text Only<pre><code>load data local inpath '/opt/module/data/log.data' into table log_text;\n</code></pre> \u67e5\u770b\u8868\u4e2d\u6570\u636e\u5927\u5c0f\uff0c18M Text Only<pre><code>dfs -du -h /user/hive/warehouse/log_text;\n</code></pre></p> <p>2.ORC \u5efa\u8868\uff0c\u5b58\u50a8\u683c\u5f0f\u662forc\uff0corc\u9ed8\u8ba4\u5f00\u542f\u538b\u7f29\uff0c\u8fd9\u91cc\u628a\u538b\u7f29\u5148\u5173\u95ed\uff1a Text Only<pre><code>create table log_orc (\n\u00a0 \u00a0track_time string,\n\u00a0 \u00a0url string,\n\u00a0 \u00a0session_id string,\n\u00a0 \u00a0referer string,\n\u00a0 \u00a0ip string,\n\u00a0 \u00a0end_user_id string,\n\u00a0 \u00a0city_id string\n)row format delimited fields terminated by '\\t'\nstored as orc\ntblproperties(\"orc.compress\"=\"NONE\"); -- \u8bbe\u7f6e orc \u5b58\u50a8\u4e0d\u4f7f\u7528\u538b\u7f29\n</code></pre> \u628a\u4e0a\u9762\u90a3\u5f20\u8868log_text\u7684\u6570\u636e\u63d2\u5165\u5230\u8fd9\u5f20\u8868\u4e2d\uff0c\u975eTEXTFILE\u683c\u5f0f\u7684\u8868\u53ea\u80fd\u8fd9\u6837\u505a\uff0c\u56e0\u4e3aload\u65e0\u6cd5\u628aTEXTFILE\u683c\u5f0f\u7684\u6570\u636e\u5bfc\u5165\u5230\u975eTEXTFILE\u683c\u5f0f\u7684\u8868\u4e2d\uff0c\u4f46\u662fload\u53ef\u4ee5\u5bfc\u5206\u533a\u8868\u548c\u5206\u6876\u8868\uff0cload\u5bfc\u5165\u6570\u636e\u5230\u5206\u533a\u8868\u548c\u5206\u6876\u8868\u662f\u8d70MR\uff0c\u8fd9\u91cc\u7684insert\u4e5f\u662f\u8d70MR\u3002 Text Only<pre><code>insert into table log_orc select * from log_text;\n</code></pre> \u67e5\u770b\u8868\u4e2d\u6570\u636e\u5927\u5c0f\uff0c7.69M Text Only<pre><code>dfs -du -h /user/hive/warehouse/log_orc;\n</code></pre></p> <p>3. Parquet \u5efa\u8868\uff0c\u5b58\u50a8\u683c\u5f0f\u662fParquet\uff0c\u9ed8\u8ba4 parquet\u6ca1\u6709\u5f00\u542f\u538b\u7f29\u3002 Text Only<pre><code>create table log_parquet (\n\u00a0 \u00a0track_time string,\n\u00a0 \u00a0url string,\n\u00a0 \u00a0session_id string,\n\u00a0 \u00a0referer string,\n\u00a0 \u00a0ip string,\n\u00a0 \u00a0end_user_id string,\n\u00a0 \u00a0city_id string\n)row format delimited fields terminated by '\\t'\nstored as parquet;\n</code></pre> \u5bfc\u5165\u6570\u636e\uff0c\u540c\u6837\u9700\u8981\u7528insert\u8d70MR Text Only<pre><code>insert into table log_parquet select * from log_text;\n</code></pre> \u67e5\u770b\u8868\u4e2d\u6570\u636e\u5927\u5c0f\uff0c 13.09 MB Text Only<pre><code>dfs -du -h /user/hive/warehouse/log_parquet;\n</code></pre></p> <p>\u4e09\u79cd\u683c\u5f0f\u5b58\u50a8\u6587\u4ef6\u7684\u5927\u5c0f\u5173\u7cfb\uff1a TEXTFILE &gt; ORC &gt; Parquet \u4e09\u79cd\u683c\u5f0f\u6587\u4ef6\u7684\u67e5\u8be2\u901f\u5ea6\u76f8\u5f53</p> <p>\u5b58\u50a8\u683c\u5f0f\u4e0e\u538b\u7f29\u65b9\u5f0f\u7ed3\u5408\uff1a \u521b\u5efa\u4e00\u5f20\u5b58\u50a8\u683c\u5f0f\u662forc\uff0c\u538b\u7f29\u65b9\u5f0f\u662fzlib\u7684\u8868 Text Only<pre><code>create table log_orc_zlib (\n\u00a0\u00a0\u00a0\u00a0track_time string,\n\u00a0\u00a0\u00a0\u00a0url string,\n\u00a0\u00a0\u00a0\u00a0session_id string,\n\u00a0\u00a0\u00a0\u00a0referer string,\n\u00a0\u00a0\u00a0\u00a0ip string,\n\u00a0\u00a0\u00a0\u00a0end_user_id string,\n\u00a0\u00a0\u00a0\u00a0city_id string\n)row format delimited fields terminated by '\\t'\nstored as orc\ntblproperties(\"orc.compress\"=\"ZLIB\");\n</code></pre> \u5bfc\u5165\u6570\u636e Text Only<pre><code>insert into log_orc_zlib select * from log_text;\n</code></pre> \u67e5\u770b\u5927\u5c0f\u4e3a2.78 MB</p> <p>\u521b\u5efa\u4e00\u5f20\u5b58\u50a8\u683c\u5f0f\u662forc\uff0c\u538b\u7f29\u65b9\u5f0f\u662fsnappy\u7684\u8868 Text Only<pre><code>create table log_orc_snappy (\n\u00a0\u00a0\u00a0\u00a0track_time string,\n\u00a0\u00a0\u00a0\u00a0url string,\n\u00a0\u00a0\u00a0\u00a0session_id string,\n\u00a0\u00a0\u00a0\u00a0referer string,\n\u00a0\u00a0\u00a0\u00a0ip string,\n\u00a0\u00a0\u00a0\u00a0end_user_id string,\n\u00a0\u00a0\u00a0\u00a0city_id string\n)row format delimited fields terminated by '\\t'\nstored as orc\ntblproperties(\"orc.compress\"=\"snappy\");\n</code></pre> \u5bfc\u5165\u6570\u636e\uff0c\u67e5\u770b\u5927\u5c0f\u4e3a 3.75 MB</p> <p>\u521b\u5efa\u4e00\u5f20\u5b58\u50a8\u683c\u5f0f\u662fparquet\uff0c\u538b\u7f29\u65b9\u5f0f\u662fsnappy\u7684\u8868 Text Only<pre><code>create table log_parquet_snappy (\n\u00a0\u00a0\u00a0\u00a0track_time string,\n\u00a0\u00a0\u00a0\u00a0url string,\n\u00a0\u00a0\u00a0\u00a0session_id string,\n\u00a0\u00a0\u00a0\u00a0referer string,\n\u00a0\u00a0\u00a0\u00a0ip string,\n\u00a0\u00a0\u00a0\u00a0end_user_id string,\n\u00a0\u00a0\u00a0\u00a0city_id string\n)row format delimited fields terminated by '\\t'\nstored as parquet\ntblproperties(\"orc.compress\"=\"snappy\");\n</code></pre> \u5bfc\u5165\u6570\u636e\uff0c\u67e5\u770b\u5927\u5c0f\u4e3a6.39 MB\uff086.39 MB\u662f\u8001\u5e08\u6d4b\u7684\uff0c\u6211\u8fd9\u91cc\u6d4b\u8bd5\u5931\u8d25\u4e86\uff0c\u8fd8\u6ca1\u6709\u5f00\u542fsnappy\u538b\u7f29\u65f6\u4e00\u6837\uff0c\u662f13.09 MB\uff09</p> <p>\u5b58\u50a8\u65b9\u5f0f\u548c\u538b\u7f29\u603b\u7ed3\uff1a\u5728\u5b9e\u9645\u7684\u9879\u76ee\u5f00\u53d1\u5f53\u4e2d\uff0chive \u8868\u7684\u6570\u636e\u5b58\u50a8\u683c\u5f0f\u4e00\u822c\u9009\u62e9\uff1aorc \u6216 parquet\u3002\u538b\u7f29\u65b9\u5f0f\u4e00 \u822c\u9009\u62e9 snappy\uff0clzo\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/17-%E5%8E%8B%E7%BC%A9/","title":"17-\u538b\u7f29","text":"<p> \u7ea6 347 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p>\u538b\u7f29\u65b9\u5f0f\u7b49\u5185\u5bb9\u89c1hadoop\u6709\u5173\u538b\u7f29\u7684\u7b14\u8bb0\uff1a17-\u538b\u7f29</p> <p>\u5f00\u542f Map \u8f93\u51fa\u9636\u6bb5\u538b\u7f29\uff08MR \u5f15\u64ce\uff09\uff0c\u53ef\u4ee5\u51cf\u5c11 job \u4e2d map \u548c Reduce task \u95f4\u6570\u636e\u4f20\u8f93\u91cf\u3002 \u5728\u4f1a\u8bdd\u4e2d\u5f00\u542f map \u8f93\u51fa\u9636\u6bb5\u538b\u7f29\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a \uff081\uff09\u5f00\u542f hive \u4e2d\u95f4\u4f20\u8f93\u6570\u636e\u538b\u7f29\u529f\u80fd Text Only<pre><code>set hive.exec.compress.intermediate=true;\n</code></pre> \uff082\uff09\u5f00\u542f mapreduce \u4e2d map \u8f93\u51fa\u538b\u7f29\u529f\u80fd Text Only<pre><code>set mapreduce.map.output.compress=true;\n</code></pre> \uff083\uff09\u8bbe\u7f6e mapreduce \u4e2d map \u8f93\u51fa\u6570\u636e\u7684\u538b\u7f29\u65b9\u5f0f Text Only<pre><code>set mapreduce.map.output.compress.codec=org.apache.hadoop.io.compress.SnappyCodec;\n</code></pre> \uff084\uff09\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff0c\u5728map\u8f93\u51fa\u7aef\u5f00\u542f\u538b\u7f29\u53ea\u80fd\u5728\u65e5\u5fd7\u4e2d\u770b\u5230\u6548\u679c\uff0c\u6240\u4ee5\u53ef\u4ee5\u5148\u4e0d\u5f00\u542f\u538b\u7f29\u6267\u884c\u4e00\u904d\uff0c\u7136\u540e\u518d\u5f00\u542f\u6267\u884c\u4e00\u904d\uff0c\u5bf9\u6bd4\u4e24\u6b21\u7684\u65e5\u5fd7\uff0c\u5728\u5386\u53f2\u670d\u52a1\u5668\u4e2d\u53ef\u4ee5\u770b\u5230\u65e5\u5fd7\u3002 Text Only<pre><code>select count(ename) name from emp;\n</code></pre> \u5f00\u542f\u538b\u7f29\u4e4b\u540e\u7684\u65e5\u5fd7\uff0c\u6ca1\u6709\u5f00\u542f\u538b\u7f29\u662f\u6ca1\u6709\u8fd9\u4e00\u884c\u7684\uff1a </p> <p>\u5f00\u542f Reduce \u8f93\u51fa\u9636\u6bb5\u538b\u7f29\uff0c\u53ef\u4ee5\u4ee5\u538b\u7f29\u6587\u4ef6\u7684\u65b9\u5f0f\u4fdd\u5b58\u67e5\u8be2\u7ed3\u679c\u3002 \u64cd\u4f5c\u8fc7\u7a0b\uff1a \uff081\uff09\u5f00\u542f hive \u6700\u7ec8\u8f93\u51fa\u6570\u636e\u538b\u7f29\u529f\u80fd Text Only<pre><code>set hive.exec.compress.output=true;\n</code></pre> \uff082\uff09\u5f00\u542f mapreduce \u6700\u7ec8\u8f93\u51fa\u6570\u636e\u538b\u7f29 Text Only<pre><code>set mapreduce.output.fileoutputformat.compress=true;\n</code></pre> \uff083\uff09\u8bbe\u7f6e mapreduce \u6700\u7ec8\u6570\u636e\u8f93\u51fa\u538b\u7f29\u65b9\u5f0f Text Only<pre><code>set mapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.SnappyCodec;\n</code></pre> \uff084\uff09\u8bbe\u7f6e mapreduce \u6700\u7ec8\u6570\u636e\u8f93\u51fa\u538b\u7f29\u4e3a\u5757\u538b\u7f29\uff0c\u9ed8\u8ba4\u662fRECORD\uff0c\u4ee5\u8bb0\u5f55\u4e3a\u5355\u4f4d\u538b\u7f29\u3002 Text Only<pre><code>set mapreduce.output.fileoutputformat.compress.type=BLOCK;\n</code></pre> \uff085\uff09\u6d4b\u8bd5\u4e00\u4e0b\u8f93\u51fa\u7ed3\u679c\u662f\u5426\u662f\u538b\u7f29\u6587\u4ef6 Text Only<pre><code>insert overwrite local directory '/opt/module/data/distribute-result'\nselect * from emp distribute by deptno sort by empno desc;\n</code></pre> </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/18-%E4%BC%98%E5%8C%96/","title":"18-\u4f18\u5316","text":"<p> \u7ea6 2797 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 56 \u5206\u949f</p> <p>1.\u6267\u884c\u8ba1\u5212 \u67e5\u770b\u6267\u884c\u8ba1\u5212\uff1aexplain \u67e5\u770b\u8be6\u7ec6\u7684\u6267\u884c\u8ba1\u5212\uff1aexplain extended</p> <p>2.Fetch \u6293\u53d6 Fetch \u6293\u53d6\u662f\u6307Hive\u5bf9\u4e00\u4e9b\u7b80\u5355\u7684\u67e5\u8be2\u53ef\u4ee5\u4e0d\u5fc5\u4f7f\u7528 MapReduce \u8ba1\u7b97\u3002\u4f8b\u5982\uff1aSELECT* FROM employees;\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cHive \u53ef\u4ee5\u7b80\u5355\u5730\u8bfb\u53d6 employee \u5bf9\u5e94\u7684\u5b58\u50a8\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c \u7136\u540e\u8f93\u51fa\u67e5\u8be2\u7ed3\u679c\u5230\u63a7\u5236\u53f0\u3002 \u4ec0\u4e48\u662f\u7b80\u5355\u7684\u67e5\u8be2\u5462\uff1f\u89c1\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u63cf\u8ff0\uff0c\u76ee\u524d\u7b80\u5355\u67e5\u8be2\u8bed\u53e5\u662f\u6307\u6ca1\u6709\u4efb\u4f55\u5b50\u67e5\u8be2\u3001\u6ca1\u6709\u4efb\u4f55\u805a\u96c6\u51fd\u6570\u3001\u6ca1\u6709distinct\u3001\u6ca1\u6709lateral view\u3001\u6ca1\u6709join\u7684\u8bed\u53e5\u3002 \u5728 hive-default.xml.template \u6587\u4ef6\u4e2d hive.fetch.task.conversion \u9ed8\u8ba4\u662f more\u3002\u6307\u5b9a\u4e3anone\u5219\u6240\u6709\u7b80\u5355\u67e5\u8be2\u90fd\u4f1a\u8d70MR\uff1b\u6307\u5b9a\u4e3aminimal\uff0c\u5219\u53ea\u6709select *\u3001\u7528\u5206\u533a\u5b57\u6bb5\u8fc7\u6ee4\u3001limit\u7684\u7b80\u5355\u67e5\u8be2\u624d\u4e0d\u8d70MR\uff0c\u5176\u5b83\u7b80\u5355\u67e5\u8be2\u5747\u4f1a\u8d70MR\uff1b\u6307\u5b9a\u4e3amore\uff0c\u5219\u7b80\u5355\u67e5\u8be2\uff08\u652f\u6301\u7b80\u5355\u7684\u62bd\u6837\u67e5\u8be2\u548c\u865a\u62df\u5217\u67e5\u8be2\uff09\u5747\u4e0d\u4f1a\u8d70MR\u3002 Text Only<pre><code>&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.fetch.task.conversion&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;more&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;description&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Expects one of [none, minimal, more].\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Some select queries can be converted to single FETCH task minimizing latency.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Currently the query should be single sourced not having any subquery and should not have\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0any aggregations or distincts (which incurs RS), lateral views and joins.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a00. none : disable hive.fetch.task.conversion\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01. minimal : SELECT STAR, FILTER on partition columns, LIMIT only\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02. more\u00a0\u00a0\u00a0\u00a0: SELECT, FILTER, LIMIT only (support TABLESAMPLE and virtual columns)\n\u00a0\u00a0\u00a0\u00a0&lt;/description&gt;\n\u00a0\u00a0&lt;/property&gt;\n</code></pre></p> <p>3.\u672c\u5730\u6a21\u5f0f \u6ca1\u6709\u5f00\u542f\u672c\u5730\u6a21\u5f0f\u65f6\uff0c\u6240\u6709\u4efb\u52a1\u90fd\u4f1a\u63d0\u4ea4\u7ed9yarn\u6765\u8c03\u5ea6\u6267\u884c\uff0c\u5f00\u542f\u672c\u5730\u6a21\u5f0f\u4e4b\u540e\uff0chive\u4f1a\u5148\u5224\u65ad\u67e5\u8be2\u7684\u6570\u636e\u91cf\u5927\u4e0d\u5927\uff0c\u5982\u679c\u4e0d\u5927\u5c31\u76f4\u63a5\u5728\u672c\u5730\u8fd0\u884c\uff0c\u4e0d\u63d0\u4ea4\u7ed9yarn\u3002 Text Only<pre><code>//\u5f00\u542f\u672c\u5730 mr\uff0c\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\nset hive.exec.mode.local.auto=true;\n//\u8bbe\u7f6e local mr \u7684\u6700\u5927\u8f93\u5165\u6570\u636e\u91cf\uff0c\u5f53\u8f93\u5165\u6570\u636e\u91cf\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u65f6\u91c7\u7528 local mr \u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3a 134217728\uff0c\u5373 128M\nset hive.exec.mode.local.auto.inputbytes.max=50000000;\n//\u8bbe\u7f6e local mr \u7684\u6700\u5927\u8f93\u5165\u6587\u4ef6\u4e2a\u6570\uff0c\u5f53\u8f93\u5165\u6587\u4ef6\u4e2a\u6570\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u65f6\u91c7\u7528 local mr \u7684\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3a 4\nset hive.exec.mode.local.auto.input.files.max=10;\n</code></pre></p> <p>4.\u4f18\u5316\u5927\u8868\u548c\u5c0f\u8868\u7684join 4.1\u00a0\u5f00\u542f MapJoin (1)\u5f00\u542f Map join\uff0c\u9ed8\u8ba4\u5c31\u662f true Text Only<pre><code>set hive.auto.convert.join = true;\n</code></pre> (2)\u5927\u8868\u5c0f\u8868\u7684\u9608\u503c\u8bbe\u7f6e\uff08\u9ed8\u8ba4 25M \u4ee5\u4e0b\u8ba4\u4e3a\u662f\u5c0f\u8868\uff09\uff1a Text Only<pre><code>set hive.mapjoin.smalltable.filesize = 25000000;\n</code></pre></p> <p>4.2\u00a0 \u7a7a key \u8fc7\u6ee4\u3002key\u662f\u6307map\u9636\u6bb5\u8f93\u51fa\u7ed3\u679c\u4e2d\u7684key\uff0c\u5728join\u65f6\uff0con\u540e\u9762\u505a\u8fde\u63a5\u7684\u5b57\u6bb5\u5c31\u662fmap\u8f93\u51fa\u4e2d\u7684key\u3002\u6bd4\u5982\u62ff\u5de6\u8fde\u63a5\u6765\u8bf4\uff0c\u7531\u4e8e\u9700\u8981\u4fdd\u7559\u5de6\u8fb9\u8868\u7684\u6240\u6709\u6570\u636e\uff0c\u5982\u679c\u5de6\u8fb9\u8868\u505a\u8fde\u63a5\u7684\u5b57\u6bb5\u6709\u5927\u91cf\u7684null\u503c\uff0c\u8fd9\u4e9bnull\u503c\u6240\u5728\u7684\u884c\u5728\u8fde\u63a5\u65f6\u662f\u4f1a\u4fdd\u7559\u4e0b\u6765\u7684\uff0c\u53c8\u5982\u679c\u5305\u542b\u8fd9\u4e9bnull\u503c\u7684\u884c\u6211\u4eec\u672c\u6765\u4e0d\u60f3\u8981\uff0c\u90a3\u4e48\u8fd9\u65f6\u5c31\u5e94\u8be5\u5148\u8fc7\u6ee4\u6389\u8fd9\u4e9bnull\u503c\u6240\u5728\u7684\u884c\uff0c\u7136\u540e\u518d\u505a\u8fde\u63a5\u3002right join\u548cfull join\u60c5\u51b5\u7c7b\u4f3c\u3002\u5728\u505a\u5185\u8fde\u63a5\u65f6\uff0c\u5982\u679c\u8fde\u63a5\u7684\u5b57\u6bb5\u662fnull\uff0c\u90a3\u4e48\u8be5\u884c\u7684\u6570\u636e\u4f1a\u76f4\u63a5\u4e22\u5f03\uff0c\u4e0d\u4f1a\u53c2\u4e0e\u8fde\u63a5\u7684\u8ba1\u7b97\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8003\u8651\u5148\u7a7a key \u8fc7\u6ee4\u3002 Text Only<pre><code>select n.*\nfrom (select * from nullidtable where id is not null) n\nleft join bigtable o\non n.id = o.id;\n</code></pre></p> <p>4.3\u00a0 \u7a7a key \u8f6c\u6362\u3002\u7a7a key \u8fc7\u6ee4\u662f\u5f53\u505a\u8fde\u63a5\u7684\u5b57\u6bb5\u662fnull\uff0c\u5e76\u4e14\u8fd9\u4e9b\u6570\u636e\u672c\u6765\u5c31\u662f\u6211\u4eec\u4e0d\u60f3\u8981\u7684\uff0c\u90a3\u4e48\u5e94\u8be5\u5148\u8fc7\u6ee4\u6389\u8fd9\u4e9b\u6570\u636e\u3002\u800c\u5f53\u8fd9\u4e9bnull\u503c\u6240\u5728\u884c\u7684\u6570\u636e\u6211\u4eec\u8fd8\u60f3\u8981\uff0c\u90a3\u4e48\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u8003\u8651\u6570\u636e\u503e\u659c\u7684\u95ee\u9898\u4e86\uff0c\u56e0\u4e3a\u5177\u6709\u76f8\u540ckey\u503c\u7684\u6570\u636e\u662f\u4e00\u5b9a\u4f1a\u8fdb\u5165\u5230\u540c\u4e00\u4e2areduce\u4e2d\u7684\uff0c\u5982\u679c\u5f53key\u662fnull\u7684\u6570\u636e\u6709\u5f88\u591a\uff0c\u90a3\u4e48\u5c31\u4f1a\u9020\u6210\u62c9\u53d6null\u503c\u7684reduce\u6570\u636e\u503e\u659c\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u91c7\u53d6\u7a7a key \u8f6c\u6362\u7684\u624b\u6bb5\u6765\u4f18\u5316\uff0c\u5177\u4f53\u505a\u6cd5\u662f\u628anull\u503c\u7528\u4e00\u4e2a\u968f\u673a\u503c\u6765\u66ff\u6362\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e9b\u6570\u636e\u5206\u6563\u5230\u4e0d\u540c\u7684reduce\u4e2d\u53bb\u4e86\u3002\u6ce8\u610f\uff0c\u5206\u914d\u968f\u673a\u503c\u8981\u4fdd\u8bc1\u539f\u6765join\u4e0d\u4e0a\u7684null\u503c\u73b0\u5728\u8fd8\u662fjoin\u4e0d\u4e0a\u3002 Text Only<pre><code>select n.*\nfrom nullidtable n\nfull join bigtable o\non nvl(n.id,rand()) = o.id;\n</code></pre></p> <p>5.\u4f7f\u7528\u5206\u6876\u8868\u6765\u4f18\u5316\u4e24\u5f20\u5927\u8868\u7684join \u6211\u4eec\u77e5\u9053\u628a\u4e24\u5f20\u5927\u8868\u5206\u6210\u51e0\u5f20\u5c0f\u8868\u4e4b\u540e\u5206\u5f00join\uff0c\u7136\u540e\u628a\u6240\u6709\u7ed3\u679c\u5408\u5e76\u8d77\u6765\u7684\u5f97\u5230\u7684\u6700\u7ec8\u7ed3\u679c\u662f\u9519\u8bef\uff08\u5982\u5de6\u56fe\u6240\u793a\uff09\uff0c\u4f46\u662f\u5bf9\u4e8e\u5206\u6876\u8868\u800c\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e24\u5f20\u90fd\u5efa\u6210\u5206\u6876\u8868\uff0c\u5206\u6876\u7684\u5b57\u6bb5\u5c31\u662f\u505a\u8fde\u63a5\u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u5728\u4e24\u5f20\u8868\u4e2d\u8fde\u63a5\u5b57\u6bb5\u76f8\u540c\u7684\u6570\u636e\u4e00\u5b9a\u540c\u4e00\u4e2a\u6876\u4e2d\uff0c\u4e8e\u662f\u628a\u5c0f\u8868\u5206\u5f00join\uff0c\u7136\u540e\u628a\u7ed3\u679c\u5408\u5e76\u8d77\u6765\u5f97\u5230\u7684\u6700\u7ec8\u7ed3\u679c\u5c31\u662f\u6b63\u786e\u7684\uff08\u5982\u53f3\u56fe\u6240\u793a\uff09\uff0c\u6b64\u65b9\u5f0f\u5176\u5b9e\u5c31\u662fHash join\uff0c\u53ea\u4e0d\u8fc7\u662f\u5728\u4fdd\u5b58\u6570\u636e\u65f6\u5c31\u63d0\u524d\u505a\u597d\u4e86hash\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728Map\u7aef\u7684\u591a\u4e2amap\u4e2d\u5b8c\u6210\u6bcf\u4e24\u4e2a\u6876\u7684join\uff0c\u7136\u540e\u53ea\u5728\u4e00\u4e2aReduce\u4e2d\u5b8c\u6210\u7ed3\u679c\u7684\u805a\u5408\u3002  </p> <p>6.\u4f18\u5316group by \u5982\u679c\u4f7f\u7528\u4e86set mapreduce.job.reduces\u8bbe\u7f6ereduce\u7684\u4e2a\u6570\uff0c\u90a3\u4e48\u4f7f\u7528group by\u5c31\u4f1a\u5f00\u542f\u76f8\u5e94\u4e2a\u6570\u7684reduce\u6765\u8ba1\u7b97\uff08\u4f46\u76ee\u524d\u4e3a\u6b62\uff0c\u597d\u50cf\u8bbe\u7f6ereduce\u7684\u4e2a\u6570\u53ea\u5bf9order by\u4e0ecount(distinct)\u4e24\u79cd\u60c5\u51b5\u65e0\u6548\uff0c\u65e0\u8bba\u8bbe\u7f6e\u591a\u5c11\u4e2a\uff0c\u5b83\u4fe9\u7684reduce\u4e2a\u6570\u90fd\u662f1\uff0c\u5176\u5b83\u8bed\u53e5\u90fd\u662f\u8bbe\u7f6e\u591a\u5c11\u4e2a\u5f00\u5c31\u591a\u5c11reduce\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u503c-1\uff0c\u90a3\u4e48hive\u5c31\u4f1a\u6839\u636e\u540e\u9762\u8981\u8bb2\u7684\u5f0f\u5b50\u8ba1\u7b97\u5f97\u5230\uff09\u3002 \u4e0ejoin on\u505a\u8fde\u63a5\u7684\u5b57\u6bb5\u4f1a\u88ab\u4f5c\u4e3amap\u9636\u6bb5\u8f93\u51fa\u7ed3\u679c\u4e2dkey\u4e00\u6837\uff0cgroup by\u7684\u5b57\u6bb5\u4e5f\u4f1a\u88ab\u5f53\u4f5ckey\uff0c\u7531\u4e8ekey\u76f8\u540c\u7684\u6570\u636e\u4e00\u5b9a\u4f1a\u8fdb\u5230\u540c\u4e00\u4e2areduce\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u5f53\u67d0\u4e00\u4e2a\u6216\u51e0\u4e2akey\u7684\u6570\u636e\u91cf\u592a\u5927\u65f6\uff0c\u540c\u6837\u6709\u6570\u636e\u503e\u659c\u7684\u95ee\u9898\uff0c\u4f1a\u9020\u6210\u90e8\u5206reduce\u4efb\u52a1\u6267\u884c\u7684\u65f6\u95f4\u8fc7\u957f\u3002 \u4e24\u79cd\u4f18\u5316\u624b\u6bb5\uff0c\u8fd9\u4e24\u4e2a\u4f18\u5316\u624b\u6bb5\u901a\u5e38\u662f\u4e00\u8d77\u5f00\u542f\uff1a 6.1\u00a0 \u5f00\u542f Map \u7aef\u805a\u5408 \u8bbe\u7f6e\u5f00\u542f Map \u7aef\u805a\u5408\uff0c\u9ed8\u8ba4\u4e3atrue\u5373\u5f00\u542f Text Only<pre><code>set\u00a0hive.map.aggr=true\n</code></pre> \u8bbe\u7f6e\u5728 Map \u7aef\u8fdb\u884c\u805a\u5408\u64cd\u4f5c\u7684\u6761\u76ee\u6570\u76ee Text Only<pre><code>set\u00a0hive.groupby.mapaggr.checkinterval=100000;\n</code></pre></p> <p>6.2 \u5f00\u542f\u8d1f\u8f7d\u5747\u8861\uff0c\u9ed8\u8ba4\u4e3afalse\uff0c\u6ca1\u6709\u5f00\u542f Text Only<pre><code>set\u00a0hive.groupby.skewindata=true;\n</code></pre> \u8d1f\u8f7d\u5747\u8861\u662f\u6307\uff0c\u5f53\u540c\u4e00key\u7684\u6570\u636e\u91cf\u8fc7\u591a\u65f6\uff0c\u4f1a\u5728key\u540e\u9762\u62fc\u63a5\u4e00\u4e9b\u968f\u673a\u6570\uff0c\u8fd9\u6837\u539f\u672c\u76f8\u540c\u7684key\u5c31\u4f1a\u8fdb\u5230\u4e0d\u540c\u7684reduce\u4e2d\u53bb\u4e86\u3002\u4f46\u662f\u8fd9\u6837\u4f1a\u5bfc\u81f4\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u4e0d\u5bf9\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u518d\u6765\u4e00\u4e2ajob\uff0c\u5373\u518d\u8fdb\u884c\u4e00\u6b21MapReduce\uff0c\u8fd9\u6b21\u662f\u628a\u524d\u4e00\u4e2ajob\u7684\u7ed3\u679c\u7684key\u7684\u968f\u673a\u6570\u53bb\u6389\uff0c\u7136\u540ereduce\u5f97\u5230\u6700\u7ec8\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <p>7.\u4f18\u5316count(distinct) \u7531\u4e8ecount(distinct)\u64cd\u4f5c\u53ea\u80fd\u7528\u4e00\u4e2a ReduceTask \u6765\u5b8c\u6210\uff0c\u5f53\u6570\u636e\u91cf\u5f88\u5927\u65f6\uff0c\u4e00\u4e2a Reduce \u9700\u8981\u5904\u7406\u7684\u6570\u636e\u91cf\u592a\u5927\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a Job \u5f88\u96be\u5b8c\u6210\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u6761SQL\uff0c\u5373\u4f7f\u8bbe\u7f6ereduce\u7684\u4e2a\u6570\u4e3a5\uff0c\u6700\u540e\u4e5f\u53ea\u4f1a\u542f\u52a8\u4e00\u4e2areduce\u6765\u5b8c\u6210\uff0c\u56e0\u4e3a\u6d89\u53ca\u53bb\u91cd\u64cd\u4f5c\u3002\uff08\u5982\u679cbigtable\u662f\u5f20\u5206\u6876\u8868\uff0c\u5f53count(distinct(field))\u7684field\u548c\u5206\u6876\u7684\u5b57\u6bb5\u76f8\u540c\u65f6\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u542f\u52a8\u591a\u4e2areduce\u6765\u5b8c\u6210\uff0c\u6bcf\u4e2areduce\u8d1f\u8d23\u4e00\u4e2a\u6876\uff0c\u4f46\u5b9e\u9645hive\u5e76\u6ca1\u5b9e\u73b0\u3002\uff09 Text Only<pre><code>set mapreduce.job.reduces = 5;\n</code></pre> Text Only<pre><code>select count(distinct id) from bigtable;\n</code></pre> \u4f18\u5316\u7684\u65b9\u6cd5\u662f\u7528\u5148 GROUP BY \u518d COUNT \u7684\u65b9\u5f0f\u6765\u66ff\u6362count(distinct) Text Only<pre><code>select count(id) from (select id from bigtable group by id) a;\n</code></pre> \u8fd9\u6837\u5c31\u4f1a\u5f00\u4e24\u4e2ajob\u6765\u5b8c\u6210\u4efb\u52a1\u3002\u7b2c\u4e00\u4e2ajob\u4f1a\u5f00\u542f5\u4e2areduce\u6765\u5b8c\u6210select id from bigtable group by id\uff0c\u56e0\u4e3a\u8bbe\u7f6e\u7684reduce\u7684\u4e2a\u6570\u662f5\uff0cid\u76f8\u540c\u7684\u6570\u636e\u8fdb\u5230\u540c\u4e00\u4e2areduce\uff0c\u540c\u4e00\u4e2areduce\u91cc\u9762\u53ef\u4ee5\u6709\u591a\u4e2a\u4e0d\u540c\u7684id\u3002\u7b2c\u4e8c\u4e2ajob\u53ea\u4f1a\u6709\u4e00\u4e2areduce\uff0c\u56e0\u4e3a\u8981\u5b8c\u6210count(id)\u3002\u5f53\u7136\u5728\u4f7f\u7528 group by\u65f6\u8981\u8003\u8651\u6570\u636e\u503e\u659c\u7684\u95ee\u9898\u3002</p> <p>8.\u884c\u5217\u8fc7\u6ee4 \u5217\u5904\u7406\uff1a\u5728 SELECT \u4e2d\uff0c\u53ea\u62ff\u9700\u8981\u7684\u5217\uff0c\u5982\u679c\u6709\u5206\u533a\uff0c\u5c3d\u91cf\u4f7f\u7528\u5206\u533a\u8fc7\u6ee4\uff0c\u5c11\u7528 SELECT *\u3002 \u884c\u5904\u7406\uff1a\u867d\u7136\u6709\u8c13\u8bcd\u4e0b\u63a8\uff0c\u4f46\u8c13\u8bcd\u4e0b\u63a8\u53ef\u80fd\u4f1a\u5728\u590d\u6742\u7684SQL\u8bed\u53e5\u4e2d\u5931\u6548\uff0c\u6240\u4ee5\u5c3d\u91cf\u5728\u8fde\u63a5\u65f6\u5148\u8fc7\u6ee4\u6389\u4e00\u90e8\u5206\u6570\u636e\uff0c\u7136\u540e\u518djoin\u3002</p> <p>9. \u5408\u7406\u8bbe\u7f6e Map \u53ca Reduce \u6570</p> <p>\u5408\u7406\u8bbe\u7f6eMapTask\u7684\u6570\u91cf\uff1a 1.MapTask\u7684\u4e2a\u6570\u7531\u5207\u7247\u6570\u91cf\u51b3\u5b9a\uff0c\u6240\u4ee5\u53ef\u4ee5\u8bbe\u7f6e\u6700\u5927\u5207\u7247\u7684\u5927\u5c0f\u6765\u63a7\u5236\u5207\u7247\u6570\u91cf\uff0c\u4ee5\u4e0b\u662f\u9ed8\u8ba4\u503c\u3002 Text Only<pre><code>mapreduce.input.fileinputformat.split.maxsize=256000000;\n</code></pre> 2.\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76 map\u7aef\u8f93\u5165\u65f6\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u53ef\u4ee5\u51cf\u5c11MapTask\u7684\u6570\u91cf\uff0cCombineHiveInputFormat \u5177\u6709\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u7684\u529f\u80fd\uff0c\u4e5f\u662f\u7cfb\u7edf\u9ed8\u8ba4\u7684\u8f93\u5165\u7c7b\u578b\u3002HiveInputFormat \u6ca1\u6709\u5bf9\u5c0f\u6587\u4ef6\u5408\u5e76\u529f\u80fd\u3002 Text Only<pre><code>set hive.input.format = org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;\n</code></pre></p> <p>\u9644\uff1a\u8bbe\u7f6e\u5728 Map-Reduce \u7684\u4efb\u52a1\u7ed3\u675f\u65f6\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u8fd9\u4e0d\u5c5e\u4e8e\u8c03\u6574MapTask\u6570\u91cf\u7684\u4f18\u5316 \u5728 map-only \u4efb\u52a1\uff08\u6ca1\u6709reduce\u7684\u4efb\u52a1\uff09\u7ed3\u675f\u65f6\u5408\u5e76\u5c0f\u6587\u4ef6\uff0c\u9ed8\u8ba4 true Text Only<pre><code>set hive.merge.mapfiles = true;\n</code></pre> \u5728 map-reduce \u4efb\u52a1\u7ed3\u675f\u65f6\u5408\u5e76\u5c0f\u6587\u4ef6\uff0c\u9ed8\u8ba4 false Text Only<pre><code>set hive.merge.mapredfiles = true;\n</code></pre> \u8bbe\u7f6e\u5408\u5e76\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4 256M Text Only<pre><code>set hive.merge.size.per.task = 268435456;\n</code></pre> \u8bbe\u7f6e\u5c0f\u6587\u4ef6\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u5f53\u8f93\u51fa\u6587\u4ef6\u5927\u5c0f\u5c0f\u4e8e\u8be5\u503c\u65f6\uff0c\u542f\u52a8\u4e00\u4e2a\u72ec\u7acb\u7684 map-reduce \u4efb\u52a1\u8fdb\u884c\u6587\u4ef6 merge\u00a0\u00a0 Text Only<pre><code>set hive.merge.smallfiles.avgsize = 16777216;\n</code></pre></p> <p>\u5408\u7406\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\uff1a \u76ee\u524d\u4e3a\u6b62\uff0c\u597d\u50cf\u8bbe\u7f6ereduce\u7684\u4e2a\u6570\u53ea\u5bf9order by\u4e0eCount(Distinct)\u4e24\u79cd\u60c5\u51b5\u65e0\u6548\uff0c\u65e0\u8bba\u8bbe\u7f6e\u591a\u5c11\u4e2a\uff0c\u5b83\u4fe9\u7684reduce\u4e2a\u6570\u90fd\u662f1\uff0c\u5176\u5b83\u8bed\u53e5\u90fd\u662f\u6839\u636e\u65b9\u6cd5\u4e8c\u8bbe\u7f6e\u7684\u591a\u5c11\u4e2a\u5f00\u5c31\u591a\u5c11reduce\uff0c\u5982\u679c\u4e3a\u9ed8\u8ba4\u503c-1\uff0c\u90a3\u4e48hive\u5c31\u4f1a\u6839\u636e\u4e0b\u9762\u7684\u65b9\u6cd5\u4e00\u8ba1\u7b97\u5f97\u5230\u3002</p> <p>\u8c03\u6574reduce\u4e2a\u6570\u65b9\u6cd5\u4e00\uff0c\u53ea\u5728set mapreduce.job.reduces = -1\u65f6\u751f\u6548\uff1a \uff081\uff09\u8bbe\u7f6e\u6bcf\u4e2a Reduce \u5904\u7406\u7684\u6570\u636e\u91cf\u9ed8\u8ba4\u662f 256MB Text Only<pre><code>hive.exec.reducers.bytes.per.reducer=256000000\n</code></pre> \uff082\uff09\u8bbe\u7f6e\u6bcf\u4e2a\u4efb\u52a1\u6700\u5927\u7684 reduce \u6570\uff0c\u9ed8\u8ba4\u4e3a 1009 Text Only<pre><code>hive.exec.reducers.max=1009\u00a0\u00a0\u00a0\u00a0\u00a0\n</code></pre> reduce\u7684\u4e2a\u6570\u7531\u4ee5\u4e0a\u4e24\u4e2a\u53c2\u6570\u4ee5\u53camap\u7aef\u8f93\u51fa\u6570\u91cf\u91cf\u5171\u540c\u51b3\u5b9a\uff0c\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a Text Only<pre><code>N=min(\u53c2\u65702\uff0c\u603b\u8f93\u5165\u6570\u636e\u91cf/\u53c2\u65701)\n</code></pre></p> <p>\u8c03\u6574reduce\u4e2a\u6570\u65b9\u6cd5\u4e8c\uff1a \u5728 hadoop \u7684 mapred-default.xml \u6587\u4ef6\u4e2d\u4fee\u6539\uff0c\u6216\u8005\u5728hive\u4f1a\u8bdd\u4e2d\u8bbe\u7f6e\u6bcf\u4e2a job \u7684 Reduce \u4e2a\u6570\uff1a Text Only<pre><code>set mapreduce.job.reduces = 15;\n</code></pre></p> <p>reduce \u4e2a\u6570\u5e76\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff1a \uff081\uff09\u8fc7\u591a\u7684\u542f\u52a8\u548c\u521d\u59cb\u5316 reduce \u4e5f\u4f1a\u6d88\u8017\u65f6\u95f4\u548c\u8d44\u6e90\uff1b \uff082\uff09\u53e6\u5916\uff0c\u6709\u591a\u5c11\u4e2a reduce\uff0c\u5c31\u4f1a\u6709\u591a\u5c11\u4e2a\u8f93\u51fa\u6587\u4ef6\uff0c\u5982\u679c\u751f\u6210\u4e86\u5f88\u591a\u4e2a\u5c0f\u6587\u4ef6\uff0c\u90a3 \u4e48\u5982\u679c\u8fd9\u4e9b\u5c0f\u6587\u4ef6\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u4efb\u52a1\u7684\u8f93\u5165\uff0c\u5219\u4e5f\u4f1a\u51fa\u73b0\u5c0f\u6587\u4ef6\u8fc7\u591a\u7684\u95ee\u9898\uff1b \u5728\u8bbe\u7f6e reduce \u4e2a\u6570\u7684\u65f6\u5019\u4e5f\u9700\u8981\u8003\u8651\u8fd9\u4e24\u4e2a\u539f\u5219\uff1a\u5904\u7406\u5927\u6570\u636e\u91cf\u5229\u7528\u5408\u9002\u7684 reduce \u6570\uff1b \u4f7f\u5355\u4e2a reduce \u4efb\u52a1\u5904\u7406\u6570\u636e\u91cf\u5927\u5c0f\u8981\u5408\u9002\uff1b</p> <p>10.\u5e76\u884c\u6267\u884c Hive \u4f1a\u5c06\u4e00\u4e2aSQL\u67e5\u8be2\u8f6c\u5316\u6210\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u9636\u6bb5\uff0c \u8bbe\u7f6e\u53c2\u6570 hive.exec.parallel \u503c\u4e3a true\uff0c\u53ef\u4ee5\u8ba9\u591a\u4e2a\u9636\u6bb5\u5e76\u53d1\u6267\u884c\uff0c\u9ed8\u8ba4\u662ffalse\u3002 Text Only<pre><code>set hive.exec.parallel=true;\nset hive.exec.parallel.thread.number=16; //\u540c\u4e00\u4e2a sql \u5141\u8bb8\u6700\u5927\u5e76\u884c\u5ea6\uff0c\u9ed8\u8ba4\u4e3a8\u3002\n</code></pre></p> <p>11.\u4e25\u683c\u6a21\u5f0f 11.1 \u4ee5\u4e0b\u53c2\u6570\u8bbe\u7f6e\u4e3atrue\uff0c\u5bf9\u4e8e\u5206\u533a\u8868\uff0c\u9664\u975e where \u8bed\u53e5\u4e2d\u542b\u6709\u5206\u533a\u5b57\u6bb5\u8fc7\u6ee4\u6761\u4ef6\u6765\u9650\u5236\u8303\u56f4\uff0c\u5426\u5219\u4e0d\u5141\u8bb8\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u4e0d\u5141\u8bb8\u7528\u6237\u626b\u63cf\u6240\u6709\u5206\u533a\uff0c\u9ed8\u8ba4\u662ffalse\u3002 Text Only<pre><code>set\u00a0hive.strict.checks.no.partition.filter=true;\n</code></pre> 11.2\u00a0 \u4ee5\u4e0b\u53c2\u6570\u8bbe\u7f6e\u4e3atrue\uff0c\u5bf9\u4e8e\u4f7f\u7528\u4e86 order by \u8bed\u53e5\u7684\u67e5\u8be2\uff0c\u8981\u6c42\u5fc5\u987b\u4f7f\u7528 limit \u8bed\u53e5\uff0c\u5426\u5219\u4e0d\u80fd\u6267\u884c\uff0c\u9ed8\u8ba4\u662ffalse\u3002 Text Only<pre><code>set hive.strict.checks.orderby.no.limit=true;\u00a0\u00a0 \u00a0\n</code></pre> 11.3 \u505a\u8fde\u63a5\u65f6\u4e0d\u52a0on\u8fde\u63a5\u6761\u4ef6\uff0c\u6216\u8005\u8fde\u63a5\u6761\u4ef6\u5931\u6548\uff0c\u90fd\u5c06\u4ea7\u751f\u7b1b\u5361\u5c14\u79ef\uff0c\u4ee5\u4e0b\u53c2\u6570\u8bbe\u7f6e\u4e3atrue\uff0c\u5c06\u4e0d\u5141\u8bb8\u7b1b\u5361\u5c14\u79ef\u67e5\u8be2\u6267\u884c\uff0c\u9ed8\u8ba4\u662ffalse\u3002 Text Only<pre><code>set hive.strict.checks.cartesian.product=true;\n</code></pre></p> <p>12.\u5f00\u542fJVM\u91cd\u7528</p> <p>13.\u538b\u7f29</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/19-%E7%BB%83%E4%B9%A0/","title":"19-\u7ec3\u4e60","text":"<p> \u7ea6 647 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>\u5148\u521b\u5efa\u4e24\u5f20TEXTFILE\u683c\u5f0f\u7684\u8868 \u89c6\u9891\u8868 Text Only<pre><code>create table gulivideo_ori(\n\u00a0\u00a0\u00a0\u00a0videoId string,\n\u00a0\u00a0\u00a0\u00a0uploader string,\n\u00a0\u00a0\u00a0\u00a0age int,\n\u00a0\u00a0\u00a0\u00a0category array&lt;string&gt;,\n\u00a0\u00a0\u00a0\u00a0length int,\n\u00a0\u00a0\u00a0\u00a0views int,\n\u00a0\u00a0\u00a0\u00a0rate float,\n\u00a0\u00a0\u00a0\u00a0ratings int,\n\u00a0\u00a0\u00a0\u00a0comments int,\n\u00a0\u00a0\u00a0\u00a0relatedId array&lt;string&gt;\n)row format delimited fields terminated by \"\\t\"\ncollection items terminated by \"&amp;\"\nstored as textfile;\n</code></pre> \u7528\u6237\u8868 Text Only<pre><code>create table gulivideo_user_ori(\n\u00a0\u00a0\u00a0\u00a0uploader string,\n\u00a0\u00a0\u00a0\u00a0videos int,\n\u00a0\u00a0\u00a0\u00a0friends int\n)row format delimited fields terminated by \"\\t\";\n</code></pre></p> <p>\u628a\u6570\u636e\u5bfc\u5165 Text Only<pre><code>load data local inpath \"/opt/module/data/guliVideo/video\" into table gulivideo_ori;\nload data local inpath \"/opt/module/data/guliVideo/user\" into table gulivideo_user_ori;\n</code></pre></p> <p>\u8fd8\u662f\u4e0a\u9762\u4e24\u5f20\u8868\uff0c\u4f46\u662f\u628a\u5b58\u50a8\u683c\u5f0f\u6539\u6210ORC\uff0c\u538b\u7f29\u683c\u5f0f\u6539\u6210Snappy Text Only<pre><code>create table gulivideo_orc(\n\u00a0\u00a0\u00a0\u00a0videoId string,\n\u00a0\u00a0\u00a0\u00a0uploader string,\n\u00a0\u00a0\u00a0\u00a0age int,\n\u00a0\u00a0\u00a0\u00a0category array&lt;string&gt;,\n\u00a0\u00a0\u00a0\u00a0length int,\n\u00a0\u00a0\u00a0\u00a0\u00a0int,\n\u00a0\u00a0\u00a0\u00a0rate float,\n\u00a0\u00a0\u00a0\u00a0ratings int,\n\u00a0\u00a0\u00a0\u00a0comments int,\n\u00a0\u00a0\u00a0\u00a0relatedId array&lt;string&gt;\n)stored as orc\ntblproperties(\"orc.compress\"=\"SNAPPY\");\n</code></pre> Text Only<pre><code>create table gulivideo_user_orc(\n\u00a0\u00a0\u00a0\u00a0uploader string,\n\u00a0\u00a0\u00a0\u00a0videos int,\n\u00a0\u00a0\u00a0\u00a0friends int\n)stored as orc\ntblproperties(\"orc.compress\"=\"SNAPPY\");\n</code></pre></p> <p>\u628a\u4e0a\u9762\u4e24\u5f20\u7684\u6570\u636e\u63d2\u5230\u4e0b\u9762\u4e24\u5f20\u8868\u4e2d\uff0c\u975eTEXTFILE\u683c\u5f0f\u7684\u8868\u53ea\u80fd\u8fd9\u6837\u505a\uff0c\u56e0\u4e3aload\u65e0\u6cd5\u5bfc\u5165\u5230\u975eTEXTFILE\u683c\u5f0f\u7684\u8868\u4e2d\uff0c\u4f46\u662fload\u53ef\u4ee5\u5bfc\u5206\u533a\u8868\u548c\u5206\u6876\u8868 Text Only<pre><code>insert into table gulivideo_orc select * from gulivideo_ori;\ninsert into table gulivideo_user_orc select * from gulivideo_user_ori;\n</code></pre></p> <p>\u9700\u6c42\uff1a 1.\u7edf\u8ba1\u89c6\u9891\u89c2\u770b\u6570 Top10 Text Only<pre><code>select videoId\nfrom gulivideo_orc\norder by views desc\nlimit 10;\n</code></pre> </p> <p>2.\u7edf\u8ba1\u89c6\u9891\u7c7b\u522b\u70ed\u5ea6 Top10\uff0c\u4e5f\u5c31\u662f\u7c7b\u522b\u6807\u7b7e\u51fa\u73b0\u6700\u591a\u768410\u4e2a Text Only<pre><code>select t.ec,count(t.ec) c\nfrom(\n\u00a0\u00a0\u00a0\u00a0select explode(category) ec\n\u00a0\u00a0\u00a0\u00a0from gulivideo_orc\n) t\ngroup by t.ec\norder by c desc\nlimit 10;\n</code></pre> </p> <p>3.\u7edf\u8ba1\u51fa\u89c6\u9891\u89c2\u770b\u6570\u6700\u9ad8\u7684 20 \u4e2a\u89c6\u9891\u7684\u6240\u5c5e\u7c7b\u522b\u4ee5\u53ca\u7c7b\u522b\u5305\u542b Top20 \u89c6\u9891\u7684\u4e2a\u6570 Text Only<pre><code>select t2.category,count(*)\nfrom (\n\u00a0\u00a0\u00a0\u00a0select explode(t1.category) category\n\u00a0\u00a0\u00a0\u00a0from (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select category\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from gulivideo_orc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order by views desc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0limit 20\n\u00a0\u00a0\u00a0\u00a0)t1\n)t2\ngroup by t2.category;\n</code></pre>  \u4e0b\u9762\u7684\u5199\u6cd5\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3aselect \u5728order by \u4e4b\u524d\u6267\u884c\uff0c\u4f7f\u7528explode(category)\u5c31\u6ca1\u6709views\u4e86\uff0c\u5982\u679c\u53ea\u4f7f\u7528 category \u5c31\u8fd8\u6709views Text Only<pre><code>select explode(category)\nfrom gulivideo_orc\norder by views desc\nlimit 20;\n</code></pre></p> <p>4.\u7edf\u8ba1\u89c6\u9891\u89c2\u770b\u6570 Top50 \u6240\u5173\u8054\u89c6\u9891\u7684\u6240\u5c5e\u7c7b\u522b\u6392\u5e8f Text Only<pre><code>select t2.ec,count(*) c\nfrom(\n\u00a0\u00a0\u00a0\u00a0select explode(category) ec\n\u00a0\u00a0\u00a0\u00a0from gulivideo_orc\n\u00a0\u00a0\u00a0\u00a0where videoId in (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select explode(t1.relatedId)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select relatedId\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from gulivideo_orc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order by views desc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0limit 50\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0)t1\n\u00a0\u00a0\u00a0\u00a0)\n)t2\ngroup by t2.ec\norder by c desc;\n</code></pre> </p> <p>5.\u7edf\u8ba1\u6bcf\u4e2a\u7c7b\u522b\u4e2d\u7684\u89c6\u9891\u70ed\u5ea6 Top10,\u4ee5 Music \u4e3a\u4f8b Text Only<pre><code>select videoId, views, ec\nfrom gulivideo_orc\nlateral view explode(category) category_tmp as ec\nwhere ec='Music'\norder by views desc\nlimit 10;\n</code></pre> </p> <p>6.\u7edf\u8ba1\u6bcf\u4e2a\u7c7b\u522b\u89c6\u9891\u89c2\u770b\u6570 Top10 Text Only<pre><code>select t1.videoId, t1.views, t1.ec, t1.r\nfrom(\n\u00a0\u00a0\u00a0\u00a0select videoId, views, ec, rank() over(partition by ec order by views desc) r\n\u00a0\u00a0\u00a0\u00a0from gulivideo_orc\n\u00a0\u00a0\u00a0\u00a0lateral view explode(category) category_tmp as ec\n)t1\nwhere t1.r&lt;=10;\n</code></pre> \u5f00\u7a97\u548c\u70b8\u88c2\u51fd\u6570\u6267\u884c\u6d41\u7a0b\uff1a </p> <p></p> <p>7.\u7edf\u8ba1\u4e0a\u4f20\u89c6\u9891\u6700\u591a\u7684\u7528\u6237 Top10 \u4ee5\u53ca\u4ed6\u4eec\u4e0a\u4f20\u7684\u89c6\u9891\u89c2\u770b\u6b21\u6570\u5728\u524d 20 \u7684\u89c6\u9891 Text Only<pre><code>select t1.uploader, t1.videoId, t1.views, t1.r\nfrom(\n\u00a0\u00a0\u00a0\u00a0select uploader, videoId, views, rank() over(partition by uploader order by views desc) r\n\u00a0\u00a0\u00a0\u00a0from gulivideo_orc\n\u00a0\u00a0\u00a0\u00a0where uploader in (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select uploader\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from gulivideo_user_orc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order by videos desc\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0limit 10\n\u00a0\u00a0\u00a0\u00a0)\n)t1\nwhere t1.r&lt;=20;\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/2-DDL%EF%BC%88%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%EF%BC%89/","title":"2-DDL\uff08\u6570\u636e\u5b9a\u4e49\u8bed\u8a00\uff09","text":"<p> \u7ea6 1355 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 27 \u5206\u949f</p> <p>DDL \u6570\u636e\u5b9a\u4e49\u8bed\u8a00\u91cd\u70b9\u662f\u5efa\u5e93\u548c\u5efa\u8868</p> <p>\u4e00\u3001\u5bf9\u6570\u636e\u5e93\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff1a 1.\u521b\u5efa\u6570\u636e\u5e93 Text Only<pre><code>CREATE DATABASE [IF NOT EXISTS] database_name\n[COMMENT database_comment]\n[LOCATION hdfs_path]\n[WITH DBPROPERTIES (property_name=property_value, ...)];\n</code></pre> COMMENT \u6ce8\u91ca\uff0c\u89e3\u91ca\u8fd9\u4e2a\u5e93\u662f\u505a\u4ec0\u4e48\u7528\u7684 LOCATION \u7528\u4e8e\u6307\u5b9a\u6570\u636e\u5e93\u5728HDFS\u4e0a\u5b58\u653e\u7684\u4f4d\u7f6e\uff0c\u4f7f\u7528LOCATION\u6307\u5b9a\u4f4d\u7f6e\u7684\u8bdd\u5c31\u76f4\u63a5\u4f7f\u7528\u6307\u5b9a\u7684\u76ee\u5f55\u4f5c\u4e3a\u6570\u636e\u5e93\uff0c\u5426\u5219\u9ed8\u8ba4\u662f\u5728/user/hive/warehouse\u4e0b\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\u8868\u793a\u6570\u636e\u5e93\uff0c\u5e76\u4e14\u76ee\u5f55\u7684\u540d\u5b57\u662fdatabase_name\u540e\u9762\u52a0\u4e0a.db\u540e\u7f00\uff0c\u52a0\u4e0a\u8fd9\u4e2a\u540e\u7f00\u5176\u5b9e\u662f\u4e3a\u4e86\u4e8edefault\u5e93\u533a\u5206\uff0c\u56e0\u4e3a/user/hive/warehouse\u8fd9\u4e2a\u76ee\u5f55\u5c31\u662fdefault\u6570\u636e\u5e93\uff0c\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u4e0d\u5e26.db\u7684\u76ee\u5f55\u5c31\u662fdefault\u5e93\u4e2d\u7684\u8868\uff08\u5f53\u7136\u5143\u6570\u636e\u5e93\u4e2d\u5f97\u6709\u8fd9\u5f20\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\uff09\u3002 WITH DBPROPERTIES \u6307\u5b9a\u8bf8\u5982\u521b\u5efa\u4f5c\u8005\u662f\u8c01\u3001\u521b\u5efa\u65f6\u95f4\u7b49\u81ea\u5b9a\u4e49\u4fe1\u606f\u3002</p> <p>2.\u67e5\u770b\u6570\u636e\u5e93 \u67e5\u770b\u6709\u54ea\u4e9b\u6570\u636e\u5e93\uff1a Text Only<pre><code>show databases;\nshow databases like 'db_hive*';\n</code></pre> \u67e5\u770b\u67d0\u4e2a\u5e93\u7684\u4fe1\u606f\uff0c\u770b\u4e0d\u5230DBPROPERTIES\uff1a Text Only<pre><code>desc database db_hive;\n</code></pre> \u67e5\u770b\u67d0\u4e2a\u5e93\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u770b\u5f97\u5230DBPROPERTIES\uff1a Text Only<pre><code>desc database extended db_hive;\n</code></pre> \u4ee5\u4e0a\u4fe1\u606f\u5176\u5b9e\u8bb0\u5f55\u5728MySQL\u5143\u6570\u636e\u5e93\u4e2d\u7684\u8868DBS\u4e2d\uff0c\u76f4\u63a5\u67e5\u770b\u8fd9\u5f20\u8868\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p>3.\u4fee\u6539\u6570\u636e\u5e93\uff0calter \u53ea\u80fd\u4fee\u6539DBPROPERTIES\u4e2d\u7684\u503c Text Only<pre><code>alter database db_hive set dbproperties('createtime'='20170830');\n</code></pre></p> <p>4.\u5220\u9664\u6570\u636e\u5e93 \u76f4\u63a5drop\u53ea\u80fd\u5220\u9664\u7a7a\u7684\u6570\u636e\u5e93 Text Only<pre><code>drop database db_hive;\ndrop database if exists db_hive2;\n</code></pre> \u5982\u679c\u6570\u636e\u5e93\u4e0d\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u4f7f\u7528 cascade \u547d\u4ee4\uff0c\u5f3a\u5236\u5220\u9664 Text Only<pre><code>drop database db_hive cascade;\n</code></pre></p> <p>\u4e8c\u3001\u5bf9\u8868\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff1a 1. \u521b\u5efa\u8868 Text Only<pre><code>CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name\n[(col_name data_type [COMMENT col_comment], ...)]\n[COMMENT table_comment]\n[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]\n[CLUSTERED BY (col_name, col_name, ...) INTO num_buckets BUCKETS]\n[SORTED BY (col_name [ASC|DESC], ...)]\n[ROW FORMAT row_format]\n[STORED AS file_format]\n[LOCATION hdfs_path]\n[TBLPROPERTIES (property_name=property_value, ...)]\n[AS select_statement]\n</code></pre> \u89e3\u91ca\u8bf4\u660e \uff081\uff09CREATE TABLE\u00a0\u00a0\u521b\u5efa\u4e00\u4e2a\u6307\u5b9a\u540d\u5b57\u7684\u8868\u3002\u5982\u679c\u76f8\u540c\u540d\u5b57\u7684\u8868\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u629b\u51fa\u5f02\u5e38\uff1b \u7528\u6237\u53ef\u4ee5\u7528 IF NOT EXISTS\u00a0\u00a0\u9009\u9879\u6765\u5ffd\u7565\u8fd9\u4e2a\u5f02\u5e38\u3002 <code>\uff082\uff09EXTERNAL</code> \u5173\u952e\u5b57\u53ef\u4ee5\u8ba9\u7528\u6237\u521b\u5efa\u4e00\u4e2a\u5916\u90e8\u8868\uff0c\u5728\u5220\u9664\u8868\u7684\u65f6\u5019\uff0c\u5185\u90e8\u8868\u7684\u5143\u6570\u636e\u548c\u6570\u636e\u4f1a\u88ab\u4e00\u8d77\u5220\u9664\uff0c\u800c\u5916\u90e8\u8868\u53ea\u5220\u9664\u5143\u6570\u636e\uff0c\u4e0d\u5220\u9664\u6570\u636e\u3002 \uff083\uff09COMMENT \u4e3a\u8868\u548c\u5217\u6dfb\u52a0\u6ce8\u91ca <code>\uff084\uff09PARTITIONED BY</code> \u521b\u5efa\u5206\u533a\u8868 \uff085\uff09CLUSTERED BY \u521b\u5efa\u5206\u6876\u8868 \uff086\uff09SORTED BY \u4e0d\u5e38\u7528\uff0c\u5bf9\u6876\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5217\u53e6\u5916\u6392\u5e8f <code>\uff087\uff09ROW FORMAT DELIMITED \\[FIELDS TERMINATED BY char\\]</code> \u00a0\u00a0\u00a0\u00a0\u00a0[COLLECTION ITEMS TERMINATED BY char] \u00a0\u00a0\u00a0\u00a0\u00a0[MAP KEYS TERMINATED BY char] \u00a0\u00a0\u00a0\u00a0\u00a0[LINES TERMINATED BY char] \uff088\uff09STORED AS \u6307\u5b9a\u5b58\u50a8\u6587\u4ef6\u7c7b\u578b\uff0c\u5e38\u7528\u7684\u5b58\u50a8\u6587\u4ef6\u7c7b\u578b\uff1aSEQUENCEFILE\uff08\u4e8c\u8fdb\u5236\u5e8f\u5217\u6587\u4ef6\uff09\u3001TEXTFILE\uff08\u6587\u672c\uff09\u3001RCFILE\uff08\u5217\u5f0f\u5b58\u50a8\u683c\u5f0f\u6587\u4ef6\uff09\uff0c\u9ed8\u8ba4\u662f\u7eaf\u6587\u672c\uff0c\u7b49\u540c\u4e8e\u4f7f\u7528 STORED AS TEXTFILE\u3002\u5982\u679c\u6570\u636e\u9700\u8981\u538b\u7f29\uff0c\u4f7f\u7528 STORED AS SEQUENCEFILE\u3002 \uff089\uff09LOCATION \u6307\u5b9a\u8868\u5728 HDFS \u4e0a\u7684\u5b58\u50a8\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u5728\u6307\u5b9a\u6570\u636e\u5e93\u7684\u76ee\u5f55\u4e0b\u3002 \uff0810\uff09TBLPROPERTIES \u7528\u4e8e\u6307\u5b9a\u4e00\u4e9b\u5c5e\u6027\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u8be5\u8868\u662f\u5426\u542f\u7528\u538b\u7f29. \uff0811\uff09AS \u540e\u8ddf\u67e5\u8be2\u8bed\u53e5\uff0c\u6839\u636e\u67e5\u8be2\u7ed3\u679c\u521b\u5efa\u8868\u3002 \uff0812\uff09LIKE \u5141\u8bb8\u7528\u6237\u590d\u5236\u73b0\u6709\u7684\u8868\u7ed3\u6784\uff0c\u4f46\u662f\u4e0d\u590d\u5236\u6570\u636e\u3002</p> <p>\u7ba1\u7406\u8868\u548c\u5916\u90e8\u8868\uff1a \u7ba1\u7406\u8868\uff0c\u4e5f\u79f0\u4e3a\u5185\u90e8\u8868\uff0c \u5220\u9664\u4e00\u4e2a\u7ba1\u7406\u8868\u65f6\uff0cHive \u4e5f\u4f1a\u5220\u9664\u8fd9\u4e2a\u8868\u4e2d\u6570\u636e\uff0c\u4e5f\u5c31\u662fHDFS\u4e0a\u7684\u5185\u5bb9\u4e5f\u4f1a\u88ab\u5220\u9664\u3002\u4f46\u662f\u5916\u90e8\u8868\u5728\u5220\u9664\u8868\u65f6\u5e76\u4e0d\u4f1a\u5220\u9664HDFS\u4e0a\u7684\u6570\u636e\uff0c\u53ea\u4f1a\u5220\u9664MySQL\u4e2d\u7684\u5143\u6570\u636e\u4fe1\u606f\u3002\u6240\u4ee5\u901a\u5e38\u521b\u5efa\u7684\u90fd\u662f\u5916\u90e8\u8868\uff0c\u6570\u636e\u66f4\u5b89\u5168\u3002</p> <p>Hive\u4e2d\u7684\u6570\u636e\u7c7b\u578b\u6709\u5982\u4e0b\u8fd9\u4e9b\uff0c\u6700\u5e38\u7528\u7684\u4e5f\u5c31INT\u3001BIGINT\u3001DOUBLE\u3001STRING  </p> <p>1.1 \u521b\u5efa\u8868\u7684\u4f8b\u5b50\uff1a \u6587\u4ef6\u4e2d\u6709\u5982\u4e0b\u5185\u5bb9\uff1a Text Only<pre><code>songsong,bingbing_lili,xiao song:18_xiaoxiao song:19,beijing_hui long guan_10\nyangyang,caicai_susu,xiao yang:18_xiaoxiao yang:19,beijing_chao yang_20\n</code></pre> \u4e0a\u9762\u7684\u4e00\u884c\u6570\u636e\u5982\u679c\u7528json\u8868\u793a\u5176\u60f3\u8868\u8fbe\u7684\u5185\u5bb9\u7684\u8bdd\u5c31\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a Text Only<pre><code>{\n\u00a0\u00a0\"name\": \"songsong\",\n\u00a0\u00a0\"friends\": [\n\u00a0\u00a0\u00a0\u00a0\"bingbing\",\n\u00a0\u00a0\u00a0\u00a0\"lili\"\n\u00a0\u00a0],\n\u00a0\u00a0\"children\": {\n\u00a0\u00a0\u00a0\u00a0\"xiao song\": 18,\n\u00a0\u00a0\u00a0\u00a0\"xiaoxiao song\": 19\n\u00a0\u00a0},\n\u00a0\u00a0\"address\": {\n\u00a0\u00a0\u00a0\u00a0\"city\": \"beijing\",\n\u00a0\u00a0\u00a0\u00a0\"street\": \"hui long guan\",\n\u00a0\u00a0\u00a0\u00a0\"number\": 10\n\u00a0\u00a0}\n}\n</code></pre> \u4e0a\u8ff0\u6570\u636e\u7684\u5efa\u8868\u8bed\u53e5\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a Text Only<pre><code>create external table test(\n\u00a0\u00a0\u00a0\u00a0name string,\n\u00a0\u00a0\u00a0\u00a0friends array&lt;string&gt;,\n\u00a0\u00a0\u00a0\u00a0children map&lt;string, int&gt;,\n\u00a0\u00a0\u00a0\u00a0address struct&lt;city:string, street:string, number:int&gt;\n)row format delimited fields terminated by ','\ncollection items terminated by '_'\nmap keys terminated by ':'\nlines terminated by '\\n';\n</code></pre> \u5efa\u8868\u65f6\uff0crow format delimited fields terminated by\u4e00\u5b9a\u8981\u6307\u5b9a\u4e00\u4e0b\uff0c\u4e0d\u7136\u5c31\u662f\u9ed8\u8ba4\u7684\u4e0d\u77e5\u9053\u662f\u5565\u7684\u4e00\u4e2a\u5b57\u7b26\u3002</p> <p>1.2 \u6839\u636e\u67e5\u8be2\u7ed3\u679c\u521b\u5efa\u8868\uff0c\u67e5\u8be2\u7684\u7ed3\u679c\u4f1a\u6dfb\u52a0\u5230\u65b0\u521b\u5efa\u7684\u8868\u4e2d\uff1a Text Only<pre><code>create table if not exists student1 as select id, name from student;\n</code></pre></p> <p>1.3 \u6839\u636e\u5df2\u7ecf\u5b58\u5728\u7684\u8868\u7ed3\u6784\u521b\u5efa\u8868 Text Only<pre><code>create table if not exists student3 like student;\n</code></pre></p> <p>2.\u67e5\u770b\u8868\u7ed3\u6784 Text Only<pre><code>desc student3\n</code></pre></p> <p>3.\u67e5\u770b\u8868\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5728\u5143\u6570\u636e\u5e93\u4e2d\u7684\u8868table_params\u4e2d Text Only<pre><code>desc formatted\u00a0student3\n</code></pre></p> <p>4\u52306\u662f\u4fee\u6539\u8868\u7684\u64cd\u4f5c\uff1a 4.\u7ba1\u7406\u8868\u4e0e\u5916\u90e8\u8868\u7684\u4e92\u76f8\u8f6c\u6362 Text Only<pre><code>\u4fee\u6539\u5185\u90e8\u8868\u4e3a\u5916\u90e8\u8868\uff1aalter table student2 set tblproperties('EXTERNAL'='TRUE');\n\u4fee\u6539\u5916\u90e8\u8868\u4e3a\u5185\u90e8\u8868\uff1aalter table student2 set tblproperties('EXTERNAL'='FALSE');\n</code></pre> \u6ce8\u610f\uff1a('EXTERNAL'='TRUE')\u548c('EXTERNAL'='FALSE')\u4e3a\u56fa\u5b9a\u5199\u6cd5\uff0c\u533a\u5206\u5927\u5c0f\u5199\uff01</p> <p>5. \u91cd\u547d\u540d\u8868 Text Only<pre><code>ALTER TABLE table_name RENAME TO new_table_name\n</code></pre> \u6bd4\u5982\uff1a\u00a0 Text Only<pre><code>alter table dept_partition2 rename to dept_partition3;\n</code></pre></p> <p>6.\u6dfb\u52a0/\u66ff\u6362/\u4fee\u6539\u5217\u4fe1\u606f 6.1\u6dfb\u52a0/\u66ff\u6362 \u5217 Text Only<pre><code>ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type [COMMENT col_comment], ...)\n</code></pre> \u6bd4\u5982\u6dfb\u52a0\u5217\uff1a Text Only<pre><code>alter table dept add columns(deptdesc string);\n</code></pre> \u66ff\u6362\u5217\u662f\u5c06\u6574\u4e2a\u8868\u7684\u5217\u90fd\u66ff\u6362\u6389 Text Only<pre><code>alter table dept replace columns(deptno string, dname string, loc string);\n</code></pre></p> <p>6.2\u4fee\u6539 \u5217 Text Only<pre><code>ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_name column_type [COMMENT col_comment]\n</code></pre> \u6bd4\u5982\u628adeptdesc\u6539\u6210desc\u5e76\u4e14\u7c7b\u578b\u662fstring Text Only<pre><code>alter table dept change column deptdesc desc string;\n</code></pre></p> <p>7.\u5220\u9664\u8868 Text Only<pre><code>drop table dept;\n</code></pre></p> <p>8.Truncate\u6e05\u9664\u8868\u4e2d\u6570\u636e\u662f\u5220\u9664hdfs\u4e0a\u7684\u6570\u636e\uff0c\u4f46\u662fTruncate \u53ea\u80fd\u5220\u9664\u7ba1\u7406\u8868\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u80fd\u5220\u9664\u5916\u90e8\u8868\u4e2d\u7684\u6570\u636e Text Only<pre><code>truncate table student;\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/3-DML%EF%BC%88%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%EF%BC%89/","title":"3-DML\uff08\u6570\u636e\u64cd\u4f5c\u8bed\u8a00\uff09","text":"<p> \u7ea6 793 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>Hive\u7684DML\uff08\u6570\u636e\u64cd\u4f5c\u8bed\u8a00\uff09\u5305\u62ec\u5bf9\u8868\u4e2d\u6570\u636e\u7684 \u5bfc\u5165(load)\u3001\u63d2\u5165(insert)\u3001\u5220\u9664(delete) \u548c \u4fee\u6539(update) \u4ee5\u53ca \u5bf9\u6574\u5f20\u8868\u6570\u636e\u7684\u5bfc\u5165(import)\u548c\u6570\u636e\u7684\u5bfc\u51fa(Export)\uff0c\u5220\u9664\u548c\u4fee\u6539\u4e0d\u5e38\u7528\uff0c\u6240\u4ee5\u53ea\u8bf4\u660e\u6570\u636e\u7684\u5bfc\u5165\u548c\u5bfc\u51fa\u3002  \u6570\u636e\u5bfc\u5165 1. \u5411\u8868\u4e2d\u88c5\u8f7d\u6570\u636e\uff08Load\uff09 Text Only<pre><code>load data [local] inpath '\u6570\u636e\u7684path' [overwrite] into table student [partition (partcol1=val1,\u2026)];\n</code></pre> local\u8868\u793a\u4ece\u672c\u5730\u52a0\u8f7d\u6570\u636e\u5230 hive \u8868\uff1b\u5426\u5219\u4ece HDFS \u52a0\u8f7d\u6570\u636e\u5230 hive \u8868 overwrite\u8868\u793a\u8986\u76d6\u8868\u4e2d\u5df2\u6709\u6570\u636e\uff0c\u5426\u5219\u8868\u793a\u6dfb\u52a0 partition\u8868\u793a\u4e0a\u4f20\u5230\u6307\u5b9a\u5206\u533a \u6bd4\u5982\u52a0\u8f7d\u672c\u5730\u6587\u4ef6\u5230 hive\uff1a Text Only<pre><code>load data local inpath '/opt/module/hive/datas/student.txt' into table default.student;\n</code></pre></p> <p>Load\u4e0e\u76f4\u63a5\u4f7f\u7528hdfs\u7684put\u547d\u4ee4\u7684\u533a\u522b\u662f\uff0c\u4f7f\u7528hdfs\u7684put\u547d\u4ee4\u4e0d\u4f1a\u7ecf\u8fc7hive\uff0c\u6240\u4ee5\u4e5f\u5c31\u4e0d\u4f1a\u4fee\u6539\u4efb\u4f55\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5728\u4f7f\u7528select count(*)\u7b49\u76f4\u63a5\u8bbf\u95ee\u5143\u6570\u636e\u5e93\u5c31\u53ef\u4ee5\u5f97\u5230\u7ed3\u679c\u7684\u547d\u4ee4\u65f6\uff0c\u4e0d\u4f1a\u8bbf\u95eehdfs\u4e0a\u7684\u6587\u4ef6\uff0c\u6240\u4ee5\u5f97\u5230\u7ed3\u679c\u5c31\u4e0d\u662f\u771f\u5b9e\u7684\u7ed3\u679c\u3002\u800c\u4f7f\u7528load\u4f1a\u4fee\u6539\u5143\u6570\u636e\u4fe1\u606f\u4e2d\u7684numFiles\uff0c\u4f46\u4e0d\u4f1a\u4fee\u6539numRows\uff08\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u5728\u5143\u6570\u636e\u5e93\u7684table_params\u8868\u4e2d\uff09\uff0c\u6240\u4ee5\u5bfc\u5165\u6570\u636e\u548chdfs put\u6570\u636e\u4e00\u6837\u5feb\uff0c\u4f46\u5728\u4f7f\u7528select count(*)\u67e5\u8be2\u8bed\u53e5\u65f6\u4f1a\u8d70MR\u8bbf\u95eehdfs\u6587\u4ef6\uff0c\u56e0\u4e3a\u6b64\u65f6numFlis&gt;0\uff0c\u800cnumRows=0\uff0c\u6240\u4ee5\u80fd\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\u3002</p> <p>2.\u5411\u8868\u4e2d\u63d2\u5165\u6570\u636e\uff08Insert\uff09 \u57fa\u672c\u63d2\u5165\u6570\u636e\u5982\u4e0b\uff0c\u4f1a\u8d70MR\u540c\u65f6\u66f4\u65b0\u5143\u6570\u636e\u4fe1\u606f\u4e2d\u7684numFile\u548cnumRows Text Only<pre><code>insert into table student_par values(1,'wangwu'),(2,'zhaoliu');\n</code></pre> \u5355\u5f20\u8868\u67e5\u8be2\u7ed3\u679c\u63d2\u5165 Text Only<pre><code>insert overwrite table student_par\nselect id, name from student where month='201709';\n</code></pre> insert into\uff1a\u4ee5\u8ffd\u52a0\u6570\u636e\u7684\u65b9\u5f0f\u63d2\u5165\u5230\u8868\u6216\u5206\u533a\uff0c\u539f\u6709\u6570\u636e\u4e0d\u4f1a\u5220\u9664 insert overwrite\uff1a\u4f1a\u8986\u76d6\u8868\u4e2d\u5df2\u5b58\u5728\u7684\u6570\u636e \u6ce8\u610f\uff1ainsert \u4e0d\u652f\u6301\u63d2\u5165\u90e8\u5206\u5b57\u6bb5</p> <p>3. \u521b\u5efa\u8868\u65f6\u5c06\u5176\u5b83\u8868\u7684\u67e5\u8be2\u7ed3\u679c\u4f5c\u4e3a\u6570\u636e\u5bfc\u5165\uff08as select\uff09 Text Only<pre><code>create table if not exists student3 as select id, name from student;\n</code></pre></p> <p>4. \u521b\u5efa\u8868\u65f6\u901a\u8fc7 Location \u6307\u5b9a\u6570\u636e\u5b58\u653e\u7684\u8def\u5f84\uff0c\u5982\u679c\u8def\u5f84\u4e0b\u5df2\u7ecf\u6709\u6570\u636e\u4e86\uff0c\u90a3\u4e48\u7b49\u540c\u4e8e\u76f4\u63a5\u5c06\u6570\u636e\u5bfc\u5165\u5230\u8868\u4e2d\u4e86 Text Only<pre><code>create external table if not exists student5(id int, name string)\nrow format delimited fields terminated by '\\t'\nlocation '/student;\n</code></pre></p> <p>6. Import \u6570\u636e\u5230\u6307\u5b9a Hive \u8868\u4e2d \u6ce8\u610f\uff1a\u5fc5\u987b\u5148\u7528 export \u5bfc\u51fa\u540e\uff0c\u624d\u80fd\u4f7f\u7528import\u547d\u4ee4\u5c06\u6570\u636e\u5bfc\u5165\u3002\u88ab\u5bfc\u5165\u7684\u8868\u5fc5\u987b\u4e0d\u5b58\u5728\u6216\u662f\u4e00\u5f20\u7a7a\u8868\uff0c\u4e0d\u80fd\u662f\u4e00\u5f20\u6709\u6570\u636e\u7684\u8868 Text Only<pre><code>import table student2 from '/user/hive/warehouse/export/student';\n</code></pre></p> <p>\u6570\u636e\u5bfc\u51fa 1.insert\u00a0\u52a0\u4e2a local \u53ef\u4ee5\u5c06\u6570\u636e\u5bfc\u51fa\u5230\u672c\u5730 Text Only<pre><code>insert overwrite local directory '/opt/module/hive/data/export/student'\nselect * from student;\n</code></pre></p> <p>2.insert\u00a0\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u683c\u5f0f\u5316\u5bfc\u51fa\u5230\u672c\u5730 Text Only<pre><code>insert overwrite local directory '/tmp/student1'\nROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t'\nselect * from student;\n</code></pre></p> <p>3. .Insert\u00a0\u6ca1\u6709 local \u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u5bfc\u51fa\u5230 HDFS \u4e0a Text Only<pre><code>insert overwrite directory '/user/atguigu/student2'\nROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t'\nselect * from student;\n</code></pre></p> <p>4.Hadoop \u547d\u4ee4\u5bfc\u51fa\u5230\u672c\u5730(\u53ef\u4ee5\u5728hive\u4e2d\u4f7f\u7528hadoop\u7684\u547d\u4ee4) Text Only<pre><code>hive&gt; dfs -get /user/hive/warehouse/student/student.txt /opt/module/data/export/student3.txt;\n</code></pre></p> <p>5.Hive Shell \u547d\u4ee4\u5bfc\u51fa Text Only<pre><code>hive -e 'select * from default.student;' &gt; /opt/module/hive/data/export/student4.txt;\n</code></pre></p> <p>6.export \u5bfc\u51fa\u5230 HDFS \u4e0a\uff0c\u4e0e\u524d\u9762\u7684import\u662f\u914d\u5957\u4f7f\u7528\u7684\uff0c export \u548c import \u4e3b\u8981\u7528\u4e8e\u4e24\u4e2a Hadoop \u5e73\u53f0\u96c6\u7fa4\u4e4b\u95f4 Hive \u8868\u8fc1\u79fb Text Only<pre><code>export table default.student to '/student1'\n</code></pre></p> <p>7. Sqoop \u5bfc\u51fa</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/4-%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E5%88%86%E6%A1%B6%E8%A1%A8/","title":"4-\u5206\u533a\u8868\u548c\u5206\u6876\u8868","text":"<p> \u7ea6 1920 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 38 \u5206\u949f</p> <p>\u5206\u533a\u8868\uff1a \u5efa\u5e93\u5176\u5b9e\u5c31\u662f\u5728HDFS\u4e0a\u65b0\u5efa\u4e86\u4e00\u4e2a\u76ee\u5f55\uff0c\u5efa\u8868\u5c31\u662f\u8be5\u76ee\u5f55\u4e0b\u53c8\u65b0\u5efa\u4e86\u4e00\u4e2a\u76ee\u5f55\uff0c\u4ee5\u540e\u67e5\u8be2\u8be5\u8868\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u5c31\u662f\u626b\u63cf\u8868\u5bf9\u5e94\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\uff0c\u800c\u5206\u533a\u8868\u6307\u7684\u5c31\u662f\u5728\u8868\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u518d\u65b0\u5efa\u76ee\u5f55\u4f5c\u4e3a\u8868\u7684\u5206\u533a\uff0c\u4ee5\u540e\u53ea\u8981\u5e26\u4e0a\u5206\u533a\u6761\u4ef6\u67e5\u8be2\u8868\uff0c\u90a3\u4e48\u5c31\u53ea\u9700\u8981\u626b\u63cf\u5206\u533a\u5bf9\u5e94\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5373\u53ef\uff0c\u8fd9\u6837\u5c31\u6781\u5927\u7684\u63d0\u5347\u4e86\u67e5\u8be2\u6548\u7387\u3002</p> <p>\u65b0\u5efa\u4e00\u5f20\u7528\u4e8e\u8bb0\u5f55\u6bcf\u5929\u7528\u6237\u767b\u5f55\u4fe1\u606f\u7684\u5206\u533a\u8868\uff0c\u7528\u6bcf\u4e00\u5929\u4f5c\u4e3a\u5206\u533a Text Only<pre><code>create table if not exists login_logs(uid string,ip string)\n`partitioned by (day string)`\nrow format delimited fields terminated by '\\t';\n</code></pre> \u5206\u533a\u8868\u7684\u5206\u533a\u5b57\u6bb5\u5728\u4ee5\u540e\u67e5\u8be2\u65f6\u548c\u8868\u7684\u5176\u5b83\u5b57\u6bb5\u4e00\u6837\u7684\u7528\uff0c\u5b83\u5c31\u76f8\u5f53\u4e8e\u8868\u7684\u4e00\u4e2a\u4f2a\u5217</p> <p>\u521b\u5efa\u4e09\u4e2a\u7528\u6237\u767b\u5f55\u8bb0\u5f55\u7684log\u6587\u4ef6 login_20210901.log Text Only<pre><code>101\u00a0 \u00a0 192.168.10.1\n102\u00a0\u00a0\u00a0\u00a0192.168.10.2\n</code></pre> login_20210902.log Text Only<pre><code>201\u00a0\u00a0\u00a0\u00a0192.168.20.1\n202\u00a0\u00a0\u00a0\u00a0192.168.20.2\n</code></pre> login_20210903.log Text Only<pre><code>301\u00a0\u00a0\u00a0\u00a0192.168.30.1\n302\u00a0\u00a0\u00a0\u00a0192.168.30.2\n</code></pre></p> <p>\u628a\u4e0a\u9762\u7684\u672c\u5730\u6570\u636e\u52a0\u8f7d\u5230Hive\u4e2d Text Only<pre><code>load data local inpath '/opt/module/data/login_20210901.log' into table login_logs partition(day='20210901');\nload data local inpath '/opt/module/data/login_20210902.log' into table login_logs partition(day='20210902');\nload data local inpath '/opt/module/data/login_20210903.log' into table login_logs partition(day='20210903');\n</code></pre> \u6ce8\u610f\uff1a\u5f80\u5206\u533a\u8868\u4e2d\u5bfc\u5165\u6570\u636e\u5fc5\u987b\u6307\u5b9a\u5206\u533a  \u67e5\u8be2\u5206\u533a\u8868\u4e2d\u6570\u636e\uff0c\u5206\u533a\u5b57\u6bb5\u548c\u8868\u7684\u666e\u901a\u5217\u4e00\u6837\u7684\u7528 Text Only<pre><code>select * from login_logs where day='20210901';\n</code></pre> </p> <p>\u589e\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5206\u533a Text Only<pre><code>alter table login_logs add partition(day='20210904') partition(day='20210905');\n</code></pre></p> <p>\u5220\u9664\u591a\u4e2a\u5206\u533a\uff0c\u6ce8\u610f\u4e2d\u95f4\u7684\u9017\u53f7\uff0c\u589e\u52a0\u5206\u533a\u65f6\u4f7f\u7528\u7a7a\u683c\u5206\u5f00\uff0c\u5220\u9664\u5206\u533a\u65f6\u4f7f\u7528\u9017\u53f7\u9694\u5f00\uff0c\u5220\u9664\u7ba1\u7406\u8868\u7684\u5206\u533a\u4f1a\u5220\u9664hdfs\u4e0a\u7684\u6570\u636e Text Only<pre><code>alter table login_logs drop partition(day='20210904'),partition(day='20210905');\n</code></pre></p> <p>\u67e5\u770b\u6709\u591a\u5c11\u4e2a\u5206\u533a Text Only<pre><code>show partitions login_logs;\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u5bf9\u5206\u533a\u518d\u8fdb\u884c\u62c6\u5206\uff0c\u4e5f\u5c31\u662f\u4e8c\u7ea7\u5206\u533a\uff0c\u6bd4\u5982\u5148\u6309\u5929\u8fdb\u884c\u5206\u533a\uff0c\u518d\u6309\u5c0f\u65f6\u8fdb\u884c\u5206\u533a \u5148\u5220\u9664\u4e4b\u524d\u7684\u8868\uff0c\u7136\u540e\u518d\u521b\u5efa\u4e8c\u7ea7\u5206\u533a\u8868 Text Only<pre><code>drop table\u00a0login_logs;\n</code></pre> Text Only<pre><code>create table if not exists login_logs(uid string,ip string)\npartitioned by (day string, hour string)\nrow format delimited fields terminated by '\\t';\n</code></pre></p> <p>\u52a0\u8f7d\u672c\u5730\u6570\u636e\u5230Hive\u4e2d Text Only<pre><code>load data local inpath '/opt/module/data/login_20210901.log' into table login_logs partition(day='20210901', hour='01');\n</code></pre></p> <p>\u67e5\u8be2\u4e8c\u7ea7\u5206\u533a\u7684\u6570\u636e Text Only<pre><code>select * from login_logs where day='20210901' and hour='01';\n</code></pre> </p> <p>\u628a\u6570\u636e\u76f4\u63a5\u4e0a\u4f20\u5230\u5206\u533a\u76ee\u5f55\u4e0a\uff0c\u8ba9\u5206\u533a\u8868\u548c\u6570\u636e\u4ea7\u751f\u5173\u8054\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a \u5728hive\u4e2d\u6267\u884cHDFS\u7684\u547d\u4ee4\u76f4\u63a5\u521b\u5efa\u5206\u533a\u5bf9\u5e94\u7684\u76ee\u5f55\u548c\u4e0a\u4f20\u6570\u636e\u5230\u5206\u533a\u4e2d\uff1a Text Only<pre><code>dfs -mkdir -p /user/hive/warehouse/login_logs/day=20210902/hour=13;\ndfs -put /opt/module/data/login_20210902.log /user/hive/warehouse/login_logs/day=20210902/hour=13;\n</code></pre> \u67e5\u8be2\u4e8c\u7ea7\u5206\u533a\u7684\u6570\u636e\uff0c\u53d1\u73b0\u67e5\u4e0d\u5230\uff0c\u539f\u56e0\u662f\u5206\u533a\u4fe1\u606f\u662f\u9700\u8981\u8bb0\u5f55\u5728\u5143\u6570\u636e\u5e93\u4e2d\u7684\uff0c\u5177\u4f53\u5728partitions\u8868\u4e2d\uff0c\u5143\u6570\u636e\u4e2d\u6ca1\u6709\u5206\u533a\u7684\u4fe1\u606f\u5c31\u67e5\u4e0d\u5230\u5206\u533a\u4e2d\u7684\u6570\u636e\uff0c\u5c31\u50cf\u6ca1\u6709\u521b\u5efa\u8868\u76f4\u63a5\u5728hdfs\u4e0a\u521b\u5efa\u76ee\u5f55\u4e00\u6837\uff0c\u662f\u6ca1\u6709\u7528\u7684\u3002 Text Only<pre><code>select * from login_logs where day='20210902' and hour='13';\n</code></pre></p> <p>\u65b9\u5f0f\u4e00\uff1a\u6267\u884c\u4fee\u590d\u547d\u4ee4 Text Only<pre><code>msck repair table\u00a0login_logs;\n</code></pre></p> <p>\u65b9\u5f0f\u4e8c\uff1a\u6dfb\u52a0\u5206\u533a Text Only<pre><code>alter table login_logs add partition(day='20210902',hour='13');\n</code></pre></p> <p>\u52a8\u6001\u5206\u533a\uff1a \u5982\u679c\u60f3\u628a\u4e00\u5f20\u8868\u7684\u67e5\u8be2\u7ed3\u679c\u5bfc\u5165\u5230\u53e6\u5916\u4e00\u5f20\u5206\u533a\u8868\u4e2d\uff0c\u5e76\u4e14\u60f3\u628a\u67e5\u8be2\u7ed3\u679c\u4e2d\u7684\u67d0\u4e2a\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u8868\u7684\u5206\u533a\u5b57\u6bb5\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u52a8\u6001\u7684\u5728\u5206\u533a\u8868\u4e2d\u521b\u5efa\u5206\u533a\u4e86\uff0c\u56e0\u4e3a\u5206\u533a\u5b57\u6bb5\u7684\u5177\u4f53\u503c\u4e0d\u786e\u5b9a\uff0c\u65e0\u6cd5\u9884\u5148\u624b\u52a8\u521b\u5efa\uff0c\u52a8\u6001\u5206\u533a\u5c31\u662f\u6765\u89e3\u51b3\u8fd9\u4ef6\u4e8b\u3002 \u52a8\u6001\u5206\u533a\u662f\u4f7f\u7528insert\u63d2\u5165\u8bed\u53e5\u5f80\u5206\u533a\u8868\u91cc\u63d2\u5165\u6570\u636e\u65f6\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u5e76\u4e0d\u662f\u8bf4\u6709\u4e00\u79cd\u5206\u533a\u8868\u7684\u7c7b\u578b\u662f\u52a8\u6001\u5206\u533a\u8868\uff0c\u52a8\u6001\u5206\u533a\u8d70MR\u3002 \u52a8\u6001\u5206\u533a\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff1a Text Only<pre><code>hive.exec.dynamic.partition=true\n</code></pre> \u521b\u5efa\u4e00\u5f20\u6309\u90e8\u95e8\u4f4d\u7f6e\u4f5c\u4e3a\u5206\u533a\u7684\u8868 Text Only<pre><code>create table dept_partition(id int, name string) partitioned by (loc int) row format delimited fields terminated by '\\t';\n</code></pre> \u5f80\u5206\u533a\u8868\u91cc\u63d2\u5165\u6570\u636e\uff0c\u4ee5\u67e5\u8be2\u51fa\u6765\u7684loc\u5217\u7684\u503c\u4f5c\u4e3a\u5206\u533a\u7684\u503c\uff1a Text Only<pre><code>insert into table dept_partition select deptno, dname, loc from dept;\n</code></pre> \u6ce8\u610f\uff0c\u5728select\u8bed\u53e5\u4e2dloc\u5fc5\u987b\u5728\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u52a8\u6001\u5206\u533a\u53ea\u4f1a\u628a\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u7684\u503c\u4f5c\u4e3a\u5206\u533a\u5b57\u6bb5\u7684\u503c\u6765\u521b\u5efa\u5206\u533a\uff0c\u8fd9\u662f\u52a8\u6001\u5206\u533a\u4e25\u683c\u6a21\u5f0f\u4e0b\u7684\u8bed\u6cd5\uff08\u5373Dynamic partition strict mode requires at least one static partition column\uff0c\u52a8\u6001\u5206\u533a\u4e25\u683c\u6a21\u5f0f\u9700\u8981\u81f3\u5c11\u4e00\u4e2a\u9759\u6001\u5206\u533a\u5217\uff09  \u8fd8\u53ef\u4ee5\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u4f7f\u7528\u4e0b\u9762\u7684\u8bed\u6cd5\u5f80\u5206\u533a\u4e2d\u63d2\u5165\u6570\u636e\uff0c\u4e0d\u8fc7\u8fd9\u5e76\u4e0d\u662f\u52a8\u6001\u5206\u533a\u63d2\u5165\uff0c\u800c\u662f\u9759\u6001\u5206\u533a\u63d2\u5165\uff0c\u5373\u67e5\u8be2\u7ed3\u679c\u53ea\u4f1a\u63d2\u5165\u5230loc=100\u7684\u5206\u533a\u4e2d\uff1a Text Only<pre><code>insert into table dept_partition partition(loc='100') select deptno, dname from dept;\n</code></pre> \u5982\u679c\u8981\u4f7f\u7528\u4e0b\u9762\u7684\u8bed\u6cd5\u5b9e\u73b0\u52a8\u6001\u5206\u533a\u63d2\u5165\uff08\u6ce8\u610f\u4ece\u8868\u4e2d\u67e5\u51fa\u6765\u7684\u5206\u533a\u5b57\u6bb5\u540c\u6837\u4e5f\u5e94\u8be5\u653e\u5728\u6700\u540e\uff0c\u5982\u679c\u662f\u591a\u7ea7\u5206\u533a\uff0c\u5b57\u6bb5\u7684\u987a\u5e8f\u4e5f\u4e0d\u80fd\u4e71\uff09\uff1a Text Only<pre><code>insert into table dept_partition partition(loc) select deptno, dname, loc from dept;\n</code></pre> \u9700\u8981\u5f00\u542f\u975e\u4e25\u683c\u6a21\u5f0f\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u662f\u4e25\u683c\u6a21\u5f0f\uff1a Text Only<pre><code>set hive.exec.dynamic.partition.mode=nonstrict;\n</code></pre> \u603b\u7ed3\u4e00\u70b9\uff0c\u4e25\u683c\u6a21\u5f0f\u548c\u975e\u4e25\u683c\u6a21\u5f0f\u9664\u4e86\u8bed\u6cd5\u4e0a\u7684\u533a\u522b\uff0c\u662f\u771f\u7684\u6ca1\u5565\u5176\u5b83\u533a\u522b\u4e86\uff0c\u975e\u4e25\u683c\u6a21\u5f0f\u4e0b\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e25\u683c\u6a21\u5f0f\u4e0b\u7684\u8bed\u6cd5\u5f80\u52a8\u6001\u5206\u533a\u4e2d\u63d2\u5165\u6570\u636e\u3002</p> <p>\u5206\u6876\u8868\uff1a hive\u4e2d\u8868\u5c31\u662f\u4e00\u4e2a\u76ee\u5f55\uff0c\u8868\u4e2d\u7684\u6570\u636e\u5c31\u662f\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\uff0c\u5206\u6876\u8868\u5c31\u662f\u628a\u8868\u4e2d\u7684\u6570\u636e\u62c6\u5206\u6210\u591a\u4e2a\u6587\u4ef6\u6765\u5b58\u653e\u3002\u4e0e\u5206\u533a\u8868\u4e0d\u540c\uff0c\u5206\u533a\u8868\u662f\u628a\u8868\u518d\u62c6\u5206\u6210\u76ee\u5f55\uff0c\u5206\u533a\u5b57\u6bb5\u4e5f\u4f5c\u4e3a\u8868\u7684\u4e00\u4e2a\u5217\u770b\u5f85\uff0c\u800c\u5206\u6876\u5219\u53ea\u662f\u7b80\u5355\u5730\u628a\u8868\u4e2d\u7684\u6570\u636e\u62c6\u5206\u6210\u591a\u4e2a\u6587\u4ef6\u800c\u5df2\u3002\u5206\u6876\u89c4\u5219\u662f\uff0c\u5bf9\u5206\u6876\u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u54c8\u5e0c\uff0c\u7136\u540e\u9664\u4ee5\u6876\u7684\u4e2a\u6570\u6c42\u4f59\u7684\u65b9\u5f0f\u51b3\u5b9a\u8be5\u6761\u8bb0\u5f55\u5b58\u653e\u5728\u54ea\u4e2a\u6876\u5f53\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u5206\u6876\u5b57\u6bb5\u76f8\u540c\u7684\u6570\u636e\u4e00\u5b9a\u5728\u540c\u4e00\u4e2a\u6876\u4e2d\uff0c\u540c\u4e00\u4e2a\u6876\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u4e0d\u540c\u7684\u7528\u4e8e\u5206\u6876\u7684\u5b57\u6bb5\uff0c\u53ea\u8981\u5b83\u4eec\u8ba1\u7b97\u7684\u7ed3\u679c\u76f8\u540c\u5c31\u884c\u3002\uff08\u53ef\u80fd\u5f88\u5947\u602a\uff0c\u56e0\u4e3aMapReduce\u6700\u6015\u7684\u5c31\u662f\u5c0f\u6587\u4ef6\uff0c\u4f46\u662f\u5206\u6876\u5374\u8981\u62c6\u5206\u6210\u591a\u4e2a\u6587\u4ef6\uff0c\u539f\u56e0\u662f\u56e0\u4e3a\u6839\u636e\u5206\u6876\u5b57\u6bb5\u76f8\u540c\u7684\u6570\u636e\u4e00\u5b9a\u5728\u540c\u4e00\u4e2a\u6876\u4e2d\u8fd9\u4e2a\u7279\u70b9\uff0c\u53ef\u4ee5\u5bf9\u67d0\u4e9bSQL\u8bed\u53e5\u7684\u6267\u884c\u505a\u4f18\u5316\uff0c\u6bd4\u5982\u4f18\u5316\u4e24\u5f20\u5927\u8868\u7684join 11-\u4f18\u5316\uff09 Text Only<pre><code>create table stu_buck(id int, name string)\n`clustered by(id) into 4 buckets`\nrow format delimited fields terminated by '\\t';\n</code></pre></p> <p>\u5bfc\u5165\u6570\u636e\u5230\u8868\u4e2d\uff0c\u7531\u4e8e\u5f80\u5206\u6876\u8868\u4e2d\u5bfc\u5165\u6570\u636e\u4f1a\u8d70MR\uff0c\u6240\u4ee5\u4f7f\u7528loal\u00a0data \u4ece\u672c\u5730\u5bfc\u5165\u6570\u636e\u8bdd\u53ef\u80fd\u4f1a\u629b\u5f02\u5e38\uff0c\u56e0\u4e3a\u5c06MR\u4efb\u52a1\u63d0\u4ea4\u7ed9yarn\u540e\uff0c\u5c31\u4e0d\u77e5\u9053yarn\u4f1a\u628a\u4efb\u52a1\u5206\u914d\u7ed9\u90a3\u53f0\u673a\u5668\u6267\u884c\u4e86\uff0c\u5982\u679c\u4e0d\u662f\u6bcf\u53f0\u673a\u5668\u4e0a\u90fd\u6709\u5982\u4e0b\u7684\u672c\u5730\u6587\u4ef6\uff0c\u5e76\u4e14\u6070\u597d\u4efb\u52a1\u5206\u914d\u5230\u4e00\u4e2a\u6ca1\u6709stu.txt\u6587\u4ef6\u7684\u4e3b\u673a\u4e0a\u5c31\u4f1a\u56e0\u4e3a\u518d\u627e\u4e0d\u5230\u6587\u4ef6\u629b\u5f02\u5e38\u3002 Text Only<pre><code>load data inpath '/opt/module/data/stu.txt' into table stu_buck;\n</code></pre></p> <p>\u5206\u6876\u8868\u64cd\u4f5c\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879: \uff081\uff09reduce \u7684\u4e2a\u6570\u8bbe\u7f6e\u4e3a-1,\u8ba9 Job \u81ea\u884c\u51b3\u5b9a\u9700\u8981\u7528\u591a\u5c11\u4e2a reduce \u6216\u8005\u5c06 reduce \u7684\u4e2a\u6570\u8bbe\u7f6e\u4e3a\u5927\u4e8e\u7b49\u4e8e\u5206\u6876\u8868\u7684\u6876\u6570 \uff082\uff09\u4ece hdfs \u4e2d load \u6570\u636e\u5230\u5206\u6876\u8868\u4e2d\uff0c\u907f\u514d\u672c\u5730\u6587\u4ef6\u627e\u4e0d\u5230\u95ee\u9898 \uff083\uff09\u4e0d\u8981\u4f7f\u7528\u672c\u5730\u6a21\u5f0f</p> <p>\u62bd\u6837\u67e5\u8be2\uff1a \u4f7f\u7528\u5206\u6876\u8868\u6700\u5e38\u7528\u7684\u529f\u80fd\u5c31\u662f\u62bd\u6837\u67e5\u8be2\uff0c\u8bed\u6cd5\uff1a TABLESAMPLE(BUCKET x OUT OF y)\uff0c\u4f8b\u5982\uff1a Text Only<pre><code>select * from stu_buck tablesample(bucket 1 out of 4 on id);\n</code></pre> \u8868\u793a\u628a\u8868\u7684\u6570\u636e\u5206\u62104\u4efd\uff0c\u4ece\u7b2c1\u4efd\u4e2d\u62bd\u6837\uff0c\u6ce8\u610f\uff1ax \u7684\u503c\u5fc5\u987b\u5c0f\u4e8e\u7b49\u4e8e y \u7684\u503c\uff0c\u5426\u5219\u5c31\u4f1a\u629b\u5f02\u5e38\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/5-DQL%EF%BC%88%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%EF%BC%89/","title":"5-DQL\uff08\u6570\u636e\u67e5\u8be2\u8bed\u8a00\uff09","text":"<p> \u7ea6 816 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>Hive\u7684sql\u67e5\u8be2\u8bed\u53e5\u57fa\u672c\u4e0a\u4e0eMySQL\u76f8\u540c\uff0c\u4f46\u4e5f\u6709\u8bb8\u591a\u4e0d\u540c\u3002\u5404\u79cd\u51fd\u6570\u3001\u5206\u7ec4\u3001\u6392\u5e8f\u3001\u8fde\u63a5\u3001\u5b50\u67e5\u8be2\u3001\u7a97\u53e3\u7b49\u7b49\u5185\u5bb9\u90fd\u5c5e\u4e8eDQL\u7684\u8303\u56f4\u3002\uff08\u6ce8\u610f\uff1a\u6d4b\u8bd5\u7528\u4f8b\u7528\u5230\u7684\u8868\u7684\u5efa\u8868\u8bed\u53e5\u548c\u6570\u636e\u5728\u6587\u672b\uff0c\u5728\u540e\u9762\u8bb8\u591a\u4f8b\u5b50\u4e2d\u90fd\u4f1a\u7528\u5230\u3002\uff09 </p> <p>Operators\uff08\u8fd0\u7b97\u7b26\uff09 Hive\u7684\u8fd0\u7b97\u7b26\uff08Operators\uff09\u5305\u62ec \u5173\u7cfb\u8fd0\u7b97\u7b26\u3001\u7b97\u6570\u8fd0\u7b97\u7b26\u3001\u903b\u8f91\u8fd0\u7b97\u7b26\u3001\u4ece\u590d\u6742\u7c7b\u578b\u4e2d\u53d6\u6570\u7684\u8fd0\u7b97\u7b26\u7b49\uff0c\u590d\u6742\u7c7b\u578b\u7684\u6784\u9020\u51fd\u6570\u4e5f\u5c5e\u4e8e\u8fd0\u7b97\u7b26\uff1a </p> <p>1.\u5173\u7cfb\u8fd0\u7b97\u7b26\uff1aA&lt;=&gt;B\uff0c\u5982\u679c A\u548cB\u76f8\u540c \u6216\u8005 A\u548cB\u90fd\u4e3aNULL\uff0c\u5219\u8fd4\u56de TRUE\uff0c\u5426\u5219\u8fd4\u56de False\u3002\u800c A=B\u4e0d\u80fd\u5904\u7406\u6709\u4e00\u4e2a\u6570\u4e3aNULL\u7684\u60c5\u51b5\u3002</p> <p>2.\u5173\u7cfb\u8fd0\u7b97\u7b26\uff1aRLIKE\uff0cRLIKE \u53ef\u4ee5\u901a\u8fc7 Java \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd9\u4e2a\u66f4\u5f3a\u5927\u7684\u8bed\u8a00\u6765\u6307\u5b9a\u5339\u914d\u6761\u4ef6\u3002 Text Only<pre><code>select * from emp where ename RLIKE '[A]';\n</code></pre></p> <p>3.\u590d\u6742\u7c7b\u578b\u7684\u6784\u9020\u51fd\u6570</p> <ul> <li>map(key1, value1, key2, value2, ...)</li> <li>struct(val1, val2, val3, ...)</li> <li>named_struct(name1, val1, name2, val2, ...)</li> <li>array(val1, val2, ...)</li> </ul> <p>\u4f8b\u5982\uff1a Text Only<pre><code>&gt; select map('a', 1, 'b', 'b');\n{\"a\":\"1\",\"b\":\"b\"}\n</code></pre> Text Only<pre><code>&gt;\u00a0select struct('a', 1, 'b', 'b');\n{\"col1\":\"a\",\"col2\":1,\"col3\":\"b\",\"col4\":\"b\"}\n</code></pre> Text Only<pre><code>&gt;\u00a0select named_struct('a', 1, 'b', 'b');\n{\"a\":1,\"b\":\"b\"}\n</code></pre> Text Only<pre><code>&gt;\u00a0select array('a', 1, 'b', 'b');\n[\"a\",\"1\",\"b\",\"b\"]\n</code></pre> \u5f53\u7136\uff0c\u8fd9\u51e0\u4e2a\u51fd\u6570\u4e0d\u5e94\u8be5\u8fd9\u6837\u7528\uff0c\u800c\u662f\u5e94\u8be5\u7528\u5728\u9700\u8981\u5c06\u8868\u4e2d\u67e5\u8be2\u51fa\u6765\u7684\u6570\u636e\u6784\u9020\u6210\u590d\u6742\u7c7b\u578b\u7684\u573a\u666f\u3002</p> <p>4.\u4ece\u590d\u6742\u7c7b\u578b\u4e2d\u53d6\u6570\u7684\u8fd0\u7b97\u7b26 4.1 Array\u4e2d\u53d6\u503c\uff1a A[n] 4.2 Map\u4e2d\u53d6\u503c\uff1a M[key] 4.3 Struct\u4e2d\u53d6\u503c\uff1a S.x</p> <p>JOIN\uff08\u8fde\u63a5\uff09 MySQL\u4e0d\u652f\u6301\u5168\u5916\u8fde\u63a5\uff0c\u4f46Hive\u652f\u6301\uff0c\u6240\u4ee5 A U B \u5c31\u53ef\u4ee5\u5199\u6210\u5168\u5916\u8fde\u63a5\u4e86\u3002 nvl\u51fd\u6570\u7684\u4f5c\u7528\u548cMySQL\u7684ifnull\u51fd\u6570\u529f\u80fd\u4e00\u6837\uff0c\u7b2c\u4e00\u53c2\u6570\u4e3anull\uff0c\u5c31\u53d6\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u503c\u3002 Text Only<pre><code>select e.empno,e.ename,nvl(e.deptno,d.deptno),d.dname\nfrom emp e\nfull join dept d\non e.deptno=d.deptno;\n</code></pre> A - B \u5dee\u96c6\u7684\u4e24\u79cd\u5199\u6cd5\uff1a Text Only<pre><code>select e.empno,e.ename,e.deptno\nfrom emp e\nleft join dept d\non e.deptno=d.deptno\nwhere d.deptno is null;\n</code></pre> Text Only<pre><code>select e.empno,e.ename,e.deptno\nfrom emp e\nwhere e.deptno not in (\n\u00a0 \u00a0select d.deptno\n\u00a0 \u00a0from deptno\n);\n</code></pre></p> <p>UNION union\u7684\u8bed\u6cd5\uff1a Text Only<pre><code>select_statement UNION [ALL | DISTINCT] select_statement UNION [ALL | DISTINCT] select_statement ...\n</code></pre> 1.union \u7b49\u4e8e union distinct\uff0c\u6548\u679c\u662f\u4f1a\u5bf9\u5b50\u67e5\u8be2\u7ed3\u679c\u53bb\u91cd 2.union all \u4e0d\u4f1a\u5bf9\u5b50\u67e5\u8be2\u7ed3\u679c\u53bb\u91cd \u6ce8\u610f\uff1aunion distinct\u00a0 \u8986\u76d6\u6389\u5bf9\u524d\u9762\u6240\u6709\u7684 union all</p> <p>\u51c6\u5907\u6570\u636e 1. \u521b\u5efa\u90e8\u95e8\u8868 Text Only<pre><code>create table if not exists dept(\n\u00a0 \u00a0deptno int comment '\u90e8\u95e8\u53f7',\n\u00a0 \u00a0dname string comment '\u90e8\u95e8\u540d\u79f0',\n\u00a0 \u00a0loc int \u00a0comment '\u90e8\u95e8\u4f4d\u7f6e'\n)row format delimited fields terminated by '\\t';\n</code></pre> \u90e8\u95e8\u8868\u6570\u636e Text Only<pre><code>10 \u00a0 \u00a0ACCOUNTING \u00a0 \u00a01700\n20 \u00a0 \u00a0RESEARCH \u00a0 \u00a01800\n30 \u00a0 \u00a0SALES \u00a0 \u00a01900\n40 \u00a0 \u00a0OPERATIONS \u00a0 \u00a01700\n</code></pre> 2. \u521b\u5efa\u5458\u5de5\u8868 Text Only<pre><code>create table if not exists emp(\n\u00a0 \u00a0empno int comment '\u5458\u5de5\u7f16\u53f7',\n\u00a0 \u00a0ename string comment '\u5458\u5de5\u59d3\u540d',\n\u00a0 \u00a0job string comment '\u5458\u5de5\u804c\u4f4d',\n\u00a0 \u00a0mgr int comment '\u4e0a\u7ea7\u9886\u5bfc\u7684\u5458\u5de5\u7f16\u53f7',\n\u00a0 \u00a0hiredate string comment '\u5165\u804c\u65e5\u671f',\n\u00a0 \u00a0sal double comment '\u85aa\u6c34',\n\u00a0 \u00a0comm double comment '\u5956\u91d1',\n\u00a0 \u00a0deptno int comment '\u6240\u5728\u90e8\u95e8\u53f7'\n)row format delimited fields terminated by '\\t';\n</code></pre> \u5458\u5de5\u8868\u6570\u636e Text Only<pre><code>7369 \u00a0 \u00a0SMITH \u00a0 \u00a0CLERK \u00a0 \u00a07902 \u00a0 \u00a01980-12-17 \u00a0 \u00a0800.00 \u00a0 \u00a0 \u00a0 \u00a020\n7499 \u00a0 \u00a0ALLEN \u00a0 \u00a0SALESMAN \u00a0 \u00a07698 \u00a0 \u00a01981-2-20 \u00a0 \u00a01600.00 \u00a0 \u00a0300.00 \u00a0 \u00a030\n7521 \u00a0 \u00a0WARD \u00a0 \u00a0SALESMAN \u00a0 \u00a07698 \u00a0 \u00a01981-2-22 \u00a0 \u00a01250.00 \u00a0 \u00a0500.00 \u00a0 \u00a030\n7566 \u00a0 \u00a0JONES \u00a0 \u00a0MANAGER \u00a0 \u00a07839 \u00a0 \u00a01981-4-2 \u00a0 \u00a02975.00 \u00a0 \u00a0 \u00a0 \u00a020\n7654 \u00a0 \u00a0MARTIN \u00a0 \u00a0SALESMAN \u00a0 \u00a07698 \u00a0 \u00a01981-9-28 \u00a0 \u00a01250.00 \u00a0 \u00a01400.00 \u00a0 \u00a030\n7698 \u00a0 \u00a0BLAKE \u00a0 \u00a0MANAGER \u00a0 \u00a07839 \u00a0 \u00a01981-5-1 \u00a0 \u00a02850.00 \u00a0 \u00a0 \u00a0 \u00a030\n7782 \u00a0 \u00a0CLARK \u00a0 \u00a0MANAGER \u00a0 \u00a07839 \u00a0 \u00a01981-6-9 \u00a0 \u00a02450.00 \u00a0 \u00a0 \u00a0 \u00a010\n7788 \u00a0 \u00a0SCOTT \u00a0 \u00a0ANALYST \u00a0 \u00a07566 \u00a0 \u00a01987-4-19 \u00a0 \u00a03000.00 \u00a0 \u00a0 \u00a0 \u00a020\n7839 \u00a0 \u00a0KING \u00a0 \u00a0PRESIDENT\u00a0\u00a0\u00a0\u00a0 \u00a0 \u00a01981-11-17 \u00a0 \u00a05000.00 \u00a0 \u00a0 \u00a0 \u00a010\n7844 \u00a0 \u00a0TURNER \u00a0 \u00a0SALESMAN \u00a0 \u00a07698 \u00a0 \u00a01981-9-8 \u00a0 \u00a01500.00 \u00a0 \u00a00.00 \u00a0 \u00a030\n7876 \u00a0 \u00a0ADAMS \u00a0 \u00a0CLERK \u00a0 \u00a07788 \u00a0 \u00a01987-5-23 \u00a0 \u00a01100.00 \u00a0 \u00a0 \u00a0 \u00a020\n7900 \u00a0 \u00a0JAMES \u00a0 \u00a0CLERK \u00a0 \u00a07698 \u00a0 \u00a01981-12-3 \u00a0 \u00a0950.00 \u00a0 \u00a0 \u00a0 \u00a030\n7902 \u00a0 \u00a0FORD \u00a0 \u00a0ANALYST \u00a0 \u00a07566 \u00a0 \u00a01981-12-3 \u00a0 \u00a03000.00 \u00a0 \u00a0 \u00a0 \u00a020\n7934 \u00a0 \u00a0MILLER \u00a0 \u00a0CLERK \u00a0 \u00a07782 \u00a0 \u00a01982-1-23 \u00a0 \u00a01300.00 \u00a0 \u00a0 \u00a0 \u00a010\n</code></pre> 3.\u52a0\u8f7d\u6570\u636e\u5230hive\u8868\u4e2d Text Only<pre><code>load data local inpath '/opt/module/data/dept.txt' into table dept;\nload data\u00a0local inpath '/opt/module/data/emp.txt' into table emp;\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/6-%E6%8E%92%E5%BA%8F/","title":"6-\u6392\u5e8f","text":"<p> \u7ea6 953 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 19 \u5206\u949f</p> <p>1.order by \u5168\u5c40\u6709\u5e8f\uff0c\u9ed8\u8ba4\u5347\u5e8fASC\uff0c\u8bbe\u7f6ereduce\u4e2a\u6570\u65e0\u6548\uff0c\u6c38\u8fdc\u53ea\u6709\u4e00\u4e2areduce\uff0c\u751f\u4ea7\u73af\u5883\u4e0b\u4e0d\u5141\u8bb8\u4f7f\u7528order by\uff0c\u4f1a\u901a\u8fc7\u914d\u7f6e\u4e0d\u6267\u884c\u901a\u8fc7order by\u6392\u5e8f\u7684SQL\uff0c\u56e0\u4e3a\u53ea\u67091\u4e2areduce\uff0c\u4f1a\u9020\u6210\u6570\u636e\u503e\u659c\uff0creduce\u4efb\u52a1\u8fc7\u91cd\u3002\u4e0d\u8fc7order by \u548c limit \u8fde\u7528\u8fd8\u662f\u53ef\u4ee5\uff0c\u6bd4\u5982\u8bf4\u53d6top10\uff0c\u4e5f\u5c31\u662f\u964d\u5e8f\u6392\uff0c\u7136\u540elimit 10\uff0c\u8fd9\u65f6hive\u4f1a\u5f0010\u4e2amap\u4efb\u52a1\uff0c\u7136\u540e\u8ba9\u6bcf\u4e2amap\u4efb\u52a1\u53d6top10\uff0c\u6700\u540e\u518d\u5728\u4e00\u4e2areduce\u91cc\u4ece100\u6761\u6570\u636e\u91cc\u53d6top10\u3002(MapReduce\u7a0b\u5e8f\u89c1\u672b\u5c3e)</p> <p>2.sort by \u4f1a\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u6392\u5e8f\uff0c\u5206\u533a\u7684\u4e2a\u6570\u7b49\u4e8e\u8bbe\u7f6e\u7684reduce\u4e2a\u6570\uff0c\u5982\u679c\u4e0d\u4e0edistribute by \u8fde\u7528\u7684\u8bdd\uff0c\u5206\u533a\u7684\u89c4\u5219\u662f\u968f\u673a\u5730\u5bf9\u6570\u636e\u5206\u533a\u3002 \u5728\u5f53\u524d\u4f1a\u8bdd\u4e2d\u8bbe\u7f6ereduce\u4e2a\u6570 Text Only<pre><code>set mapreduce.job.reduces=3;\n</code></pre> \u67e5\u770breduce\u4e2a\u6570 Text Only<pre><code>set mapreduce.job.reduces;\n</code></pre> \u6839\u636e\u90e8\u95e8\u7f16\u53f7\u964d\u5e8f\u67e5\u770b\u5458\u5de5\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u5e76\u4e0d\u662f\u5168\u5c40\u6709\u5e8f\u7684\uff0c\u800c\u662f\u90e8\u5206\u6709\u5e8f\u7684 Text Only<pre><code>select * from emp sort by deptno desc;\n</code></pre> \u6216\u8005\u5c06\u67e5\u8be2\u7ed3\u679c\u5bfc\u5165\u5230\u6587\u4ef6\u4e2d\uff0c\u4e0eMapReduce\u8bbe\u7f6e\u5206\u533a\u540e\u4e00\u6837\uff0c\u4f1a\u4fdd\u5b58\u5230\u591a\u4e2a\u6587\u4ef6\u4e2d\uff0c\u5728\u6bcf\u4e2a\u6587\u4ef6\u91cc\u7684\u6570\u636e\u662f\u6709\u5e8f\u7684 Text Only<pre><code>insert overwrite local directory '/opt/module/data/sortby-result'\nselect * from emp sort by deptno desc;\n</code></pre></p> <p>3.distribute by \u6307\u5b9a\u6309\u54ea\u4e2a\u5b57\u6bb5\u8fdb\u884c\u5206\u533a\uff0c\u5206\u533a\u7684\u4e2a\u6570\u7b49\u4e8e\u8bbe\u7f6e\u7684reduce\u4e2a\u6570\uff0c\u5e38\u4e0esort by \u8fde\u7528 \u5148\u8bbe\u7f6ereduce\u4e2a\u6570\u5927\u4e8e1\uff0c\u4e0d\u7136\u770b\u4e0d\u5230\u6548\u679c Text Only<pre><code>set mapreduce.job.reduces=3;\n</code></pre> \u6bd4\u5982\u53ea\u5bf9\u67e5\u8be2\u7ed3\u679c\u5206\u533a\uff1a Text Only<pre><code>insert overwrite local directory '/opt/module/data/distribute-result'\nselect * from emp\ndistribute by deptno\n</code></pre> \u5bf9\u67e5\u8be2\u7ed3\u679c\u5206\u533a\u540e\u6392\u5e8f\uff1a Text Only<pre><code>insert overwrite local directory '/opt/module/data/distribute-result'\nselect * from emp\ndistribute by deptno\nsort by empno desc;\n</code></pre> \u6ce8\u610f\uff1a</p> <ul> <li>distribute by \u7684\u5206\u533a\u89c4\u5219\u662f\u6839\u636e\u5206\u533a\u5b57\u6bb5\u7684 hash \u7801\u4e0e reduce \u7684\u4e2a\u6570\u8fdb\u884c\u6a21\u9664\u540e\uff0c \u4f59\u6570\u76f8\u540c\u7684\u5206\u5230\u4e00\u4e2a\u533a\u3002</li> <li>Hive \u8981\u6c42 DISTRIBUTE BY \u8bed\u53e5\u8981\u5199\u5728 SORT BY \u8bed\u53e5\u4e4b\u524d\u3002</li> </ul> <p>4 cluster by\uff0c\u5f53 distribute by \u548c sorts by \u5b57\u6bb5\u76f8\u540c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 cluster by\uff0c\u4f46\u662fcluster by\u4e0d\u80fd\u6307\u5b9a\u6392\u5e8f\u89c4 ASC\u3001DESC\uff0c\u9ed8\u8ba4\u53ea\u80fd\u662f\u5347\u5e8f\u3002\u4e5f\u5c31\u662f\u8bf4 cluster by\u662fdistribute by \u548c sorts by \u5b57\u6bb5\u76f8\u540c\u4e14\u6309\u5347\u5e8f\u89c4\u5219\u6392\u5e8f\u65f6\u7684\u7b80\u5199\u89c4\u5219\u3002 \u4ee5\u4e0b\u4e24\u79cd\u5199\u6cd5\u7b49\u4ef7\uff1a Text Only<pre><code>select * from emp cluster by deptno;\nselect * from emp distribute by deptno sort by deptno;\n</code></pre></p> <p>\u603b\u7ed3\uff1a</p> \u5173\u952e\u5b57 \u4f5c\u7528 \u662f\u5426\u5168\u5c40\u6709\u5e8f Reducer \u6570\u91cf \u6392\u5e8f\u65b9\u5411\u9650\u5236 ORDER BY \u5168\u5c40\u6392\u5e8f \u662f 1 \u53ef\u6307\u5b9a ASC/DESC SORT BY \u5c40\u90e8\u6392\u5e8f\uff08\u6bcf\u4e2a Reducer \u5185\u90e8\u6709\u5e8f\uff09 \u5426 \u591a\u4e2a \u53ef\u6307\u5b9a ASC/DESC DISTRIBUTE BY \u6309\u5b57\u6bb5\u54c8\u5e0c\u5206\u533a \u5426 \u591a\u4e2a \u65e0 CLUSTER BY \u6309\u5b57\u6bb5\u54c8\u5e0c\u5206\u533a + \u7ec4\u5185\u5347\u5e8f\u6392\u5e8f \u5426 \u591a\u4e2a \u4ec5\u5347\u5e8f <p>MapReduce\u7a0b\u5e8f\uff1a\u6c42\u6d88\u8d39\u91d1\u989dtop10\u7684\u8ba2\u5355 \u8f93\u5165\u6570\u636e\uff1a\u56e0\u4e3aMapTask\u7684\u6570\u91cf\u7531\u5207\u7247\u6570\u91cf\u51b3\u5b9a\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u5f00\u542f3\u4e2aMapTask\u5c31\u9700\u8981\u5c06\u8f93\u5165\u6587\u4ef6\u5206\u62103\u4e2a\u6587\u4ef6 Order\u7c7b Text Only<pre><code>public class Order implements WritableComparable&lt;Order&gt; {\n\n\u00a0\u00a0\u00a0\u00a0private String name;\n\u00a0\u00a0\u00a0\u00a0private String orderDate;\n\u00a0\u00a0\u00a0\u00a0private double cost;\n\n\u00a0\u00a0\u00a0\u00a0public Order() {\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public Order(String name, String orderDate, double cost) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.name = name;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.orderDate = orderDate;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.cost = cost;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void write(DataOutput out) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeUTF(name);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeUTF(orderDate);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0out.writeDouble(cost);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void readFields(DataInput in) throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0name = in.readUTF();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0orderDate = in.readUTF();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cost = in.readDouble();\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int compareTo(Order o) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return Double.compare(o.cost, this.cost);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public String toString() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return name + ',' + orderDate + ',' + cost;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public String getName() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return name;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public String getOrderDate() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return orderDate;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public double getCost() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return cost;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> map Text Only<pre><code>public class TopNMapper extends Mapper&lt;LongWritable, Text, DoubleWritable, Order&gt; {\n\n\u00a0\u00a0\u00a0\u00a0DoubleWritable doubleWritable = new DoubleWritable();\n\u00a0\u00a0\u00a0\u00a0PriorityQueue&lt;Order&gt; queue = new PriorityQueue&lt;&gt;();\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, DoubleWritable, Order&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] split = value.toString().split(\",\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0double cost = Double.parseDouble(split[2]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Order order = new Order(split[0], split[1], cost);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0queue.add(order);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void cleanup(Mapper&lt;LongWritable, Text, DoubleWritable, Order&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 3; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Order order = queue.remove();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0doubleWritable.set(order.getCost());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(doubleWritable, order);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> reduce Text Only<pre><code>public class TopNReducer extends Reducer&lt;DoubleWritable, Order, NullWritable, Order&gt; {\n\n\u00a0\u00a0\u00a0\u00a0PriorityQueue&lt;Order&gt; queue = new PriorityQueue&lt;&gt;();\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void reduce(DoubleWritable key, Iterable&lt;Order&gt; values, Reducer&lt;DoubleWritable, Order, NullWritable, Order&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Order value : values) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Order order = new Order(value.getName(), value.getOrderDate(), value.getCost());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0queue.add(order);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0protected void cleanup(Reducer&lt;DoubleWritable, Order, NullWritable, Order&gt;.Context context) throws IOException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 3; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0context.write(NullWritable.get(), queue.remove());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> Driver Text Only<pre><code>public class TopNDriver {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws IOException, InterruptedException, ClassNotFoundException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Job job = Job.getInstance(new Configuration());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setJarByClass(TopNDriver.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapperClass(TopNMapper.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setReducerClass(TopNReducer.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputKeyClass(DoubleWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setMapOutputValueClass(Order.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputKeyClass(NullWritable.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0job.setOutputValueClass(Order.class);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String classPath = Thread.currentThread().getContextClassLoader().getResource(\"\").getPath();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileInputFormat.setInputPaths(job, new Path(classPath + \"/input/topN\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0FileOutputFormat.setOutputPath(job, new Path(classPath + \"/top3\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean b = job.waitForCompletion(true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.exit(b ? 0 : 1);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/7-Hive%E5%87%BD%E6%95%B0/","title":"7-Hive\u51fd\u6570","text":"<p> \u7ea6 181 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 4 \u5206\u949f</p> <p>Hive\u7684\u51fd\u6570\u79f0\u4e3aUDF\uff08User-Defined-Function\uff09\uff0c\u6309\u8f93\u5165\u8f93\u51fa\u7684\u5f62\u5f0f\u53ef\u5206\u4e3a3\u7c7b\uff0c\u5373\u4e00\u8fdb\u4e00\u51fa\u3001\u591a\u8fdb\u4e00\u51fa\u3001\u4e00\u8fdb\u591a\u51fa\uff0c\u867d\u7136\u8bf4UDF\u5305\u62ec\u8fd93\u7c7b\u51fd\u6570\uff0c\u4f46\u901a\u5e38\u5c06\u4e00\u8fdb\u4e00\u51fa\u7684\u51fd\u6570\u79f0\u4e3aUDF\u51fd\u6570\uff0c\u591a\u8fdb\u4e00\u51fa\u7684\u51fd\u6570\u79f0\u4e3aUDAF\u51fd\u6570\uff0c\u4e00\u8fdb\u591a\u51fa\u7684\u51fd\u6570\u79f0\u4e3aUDTF\u3002\u5373\uff1a \uff081\uff09UDF\uff08User-Defined-Function\uff09\uff0c\u4e00\u8fdb\u4e00\u51fa\uff0c \uff082\uff09UDAF\uff08User-Defined Aggregation Function\uff09 \u805a\u96c6\u51fd\u6570\uff0c\u591a\u8fdb\u4e00\u51fa\uff0c\u5982\uff1acount\u3001max\u3001min\u3001sum\u3001avg \uff083\uff09UDTF\uff08User-Defined Table-Generating Functions\uff09 \u4e00\u8fdb\u591a\u51fa\uff0c\u7c7b\u4f3c\u4e8e\uff1alateral view explode() </p> <p>\u4e0e\u51fd\u6570\u6709\u5173\u7684\u5e38\u7528\u547d\u4ee4\uff1a \u67e5\u770b\u7cfb\u7edf\u81ea\u5e26\u7684\u51fd\u6570\uff1ashow functions; \u663e\u793a\u81ea\u5e26\u7684\u51fd\u6570\u7684\u7528\u6cd5\uff1adesc function upper; \u663e\u793a\u81ea\u5e26\u7684\u51fd\u6570\u7684\u8be6\u7ec6\u7528\u6cd5\uff0c\u6709\u4f8b\u5b50\uff1adesc function extended upper;</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/8-UDF%E4%B9%8B%E4%B8%8E%E6%95%B0%E5%AD%A6%E3%80%81%E9%9B%86%E5%90%88%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%20%E5%92%8C%20%E6%97%A5%E6%9C%9F%20%E7%9B%B8%E5%85%B3%E7%9A%84%E5%87%BD%E6%95%B0/","title":"8-UDF\u4e4b\u4e0e\u6570\u5b66\u3001\u96c6\u5408\u3001\u7c7b\u578b\u8f6c\u6362 \u548c \u65e5\u671f \u76f8\u5173\u7684\u51fd\u6570","text":"<p> \u7ea6 568 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 11 \u5206\u949f</p> <p>\u6570\u5b66\u51fd\u6570 \u4e0e\u53d6\u6574\u6709\u5173\u7684\u51fd\u6570\uff1a round\uff1a \u56db\u820d\u4e94\u5165 Text Only<pre><code>select round(3.14);\nselect round(3.54);\n</code></pre> ceil\uff1a\u00a0\u00a0\u5411\u4e0a\u53d6\u6574 Text Only<pre><code>select ceil(3.14);\nselect ceil(3.54);\n</code></pre> floor\uff1a \u5411\u4e0b\u53d6\u6574 Text Only<pre><code>select floor(3.14);\nselect floor(3.54);\n</code></pre></p> <p>\u96c6\u5408\u51fd\u6570 size\uff1a \u96c6\u5408\u4e2d\u5143\u7d20\u7684\u4e2a\u6570 Text Only<pre><code>select size(friends) from test3;\n</code></pre> map_keys\uff1a \u8fd4\u56demap\u4e2d\u7684key Text Only<pre><code>select map_keys(children) from test3;\n</code></pre> map_values: \u8fd4\u56demap\u4e2d\u7684value Text Only<pre><code>select map_values(children) from test3;\n</code></pre> array_contains: \u5224\u65adarray\u4e2d\u662f\u5426\u5305\u542b\u67d0\u4e2a\u5143\u7d20 Text Only<pre><code>select array_contains(friends,'bingbing') from test3;\n</code></pre> sort_array\uff1a \u5c06array\u4e2d\u7684\u5143\u7d20\u6392\u5e8f Text Only<pre><code>select sort_array(friends) from test3;\n</code></pre></p> <p>\u7c7b\u578b\u8f6c\u6362\u51fd\u6570 cast(expr as )\uff1a\u5c06\u8868\u8fbe\u5f0fexpr\u7684\u7ed3\u679c\u8f6c\u6362\u6210\u6307\u5b9a\u7684\u7c7b\u578b \u4f8b\u5982\uff0c\u628astring\u7c7b\u578b\u7684'100'\u8f6c\u5316\u6210BIGINT\u7c7b\u578b\u7684100 Text Only<pre><code>select cast('100' as BIGINT);\n</code></pre> \u628a\u65e5\u671f\u8f6c\u6362\u6210string Text Only<pre><code>select cast(date_format('2021-10-27 14:45:55', 'yyyy-MM-dd') as string);\n</code></pre> <p>\u65e5\u671f\u51fd\u6570 unix_timestamp\uff1a\u8fd4\u56de\u5f53\u524d\u6216\u6307\u5b9a\u65f6\u95f4\u7684\u65f6\u95f4\u6233 \uff08\u5355\u4f4d\uff1a\u79d2\uff09 Text Only<pre><code>select unix_timestamp();\nselect unix_timestamp(\"2020-10-28\",'yyyy-MM-dd');\n</code></pre> from_unixtime\uff1a\u5c06\u65f6\u95f4\u6233\u8f6c\u4e3a\u65e5\u671f\u683c\u5f0f Text Only<pre><code>select from_unixtime(1603843200);\n</code></pre> current_date\uff1a\u5f53\u524d\u65e5\u671f Text Only<pre><code>select current_date;\n</code></pre> current_timestamp\uff1a\u5f53\u524d\u7684\u65e5\u671f\u52a0\u65f6\u95f4 Text Only<pre><code>select current_timestamp;\n</code></pre> to_date\uff1a\u62bd\u53d6\u65e5\u671f\u90e8\u5206 Text Only<pre><code>select to_date('2020-10-28 12:12:12');\n</code></pre> year\uff1a\u83b7\u53d6\u5e74 Text Only<pre><code>select year('2020-10-28 12:12:12');\n</code></pre> month\uff1a\u83b7\u53d6\u6708 Text Only<pre><code>select month('2020-10-28 12:12:12');\n</code></pre> day\uff1a\u83b7\u53d6\u65e5 Text Only<pre><code>select day('2020-10-28 12:12:12');\n</code></pre> hour\uff1a\u83b7\u53d6\u65f6 Text Only<pre><code>select hour('2020-10-28 12:12:12');\n</code></pre> minute\uff1a\u83b7\u53d6\u5206 Text Only<pre><code>select minute('2020-10-28 12:13:12');\n</code></pre> second\uff1a\u83b7\u53d6\u79d2 Text Only<pre><code>select second('2020-10-28 12:12:14');\n</code></pre> weekofyear\uff1a\u5f53\u524d\u65f6\u95f4\u662f\u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u5468 Text Only<pre><code>select weekofyear('2020-10-28 12:12:12');\n</code></pre> dayofmonth\uff1a\u5f53\u524d\u65f6\u95f4\u662f\u4e00\u4e2a\u6708\u4e2d\u7684\u7b2c\u51e0\u5929 Text Only<pre><code>select dayofmonth('2020-10-28 12:12:12');\n</code></pre> months_between\uff1a \u4e24\u4e2a\u65e5\u671f\u95f4\u76f8\u5dee\u7684\u6708\u4efd\uff0cMySQL\u90a3\u91cc\u9762\u6ca1\u6709\u8fd9\u4e2a\u51fd\u6570 Text Only<pre><code>select months_between('2020-04-01','2020-10-28');\n</code></pre> add_months\uff1a\u65e5\u671f\u52a0\u51cf\u6708 Text Only<pre><code>select add_months('2020-10-28',-3);\n</code></pre> datediff\uff1a\u4e24\u4e2a\u65e5\u671f\u76f8\u5dee\u7684\u5929\u6570 Text Only<pre><code>select datediff('2020-11-04','2020-10-28');\n</code></pre> date_add\uff1a\u65e5\u671f\u52a0\u5929\u6570 Text Only<pre><code>select date_add('2020-10-28',4);\n</code></pre> date_sub\uff1a\u65e5\u671f\u51cf\u5929\u6570 Text Only<pre><code>select date_sub('2020-10-28',-4);\n</code></pre> last_day\uff1a\u5f53\u6708\u7684\u6700\u540e\u4e00\u5929 Text Only<pre><code>select last_day('2020-02-30');\n</code></pre> date_format(): \u683c\u5f0f\u5316\u65e5\u671f \u7b2c\u4e00\u4e2a\u53c2\u6570\u8f93\u5165\u7684\u65e5\u671f\u5fc5\u987b\u662f yyyy-MM-dd HHss \u7684\u6807\u51c6\u683c\u5f0f\uff0c\u7136\u540e\u4ee5\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u683c\u5f0f\u8f93\u51fa Text Only<pre><code>select date_format('2020-10-28 12:12:12','yyyy/MM/dd HH:mm:ss');\n</code></pre> next_day\uff1a\u4e0b\u4e00\u4e2a\u5468\u51e0\u7684\u65e5\u671f\u662f\u54ea\u4e00\u5929 \u6bd4\u59822021-10-27\u662f\u5468\u4e09\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u5468\u4e94\u662f\uff1a Text Only<pre><code>&gt; select next_day('2021-10-27','friday');\n2021-10-29\n</code></pre> \u518d\u6bd4\u59822021-10-27\u662f\u5468\u4e09\uff0c\u90a3\u4e48\u672c\u5468\u7684\u5468\u4e00\u662f\uff1a Text Only<pre><code>&gt; select date_add(next_day('2021-10-27','MO'),-7);\n2021-10-25\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hive/9-UDF%20%E4%B9%8B%20%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0%20%E5%92%8C%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0/","title":"9-UDF \u4e4b \u6761\u4ef6\u51fd\u6570 \u548c \u5b57\u7b26\u4e32\u51fd\u6570","text":"<p> \u7ea6 651 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>\u6761\u4ef6\u51fd\u6570 NVL(value\uff0cdefault_value)\uff1avalue\u4e0d\u4e3anull\u5219\u8fd4\u56devalue\uff0c\u5426\u5219\u8fd4\u56dedefault_value\uff0c\u5982\u679c\u4e24\u4e2a\u53c2\u6570\u90fd\u4e3aNULL \uff0c\u5219\u8fd4\u56de NULL\u3002 \u8be5\u51fd\u6570\u7684\u76ee\u7684\u662f\u628a\u4e00\u4e2a\u7a7a\u503c\uff08null\uff09\u8f6c\u6362\u6210\u4e00\u4e2a\u5b9e\u9645\u7684\u503c\u3002\u5176\u8868\u8fbe\u5f0f\u7684\u503c\u53ef\u4ee5\u662f\u6570\u5b57\u578b\u3001\u5b57\u7b26\u578b\u548c\u65e5\u671f\u578b\u3002\u4f46\u662f\u8868\u8fbe\u5f0f1\u548c\u8868\u8fbe\u5f0f2\u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u4e3a\u540c\u4e00\u4e2a\u7c7b\u578b\u3002</p> <p>COALESCE(T v1, T v2, ...)\uff1av1\u4e0d\u4e3anull\u5219\u8fd4\u56dev1\uff0c\u5426\u5219v2\u4e0d\u4e3anull\u5219\u8fd4\u56dev2\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002</p> <p>IF(expr1,expr2,expr3) \u76f8\u5f53\u4e8eJava\u4e2d\u7684\u4e09\u5143\u8fd0\u7b97\u7b26\uff0cexpr1\u4e3atrue\uff0c\u5219\u7ed3\u679c\u4e3aexpr2\uff0c\u5426\u5219\u7ed3\u679c\u4e3aexpr3\u3002 \u6848\u4f8b\uff1a \u521b\u5efa\u4e00\u5f20\u8868 Text Only<pre><code>create table emp_sex(\n\u00a0\u00a0\u00a0\u00a0name string,\n\u00a0\u00a0\u00a0\u00a0dept_id string,\n\u00a0\u00a0\u00a0\u00a0sex string\n)row format delimited fields terminated by \"\\t\";\n</code></pre> \u6570\u636esex.txt\uff1a Text Only<pre><code>\u609f\u7a7a\u00a0\u00a0\u00a0\u00a0A\u00a0\u00a0\u00a0\u00a0\u7537\n\u5927\u6d77\u00a0\u00a0\u00a0\u00a0A\u00a0\u00a0\u00a0\u00a0\u7537\n\u5b8b\u5b8b\u00a0\u00a0\u00a0\u00a0B\u00a0\u00a0\u00a0\u00a0\u7537\n\u51e4\u59d0\u00a0\u00a0\u00a0\u00a0A\u00a0\u00a0\u00a0\u00a0\u5973\n\u5a77\u59d0\u00a0\u00a0\u00a0\u00a0B\u00a0\u00a0\u00a0\u00a0\u5973\n\u5a77\u5a77\u00a0\u00a0\u00a0\u00a0B\u00a0\u00a0\u00a0\u00a0\u5973\n</code></pre> \u5bfc\u5165\u5230hive Text Only<pre><code>load data local inpath '/opt/module/data/sex.txt' into table emp_sex;\n</code></pre> \u9700\u6c42\uff1a\u6c42\u51fa\u4e0d\u540c\u90e8\u95e8\u7537\u5973\u5404\u591a\u5c11\u4eba\u3002\u7ed3\u679c\u5982\u4e0b\uff1a  HQL\uff1a Text Only<pre><code>select dept_id,\n\u00a0\u00a0\u00a0\u00a0sum(if(sex='\u7537',1,0)) male,\n\u00a0\u00a0\u00a0\u00a0sum(if(sex='\u5973',1,0)) female\nfrom emp_sex\ngroup by dept_id;\n</code></pre></p> <p>CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END\uff1a\u5f53a=b\u65f6\u8fd4\u56dec\uff0ca=d\u65f6\u8fd4\u56dee CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END\uff1a\u5f53a=true\u65f6\u8fd4\u56deb\uff0cc=true\u65f6\u8fd4\u56ded \u7528case when then \u89e3\u51b3\u4e0a\u9762\u7684\u90a3\u4e2a\u95ee\u9898\uff1a Text Only<pre><code>select dept_id,\n\u00a0\u00a0\u00a0\u00a0sum(case sex when '\u7537' then 1 else 0 end) male,\n\u00a0\u00a0\u00a0\u00a0sum(case sex when '\u5973' then 1 else 0 end) female\nfrom emp_sex\ngroup by dept_id;\n</code></pre></p> <p>\u5b57\u7b26\u4e32\u51fd\u6570 upper\uff1a \u8f6c\u5927\u5199 Text Only<pre><code>select upper('low');\n</code></pre> lower\uff1a \u8f6c\u5c0f\u5199 Text Only<pre><code>select lower('low');\n</code></pre> length\uff1a \u957f\u5ea6 Text Only<pre><code>select length(\"atguigu\");\n</code></pre> trim\uff1a\u00a0\u00a0\u524d\u540e\u53bb\u7a7a\u683c Text Only<pre><code>select trim(\" atguigu \");\n</code></pre> lpad\uff1a \u5411\u5de6\u8865\u9f50\u5230\u6307\u5b9a\u957f\u5ea6\uff0c\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u662f\u7528\u4e8e\u8865\u9f50\u7684\u5b57\u7b26 Text Only<pre><code>select lpad('atguigu',9,'g');\n</code></pre> rpad\uff1a\u00a0\u00a0\u5411\u53f3\u8865\u9f50\uff0c\u5230\u6307\u5b9a\u957f\u5ea6 Text Only<pre><code>select rpad('atguigu',9,'g');\n</code></pre> regexp_replace\uff1a\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u76ee\u6807\u5b57\u7b26\u4e32\uff0c\u5339\u914d\u6210\u529f\u540e\u66ff\u6362\uff01 Text Only<pre><code>SELECT regexp_replace('2020/10/25', '/', '-');\n</code></pre> concat(str1, str2, ... strN)\uff1a\u62fc\u63a5\u5b57\u7b26\u4e32 Text Only<pre><code>&gt; select concat('a', ',', 'b', '-', 'c');\na,b-c\n</code></pre> concat_ws(separator, [string | array(string)]+)\uff1a\u4e5f\u662f\u62fc\u63a5\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u62fc\u63a5\u6bcf\u4e2a\u5b57\u7b26\u65f6\u4e2d\u95f4\u4f7f\u7528\u7684\u5206\u9694\u7b26\uff0c\u540e\u9762\u53ef\u53d8\u53c2\u6570\uff0c\u65e2\u53ef\u4ee5\u662f\u591a\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u6570\u7ec4\u3002 Text Only<pre><code>&gt;\u00a0select concat_ws(',', 'a', 'b', 'c');\na,b,c\n</code></pre> str_to_map(text[, delimiter1, delimiter2])\uff1a\u4f7f\u7528\u5206\u9694\u7b26\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u8f6c\u6362\u6210Map\uff0cdelimiter1\u662f\u6bcf\u4e24\u4e2aK-V\u952e\u503c\u5bf9\u4e4b\u95f4\u7684\u5206\u9694\u7b26\uff0cdelimiter2\u662f\u6bcf\u4e2aK-V\u952e\u503c\u5bf9K\u548cV\u4e4b\u95f4\u7684\u5206\u9694\u7b26\uff0cdelimiter1\u9ed8\u8ba4\u662f\u9017\u53f7\uff0cdelimiter2\u9ed8\u8ba4\u662f :\u00a0 Text Only<pre><code>&gt; select str_to_map('a:1,b:2,c:3', ',', ':');\n{\"a\":\"1\",\"b\":\"2\",\"c\":\"3\"}\n</code></pre> split(string str, string pat)\uff1a\u6309pat\u5206\u5272\u5b57\u7b26\u4e32str</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/1-Kafka%E6%9E%B6%E6%9E%84%E5%8F%8A%E7%90%86%E8%A7%A3/","title":"1-Kafka\u67b6\u6784\u53ca\u7406\u89e3","text":"<p> \u7ea6 872 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <p>Kafka \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u57fa\u4e8e\u53d1\u5e03/\u8ba2\u9605\u6a21\u5f0f\u7684\u6d88\u606f\u961f\u5217\uff08Message Queue\uff09\uff0c\u4e3b\u8981\u5e94\u7528\u4e8e\u5927\u6570\u636e\u5b9e\u65f6\u5904\u7406\u9886\u57df\u3002 Flume\u9488\u5bf9\u7684\u662f\u6587\u4ef6\u6570\u636e\uff0cKafka\u9488\u5bf9\u7684\u662f\u6d88\u606f\u6570\u636e\u3002Flume\u662f\u4e3b\u52a8\u7684\uff0c\u4e3b\u52a8\u5730\u76d1\u63a7\u53d8\u5316\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u4e3b\u52a8\u5730\u628a\u6570\u636e\u5199\u51fa\u3002Kafka\u662f\u88ab\u52a8\u7684\uff0c\u7531\u751f\u4ea7\u8005\u4e3b\u52a8\u5f80\u6d88\u606f\u961f\u5217\u91cc\u53d1\u9001\u6570\u636e\uff0c\u7531\u6d88\u8d39\u8005\u4e3b\u52a8\u4ece\u6d88\u606f\u961f\u5217\u91cc\u9762\u62c9\u53d6\u6570\u636e\u3002</p> <p>Kafka\u67b6\u6784\u56fe\uff1a Topic-A\u6709\u4e24\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u6709\u4e24\u4e2a\u526f\u672c\uff0c\u540c\u4e00\u4e2a\u5206\u533a\u7684\u4e0d\u540c\u526f\u672c\u5fc5\u987b\u5206\u5e03\u5728\u4e0d\u540c\u7684\u4e3b\u673a\u4e0a\uff1bTopic-B\u4e5f\u6709\u4e24\u4e2a\u5206\u533a\uff0c\u4f46\u662f\u6bcf\u4e2a\u5206\u533a\u53ea\u6709\u4e00\u4e2a\u526f\u672c\uff0c\u8fd9\u4e24\u4e2a\u5206\u533a\u53ef\u4ee5\u5206\u5e03\u5728\u540c\u4e00\u4e2a\u4e3b\u673a\u4e0a\uff0c\u4f46\u662f\u901a\u5e38Kafka\u4f1a\u4f18\u5148\u628a\u4e0d\u540c\u5206\u533a\u5206\u5e03\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u5e76\u53d1\u5ea6\u548c\u541e\u5410\u91cf\u3002 </p> <ul> <li>Broker \uff1a \u4e00\u53f0 kafka \u670d\u52a1\u5668\u5c31\u662f\u4e00\u4e2a broker\u3002</li> <li>Producer \uff1a \u751f\u4ea7\u8005\uff0c\u5c31\u662f\u5411 kafka broker \u53d1\u6d88\u606f\u7684\u5ba2\u6237\u7aef\uff1b</li> <li>Consumer \uff1a\u6d88\u8d39\u8005\uff0c\u5411 kafka broker \u53d6\u6d88\u606f\u7684\u5ba2\u6237\u7aef\uff1b</li> <li>Topic \uff1a \u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u9762\u5411\u7684\u90fd\u662ftopic\uff0ctopic\u4e2d\u4fdd\u5b58\u7684\u662f\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\uff0c\u4e00\u4e2a topic \u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a partition\uff0c\u6bcf\u4e2apartition\u53ea\u4fdd\u5b58topic\u7684\u4e00\u90e8\u5206\u6570\u636e\u3002\u5982\u679cTopic\u53ea\u6709\u4e00\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u6240\u6709\u53d1\u9001\u5230\u6b64topic\u7684\u6d88\u606f\u90fd\u662f\u6709\u5e8f\u7684\uff0c\u4f46\u662f\u5982\u679ctopic\u88ab\u5212\u5206\u6210\u4e86\u591a\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u5728\u6574\u4e2atopic\u4e2d\u6d88\u606f\u5c31\u4e0d\u662f\u5168\u5c40\u6709\u5e8f\u4e86\uff0c\u800c\u53ea\u662f\u5728\u5206\u533a\u5185\u6709\u5e8f\u3002</li> <li>Partition\uff1a \u4e00\u4e2a topic \u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a partition\uff0c\u6bcf\u4e2a partition \u90fd\u662f\u4e00\u4e2a\u6709\u5e8f\u7684\u961f\u5217\uff1b\u4e00\u4e2atopic\u7684\u591a\u4e2apartition\u901a\u5e38\u5206\u5e03\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u5e76\u53d1\u5ea6\u548c\u541e\u5410\u91cf\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u3002</li> </ul> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u6d88\u8d39\u8005A\u3001B\u5c5e\u4e8e\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\uff0c\u5b83\u4eec\u5404\u81ea\u8d1f\u8d23\u6d88\u8d39Topic-A\u4e24\u4e2a\u5206\u533a\u4e2d\u7684\u6d88\u606f\uff0c\u7cfb\u7edf\u7684\u5e76\u884c\u5ea6\u548c\u541e\u5410\u5f88\u9ad8\uff0c\u56e0\u4e3a\u6709\u4e24\u4e2a\u6d88\u8d39\u8005\u5728\u540c\u65f6\u6d88\u8d39\u6d88\u606f\u561b\uff1b\u800c\u6d88\u8d39\u8005C\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u5b83\u9700\u8981\u4e00\u4e2a\u4eba\u8d1f\u8d23\u6d88\u8d39Topic-B\u7684\u6240\u6709\u6d88\u606f\uff0c\u867d\u7136Topic-B\u6709\u4e24\u4e2a\u5206\u533a\uff0c\u4f46\u662f\u4e24\u4e2a\u5206\u533a\u5e76\u53d1\u5ea6\u7684\u4f18\u52bf\u5e76\u6ca1\u6709\u88ab\u5229\u7528\u5230\uff0c\u7cfb\u7edf\u7684\u74f6\u9888\u5728\u4e8e\u6d88\u8d39\u8005C\u7684\u6d88\u8d39\u901f\u5ea6\u3002</p> <ul> <li>Replica\uff1a\u526f\u672c\uff0c\u4e00\u4e2aPartition\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u591a\u4e2aReplica\uff0c\u6bcf\u4e2aReplica\u5fc5\u987b\u5206\u5e03\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0cReplica\u6709\u4e24\u79cd\u89d2\u8272\uff0c\u4e00\u4e2aLeader\u548c\u591a\u4e2aFollower\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u90fd\u662f\u548cLeader\u6253\u4ea4\u9053\uff0cFollower\u53ea\u8d1f\u8d23\u5907\u4efdLeader\u7684\u6570\u636e\uff0c\u5f53Leader\u53d1\u751f\u6545\u969c\u65f6\uff0c\u67d0\u4e2a Follower\u4f1a\u6210\u4e3a\u65b0\u7684 Leader\u3002\u526f\u672c\u7b56\u7565\u63d0\u9ad8\u4e86Kafka\u7684\u53ef\u7528\u6027\uff0c\u4f46\u662f\u8bbe\u7f6eReplica\u7684\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7Kafka\u96c6\u7fa4Broker\u7684\u6570\u91cf\u3002Topic\u3001partition\u3001Replica\u3001Leader\u3001Follower\u4e0e redis\u7684\u96c6\u7fa4\u548c\u4e3b\u4ece\u590d\u5236\u7684\u601d\u60f3\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7redis\u7684\u4e3b\u4ece\u590d\u5236\u53ef\u4ee5\u505a\u5230\u8bfb\u5199\u5206\u79bb\uff0c\u800cReplica\u7684Leader\u4e0eFollower\u4e0d\u80fd\u505a\u5230\u8bfb\u5199\u5206\u79bb\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7684\u8bfb\u5199\u64cd\u4f5c\u90fd\u662f\u548cLeader\u8fdb\u884c\u3002</li> <li>Consumer Group\uff1a\u6d88\u8d39\u8005\u7ec4\uff0c\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u4e0d\u540c\u6d88\u8d39\u8005\u4e0d\u80fd\u540c\u65f6\u8ba2\u9605\u540c\u4e00\u4e2atopic\u7684\u540c\u4e00\u4e2apartition\uff0c\u53ea\u80fd\u8ba2\u9605\u540c\u4e00\u4e2atopic\u7684\u4e0d\u540cpartition\uff0c\u6216\u8005\u8ba2\u9605\u4e0d\u540c\u7684topic\u3002</li> <li>Kafka\u4e3b\u673a\u542f\u52a8\u9700\u8981\u5411zookeeper\u96c6\u7fa4\u6ce8\u518c\u4fe1\u606f\uff0c\u8fd9\u6837\u624d\u80fd\u52a0\u5165\u5230Kafka\u96c6\u7fa4\u4e2d\uff0cKafka\u96c6\u7fa4\u8fd8\u4f1a\u628atopic\u4fe1\u606f\u5b58\u653e\u5230zookeeper\u96c6\u7fa4\u4e2d</li> </ul>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/2-Kafka%E5%AE%89%E8%A3%85/","title":"2-Kafka\u5b89\u88c5","text":"<p> \u7ea6 1253 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 25 \u5206\u949f</p> <p>1.\u5b98\u7f51\u4e0b\u8f7dKafka 2.\u89e3\u538b\u00a0tar -zxvf /opt/software/kafka_2.13-2.8.0.tgz -C /opt/module/ 3.\u914d\u7f6e\u6587\u4ef6 config/server.properties \u4e2d\u7684\u4ee5\u4e0b\u5185\u5bb9\u9700\u8981\u4fee\u6539 Text Only<pre><code>vim config/server.properties\n</code></pre> Text Only<pre><code>#broker \u7684\u5168\u5c40\u552f\u4e00\u7f16\u53f7\uff0c\u4e0d\u80fd\u91cd\u590d\nbroker.id=0\n#topic\u6570\u636e\u5b58\u653e\u7684\u4f4d\u7f6e\nlog.dirs=/opt/module/kafka_2.13-2.8.0/data\n#zookeeper\u96c6\u7fa4\u7684\u8fde\u63a5\u5730\u5740\nzookeeper.connect=hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka\n</code></pre> 4.\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u65b9\u4fbf\u76f4\u63a5\u4f7f\u7528kafka\u7684\u547d\u4ee4 Text Only<pre><code>vim /etc/profile.d/my_env.sh\n</code></pre> Text Only<pre><code>#KAFKA_HOME\nexport KAFKA_HOME=/opt/module/kafka_2.13-2.8.0\nexport PATH=$PATH:$KAFKA_HOME/bin\n</code></pre> Text Only<pre><code>source /etc/profile\n</code></pre> 5.\u5206\u53d1 Text Only<pre><code>xsync kafka_2.13-2.8.0/\n</code></pre> 6.\u5728Hadoop103\u548cHadoop104\u4e0a\u4fee\u6539\u73af\u5883\u53d8\u91cf\uff0c\u56e0\u4e3a /etc/profile.d/my_env.sh \u5c5e\u4e8eroot\u7528\u6237\uff0c\u5f53\u524djmoon\u7528\u6237\u6ca1\u6709\u6743\u9650\u5206\u53d1 7.\u4fee\u6539Hadoop103\u548cHadoop104 \u7684 \u914d\u7f6e\u6587\u4ef6 config/server.properties \u4e2d\u7684 broker.id\uff0c broker.id \u4e0d\u5f97\u91cd\u590d\uff0c\u5982 broker.id=1\u3001 broker.id=2 8.\u5728/home/jmoon/bin\u76ee\u5f55\u4e0b\u7f16\u5199\u7fa4\u8d77Kafka\u7684\u811a\u672c kafka.sh Text Only<pre><code>#!/bin/bash\n\ncase $1 in\n\"start\"){\n\u00a0\u00a0\u00a0\u00a0for i in hadoop102 hadoop103 hadoop104\n\u00a0\u00a0\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo ---------- kafka $i \u542f\u52a8 ------------\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh $i \"/opt/module/kafka_2.13-2.8.0/bin/kafka-server-start.sh -daemon /opt/module/kafka_2.13-2.8.0/config/server.properties\"\n\u00a0\u00a0\u00a0\u00a0done\n};;\n\"stop\"){\n\u00a0\u00a0\u00a0\u00a0for i in hadoop102 hadoop103 hadoop104\n\u00a0\u00a0\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo ---------- kafka $i \u505c\u6b62 ------------\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh $i \"/opt/module/kafka_2.13-2.8.0/bin/kafka-server-stop.sh stop\"\n\u00a0\u00a0\u00a0\u00a0done\n};;\nesac\n</code></pre> \u589e\u52a0\u53ef\u6267\u884c\u6743\u9650 Text Only<pre><code>chmod +x\u00a0kafka.sh\n</code></pre> \u5206\u53d1\uff0c\u4ee5\u4fbf\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\u90fd\u53ef\u4ee5\u7fa4\u8d77kafka Text Only<pre><code>xsync\u00a0kafka.sh\n</code></pre> 9.\u542f\u52a8zookeeper\u96c6\u7fa4\uff0czk.sh start 10.\u542f\u52a8kafka\u96c6\u7fa4\uff0ckafka.sh start</p> <p>zookeeper\u5bf9\u4e8eKafka\u7684\u4f5c\u7528 1.\u501f\u52a9Zookeeper\u5b8c\u6210Kafka\u96c6\u7fa4\u4e2d\u4e3b\u673a\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf \u642d\u5efaHadoop\u548cZookeeper\u7684\u96c6\u7fa4\u65f6\u5747\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u5176\u5b83\u4e3b\u673a\u7684\u4fe1\u606f\uff0cHadoop\u662f\u5c06\u5176\u5b83Hadoop\u4e3b\u673a\u7684ip\u5730\u5740\u914d\u7f6e\u5728etc/hadoop/workers\u6587\u4ef6\u4e2d\uff0cZookeeper\u662f\u5728conf/zoo.cfg\u6587\u4ef6\u4e2d\u914d\u7f6e\u5176\u5b83Zookeeper\u4e3b\u673a\u7684ip\u3001\u901a\u4fe1\u7aef\u53e3\u53f7\u4ee5\u53ca\u9009\u4e3e\u7aef\u53e3\u53f7\u3002\u4f46\u4ece\u4ee5\u4e0a\u6b65\u9aa4\u4e2d\u53ef\u4ee5\u770b\u5230\u642d\u5efaKafka\u96c6\u7fa4\u5e76\u4e0d\u9700\u8981\u914d\u7f6e\u5176\u5b83Kafka\u4e3b\u673a\u7684\u4fe1\u606f\uff0c\u800c\u662f\u53ea\u9700\u8981\u7ed9Kafka\u4e3b\u673a\u6307\u5b9a\u4e00\u4e2a\u5728\u96c6\u7fa4\u4e2d\u552f\u4e00\u7684id\u5373\u53ef\uff0c\u8fd9\u662f\u56e0\u4e3a\u6bcf\u53f0Kafka\u542f\u52a8\u4e4b\u540e\u90fd\u5c06\u81ea\u5df1\u7684\u4fe1\u606f\u6ce8\u518c\u5230zookeeper\u4e2d\uff08\u5728/brokers/ids\u4e0b\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u8282\u70b9\uff0c\u540d\u5b57\u5c31\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684id\uff0c\u8be5\u8282\u70b9\u91cc\u9762\u4fdd\u5b58\u7740Kafka\u4e3b\u673a\u5730\u5740\u7b49\u4fe1\u606f\uff09\uff0c\u6240\u4ee5\u5f53\u6709\u65b0\u7684Kafka\u6ce8\u518c\u5230zookeeper\u65f6\uff0c\u5176\u5b83Kafka\u4e3b\u673a\u80fd\u591f\u611f\u77e5\u5230\uff08zookeeper\u7684\u901a\u77e5\u673a\u5236\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\u53ea\u8981Kafka\u914d\u7f6e\u6587\u4ef6\u91cc\u914d\u7f6e\u8fde\u63a5\u7684zookeeper\u96c6\u7fa4\u662f\u540c\u4e00\u4e2a\uff0c\u90a3\u4e48\u8fd9\u4e9bKafka\u5b9e\u4f8b\u5c31\u5c5e\u4e8e\u540c\u4e00\u96c6\u7fa4\u3002\u539f\u672c\u5728\u96c6\u7fa4\u4e2d\u7684\u4e3b\u673a\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf \u4e0e \u5f80\u6b63\u5728\u8fd0\u884c\u7684\u96c6\u7fa4\u4e2d\u65b0\u589e\u4e3b\u673a \u662f\u4e0d\u4e00\u6837\u7684\uff08\u6bd4\u5982zookeeper\u57283.5\u4ee5\u540e\u624d\u652f\u6301\u5f80\u6b63\u5728\u8fd0\u884c\u7684\u96c6\u7fa4\u4e2d\u65b0\u589e\u4e00\u53f0\u5168\u65b0\u7684zookeeper\u8282\u70b9\uff09\uff0c\u4f46\u662f\u7531\u4e8ezookeeper\u7684\u5b58\u5728\uff0c\u4f7f\u5f97Kafka\u96c6\u7fa4\u65e0\u8bba\u662f\u54ea\u4e00\u79cd\u52a8\u6001\u7684\u6269\u5c55\u90fd\u53d8\u5f97\u975e\u5e38\u7b80\u5355\u3002</p> <p>2.\u501f\u52a9Zookeeper\u5b8c\u6210controller\u7684\u9009\u62e9 Kafka\u96c6\u7fa4\u9700\u8981\u4e00\u4e2acontroller\u6765\u4e3b\u4e8b\u5b8c\u6210\u4e00\u4e9b\u5de5\u4f5c\uff0c\u6bd4\u5982\uff0c\u5c06\u5206\u533a\u5206\u914d\u5728\u96c6\u7fa4\u7684\u4e3b\u673a\u4e0a\u3001\u5206\u533a\u526f\u672c\u4e4b\u95f4Leader\u7684\u9009\u4e3e\u7b49\u3002Kafka\u96c6\u7fa4\u7684controller\u7684\u9009\u4e3e\u4e5f\u9700\u8981\u4f9d\u8d56zookeeper\uff0c\u9009\u4e3e\u7684\u65b9\u5f0f\u5c31\u662f\u6240\u6709Kafka\u4e3b\u673a\u4e89\u62a2\u5730\u521b\u5efa\u4e34\u65f6\u8282\u70b9/controller\uff0c\u5e76\u5f80\u8fd9\u4e2a\u8282\u70b9\u91cc\u9762\u5199\u5165\u4fe1\u606f\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2aKafka\u4f1a\u521b\u5efa\u6210\u529f\uff0c\u6240\u4ee5\u4e5f\u5c31\u53ef\u4ee5\u5b8c\u6210\u9009\u4e3e\u3002</p> <p>3.\u501f\u52a9Zookeeper\u4fdd\u5b58\u96c6\u7fa4\u7684\u516c\u5171\u4fe1\u606f\uff0c\u4f7f\u5f97\u6bcf\u53f0Kafka\u4e3b\u673a\u80fd\u540c\u6b65\u83b7\u53d6\u5230\u8fd9\u4e9b\u4fe1\u606f Kafka\u4e0d\u5149\u628a\u81ea\u5df1\u7684\u6ce8\u518c\u4fe1\u606f\u5b58\u5230zookeeper\uff0c\u8fd8\u4f1a\u628atopic\u7684\u4fe1\u606f\u5b58\u5230zookeeper\uff0c\u6bd4\u5982\u6709\u591a\u5c11\u4e2atopic\uff0c\u6bcf\u4e2atopic\u6709\u591a\u5c11\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u6709\u591a\u5c11\u4e2a\u526f\u672c\uff0c\u90fd\u653e\u5728\u54ea\uff0c\u526f\u672c\u4e2d\u8c01\u662fleader\uff0c\u8c01\u662ffollower\u3002\u56e0\u4e3a\u6bcf\u4e2aKafka\u4e3b\u673a\u8bfb\u53d6\u5230\u7684topic\u4fe1\u606f\u5fc5\u987b\u76f8\u540c\uff0c\u5e76\u4e14\u6bcf\u4e2aKafka\u4e3b\u673a\u5bf9topic\u4fe1\u606f\u7684\u4fee\u6539\u5fc5\u987b\u662f\u7acb\u523b\u751f\u6548\u7684\uff0c\u4e0d\u5b58\u5728\u4fee\u6539\u5bfc\u81f4Kafka\u4e3b\u673a\u8bfb\u53d6\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u9488\u5bf9\u8fd9\u79cd\u9700\u6c42\uff0c\u5f53\u7136\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u4fe1\u606f\u5b58\u653e\u5728redis\u91cc\u9762\uff0c\u4f46zookeeper\u4e5f\u80fd\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u5e76\u4e14zookeeper\u662f\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u5bf9\u4e8e\u4fdd\u5b58\u50cftopic\u5143\u6570\u636e\u8fd9\u79cd\u5c11\u91cf\u6570\u636e\u5e76\u4e14\u5bf9\u6570\u636e\u53ef\u9760\u6027\u548c\u53ef\u7528\u6027\u8981\u6c42\u9ad8\u7684\u9700\u6c42\u5c31\u518d\u9002\u5408\u4e0d\u8fc7\u4e86\uff08zookeeper\u63d0\u4f9b\u7684\u5b58\u53d6\u6570\u636e\u7684\u670d\u52a1\uff09\u3002</p> <p>4.\u501f\u52a9Zookeeper\u5b8c\u6210\u6d88\u8d39\u8005\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf \u8fd8\u6709\u4e00\u70b9\u5c31\u662f\u6d88\u8d39\u8005\u7ec4\u7684\u4fe1\u606f\u4e5f\u662f\u4fdd\u5b58\u5728zookeeper\u91cc\u9762\u7684\uff0c\u6bd4\u5982\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u90fd\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u8282\u70b9\uff0c\u8fd9\u6837\u5f53\u6d88\u8d39\u8005\u7ec4\u91cc\u6709\u6d88\u8d39\u8005\u52a8\u6001\u4e0a\u4e0b\u7ebf\u65f6\uff0cKafka\u5c31\u80fd\u53ca\u65f6\u6536\u5230\u901a\u77e5\uff0c\u7136\u540e\u8fdb\u884cRebalance\u3002</p> <p>\u5f53\u7136\u4e0d\u6b62\u4e0a\u9762\u6240\u8bf4\u7684\u8fd9\u4e9b\uff0c\u8fd8\u6709\u5176\u5b83\u5f88\u591a\u4fe1\u606f\u90fd\u662f\u4fdd\u5b58\u5728zookeeper\u91cc\u9762\u7684\uff0c\u603b\u7684\u6765\u8bf4\u5c31\u662f\uff0czookeeper\u7684\u6570\u636e\u5b58\u50a8\u670d\u52a1\u548c\u901a\u77e5\u673a\u5236\u5bf9\u4e8e\u534f\u8c03Kafka\u96c6\u7fa4\u8d77\u5230\u4e86\u91cd\u8981\u7684\u4f5c\u7528\u3002</p> <p>zookeeper\u548cKafka\u90fd\u662f\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u6574\u4e2a\u96c6\u7fa4\u5bf9\u4e8e\u5916\u90e8\u6765\u8bf4\u662f\u4e00\u4e2a\u6574\u4f53\uff0c\u7528\u6237\u65e0\u8bba\u8fde\u63a5\u7684\u662f\u96c6\u7fa4\u4e2d\u7684\u54ea\u4e00\u53f0\u673a\u5668\uff0c\u4f7f\u7528\u7684\u90fd\u662f\u8fd9\u4e2a\u6574\u4f53\u5411\u5916\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u7528\u6237\u5e76\u4e0d\u9700\u8981\u5173\u5fc3\u8bfb\u5230\u7684\u6570\u636e\u5230\u5e95\u662f\u54ea\u4e00\u53f0\u4e3b\u673a\u8fd4\u56de\u7684\uff0c\u4e5f\u5373\u4e0d\u7528\u5173\u5fc3\u6574\u4e2a\u96c6\u7fa4\u5185\u90e8\u662f\u5982\u4f55\u534f\u8c03\u4e00\u8d77\u5de5\u4f5c\u7684\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/3-kafka%E7%9A%84shell%E5%91%BD%E4%BB%A4%20%E5%8F%8A%20Kafka%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6/","title":"3-kafka\u7684shell\u547d\u4ee4 \u53ca Kafka\u6587\u4ef6\u5b58\u50a8\u673a\u5236","text":"<p> \u7ea6 774 \u4e2a\u5b57  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 15 \u5206\u949f</p> <p>1.\u67e5\u770b\u5f53\u524d\u670d\u52a1\u5668\u4e2d\u7684\u6240\u6709 topic kafka\u6709\u5173topic\u7684\u6570\u636e\u4fe1\u606f\u662f\u5b58\u653e\u5728zookeeper\u4e2d\u7684\uff0c\u8fd9\u6837kafka\u7684\u96c6\u7fa4\u5c31\u53ef\u4ee5\u65b9\u4fbf\u540c\u6b65\u5230\u8fd9\u4e9b\u4fe1\u606f\u4e86\uff0c\u6240\u4ee5\u5728kafka-topics.sh\u7684\u53c2\u6570\u4e2d\u6307\u5b9a\u8981\u8fde\u63a5\u7684zookeeper\u7684\u5730\u5740\uff0c\u7136\u540e\u76f4\u63a5\u4ece\u8fd9\u53f0zookeeper\u4e2d\u83b7\u53d6\u5230topic\u7684\u4fe1\u606f\u3002 Text Only<pre><code>bin/kafka-topics.sh --zookeeper hadoop102:2181 --list\n</code></pre> \u4e0a\u9762kafka\u7684\u65e7\u7248\u672c\u4e2d\u7684\u547d\u4ee4\uff0c\u65b0\u7248\u672c\u867d\u7136\u8fd8\u517c\u5bb9\uff0c\u4f46\u662f\u5b98\u7f51\u4ecb\u7ecd\u8bf4\u5c06\u6765kafka\u662f\u8981\u89e3\u9664\u5bf9zookeeper\u7684\u4f9d\u8d56\u7684\uff0c\u6240\u4ee5\u4e3a\u4e86\u5e73\u6ed1\u8fc7\u6e21\uff0c\u65b0\u7248\u4f7f\u7528\u4e86\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u4e0d\u76f4\u63a5\u67e5zookeeper\uff0c\u800c\u662f\u8fde\u63a5kafka\uff0c\u8ba9Kafka\u53bbzookeeper\u4e2d\u67e5\u8be2\u6570\u636e\u7136\u540e\u8fd4\u56de\u3002 Text Only<pre><code>kafka-topics.sh --list --bootstrap-server localhost:9092\n</code></pre></p> <p>2.\u521b\u5efatopic Text Only<pre><code>kafka-topics.sh --create --topic quickstart-events\u00a0--partitions 2 --replication-factor 2 --bootstrap-server localhost:9092\n</code></pre> \u9009\u9879\u8bf4\u660e\uff1a --topic \u5b9a\u4e49 topic \u540d --partitions \u5b9a\u4e49\u5206\u533a\u6570 --replication-factor \u5b9a\u4e49\u526f\u672c\u6570 \u5206\u533a\u6570\u4efb\u610f\uff0c\u4f46\u526f\u672c\u6570\u4e0d\u80fd\u8d85\u8fc7Kafka\u96c6\u7fa4\u673a\u5668\u7684\u4e2a\u6570\u3002topic\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\uff0c\u5206\u533a\u6570\u53ef\u4ee5\u589e\u52a0\uff0c\u4f46\u662f\u4e0d\u80fd\u51cf\u5c11\uff0c\u56e0\u4e3a\u5206\u533a\u91cc\u9762\u5df2\u7ecf\u5b58\u50a8\u6570\u636e\u4e86\u3002</p> <p>3. \u5220\u9664 topic Text Only<pre><code>kafka-topics.sh --delete --topic quickstart-events\u00a0--bootstrap-server localhost:9092\n</code></pre></p> <p>4.\u67e5\u770btopic\u8be6\u60c5 Text Only<pre><code>kafka-topics.sh --describe --topic quickstart-events --bootstrap-server localhost:9092\n</code></pre></p> <p>5.\u5728Hadoop102\u4e0a\u542f\u52a8\u63a7\u5236\u53f0\u5ba2\u6237\u7aef\u751f\u4ea7\u8005 Text Only<pre><code>kafka-console-producer.sh --topic quickstart-events --bootstrap-server localhost:9092\n</code></pre></p> <p>6.\u5728Hadoop103\u3001Hadoop104\u4e0a\u542f\u52a8\u63a7\u5236\u53f0\u5ba2\u6237\u7aef\u6d88\u8d39\u8005\uff0c\u56e0\u4e3aKafka\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u5728Hadoop103\u3001Hadoop104\u4e0a\u6709\u5c5e\u4e8e\u540c\u4e00\u4e2a\u96c6\u7fa4\u7684Kafka\uff0c\u6240\u4ee5\u76f4\u63a5\u5728Hadoop103\u3001Hadoop104\u4e0a\u8fdelocalhost:9092\u6ca1\u6709\u95ee\u9898\u3002\u53ea\u8981\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u914d\u7f6e\u8fde\u63a5\u7684zookeeper\u96c6\u7fa4\u662f\u540c\u4e00\u4e2a\uff0c\u90a3\u4e48\u8fd9\u4e9bKafka\u5b9e\u4f8b\u5c31\u5c5e\u4e8e\u540c\u4e00\u96c6\u7fa4\u3002 Text Only<pre><code>kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092\n</code></pre> --from-beginning\uff1a \u4f1a\u628a\u4e3b\u9898\u4e2d\u4ee5\u5f80\u6240\u6709\u7684\u6570\u636e\u90fd\u8bfb\u53d6\u51fa\u6765\u3002 \u7b2c\u4e00\u6b21\u542f\u52a8\u6d88\u8d39\u8005\u540e\uff0cKafka\u4f1a\u521b\u5efa1\u4e2atopic\u6765\u5b58\u50a8\u6d88\u8d39\u8bfb\u53d6\u6570\u636e\u7684\u504f\u79fb\u4f4d\u7f6e\uff0c\u8fd9\u4e2atopic\u670950\u5206\u533a\uff0c\u6bcf\u4e00\u4e2a\u5206\u533a\u90fd\u53ea\u6709\u4e00\u4e2a\u526f\u672c </p> <p>Kafka\u6587\u4ef6\u5b58\u50a8\u673a\u5236\uff1a \u4e00\u4e2atopic\u5206\u4e3a\u4e00\u4e2a\u6216\u591a\u4e2a\u5206\u533a\uff0c\u4e00\u4e2a\u5206\u533a\u53c8\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u526f\u672c\uff0c\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a\u6709\u4e24\u4e2a\u5206\u533a\u548c\u4e24\u4e2a\u526f\u672c\u7684topic\uff1a Text Only<pre><code>kafka-topics.sh --create --topic quickstart-events --partitions 2 --replication-factor 2 --bootstrap-server localhost:9092\n</code></pre> \u90a3\u4e48\u5728Kafka\u96c6\u7fa4\u4e0a\u6570\u636e\u662f\u8fd9\u6837\u5b58\u50a8\u7684\uff1a Hadoop102\u4e0a\u7684/opt/module/kafka_2.13-2.8.0/data\u76ee\u5f55\uff08\u8fd9\u4e2a\u76ee\u5f55\u4e0e\u524d\u9762\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u914d\u7f6e\u7684log.dirs\u6709\u5173\uff09\uff1a  Hadoop103\u4e0a\uff1a  Hadoop104\u4e0a\uff1a  \u8fdb\u5230\u5206\u533aquickstart-events-0\u76ee\u5f55\u91cc\u9762\uff0c Kafka \u91c7\u53d6\u4e86\u5206\u7247\u548c\u7d22\u5f15\u673a\u5236\uff0c\u5c06\u6bcf\u4e2a partition \u5206\u4e3a\u591a\u4e2a segment\uff1a  \u5f53\u6570\u636e\u91cf\u5927\u8d77\u6765\u4e4b\u540e\uff0csegment\u5c31\u662f\u8fd9\u6837\u7684\u6548\u679c\uff0c\u6587\u4ef6\u540d\u7684\u6570\u5b57\u662f\u627f\u63a5\u4e0a\u4e00\u4e2a segment\u4e2d\u7684\u6700\u5927\u6d88\u606f\u6570\uff1a  \u603b\u7ed3Kafka\u6587\u4ef6\u5b58\u50a8\u673a\u5236\u5c31\u662f\uff0c\u4e3b\u9898\u5206\u533a\uff0c\u5206\u533a\u5206\u7247\uff08topic\u5206\u6210partition\uff0cpartition\u5206\u6210segment\uff09\u3002\u5199\u6570\u636e\u65f6\u91c7\u7528\u987a\u5e8f\u5199\u78c1\u76d8\u548c\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u5b9e\u73b0\u4e86\u5feb\u901f\u5199\u5165\uff1b\u8bfb\u6570\u636e\u65f6\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u5b9a\u4f4d\u6d88\u606f\u5728\u54ea\u4e00\u4e2asegment\uff0c\u7136\u540e\u5229\u7528segment\u5bf9\u5e94\u7684\u7d22\u5f15\u5c31\u80fd\u5feb\u901f\u627e\u5230\u6d88\u606f\u7684\u4f4d\u7f6e\u3002\u53e6\u5916\uff0c\u5728\u5206\u533a\u4e2d\u8fd8\u7ef4\u62a4\u7740HW\uff08High Watermark\uff0c\u9ad8\u6c34\u4f4d\uff09\u548c LEO\uff08Long End Offset\uff09\u4e24\u4e2a\u503c\uff0c\u6765\u4fdd\u8bc1\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u4e0d\u51fa\u73b0\u6570\u636e\u6df7\u4e71\u7684\u95ee\u9898\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/4-%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8CKafka%E4%B9%8B%E9%97%B4%E7%9A%84%20%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%20%E5%92%8C%20%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D/","title":"4-\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u7684 \u6d88\u606f\u4e22\u5931 \u548c \u6d88\u606f\u91cd\u590d","text":"<p> \u7ea6 1647 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 33 \u5206\u949f</p> <p>\u4fdd\u8bc1\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u6570\u636e\u7684\u53ef\u9760\u6027\u9700\u8981\u8003\u8651\u4e24\u4e2a\u95ee\u9898\uff1a\u6570\u636e\u4e22\u5931\u3001\u6570\u636e\u91cd\u590d\u3002\u6216\u8005\u79f0\u4e3a \u6d88\u606f\u4e22\u5931 \u548c \u6d88\u606f\u91cd\u590d\u3002</p> <p>\u4e3a\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0ctopic \u7684\u6bcf\u4e2a partition \u7684 Leader \u5728\u6536\u5230\u00a0producer \u53d1\u9001\u7684\u6570\u636e\u540e\uff0c\u90fd\u9700\u8981\u5411producer \u53d1\u9001ack\uff08acknowledgement\uff09 \uff0cproducer \u6536\u5230 ack\u540e\uff0c \u624d\u4f1a\u8fdb\u884c\u4e0b\u4e00\u8f6e\u7684\u53d1\u9001\uff0c\u5426\u5219\u91cd\u65b0\u53d1\u9001\u6570\u636e\u3002</p> <p>\u4e0d\u8fc7Leader \u6536\u5230\u00a0producer \u53d1\u9001\u7684\u6570\u636e\u540e\uff0c\u5e76\u4e0d\u4e00\u5b9a\u662f\u7acb\u5373\u5411producer\u53d1\u9001ack\uff0cLeader\u8fd8\u9700\u8981\u8003\u8651Follower\u540c\u6b65\u6570\u636e\u7684\u60c5\u51b5\uff0c\u56e0\u4e3aLeader\u53ef\u80fd\u4f1a\u5728\u53d1\u9001\u5b8cack\u4e4b\u540e\u7acb\u9a6c\u5c31\u6302\u6389\u4e86\uff0c\u8fd9\u65f6\u5982\u679c\u6ca1\u6709Follower\u540c\u6b65\u5b8c\u6570\u636e\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u6bd5\u7adfproducer\u5728\u6536\u5230ack\u4e4b\u540e\u5c31\u4e0d\u4f1a\u518d\u91cd\u590d\u53d1\u9001\u6570\u636e\u4e86\u3002\u6240\u4ee5Leader\u5e94\u8be5\u4f55\u65f6\u53d1\u9001ack\u6d88\u606f\u5462\uff0cKafka \u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u4e09\u79cd\u53ef\u9760\u6027\u7ea7\u522b\u7684\u7b56\u7565\uff0c\u751f\u4ea7\u8005\u914d\u7f6eacks\u53c2\u6570\u6765\u9009\u62e9\u4f7f\u7528\u54ea\u79cd\u7b56\u7565\u3002</p> <p>acks=0\uff1a producer\u4e0d\u5fc5\u7b49\u5f85 broker \u7684 ack\uff0c\u53ea\u7ba1\u53d1\u9001\u6d88\u606f\u5373\u53ef\uff0c\u663e\u7136\u8fd9\u79cd\u7b56\u7565\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u6d88\u606f\u6ca1\u80fd\u4ece\u751f\u4ea7\u8005\u53d1\u9001\u5230Leader\uff0c\u6216\u8005Follwer\u540c\u6b65\u5b8c\u6210\u4e4b\u524dLeader\u5b95\u673a\u4e22\u5931\u6570\u636e\u3002</p> <p>acks=1\uff1aleader\u63a5\u6536\u5230producer\u7684\u6570\u636e\u5e76\u4fdd\u5b58\u6210\u529f\u540e\u5c31\u4f1a\u5411producer\u53d1\u9001ack\uff0cLeader\u4e0d\u5fc5\u7b49Follower\u540c\u6b65\u6570\u636e\u5b8c\u6210\uff0c\u8fd9\u79cd\u7b56\u7565\u4e0d\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u4e22\u5931\u6570\u636e\uff0c\u4f46\u662f\u4f1a\u56e0\u4e3aFollwer\u540c\u6b65\u5b8c\u6210\u4e4b\u524dLeader\u5b95\u673a\u4e22\u5931\u6570\u636e\u3002</p> <p>acks=-1 \u6216 \"all\"\uff1a\u5982\u679c\u9009\u62e9\u7b49\u5f85\u6240\u6709Follwer\u540c\u6b65\u5b8c\u6570\u636e\u4e4b\u540e\u518d\u53d1\u9001ack\u672a\u514d\u7b49\u7684\u662f\u5c06\u592a\u957f\u4e86\uff0c\u4e8e\u662fKafka\u8ba9Leader\u7ef4\u62a4\u4e86\u4e00\u4e2a \u52a8\u6001\u7684 ISR(in-sync replica set)\u96c6\u5408\uff0cISR\u96c6\u5408\u91cc\u9762\u8bb0\u5f55\u7684\u662f\u51e0\u4e2a\u540c\u6b65\u6570\u636e\u6bd4\u8f83\u5feb\u7684Follower\uff08\u591a\u5feb\u624d\u80fd\u79f0\u4e4b\u4e3a\u5feb\uff0c\u8fd9\u4e2a\u65f6\u95f4\u9608\u503c\u7531 replica.lag.time.max.ms \u53c2\u6570\u8bbe\u5b9a\uff09\uff0c\u5f53ISR\u96c6\u5408\u91cc\u9762\u7684\u6240\u6709Follower\u90fd\u540c\u6b65\u5b8c\u6570\u636e\uff0cLeader\u624d\u5411producer\u53d1\u9001ack\u6d88\u606f\u3002ISR\u96c6\u5408\u662f\u52a8\u6001\u7684\uff0c\u5982\u679c\u67d0\u4e2aFollower\u540c\u6b65\u6570\u636e\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86\u8bbe\u5b9a\u7684\u9608\u503c\u5c31\u4f1a\u88ab\u8e22\u51faISR\u3002\u8fd9\u79cd\u7b56\u7565\u65e2\u4e0d\u4f1a\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u4e22\u5931\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3aFollwer\u540c\u6b65\u5b8c\u6210\u4e4b\u524dLeader\u5b95\u673a\u4e22\u5931\u6570\u636e\u3002\uff08ack\u89e3\u51b3\u56e0\u7f51\u7edc\u539f\u56e0\u4e22\u5931\u6570\u636e\uff0c\u526f\u672c\u89e3\u51b3\u56e0\u4e3a\u673a\u5668\u6545\u969c\u4e22\u6570\u636e\uff0c\u4e8c\u8005\u7ed3\u5408\u624d\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\uff09</p> <p>\u6240\u4ee5acks=-1\u8fd9\u79cd\u7b56\u7565\u6700\u4e3a\u53ef\u9760\uff0c\u80fd\u89e3\u51b3\u7684\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u89e3\u51b3\u6570\u636e\u91cd\u590d\u7684\u95ee\u9898\u3002acks=0\u65f6\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u91cd\u590d\u7684\u95ee\u9898\uff0c\u56e0\u4e3aproducer\u53ea\u4f1a\u53d1\u9001\u4e00\u6b21\u6d88\u606f\uff0c\u4f46\u662facks=1\u548cacks=-1\u5747\u4f1a\u51fa\u73b0\u6570\u636e\u91cd\u590d\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u5728\u8fd9\u4e24\u79cd\u7b56\u7565\u4e0b\uff0cproducer\u5747\u53ef\u80fd\u4f1a\u91cd\u590d\u53d1\u9001\u6d88\u606f\u3002 \u5f53acks=1\u65f6\uff0cleader\u53d1\u9001\u7684ack\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u4e22\u5931\uff0c\u90a3\u4e48\u6b64\u65f6producer\u4f1a\u91cd\u590d\u5411leader\u53d1\u9001\u6d88\u606f\u3002 \u5f53acks=-1\u65f6\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4producer\u91cd\u590d\u5411leader\u53d1\u9001\u6d88\u606f\u3002\u4e00\u662f\uff0cleader\u53d1\u9001\u7684ack\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u4e22\u5931\uff0c\u90a3\u4e48\u6b64\u65f6producer\u4f1a\u91cd\u590d\u5411leader\u53d1\u9001\u6d88\u606f\uff1b\u4e8c\u662f\uff0cleader\u7b49Follower\u540c\u6b65\u7684\u8fc7\u7a0b\u4e2d\uff0cleader\u6302\u4e86\uff0cFollower\u4eec\u540c\u6b65\u5230\u4e86\u90e8\u5206\u6570\u636e\u6216\u8005\u5168\u90e8\u6570\u636e\uff0c\u8fd9\u65f6producer\u4f1a\u56e0\u4e3a\u6ca1\u6709\u6536\u5230ack\u800c\u5411\u65b0\u7684leader\u91cd\u590d\u53d1\u9001\u6d88\u606f\u3002</p> <p>\u4e3a\u89e3\u51b3\u6570\u636e\u91cd\u590d\u95ee\u9898\uff0cKafka\u5f15\u5165\u4e86\u5e42\u7b49\u6027\uff0c \u542f\u7528\u5e42\u7b49\u6027\u53ea\u9700\u8981\u5c06 Producer \u7684\u53c2\u6570\u4e2d enable.idompotence \u8bbe\u7f6e\u4e3a true \u5373\u53ef\u3002 \u5f00\u542f\u5e42\u7b49\u6027\u7684 Producer \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u88ab\u5206\u914d\u4e00\u4e2a PID\uff0c\u5e76\u4e14\u4f1a\u7ed9\u6bcf\u6761\u6d88\u606f\u9644\u5e26\u4e00\u4e2a \u5355\u8c03\u9012\u589e\u7684Sequence Number\u3002Broker \u7aef\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u7ef4\u62a4\u4e00\u4e2aSeqNumber\uff0c\u53ea\u6709\u5f53\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u7684\u5e8f\u5217\u53f7\u6bd4broker\u7ef4\u62a4\u7684\u5e8f\u5217\u53f7\u59271\u65f6\uff0cbroker\u624d\u4f1a\u63a5\u6536\u5b83\uff0c\u5982\u679c\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u7684\u5e8f\u53f7\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u7ef4\u62a4\u7684SeqNumber\uff0c\u5219\u4e3a\u91cd\u590d\u6d88\u606f\uff0c\u5982\u679c\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u7684\u5e8f\u53f7\u5927\u4e8e\u5f53\u524d\u7ef4\u62a4\u7684SeqNumber+1\uff0c\u5219\u662f\u4e71\u5e8f\u6d88\u606f\uff0c\u4e2d\u95f4\u53ef\u80fd\u51fa\u73b0\u4e86\u6d88\u606f\u4e22\u5931\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u5f00\u542f\u5e42\u7b49\u540e\u5728\u5206\u533a\u5185\u4e0d\u4ec5\u53ef\u4ee5\u6d88\u606f\u53bb\u91cd\uff08\u751f\u4ea7\u8005\u867d\u7136\u4f1a\u5f80\u4e0d\u540c\u7684\u5206\u533a\u53d1\u9001\u6d88\u606f\uff0c\u4f46\u662f\u91cd\u53d1\u7684\u6d88\u606f\u4e00\u5b9a\u662f\u53d1\u5230\u540c\u4e00\u4e2a\u5206\u533a\u7684\uff09\uff0c\u800c\u4e14\u8fd8\u53ef\u4ee5\u4fdd\u6301\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\u3002PID\u662f\u751f\u4ea7\u8005\u548cKafka\u4e00\u6b21\u4f1a\u8bdd\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u6240\u4ee5\u5982\u679c\u751f\u4ea7\u8005\u65ad\u5f00\u8fde\u63a5\u540e\u91cd\u8fdeKafka\u4f1a\u518d\u6b21\u751f\u6210\u4e00\u4e2a\u65b0\u7684PID\uff0c\u8fd9\u65f6\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u5c31\u4e0e\u4e0a\u6b21\u4f1a\u8bdd\u53d1\u9001\u7684\u6d88\u606f\u5c31\u6ca1\u6709\u91cd\u590d\u7684\u5173\u7cfb\u4e86\u3002 <p>\u4ee5\u4e0a\u662fKafka\u89e3\u51b3\u4e0e\u751f\u4ea7\u8005\u4e4b\u95f4\u7684\u6570\u636e\u4e22\u5931\u548c\u6570\u636e\u91cd\u590d\u95ee\u9898\u7684\u5177\u4f53\u63aa\u65bd\u3002\u4f46\u662f\u7531\u4e8e \u751f\u4ea7\u8005\u751f\u4ea7\u6d88\u606f \u548c \u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f \u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u662f\u5f02\u6b65\u7684\uff0c\u6240\u4ee5Kafka\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u4e5f\u4f1a\u5b58\u5728\u7740\u95ee\u9898\u3002\u5373\uff0c\u5f53Follower\u6b63\u5728\u540c\u6b65Leader\u6570\u636e\u65f6\uff0cLeader\u6302\u4e86\uff0c\u8fd9\u65f6Follower\u4eec\u53ea\u540c\u6b65\u5230\u4e86\u90e8\u5206\u6570\u636e\u6216\u8005\u5168\u90e8\u6570\u636e\uff0c\u6211\u4eec\u77e5\u9053\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0c\u751f\u4ea7\u8005\u4f1a\u91cd\u590d\u53d1\u9001\u6d88\u606f\uff0c\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4f46\u662f\u8fd9\u662f\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u7684\u95ee\u9898\uff0c\u5728\u4e0a\u9762\u5df2\u7ecf\u89e3\u51b3\uff0c\u6211\u4eec\u8981\u8c08\u7684\u662f\u6b64\u65f6Follower\u91cd\u65b0\u9009\u4e3e\u51faLeader\u4e4b\u540e\uff0c\u6d88\u8d39\u8be5\u5982\u4f55\u6d88\u8d39\u65b0Leader\u4e2d\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u8fd9\u65f6\u65b0Leader\u4e2d\u7684\u6570\u636e\u4e0e\u539fLeader\u4e2d\u7684\u6570\u636e\u5e76\u4e0d\u662f\u4e00\u81f4\u7684\uff0c\u8981\u7b49\u5230\u751f\u4ea7\u8005\u91cd\u590d\u53d1\u9001\u6d88\u606f\u4e4b\u540e\u624d\u4f1a\u5230\u8fbe\u4e00\u81f4\uff0c\u4f46\u5728\u751f\u4ea7\u8005\u91cd\u590d\u53d1\u9001\u6d88\u606f\u4e4b\u524d\uff0c\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u8bf7\u6c42\u5e76\u6ca1\u6709\u505c\u6b62\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u6d88\u8d39\u8005\u5728\u539fLeader\uff08\u4e0b\u56fe\u7b2c\u4e00\u4e2a\uff09\u4e2d\u5df2\u7ecf\u6d88\u8d39\u523018\u53f7\u6570\u636e\u4e86\uff0c\u4f46\u662f\u73b0\u5728\u7684\u65b0Leader\uff08\u4e0b\u56fe\u7b2c\u4e09\u4e2a\uff09\u5e76\u6ca1\u670918\u53ca\u4e4b\u540e\u7684\u6570\u636e\uff0c\u53ef\u80fd\u6700\u591a\u4e5f\u5c31\u53ea\u670915\u53f7\u6570\u636e\uff0c\u8fd9\u65f6\u5c31\u6709\u95ee\u9898\u4e86\u3002\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0cKafka\u5f15\u5165\u4e86HW\uff08High Watermark\uff0c\u9ad8\u6c34\u4f4d\uff09\u7684\u6982\u5ff5\uff0cHigh Watermark\u5c31\u662f\u6240\u6709\u526f\u672c\u4e2d\u6570\u636e\u7684\u6700\u5c0f\u5e8f\u53f7\uff0c\u53ea\u6709High Watermark\u53ca\u4e4b\u524d\u7684\u6570\u636e\u5bf9\u6d88\u8d39\u8005\u53ef\u89c1\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e0d\u51fa\u4e0a\u9762\u7684\u60c5\u51b5\u4e86\uff0c\u8fd8\u6709\u4e00\u4e2a\u6982\u5ff5\u5c31\u662fLEO\uff08Long End Offset\uff09\uff0c\u6307\u7684\u662f\u6bcf\u4e2a\u526f\u672c\u6570\u636e\u4e2d\u7684\u6700\u5927\u5e8f\u53f7\uff0c\u5f53\u65b0Leader\u4ea7\u751f\u4e4b\u540e\uff0cLeader\u548cFollower\u4f1a\u9996\u5148\u540c\u6b65\u5230\u6700\u5927\u7684LEO\u5904\uff0c\u7136\u540e\u518d\u5411\u751f\u4ea7\u8005\u53d1\u9001ack\uff0c\u4ee5\u514d\u8ba9\u751f\u4ea7\u8005\u91cd\u590d\u53d1\u9001\u592a\u591a\u6570\u636e\uff08\u548ctcp\u7684ack\u7c7b\u4f3c\uff09\u3002 </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/5-%E7%94%9F%E4%BA%A7%E8%80%85%E7%9A%84%E5%88%86%E5%8C%BA%E7%AD%96%E7%95%A5%20%E5%8F%8A%20%E7%94%9F%E4%BA%A7%E8%80%85API/","title":"5-\u751f\u4ea7\u8005\u7684\u5206\u533a\u7b56\u7565 \u53ca \u751f\u4ea7\u8005API","text":"<p> \u7ea6 1785 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 36 \u5206\u949f</p> <p>\u6d88\u606f\u53d1\u9001\u6d41\u7a0b\uff1a Kafka \u7684 Producer \u53d1\u9001\u6d88\u606f\u91c7\u7528\u7684\u662f\u5f02\u6b65\u53d1\u9001\u7684\u65b9\u5f0f\u3002\u5728\u6d88\u606f\u53d1\u9001\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6d89\u53ca\u5230\u4e86\u4e24\u4e2a\u7ebf\u7a0b\u2014\u2014main \u7ebf\u7a0b\u548c Sender \u7ebf\u7a0b\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7ebf\u7a0b\u5171\u4eab\u53d8\u91cf\u2014\u2014RecordAccumulator\u3002main \u7ebf\u7a0b\u5c06\u6d88\u606f\u53d1\u9001\u7ed9 RecordAccumulator\uff0c Sender \u7ebf\u7a0b\u4e0d\u65ad\u4ece RecordAccumulator \u4e2d\u62c9\u53d6\u6d88\u606f\u53d1\u9001\u5230 Kafka broker\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a  \u5728main\u7ebf\u7a0b\u4e2d\uff0c\u6d88\u606f\u7684\u53d1\u9001\u9700\u8981\u7ecf\u8fc7\u62e6\u622a\u5668\u3001\u5e8f\u5217\u5316\u5668\u3001\u5206\u533a\u5668\u624d\u4f1a\u8fdb\u5165RecordAccumulator\u3002 \u5206\u533a\u5668\u662f\u7528\u6765\u51b3\u5b9a\u5c06\u6d88\u606f\u53d1\u9001\u5230\u54ea\u4e2a\u5206\u533a\u7684\uff0c\u5728\u53d1\u9001\u6d88\u606f\u65f6\u9700\u8981\u5c06\u6570\u636e\u5c01\u88c5\u6210\u4e00\u4e2a ProducerRecord \u5bf9\u8c61\uff0cKafka\u4e2d\u63d0\u4f9b\u7684\u9ed8\u8ba4\u5206\u533a\u5668\u662fDefaultPartitioner\uff0c\u5b83\u5b9e\u73b0\u4e86Partitioner\u63a5\u53e3\uff0cDefaultPartitioner\u4f1a\u6839\u636enew\u00a0ProducerRecord\u5bf9\u8c61\u65f6\u6307\u5b9a\u7684\u53c2\u6570\u6765\u51b3\u5b9a\uff0c \u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a  \uff081\uff09\u6307\u660e partition \u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u5c06\u6307\u660e\u7684\u503c\u76f4\u63a5\u4f5c\u4e3a partiton \u503c\u3002 \uff082\uff09\u6ca1\u6709\u6307\u660e partition \u503c\u4f46\u6709 key \u7684\u60c5\u51b5\u4e0b\uff0c\u5c06 key \u7684 hash \u503c\u4e0e topic \u7684 partition \u6570\u8fdb\u884c\u53d6\u4f59\u5f97\u5230 partition \u503c\uff0c\u8be5\u65b9\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u5177\u6709\u76f8\u540ckey\u7684\u6d88\u606f\u8fdb\u5165\u5230\u540c\u4e00\u4e2a\u5206\u533a\u3002 \uff083\uff09\u65e2\u6ca1\u6709 partition \u503c\u53c8\u6ca1\u6709 key \u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c06\u8fde\u7eed\u7684\u6d88\u606f\u53d1\u9001\u7ed9\u4e00\u4e2a\u5206\u533a\uff0c\u7136\u540e\u518d\u5c06\u4e0b\u4e00\u6ce2\u8fde\u7eed\u6d88\u606f\u53d1\u9001\u7ed9\u4e0b\u4e00\u4e2a\u5206\u533a\u3002\u63a7\u5236\u53f0\u5ba2\u6237\u7aef\u751f\u4ea7\u8005\u5c31\u662f\u8fd9\u79cd\u7b56\u7565\uff0c\u56e0\u4e3a\u63a7\u5236\u53f0\u751f\u4ea7\u8005\u53ea\u80fd\u63d0\u4f9bvalue\u3002 \uff084\uff09\u7528\u6237\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5206\u533a\u7b56\u7565\u3002</p> <p>\u751f\u4ea7\u8005\u4ee3\u7801\u6d4b\u8bd5\uff0c\u5f00\u542f\u4e24\u4e2a\u5c5e\u4e8e\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u7684\u63a7\u5236\u53f0\u5ba2\u6237\u7aef\u6d88\u8d39\u8005\uff0c\u89c2\u5bdf\u6253\u5370\u7ed3\u679c\u3002 1.\u5bfc\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;2.8.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;1.7.30&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>2. \u4e0d\u5e26\u56de\u8c03\u51fd\u6570\u7684 API KafkaProducer\uff1a\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u751f\u4ea7\u8005\u5bf9\u8c61\uff0c\u7528\u6765\u53d1\u9001\u6570\u636e ProducerConfig\uff1a\u83b7\u53d6\u6240\u9700\u7684\u4e00\u7cfb\u5217\u914d\u7f6e\u53c2\u6570 \u00a0\u00a0 \u00a0\u76f8\u5173\u53c2\u6570\uff1a \u00a0 \u00a0 batch.size\uff1a \u53ea\u6709\u6570\u636e\u79ef\u7d2f\u5230 batch.size \u4e4b\u540e\uff0c sender \u624d\u4f1a\u53d1\u9001\u6570\u636e\u3002 \u00a0\u00a0 \u00a0linger.ms\uff1a \u5982\u679c\u6570\u636e\u8fdf\u8fdf\u672a\u8fbe\u5230 batch.size\uff0c sender \u7b49\u5f85 linger.time \u4e4b\u540e\u5c31\u4f1a\u53d1\u9001\u6570\u636e\u3002 ProducerRecord\uff1a\u6bcf\u6761\u6570\u636e\u90fd\u8981\u5c01\u88c5\u6210\u4e00\u4e2a ProducerRecord \u5bf9\u8c61 Text Only<pre><code>public class ProducerTest {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0////kafka\u96c6\u7fa4\u8fde\u63a5\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0 \u00a0 \u00a0 \u00a0\u00a0//\u6d88\u606f\u53d1\u9001\u5931\u8d25\u540e\u91cd\u53d1\u6d88\u606f\u7684\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.RETRIES_CONFIG, 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//acks\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.ACKS_CONFIG, \"all\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53ea\u6709\u6570\u636e\u79ef\u7d2f\u5230 batch.size \u4e4b\u540e\uff0c sender \u624d\u4f1a\u53d1\u9001\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);//16KB\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u6570\u636e\u8fdf\u8fdf\u672a\u8fbe\u5230 batch.size\uff0c sender \u7b49\u5f85 linger.time \u4e4b\u540e\u4e5f\u4f1a\u53d1\u9001\u6570\u636e\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.LINGER_MS_CONFIG, 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//RecordAccumulator \u7f13\u51b2\u533a\u5927\u5c0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);//32Mb\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u751f\u4ea7\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53d1\u9001\u6d88\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 100; i++) {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 //\u65e2\u6ca1\u6709 partition \u503c\u53c8\u6ca1\u6709 key \u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c06\u8fde\u7eed\u7684\u6d88\u606f\u53d1\u9001\u7ed9\u4e00\u4e2a\u5206\u533a\uff0c\u518d\u8fd0\u884c\u5219\u4f1a\u5c06\u4e0b\u4e00\u6ce2\u8fde\u7eed\u6d88\u606f\u53d1\u9001\u7ed9\u4e0b\u4e00\u4e2a\u5206\u533a\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0//producer.send(new ProducerRecord&lt;&gt;(\"test-group\", Integer.toString(i)));\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0//\u6ca1\u6709\u6307\u660e partition \u503c\u4f46\u6709 key \u7684\u60c5\u51b5\u4e0b\uff0c\u5c06 key \u7684 hash \u503c\u4e0e topic \u7684 partition \u6570\u8fdb\u884c\u53d6\u4f59\u5f97\u5230 partition \u503c\uff0c\u8fd9\u91cckey\u662f\u9012\u589e\u7684\uff0c\u6240\u4ee5\u4f1a\u8f6e\u6d41\u5730\u53d1\u5f80\u6bcf\u4e00\u4e2a\u5206\u533a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.send(new ProducerRecord&lt;&gt;(\"test-group\", Integer.toString(i), Integer.toString(i)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>3. \u5e26\u56de\u8c03\u51fd\u6570\u7684 API \u56de\u8c03\u51fd\u6570\u4f1a\u5728 producer \u6536\u5230 ack \u65f6\u8c03\u7528\uff0c\u4e3a\u5f02\u6b65\u8c03\u7528\uff0c \u8be5\u65b9\u6cd5\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662fRecordMetadata \u548c Exception\uff0c\u5982\u679c Exception \u4e3a null\uff0c\u8bf4\u660e\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0c\u5982\u679cException \u4e0d\u4e3a null\uff0c\u8bf4\u660e\u6d88\u606f\u53d1\u9001\u5931\u8d25\u3002 \u6ce8\u610f\uff1a\u8bbe\u7f6eacks=1\u6216-1\u65f6\uff0c\u6d88\u606f\u53d1\u9001\u5931\u8d25\u4f1a\u81ea\u52a8\u91cd\u8bd5\uff0c\u4e0d\u9700\u8981\u6211\u4eec\u5728\u56de\u8c03\u51fd\u6570\u4e2d\u624b\u52a8\u91cd\u8bd5\u3002 Text Only<pre><code>public class CallbackProducer {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0////kafka\u96c6\u7fa4\u8fde\u63a5\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6d88\u606f\u53d1\u9001\u5931\u8d25\u540e\u91cd\u53d1\u6d88\u606f\u7684\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.RETRIES_CONFIG, 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//acks\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.ACKS_CONFIG, \"all\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u751f\u4ea7\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53d1\u9001\u6d88\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 100; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.send(new ProducerRecord&lt;&gt;(\"test-group\", Integer.toString(i)), (metadata, exception) -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (exception != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"send fail\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"send success\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"topic: \" + metadata.topic());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"partition: \" + metadata.partition());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"offset: \" + metadata.offset());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>4. \u540c\u6b65\u53d1\u9001 \u540c\u6b65\u53d1\u9001\u7684\u610f\u601d\u5c31\u662f\uff0c\u4e00\u6761\u6d88\u606f\u53d1\u9001\u4e4b\u540e\uff0c\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c \u76f4\u81f3\u8fd4\u56de ack\u3002\u7531\u4e8e send \u65b9\u6cd5\u8fd4\u56de\u7684\u662f\u4e00\u4e2a Future \u5bf9\u8c61\uff0c\u6839\u636e Futrue \u5bf9\u8c61\u7684\u7279\u70b9\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u540c\u6b65\u53d1\u9001\u7684\u6548\u679c\uff0c\u53ea\u9700\u5728\u8c03\u7528 Future \u5bf9\u8c61\u7684 get \u65b9\u53d1\u5373\u53ef\u3002 Text Only<pre><code>public class SyncSend {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws ExecutionException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0////kafka\u96c6\u7fa4\u8fde\u63a5\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6d88\u606f\u53d1\u9001\u5931\u8d25\u540e\u91cd\u53d1\u6d88\u606f\u7684\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.RETRIES_CONFIG, 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//acks\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.ACKS_CONFIG, \"all\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u751f\u4ea7\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53d1\u9001\u6d88\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 100; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.send(new ProducerRecord&lt;&gt;(\"test-group\", Integer.toString(i), Integer.toString(i)))`.get();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5982\u4f55\u4fdd\u6301\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\uff1f \u6211\u4eec\u77e5\u9053\u6d88\u606f\u53ea\u5728\u4e00\u4e2a\u5206\u533a\u5185\u662f\u6709\u5e8f\u7684\uff0c\u5982\u679c\u4e00\u4e2atopic\u6709\u591a\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u6240\u6709\u6d88\u606f\u5728\u6574\u4e2atopic\u5168\u5c40\u662f\u65e0\u5e8f\u7684\uff0c\u6240\u4ee5\u8981\u60f3\u4fdd\u6301\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\uff0ctopic\u5c31\u5fc5\u987b\u53ea\u80fd\u6709\u4e00\u4e2a\u5206\u533a\uff0c\u4e0d\u8fc7\u5373\u4f7ftopic\u53ea\u6709\u4e00\u4e2a\u5206\u533a\u4e5f\u4e0d\u80fd\u5b8c\u5168\u4fdd\u6301\u6d88\u8d39\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\u6027\uff0c\u56e0\u4e3a\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u662f\u5f02\u6b65\u7684\uff0c\u5e76\u4e0d\u4f1a\u6bcf\u6b21\u90fd\u7b49\u5f85\u4e0a\u4e00\u6b21\u6d88\u606f\u53d1\u9001\u6210\u529f\u5e76\u6536\u5230\u8fd4\u56de\u7684ack\u4e4b\u540e\u518d\u53d1\u9001\u4e0b\u4e00\u6761\u6d88\u606f\uff0c\u6bd4\u5982\u51fa\u73b01\u30012\u30013\u53f7\u6d88\u606f\u6309\u5e8f\u53d1\u9001\u5230\u53ea\u6709\u4e00\u4e2a\u5206\u533a\u7684topic\uff0c\u4f46\u662f\u7531\u4e8e1\u53f7\u6d88\u606f\u53d1\u9001\u8fc7\u7a0b\u4e2d\u4e22\u5931\u4e86\uff0c\u53ea\u80fd\u91cd\u53d11\u53f7\u6d88\u606f\uff0c\u5bfc\u81f4\u6700\u7ec8Kafka\u6536\u5230\u6d88\u606f\u7684\u987a\u5e8f\u662f2\u30013\u30011\u3002\u5982\u679c\u60f3\u8981\u5728\u6d88\u606f\u961f\u5217\u4e2d\u4fdd\u6301\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f\uff0c\u67093\u79cd\u529e\u6cd5\uff0c\u5f53\u71363\u79cd\u529e\u6cd5\u7684\u524d\u63d0\u90fd\u662ftopic\u53ea\u80fd\u6709\u4e00\u4e2a\u5206\u533a\uff1a</p> <ol> <li>\u5f00\u542f\u5e42\u7b49\uff0cKafka\u7684\u5e42\u7b49\u6027\u4f1a\u4fdd\u8bc1\u4e00\u4e2a\u5206\u533a\u5185\u6d88\u606f\u4e0d\u91cd\u590d\uff0c\u548c\u4fdd\u6301\u6d88\u8d39\u8005\u53d1\u9001\u6d88\u606f\u7684\u987a\u5e8f</li> <li>\u4f7f\u7528\u4ee5\u4e0a\u540c\u6b65\u53d1\u9001\u6d88\u606f\u7684\u65b9\u5f0f</li> <li>\u8bbe\u7f6e\u751f\u4ea7\u8005\u53c2\u6570max.in.flight.requests.per.connection=1\uff0c\u6b64\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5728\u751f\u4ea7\u8005\u6536\u5230\u670d\u52a1\u5668\u53d1\u9001\u8fc7\u6765\u7684ack\u4e4b\u524d\u80fd\u53d1\u9001\u591a\u5c11\u6761\u6d88\u606f\uff0c\u8bbe\u7f6e\u53c2\u6570\u503c\u4e3a1\u5c31\u548c\u4e0a\u9762\u540c\u6b65\u53d1\u9001\u6d88\u606f\u4e00\u6837\u4e86\u3002</li> </ol> <p>5.\u81ea\u5b9a\u4e49\u5206\u533a\u7b56\u7565 \uff081\uff09\u5b9e\u73b0Partitioner\u63a5\u53e3\uff0cconfigure()\u5728\u5206\u533a\u5668\u7b2c\u4e00\u6b21\u4f7f\u7528\u65f6\u6267\u884c\uff0c\u5e76\u4e14\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff1bpartition()\u65b9\u6cd5\u4f1a\u5728\u751f\u4ea7\u8005\u53d1\u9001\u6bcf\u4e00\u6761\u6570\u636e\u65f6\u6267\u884c\uff0cclose()\u65b9\u6cd5\u4f1a\u5728\u751f\u4ea7\u8005\u8c03\u7528producer.close()\u65f6\u6267\u884c\uff0cproducer.close()\u4e0d\u4ec5\u4f1a\u6267\u884c\u6240\u6709\u5206\u533a\u5668\u7684close\u65b9\u6cd5\uff0c\u8fd8\u4f1a\u6267\u884c\u6240\u6709\u62e6\u622a\u5668\u7684close\u65b9\u6cd5\u3002 Text Only<pre><code>public class MyPartition implements Partitioner {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 1;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() {}\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void configure(Map&lt;String, ?&gt; configs) {}\n}\n</code></pre> \uff082\uff09\u5728\u751f\u4ea7\u8005\u7684\u914d\u7f6e\u4fe1\u606f\u4e2d\u6307\u5b9a\u5206\u533a\u5668 Text Only<pre><code>public class Producer {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0////kafka\u96c6\u7fa4\u8fde\u63a5\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5f00\u542f\u5e42\u7b49\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `//\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u5206\u533a\u5668`\n `properties.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, \"producer.partition.MyPartition\");`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u751f\u4ea7\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0org.apache.kafka.clients.producer.Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53d1\u9001\u6d88\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 100; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.send(new ProducerRecord&lt;&gt;(\"test-group\", Integer.toString(i), Integer.toString(i)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/6-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8B%A6%E6%88%AA%E5%99%A8/","title":"6-\u81ea\u5b9a\u4e49\u751f\u4ea7\u8005\u53d1\u9001\u6570\u636e\u7684\u62e6\u622a\u5668","text":"<p> \u7ea6 500 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>\u751f\u4ea7\u8005\u53d1\u9001\u6570\u636e\u7684\u62e6\u622a\u5668\u5728\u5206\u533a\u5668\u4e4b\u524d\u8c03\u7528\uff0c\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u5b9e\u73b0ProducerInterceptor\u63a5\u53e3\uff0cconfigure()\u5728\u5206\u533a\u5668\u7b2c\u4e00\u6b21\u4f7f\u7528\u65f6\u6267\u884c\uff0c\u5e76\u4e14\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff1bclose()\u65b9\u6cd5\u4f1a\u5728\u751f\u4ea7\u8005\u8c03\u7528producer.close()\u65f6\u6267\u884c\uff0cproducer.close()\u4e0d\u4ec5\u4f1a\u6267\u884c\u6240\u6709\u62e6\u622a\u5668\u7684close\u65b9\u6cd5\uff0c\u8fd8\u4f1a\u6267\u884c\u6240\u6709\u5206\u533a\u5668\u7684close\u65b9\u6cd5\uff1b \u751f\u4ea7\u8005\u6bcf\u53d1\u9001\u4e00\u6761\u6570\u636e\u65f6\u90fd\u4f1a\u6267\u884conSend()\u65b9\u6cd5\u548conAcknowledgement()\u65b9\u6cd5\u3002 \u62e6\u622a\u5668\u6848\u4f8b\uff1a \u5728\u6d88\u606f\u53d1\u9001\u524d\u5c06\u65f6\u95f4\u6233\u4fe1\u606f\u52a0\u5230\u6d88\u606f value \u7684\u6700\u524d\u90e8\uff0c\u5728\u6d88\u606f\u53d1\u9001\u540e\u66f4\u65b0\u6210\u529f\u53d1\u9001\u6d88\u606f\u6570\u548c\u5931\u8d25\u53d1\u9001\u6d88\u606f\u6570\u3002 1.\u62e6\u622a\u5668\u4ee3\u7801\uff1a Text Only<pre><code>public class TimeAndCountInterceptor implements ProducerInterceptor {\n\u00a0\u00a0\u00a0\u00a0private int success = 0;\n\u00a0\u00a0\u00a0\u00a0private int error = 0;\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u8be5\u65b9\u6cd5\u4f1a\u5728\u53d1\u9001\u6bcf\u4e00\u6761\u6d88\u606f\u65f6\uff0c\u5e8f\u5217\u5316\u5668 \u548c \u5206\u533a\u5668 \u6267\u884c\u4e4b\u524d\u6267\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public ProducerRecord onSend(ProducerRecord record) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ProducerRecord(record.topic(), record.partition(), record.key(), System.currentTimeMillis() + \": \" + record.value());\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u8be5\u65b9\u6cd5\u4f1a\u5728\u53d1\u9001\u6bcf\u4e00\u6761\u6d88\u606f\u6210\u529f\u540e\uff0c\u5373\u751f\u4ea7\u8005\u6536\u5230Kafka\u53d1\u9001\u7684acknowledge\u4e4b\u540e\uff0csend()\u65b9\u6cd5\u91cc\u7684\u56de\u8c03\u51fd\u6570\u6267\u884c\u4e4b\u524d\u6267\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void onAcknowledgement(RecordMetadata metadata, Exception exception) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0success++;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0error++;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u8be5\u65b9\u6cd5\u4f1a\u5728\u751f\u4ea7\u8005\u8c03\u7528close\u65b9\u6cd5\u65f6\u6267\u884c\uff0c\u6240\u4ee5\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u6210\u529f\u53d1\u9001\" + success + \"\u6761\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u53d1\u9001\u5931\u8d25\" + error + \"\u6761\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0* \u8be5\u65b9\u6cd5\u4f1a\u5728\u8fd9\u4e2a\u62e6\u622a\u5668\u7b2c\u4e00\u6b21\u8c03\u7528\u65f6\u6267\u884c\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u4f7f\u7528\u521b\u5efa\u751f\u4ea7\u8005\u65f6\u914d\u7f6e\u7684\u914d\u7f6e\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void configure(Map&lt;String, ?&gt; configs) {\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.\u751f\u4ea7\u8005\u914d\u7f6e\u4fe1\u606f\u4e2d\u6307\u5b9a\u62e6\u622a\u5668\u7684\u5168\u7c7b\u540d Text Only<pre><code>public class Producer {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties properties = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0////kafka\u96c6\u7fa4\u8fde\u63a5\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5f00\u542f\u5e42\u7b49\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u62e6\u622a\u5668`\n `ArrayList&lt;String&gt; interceptors = new ArrayList&lt;&gt;();`\n `interceptors.add(\"producer.interceptor.TimeAndCountInterceptor\");`\n `properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG, interceptors);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringSerializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u751f\u4ea7\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0org.apache.kafka.clients.producer.Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u53d1\u9001\u6d88\u606f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 100; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.send(new ProducerRecord&lt;&gt;(\"test-group\", Integer.toString(i), Integer.toString(i)));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0producer.close();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/7-%E6%B6%88%E8%B4%B9%E8%80%85%E7%BB%84%E7%9A%84offset%20%E5%92%8C%20%E6%B6%88%E8%B4%B9%E8%80%85%E7%BB%84%E7%9A%84%E5%88%86%E5%8C%BA%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/","title":"7-\u6d88\u8d39\u8005\u7ec4\u7684offset \u548c \u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565","text":"<p> \u7ea6 1630 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 33 \u5206\u949f</p> <p>\u4e3a\u4ec0\u4e48\u8bf4\u6d88\u606f\u662f\u4ee5\u6d88\u8d39\u8005\u7ec4\u4e3a\u5355\u4f4d\u8fdb\u884c\u6d88\u8d39\u7684\uff08\u5f53\u6ca1\u6709\u6307\u5b9a\u4e00\u4e2a\u6d88\u8d39\u8005\u5c5e\u4e8e\u54ea\u4e2a\u7ec4\u65f6\uff0cKafka\u4f1a\u9ed8\u8ba4\u7ed9\u5b83\u5206\u914d\u4e00\u4e2a\u7ec4\uff0c\u8fd9\u4e2a\u7ec4\u91cc\u5c31\u5b83\u4e00\u4e2a\u6d88\u8d39\u8005\uff09\uff1f \u56e0\u4e3a\u4e0d\u5141\u8bb8\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u7684\u4e0d\u540c\u6d88\u8d39\u8005\u6d88\u8d39\u4e00\u4e2a\u6d88\u606f\u4e24\u6b21\uff0c\u6240\u4ee5\u6574\u4e2a\u6d88\u8d39\u8005\u7ec4\u5728\u903b\u8f91\u4e0a\u89c6\u4e3a\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u4e5f\u5c31\u662f\u8bf4\u6d88\u606f\u662f\u4ee5\u6d88\u8d39\u8005\u7ec4\u4e3a\u5355\u4f4d\u8fdb\u884c\u6d88\u8d39\u7684\u3002\u8fd9\u5f88\u5408\u7406\uff0c \u56e0\u4e3a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u5e94\u8be5\u662f\u6574\u4e2a\u5fae\u670d\u52a1\u67b6\u6784\u91cc\u9762\u7684\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u591a\u4e2a\u5b9e\u4f53\uff08\u6574\u591a\u4e2a\u5b9e\u4f53\u662f\u4e3a\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\uff09\uff0c\u8fd9\u591a\u4e2a\u5b9e\u4f53\u4e4b\u95f4\u4e0d\u80fd\u51fa\u73b0\u91cd\u590d\u6d88\u8d39\u6d88\u606f\u7684\u60c5\u51b5\u3002</p> <p>\u6d88\u8d39\u8005\u7ec4\u7684offset \u56e0\u4e3a\u4e0d\u5141\u8bb8\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u7684\u4e0d\u540c\u6d88\u8d39\u8005\u6d88\u8d39\u4e00\u4e2a\u6d88\u606f\u4e24\u6b21\uff0c\u6240\u4ee5\u6574\u4e2a\u6d88\u8d39\u8005\u7ec4\u5728\u903b\u8f91\u4e0a\u89c6\u4e3a\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u4e5f\u5c31\u662f\u8bf4\u6d88\u606f\u662f\u4ee5\u6d88\u8d39\u8005\u7ec4\u4e3a\u5355\u4f4d\u8fdb\u884c\u6d88\u8d39\u7684\uff1b\u53c8\u56e0\u4e3a\u6d88\u8d39\u8005\u7ec4\u662f\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u6d88\u8d39topic\u7684\u6d88\u606f\uff0c\u800c\u4e14\u4e00\u4e2a\u5206\u533a\u53ef\u4ee5\u88ab\u4e0d\u540c\u7684\u6d88\u8d39\u8005\u7ec4\u6d88\u8d39\uff0c\u6240\u4ee5Kafka\u5fc5\u987b\u4e3a\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u8bb0\u5f55\u4e00\u4e2a\u5728\u6b64\u5206\u533a\u6d88\u8d39\u7684\u4f4d\u7f6eoffset\u3002\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684consumer-group-id\uff0c\u4e8e\u662f\u4f7f\u7528\u4f5c\u4e3akey\u662f\u5177\u6709\u552f\u4e00\u6027\u7684\uff0cvalue\u5c31\u662foffset\u7684\u503c\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5206\u533a\u91cc\u7684\u6bcf\u4e00\u4e2a\u6d88\u606f\u90fd\u6709\u4e00\u4e2a\u504f\u79fb\u91cf\uff0c\u4ece0\u5f00\u59cb\uff0coffset\u6b63\u662f\u8bb0\u5f55\u7684\u8fd9\u4e2a\u503c\u3002  <p>\u4e3a\u4ec0\u4e48\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u7684\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u6d88\u8d39\u8005\u4e0d\u80fd\u540c\u65f6\u6d88\u8d39\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\uff1f \u56e0\u4e3aoffset\u662f\u4ee5\u6d88\u8d39\u8005\u4e3a\u5355\u4f4d\u8fdb\u884c\u7ef4\u62a4\u7684\uff0c\u800c\u4e0d\u662f\u4ee5\u5355\u4e2a\u6d88\u8d39\u8005\u4e3a\u5355\u4f4d\uff0c\u6bd4\u5982\u8bf4\u5982\u679c\u6709A\u3001B\u4e24\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\uff08\u8fd9\u91cc\u5e76\u6ca1\u6709\u91cd\u590d\u6d88\u606f\u7684\u60c5\u51b5\uff09\uff0cA\u6d88\u8d39\u8005\u6d88\u8d39\u8fd9\u4e2a\u5206\u533a\u76841\u30012\u30013\u53f7\u6d88\u606f\uff0cB\u6d88\u8d39\u8005\u6d88\u8d39\u8fd9\u4e2a\u5206\u533a\u76844\u30015\u30016\u53f7\u6d88\u606f\uff0c\u7136\u540eB\u6d88\u8d39\u8005\u5148\u63d0\u4ea4\u4fee\u6539offset\u4e3a6\uff0c\u63a5\u7740A\u6d88\u8d39\u8005\u63d0\u4ea4\u4fee\u6539offset\u4e3a3\uff0c\u90a3\u4e48\u5c31\u51fa\u73b0\u95ee\u9898\u4e86\uff0c\u8fd9\u4e0e\u591a\u7ebf\u7a0b\u4fee\u6539\u540c\u4e00\u4e2a\u53d8\u91cf\u7c7b\u4f3c\u3002</p> <p>\u4ee5\u4e0a\u8bf4\u660e\u4e86\u4e3a\u4ec0\u4e48\u8981\u4ee5\u6d88\u8d39\u8005\u7ec4\u4e3a\u5355\u4f4d\u6d88\u8d39\u6d88\u606f\uff0c\u548c\u4e3a\u4ec0\u4e48\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u4e0d\u80fd\u6709\u591a\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\u6d88\u606f\u3002\u90a3\u5177\u4f53\u8be5\u5982\u4f55\u628a\u5206\u533a\u5206\u914d\u7ed9\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u5462\uff0c\u8fd9\u5c31\u662f\u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565\u8981\u8ba8\u8bba\u7684\u95ee\u9898\u3002Kafka\u63d0\u4f9b\u4e86\u4e09\u79cd\u5206\u914d\u7b56\u7565\uff1a</p> <ul> <li>RangeAssignor</li> <li>RoundRobinAssignor</li> <li>StickyAssignor</li> </ul> <p>\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u00a0RangeAssignor\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u00a0partition.assignment.strategy\u00a0\u6765\u6539\u53d8\u6d88\u8d39\u7ec4\u7684\u5206\u533a\u7b56\u7565\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5206\u533a\u5206\u914d\u7b56\u7565\uff0c\u53ea\u9700\u8981\u7ee7\u627f\u00a0AbstractPartitionAssignor\u00a0\u62bd\u8c61\u7c7b\u5373\u53ef\u3002</p> <p>RoundRobinAssignor\uff1a \u628atopic\u7684\u5206\u533a\u8f6e\u6d41\u5730\u5206\u914d\u7ed9\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\uff0c\u6b64\u79cd\u5206\u914d\u65b9\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u5206\u5f97\u5206\u533a\u6700\u591a\u7684\u6d88\u8d39\u8005\u548c\u5206\u5f97\u5206\u533a\u6700\u5c11\u7684\u6d88\u8d39\u8005\u53ea\u5dee\u4e00\u4e2a\u5206\u533a\uff0c\u8fd9\u6837\u5f88\u5747\u5300\uff0c\u4f46\u662f\u8fd9\u6837\u4e0d\u80fd\u5b9e\u73b0\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u8ba2\u9605\u4e0d\u540c\u7684topic\uff08\u6211\u4e5f\u641e\u4e0d\u61c2\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u4e3a\u4ec0\u4e48\u8981\u8ba2\u9605\u4e0d\u540c\u7684topic\uff0c\u8fd9\u4e0e\u6211\u4e0a\u9762\u7684\u7406\u89e3\u76f8\u6096\uff0c\u60f3\u8ba2\u9605\u4e0d\u540c\u7684topic\uff0c\u4f60\u5c31\u4e0d\u5e94\u8be5\u653e\u5728\u540c\u4e00\u7ec4\u91cc\uff09\u3002 </p> <p>RangeAssignor\uff1a Range\u5206\u914d\u65b9\u5f0f\u53ef\u4ee5\u5b9e\u73b0\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u8ba2\u9605\u4e0d\u540c\u7684topic\uff0c\u6bd4\u5982A\u3001B\u6d88\u8d39\u8005\u8ba2\u9605Topic-A\uff0c\u90a3\u5c31\u628aTopic-A\u7684\u5206\u533a\u9664\u4ee52\uff0c\u524d\u4e00\u534a\u5206\u7ed9A\u6d88\u8d39\u8005\uff0c\u540e\u4e00\u534a\u5206\u7ed9B\u6d88\u8d39\u8005\uff1bB\u3001C\u6d88\u8d39\u8005\u8ba2\u9605Topic-B\uff0c\u540c\u6837\u4e5f\u662f\u628aTopic-B\u7684\u5206\u533a\u9664\u4ee52\uff0c\u524d\u4e00\u534a\u5206\u7ed9B\u6d88\u8d39\u8005\uff0c\u540e\u4e00\u534a\u5206\u7ed9C\u6d88\u8d39\u8005\u3002\u8fd9\u6837\u5206\u5c31\u4e0d\u662f\u5f88\u5747\u5300\u4e86\uff0c\u5206\u5f97\u5206\u533a\u6700\u591a\u7684\u6d88\u8d39\u8005\u548c\u5206\u5f97\u5206\u533a\u6700\u5c11\u7684\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u76f8\u5dee\u5f88\u591a\uff0c\u5176\u5b9e\u8f6e\u6d41\u5206\u4e5f\u76f8\u5f53\u4e8e\u662f\u9664\u4ee5\u6d88\u8d39\u8005\u4e2a\u6570\uff0c\u8fd9\u91cc\u5206\u5f97\u4e0d\u5747\u5300\u7684\u6839\u672c\u95ee\u9898\u5728\u4e8e\u6309topic\u5206\u3002\uff08\u4e0b\u9762\u51fa\u73b0\u4e86\u4e00\u4e2a\u6d88\u8d39\u8005\u8ba2\u9605\u540c\u4e00\u4e2atopic\u7684\u591a\u4e2a\u5206\u533a\uff0c\u8fd9\u662f\u5141\u8bb8\u7684\uff0c\u5e76\u6ca1\u6709\u51fa\u73b0\u4e00\u4e2a\u5206\u533a\u88ab\u540c\u4e00\u7ec4\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u8ba2\u9605\uff09 </p> <p>\u51fa\u73b0\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\u90fd\u4f1a\u542f\u7528\u5206\u914d\u7b56\u7565\u91cd\u65b0\u5206\u914d\u5206\u533a\uff08Rebalance\uff09\uff1a 1.\u6709\u65b0\u7684\u6d88\u8d39\u8005\u52a0\u5165\u6d88\u8d39\u8005\u7ec4 2.\u6709\u6d88\u8d39\u8005\u9000\u51fa\u6d88\u8d39\u8005\u7ec4 3.topic\u65b0\u589e\u5206\u533a</p> <p>\u6d88\u8d39\u8005\u7ec4\u6d4b\u8bd5\u6848\u4f8b\uff0c\u9a8c\u8bc1\uff1a a.\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u7684\u6d88\u8d39\u8005\u53ea\u80fd\u8ba2\u9605\u540c\u4e00\u4e2atopic\u7684\u4e0d\u540c\u5206\u533a\uff0c\u5982\u679c\u6709\u6d88\u8d39\u8005\u52a0\u5165\u6216\u9000\u51fa\u6d88\u8d39\u8005\u7ec4\u5c31\u4f1a\u5f15\u8d77\u5206\u533a\u91cd\u65b0\u5206\u914d\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6bcf\u4e00\u4f4d\u6d88\u8d39\u8005\u3002 b.\u5982\u679c\u6574\u4e2a\u6d88\u8d39\u8005\u7ec4\u4e0b\u7ebf\u4e86\uff0c\u5f53\u8fd9\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u67d0\u4e00\u4f4d\u6d88\u8d39\u8005\u4e0a\u7ebf\u65f6\uff0c\u4f1a\u63a5\u7740\u4ece\u4e0a\u6b21\u6d88\u8d39\u7684\u4f4d\u7f6e\u7ee7\u7eed\u6d88\u8d39  1.\u5728 hadoop103\u3001 hadoop104 \u4e0a\u4fee\u6539 /opt/module/kafka_2.13-2.8.0/config/consumer.properties \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u7ec4\u540d\u00a0group.id Text Only<pre><code>group.id=AAA\n</code></pre> 2.\u521b\u5efa\u4e00\u4e2a\u4e24\u4e2a\u5206\u533a\u7684topic Text Only<pre><code>kafka-topics.sh --create --topic test-group --partitions 2 --bootstrap-server localhost:9092\n</code></pre> 3. \u5728 hadoop103\u3001 hadoop104 \u4e0a\u5206\u522b\u542f\u52a8\u6d88\u8d39\u8005 Text Only<pre><code>kafka-console-consumer.sh --topic test-group --consumer.config /opt/module/kafka_2.13-2.8.0/config/consumer.properties --bootstrap-server localhost:9092\n</code></pre> 4. \u5728 hadoop102 \u4e0a\u542f\u52a8\u751f\u4ea7\u8005 Text Only<pre><code>kafka-console-producer.sh --topic test-group --bootstrap-server localhost:9092\n</code></pre> 5.\u5982\u679c\u8fd9\u65f6\u518d\u5f00\u4e00\u4e2a\u6d88\u8d39\u8005\u52a0\u5165\u5230AAA\u7ec4\uff0c\u5c31\u4f1a\u5f15\u8d77\u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\uff0c\u6548\u679c\u5c31\u662f\u4e4b\u524d\u7684\u67d0\u4e00\u4e2a\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u88ab\u6324\u4e0b\u53bb\uff0c\u88ab\u6324\u4e0b\u53bb\u7684\u6d88\u8d39\u8005\u5c31\u662f\u6ca1\u6709\u5206\u914d\u5230\u5206\u533a\u7684\uff0c\u4e0d\u8fc7\u4e5f\u6709\u53ef\u80fd\u4e4b\u524d\u7684\u6d88\u8d39\u8005\u90fd\u6ca1\u6709\u88ab\u6324\u4e0b\u53bb\uff0c\u8fd9\u65f6\u5c31\u662f\u65b0\u52a0\u5165\u7684\u6d88\u8d39\u8005\u6ca1\u6709\u5206\u914d\u5230\u5206\u533a\u3002\u6ca1\u6709\u5206\u914d\u5230\u5206\u533a\u7684\u6d88\u8d39\u8005\u662f\u63a5\u6536\u4e0d\u5230\u6d88\u606f\u7684\u3002 6.\u5173\u95ed\u6240\u6709\u6d88\u8d39\u8005\uff0c\u751f\u4ea7\u8005\u7ee7\u7eed\u53d1\u9001\u6d88\u606f\uff0c\u8fd9\u65f6\u518d\u542f\u52a8AAA\u6d88\u8d39\u8005\u7ec4\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u6d88\u8d39\u8005\u4f1a\u4ece\u4e0a\u6b21\u6d88\u8d39\u7684\u4f4d\u7f6e\u7ee7\u7eed\u6d88\u8d39\uff0c\u4e5f\u5c31\u662f\u4f1a\u6d88\u8d39\u6d88\u8d39\u8005\u7ec4\u4e0b\u7ebf\u671f\u95f4\u751f\u4ea7\u8005\u751f\u4ea7\u7684\u6d88\u606f\uff0c\u5982\u679c\u518d\u542f\u52a8AAA\u6d88\u8d39\u8005\u7ec4\u7684\u53e6\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u5219\u4e0d\u4f1a\u6d88\u8d39\u6d88\u8d39\u8005\u7ec4\u4e0b\u7ebf\u671f\u95f4\u751f\u4ea7\u8005\u751f\u4ea7\u7684\u6d88\u606f\uff0c\u56e0\u4e3a\u6d88\u8d39\u8005\u7ec4\u7684\u524d\u4e00\u4e2a\u6d88\u8d39\u8005\u5df2\u7ecf\u628a\u8fd9\u4e9b\u6d88\u606f\u6d88\u8d39\u4e86\uff0c\u5e76\u4e14\u6539\u53d8\u5e76\u63d0\u4ea4\u4e86offset\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/8-%E6%B6%88%E8%B4%B9%E8%80%85%E6%8F%90%E4%BA%A4offset%20%E5%8F%8A%20%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%20%E6%B6%88%E8%B4%B9%E4%B8%A2%E5%A4%B1%20%E5%92%8C%20%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%20%E9%97%AE%E9%A2%98/","title":"8-\u6d88\u8d39\u8005\u63d0\u4ea4offset \u53ca \u6d88\u8d39\u8005\u7684 \u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39 \u95ee\u9898","text":"<p> \u7ea6 2357 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 47 \u5206\u949f</p> <p>\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u53ea\u80fd\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u4e00\u4e2a\u5206\u533a\uff0c\u4e0d\u80fd\u6709\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u4e00\u4e2a\u5206\u533a\uff0c\u6240\u4ee5broker\u662f\u4ee5&lt;\u6d88\u8d39\u8005\u7ec4id\uff0c topic\uff0cpartition&gt;\u4f5c\u4e3akey\u6765\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u5728\u6b64\u5206\u533a\u4e0a\u7684\u6d88\u8d39\u4f4d\u7f6eoffset\u7684\uff0c\u8fd9\u80fd\u4fdd\u8bc1\u6574\u4e2a\u6d88\u8d39\u8005\u7ec4\u4e0b\u7ebf\u518d\u4e0a\u7ebf\u540e\u80fd\u63a5\u7740\u7ee7\u7eed\u6d88\u8d39\u3002\u65e2\u7136offset\u8bb0\u5f55\u7684\u662f\u6d88\u8d39\u8005\u6d88\u8d39\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48offset\u503c\u5e94\u8be5\u662f\u7531\u6d88\u8d39\u8005\u6765\u4fee\u6539\uff0cbroker\u53ea\u8d1f\u8d23\u4fdd\u5b58offset\u7684\u503c\uff0c\u7b49\u5230\u4e0b\u6b21\u6d88\u8d39\u8005\u7ec4\u518d\u6b21\u4e0a\u7ebf\u65f6\uff0c\u7531\u6d88\u8d39\u8005\u8bfb\u53d6offset\u503c\uff0c\u63a5\u7740\u7ee7\u7eed\u4e0a\u6b21\u7684\u4f4d\u7f6e\u6d88\u8d39\u3002 \u6d88\u8d39\u8005\u7ec4\u4e0a\u7ebf\u65f6\u5148\u8bfb\u53d6offset\u7684\u503c\uff0c\u4ee5\u540e\u6bcf\u6210\u529f\u6d88\u8d39\u4e00\u6761\u6d88\u8d39\u5c31\u5c06\u672c\u5730\u5185\u5b58\u7ef4\u62a4\u7684offset\u52a01\uff0c\u7136\u540e\u9694\u6bb5\u65f6\u95f4\u63d0\u4ea4offset\u503c\u7ed9broker\uff0c\u7531broker\u6765\u6301\u4e45\u5316\u5730\u4fdd\u5b58offset\u503c\u3002\u90a3\u5230\u5e95\u4f55\u65f6\u63d0\u4ea4offset\u7ed9broker\uff0c\u9694\u6bb5\u65f6\u95f4\u5230\u5e95\u9694\u7684\u662f\u591a\u4e45\u5462\uff1fKafka\u63d0\u4f9b\u597d\u51e0\u79cd\u53ef\u4f9b\u9009\u62e9\u7684\u7b56\u7565\u3002</p> <p>1.\u81ea\u52a8\u63d0\u4ea4offset \u4e3a\u4e86\u4f7f\u6211\u4eec\u80fd\u591f\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c Kafka \u63d0\u4f9b\u4e86\u81ea\u52a8\u63d0\u4ea4 offset \u7684\u529f\u80fd\u3002\u81ea\u52a8\u63d0\u4ea4 offset \u7684\u76f8\u5173\u53c2\u6570\uff1a</p> <ul> <li>enable.auto.commit\uff1a \u662f\u5426\u5f00\u542f\u81ea\u52a8\u63d0\u4ea4 offset \u529f\u80fd</li> <li>auto.commit.interval.ms\uff1a \u81ea\u52a8\u63d0\u4ea4 offset \u7684\u65f6\u95f4\u95f4\u9694</li> </ul> <p>Text Only<pre><code>public class AutoCommitTest {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties props = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u6d88\u8d39\u8005\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.GROUP_ID_CONFIG, \"AAA\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5f00\u542f\u81ea\u52a8\u63d0\u4ea4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"true\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u81ea\u52a8\u63d0\u4ea4\u7684\u65f6\u95f4\u95f4\u9694\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, \"1000\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u53cd\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u53cd\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8ba2\u9605\u4e3b\u9898\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0consumer.subscribe(List.of(\"test-group\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u62c9\u53d6\u6d88\u606f\uff0c\u53c2\u6570\u662f\u6bcf\u6b21\u62c9\u53d6\u6d88\u606f\u7684\u65f6\u95f4\u95f4\u9694\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConsumerRecord&lt;String, String&gt; record : records)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u5982\u679c\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\uff0c\u5e76\u4e14\u4e0d\u4f7f\u7528\u624b\u52a8\u63d0\u4ea4\uff0c\u90a3\u4e48\u6d88\u8d39\u8005\u5c31\u4e0d\u4f1a\u63d0\u4ea4offset\uff0c\u4e8e\u662f\u6bcf\u6b21\u91cd\u542f\u4e0a\u9762\u8fd9\u4e2a\u6d88\u8d39\u8005\u90fd\u4f1a\u91cd\u65b0\u8bfb\u53d6\u4e00\u6b21\u4e4b\u524d\u5df2\u7ecf\u6d88\u8d39\u8fc7\u7684\u6d88\u606f\u3002</p> <p>2. \u624b\u52a8\u63d0\u4ea4 offset</p> <p>\u6d88\u8d39\u8005\u7684 \u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39 \u95ee\u9898 \u81ea\u52a8\u63d0\u4ea4\u7684\u65f6\u95f4\u95f4\u9694\u8bbe\u7f6e\u7684\u592a\u77ed\u548c\u592a\u957f\u90fd\u4f1a\u6709\u95ee\u9898\u3002\u8bbe\u7f6e\u5f97\u592a\u77ed\uff0c\u4f1a\u9020\u6210\u6d88\u8d39\u8005\u8fd8\u6ca1\u6709\u6d88\u8d39\u5b8c\u8fd9\u6279\u6570\u636e\u65f6\u5c31\u63d0\u524d\u63d0\u4ea4\uff0c\u5982\u679c\u8fd9\u65f6\u6d88\u8d39\u8005\u6302\u6389\u4e86\uff0c\u91cd\u542f\u540e\u5c31\u4e0d\u4f1a\u7ee7\u7eed\u6d88\u8d39\u4e0a\u6b21\u8fd8\u6ca1\u6709\u6d88\u8d39\u5b8c\u7684\u6570\u636e\uff0c\u800c\u76f4\u63a5\u6d88\u8d39\u4e0b\u4e00\u6279\u6570\u636e\uff0c\u9020\u6210\u6d88\u8d39\u8005\u6d88\u606f\u4e22\u5931\u7684\u95ee\u9898\uff08\u6216\u8005\u79f0\u4e3a\u6570\u636e\u6f0f\u6d88\u8d39\u3001\u6d88\u8d39\u4e22\u5931\uff09\u3002\u8bbe\u7f6e\u5f97\u592a\u957f\uff0c\u4f1a\u9020\u6210\u6d88\u8d39\u8005\u5df2\u7ecf\u6d88\u8d39\u5b8c\u8fd9\u6279\u6570\u636e\uff0c\u4f46\u662f\u5374\u8fdf\u8fdf\u6ca1\u6709\u63d0\u4ea4\uff0c\u5982\u679c\u8fd9\u65f6\u6d88\u8d39\u8005\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u91cd\u542f\u4e4b\u540e\u6d88\u8d39\u8005\u4f1a\u5c06\u4e0a\u6b21\u5df2\u7ecf\u6d88\u8d39\u4e86\u7684\u6570\u636e\u518d\u6b21\u91cd\u65b0\u6d88\u8d39\u4e00\u6b21\uff0c\u8fd9\u5c31\u662f\u91cd\u590d\u6d88\u8d39\u95ee\u9898\u3002 \u6240\u4ee5\u81ea\u52a8\u63d0\u4ea4\u7684\u65f6\u95f4\u95f4\u9694\u5e76\u4e0d\u597d\u628a\u63e1\uff0c\u4e8e\u662fKafka\u6d88\u8d39\u8005\u5ba2\u6237\u7aef\u8fd8\u63d0\u4f9b\u4e86\u624b\u52a8\u63d0\u4ea4offset\u7684\u65b9\u5f0f\uff0c\u624b\u52a8\u63d0\u4ea4\u5206\u4e3a\u540c\u6b65\u63d0\u4ea4\u548c\u5f02\u6b65\u63d0\u4ea4\u4e24\u79cd\u65b9\u5f0f\u3002\u540c\u6b65\u63d0\u4ea4\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u76f4\u5230\u8fd9\u6279\u6570\u636e\u7684offset\u63d0\u4ea4\u6210\u529f\u4e4b\u540e\uff0c\u624d\u4f1a\u62c9\u53d6\u4e0b\u4e00\u6279\u6570\u636e\uff1b\u5f02\u6b65\u63d0\u4ea4\u65b0\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u63d0\u4ea4offset\uff0c\u4e3b\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u662f\u76f4\u63a5\u518d\u8fdb\u884c\u4e0b\u4e00\u6b21\u6570\u636e\u7684\u62c9\u53d6\u3002\u4e5f\u5e76\u4e0d\u662f\u8bf4\u624b\u52a8\u63d0\u4ea4\u7684\u4e24\u79cd\u65b9\u5f0f\u4e0d\u4f1a\u51fa\u73b0\u6d88\u8d39\u4e22\u5931\u548c\u91cd\u590d\u6d88\u8d39\u4e24\u4e2a\u95ee\u9898\u3002\u53ea\u662f\u624b\u52a8\u63d0\u4ea4\u65b9\u5f0f\u6bd4\u8d77\u81ea\u52a8\u63d0\u4ea4\u65b9\u5f0f\u66f4\u52a0\u53ef\u63a7\u3002 \u5728\u624b\u52a8\u63d0\u4ea4\u65b9\u5f0f\u4e2d\uff0c\u5982\u679c\u5148\u63d0\u4ea4 offset \u540e\u6d88\u8d39\uff0c\u53ef\u80fd\u9020\u6210\u6d88\u8d39\u4e22\u5931\u95ee\u9898\uff1b\u5982\u679c\u5148\u6d88\u8d39\u540e\u63d0\u4ea4 offset\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u91cd\u590d\u6d88\u8d39\u95ee\u9898\u3002</p> <p>2.1 \u540c\u6b65\u63d0\u4ea4 \u624b\u52a8\u63d0\u4ea4\u4e4b\u524d\u9700\u8981\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4 Text Only<pre><code>public class SyncCommit {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties props = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u6d88\u8d39\u8005\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.GROUP_ID_CONFIG, \"AAA\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4`\n `props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8ba2\u9605\u4e3b\u9898\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0consumer.subscribe(List.of(\"test-group\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u62c9\u53d6\u6d88\u606f\uff0c\u53c2\u6570\u662f\u6bcf\u6b21\u62c9\u53d6\u6d88\u606f\u7684\u65f6\u95f4\u95f4\u9694\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConsumerRecord&lt;String, String&gt; record : records){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 `//\u540c\u6b65\u63d0\u4ea4`\n `consumer.commitSync();`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.2\u5f02\u6b65\u63d0\u4ea4 \u540c\u6b65\u63d0\u4ea4\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u5f02\u6b65\u63d0\u4ea4\u4f1a\u65b0\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u63d0\u4ea4\uff0c\u6240\u4ee5\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u6545\u800c\u5f02\u6b65\u63d0\u4ea4\u7684\u541e\u5410\u91cf\u8981\u9ad8\u4e8e\u56fe\u540c\u6b65\u63d0\u4ea4\u65b9\u5f0f\u3002 Text Only<pre><code>public class AsyncCommit {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties props = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u6d88\u8d39\u8005\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.GROUP_ID_CONFIG, \"AAA\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4`\n `props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8ba2\u9605\u4e3b\u9898\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0consumer.subscribe(List.of(\"test-group\"));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u62c9\u53d6\u6d88\u606f\uff0c\u53c2\u6570\u662f\u6bcf\u6b21\u62c9\u53d6\u6d88\u606f\u7684\u65f6\u95f4\u95f4\u9694\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConsumerRecord&lt;String, String&gt; record : records){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`//\u5f02\u6b65\u63d0\u4ea4`\n `consumer.commitAsync((offsets, exception) -&gt; {`\n `if (exception != null) {`\n `System.out.println(\"\u63d0\u4ef7\u5931\u8d25\");`\n `exception.printStackTrace();`\n `}`\n `});`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> ~~\u548cJS\u4ee5\u53ca\u5176\u5b83\u6240\u6709\u7684\u5f02\u6b65\u7f16\u7a0b\u65b9\u5f0f\u4e00\u6837\uff0c~~\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u53bb\u5e72\u6d3b\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\u5728\u6536\u5230\u670d\u52a1\u5668\u5931\u8d25\u6216\u8005\u6210\u529f\u6d88\u606f\u4e4b\u540e\u624d\u4f1a\u8c03\u7528\uff0c\u5e76\u4e14\u8fd9\u4e2a\u56de\u8c03\u5e94\u8be5\u662f\u5728\u8fd9\u4e2a\u65b0\u7684\u5e72\u6d3b\u7684\u7ebf\u7a0b\u91cc\u88ab\u8c03\u7528\u6267\u884c\u3002</p> <p>3. \u81ea\u5b9a\u4e49\u5b58\u50a8 offset \u4ee5\u4e0a\u7684\u63d0\u4ea4\u65b9\u5f0f\u90fd\u662f\u628aoffset\u5b58\u5230Kafka\u4e2d\uff0c\u5176\u5b9e\u5728 Kafka 0.9 \u7248\u672c\u4e4b\u524d\uff0c offset \u662f\u5b58\u50a8\u5728 zookeeper\u4e2d\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4offset\u5b58\u50a8\u4f4d\u7f6e\u5e76\u4e0d\u662f\u4e00\u5b9a\u975e\u5f97\u5b58\u50a8\u5728Kafka\u91cc\u9762\uff0cKafka\u4e5f\u53ef\u4ee5\u8ba9\u7528\u6237\u81ea\u5b9a\u4e49offset\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u6bd4\u5982\u5c06offset\u5b58\u50a8\u5728Mysql\u4e2d\uff0c\u8fd9\u6837\u6d88\u8d39\u6570\u636e\u7684\u8fc7\u7a0b\u548c\u63d0\u4ea4offset\u7684\u8fc7\u7a0b\u5c31\u80fd\u653e\u5728\u4e00\u4e2a\u4e8b\u52a1\u91cc\u9762\u8fdb\u884c\u4e86\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e0d\u51fa\u73b0\u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39\u95ee\u9898\u3002 \u4f46\u662f\u81ea\u5b9a\u4e49\u5b58\u50a8offset\u9700\u8981\u81ea\u5df1\u5199\u8bfb\u53d6\u548c\u63d0\u4ea4offset\u7684\u4ee3\u7801\uff0c\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u8bfb\u53d6offset\u7684\u4ee3\u7801\u662f\u56e0\u4e3a\u5728\u6d88\u8d39\u8005\u7ec4\u5206\u533a\u5206\u914d\u65f6\uff08Rebalance\uff09\uff0c\u6d88\u8d39\u8005\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u4f1a\u91cd\u65b0\u5206\u914d\u65b0\u7684\u5206\u533a\uff0c\u90a3\u4e48\u6b64\u65f6\u6bcf\u4e2a\u6d88\u8d39\u8005\u5c31\u9700\u8981\u91cd\u65b0\u8bfb\u53d6\u6d88\u8d39\u8005\u7ec4\u5728\u8be5\u5206\u533a\u7684\u6d88\u8d39\u4f4d\u7f6e\uff0c\u53c8\u56e0\u4e3a\u81ea\u5b9a\u4e49\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u6240\u4ee5\u8bfb\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\u5c31\u5fc5\u987b\u81ea\u5df1\u5b9e\u73b0\uff0c\u5982\u679c\u4e0d\u81ea\u5b9a\u4e49\uff0c\u90a3\u4e48Kafka\u5df2\u7ecf\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u5373\u4eceKafka\u90a3\u91cc\u8bfb\u53d6offset\uff1b\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u63d0\u4ea4offset\u7684\u4ee3\u7801\u662f\u56e0\u4e3a\u5b58\u50a8\u65b9\u5f0f\u662f\u81ea\u5b9a\u4e49\u7684\uff0c\u6240\u4ee5\u5c06offset\u5199\u5165\u8fc7\u7a0b\u5fc5\u987b\u7531\u7528\u6237\u81ea\u5df1\u5b9e\u73b0\u3002 \u56e0\u4e3a\u8bfb\u53d6offset\u662f\u53d1\u751f\u5728Rebalance\u65f6\uff0c\u800cRebalance\u7684\u8fc7\u7a0b\u662f\u7531Kafka\u63a7\u5236\u7684\uff0c\u6240\u4ee5\u5f53Rebalance\u5b8c\u6210\u65f6\u5e94\u8be5\u7531Kafka\u6765\u901a\u77e5\u6d88\u8d39\u8005\u91cd\u65b0\u8bfb\u53d6offset\uff0c\u5e76\u4e14\u5728\u901a\u77e5\u65f6\u9644\u5e26\u4e0a\u5206\u914d\u5f97\u5230\u7684\u5206\u533a\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7&lt;\u6d88\u8d39\u8005\u7ec4\uff0ctopic\uff0c\u5206\u533a&gt;\u8fd9\u4e2a\u552f\u4e00\u6807\u8bc6\u53bb\u6307\u5b9a\u5b58\u50a8\u4ecb\u8d28\u91cc\u9762\u53d6offset\u7684\u503c\u4e86\u3002\u6bd4\u5982\u5c06offset\u4fdd\u5b58\u5728MySQL\u4e2d\uff0c\u90a3\u4e48\u8868\u7684\u5217\u5e94\u8be5\u662f\u3010\u6d88\u8d39\u8005\u7ec4\uff0ctopic\uff0c\u5206\u533a\uff0coffset\u3011\u3002 Text Only<pre><code>public class CustomCommit {\n\u00a0\u00a0\u00a0\u00a0//\u5728\u672c\u5730\u7ef4\u62a4\u7684offset\n\u00a0\u00a0\u00a0\u00a0private static Map&lt;TopicPartition, Long&gt; currentOffset = new HashMap&lt;&gt;();\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Properties props = new Properties();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"Hadoop102:9092,Hadoop103:9092,Hadoop104:9092\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8bbe\u7f6e\u6d88\u8d39\u8005\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.GROUP_ID_CONFIG, \"AAA\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316key\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6307\u660e\u5e8f\u5217\u5316value\u7684\u7c7b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, \"org.apache.kafka.common.serialization.StringDeserializer\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Consumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8ba2\u9605\u4e3b\u9898\uff0c\u81ea\u5b9a\u4e49RebalanceListener\uff0c\u8be5\u76d1\u542c\u5668\u7684\u65b9\u6cd5\u4f1a\u5728Rebalance\u4e4b\u540e\u6267\u884c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0consumer.subscribe(List.of(\"test-group\"), new ConsumerRebalanceListener() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u8be5\u65b9\u6cd5\u4f1a\u5728\u53d1\u751fRebalance\uff0c\u5e76\u5728Rebalance\u5f00\u59cb\u4e4b\u524d\u90a3\u4e2a\u65f6\u95f4\u70b9\u6267\u884c\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u4e5f\u5c31\u662f\u4f1a\u5728consumer\u5173\u95ed\uff08\u6d88\u8d39\u8005\u9000\u51fa\u6d88\u8d39\u8005\u7ec4\uff09\u65f6\uff0c\u6216\u8005\u662f\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u6709\u6d88\u8d39\u8005\u53d6\u6d88\u8ba2\u9605\u4e3b\u9898\u65f6\u88ab\u8c03\u7528\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u5e94\u8be5\u653e\u63d0\u4ea4offset\u5230\u81ea\u5b9a\u4e49\u5b58\u50a8\u4ecb\u8d28\u7684\u4ee3\u7801\uff0c\u4ee5\u514d\u53d1\u751f\u91cd\u590d\u6d88\u8d39\u7684\u95ee\u9898\u3002\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void onPartitionsRevoked(Collection&lt;TopicPartition&gt; partitions) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0commitOffset(currentOffset);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u4f1a\u5728Rebalance\u5b8c\u6210\u65f6\u6267\u884c\uff0c\u6240\u4ee5\u8fd9\u91cc\u9762\u5e94\u8be5\u653e\u4ece\u81ea\u5b9a\u4e49\u5b58\u50a8\u4ecb\u8d28\u91cc\u9762\u8bfb\u53d6offset\u7684\u4ee3\u7801\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void onPartitionsAssigned(Collection&lt;TopicPartition&gt; partitions) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7b2c\u4e00\u6b65\uff0c\u5148\u6e05\u7a7a\u672c\u5730\u7ef4\u62a4\u7684offset\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0currentOffset.clear();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (TopicPartition partition : partitions) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u7b2c\u4e8c\u6b65\uff0cgetOffset()\u83b7\u53d6\u8be5\u6d88\u8d39\u8005\u5206\u914d\u5f97\u5230\u7684\u6bcf\u4e2a\u5206\u533a\u7684offset\uff0c\u7136\u540e\u544a\u8bc9\u8fd9\u4e2a\u6d88\u8d39\u8005\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0consumer.seek(partition, getOffset(partition));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u62c9\u53d6\u6d88\u606f\uff0c\u53c2\u6570\u662f\u6bcf\u6b21\u62c9\u53d6\u6d88\u606f\u7684\u65f6\u95f4\u95f4\u9694\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (ConsumerRecord&lt;String, String&gt; record : records){\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6d88\u8d39\u8005\u6bcf\u6d88\u8d39\u5b8c\u4e00\u6761\u6570\u636e\u5c31\u66f4\u65b0\u4e00\u4e0b\u672c\u5730\u7ef4\u62a4\u7684offset\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0currentOffset.put(new TopicPartition(record.topic(), record.partition()), record.offset());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6d88\u8d39\u5b8c\u8fd9\u4e00\u6279\u6570\u636e\u540e\u5c31\u53ef\u4ee5\u63d0\u4ea4\u4e00\u6b21offset\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u6bcf\u6d88\u8d39\u5b8c\u4e00\u6761\u6570\u636e\u540e\u5c31\u63d0\u4ea4\uff0c\u4f46\u662f\u90a3\u6837\u6548\u7387\u6709\u70b9\u4f4e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0commitOffset(currentOffset);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u4ece\u81ea\u5b9a\u4e49\u5b58\u50a8\u4ecb\u8d28\u91cc\u9762\u8bfb\u53d6\u67d0\u4e2a\u5206\u533a\u7684offset\u5e76\u4fdd\u5b58\u5230\u672c\u5730\u7ef4\u62a4\u7684offset\u4e2d\n\u00a0\u00a0\u00a0\u00a0private static long getOffset(TopicPartition partition) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return 0;\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u63d0\u4ea4\u8be5\u6d88\u8d39\u8005\u6240\u6709\u5206\u533a\u7684 offset\uff0c\u628a\u672c\u5730\u7ef4\u62a4\u7684offset\uff08\u5373currentOffset\uff09\u5168\u90e8\u63d0\u4ea4\u8fc7\u53bb\n\u00a0\u00a0\u00a0\u00a0private static void commitOffset(Map&lt;TopicPartition, Long&gt; currentOffset) {\n\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Kafka/9-Flume%20%E4%B8%8E%20Kafka%20%E5%AF%B9%E6%8E%A5/","title":"9-Flume \u4e0e Kafka \u5bf9\u63a5","text":"<p> \u7ea6 370 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 7 \u5206\u949f</p> <p> Flume \u4e0e Kafka \u5bf9\u63a5\uff1a\u5728Kafka\u4e0a\u521b\u5efa\u4e24\u4e2atopic\uff0c\u5b9e\u73b0\u7aef\u53e3\u6570\u636e\u4e2d\u5305\u542bhello\u7684\u8fdb\u5165topic-a\uff0c\u4e0d\u5305\u542bhello\u7684\u8fdb\u5165topic-b\uff0c\u7136\u540e\u542f\u52a8\u4e24\u4e2a\u6d88\u8d39\u8005\u5206\u522b\u6d88\u8d39topic-a \u548c topic-b\u7684\u6570\u636e\u3002 \u5b9e\u73b0\u601d\u8def\uff1aKafka sink\u5c31\u662fKafka\u7684\u751f\u4ea7\u8005\uff0c\u8be5\u751f\u4ea7\u8005\u4f1a\u5bf9flume event\u7684\u5934\u8fdb\u884c\u68c0\u67e5\uff0c\u6839\u636eevent head\u4e2d\u7684topic\u5c5e\u6027\u7684\u503c\u5c06\u6d88\u606f\u53d1\u9001\u5230\u76f8\u5e94\u7684topic\u3002 1.\u8981\u60f3\u5b9e\u73b0\u5728event \u5934\u91cc\u9762\u8bbe\u7f6e\u5c5e\u6027\uff0c\u5c31\u5fc5\u987b\u5b9e\u73b0flume\u7684\u62e6\u622a\u5668 flume\u62e6\u622a\u5668\u7684\u4ee3\u7801\uff1a Text Only<pre><code>public class TopicInterceptor implements Interceptor {\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void initialize() {}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public Event intercept(Event event) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Map&lt;String, String&gt; headMap = event.getHeaders();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String body = new String(event.getBody());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (body.contains(\"hello\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0headMap.put(\"topic\", \"topic-a\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0headMap.put(\"topic\", \"topic-b\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return event;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public List&lt;Event&gt; intercept(List&lt;Event&gt; list) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (Event event : list) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0intercept(event);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return list;\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0public void close() {}\n\n\u00a0\u00a0\u00a0\u00a0public static class Builder implements Interceptor.Builder{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public Interceptor build() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new TopicInterceptor();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0@Override\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0public void configure(Context context) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>2.\u628a\u62e6\u622a\u5668\u6253\u5305\u653e\u5230/opt/module/flume-1.9.0/lib\uff0c\u7136\u540eflume\u914d\u7f6e\u6587\u4ef6 flume-kafka.conf\uff1a Text Only<pre><code># Name the components on this agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\na1.sources.r1.type = netcat\na1.sources.r1.bind = localhost\na1.sources.r1.port = 44444\n\n`# \u62e6\u622a\u5668`\n`a1.sources.r1.interceptors = i1`\n`a1.sources.r1.interceptors.i1.type =interceptor.TopicInterceptor$Builder`\n\n# Describe the sink\n`a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink`\n`# \u5982\u679cevent head\u4e2d\u6ca1\u6709\u6307\u5b9atopic\uff0c\u90a3\u4e48\u6d88\u606f\u5c06\u53d1\u5f80a1.sinks.k1.kafka.topic\u6307\u5b9a\u7684topic`\n`a1.sinks.k1.kafka.topic = topic-a`\n`a1.sinks.k1.kafka.bootstrap.servers = hadoop102:9092,hadoop103:9092,hadoop104:9092`\n`a1.sinks.k1.kafka.flumeBatchSize = 20`\n`a1.sinks.k1.kafka.producer.acks = 1`\n`a1.sinks.k1.kafka.producer.linger.ms = 1`\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n</code></pre></p> <p>3.\u5728Hadoop102\u4e0a\u542f\u52a8flume Text Only<pre><code>bin/flume-ng agent -c conf/ -n a1 -f job/flume-kafka.conf\n</code></pre> \u542f\u52a8netcat\u5ba2\u6237\u7aef Text Only<pre><code>nc localhost 44444\n</code></pre> \u542f\u52a8\u4e24\u4e2a\u6d88\u8d39\u8005\u5206\u522b\u6d88\u8d39topic-a \u548c topic-b\u7684\u6570\u636e Text Only<pre><code>kafka-console-consumer.sh --topic topic-a --bootstrap-server localhost:9092\n</code></pre> Text Only<pre><code>kafka-console-consumer.sh --topic topic-b --bootstrap-server localhost:9092\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/1-Hello%20Scala/","title":"1-Hello Scala","text":"<p> \u7ea6 482 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>Scala\u662f\u4e00\u4e2a\u591a\u8303\u5f0f\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u591a\u8303\u5f0f\u6307\u7684\u662fScala\u65e2\u662f\u9762\u5411\u5bf9\u8c61\u7684\u53c8\u53ef\u4ee5\u51fd\u6570\u5f0f\u7f16\u7a0b\u3002\u7528Scala\u5199\u7684\u4f18\u79c0\u7684\u6846\u67b6\u6709\uff1aspark\u3001Kafka\u3001akka\u3002</p> <p>\u5b89\u88c5\u914d\u7f6eScala 1.\u4e0b\u8f7d\u5e76\u89e3\u538bScala\u7684SDK\uff0cscala-2.12.11.zip 2.\u914d\u7f6e\u73af\u5883\u53d8\u91cf SCALA_HOME=D:\\Program Files\\scala-2.12.11 Path\u73af\u5883\u53d8\u91cf\u52a0\u4e0a%SCALA_HOME%\\bin</p> <p>Scala\u7684Hello World\u7a0b\u5e8f 1.HelloScala.scala Text Only<pre><code>object HelloScala {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"hello scala\")\n\u00a0\u00a0}\n}\n</code></pre> 2.\u7f16\u8bd1\uff0cScala\u4e5f\u662f\u8fd0\u884c\u5728jvm\u4e0a\u7684\uff0c\u6240\u4ee5\u7f16\u8bd1\u7684\u7ed3\u679c\u4e5f\u662f\u5b57\u8282\u7801.class\u6587\u4ef6 Text Only<pre><code>scalac HelloScala.scala\n</code></pre> 3.\u8fd0\u884c Text Only<pre><code>scala HelloScala\n</code></pre> 4.\u56e0\u4e3aScala\u7f16\u8bd1\u7ed3\u679c\u4e5f\u662f\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u6240\u4ee5\u6309\u9053\u7406\u6765\u8bb2\uff0c\u4f7f\u7528java\u547d\u4ee4\u4e5f\u53ef\u8fd0\u884cScala\u7f16\u8bd1\u7684\u5b57\u8282\u7801\uff0c\u786e\u5b9e\u53ef\u4ee5\uff0c\u4f46\u662f\u4f7f\u7528java\u547d\u4ee4\u8fd0\u884c\u5b57\u8282\u7801\u65f6\uff0c\u53ea\u4f1a\u9ed8\u8ba4\u6307\u660ejava\u7684sdk\u7684\u8def\u5f84\uff0c\u800c\u4eceScala\u53cd\u7f16\u8bd1\u7684\u7ed3\u679c\u6765\u770bScala\u9ed8\u8ba4import scala.Predef.; \u6240\u4ee5\u4f7f\u7528java\u547d\u4ee4\u8fd0\u884cScala\u7f16\u8bd1\u7684\u5b57\u8282\u7801\u65f6\u8fd8\u9700\u8981\u6307\u660eScala\u7684SDK\u7684\u8def\u5f84\u3002\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0cScala\u7f16\u8bd1\u7684\u7ed3\u679c\u6709\u4e24\u4e2a\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u90a3\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u5373\u516c\u6709\u9759\u6001main\u65b9\u6cd5\u5e94\u8be5\u5728\u90a3\u4e2a\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u5462\uff0c\u76f4\u89c2\u7684\u6765\u770b\u5e94\u8be5\u5728\u4e0d\u5e26\\(\u7b26\u53f7\u7684\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u56e0\u4e3a\u6211\u4eec\u5199\u7684main\u65b9\u6cd5\u5c31\u662f\u5728\u4e0d\u5e26\\)\u7b26\u53f7\u7684object\u4e2d\uff0c\u901a\u8fc7\u53cd\u7f16\u8bd1\u7684\u7ed3\u679c\u770b\u6765\uff0c\u4e5f\u786e\u5b9e\u662f\u5728\u4e0d\u5e26\\(\u7b26\u53f7\u7684\u5b57\u8282\u7801\u6587\u4ef6\uff08\u4f46\u8fd9\u4e2a\u4e0d\u5e26\\)\u7b26\u53f7\u7684object\u5374\u4e0d\u662f\u8fd9\u4e2a\u4e0d\u5e26\\(\u7b26\u53f7\u7684\u5b57\u8282\u7801\u7684\u7c7b\u7684\u5bf9\u8c61\uff0c\u800c\u662f\u90a3\u4e2a\u5e26\\)\u7b26\u53f7\u7684\u5b57\u8282\u7801\u7684\u7c7b\u7684\u5bf9\u8c61\uff0c\u4e0b\u4e00\u7bc7\u7b14\u8bb0\u4f1a\u89e3\u91ca\u8fd9\u4e2a\u95ee\u9898\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u4f1a\u751f\u6210\u4e24\u4e2a\u5b57\u8282\u7801\u6587\u4ef6 \u548c \u7a0b\u5e8f\u7684\u5165\u53e3\u65b9\u6cd5\u4e3a\u4ec0\u4e48\u5728\u4e0d\u5e26$\u7b26\u53f7\u7684\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\uff09\u3002 Text Only<pre><code>java -cp %SCALA_HOME%/lib/scala-library.jar\u00a0HelloScala\n</code></pre></p> <p>idea\u4e2d\u914d\u7f6eScala\u7684\u7f16\u5199\u73af\u5883 1.\u4e0b\u8f7dScala\u7684\u63d2\u4ef6 2.\u65b0\u5efaMaven\u5de5\u7a0b 3.\u53f3\u952e\u5de5\u7a0b\uff0cAdd FrameWrok Support\uff0c\u9009\u62e9Scala</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/10-Scala%E7%9A%84%E6%96%B9%E6%B3%95%20%E4%B8%8E%20Java%E7%9A%84%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8/","title":"10-Scala\u7684\u65b9\u6cd5 \u4e0e Java\u7684\u65b9\u6cd5\u5f15\u7528","text":"<p> \u7ea6 323 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u5728Scala\u4e2d\uff0c\u65b9\u6cd5\u4e0e\u51fd\u6570\u9664\u4e86\u4ee5\u4e0b\u4e24\u70b9\u4e0d\u540c\u5916\uff0c\u5728\u5176\u5b83\u7528\u6cd5\u4e0a\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff0c\u6bd4\u5982Scala\u4e2d\u65b9\u6cd5\u540c\u6837\u53ef\u4ee5\u50cf\u51fd\u6570\u4e00\u6837\u8d4b\u503c\u7ed9\u53d8\u91cf\u3002 1.\u51fd\u6570\u6ca1\u6709\u91cd\u8f7d\u548c\u91cd\u5199\u7684\u6982\u5ff5\uff0c\u4e0d\u80fd\u5728\u540c\u4e00\u4e2a\u4f5c\u7528\u57df\u5185\u5b9a\u4e49\u4e24\u4e2a\u540c\u540d\u7684\u51fd\u6570\uff0c\u4f46\u662f\u65b9\u6cd5\u53ef\u4ee5\u8fdb\u884c\u91cd\u8f7d\u548c\u91cd\u5199\u3002 2.\u65b9\u6cd5\u53ea\u80fd\u63d0\u4f9b\u7c7b\u7684\u5bf9\u8c61\u6765\u8c03\u7528\uff0c\u800c\u51fd\u6570\u58f0\u660e\u4e4b\u540e\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u3002 \u6d4b\u8bd5\u5982\u4e0b\uff0c\u4f34\u751f\u5bf9\u8c61\u548c\u5b9e\u4f8b\u5bf9\u8c61\u90fd\u662f\u5bf9\u8c61\uff0c\u53ef\u4ee5\u5c06\u5bf9\u8c61\u7684\u65b9\u6cd5\u8d4b\u503c\u7ed9\u53d8\u91cf Text Only<pre><code>object MyMethod {\n\u00a0\u00a0def func2(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"MyMethod func2\")\n\u00a0\u00a0}\n}\n\nclass MyMethod(val field: String) {\n\u00a0\u00a0def func1(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(field)\n\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val myMethod = new MyMethod(\"MyMethod field\")\n\u00a0\u00a0val f1: () =&gt; Unit = myMethod.func1\n\u00a0\u00a0val f2: () =&gt; Unit = MyMethod.func2\n\u00a0\u00a0f1()\n\u00a0\u00a0f2()\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>MyMethod field\nMyMethod func2\n</code></pre></p> <p>Java\u4e2d\u7684\u51fd\u6570\u5f0f\u63a5\u53e3\u662f\u501f\u9274\u81eaScala\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u601d\u60f3 Text Only<pre><code>@FunctionalInterface\ninterface FuncInterface {\n\u00a0\u00a0\u00a0\u00a0void method(String str);\n}\n\nclass AClass {\n\u00a0\u00a0\u00a0\u00a0public static void invokeMethod(FuncInterface func) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0func.method(\"AClass\");\n\u00a0\u00a0\u00a0\u00a0}\n}\n\npublic class BClass {\n\u00a0\u00a0\u00a0\u00a0void myPrint(String str) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(str);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BClass bClass = new BClass();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0AClass.invokeMethod(bClass::myPrint);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u53ef\u4ee5\u5c06\u51fd\u6570\u5f0f\u63a5\u53e3\u76f4\u63a5\u770b\u4f5c\u662f\u51fd\u6570\uff0cbClass::myPrint\u8d4b\u503c\u7ed9func\u53d8\u91cf\uff0c\u5176\u5b9e\u5c31\u662f\u5c06\u5b9e\u4f8b\u5bf9\u8c61bClass\u7684\u65b9\u6cd5myPrint\u8d4b\u503c\u7ed9\u53d8\u91cf\uff0c\u7b49\u4ef7\u4e8e\u4ee5\u540e\u8c03\u7528func.method\u5176\u5b9e\u5c31\u662f\u8c03\u7528bClass.myPrint</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/2-%E4%BC%B4%E7%94%9F%E7%B1%BB%20%E5%92%8C%20%E4%BC%B4%E7%94%9F%E5%AF%B9%E8%B1%A1/","title":"2-\u4f34\u751f\u7c7b \u548c \u4f34\u751f\u5bf9\u8c61","text":"<p> \u7ea6 1399 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 28 \u5206\u949f</p> <p>Scala\u8ba4\u4e3aJava\u4e2d\u7684static\u4e0d\u591f\u9762\u5411\u5bf9\u8c61\uff0c\u6240\u4ee5\u53d6\u6d88\u4e86static\u5173\u952e\u5b57\uff0c\u66ff\u4ee3\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u4f34\u751f\u7c7b\u548c\u4f34\u751f\u5bf9\u8c61\uff0c\u5982\u4e0b\u6240\u793a\uff1a Text Only<pre><code>class Student(name: String, age: Int) {\n\u00a0\u00a0def printInfo(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"name=\" + this.name +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", age=\" + this.age +\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\", school=\" + Student.school)\n\u00a0\u00a0}\n}\n\nobject Student{\n\u00a0\u00a0private val school = \"JNU\"\n\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val alice = new Student(\"alice\", 20)\n\u00a0\u00a0\u00a0\u00a0alice.printInfo()\n\u00a0\u00a0}\n}\n</code></pre> 1.\u5728Scala\u4e2d\uff0c\u7c7b\u4f7f\u7528class\u5173\u952e\u5b57\u58f0\u660e\uff0c\u4f34\u751f\u5bf9\u8c61\u4f7f\u7528object\u58f0\u660e\uff0c\u8981\u60f3\u4e8c\u8005\u5177\u6709\u4f34\u751f\u5173\u7cfb\u5c31\u9700\u8981\u5177\u6709\u76f8\u540c\u7684\u540d\u5b57\uff0c\u5e76\u4e14\u5f97\u653e\u5728\u540c\u4e00\u4e2ascala\u6587\u4ef6\u4e2d\u3002 2.\u4f34\u751f\u7c7b\u53ef\u4ee5\u8bbf\u95ee\u4f34\u751f\u5bf9\u8c61\u4e2d\u5f97\u4efb\u4f55\u5b57\u6bb5\u548c\u65b9\u6cd5\uff0c\u5305\u62ec\u79c1\u6709\u7684\u3002 3.\u4f34\u751f\u5bf9\u8c61\u76f8\u5f53\u4e8eJava\u91cc\u9762\u7684\u4e00\u4e2a\u5355\u4f8b\u5bf9\u8c61\u3002 Scala\u7684\u7f16\u7a0b\u601d\u60f3\u5c31\u662f\u8ba4\u4e3astatic\u4e0d\u591f\u9762\u5411\u5bf9\u8c61\uff0c\u4e0d\u5e94\u8be5\u901a\u8fc7\u7c7b\u6765\u8c03\u7528\u53d8\u91cf\u548c\u65b9\u6cd5\uff0c\u53d8\u91cf\u548c\u65b9\u6cd5\u5e94\u8be5\u662f\u5b9e\u4f8b\u5bf9\u8c61\u624d\u6709\u7684\u4e1c\u897f\uff0c\u6240\u4ee5Scala\u641e\u4e86\u8fd9\u4e2a\u4f34\u751f\u5bf9\u8c61\uff0c\u56e0\u4e3a\u5b83\u662f\u5355\u4f8b\u7684\uff0c\u6240\u4ee5\u5b83\u91cc\u9762\u7684\u5b57\u6bb5\u53ea\u6709\u4e00\u4efd\uff0c\u5b83\u7684\u65b9\u6cd5\u53ea\u80fd\u901a\u8fc7\u8fd9\u4e2a\u5bf9\u8c61\u8c03\u7528\uff0c\u53c8\u4f34\u751f\u7c7b\u53ef\u4ee5\u8bbf\u95ee\u4f34\u751f\u5bf9\u8c61\u4e2d\u5f97\u4efb\u4f55\u5b57\u6bb5\u548c\u65b9\u6cd5\uff0c\u4e8e\u662f\u4e5f\u5c31\u76f8\u5f53\u4e8e\u5b9e\u73b0\u4e86Java\u7c7b\u7684static\u5b57\u6bb5\u548c\u65b9\u6cd5\uff0c\u6240\u4ee5\u5728\u719f\u6089Java\u7684\u7a0b\u5e8f\u5458\u770b\u6765\uff0c\u4f34\u751f\u5bf9\u8c61\u5c31\u662f\u628a\u539f\u6765\u9700\u8981\u5728Java\u7c7b\u91cc\u9762\u5b9a\u4e49\u7684static\u5b57\u6bb5\u548c\u65b9\u6cd5\u7ed9\u63d0\u53d6\u4e86\u51fa\u6765\uff0c\u653e\u5728\u8fd9\u4e2a\u5355\u4f8b\u7684\u4f34\u751f\u5bf9\u8c61\u91cc\u9762\u4e86\u3002\u4f34\u751f\u5bf9\u8c61\u662f\u5df2\u7ecf\u5b9e\u4f8b\u5316\u7684\u5bf9\u8c61\uff0c\u6240\u4ee5\u5b83\u7684\u5b57\u6bb5\u548c\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u4f34\u751f\u5bf9\u8c61\u4f7f\u7528\uff0c\u4f34\u751f\u7c7b\u662f\u4e00\u4e2a\u7c7b\uff0c\u6ca1\u6709\u5b9e\u4f8b\u5316\uff0c\u6240\u4ee5\u5b83\u7684\u5b57\u6bb5\u548c\u65b9\u6cd5\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\uff0c\u901a\u8fc7\u8fd9\u6837\u7684\u8bbe\u8ba1\uff0cScala\u5c31\u89e3\u51b3\u4e86Java\u4e2d\u76f4\u63a5\u901a\u8fc7\u7c7b\u6765\u8c03\u7528static\u5b57\u6bb5\u548c\u65b9\u6cd5\u7684\u95ee\u9898\u3002</p> <p>\u73b0\u5728\u770b\u6765\uff0cJava\u7684static\u786e\u5b9e\u6709\u70b9\u4e0d\u5408\u7406\uff0c\u6bd4\u5982\u901a\u8fc7static\u53ef\u4ee5\u5728\u7c7b\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u8be5\u7c7b\u7684\u5bf9\u8c61\uff1a Text Only<pre><code>// \u8ba2\u5355\u7c7b\npublic class Order {\n\u00a0\u00a0\u00a0\u00a0static Order order = new Order();\n}\n</code></pre> \u8fd9\u79cd\u8bed\u6cd5\u5728\u4e0d\u719f\u6089JVM\u7684\u9762\u5411\u5bf9\u8c61\u7a0b\u5e8f\u5458\u770b\u6765\u662f\u4e0d\u592a\u5408\u7406\uff0c\u56e0\u4e3a\u4e00\u4e2a\u7c7b\u8fd8\u6ca1\u5b9a\u4e49\u5b8c\uff0c\u4f60\u5374\u53ef\u4ee5\u5b9a\u4e49\u5b83\u7684\u5bf9\u8c61\uff0c\u603b\u89c9\u5f97\u6709\u70b9\u8fdd\u80cc\u7c7b\u4e0e\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u6700\u540e\u7d22\u6027\u6b7b\u8bb0\u8fd9\u5c31\u662fstatic\u5173\u952e\u5b57\u7684\u7279\u70b9\u3002\u5982\u679c\u719f\u6089JVM\u5c31\u77e5\u9053\uff0cstatic\u53d8\u91cf\u7684\u8d4b\u503c\u662f\u5728\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\u7684\u8fde\u63a5\u7684\u51c6\u5907\u9636\u6bb5\u6267\u884c\u65b9\u6cd5\u5b8c\u6210\u7684\uff0c\u4e0e\u7c7b\u5b9e\u4f8b\u5316\u8c03\u7528\u7684\u6784\u9020\u65b9\u6cd5\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u5728JVM\u4e2d\u6267\u884c\u4e0a\u9762\u7684\u4ee3\u7801\u662f\u884c\u5f97\u901a\u7684\u3002 <p>\u6240\u4ee5\u901a\u8fc7\u4f7f\u7528\u4f34\u751f\u5bf9\u8c61\u66ff\u6362static\u7684\u8bbe\u8ba1\u786e\u5b9e\u5f88\u68d2\uff0c\u8fd8\u6709\uff0c\u6bd4\u5982Java\u96c6\u5408\u5bf9\u5e94\u7684\u5de5\u5177\u7c7b\u91cc\u9762\u90fd\u662f\u9759\u6001\u65b9\u6cd5\uff0c\u5176\u5b9e\u8fd9\u4e9b\u9759\u6001\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u653e\u5728\u96c6\u5408\u7c7b\u91cc\u9762\uff0c\u4f46\u662f\u4e3a\u4e86\u7ed3\u6784\u66f4\u52a0\u6e05\u6670\u8fd8\u662f\u628a\u5b83\u4eec\u5355\u72ec\u5730\u653e\u5728\u4e86\u5de5\u5177\u7c7b\u4e2d\uff0c\u800cScala\u91c7\u7528\u4f34\u751f\u5bf9\u8c61\u5f88\u4f18\u96c5\u5730\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0cJava\u4e2d\u6240\u6709\u653e\u5728\u5de5\u5177\u7c7b\u4e2d\u7684\u9759\u6001\u65b9\u6cd5\uff0c\u73b0\u5728\u76f4\u63a5\u653e\u5728\u4f34\u751f\u5bf9\u8c61\u4e2d\uff0c\u901a\u8fc7\u5bf9\u8c61\u8c03\u65b9\u6cd5\u66f4\u52a0\u9762\u5411\u5bf9\u8c61\uff0c\u5e76\u4e14\u4f34\u751f\u7c7b\u548c\u4f34\u751f\u5bf9\u8c61\u540c\u540d\uff0c\u4ee3\u7801\u7ed3\u6784\u5f88\u6e05\u6670\u3002</p> <p>\u4ee5\u4e0a\u4ece\u4f7f\u7528\u8005\u5c42\u9762\u7684\u89d2\u5ea6\u89e3\u91ca\u4e86Scala\u7684\u4f34\u751f\u7c7b\u548c\u4f34\u751f\u5bf9\u8c61\uff0c\u65e2\u7136Scala\u7f16\u8bd1\u7684\u7ed3\u679c\u4e5f\u662f\u5b57\u8282\u7801\uff0c\u6240\u4ee5\u6309\u9053\u7406\u8bb2\uff0c\u6211\u4eec\u5e94\u8be5\u80fd\u5c06Scala\u7f16\u8bd1\u7684\u5b57\u8282\u7801\u53cd\u7f16\u8bd1\u6210Java\u4ee3\u7801\uff0c\u4e8e\u662f\u53ef\u4ee5\u4ee5Java\u7684\u8bed\u6cd5\u6765\u7406\u89e3Scala\u662f\u5982\u4f55\u5b9e\u73b0\u4e0a\u8ff0\u7684\u4f34\u751f\u7c7b\u548c\u4f34\u751f\u5bf9\u8c61\u7684\u903b\u8f91\u7684\uff08\u6ce8\u610f\u8fd9\u91cc\u662f\u4ee5Java\u7684\u8bed\u6cd5\u6765\u7406\u89e3\uff0c\u5176\u5b9eScala\u7684\u8bed\u6cd5\u548c\u7f16\u7a0b\u601d\u60f3\u662f\u548cJava\u5b8c\u5168\u4e0d\u4e00\u6837\u7684\uff09\u3002 \u53cd\u7f16\u8bd1\u5f97\u5230\u7684Java\u4ee3\u7801\uff1a Text Only<pre><code>public class Student {\n\u00a0\u00a0\u00a0private final String name;\n\u00a0\u00a0\u00a0private final int age;\n\u00a0\u00a0\u00a0public static void main(final String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Student$.MODULE$.main(var0);\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0public void printInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.MODULE$.println((new StringBuilder(20)).append(\"name=\").append(this.name).append(\", age=\").append(this.age).append(\", school=\").append(Student$.MODULE$.Student$school()).toString());\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0public Student(final String name, final int age) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.name = name;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.age = age;\n\u00a0\u00a0\u00a0}\n}\n\npublic final class Student$ {\n\u00a0\u00a0\u00a0public static Student$ MODULE$;\n\u00a0\u00a0\u00a0private final String Student$school;\n\u00a0\u00a0\u00a0static {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Student$();\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0public String Student$school() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return this.Student$school;\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0public void main(final String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Student alice = new Student(\"alice\", 20);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0alice.printInfo();\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0private Student$() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MODULE$ = this;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.Student$school = \"JNU\";\n\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230Student\\(\u7c7b\u7684\u6784\u9020\u51fd\u6570\u662f\u79c1\u6709\u7684\uff0c\u5e76\u4e14\u5728\u9759\u6001\u4ee3\u7801\u5757\u91cc\u8fdb\u884c\u4e86\u5b9e\u4f8b\u5316\uff0c\u5c06\u5f15\u7528\u8d4b\u7ed9\u4e86\u516c\u6709\u9759\u6001\u5b57\u6bb5MODULE\\)\uff0c\u800c\u4e14Student\\(\u7c7b\u4e2d\u7684\u5b57\u6bb5\u548c\u65b9\u6cd5\u5c31\u662fScala\u4e2d\u7684\u4f34\u751f\u5bf9\u8c61\u7684\u5b57\u6bb5\u548c\u65b9\u6cd5\uff0c\u6240\u4ee5Scala\u4e2d\u7684\u4f34\u751f\u5bf9\u8c61\u5176\u5b9e\u5c31\u662fMODULE\\)\u6307\u5411\u7684\u5bf9\u8c61\u3002 \u4eceStudent\u7c7b\u4e2d\u53ef\u4ee5\u770b\u5230Scala\u4e2d\u7684\u4f34\u751f\u7c7b\u7684\u65b9\u6cd5\u548c\u5b57\u6bb5\u90fd\u91cc\u9762\uff0c\u6240\u4ee5Scala\u7684\u4f34\u751f\u7c7b\u5c31\u662f\u8fd9\u4e2aStudent\u7c7b\uff0c\u5e76\u4e14Student\u7c7b\u4e2d\u8fd8\u81ea\u52a8\u751f\u6210\u4e86\u9759\u6001\u516c\u6709\u7684main\u65b9\u6cd5\uff0c\u8fd9\u5c31\u662f\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u901a\u8fc7\u59d4\u6258\u7684\u65b9\u5f0f\u8c03\u7528\u4e86\u4f34\u751f\u5bf9\u8c61\u4e2d\u5b9a\u4e49\u7684main\u65b9\u6cd5\uff0c\u4e8e\u662f\u6211\u4eec\u5728\u4f7f\u7528java\u547d\u4ee4\u8fd0\u884cScala\u7f16\u8bd1\u7684\u5b57\u8282\u7801\u65f6\uff0c\u4e0d\u80fdjava\u00a0Student\\(\uff0c\u800c\u662f\u5e94\u8be5java\u00a0Student\u3002 \u7efc\u4e0a\uff0c\u4f34\u751f\u5bf9\u8c61Student\u5176\u5b9e\u662fStudent\\)\u7684\u5bf9\u8c61\uff0c\u4f34\u751f\u7c7b\u7f16\u8bd1\u6210\u7684\u5c31\u662f\u76f8\u5e94\u7684\u7c7b\u7684\u5b57\u8282\u7801\uff0c\u53ea\u4e0d\u8fc7\u4f1a\u81ea\u52a8\u6dfb\u52a0main\u65b9\u6cd5\u3002</p> <p>\u5982\u679c\u53ea\u58f0\u660e\u4e86\u4f34\u751f\u5bf9\u8c61\uff0c\u6ca1\u6709\u5199\u76f8\u5e94\u7684\u4f34\u751f\u7c7b\uff0c\u90a3\u4e48\u7f16\u8bd1\u4e5f\u4f1a\u81ea\u52a8\u751f\u6210\u4f34\u751f\u5bf9\u8c61\u5bf9\u5e94\u7684\u4f34\u751f\u7c7b\uff0c\u5982\u5f00\u7bc7\u7684HelloScala\u7a0b\u5e8f\uff1a Text Only<pre><code>object HelloScala {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"hello scala\")\n\u00a0\u00a0}\n}\n</code></pre> \u53cd\u7f16\u8bd1\u7684\u7ed3\u679c\uff1a Text Only<pre><code>public final class HelloWorld$ {\n\u00a0\u00a0\u00a0public static HelloWorld$ MODULE$;\n\u00a0\u00a0\u00a0static {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new HelloWorld$();\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0public void main(final String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.MODULE$.println(\"hello world\");\n\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0private HelloWorld$() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MODULE$ = this;\n\u00a0\u00a0\u00a0}\n}\n\npublic final class HelloWorld {\n\u00a0\u00a0\u00a0public static void main(final String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0HelloWorld$.MODULE$.main(var0);\n\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/3-%E5%8F%98%E9%87%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","title":"3-\u53d8\u91cf\u548c\u6570\u636e\u7c7b\u578b","text":"<p> \u7ea6 1713 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 34 \u5206\u949f</p> <p>\u53d8\u91cf\u58f0\u660e \u58f0\u660e\u53d8\u91cf\uff1avar \u53d8\u91cf\u540d [: \u53d8\u91cf\u7c7b\u578b] = \u521d\u59cb\u503c\uff0c\u5982\uff1avar i:Int = 10 \u58f0\u660e\u5e38\u91cf\uff1aval \u5e38\u91cf\u540d [: \u5e38\u91cf\u7c7b\u578b] = \u521d\u59cb\u503c\uff0c\u5982\uff1aval i:Int = 10 \u6ce8\u610f\uff1a \u80fd\u7528\u5e38\u91cf\u7684\u5730\u65b9\u4e0d\u7528\u53d8\u91cf 1.\u58f0\u660e\u53d8\u91cf\u65f6\uff0c\u7c7b\u578b\u53ef\u4ee5\u7701\u7565\uff0c\u7f16\u8bd1\u5668\u81ea\u52a8\u63a8\u5bfc\uff0c\u5373\u7c7b\u578b\u63a8\u5bfc 2.\u53d8\u91cf\u58f0\u660e\u65f6\uff0c\u5fc5\u987b\u8981\u6709\u521d\u59cb\u503c 3.Scala \u662f\u5f3a\u6570\u636e\u7c7b\u578b\u8bed\u8a00\uff0c\u7c7b\u578b\u786e\u5b9a\u540e\u4e0d\u80fd\u4fee\u6539 Text Only<pre><code>var a = 10\na = \"a\"//\u9519\u8bef\n</code></pre></p> <p>\u6807\u8bc6\u7b26\u7684\u547d\u540d\u89c4\u8303 Scala \u5bf9\u5404\u79cd\u53d8\u91cf\u3001 \u65b9\u6cd5\u3001 \u51fd\u6570\u7b49\u547d\u540d\u65f6\u4f7f\u7528\u7684\u5b57\u7b26\u5e8f\u5217\u79f0\u4e3a\u6807\u8bc6\u7b26\u3002\u5373\uff1a \u51e1\u662f\u81ea\u5df1\u53ef\u4ee5\u8d77\u540d\u5b57\u7684\u5730\u65b9\u90fd\u53eb\u6807\u8bc6\u7b26\u3002 \u547d\u540d\u89c4\u5219\uff1a 1. \u4ee5\u5b57\u6bcd\u6216\u8005\u4e0b\u5212\u7ebf\u5f00\u5934\uff0c\u540e\u63a5\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf 2. \u4ee5\u64cd\u4f5c\u7b26\u5f00\u5934\uff0c\u4e14\u53ea\u5305\u542b\u64cd\u4f5c\u7b26\uff08 + - * / # !\u7b49\uff09\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48Scala\u4e2d+\u7b49\u7b49\u7b26\u53f7\u5176\u5b9e\u662f\u4e00\u4e2a\u65b9\u6cd5 3. \u7528\u53cd\u5f15\u53f7`....`\u5305\u62ec\u7684\u4efb\u610f\u5b57\u7b26\u4e32\uff0c\u5373\u4f7f\u662f Scala \u5173\u952e\u5b57\uff08 39 \u4e2a\uff09\u4e5f\u53ef\u4ee5</p> <p>\u5b57\u7b26\u4e32\u7684\u64cd\u4f5c 1. +\u53f7\u8fde\u63a5 Text Only<pre><code>var str = 2 + \"2\"\nprintln(str)\u00a0 \u00a0//22\n</code></pre> 2. *\u53f7 Text Only<pre><code>var str = \"2\" * 3\nprintln(str) //222\n</code></pre> 3. printf \u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u8f93\u51fa\uff0c\u901a\u8fc7%\u4f20\u503c Text Only<pre><code>printf(\"name=%s, age=%d\\n\", \"alice\", 12)\n</code></pre> 3. \u5b57\u7b26\u4e32\u6a21\u677f\uff08\u63d2\u503c\u5b57\u7b26\u4e32\uff09 \uff1a \u901a\u8fc7$\u83b7\u53d6\u53d8\u91cf\u503c\uff0c\u6ce8\u610f\uff1a\u2460\u53cc\u5f15\u53f7\u524d\u9762\u7684s\u4e0d\u80fd\u6389 \u2461\u5927\u62ec\u53f7\u53ef\u4ee5\u7701\u7565\uff0c\u4f46\u662f\u4e00\u822c\u52a0\u4e0a\uff0c\u53ef\u8bfb\u6027\u66f4\u597d Text Only<pre><code>val name = \"alice\"\nval age = 12\nvar str = s\"name=${name}, age=${age}\"\nprintln(str)\u00a0 //name=alice, age=12\n\nvar d: Double = 1.23456789\nstr = s\"d=${d}\"\nprintln(str) //d=1.23456789\n</code></pre> \u683c\u5f0f\u5316\u6d6e\u70b9\u6570\uff0c\u53cc\u5f15\u53f7\u524d\u9762\u52a0\u7684\u662ff\uff0c10\u8868\u793a\u6700\u540e\u8f93\u51fa\u7684\u6574\u4e2a\u6d6e\u70b9\u6570\u536010\u4f4d\uff0c\u4e0d\u8db310\u4f4d\u7528\u7a7a\u683c\u8865\u9f50\uff0c.2\u8868\u793a\u4fdd\u7559\u4e24\u4f4d\u5c0f\u6570 Text Only<pre><code>var d: Double = 1.23456789\nprintln(f\"d=${d}%10.2f\")\u00a0 //d= \u00a0 \u00a0 \u00a01.23\n</code></pre> \u7b49\u4ef7\u4e8e\uff1a Text Only<pre><code>var d: Double = 1.23456789\nprintln(d.formatted(\"%10.2f\"))\n</code></pre> \u53cc\u5f15\u53f7\u524d\u9762\u52a0\u7684\u662fraw\uff0c\u8868\u793a\u7684\u662f\u539f\u5c01\u4e0d\u52a8\u7684\u8f93\u51fa\u5b57\u7b26\u4e32\u4e2d\u7684\u5185\u5bb9\uff0c\u4e0d\u7ba1\u6709\u6ca1\u6709\u8f6c\u4e49\u5b57\u7b26\u7b49\u7b49 Text Only<pre><code>println(raw\"\\t\\n\")\u00a0 \\\\ \u00a0\\t\\n\n</code></pre> 4. \u4e09\u4e2a\u53cc\u5f15\u53f7 4.1 \u4f7f\u7528\u4e09\u4e2a\u53cc\u5f15\u53f7\u53ef\u4ee5\u76f4\u63a5\u8f93\u51fa\u4e09\u4e2a\u53cc\u5f15\u53f7\u5305\u88f9\u7684\u539f\u5c01\u4e0d\u52a8\u7684\u5185\u5bb9\uff0c\u4e0d\u7ba1\u6709\u6ca1\u6709\u8f6c\u4e49\u5b57\u7b26\u7b49\u7b49\uff0c\u4e0e\u53cc\u5f15\u53f7\u524d\u9762\u52a0\u7684\u662fraw\u7684\u529f\u80fd\u4e00\u6837 Text Only<pre><code>var str = \"\"\"\\t\\n\"\"\"\nprintln(str) \\\\\u00a0 \\t\\n\n</code></pre> 4.2\u4f7f\u7528\u4e09\u4e2a\u53cc\u5f15\u53f7\u7684.stripMargin\uff0c\u53ef\u4ee5\u683c\u5f0f\u5316\u591a\u884c\u5185\u5bb9\uff0c\u901a\u8fc7\u7ad6\u6760|\u6765\u5bf9\u9f50\uff0c\u4e5f\u5c31\u662f\u8f93\u51fa\u65f6\u4f1a\u628a\u7ad6\u6760 | \u53ca\u524d\u9762\u7a7a\u683c\u53bb\u6389 Text Only<pre><code>var str = \"\"\"select *\n\u00a0 \u00a0 \u00a0 \u00a0|from emp\n\u00a0 \u00a0 \u00a0 \u00a0|where eno&lt;1001;\n\u00a0 \u00a0 \u00a0 \u00a0|\"\"\".stripMargin\nprintln(str)\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>select *\nfrom emp\nwhere eno&lt;1001;\n</code></pre></p> <p>\u8f93\u5165\u8f93\u51fa \u6807\u51c6\u8f93\u5165\u8f93\u51fa \u6807\u51c6\u8f93\u5165\uff1aStdIn.readLine()\u3001 StdIn.readShort()\u3001 StdIn.readDouble()\u7b49\u7b49 Text Only<pre><code>println(StdIn.readLine())\n</code></pre> \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6 Text Only<pre><code>val a = Source.fromFile(\"src/main/resources/a.txt\")\na.foreach(print)\na.close()\n</code></pre> \u5199\u5165\u5230\u6587\u4ef6\uff0cScala\u6ca1\u6709\u63d0\u4f9b\u8f93\u51fa\u5230\u6587\u4ef6\u7684api\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Java\u7684io Text Only<pre><code>val writer = new PrintWriter(new File(\"src/main/resources/b.txt\"))\nwriter.write(\"bbbbb\")\nwriter.close()\n</code></pre></p> <p>\u6570\u636e\u7c7b\u578b \u4e0d\u50cfJava\u7684\u516b\u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e0d\u662f\u7c7b\uff0c\u5728Scala\u4e2d\u4e00\u5207\u7686\u662f\u5bf9\u8c61\uff0c\u6240\u4ee5Scala\u7684\u6240\u6709\u6570\u636e\u7c7b\u578b\u90fd\u662f\u7c7b\uff0c\u5e76\u4e14\u6709\u5171\u540c\u7684\u7956\u5148Any\u3002 Scala\u4e2d\u6570\u636e\u7c7b\u578b\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u6570\u503c\u7c7b\u578b\uff08 AnyVal\uff09 \u3001\u5f15\u7528\u7c7b\u578b\uff08AnyRef\uff09  1. Scala\u6570\u636e\u7c7b\u578b\u4ecd\u7136\u9075\u5b88\u4f4e\u7cbe\u5ea6\u7684\u503c\u7c7b\u578b\u5411\u9ad8\u7cbe\u5ea6\u503c\u7c7b\u578b\u7684\u81ea\u52a8\u8f6c\u6362\uff08\u9690\u5f0f\u8f6c\u6362\uff09 2. Scala\u4e2d\u7684StringOps\u662f\u5bf9Java String\u7684\u589e\u5f3a\uff0cScala\u4e5f\u6709String\u7c7b\u578b\uff0cScala\u7684String\u5176\u5b9e\u5c31\u662fJava\u7684String\uff0c\u5c5e\u4e8eAnyRef\u4e0b\u7684(all java classes) 3. Unit\uff1aUnit\u662f\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c \u53ea\u6709\u4e00\u4e2a\u5bf9\u8c61\u5c31\u662f()\u3002\u5bf9\u5e94Java\u4e2d\u7684void\uff0c \u7528\u4e8e\u65b9\u6cd5\u8fd4\u56de\u503c\u7684\u4f4d\u7f6e\uff0c \u8868\u793a\u65b9\u6cd5\u6ca1\u6709\u8fd4\u56de\u503c\u3002 4. Null\uff1aNull\u662f\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c\u53ea\u6709\u4e00\u4e2a\u5bf9\u8c61\u5c31\u662fnull\u3002 \u5b83\u662f\u6240\u6709\u5f15\u7528\u7c7b\u578b\uff08AnyRef\uff09 \u7684\u5b50\u7c7b\u3002 5. Nothing\uff0c \u662f\u6240\u6709\u6570\u636e\u7c7b\u578b\u7684\u5b50\u7c7b\uff0c\u5f53\u4e00\u4e2a\u51fd\u6570\u6ca1\u6709\u660e\u786e\u8fd4\u56de\u503c\u65f6\u4f7f\u7528\u3002</p> <p>\u6574\u6570\u7c7b\u578b\uff08 Byte\u3001 Short\u3001 Int\u3001 Long\uff09  1. Scala \u5404\u6574\u6570\u7c7b\u578b\u6709\u56fa\u5b9a\u7684\u5b57\u8282\u6570\u548c\u8868\u793a\u8303\u56f4\uff0c\u8d85\u51fa\u8868\u793a\u7684\u8303\u56f4\u7684\u8d4b\u503c\u4f1a\u62a5\u9519 Text Only<pre><code>// \u6b63\u786e\nvar n1:Byte = 127\nvar n2:Byte = -128\n// \u9519\u8bef\n// var n3:Byte = 128\n// var n4:Byte = -129\n</code></pre> 2.Scala \u7684\u6574\u578b\uff0c\u9ed8\u8ba4\u4e3a Int \u578b\uff0c\u58f0\u660e Long \u578b\uff0c\u987b\u540e\u52a0\u2018l\u2019\u6216\u2018L Text Only<pre><code>var n5 = 10 //\u9ed8\u8ba4\u4e3a Int \u578b\nprintln(n5)\nvar n6 = 9223372036854775807L\nprintln(n6)\n</code></pre></p> <p>\u6d6e\u70b9\u7c7b\u578b\uff08 Float\u3001 Double\uff09  Scala \u7684\u6d6e\u70b9\u578b\u5e38\u91cf\u9ed8\u8ba4\u4e3a Double \u578b\uff0c\u58f0\u660e Float \u578b\u5e38\u91cf\uff0c\u987b\u540e\u52a0\u2018f\u2019\u6216\u2018F\u2019 Text Only<pre><code>var n7 = 2.2345678912f\nvar n8 = 2.2345678912\n</code></pre></p> <p>Unit \u7c7b\u578b\u3001 Null \u7c7b\u578b\u548c Nothing \u7c7b\u578b\uff08\u91cd\u70b9\uff09  Unit\uff1aUnit\u662f\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c \u53ea\u6709\u4e00\u4e2a\u5bf9\u8c61\u5c31\u662f()\u3002\u5bf9\u5e94Java\u4e2d\u7684void\uff0c \u7528\u4e8e\u65b9\u6cd5\u8fd4\u56de\u503c\u7684\u4f4d\u7f6e\uff0c \u8868\u793a\u65b9\u6cd5\u6ca1\u6709\u8fd4\u56de\u503c\u3002 Text Only<pre><code>val a: Unit = ()\nprintln(a)\n\ndef func(): Unit = {}\nval b = func()\nprintln(b)\n</code></pre> Null\u662f\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c\u53ea\u6709\u4e00\u4e2a\u5bf9\u8c61\u5c31\u662fnull\u3002 \u5b83\u662f\u6240\u6709\u5f15\u7528\u7c7b\u578b\uff08AnyRef\uff09 \u7684\u5b50\u7c7b\u3002 Text Only<pre><code>val a: Null = null\nprintln(a)\n\nvar b: Student = new Student(\"alice\", 20)\nb = null\nprintln(b)\n\n// \u62a5\u9519\uff0c\u56e0\u4e3anull\u662fNull\u7684\u5b9e\u4f8b\uff0cNull\u662f\u6240\u6709\u5f15\u7528\u7c7b\u578b\uff08AnyRef\uff09 \u7684\u5b50\u7c7b\uff0c\n// \u4e0d\u662fAnyVal\u7684\u5b50\u7c7b\uff0c\u6240\u4ee5\u65e0\u6cd5\u8fdb\u884c\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\nval c: Int = null\n</code></pre> Nothing\uff0c\u662f\u6240\u6709\u6570\u636e\u7c7b\u578b\u7684\u5b50\u7c7b\uff0c\u5f53\u4e00\u4e2a\u51fd\u6570\u6ca1\u6709\u660e\u786e\u8fd4\u56de\u503c\u65f6\u4f7f\u7528\uff0c\u6bd4\u5982Breaks\u7c7b\u7684break()\u65b9\u6cd5\u3002\u4e5f\u56e0\u4e3a Nothing \u662f\u6240\u6709\u7c7b\u578b\u7684\u5b50\u7c7b\u578b\uff0c\u6240\u4ee5 throw \u8868\u8fbe\u5f0f\u53ef\u4ee5\u7528\u5728\u9700\u8981\u7c7b\u578b\u7684\u5730\u65b9\u3002 Text Only<pre><code>def break(): Nothing = { throw breakException }\n</code></pre></p> <p>\u6570\u503c\u7c7b\u578b\u81ea\u52a8\u8f6c\u6362 \u5f53 Scala \u7a0b\u5e8f\u5728\u8fdb\u884c\u8d4b\u503c\u6216\u8005\u8fd0\u7b97\u65f6\uff0c\u7cbe\u5ea6\u5c0f\u7684\u7c7b\u578b\u81ea\u52a8\u8f6c\u6362\u4e3a\u7cbe\u5ea6\u5927\u7684\u6570\u503c\u7c7b\u578b\uff0c\u8fd9\u4e2a\u5c31\u662f\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\uff08\u9690\u5f0f\u8f6c\u6362\uff09\u3002\u8f6c\u6362\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a  1.\u628a\u7cbe\u5ea6\u5927\u7684\u6570\u503c\u7c7b\u578b\u8d4b\u503c\u7ed9\u7cbe\u5ea6\u5c0f\u7684\u6570\u503c\u7c7b\u578b\u65f6\uff0c\u5c31\u4f1a\u62a5\u9519\uff0c\u53cd\u4e4b\u5c31\u4f1a\u8fdb\u884c\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\u3002 Text Only<pre><code>val a: Int = 10\nval b: Byte = a //\u9519\u8bef\uff0c\u4e0d\u80fd\u628a\u9ad8\u7cbe\u5ea6\u8d4b\u7ed9\u4f4e\u7cbe\u5ea6\n</code></pre> 2.\u81ea\u52a8\u63d0\u5347\u539f\u5219\uff1a\u6709\u591a\u79cd\u7c7b\u578b\u7684\u6570\u636e\u6df7\u5408\u8fd0\u7b97\u65f6\uff0c\u7cfb\u7edf\u9996\u5148\u81ea\u52a8\u5c06\u6240\u6709\u6570\u636e\u8f6c\u6362\u6210\u7cbe\u5ea6\u5927\u7684\u90a3\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8ba1\u7b97\u3002 Text Only<pre><code>var n = 1 + 2.0\u00a0 \u00a0//n \u662f Double\u7c7b\u578b\n</code></pre> 3.\uff08 byte\uff0c short\uff09\u548c char \u4e4b\u95f4\u4e0d\u4f1a\u76f8\u4e92\u81ea\u52a8\u8f6c\u6362\u3002 Text Only<pre><code>val a: Char = 'c'\nval b: Byte = a//\u9519\u8bef\nval c: Short = a//\u9519\u8bef\n\nval d: Byte = 97\nval e: Short = 97\nval f: Char = d//\u9519\u8bef\nval g: Char = e//\u9519\u8bef\n</code></pre> Char\u53ef\u4ee5\u81ea\u52a8\u8f6c\u6362\u6210Int\uff0c\u4f46\u662fInt\u4e0d\u80fd\u81ea\u52a8\u8f6c\u6362\u6210Char Text Only<pre><code>val a: Char = 'c'\nval b: Int = a\u00a0 //\u53ef\u4ee5\nprintln(b)\n\nval c: Char = b\u00a0 //\u9519\u8bef\nprintln(c)\n</code></pre> 4.byte\uff0c short\uff0c char \u4ed6\u4eec\u4e09\u8005\u53ef\u4ee5\u8ba1\u7b97\uff0c \u5728\u8ba1\u7b97\u65f6\u4f1a\u8f6c\u6362\u4e3a int \u7c7b\u578b\u3002 Text Only<pre><code>val a: Byte = 10\nval b: Short = 20\nval c: Char = 'c'\nval d: Short = a + b //\u9519\u8bef\uff0cByte\u548cShort\u76f8\u52a0\u7684\u7ed3\u679c\u662fInt\uff0c\u8fd9\u70b9\u662f\u4e0e\u7b2c\u4e8c\u70b9\u81ea\u52a8\u63d0\u5347\u539f\u5219\u76f8\u6096\u7684\nval d: Short = a + c\u00a0\u00a0//\u9519\u8bef\uff0cByte\u548cChar\u76f8\u52a0\u7684\u7ed3\u679c\u662fInt\n</code></pre></p> <p>\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362 \u9ad8\u7cbe\u5ea6\u5411\u4f4e\u7cbe\u5ea6\u7684\u5f3a\u5236\u8f6c\u6362 Text Only<pre><code>var n: Int = 2.5.toInt\n</code></pre> String \u7c7b\u578b\u5411\u6570\u503c\u7c7b\u578b\u8f6c\u6362 Text Only<pre><code>val s1: String = \"123\"\nval n1: Byte = s1.toByte\nval n2: Short = s1.toShort\nval n3: Int = s1.toInt\nval n4: Long = s1.toLong\nval n5: Float = s1.toFloat\n\nval n6: Int = \"12.3\".toInt\u00a0 //\u9519\u8bef\nval n6: Int = \"12.3\".toFloat.toInt //\u53ef\u4ee5\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/4-%E8%BF%90%E7%AE%97%E7%AC%A6/","title":"4-\u8fd0\u7b97\u7b26","text":"<p> \u7ea6 821 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u6bd4\u8f83\u8fd0\u7b97\u7b26== \u5728Java\u4e2d\u6bd4\u8f83\u7684\u662f\u5f15\u7528\u5730\u5740\uff0c\u4f46\u662f\u5728Scala\u4e2d\u8c03\u7528\u7684\u662fequals\u65b9\u6cd5\u3002 Java\u4e2d\u8f93\u51fa\u662ffalse\uff1a Text Only<pre><code>String str1 = \"hello\";\nString str2 = new String(\"hello\");\nSystem.out.println(str1 == str2);\n</code></pre> Scala\u4e2d\u8f93\u51fa\u7684\u662ftrue\uff1a Text Only<pre><code>val str1: String = \"hello\"\nval str2: String = new String(\"hello\")\nprintln(str1 == str2)\n</code></pre> Scala\u4f7f\u7528eq()\u65b9\u6cd5\u6765\u6bd4\u8f83\u5f15\u7528\u5730\u5740\uff0c\u4ee5\u4e0b\u8f93\u51fa\u4e3afalse\uff1a Text Only<pre><code>val str1: String = \"hello\"\nval str2: String = new String(\"hello\")\nprintln(str1.eq(str2))\n</code></pre></p> <p>\u8d4b\u503c\u8fd0\u7b97\u7b26 \u5728Java\u4e2d\uff1a Text Only<pre><code>byte b = 10;\nb = b + 1; // \u9519\u8bef\uff0cbyte\u548cint\u76f8\u52a0\u7684\u7ed3\u679c\u662fint\uff0c\u9ad8\u7cbe\u5ea6\u4e0d\u80fd\u76f4\u63a5\u8d4b\u7ed9\u4f4e\u7cbe\u5ea6\uff08\u4e0d\u80fd\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\uff09\uff0c\u53ea\u80fd\u5f3a\u8f6c\n//\u4ee5\u4e0b\u4e24\u79cd\u662fok\u7684\uff0c\u7f16\u8bd1\u5668\u4f1a\u5904\u7406\nb++;//ok\nb += 1;//ok\n</code></pre> Scala \u4e2d\u6ca1\u6709++\u3001 --\u64cd\u4f5c\u7b26\uff0c\u53ef\u4ee5\u901a\u8fc7+=\u3001 -=\u6765\u5b9e\u73b0\u540c\u6837\u7684\u6548\u679c Text Only<pre><code>var a: Int = 10\na += 1\n\nvar b: Byte = 10\nb += 1 //\u5728Scala\u91cc\u662f\u9519\u8bef\uff0c\u7f16\u8bd1\u5668\u628a1\u4f5c\u4e3aInt\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u628aInt\u8d4b\u7ed9Byte\n</code></pre></p> <p>Scala\u662f\u4e00\u95e8\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\uff0c\u6709\u4ee5\u4e0b\u7684\u7279\u70b9\uff1a 1.\u5f53\u8c03\u7528\u5bf9\u8c61\u7684\u65b9\u6cd5\u65f6\uff0c \u70b9.\u53ef\u4ee5\u7701\u7565\uff0c\u7528\u7a7a\u683c\u4ee3\u66ff 2.\u5982\u679c\u65b9\u6cd5\u53c2\u6570\u53ea\u6709\u4e00\u4e2a\uff0c\u6216\u8005\u6ca1\u6709\u53c2\u6570\uff0c()\u53ef\u4ee5\u7701\u7565\uff1b 2.\u5982\u679c\u51fd\u6570\u53c2\u6570\u6ca1\u6709\u53c2\u6570\uff0c() \u53ef\u4ee5\u7701\u7565\uff0c\u51fd\u6570\u53c2\u6570\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\uff0c() \u4e0d\u53ef\u4ee5\u7701\u7565 \u6ce8\u610f\uff1a\u5982\u679c\u4f7f\u7528 \u70b9.\u00a0\u6765\u8c03\u7528\u65b9\u6cd5\uff0c\u5e76\u4e14\u51fd\u6570\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u5c31\u4e0d\u80fd\u7701\u7565()\u00a0 Text Only<pre><code>object TestFunction {\n\u00a0\u00a0def func(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"func\u65b9\u6cd5\u88ab\u8c03\u7528\")\n\u00a0\u00a0}\n\u00a0\u00a0def func(str: String): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(str)\n\u00a0\u00a0}\n\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0//\u5f53\u8c03\u7528\u5bf9\u8c61\u7684\u65b9\u6cd5\u65f6\uff0c\u70b9.\u53ef\u4ee5\u7701\u7565\n\u00a0\u00a0\u00a0\u00a0TestFunction func()\n\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u65b9\u6cd5\u6ca1\u6709\u53c2\u6570\uff0c\u6216\u8005\u53c2\u6570\u53ea\u6709\u4e00\u4e2a\uff0c ()\u53ef\u4ee5\u7701\u7565\n\u00a0\u00a0\u00a0\u00a0TestFunction func; //\u8fd9\u91cc;\u53f7\u4e0d\u80fd\u5c11\uff0c\u8fd9\u662f\u7279\u6b8a\u60c5\u51b5\uff0c\u4e0d\u52a0;\u53f7\uff0c\u7f16\u8bd1\u5668\u65e0\u6cd5\u5224\u65ad\u8bed\u53e5\u662f\u5426\u7ed3\u675f\n\u00a0\u00a0\u00a0\u00a0TestFunction func \"\u53c2\u6570\u53ea\u6709\u4e00\u4e2a\u53ef\u4ee5\u7701\u7565()\"\n\u00a0\u00a0\u00a0\u00a0//TestFunction.func \"\u53c2\u6570\u53ea\u6709\u4e00\u4e2a\u53ef\u4ee5\u7701\u7565()\" //\u9519\u8bef\uff0c\u5982\u679c\u4f7f\u7528 \u70b9. \u6765\u8c03\u7528\u65b9\u6cd5\uff0c\u5e76\u4e14\u51fd\u6570\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u5c31\u4e0d\u80fd\u7701\u7565()\n\n\u00a0\u00a0\u00a0\u00a0def fun1(): Unit = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(\"fun\u51fd\u6570\u88ab\u8c03\u7528\u4e86\")\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0def fun2(name: String): Unit = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(name)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u51fd\u6570\u53c2\u6570\u6ca1\u6709\u53c2\u6570\uff0c() \u53ef\u4ee5\u7701\u7565\n\u00a0\u00a0\u00a0\u00a0fun1\n\u00a0\u00a0\u00a0\u00a0//fun2 \"alice\"\u00a0\u00a0//\u9519\u8bef\uff0c\u51fd\u6570\u53c2\u6570\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\uff0c() \u4e0d\u53ef\u4ee5\u7701\u7565\n\u00a0\u00a0}\n}\n</code></pre></p> Text Only<pre><code>println(1.2.toString())\nprintln(1.2.toString)\nprintln(1.2 toString)\nprintln(1.2 toInt)\nprintln(1.23.toInt.toString)\n</code></pre> <p>Scala\u7684\u9762\u5411\u5bf9\u8c61\u7684\u601d\u60f3\u975e\u5e38\u5f7b\u5e95\uff0c\u6240\u4ee5\u5728Scala\u4e2d\uff0c\u8fd0\u7b97\u7b26\u672c\u8d28\u662f\u65b9\u6cd5\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5\u8c03\u7528\u7684\u5f62\u5f0f\u6765\u4f7f\u7528\u8fd0\u7b97\u7b26\uff0c\u8fd9\u4e5f\u7b26\u5408\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u601d\u60f3\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u4ee5\u65b9\u6cd5\u8c03\u7528\u7684\u5f62\u5f0f\u6765\u4f7f\u7528\u8fd0\u7b97\u7b26\uff0c\u8fd9\u76f8\u5f53\u4e8e\u7701\u7565\u4e86\u70b9. \u548c () Text Only<pre><code>//\u51fd\u6570\u8c03\u7528\u5f62\u5f0f\nval b: Int = 1.+(1)\n//\u5e38\u89c4\u7684\u5f62\u5f0f\uff0c\u76f8\u5f53\u4e8e\u7701\u7565\u4e86\u70b9. \u548c ()\nval a: Int = 1 + 1\n</code></pre></p> <p>if-else\u53ef\u4ee5\u6709\u8fd4\u56de\u503c\uff0c\u5177\u4f53\u8fd4\u56de\u503c\u53d6\u51b3\u4e8e\u6ee1\u8db3\u6761\u4ef6\u7684\u4ee3\u7801\u4f53\u7684\u6700\u540e\u4e00\u884c\u5185\u5bb9\u3002Scala\u4e2d\u6ca1\u6709\u4e09\u5143\u8fd0\u7b97\u7b26\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528if-else\u6765\u5b9e\u73b0\u4e09\u5143\u8fd0\u7b97\u7b26\u7684\u903b\u8f91\u3002 Text Only<pre><code>var age = 18\nval res: String = if (age &gt;= 18) {\n\u00a0\u00a0\"\u6210\u5e74\"\n} else {\n\u00a0\u00a0\"\u672a\u6210\u5e74\"\n}\n</code></pre> \u8fd4\u56de\u503c\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0c\u53d6\u5b83\u4eec\u5171\u540c\u7684\u7956\u5148\u7c7b\u578b\uff1a Text Only<pre><code>val res: Any = if (age &lt; 18) {\n\u00a0\u00a0\"\u7ae5\u5e74\"\n} else if (age &gt;= 18 &amp;&amp; age &lt; 30) {\n\u00a0\u00a0\"\u4e2d\u5e74\"\n} else {\n\u00a0\u00a0100\n}\n</code></pre></p> <p>For \u5faa\u73af\uff0c Scala \u4e3a for \u5faa\u73af\u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u7684\u7279\u6027\uff0c\u6240\u4ee5 for \u5faa\u73af\u7684\u8fd9\u4e9b\u7279\u6027\u88ab\u79f0 for \u63a8\u5bfc\u5f0f \u6216 for \u8868\u8fbe\u5f0f \u5305\u542b\u8fb9\u754c\u7684\u8303\u56f4\u904d\u5386\uff1a Text Only<pre><code>//i \u5c06\u4f1a\u4ece 1-3 \u5faa\u73af\uff0c \u524d\u540e\u95ed\u5408\nfor (i &lt;- 1 to 3) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 1 2 3\n}\n</code></pre> to\u4e0d\u662f\u5173\u952e\u5b57\uff0cto\u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u6240\u4ee5\u4ee5\u4e0a\u8fd8\u53ef\u4ee5\u5199\u6210\uff1a Text Only<pre><code>for (i &lt;- 1.to(3)) {\n\u00a0\u00a0print(i + \" \")\n}\n</code></pre> to\u662fRichInt\u7c7b\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c1\u4f1a\u88ab\u9690\u5f0f\u8f6c\u6362\u5305\u88c5\u6210RichInt\u7c7b\u7684\u5b9e\u4f8b\uff0c\u6240\u4ee5\u80fd\u8c03\u7528to\u65b9\u6cd5\uff0cto\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662fRange.Inclusive\uff0c\u5b83\u662fRange\u7c7b\u7684\u5b50\u7c7b\uff0cRange\u7c7b\u53c8\u662f\u96c6\u5408\u7c7b\u7684\u5b50\u7c7b\u3002</p> <p>\u4e0d\u5305\u542b\u8fb9\u754c\u7684\u8303\u56f4\u904d\u5386\uff1a Text Only<pre><code>for (i &lt;- Range(1,3)) {\n\u00a0\u00a0print(i + \" \")\u00a0 //\u6253\u5370 1 2\n}\nfor (i &lt;- 1 until 3) {\n\u00a0\u00a0print(i + \" \")\u00a0\u00a0//\u6253\u5370 1 2\n}\n</code></pre></p> <p>\u904d\u5386\u96c6\u5408\uff1a Text Only<pre><code>for (i &lt;- Array(1,2,3)) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 1 2 3\n}\nfor (i &lt;- List(1,2,3)) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 1 2 3\n}\nfor (i &lt;- Set(1,2,3)) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 1 2 3\n}\n</code></pre></p> <p>\u5faa\u73af\u5b88\u536b\uff0c\u4e5f\u79f0\u6761\u4ef6\u5224\u65ad\u5f0f\uff0c\u4fdd\u62a4\u5f0f\u4e3a true \u5219\u8fdb\u5165\u5faa\u73af\u4f53\u5185\u90e8\uff0c\u4e3a false \u5219\u8df3\u8fc7\u3002 Scala\u7684for\u5faa\u73af\u6ca1\u6709continue\uff0c\u800c\u662f\u4f7f\u7528\u5faa\u73af\u5b88\u536b\u6765\u5b9e\u73b0\u3002\u4ee5\u4e0b\u4ee3\u7801\u4f1a\u5728i\u4e0d\u7b49\u4e8e2\u7684\u65f6\u5019\u6267\u884c\uff1a Text Only<pre><code>for(i &lt;- 1 to 3 if i != 2) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 1 3\n}\n</code></pre> \u7b49\u4ef7\u4e8e\uff1a Text Only<pre><code>for (i &lt;- 1 to 3){\n\u00a0\u00a0if (i != 2) {\n\u00a0\u00a0\u00a0\u00a0print(i + \" \")\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5faa\u73af\u6b65\u957f, by \u8868\u793a\u6b65\u957f\uff1a Text Only<pre><code>for (i &lt;- 1 to 10 by 2) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 1 3 5 7 9\n}\n</code></pre> \u5012\u5e8f\u8f93\u51fa\uff1a Text Only<pre><code>for (i &lt;- 10 to 1 by -1) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 10 9 8 7 6 5 4 3 2 1\n}\n//\u7b49\u4ef7\u4e8e\nfor (i &lt;- 10 to 1 reverse) {\n\u00a0\u00a0print(i + \" \") //\u6253\u5370 10 9 8 7 6 5 4 3 2 1\n}\n</code></pre> \u6ce8\u610f\uff1a\u6b65\u957f\u4e0d\u80fd\u4e3a0\uff0c\u5426\u5219\u4f1a\u629b\u5f02\u5e38</p> <p>\u5d4c\u5957\u5faa\u73af\uff0cScala\u7684\u5d4c\u5957\u5faa\u73af\u53ef\u4ee5\u5199\u5728\u4e00\u4e2aif\u8bed\u53e5\u4e2d \u6253\u5370\u4e5d\u4e5d\u4e58\u6cd5\u8868\uff1a Text Only<pre><code>for (i &lt;- 1 to 9; j &lt;- 1 to i) {\n\u00a0\u00a0print(s\"${i}*${j}=${i * j} \")\n\u00a0\u00a0if (i == j) println()\n}\n</code></pre> \u7b49\u4ef7\u4e8e\uff1a Text Only<pre><code>for (i &lt;- 1 to 9) {\n\u00a0\u00a0for (j &lt;- 1 to i) {\n\u00a0\u00a0\u00a0\u00a0print(s\"${i}*${j}=${i * j} \")\n\u00a0\u00a0}\n\u00a0\u00a0println()\n}\n</code></pre></p> <p>\u5f15\u5165\u53d8\u91cf\uff0c\u53ef\u4ee5\u4e0d\u7528\u5728for\u5faa\u73af\u4f53\u91cc\u9762\u5b9a\u4e49\u53d8\u91cf\uff0c\u76f4\u63a5\u5728for\u8868\u8fbe\u5f0f\u91cc\u5b9a\u4e49 Text Only<pre><code>for(i &lt;- 1 to 3; j = 4 - i) {\n\u00a0\u00a0println(\"i=\" + i + \" j=\" + j)\n}\n</code></pre></p> <p>\u8bf4\u660e\uff1a\u5f53for \u63a8\u5bfc\u5f0f\u4e00\u884c\u4e2d\u6709\u591a\u4e2a\u8868\u8fbe\u5f0f\u65f6\uff0c\u9700\u8981\u7528 \u5206\u53f7; \u6765\u9694\u5f00\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6362\u884c\u6765\u9694\u5f00\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u82b1\u62ec\u53f7\u4e86\uff1a Text Only<pre><code>for {\n\u00a0\u00a0i &lt;- 1 to 3\n\u00a0\u00a0j = 4 - i\n} {\n\u00a0\u00a0println(\"i=\" + i + \" j=\" + j)\n}\n</code></pre></p> <p>for\u5faa\u73af\u8fd4\u56de\u503c\uff0c\u4e0eif\u8bed\u53e5\u7c7b\u4f3c\uff0cfor\u5faa\u73af\u4e5f\u6709\u8fd4\u56de\u503c\uff0c\u4f46\u662f\u9700\u8981\u4f7f\u7528yield\u5173\u952e\u5b57\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u96c6\u5408\uff08\u8fd9\u4e2ayield\u548cJava\u4e2d\u7684\u7ebf\u7a0b\u8ba9\u6b65\u7684\u5173\u952e\u5b57\u6ca1\u6709\u5173\u7cfb\uff09\uff0c\u5982\u679c\u4f7f\u7528yield\uff0cfor\u5faa\u73af\u5c31\u4e0d\u80fd\u6709\u5faa\u73af\u4f53\u4e86 Text Only<pre><code>val seq = for {\n\u00a0\u00a0i &lt;- 1 to 10\n\u00a0\u00a0if i % 2 == 0\n} yield i\nprintln(seq)\u00a0 //\u8f93\u51faVector(2, 4, 6, 8, 10)\n</code></pre></p> <p>Scala\u4e2d\u6709while\u548cdo..while\u5faa\u73af\uff0c\u56e0\u4e3awhile\u80fd\u505a\u7684\u4e8b\uff0cfor\u90fd\u80fd\u505a\uff0c\u5e76\u4e14\u80fd\u505a\u5f97\u66f4\u597d\uff0c\u6240\u4ee5\u63a8\u8350\u4f7f\u7528for\u5faa\u73af\u3002</p> <p>Java\u4e2d\u6709continue\u548cbreak\u6765\u4e2d\u65ad\u5faa\u73af\u7684\u6267\u884c\uff0ccontinue\u7528\u6765\u7ed3\u675f\u5f53\u524d\u8f6e\u6b21\u7684\u5faa\u73af\uff0cbreak\u7528\u6765\u4e2d\u65ad\u6574\u4e2a\u5faa\u73af\u7684\u6267\u884c\u3002\u4f46\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u9002\u5e94\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u7279\u70b9\uff0cScala\u53d6\u6d88\u4e86\u8fd9\u4e24\u4e2a\u5173\u952e\u5b57\uff0ccontinue\u7684\u529f\u80fd\u53ef\u4ee5\u4f7f\u7528\u5faa\u73af\u5b88\u536b\u6765\u5b9e\u73b0\uff0c\u800cbreak\u5219\u662f\u4f7f\u7528\u629b\u51fa\u5f02\u5e38\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002 \u91c7\u7528\u629b\u51fa\u5f02\u5e38\u7684\u65b9\u5f0f\u9000\u51fa\u5faa\u73af\uff1a Text Only<pre><code>try {\n\u00a0\u00a0for (i &lt;- 1 to 5) {\n\u00a0\u00a0\u00a0\u00a0if (i == 3) throw new RuntimeException\n\u00a0\u00a0\u00a0\u00a0println(i)\n\u00a0\u00a0}\n} catch {\n\u00a0\u00a0case e: Exception =&gt; //\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff0c\u53ea\u662f\u9000\u51fa\u5faa\u73af\n}\n</code></pre> \u4ee5\u4e0a\u5b9e\u73b0\u8fc7\u7a0b\u8fc7\u4e8e\u7e41\u7410\uff0c\u53ef\u4ee5\u91c7\u7528 Scala \u81ea\u5e26\u7684\u51fd\u6570\u9000\u51fa\u5faa\u73af\uff0c\u539f\u7406\u5176\u5b9e\u5c31\u662f\u629b\u51fa\u5f02\u5e38\u7684\u65b9\u5f0f\uff0c\u53ea\u4e0d\u8fc7\u662fScala\u5c01\u88c5\u4e86\u4e00\u4e0b\uff1a Text Only<pre><code>Breaks.breakable(\n\u00a0\u00a0for (i &lt;- 1 to 5) {\n\u00a0\u00a0\u00a0\u00a0if (i == 3) Breaks.break()\n\u00a0\u00a0\u00a0\u00a0println(i)\n\u00a0\u00a0}\n)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/5-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/","title":"5-\u51fd\u6570\u5f0f\u7f16\u7a0b","text":"<p> \u7ea6 3390 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 68 \u5206\u949f</p> <p>\u51fd\u6570\u5b9a\u4e49\u7684\u57fa\u672c\u8bed\u6cd5\uff1a  \u5728Java\u4e2d\u53ea\u6709\u65b9\u6cd5\u7684\u6982\u5ff5\uff0c\u5e76\u4e14\u53ea\u80fd\u5728\u7c7b\u4e2d\u5b9a\u4e49\uff0c\u4f46\u662f\u5728Scala\u4e2d\u662f\u533a\u5206\u51fd\u6570\u548c\u65b9\u6cd5\u4e24\u4e2a\u6982\u5ff5\u7684\uff0c\u53ea\u6709\u5728\u7c7b\u4e2d\u5b9a\u4e49\u7684\u51fd\u6570\u624d\u79f0\u4e4b\u4e3a\u65b9\u6cd5\uff0c\u4e8e\u662f\u5728Scala\u4e2d\u65b9\u6cd5\u4e0e\u51fd\u6570\u7684\u533a\u522b\u6709\u4e24\u70b9\uff1a 1.\u51fd\u6570\u6ca1\u6709\u91cd\u8f7d\u548c\u91cd\u5199\u7684\u6982\u5ff5\uff0c\u4e0d\u80fd\u5728\u540c\u4e00\u4e2a\u4f5c\u7528\u57df\u5185\u5b9a\u4e49\u4e24\u4e2a\u540c\u540d\u7684\u51fd\u6570\uff0c\u4f46\u662f\u65b9\u6cd5\u53ef\u4ee5\u8fdb\u884c\u91cd\u8f7d\u548c\u91cd\u5199\u3002 2.\u65b9\u6cd5\u53ea\u80fd\u63d0\u4f9b\u7c7b\u7684\u5bf9\u8c61\u6765\u8c03\u7528\uff0c\u800c\u51fd\u6570\u58f0\u660e\u4e4b\u540e\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u3002 \u51fd\u6570\u548c\u65b9\u6cd5\u9664\u4e86\u4ee5\u4e0a\u4e24\u70b9\u4e0d\u540c\u5916\uff0c\u5176\u5b83\u6ca1\u6709\u4ec0\u4e48\u4e0d\u540c\uff0cScala\u4e2d\u65b9\u6cd5\u540c\u6837\u53ef\u4ee5\u50cf\u51fd\u6570\u4e00\u6837\u8d4b\u503c\u7ed9\u53d8\u91cf\u3002 \u5728\u7c7b\u7684\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u7684\u79f0\u4e3a\u51fd\u6570\uff0c\u540c\u4e00\u4e2a\u4f5c\u7528\u57df\u4e0d\u80fd\u6709\u540c\u540d\u7684\u51fd\u6570\uff0c\u4ee5\u4e0b\u4f1a\u62a5\u9519\uff1a Text Only<pre><code>object FunctionAndMethod {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0//\u9519\u8bef\uff0c\u540c\u4e00\u4e2a\u4f5c\u7528\u57df\u4e0d\u80fd\u6709\u540c\u540d\u7684\u51fd\u6570\n\u00a0\u00a0\u00a0\u00a0def func(name: String): Unit = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(name)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0def func(): Unit = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(\"\u6ca1\u6709\u53c2\u6570\u7684\u51fd\u6570\")\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n}\n</code></pre> \u5728\u7c7b\u4e2d\u5b9a\u4e49\u7684\u79f0\u4e3a\u65b9\u6cd5\uff0c\u65b9\u6cd5\u540d\u53ef\u4ee5\u76f8\u540c\uff0c\u5373\u65b9\u6cd5\u53ef\u4ee5\u8fdb\u884c\u91cd\u8f7d\u548c\u91cd\u5199 Text Only<pre><code>object FunctionAndMethod {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0func(\"alice\")\n\u00a0\u00a0\u00a0\u00a0func()\n\u00a0\u00a0}\n\n\u00a0\u00a0def func(name: String): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(name)\n\u00a0\u00a0}\n\n\u00a0\u00a0def func(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"\u6ca1\u6709\u53c2\u6570\u7684\u65b9\u6cd5\")\n\u00a0\u00a0}\n}\n</code></pre></p> <p>Scala\u51fd\u6570\u53c2\u6570\u6709\u5982\u4e0b\u7279\u70b9\uff1a 1.\u53ef\u53d8\u53c2\u6570\uff0c\u5982\u679c\u53c2\u6570\u5217\u8868\u4e2d\u5b58\u5728\u591a\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u53ef\u53d8\u53c2\u6570\u53ea\u80fd\u653e\u5728\u6700\u540e Text Only<pre><code>def test(args : String*): Unit = {\n\u00a0\u00a0println(args)\n}\n</code></pre></p> <p>\u4ee5\u4e0b\u4e24\u4e2a\u7279\u70b9\u662fJava\u65b9\u6cd5\u6ca1\u6709\u7684\uff1a 2.\u53c2\u6570\u53ef\u4ee5\u6709\u9ed8\u8ba4\u503c\uff0c\u4e00\u822c\u5c06\u6709\u9ed8\u8ba4\u503c\u7684\u53c2\u6570\u653e\u7f6e\u5728\u53c2\u6570\u5217\u8868\u7684\u540e\u9762 Text Only<pre><code>def test(name: String, age: Int = 30): Unit = {\n\u00a0\u00a0println(s\"$name, $age\")\n}\n</code></pre> 3.\u5e26\u540d\u53c2\u6570\u8c03\u7528 Text Only<pre><code>def test(name: String, age: Int = 30): Unit = {\n\u00a0\u00a0println(s\"$name, $age\")\n}\ntest(age = 18, name = \"bob\")\n</code></pre></p> <p>\u51fd\u6570\u81f3\u7b80\u539f\u5219\uff1a\u80fd\u7701\u5219\u7701 \u5b8c\u6574\u51fd\u6570\u7684\u5b9a\u4e49\uff1a Text Only<pre><code>def f(name: String): String = {\n\u00a0\u00a0return name\n}\n</code></pre> 1.return\u53ef\u4ee5\u7701\u7565\uff0c Scala \u4f1a\u4f7f\u7528\u51fd\u6570\u4f53\u7684\u6700\u540e\u4e00\u884c\u4ee3\u7801\u4f5c\u4e3a\u8fd4\u56de\u503c Text Only<pre><code>def f0(name: String): String = {\n\u00a0\u00a0name\n}\n</code></pre> 2.\u5982\u679c\u51fd\u6570\u4f53\u53ea\u6709\u4e00\u884c\u4ee3\u7801\uff0c\u53ef\u4ee5\u7701\u7565\u82b1\u62ec\u53f7 Text Only<pre><code>def f1(name: String): String = name\n</code></pre> 3.\u8fd4\u56de\u503c\u7c7b\u578b\u5982\u679c\u80fd\u591f\u63a8\u65ad\u51fa\u6765\uff0c\u90a3\u4e48\u8fd4\u56de\u503c\u7c7b\u578b\u53ef\u4ee5\u7701\u7565\uff08 :\u548c\u8fd4\u56de\u503c\u7c7b\u578b\u4e00\u8d77\u7701\u7565\uff09 Text Only<pre><code>def f2(name: String) = name\n</code></pre> \u6ce8\u610f\uff1a\u5982\u679c\u6709 return\uff0c\u5219\u4e0d\u80fd\u7701\u7565\u8fd4\u56de\u503c\u7c7b\u578b\uff0c\u5fc5\u987b\u6307\u5b9a Text Only<pre><code>def f3(name: String) = return name //\u9519\u8bef\uff0c\u5982\u679c\u6709 return\uff0c\u5219\u4e0d\u80fd\u7701\u7565\u8fd4\u56de\u503c\u7c7b\u578b\uff0c\u5fc5\u987b\u6307\u5b9a\n</code></pre> 4.\u5982\u679c\u51fd\u6570\u660e\u786e\u58f0\u660e unit\uff0c\u90a3\u4e48\u5373\u4f7f\u51fd\u6570\u4f53\u4e2d\u4f7f\u7528 return \u5173\u952e\u5b57\u4e5f\u4e0d\u8d77\u4f5c\u7528 Text Only<pre><code>def f4(name: String): Unit = {\n\u00a0\u00a0return name\n}\n\nprintln(f4(\"alice\")) //\u8f93\u51fa()\n</code></pre> 5.\u5982\u679c\u8fd4\u56de\u503c\u7c7b\u578b\u662fUnit\uff0c\u53ef\u4ee5\u7701\u7565\u7b49\u53f7 Text Only<pre><code>def f5(name: String) {\n\u00a0\u00a0println(name)\n}\n</code></pre> 6.\u5982\u679c\u51fd\u6570\u65e0\u53c2\uff0c\u4f46\u662f\u51fd\u6570\u58f0\u660e\u65f6\u52a0\u4e86()\uff0c\u90a3\u4e48\u8c03\u7528\u65f6\uff0c\u5c0f\u62ec\u53f7\uff0c\u53ef\u52a0\u53ef\u4e0d\u52a0 Text Only<pre><code>def f6() {\n\u00a0\u00a0println(\"\u7a7a\u53c2\uff0c\u4f46\u662f\u51fd\u6570\u58f0\u660e\u65f6\u52a0\u4e86()\")\n}\nf6\n</code></pre> \u5982\u679c\u51fd\u6570\u65e0\u53c2\uff0c\u90a3\u4e48\u51fd\u6570\u58f0\u660e\u65f6\u5c0f\u62ec\u53f7\u53ef\u4ee5\u7701\u7565\uff0c\u4f46\u662f\u8c03\u7528\u65f6\u5c0f\u62ec\u53f7\u5fc5\u987b\u7701\u7565 Text Only<pre><code>def f7 {\n\u00a0\u00a0println(\"\u7a7a\u53c2\uff0c\u4f46\u662f\u51fd\u6570\u58f0\u660e\u65f6\u52a0\u4e86()\")\n}\nf7\n//f7() //\u9519\u8bef\uff0c\u8c03\u7528\u65f6\u5c0f\u62ec\u53f7\u5fc5\u987b\u7701\u7565\n</code></pre></p> <p>7.\u533f\u540d\u51fd\u6570\uff0clambda\u8868\u8fbe\u5f0f \u5982\u679c\u5e76\u4e0d\u5173\u5fc3\u51fd\u6570\u540d\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u533f\u540d\u51fd\u6570\u7684\u5199\u6cd5\uff0c\u533f\u540d\u51fd\u6570\u7684\u5b9a\u4e49\u662f\uff1a(\u53c2\u6570\u540d:\u53c2\u6570\u7c7b\u578b\uff0c...) =&gt; {\u51fd\u6570\u4f53} \uff0c\u56e0\u4e3a\u8fd4\u56de\u503c\u7c7b\u578b\u90fd\u662f\u7f16\u8bd1\u5668\u53ef\u4ee5\u63a8\u65ad\u51fa\u6765\u7684\uff0c\u6240\u4ee5\u5b9a\u4e49\u533f\u540d\u51fd\u6570\u65f6\u4e0d\u9700\u8981\uff0c\u4e5f\u4e0d\u80fd\u6307\u5b9a\u8fd4\u56de\u503c\u7c7b\u578b\u3002 Text Only<pre><code>(name: String) =&gt; println(name)\n</code></pre> 7.1 \u533f\u540d\u51fd\u6570\u53ef\u4ee5\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf Text Only<pre><code>val f8 = (name: String) =&gt; println(name)\nf8(\"bob\")\n</code></pre> \u533f\u540d\u51fd\u6570\u7684\u7c7b\u578b\u662f\uff1a\u53c2\u6570\u7c7b\u578b =&gt; \u8fd4\u56de\u503c\u7c7b\u578b\uff0c\u6240\u4ee5\u4e0a\u9762f8\u7684\u7c7b\u578b\u53ef\u4ee5\u6839\u636e\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u63a8\u5bfc\u5f97\u5230\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u660e\u786e\u7684\u5199\u51fa\u6765 String =&gt; Unit Text Only<pre><code>val f8: String =&gt; Unit = (name: String) =&gt; println(name)\n</code></pre></p> <p>7.2 \u533f\u540d\u51fd\u6570\u7684\u7b80\u5316\uff1a 7.2.1 \u533f\u540d\u51fd\u6570\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\u65f6\uff0c\u62ec\u53f7\u53ef\u4ee5\u7701\u7565\uff0c\u6b64\u65f6\u53c2\u6570\u7684\u7c7b\u578b\u4e5f\u5fc5\u987b\u8ddf\u7740\u4e00\u8d77\u7701\u7565\uff0c\u53c2\u6570\u7684\u7c7b\u578b\u53ef\u4ee5\u6839\u636ef8\u7684\u7c7b\u578b\u8fdb\u884c\u63a8\u5bfc\uff08\u6839\u636e\u88ab\u8d4b\u503c\u7684\u53d8\u91cf\u7684\u7c7b\u578b\u8fdb\u884c\u63a8\u5bfc\uff09\uff0c\u6240\u4ee5f8\u7684\u7c7b\u578b\u5fc5\u987b\u660e\u786e\u6307\u5b9a\u3002\u4e5f\u5c31\u662f\u5728\u533f\u540d\u51fd\u6570\u4e2d\uff0c \u88ab\u8d4b\u503c\u7684\u53d8\u91cf\u7684\u7c7b\u578b\u548c\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a\uff1a Text Only<pre><code>val f8: String =&gt; Unit = name =&gt; println(name)\n</code></pre> 7.2.2\u00a0\u533f\u540d\u51fd\u6570\u5982\u679c\u53ea\u6709\u4e00\u884c\uff0c \u5219\u82b1\u62ec\u53f7\u4e5f\u53ef\u4ee5\u7701\u7565 7.2.3 \u533f\u540d\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012\u65f6\uff0c\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u53ef\u4ee5\u7701\u7565\uff0c\u4f1a\u6839\u636e\u5f62\u53c2\u8fdb\u884c\u81ea\u52a8\u7684\u63a8\u5bfc\uff08\u6839\u636e\u88ab\u8d4b\u503c\u7684\u53d8\u91cf\u7684\u7c7b\u578b\u8fdb\u884c\u63a8\u5bfc\uff09\uff0c\u533f\u540d\u51fd\u6570\u6700\u4e3b\u8981\u7684\u4f5c\u7528\u5c31\u662f\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012 Text Only<pre><code>def f9(func: String =&gt; Unit): Unit = {\n\u00a0\u00a0func(\"xxx\")\n}\nf9(name =&gt; println(name))\n</code></pre> 7.2.4\u00a0\u5982\u679c\u533f\u540d\u51fd\u6570\u53c2\u6570\u5217\u8868\u4e2d\u7684\u6240\u6709\u53c2\u6570\u53ea\u5728\u51fd\u6570\u4f53\u51fa\u73b0\u4e00\u6b21\uff0c\u5e76\u4e14\u662f\u6309\u7167\u53c2\u6570\u5217\u8868\u4e2d\u53c2\u6570\u58f0\u660e\u7684\u987a\u5e8f\u51fa\u73b0\u7684\uff0c\u5219\u53c2\u6570\u53ef\u4ee5\u7701\u7565\uff0c\u5e76\u5c06\u7528\u5230\u8be5\u53c2\u6570\u7684\u5730\u65b9\u7528_\u4e0b\u5212\u7ebf\u4ee3\u66ff Text Only<pre><code>f9(println(_))\n</code></pre> 7.2.5 \u53ef\u4ee5\u770b\u5230\u533f\u540d\u51fd\u6570 name =&gt; println(name) \u53ea\u662f\u8c03\u7528\u4e86println\u51fd\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5c06println\u51fd\u6570\u8fdb\u884c\u4f20\u9012\uff0c\u4e5f\u5c31\u662f\u5c06println\u51fd\u6570\u76f4\u63a5\u8d4b\u503c\u7ed9\u5f62\u53c2func\uff08\u8fd9\u5c31\u662fJava\u4e2d\u7684\u65b9\u6cd5\u5f15\u7528\u7684\u6765\u6e90 10-Scala\u7684\u65b9\u6cd5 \u4e0e Java\u7684\u65b9\u6cd5\u5f15\u7528\u00a0\uff09\uff0c\u8fd9\u4e0e\u524d\u9762\u5c06\u533f\u540d\u51fd\u6570\u8d4b\u503c\u7ed9\u5f62\u53c2func\u662f\u6709\u533a\u522b\u7684\u3002 Text Only<pre><code>f9(println)\n</code></pre></p> <p>\u7701\u7565\u89c4\u5219\u5c31\u8bb0\u4f4f\u4e00\u70b9\uff1a\u975e\u533f\u540d\u51fd\u6570\u7701return\u548c\u8fd4\u56de\u503c\u7c7b\u578b\uff1b\u5728\u533f\u540d\u51fd\u6570\u4e2d\uff0c \u88ab\u8d4b\u503c\u7684\u53d8\u91cf\u7684\u7c7b\u578b\u548c\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u5fc5\u987b\u81f3\u5c11\u6307\u5b9a\u4e00\u4e2a\uff0c\u6240\u4ee5\u5982\u679c\u533f\u540d\u51fd\u6570\u5982\u679c\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u53ef\u4ee5\u66f4\u8fdb\u4e00\u6b65\u7701\u7565\u53c2\u6570\u7c7b\u578b\uff0c\u56e0\u4e3a\u5176\u53c2\u6570\u7c7b\u578b\u53ef\u4ee5\u6839\u636e\u5f62\u53c2\uff08\u5373\u88ab\u8d4b\u503c\u7684\u53d8\u91cf\uff09\u7684\u7c7b\u578b\u63a8\u5bfc\u51fa\u6765\u3002</p> <p>\u51fd\u6570\u7684\u9ad8\u9636\u7528\u6cd5\uff1a 1. \u51fd\u6570\u53ef\u4ee5\u4f5c\u4e3a\u503c\u8fdb\u884c\u4f20\u9012\uff0c\u4e5f\u5c31\u662f\u628a\u51fd\u6570\u4f53\u5f53\u4f5c\u662f\u4e00\u4e2a\u5bf9\u8c61\u8d4b\u503c\u7ed9\u4e00\u4e2a\u5f15\u7528 \u533f\u540d\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf Text Only<pre><code>val f8: String =&gt; Unit = name =&gt; println(name)\n</code></pre> \u90a3\u975e\u533f\u540d\u51fd\u6570\u5462\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u76f4\u63a5\u5c06\u51fd\u6570\u540d\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf\uff0c\u7b54\u6848\u662f\u53ef\u4ee5\uff0c\u8fd9\u76f8\u5f53\u4e8e\u662f\u628a\u4e00\u4e2a\u5f15\u7528\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u5f15\u7528\uff0c\u6709\u5982\u4e0b\u4e24\u79cd\u65b9\u5f0f\uff1a \u4e00\u662f\u6307\u76f4\u63a5\u5c06\u51fd\u6570\u540d\u8d4b\u503c\u7ed9\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f46\u5fc5\u987b\u6307\u5b9a\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u51fd\u6570\u7684\u7c7b\u578b Text Only<pre><code>def fun(): Unit = {\n\u00a0\u00a0println(\"i like scala\")\n}\n//\u5982\u679c\u60f3\u5c06fun\u51fd\u6570\u8d4b\u503c\u7ed9\u5e38\u91cff\uff0c\u4e0d\u80fd\u76f4\u63a5\u50cf\u4e0b\u9762\u8fd9\u6837\u5199\uff0c\u56e0\u4e3a\u76f4\u63a5\u5199fun\u662f\u8c03\u7528fun\u51fd\u6570\nval f0 = fun\nprintln(f0) //\u6253\u5370()\n//\u5fc5\u987b\u6307\u5b9a\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u6307\u660e\u53d8\u91cf\u662f\u4e00\u4e2a\u51fd\u6570\u7c7b\u578b\uff0c\u8fd9\u6837\u624d\u4e0d\u4f1a\u5f15\u8d77\u6b67\u4e49\nval f1: () =&gt; Unit = fun\nprintln(f1) //\u6253\u5370fun\u51fd\u6570\u7684\u5f15\u7528\u5730\u5740\n</code></pre> \u4e8c\u662f\u6307\u5982\u679c\u4e0d\u6307\u5b9a\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u90a3\u5c31\u9700\u8981\u5728\u51fd\u6570\u540d\u540e\u9762\u52a0\u4e00\u4e2a _\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e0d\u662f\u51fd\u6570\u8c03\u7528 Text Only<pre><code>val f2 = fun _\nprintln(f2)\u00a0//\u6253\u5370fun\u51fd\u6570\u7684\u5f15\u7528\u5730\u5740\n</code></pre></p> <p>2. \u51fd\u6570\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u8fdb\u884c\u4f20\u9012 Text Only<pre><code>def calculator(a: Int, b: Int, op: (Int, Int) =&gt; Int): Int = {\n\u00a0\u00a0op(a, b)\n}\nprintln(calculator(2, 3, (x , y) =&gt; x + y))\n</code></pre></p> <p>3. \u51fd\u6570\u53ef\u4ee5\u4f5c\u4e3a\u51fd\u6570\u8fd4\u56de\u503c\u8fd4\u56de Text Only<pre><code>def f(a:String): String =&gt; Unit ={\n\u00a0\u00a0def f(b:String): Unit ={\n\u00a0\u00a0\u00a0\u00a0println(a + \":\" + b)\n\u00a0\u00a0}\n\u00a0\u00a0f\u00a0\u00a0//\u5c06\u51fd\u6570\u76f4\u63a5\u8fd4\u56de\n}\nf(\"a\")(\"b\") //\u8c03\u7528\n</code></pre></p> <p>\u6848\u4f8b\u7ec3\u4e60\uff1a 1.\u5b9a\u4e49\u4e00\u4e2a\u533f\u540d\u51fd\u6570\uff0c\u5e76\u5c06\u5b83\u4f5c\u4e3a\u503c\u8d4b\u7ed9\u53d8\u91cf fun\u3002\u51fd\u6570\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u7c7b\u578b\u5206\u522b \u4e3a Int\uff0c String\uff0c Char\uff0c\u8fd4\u56de\u503c\u7c7b\u578b\u4e3a Boolean\u3002\u8981\u6c42\u8c03\u7528\u51fd\u6570f(0) (\"\") ('0')\u5f97\u5230\u8fd4\u56de\u503c\u4e3a false\uff0c\u5176\u5b83\u60c5\u51b5\u5747\u8fd4\u56de true\u3002 Text Only<pre><code>val fun = (a: Int, b: String, c: Char) =&gt; !(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n</code></pre> \u56e0\u4e3a\u5728\u533f\u540d\u51fd\u6570\u4e2d\uff0c \u88ab\u8d4b\u503c\u7684\u53d8\u91cf\u7684\u7c7b\u578b\u548c\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u53ef\u4ee5\u53ea\u6307\u5b9a\u4e00\u4e2a\uff0c\u6240\u4ee5\u8fd8\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a Text Only<pre><code>val fun: (Int, String, Char) =&gt; Boolean = (a, b, c) =&gt; !(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n</code></pre> 2. \u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570 f\uff0c\u5b83\u63a5\u6536\u4e00\u4e2a Int \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff08\u8bb0\u4f5c f1\uff09\u3002\u5b83\u8fd4\u56de\u7684\u51fd\u6570 f1\uff0c\u63a5\u6536\u4e00\u4e2a String \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u540c\u6837\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff08\u8bb0\u4f5c f2\uff09\u3002\u51fd\u6570 f2 \u63a5\u6536\u4e00\u4e2a Char \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a Boolean \u7684\u503c\u3002\u8981\u6c42\u8c03\u7528\u51fd\u6570 f(0) (\"\") ('0')\u5f97\u5230\u8fd4\u56de\u503c\u4e3a false\uff0c\u5176\u5b83\u60c5\u51b5\u5747\u8fd4\u56de true\u3002 Text Only<pre><code>def f(a: Int): String =&gt; Char =&gt; Boolean = {\n\u00a0\u00a0def f(b: String): Char =&gt; Boolean = {\n\u00a0\u00a0\u00a0\u00a0def f(c: Char): Boolean = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0!(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0f\n\u00a0\u00a0}\n\u00a0\u00a0f\n}\n</code></pre> \u6216\u8005\uff1a Text Only<pre><code>def f(a: Int) = {\n\u00a0\u00a0def f(b: String) = {\n\u00a0\u00a0\u00a0\u00a0def f(c: Char) = {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0!(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0f _\n\u00a0\u00a0}\n\u00a0\u00a0f _\n}\n</code></pre> \u56e0\u4e3a\u5e76\u4e0d\u5173\u5fc3\u5185\u5c42\u51fd\u6570\u7684\u540d\u5b57\uff0c\u6240\u4ee5\u53ef\u4ee5\u91c7\u7528\u533f\u540d\u51fd\u6570\u7684\u5199\u6cd5\uff1a Text Only<pre><code>def f(a: Int) = {\n\u00a0\u00a0(b: String) =&gt; (c: Char) =&gt; !(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n}\n</code></pre> \u5728\u533f\u540d\u51fd\u6570\u4e2d\uff0c \u88ab\u8d4b\u503c\u7684\u53d8\u91cf\u7684\u7c7b\u578b\u548c\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u53ef\u4ee5\u53ea\u6307\u5b9a\u4e00\u4e2a\uff0c\u6240\u4ee5\u8fd8\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a Text Only<pre><code>def f(a: Int): String =&gt; Char =&gt; Boolean = {\n\u00a0\u00a0b =&gt; c =&gt; !(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n}\n</code></pre> \u8c03\u7528\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230f(0)\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e8e\u662f\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c\u51fd\u6570\u7684\u8c03\u7528\uff0c\u4f46\u662f\u4ecejvm\u6267\u884c\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5f53f(0)\u8c03\u7528\u7ed3\u675f\u65f6\uff0cf(0)\u5df2\u7ecf\u5f39\u6808\u4e86\uff0c\u6309\u9053\u7406\u6765\u8bf4f(0)\u7684\u5c40\u90e8\u53d8\u91cfa\u4e5f\u5df2\u7ecf\u8ddf\u7740\u6ca1\u4e86\uff0c\u4e3a\u4ec0\u4e48\u5185\u5c42\u51fd\u6570\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528a\u7684\u503c\uff1f\u56e0\u4e3a\u5728Scala\u4e2d\uff0c\u51fd\u6570\u4e5f\u5df2\u7ecf\u53d8\u6210\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e8e\u662f\u5b83\u7684\u5c40\u90e8\u53d8\u91cf\u4e5f\u5c31\u8ddf\u7740\u5bf9\u8c61\u4e00\u8d77\u5206\u914d\u5728\u4e86\u5806\u7a7a\u95f4\u4e2d\uff0c\u4e8e\u662f\u5230f(0)\u5f39\u6808\u4e4b\u540e\uff0c\u5b83\u7684\u5c40\u90e8\u53d8\u91cf\u5e76\u6ca1\u6709\u88ab\u8ddf\u7740\u4e00\u8d77\u6e05\u9664\u6389\uff0c\u4e8e\u662f\u5185\u5c42\u51fd\u6570\u4f9d\u65e7\u53ef\u4ee5\u7ee7\u7eed\u8bbf\u95ee\u5f97\u5230\uff0c\u6b64\u65f6\u5185\u5c42\u51fd\u6570\u6240\u5904\u7684\u53d8\u91cf\u7684\u73af\u5883\u79f0\u4e3a\u95ed\u5305\u3002 Text Only<pre><code>f(0)(\"\")('0')\n</code></pre> \u4e0a\u9762\u51fd\u6570\u4e2d\u5957\u51fd\u6570\u7684\u5199\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u8fde\u7eed\u4f7f\u7528()\u8c03\u7528\u7684\u6548\u679c\uff0c\u8fd9\u79cd\u8fde\u7eed\u4f7f\u7528()\u8c03\u7528\u7684\u6548\u679c\u5c31\u662f\u67ef\u91cc\u5316\uff0c\u5373 \u51fd\u6570\u67ef\u91cc\u5316\u5c31\u662f \u628a\u4e00\u4e2a\u53c2\u6570\u5217\u8868\u7684\u591a\u4e2a\u53c2\u6570\u53d8\u6210\u591a\u4e2a\u53c2\u6570\u5217\u8868\u3002Scala\u652f\u6301\u4e86\u67ef\u91cc\u5316\uff0c\u4e8e\u662f\u4e0a\u8ff0\u51fd\u6570\u8fd8\u53ef\u4ee5\u5199\u6210\u8fd9\u6837\uff1a Text Only<pre><code>def f(a:Int)(b:String)(c:Char): Boolean ={\n\u00a0\u00a0!(a == 0 &amp;&amp; b == \"\" &amp;&amp; c == '0')\n}\n</code></pre> \u8c03\u7528\u4f9d\u65e7\u662f\uff0c\u4f46\u662ff(0)\u7684\u8fd4\u56de\u503c\u5df2\u7ecf\u4e0d\u662f\u51fd\u6570\u4e86\uff0c\u66f4\u786e\u5207\u7684\u8bf4\uff0cf(0)\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u518d\u66f4\u786e\u5207\u7684\u8bf4\uff0c\u67ef\u91cc\u5316\u4e4b\u540e\u7684\u51fd\u6570\u5c31\u662f\u4e00\u4e2a\u6574\u4f53\u7684\u51fd\u6570\uff0c\u4e0d\u80fd\u5206\u5f00\u8c03\u7528\u4e86 Text Only<pre><code>f(0)(\"\")('0')\n</code></pre></p> <p>\u95ed\u5305\u7684\u4e00\u4e2a\u5178\u578b\u5e94\u7528\u662f\u53ef\u4ee5\u5199\u51fa\u901a\u7528\u6027\u5f88\u5f3a\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u4e0b\u9762\u53ef\u4ee5\u901a\u8fc7\u6539\u53d8\u4f20\u7ed9addX\u7684\u53c2\u6570\u751f\u6210\u5177\u6709\u76f8\u4f3c\u529f\u80fd\uff0c\u4f46\u53c8\u529f\u80fd\u4e0d\u540c\u7684\u51fd\u6570\uff1a Text Only<pre><code>def addX(a:Int): Int =&gt; Int ={\n\u00a0\u00a0def f(b:Int): Int = a+b\n\u00a0\u00a0f\n}\n\nval addFour = addX(4) //\u751f\u6210\u4e00\u4e2a\u529f\u80fd\u662f\u52a04\u7684\u51fd\u6570\nprintln(addFour(5))\nval addFive = addX(5) ////\u751f\u6210\u4e00\u4e2a\u529f\u80fd\u662f\u52a05\u7684\u51fd\u6570\nprintln(addFive(5))\n</code></pre> \u4e0a\u8ff0addX\u51fd\u6570\u6839\u636e\u7b80\u5316\u539f\u5219\u8fd8\u53ef\u4ee5\u5199\u6210 Text Only<pre><code>def addX(a: Int): Int =&gt; Int = a + _\n</code></pre></p> <p>\u9012\u5f52\u4e0e\u5c3e\u9012\u5f52 \u53ea\u8981\u80fd\u7528for\u5faa\u73af\u89e3\u51b3\u7684\u95ee\u9898\u90fd\u53ef\u4ee5\u4f7f\u7528\u9012\u5f52\u6765\u89e3\u51b3\uff0c\u4f46\u662f\u6709\u4e9b\u95ee\u9898\u4f7f\u7528for\u5faa\u73af\u662f\u89e3\u51b3\u4e0d\u4e86\u7684\uff0c\u5fc5\u987b\u9012\u5f52\uff0c\u6bd4\u5982\u6c49\u8bfa\u5854\u95ee\u9898\uff0c\u6240\u4ee5\u9012\u5f52\u662ffor\u5faa\u73af\u7684\u8d85\u96c6\uff0c\u5728\u7eaf\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\u4e2d\u5c31\u6ca1\u6709for\u5faa\u73af\uff0c\u53ea\u6709\u9012\u5f52\u3002 \u8ba1\u7b97n\u7684\u9636\u4e58\u7684for\u5faa\u73af\u7684\u5b9e\u73b0\uff1a Text Only<pre><code>var result: Int = 1\nfor (i &lt;- 1 to 5) {\n\u00a0\u00a0result *= i\n}\n\nprintln(result)\n</code></pre> \u8ba1\u7b97n\u7684\u9636\u4e58\u7684\u9012\u5f52\u5b9e\u73b0\uff1a Text Only<pre><code>def factorial(n: Int): Int = {\n\u00a0\u00a0if (n == 0) return 1 //\u8fd9\u4e2areturn\u5fc5\u987b\u4fdd\u7559\uff0c\u56e0\u4e3a\u4e0d\u662f\u6700\u540e\u4e00\u884c\u4ee3\u7801\n\u00a0\u00a0n * factorial(n - 1)\n}\n\nprintln(factorial(5))\n</code></pre> \u5728\u9012\u5f52\u5b9e\u73b0\u4e2d\uff0c\u6bcf\u4e00\u5c42\u7684\u51fd\u6570\u8c03\u7528\u7684\u6808\u5e27\u90fd\u8981\u4fdd\u7559\uff0c\u8fd9\u65e0\u7591\u662f\u6ca1\u6709for\u5faa\u73af\u5b9e\u73b0\u6765\u5f97\u66f4\u9ad8\u6548\uff0c\u6211\u4eec\u77e5\u9053\u6240\u6709for\u5faa\u73af\u90fd\u53ef\u4ee5\u4f7f\u7528\u9012\u5f52\u5b9e\u73b0\uff0c\u90a3\u6709\u6ca1\u6709\u4e00\u79cd\u9012\u5f52\u7684\u5f62\u5f0f\u53ef\u4ee5\u5b9e\u73b0for\u5faa\u73af\u6240\u505a\u7684\u4e8b\u60c5\uff0c\u53c8\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u4fdd\u7559\u9012\u5f52\u8c03\u7528\u7684\u6808\u5e27\u5462\uff1f\u7b54\u6848\u5c31\u662f\u5c3e\u9012\u5f52\uff0c\u5c3e\u9012\u5f52\u5c31\u662f\u53ea\u5728\u51fd\u6570\u7684\u672b\u5c3e\u8c03\u7528\u81ea\u5df1\uff0c\u4e0d\u505a\u9700\u8981\u7b49\u5f85\u4e0b\u6b21\u8c03\u7528\u7ed3\u679c\u7684\u8ba1\u7b97\uff0c\u5f62\u6210\u4e00\u79cd\u5faa\u73af\u7684\u6548\u679c\u3002\u4e0a\u8ff0for\u5faa\u73af\u7528\u5c3e\u9012\u5f52\u5b9e\u73b0\uff1a Text Only<pre><code>def tailFactorial(n: Int): Int = {\n\u00a0\u00a0@tailrec\n\u00a0\u00a0def loop(n: Int, result: Int): Int = {\n\u00a0\u00a0\u00a0\u00a0if (n == 0) return result\n\u00a0\u00a0\u00a0\u00a0loop(n - 1, n * result)\n\u00a0\u00a0}\n\u00a0\u00a0loop(n, 1)\n}\n\nprintln(tailFactorial(5))\n</code></pre> loop\u5c31\u662f\u5c3e\u9012\u5f52\u51fd\u6570\u7684\u5b9e\u73b0\uff0c\u53ef\u4ee5\u770b\u5230loop\u6700\u540e\u9012\u5f52\u8c03\u7528\u81ea\u5df1\u7ed3\u675f\u662f\u53ef\u4ee5\u76f4\u63a5\u5f39\u6808\u7684\uff0c\u4e0d\u9700\u8981\u4e3a\u81ea\u5df1\u4fdd\u7559\u6808\u5e27\uff0c\u6240\u4ee5\u5c3e\u9012\u5f52\u7684\u5b9e\u73b0\u548cfor\u5faa\u73af\u4e00\u6837\u9ad8\u6548\u3002\u867d\u7136\u4e0a\u8ff0\u5c3e\u9012\u5f52\u4ee3\u7801\u53ef\u4ee5\u5728Java\u4e2d\u5b9e\u73b0\uff0c\u4f46\u662fJava\u5374\u4e0d\u80fd\u771f\u6b63\u5730\u5b9e\u73b0\u5c3e\u9012\u5f52\u7684\u6548\u679c\uff0c\u56e0\u4e3a\u5c3e\u9012\u5f52\u9700\u8981\u7f16\u8bd1\u5668\u7684\u652f\u6301\u3002Scala\u7684\u6ce8\u89e3@tailrec\u7528\u4e8e\u6807\u660e\u8fd9\u662f\u4e00\u4e2a\u5c3e\u9012\u5f52\u51fd\u6570\uff0c\u548cJava@override\u7684\u4f5c\u7528\u7c7b\u4f3c\uff0c\u4e0d\u662f\u4e00\u4e2a\u529f\u80fd\u6027\u7684\u6ce8\u89e3\uff0c\u53ea\u662f\u6807\u8bc6\u4f5c\u7528\uff0c\u4e0d\u6807\u660e@tailrec\u8be5\u51fd\u6570\u540c\u6837\u662f\u5c3e\u9012\u5f52\u51fd\u6570\uff0c\u6807\u660e\u4e86@tailrec\u5f53\u51fd\u6570\u4e0d\u662f\u5c3e\u9012\u5f52\u51fd\u6570\u65f6\uff0c\u5c31\u4f1a\u62a5\u9519\u3002</p> <p>\u63a7\u5236\u62bd\u8c61 1.\u503c\u8c03\u7528\uff0c\u5c31\u662f\u666e\u901a\u7684\u503c\u4f20\u9012 2.\u540d\u8c03\u7528\uff1a\u4ee3\u7801\u5757\u7684\u4f20\u9012\uff0c\u6bcf\u6b21\u4f7f\u7528\u8fd9\u4e2a\u540d\uff0c\u90fd\u662f\u5728\u6267\u884c\u4ee3\u7801\u5757 \u540d\u8c03\u7528\u65f6\uff0c\u53c2\u6570\u7684\u7c7b\u578b\u662f =&gt; Int\uff0c\u8868\u793a\u5e94\u8be5\u4f20\u9012\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c\u56e0\u4e3a\u4ee3\u7801\u5757\u662f\u6ca1\u6709\u53c2\u6570\u7684\uff0c\u5e76\u4e14\u6b64\u4ee3\u7801\u5757\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2aInt\uff0c\u6ce8\u610f\u4ee3\u7801\u7684\u8fd4\u56de\u503c\u5c31\u662f\u6267\u884c\u6700\u540e\u4e00\u6761\u8bed\u53e5\u7684\u503c\uff0c\u4e0d\u80fd\u7528return\u8fd4\u56de\u3002 Text Only<pre><code>def foo(a: =&gt; Int): Unit ={\n\u00a0\u00a0println(a)\n\u00a0\u00a0println(a)\n}\n\nfoo({\n\u00a0\u00a0println(\"\u4f20\u540d\u53c2\u6570\")\n\u00a0\u00a023\n})\n//\u8c03\u7528\u65f6\u5c0f\u62ec\u53f7\u53ef\u4ee5\u7701\u7565\nprintln(\"========\")\nfoo {\n\u00a0\u00a0println(\"\u4f20\u540d\u53c2\u6570\")\n\u00a0\u00a023\n}\n</code></pre> \u7ed3\u679c\u5982\u4e0b\uff0ca\u5728\u51fd\u6570\u91cc\u88ab\u4f7f\u7528\u4e86\u51e0\u6b21\uff0c\u4ee3\u7801\u5757\u5c31\u4f1a\u88ab\u6267\u884c\u51e0\u6b21 Text Only<pre><code>\u4f20\u540d\u53c2\u6570\n23\n\u4f20\u540d\u53c2\u6570\n23\n========\n\u4f20\u540d\u53c2\u6570\n23\n\u4f20\u540d\u53c2\u6570\n23\n</code></pre></p> <p>\u7efc\u5408\u6848\u4f8b\uff1a\u81ea\u5b9a\u4e49\u5b9e\u73b0while\u5faa\u73af \u4f7f\u7528\u7f16\u7a0b\u8bed\u8a00\u81ea\u5e26\u7684while\uff1a Text Only<pre><code>var n = 10\n// 1. \u5e38\u89c4\u7684while\u5faa\u73af\nwhile (n &gt;= 1) {\n\u00a0\u00a0println(n)\n\u00a0\u00a0n -= 1\n}\n</code></pre> \u4f7f\u7528\u540d\u8c03\u7528\u5b9e\u73b0\u81ea\u5b9a\u4e49while\uff0c\u6761\u4ef6\u548c\u5faa\u73af\u91cc\u7684\u64cd\u4f5c\u90fd\u5fc5\u987b\u662f\u540d\u4f20\u9012\uff0c\u4e5f\u5c31\u662f\u4ee3\u7801\u5757\uff0c\u56e0\u4e3a\u53ea\u6709\u662f\u4ee3\u7801\u5757\u624d\u80fd\u5728\u6bcf\u6b21\u8c03\u7528\u7684\u65f6\u5019\u90fd\u6267\u884c Text Only<pre><code>@tailrec\ndef myWhile(condition: =&gt; Boolean, op: =&gt; Unit): Unit = {\n\u00a0\u00a0if (condition) {\n\u00a0\u00a0\u00a0\u00a0op\n\u00a0\u00a0\u00a0\u00a0myWhile(condition, op)\n\u00a0\u00a0}\n}\n\nvar n = 10\nmyWhile(n &gt;= 1, {\n\u00a0\u00a0println(n)\n\u00a0\u00a0n -= 1\n})\n</code></pre> \u53ea\u7528\u540d\u8c03\u7528\u5fc5\u987b\u8981\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\u8fdb\u884c\uff0c\u4e0d\u80fd\u505a\u5230\u81ea\u5e26while\u90a3\u79cd\u4e66\u5199\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u4f7f\u7528\u67ef\u91cc\u5316\u6765\u5b9e\u73b0\u5c06\u4e00\u4e2a\u53c2\u6570\u5217\u8868\u7684\u591a\u4e2a\u53c2\u6570\u53d8\u6210\u591a\u4e2a\u53c2\u6570\u5217\u8868 Text Only<pre><code>@tailrec\ndef myWhile(condition: =&gt; Boolean)(op: =&gt; Unit): Unit = {\n\u00a0\u00a0if (condition) {\n\u00a0\u00a0\u00a0\u00a0op\n\u00a0\u00a0\u00a0\u00a0myWhile(condition)(op)\n\u00a0\u00a0}\n}\n</code></pre> \u4f20\u540d\u8c03\u7528\u53ef\u4ee5\u7701\u7565\u82b1\u62ec\u53f7\u5916\u9762\u7684\u5c0f\u62ec\u53f7\uff0c\u4e8e\u662f\u5c31\u505a\u5230\u4e86\u81ea\u5e26while\u90a3\u79cd\u4e66\u5199 Text Only<pre><code>var n = 10\nmyWhile(n &gt;= 1){\n\u00a0\u00a0println(n)\n\u00a0\u00a0n -= 1\n}\n</code></pre> \u4e5f\u53ef\u7ed3\u5408\u95ed\u5305\u8fd4\u56de\u51fd\u6570\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u79cd\u6548\u679c\uff1a Text Only<pre><code>def myWhile(condition: =&gt; Boolean): (=&gt; Unit) =&gt; Unit = {\n\u00a0\u00a0def doLoop(op: =&gt; Unit): Unit = {\n\u00a0\u00a0\u00a0\u00a0if (condition) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0op\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0myWhile(condition)(op)\u00a0\u00a0//\u9012\u5f52\u8c03\u7528\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n\u00a0\u00a0doLoop\n}\n</code></pre> \u7528\u533f\u540d\u51fd\u6570\u7b80\u5316\u5185\u5c42\u51fd\u6570\uff1a Text Only<pre><code>def myWhile(condition: =&gt; Boolean): (=&gt; Unit) =&gt; Unit = {\n\u00a0\u00a0op =&gt; {\n\u00a0\u00a0\u00a0\u00a0if (condition) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0op\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0myWhile(condition)(op)\u00a0\u00a0//\u9012\u5f52\u8c03\u7528\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n}\n</code></pre> \u4f20\u540d\u8c03\u7528\u53ef\u4ee5\u7701\u7565\u82b1\u62ec\u53f7\u5916\u9762\u7684\u5c0f\u62ec\u53f7\uff0c\u4e8e\u662f\u5c31\u505a\u5230\u4e86\u81ea\u5e26while\u90a3\u79cd\u4e66\u5199 Text Only<pre><code>var n = 10\nmyWhile(n &gt;= 1){\n\u00a0\u00a0println(n)\n\u00a0\u00a0n -= 1\n}\n</code></pre></p> <p>\u60f0\u6027\u52a0\u8f7d \u5f53\u51fd\u6570\u8fd4\u56de\u503c\u88ab\u58f0\u660e\u4e3a lazy \u65f6\uff0c\u51fd\u6570\u7684\u6267\u884c\u5c06\u88ab\u63a8\u8fdf\uff0c\u76f4\u5230\u6211\u4eec\u9996\u6b21\u5bf9\u6b64\u53d6\u503c\uff0c\u8be5\u51fd\u6570\u624d\u4f1a\u6267\u884c\u3002 \u6ce8\u610f\uff1a lazy \u4e0d\u80fd\u4fee\u9970 var \u7c7b\u578b\u7684\u53d8\u91cf Text Only<pre><code>def f(a: Int): Int ={\n\u00a0\u00a0println(\"1 f\u88ab\u8c03\u7528\")\n\u00a0\u00a0a\n}\nlazy val a = f(10)\nprintln(\"2 \")\nprintln(\"3 a=\"+a)\nprintln(\"4 a=\"+a)\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>2\n1 f\u88ab\u8c03\u7528\n3 a=10\n4 a=10\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/6-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/","title":"6-\u9762\u5411\u5bf9\u8c61","text":"<p> \u7ea6 5143 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 103 \u5206\u949f</p> <p>Scala \u6709\u4e24\u79cd\u5305\u7684\u7ba1\u7406\u98ce\u683c\uff1a \u4e00\u79cd\u65b9\u5f0f\u548c Java \u7684\u5305\u7ba1\u7406\u98ce\u683c\u76f8\u540c\uff0c\u6bcf\u4e2a\u6e90\u6587\u4ef6\u4e00\u4e2a\u5305\uff08 \u5305\u540d\u548c\u6e90\u6587\u4ef6\u6240\u5728\u8def\u5f84\u4e0d\u8981\u6c42\u5fc5\u987b\u4e00\u81f4\uff09\uff0c\u5305\u540d\u7528\u201c.\u201d\u8fdb\u884c\u5206\u9694\u4ee5\u8868\u793a\u5305\u7684\u5c42\u7ea7\u5173\u7cfb\uff0c\u5982com.atguigu.scala\u3002 \u53e6\u4e00\u79cd\u98ce\u683c\uff0c\u901a\u8fc7\u5d4c\u5957\u7684\u98ce\u683c\u8868\u793a\u5c42\u7ea7\u5173\u7cfb\uff0c\u5982\u4e0b\uff1a Text Only<pre><code>package com {\n\u00a0package atguigu {\n\u00a0 \u00a0package scala {\n\u00a0 \u00a0}\n\u00a0}\n}\n</code></pre> \u7b2c\u4e8c\u79cd\u98ce\u683c\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u4e00\u4e2a\u6e90\u6587\u4ef6\u4e2d\u53ef\u4ee5\u58f0\u660e\u591a\u4e2a package</li> <li>\u5b50\u5305\u4e2d\u7684\u7c7b\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7236\u5305\u4e2d\u7684\u5185\u5bb9\uff0c\u800c\u65e0\u9700\u5bfc\u5305</li> </ul> <p>\u5305\u5bf9\u8c61 \u5728 Scala \u4e2d\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5305\u5b9a\u4e49\u4e00\u4e2a\u540c\u540d\u7684\u5305\u5bf9\u8c61\uff0c \u5b9a\u4e49\u5728\u5305\u5bf9\u8c61\u4e2d\u7684\u6210\u5458\uff0c \u4f5c\u4e3a\u5176\u5bf9\u5e94\u5305\u4e0b\u6240\u6709 class \u548c object \u7684\u5171\u4eab\u53d8\u91cf\uff0c \u53ef\u4ee5\u88ab\u76f4\u63a5\u8bbf\u95ee\u3002 Text Only<pre><code>package object com {\n\u00a0\u00a0val shareValue = \"share\"\n\u00a0\u00a0def shareMethod() = {}\n}\n</code></pre></p> <p>\u5bfc\u5305\u8bf4\u660e</p> <ol> <li>\u548c Java \u4e00\u6837\uff0c\u53ef\u4ee5\u5728\u9876\u90e8\u4f7f\u7528 import \u5bfc\u5165\uff0c \u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u7c7b\u90fd\u53ef\u4ee5\u4f7f\u7528</li> <li>\u5c40\u90e8\u5bfc\u5165\uff1a\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\uff0c\u4ec0\u4e48\u65f6\u5019\u5bfc\u5165\uff0c \u5728\u5176\u4f5c\u7528\u8303\u56f4\u5185\u90fd\u53ef\u4ee5\u4f7f\u7528</li> <li>\u5bfc\u5165\u5305\u4e0b\u7684\u6240\u6709\u6210\u5458\uff1a import java.util._</li> <li>\u7ed9\u5bfc\u5165\u7684\u7c7b\u8d77\u522b\u540d\uff1a import java.util.{ArrayList=&gt;AL}</li> <li>\u5bfc\u5165\u76f8\u540c\u5305\u7684\u591a\u4e2a\u7c7b\uff1a import java.util.{HashSet, ArrayList}</li> <li>\u5c4f\u853d\u7c7b\uff1a import java.util.{ArrayList =&gt;_,_} \uff0c\u8868\u793a\u53ea\u6709ArrayList\u4e0d\u5bfc\u5165\uff0c\u5176\u5b83\u5747\u5bfc\u5165</li> <li>\u5bfc\u5165\u5305\u7684\u7edd\u5bf9\u8def\u5f84\uff1a new _root_.java.util.HashMap</li> </ol> <p>Scala \u4e2d\u7684\u4e09\u4e2a\u9ed8\u8ba4\u5bfc\u5165\u5206\u522b\u662f import java.lang._ import scala._ import scala.Predef._</p> <p>\u7c7b\uff1aScala \u4e2d\u6ca1\u6709 public\uff0c\u7c7b\u4e0d\u52a0\u4fee\u9970\u7b26\u5c31\u662f\u516c\u6709\u7684\u53ef\u89c1\u6027\uff08\u5373\u9ed8\u8ba4\u5c31\u662fpublic\uff09\uff0c \u4e00\u4e2a Scala \u6e90\u6587\u4ef6\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7c7b\u3002 \u5c5e\u6027\uff1a</p> <ul> <li>\u5c5e\u6027\u4e0d\u52a0\u4fee\u9970\u7b26\u9ed8\u8ba4\u4e5f\u662f\u516c\u6709\u7684\u53ef\u89c1\u6027\uff1b</li> <li>\u7531\u4e8eScala\u4e2d\u53d8\u91cf\u7684\u58f0\u660e\u5fc5\u987b\u521d\u59cb\u5316\uff0c\u5f53\u7c7b\u7684\u5c5e\u6027\u5982\u679c\u4e0d\u9700\u8981\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528_\u4e0b\u5212\u7ebf\u6765\u8d4b\u9ed8\u8ba4\u503c\uff08\u6bd4\u5982Int\u7c7b\u578b\u5c31\u662f0\uff0cString\u7c7b\u578b\u5c31\u662fnull\uff0c\u4e0b\u5212\u7ebf\u8d4b\u9ed8\u8ba4\u521d\u503c\u53ea\u80fd\u5728\u7c7b\u4e2d\u58f0\u660e\u53d8\u91cf\u65f6\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u5728\u65b9\u6cd5\u7684\u53c2\u6570\u4e0a\uff08\u4f5c\u4e3a\u8c03\u7528\u65b9\u6cd5\u7684\u53c2\u6570\u6216\u8005\u51fd\u6570\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u90fd\u4e0d\u884c\uff09\uff09\uff0c\u4f46\u662f\u00a0val \u4fee\u9970\u7684\u5c5e\u6027\u4e0d\u80fd\u7528\u4e0b\u5212\u7ebf\u8d4b\u9ed8\u8ba4\u503c\uff0c\u5fc5\u987b\u663e\u793a\u6307\u5b9a\uff1b</li> <li>\u4f7f\u7528@BeanPropetry\u6ce8\u89e3\u53ef\u4ee5\u81ea\u52a8\u5730\u4e3a\u5c5e\u6027\uff08\u9664\u79c1\u6709\u5c5e\u6027\u5916\uff09\u751f\u6210\u89c4\u8303\u7684 getter/setter\u65b9\u6cd5\uff1b</li> </ul> <p>Scala\u7684\u8bbf\u95ee\u6743\u9650\u4e0eJava\u6709\u70b9\u533a\u522b\uff1a</p> <ol> <li>Scala \u4e2d\u7684\u7c7b\u3001\u5c5e\u6027\u548c\u65b9\u6cd5\u7684\u9ed8\u8ba4\u8bbf\u95ee\u6743\u9650\u4e3a public\uff0c\u4f46 Scala \u4e2d\u65e0 public \u5173\u952e\u5b57\u3002</li> <li>private \u4e3a\u79c1\u6709\u6743\u9650\uff0c\u53ea\u5728\u7c7b\u7684\u5185\u90e8\u548c\u4f34\u751f\u5bf9\u8c61\u4e2d\u53ef\u7528\u3002</li> <li>protected \u4e3a\u53d7\u4fdd\u62a4\u6743\u9650\uff0cScala \u4e2d\u53d7\u4fdd\u62a4\u6743\u9650\u6bd4 Java \u4e2d\u66f4\u4e25\u683c\uff0c\u53ea\u6709\u540c\u7c7b\u3001\u5b50\u7c7b\u53ef\u4ee5\u8bbf\u95ee\uff08\u4e0d\u80fd\u5728\u5b50\u7c7b\u4e2d\u901a\u8fc7\u5bf9\u8c61.\u5c5e\u6027\u7684\u65b9\u5f0f\u8bbf\u95ee\uff0c\u800c\u662f\u5b50\u7c7b\u901a\u8fc7\u7ee7\u627f\u7684\u65b9\u5f0f\u8bbf\u95ee\uff09\uff0c\u540c\u5305\u4e0d\u80fd\u8bbf\u95ee\u3002</li> <li>private[\u5305\u540d] \u589e\u52a0\u5305\u8bbf\u95ee\u6743\u9650\uff0c\u5305\u540d\u4e0b\u7684\u5176\u4ed6\u7c7b\u4e5f\u53ef\u4ee5\u4f7f\u7528\u3002</li> </ol> <p>Text Only<pre><code>class Person {\n\u00a0\u00a0private var name: String = \"bob\"\n\u00a0\u00a0// _ \u8868\u793a\u7ed9\u5c5e\u6027\u4e00\u4e2a\u9ed8\u8ba4\u503c\n `@BeanProperty //Bean\u5c5e\u6027`\n `protected var age: Int = _`\n\u00a0\u00a0private[chapter03] var sex: String = \"\u7537\"\n `//val \u4fee\u9970\u7684\u5c5e\u6027\u4e0d\u80fd\u8d4b\u9ed8\u8ba4\u503c\uff0c\u5fc5\u987b\u663e\u793a\u6307\u5b9a`\n `//val school: String = _`\n}\nobject Person {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val person = new Person\n `println(person.getAge)`\n\u00a0\u00a0\u00a0\u00a0println(person.name) //\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0println(person.age) //\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0println(person.sex) //\u53ef\u4ee5\n\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>class Student extends Person {\n\u00a0\u00a0def printInfo(): Unit = {\n\u00a0\u00a0\u00a0\u00a0//name = \"alice\" //\u4e0d\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0age = 18 //\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0sex = \"male\" //\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0val person = new Person\n\u00a0\u00a0\u00a0\u00a0//println(person.name) //\u4e0d\u53ef\u4ee5\n `//println(person.age) //\u4e0d\u53ef\u4ee5`\n\u00a0\u00a0\u00a0\u00a0println(person.sex) //\u53ef\u4ee5\n\u00a0\u00a0}\n}\nobject Student {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val person = new Person //\u53c8\u65e0\u53c2\u6784\u9020\u5668\uff0c\u6240\u4ee5\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u8c03\u7528\u7684()\n `println(person.getSex)`\n\u00a0\u00a0\u00a0\u00a0//println(person.name) //\u4e0d\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0//println(person.age) //\u4e0d\u53ef\u4ee5\n\u00a0\u00a0\u00a0\u00a0println(person.sex) //\u53ef\u4ee5\n\u00a0\u00a0}\n}\n</code></pre></p> <p>Scala \u7c7b\u7684\u6784\u9020\u5668\u5305\u62ec\uff1a \u4e3b\u6784\u9020\u5668\u548c\u8f85\u52a9\u6784\u9020\u5668 \u4e3b\u6784\u9020\u5668\u5c31\u662f\u76f4\u63a5\u5728\u7c7b\u540d\u540e\u9762\u58f0\u660e\u53c2\u6570\u7684\u6784\u9020\u5668\u3002\u8fd9\u5c31\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u7c7b\u7684\u5b9a\u4e49\u90fd\u4f5c\u4e3a\u4e86\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u8c03\u7528\u65b9\u6cd5\uff0c\u5728\u7c7b\u5b9e\u4f8b\u5316\u7684\u65f6\u5019\u88ab\u8c03\u7528 Text Only<pre><code>class Animal(name: String, age: Int) {\n\u00a0\u00a0println(s\"name=${name},age=${age}\")\n}\n</code></pre> 1. \u5982\u679c\u4e3b\u6784\u9020\u5668\u65e0\u53c2\u6570\uff0c\u5c0f\u62ec\u53f7\u53ef\u7701\u7565\uff0c\u6784\u5efa\u5bf9\u8c61\u65f6\u8c03\u7528\u7684\u6784\u9020\u65b9\u6cd5\u7684\u5c0f\u62ec\u53f7\u4e5f\u53ef\u4ee5\u7701\u7565\u3002 Text Only<pre><code>class Animal {}\nobject Animal {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val animal = new Animal\n\u00a0\u00a0}\n}\n</code></pre> 2. \u4e3b\u6784\u9020\u5668\u51fd\u6570\u7684\u5f62\u53c2\u5305\u62ec\u4e09\u79cd\u7c7b\u578b\uff1a\u672a\u7528val\u548cvar\u4fee\u9970\u3001 var \u4fee\u9970\u3001 val \u4fee\u9970</p> <ul> <li>\u672a\u7528val\u548cvar\u4fee\u9970\uff0c\u8fd9\u4e2a\u53c2\u6570\u5c31\u662f\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u5373\u5c40\u90e8\u5e38\u91cf</li> <li>val \u4fee\u9970\u7684\u53c2\u6570\uff0c\u4f5c\u4e3a\u7c7b\u53ea\u8bfb\u5c5e\u6027\u4f7f\u7528\uff0c\u4e0d\u80fd\u4fee\u6539</li> </ul> <p>\u672a\u7528val\u548cvar\u4fee\u9970 \u548c \u7528val \u4fee\u9970\u7684\u53c2\u6570\u7684\u533a\u522b\uff1a\u672a\u7528val\u548cvar\u4fee\u9970\u65f6\uff0c\u4e00\u65e6\u7c7b\u4e2d\u6709\u65b9\u6cd5\u8bbf\u95ee\u5230\u4e86\u8fd9\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u53c2\u6570\u5c31\u7acb\u523b\u53d8\u4e3a\u7c7b\u7684\u79c1\u6709\u5e38\u91cf\u5c5e\u6027\uff0c\u5916\u90e8\u8bbf\u95ee\u4e0d\u5230\uff1b\u800c\u7528val \u4fee\u9970\u7684\u53c2\u6570\u76f4\u63a5\u5c31\u662f\u7c7b\u7684\u516c\u6709\u5e38\u91cf\u5c5e\u6027\uff0c\u5916\u90e8\u53ef\u4ee5\u8bbf\u95ee\u5230\uff0c\u53ea\u662f\u4e0d\u80fd\u4fee\u6539\u3002 \u00a0 \u00a0 \u8fd9\u4e2a\u533a\u522b\u53ef\u4ee5\u53cd\u7f16\u8bd1\u6210Java\u4ee3\u7801\u6765\u770b\uff0c\u5176\u5b9eJVM\u5b57\u8282\u7801\u7684\u903b\u8f91\u5c31\u662fJava\u7684\u8bed\u6cd5\u89c4\u5219\uff0c\u6240\u4ee5\u7528Java\u7684\u8bed\u6cd5\u89c4\u5219\u6765\u7406\u89e3Scala\u7684\u9762\u5411\u5bf9\u8c61\u8bed\u6cd5\u89c4\u5219\u7684\u903b\u8f91\u662f\u5b8c\u5168\u53ef\u4ee5\u7684\u3002\u4ece\u53cd\u7f16\u8bd1\u6210Java\u4ee3\u7801\u7684\u7ed3\u679c\u6765\u770b\uff0cScala\u7c7b\u7684\u5c5e\u6027\u90fd\u662f\u79c1\u6709\u7684\uff0c\u53ea\u4e0d\u8fc7\u4f1a\u81ea\u52a8\u751f\u6210\u4e0e\u5c5e\u6027\u540d\u540c\u540d\u7684\u65b9\u6cd5\u6765\u8bbf\u95ee\u5c5e\u6027\uff0c\u5982\u679c\u5728Scala\u4e2d\u5b9a\u4e49\u5c5e\u6027\u662f\u79c1\u6709\u7684\uff0c\u90a3\u4e48\u76f8\u5e94\u7684\u4e0e\u5c5e\u6027\u540d\u540c\u540d\u7684\u65b9\u6cd5\u4e5f\u5c31\u662f\u79c1\u6709\u7684\uff0c\u6240\u4ee5\u7528val \u4fee\u9970\u7684\u53c2\u6570\u80fd\u5728\u5916\u90e8\u8bbf\u95ee\u5230\u662f\u56e0\u4e3a\u751f\u6210\u4e86\u516c\u6709\u7684\u4e0e\u5c5e\u6027\u540d\u540c\u540d\u7684\u65b9\u6cd5\uff0c\u800c\u00a0\u672a\u7528val\u548cvar\u4fee\u9970\u7684\u53c2\u6570\u4e0d\u80fd\u5728\u5916\u90e8\u8bbf\u95ee\u5230\uff0c\u662f\u56e0\u4e3a\u6839\u672c\u4e0d\u4f1a\u81ea\u52a8\u751f\u6210\u4e0e\u5c5e\u6027\u540d\u540c\u540d\u7684\u65b9\u6cd5\u3002</p> <ul> <li>var \u4fee\u9970\u7684\u53c2\u6570\uff0c\u4f5c\u4e3a\u7c7b\u7684\u6210\u5458\u5c5e\u6027\u4f7f\u7528\uff0c\u53ef\u4ee5\u4fee\u6539</li> </ul> Text Only<pre><code>class Dog(private var name: String, private var age: Int) {\n\u00a0\u00a0override def toString = s\"Dog(name=$name, age=$age)\"\n}\n</code></pre> <p>\u8f85\u52a9\u6784\u9020\u5668\uff1a</p> <ol> <li>\u8f85\u52a9\u6784\u9020\u5668\u5c31\u662f\u5728\u7c7b\u91cc\u9762\u5b9a\u4e49\u7684\u6784\u9020\u5668\uff0c\u4e0d\u8fc7\u51fd\u6570\u7684\u540d\u79f0\u5fc5\u987b\u662fthis\uff0c \u53ef\u4ee5\u6709\u91cd\u8f7d\uff0c\u7f16\u8bd1\u5668\u901a\u8fc7\u53c2\u6570\u7684\u4e2a\u6570\u53ca\u7c7b\u578b\u6765\u533a\u5206</li> <li>\u8f85\u52a9\u6784\u9020\u65b9\u6cd5\u4e0d\u80fd\u76f4\u63a5\u6784\u5efa\u5bf9\u8c61\uff0c\u5fc5\u987b\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u8c03\u7528\u4e3b\u6784\u9020\u65b9\u6cd5\uff0c\u800c\u4e14\u8c03\u7528\u4e3b\u6784\u9020\u5668\u7684\u8bed\u53e5\u5fc5\u987b\u5728\u8f85\u52a9\u6784\u9020\u5668\u7684\u7b2c\u4e00\u884c</li> <li>\u8f85\u52a9\u6784\u9020\u5668\u8c03\u7528\u5176\u4ed6\u7684\u8f85\u52a9\u6784\u9020\u5668\uff0c\u8981\u6c42\u88ab\u8c03\u7528\u7684\u8f85\u52a9\u6784\u9020\u5668\u5fc5\u987b\u63d0\u524d\u58f0\u660e</li> </ol> Text Only<pre><code>class Animal {\n\u00a0\u00a0var name: String = _\n\u00a0\u00a0var age: Int = _\n\u00a0\u00a0def this(name: String) {\n\u00a0\u00a0\u00a0\u00a0this() //\u5fc5\u987b\u8c03\u7528\u4e3b\u7c7b\u6784\u9020\u5668\n\u00a0\u00a0\u00a0\u00a0this.name = name\n\u00a0\u00a0}\n\u00a0\u00a0def this(name: String, age: Int) {\n\u00a0\u00a0\u00a0\u00a0this(name) //\u95f4\u63a5\u5730\u8c03\u7528\u4e3b\u7c7b\u6784\u9020\u5668\n\u00a0\u00a0\u00a0\u00a0this.age = age\n\u00a0\u00a0}\n}\n</code></pre> <p>\u6ce8\u610f\uff1a\u8f85\u52a9\u6784\u9020\u5668\u7684\u51fd\u6570\u540d\u5fc5\u987b\u662fthis\uff0c\u4ece\u800c\u4e0e\u7c7b\u540c\u540d\u7684\u51fd\u6570\u5c31\u53ea\u80fd\u662f\u4e2a\u666e\u901a\u51fd\u6570\u4e86\uff1a Text Only<pre><code>class Animal {\n\u00a0\u00a0var name: String = _\n\u00a0\u00a0var age: Int = _\n\u00a0\u00a0//\u8fd9\u53ea\u662f\u4e00\u4e2a\u666e\u901a\u7684\u65b9\u6cd5\n\u00a0\u00a0def Animal(): Unit ={\n\u00a0\u00a0\u00a0\u00a0println(\"\u8fd9\u53ea\u662f\u4e00\u4e2a\u666e\u901a\u7684\u65b9\u6cd5\")\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u6700\u63a8\u8350\u7684\u505a\u6cd5\uff0cname\u548cage\u662fDog\u7684\u79c1\u6709\u5b57\u6bb5\uff0c\u5199\u5b8c\u7b2c\u4e00\u884c\u5c31\u5b9a\u4e49\u5b8c\u4e86\u8fd9\u4e24\u4e2a\u5b57\u6bb5\uff0c\u5e76\u4e14\u5b9a\u4e49\u4e86\u4e24\u4e2a\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u7136\u540e\u4f7f\u7528\u8f85\u52a9\u6784\u9020\u5668\u901a\u8fc7\u8c03\u7528\u4e3b\u6784\u9020\u5668\u6765\u5b9a\u4e49\u5176\u5b83\u4e00\u4e2a\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u5728Java\u91cc\u9762\u5f88\u591a\u7c7b\u7684\u6784\u9020\u5668\u90fd\u662f\u8fd9\u6837\u7684\uff0c\u5148\u5b9a\u4e49\u4e00\u4e2a\u5168\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u7136\u540e\u5176\u5b83\u6784\u9020\u5668\u90fd\u8c03\u7528\u8fd9\u4e2a\u5168\u53c2\u6570\u7684\u6784\u9020\u5668\uff0c\u5e76\u4f20\u5165\u4e00\u4e9b\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u8f85\u52a9\u6784\u9020\u5668\u89c4\u5b9a\u5fc5\u987b\u8c03\u7528\u4e3b\u6784\u9020\u5668\u7684\u539f\u56e0\u5e94\u8be5\u5c31\u662f\u8fd9\u6837\u7684\u3002\uff08\u4e0d\u8fc7\u5728Scala\u4e2d\u65b9\u6cd5\u548c\u51fd\u6570\u7684\u53c2\u6570\u90fd\u53ef\u4ee5\u6709\u9ed8\u8ba4\u503c\uff08\u4e0d\u80fd\u662f_\u4e0b\u5212\u7ebf\u7684\u8fd9\u79cd\u503c\uff09\uff0c\u6240\u4ee5\u4e3b\u6784\u9020\u5668\u53ef\u4ee5\u6709\u9ed8\u8ba4\u503c\uff0c\u5982\u679c\u53ea\u662f\u60f3\u7528\u8f85\u52a9\u6784\u9020\u5668\u4f20\u5165\u9ed8\u8ba4\u503c\uff0c\u597d\u50cf\u7528\u8f85\u52a9\u6784\u9020\u5668\u5c31\u6ca1\u6709\u5fc5\u8981\u4e86\uff0c\u8f85\u52a9\u6784\u9020\u5668\u5e94\u8be5\u662f\u7528\u6765\u505a\u4e00\u4e9b\u590d\u6742\u70b9\u7684\u903b\u8f91\u5224\u65ad\uff09 Text Only<pre><code>class Dog(private var name: String, private var age: Int) {\n\u00a0\u00a0def this(name: String) {\n\u00a0\u00a0\u00a0\u00a0this(name, 0)\n\u00a0\u00a0}\n\u00a0\u00a0def this(age: Int) {\n\u00a0\u00a0\u00a0\u00a0this(\"\", age)\n\u00a0\u00a0}\n\u00a0\u00a0override def toString = s\"Dog(name=$name, age=$age)\"\n}\n</code></pre></p> <p>\u7ee7\u627f\uff1a Scala\u548cJava\u4e00\u6837\u662f\u5355\u7ee7\u627f\uff0c\u4f7f\u7528extends\u5173\u952e\u5b57\u3002\u4eceScala\u7c7b\u6784\u9020\u5668\u5b9a\u4e49\u7684\u5f62\u5f0f\u6765\u770b\uff0c\u7c7b\u548c\u5176\u6784\u9020\u5668\u7684\u5b9a\u4e49\u662f\u7ed1\u5728\u4e00\u8d77\u7684\uff0c\u4e5f\u5c31\u662f\u5b9a\u4e49\u7c7b\u540d\u7684\u540c\u65f6\u4e5f\u5c31\u5b9a\u4e49\u4e86\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u4e5f\u662f\u5f88\u5408\u7406\uff0c\u56e0\u4e3a\u5728Java\u4e2d\uff0c\u65e0\u8bba\u7c7b\u6709\u6ca1\u6709\u58f0\u660e\u6784\u9020\u5668\uff0c\u7c7b\u90fd\u4f1a\u6709\u4e00\u4e2a\u6784\u9020\u5668\uff0c\u53ea\u4e0d\u8fc7\u662fScala\u6362\u4e86\u4e00\u79cd\u5199\u6cd5\u3002\u5728Scala\u4e2dextends\u5173\u952e\u5b57\u540e\u9762\u58f0\u660e\u88ab\u7ee7\u627f\u7684\u7c7b\u7684\u540c\u65f6\u4e5f\u5c31\u8c03\u7528\u4e86\u7236\u7c7b\u7684\u6784\u9020\u5668\uff0c\u8fd9\u540c\u6837\u4e5f\u5f88\u5408\u7406\uff0c\u56e0\u4e3a\u5728Java\u4e2d\uff0c\u65e0\u8bba\u6709\u6ca1\u6709\u663e\u5f0f\u5730\u8c03\u7528\u7236\u7c7b\u6784\u9020\u5668\uff0c\u5b50\u7c7b\u90fd\u4f1a\u8c03\u7528\u7236\u7c7b\u7684\u6784\u9020\u5668\uff0c\u53ea\u4e0d\u8fc7\u662fScala\u6362\u4e86\u4e00\u79cd\u5199\u6cd5\u3002\u6240\u4ee5\uff0c\u7efc\u4e0a\u4e00\u70b9\u5c31\u662f\uff0cScala\u4e2d\u7c7b\u540d\u51fa\u73b0\u7684\u5730\u65b9\u5c31\u90fd\u8c03\u7528\u4e86\u7c7b\u7684\u6784\u9020\u5668\u3002 \u7ee7\u627f\u5173\u7cfb\u4e2d\u6784\u9020\u5668\u7684\u8c03\u7528\u987a\u5e8f\u662f \u5148\u7236\u7c7b\u6784\u9020\u5668 \u518d \u5b50\u7c7b\u6784\u9020\u5668\uff0c\u5b50\u7c7bStudent\u7684\u58f0\u660e\u7ee7\u627f\u5173\u7cfb\u65f6\u4e5f\u58f0\u660e\u4e86\u8981\u8c03\u7528\u7236\u7c7b\u7684\u4e3b\u6784\u9020\u5668\uff0c\u56e0\u4e3a\u7236\u7c7bPerson\u4e2d\u6709\u65e0\u53c2\u7684\u8f85\u52a9\u6784\u9020\u5668\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u58f0\u660e\u8c03\u7528\u7236\u7c7b\u7684\u65e0\u53c2\u6784\u9020\u5668\uff0c\u90a3\u4e48\u6b64\u65f6\u53ef\u4ee5\u7701\u7565Person\u540e\u9762\u7684\u62ec\u53f7\u3002\u56e0\u4e3a\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u65f6\u4e00\u5b9a\u4f1a\u88ab\u8c03\u7528\u7684\uff0c\u6240\u4ee5\u5373\u4f7f\u662f\u8c03\u7528\u5b50\u7c7b\u7684\u8f85\u52a9\u6784\u9020\u5668\u521b\u5efa\u5b50\u7c7b\u7684\u5bf9\u8c61\uff0c\u7236\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u4e5f\u662f\u4e00\u5b9a\u4f1a\u88ab\u8c03\u7528\u5230\u7684\u3002 \u56e0\u4e3a\u5728\u58f0\u660e\u88ab\u7ee7\u627f\u7684\u7c7b\u7684\u65f6\u5019\u5c31\u5df2\u7ecf\u6307\u5b9a\u4e86\u4f1a\u8c03\u7528\u7236\u7c7b\u7684\u54ea\u4e2a\u6784\u9020\u5668\uff0c\u5e76\u4e14\u5728\u6784\u5efa\u5b50\u7c7b\u5bf9\u8c61\u65f6\uff0c\u8fd9\u4e2a\u6784\u9020\u5668\u4e5f\u662f\u4e00\u5b9a\u4f1a\u88ab\u8c03\u7528\u7684\uff0c\u6240\u4ee5Scala\u4e0d\u80fd\u4f7f\u7528super\u5173\u952e\u5b57\u518d\u6765\u663e\u5f0f\u5730\u58f0\u660e\u8c03\u7528\u7236\u7c7b\u7684\u6784\u9020\u5668\uff0c\u4e5f\u5c31\u662f\u4e0d\u53ef\u4ee5super()\uff0c\u53ea\u80fd\u4f7f\u7528super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u5b57\u6bb5\u548c\u5176\u5b83\u65b9\u6cd5\u3002 Text Only<pre><code>// \u5b9a\u4e49\u4e00\u4e2a\u7236\u7c7b\nclass Person(var name: String, var age: Int) {\n\u00a0\u00a0println(\"\u7236\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u8c03\u7528\")\n\n\u00a0 def this() {\n\u00a0\u00a0\u00a0\u00a0this(null, 0)\n\u00a0\u00a0\u00a0\u00a0println(\"\u7236\u7c7b\u7684\u8f85\u52a9\u6784\u9020\u5668\u8c03\u7528\")\n\u00a0\u00a0}\n}\n// \u5b9a\u4e49\u5b50\u7c7b\nclass Student(name: String, age: Int, var stdNo: String) extends Person(name, age) {\n\u00a0\u00a0println(\"\u5b50\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u8c03\u7528\")\n\n\u00a0 def this(stdNo: String) {\n\u00a0\u00a0\u00a0\u00a0this(null, 0, stdNo)\n\u00a0\u00a0\u00a0\u00a0println(\"\u5b50\u7c7b\u7684\u8f85\u52a9\u6784\u9020\u5668\u8c03\u7528\")\n\u00a0\u00a0}\n}\n</code></pre> val person = new Student(\"123\")\u7684\u7ed3\u679c\u662f\uff1a Text Only<pre><code>\u7236\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u8c03\u7528\n\u5b50\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u8c03\u7528\n\u5b50\u7c7b\u7684\u8f85\u52a9\u6784\u9020\u5668\u8c03\u7528\n</code></pre></p> <p>\u591a\u6001\uff0c\u7236\u7c7b\u5f15\u7528\u6307\u5411\u5b50\u7c7b\u5bf9\u8c61\u8c03\u7528\u7684\u662f\u5b50\u7c7b\u7684\u65b9\u6cd5\u548c\u5b57\u6bb5\uff0c\u8fd9\u5c31\u662fScala\u7684\u591a\u6001\u3002\u5728Java\u4e2d\u5b57\u6bb5\u662f\u6ca1\u6709\u591a\u6001\u7684\uff0c\u4f46\u662f\u5728Scala\u4e2d\u5b57\u6bb5\u662f\u6709\u591a\u6001\u7684\uff0c\u6240\u4ee5Scala\u7684\u591a\u6001\u66f4\u52a0\u5f7b\u5e95\uff0c\u4f46\u662f\u5728Scala\u4e2d\u91cd\u5199\u5fc5\u987b\u8981\u52a0ovrride\u5173\u952e\u5b57\u3002 Java\u4e2d\u53ea\u6709\u65b9\u6cd5\u6709\u591a\u6001\uff0c\u5b57\u6bb5\u6ca1\u6709\u591a\u6001\uff1a Text Only<pre><code>public class Person {\n\u00a0\u00a0\u00a0\u00a0String name = \"person\";\n\u00a0\u00a0\u00a0\u00a0public void printInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"name=\" + name);\n\u00a0\u00a0\u00a0\u00a0}\n}\npublic class Student extends Person {\n\u00a0\u00a0\u00a0\u00a0String name = \"student\";\n\u00a0 \u00a0 public void printInfo() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"name=\" + name);\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0 \u00a0 public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Person person = new Student();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(person.name);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0person.printInfo();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> \u6253\u5370\u7ed3\u679c\u662f\uff1a Text Only<pre><code>person\nname=student\n</code></pre></p> <p>Scala\u4e2d\u5b57\u6bb5\u548c\u65b9\u6cd5\u90fd\u6709\u591a\u6001\uff0c\u4f46\u662fScala\u4e0d\u80fdoverride\u7236\u7c7bvar\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ea\u6709val\u7c7b\u578b\u7684\u5e38\u91cf\u624d\u6709\u591a\u6001\uff1a Text Only<pre><code>class Person {\n\u00a0\u00a0val name: String = \"peron\"\n\u00a0\u00a0def printInfo(): Unit ={\n\u00a0\u00a0\u00a0\u00a0println(name)\n\u00a0\u00a0}\n}\nclass Student extends Person {\n\u00a0\u00a0override val name: String = \"student\"\n\u00a0 override def printInfo(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(name)\n\u00a0\u00a0}\n}\nobject Test {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0//val p = new Student //\u81ea\u52a8\u7c7b\u578b\u63a8\u65ad\u4e0d\u80fd\u591a\u6001\uff0c\u56e0\u4e3a\u5b83\u63a8\u65ad\u51fa\u6765\u7684\u7c7b\u578b\u5c31\u662fStudent\n\u00a0\u00a0\u00a0\u00a0val person: Person = new Student //\u5fc5\u987b\u663e\u5f0f\u5730\u6307\u5b9a\u4e3a\u7236\u7c7b\u7684\u5f15\u7528\u624d\u80fd\u591a\u6001\n\u00a0\u00a0\u00a0\u00a0println(person.name)\n\u00a0\u00a0\u00a0\u00a0person.printInfo()\n\u00a0\u00a0}\n}\n</code></pre> \u6253\u5370\u7ed3\u679c\uff1a Text Only<pre><code>student\nstudent\n</code></pre></p> <p>\u62bd\u8c61\u7c7b\uff0cScala\u4e2d\u7684\u62bd\u8c61\u7c7b\u7684\u6982\u5ff5\u548cJava\u7684\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7Scala\u6709\u62bd\u8c61\u5c5e\u6027\uff0c\u800cJava\u4e2d\u6ca1\u6709\u62bd\u8c61\u5c5e\u6027\u3002Scala\u5728\u62bd\u8c61\u7c7b\u7684\u8bed\u6cd5\u4e0a\u9700\u8981\u6ce8\u610f\u51e0\u70b9\uff1a 1.\u975e\u62bd\u8c61\u7c7b\u7684\u5c5e\u6027\u5728\u5b9a\u4e49\u65f6\u5fc5\u987b\u521d\u59cb\u5316\uff0c\u4f46\u662f\u5728\u62bd\u8c61\u7c7b\u4e2d\u7684\u62bd\u8c61\u5c5e\u6027\u5e76\u4e0d\u9700\u8981 2.\u5fc5\u987b\u5b9e\u73b0\u7236\u7c7bvar\u7c7b\u578b\u7684\u62bd\u8c61\u53d8\u91cf\uff0c\u5fc5\u987b\u5b9e\u73b0\u7236\u7c7bval\u7c7b\u578b\u7684\u62bd\u8c61\u5e38\u91cf\uff0coverride\u5173\u952e\u5b57\u53ef\u52a0\u53ef\u4e0d\u52a0\u3002\u6ce8\u610f\u4e0eoverride\u975e\u62bd\u8c61\u5c5e\u6027\u7684\u533a\u522b\uff0c\u53ea\u80fdoverride\u975e\u62bd\u8c61val\u5e38\u91cf\uff0c\u4e0d\u80fdoverride\u975e\u62bd\u8c61var\u53d8\u91cf\u3002 3.\u91cd\u5199\u975e\u62bd\u8c61\u65b9\u6cd5\u9700\u8981\u7528 override \u4fee\u9970\uff0c\u91cd\u5199\u62bd\u8c61\u65b9\u6cd5\u5219\u53ef\u52a0\u53ef\u4e0d\u52a0 override Text Only<pre><code>abstract class Person {\n\u00a0\u00a0var name: String\n\u00a0\u00a0val age: Int\n\n\u00a0 def printInfo(): Unit\n\n\u00a0\u00a0def printName(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"name: \" + name)\n\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>class Student extends Person {\n\u00a0\u00a0//\u5fc5\u987b\u5b9e\u73b0\u7236\u7c7bvar\u7c7b\u578b\u7684\u62bd\u8c61\u53d8\u91cf\n\u00a0\u00a0var name = \"student\"\n\u00a0\u00a0//\u5fc5\u987b\u5b9e\u73b0\u7236\u7c7bval\u7c7b\u578b\u7684\u62bd\u8c61\u5e38\u91cf\n\u00a0 val age: Int = 18\n\n\u00a0\u00a0//\u91cd\u5199\u62bd\u8c61\u65b9\u6cd5\u5219\u53ef\u4ee5\u4e0d\u52a0 override\n\u00a0\u00a0def printInfo(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"name: \" + name + \", age: \" + age)\n\u00a0\u00a0}\n\n\u00a0\u00a0//\u91cd\u5199\u975e\u62bd\u8c61\u65b9\u6cd5\u9700\u8981\u7528 override \u4fee\u9970\n\u00a0\u00a0override def printName(): Unit = super.printName()\n}\n</code></pre></p> <p>\u533f\u540d\u5b50\u7c7b\uff0cScala\u7684\u533f\u540d\u5b50\u7c7b\u548cJava\u7684\u533f\u540d\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u5728\u8bed\u6cd5\u4e0a\u6709\u70b9\u4e0d\u540c\uff0cScala\u5b9a\u4e49\u533f\u540d\u5b50\u7c7b\u65f6\u4e0d\u9700\u8981\u52a0()\uff0c\u4f46\u662fJava\u8981\u3002 Text Only<pre><code>val person = new Person {\n\u00a0\u00a0override var name: String = \"bob\"\n\u00a0\u00a0override val age: Int = 19\n\u00a0\u00a0override def printInfo(): Unit = println(\"name: \" + name + \", age: \" + age)\n}\n</code></pre></p> <p>\u4f34\u751f\u7c7b\u548c\u4f34\u751f\u5bf9\u8c61 Scala\u4e2d\u6ca1\u6709static\u5173\u952e\u5b57\uff0c\u4e3a\u4e86\u5b9e\u73b0static\u5173\u952e\u5b57\u7684\u6548\u679c\uff0c\u5c31\u5f15\u5165\u4e86\u4f34\u751f\u5bf9\u8c61\uff0c\u4f34\u751f\u5bf9\u8c61\u6709\u5982\u4e0b\u7684\u7279\u70b9\uff1a</p> <ol> <li>\u4f34\u751f\u5bf9\u8c61\u662f\u4e00\u4e2a\u5355\u4f8b\u7684\u5df2\u7ecf\u5b9e\u4f8b\u5316\u7684\u5bf9\u8c61</li> <li>\u4f34\u751f\u7c7b\u4e0e\u4f34\u751f\u5bf9\u8c61\u7684\u540d\u5b57\u5fc5\u987b\u76f8\u540c</li> <li>\u4f34\u751f\u7c7b\u53ef\u4ee5\u8bbf\u95ee\u4f34\u751f\u5bf9\u8c61\u7684\u6240\u6709\u5c5e\u6027\u548c\u65b9\u6cd5</li> <li>\u4f34\u751f\u5bf9\u8c61\u4f7f\u7528object\u5173\u952e\u5b57\u58f0\u660e</li> </ol> <p>\u56e0\u4e3a\u4f34\u751f\u5bf9\u8c61\u662f\u5355\u4f8b\u7684\uff0c\u6240\u4ee5\u4f34\u751f\u5bf9\u8c61\u7684\u5c5e\u6027\u5168\u5c40\u5c31\u53ea\u6709\u4e00\u4efd\u4e86\uff0c\u4f34\u751f\u5bf9\u8c61\u5bf9\u8c61\u7684\u65b9\u6cd5\u4e5f\u5c31\u6709\u901a\u8fc7\u8fd9\u4e2a\u4f34\u751f\u5bf9\u8c61\u624d\u80fd\u8bbf\u95ee\u5f97\u5230\uff0c\u4e8e\u662f\u5c31\u5b9e\u73b0\u4e86Java\u4e2d\u7684\u9759\u6001\u5b57\u6bb5\u548c\u9759\u6001\u65b9\u6cd5\u7684\u6548\u679c\u4e86\u3002 \u4f34\u751f\u5bf9\u8c61\u6709\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684apply()\u65b9\u6cd5\uff0c\u7279\u6b8a\u7684\u70b9\u5c31\u5728\u4e8e\uff0c\u901a\u8fc7\u8c03\u7528\u4f34\u751f\u5bf9\u8c61\u7684apply\u65b9\u6cd5\u65f6\u53ef\u4ee5\u4e0d\u7528\u50cf\u8c03\u7528\u5176\u5b83\u65b9\u6cd5\u90a3\u6837\uff0c\u9700\u8981\u628a\u65b9\u6cd5\u663e\u5f0f\u7684\u5199\u51fa\uff0c\u800c\u662f\u76f4\u63a5\u5728\u4f34\u751f\u5bf9\u8c61\u540e\u9762\u52a0\u4e2a\u62ec\u53f7\u5199\u4e0a\u53c2\u6570\u5c31\u4ee3\u8868\u8c03\u7528\u4e86apply\u65b9\u6cd5\u3002 \u4f7f\u7528\u4f34\u751f\u5bf9\u8c61\u5b9e\u73b0\u4f34\u751f\u7c7b\u7684\u5355\u4f8b\u5bf9\u8c61\uff1a Text Only<pre><code>object TestSingleton {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0//val dog = new Dog(\"XiaoHei\", 6)//\u9519\u8bef\uff0cDog\u7684\u6784\u9020\u5668\u5df2\u7ecf\u79c1\u6709\u5316\u4e86\n\u00a0\u00a0\u00a0\u00a0val dog1 = Dog.getInstance()\n\u00a0\u00a0\u00a0\u00a0val dog2 = Dog() //\u8c03\u7528apply\u65b9\u6cd5\n\u00a0\u00a0\u00a0\u00a0println(dog1.eq(dog2)) //true\n\u00a0\u00a0}\n}\n//\u76f4\u63a5\u5728\u53c2\u6570\u5217\u8868\u524d\u9762\u52a0\u4e0aprivate\u5c31\u53ef\u4ee5\u79c1\u6709\u5316\u6784\u9020\u5668\u4e86\nclass Dog private(val name: String, val age: Int) {\n\u00a0\u00a0override def toString = s\"Dog(name=$name, age=$age)\"\n}\nobject Dog {\n\u00a0\u00a0//\u997f\u6c49\u5f0f\n\u00a0\u00a0private val dog: Dog = new Dog(\"WangCai\", 5)\n\u00a0 def getInstance(): Dog = dog\n\u00a0 def apply(): Dog = dog\n}\n</code></pre></p> <p>trait\uff08\u7279\u8d28\uff09 \u62bd\u8c61\u7c7b\u662f\u5bf9\u540c\u4e00\u7c7b\u4e8b\u7269\u7684\u62bd\u8c61\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u7c7b\u4e8b\u7269\u7684\u672c\u8d28\uff1b\u800ctrait\u662f\u5bf9\u6709\u4e9b\u4e0d\u540c\u7c7b\u4e8b\u7269\u6240\u5177\u6709\u7684\u5171\u540c\u7684\u7279\u70b9\u7684\u62bd\u8c61\uff0c\u6709\u4e9b\u4e8b\u7269\u6709\u8fd9\u79cd\u7279\u8d28\uff0c\u6709\u4e9b\u4e8b\u7269\u6ca1\u6709\u8fd9\u79cd\u7279\u8d28\u3002 Scala\u4e2d\u7684trait\u53ef\u4ee5\u88ab\u4e00\u4e2a\u7c7b\u591a\u7ee7\u627f\uff0c\u8fd9\u79f0\u4e3a\u4e00\u4e2a\u7c7b\u6df7\u5165(Mixin)\u4e86\u591a\u4e2a\u7279\u8d28\uff0c\u591a\u7ee7\u627f\u7684\u8fd9\u4e2a\u7279\u70b9\u4e0eJava\u7684\u63a5\u53e3\u7c7b\u4f3c\uff1b Scala \u4e2d\u7684 trait \u5373\u53ef\u4ee5\u6709\u62bd\u8c61\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u6709\u5177\u4f53\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u8fd9\u5374\u4e0eJava\u4e2d\u7684\u62bd\u8c61\u7c7b\u5f88\u7c7b\u4f3c\uff1b\u4ece\u5b57\u8282\u7801\u4e0a\u770b\u4e5f\u662f\u8fd9\u6837\u7684\uff0cScala\u7684trait\u7b49\u4e8e\u62bd\u8c61\u7c7b\u52a0\u63a5\u53e3\u3002 Scala\u7684trait\u4e0eScala\u81ea\u5df1\u5bf9\u62bd\u8c61\u7c7b\u7684\u5b9a\u4e49\u5f88\u7c7b\u4f3c\uff0c\u4f46\u4e5f\u6709\u533a\u522b\uff0c\u5982\u4e0b\uff1a</p> <ol> <li>\u62bd\u8c61\u7c7b\u53ea\u80fd\u88ab\u4e00\u4e2a\u7c7b\u5355\u7ee7\u627f\uff0c\u4f46\u662ftrait\u53ef\u4ee5\u88ab\u4e00\u4e2a\u7c7b\u591a\u6269\u5c55\u3002</li> <li>\u62bd\u8c61\u7c7b\u53ef\u4ee5\u5b9a\u4e49\u6784\u9020\u5668\uff0c\u4f46\u662ftrait\u4e0d\u80fd\u5b9a\u4e49\u6784\u9020\u5668\u3002</li> </ol> Text Only<pre><code>trait PersonTrait {\n\u00a0\u00a0// \u5177\u4f53\u5c5e\u6027\n\u00a0\u00a0var name: String = _\n\u00a0\u00a0// \u62bd\u8c61\u5c5e\u6027\n\u00a0\u00a0var age: Int\n\u00a0\u00a0// \u5177\u4f53\u65b9\u6cd5\n\u00a0\u00a0def eat(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"person eat\")\n\u00a0\u00a0}\n\u00a0\u00a0// \u62bd\u8c61\u65b9\u6cd5\n\u00a0\u00a0def say(): Unit\n}\n</code></pre> <p>\u8ba9\u4e00\u4e2a\u7c7b\u5177\u6709\u67d0\u4e9b\u7279\u8d28\uff0c\u4e5f\u5c31\u7c7b\u7ee7\u627f\u7279\u8d28\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a Text Only<pre><code>\u6ca1\u6709\u7236\u7c7b\uff1aclass \u7c7b\u540d extends \u7279\u8d281 with \u7279\u8d282 with \u7279\u8d283 \u2026\n\u6709\u7236\u7c7b\uff1aclass \u7c7b\u540d extends \u7236\u7c7b with \u7279\u8d281 with \u7279\u8d282 with \u7279\u8d283 \u2026\n</code></pre></p> <p>\u6240\u6709Java\u7684\u63a5\u53e3\u90fd\u53ef\u4ee5\u4f5c\u4e3atrait\u4f7f\u7528 Text Only<pre><code>//\u4f7f\u7528PersonTrait\u7684name\u5c5e\u6027\uff0c\u5b9e\u73b0PersonTrait\u7684age\u5c5e\u6027\nclass Student(_name: String, var age: Int) extends PersonTrait with java.io.Serializable {\n\u00a0\u00a0this.name = _name\n\u00a0\u00a0override def say(): Unit = println(\"student say\")\n}\n</code></pre></p> <p>\u52a8\u6001\u6df7\u5165\uff1a\u53ef\u4ee5\u5728\u521b\u5efa\u7c7b\u7684\u5bf9\u8c61\u65f6\u52a8\u6001\u6df7\u5165 trait\uff0c\u800c\u65e0\u9700\u5148\u4f7f\u8be5\u7c7b\u6df7\u5165\u8be5 trait\uff0c\u7136\u540e\u518d\u521b\u5efa\u5bf9\u8c61 Text Only<pre><code>object DynamicTrait {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val stu = new Student(\"zhangsan\", 18) with SexTrait {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0override var sex: String = \"male\"\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0println(\"name: \" + stu.name + \", age: \" + stu.age + \", sex:\" + stu.sex)\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u7279\u8d28\u53e0\u52a0 \u7531\u4e8e\u4e00\u4e2a\u7c7b\u53ef\u4ee5\u6df7\u5165\uff08 mixin\uff09\u591a\u4e2a trait\uff0c\u5982\u679c\u6df7\u5165\u7684\u591a\u4e2a trait \u4e2d\u6709\u76f8\u540c\u7b7e\u540d\u7684\u5177\u4f53\u65b9\u6cd5\uff0c\u90a3\u5c31\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u89e3\u51b3\u51b2\u7a81\u95ee\u9898\u7684\u65b9\u6cd5\u5c31\u662f\u91cd\u5199\u51b2\u7a81\u7684\u65b9\u6cd5\u3002\u5982\u679c\u6709\u76f8\u540cvar\u53d8\u91cf\uff0c\u4e5f\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u4f46\u662f\u65e0\u6cd5\u89e3\u51b3\u8fd9\u6837\u7684\u51b2\u7a81\uff0c\u56e0\u4e3avar\u53d8\u91cf\u4e0d\u80fd\u88ab\u91cd\u5199\uff0c\u53ea\u80fd\u88ab\u5b50\u7c7b\u4f7f\u7528\uff0c\u611f\u89c9\u50cf\u662fScala\u7684bug\u3002</p> <p>\u5728\u91cd\u5199\u7684\u65b9\u6cd5\u4e2d\u901a\u8fc7super\u8c03\u7528\u7236\u7c7b\u65b9\u6cd5\u65f6\uff0c\u4f1a\u8c03\u7528\u54ea\u4e2a\u7236\u7c7b\u7684\u65b9\u6cd5\u5462\uff0c\u9996\u5148\u8fd9\u4e0etrait\u7684\u58f0\u660e\u987a\u5e8f\u6709\u5173\uff0cScala\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u51b2\u7a81\u7684\u7236\u7c7b\u65b9\u6cd5\u7684\u89c4\u5219\u5c31\u662f\u8fd9\u6837\u7684\uff0csuper\u4f1a\u8c03\u7528\u5728\u7ee7\u627f\u65f6\u58f0\u660e\u5728\u6700\u540e\u9762\u7684\u90a3\u4e2atrait\u7684\u65b9\u6cd5\u3002\u7136\u540e\u8fd8\u8981\u8fdb\u4e00\u6b65\u770btrait\u4e4b\u95f4\u6709\u6ca1\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0c\u4ee5\u53ca\u6700\u540e\u4e00\u4e2atrait\u6709\u6ca1\u6709\u901a\u8fc7\u4e5f\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\u3002 \u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u4e24\u4e2atrait\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0c\u5e76\u4e14TraitB\u3001TraitA\u6709\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u51b2\u7a81\u65b9\u6cd5\uff1a  Text Only<pre><code>trait TraitC {\n\u00a0\u00a0def fun(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"trait-c have a fun\")\n\u00a0\u00a0}\n}\ntrait TraitA extends TraitC {\n\u00a0\u00a0override def fun(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"trait-a have a fun\")\n `super.fun()`\n\u00a0\u00a0}\n}\ntrait TraitB extends TraitC {\n\u00a0\u00a0override def fun(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"trait-b have a fun\")\n `super.fun()`\n\u00a0\u00a0}\n}\nclass Sub `extends TraitA with TraitB` {\n\u00a0\u00a0//\u5fc5\u987b\u91cd\u5199\uff0c\u4e0d\u7136\u5c31\u4f1a\u4ea7\u751f\u51b2\u7a81\n\u00a0\u00a0override def fun(): Unit = `super.fun()`\n}\nobject Test {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val sub = new Sub\n\u00a0\u00a0\u00a0\u00a0sub.fun()\n\u00a0\u00a0}\n}\n</code></pre> \u8c03\u7528\u7ed3\u679c\uff1a Text Only<pre><code>trait-b have a fun\ntrait-a have a fun\ntrait-c have a fun\n</code></pre></p> <p>\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u4e24\u4e2atrait\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0cTraitB\u6ca1\u6709\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u51b2\u7a81\u65b9\u6cd5\uff0cTraitA\u6709\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u51b2\u7a81\u65b9\u6cd5 \u8c03\u7528\u7ed3\u679c\uff1a Text Only<pre><code>trait-b have a fun\n</code></pre></p> <p>\u7b2c\u4e09\u79cd\u60c5\u51b5\uff0c\u4e24\u4e2atrait\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0cTraitB\u6709\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u51b2\u7a81\u65b9\u6cd5\uff0c\u4f46\u662fTraitA\u6ca1\u6709\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u7684\u51b2\u7a81\u65b9\u6cd5 \u8c03\u7528\u7ed3\u679c\uff1a Text Only<pre><code>trait-b have a fun\ntrait-a have a fun\n</code></pre></p> <p>\u524d\u4e09\u79cd\u60c5\u51b5\u4e2d\u4e24\u4e2atrait\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u83f1\u5f62\u7ee7\u627f\u95ee\u9898\u3002</p> <p>\u7b2c\u56db\u79cd\u60c5\u51b5\uff0c\u4e24\u4e2atrait\u6ca1\u6709\u5171\u540c\u7684\u7236\u7c7b\uff0c\u6240\u4ee5\u5373\u4f7fTraitB\u6709\u901a\u8fc7super\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u4e5f\u4e0d\u4f1a\u8c03\u7528\u5230TraitA\u7684\u51b2\u7a81\u7684\u65b9\u6cd5\u3002  Text Only<pre><code>trait TraitA {\n\u00a0\u00a0def fun(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"trait-a have a fun\")\n\u00a0\u00a0}\n}\ntrait TraitB {\n\u00a0\u00a0def fun(): Unit = {\n\u00a0\u00a0\u00a0\u00a0println(\"trait-b have a fun\")\n\u00a0\u00a0}\n}\nclass Sub extends TraitA with TraitB {\n\u00a0\u00a0//\u5fc5\u987b\u91cd\u5199\uff0c\u4e0d\u7136\u5c31\u4f1a\u4ea7\u751f\u51b2\u7a81\n\u00a0\u00a0override def fun(): Unit = super.fun()\n}\nobject Test {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val sub = new Sub\n\u00a0\u00a0\u00a0\u00a0sub.fun()\n\u00a0\u00a0}\n}\n</code></pre> \u8c03\u7528\u7ed3\u679c\u662f\uff1a Text Only<pre><code>trait-b have a fun\n</code></pre></p> <p>\u5bf9\u4e8e\u4ea7\u751f\u51b2\u7a81\u65f6\uff0csuper\u5173\u952e\u5b57\u5230\u5e95\u8c03\u7528\u54ea\u4e2a\u7236\u7c7b\u7684\u65b9\u6cd5\uff0cScala\u91c7\u7528\u4e86\u7279\u8d28\u53e0\u52a0\u7684\u7b56\u7565\uff1a \u7b2c\u4e00\u6b65\uff1a\u5217\u51fa\u6df7\u5165\u7684\u7b2c\u4e00\u4e2a\u7279\u8d28\uff08 TraitA\uff09\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u4f5c\u4e3a\u4e34\u65f6\u53e0\u52a0\u987a\u5e8f Text Only<pre><code>TraitA --&gt; TraitC\n</code></pre> \u7b2c\u4e8c\u6b65\uff1a\u5217\u51fa\u6df7\u5165\u7684\u7b2c\u4e8c\u4e2a\u7279\u8d28\uff08TraitB\uff09\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u5e76\u5c06\u8be5\u987a\u5e8f\u53e0\u52a0\u5230\u524d\u9762\u7684\u987a\u5e8f\u4e0a\uff0c \u5df2\u7ecf\u51fa\u73b0\u7684\u7279\u8d28\u4e0d\u518d\u91cd\u590d Text Only<pre><code>TraitB --&gt;\u00a0\u00a0TraitC\n</code></pre> Text Only<pre><code>TraitB --&gt; TraitA --&gt; TraitC\n</code></pre> \u7b2c\u4e09\u6b65\uff1a\u5c06\u5b50\u7c7b\uff08Sub\uff09\u653e\u5728\u4e34\u65f6\u53e0\u52a0\u987a\u5e8f\u7684\u7b2c\u4e00\u4e2a\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u53e0\u52a0\u987a\u5e8f Text Only<pre><code>Sub --&gt; TraitB --&gt; TraitA --&gt; TraitC\n</code></pre></p> <p>\u5982\u679c\u60f3\u8981\u8c03\u7528\u67d0\u4e2a\u6307\u5b9a\u7684\u6df7\u5165\u7279\u8d28\u4e2d\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u589e\u52a0\u7ea6\u675f\uff1a super[]\uff0c\u6bd4\u5982\u628a\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684Sub\u4e2d\u7684\u8c03\u7528\u6539\u6210super[TraitA].fun()\uff0c\u90a3\u4e48\u8c03\u7528\u7684\u7ed3\u679c\u5c31\u662f\uff1a Text Only<pre><code>trait-a have a fun\ntrait-c have a fun\n</code></pre></p> <p>\u7c7b\u578b\u68c0\u67e5\u548c\u8f6c\u6362</p> <ul> <li>obj.isInstanceOf[T]\uff1a\u5224\u65ad obj \u662f\u4e0d\u662f T \u7c7b\u578b\u3002</li> <li>obj.asInstanceOf[T]\uff1a\u5c06 obj \u5f3a\u8f6c\u6210 T \u7c7b\u578b\uff08Java\u4e2d\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u7684\u8bed\u6cd5\u662f\u62ec\u53f7\u52a0\u7c7b\u578b\uff0c\u6bd4\u5982\uff1a(int)\uff0cScala\u4e2d\u6ca1\u6709\u8fd9\u79cd\u5f3a\u5236\u8f6c\u6362\u7c7b\u578b\u7684\u8bed\u6cd5\uff0c\u800c\u662f\u4f7f\u7528obj.asInstanceOf[T]\u4ee3\u66ff\uff09\u3002</li> <li>classOf \u83b7\u53d6\u5bf9\u8c61\u7684\u7c7b\u540d\u3002</li> </ul> Text Only<pre><code>class Person\nclass Student extends Person\n\nobject Test {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val person: Person = new Student\n\u00a0\u00a0\u00a0\u00a0//\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u4e3a\u67d0\u4e2a\u7c7b\u578b\u7684\u5b9e\u4f8b\n\u00a0\u00a0\u00a0\u00a0if (person.isInstanceOf[Student]) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8f6c\u6362\u5f15\u7528\u7684\u7c7b\u578b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val person1: Student = person.asInstanceOf[Student]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(person1) //chapter06.Student@13c78c0b\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0//\u83b7\u53d6\u7c7b\u7684\u4fe1\u606f\n\u00a0\u00a0\u00a0\u00a0val pClass: Class[Person] = classOf[Person]\n\u00a0\u00a0\u00a0\u00a0println(pClass)\u00a0\u00a0//class chapter06.Person\n\u00a0\u00a0}\n}\n</code></pre> <p>\u679a\u4e3e\u7c7b\u9700\u8981\u7ee7\u627f Enumeration \u5e94\u7528\u7c7b\u9700\u8981\u7ee7\u627f App\uff0c\u5e94\u7528\u7c7b\u5c31\u662f\u5df2\u7ecf\u5e2e\u4f60\u628amain\u65b9\u6cd5\u7684\u5b9a\u4e49\u5199\u597d\u7684\u7c7b\uff0c\u4f60\u53ea\u9700\u8981\u7ee7\u627f App\u5c31\u53ef\u4ee5\u76f4\u63a5\u5199main\u65b9\u6cd5\u91cc\u9762\u7684\u4ee3\u7801\u4e86 Text Only<pre><code>object Color `extends Enumeration` {\n\u00a0\u00a0val RED = Value(1, \"red\")\n\u00a0\u00a0val YELLOW = Value(2, \"yellow\")\n\u00a0\u00a0val BLUE = Value(3, \"blue\")\n}\n\nobject Test `extends App` {\n\u00a0\u00a0println(Color.RED) //red\n\u00a0\u00a0println(Color.RED.id) //1\n\u00a0\u00a0println(Color.values) //Color.ValueSet(red, yellow, blue)\n}\n</code></pre></p> <p>Type \u5b9a\u4e49\u65b0\u7c7b\u578b\uff1a \u4f7f\u7528 type \u5173\u952e\u5b57\u53ef\u4ee5\u5b9a\u4e49\u65b0\u7684\u6570\u636e\u7c7b\u578b\u540d\u79f0\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u7c7b\u578b\u7684\u4e00\u4e2a\u522b\u540d\u3001 Text Only<pre><code>object TestType extends App {\n\u00a0\u00a0`type MyString = String`\n\u00a0\u00a0val str: MyString = \"abc\"\n\u00a0\u00a0println(str)\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/7-%E9%9B%86%E5%90%88/","title":"7-\u96c6\u5408","text":"<p> \u7ea6 3340 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 67 \u5206\u949f</p> <p>Scala \u7684\u96c6\u5408\u6709\u4e09\u5927\u7c7b\uff1a\u5e8f\u5217 Seq\u3001\u96c6\u5408 Set\u3001 \u6620\u5c04 Map\uff0c \u6240\u6709\u7684\u96c6\u5408\u90fd\u6269\u5c55\u81ea Iterable\u7279\u8d28\u3002 \u5bf9\u4e8e\u51e0\u4e4e\u6240\u6709\u7684\u96c6\u5408\u7c7b\uff0cScala \u90fd\u540c\u65f6\u63d0\u4f9b\u4e86\u53ef\u53d8\u548c\u4e0d\u53ef\u53d8\u7684\u7248\u672c\uff0c\u5206\u522b\u4f4d\u4e8escala.collection.mutable \u548c scala.collection.immutable \u3002 \u4e0d\u53ef\u53d8\u5728\u4e0d\u540c\u7684\u4e0d\u53ef\u53d8\u96c6\u5408\u4e2d\u610f\u601d\u662f\u4e0d\u4e00\u6837\u7684\u3002\u5bf9\u4e8eArray\u6765\u8bf4\uff0c\u4e0d\u53ef\u53d8\u7684\u610f\u601d\u662f\u96c6\u5408\u7684\u5927\u5c0f\u4e0d\u80fd\u52a8\u6001\u53d8\u5316\uff0c\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684\u6570\u7ec4\uff08int[]\uff09\uff0c\u4f46\u662f\u53ef\u4ee5\u5bf9Array\u4e2d\u7684\u5143\u7d20\u8fdb\u884c\u4fee\u6539\uff1b\u5bf9\u4e8eList\u800c\u8a00\uff0c\u4e0d\u53ef\u53d8\u7684\u610f\u601d\u662fListi\u4e00\u65e6\u521b\u5efa\u4e4b\u540e\uff0c\u5c31\u4e0d\u80fd\u65b0\u589e\u52a0\u5143\u7d20\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539List\u4e2d\u5143\u7d20\u7684\u503c\u3002\u5bf9\u4e8eMap\u4e5f\u662f\u65e2\u4e0d\u80fd\u6dfb\u52a0\u4e5f\u4e0d\u80fd\u4fee\u6539\u3002\u603b\u4e4b\uff0c\u4e0d\u53ef\u53d8\u96c6\u5408\u7684\u5927\u5c0f\u662f\u4e00\u5b9a\u4e0d\u80fd\u6539\u53d8\uff0c\u6240\u6709\u4f1a\u6539\u53d8\u5927\u5c0f\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u65b0\u589e\u6216\u8005\u5220\u9664\u5143\u7d20\uff0c\u90fd\u4f1a\u91cd\u65b0\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u96c6\u5408\u7136\u540e\u8fd4\u56de\uff0c\u539f\u6709\u7684\u96c6\u5408\u4e0d\u53d8\uff0c\u81f3\u4e8e\u80fd\u4e0d\u80fd\u4fee\u6539\u96c6\u5408\u4e2d\u539f\u6709\u5143\u7d20\u7684\u503c\uff0c\u597d\u50cf\u53ea\u6709Array\u80fd\u4fee\u6539\uff0c\u5176\u5b83\u96c6\u5408\u5747\u4e0d\u80fd\u4fee\u6539\u3002 \u53ef\u53d8\u7684\u610f\u601d\u662f\u5f15\u7528\u59cb\u7ec8\u90fd\u662f\u8fd9\u4e2a\u5f15\u7528\uff0c\u96c6\u5408\u5185\u90e8\u662f\u5982\u4f55\u8c03\u6574\u5927\u5c0f\u5bf9\u4e8e\u4f7f\u7528\u8005\u662f\u900f\u660e\u7684\uff0c\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684ArrayList\u7b49\u96c6\u5408\u3002 \u4e0d\u53ef\u53d8\u96c6\u5408\uff1a  1. Set\u3001Map \u662f Java \u4e2d\u4e5f\u6709\u7684\u96c6\u5408 2. Seq \u662f Java \u6ca1\u6709\u7684\uff0c\u6211\u4eec\u53d1\u73b0 List \u5f52\u5c5e\u5230 Seq \u4e86\uff0c\u56e0\u6b64\u8fd9\u91cc\u7684 List \u5c31\u548c Java \u4e0d\u662f\u540c\u4e00\u4e2a\u6982\u5ff5\u4e86 3. for \u5faa\u73af\u4e2d\u7684 1 to 3\uff0c\u5c31\u662f IndexedSeq \u4e0b\u7684 Range 4. String \u4e5f\u5c5e\u4e8e IndexedSeq\uff0c\u5b9e\u9645\u4e0a\u662fScala\u904d\u5386\u5668\u505a\u4e86\u9690\u5f0f\u8f6c\u6362\uff0cArray\u4e5f\u662f\u8fd9\u6837\u7684 5. Queue \u548c Stack \u88ab\u5f52\u5c5e\u5230 LinearSeq(\u7ebf\u6027\u5e8f\u5217) IndexedSeq \u548c LinearSeq \u7684\u533a\u522b\uff1a</p> <ul> <li>IndexedSeq \u662f\u901a\u8fc7\u7d22\u5f15\u6765\u67e5\u627e\u548c\u5b9a\u4f4d\uff0c\u56e0\u6b64\u901f\u5ea6\u5feb\uff0c\u6bd4\u5982 String \u5c31\u662f\u4e00\u4e2a\u7d22\u5f15\u96c6\u5408\uff0c\u901a\u8fc7\u7d22\u5f15\u5373\u53ef\u5b9a\u4f4d</li> <li>LinearSeq \u662f\u7ebf\u578b\u7684\uff0c\u5373\u6709\u5934\u5c3e\u7684\u6982\u5ff5\uff0c\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u4e00\u822c\u662f\u62ff\u6765\u904d\u5386\u7684</li> </ul> <p>\u53ef\u53d8\u96c6\u5408\uff1a </p> <p>\u6570\u7ec4Array\uff0c\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684\u6570\u7ec4\uff08\u6bd4\u5982\uff1aint[]\uff09\uff1a \u7b2c\u4e00\u79cd\u5b9a\u4e49\u6570\u7ec4\u7684\u65b9\u5f0f\uff0c\u65b9\u62ec\u53f7\u662fScala\u7684\u6cdb\u578b\uff0c\u5982\u679c\u5148\u4fdd\u5b58\u4efb\u4f55\u7c7b\u578b\u7684\u5143\u7d20\u5c31\u6709Any\u7c7b\u578b\uff0c\u8fd9\u91cc\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a5\u7684\u6570\u7ec4\uff0c\u5b9a\u4e49\u4e4b\u540e\u6570\u7ec4\u7684\u5927\u5c0f\u5c31\u4e0d\u80fd\u518d\u6539\u53d8\u4e86 Text Only<pre><code>val arr: Array[Int] = new Array[Int](5)\n</code></pre> \u7b2c\u4e8c\u79cd\u5b9a\u4e49\u65b9\u5f0f\uff0c\u6b64\u65b9\u5f0f\u4f7f\u7528\u4e86\u4f34\u751f\u5bf9\u8c61Array\u7684apply()\u65b9\u6cd5 Text Only<pre><code>val arr2 = Array(12, 37, 42, 58, 97)\n</code></pre></p> <p>\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\uff1a \u8bfb\u6570\u7ec4\u4e2d\u7684\u67d0\u4e00\u4e2a\u5143\u7d20\u8c03\u7528\u7684\u662f\u4f34\u751f\u7c7bArray\u7684apply\u65b9\u6cd5\uff0c\u548c\u4f34\u751f\u5bf9\u8c61\u7684apply\u65b9\u6cd5\u4e00\u6837\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\uff0c\u5e76\u4e0d\u662f\u8bf4\u7528\u6237\u4e3a\u4f34\u751f\u7c7b\u81ea\u5b9a\u4e49\u7684apply\u65b9\u6cd5\u4e5f\u53ef\u4ee5\u8fd9\u6837\u7528\uff0cArray\u7684\u8fd9\u4e2aapply\u65b9\u6cd5\u7684\u65b9\u6cd5\u4f53\u662f\u7f16\u8bd1\u5668\u81ea\u52a8\u751f\u6210\u7684\uff0c\u8bb8\u591a\u96c6\u5408\u7c7b\u578b\u90fd\u662f\u8fd9\u6837\u7684\uff0c\u662f\u8bbf\u95ee\u96c6\u5408\u7684\u8bed\u6cd5\u7cd6 Text Only<pre><code>val i: Int = arr(0)\n\u7b49\u4ef7\u4e8e\nval i: Int = arr.apply(0)\n</code></pre> \u4fee\u6539\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u8c03\u7528\u7684\u662f\u4f34\u751f\u7c7bArray\u7684Update\u65b9\u6cd5\uff0c\u548cArray\u7684apply\u65b9\u6cd5\u4e00\u6837\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\uff0c\u4e5f\u662f\u7f16\u8bd1\u5668\u81ea\u52a8\u751f\u6210\u65b9\u6cd5\u4f53 Text Only<pre><code>arr(0)=1\n\u7b49\u4ef7\u4e8e\narr.update(0, 1)\n</code></pre></p> <p>\u6570\u7ec4\u904d\u5386\u7684\u65b9\u5f0f\uff1a 1.\u666e\u901afor\u5faa\u73af Text Only<pre><code>for (i &lt;- 0 until arr.length){\nprintln(arr(i))\n}\n</code></pre> 0 until arr.length \u53ef\u4ee5\u7528arr.indices\u4ee3\u66ff\uff0c\u8fd4\u56de\u7684\u540c\u6837\u662fRange Text Only<pre><code>for (i &lt;- arr.indices) println(arr(i))\n</code></pre> 2.\u589e\u5f3afor\u5faa\u73af Text Only<pre><code>for (elem &lt;- arr) println(elem)\n</code></pre> 3.\u8fed\u4ee3\u5668 Text Only<pre><code>val iter = arr.iterator\nwhile (iter.hasNext)\nprintln(iter.next())\n</code></pre> 4.\u8c03\u7528foreach\u65b9\u6cd5 Text Only<pre><code>arr.foreach( println )\n</code></pre> 5.\u53ef\u4ee5\u76f4\u63a5\u628a\u6574\u4e2a\u96c6\u5408\u4ee5\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u8fd4\u56de Text Only<pre><code>println(arr.mkString(\"--\"))\n</code></pre></p> <p>\u4e3a\u6570\u7ec4\u6dfb\u52a0\u5143\u7d20\u7684\u65b9\u5f0f\uff0c\u6ce8\u610fArray\u662f\u4e0d\u53ef\u53d8\u96c6\u5408\uff0c\u4e0d\u80fd\u76f4\u63a5\u6dfb\u52a0\u5143\u7d20\uff0c\u53ea\u80fd\u662f\u5148\u521b\u5efa\u65b0\u7684\u96c6\u5408\uff0c\u7136\u540e\u518d\u590d\u5236\u8d4b\u503c\uff0c\u6700\u540e\u8fd4\u56de\u8fd9\u4e2a\u65b0\u7684\u96c6\u5408\u7684\u5f15\u7528\u3002 1.\u5728\u5c3e\u90e8\u6dfb\u52a0\u5143\u7d20\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\uff0c:+ \u662f\u4e00\u4e2a\u65b9\u6cd5 Text Only<pre><code>val newArr = arr.:+(73)\n</code></pre> \u6211\u4eec\u77e5\u9053\u65b9\u6cd5\u8c03\u7528\u53ef\u4ee5\u7b80\u5316\uff0c\u70b9.\u53ef\u4ee5\u7528\u7a7a\u683c\u4ee3\u66ff\uff0c\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\u65f6\u5c0f\u62ec\u53f7\u53ef\u4ee5\u7701\u7565\uff0c\u4e8e\u662f\u4e0a\u9762\u7684\u8c03\u7528\u53ef\u4ee5\u5199\u6210\uff1a Text Only<pre><code>val newArr = arr :+ 73\n</code></pre> 2.\u5728\u5934\u90e8\u6dfb\u52a0\u65b0\u7684\u5143\u7d20\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\uff0c+: \u662f\u4e00\u4e2a\u65b9\u6cd5 Text Only<pre><code>val newArr2 = newArr.+:(15)\n</code></pre> \u540c\u6837\u53ef\u4ee5\u7b80\u5316\u8c03\u7528\uff0c\u4f46\u662fScala\u7f16\u8bd1\u5668\u89c4\u5b9a\u4ee5 : \u7ed3\u5c3e\u7684\u65b9\u6cd5\u7684\u7b80\u5316\u8c03\u7528\u8981\u53cd\u8fc7\u6765\u5199\uff0c\u6bd4\u5982\u8fd9\u4e2a +: \u7684\u7b80\u5316\u8c03\u7528\uff1a Text Only<pre><code>val newArr2 = 15 +: newArr\n</code></pre> \u4e8e\u662f\u53ef\u4ee5\u8fd9\u6837\u4e3a\u4e00\u4e2a\u6570\u7ec4\u65b0\u589e\u52a0\u5143\u7d20\uff1a Text Only<pre><code>val newArr3 = 19 +: 29 +: newArr2 :+ 26 :+ 73\n</code></pre></p> <p>\u5408\u5e76\u4e24\u4e2a\u6570\u7ec4\u7528++ Text Only<pre><code>val newArr = Array(1, 2, 3) ++ Array(4, 5, 6)\n</code></pre></p> <p>\u603b\u7ed3\uff1a\u5408\u5e76\u4e24\u4e2a \u4e0d\u53ef\u53d8\u96c6\u5408 \u548c \u53ef\u53d8\u96c6\u5408 \u5747\u53ef\u4ee5\u7528++\uff0c++\u4f1a\u8fd4\u56de\u4e00\u4e2a\u76f8\u5e94\u7c7b\u578b\u7684\u65b0\u96c6\u5408\uff1b\u5408\u5e76\u53ef\u53d8\u96c6\u5408\u8fd8\u53ef\u4ee5\u4f7f\u7528++=\uff0c++=\u5e76\u4e0d\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u96c6\u5408\uff0c\u800c\u662f\u76f4\u63a5\u5c06\u540e\u4e00\u4e2a\u53ef\u53d8\u96c6\u5408\u7684\u5143\u7d20\u6dfb\u52a0\u5230\u524d\u4e00\u4e2a\u53ef\u53d8\u96c6\u5408\u4e4b\u4e2d\u3002 Text Only<pre><code>val newArr: Array[Int] = Array(1, 2, 3) ++ Array(4, 5, 6)\nval newArrBuf1: ArrayBuffer[Int] = ArrayBuffer(1, 2, 3) ++= ArrayBuffer(4, 5, 6)\nval newArrBuf2: ArrayBuffer[Int] = ArrayBuffer(1, 2, 3) ++= Array(4, 5, 6)\n</code></pre></p> <p>\u53ef\u53d8\u6570\u7ec4ArrayBuffer\uff0c\u7c7b\u4f3c\u4e8eJava\u4e2d\u7684ArrayList: \u5b9a\u4e49ArrayBuffer\u7684\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e0e\u5b9a\u4e49Array\u7684\u4e24\u79cd\u65b9\u5f0f\u4e00\u6837\uff1a Text Only<pre><code>val arr1: ArrayBuffer[Int] = new ArrayBuffer[Int]() //\u4f7f\u7528ArrayBuffer\u7c7b\u7684\u6784\u9020\u5668\nval arr2 = ArrayBuffer(23, 57, 92)\u00a0 //\u4f7f\u7528\u4f34\u751f\u5bf9\u8c61ArrayBuffer\u7684apply\u65b9\u6cd5\n</code></pre> \u8bbf\u95ee ArrayBuffer\u5143\u7d20\u7684\u65b9\u5f0f\u4e0eArray\u4e00\u6837\uff0c\u904d\u5386 ArrayBuffer \u7684\u65b9\u5f0f\u4e5f\u4e00\u6837\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u540c\u6837\u4e5f\u662f\u7528\u4e8e\u5176\u5b83\u96c6\u5408\u3002</p> <p>\u6dfb\u52a0\u5143\u7d20\u7684\u65b9\u5f0f\uff1a 1.\u540c\u6837\u53ef\u4ee5\u4f7f\u7528 :+ \u548c +: \u4e24\u4e2a\u65b9\u6cd5\u4e3a ArrayBuffer \u6dfb\u52a0\u5143\u7d20\uff0c\u4f46\u662f\u4e5f\u540c\u6837\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684ArrayBuffer\uff0c\u6240\u4ee5\u6781\u529b\u4e0d\u63a8\u8350\u8fd9\u6837\u505a\uff0c\u56e0\u4e3aArrayBuffer\u662f\u53ef\u53d8\u7684\u6570\u7ec4 2.\u4f7f\u7528 += \u65b9\u6cd5\u4e3a ArrayBuffer \u5728\u5c3e\u90e8\u6dfb\u52a0\u5143\u7d20 Text Only<pre><code>arr2 += 100\n</code></pre> 3.\u4f7f\u7528 +=: \u65b9\u6cd5\u4e3a ArrayBuffer \u5728\u5934\u90e8\u6dfb\u52a0\u5143\u7d20 Text Only<pre><code>77 +=: arr2\n</code></pre> \u540c\u6837\u4e0d\u63a8\u8350\u4f7f\u7528 += \u548c +=: \u4e24\u4e2a\u65b9\u6cd5\uff0c\u5bf9\u4e8e\u53ef\u53d8\u6570\u7ec4\u66f4\u63a8\u8350\u4f7f\u7528append\u7b49\u82f1\u6587\u51fd\u6570\u540d\u66f4\u52a0\u76f4\u89c2\u660e\u4e86\u7684\u65b9\u6cd5\uff1a Text Only<pre><code>arr1.append(36) //\u5728\u5c3e\u90e8\u6dfb\u52a0\u5143\u7d20\narr1.prepend(11, 76) //\u5728\u5934\u90e8\u6dfb\u52a0\u5143\u7d20\narr1.insert(1, 13, 59) //\u5728\u7d22\u5f15\u4e3a1\u7684\u4f4d\u7f6e\u6dfb\u52a0\u5143\u7d20\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7d22\u5f15\uff0c\u7b2c\u4e8c\u53c2\u6570\u662f\u53ef\u53d8\u53c2\u6570\narr1.insertAll(2, newArr1)\u00a0 //\u5728\u7d22\u5f15\u4e3a2\u7684\u4f4d\u7f6e\u540e\u9762\u63d2\u5165\u6570\u7ec4\narr1.prependAll(newArr2)\u00a0 //\u5728\u5934\u90e8\u63d2\u5165\u6570\u7ec4\n</code></pre></p> <p>\u7ea6\u5b9a\uff1a \u5728\u64cd\u4f5c\u96c6\u5408\u7684\u65f6\u5019\uff0c\u4e0d\u53ef\u53d8\u7528\u7b26\u53f7\u65b9\u6cd5\uff0c\u53ef\u53d8\u7528\u82f1\u6587\u540d\u65b9\u6cd5</p> <p>\u5220\u9664\u5143\u7d20\u7684\u65b9\u5f0f\uff1a 1.\u4f7f\u7528 -= \u5220\u9664\u6307\u5b9a\u503c\u7684\u5143\u7d20 Text Only<pre><code>arr1 -= 13 //\u5220\u9664\u5143\u7d20\u503c\u4e3a13\u7684\u5143\u7d20\uff0c\u53ea\u5220\u9664\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u90a3\u4e00\u4e2a\uff0c\u5982\u679c\u6570\u7ec4\u4e2d\u6ca1\u6709\u8fd9\u4e2a\u503c\uff0c\u5c31\u4e0d\u505a\u4efb\u4f55\u6539\u53d8\n</code></pre> 2.\u4f7f\u7528\u5176\u5b83\u65b9\u6cd5\u5220\u9664\u5143\u7d20 Text Only<pre><code>arr1.remove(3) //\u5220\u9664\u6307\u5b9a\u7d22\u5f15\u4f4d\u7f6e\u7684\u5143\u7d20\narr1.remove(0, 10) //\u5220\u9664\u6307\u5b9a\u7d22\u5f15\u4f4d\u7f6e\u5373\u4e4b\u540e\u591a\u5c11\u4e2a\u5143\u7d20\n</code></pre></p> <p>\u53ef\u53d8\u6570\u7ec4\u548c\u4e0d\u53ef\u53d8\u6570\u7ec4\u7684\u8f6c\u6362 1.\u53ef\u53d8\u6570\u7ec4\u8f6c\u6362\u4e3a\u4e0d\u53ef\u53d8\u6570\u7ec4\uff0c\u8c03\u7528toArray\u65b9\u6cd5 Text Only<pre><code>val arr2 = ArrayBuffer[Int]()\nval newArr: Array[Int] = arr.toArray\n</code></pre> 2.\u4e0d\u53ef\u53d8\u6570\u7ec4\u8f6c\u6362\u4e3a\u53ef\u53d8\u6570\u7ec4\uff0c\u8c03\u7528toBuffer\u65b9\u6cd5 Text Only<pre><code>val arr = Array(12, 37, 42, 58, 97)\nval newBuffer: mutable.Buffer[Int] = arr.toBuffer\n</code></pre></p> <p>\u4e8c\u7ef4\u6570\u7ec4 \u521b\u5efa\u4e8c\u7ef4\u6570\u7ec4\uff1a Text Only<pre><code>val array: Array[Array[Int]] = Array.ofDim[Int](2, 3)\n</code></pre> \u8bbf\u95ee\uff1a Text Only<pre><code>array(0)(2) = 19\n</code></pre> \u904d\u5386\uff1a Text Only<pre><code>//\u7b2c\u4e00\u79cd\u904d\u5386\u65b9\u5f0f\narray.foreach(line =&gt; println(line.mkString(\", \")))\n//\u7b2c\u4e8c\u79cd\u904d\u5386\u65b9\u5f0f\nfor (i &lt;- array.indices; j &lt;- array(i).indices){\nprint(array(i)(j) + \"\\t\")\nif (j == array(i).length - 1) println()\n}\n</code></pre></p> <p>\u4e0d\u53ef\u53d8 List \u4e0d\u540c\u4e8eJava\u7684\u5212\u5206\uff0c\u5728Scala\u4e2dList\u548cArray\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u96c6\u5408\u7c7b\u578b\uff0cArray\u662f\u6df7\u5165\u4e86IndexedSeq\u7279\u8d28\u7684\uff0c\u800cList\u662f\u6df7\u5165\u4e86LinearSeq\u7279\u8d28\u7684\uff0c\u4e5f\u5c31\u662fArray\u662f\u53ef\u4ee5\u901a\u8fc7\u7d22\u5f15\u6765\u5feb\u901f\u5b9a\u4f4d\u5143\u7d20\u7684\uff0c\u800cList\u4e0d\u884c\u3002</p> <p>\u5b9a\u4e49\u4e0d\u53ef\u53d8List\u96c6\u5408\uff1a \u56e0\u4e3aList\u5728\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u53ea\u7528List\u7684\u6784\u9020\u5668\u6765\u5b9a\u4e49List\uff0c\u53ea\u80fd\u901a\u8fc7List\u7684\u4f34\u751f\u5bf9\u8c61\u7684apply\u65b9\u6cd5\u6765\u521b\u5efaList\uff1a Text Only<pre><code>val list = List(1, 2, 3)\n</code></pre> \u4f34\u751f\u5bf9\u8c61List\u7684apply\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\uff08\u5982\u4e0b\uff09\uff0cScala\u5bf9\u4e8e\u53ef\u53d8\u53c2\u6570\u4f1a\u5c01\u88c5\u6210ArrayBuffer\uff0c\u7136\u540e\u5728apply\u65b9\u6cd5\u4e2d\u8c03\u7528 ArrayBuffer \u7684 toList \u65b9\u6cd5\u8f6c\u6362\u6210\u4e86List\uff1a Text Only<pre><code>override def apply[A](xs: A*): List[A] = xs.toList\n</code></pre> \u62bd\u8c61\u7c7bList\u5b9a\u4e49\u65f6\u524d\u9762\u8fd8\u6709\u4e00\u4e2asealed\u5173\u952e\u5b57\uff0c\u8be5\u5173\u952e\u5b57\u8868\u793a\u7684\u610f\u601d\u662f\uff0c\u88ab\u4fee\u9970\u7684\u7c7b\u7684\u5b50\u7c7b\u53ea\u80fd\u5b9a\u4e49\u5728\u5f53\u524d\u6587\u4ef6\u4e2d\u3002List\u6709\u4e24\u4e2a\u5b50\u7c7b Nil \u548c :: \uff0cNil\u8868\u793a\u7684\u662f\u4e00\u4e2a\u7a7aList\u5bf9\u8c61\uff0c:: \u662fList\u7684\u4e00\u4e2a\u5177\u4f53\u5b9e\u73b0\u7c7b\u3002</p> <p>\u8bbf\u95eeList\u7684\u5143\u7d20\uff1a \u867d\u7136List\u4e0d\u80fd\u901a\u8fc7\u7d22\u5f15\u968f\u673a\u8bbf\u95ee\uff0c\u4f46\u662f\u4e3a\u4e86\u8bfb\u53d6\u5143\u7d20\u7684\u65b9\u4fbf\uff0cScala\u4e3aList\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\u7684apply\u65b9\u6cd5\uff0c\u5b9e\u73b0\u53ef\u4ee5\u901a\u8fc7\u4e0b\u6807\u7684\u65b9\u5f0f\u8bbf\u95ee\u5230\u6570\u7ec4\u7684\u5143\u7d20\uff0c\u8fd9\u79cd\u5c31\u7c7b\u4f3c\u4e8e\u901a\u8fc7\u4e0b\u6807\u8bbf\u95ee\u94fe\u8868\u4e00\u6837\uff0c\u5b9e\u73b0\u7684\u8fc7\u7a0b\u5176\u5b9e\u987a\u5e8f\u904d\u5386\u5230\u4e0b\u6807\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u800c\u4e0d\u662f\u771f\u6b63\u610f\u601d\u4e0a\u7684\u968f\u673a\u8bbf\u95ee\u3002 Text Only<pre><code>val i: Int = list(1)\n</code></pre> \u4f46\u662fList\u6ca1\u6709\u63d0\u4f9b\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\u7684update\u65b9\u6cd5\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u8c03\u7528\u662f\u9519\u8bef\u7684\uff1a Text Only<pre><code>list(1) = 0\u00a0 //\u9519\u8bef\n</code></pre></p> <p>\u904d\u5386\u7684\u65b9\u5f0f\u4e8eArray\u4e00\u6837\u3002</p> <p>\u6dfb\u52a0\u5143\u7d20\u4e5f\u4e0eArray\u4e00\u6837\uff1a 1.\u5728\u5c3e\u90e8\u6dfb\u52a0\u5143\u7d20\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684List\uff0c:+ \u662f\u4e00\u4e2a\u65b9\u6cd5 Text Only<pre><code>val list1 = list :+ 4\n</code></pre> 2.\u5728\u5934\u90e8\u6dfb\u52a0\u65b0\u7684\u5143\u7d20\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\uff0c+: \u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u4ee5 : \u7ed3\u5c3e\u7684\u65b9\u6cd5\u7684\u7b80\u5316\u8c03\u7528\u8981\u53cd\u8fc7\u6765\u5199 Text Only<pre><code>val list2 = 0 +: list\n</code></pre> List\u6709\u4e00\u4e2a\u65b9\u6cd5\u53eb :: \uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u521b\u5efa\u4e00\u4e2a::\u5bf9\u8c61\uff08\u524d\u9762\u6709\u8bf4\u8fc7List\u6709\u4e00\u4e2a\u5b50\u7c7b\u4e5f\u53eb ::\uff09\uff0c\u5e76\u5c06\u4f20\u8fdb\u6765\u7684\u53c2\u6570\u653e\u5728\u8fd9\u4e2a\u65b0\u7684List\u7684\u6700\u524d\u9762\uff0c\u7136\u540e\u5c06\u539f\u6765List\u7684\u5143\u7d20\u653e\u5728\u540e\u9762\uff0c\u6700\u540e\u8fd4\u56de\u8fd9\u4e2a ::\u5bf9\u8c61\uff0c\u4e8e\u662f\u5c31\u5b9e\u73b0\u4e86\u5728\u5934\u90e8\u6dfb\u52a0\u65b0\u7684\u5143\u7d20 Text Only<pre><code>val list3 = list.::(0)\nprintln(list3)\u00a0 //\u7ed3\u679c\u662f List(0, 1, 2, 3)\n</code></pre> \u524d\u9762\u8fd8\u8bf4\u8fc7List \u6709\u4e00\u4e2a\u7a7a\u5b50\u7c7b\u5bf9\u8c61Nil\uff0c\u4e8e\u662f\u521b\u5efa\u4e00\u4e2aList\u7684\u65b9\u5f0f\u8fd8\u53ef\u4ee5\u662f\u8fd9\u6837\u7684\uff0c\u6ce8\u610f\u4ee5 : \u7ed3\u5c3e\u7684\u65b9\u6cd5\u7684\u7b80\u5316\u8c03\u7528\u8981\u53cd\u8fc7\u6765\u5199 Text Only<pre><code>val list4 = 1 :: 2 :: 3 :: 4 :: Nil\nprintln(list4)\u00a0 //\u7ed3\u679c\u662f List(1, 2, 3, 4)\n</code></pre></p> <p>\u5408\u5e76\u4e24\u4e2aList\u7528 ::: \u65b9\u6cd5 Text Only<pre><code>val list5 = list3 ::: list4\nprintln(list5)\u00a0 //\u7ed3\u679c\u662fList(0, 1, 2, 3, 1, 2, 3, 4)\n</code></pre> \u4e5f\u53ef\u4ee5\u7528 ++ \u65b9\u6cd5\uff0c++ \u65b9\u6cd5\u5176\u5b9e\u8c03\u7528\u7684\u5c31\u662f ::: \u65b9\u6cd5 Text Only<pre><code>val list6 = list3 ++ list4\nprintln(list6) \u00a0//\u7ed3\u679c\u662fList(0, 1, 2, 3, 1, 2, 3, 4)\n</code></pre> \u5408\u5e76\u4e0d\u80fd\u7528 :: \u65b9\u6cd5\uff0c\u8fd9\u4f1a\u628aList\u96c6\u5408\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u6dfb\u52a0 Text Only<pre><code>val list7 = list3 :: list4\nprintln(list7) \u00a0//\u7ed3\u679c\u662fList(List(0, 1, 2, 3), 1, 2, 3, 4)\n</code></pre></p> <p>\u53ef\u53d8\u5217\u8868 ListBuffer \u521b\u5efaListBuffer Text Only<pre><code>val lb1 = new ListBuffer[Int]() //\u4f7f\u7528ListBuffer\u7684\u6784\u9020\u5668\nval lb2 = ListBuffer(1, 2, 3, 4) \u00a0//\u4f7f\u7528\u4f34\u751f\u5bf9\u8c61ListBuffer\u7684apply\u65b9\u6cd5\n</code></pre> \u8bbf\u95ee\u5143\u7d20\uff1a \u56e0\u4e3a ListBuffer\u53ef\u53d8\uff0c\u6240\u4ee5 ListBuffer\u6709\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\u7684update\u65b9\u6cd5\uff0c\u4e5f\u6709\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\u7684apply\u65b9\u6cd5 Text Only<pre><code>lb2(1) = 100\nprintln(lb2(1))\n</code></pre></p> <p>\u6dfb\u52a0\u5143\u7d20 1.\u540c\u6837\u53ef\u4ee5\u4f7f\u7528 :+ \u548c +: \u4e24\u4e2a\u65b9\u6cd5\u4e3a ListBuffer\u6dfb\u52a0\u5143\u7d20\uff0c\u4f46\u662f\u4e5f\u540c\u6837\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684ListBuffer\uff0c\u6240\u4ee5\u6781\u529b\u4e0d\u63a8\u8350\u8fd9\u6837\u505a\uff0c\u56e0\u4e3aListBuffer\u662f\u53ef\u53d8\u7684 2.\u4f7f\u7528 += \u65b9\u6cd5\u4e3a ListBuffer \u5728\u5c3e\u90e8\u6dfb\u52a0\u5143\u7d20 Text Only<pre><code>lb1 += 0\nprintln(lb1)\u00a0 //ListBuffer(0)\n</code></pre> 3.\u4f7f\u7528 +=: \u65b9\u6cd5\u4e3a ListBuffer \u5728\u5934\u90e8\u6dfb\u52a0\u5143\u7d20 Text Only<pre><code>1 +=: lb1\nprintln(lb1)\u00a0 // ListBuffer(1, 0)\n</code></pre> \u540c\u6837\u4e0d\u63a8\u8350\u4f7f\u7528 += \u548c +=: \u4e24\u4e2a\u65b9\u6cd5\uff0c\u5728\u64cd\u4f5c\u53ef\u53d8\u96c6\u5408\u7684\u65f6\u5019\u7528\u82f1\u6587\u540d\u65b9\u6cd5\u8bed\u4e49\u66f4\u52a0\u660e\u786e\uff1a Text Only<pre><code>lb2.append(5) //\u5728\u5c3e\u90e8\u6dfb\u52a0\u5143\u7d20\nlb2.prepend(-1, 0) //\u5728\u5934\u90e8\u6dfb\u52a0\u5143\u7d20\nlb2.insert(1, 0, 0) //\u5728\u7d22\u5f15\u4e3a1\u7684\u4f4d\u7f6e\u6dfb\u52a0\u5143\u7d20\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u7d22\u5f15\uff0c\u7b2c\u4e8c\u53c2\u6570\u662f\u53ef\u53d8\u53c2\u6570\nlb2.insertAll(2, lb1) //\u5728\u7d22\u5f15\u4e3a2\u7684\u4f4d\u7f6e\u540e\u9762\u63d2\u5165\u6570\u7ec4\nlb2.prependAll(lb1) //\u5728\u5934\u90e8\u63d2\u5165\u6570\u7ec4\n</code></pre></p> <p>\u5408\u5e76\u4e24\u4e2aListBuffer\uff1a ++\u65b9\u6cd5\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u65b0\u7684ListBuffer Text Only<pre><code>val lb3 = lb1 ++ lb2\n</code></pre> ++=\u76f4\u63a5\u6539\u53d8\u8c03\u7528\u8be5\u65b9\u6cd5\u7684 ListBuffer Text Only<pre><code>lb1 ++= lb2\nprintln(lb1)\n</code></pre> ListBuffer \u6ca1\u6709 ::: \u65b9\u6cd5\uff0cList\u6ca1\u6709 ++= \u65b9\u6cd5</p> <p>\u5220\u9664\u5143\u7d20\u7684\u65b9\u6cd5\u548cArrayBuffer\u76f8\u540c\u3002</p> <p>Set \u96c6\u5408 Scala\u4e2d\u7684\u4e0d\u53ef\u53d8Set\u548c\u53ef\u53d8Set\u90fd\u53ebSet\uff0c\u53ea\u662f\u5728\u4e0d\u540c\u7684\u5305\u4e0b\uff0c\u9ed8\u8ba4\u662f\u4e0d\u53ef\u53d8\u7684Set\uff0c\u5982\u679c\u60f3\u7528\u53ef\u53d8\u7684Set\uff0c \u9700\u8981\u5f15\u7528scala.collection.mutable.Set \u5305\u3002 \u4e0d\u53ef\u53d8Set \u521b\u5efa\u4e0d\u53ef\u53d8Set\uff0c\u56e0\u4e3aSet\u662f\u4e00\u4e2atrait\u7279\u8d28\u4e0d\u80fd\u76f4\u63a5\u521b\u5efa\u5bf9\u8c61\uff0c\u6240\u4ee5\u53ea\u80fd\u7528\u5b83\u7684\u4f34\u751f\u5bf9\u8c61\u6765\u521b\u5efa\uff1a Text Only<pre><code>val set1 = Set(1, 1, 2, 2, 3, 3)\nprintln(set1) //Set(1, 2, 3)\uff0c\u53bb\u91cd\u4e4b\u540e\u7684\u7ed3\u679c\n</code></pre> \u6dfb\u52a0\u5143\u7d20\uff1a Text Only<pre><code>val set2 = set1 + 4\nprintln(set2)\u00a0 //Set(1, 2, 3, 4)\n</code></pre> \u5220\u9664\u5143\u7d20\uff1a Text Only<pre><code>val set4 = set3 - 4\n</code></pre> \u5408\u5e76set Text Only<pre><code>val set3 = set1 ++ set2\n</code></pre></p> <p>\u53ef\u53d8Set \u6ce8\u610f\u53ef\u53d8\u7684Set\u5728import scala.collection.mutable.Set\u5305\u4e0b \u5b9a\u4e49Set\uff1a Text Only<pre><code>val set1 = mutable.Set(1, 1, 2, 2, 3, 3)\n</code></pre> \u6dfb\u52a0\u5143\u7d20\u7528+=\u5c31\u4f1a\u5728\u539f\u6709\u7684Set\u4e0a\u8fdb\u884c\u6dfb\u52a0\uff0c\u4f7f\u7528+\u7684\u6548\u679c\u8fd4\u56de\u7684\u662f\u65b0\u7684Set\u5bf9\u8c61\uff1a Text Only<pre><code>set1 += 4\nprintln(set1)\u00a0 //Set(1, 2, 3, 4)\n</code></pre> \u63a8\u8350\u4f7f\u7528\u82f1\u6587\u540d\u7684\u65b9\u6cd5\uff0cadd\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662fBoolean\uff0c\u8868\u793a\u662f\u5426\u6dfb\u52a0\u6210\u529f\uff0c\u5982\u679cset\u96c6\u5408\u4e2d\u5df2\u7ecf\u6709\u8be5\u5143\u7d20\u4e86\u3002\u8fd4\u56defalse\uff0c\u5373\u672a\u6dfb\u52a0\u6210\u529f\uff0c\u53cd\u4e4b\u4e3atrue\uff1a Text Only<pre><code>set1.add(5)\u00a0 //Set(1, 5, 2, 3, 4)\n</code></pre></p> <p>\u5220\u9664\u5143\u7d20\uff1a Text Only<pre><code>set1 -= 4\nset1.remove(5)\n</code></pre></p> <p>\u5408\u5e76Set\u8c03\u7528++=\u65b9\u6cd5 Text Only<pre><code>val set1 = Set(1, 1, 2, 2, 3, 3)\nval set2 = Set(4,5,6)\nset1 ++= set2\nprintln(set1)\n</code></pre></p> <p>Map \u96c6\u5408 Scala\u4e2d\u7684\u4e0d\u53ef\u53d8Map\u548c\u53ef\u53d8Map\u90fd\u53ebMap\uff0c\u53ea\u662f\u5728\u4e0d\u540c\u7684\u5305\u4e0b\uff0c\u9ed8\u8ba4\u662f\u4e0d\u53ef\u53d8\u7684Map\uff0c\u5982\u679c\u60f3\u7528\u53ef\u53d8\u7684Map\uff0c \u9700\u8981\u5f15\u7528scala.collection.mutable.Map \u5305\u3002 \u4e0d\u53ef\u53d8 Map \u56e0\u4e3aMap\u662f\u4e00\u4e2atrait\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u521b\u5efa\u4e0d\u53ef\u53d8Map\u7684\u5b9e\u4f8b\uff0c\u53ea\u80fd\u4f7f\u7528\u4f34\u751f\u5bf9\u8c61\u7684apply\u65b9\u6cd5\u521b\u5efa\uff0c\u6b64\u65f6\u4f20\u5165\u7684\u53c2\u6570\u662f\u591a\u4e2a\u4e8c\u5143\u7ec4\uff0cScala\u4e2dMap\u4e0e\u4e8c\u5143\u7ec4\u7684\u5173\u7cfb \u548c Java\u4e2dMap\u4e0eMap\u7684entrySet\u65b9\u6cd5\u8fd4\u56de\u7684Entry\u7684\u5173\u7cfb\u4e00\u6837\u3002\u4ee5Map\u7684\u89d2\u5ea6\u6765\u770b\u5c31\u662fkv\u952e\u503c\u5bf9\uff0c\u53ea\u80fd\u901a\u8fc7key\u83b7\u53d6value\u3002\u4f46\u662f\u628a\u6bcf\u4e00\u4e2akv\u952e\u503c\u5bf9\u5355\u62ce\u51fa\u6765\u770b\uff0c\u5b83\u4eec\u662f\u4e00\u4e2a\u6574\u4f53\uff0c\u5728Scala\u4e2d\u662f\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u904d\u5386\u6bcf\u4e2akv\u65f6\u5b83\u7684\u7c7b\u578b\u5c31\u662f\u4e8c\u5143\u7ec4\uff0c\u5728Java\u4e2d\u5c31\u662f\u4e00\u4e2aMap.Entry\uff08HashMap\u5e95\u5c42\u7684Node\u8282\u70b9\u5176\u5b9e\u5c31\u662fMap.Entry\u7684\u5b50\u7c7b\uff09\u3002 Text Only<pre><code>val map = Map( \"a\"-&gt;1, \"b\"-&gt;2, \"c\"-&gt;3 )\n</code></pre> \u904d\u5386Map\uff1a Text Only<pre><code>map.foreach((kv: (String, Int)) =&gt; println(kv))\u00a0 //(String, Int)\u662f\u4e00\u4e2a\u4e8c\u5143\u7ec4\u7c7b\u578b\n\u7b80\u5199\u5f62\u5f0f\uff1a\nmap.foreach(println)\n</code></pre> \u901a\u8fc7key\u904d\u5386map\uff1a Text Only<pre><code>for (key &lt;- map.keys) {\nprintln(s\"${key}=${map.get(key)}\")\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>a=Some(1)\nb=Some(2)\nc=Some(3)\n</code></pre> \u4e3a\u4e86\u907f\u514d\u7a7a\u6307\u9488\u5f02\u5e38\uff0cScala\u5b9a\u4e49\u4e86\u4e00\u4e2a\u62bd\u8c61\u7c7bOption\uff0cSome\u548cNone\u662f\u5b83\u7684\u4e24\u4e2a\u5177\u4f53\u7684\u5b50\u7c7b\uff0cmap\u7684get\u65b9\u6cd5\u5982\u679c\u80fdget\u5230\u503c\u5c31\u5305\u88c5\u5230Some\u5bf9\u8c61\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u503c\u5c31\u4f1a\u5305\u88c5\u5230None\u5bf9\u8c61\u4e2d\u3002\uff08\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\uff0c\u907f\u514d\u7a7a\u6307\u9488\u5f02\u5e38\uff1f\uff1f\uff09</p> <p>\u83b7\u53d6\u67d0\u4e2akey\u7684value\uff1a \u56e0\u4e3aMap\u7684get\u65b9\u6cd5\u4f1a\u628a\u8fd4\u56de\u7684\u503c\u5305\u88c5\u5230Some\u4e2d\uff0c\u6240\u4ee5\u8981\u60f3\u771f\u6b63\u7684\u62ff\u5230\u503c\uff0c\u8fd8\u5f97\u518d\u8c03\u7528Some\u7684get\u65b9\u6cd5\uff1a Text Only<pre><code>val value = map.get(\"a\").get\u00a0 //\u8fd4\u56de1\nval value1 = map.get(\"d\") //\u8fd4\u56deNone\nmap.get(\"d\").get //\u7a7a\u6307\u9488\u5f02\u5e38\nval value2 = map.getOrElse(\"d\", 100) //\u5982\u679c\u83b7\u53d6\u4e0d\u5230\"d\"\u7684value\uff0c\u5c31\u7528100\u4ee3\u66ff\uff0c\u5982\u679c\u80fd\u83b7\u53d6\u5230\u5c31\u76f4\u63a5\u8fd4\u56de\u5176value\uff0c\u4e0d\u5728\u8fd4\u56deSome\u5bf9\u8c61\n</code></pre> \u4e3a\u4e86\u80fd\u65b9\u4fbf\u83b7\u53d6\u5230\u503c\uff0cMap\u63d0\u4f9b\u4e86\u53ef\u4ee5\u7701\u7565\u65b9\u6cd5\u540d\u7684apply\u65b9\u6cd5\uff0c\u4e0d\u80fd\u83b7\u53d6\u5230\u503c\u65f6\u5c31\u629b\u51faNoSuchElementException\u5f02\u5e38 Text Only<pre><code>val value = map(\"a\")\n</code></pre></p> <p>\u4e0d\u53ef\u53d8\u7684Map\u4e0d\u80fd\u65b0\u589e\u52a0\u5143\u7d20\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539\u5df2\u6709\u5143\u7d20\u7684value\uff0c\u6240\u4ee5\u8fd8\u662f\u5f97\u7528\u53ef\u53d8\u7684Map</p> <p>\u53ef\u53d8\u7684Map \u6ce8\u610f\u53ef\u53d8\u7684Map\u5728import scala.collection.mutable.Map\u5305\u4e0b \u521b\u5efaMap\uff1a Text Only<pre><code>val map = mutable.Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3)\n</code></pre> \u6dfb\u52a0\u5143\u7d20\uff0cput\u5176\u5b9e\u8c03\u7528\u7684\u662fupdate\u65b9\u6cd5\uff0cupdate\u65b9\u6cd5\u5176\u5b9e\u8c03\u7528\u7684\u662f +=\u65b9\u6cd5\uff0c\u53ea\u6709put\u65b9\u6cd5\u6709\u8fd4\u56de\u503c\uff0c\u5176\u8fd4\u56de\u503c\u662f\u5305\u88c5\u5728Some\u4e2d\u7684\u65e7\u5143\u7d20\u7684\u503c\uff0c\u6ca1\u6709\u65e7\u5143\u7d20\u5219\u662fNone\u3002 Text Only<pre><code>map.put(\"d\", 4)\n\u6216\u8005\nmap += ((\"e\", 5))\n</code></pre> \u5220\u9664\u5143\u7d20\uff1a Text Only<pre><code>map.remove(\"d\")\n\u6216\u8005\nmap -= \"e\"\n</code></pre></p> <p>\u4fee\u6539\u5143\u7d20\uff0c\u5982\u679c\u6dfb\u52a0\u7684key\u4e0d\u5b58\u5728\uff0c\u5c31\u53d8\u6210\u6dfb\u52a0\u5143\u7d20\u4e86 Text Only<pre><code>map.update(\"a\",10)\n\u6216\u8005\nmap(\"a\") = 10 //\u8fd9\u5b9e\u9645\u4e0a\u662fupdate\u65b9\u6cd5\u540d\u7701\u7565\u4e4b\u540e\u7684\u7b80\u5199\u6548\u679c\uff0c\u4e0d\u53ef\u53d8\u7684Map\u6ca1\u6709update\u65b9\u6cd5\n</code></pre></p> <p>\u5408\u5e76\u4e24\u4e2aMap\uff0c\u5c06\u4e0d\u53ef\u53d8\u7684map2\u6dfb\u52a0\u5230\u53ef\u53d8\u7684map1\u4e2d\uff0ckey\u76f8\u540c\u5c31\u8986\u76d6 Text Only<pre><code>val map1 = mutable.Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3)\nval map2 = Map(\"a\" -&gt; 11, \"b\" -&gt; 22, \"c\" -&gt; 33, \"d\" -&gt; 44)\nmap1 ++= map2\nprintln(map1) //\u8f93\u51fa\u7ed3\u679c\uff1aMap(b -&gt; 22, d -&gt; 44, a -&gt; 11, c -&gt; 33)\n</code></pre> \u4e5f\u53ef\u4ee5\u4f7f\u7528++\u65b9\u6cd5\u751f\u6210\u4e00\u4e2a\u65b0\u7684Map Text Only<pre><code>val map3 = map1 ++ map2\n</code></pre></p> <p>\u5143\u7ec4 \u5143\u7ec4\u4e5f\u662f\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u5bb9\u5668\uff0c\u53ef\u4ee5\u5b58\u653e\u5404\u79cd\u76f8\u540c\u6216\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002\u8bf4\u7684\u7b80\u5355\u70b9\uff0c\u5c31\u662f\u5c06\u591a\u4e2a\u65e0\u5173\u7684\u6570\u636e\u5c01\u88c5\u4e3a\u4e00\u4e2a\u6574\u4f53\uff0c\u79f0\u4e3a\u5143\u7ec4\u3002 \u6ce8\u610f\uff1a \u5143\u7ec4\u4e2d\u6700\u5927\u53ea\u80fd\u6709 22 \u4e2a\u5143\u7d20 \u58f0\u660e\u5b9a\u4e49\u4e00\u4e2a\u5143\u7ec4\uff0c\u5143\u7ec4\u7684\u7c7b\u578b\u5c31\u662f\u5b83\u6240\u5b58\u653e\u7684\u6570\u636e\u7684\u7c7b\u578b\u5408\u8d77\u6765\uff1a Text Only<pre><code>val tuple: (Int, Double, String, Boolean) = (1, 2.5, \"abc\", true)\n</code></pre> \u5b9a\u4e49\u4e00\u4e2a\u4e8c\u5143\u7ec4\u8fd8\u53ef\u4ee5\u8fd9\u6837\uff1a Text Only<pre><code>val tuple2: (String, Int) = \"a\" -&gt; 100\n</code></pre> \u5143\u7ec4\u5b9a\u4e49\u4e4b\u540e\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u4e0d\u80fd\u6dfb\u52a0\u5143\u7d20\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539\u5143\u7d20\uff0c\u53ea\u80fd\u8bbf\u95ee\u503c\u3002 \u8bbf\u95ee\u5143\u7ec4\uff1a Text Only<pre><code>println(tuple._1)\nprintln(tuple._2)\nprintln(tuple._3)\nprintln(tuple._4) \u00a0\n</code></pre> \u901a\u8fc7\u7d22\u5f15\u8bbf\u95ee\uff1a Text Only<pre><code>val value = tuple.productElement(1)\u00a0 //2.5\n</code></pre> \u901a\u8fc7\u8fed\u4ee3\u5668\u904d\u5386\u5143\u7ec4\uff1a Text Only<pre><code>for (elem &lt;- tuple.productIterator) {\n\u00a0\u00a0 \u00a0println(elem)\n}\n</code></pre> \u5b9a\u4e49\u5d4c\u5957\u5143\u7ec4\uff1a Text Only<pre><code>val tuple3: (Int, Double, (String, Boolean)) = (1, 1.1, (\"a\", false))\nprint(tuple3._3._2)\u00a0 //\u8f93\u51fafalse\n</code></pre></p> <p>\u96c6\u5408\u5e38\u7528\u51fd\u6570</p> <p>\u57fa\u672c\u5c5e\u6027\u548c\u5e38\u7528\u64cd\u4f5c Text Only<pre><code>val list = List(1, 3, 5, 7, 2, 89)\nval set = Set(23, 34, 423, 75)\n</code></pre> 1.\u83b7\u53d6\u96c6\u5408\u957f\u5ea6\uff0clength\u662fLinearSeq\u624d\u6709\u4e00\u4e2a\u5c5e\u6027 Text Only<pre><code>val length = list.length\n</code></pre> \u83b7\u53d6\u96c6\u5408\u5927\u5c0f\uff0csize\u662f\u6240\u6709\u96c6\u5408\u7c7b\u578b\u90fd\u6709\u4e00\u4e2a\u5c5e\u6027 Text Only<pre><code>println(set.size)\n</code></pre> 2.\u904d\u5386\u96c6\u5408 \u589e\u5f3afor\u5faa\u73af\u904d\u5386\uff1a Text Only<pre><code>for (elem &lt;- list)\n\u00a0println(elem)\n</code></pre> \u5176\u5b9e\u589e\u5f3afor\u5faa\u73af\u7f16\u8bd1\u4e4b\u540e\u5c31\u662f\u4f7f\u7528\u7684\u8fed\u4ee3\u5668\uff0c\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u76f4\u63a5\u628a\u8fed\u4ee3\u5668\u58f0\u660e\u51fa\u6765\uff1a Text Only<pre><code>for (elem &lt;- list.iterator)\n\u00a0println(elem)\n</code></pre> 3.\u751f\u6210\u5b57\u7b26\u4e32 Text Only<pre><code>println(list.mkString(\"--\"))\nprintln(set.mkString(\"--\"))\n</code></pre> 4.\u662f\u5426\u5305\u542b\u67d0\u4e2a\u5143\u7d20 Text Only<pre><code>println(list.contains(23))\nprintln(set.contains(23))\n</code></pre></p> <p>\u884d\u751f\u96c6\u5408\uff0c\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u4e4b\u540e\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u96c6\u5408\u4f5c\u4e3a\u7ed3\u679c Text Only<pre><code>val list = List(1, 3, 5, 7, 2, 89)\nval set = Set(23, 34, 423, 75)\n</code></pre> 1.\u83b7\u53d6\u96c6\u5408\u7684\u5934 Text Only<pre><code>println(list.head) //1\n</code></pre> 2.\u83b7\u53d6\u96c6\u5408\u7684\u5c3e\uff0c\u9664\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e4b\u5916\u7684\u5143\u7d20\u90fd\u662f\u96c6\u5408\u7684\u5c3e Text Only<pre><code>println(list.tail)\u00a0 //List(3, 5, 7, 2, 89)\n</code></pre> 3.\u96c6\u5408\u6700\u540e\u4e00\u4e2a\u6570\u636e Text Only<pre><code>println(list.last)\u00a0 //89\n</code></pre> 4.\u96c6\u5408\u521d\u59cb\u6570\u636e\uff0c\u9664\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e4b\u5916\u7684\u5143\u7d20\u90fd\u662f\u96c6\u5408\u7684\u521d\u59cb\u6570\u636e Text Only<pre><code>println(list.init) //List(1, 3, 5, 7, 2)\n</code></pre> 5.\u53cd\u8f6c Text Only<pre><code>println(list.reverse)\u00a0 //List(89, 2, 7, 5, 3, 1)\n</code></pre> 6.\u53d6\u524dn\u4e2a\u5143\u7d20 Text Only<pre><code>println(list.take(3))\u00a0 //List(1, 3, 5)\n</code></pre> \u53d6\u540en\u4e2a\u5143\u7d20 Text Only<pre><code>println(list.takeRight(3))\u00a0 \u00a0//List(7, 2, 89)\n</code></pre> 7.\u53bb\u6389\u524dn\u4e2a\u5143\u7d20 Text Only<pre><code>println(list.drop(2))\u00a0 //List(5, 7, 2, 89)\n</code></pre> \u53bb\u6389\u540en\u4e2a\u5143\u7d20 Text Only<pre><code>println(list.dropRight(2))\u00a0 //List(1, 3, 5, 7)\n</code></pre> 8.\u5e76\u96c6 Text Only<pre><code>val list1 = List(1, 2, 3)\nval list2 = List(2, 3, 4)\n//\u7b49\u4ef7\u4e8e\u7528 :::\nval union: List[Int] = list1.union(list2)\nprintln(union)\u00a0 //List(1, 2, 3, 2, 3, 4)\n</code></pre> \u5982\u679c\u662fSet\u505a\u5e76\u96c6\u4f1a\u53bb\u91cd Text Only<pre><code>val set1 = Set(1, 2, 3)\nval set2 = Set(2, 3, 4)\nval set3: Set[Int] = set1.union(set2)\nprintln(set3)\u00a0 //Set(1, 2, 3, 4)\n</code></pre> 9.\u4ea4\u96c6 Text Only<pre><code>val list1 = List(1, 2, 3)\nval list2 = List(2, 3, 4)\nval intersection = list1.intersect(list2)\nprintln(intersection) //List(2, 3)\n</code></pre> 10.\u5dee\u96c6 Text Only<pre><code>val list1 = List(1, 2, 3)\nval list2 = List(2, 3, 4)\nprintln(list1.diff(list2))\u00a0 //List(1)\nprintln(list2.diff(list1))\u00a0 //List(4)\n</code></pre> 11.\u62c9\u94fe\uff0c\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u5143\u7ec4\u7684\u96c6\u5408 Text Only<pre><code>val list1 = List(1, 2, 3)\nval list2 = List(2, 3, 4)\nprintln(list1.zip(list2))\u00a0 //List((1,2), (2,3), (3,4))\nprintln(list2.zip(list1))\u00a0 //List((2,1), (3,2), (4,3))\n</code></pre> 12.\u6ed1\u7a97\uff0c\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u96c6\u5408\u7684\u96c6\u5408 Text Only<pre><code>val list = List(1, 2, 3, 4, 5, 6, 7, 8, 9)\nfor (elem &lt;- list.sliding(3)) println(elem)\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>List(1, 2, 3)\nList(2, 3, 4)\nList(3, 4, 5)\nList(4, 5, 6)\nList(5, 6, 7)\nList(6, 7, 8)\nList(7, 8, 9)\n</code></pre> 3\u4e2a\u6b65\u957f\u7684\u6ed1\u7a97\uff1a Text Only<pre><code>val list = List(1, 2, 3, 4, 5, 6, 7, 8, 9)\nfor (elem &lt;- list.sliding(3, 3)) println(elem)\n</code></pre> \u8f93\u51fa\u7684\u7ed3\u679c\uff1a Text Only<pre><code>List(1, 2, 3)\nList(4, 5, 6)\nList(7, 8, 9)\n</code></pre></p> <p>\u96c6\u5408\u7b80\u5355\u8ba1\u7b97\u51fd\u6570 Text Only<pre><code>val list1 = List(1, 5, 2, 3, 6, 4)\nval list2 = List((\"a\", 5), (\"b\", 1), (\"c\", 8), (\"d\", 2), (\"e\", -3), (\"f\", 4))\n</code></pre> 1.\u6c42\u548c Text Only<pre><code>println(list1.sum)\u00a0 //21\n</code></pre> 2.\u6c42\u4e58\u79ef Text Only<pre><code>println(list1.product) //720\n</code></pre> 3.\u6700\u5927\u503c Text Only<pre><code>println(list1.max) //6\n</code></pre> \u5982\u679c\u662f\u6bd4\u8f83\u590d\u6742\u7684\u7c7b\u578b\uff0c\u8fd8\u53ef\u4ee5\u6307\u5b9a\u6bd4\u8f83\u7684\u5143\u7d20 Text Only<pre><code>println(list2.maxBy((tuple: (String, Int)) =&gt; tuple._2))\u00a0 //(c,8)\n</code></pre> \u7b80\u5316\u5f62\u5f0f\uff1a Text Only<pre><code>println(list2.maxBy(_._2))\u00a0 //(c,8)\n</code></pre> 4.\u6700\u5c0f\u503c Text Only<pre><code>println(list1.min) //1\n</code></pre> \u540c\u6837\u53ef\u4ee5\u6307\u5b9a\u8981\u6bd4\u8f83\u7684\u5143\u7d20 Text Only<pre><code>println(list2.minBy(_._2))\u00a0 //(e,-3)\n</code></pre> 5.\u6392\u5e8f List\u662f\u4e0d\u53ef\u53d8\u7684\u96c6\u5408\uff0c\u6240\u4ee5sorted\u51fd\u6570\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u6392\u597d\u4e86\u5e8f\u7684List\uff0c\u9ed8\u8ba4\u662f\u5347\u5e8f Text Only<pre><code>val sortedList = list.sorted\nprintln(sortedList) //List(1, 2, 3, 4, 5, 6)\n</code></pre> \u90a3\u4e48\u5bf9\u6570\u636e\u7684\u6bd4\u8f83\u89c4\u5219\u662f\u5148\u6bd4\u8f83\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u7b2c\u4e00\u4e2a\u5143\u7d20\u76f8\u540c\u5219\u6bd4\u8f83\u7b2c\u4e8c\u4e2a\u5143\u7ec4\uff1a Text Only<pre><code>val list = List((\"b\", 1), (\"a\", 5), (\"a\", 4), (\"a\", 6), (\"c\", 8))\nprintln(list.sorted)\u00a0 //List((a,4), (a,5), (a,6), (b,1), (c,8))\n</code></pre> \u53ef\u4ee5\u6307\u5b9a\u9006\u5e8f\u6392 Text Only<pre><code>println(list.sorted(Ordering[Int].reverse))\u00a0 //List(6, 5, 4, 3, 2, 1)\n</code></pre> \u5982\u679c\u662f\u6bd4\u8f83\u590d\u6742\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u6307\u5b9a\u6bd4\u8f83\u7684\u5143\u7d20\uff0c\u9ed8\u8ba4\u662f\u5347\u5e8f Text Only<pre><code>println(list2.sortBy(_._2))\u00a0 //List((e,-3), (b,1), (d,2), (f,4), (a,5), (c,8))\n</code></pre> \u53ef\u4ee5\u6307\u5b9a\u4e3a\u964d\u5e8f\u6392 Text Only<pre><code>println(list2.sortBy(_._2)(Ordering[Int].reverse))\n</code></pre> \u8fd8\u53ef\u4ee5\u4f7f\u7528sortWith\u65b9\u6cd5\u6307\u5b9a\u5143\u7d20\u7684\u6bd4\u8f83\u89c4\u5219\uff1a Text Only<pre><code>println(list2.sortWith( (a:(String, Int) , b: (String, Int)) =&gt; {a._2 &lt; b._2} ))\n</code></pre> \u7b80\u5316\u5f62\u5f0f\uff1a Text Only<pre><code>println(list2.sortWith(_._2 &lt; _._2))\n</code></pre></p> <p>\u96c6\u5408\u9ad8\u7ea7\u8ba1\u7b97\u51fd\u6570 1. \u8fc7\u6ee4 filter\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u51fd\u6570\uff0c\u51fd\u6570\u7684\u53c2\u6570\u662f\u96c6\u5408\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u662fBoolean\u7c7b\u578b\uff0c\u5373true\u8868\u793a\u4fdd\u7559\u5f53\u524d\u5143\u7d20\uff0c\u5426\u5219\u820d\u5f03\u5f53\u524d\u5143\u7d20 \u6bd4\u5982\u9009\u53d6\u5076\u6570\uff1a Text Only<pre><code>val list = List(1, 2, 3, 4, 5, 6, 7, 8, 9)\nval evenList = list.filter((elem: Int) =&gt; elem % 2 == 0)\nprintln(evenList)\u00a0 //List(2, 4, 6, 8)\n</code></pre> \u7b80\u5316\u5f62\u5f0f\uff1a Text Only<pre><code>val evenList = list.filter(_ % 2 == 0)\n</code></pre></p> <p>2. \u8f6c\u5316/\u6620\u5c04\uff08map\uff09 map\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u51fd\u6570\uff0c\u51fd\u6570\u7684\u53c2\u6570\u662f\u96c6\u5408\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u662f\u7ecf\u8fc7\u51fd\u6570\u5904\u7406\u4e4b\u540e\u7684\u503c \u6bd4\u5982\u628a\u96c6\u5408\u4e2d\u6bcf\u4e2a\u6570\u4e582\uff1a Text Only<pre><code>val list = List(1, 2, 3, 4, 5, 6, 7, 8, 9)\nval doubleList = list.map(_ * 2)\nprintln(doubleList)\u00a0 //List(2, 4, 6, 8, 10, 12, 14, 16, 18)\n</code></pre></p> <p>\u5bf9\u4e8eMap\u7c7b\u578b\u7684\u96c6\u5408\u505amap\u6620\u5c04\u65f6\uff0c\u540c\u6837\u904d\u5386\u7684\u662fMap\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u4e2a\u5143\u7d20\u7684\u7c7b\u578b\u662f\u4e8c\u5143\u7ec4 \u5c06\u6bcf\u4e2akey\u5bf9\u5e94\u7684value\u4e58\u4ee52\uff0cmap\u6620\u5c04\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7684\u53c2\u6570kv\u7684\u7c7b\u578b\u662f\u5143\u7ec4 Text Only<pre><code>val map = Map(\"Hello\" -&gt; 4, \"Hbase\" -&gt; 2, \"kafka\" -&gt; 1, \"Scala\" -&gt; 3)\nval map1 = map.map(kv =&gt; (kv._1, kv._2 * 2))\nprintln(map1)\n</code></pre> \u4ee5\u4e0a\u9700\u6c42\u5176\u5b9e\u53ea\u662f\u5bf9Map\u7684value\u8fdb\u884c\u64cd\u4f5c\uff0c\u5982\u679c\u53ea\u9700\u8981\u5bf9Map\u7684value\u8fdb\u884c\u6620\u5c04\uff0c\u53ef\u4ee5\u4f7f\u7528mapValues\u51fd\u6570 Text Only<pre><code>val map1 = map.mapValues(_ * 2)\n</code></pre></p> <p>3. \u6241\u5e73\u5316 \u5c06\u96c6\u5408\u91cc\u9762\u7684\u96c6\u5408\u90fd\u5c55\u5f00\u653e\u5230\u4e00\u4e2a\u96c6\u5408\u91cc\u9762 Text Only<pre><code>val nestedList: List[List[Int]] = List(List(1,2,3),List(4,5),List(6,7,8,9))\nval flatList = nestedList.flatten\nprintln(flatList) //List(1, 2, 3, 4, 5, 6, 7, 8, 9)\n</code></pre></p> <p>4. \u6241\u5e73\u6620\u5c04 \u6241\u5e73\u6620\u5c04\u662f\u5148\u505a\u6620\u5c04\u518d\u505a\u6241\u5e73\uff0c\u6bd4\u5982\u5c06\u4e00\u7ec4\u5b57\u7b26\u4e32\u5206\u8bcd\u7136\u540e\u4fdd\u5b58\u6210\u5355\u8bcd\u7684\u5217\u8868\uff0c\u4f7f\u7528\u4e0a\u9762\u4e24\u4e2amap\u51fd\u6570\u548cflatten\u51fd\u6570\u9700\u8981\u8fd9\u6837\u505a\uff1a Text Only<pre><code>val strings: List[String] = List(\"hello world\", \"hello scala\", \"hello java\", \"we study\")\nval splitList: List[Array[String]] = strings.map( _.split(\" \") ) \u00a0 \u00a0// \u5206\u8bcd\nval flattenList = splitList.flatten \u00a0 \u00a0// \u6253\u6563\u6241\u5e73\u5316\nprintln(flattenList)\u00a0 //List(hello, world, hello, scala, hello, java, we, study)\n</code></pre> \u4e0d\u8fc7\u96c6\u5408\u63d0\u4f9b\u4e86flatMap\u51fd\u6570\uff0c\u5c06\u4e0a\u8ff0\u4e24\u4e2a\u6b65\u9aa4\u5408\u4e8c\u4e3a\u4e00 Text Only<pre><code>val flatmapList = strings.flatMap(_.split(\" \"))\n</code></pre></p> <p>5. \u5206\u7ec4(group) \u5206\u7ec4\u5c31\u662f\u628a\u96c6\u5408\u4e2d\u5177\u6709\u76f8\u540c\u7279\u5f81\u7684\u5143\u7d20\u653e\u5728\u4e00\u4e2a\u7ec4\u91cc\uff0c\u8fd9\u4e2a\u7ec4\u5176\u5b9e\u662fMap\u7684value\uff0c\u662f\u4e00\u4e2aList\u96c6\u5408 \u6bd4\u5982\u7ed9\u5b9a\u4e00\u7ec4\u8bcd\u6c47\uff0c\u6309\u7167\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\u8fdb\u884c\u5206\u7ec4 Text Only<pre><code>val wordList = List(\"china\", \"america\", \"alice\", \"canada\", \"cary\", \"bob\", \"japan\")\nprintln( wordList.groupBy( _.charAt(0) ) )\n</code></pre> \u8f93\u51fa\u5c31\u662f\u4e00\u4e2aMap\uff0cgroupBy\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533f\u540d\u51fd\u6570\uff0c\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u662f\u96c6\u5408\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u5c31\u662f\u8fd9\u4e2a\u5143\u7d20\u6240\u5bf9\u5e94\u7684\u5206\u7ec4\u7684key\uff0c\u5177\u6709\u76f8\u540c\u7684key\u7684\u5143\u7d20\u4f1a\u8fdb\u5230\u540c\u4e00\u4e2avalue\u4e2d\uff0cvalue\u662f\u4e00\u4e2a\u96c6\u5408\u3002 Text Only<pre><code>Map(b -&gt; List(bob), j -&gt; List(japan), a -&gt; List(america, alice), c -&gt; List(china, canada, cary))\n</code></pre></p> <p>\u4ee5\u4e0a5\u4e2a\u64cd\u4f5c\u8f93\u5165\u7684\u662f\u96c6\u5408\uff0c\u8f93\u51fa\u7684\u4e5f\u662f\u96c6\u5408\uff0c\u6240\u4ee5\u90fd\u53ef\u4ee5\u770b\u4f5c\u662fmap\u64cd\u4f5c\u3002\u5982\u679c\u8f93\u5165\u7684\u662f\u96c6\u5408\uff0c\u8f93\u51fa\u7684\u662f\u4e00\u4e2a\u6570\uff0c\u90a3\u5c31\u662fReduce\u64cd\u4f5c\u4e86\uff0c\u4ee5\u4e0b\u4e24\u4e2a\u64cd\u4f5c\u5c31\u662fReduce\u64cd\u4f5c\u3002</p> <p>6. \u7b80\u5316\uff08\u5f52\u7ea6\uff09 reduce\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u51fd\u6570\u9700\u8981\u4f20\u5165\u4e24\u4e2a\u5143\u7d20\u7136\u540e\u8fd4\u56de\u4e00\u4e2a\u503c\u3002reduce\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff0c\u5148\u4f20\u5165\u96c6\u5408\u7684\u524d\u4e24\u4e2a\u5143\u7d20\uff0c\u7136\u540e\u7b97\u5f97\u4e00\u4e2a\u7ed3\u679c\uff0c\u518d\u628a\u8fd9\u4e2a\u7ed3\u679c\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u5143\u7d20\u4f20\u5165\uff0c\u4e00\u76f4\u5faa\u73af\u76f4\u5230\u5f97\u5230\u6700\u540e\u7684\u7ed3\u679c\u3002 reduce\u8c03\u7528\u7684\u662freduceLeft\uff0c\u6240\u4ee5\u4e8c\u8005\u8ba1\u7b97\u7684\u8fc7\u7a0b\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u6ce8\u610freduceRight\u5e76\u4e0d\u662f\u628areduceLeft\u7684\u8ba1\u7b97\u8fc7\u7a0b\u8fd4\u8fc7\u6765 Text Only<pre><code>val list2 = List(3, 4, 5, 8, 10)\nprintln(list2.reduce(_ - _)) // (((3 - 4) - 5) - 8) - 10 = -24\nprintln(list2.reduceLeft(_ - _)) // (((3 - 4) - 5) - 8) - 10 = -24\nprintln(list2.reduceRight(_ - _)) //3 - (4 - (5 - (8 - 10))) = 6\n</code></pre> reduce\u4e0ereduceLeft\u7684\u533a\u522b\u662f\uff0creduce\u7684\u4e24\u4e2a\u53c2\u6570\u7c7b\u578b\u5fc5\u987b\u662f\u76f8\u540c\u7684\uff0c\u800creduceLeft\u7684\u4e24\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u540c\u3002</p> <p>7. \u6298\u53e0 fold\u65b9\u6cd5\u4e8ereduce\u65b9\u6cd5\u7684\u8ba1\u7b97\u8fc7\u7a0b\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u662f\u591a\u4e86\u4e00\u4e2a\u521d\u59cb\u503c Text Only<pre><code>val list = List(1, 2, 3, 4)\nprintln(list.fold(10)(_ + _)) // (((10 + 1) + 2) + 3) + 4 = 20\nprintln(list.foldLeft(10)(_ - _)) // (((10 - 1) - 2) - 3) - 4 = 0\nprintln(list.foldRight(10)(_ - _)) // 1 - (2 - (3 - (4 - 10))) = 8\n</code></pre></p> <p>\u96c6\u5408\u8ba1\u7b97\u51fd\u6570\u6848\u4f8b\uff1a 1.\u5408\u5e76\u4e24\u4e2aMap\uff0c\u5bf9\u4e8e\u76f8\u540ckey\u7684\u6570\u636e\u5e76\u4e0d\u662f\u7b80\u5355\u7684\u8986\u76d6\uff0c\u800c\u662f\u76f8\u52a0 \u2460 map1\u53ef\u4ee5\u662f\u4e0d\u53d8\u7684map\uff0c\u56e0\u4e3a\u662f\u4ee5map1\u6765\u8c03\u7528foldLeft\u65b9\u6cd5\uff0cfoldLeft\u65b9\u6cd5\u662f\u4ee5\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5373map2\u4e3a\u521d\u59cb\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e00\u4e2amap1\u7684\u5143\u7d20\uff0c\u5bf9\u6bcf\u4e00\u4e2amap1\u7684\u5143\u7d20\u90fd\u4f1a\u5c06 map2 \u548c \u8be5\u5143\u7d20 \u4f20\u5165foldLeft\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5373\u533f\u540d\u51fd\u6570\u4e2d\u8fdb\u884c\u5904\u7406\uff0c\u533f\u540d\u51fd\u6570\u8fd4\u56de\u5904\u7406\u4e4b\u540e\u7684\u7ed3\u679c\uff08\u4e5f\u5c31\u662f\u5904\u7406\u4e4b\u540emap2\uff09\uff0c\u518d\u5c06\u8be5\u7ed3\u679c\u4e0emap1\u7684\u4e0b\u4e00\u4e2a\u5143\u7d20\u4f20\u5165\u533f\u540d\u51fd\u6570\uff0c\u4e00\u76f4\u5faa\u73af\u76f4\u5230\u904d\u5386\u5b8cmap1\u7684\u6240\u6709\u5143\u7d20\u3002 \u2461 \u4e0d\u80fd\u7528fold\u65b9\u6cd5\uff0c\u56e0\u4e3afold\u65b9\u6cd5\u7684\u4e24\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u5fc5\u987b\u76f8\u540c\uff0cfoldLeft\u65b9\u6cd5\u7684\u4e24\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u540c Text Only<pre><code>val map1 = Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3)\nval map2 = mutable.Map(\"a\" -&gt; 4, \"b\" -&gt; 5, \"d\" -&gt; 6, \"e\" -&gt; 8)\nmap1.foldLeft(map2)((map2, kv) =&gt; {\n\u00a0map2(kv._1) = map2.getOrElse(kv._1, 0) + kv._2\n\u00a0map2\n})\nprintln(map2)\n</code></pre> \u6216\u8005\uff1a Text Only<pre><code>map1.foreach{\n\u00a0\u00a0case (key, value) =&gt;\n\u00a0\u00a0\u00a0\u00a0map2(key) = map2.getOrElse(key, 0) + value\n}\n</code></pre> \u90fd\u662f\u904d\u5386map1\u66f4\u65b0map2</p> <p>2. \u666e\u901a WordCount\uff0c \u5c06\u96c6\u5408\u4e2d\u51fa\u73b0\u7684\u76f8\u540c\u7684\u5355\u8bcd\uff0c\u8fdb\u884c\u8ba1\u6570\uff0c\u53d6\u8ba1\u6570\u6392\u540d\u524d\u4e09\u7684\u7ed3\u679c Text Only<pre><code>val stringList = List(\"Hello Scala Hbase kafka\", \"Hello Scala Hbase\", \"Hello Scala\", \"Hello\")\nval top3 = stringList.flatMap(_.split(\" \")) //\u5148\u5207\u5206\u7136\u540e\u6241\u5e73\u5316 List(Hello, Scala, Hbase, kafka, Hello, Scala, Hbase, Hello, Scala, Hello)\n\u00a0.groupBy(word =&gt; word) //\u5206\u7ec4 Map(Hello -&gt; List(Hello, Hello, Hello, Hello), Hbase -&gt; List(Hbase, Hbase), kafka -&gt; List(kafka), Scala -&gt; List(Scala, Scala, Scala))\n.mapValues(_.length) //\u8ba1\u7b97\u6bcf\u4e2a\u5206\u7ec4\u7684\u957f\u5ea6 Map(Hello -&gt; 4, Hbase -&gt; 2, kafka -&gt; 1, Scala -&gt; 3)\n\u00a0.toList //map\u548cset\u90fd\u662f\u65e0\u5e8f\u7684\u96c6\u5408\u4e0d\u80fd\u6392\u5e8f\uff0c\u53ea\u6709\u8f6c\u4e3aList\u624d\u80fd\u6392\u5e8f List((Hello,4), (Hbase,2), (kafka,1), (Scala,3))\n\u00a0.sortWith(_._2 &gt; _._2) //\u6309\u5143\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u503c\u964d\u5e8f\u6392List((Hello,4), (Scala,3), (Hbase,2), (kafka,1))\n\u00a0.take(3) //\u53d6\u524d3 List((Hello,4), (Scala,3), (Hbase,2))\nprintln(top3) //List((Hello,4), (Scala,3), (Hbase,2))\n</code></pre></p> <p>3.\u590d\u6742\u4e00\u70b9\u7684WordCount\uff0c\u5df2\u7ecf\u7ed9\u51fa\u6bcf\u4e2aString\u7684\u51fa\u73b0\u9891\u7387\uff0c\u9700\u6c42\u8fd8\u662f\u5bf9\u5355\u8bcd\u8ba1\u6570\u53d6\u524d\u4e09 Text Only<pre><code>val stringList = List(\n\u00a0(\"Hello Scala Hbase kafka\", 2),\n\u00a0(\"Hello Scala Hbase\", 1),\n\u00a0(\"Hello Scala\", 3),\n\u00a0(\"Hello\", 4)\n)\nval top3 = stringList.flatMap(kv =&gt; kv._1.split(\" \").map(word =&gt; (word, kv._2)))\u00a0 //List((Hello,2), (Scala,2), (Hbase,2), (kafka,2), (Hello,1), (Scala,1), (Hbase,1), (Hello,3), (Scala,3), (Hello,4))\n\u00a0.groupBy(kv =&gt; kv._1)\n\u00a0.mapValues(_.map(_._2).sum)\n\u00a0.toList\n\u00a0.sortWith(_._2 &gt; _._2)\n\u00a0.take(3)\nprintln(top3)\u00a0 //List((Hello,10), (Scala,6), (Hbase,3))\n</code></pre></p> <p>\u961f\u5217 \u53ef\u53d8\u961f\u5217 \u521b\u5efa\u4e00\u4e2a\u53ef\u53d8\u961f\u5217 \u76f4\u63a5\u4f7f\u7528\u53ef\u53d8\u961f\u5217\u7684\u6784\u9020\u5668\u8fdb\u884c\u521b\u5efa\uff1a Text Only<pre><code>val queue1: mutable.Queue[String] = new mutable.Queue[String]()\n</code></pre> \u4f7f\u7528\u53ef\u53d8\u961f\u5217\u7684\u4f34\u751f\u5bf9\u8c61\u6765\u521b\u5efa\uff1a Text Only<pre><code>val queue2 = mutable.Queue(\"a\",\"b\",\"c\")\n</code></pre> \u5165\u961f\uff1a Text Only<pre><code>queue2.enqueue(\"d\")\n</code></pre> \u51fa\u961f\uff1a Text Only<pre><code>val str = queue2.dequeue() \u00a0//a\n</code></pre></p> <p>\u4e0d\u53ef\u53d8\u961f\u5217 \u4e0d\u53ef\u53d8\u961f\u5217\u53ea\u80fd\u4f7f\u7528\u4f34\u751f\u5bf9\u8c61\u6765\u521b\u5efa Text Only<pre><code>val queue3: immutable.Queue[String] = immutable.Queue(\"a\", \"b\", \"c\")\n</code></pre> \u4e0d\u53ef\u53d8\u961f\u5217\u4e00\u65e6\u521b\u5efa\u4e4b\u540e\u5c31\u4e0d\u80fd\u6539\u53d8\uff0c\u6240\u6709\u5165\u961f\u64cd\u4f5c\u90fd\u4f1a\u4ea7\u751f\u65b0\u7684\u961f\u5217\uff1a Text Only<pre><code>val queue4 = queue3.enqueue(\"d\")\nprintln(queue3) //Queue(a, b, c)\nprintln(queue4) //Queue(a, b, c, d)\n</code></pre> \u51fa\u961f\u540c\u6837\u4e0d\u4f1a\u6539\u53d8\u961f\u5217\uff0c\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u961f\u5934\u7684\u5143\u7d20\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u5305\u542b\u5269\u4e0b\u6240\u6709\u5143\u7d20\u7684\u7684\u961f\u5217 Text Only<pre><code>val v1 = queue3.dequeue\nprintln(v1)\u00a0 //(a,Queue(b, c))\nprintln(v1.getClass) //class scala.Tuple2\nprintln(queue3) //Queue(a, b, c)\n</code></pre></p> <p>\u5e76\u884c\u96c6\u5408 Scala \u4e3a\u4e86\u5145\u5206\u4f7f\u7528\u591a\u6838 CPU\uff0c\u63d0\u4f9b\u4e86\u5e76\u884c\u96c6\u5408\uff08\u6709\u522b\u4e8e\u524d\u9762\u7684\u4e32\u884c\u96c6\u5408\uff09\uff0c\u7528\u4e8e\u591a\u6838\u73af\u5883\u7684\u5e76\u884c\u8ba1\u7b97\u3002 \u5728\u539f\u6765\u7684\u96c6\u5408\u540e\u9762\u4f7f\u7528par\u65b9\u6cd5\u5c31\u4f1a\u8fd4\u56de\u8be5\u96c6\u5408\u5e76\u884c\u96c6\u5408\uff0c\u7136\u540e\u4e4b\u540e\u64cd\u4f5c\u4f1a\u88ab\u5206\u6563\u5230\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u64cd\u4f5c\uff0c\u4ece\u4e0b\u9762\u7684\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u6ca1\u4f7f\u7528\u5e76\u884c\u96c6\u5408\u7684\u64cd\u4f5c\u90fd\u662f\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u4e32\u884c\u5b8c\u6210\u7684\uff0c\u4f7f\u7528\u4e86\u5e76\u884c\u96c6\u5408\u7684\u64cd\u4f5c\u88ab\u5206\u6563\u5230\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u5e76\u884c\u5b8c\u6210\u3002 Text Only<pre><code>val result1: immutable.IndexedSeq[Long] = (1 to 100).map(\n\u00a0\u00a0x =&gt; Thread.currentThread.getId\n)\nprintln(result1)\n\nval result2: ParSeq[Long] = (1 to 100).par.map(\n\u00a0\u00a0x =&gt; Thread.currentThread.getId\n)\nprintln(result2)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/8-%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/","title":"8-\u6a21\u5f0f\u5339\u914d","text":"<p> \u7ea6 1088 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 22 \u5206\u949f</p> <p>Scala\u4e2d\u6ca1\u6709switch case\uff0c\u800c\u662fmatch case\uff0cScala\u7684 match case \u63d0\u4f9b\u5f88\u591a\u7684\u529f\u80fd\uff0c\u6545match case \u79f0\u4e3a\u6a21\u5f0f\u5339\u914d\u3002 \u57fa\u672c\u8bed\u6cd5\uff1a Text Only<pre><code>val x: Int = 5\nval y: String = x match {\n\u00a0case 1 =&gt; \"one\"\n\u00a0case 2 =&gt; \"two\"\n\u00a0case 3 =&gt; \"three\"\n\u00a0case _ =&gt; \"other\"\n}\nprintln(y) //other\n</code></pre> \u4f1a\u4ece\u4e0a\u81f3\u4e0b\u5339\u914dcase\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\u5c31\u4f1a\u6267\u884c =&gt; \u540e\u9762\u7684\u4ee3\u7801\uff0c\u6bcf\u4e2acase\u4e0d\u7528\u5199break\u8bed\u53e5\uff0c\u6267\u884c\u5b8c =&gt; \u540e\u9762\u7684\u4ee3\u7801\u5c31\u4f1a\u9000\u51fa\uff0c \u5982\u679c\u6240\u6709 case \u90fd\u4e0d\u5339\u914d\uff0c\u90a3\u4e48\u4f1a\u6267\u884c case _ \u5206\u652f\u3002</p> <p>\u6a21\u5f0f\u5b88\u536b \u5982\u679c\u60f3\u8981\u8868\u8fbe\u5339\u914d\u67d0\u4e2a\u8303\u56f4\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u6a21\u5f0f\u5339\u914d\u4e2d\u589e\u52a0\u6761\u4ef6\u5b88\u536b\u3002 Text Only<pre><code>val x: Int = 80\nval y: String = x match {\n\u00a0case i if i &lt; 60 =&gt; \"\u4e0d\u53ca\u683c\"\n\u00a0case i if i &gt;= 60 &amp;&amp; i &lt; 80 =&gt; \"\u826f\"\n\u00a0case i if i &gt;= 80 =&gt; \"\u4f18\"\n\u00a0case _ =&gt; \"\u975e\u6cd5\"\n}\nprintln(y)\n</code></pre></p> <p>\u5339\u914d\u5e38\u91cf \u5982\u679c\u60f3\u8981\u5728\u6700\u540e\u7684\u9ed8\u8ba4\u5339\u914d\u5206\u652f\u4e2d\u4f7f\u7528\u4f20\u8fdb\u6765\u7684\u8fdb\u884c\u5339\u914d\u7684\u53d8\u91cf\u5c31\u4e0d\u80fd\u4f7f\u7528_\u4e0b\u5212\u7ebf\u4e86\uff0c\u9700\u8981\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u540d\u6765\u63a5\u6536\uff0c\u4ecd\u7136\u8868\u793a\u7684\u9ed8\u8ba4\u5339\u914d\u3002 Text Only<pre><code>def describe(x: Any): Any = x match {\n\u00a0case 5 =&gt; \"Int five\"\n\u00a0case \"hello\" =&gt; \"String hello\"\n\u00a0case true =&gt; \"Boolean true\"\n\u00a0case '+' =&gt; \"Char +\"\n\u00a0case a =&gt; a.getClass + \" \" + a\n}\nprintln(describe(List(1, 2)))\u00a0 //class scala.collection.immutable.$colon$colon List(1, 2\n</code></pre></p> <p>\u5339\u914d\u7c7b\u578b \u9700\u8981\u8fdb\u884c\u7c7b\u578b\u5224\u65ad\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u524d\u6587\u6240\u5b66\u7684 isInstanceOf[T]\u548c asInstanceOf[T]\uff0c\u4e5f\u53ef\u4f7f\u7528\u6a21\u5f0f\u5339\u914d\u5b9e\u73b0\u540c\u6837\u7684\u529f\u80fd\u3002 Text Only<pre><code>def describe(x: Any): String = x match {\n\u00a0case i: Int =&gt; \"Int \" + i\n\u00a0case s: String =&gt; \"String \" + s\n\u00a0case m: List[String] =&gt; \"List \" + m\n\u00a0case c: Array[Int] =&gt; \"Array[Int]\" + c\n\u00a0case otherThing =&gt; \"other thing \" + otherThing\n}\n\nfor (elem &lt;- List(\n\u00a01,\n\u00a0\"abc\",\n\u00a0List(1, 2, 3),\n\u00a0List(\"a\", \"b\", \"c\"),\n\u00a0Array(1, 2, 3),\n\u00a0Array(\"a\", \"b\", \"c\"),\n\u00a0Set(\"a\", \"b\", \"c\")\n)) {\n\u00a0println(describe(elem))\n}\n</code></pre> \u8f93\u51fa\u7684\u7ed3\u679c\uff1a Text Only<pre><code>Int 1\nString abc\nList List(1, 2, 3)\nList List(a, b, c)\nArray[Int][I@46d56d67\nother thing [Ljava.lang.String;@d8355a8\nother thing Set(a, b, c)\n</code></pre> \u53ef\u4ee5\u770b\u5230\u7684\u662f List(1, 2, 3) \u548c List(\"a\", \"b\", \"c\")\u90fd\u5339\u914d\u5230\u4e86 case m: List[String] =&gt; \"List \" + m \uff0c\u8fd9\u662f\u56e0\u4e3a\u6cdb\u578b\u64e6\u9664\uff0c\u800c\u53ea\u6709Array(1, 2, 3)\u5339\u914d\u5230\u4e86case c: Array[Int] =&gt; \"Array[Int]\" + c\uff0cArray(\"a\", \"b\", \"c\")\u6ca1\u6709\u5339\u914d\u5230\uff0c\u8fd9\u662f\u56e0\u4e3aScala\u7684Array\u7684\u5b9e\u73b0\u5176\u5b9e\u662fJava\u4e2d\u7684\u6570\u7ec4\uff0c\u6570\u7ec4\u7c7b\u578b\u4e0d\u4f1a\u88ab\u64e6\u9664\u3002</p> <p>\u5339\u914d\u6570\u7ec4 Text Only<pre><code>for (arr &lt;- List(\n\u00a0Array(0),\n\u00a0Array(1, 0),\n\u00a0Array(0, 1),\n\u00a0Array(0, 1, 0),\n\u00a0Array(2, 1, 7),\n\u00a0Array(\"hello\", 1, 30),\n)) {\n\u00a0val result = arr match {\n\u00a0 \u00a0case Array(0) =&gt; \"0\" //\u5b8c\u5168\u5339\u914d\n\u00a0 \u00a0case Array(1, 0) =&gt; \"Array(1, 0)\" //\u5b8c\u5168\u5339\u914d\n\u00a0 \u00a0case Array(x, y) =&gt; \"Array: \" + x + \", \" + y //\u5339\u914d\u53ea\u6709\u4e24\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\n\u00a0 \u00a0case Array(0, _*) =&gt; \"\u5339\u914d\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e3a0\u7684\u6570\u7ec4\" //\u5339\u914d\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e3a0\u7684\u6570\u7ec4\n\u00a0 \u00a0case Array(x, 1, z) =&gt; \"\u5339\u914d\u4e2d\u95f4\u5143\u7d20\u4e3a1\u7684\u53ea\u6709\u4e09\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\" //\u5339\u914d\u4e2d\u95f4\u5143\u7d20\u4e3a1\u7684\u53ea\u6709\u4e09\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\n\u00a0 \u00a0case _ =&gt; \"something else\"\n\u00a0}\n\u00a0println(result)\n}\n</code></pre></p> <p>\u4ee5\u4e0a\u5339\u914d\u6570\u7ec4\u7684\u65b9\u5f0f\u5339\u914d\u5217\u8868\u65f6\u4e5f\u53ef\u4ee5\u4f7f\u7528\uff0c\u5217\u8868\u5339\u914d\u65f6\u8fd8\u6709\u5176\u5b83\u65b9\u5f0f\u53ef\u4ee5\u4f7f\u7528\uff1a Text Only<pre><code>for (list &lt;- List(\n\u00a0List(1, 2, 5, 7, 24),\n\u00a0List(24)\n)) {\n\u00a0list match {\n\u00a0 \u00a0case first :: second :: rest =&gt; println(s\"first: $first, second: $second, rest: $rest\")\n\u00a0 \u00a0case _ =&gt; println(\"something else\")\n\u00a0}\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>first: 1, second: 2, rest: List(5, 7, 24)\nsomething else\n</code></pre> \u53ef\u4ee5\u770b\u5230 case first :: second :: rest \u53ef\u4ee5\u5339\u914d\u4e09\u4e2a\u5143\u7d20\u4ee5\u4e0a\u7684List\uff0cList\u7684\u524d\u4e24\u4e2a\u5143\u7d20\u8d4b\u503c\u7ed9first \u548c second\uff0c\u6700\u540e\u6240\u6709\u5143\u7d20\u7ec4\u6210\u4e00\u4e2aList\u8d4b\u503c\u7ed9rest\u3002</p> <p>\u5339\u914d\u5143\u7ec4 \u5982\u679c\u4e0d\u5173\u5fc3\u5143\u7d20\u7684\u503c\uff0c\u53ea\u662f\u60f3\u8868\u793a\u4efb\u610f\u5c31\u53ef\u4ee5\u4f7f\u7528_\u4e0b\u5212\u7ebf\uff1b\u5982\u679c\u65e2\u60f3\u8868\u793a\u4efb\u610f\uff0c\u53c8\u60f3\u4f7f\u7528\u8fd9\u4e2a\u503c\u5c31\u7528\u4e00\u4e2a\u5b57\u6bcd\u6765\u8868\u793a\u8fd9\u4e2a\u53d8\u91cf\u3002 Text Only<pre><code>for (tuple &lt;- List(\n\u00a0(0, 1),\n\u00a0(1, 0),\n\u00a0(0, 1, 0),\n\u00a0(0, 5, 1),\n\u00a0(\"hello\", true, 0.5, 3)\n)) {\n\u00a0val result = tuple match {\n\u00a0 \u00a0case (0, _) =&gt; \"(0, _)\" //\u5339\u914d\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e3a0\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e3a\u4efb\u610f\u7684\u4e8c\u5143\u7ec4\n\u00a0 \u00a0case (a, b) =&gt; s\"{${a}, ${b})\" //\u5339\u914d\u4e24\u4e2a\u5143\u7d20\u90fd\u4e3a\u4efb\u610f\u7684\u4e8c\u5143\u7ec4\n\u00a0 \u00a0case (a, 1, _) =&gt; s\"(${a}, 1, _)\" //\u5339\u914d\u4e2d\u95f4\u5143\u7d20\u4e3a1\uff0c\u5176\u4f59\u4e24\u4e2a\u5143\u7d20\u4efb\u610f\u7684\u4e09\u5143\u7ec4\n\u00a0 \u00a0case (x, y, z) =&gt; s\"(${x}, ${y}, ${z})\" //\u5339\u914d\u4e09\u4e2a\u5143\u7d20\u90fd\u662f\u4efb\u610f\u7684\u4e09\u5143\u7ec4\n\u00a0 \u00a0case _ =&gt; \"something else\"\n\u00a0}\n\u00a0println(result)\n}\n</code></pre></p> <p>\u4ee5\u4e0b\u7ed9\u53d8\u91cf\u8d4b\u503c\u7684\u7528\u6cd5\u4e5f\u5c5e\u4e8e\u6a21\u5f0f\u5339\u914d\u7684\u8303\u7574\uff1a 1.\u58f0\u660e\u53d8\u91cf\u65f6\u5339\u914d\u5143\u7ec4\u7684\u503c Text Only<pre><code>val (x, y) = (10, \"hello\")\nprintln(s\"x: $x, y: $y\")\u00a0 //x: 10, y: hello\n</code></pre> 2.\u5339\u914dList\u4e2d\u7684\u503c Text Only<pre><code>val List(first, second, _*) = List(23, 15, 9, 78)\nprintln(s\"first: $first, second: $second\")\u00a0 //first: 23, second: 15\n\nval fir :: sec :: rest = List(23, 15 , 9, 78)\nprintln(s\"first: $fir, second: $sec, rest: $rest\")\u00a0 //first: 23, second: 15, rest: List(9, 78)\n</code></pre> 3.\u5728for\u63a8\u5bfc\u5f0f\u4e2d\u8fdb\u884c\u6a21\u5f0f\u5339\u914d \u6700\u57fa\u672c\u7684\u904d\u5386\u65b9\u5f0f\uff1a Text Only<pre><code>val list: List[(String, Int)] = List((\"a\", 12), (\"b\", 35), (\"c\", 27), (\"a\", 13))\nfor (elem &lt;- list){\n\u00a0println(elem._1 + \" \" + elem._2)\n}\n</code></pre> 3.1 \u5c06List\u7684\u5143\u7d20\u76f4\u63a5\u5b9a\u4e49\u4e3a\u5143\u7ec4\uff0c\u5bf9\u53d8\u91cf\u8d4b\u503c Text Only<pre><code>for ((word, count) &lt;- list ){\n\u00a0println(word + \": \" + count)\n}\n</code></pre> 3.2 \u53ef\u4ee5\u4e0d\u8003\u8651\u67d0\u4e2a\u4f4d\u7f6e\u7684\u53d8\u91cf\uff0c\u53ea\u904d\u5386key\u6216\u8005value Text Only<pre><code>for ((word, _) &lt;- list)\n\u00a0println(word)\n</code></pre> 3.3 \u53ef\u4ee5\u6307\u5b9a\u67d0\u4e2a\u4f4d\u7f6e\u7684\u503c\u5fc5\u987b\u662f\u591a\u5c11\uff0c\u5982\u4e0b\u53ea\u4f1a\u6253\u5370\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\"a\"\u7684\u5143\u7ec4\u7684\u7b2c\u4e8c\u5143\u7d20\u7684\u503c\uff0c\u5373\u8f93\u51fa 12 13 Text Only<pre><code>for ((\"a\", count) &lt;- list){\n\u00a0\u00a0println(count)\n}\n</code></pre></p> <p>\u5339\u914d\u5bf9\u8c61\u53ca\u6837\u4f8b\u7c7b \u5bf9\u81ea\u5b9a\u4e49\u7c7b\u7684\u5bf9\u8c61\u7684\u5339\u914d\u9700\u8981\u5728\u5176\u4f34\u751f\u5bf9\u8c61\u4e2d\u5b9e\u73b0unapply\u65b9\u6cd5(\u5bf9\u8c61\u63d0\u53d6\u5668)\uff0c\u7528\u4e8e\u6307\u5b9a\u5339\u914d\u65f6\u9700\u8981\u5bf9\u5bf9\u8c61\u7684\u54ea\u4e9b\u5b57\u6bb5\u8fdb\u884c\u6bd4\u8f83\uff0cmatch case \u5bf9 \u5bf9\u8c61\u8fdb\u884c\u5339\u914d\u65f6\u9ed8\u8ba4\u4f1a\u8c03\u7528 unapply \u65b9\u6cd5\uff0cunapply\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u662fOption\u7684\u5b50\u7c7b\u5bf9\u8c61\uff0c\u5373None\u548cSome\uff0c\u8fd9\u6837\u624d\u80fd\u5728case\u540e\u9762\u83b7\u53d6\u503c\u65f6\u907f\u514d\u7a7a\u6307\u9488\u5f02\u5e38\u3002 Text Only<pre><code>// \u5b9a\u4e49\u7c7b\nclass Student(val name: String, val age: Int)\n\n// \u5b9a\u4e49\u4f34\u751f\u5bf9\u8c61\nobject Student {\n\u00a0\u00a0// \u5fc5\u987b\u5b9e\u73b0\u4e00\u4e2aunapply\u65b9\u6cd5\uff0c\u7528\u6765\u5bf9\u5bf9\u8c61\u5c5e\u6027\u8fdb\u884c\u62c6\u89e3\n\u00a0\u00a0def unapply(student: Student): Option[(String, Int)] = {\n\u00a0\u00a0\u00a0\u00a0if (student == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0None\n\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Some((student.name, student.age))\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n}\n\nobject Test {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val student = new Student(\"alice\", 19)\n\u00a0\u00a0\u00a0\u00a0// \u9488\u5bf9\u5bf9\u8c61\u5b9e\u4f8b\u7684\u5185\u5bb9\u8fdb\u884c\u5339\u914d\n\u00a0\u00a0\u00a0\u00a0val result = student match {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case Student(\"alice\", 18) =&gt; \"Alice, 18\"\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case _ =&gt; \"Else\"\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0println(result)\n\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06Student\u5b9a\u4e49\u4e3acase\u7c7b Text Only<pre><code>case class Student(name: String, age: Int)\n</code></pre></p> <p>\u5f53\u4e00\u4e2a\u7c7b\u88ab\u58f0\u540d\u4e3acase class\u7684\u65f6\u5019\uff0cscala\u4f1a\u5e2e\u52a9\u6211\u4eec\u505a\u4e0b\u9762\u51e0\u4ef6\u4e8b\u60c5\uff1a 1.\u6784\u9020\u5668\u4e2d\u7684\u53c2\u6570\u9ed8\u8ba4\u662fval\u7c7b\u578b\uff0c\u9664\u975e\u663e\u5f0f\u6307\u5b9a\u4e3avar\uff0c\u4e5f\u5c31\u662f\u8bf4case class\u4e0d\u5b58\u5728\u4e3b\u6784\u9020\u5668\u5c40\u90e8\u53d8\u91cf 2.\u81ea\u52a8\u521b\u5efa\u4f34\u751f\u5bf9\u8c61\uff0c\u540c\u65f6\u5728\u4f34\u751f\u5bf9\u8c61\u4e2d\u5b9e\u73b0\u4e86 apply\u65b9\u6cd5 \u548c unapply\u65b9\u6cd5 3.\u81ea\u52a8\u5728\u4f34\u751f\u7c7b\u548c\u4f34\u751f\u5bf9\u8c61\u4e2d\u5b9e\u73b0\u4e86 toString\u3001 equals\u3001 hashCode \u548c copy\u65b9\u6cd5 4.\u4f34\u751f\u7c7b\u81ea\u52a8\u6df7\u5165Serializable\u7279\u8d28</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Scala/9-%E5%BC%82%E5%B8%B8%E3%80%81%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%20%E5%92%8C%20%E6%B3%9B%E5%9E%8B/","title":"9-\u5f02\u5e38\u3001\u9690\u5f0f\u8f6c\u6362 \u548c \u6cdb\u578b","text":"<p> \u7ea6 1047 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 21 \u5206\u949f</p> <p>\u5f02\u5e38 \u6355\u83b7\u5f02\u5e38\u7528\u5230\u4e86\u6a21\u5f0f\u5339\u914d\u7684\u8bed\u6cd5\uff1a Text Only<pre><code>object Test01_Exception {\ndef main(args: Array[String]): Unit = {\n\u00a0 \u00a0try {\n\u00a0 \u00a0 \u00a0val n = 10 / 0\n\u00a0 \u00a0} catch {\n\u00a0 \u00a0 \u00a0case e: ArithmeticException =&gt; {\n\u00a0 \u00a0 \u00a0 \u00a0println(\"\u53d1\u751f\u7b97\u672f\u5f02\u5e38\")\n\u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0 \u00a0case e: Exception =&gt; {\n\u00a0 \u00a0 \u00a0 \u00a0println(\"\u53d1\u751f\u4e00\u822c\u5f02\u5e38\")\n\u00a0 \u00a0 \u00a0}\n\u00a0 \u00a0} finally {\n\u00a0 \u00a0 \u00a0println(\"\u5904\u7406\u7ed3\u675f\")\n\u00a0 \u00a0}\n}\n}\n</code></pre> Scala\u5f02\u5e38\u5904\u7406\u9700\u8981\u6ce8\u610f\u51e0\u70b9\uff1a 1.Scala\u6ca1\u6709\u53d7\u68c0\u67e5\u578b\u5f02\u5e38\u7684\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f\u8bf4Scala\u5e76\u4e0d\u5f3a\u5236\u8981\u6c42\u7a0b\u5e8f\u5458\u5728\u5199\u4ee3\u7801\u5904\u7406\u4e00\u5207\u5df2\u77e5\u53ef\u80fd\u4f1a\u53d1\u751f\u7684\u5f02\u5e38\uff0c\u6240\u6709\u5f02\u5e38\u90fd\u662f\u8fd0\u884c\u65f6\u5f02\u5e38 2.\u6240\u6709\u5f02\u5e38\u90fd\u662f Throwable \u7684\u5b50\u7c7b\u578b 3.\u7528 throw \u5173\u952e\u5b57\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\u5bf9\u8c61\u3002throw \u8868\u8fbe\u5f0f\u662f\u6709\u7c7b\u578b\u7684\uff0c\u5373 Nothing\uff0c\u56e0\u4e3a Nothing \u662f\u6240\u6709\u7c7b\u578b\u7684\u5b50\u7c7b\u578b\uff0c\u6240\u4ee5 throw \u8868\u8fbe\u5f0f\u53ef\u4ee5\u7528\u5728\u9700\u8981\u7c7b\u578b\u7684\u5730\u65b9\u3002 4.java \u63d0\u4f9b\u4e86 throws \u5173\u952e\u5b57\u6765\u58f0\u660e\u5f02\u5e38\uff0c \u5728 Scala \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 @throws \u6ce8\u89e3\u6765\u58f0\u660e\u5f02\u5e38 Text Only<pre><code>@throws(classOf[NumberFormatException])\ndef f11()={\n\u00a0\"abc\".toInt\n}\n</code></pre></p> <p>\u9690\u5f0f\u8f6c\u6362 \u5f53Scala\u7f16\u8bd1\u5668\u7b2c\u4e00\u6b21\u7f16\u8bd1\u5931\u8d25\u7684\u65f6\u5019\uff0c\u4f1a\u5728\u5f53\u524d\u7684\u73af\u5883\u4e2d\u67e5\u627e\u80fd\u8ba9\u4ee3\u7801\u7f16\u8bd1\u901a\u8fc7\u7684\u65b9\u6cd5\uff0c\u5fc5\u8981\u7684\u65f6\u8fdb\u884c\u8fd8\u4f1a\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\uff0c\u5b9e\u73b0\u4e8c\u6b21\u7f16\u8bd1</p> <p>\u9690\u5f0f\u51fd\u6570\uff0c\u4f7f\u7528 implicit \u5173\u952e\u5b57\u58f0\u660e\u7684\u51fd\u6570\u79f0\u4e4b\u4e3a\u9690\u5f0f\u51fd\u6570 \u6848\u4f8b\uff1a\u901a\u8fc7\u9690\u5f0f\u8f6c\u5316\u4e3a Int \u7c7b\u578b\u589e\u52a0\u65b9\u6cd5\u3002 \u5f53\u60f3\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u65f6\uff0c\u5982\u679c\u7f16\u8bd1\u9519\u8bef\uff0c\u90a3\u4e48\u7f16\u8bd1\u5668\u4f1a\u5c1d\u8bd5\u5728\u5f53\u524d\u4f5c\u7528\u57df\u8303\u56f4\u5185\u67e5\u627e\u80fd\u8c03\u7528\u5bf9\u5e94\u65b9\u6cd5\u7684\u8f6c\u6362\u89c4\u5219\uff0c\u8fd9\u4e2a\u8c03\u7528\u8fc7\u7a0b\u662f\u7531\u7f16\u8bd1\u5668\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u79f0\u4e4b\u4e3a\u9690\u5f0f\u8f6c\u6362\u3002\u4e5f\u79f0\u4e4b\u4e3a\u81ea\u52a8\u8f6c\u6362\u3002\u6ce8\u610f\u9690\u5f0f\u51fd\u6570\u5fc5\u987b\u653e\u5728println(12.myMax(15))\u4e4b\u524d Text Only<pre><code>// \u81ea\u5b9a\u4e49\u7c7b\nclass MyRichInt(val self: Int) {\n\u00a0//\u8fd4\u56de\u4e8c\u8005\u4e4b\u95f4\u7684\u5927\u503c\n\u00a0def myMax(n: Int): Int = if ( n &lt; self ) self else n\n\u00a0//\u8fd4\u56de\u4e8c\u8005\u4e4b\u95f4\u7684\u5c0f\u503c\n\u00a0def myMin(n: Int): Int = if ( n &lt; self ) n else self\n}\n\nobject Test01_Exception {\n\u00a0def main(args: Array[String]): Unit = {\n\u00a0 \u00a0//\u9690\u5f0f\u51fd\u6570\n\u00a0 \u00a0implicit def convert(num: Int): MyRichInt = new MyRichInt(num)\n\u00a0 \u00a0// Int\u7c7b\u578b\u672c\u6765\u662f\u6ca1\u6709myMax\u65b9\u6cd5\u7684\uff0c\u5f53\u7f16\u8bd1\u5668\u7b2c\u4e00\u6b21\u7f16\u8bd1\u5931\u8d25\u65f6\uff0c\u4f1a\u627e\u5230\u5728\u5b83\u524d\u9762\u5b9a\u4e49\u7684\u9690\u5f0f\u51fd\u6570convert\uff0c\u5f97\u5230MyRichInt\u5bf9\u8c61\uff0c\n\u00a0 \u00a0// \u7136\u540e\u5728\u8c03\u7528MyRichInt\u5bf9\u8c61\u7684myMax\u65b9\u6cd5\u5f97\u5230\u6700\u540e\u7684\u7ed3\u679c\n\u00a0 \u00a0println(12.myMax(15))\n\u00a0}\n}\n</code></pre></p> <p>\u9690\u5f0f\u7c7b \u76f4\u63a5\u5c06MyRichInt\u7c7b\u58f0\u660e\u4e3a\u9690\u79c1\u7c7b\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd\u3002 Text Only<pre><code>object Test01_Exception {\n\u00a0// \u81ea\u5b9a\u4e49\u9690\u5f0f\u7c7b\n\u00a0implicit class MyRichInt(val self: Int) {\n\u00a0 \u00a0//\u8fd4\u56de\u4e8c\u8005\u4e4b\u95f4\u7684\u5927\u503c\n\u00a0 \u00a0def myMax(n: Int): Int = if ( n &lt; self ) self else n\n\u00a0 \u00a0//\u8fd4\u56de\u4e8c\u8005\u4e4b\u95f4\u7684\u5c0f\u503c\n\u00a0 \u00a0def myMin(n: Int): Int = if ( n &lt; self ) n else self\n\u00a0}\n\u00a0def main(args: Array[String]): Unit = {\n\u00a0 \u00a0println(12.myMax(15))\n\u00a0}\n}\n</code></pre> \u6ce8\u610f\uff1a 1.\u9690\u5f0f\u7c7b\u5fc5\u987b\u88ab\u5b9a\u4e49\u5728\u201c\u7c7b\u201d\u6216\u201c\u4f34\u751f\u5bf9\u8c61\u201d\u6216\u201c\u5305\u5bf9\u8c61\u201d\u91cc\uff0c\u5373\u9690\u5f0f\u7c7b\u4e0d\u80fd\u662f\u9876\u7ea7\u7684\u3002 2.\u9690\u5f0f\u7c7b\u7684\u4e3b\u6784\u9020\u5668\u5fc5\u987b\u53ea\u80fd\u6709\u4e00\u4e2a\u53c2\u6570</p> <p>\u9690\u5f0f\u53c2\u6570 \u666e\u901a\u65b9\u6cd5\u6216\u8005\u51fd\u6570\u4e2d\u7684\u53c2\u6570\u53ef\u4ee5\u901a\u8fc7 implicit \u5173\u952e\u5b57\u58f0\u660e\u4e3a\u9690\u5f0f\u53c2\u6570\uff0c\u8c03\u7528\u8be5\u65b9\u6cd5\u65f6\uff0c\u5c31\u53ef\u4ee5\u4e0d\u4f20\u5165\u8be5\u53c2\u6570\uff0c\u7f16\u8bd1\u5668\u4f1a\u5728\u76f8\u5e94\u7684\u4f5c\u7528\u57df\u5bfb\u627e\u7b26\u5408\u6761\u4ef6\u7684\u9690\u5f0f\u503c\u3002 Text Only<pre><code>object Test01_Exception {\n\u00a0def main(args: Array[String]): Unit = {\n\u00a0 \u00a0implicit val str: String = \"alice\"\n\u00a0 \u00a0def sayHello()(implicit name: String = \"bob\"): Unit = {\n\u00a0 \u00a0 \u00a0println(\"hello, \" + name)\n\u00a0 \u00a0}\n\u00a0 \u00a0sayHello //\u8f93\u51fa\u662falice\n\u00a0}\n}\n</code></pre> \u6ce8\u610f\uff1a 1.\u5b9a\u4e49\u542b\u6709\u9690\u5f0f\u53c2\u6570\u7684\u51fd\u6570\u9700\u8981\u4f7f\u7528\u67ef\u91cc\u5316\u7684\u5f62\u5f0f\uff0c\u4e3a\u4e86\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6\uff0c\u9700\u8981\u5c06\u9690\u5f0f\u53c2\u6570\u653e\u5728\u6700\u540e\u7684\u53c2\u6570\u5217\u8868\u91cc\uff0c\u5e76\u4e14\u524d\u9762\u7684\u7a7a\u53c2\u6570\u5217\u8868\u7684\u7a7a\u62ec\u53f7\u4e5f\u4e0d\u80fd\u7701\u7565 1.\u7f16\u8bd1\u5668\u6309\u7167\u9690\u5f0f\u53c2\u6570\u7684\u7c7b\u578b\u53bb\u5bfb\u627e\u5bf9\u5e94\u7c7b\u578b\u7684\u9690\u5f0f\u503c\uff0c\u4e0e\u9690\u5f0f\u503c\u7684\u540d\u79f0\u65e0\u5173\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u4f5c\u7528\u57df\u4e2d\uff0c\u76f8\u540c\u7c7b\u578b\u7684\u9690\u5f0f\u503c\u53ea\u80fd\u6709\u4e00\u4e2a 2.\u9690\u5f0f\u53c2\u6570\u4f18\u5148\u4e8e\u9ed8\u8ba4\u53c2\u6570</p> <p>\u7b80\u4fbf\u5199\u6cd5\uff0c\u5c06\u60f3\u8981\u4f7f\u7528\u7684\u9690\u5f0f\u503c\u76f4\u63a5\u7528implicitly[String]\u58f0\u660e\u5373\u53ef\u4f7f\u7528 Text Only<pre><code>object Test01_Exception {\n\u00a0def main(args: Array[String]): Unit = {\n\u00a0 \u00a0implicit val str: String = \"alice\"\n\u00a0 \u00a0def sayHello(): Unit = {\n\u00a0 \u00a0 \u00a0println(\"hello, \" + implicitly[String])\n\u00a0 \u00a0}\n\u00a0 \u00a0sayHello //alice\n\u00a0}\n}\n</code></pre></p> <p>\u6cdb\u578b \u8bed\u6cd5 Text Only<pre><code>class MyList[+T]{ //\u534f\u53d8\n}\nclass MyList[-T]{ //\u9006\u53d8\n}\nclass MyList[T] //\u4e0d\u53d8\n</code></pre></p> <p>\u534f\u53d8\uff1a Son \u662f Father \u7684\u5b50\u7c7b\uff0c\u5219 MyList[Son] \u4e5f\u4f5c\u4e3a MyList[Father]\u7684\u201c\u5b50\u7c7b\u201d \u3002 \u9006\u53d8\uff1a Son \u662f Father \u7684\u5b50\u7c7b\uff0c\u5219 MyList[Son]\u4f5c\u4e3a MyList[Father]\u7684\u201c\u7236\u7c7b\u201d \u3002 \u4e0d\u53d8\uff1a Son \u662f Father \u7684\u5b50\u7c7b\uff0c\u5219 MyList[Father]\u4e0e MyList[Son]\u201c\u65e0\u7236\u5b50\u5173\u7cfb\u201d \u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/1-Spark%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/","title":"1-Spark\u5feb\u901f\u4e0a\u624b","text":"<p> \u7ea6 3530 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 71 \u5206\u949f</p> <p>IDEA\u672c\u5730\u6a21\u5f0f\u8dd1Spark\u7a0b\u5e8f 1.\u914d\u7f6e\u597dScala\u7684\u73af\u5883 2.\u5bfc\u5165Spark\u7684\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spark-core_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> 3.\u6dfb\u52a0log4j.properties Text Only<pre><code>log4j.rootCategory=ERROR, console\nlog4j.appender.console=org.apache.log4j.ConsoleAppender\nlog4j.appender.console.target=System.err\nlog4j.appender.console.layout=org.apache.log4j.PatternLayout\nlog4j.appender.console.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss} %p %c{1}: %m%n\n\n# Set the default spark-shell log level to ERROR. When running the spark-shell, the\n# log level for this class is used to overwrite the root logger's log level, so that\n# the user can have different defaults for the shell and regular Spark apps.\nlog4j.logger.org.apache.spark.repl.Main=ERROR\n\n# Settings to quiet third party logs that are too verbose\nlog4j.logger.org.spark_project.jetty=ERROR\nlog4j.logger.org.spark_project.jetty.util.component.AbstractLifeCycle=ERROR\nlog4j.logger.org.apache.spark.repl.SparkIMain$exprTyper=ERROR\nlog4j.logger.org.apache.spark.repl.SparkILoop$SparkILoopInterpreter=ERROR\nlog4j.logger.org.apache.parquet=ERROR\nlog4j.logger.parquet=ERROR\n\n# SPARK-9183: Settings to avoid annoying messages when looking up nonexistent UDFs in SparkSQL with Hive support\nlog4j.logger.org.apache.hadoop.hive.metastore.RetryingHMSHandler=FATAL\nlog4j.logger.org.apache.hadoop.hive.ql.exec.FunctionRegistry=ERROR\n</code></pre></p> <p>WordCount\u6848\u4f8b \u5bf9RDD\u7684\u64cd\u4f5c\u548cScala\u7684\u96c6\u5408\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u5bf9Scala\u96c6\u5408\u7684\u6bcf\u4e00\u6b65\u64cd\u4f5c\u90fd\u662f\u6709\u7ed3\u679c\u7684\uff0c\u5373\u6bcf\u4e00\u6b65\u64cd\u4f5c\u90fd\u662f\u4f1a\u7acb\u5373\u5bf9\u96c6\u5408\u8fdb\u884c\u8ba1\u7b97\uff0c\u800cRDD\u64cd\u4f5c\u4e0d\u662f\uff0c\u5728RDD\u7684collect\u51fd\u6570\u4e4b\u524d\u8c03\u7528\u7684RDD\u51fd\u6570\u90fd\u53ea\u662f\u4e00\u79cd\u58f0\u660e\uff0c\u5e76\u4e0d\u6ca1\u6709\u771f\u6b63\u7684\u5bf9\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u53ea\u6709\u6267\u884c\u5230collect\u51fd\u6570\u65f6\u624d\u5f00\u59cb\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u6309\u4e4b\u524d\u58f0\u660e\u597d\u7684\u6b65\u9aa4\u8fdb\u884c\u8ba1\u7b97\uff08\u4e0etensorflow\u4e00\u6a21\u4e00\u6837\uff0c\u90fd\u662f\u5148\u6784\u5efa\u8ba1\u7b97\u56fe\uff0c\u6784\u5efa\u5b8c\u4e4b\u540e\u7b49\u5230\u6700\u540e\u4e00\u6b65\u8c03\u7528\u624d\u5f00\u59cb\u8ba1\u7b97\uff0c\u6700\u540e\u4e00\u6b65\u8c03\u7528\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u5f00\u5173\uff0c\u6309\u4e0b\u53bb\u4e4b\u540e\u6570\u636e\u624d\u5f00\u59cb\u6d41\u52a8\uff09\u3002RDD\u662f\u901a\u8fc7\u88c5\u9970\u8005\u6a21\u5f0f\u5b9e\u73b0\u8fd9\u6837\u7684\u6548\u679c\u7684\uff0c\u7c7b\u4f3c\u4e8eJava IO\u7684\u8bbe\u8ba1\uff0cRDD\u7684\u6bcf\u4e00\u6b65\u64cd\u4f5c\u5176\u5b9e\u90fd\u662f\u5728\u521b\u5efa\u5bf9\u8c61\uff0c\u5373\u5c06\u4e0a\u4e00\u4e2a\u5bf9\u8c61\u5305\u88c5\u5230\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u4e2d\u3002 setMaster(\"local[*]\")\u8868\u793a\u4f7f\u7528Local\u6a21\u5f0f\uff0c\u5176\u4e2d\u7684[*]\u8868\u793a\u4f7f\u7528\u4e0e\u672c\u5730cpu\u6838\u5fc3\u6570\u76f8\u540c\u591a\u7684\u7ebf\u7a0b\u8fdb\u884c\u5e76\u884c\u8ba1\u7b97\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5177\u4f53\u6307\u5b9a\u4f7f\u7528\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff0c\u6bd4\u5982setMaster(\"local[2]\")\uff0c\u5982\u679c\u4e0d\u6307\u5b9asetMaster(\"local\")\u5219\u4f7f\u7528\u5355\u7ebf\u7a0b\u3002 Text Only<pre><code>object WordCount {\n\u00a0def main(args: Array[String]): Unit = {\n\u00a0 \u00a0// TODO \u5efa\u7acb\u548cSpark\u6846\u67b6\u7684\u8fde\u63a5\n\u00a0 \u00a0val sparConf = new SparkConf().`setMaster(\"local[*]\")`.setAppName(\"WordCount\")\n\u00a0 \u00a0val sc = new SparkContext(sparConf)\n\u00a0 \u00a0// TODO \u6267\u884c\u4e1a\u52a1\u64cd\u4f5c\n\u00a0 \u00a0// 1. \u8bfb\u53d6\u6587\u4ef6\uff0c\u83b7\u53d6\u4e00\u884c\u4e00\u884c\u7684\u6570\u636e\n\u00a0 \u00a0val lines: RDD[String] = sc.textFile(\"data\")\n\u00a0 \u00a0// 2. \u6620\u5c04\uff1a\u5c06\u6bcf\u4e00\u884c\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c\u5f62\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u5355\u8bcd\uff08\u5206\u8bcd\uff09\u653e\u5230\u4e00\u4e2aList\u4e2d\n\u00a0 \u00a0// \u00a0 \u00a0\u6241\u5e73\u5316\uff1a\u5c06\u6240\u6709List\u62c6\u5206\u6210\u4e2a\u4f53\u7684\u64cd\u4f5c\n\u00a0 \u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0 \u00a0// 3. \u5c06\u6570\u636e\u6839\u636e\u5355\u8bcd\u8fdb\u884c\u5206\u7ec4\uff0c\u4fbf\u4e8e\u7edf\u8ba1\uff0c\u5206\u7ec4\u7684\u7ed3\u679c\u662f\u4e00\u4e2aMap\uff0ckey\u662f\u5206\u7ec4\u7684key\uff0cvalue\u662f\u76f8\u540ckey\u7684\u6570\u636e\u7684List\n\u00a0 \u00a0// \u00a0 \u00a0Map((Hello -&gt; List(Hello, Hello, Hello)), (world -&gt; List(world, world)))\n\u00a0 \u00a0val wordGroup: RDD[(String, Iterable[String])] = words.groupBy(word =&gt; word)\n\u00a0 \u00a0// 4. \u5bf9\u5206\u7ec4\u540e\u7684\u6570\u636e\u518d\u8fdb\u884cmap\u6620\u5c04\n\u00a0 \u00a0// \u00a0 \u00a0Map((hello -&gt; 3), (world -&gt; 2))\n\u00a0 \u00a0val wordToCount: RDD[(String, Int)] = wordGroup.mapValues(_.size)\n\u00a0 \u00a0// 5. \u5f53\u8c03\u7528collect\u65f6\u624d\u4f1a\u8fdb\u884c\u6570\u636e\u7684\u8ba1\u7b97\u3002\u4e5f\u5c31\u662f\u8bf4\u4e0a\u9762\u7684\u6b65\u9aa4\u53ea\u662f\u5728\u58f0\u660e\u64cd\u4f5c\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u8ba1\u7b97\uff0c\u53ea\u6709\u6267\u884ccollect\u65b9\u6cd5\u65f6\u6570\u636e\u624d\u4f1a\u5f00\u59cb\u6d41\u52a8\u8fdb\u884c\u4e0a\u9762\u7684\u64cd\u4f5c\n\u00a0 \u00a0// collect\u7684\u8fd4\u56de\u503c\u662fArray\uff0c\u4e5f\u5c31\u662f\u6700\u540e\u4f1a\u628aRDD\u8f6c\u6362\u6210Scala\u7684\u6570\u636e\u7ed3\u6784\uff0c\u65b9\u4fbf\u8f93\u51fa\u7ed3\u679c\n\u00a0 \u00a0// Array((hello -&gt; 3), (world -&gt; 2))\n\u00a0 \u00a0val array: Array[(String, Int)] = wordToCount.collect()\n\u00a0 \u00a0array.foreach(println)\n\u00a0 \u00a0// TODO \u5173\u95ed\u8fde\u63a5\n\u00a0 \u00a0sc.stop()\n\u00a0}\n}\n</code></pre> \u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528RDD\u63d0\u4f9b\u7684reduceByKey\u51fd\u6570\u76f4\u63a5\u8fdb\u884c\u805a\u5408\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u5c06\u4e0a\u9762\u7684\u7b2c3\u30014\u6b65\u5408\u5e76\u4e3a\u4e00\u6b65\uff0c\u4e0d\u7528\u5148\u5206\u7ec4\u7136\u540e\u518d\u5bf9\u6bcf\u4e00\u7ec4\u6570\u636e\u505amap\u6620\u5c04\u6216\u8005reduce\u805a\u5408\uff0c\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0creduceByKey\u64cd\u4f5c\u8981\u6c42\u8f93\u5165\u7684\u6570\u636e\u5fc5\u987b\u662f\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u5373kv\u952e\u503c\u5bf9\u5f62\u5f0f\u7684\uff0c\u56e0\u4e3a\u5b83\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\u76f4\u63a5\u5bf9\u6240\u6709key\u76f8\u540c\u7684\u4e8c\u5143\u7ec4\u7684value\u505areduce\u64cd\u4f5c\u3002 Text Only<pre><code>object WordCount2 {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0// TODO \u5efa\u7acb\u548cSpark\u6846\u67b6\u7684\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0val sparConf = new SparkConf().setMaster(\"local\").setAppName(\"WordCount\")\n\u00a0\u00a0\u00a0\u00a0val sc = new SparkContext(sparConf)\n\u00a0\u00a0\u00a0\u00a0// TODO \u6267\u884c\u4e1a\u52a1\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0// 1. \u8bfb\u53d6\u6587\u4ef6\uff0c\u83b7\u53d6\u4e00\u884c\u4e00\u884c\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0val lines: RDD[String] = sc.textFile(\"data\")\n\u00a0\u00a0\u00a0\u00a0// 2. \u6620\u5c04\uff1a\u5c06\u6bcf\u4e00\u884c\u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c\u5f62\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u5355\u8bcd\uff08\u5206\u8bcd\uff09\u653e\u5230\u4e00\u4e2aList\u4e2d\n\u00a0\u00a0\u00a0\u00a0//\u00a0\u00a0\u00a0\u00a0\u6241\u5e73\u5316\uff1a\u5c06\u6240\u6709List\u62c6\u5206\u6210\u4e2a\u4f53\u7684\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0\u00a0\u00a0`// 3.\u6620\u5c04\uff0c\u628a\u6bcf\u4e2a\u5355\u8bcd\u6620\u5c04\u6210\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e3a1\uff0c\u65b9\u4fbf\u540e\u9762\u76f4\u63a5\u4f7f\u7528reduceByKey`\n `// hello \u53d8\u6210 (hello, 1)`\n `val wordAndOne: RDD[(String, Int)] = words.map((_, 1))`\n `// 4.\u5206\u7ec4\u805a\u5408\u4e24\u6b65\u64cd\u4f5c\u76f4\u63a5\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u4e5f\u5c31\u662f\u5bf9\u6240\u6709key\u76f8\u540c\u7684\u4e8c\u5143\u7ec4\u7684value\u76f4\u63a5\u505areduce\u64cd\u4f5c`\n `val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)`\n\u00a0\u00a0\u00a0\u00a0// 5. \u5f53\u8c03\u7528collect\u65f6\u624d\u4f1a\u8fdb\u884c\u6570\u636e\u7684\u8ba1\u7b97\u3002\u4e5f\u5c31\u662f\u8bf4\u4e0a\u9762\u7684\u6b65\u9aa4\u53ea\u662f\u5728\u58f0\u660e\u64cd\u4f5c\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u8ba1\u7b97\uff0c\u53ea\u6709\u6267\u884ccollect\u65b9\u6cd5\u65f6\u6570\u636e\u624d\u4f1a\u5f00\u59cb\u6d41\u52a8\u8fdb\u884c\u4e0a\u9762\u7684\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0// collect\u7684\u8fd4\u56de\u503c\u662fArray\uff0c\u4e5f\u5c31\u662f\u6700\u540e\u4f1a\u628aRDD\u8f6c\u6362\u6210Scala\u7684\u6570\u636e\u7ed3\u6784\uff0c\u65b9\u4fbf\u8f93\u51fa\u7ed3\u679c\n\u00a0\u00a0\u00a0\u00a0// Array((hello -&gt; 3), (world -&gt; 2))\n\u00a0\u00a0\u00a0\u00a0val array: Array[(String, Int)] = wordToCount.collect()\n\u00a0\u00a0\u00a0\u00a0array.foreach(println)\n\u00a0\u00a0\u00a0\u00a0// TODO \u5173\u95ed\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0sc.stop()\n\u00a0\u00a0}\n}\n</code></pre></p> <p>Local \u6a21\u5f0f 1.\u89e3\u538b\u7f29Spark\u5e76\u91cd\u547d\u540d Text Only<pre><code>tar -zxvf /opt/software/spark-3.0.0-bin-hadoop3.2.tgz -C /opt/module/\n</code></pre> Text Only<pre><code>mv spark-3.0.0-bin-hadoop3.2/ spark-local\n</code></pre> 2.\u8fdb\u5165Spark\u7684\u547d\u4ee4\u884c\u4ea4\u4e92\u754c\u9762 Text Only<pre><code>bin/spark-shell\n</code></pre> Spark WebUI\u5730\u5740\uff0c\u67e5\u770b\u672c\u6b21\u4f1a\u8bdd\u671f\u95f4\u4efb\u52a1\u8fd0\u884c\u60c5\u51b5\uff1a Text Only<pre><code>http://hadoop102:4040\n</code></pre> 3.\u6d4b\u8bd5\uff0c\u4f7f\u7528\u547d\u4ee4\u884c\u4ea4\u4e92\u754c\u9762\u5b8c\u6210wordcount\u7a0b\u5e8f 3.1 \u5728/opt/module/spark-local/data\u4e0b\u65b0\u5efa\u4e00\u4e2awords.txt\u5e76\u6dfb\u52a0\u70b9\u5185\u5bb9 3.2 \u8f93\u5165\u5982\u4e0b\u4ee3\u7801\u3002\u5728\u547d\u4ee4\u884c\u4e2d\u5df2\u7ecf\u521b\u5efa\u4e86SparkContext\u5bf9\u8c61sc\uff0csc\u4f7f\u7528\u7684master\u662fLocal \u6a21\u5f0f\uff0c\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0c\u6240\u4ee5\u547d\u4ee4\u884c\u53ea\u80fd\u5728Local\u6a21\u5f0f\u4e0b\u6267\u884cspark\u7a0b\u5e8f\u3002 Text Only<pre><code>sc.textFile(\"data/words.txt\").flatMap(_.split(\" \")).map((_,1)).reduceByKey(_+_).collect()\n</code></pre> 4. \u9000\u51fa\u547d\u4ee4\u884c\uff0c\u6309\u952e Ctrl+C \u6216\u8f93\u5165 Scala \u6307\u4ee4 Text Only<pre><code>:quit\n</code></pre> 5. Local \u6a21\u5f0f\u63d0\u4ea4\u5e94\u7528\u3002\u8fd8\u53ef\u4ee5\u5c06IDEA\u4e2d\u7684\u7a0b\u5e8f\u6253\u5305\u4e4b\u540e\u518d\u63d0\u4ea4\u7ed9spark\u8fd0\u884c\uff0c\u4ee5\u4e0b\u662f\u5c06spark\u81ea\u5e26\u7684\u8ba1\u7b97\u5706\u5468\u7387\u7684\u7a0b\u5e8f\u63d0\u4ea4\u7ed9spark\u8fd0\u884c\u7684\u547d\u4ee4\uff0cspark-submit \u63d0\u4ea4\u7684Local \u6a21\u5f0f\u7684\u4efb\u52a1\u7684\u65e5\u5fd7\u4e0d\u80fd\u5728\u00a0http://hadoop102:4040 \u770b\u5230\uff0chttp://hadoop102:4040\u00a0\u53ea\u80fd\u770b\u5230\u5f53\u524d\u4f1a\u8bdd\u7684\u4efb\u52a1\u7684\u65e5\u5fd7\uff0c\u56e0\u4e3a\u4f1a\u8bdd\u7684app-id\u4e0e\u5355\u72ec\u63d0\u4ea4\u8fd0\u884c\u7684app-id\u4e0d\u540c\u3002 Text Only<pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n--master local[2] \\\n./examples/jars/spark-examples_2.12-3.0.0.jar \\\n10\n</code></pre></p> <p>Standalone \u6a21\u5f0f Spark\u7684Standalone\uff08\u72ec\u7acb\u90e8\u7f72\uff09\u6a21\u5f0f\u6307\u7684\u662f\u4f7f\u7528Spark\u81ea\u5e26\u7684 \u8d44\u6e90\u8c03\u5ea6\u5668 \u90e8\u7f72Spark\u96c6\u7fa4\u3002 \u96c6\u7fa4\u89c4\u5212\u5982\u4e0b\uff0cMaster\u7c7b\u4f3c\u4e8eYarn\u7684ResourceManager\uff0cWork\u7c7b\u4f3c\u4e8eYarn\u7684NodeManager\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684\u96c6\u7fa4\u6307\u7684\u662f \u8d44\u6e90\u8c03\u5ea6\u5668 \u7684\u96c6\u7fa4\uff0c\u7531\u8d44\u6e90\u8c03\u5ea6\u5668\u8c03\u5ea6spark\u7a0b\u5e8f\u7684\u8fd0\u884c\u3002 </p> <p>1.\u89e3\u538b\u7f29Spark\u5e76\u91cd\u547d\u540d Text Only<pre><code>tar -zxvf /opt/software/spark-3.0.0-bin-hadoop3.2.tgz -C /opt/module/\n</code></pre> Text Only<pre><code>mv spark-3.0.0-bin-hadoop3.2/ spark-standalone\n</code></pre> 2.\u4fee\u6539 conf/slaves \u6587\u4ef6 Text Only<pre><code>mv slaves.template slaves\n</code></pre> \u6dfb\u52a0worker\uff1a Text Only<pre><code>hadoop102\nhadoop103\nhadoop104\n</code></pre> 3. \u4fee\u6539 conf/spark-env.sh \u6587\u4ef6 Text Only<pre><code>mv spark-env.sh.template spark-env.sh\n</code></pre> \u6307\u5b9a JAVA_HOME \u548c master \u6240\u5728\u7684\u4e3b\u673a \u4ee5\u53ca \u5411 master \u7684\u63d0\u4ea4spark\u7a0b\u5e8f\u7684\u7aef\u53e3 Text Only<pre><code>export JAVA_HOME=/opt/module/jdk1.8.0_301\nSPARK_MASTER_HOST=hadoop102\nSPARK_MASTER_PORT=7077\n</code></pre> 4. \u5206\u53d1 spark Text Only<pre><code>xsync spark-standalone\n</code></pre> 5. \u542f\u52a8\u96c6\u7fa4 Text Only<pre><code>sbin/start-all.sh\n</code></pre> \u67e5\u770bjvm\u8fdb\u7a0b\uff1a Text Only<pre><code>jpsall\n</code></pre> \u67e5\u770b Master \u8d44\u6e90\u76d1\u63a7 Web UI \u754c\u9762 Text Only<pre><code>http://hadoop102:8080/\n</code></pre> 6. Standalone \u6a21\u5f0f\u63d0\u4ea4\u5e94\u7528\uff0c\u540c\u6837\u662f\u8fd0\u884c\u81ea\u5e26\u7684\u8ba1\u7b97\u5706\u5468\u7387\u7684spark\u7a0b\u5e8f\uff0c\u4e0d\u8fc7\u8fd9\u6b21\u662f\u63d0\u4ea4\u7ed9Spark\u81ea\u5e26\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\u7684master\uff0c\u6240\u4ee5\u4f1a\u4ee5\u5206\u5e03\u5f0f\u8ba1\u7b97\u7684\u65b9\u5f0f\u5728\u591a\u53f0\u4e3b\u673a\u4e0a\u8fd0\u884cspark\u7a0b\u5e8f\u3002 Text Only<pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n`--master spark://hadoop102:7077 \\`\n./examples/jars/spark-examples_2.12-3.0.0.jar \\\n10\n</code></pre> 7.\u505c\u6b62\u96c6\u7fa4 Text Only<pre><code>sbin/stop-all.sh\n</code></pre></p> <p>spark-submit\u547d\u4ee4\u53c2\u6570\u8bf4\u660e\uff1a</p> \u53c2\u6570 \u89e3\u91ca \u53ef\u9009\u503c\u4e3e\u4f8b --class \u6307\u5b9aSpark \u7a0b\u5e8f\u4e2d\u5305\u542b\u4e3b\u51fd\u6570\u7684\u7c7b --master \u6307\u5b9aSpark \u7a0b\u5e8f\u8fd0\u884c\u7684\u6a21\u5f0f(\u73af\u5883) \u6a21\u5f0f\uff1a local[*]\u3001 spark://haoop102:7077\u3001Yarn --executor-memory 1G \u6307\u5b9a\u6bcf\u4e2a executor \u53ef\u7528\u5185\u5b58\u4e3a 1G \u7b26\u5408\u96c6\u7fa4\u5185\u5b58\u914d\u7f6e\u5373\u53ef\uff0c\u5177\u4f53\u60c5\u51b5\u5177\u4f53\u5206\u6790 --total-executor-cores 2 \u6307\u5b9a\u6240\u6709executor\u4f7f\u7528\u7684cpu\u6838\u6570\u4e3a 2 \u4e2a --executor-cores \u6307\u5b9a\u6bcf\u4e2aexecutor\u4f7f\u7528\u7684cpu\u6838\u6570 application-jar \u6253\u5305\u597d\u7684\u5e94\u7528 jar\uff0c\u5305\u542b\u4f9d\u8d56\u3002\u8fd9\u4e2a URL \u5728\u96c6\u7fa4\u4e2d\u5168\u5c40\u53ef\u89c1\u3002 \u6bd4\u5982 hdfs:// \u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u5982\u679c\u662ffile:// path\uff0c\u90a3\u4e48\u6240\u6709\u7684\u8282\u70b9\u7684path \u90fd\u5305\u542b\u540c\u6837\u7684 jar application-arguments \u4f20\u7ed9 main()\u65b9\u6cd5\u7684\u53c2\u6570 <p>\u914d\u7f6e\u5386\u53f2\u670d\u52a1 Local\u6a21\u5f0f\u65f6\uff0c\u9000\u51fa\u547d\u4ee4\u884c\u4e4b\u540e\u5c31\u65e0\u6cd5\u901a\u8fc7 http://hadoop102:4040\u00a0\u67e5\u770b\u4efb\u52a1\u8fd0\u884c\u60c5\u51b5\u4e86\uff0c\u5e76\u4e14\u4efb\u52a1\u8fd0\u884c\u7684\u65e5\u5fd7\u4e5f\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u5373\u4f7f\u518d\u6b21\u5f00\u542f\u547d\u4ee4\u884c\u4e5f\u770b\u4e0d\u5230\u4e4b\u524d\u4efb\u52a1\u7684\u8fd0\u884c\u65e5\u5fd7\u3002Standalone \u6a21\u5f0f\u4e5f\u662f\u4e00\u6837\uff0c\u53ea\u80fd\u67e5\u770b\u5728\u96c6\u7fa4\u8fd0\u884c\u671f\u95f4\u8fd0\u884c\u7684\u4efb\u52a1\u7684\u65e5\u5fd7\uff0c\u96c6\u7fa4\u505c\u6b62\u4e4b\u540e\u5c31\u67e5\u770b\u4e0d\u5230\u4e86\uff0c\u5e76\u4e14\u4e5f\u4e0d\u4f1a\u4fdd\u7559\u4efb\u52a1\u7684\u65e5\u5fd7\u3002\u5386\u53f2\u670d\u52a1\u5668\u53ef\u4ee5\u4fdd\u5b58\u65e0\u8bba\u662fLocal\u6a21\u5f0f\u8fd8\u662fStandalone \u6a21\u5f0f\u7684\u4efb\u52a1\u7684\u65e5\u5fd7\u3002 1.\u4fee\u6539 conf/spark-defaults.conf \u6587\u4ef6 Text Only<pre><code>mv spark-defaults.conf.template spark-defaults.conf\n</code></pre> \u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5f00\u542f\u65e5\u5fd7\uff0c\u5e76\u8bbe\u7f6e\u5c06\u65e5\u5fd7\u4fdd\u5b58\u5728HDFS\u4e0a Text Only<pre><code>spark.eventLog.enabled true\nspark.eventLog.dir hdfs://hadoop102:8020/spark-history\n</code></pre> \u6ce8\u610f\uff1a\u9700\u8981\u542f\u52a8 hadoop \u96c6\u7fa4\uff0c HDFS \u4e0a\u7684 /spark-history \u76ee\u5f55\u9700\u8981\u63d0\u524d\u5b58\u5728 Text Only<pre><code>sbin/start-dfs.sh\nhadoop fs -mkdir /spark-history\n</code></pre> 2. \u4fee\u6539 spark-env.sh \u6587\u4ef6, \u6dfb\u52a0\u65e5\u5fd7\u914d\u7f6e Text Only<pre><code>export SPARK_HISTORY_OPTS=\"\n-Dspark.history.ui.port=18080\n-Dspark.history.fs.logDirectory=hdfs://hadoop102:8020/spark-history\n-Dspark.history.retainedApplications=30\"\n</code></pre> -Dspark.history.ui.port\uff1a WEB UI \u8bbf\u95ee\u7684\u7aef\u53e3\u53f7\u4e3a 18080 -Dspark.history.fs.logDirectory\uff1a\u6307\u5b9a\u5386\u53f2\u670d\u52a1\u5668\u65e5\u5fd7\u5b58\u50a8\u8def\u5f84 -Dspark.history.retainedApplications\uff1a\u6307\u5b9a\u4fdd\u5b58 Application \u5386\u53f2\u8bb0\u5f55\u7684\u4e2a\u6570\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u65e7\u7684\u5e94\u7528\u7a0b\u5e8f\u4fe1\u606f\u5c06\u88ab\u5220\u9664\uff0c\u8fd9\u4e2a\u662f\u5185\u5b58\u4e2d\u7684\u5e94\u7528\u6570\uff0c\u800c\u4e0d\u662f\u9875\u9762\u4e0a\u663e\u793a\u7684\u5e94\u7528\u6570\u3002 4. \u5206\u53d1\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0d\u5206\u53d1\u5c31\u53ea\u80fd\u4fdd\u5b58\u672c\u673aLocal\u6a21\u5f0f\u4e0b\u7684\u65e5\u5fd7 Text Only<pre><code>xsync conf\n</code></pre> 5.\u542f\u52a8\u5386\u53f2\u670d\u52a1\u5668 Text Only<pre><code>sbin/start-history-server.sh\n</code></pre> \u542f\u52a8spark\u96c6\u7fa4 Text Only<pre><code>sbin/start-all.sh\n</code></pre> 6.\u8bbf\u95ee\u5386\u53f2\u670d\u52a1\u7684webui Text Only<pre><code>http://hadoop102:18080/\n</code></pre> 7.\u505c\u6b62\u5386\u53f2\u670d\u52a1\u5668 Text Only<pre><code>sbin/stop-history-server.sh\n</code></pre></p> <p>Master\u9ad8\u53ef\u7528 \u56e0\u4e3a Master \u8282\u70b9\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u4ee5\u4f1a\u5b58\u5728\u5355\u70b9\u6545\u969c\u95ee\u9898\u3002 \u4e3a\u4e86\u89e3\u51b3\u5355\u70b9\u6545\u969c\u95ee\u9898\uff0c\u9700\u8981\u5728\u96c6\u7fa4\u4e2d\u914d\u7f6e\u591a\u4e2a Master \u8282\u70b9\uff0c\u4e00\u65e6\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u7684 Master\u53d1\u751f\u6545\u969c\u65f6\uff0c\u7531\u5907\u7528 Master \u63d0\u4f9b\u670d\u52a1\uff0c\u4fdd\u8bc1\u4f5c\u4e1a\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u3002 \u9ad8\u53ef\u7528\u4e00\u822c\u91c7\u7528Zookeeper \u6765\u5b9e\u73b0\uff0c\u901a\u8fc7\u4e89\u62a2\u521b\u5efa\u67d0\u4e2a\u8282\u70b9\u5b8c\u6210\u4e3bMaster\u7684\u9009\u62e9\u3002 \u96c6\u7fa4\u89c4\u5212\uff1a  1. \u505c\u6b62spark\u96c6\u7fa4 Text Only<pre><code>sbin/stop-all.sh\n</code></pre> 2. \u542f\u52a8 Zookeeper\u96c6\u7fa4 Text Only<pre><code>zk.sh start\n</code></pre> 3.\u4fee\u6539 spark-env.sh \u6587\u4ef6 Text Only<pre><code>#\u6ce8\u91ca\u5982\u4e0b\u5185\u5bb9\uff1a\n#SPARK_MASTER_HOST=hadoop102\n#SPARK_MASTER_PORT=7077\n\n#\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9:\n#Master \u76d1\u63a7\u9875\u9762\u9ed8\u8ba4\u8bbf\u95ee\u7aef\u53e3\u4e3a 8080\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u548c Zookeeper \u51b2\u7a81\uff0c\u6240\u4ee5\u6539\u6210 8989\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u8bbf\u95ee UI \u76d1\u63a7\u9875\u9762\u65f6\u8bf7\u6ce8\u610f\nSPARK_MASTER_WEBUI_PORT=8989\nexport SPARK_DAEMON_JAVA_OPTS=\"\n-Dspark.deploy.recoveryMode=ZOOKEEPER\n-Dspark.deploy.zookeeper.url=hadoop102,hadoop103,hadoop104\n-Dspark.deploy.zookeeper.dir=/spark\"\n</code></pre> 4.\u5206\u53d1\u914d\u7f6e Text Only<pre><code>xsync conf/spark-env.sh\n</code></pre> 5.\u542f\u52a8spark\u96c6\u7fa4 Text Only<pre><code>sbin/start-all.sh\n</code></pre> 6.\u5355\u72ec\u5728hadoop103\u4e0a\u542f\u52a8Master\uff0c\u6210\u4e3a\u5907\u7528Master Text Only<pre><code>sbin/start-master.sh\n</code></pre> \u8bbf\u95eehadoop103\u7684Master\u7684webui Text Only<pre><code>http://hadoop103:8989/\n</code></pre> \u53ef\u4ee5\u770b\u5230\u72b6\u6001\u662fstandby  7.\u6b64\u65f6\u5728\u63d0\u4ea4\u5e94\u7528\u65f6\u6307\u5b9a\u4e24\u4e2aMaster\u7684\u5730\u5740\uff0c\u4e07\u4e00\u6709\u4e00\u4e2aMaster\u6302\u4e86\uff0c\u6b64\u6b21\u63d0\u4ea4\u4e5f\u4e0d\u4f1a\u5931\u8d25 Text Only<pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n`--master spark://hadoop102:7077,hadoop103:7077 \\`\n./examples/jars/spark-examples_2.12-3.0.0.jar \\\n10\n</code></pre> 8.\u6d4b\u8bd5\u9ad8\u53ef\u7528 \u5148\u6740\u6b7bhadoop102\u7684master Text Only<pre><code>kill -9 6652\n</code></pre> \u7136\u540e\u67e5\u770bhadoop103\u7684master\u7684\u72b6\u6001\uff0c\u53d1\u73b0\u53d8\u4e3aalive</p> <p>Yarn\u6a21\u5f0f Standalone\u6a21\u5f0f\u4f7f\u7528\u7684\u662fSpark\u81ea\u5e26\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\uff0c\u4e0espark-core\u4e0d\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\uff0cspark-core\u672c\u8eab\u53ea\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\uff0c\u4e0d\u6d89\u53ca\u8d44\u6e90\u8c03\u5ea6\uff0c\u4f7f\u7528spark-core\u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u88ab\u8d44\u6e90\u8c03\u5ea6\u5668\u5206\u6563\u5230\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u6267\u884c\u3002Yarn\u4f5c\u4e3a\u4e00\u6b3e\u8d44\u6e90\u8c03\u5ea6\u5668\uff0c\u4e5f\u53ef\u4ee5\u8c03\u5ea6Spark\u7a0b\u5e8f\u7684\u8fd0\u884c\u3002 1.\u89e3\u538b\u7f29Spark\u5e76\u91cd\u547d\u540d \u6ce8\u610f\u8fd9\u91cc\u4e0d\u9700\u8981\u5206\u53d1spark\uff0c\u56e0\u4e3a\u5c06spark\u8fd0\u884c\u5728yarn\u4e0a\uff0c\u5e76\u4e0d\u9700\u8981\u5176\u5b83\u4e3b\u673a\u4e5f\u914d\u7f6espark\u7684\u73af\u5883\u3002\u4e5f\u5c31\u662f\u5c06spark\u7a0b\u5e8f\u63d0\u4ea4yarn\u4e4b\u540e\uff0c\u5269\u4e0b\u7684\u5c06\u4efb\u52a1\u8c03\u5ea6\u7ed9\u5176\u5b83\u4e3b\u673a\u7684\u5de5\u4f5c\u662f\u7531yarn\u6765\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u6709\u4e00\u53f0\u4e3b\u673a\u4e0a\u6709spark\u7684\u73af\u5883\u5373\u53ef\uff0c\u8fd9\u53f0\u4e3b\u673a\u53ea\u662f\u7528\u4e8e\u63d0\u4ea4spark\u7a0b\u5e8f\u7ed9yarn\u3002 Text Only<pre><code>tar -zxvf /opt/software/spark-3.0.0-bin-hadoop3.2.tgz -C /opt/module/\n</code></pre> Text Only<pre><code>mv spark-3.0.0-bin-hadoop3.2/ spark-yarn\n</code></pre> 2. \u4fee\u6539 yarn \u7684\u914d\u7f6e\u6587\u4ef6/opt/module/hadoop-3.3.1/etc/hadoop/yarn-site.xml\uff08\u4e0d\u914d\u7f6e\u4e5f\u662f\u53ef\u4ee5\u7684\uff09\uff0c\u5e76\u5206\u53d1 Text Only<pre><code>&lt;!--\u662f\u5426\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u68c0\u67e5\u6bcf\u4e2a\u4efb\u52a1\u6b63\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u91cf\uff0c\u5982\u679c\u4efb\u52a1\u8d85\u51fa\u5206\u914d\u503c\uff0c\u5219\u76f4\u63a5\u5c06\u5176\u6740\u6389\uff0c\u9ed8\u8ba4\u662f true --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.nodemanager.pmem-check-enabled&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n&lt;!--\u662f\u5426\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u68c0\u67e5\u6bcf\u4e2a\u4efb\u52a1\u6b63\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u91cf\uff0c\u5982\u679c\u4efb\u52a1\u8d85\u51fa\u5206\u914d\u503c\uff0c\u5219\u76f4\u63a5\u5c06\u5176\u6740\u6389\uff0c\u9ed8\u8ba4\u662f true --&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> Text Only<pre><code>xsync\u00a0/opt/module/hadoop-3.3.1/etc/hadoop/yarn-site.xml\n</code></pre> 3. \u4fee\u6539 conf/spark-env.sh\uff0c\u6dfb\u52a0 JAVA_HOME \u548c YARN_CONF_DIR \u914d\u7f6e Text Only<pre><code>mv spark-env.sh.template spark-env.sh\n</code></pre> Text Only<pre><code>export JAVA_HOME=/opt/module/jdk1.8.0_301\nexport YARN_CONF_DIR=/opt/module/hadoop-3.3.1/etc/hadoop\n</code></pre> 4.\u542f\u52a8Yarn\u7684\u96c6\u7fa4 Text Only<pre><code>start-yarn.sh\n</code></pre> 5.\u63d0\u4ea4spark\u4efb\u52a1\u7ed9yarn client\u6a21\u5f0f\u548ccluster\u90e8\u7f72\u6a21\u5f0f\u6700\u76f4\u89c2\u7684\u533a\u522b\u5c31\u662f\uff1aclient\u6a21\u5f0f\u4f1a\u5c06\u7ed3\u679c\u6253\u5370\u5230\u63a7\u5236\u53f0\uff1b\u800ccluster\u90e8\u7f72\u6a21\u5f0f\u4e0d\u4f1a\u5c06\u7ed3\u679c\u6253\u5370\u5230\u63a7\u5236\u53f0\uff0c\u800c\u662f\u4f1a\u5c06\u8f93\u51fa\u8bb0\u5f55\u5230yarn\u5386\u53f2\u670d\u52a1\u5668\u7684\u65e5\u5fd7\u4e0a\u3002 \u4e24\u79cd\u6a21\u5f0f\u4e0b\u771f\u6b63\u505a\u8ba1\u7b97\u7684Executor\u90fd\u662f\u8fd0\u884c\u5728Yarn\u96c6\u7fa4\u4e0a\uff0c\u800c\u533a\u522b\u4ec5\u5728\u4e8eDriver\u8fd0\u884c\u5730\u65b9\uff0cclient\u6a21\u5f0f\u4e0bDriver\u8fd0\u884c\u5728\u63d0\u4ea4spark\u7a0b\u5e8f\u7684\u672c\u5730\u673a\u5668\u4e0a\uff0cDriver\u7684\u65e5\u5fd7\u548c\u8f93\u51fa\u7684\u7ed3\u679c\u90fd\u4f1a\u76f4\u63a5\u6253\u5370\u5230\u63a7\u5236\u53f0\u4e0a\u3002\u800ccluster\u90e8\u7f72\u6a21\u5f0f\u4e0bDriver \u8fd0\u884c\u5728 Yarn \u4e0a\uff0cDriver\u8f93\u51fa\u7684\u65e5\u5fd7\u4ee5\u53ca\u7ed3\u679c\u4f1a\u8f93\u51fa\u5230yarn\u7684\u5386\u53f2\u670d\u52a1\u5668\u65e5\u5fd7\u4e2d\u3002 Text Only<pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n`--master yarn \\`\n`--deploy-mode client \\`\n./examples/jars/spark-examples_2.12-3.0.0.jar \\\n10\n</code></pre> Text Only<pre><code>bin/spark-submit \\\n--class org.apache.spark.examples.SparkPi \\\n`--master yarn \\`\n`--deploy-mode cluster \\`\n./examples/jars/spark-examples_2.12-3.0.0.jar \\\n10\n</code></pre></p> <p>6. \u914d\u7f6e\u5386\u53f2\u670d\u52a1\u5668 \u4e0e\u524d\u9762\u914d\u7f6e\u5386\u53f2\u670d\u52a1\u5668\u6b65\u9aa4\u5dee\u4e0d\u591a\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u4e0d\u9700\u8981\u5206\u53d1\u914d\u7f6e\u3002 6.1 \u4fee\u6539 conf/spark-defaults.conf \u6587\u4ef6 Text Only<pre><code>mv spark-defaults.conf.template spark-defaults.conf\n</code></pre> \u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5f00\u542f\u65e5\u5fd7\uff0c\u5e76\u8bbe\u7f6e\u5c06\u65e5\u5fd7\u4fdd\u5b58\u5728HDFS\u4e0a Text Only<pre><code>spark.eventLog.enabled true\nspark.eventLog.dir hdfs://hadoop102:8020/spark-history\nspark.yarn.historyServer.address=hadoop102:18080\nspark.history.ui.port=18080\n</code></pre> \u6ce8\u610f\uff1a\u9700\u8981\u542f\u52a8 hadoop \u96c6\u7fa4\uff0c HDFS \u4e0a\u7684 /spark-history \u76ee\u5f55\u9700\u8981\u63d0\u524d\u5b58\u5728 Text Only<pre><code>\u5728hadoop\u7684\u76ee\u5f55\u4e0b\uff1asbin/start-dfs.sh\nhadoop fs -mkdir /spark-history\n</code></pre> 6.2 \u4fee\u6539 spark-env.sh \u6587\u4ef6, \u6dfb\u52a0\u65e5\u5fd7\u914d\u7f6e Text Only<pre><code>export SPARK_HISTORY_OPTS=\"\n-Dspark.history.ui.port=18080\n-Dspark.history.fs.logDirectory=hdfs://hadoop102:8020/spark-history\n-Dspark.history.retainedApplications=30\"\n</code></pre> 6.3 \u542f\u52a8Spark\u7684\u5386\u53f2\u670d\u52a1\uff0c\u5728Spark\u7684\u76ee\u5f55\u4e0b\uff1a Text Only<pre><code>sbin/start-history-server.sh\n</code></pre> 7.\u91cd\u65b0\u63d0\u4ea4\u4efb\u52a1\u5230yarn\uff0c\u67e5\u770b\u5386\u53f2\u670d\u52a1\u5668\u4e0a\u7684\u65e5\u5fd7</p> <p>\u4e09\u79cd\u90e8\u7f72\u6a21\u5f0f\u5bf9\u6bd4</p> \u90e8\u7f72\u6a21\u5f0f Spark\u5b89\u88c5\u673a\u5668\u6570 \u542f\u52a8\u7684\u8fdb\u7a0b Local 1 \u901a\u8fc7bin/spark-shell\u547d\u4ee4\u542f\u52a8\u7684SparkSubmit\u8fdb\u7a0b\uff0c\u9000\u51fa\u547d\u4ee4\u884cSparkSubmit\u8fdb\u7a0b\u5c31\u7ed3\u675f\u4e86 Standalone 3 1\u4e2a Master \u548c 3\u4e2a\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\u7684 Worker Yarn 1 1\u4e2a ResourceManager \u548c 3\u4e2a\u5206\u5e03\u5728\u4e0d\u540c\u673a\u5668\u4e0a\u7684 NodeManager <p>Spark\u5728Local\u6a21\u5f0f\u4e0b\u53ea\u9700\u8981\u542f\u52a8\u4e00\u4e2aJVM\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u6267\u884cSpark\u7a0b\u5e8f\uff0c\u867d\u7136\u4e0d\u662f\u4ee5\u5206\u5e03\u5f0f\u7684\u65b9\u5f0f\u5728\u8fd0\u884c\u7a0b\u5e8f\uff0c\u4f46\u662f\u53ef\u4ee5\u7528\u4e8e\u6d4b\u8bd5spark\u7a0b\u5e8f\u3002\u65e2\u7136Spark\u662f\u7528Scala\u5199\u7684\uff0c\u6240\u4ee5\u53ea\u8981\u6709JVM\u5c31\u80fd\u8fd0\u884cSpark\uff0c\u4e8e\u662f\u4e4e\u5b8c\u5168\u53ef\u4ee5\u5728Windows\u73af\u5883\u4e0b\u8fd0\u884cLocal\u6a21\u5f0f\uff0c\u4e0d\u8fc7\u8fd8\u662f\u9700\u8981Spark\u63d0\u4f9b\u4e00\u4e9b\u542f\u52a8\u811a\u672c\uff0c\u5f53\u7136Spark\u4e5f\u63d0\u4f9b\u4e86\u3002\u5176\u5b9e\u611f\u89c9\u5728IDEA\u91cc\u5199\u7684Spark\u7a0b\u5e8f\u548cLocal\u6a21\u5f0f\u7684Spark\u5dee\u4e0d\u591a\uff0c\u8bf4\u767d\u4e86Local\u6a21\u5f0f\u4e0b\u7684Spark\u53ea\u662f\u63d0\u4f9b\u4e86spark\u7a0b\u5e8f\u8fd0\u884c\u6240\u4f9d\u8d56\u7684\u5404\u79cdjar\u5305\uff0c\u800c\u5728IDEA\u4e2d\u5219\u662f\u7528Maven\u5b8c\u6210\u4e86\u4f9d\u8d56\u7684\u5f15\u5165\u3002</p> <p>\u6ce8\u610f\uff1a\u9700\u8981\u5c06Spark\u89e3\u538b\u90fd\u65e0\u7a7a\u683c\u7684\u76ee\u5f55</p> <p>\u7aef\u53e3\u53f7</p> <ul> <li>Spark \u67e5\u770b\u5f53\u524d Spark-shell \u8fd0\u884c\u4efb\u52a1\u60c5\u51b5\u7aef\u53e3\u53f7\uff1a 4040\uff08\u8ba1\u7b97\uff09</li> <li>Spark Master \u5185\u90e8\u901a\u4fe1\u670d\u52a1\u7aef\u53e3\u53f7\uff1a 7077</li> <li>Standalone \u6a21\u5f0f\u4e0b\uff0c Spark Master Web \u7aef\u53e3\u53f7\uff1a 8080\uff08\u8d44\u6e90\uff09</li> <li>Spark \u5386\u53f2\u670d\u52a1\u5668\u7aef\u53e3\u53f7\uff1a 18080</li> <li>Hadoop YARN \u4efb\u52a1\u8fd0\u884c\u60c5\u51b5\u67e5\u770b\u7aef\u53e3\u53f7\uff1a 8088</li> </ul>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/10-RDD%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90%20%E4%B9%8B%20Value%20%E7%B1%BB%E5%9E%8B%EF%BC%88%E7%BB%AD%EF%BC%89/","title":"10-RDD\u8f6c\u6362\u7b97\u5b50 \u4e4b Value \u7c7b\u578b\uff08\u7eed\uff09","text":"<p> \u7ea6 1177 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 24 \u5206\u949f</p> <p>7.filter\uff0c\u8fc7\u6ee4 \u5bf9\u5206\u533a\u5185\u7684\u6bcf\u4e00\u6761\u8fdb\u884c\u8fc7\u6ee4\uff0c\u5206\u533a\u6570\u4e0d\u4f1a\u6539\u53d8\uff0c\u4f46\u662f\u5206\u533a\u4e4b\u95f4\u53ef\u80fd\u4f1a\u51fa\u73b0\u6570\u636e\u503e\u659c\u3002 \u793a\u4f8b\uff1a\u53ea\u4fdd\u7559\u5076\u6570 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"filter\")\n\u00a0\u00a0 \u00a0val rdd: RDD[Int] = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)\n\u00a0\u00a0 \u00a0rdd.filter(_ % 2 == 0).collect.foreach(println)\n}\n</code></pre></p> <p>8.sample\uff0c\u62bd\u6837 \u4ece\u6570\u636e\u96c6\u4e2d\u62bd\u53d6\u6570\u636e \u51fd\u6570\u7b7e\u540d\u5982\u4e0b\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u6570\u636e\u88ab\u62bd\u5230\u540e\u662f\u5426\u653e\u56de\uff0c\u4e0d\u653e\u56de\u5c31\u662f\u4f2f\u52aa\u5229\u7b97\u6cd5\uff0c\u653e\u56de\u5c31\u662f\u6cca\u677e\u7b97\u6cd5\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u5c0f\u6570\uff0c\u8303\u56f4\u5728[0, 1]\u4e4b\u95f4\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684\u53d6\u503c\u4e0d\u540c\uff0c\u8be5\u6570\u7684\u542b\u4e49\u5c31\u4e0d\u540c\uff1b\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u968f\u673a\u6570\u79cd\u5b50\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5c31\u662f\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\u3002 \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3afalse\u5c31\u662f\u4f2f\u52aa\u5229\u7b97\u6cd5\uff0c\u62bd\u6837\u7684\u8fc7\u7a0b\u662f\uff0c\u9996\u5148\u6839\u636e\u968f\u673a\u6570\u79cd\u5b50\u751f\u6210\u4e00\u8fde\u4e32\u7684\u968f\u673a\u6570\uff0cRDD\u4e2d\u6bcf\u4e00\u6761\u6570\u636e\u90fd\u4f1a\u5bf9\u5e94\u5230\u76f8\u5e94\u7684\u968f\u673a\u6570\u4e0a\uff0c\u5f53\u6570\u636e\u5bf9\u5e94\u7684\u968f\u673a\u6570\u5927\u4e8e\u7b2c\u4e8c\u53c2\u6570\u65f6\uff0c\u8be5\u6570\u636e\u5c31\u4f1a\u88ab\u9009\u53d6\u3002\u4e5f\u5c31\u662f\u8bf4\u5f53\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f0\u65f6\u8868\u793a\u5168\u4e0d\u53d6\uff0c\u662f1\u65f6\u8868\u793a\u5168\u53d6\u3002 \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3atrue\u65f6\u5c31\u662f\u6cca\u677e\u7b97\u6cd5\uff0c\u6b64\u65f6\u7b2c\u4e8c\u53c2\u6570\u8868\u793a\u662f\u5565\u6211\u4e5f\u4e0d\u77e5\u9053\u3002 \u53cd\u6b63\u5c31\u662f\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3atrue\u65f6\u5c31\u8868\u793a\u53ef\u4ee5\u91cd\u590d\u62bd\u53d6\u6570\u636e\uff0c\u4e3afalse\u5c31\u662f\u4e0d\u4f1a\u91cd\u590d\u62bd\u53d6\u6570\u636e\u3002 Text Only<pre><code>def sample(\n\u00a0 \u00a0withReplacement: Boolean,\n\u00a0 \u00a0fraction: Double,\n\u00a0 \u00a0seed: Long = Utils.random.nextLong): RDD[T]\n</code></pre></p> <p>9.distinct\uff0c\u53bb\u91cd Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 val sc = new SparkContext(\"local[*]\", \"distinct\")\n\u00a0 val rdd = sc.makeRDD(List(1, 2, 3, 4, 1, 2, 3, 4), 3)\n\u00a0\u00a0rdd.distinct.foreach(println)\n}\n</code></pre> Scala\u96c6\u5408\u7684distinct\u65b9\u6cd5\u53bb\u91cd\u7684\u539f\u7406\u662f\u628a\u5143\u7d20\u6dfb\u52a0\u5230HashSet\u4e2d\uff0c\u800cRDD\u7684distinct\u7b97\u5b50\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f Text Only<pre><code>map(x =&gt; (x, null)).reduceByKey((x, _) =&gt; x, numPartitions).map(_._1)\n</code></pre> \u9996\u5148\u4f1a\u628a\u6bcf\u4e00\u4e2a\u5143\u7d20\u6620\u5c04\u6210(x,null)\uff0c\u7136\u540ereduceByKey\uff0c\u6240\u6709\u76f8\u540c\u7684(x,null)\u53d8\u6210\u4e00\u4e2a(x,null)\uff0c\u6700\u540e\u6620\u5c04\u53ea\u53d6\u5143\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd9\u6837\u505a\u662f\u4e3a\u5206\u5e03\u5f0f\u8ba1\u7b97\u3002</p> <p>10.coalesce\uff0c\u5408\u5e76\u5206\u533a \u5982\u679c\u5206\u533a\u6570\u8fc7\u591a\uff0c\u5c31\u4f1a\u5b58\u5728\u8fc7\u591a\u7684\u5c0f\u4efb\u52a1\uff0c\u8fd9\u53cd\u800c\u4f1a\u7a0b\u5e8f\u7684\u6027\u80fd\u964d\u4f4e\uff0c\u56e0\u4e3a\u589e\u52a0\u4e86\u8c03\u5ea6\u548c\u901a\u4fe1\u7684\u6210\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7 coalesce \u65b9\u6cd5\uff0c\u6536\u7f29\u5408\u5e76\u5206\u533a\uff0c\u51cf\u5c11\u5206\u533a\u7684\u4e2a\u6570\u3002 \u793a\u4f8b\uff1a\u9996\u5148\u4e09\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u5206\u522b\u662f\u30101, 2, 3\u3011\u3001\u3010 4, 5, 6\u3011\u3001\u30107, 8, 9\u3011\uff0c\u7136\u540e\u5408\u5e76\u6210\u4e24\u4e2a\u5206\u533a\u7684\u7ed3\u679c\u662f\u30101, 2, 3\u3011\u3001\u30104, 5, 6, 7, 8, 9\u3011\uff0c\u53ef\u89c1coalesce \u65b9\u6cd5\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\u65f6\u53ea\u4f1a\u8fdb\u884c\u7b80\u5355\u7684\u5206\u533a\u5408\u5e76\uff0c\u5e76\u4e0d\u4f1a\u91cd\u65b0\u5747\u5300\u7684\u5206\u914d\u6570\u636e\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 val sc = new SparkContext(\"local[*]\", \"coalesce\")\n\u00a0 val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)\n `val rddCoalesce: RDD[Int] = rdd.coalesce(2)`\n\u00a0 rddCoalesce.saveAsTextFile(\"output\")\n\u00a0 sc.stop()\n}\n</code></pre> \u91cd\u65b0\u5747\u5300\u7684\u4e3a\u6bcf\u4e2a\u5206\u533a\u5206\u914d\u6570\u636e\u7684\u8fc7\u7a0b\u79f0\u4e3aShuffle\uff0ccoalesce \u65b9\u6cd5\u7684\u7b2c\u4e8c\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u662f\u5426\u8981\u8fdb\u884cShuffle\u3002\u8fd9\u6837\u5408\u5e76\u6210\u4e24\u4e2a\u5206\u533a\u7684\u7ed3\u679c\u5c31\u662f\u5c06\u6570\u636e\u968f\u673a\u5747\u5300\u7684\u5206\u914d\u5230\u6bcf\u4e2a\u5206\u533a\uff0c\u5982\u7ed3\u679c\u53ef\u80fd\u662f\u8fd9\u6837\u7684\uff1a\u30101, 3, 5, 7, 9\u3011\u3001\u30102, 4, 6, 8\u3011 Text Only<pre><code>rdd.coalesce(2, true)\n</code></pre></p> <p>coalesce\u4e0d\u4ec5\u53ef\u4ee5\u5408\u5e76\u5206\u533a\uff0c\u8fd8\u53ef\u4ee5\u589e\u52a0\u5206\u533a\uff0c\u56e0\u4e3a\u589e\u52a0\u5206\u533a\u6570\u636e\u5fc5\u987b\u8981\u88ab\u6253\u4e71\uff0c\u6240\u4ee5\u5f53\u60f3\u4f7f\u7528coalesce\u589e\u52a0\u5206\u533a\u65f6\uff0c\u7b2c\u4e8c\u53c2\u6570\u5fc5\u987b\u8bbe\u7f6e\u4e3atrue\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"coalesce\")\n\u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 2)\n\u00a0`rdd.coalesce(3, shuffle = true).saveAsTextFile(\"output\")`\n\u00a0sc.stop()\n}\n</code></pre></p> <p>11.repartition \u8fd8\u53ef\u4ee5\u4f7f\u7528repartition\u6765\u5408\u5e76\u6216\u8005\u589e\u52a0\u5206\u533a\uff0crepartition\u5176\u5b9e\u8c03\u7528\u7684\u5c31\u662f coalesce\uff0c\u9ed8\u8ba4shuffle=true Text Only<pre><code>def repartition(numPartitions: Int)(implicit ord: Ordering[T] = null): RDD[T] = withScope {\n\u00a0coalesce(numPartitions, shuffle = true)\n}\n</code></pre></p> <p>12.sortBy\uff0c\u6392\u5e8f sortBy\u53ef\u4ee5\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u9ed8\u8ba4\u6392\u5e8f\u524d\u540e\u5206\u533a\u6570\u4e0d\u4f1a\u6539\u53d8\uff0csortBy\u4f1a\u628a\u6392\u597d\u5e8f\u7684\u6570\u636e\u5e73\u5747\u5206\u6563\u5728\u6bcf\u4e2a\u5206\u533a\u4e2d\uff0c\u6240\u4ee5\u6570\u636e\u5c31\u4f1a\u5f62\u6210\u5206\u533a\u5185\u6709\u5e8f\u548c\u5168\u5c40\u6709\u5e8f\u7684\u6548\u679c\u3002\u56e0\u4e3a\u8fd9\u4e2d\u95f4\u5b58\u5728\u5bf9\u5206\u533a\u95f4\u6570\u636e\u7684\u8c03\u6574\uff0c\u6240\u4ee5sortBy\u662f\u6709Shuffle\u7684\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"sortBy\")\n\u00a0val rdd = sc.makeRDD(List(1, 5, 2, 3, 4, 6, 8, 7), 2)\n\u00a0rdd.sortBy(num =&gt; num).saveAsTextFile(\"output\")\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u53ef\u89c1\u5206\u533a\u5185\u6570\u636e\u6709\u5e8f Text Only<pre><code>\u6587\u4ef61\uff1a\n1 2 3 4\n\u6587\u4ef62\uff1a\n5 6 7 8\n</code></pre> \u5982\u679c\u4e0d\u628a\u5206\u533a\u6570\u636e\u4fdd\u5b58\u5728\u6587\u4ef6\uff0c\u800c\u662f\u76f4\u63a5\u8f93\u51fa\uff0c\u90a3\u4e48\u8f93\u51fa\u7ed3\u679c\u662f1 2 3 4 5 6 7 8\uff0c\u53ef\u89c1\u5168\u5c40\u4e5f\u662f\u6709\u5e8f\u7684\u3002 sortBy\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u9ed8\u8ba4\u4e3atrue\uff0c\u8868\u793a\u5347\u5e8f\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e3afalse\uff0c\u8868\u793a\u964d\u5e8f\u3002sortBy\u7b2c\u4e09\u4e2a\u53c2\u6570\u8fd8\u53ef\u6307\u5b9a\u6392\u5e8f\u540e\u5206\u533a\u7684\u6570\u91cf\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"sortBy\")\n\u00a0val rdd = sc.makeRDD(List(1, 5, 2, 3, 4, 6, 8, 7), 2)\n\u00a0rdd.sortBy(num =&gt; num, ascending = false, 4).saveAsTextFile(\"output\")\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/11-RDD%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90%20%E4%B9%8B%20%E5%8F%8Cvalue%E7%B1%BB%E5%9E%8B/","title":"11-RDD\u8f6c\u6362\u7b97\u5b50 \u4e4b \u53ccvalue\u7c7b\u578b","text":"<p> \u7ea6 788 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u53ccvalue\u7c7b\u578b\uff0c\u5373\u5bf9\u4e24\u4e2a\u6570\u636e\u6e90\u6570\u636e\u7684\u64cd\u4f5c Text Only<pre><code>val sc = new SparkContext(\"local[*]\", \"zip\")\nval rdd1 = sc.makeRDD(List(1,2,3,4))\nval rdd2 = sc.makeRDD(List(3,4,5,6))\n</code></pre></p> <p>1.\u4ea4\u96c6\uff0cintersection Text Only<pre><code>// \u4ea4\u96c6 : \u30103\uff0c4\u3011\nval rdd3: RDD[Int] = rdd1.intersection(rdd2)\nprintln(rdd3.collect().mkString(\",\"))\n</code></pre></p> <p>2.\u5e76\u96c6\uff0cunion Text Only<pre><code>// \u5e76\u96c6 : \u30101\uff0c2\uff0c3\uff0c4\uff0c3\uff0c4\uff0c5\uff0c6\u3011\nval rdd4: RDD[Int] = rdd1.union(rdd2)\nprintln(rdd4.collect().mkString(\",\"))\n</code></pre></p> <p>3.\u5dee\u96c6\uff0csubtract Text Only<pre><code>// \u5dee\u96c6 : \u30101\uff0c2\u3011\nval rdd5: RDD[Int] = rdd1.subtract(rdd2)\nprintln(rdd5.collect().mkString(\",\"))\n</code></pre></p> <p>4.\u62c9\u94fe\uff0czip Text Only<pre><code>// \u62c9\u94fe : \u3010(1,3),(2,4),(3,5),(4,6)\u3011\uff0c\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u5143\u7ec4\u7684\u96c6\u5408\nval rdd6: RDD[(Int, Int)] = rdd1.zip(rdd2)\nprintln(rdd6.collect().mkString(\",\"))\n</code></pre> \u62c9\u94fe\u6709\u4e24\u70b9\u9700\u8981\u6ce8\u610f\uff1a 1.\u8981\u6c42\u4e24\u4e2a\u6570\u636e\u6e90\u5206\u533a\u6570\u91cf\u8981\u4fdd\u6301\u4e00\u81f4 2.\u8981\u6c42\u4e24\u4e2a\u6570\u636e\u6e90\u5404\u4e2a\u5206\u533a\u4e2d\u6570\u636e\u91cf\u8981\u4fdd\u6301\u4e00\u81f4</p> <p>\u53e6\u5916\u8fd8\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u4ea4\u96c6\uff0c\u5e76\u96c6\u548c\u5dee\u96c6\u8981\u6c42\u4e24\u4e2a\u6570\u636e\u6e90\u6570\u636e\u7c7b\u578b\u4fdd\u6301\u4e00\u81f4\uff0c\u62c9\u94fe\u64cd\u4f5c\u4e24\u4e2a\u6570\u636e\u6e90\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u4e00\u81f4</p> <p>\u4ee5\u4e0b3\u4e2a\u7b97\u5b50\u5373\u662f\u53ccvalue\u7c7b\u578b\u7684\u7b97\u5b50\uff0c\u4e5f\u662fkey-value\u7c7b\u578b\u7684\u7b97\u5b50\uff0c\u5373\u5747\u662f\u5bf9\u4e24\u4e2akv\u7c7b\u578b\u7684\u6570\u636e\u6e90\u7684\u64cd\u4f5c\u3002 5.join \u5728\u7c7b\u578b\u4e3a(K,V)\u548c(K,W)\u7684 RDD \u4e0a\u8c03\u7528\uff0c\u8fd4\u56de\u4e00\u4e2a\u76f8\u540c key \u5bf9\u5e94\u7684\u6240\u6709\u5143\u7d20\u8fde\u63a5\u5728\u4e00\u8d77\u7684 (K,(V,W)) \u7684 RDD\u3002\u6ce8\u610f\u4e00\u70b9\u5c31\u662f\u4e24\u6570\u636e\u6e90\u7684value\u7684\u7c7b\u578b\u53ef\u4ee5\u4e0d\u540c\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"combineByKey\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"c\", 3), (\"f\", 3)))\n\u00a0\u00a0val rdd2 = sc.makeRDD(List((\"a\", 5), (\"c\", 6), (\"a\", 4)))\n\u00a0\u00a0val joinRDD: RDD[(String, (Int, Int))] = rdd1.join(rdd2)\n\u00a0\u00a0joinRDD.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>(a,(1,5))\n(a,(1,4))\n(a,(2,5))\n(a,(2,4))\n(c,(3,6))\n</code></pre> \u53ef\u89c1\uff1a</p> <ol> <li>\u4e24\u4e2a\u4e0d\u540c\u6570\u636e\u6e90\u4e2d\u76f8\u540c\u7684key\u7684value\u4f1a\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e8c\u5143\u7ec4</li> <li>\u5982\u679c\u4e24\u4e2a\u6570\u636e\u6e90\u4e2dkey\u6ca1\u6709\u5339\u914d\u4e0a\uff0c\u90a3\u4e48\u6570\u636e\u4e0d\u4f1a\u51fa\u73b0\u5728\u7ed3\u679c\u4e2d</li> <li>\u5982\u679c\u4e24\u4e2a\u6570\u636e\u6e90\u4e2d\u6709\u591a\u4e2a\u76f8\u540c\u7684key\uff0c\u4f1a\u4f9d\u6b21\u5339\u914d</li> </ol> <p>6. leftOuterJoin \u548c rightOuterJoin leftOuterJoin\u8f93\u51fa\u7684value\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662fOption\u7c7b\u578b Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"combineByKey\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3)))\n\u00a0\u00a0val rdd2 = sc.makeRDD(List((\"a\", 4), (\"b\", 5)))\n\u00a0\u00a0val leftOuterJoinRDD: RDD[(String, (Int, Option[Int]))] = rdd1.leftOuterJoin(rdd2)\n\u00a0\u00a0leftOuterJoinRDD.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(a,(1,Some(4)))\n(b,(2,Some(5)))\n(c,(3,None))\n</code></pre></p> <p>\u800crightOuterJoin\u8f93\u51fa\u7684value\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662fOption\u7c7b\u578b Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"combineByKey\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2)))\n\u00a0\u00a0val rdd2 = sc.makeRDD(List((\"a\", 4), (\"b\", 5), (\"c\", 6)))\n\u00a0\u00a0val rightOuterJoinRDD: RDD[(String, (Option[Int], Int))] = rdd1.rightOuterJoin(rdd2)\n\u00a0\u00a0rightOuterJoinRDD.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(a,(Some(1),4))\n(b,(Some(2),5))\n(c,(None,6))\n</code></pre></p> <p>7. cogroup cogroup\u53ef\u4ee5\u64cd\u4f5c\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684kv\u7c7b\u578b\u6570\u636e\u6e90\uff0c\u5176\u529f\u80fd\u662f\uff0c\u5148\u5bf9\u6bcf\u4e2a\u6570\u636e\u6e90\u7684\u6570\u636e\u6839\u636ekey\u5206\u7ec4\uff0c\u7136\u540e\u518d\u8fde\u63a5\u6240\u6709\u6570\u636e\u6e90\u7684\u6570\u636e Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"cogroup\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"b\", 3) ))\n\u00a0\u00a0val rdd2 = sc.makeRDD(List((\"a\", 4), (\"b\", 5), (\"c\", 6)))\n\u00a0\u00a0val rdd3 = sc.makeRDD(List((\"c\", 4), (\"d\", 5), (\"d\", 6)))\n\u00a0\u00a0val cogroupRDD: RDD[(String, (Iterable[Int], Iterable[Int], Iterable[Int]))] = rdd1.cogroup(rdd2,rdd3)\n\u00a0\u00a0cogroupRDD.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0cvalue\u662f\u4e00\u4e2a\u4e09\u5143\u7ec4\uff0c\u56e0\u4e3a\u67093\u4e2a\u6570\u636e\u6e90\uff0c\u4e09\u5143\u7ec4\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u662f\u5bf9\u5e94\u6570\u636e\u6e90\u4e2dkey\u5bf9\u5e94\u7684value\u7684\u96c6\u5408\u3002 Text Only<pre><code>(a,(CompactBuffer(1, 2),CompactBuffer(4),CompactBuffer()))\n(b,(CompactBuffer(3),CompactBuffer(5),CompactBuffer()))\n(c,(CompactBuffer(),CompactBuffer(6),CompactBuffer(4)))\n(d,(CompactBuffer(),CompactBuffer(),CompactBuffer(5, 6)))\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/12-RDD%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90%20%E4%B9%8B%20Key-Value%20%E7%B1%BB%E5%9E%8B/","title":"12-RDD\u8f6c\u6362\u7b97\u5b50 \u4e4b Key-Value \u7c7b\u578b","text":"<p> \u7ea6 3189 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 64 \u5206\u949f</p> <p>Key-Value \u7c7b\u578b\uff0c\u53ea\u80fd\u5bf9\u5143\u7d20\u662f\u4e8c\u5143\u7ec4\u7684\u6570\u636e\u6e90\u8fdb\u884c\u64cd\u4f5c</p> <p>1.partitionBy \u5c06\u6570\u636e\u6309\u7167\u6307\u5b9a Partitioner \u91cd\u65b0\u8fdb\u884c\u5206\u533a\uff0c\u6ce8\u610f\uff1a</p> <ol> <li>\u5206\u533a\u5668\u76f4\u63a5\u51b3\u5b9a\u4e86\u5206\u533a\u7684\u4e2a\u6570 \u4ee5\u53ca \u6bcf\u6761\u6570\u636e\u7ecf\u8fc7 Shuffle \u540e\u8fdb\u5165\u54ea\u4e2a\u5206\u533a\u3002</li> <li>\u53ea\u6709 Key-Value \u7c7b\u578b\u7684 RDD \u624d\u6709\u5206\u533a\u5668\uff0c\u975e Key-Value \u7c7b\u578b\u7684 RDD \u5206\u533a\u7684\u503c\u662f None\u3002</li> <li>\u6bcf\u4e2a RDD \u7684\u5206\u533a ID \u8303\u56f4\uff1a 0 ~ (numPartitions - 1)\u3002</li> </ol> <p>Spark \u9ed8\u8ba4\u7684\u5206\u533a\u5668\u662f HashPartitioner\uff0c\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff0c\u5148\u8ba1\u7b97key\u7684hashCode\uff0c\u7136\u540e\u9664\u4ee5\u5206\u533a\u4e2a\u6570\u540e\u53d6\u4f59 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"partitionBy\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List((1, \"1\"), (2, \"2\"), (3, \"3\"), (4, \"4\")))\n `rdd.partitionBy(new HashPartitioner(2))`\n\u00a0 \u00a0\u00a0\u00a0 \u00a0.saveAsTextFile(\"output\")\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>\u6587\u4ef61\uff1a\n(2,2)\n(4,4)\n\u6587\u4ef62\uff1a\n(1,1)\n(3,3)\n</code></pre> \u6ce8\u610f\uff1a 1.\u5982\u679c\u4f7f\u7528\u76f8\u540c\u7684\u5206\u533a\u5668\u5bf9\u6570\u636e\u518d\u6b21\u5206\u533a\uff0c\u5e76\u4e14\u5206\u533a\u6570\u91cf\u4e0e\u4e4b\u524d\u8fd8\u76f8\u7b49\uff0c\u90a3\u4e48partitionBy\u5c06\u4e0d\u4f1a\u505a\u4efb\u4f55\u64cd\u4f5c\u3002 2. Spark \u4e0d\u5149\u53ea\u6709HashPartitioner\uff0c\u8fd8\u6709\u4e00\u4e2aRangePartitioner 3.\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5206\u533a\u5668</p> <p>\u81ea\u5b9a\u4e49\u5206\u533a\u5668 1. \u7ee7\u627fPartitioner Text Only<pre><code>class MyPartitioner extends Partitioner {\n\u00a0\u00a0// \u5206\u533a\u6570\u91cf\n\u00a0\u00a0override def numPartitions: Int = 3\n\u00a0\u00a0// \u6839\u636e\u6570\u636e\u7684key\u503c\u8fd4\u56de\u6570\u636e\u6240\u5728\u7684\u5206\u533a\u7d22\u5f15\uff08\u4ece0\u5f00\u59cb\uff09\n\u00a0\u00a0override def getPartition(key: Any): Int = {\n\u00a0\u00a0\u00a0\u00a0key match {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"a\" =&gt; 0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case \"b\" =&gt; 1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case _ =&gt; 2\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n}\n</code></pre> 2.\u5728partitionBy\u4e2d\u4f7f\u7528 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3), (\"d\", 4)), 1)\n\u00a0\u00a0 `\u00a0rdd.partitionBy(new MyPartitioner)`.saveAsTextFile(\"output\")\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre></p> <p>2.reduceByKey \u76f8\u540ckey\u7684\u6570\u636e\u8fdb\u884cvalue\u7684\u4e24\u4e24\u805a\u5408\uff0c Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"partitionBy\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"a\", 4), (\"b\", 5)), 2)\n\u00a0\u00a0 \u00a0val reduceByKeyRDD: RDD[(String, Int)] = rdd.reduceByKey((x: Int, y: Int) =&gt; {\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; ${x}+${y}=${x + y}\")\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0x + y\n\u00a0\u00a0 \u00a0})\n\u00a0\u00a0 \u00a0reduceByKeyRDD.collect().foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u5982\u679c\u76f8\u540ckey\u7684\u6570\u636e\u53ea\u67091\u4e2a\uff0c\u90a3\u4e48\u5b83\u662f\u4e0d\u4f1a\u8d70reduceByKey\u7684\uff0c\u5e76\u4e14reduceByKey\u4f1a\u5148\u5728\u5206\u533a\u5185\u505a\u805a\u5408\uff08\u9884\u805a\u5408\uff09\uff0c\u7136\u540e\u5728\u5206\u533a\u95f4\u505a\u805a\u5408 Text Only<pre><code>78 : Executor task launch worker for task 1 &gt;&gt; 3+4=7\n77 : Executor task launch worker for task 0 &gt;&gt; 1+2=3\n78 : Executor task launch worker for task 3 &gt;&gt; 3+7=10\n(b,5)\n(a,10)\n</code></pre></p> <p>3.groupByKey \u6309key\u8fdb\u884c\u5206\u7ec4\u5f62\u6210\u4e00\u4e2a\u4e8c\u5143\u7ec4\u7684\u96c6\u5408\uff0c\u5176\u4e2d\u4e8c\u5143\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u5c31\u662fkey\uff0c\u4e8c\u5143\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u76f8\u540ckey\u7684\u6570\u636e\u7684value\u5f62\u6210\u7684\u4e00\u4e2a\u96c6\u5408\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"groupByKey\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"b\", 4)))\n\u00a0\u00a0 \u00a0val groupByKeyRDD: RDD[(String, Iterable[Int])] = rdd.groupByKey()\n\u00a0\u00a0 \u00a0groupByKeyRDD.collect.foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(a,CompactBuffer(1, 2, 3))\n(b,CompactBuffer(4))\n</code></pre> \u5982\u679c\u662fgroupBy\u5219\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"groupByKey\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"b\", 4)))\n\u00a0\u00a0 \u00a0val groupByRDD: RDD[(String, Iterable[(String, Int)])] = rdd.groupBy(_._1)\n\u00a0\u00a0 \u00a0groupByRDD.collect.foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(a,CompactBuffer((a,1), (a,2), (a,3)))\n(b,CompactBuffer((b,4)))\n</code></pre> \u6240\u4ee5\uff0cgroupByKey\u548cgroupBy\u6709\u4e24\u70b9\u4e0d\u540c\uff1a 1.groupByKey\u4e0d\u9700\u8981\u6307\u5b9a\u5982\u4f55\u5206\u7ec4\uff0cgroupByKey\u662f\u5bf9k-v\u7c7b\u578b\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u9ed8\u8ba4\u5c31\u662f\u6309key\u5206\u7ec4\uff1b\u800c groupBy\u5fc5\u987b\u6307\u5b9a\u5206\u7ec4\u7684\u89c4\u5219\u3002 2. groupByKey\u4f1a\u5c06value\u5c01\u88c5\u6210\u96c6\u5408\uff0c\u800c groupBy\u662f\u76f4\u63a5\u5c06\u539f\u6765\u7684\u5143\u7d20\u5c01\u88c5\u6210\u96c6\u5408\u3002</p> <p>reduceByKey \u548c groupByKey \u7684\u533a\u522b\uff1f \u4ece shuffle \u7684\u89d2\u5ea6\uff1a reduceByKey \u548c groupByKey \u90fd\u5b58\u5728 shuffle \u7684\u64cd\u4f5c\uff0c\u4f46\u662f reduceByKey\u53ef\u4ee5\u5728 shuffle \u524d\u5bf9\u540c\u4e00\u5206\u533a\u5185\u76f8\u540c key \u7684\u6570\u636e\u8fdb\u884c\u9884\u805a\u5408\uff08combine\uff09\u529f\u80fd\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u843d\u76d8\u7684\u6570\u636e\u91cf\uff0c\u800c groupByKey \u53ea\u662f\u8fdb\u884c\u5206\u7ec4\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u91cf\u7684\u51cf\u5c11\uff0c\u4e5f\u5c31\u4e0d\u5b58\u5728\u9884\u805a\u5408\uff0c\u6240\u4ee5reduceByKey \u6027\u80fd\u6bd4\u8f83\u9ad8\u3002 \u4ece\u529f\u80fd\u7684\u89d2\u5ea6\uff1a reduceByKey \u5176\u5b9e\u5305\u542b\u5206\u7ec4\u548c\u805a\u5408\u7684\u529f\u80fd\u3002 GroupByKey \u53ea\u80fd\u5206\u7ec4\uff0c\u4e0d\u80fd\u805a\u5408\uff0c\u6240\u4ee5\u5728\u5206\u7ec4\u805a\u5408\u7684\u573a\u5408\u4e0b\uff0c\u63a8\u8350\u4f7f\u7528reduceByKey\uff1b\u5982\u679c\u4ec5\u4ec5\u662f\u5206\u7ec4\u800c\u4e0d\u9700\u8981\u805a\u5408\uff0c\u90a3\u4e48\u53ea\u80fd\u4f7f\u7528 groupByKey\u3002</p> <p>4. aggregateByKey reduceBykey\u5728\u5bf9\u5206\u533a\u95f4\u6570\u636e\u8fdb\u884c\u805a\u5408\u4e4b\u524d\u4f1a\u5148\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u9884\u805a\u5408\uff0c\u4e24\u6b21\u805a\u5408\u64cd\u4f5c\u7684\u8ba1\u7b97\u903b\u8f91\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002aggregateByKey\u4e5f\u6709\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u7684\u4e24\u6b21\u805a\u5408\u64cd\u4f5c\uff0c\u4f46\u4e24\u6b21\u805a\u5408\u7684\u8ba1\u7b97\u903b\u8f91\u53ef\u4ee5\u5206\u522b\u6307\u5b9a\u3002 aggregateByKey\u662f\u67ef\u91cc\u5316\u51fd\u6570\uff0c\u6709\u4e24\u4e2a\u53c2\u6570\u5217\u8868\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u5217\u8868\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u521d\u59cb\u503c\uff0c\u7528\u4e8e\u5f53\u78b0\u89c1\u7b2c\u4e00\u4e2akey\u7684\u65f6\u5019\uff0c\u548cvalue\u8fdb\u884c\u5206\u533a\u5185\u8ba1\u7b97\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5217\u8868\u9700\u8981\u4f20\u90122\u4e2a\u533f\u540d\u51fd\u6570\uff0c\u7b2c\u4e00\u4e2a\u533f\u540d\u51fd\u6570\u662f\u5206\u533a\u5185\u8ba1\u7b97\u89c4\u5219\uff0c\u7b2c\u4e8c\u4e2a\u533f\u540d\u51fd\u6570\u662f\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u3002 Text Only<pre><code>def aggregateByKey[U: ClassTag](zeroValue: U)(seqOp: (U, V) =&gt; U, combOp: (U, U) =&gt; U): RDD[(K, U)]\n</code></pre> \u793a\u4f8b\uff1a\u53d6\u5206\u533a\u5185\u76f8\u540ckey\u7684value\u7684\u6700\u5927\u503c\u540e\uff0c\u5c06\u5206\u533a\u95f4\u76f8\u540ckey\u7684value\u76f8\u52a0 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"aggregateByKey\")\n\u00a0\u00a0 \u00a0val rdd: RDD[(String, Int)] = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"a\", 4), (\"b\", 5), (\"b\", 6)), 2)\n\u00a0\u00a0 \u00a0//\u9996\u5148\u4e24\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u5206\u522b\u662f\uff1a\u3010(\"a\", 1), (\"a\", 2), (\"a\", 3)\u3011\u3001\u3010(\"a\", 4), (\"b\", 5), (\"b\", 6)\u3011\n\u00a0\u00a0 \u00a0//\u7136\u540eaggregateByKey\u5148\u5206\u533a\u5185groupByKey\uff1a\u3010(\"a\", (1, 2, 3))\u3011\u3001\u3010(\"a\", 4), (\"b\", (5, 6))\u3011\n\u00a0\u00a0 \u00a0//\u63a5\u7740\u5206\u533a\u5185\u805a\u5408Math.max\uff1a\u3010(\"a\", 3)\u3011\u3001\u3010(\"a\", 4), (\"b\", 6)\u3011\uff0c\u8ba1\u7b97\u8fc7\u7a0b\u662f\u90fd\u662f\u5148\u75280\u4e0e\u7b2c\u4e00\u4e2a\u6570\u6bd4\u8f83\u53d6\u5927\u503c\uff0c\u7136\u540e\u5faa\u73af\u6bd4\u8f83\u53d6\u5927\u503c\n\u00a0\u00a0 \u00a0//\u63a5\u7740\u5206\u533a\u95f4groupByKey\uff1a\u3010(\"a\", (3, 4))\u3011\u3001\u3010(\"b\", 6)\u3011\n\u00a0\u00a0 \u00a0//\u6700\u540e\u5206\u533a\u95f4\u805a\u5408_ + _\uff1a\u3010(\"a\", 7)\u3011\u3001\u3010(\"b\", 6)\u3011\n `val aggRDD: RDD[(String, Int)] = rdd.aggregateByKey(zeroValue = 0)(Math.max, _ + _)`\n\u00a0\u00a0 \u00a0aggRDD.collect.foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u4eceaggregateByKey\u51fd\u6570\u7684\u7b7e\u540d\u53ef\u4ee5\u5230\uff0c\u5206\u533a\u5185\u7684\u8ba1\u7b97\u89c4\u5219seqOp: (U, V) =&gt; U\uff0czeroValue\u7684\u7c7b\u578b\u53ef\u4ee5\u548c\u539f\u672c\u6570\u636e\u7684value\u7684\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0c\u4f46\u662f\u8fd4\u56de\u503c\u7684\u7c7b\u578b\u5fc5\u987b\u548czeroValue\u7c7b\u578b\u4e00\u81f4\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5206\u533a\u95f4\u7684\u8ba1\u7b97combOp: (U, U) =&gt; U\uff0c\u8f93\u5165\u80af\u5b9a\u662f\u5206\u533a\u5185\u8ba1\u7b97\u7ed3\u679c\u7684\u8fd4\u56de\u503c\uff0c\u6240\u4ee5\u7c7b\u578b\u662fU\uff0c\u4e0d\u8fc7\u8fd4\u56de\u503c\u4e5f\u5fc5\u987b\u662fU\u3002 \u6848\u4f8b\uff1a\u8ba1\u7b97\u76f8\u540cKey\u7684\u6570\u636e\u7684value\u7684\u5e73\u5747\u503c \u4f7f\u7528groupByKey\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"aggregateByKey\")\n\u00a0\u00a0 \u00a0//\u4e24\u4e2a\u5206\u533a\uff1a\u3010(\"a\", 1), (\"a\", 2), (\"b\", 3)\u3011\u3001\u3010(\"b\", 4), (\"b\", 5), (\"a\", 6)\u3011\n\u00a0\u00a0 \u00a0val rdd: RDD[(String, Int)] = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"b\", 3), (\"b\", 4), (\"b\", 5), (\"a\", 6)), 2)\n `rdd.groupByKey().mapValues(c`ollection =&gt; {\n\u00a0\u00a0 \u00a0\u00a0 \u00a0\u00a0collection.sum / collection.size\n\u00a0\u00a0 \u00a0}).collect.foreach(println)\n\u00a0\u00a0 \u00a0\u00a0sc.stop()\n}\n</code></pre> \u5982\u679c\u4e0d\u4f7f\u7528groupByKey+mapValues\u7684\u7ec4\u5408\uff0c\u800c\u662f\u4f7f\u7528aggregateByKey\u5206\u4e24\u6b21\u805a\u5408\u540c\u6837\u4e5f\u80fd\u5f97\u5230\u7ed3\u679c\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"aggregateByKey\")\n\u00a0\u00a0 \u00a0//\u4e24\u4e2a\u5206\u533a\uff1a\u3010(\"a\", 1), (\"a\", 2), (\"b\", 3)\u3011\u3001\u3010(\"b\", 4), (\"b\", 5), (\"a\", 6)\u3011\n\u00a0\u00a0 \u00a0val rdd: RDD[(String, Int)] = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"b\", 3), (\"b\", 4), (\"b\", 5), (\"a\", 6)), 2)\n\u00a0\u00a0 \u00a0//\u600e\u4e48\u60f3\uff1a\u8ba1\u7b97\u7684\u65f6\u5019\u90fd\u662f\u5728\u548cvalue\u8fdb\u884c\u8ba1\u7b97\uff0c\u4e0d\u8fc7\u662f\u9488\u5bf9\u76f8\u540c\u7684key\n\u00a0\u00a0 \u00a0//zeroValue\u662f\u4e00\u4e2a\u5143\u7ec4(Int,Int)\uff0c\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u539f\u6570\u636e\u4e2d\u76f8\u540ckey\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u76f8\u540ckey\u7684value\u7684\u7d2f\u52a0\n `val aggRDD: RDD[(String, (Int, Int))] = rdd.aggregateByKey(zeroValue = (0, 0))((t, v) =&gt; {`\n `(t._1 + 1, t._2 + v)`\n `}, (t1, t2) =&gt; {`\n `(t1._1 + t2._1, t1._2 + t2._2)`\n `})`\n\u00a0\u00a0 \u00a0aggRDD.mapValues(t =&gt; t._2 / t._1).collect.foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> <code>\u6240\u4ee5\u5982\u679c\u80fd\u7528aggregateByKey\u4ee3\u66ffgroupByKey+mapValues\u5f97\u5230\u7ed3\u679c\uff0c\u8981\u5c3d\u91cf\u7528aggregateByKey\uff0c\u56e0\u4e3a\u4f1a\u9884\u805a\u5408\uff0c\u6240\u4ee5\u6548\u7387\u66f4\u9ad8\u3002reduceByKey\u3001 foldByKey\u3001 aggregateByKey\u3001 combineByKey\u539f\u7406\u662f\u4e00\u6837\u7684\uff0c\u90fd\u4f1a\u9884\u805a\u5408\uff0c\u53ea\u4e0d\u8fc7\u4f7f\u7528\u4e0a\u6709\u70b9\u5dee\u522b\uff0c\u6240\u4ee5\u80fd\u7528\u8fd9\u56db\u4e2a\u805a\u5408\u7b97\u5b50\u4ee3\u66ffgroupByKey+mapValues\u7684\u5730\u65b9\uff0c\u8981\u5c3d\u91cf\u7528\u805a\u5408\u7b97\u5b50\u3002</code></p> <p>5.combineByKey \u4eceaggregateByKey\u7b2c\u4e8c\u4e2a\u6848\u4f8b\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u805a\u5408\u7684\u7ed3\u679c\u7684value\u4e0e\u539f\u672c\u6570\u636e\u7684value\u7684\u7c7b\u578b\u4e0d\u4e00\u81f4\u7684\u65f6\uff0c\u5c31\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u4e0e\u6700\u7ec8\u7ed3\u679c\u6570\u636e\u7c7b\u578b\u4e00\u81f4\u7684zeroValue\u4f5c\u4e3a\u805a\u5408\u7684\u8d77\u59cb\u503c\uff0c\u800ccombineByKey\u53ef\u4ee5\u4e0d\u7528\u8f6c\u5165zeroValue\uff0c\u800c\u662f\u5728\u5206\u533a\u5185\u805a\u5408\u65f6\u5148\u5bf9\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684value\u505a\u4e00\u6b21\u8f6c\u6362\uff0c\u4ee5\u540e\u5728\u8fd9\u4e2a\u8f6c\u6362\u540e\u7684\u503c\u7684\u57fa\u7840\u4e4b\u4e0a\u505a\u8ba1\u7b97\u3002 combineByKey\u65b9\u6cd5\u7684\u4e09\u4e2a\u53c2\u6570\u5206\u522b\u662f\uff1a \u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\uff1a\u5206\u533a\u5185\u76f8\u540ckey\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684value\u7684\u8f6c\u6362\u89c4\u5219 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\uff1a\u5206\u533a\u5185\u7684\u8ba1\u7b97\u89c4\u5219 \u7b2c\u4e09\u4e2a\u53c2\u6570\u8868\u793a\uff1a\u5206\u533a\u95f4\u7684\u8ba1\u7b97\u89c4\u5219 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a\u7b2c\u4e8c\u53c2\u6570\u662f\u4ee5\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684\u7ed3\u679c\u4f5c\u4e3a\u8d77\u59cb\u503c\u8fdb\u884c\u8ba1\u7b97\uff0c\u6240\u4ee5\u7b2c\u4e8c\u53c2\u6570\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u4e0d\u80fd\u901a\u8fc7\u5f62\u53c2\u63a8\u65ad\uff0c\u5fc5\u987b\u660e\u786e\u7ed9\u51fa\uff0c\u540c\u6837\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u7684\u533f\u540d\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u548c\u7b2c\u4e00\u4e2a\u53c2\u6570\u7684\u7ed3\u679c\u7684\u7c7b\u578b\u662f\u4e00\u81f4\u7684\uff0c\u4e0d\u80fd\u901a\u8fc7\u5f62\u53c2\u7684\u7c7b\u578b\u63a8\u65ad\u5f97\u5230\uff0c\u4e5f\u5fc5\u987b\u660e\u786e\u6307\u51fa\u3002 \u6848\u4f8b\uff1a\u8ba1\u7b97\u76f8\u540cKey\u7684\u6570\u636e\u7684value\u7684\u5e73\u5747\u503c Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"combineByKey\")\n\u00a0\u00a0 \u00a0//\u4e24\u4e2a\u5206\u533a\uff1a\u3010(\"a\", 1), (\"a\", 2), (\"b\", 3)\u3011\u3001\u3010(\"b\", 4), (\"b\", 5), (\"a\", 6)\u3011\n\u00a0\u00a0 \u00a0val rdd: RDD[(String, Int)] = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"b\", 3), (\"b\", 4), (\"b\", 5), (\"a\", 6)), 2)\n\u00a0\u00a0 \u00a0val combineByKeyRDD = rdd.combineByKey(\n\u00a0\u00a0 \u00a0v =&gt; (v, 1),\n\u00a0\u00a0 \u00a0(t: (Int, Int), v) =&gt; {\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0(t._1 + v, t._2 + 1)\n\u00a0\u00a0 \u00a0},\n\u00a0\u00a0 \u00a0(t1: (Int, Int), t2: (Int, Int)) =&gt; {\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0(t1._1 + t2._1, t1._2 + t2._2)\n\u00a0\u00a0 \u00a0}\n\u00a0\u00a0 \u00a0)\n\u00a0\u00a0 \u00a0combineByKeyRDD.mapValues(kv =&gt; kv._1 / kv._2).foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre></p> <p>6. foldByKey \u5982\u679caggregateByKey\u7684\u4e24\u6b21\u805a\u5408\u64cd\u4f5c\u5b8c\u5168\u76f8\u540c\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528foldByKey\uff0cfoldByKey\u4e5f\u53ef\u4ee5\u770b\u4f5c\u662f\u5e26zeroValue\u7684reduceByKey\u3002 \u4e0d\u50cfaggregateByKey\u7684zeroValue\u7684\u7c7b\u578b\u53ef\u4ee5\u548c\u539f\u672c\u6570\u636e\u7684value\u7684\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cfoldByKey\u7684zeroValue\u7684\u7c7b\u578b\u5fc5\u987b\u548c\u539f\u672c\u6570\u636e\u7684value\u7684\u7c7b\u578b\u4e00\u81f4\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"partitionBy\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"a\", 4), (\"b\", 5)), 2)\n\u00a0\u00a0 \u00a0val foldByKeyRDD = rdd.foldByKey(0)((x: Int, y: Int) =&gt; {\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; ${x}+${y}=${x + y}\")\n\u00a0\u00a0 \u00a0\u00a0\u00a0 \u00a0x + y\n\u00a0\u00a0 \u00a0})\n\u00a0\u00a0 \u00a0foldByKeyRDD.collect.foreach(println)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u540c\u6837\u53ef\u4ee5\u770b\u51fa\u5148\u5206\u533a\u5185\u805a\u5408\u518d\u5206\u533a\u95f4\u805a\u5408 Text Only<pre><code>77 : Executor task launch worker for task 0 &gt;&gt; 0+1=1\n78 : Executor task launch worker for task 1 &gt;&gt; 0+3=3\n77 : Executor task launch worker for task 0 &gt;&gt; 1+2=3\n78 : Executor task launch worker for task 1 &gt;&gt; 3+4=7\n78 : Executor task launch worker for task 1 &gt;&gt; 0+5=5\n77 : Executor task launch worker for task 3 &gt;&gt; 3+7=10\n(b,5)\n(a,10)\n</code></pre></p> <p>reduceByKey\u3001 foldByKey\u3001 aggregateByKey\u3001 combineByKey \u7684\u533a\u522b\uff1f \u901a\u8fc7\u67e5\u9605\u6e90\u7801\u53d1\u73b0\u8fd9\u56db\u4e2a\u805a\u5408\u65b9\u6cd5\u5e95\u5c42\u90fd\u662f\u8c03\u7528\u7684combineByKeyWithClassTag\u65b9\u6cd5\uff0c\u53ea\u662f\u4f20\u9012\u7684\u53c2\u6570\u4e0d\u540c\u3002 Text Only<pre><code>reduceByKey:\ncombineByKeyWithClassTag[V](\n\u00a0\u00a0 \u00a0(v: V) =&gt; v, // \u7b2c\u4e00\u4e2a\u503c\u4e0d\u4f1a\u53c2\u4e0e\u8ba1\u7b97\n\u00a0\u00a0 \u00a0func, // \u5206\u533a\u5185\u8ba1\u7b97\u89c4\u5219\n\u00a0\u00a0 \u00a0func, // \u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\n)\n\naggregateByKey :\ncombineByKeyWithClassTag[U](\n\u00a0\u00a0 \u00a0(v: V) =&gt; cleanedSeqOp(createZero(), v), // \u521d\u59cb\u503c\u548c\u7b2c\u4e00\u4e2akey\u7684value\u503c\u8fdb\u884c\u7684\u5206\u533a\u5185\u6570\u636e\u64cd\u4f5c\n\u00a0\u00a0 \u00a0cleanedSeqOp, // \u5206\u533a\u5185\u8ba1\u7b97\u89c4\u5219\n\u00a0\u00a0 \u00a0combOp, \u00a0 \u00a0 \u00a0 // \u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\n)\n\nfoldByKey:\ncombineByKeyWithClassTag[V](\n\u00a0\u00a0 \u00a0(v: V) =&gt; cleanedFunc(createZero(), v), // \u521d\u59cb\u503c\u548c\u7b2c\u4e00\u4e2akey\u7684value\u503c\u8fdb\u884c\u7684\u5206\u533a\u5185\u6570\u636e\u64cd\u4f5c\n\u00a0\u00a0 \u00a0cleanedFunc, \u00a0// \u5206\u533a\u5185\u8ba1\u7b97\u89c4\u5219\n\u00a0\u00a0 \u00a0cleanedFunc, \u00a0// \u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\n)\n\ncombineByKey :\ncombineByKeyWithClassTag(\n\u00a0\u00a0 \u00a0createCombiner, \u00a0// \u76f8\u540ckey\u7684\u7b2c\u4e00\u6761\u6570\u636e\u8fdb\u884c\u7684\u5904\u7406\u51fd\u6570\n\u00a0\u00a0 \u00a0mergeValue, \u00a0 \u00a0 \u00a0// \u5206\u533a\u5185\u8ba1\u7b97\u89c4\u5219\n\u00a0\u00a0 \u00a0mergeCombiners, \u00a0// \u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\n)\n</code></pre> \u603b\u7ed3\uff1a reduceByKey\uff1a\u76f8\u540c key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u7684value\u4e0d\u8fdb\u884c\u4efb\u4f55\u8ba1\u7b97\uff0c\u7136\u540e\u7528\u6b64value\u4e0e\u540e\u9762\u76f8\u540ckey\u7684value\u505a\u805a\u5408\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u76f8\u540c FoldByKey\uff1a\u76f8\u540c key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u7684value\u548c\u521d\u59cb\u503c\u8fdb\u884c\u5206\u533a\u5185\u8ba1\u7b97\uff0c\u7136\u540e\u4ee5\u7528\u8ba1\u7b97\u7ed3\u679c\u4e0e\u540e\u9762\u76f8\u540ckey\u7684value\u505a\u805a\u5408\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u76f8\u540c AggregateByKey\uff1a\u76f8\u540c key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u7684value\u548c\u521d\u59cb\u503c\u8fdb\u884c\u5206\u533a\u5185\u8ba1\u7b97\uff0c\u7136\u540e\u4ee5\u7528\u8ba1\u7b97\u7ed3\u679c\u4e0e\u540e\u9762\u76f8\u540ckey\u7684value\u505a\u805a\u5408\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u53ef\u4ee5\u4e0d\u76f8\u540c CombineByKey\uff1a\u53ef\u4ee5\u5bf9\u76f8\u540c key \u7684\u7b2c\u4e00\u4e2a\u6570\u636e\u7684value\u505a\u4e00\u6b21\u8f6c\u6362\uff0c\u7136\u540e\u4ee5\u7528\u8f6c\u6362\u4e0e\u540e\u9762\u76f8\u540ckey\u7684value\u505a\u805a\u5408\uff0c\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u8ba1\u7b97\u89c4\u5219\u53ef\u4ee5\u4e0d\u76f8\u540c</p> <p>7. sortByKey \u6309key\u8fdb\u884c\u6392\u5e8f\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u662f\u5426\u5347\u5e8f\uff0c\u9ed8\u8ba4\u5347\u5e8f\uff0cfalse\u4e3a\u964d\u5e8f\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"sortByKey\")\n\u00a0\u00a0 \u00a0val rdd: RDD[(String, Int)] = sc.makeRDD(List((\"b\", 6), (\"b\", 5), (\"a\", 3), (\"a\", 1), (\"a\", 4), (\"a\", 2)), 2)\n\u00a0\u00a0 \u00a0val sortByKeyRDD: RDD[(String, Int)] = rdd.sortByKey(ascending = false)\n\u00a0\u00a0 \u00a0sortByKeyRDD.collect.foreach(println)\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(b,6)\n(b,5)\n(a,3)\n(a,1)\n(a,4)\n(a,2)\n</code></pre> \u5982\u679c\u662f\u81ea\u5b9a\u4e49\u7c7b\u578b\uff0c\u5219key\u5fc5\u987b\u5b9e\u73b0Ordered\u7279\u8d28 Text Only<pre><code>class User(val name: String, val age: Int) extends Serializable with Ordered[User] {\n\u00a0\u00a0override def compare(that: User): Int = age - that.age\n\u00a0\u00a0override def toString = s\"User(name=$name, age=$age)\"\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"sortByKey\")\n\u00a0\u00a0val rdd: RDD[(User, Int)] = sc.makeRDD(List(\n\u00a0\u00a0\u00a0\u00a0(new User(\"zs\", 20), 2),\n\u00a0\u00a0\u00a0\u00a0(new User(\"li\", 21), 5),\n\u00a0\u00a0\u00a0\u00a0(new User(\"ww\", 22), 1),\n\u00a0\u00a0\u00a0\u00a0(new User(\"zl\", 19), 6)\n\u00a0\u00a0), 2)\n\u00a0\u00a0rdd.sortByKey().collect.foreach(println)\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(User(name=zl, age=19),6)\n(User(name=zs, age=20),2)\n(User(name=li, age=21),5)\n(User(name=ww, age=22),1)\n</code></pre></p> <p>\u6848\u4f8b\uff1a \u7edf\u8ba1\u51fa\u6bcf\u4e00\u4e2a\u7701\u4efd\u6bcf\u4e2a\u5e7f\u544a\u88ab\u70b9\u51fb\u6570\u91cf\u6392\u884c\u7684 Top3 \u6570\u636e\u683c\u5f0f\uff1a\u65f6\u95f4\u6233\u3001\u7701\u4efd\u3001\u57ce\u5e02\u3001\u7528\u6237\u3001\u5e7f\u544a\uff0c\u4e2d\u95f4\u5b57\u6bb5\u4f7f\u7528\u7a7a\u683c\u5206\u9694\u3002 \u7b2c5\u30016\u6b65\u7684group+mapValues\u5b9e\u73b0\u7684\u662f\u5206\u7ec4\u5185\u6392\u5e8f\u53d6\u524d3\u7684\u64cd\u4f5c\uff0c\u4e0d\u80fd\u4f7f\u7528aggregateByKey\u7b49\u805a\u5408\u51fd\u6570\u6765\u5b9e\u73b0\u76f8\u540c\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u4e0d\u80fd\u7528\u90a34\u4e2a\u805a\u5408\u7b97\u5b50\u6765\u4ee3\u66ff\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"case\")\n\u00a0\u00a0// 1. \u83b7\u53d6\u539f\u59cb\u6570\u636e\uff1a\u65f6\u95f4\u6233\uff0c\u7701\u4efd\uff0c\u57ce\u5e02\uff0c\u7528\u6237\uff0c\u5e7f\u544a\n\u00a0\u00a0val rdd: RDD[String] = sc.textFile(\"data/agent.log\")\n\u00a0\u00a0// 2. \u8f6c\u6362\u539f\u59cb\u6570\u636e\u7684\u7ed3\u6784\uff0c\u65b9\u4fbf\u7edf\u8ba1\n\u00a0\u00a0//\u00a0\u00a0\u00a0\u00a0\u65f6\u95f4\u6233\uff0c\u7701\u4efd\uff0c\u57ce\u5e02\uff0c\u7528\u6237\uff0c\u5e7f\u544a\n\u00a0\u00a0//\u00a0\u00a0\u00a0\u00a0=&gt;\n\u00a0\u00a0//\u00a0\u00a0\u00a0\u00a0((\u7701\u4efd, \u5e7f\u544a), 1)\n\u00a0\u00a0rdd.map(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\" \")\n\u00a0\u00a0\u00a0\u00a0((cols(1), cols(4)), 1)\n\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0// 3. \u5c06\u8f6c\u6362\u7ed3\u6784\u540e\u7684\u6570\u636e\u5206\u7ec4\u805a\u5408\n\u00a0\u00a0\u00a0\u00a0//\u00a0\u00a0\u00a0((\u7701\u4efd, \u5e7f\u544a), 1) =&gt; ((\u7701\u4efd, \u5e7f\u544a), sum)\n\u00a0\u00a0\u00a0\u00a0.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0// 4. \u8f6c\u6362\u805a\u5408\u7ed3\u679c\u7684\u7ed3\u6784\n\u00a0\u00a0\u00a0\u00a0//\u00a0\u00a0\u00a0((\u7701\u4efd, \u5e7f\u544a), sum) =&gt; (\u7701\u4efd, (\u5e7f\u544a, sum))\n\u00a0\u00a0\u00a0\u00a0.map(kv =&gt; (kv._1._1, (kv._1._2, kv._2)))\n\u00a0\u00a0\u00a0\u00a0// 5. \u5c06\u8f6c\u6362\u7ed3\u6784\u540e\u7684\u6570\u636e\u6839\u636e\u7701\u4efd\u8fdb\u884c\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0//\u00a0\u00a0\u00a0(\u7701\u4efd, [(\u5e7f\u544aA, sumA), (\u5e7f\u544aB, sumB)])\n\u00a0\u00a0\u00a0\u00a0.groupByKey\n\u00a0\u00a0\u00a0\u00a0// 6. \u5c06\u5206\u7ec4\u540e\u7684\u6570\u636e\u7ec4\u5185\u6392\u5e8f\uff08\u964d\u5e8f\uff09\uff0c\u53d6\u524d3\u540d\n\u00a0\u00a0\u00a0\u00a0.mapValues(_.toList.sortBy(_._2)(Ordering.Int.reverse).take(3))\n\u00a0\u00a0\u00a0\u00a0// 7. \u91c7\u96c6\u6570\u636e\u6253\u5370\u5728\u63a7\u5236\u53f0\n\u00a0\u00a0\u00a0\u00a0.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/13-RDD%E8%A1%8C%E5%8A%A8%E7%AE%97%E5%AD%90/","title":"13-RDD\u884c\u52a8\u7b97\u5b50","text":"<p> \u7ea6 1435 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 29 \u5206\u949f</p> <p>\u884c\u52a8(action)\u7b97\u5b50\u662f\u89e6\u53d1\u4f5c\u4e1a(Job)\u6267\u884c\u7684\u65b9\u6cd5\uff0c\u5e95\u5c42\u4ee3\u7801\u8c03\u7528\u7684\u662f\u73af\u5883\u5bf9\u8c61sc\u7684runJob\u65b9\u6cd5\uff0c\u4f1a\u521b\u5efaActiveJob\uff0c\u63d0\u4ea4\u5e76\u6267\u884c\u3002\u884c\u52a8\u7b97\u5b50\u4e0d\u4f1a\u51fa\u73b0\u5728DAG\u56fe\u4e0a\uff0c\u53ea\u6709\u8f6c\u6362\u7b97\u5b50\u624d\u4f1a\u51fa\u73b0\u5728DAG\u56fe\u4e0a\uff0c\u6240\u4ee5\u53ea\u6709\u8f6c\u6362\u7b97\u5b50\u624d\u4f1a\u88ab\u5212\u5206\u6210\u9636\u6bb5\u5c01\u88c5\u6210task\u88ab\u6267\u884c\u3002</p> <p>Text Only<pre><code>val sc = new SparkContext(\"local[*]\", \"sortByKey\")\nval rdd = sc.makeRDD(List(1, 2, 3, 4))\n</code></pre> 1.reduce reduce\u662f\u5bf9\u5168\u90e8\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u800creduceByKey\u53ea\u662f\u5bf9key-value\u7c7b\u578b\u6570\u636e\u4e2d\u76f8\u540ckey\u7684\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u5e76\u4e14 reduce\u662f\u884c\u52a8\u7b97\u5b50\uff0c\u4f1a\u76f4\u63a5\u5f97\u5230\u7ed3\u679c\uff0c\u800creduceByKey\u53ea\u662f\u4e00\u4e2a\u8f6c\u6362\u7b97\u5b50\u3002 Text Only<pre><code>val i: Int = rdd.reduce(_ + _)\nprintln(i)\u00a0 //10\n</code></pre></p> <p>2.collect \u65b9\u6cd5\u4f1a\u5c06\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\u6309\u7167\u5206\u533a\u987a\u5e8f\u91c7\u96c6\u5230Driver\u7aef\u5185\u5b58\u4e2d\uff0c\u5f62\u6210\u6570\u7ec4 Text Only<pre><code>val arr1: Array[Int] = rdd.collect\nprintln(arr1.mkString(\",\")) //1,2,3,4\n</code></pre></p> <p>3.count \u6570\u636e\u6e90\u4e2d\u6570\u636e\u7684\u4e2a\u6570 Text Only<pre><code>val count: Long = rdd.count\nprintln(count)\u00a0 //4\n</code></pre></p> <p>4.first \u83b7\u53d6\u6570\u636e\u6e90\u4e2d\u6570\u636e\u7684\u7b2c\u4e00\u4e2a Text Only<pre><code>val first: Int = rdd.first\nprintln(first)\u00a0 //1\n</code></pre></p> <p>5.take \u83b7\u53d6N\u4e2a\u6570\u636e Text Only<pre><code>val arr2: Array[Int] = rdd.take(3)\nprintln(arr2.mkString(\",\"))\u00a0 //1,2,3\n</code></pre></p> <p>6.takeOrdered \u6570\u636e\u6392\u5e8f\u540e\uff0c\u53d6N\u4e2a\u6570\u636e Text Only<pre><code>val arr3: Array[Int] = rdd.takeOrdered(3)(Ordering.Int.reverse)\nprintln(arr3.mkString(\",\"))\u00a0 //4,3,2\n</code></pre></p> <p>7.aggregate \u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662fzeroValue\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5206\u533a\u5185\u7684\u805a\u5408\u89c4\u5219\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u5206\u533a\u95f4\u7684\u805a\u5408\u89c4\u5219\u3002 aggregate\u4e0eaggregateByKey\u6709\u70b9\u4e0d\u540c\uff1aaggregateByKey\u7684\u521d\u59cb\u503czeroValue\u53ea\u4f1a\u53c2\u4e0e\u5206\u533a\u5185\u8ba1\u7b97\uff0c\u800caggregate\u7684\u521d\u59cb\u503czeroValue\u4e0d\u4ec5\u4f1a\u53c2\u4e0e\u5206\u533a\u5185\u8ba1\u7b97\uff0c\u5e76\u4e14\u8fd8\u4f1a\u53c2\u4e0e\u5206\u533a\u95f4\u7684\u8ba1\u7b97\u3002\u5982\u4e0b\u9762\u7684\u7ed3\u679c\u662f40\uff0c\u800c\u4e0d\u662f30\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"sortByKey\")\n\u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4), 2)\n\u00a0val result = rdd.aggregate(10)(_ + _, _ + _)\n\u00a0println(result)\u00a0 //40\n}\n</code></pre></p> <p>8.fold \u5982\u679caggregate\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u7684\u8ba1\u7b97\u89c4\u5219\u76f8\u540c\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528fold\u7b80\u5316\u8c03\u7528\uff0c\u4f46\u662faggregate\u548cfold\u8fd8\u6709\u70b9\u533a\u522b\uff1aaggregate\u7684zeroValue\u4e0d\u9700\u8981\u4e0e\u6570\u636e\u6e90\u7684\u6570\u636e\u7c7b\u578b\u4fdd\u6301\u4e00\u81f4\uff0c\u800cfold\u9700\u8981\u4e0e\u6570\u636e\u6e90\u7684\u6570\u636e\u7c7b\u578b\u4fdd\u6301\u4e00\u81f4\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"sortByKey\")\n\u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4), 2)\n\u00a0val result = rdd.fold(10)(_ + _)\n\u00a0println(result)\u00a0 //40\n}\n</code></pre></p> <p>9.countByValue \u7edf\u8ba1\u6240\u6709\u6570\u636e\u4e2d\u7684\u6bcf\u4e2a\u6570\u636e\u51fa\u73b0\u4e86\u51e0\u6b21 \u5e76\u4e0d\u9700\u8981\u6570\u636e\u6e90\u7684\u6570\u636e\u662fkey-value\u7c7b\u578b Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"count\")\n\u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4, 4, 4), 2)\n\u00a0val cnt: collection.Map[Int, Long] = rdd.countByValue()\n\u00a0println(cnt) //Map(4 -&gt; 3, 2 -&gt; 1, 1 -&gt; 1, 3 -&gt; 1)\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"count\")\n\u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"b\", 4)))\n\u00a0val cnt: collection.Map[(String, Int), Long] = rdd.countByValue()\n\u00a0println(cnt)\u00a0 //Map((a,3) -&gt; 1, (a,2) -&gt; 1, (a,1) -&gt; 1, (b,4) -&gt; 1)\n}\n</code></pre></p> <p>10. countByKey \u7edf\u8ba1key-value\u7c7b\u578b\u6570\u636e\u6e90\u6bcf\u4e2akey\u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u6240\u4ee5\u6b64\u65b9\u6cd5\u9700\u8981\u6570\u636e\u6e90\u7684\u6570\u636e\u662fkey-value\u7c7b\u578b Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"count\")\n\u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3), (\"b\", 4)))\n\u00a0val cnt: collection.Map[String, Long] = rdd.countByKey()\n\u00a0println(cnt)\u00a0 //Map(a -&gt; 3, b -&gt; 1)\n}\n</code></pre></p> <p>11. save \u76f8\u5173\u7b97\u5b50 saveAsTextFile\u5c06\u6570\u636e\u4fdd\u5b58\u6210 Text \u6587\u4ef6\uff0c\u5982\u679c\u662f\u81ea\u5b9a\u4e49\u5bf9\u8c61\uff0c\u5219\u5c06toString\u7684\u7ed3\u679c\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\uff1b\u76f8\u5e94\u5730\uff0c\u4f7f\u7528textFile\u7b97\u5b50\u53ef\u4ee5\u4eceText\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0ctextFile\u7b97\u5b50\u662f\u4ee5\u884c\u4e3a\u5355\u4f4d\u8bfb\u53d6\u6570\u636e\u7684\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"saveAsTextFile\")\n\u00a0\u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3)), 1)\n\u00a0\u00a0`rdd.saveAsTextFile(\"output1\")`\n\u00a0\u00a0sc.stop()\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"saveAsTextFile\")\n\u00a0\u00a0`val rdd: RDD[String] = sc.textFile(\"output1\")`\n\u00a0\u00a0rdd.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\u7684\u7ed3\u679c\uff1a Text Only<pre><code>\u6587\u4ef6\u4e2d\uff1a\n(a,1)\n(a,2)\n(a,3)\n\u63a7\u5236\u53f0\u6253\u5370\uff1a\n(a,1)\n(a,2)\n(a,3)\n</code></pre></p> <p>saveAsObjectFile\u5c06\u5bf9\u8c61\u5e8f\u5217\u5316\u540e\u4fdd\u5b58\u5230\u6587\u4ef6\uff0c \u91c7\u7528\u7684\u662f Java \u7684\u5e8f\u5217\u5316\u673a\u5236\uff0c\u6240\u4ee5\u5982\u679c\u662f\u81ea\u5b9a\u4e49\u5bf9\u8c61\u9700\u8981\u6df7\u5165Serializable\u7279\u8d28\uff1b\u76f8\u5e94\u5730\uff0c\u53ef\u4ee5\u4f7f\u7528 objectFile\u7b97\u5b50\u4eceObject\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"saveAsTextFile\")\n\u00a0\u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3)), 1)\n\u00a0 `rdd.saveAsObjectFile(\"output2\")`\n\u00a0\u00a0sc.stop()\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"saveAsTextFile\")\n `val rdd: RDD[(String, Int)] = sc.objectFile[(String, Int)](\"output2\")`\n\u00a0\u00a0rdd.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre></p> <p>saveAsSequenceFile\u53ea\u80fd\u5c06K-V\u7c7b\u578b\u6570\u636e\u4fdd\u5b58\u6210 SequenceFile\u6587\u4ef6\uff0cSequenceFile\u6587\u4ef6\u91c7\u7528\u7684\u662fHadoop\u7684\u5e8f\u5217\u5316\u673a\u5236\uff0c\u6240\u4ee5\u5982\u679c\u662f\u81ea\u5b9a\u4e49\u5bf9\u8c61\u90a3\u4e48\u9700\u8981\u6df7\u5165Writable\u7279\u8d28\uff1b\u76f8\u5e94\u7684\u53ef\u4ee5\u4f7f\u7528 sequenceFile\u7b97\u5b50\u5728 SequenceFile\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"saveAsTextFile\")\n\u00a0\u00a0val rdd = sc.makeRDD(List((\"a\", 1), (\"a\", 2), (\"a\", 3)), 1)\n\u00a0 `rdd.saveAsSequenceFile(\"output3\")`\n\u00a0\u00a0sc.stop()\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"saveAsTextFile\")\n\u00a0 `val rdd: RDD[(String, Int)] = sc.sequenceFile[String, Int](\"output3\")`\n\u00a0\u00a0rdd.collect.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre></p> <p>12. foreach \u4e0d\u540c\u4e8eScala\u96c6\u5408\u7684foreach\u65b9\u6cd5\uff0c\u8fd9\u91ccforeach\u662fRDD\u7684\u884c\u52a8\u7b97\u5b50\uff0c\u4f1a\u88ab\u5c01\u88c5\u8fdbtask\uff0c\u7136\u540e\u5728\u6bcf\u4e2aExecutor\u7aef\u4e2d\u6267\u884c\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e2a\u904d\u5386\u96c6\u5408\u7684\u64cd\u4f5c\u4f1a\u5728\u6240\u6709\u7684Executor\u4e2d\u5e76\u884c\u6267\u884c\u3002 \u5982\u679c\u4e0d\u662f\u672c\u5730\u6a21\u5f0f\uff0c\u90a3\u4e48rdd.foreach(println)\u4f1a\u5728\u4e0d\u540c\u4e3b\u673a\u4e0a\u6253\u5370\uff0c\u5982\u679c\u662f\u672c\u5730\u6a21\u5f0f\uff0c\u90a3\u4e48\u5c31\u4f1a\u7531\u591a\u4e2a\u7ebf\u7a0b\u5c06\u6570\u636e\u5e76\u53d1\u5199\u5230\u6807\u51c6\u8f93\u51fa\u4e0a\u3002\u800crdd.collect().foreach(println)\u5219\u662f\u7531collect\u7b97\u5b50\u5148\u4f1a\u5c06\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\u6309\u7167\u5206\u533a\u987a\u5e8f\u91c7\u96c6\u5230Driver\u7aef\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u901a\u8fc7Scala\u96c6\u5408\u7684foreach\u65b9\u6cd5\u904d\u5386\u8f93\u51fa\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"count\")\n\u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4))\n\u00a0// collect\u65b9\u6cd5\u4f1a\u5c06\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\u6309\u7167\u5206\u533a\u987a\u5e8f\u91c7\u96c6\u5230Driver\u7aef\u5185\u5b58\u4e2d\n\u00a0// \u6240\u4ee5\u8fd9\u91cc\u7684foreach\u65b9\u6cd5\u5e76\u4e0d\u662fRDD\u64cd\u4f5c\uff0c\u53ea\u662f\u5728Driver\u7aef\u5185\u5b58\u904d\u5386\u96c6\u5408\n\u00a0rdd.collect().foreach(v =&gt; {\n\u00a0 \u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $v\")\n\u00a0})\n\u00a0println(\"******************\")\n\u00a0// \u8fd9\u4e2aforeach\u662fRDD\u7684\u884c\u52a8\u7b97\u5b50\uff0c\u4f1a\u88ab\u5c01\u88c5\u8fdbtask\uff0c\u7136\u540e\u5728\u6bcf\u4e2aExecutor\u7aef\u4e2d\u6267\u884c\uff0c\n\u00a0// \u4e5f\u5c31\u662f\u8fd9\u4e2a\u904d\u5386\u96c6\u5408\u7684\u64cd\u4f5c\u4f1a\u5728\u6240\u6709\u7684Executor\u4e2d\u5e76\u884c\u6267\u884c\n\u00a0rdd.foreach(v =&gt; {\n\u00a0 \u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $v\")\n\u00a0})\n\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>1 : main &gt;&gt; 1\n1 : main &gt;&gt; 2\n1 : main &gt;&gt; 3\n1 : main &gt;&gt; 4\n******************\n87 : Executor task launch worker for task 31 &gt;&gt; 4\n86 : Executor task launch worker for task 19 &gt;&gt; 1\n77 : Executor task launch worker for task 23 &gt;&gt; 2\n89 : Executor task launch worker for task 27 &gt;&gt; 3\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/14-%E9%97%AD%E5%8C%85%E4%B8%8E%E5%BA%8F%E5%88%97%E5%8C%96/","title":"14-\u95ed\u5305\u4e0e\u5e8f\u5217\u5316","text":"<p> \u7ea6 1024 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>\u5728 Scala \u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u4e2d\uff0c\u95ed\u5305\u662f\u533f\u540d\u51fd\u6570\u7684\u5e38\u89c4\u64cd\u4f5c\uff0c\u6240\u4ee5\u7ecf\u5e38\u4f1a\u51fa\u73b0RDD\u7b97\u5b50\u5185\u7684\u533f\u540d\u51fd\u6570\u7528\u5230\u7b97\u5b50\u5916\u7684\u6570\u636e\uff0c\u8fd9\u4e5f\u5c31\u5f62\u6210\u4e86\u95ed\u5305\u7684\u6548\u679c\uff0c\u4f46RDD\u7b97\u5b50\u5185\u7684\u533f\u540d\u51fd\u6570\u4e0d\u4ec5\u4f1a\u95ed\u5305\u53d8\u91cf\uff0c\u8fd8\u8981\u6c42\u88ab\u95ed\u5305\u7684\u53d8\u91cf\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u56e0\u4e3a\u7b97\u5b50\u4ee5\u5916\u7684\u4ee3\u7801\u90fd\u662f\u5728 Driver \u7aef\u6267\u884c\uff0c\u4f46\u7b97\u5b50\u91cc\u9762\u7684\u4ee3\u7801\u90fd\u662f\u5728 Executor\u7aef\u6267\u884c\u7684\uff0c\u6240\u4ee5\u5982\u679c\u4f7f\u7528\u7684\u7b97\u5b50\u5916\u7684\u6570\u636e\u65e0\u6cd5\u5e8f\u5217\u5316\uff0c\u5c31\u610f\u5473\u7740\u65e0\u6cd5\u4f20\u503c\u7ed9 Executor\u7aef\u6267\u884c\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d1\u751f\u9519\u8bef\uff0cSpark\u9700\u8981\u5728\u6267\u884c\u4efb\u52a1\u8ba1\u7b97\u524d\uff0c\u68c0\u6d4b\u95ed\u5305\u5185\u7684\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u79f0\u4e4b\u4e3a\u95ed\u5305\u68c0\u6d4b\u3002</p> <p>\u6848\u4f8b\u4e00\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"sortByKey\")\n\u00a0\u00a0val rdd = sc.makeRDD(List[Int](1, 2, 3, 4))\n\u00a0\u00a0val user = new User\n `// RDD\u7b97\u5b50\u4e2d\u4f20\u9012\u7684\u533f\u540d\u51fd\u6570\u4f1a\u8fdb\u884c\u95ed\u5305\u68c0\u6d4b\uff0c\u5982\u679c\u95ed\u5305\u4e86\u7b97\u5b50\u5916\u7684\u6570\u636e\uff0c\u5e76\u4e14\u8be5\u65e0\u6cd5\u88ab\u5e8f\u5217\u5316\uff0c`\n `// \u90a3\u4e48\u5c31\u610f\u5473\u7740\u65e0\u6cd5\u4f20\u503c\u7ed9 Executor\u7aef\u6267\u884c\uff0c\u4e8e\u662f\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38`\n\u00a0\u00a0rdd.foreach(\n\u00a0\u00a0\u00a0\u00a0num =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(\"age = \" + (user.age + num))\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0)\n `println(user)\u00a0 //User(age=30)`\n\u00a0\u00a0sc.stop()\n}\n`//\u00a0\u00a0class User {`\n`//\u00a0\u00a0class User extends Serializable {`\n`// \u6837\u4f8b\u7c7b\u5728\u7f16\u8bd1\u65f6\uff0c\u4f1a\u81ea\u52a8\u6df7\u5165\u5e8f\u5217\u5316\u7279\u8d28\uff08\u5b9e\u73b0\u53ef\u5e8f\u5217\u5316\u63a5\u53e3\uff09`\ncase class User() {\n\u00a0\u00a0var age: Int = 30\n\u00a0\u00a0override def toString = s\"User(age=$age)\"\n}\n</code></pre> \u5b9e\u9a8c\u73b0\u8c61\u53ca\u7ed3\u8bba\uff1a 1.\u5982\u679c\u76f4\u63a5class User\uff0c\u90a3\u4e48\u4f1a\u629b\u51fa\u5e8f\u5217\u5316\u5f02\u5e38\uff0c\u5982\u679cclass User extends Serializable \u6216\u8005\u00a0case class User() \u65f6\u624d\u53ef\u5c06\u6570\u636e\u4f20\u5230Executor\u6267\u884c\u3002 2.println(user)\u662f\u5728Driver \u7aef\u6267\u884c\u7684\uff0c\u6240\u4ee5\u8f93\u51fa\u7ed3\u679c\u662fUser(age=30)\uff0c\u5e76\u4e14user\u88ab\u8f93\u51fa\u4f20\u5230Executor\u540e\u4f1a\u5728\u5404\u4e2aExecutor\u5185\u5b58\u53cd\u5e8f\u5217\u5316\u6210\u65b0\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u4e4b\u95f4\u662f\u72ec\u7acb\uff0c\u6ca1\u6709\u5173\u8054\u3002</p> <p>\u6848\u4f8b\u4e8c\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"Serializable\")\n\u00a0\u00a0val rdd: RDD[String] = sc.makeRDD(Array(\"hello world\", \"hello spark\", \"hive\", \"atguigu\"))\n\u00a0\u00a0//\u5339\u914d\u5305\u542bh\u7684\u6570\u636e\n\u00a0\u00a0val search = new Search(\"h\")\n\n\u00a0\u00a0//\u5e8f\u5217\u5316\u5f02\u5e38\n\u00a0\u00a0search.getMatch1(rdd).collect().foreach(println)\n\n\u00a0\u00a0//\u540c\u6837\u4f1a\u5e8f\u5217\u5316\u5f02\u5e38\uff0c\u56e0\u4e3asearch\u4f5c\u4e3a\u4e00\u4e2a\u53d8\u91cf\u51fa\u73b0\u5728\u51fd\u6570\uff0c\u6240\u4ee5\u95ed\u5305\u68c0\u6d4b\u65f6\u4f1a\u8981\u6c42\u7c7b\u80fd\u591f\u88ab\u5e8f\u5217\u5316\n\u00a0\u00a0//rdd.filter(x =&gt; x.contains(search.query)).collect().foreach(println)\n\n\u00a0\u00a0//\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\n\u00a0\u00a0//search.getMatch2(rdd).collect().foreach(println)\n\n\u00a0\u00a0sc.stop()\n}\n\n// \u7c7b\u7684\u6784\u9020\u53c2\u6570\u5176\u5b9e\u662f\u7c7b\u7684\u5c5e\u6027\nclass Search(val query: String) {\n\n\u00a0\u00a0`// \u4e0d\u7ba1\u662f\u4e0d\u662f\u533f\u540d\u51fd\u6570\uff0c\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u90fd\u4f1a\u8fdb\u884c\u95ed\u5305\uff0c`\n `// \u6240\u4ee5isMatch\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9rdd.filter\u540e\u540c\u6837\u9700\u8981\u8fdb\u884c\u95ed\u5305\u68c0\u6d4b\uff0c`\n `def isMatch(x: String): Boolean = {`\n `// \u4f20\u9012\u7ed9RDD\u7b97\u5b50\u7684\u51fd\u6570\u4e0d\u4ec5\u4f1a\u95ed\u5305\u53d8\u91cf\uff0c\u8fd8\u8981\u6c42\u88ab\u95ed\u5305\u7684\u53d8\u91cf\u80fd\u88ab\u5e8f\u5217\u5316\uff0c`\n `// \u56e0\u4e3a\u7c7b\u7684\u5bf9\u8c61\u4f5c\u4e3a\u4e00\u4e2a\u53d8\u91cf\u51fa\u73b0\u5728\u51fd\u6570\uff0c\u6240\u4ee5\u95ed\u5305\u68c0\u6d4b\u65f6\u4f1a\u8981\u6c42\u7c7b\u80fd\u591f\u88ab\u5e8f\u5217\u5316`\n `x.contains(this.query)`\n\u00a0\u00a0}\n\n\u00a0\u00a0def getMatch1(rdd: RDD[String]): RDD[String] = {\n\u00a0\u00a0\u00a0\u00a0//\u5c06isMatch\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9rdd.filter\n\u00a0\u00a0\u00a0\u00a0rdd.filter(isMatch)\n\u00a0\u00a0}\n\n\u00a0\u00a0def getMatch2(rdd: RDD[String]): RDD[String] = {\n\u00a0\u00a0\u00a0 `// \u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u5e8f\u5217\u5316\uff0c\u4e0d\u4f1a\u629b\u5e8f\u5217\u5316\u5f02\u5e38`\n `val s = query`\n `rdd.filter(x =&gt; x.contains(s))`\n\u00a0\u00a0}\n}\n</code></pre> \u5b9e\u9a8c\u7ed3\u8bba\uff1a 1.\u4e0d\u7ba1\u662f\u4e0d\u662f\u533f\u540d\u51fd\u6570\uff0c\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u90fd\u4f1a\u8fdb\u884c\u95ed\u5305 2.\u4f20\u9012\u7ed9RDD\u7b97\u5b50\u7684\u51fd\u6570\u4e0d\u4ec5\u4f1a\u95ed\u5305\u53d8\u91cf\uff0c\u8fd8\u8981\u6c42\u88ab\u95ed\u5305\u7684\u53d8\u91cf\u80fd\u88ab\u5e8f\u5217\u5316 3.\u7c7b\u7684\u5bf9\u8c61\u4f5c\u4e3a\u4e00\u4e2a\u53d8\u91cf\u51fa\u73b0\u5728\u88ab\u4f20\u9012\u7ed9RDD\u7b97\u5b50\u7684\u51fd\u6570\u4e2d\uff0c\u6240\u4ee5\u95ed\u5305\u68c0\u6d4b\u65f6\u4f1a\u8981\u6c42\u7c7b\u80fd\u591f\u88ab\u5e8f\u5217\u5316</p> <p>Kryo \u5e8f\u5217\u5316\u6846\u67b6 Java \u7684\u5e8f\u5217\u5316\u80fd\u591f\u5e8f\u5217\u5316\u4efb\u4f55\u7684\u7c7b\u3002\u4f46\u662f\u6bd4\u8f83\u91cd\uff08\u5b57\u8282\u591a\uff09 \uff0c\u5e8f\u5217\u5316\u540e\uff0c\u5bf9\u8c61\u7684\u63d0\u4ea4\u4e5f\u6bd4\u8f83\u5927\u3002 Spark \u51fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0c Spark2.0 \u5f00\u59cb\u652f\u6301\u53e6\u5916\u4e00\u79cd Kryo \u5e8f\u5217\u5316\u673a\u5236\u3002 Kryo \u901f\u5ea6\u662f Serializable \u7684 10 \u500d\u3002\u5f53 RDD \u5728 Shuffle \u6570\u636e\u7684\u65f6\u5019\uff0c\u7b80\u5355\u6570\u636e\u7c7b\u578b\u3001\u6570\u7ec4\u548c\u5b57\u7b26\u4e32\u7c7b\u578b\u5df2\u7ecf\u5728 Spark \u5185\u90e8\u4f7f\u7528 Kryo \u6765\u5e8f\u5217\u5316\uff0c\u5176\u5b83\u7c7b\u578b\u6ca1\u6709\u4f7f\u7528Kryo\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u5982\u81ea\u5b9a\u4e49\u7c7b\u5c31\u6ca1\u6709\uff0c\u800c\u662f\u4f7f\u7528\u7684Java\u7684\u5e8f\u5217\u673a\u5236\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5c06\u81ea\u5b9a\u4e49\u7c7b\u8bbe\u7f6e\u4e3a\u4f7f\u7528Kryo \u5e8f\u5217\u5316\u3002 \u4f7f\u7528 Kryo \u5e8f\u5217\u5316\uff0c\u4e5f\u8981\u7ee7\u627f Serializable \u63a5\u53e3\uff0c\u4f46\u662ftransient\u5173\u952e\u5b57\u5c31\u5e76\u4e0d\u8d77\u4f5c\u7528\u4e86\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/15-%E6%8C%81%E4%B9%85%E5%8C%96/","title":"15-\u6301\u4e45\u5316","text":"<p> \u7ea6 1502 \u4e2a\u5b57  8 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 30 \u5206\u949f</p> <p>1.\u4ee5\u4e0b\u4f1a\u6709\u4e24\u4e2aJob\uff0c\u56e0\u4e3a\u6709\u4e24\u4e2a\u884c\u52a8\u7b97\u5b50 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n\u00a0val lines: RDD[String] = sc.makeRDD(List(\"Hello Spark\", \"Hello Scala\"))\n\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0val wordAndOne: RDD[(String, Int)] = words.map(word =&gt; {\n\u00a0 \u00a0println(\"@@@@@@@@\")\n\u00a0 \u00a0(word, 1)\n\u00a0})\n\n\u00a0//\u805a\u5408\n\u00a0val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0wordToCount.collect().foreach(println)\n\u00a0println(\"================\")\n\u00a0//\u5206\u7ec4\n\u00a0val groupByKeyRDD: RDD[(String, Iterable[Int])] = wordAndOne.groupByKey()\n\u00a0groupByKeyRDD.collect.foreach(println)\n\n\u00a0TimeUnit.DAYS.sleep(1)\n\u00a0sc.stop()\n}\n</code></pre> \u867d\u7136\u5728\u4e24\u4e2aJob\u4e2d\u524d\u4e24\u4e2aRDD\u662f\u91cd\u7528\u7684\uff0c\u4f46\u662f\u56e0\u4e3aRDD\u662f\u4e0d\u4fdd\u5b58\u6570\u636e\u7684\uff0cRDD\u53ea\u662f\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e24\u4e2aJob\u4f1a\u5404\u81ea\u4ece\u6570\u636e\u6e90\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u4f1a\u88ab\u8bfb\u53d6\u4e24\u6b21\uff0c\u4ece\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u70b9\uff1a Text Only<pre><code>@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n(Hello,3)\n(Scala,1)\n(Spark,1)\n================\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n(Hello,CompactBuffer(1, 1, 1))\n(Scala,CompactBuffer(1))\n(Spark,CompactBuffer(1))\n</code></pre></p> <p>2.\u5982\u679c\u60f3\u4e0d\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 Cache \u6216\u8005 Persist \u65b9\u6cd5\u5c06\u8ba1\u7b97\u7ed3\u679c\u7f13\u5b58\u4e0b\u6765\u3002 cache\u4f1a\u5c06\u6570\u636e\u7f13\u5b58\u5728\u5185\u5b58\uff0ccache()\u65b9\u6cd5\u5176\u5b9e\u8c03\u7528\u7684\u662fpersist()\u65b9\u6cd5\uff0cpersist()\u65b9\u6cd5\u9ed8\u8ba4\u5c06\u6570\u636e\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528persist(StorageLevel.DISK_ONLY)\u5c06\u6570\u636e\u7f13\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u7a0b\u5e8f\u7ed3\u675f\u65f6\u5220\u9664\u3002 \u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u4f18\u70b9\u662f\u5feb\uff0c\u4f46\u7f3a\u70b9\u662f\u4e0d\u53ef\u9760\uff0c\u56e0\u4e3a\u7f13\u5b58\u5728\u5185\u5b58\u7684\u6570\u636e\u6709\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u6216\u8005\u7531\u4e8e\u5185\u5b58\u4e0d\u8db3\u800c\u88ab\u5220\u9664\uff0c\u4e0d\u8fc7RDD \u7684\u7f13\u5b58\u5bb9\u9519\u673a\u5236\uff08\u8840\u7f18\u5173\u7cfb\uff09\u4fdd\u8bc1\u4e86\u5373\u4f7f\u7f13\u5b58\u4e22\u5931\u4e5f\u80fd\u4fdd\u8bc1\u8ba1\u7b97\u7684\u6b63\u786e\u6267\u884c\uff0c\u65e2\u901a\u8fc7\u8840\u7f18\u5173\u7cfb\u53ef\u4ee5\u91cd\u65b0\u5bf9\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u7531\u4e8e RDD \u7684\u5404\u4e2a Partition \u662f\u76f8\u5bf9\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u8ba1\u7b97\u4e22\u5931\u7684\u90e8\u5206\u5373\u53ef\uff0c\u5e76\u4e0d\u9700\u8981\u91cd\u7b97\u5168\u90e8 Partition\u3002 Spark \u4f1a\u81ea\u52a8\u5bf9\u4e00\u4e9b Shuffle \u64cd\u4f5c\u7684\u4e2d\u95f4\u6570\u636e\u505a\u6301\u4e45\u5316\u64cd\u4f5c(\u6bd4\u5982\uff1a reduceByKey)\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u4e00\u662f\u6570\u636e\u91cf\u592a\u5927\u4e0d\u53ef\u80fd\u5728\u5185\u5b58\u4e2d\u7b49\u5f85\u5206\u533a\u6570\u636e\u5230\u9f50\u4e4b\u540e\u518d\u5f00\u59cb\u4e0b\u4e00\u9636\u6bb5\u7684\u8ba1\u7b97\uff0c\u4e8c\u662f\u5f53\u4e0b\u4e00\u9636\u6bb5\u7684\u8ba1\u7b97\u4efb\u52a1\u5931\u8d25\u4e86\u4e4b\u540e\u53ef\u4ee5\u76f4\u63a5\u91cd\u65b0\u8bfb\u53d6\u5df2\u7ecf\u843d\u76d8\u7684\u6570\u636e\u6062\u590d\u8ba1\u7b97\uff0c\u907f\u514d\u91cd\u65b0\u4ece\u5934\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\u5e76\u8ba1\u7b97\u3002\u867d\u7136shuffle\u4f1a\u843d\u76d8\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5982\u679c\u60f3\u91cd\u7528\u6570\u636e\uff0c\u4ecd\u7136\u5efa\u8bae\u8c03\u7528 persist \u6216 cache\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n\u00a0\u00a0\u00a0\u00a0val lines: RDD[String] = sc.makeRDD(List(\"Hello Spark\", \"Hello Scala\"))\n\u00a0\u00a0\u00a0\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0\u00a0\u00a0val wordAndOne: RDD[(String, Int)] = words.map(word =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(\"@@@@@@@@\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(word, 1)\n\u00a0\u00a0\u00a0\u00a0})\n`//\u00a0\u00a0\u00a0\u00a0wordAndOne.cache() //\u7f13\u5b58\u5728\u5185\u5b58\u4e2d`\n`//\u00a0\u00a0\u00a0\u00a0wordAndOne.persist() //\u7f13\u5b58\u5728\u5185\u5b58\u4e2d`\n `wordAndOne.persist(StorageLevel.DISK_ONLY) //\u7f13\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u7a0b\u5e8f\u7ed3\u675f\u65f6\u5220\u9664`\n\n\u00a0\u00a0\u00a0\u00a0//\u805a\u5408\n\u00a0\u00a0\u00a0\u00a0val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0wordToCount.collect().foreach(println)\n\u00a0\u00a0\u00a0\u00a0println(\"================\")\n\u00a0\u00a0\u00a0\u00a0//\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0val groupByKeyRDD: RDD[(String, Iterable[Int])] = wordAndOne.groupByKey()\n\u00a0\u00a0\u00a0\u00a0groupByKeyRDD.collect.foreach(println)\n\n\u00a0\u00a0\u00a0\u00a0TimeUnit.DAYS.sleep(1)\n\u00a0\u00a0\u00a0\u00a0sc.stop()\n\u00a0\u00a0}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n(Hello,2)\n(Scala,1)\n(Spark,1)\n================\n(Hello,CompactBuffer(1, 1))\n(Scala,CompactBuffer(1))\n(Spark,CompactBuffer(1))\n</code></pre> \u4ece\u4e0b\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u4e2aJob\u7684\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u7684task\u90fd\u53ef\u4ee5\u76f4\u63a5\u4ececache\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u4e0e\u4e0b\u9762\u7684checkPoint\u4e0d\u540c\uff0ccache\u7b97\u5b50\u5e76\u4e0d\u4f1a\u6539\u53d8\u4e24\u4e2aJob\u7684\u8840\u7f18\u5173\u7cfb\uff0c\u56e0\u4e3a\u7f13\u5b58\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u5982\u679c\u53d1\u751f\u7f13\u5b58\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4f9d\u9760\u8840\u7f18\u5173\u7cfb\u6765\u6062\u590d\u3002  </p> <p>3.CheckPoint \u68c0\u67e5\u70b9 checkPoint \u4e0e persist(StorageLevel.DISK_ONLY) \u90fd\u4f1a\u5c06\u6570\u636e\u843d\u76d8\uff0c\u4f46\u662fpersist\u4fdd\u5b58\u7684\u6570\u636e\u4f1a\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u5220\u9664\uff0ccheckPoint\u4e0d\u4f1a\uff0c\u6240\u4ee5\u4f7f\u7528checkPoint\u65f6\u9700\u8981\u6307\u5b9a\u4fdd\u5b58\u7684\u8def\u5f84\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n\u00a0\u00a0\u00a0\u00a0//\u4e00\u822c\u4fdd\u5b58\u8def\u5f84\u90fd\u662f\u5728\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\uff1aHDFS\n `sc.setCheckpointDir(\"checkpoint\")`\n\n\u00a0\u00a0\u00a0\u00a0val lines: RDD[String] = sc.makeRDD(List(\"Hello Spark\", \"Hello Scala\"),1)\n\u00a0\u00a0\u00a0\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0\u00a0\u00a0val wordAndOne: RDD[(String, Int)] = words.map(word =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(\"@@@@@@@@\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(word, 1)\n\u00a0\u00a0\u00a0\u00a0})\n `wordAndOne.checkpoint()`\n\n\u00a0\u00a0\u00a0\u00a0//\u805a\u5408\n\u00a0\u00a0\u00a0\u00a0val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0wordToCount.collect().foreach(println)\n\u00a0\u00a0\u00a0\u00a0println(\"================\")\n\u00a0\u00a0\u00a0\u00a0//\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0val groupByKeyRDD: RDD[(String, Iterable[Int])] = wordAndOne.groupByKey()\n\u00a0\u00a0\u00a0\u00a0groupByKeyRDD.collect.foreach(println)\n\n\u00a0\u00a0\u00a0\u00a0TimeUnit.DAYS.sleep(1)\n\u00a0\u00a0\u00a0\u00a0sc.stop()\n\u00a0\u00a0}\n</code></pre> \u4ece\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\u4e24\u4e2aJob\u8fd8\u662f\u90fd\u91cd\u65b0\u8bfb\u53d6\u4e86\u6570\u636e\u5e76\u5b8c\u6574\u5730\u6267\u884c\u4e86\u6574\u4e2a\u6d41\u7a0b\uff0c\u6240\u4ee5\u867d\u7136checkPoint\u4f1a\u5c06\u4e2d\u95f4\u8ba1\u7b97\u7684\u7ed3\u679c\u4fdd\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u5374\u4e0d\u80fd\u8ba9Job\u91cd\u7528\u6570\u636e\u3002 Text Only<pre><code>@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n(Spark,1)\n(Hello,2)\n(Scala,1)\n================\n(Spark,CompactBuffer(1))\n(Hello,CompactBuffer(1, 1))\n(Scala,CompactBuffer(1))\n</code></pre> \u4ece\u4e0b\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230checkPoint\u4f1a\u6539\u53d8\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u7684\u8840\u7f18\u5173\u7cfb\uff0c\u76f4\u63a5\u8ba9\u5176\u53d8\u6210\u4e24\u4e2aJob\uff0c\u5176\u4e2d\u7684\u7b2c\u4e8c\u4e2aJob\u4f1a\u4ececheckpoint\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53job2\u8ba1\u7b97\u5931\u8d25\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ececheckPoint\u4e2d\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\u6062\u590d\u8ba1\u7b97\uff0c\u6240\u4ee5checkPoint\u5373\u4f7f\u6539\u53d8\u4e86\u4efb\u52a1\u7684\u8840\u7f18\u5173\u7cfb\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u4efb\u52a1\u8ba1\u7b97\u5931\u8d25\u65e0\u6cd5\u6062\u590d\u91cd\u65b0\u8ba1\u7b97\uff0c\u56e0\u4e3a\u6b64\u65f6\u5e76\u4e0d\u4f9d\u8d56\u8840\u7f18\u5173\u7cfb\u6062\u590d\uff0c\u800c\u662f\u76f4\u63a5\u4ece checkPoint\u4e2d\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\u5e76\u8ba1\u7b97\u3002 </p> <p>\u6240\u4ee5\u9700\u8981\u5c06CheckPoint\u548ccache\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n `//\u4e00\u822c\u4fdd\u5b58\u8def\u5f84\u90fd\u662f\u5728\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\uff1aHDFS`\n `sc.setCheckpointDir(\"checkpoint\")`\n\n\u00a0\u00a0val lines: RDD[String] = sc.makeRDD(List(\"Hello Spark\", \"Hello Scala\"), 1)\n\u00a0\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0val wordAndOne: RDD[(String, Int)] = words.map(word =&gt; {\n\u00a0\u00a0\u00a0\u00a0println(\"@@@@@@@@\")\n\u00a0\u00a0\u00a0\u00a0(word, 1)\n\u00a0\u00a0})\n `wordAndOne.cache() //\u7f13\u5b58\u5728\u5185\u5b58\u4e2d`\n `wordAndOne.checkpoint()`\n\n\u00a0\u00a0//\u805a\u5408\n\u00a0\u00a0val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0\u00a0wordToCount.collect().foreach(println)\n\u00a0\u00a0println(\"================\")\n\u00a0\u00a0//\u5206\u7ec4\n\u00a0\u00a0val groupByKeyRDD: RDD[(String, Iterable[Int])] = wordAndOne.groupByKey()\n\u00a0\u00a0groupByKeyRDD.collect.foreach(println)\n\n\u00a0\u00a0TimeUnit.DAYS.sleep(1)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u6b64\u65f6\u8f93\u51fa\u5982\u4e0b\uff0c\u4e24\u4e2aJob\u5e76\u4e0d\u4f1a\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u662f\u4ececache\u4e2d\u8bfb\u53d6\u3002 Text Only<pre><code>@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n@@@@@@@@\n(Spark,1)\n(Hello,2)\n(Scala,1)\n================\n(Spark,CompactBuffer(1))\n(Hello,CompactBuffer(1, 1))\n(Scala,CompactBuffer(1))\n</code></pre> \u6b64\u65f6Job\u4ecd\u7136\u662f3\u4e2a\uff0c\u56e0\u4e3acheckPoint\u4ecd\u7136\u4f1a\u6539\u53d8\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u7684\u8840\u7f18\u5173\u7cfb\uff0c\u76f4\u63a5\u8ba9\u5176\u53d8\u6210\u4e24\u4e2aJob\uff0c\u6b64\u65f6Job0\u548cJob2\u7684\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u90fd\u4f1a\u4ececache\u4e2d\u8bfb\u6570\u636e\u3002 </p> <p>\u6ce8\u610f\uff1a cache\u3001persist \u548c checkpoint \u64cd\u4f5c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u88ab\u6267\u884c\uff0c\u5fc5\u987b\u6267\u884c Action \u7b97\u5b50\u624d\u80fd\u89e6\u53d1\u6267\u884c\u3002</p> <p>4.\u7f13\u5b58\u548c\u68c0\u67e5\u70b9\u533a\u522b \uff081\uff09Cache \u7f13\u5b58\u53ea\u662f\u5c06\u6570\u636e\u4fdd\u5b58\u8d77\u6765\uff0c\u4e0d\u5207\u65ad\u8840\u7f18\u4f9d\u8d56\uff0c\u800cCheckpoint \u68c0\u67e5\u70b9\u4f1a\u5207\u65ad\u8840\u7f18\u4f9d\u8d56\u3002 \uff082\uff09Cache \u7f13\u5b58\u5c06\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u6216\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\u65f6\u4f1a\u5220\u9664\uff0c\u53ef\u9760\u6027\u4f4e\u3002\u800cCheckpoint\u53ef\u4ee5\u5c06\u6570\u636e\u5b58\u50a8\u5728 HDFS \u7b49\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\u65f6\u4e0d\u4f1a\u5220\u9664\uff0c\u53ef\u9760\u6027\u9ad8\u3002 \uff083\uff09\u5efa\u8bae\u5c06 checkpoint \u548c cache \u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u8fd9\u6837 checkpeoint \u7684 job \u53ea\u9700\u4ece Cache \u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5426\u5219\u4f1a\u91cd\u65b0\u4ece\u6570\u636e\u6e90\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5b8c\u6574\u5730\u6267\u884c\u6574\u4e2a\u8ba1\u7b97\u6d41\u7a0b\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/16-%E7%B4%AF%E5%8A%A0%E5%99%A8/","title":"16-\u7d2f\u52a0\u5668","text":"<p> \u7ea6 859 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 17 \u5206\u949f</p> <p>\u4ee5\u4e0b\u7a0b\u5e8f\u4e0d\u80fd\u5b9e\u73b0\u5206\u5e03\u5f0f\u8ba1\u7b97\u5bf9\u6570\u636e\u6c42\u548c\uff0c\u56e0\u4e3asum\u53d8\u91cf\u95ed\u5305\u540e\u88ab\u53d1\u9001\u5230\u4e86\u6bcf\u4e2atask\u4e2d\uff0c\u6bcf\u4e2atask\u90fd\u6709\u4e00\u4efd\u72ec\u7acb\u7684sum\u53d8\u91cf\uff0c\u5e76\u4e14\u5728task\u8ba1\u7b97\u540e\uff0c\u6bcf\u4e2atask\u5e76\u4e0d\u4f1a\u5c06sum\u8fd4\u56de\u5230Driver\u7aef\u6c47\u603b\uff0c\u6240\u4ee5\u6700\u540e\u7684\u8f93\u51fa\u7ed3\u679c\u662f0\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0 \u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4))\n\u00a0 \u00a0var sum = 0\n\u00a0 \u00a0rdd.foreach(num =&gt; sum += num)\n\u00a0 \u00a0println(\"sum = \" + sum)\n\u00a0 \u00a0sc.stop()\n}\n</code></pre></p> <p>1.\u4f7f\u7528Spark\u81ea\u5e26\u7684\u7b80\u5355\u7d2f\u52a0\u5668 \u5982\u679c\u60f3\u5b9e\u73b0\u6bcf\u4e2atask\u8ba1\u7b97\u5b8c\u6bd5\u540e\u5c06sum\u53d8\u91cf\u8fd4\u56de\u5230Driver\u7aef\u6c47\u5408\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528Saprk\u63d0\u4f9b\u7684\u7d2f\u52a0\u5668\uff0c \u7d2f\u52a0\u5668\u662f\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf\uff0cSaprk\u81ea\u5e26\u4e863\u4e2a\u7b80\u5355\u7684\u7d2f\u52a0\u5668\uff1alongAccumulator\u3001doubleAccumulator\u3001collectionAccumulator\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0 \u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6), 3)\n `// \u4f7f\u7528Spark\u63d0\u4f9b\u4e86\u7b80\u5355\u6570\u636e\u805a\u5408\u529f\u80fd\u7684\u957f\u6574\u578b\u6570\u636e\u7d2f\u52a0\u5668\uff0c`\n `// \u9700\u8981\u7ed9\u7d2f\u52a0\u5668\u53d6\u4e00\u4e2a\u540d\u5b57\uff0c\u662f\u4e3a\u4e86\u80fd\u8bb0\u5f55\u5728webui\u4e0a`\n `val sumAcc = sc.longAccumulator(\"sum\")`\n\u00a0 \u00a0rdd.foreach(\n\u00a0 \u00a0\u00a0 \u00a0num =&gt; {\n `// \u4f7f\u7528\u7d2f\u52a0\u5668`\n `sumAcc.add(num)`\n\u00a0 \u00a0\u00a0 \u00a0}\n\u00a0 \u00a0)\n `// \u83b7\u53d6\u7d2f\u52a0\u5668\u7684\u503c`\n `println(sumAcc.value)`\n\u00a0 \u00a0TimeUnit.DAYS.sleep(1)\n\u00a0 \u00a0sc.stop()\n}\n</code></pre> \u5728webui\u4e0a\u53ef\u4ee5\u770b\u5230\u8be5\u7d2f\u52a0\u5668\u7684\u503c\uff1a  \u4f7f\u7528\u7d2f\u52a0\u5668\u7684\u8ba1\u7b97\u8fc7\u7a0b\u5982\u4e0b\uff0cDriver\u628a\u7d2f\u52a0\u5668\u53d1\u9001\u5230\u6bcf\u4e2atask\uff0ctask\u8ba1\u7b97\u5b8c\u6bd5\u540e\u628a\u7d2f\u52a0\u5668\u8fd4\u56de\u5230Driver\u7aef\u6c47\u5408\u7684\uff1a</p> <p> \u4f7f\u7528\u7d2f\u52a0\u5668\u9700\u8981\u6ce8\u610f\u4e24\u4e2a\u95ee\u9898\uff1a 1.\u5c11\u52a0\uff1a\u4e0d\u8c03\u7528\u884c\u52a8\u7b97\u5b50\u7684\u8bdd\uff0c\u5c31\u4e0d\u4f1a\u6267\u884c\u8f6c\u6362\u7b97\u5b50\u4e2d\u7d2f\u52a0\u5668\u7684\u7d2f\u52a0\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e0b\u9762\u8f93\u51fa\u7ed3\u679c\u4e3a0 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0 \u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6), 3)\n\u00a0 \u00a0val sumAcc = sc.longAccumulator(\"sum\")\n\u00a0 \u00a0`val mapRDD = rdd.map(sumAcc.add(_))`\n\u00a0 \u00a0println(sumAcc.value)\n\u00a0 \u00a0sc.stop()\n}\n</code></pre> 2.\u591a\u52a0\uff1a\u591a\u6b21\u8c03\u7528\u884c\u52a8\u7b97\u5b50\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bf9\u7d2f\u52a0\u5668\u8fdb\u884c\u591a\u6b21\u7d2f\u52a0\u805a\u5408\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u7684\u7ed3\u679c\u662f42 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0\u00a0 \u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6), 3)\n\u00a0\u00a0 \u00a0// \u4f7f\u7528Spark\u63d0\u4f9b\u4e86\u7b80\u5355\u6570\u636e\u805a\u5408\u529f\u80fd\u7684\u957f\u6574\u578b\u6570\u636e\u7d2f\u52a0\u5668\uff0c\n\u00a0\u00a0 \u00a0// \u9700\u8981\u7ed9\u7d2f\u52a0\u5668\u53d6\u4e00\u4e2a\u540d\u5b57\uff0c\u662f\u4e3a\u4e86\u80fd\u8bb0\u5f55\u5728webui\u4e0a\n\u00a0\u00a0 \u00a0val sumAcc = sc.longAccumulator(\"sum\")\n\u00a0\u00a0 \u00a0val mapRDD = rdd.map(sumAcc.add(_))\n `mapRDD.collect`\n `mapRDD.collect`\n\u00a0\u00a0 \u00a0// \u83b7\u53d6\u7d2f\u52a0\u5668\u7684\u503c\n\u00a0\u00a0 \u00a0println(sumAcc.value)\n\u00a0\u00a0 \u00a0sc.stop()\n}\n</code></pre></p> <p>2.\u81ea\u5b9a\u4e49\u7d2f\u52a0\u5668 \u9700\u6c42\u81ea\u5b9a\u4e49\u7d2f\u52a0\u5668\u5b9e\u73b0WordCount 1.\u81ea\u5b9a\u4e49\u7d2f\u52a0\u5668 Text Only<pre><code>/**\n* \u81ea\u5b9a\u4e49\u6570\u636e\u7d2f\u52a0\u5668\uff1a\n* 1. \u7ee7\u627fAccumulatorV2, \u5b9a\u4e49\u6cdb\u578b\n*\u00a0\u00a0IN: \u7d2f\u52a0\u5668\u7684\u8f93\u5165\u6570\u636e\u7c7b\u578b String, \u5373\u8c03\u7528add\u65b9\u6cd5\u65f6\u8f93\u5165\u7684\u6570\u636e\u7c7b\u578b\n*\u00a0\u00a0OUT: \u7d2f\u52a0\u5668\u8fd4\u56de\u7684\u6570\u636e\u7c7b\u578b mutable.Map[String, Long], \u5373\u8c03\u7528value\u65b9\u6cd5\u65f6\u8fd4\u56de\u7684\u6570\u636e\u7c7b\u578b\n* 2. \u91cd\u5199\u65b9\u6cd5\n*/\nclass WordCountAccumulator extends AccumulatorV2[String, mutable.Map[String, Long]] {\n\u00a0\u00a0private val wcMap = mutable.Map[String, Long]()\n\u00a0\u00a0/**\n\u00a0\u00a0\u00a0* \u5224\u65ad\u662f\u5426\u521d\u59cb\u72b6\u6001\n\u00a0\u00a0\u00a0*/\n\u00a0\u00a0override def isZero: Boolean = wcMap.isEmpty\n\n\u00a0\u00a0override def copy(): AccumulatorV2[String, mutable.Map[String, Long]] = new WordCountAccumulator\n\n\u00a0\u00a0override def reset(): Unit = wcMap.clear()\n\n\u00a0\u00a0/**\n\u00a0\u00a0\u00a0* \u5bf9\u6bcf\u4e2a\u8f93\u5165\u7684\u5143\u7d20\u505a\u7d2f\u52a0\u7684\u65b9\u6cd5\uff0c\u5728\u7b97\u5b50\u4e2d\u8c03\u7528\n\u00a0\u00a0\u00a0*/\n\u00a0\u00a0override def add(word: String): Unit = wcMap.update(word, wcMap.getOrElse(word, 0L) + 1L)\n\n\u00a0\u00a0/**\n\u00a0\u00a0\u00a0* \u5728Driver\u7aef\u9700\u8981\u5c06\u7d2f\u52a0\u5668\u4e24\u4e24\u5408\u5e76\uff0c\u8fd9\u662f\u5408\u5e76\u7684\u65b9\u6cd5\n\u00a0\u00a0\u00a0*/\n\u00a0\u00a0override def merge(other: AccumulatorV2[String, mutable.Map[String, Long]]): Unit = {\n\u00a0\u00a0\u00a0\u00a0// \u5408\u5e76\u4e24\u4e2aMap\n\u00a0\u00a0\u00a0\u00a0other.value.foreach {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case (word, count) =&gt; wcMap.update(word, wcMap.getOrElse(word, 0L) + count)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n\n\u00a0\u00a0/**\n\u00a0\u00a0\u00a0* \u5728Driver\u4e2d\u83b7\u53d6\u7d2f\u52a0\u5668\u7684\u503c\u65f6\u8c03\u7528\u7684\u65b9\u6cd5\n\u00a0\u00a0\u00a0*/\n\u00a0\u00a0override def value: mutable.Map[String, Long] = wcMap\n}\n</code></pre></p> <p>2.\u4f7f\u7528\u7d2f\u52a0\u5668\u505aWordCount Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0\u00a0val rdd = sc.makeRDD(List(\"hello world\", \"hello scala\", \"hello spark\"))\n\u00a0\u00a0// 1.\u521b\u5efa\u7d2f\u52a0\u5668\u5bf9\u8c61\n\u00a0\u00a0val wcAcc = new WordCountAccumulator\n\u00a0\u00a0// 2.\u5411Spark\u8fdb\u884c\u6ce8\u518c\n\u00a0\u00a0sc.register(wcAcc)\n\u00a0\u00a0rdd.flatMap(_.split(\" \"))\n\u00a0\u00a0\u00a0\u00a0// 3.\u4f7f\u7528\u7d2f\u52a0\u5668\u8fdb\u884c\u7d2f\u52a0\n\u00a0\u00a0\u00a0\u00a0.foreach(wcAcc.add)\n\u00a0\u00a0// 4.\u83b7\u53d6\u7d2f\u52a0\u5668\u7d2f\u52a0\u7684\u7ed3\u679c\n\u00a0\u00a0wcAcc.value.foreach(println)\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/17-%E5%B9%BF%E6%92%AD%E5%8F%98%E9%87%8F/","title":"17-\u5e7f\u64ad\u53d8\u91cf","text":"<p> \u7ea6 614 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u4f7f\u7528join\u7b97\u5b50\u8fde\u63a5\u4e24\u4e2akv\u7c7b\u578b\u7684\u6570\u636e\u65f6\uff0c\u4f1a\u6709shuffle\u7684\u8fc7\u7a0b Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3)))\n\u00a0\u00a0val rdd2 = sc.makeRDD(List((\"a\", 4), (\"b\", 5), (\"c\", 6)))\n\u00a0\u00a0rdd1.join(rdd2).collect().foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre>  \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>(a,(1,4))\n(a,(1,5))\n(c,(3,6))\n</code></pre></p> <p>shuffle\u4f1a\u6709\u4e2d\u95f4\u6570\u636e\u843d\u76d8\u7684\u64cd\u4f5c\uff0c\u6548\u7387\u8f83\u4f4e\uff0c\u5f53\u4e00\u4e2a\u5927\u6570\u636e\u6e90\u548c\u4e00\u4e2a\u5c0f\u6570\u636e\u6e90\u505ajoin\u65f6\uff0c\u53ef\u4ee5\u5c06\u5c0f\u6570\u636e\u6e90\u7684\u6240\u6709\u6570\u636e\u76f4\u63a5\u53d1\u9001\u5230\u5927\u6570\u636e\u6e90\u7684\u6bcf\u4e2a\u5206\u533a\u505ajoin\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u5f00Shuffle\uff0c\u4ece\u800c\u63d0\u9ad8\u6548\u7387\u4e86\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3)))\n\u00a0\u00a0val list = List((\"a\", 4), (\"a\", 5), (\"c\", 6))\n `rdd1.map(kv =&gt; {`\n `val res = for (elem &lt;- list if elem._1 == kv._1) yield (kv._1,(kv._2, elem._2))`\n `if (res.isEmpty) Nil`\n `else res`\n `}).flatMap(a =&gt; a)`.collect().foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre>  map\u7b97\u5b50\u5185\u7684\u533f\u540d\u51fd\u6570\u4f1a\u95ed\u5305\u5916\u90e8\u7684list\uff0c\u7136\u540e\u53d1\u9001\u7ed9\u6bcf\u4e00\u4e2atask\u6267\u884c\uff0c\u5b9e\u73b0\u4e86\u5c06\u5c0f\u6570\u636e\u6e90\u53d1\u9001\u5230\u5927\u6570\u636e\u6e90\u7684\u6bcf\u4e2a\u5206\u533a\u505ajoin\u7684\u64cd\u4f5c\uff0c\u8fd9\u6b63\u662f\u6211\u4eec\u60f3\u8981\u7684\u6548\u679c\u3002\u4f46\u65f6\u5f53\u591a\u4e2atask\u88ab\u5206\u914d\u5230\u4e00\u4e2aExecutor\u65f6\uff0c\u8fd9\u4e2aExecutor\u4f1a\u542f\u52a8\u76f8\u5e94\u6570\u91cf\u7684\u7ebf\u7a0b\u6765\u6267\u884ctask\uff0c\u4e8e\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u72ec\u7acb\u62e5\u6709\u4e00\u4efd\u5c0f\u6570\u636e\u6e90\u7684\u526f\u672c\uff08\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u5806\u5185\u5b58\u4e0a\u90fd\u6709\u4e00\u4efd\u5b8c\u6574\u7684\u526f\u672c\uff09\uff0c\u90a3\u4e48\u8fd9\u65f6\u5c31\u53ef\u80fd\u4f1a\u6709OOM\u7684\u95ee\u9898\u4e86\uff1a  \u6240\u4ee5Spark\u4e3a\u6b64\u63d0\u4f9b\u4e86\u5e7f\u64ad\u53d8\u91cf\uff0c\u8ba9\u5904\u4e8e\u540c\u4e00Executor\u7684task\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u53d8\u91cf\uff08\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u5806\u5185\u5b58\u4e0a\u7684\u4e00\u4efd\u526f\u672c\uff09\uff0c\u6ce8\u610f\u5e7f\u64ad\u53d8\u91cf\u662f\u5206\u5e03\u5f0f\u53ea\u8bfb\u53d8\u91cf\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"broadcast\")\n\u00a0\u00a0val rdd1 = sc.makeRDD(List((\"a\", 1), (\"b\", 2), (\"c\", 3)))\n\u00a0\u00a0val list = List((\"a\", 4), (\"a\", 5), (\"c\", 6))\n `val bc: Broadcast[List[(String, Int)]] = sc.broadcast(list)`\n\u00a0\u00a0rdd1.map(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0val res = for (elem &lt;- `bc.value` if elem._1 == kv._1) yield (kv._1,(kv._2, elem._2))\n\u00a0\u00a0\u00a0\u00a0if (res.isEmpty) Nil\n\u00a0\u00a0\u00a0\u00a0else res\n\u00a0\u00a0}).flatMap(a =&gt; a).collect().foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> </p> <p>\u603b\u7ed3\uff1a\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\u4ee5\u5206\u533a\u4e3a\u5355\u4f4d\u5212\u5206\u4e4b\u540e\u53d1\u9001\u5230\u6bcf\u4e00\u4e2a\u5206\u533a\uff0c\u4f46\u662f\u7b97\u5b50\u4e2d\u95ed\u5305\u7684\u53d8\u91cf\u4f1a\u88ab\u5b8c\u6574\u5730\u53d1\u9001\u5230\u6bcf\u4e2a\u5305\u542b\u8fd9\u4e2a\u7b97\u5b50\u7684\u4efb\u52a1\u4e2d\uff0c\u6240\u4ee5\u5f53\u6709\u591a\u4e2a\u5305\u542b\u8fd9\u4e2a\u7b97\u5b50\u7684\u4efb\u52a1\u5728\u540c\u4e00Executor\u4e0a\u6267\u884c\u65f6\uff0c\u8be5Executor\u8fdb\u7a0b\u5c31\u4f1a\u6709\u540c\u4e00\u4e2a\u95ed\u5305\u53d8\u91cf\u7684\u591a\u4e2a\u526f\u672c\uff0c\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5e7f\u64ad\u53d8\u91cf\uff0c\u8ba9Executor\u53ea\u4fdd\u5b58\u8fd9\u4e2a\u53d8\u91cf\u7684\u4e00\u4e2a\u526f\u672c\uff0c\u8ba9\u5904\u4e8e\u8fd9\u4e2aExecutor\u4e0a\u7684task\u5171\u4eab\u8fd9\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u5e7f\u64ad\u53d8\u91cf\u662f\u53ea\u8bfb\u53d8\u91cf\uff0c\u4e0d\u53ef\u4ee5\u4fee\u6539\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/18-SparkCore%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%93%8D/","title":"18-SparkCore\u6848\u4f8b\u5b9e\u64cd","text":"<p> \u7ea6 1658 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 33 \u5206\u949f</p> <p>\u9700\u6c42\u4e00\uff1aTop10 \u70ed\u95e8\u54c1\u7c7b</p> <p>\u7edf\u8ba1\u6bcf\u4e2a\u54c1\u7c7b\u7684\u70b9\u51fb\u6b21\u6570\u3001\u4e0b\u5355\u6b21\u6570\u3001\u652f\u4ed8\u6b21\u6570\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e09\u4e2a\u91cf\u5bf9\u54c1\u7c7b\u6392\u5e8f\uff0c\u70b9\u51fb\u6b21\u6570\u76f8\u540c\u540e\u518d\u6bd4\u8f83\u4e0b\u5355\u6b21\u6570\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6700\u540e\u53d6Top10 \u70ed\u95e8\u54c1\u7c7b 1.\u5176\u5b9e\u5c31\u662f\u4e00\u4e2aWordCount Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"req01_top10\")\n\u00a0\u00a0// 1. \u8bfb\u53d6\u539f\u59cb\u65e5\u5fd7\u6570\u636e\n\u00a0\u00a0sc.textFile(\"data/user_visit_action.txt\")\n\u00a0\u00a0\u00a0\u00a0// 2. \u5c06\u6570\u636e\u8f6c\u6362\u7ed3\u6784\n\u00a0\u00a0\u00a0\u00a0.flatMap(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (cols(6) != \"-1\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u70b9\u51fb\u7684\u573a\u5408 : ( \u54c1\u7c7bID\uff0c( 1, 0, 0 ) )\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List((cols(6), (1, 0, 0)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (cols(8) != \"null\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0b\u5355\u7684\u573a\u5408 : ( \u54c1\u7c7bID\uff0c( 0, 1, 0 ) )\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cols(8).split(\",\").map((_, (0, 1, 0)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else if (cols(10) != \"null\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u652f\u4ed8\u7684\u573a\u5408 : ( \u54c1\u7c7bID\uff0c( 0, 0, 1 ) )\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cols(10).split(\",\").map((_, (0, 0, 1)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Nil\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0// 3. \u5c06\u76f8\u540c\u7684\u54c1\u7c7bID\u7684\u6570\u636e\u8fdb\u884c\u5206\u7ec4\u805a\u5408\n\u00a0\u00a0\u00a0\u00a0//\u00a0\u00a0\u00a0\u00a0( \u54c1\u7c7bID\uff0c( \u70b9\u51fb\u6570\u91cf, \u4e0b\u5355\u6570\u91cf, \u652f\u4ed8\u6570\u91cf ) )\n\u00a0\u00a0\u00a0\u00a0.reduceByKey((t1, t2) =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(t1._1 + t2._1, t1._2 + t2._2, t1._3 + t2._3)\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0// 4. \u5c06\u7edf\u8ba1\u7ed3\u679c\u6839\u636e\u6570\u91cf\u8fdb\u884c\u964d\u5e8f\u5904\u7406\uff0c\u53d6\u524d10\u540d\n\u00a0\u00a0\u00a0\u00a0.sortBy(_._2, ascending = false).take(10).foreach(println)\n}\n</code></pre> 2.\u4f7f\u7528\u7d2f\u52a0\u5668\u5b8c\u6210\u8fd9\u4e2aWordCount Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"req01_top10\")\n\n\u00a0\u00a0// 1. \u8bfb\u53d6\u539f\u59cb\u65e5\u5fd7\u6570\u636e\n\u00a0\u00a0val data = sc.textFile(\"data/user_visit_action.txt\")\n\n\u00a0\u00a0//\u521b\u5efa\u7d2f\u52a0\u5668\n\u00a0\u00a0val acc = new MyAccumulator\n\u00a0\u00a0//\u6ce8\u518c\u7d2f\u52a0\u5668\n\u00a0\u00a0sc.register(acc)\n\n\u00a0\u00a0//\u5bf9\u6bcf\u4e00\u884c\u6570\u636e\u505a\u7d2f\u52a0\n\u00a0\u00a0data.foreach(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0if (cols(6) != \"-1\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u662f\u70b9\u51fb\u884c\u4e3a\uff0c\u90a3\u4e48\u5c31\u5c06\u70b9\u51fb\u7684\u54c1\u7c7bid\u4f20\u5230\u7d2f\u52a0\u5668\u4e2d\u7d2f\u52a0\uff0c\u7b2c\u4e00\u4e2a\u53c2\u65700\u6807\u8bc6\u8fd9\u662f\u70b9\u51fb\u884c\u4e3a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0acc.add((0, cols(6)))\n\u00a0\u00a0\u00a0\u00a0} else if (cols(8) != \"null\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u662f\u4e0b\u5355\u884c\u4e3a\uff0c\u90a3\u4e48\u5c31\u5c06\u4e0b\u5355\u7684\u6240\u6709\u54c1\u7c7bid\u4f20\u5230\u7d2f\u52a0\u5668\u4e2d\u7d2f\u52a0\uff0c\u7b2c\u4e00\u4e2a\u53c2\u65701\u6807\u8bc6\u8fd9\u662f\u4e0b\u5355\u884c\u4e3a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0acc.add((1, cols(8)))\n\u00a0\u00a0\u00a0\u00a0} else if (cols(10) != \"null\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u5982\u679c\u662f\u652f\u4ed8\u884c\u4e3a\uff0c\u90a3\u4e48\u5c31\u5c06\u652f\u4ed8\u7684\u6240\u6709\u54c1\u7c7bid\u4f20\u5230\u7d2f\u52a0\u5668\u4e2d\u7d2f\u52a0\uff0c\u7b2c\u4e00\u4e2a\u53c2\u65702\u6807\u8bc6\u8fd9\u662f\u652f\u4ed8\u884c\u4e3a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0acc.add((2, cols(10)))\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0})\n\n\u00a0\u00a0//\u5bf9\u7d2f\u52a0\u5668\u7684\u7ed3\u679c\u6392\u5e8f\uff0c\u7136\u540e\u53d6top10\u8f93\u51fa\n\u00a0\u00a0acc.value.toList.sortWith((a, b) =&gt; {\n\u00a0\u00a0\u00a0\u00a0if (a._2(0) != b._2(0)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a._2(0) &gt; b._2(0)\n\u00a0\u00a0\u00a0\u00a0} else if (a._2(1) != b._2(1)) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a._2(1) &gt; b._2(1)\n\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a._2(2) &gt; b._2(2)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}).take(10).foreach(println)\n}\n</code></pre> Text Only<pre><code>class MyAccumulator extends AccumulatorV2[(Int, String), mutable.Map[String, ArrayBuffer[Int]]] {\n\n\u00a0\u00a0private val map = mutable.Map[String, ArrayBuffer[Int]]()\n\n\u00a0\u00a0override def add(v: (Int, String)): Unit = {\n\u00a0\u00a0\u00a0\u00a0//\u867d\u7136\u70b9\u51fb\u884c\u4e3a\u53ea\u6709\u4e00\u4e2a\u54c1\u7c7bid\uff0c\u4f46\u662f\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528split\u65b9\u6cd5\u7684\n\u00a0\u00a0\u00a0\u00a0for (id &lt;- v._2.split(\",\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val arrayBuffer = map.getOrElse(id, ArrayBuffer[Int](0, 0, 0))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6839\u636e\u884c\u4e3a\u628a\u54c1\u7c7b\u5bf9\u5e94\u4f4d\u7f6e\u7684\u6570\u636e\u52a01\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0arrayBuffer(v._1) += 1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0map.update(id, arrayBuffer)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0}\n\n\u00a0\u00a0override def merge(other: AccumulatorV2[(Int, String), mutable.Map[String, ArrayBuffer[Int]]]): Unit = {\n\u00a0\u00a0\u00a0\u00a0//\u5408\u5e76\u4e24\u4e2aMap\u7684\u5e38\u89c4\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0other.value.foreach(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val arrayBuffer = map.getOrElse(kv._1, ArrayBuffer[Int](0, 0, 0))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (i &lt;- 0 until 3) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0arrayBuffer(i) += kv._2(i)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0map.update(kv._1, arrayBuffer)\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0}\n\u00a0\u00a0override def value: mutable.Map[String, ArrayBuffer[Int]] = map\n\u00a0\u00a0override def isZero: Boolean = map.isEmpty\n\u00a0\u00a0override def copy(): AccumulatorV2[(Int, String), mutable.Map[String, ArrayBuffer[Int]]] = new MyAccumulator\n\u00a0\u00a0override def reset(): Unit = map.clear()\n}\n</code></pre></p> <p>\u9700\u6c42\u4e8c\uff1a Top10 \u70ed\u95e8\u54c1\u7c7b\u4e2d\u6bcf\u4e2a\u54c1\u7c7b\u70b9\u51fb Top10 \u7684session \u5c31\u662f\u6c42\u8fd910\u4e2a\u54c1\u7c7b\u7684\u6bcf\u4e00\u4e2a\u54c1\u7c7b\u70b9\u51fb\u524d10\u7684session\u53ca\u5176\u70b9\u51fb\u6570 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"req02_top10\")\n\u00a0\u00a0// 1. \u8bfb\u53d6\u539f\u59cb\u65e5\u5fd7\u6570\u636e\n\u00a0\u00a0val data = sc.textFile(\"data/user_visit_action.txt\")\n\u00a0\u00a0data.cache()\n\u00a0\u00a0// 2. Top10 \u70ed\u95e8\u54c1\u7c7b\n\u00a0\u00a0val categoryTop10: Array[(String, (Int, Int, Int))] = data.flatMap(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0if (cols(6) != \"-1\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List((cols(6), (1, 0, 0)))\n\u00a0\u00a0\u00a0\u00a0} else if (cols(8) != \"null\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cols(8).split(\",\").map((_, (0, 1, 0)))\n\u00a0\u00a0\u00a0\u00a0} else if (cols(10) != \"null\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cols(10).split(\",\").map((_, (0, 0, 1)))\n\u00a0\u00a0\u00a0\u00a0} else {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Nil\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0.reduceByKey((t1, t2) =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0(t1._1 + t2._1, t1._2 + t2._2, t1._3 + t2._3)\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0.sortBy(_._2, ascending = false).take(10)\n\n\u00a0\u00a0val top10 = categoryTop10.map(_._1)\n\n\u00a0\u00a0//3.Top10 \u70ed\u95e8\u54c1\u7c7b\u4e2d\u6bcf\u4e2a\u54c1\u7c7b\u70b9\u51fb Top10 \u7684session\u53ca\u5176\u70b9\u51fb\u6570\n\u00a0\u00a0//\u601d\u8def\uff1a\n\u00a0\u00a0// 1.\u5148\u8fc7\u6ee4\u6570\u636e\n\u00a0\u00a0// 2.\u518d\u6839\u636e\u54c1\u7c7b\u548csession\u505aWordCount\n\u00a0\u00a0// 3.\u7136\u540e\u6839\u636e\u54c1\u7c7b\u5206\u7ec4\n\u00a0\u00a0// 4.\u7ec4\u5185\u6839\u636eWordCount\u7684\u7ed3\u679c\u6392\u5e8f\u53d6\u524d10\n\u00a0\u00a0data.map(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0//((click_category_id, session_id) ,1)\n\u00a0\u00a0\u00a0\u00a0((cols(6), cols(2)), 1)\n\u00a0\u00a0}).filter(kv =&gt; top10.contains(kv._1._1))\n\u00a0\u00a0\u00a0\u00a0.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0//(click_category_id, (session_id ,sum))\n\u00a0\u00a0\u00a0\u00a0.map(kv =&gt; (kv._1._1, (kv._1._2, kv._2)))\n\u00a0\u00a0\u00a0\u00a0//\u540c\u4e00\u54c1\u7c7b\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0.groupByKey\n\u00a0\u00a0\u00a0\u00a0//\u6392\u5e8f\u53d6\u524d10\n\u00a0\u00a0\u00a0\u00a0.mapValues(iter =&gt; iter.toList.sortBy(_._2)(Ordering.Int.reverse).take(10))\n\u00a0\u00a0\u00a0\u00a0.collect.foreach(println)\n}\n</code></pre></p> <p>\u9700\u6c42\u4e09\uff1a\u9875\u9762\u8df3\u8f6c\u7387\u7edf\u8ba1 \u4ece 1\u53f7\u9875\u9762\u8df3\u8f6c\u52303\u53f7\u9875\u9762\u7684\u603b\u6b21\u6570 \u9664\u4ee5 1\u53f7\u9875\u9762\u88ab\u8bbf\u95ee\u7684\u603b\u6b21\u6570 \u5c31\u662f 1\u53f7\u9875\u9762\u52303\u53f7\u9875\u9762\u7684\u8df3\u8f6c\u7387 1.\u6c42\u6bcf\u4e2a\u8df3\u8f6c\u7684\u9875\u9762\u8df3\u8f6c\u7387 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"req03\")\n\u00a0\u00a0// 1. \u8bfb\u53d6\u539f\u59cb\u65e5\u5fd7\u6570\u636e\n\u00a0\u00a0val data = sc.textFile(\"data/user_visit_action.txt\")\n\n\u00a0\u00a0// TODO \u8ba1\u7b97\u5206\u6bcd\n\u00a0\u00a0//\u8ba1\u7b97\u6bcf\u4e2a\u9875\u9762\u8bbf\u95ee\u7684\u603b\u6b21\u6570\uff0c\u6bd4\u59822\u53f7\u9875\u9762\u8bbf\u95ee\u4e8699\u6b21 (2,99)\uff0c\u5176\u5b9e\u5c31\u662fWordCount\n\u00a0\u00a0data.cache()\n\u00a0\u00a0val pageAccessSum = data.map(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0//(page_id, 1)\n\u00a0\u00a0\u00a0\u00a0(cols(3), 1)\n\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0.collect\n\u00a0\u00a0\u00a0\u00a0//\u8f6c\u6362\u6210Map\uff0c\u65b9\u4fbf\u540e\u9762\u76f4\u63a5\u6839\u636e\u9875\u9762\u53d6\u8bbf\u95ee\u603b\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0.toMap\n\n\u00a0\u00a0val bc = sc.broadcast(pageAccessSum)\n\n\u00a0\u00a0// TODO \u8ba1\u7b97\u5206\u5b50\n\u00a0\u00a0// \u8ba1\u7b97\u9875\u9762\u8df3\u8f6c\u5230\u7684\u603b\u6b21\u6570\uff0c\u5982\u4ece2\u53f7\u9875\u9762\u8df3\u52303\u53f7\u9875\u9762\u4e00\u5171100\u6b21 ((2,3),100)\n\u00a0\u00a0// \u601d\u8def\uff1a\n\u00a0\u00a0// 1.\u6309session\u5206\u7ec4\n\u00a0\u00a0// 2.\u6309\u65f6\u95f4\u6392\u5e8f(\u5347\u5e8f)\n\u00a0\u00a0// 3.\u62c9\u94fe\uff0c\u6bd4\u5982\u67d0\u4e2asession\u5185\u9875\u9762\u8bbf\u95ee\u987a\u5e8f\u662f3,5,7,6\uff0c\u90a3\u4e48\u9875\u9762\u8df3\u8f6c\u60c5\u51b5\u5c31\u662f(3,5)(5,7)(7,6),\u6216\u8005\u4f7f\u7528\u6ed1\u7a97sliding\u53ef\u4ee5\u5f97\u5230\u540c\u6837\u7684\u6548\u679c\n\u00a0\u00a0// 4.\u8ba1\u7b97\u5168\u5c40\u6bcf\u4e2a\u8df3\u8f6c\u7684\u6b21\u6570\uff0c\u53c8\u662fWordCount\n\u00a0\u00a0data.map(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0//(session_id, (page_id, action_time))\n\u00a0\u00a0\u00a0\u00a0(cols(2), (cols(3), cols(4)))\n\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0//\u6309sessionID\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0.groupByKey()\n\u00a0\u00a0\u00a0\u00a0.flatMap {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case (_, page_action) =&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u65f6\u95f4\u6392\u5e8f\u540e\u53ea\u53d6page_id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val page = page_action.toList.sortBy(_._2).map(_._1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//page_id\u62c9\u94fe\uff0c(page_id, page_id)\uff0c\u7136\u540e\u5728\u540e\u9762\u52a0\u4e2a1\uff0c((page_id, page_id),1)\uff0cWordCount\u5e38\u89c4\u505a\u6cd5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `page.zip(page.tail)`.map((_, 1))\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0//TODO \u8ba1\u7b97\u9875\u9762\u8df3\u8f6c\u7387\n\u00a0\u00a0\u00a0\u00a0.foreach(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val percent = kv._2.toDouble / bc.value(kv._1._1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(s\"${kv._1._1} -&gt; ${kv._1._2} = ${percent}\")\n\u00a0\u00a0\u00a0\u00a0})\n}\n</code></pre></p> <p>2.\u6c42\u6307\u5b9a\u8fde\u7eed\u8df3\u8f6c\u7684\u9875\u9762\u8df3\u8f6c\u7387 \u6bd4\u5982\u6c42\u8fde\u7eed\u8df3\u8f6c (1,2)\u3001(2,3)\u3001(3,4)\u3001(5,6)\u3001(6,7) \u4e2d\u7684\u6bcf\u4e00\u8df3\u7684\u9875\u9762\u8df3\u8f6c\u7387 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"req03\")\n\u00a0\u00a0//\u6307\u5b9a\u9875\u9762\n\u00a0\u00a0val pages = List(\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\n\u00a0\u00a0//\u8fde\u7eed\u8df3\u8f6c\n\u00a0\u00a0val hop = pages.zip(pages.tail)\n\u00a0\u00a0// 1. \u8bfb\u53d6\u539f\u59cb\u65e5\u5fd7\u6570\u636e\n\u00a0\u00a0val data = sc.textFile(\"data/user_visit_action.txt\")\n\u00a0\u00a0data.cache()\n\n\u00a0\u00a0// TODO \u8ba1\u7b97\u5206\u6bcd\n\u00a0\u00a0//\u8ba1\u7b97\u6307\u5b9a\u9875\u9762\u7684\u8bbf\u95ee\u603b\u6b21\u6570\uff0c\u6bd4\u59822\u53f7\u9875\u9762\u8bbf\u95ee\u4e8699\u6b21 (2,99)\uff0c\u8fd8\u662fWordCount\n\u00a0\u00a0val pageAccessSum = data.map(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0//(page_id, 1)\n\u00a0\u00a0\u00a0\u00a0(cols(3), 1)\n\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0//\u8fc7\u6ee4\uff0c\u53ea\u7559\u4e0b\u6307\u5b9a\u9875\u9762\u7684\u8bbf\u95ee\u603b\u6b21\u6570\uff0c\u6ce8\u610f\u6b64\u65f6\u6839\u672c\u4e0d\u9700\u8981\u7edf\u8ba1\u6700\u540e\u4e00\u4e2a\u9875\u9762\u4e5f\u5c31\u662f7\u53f7\u9875\u9762\u7684\u8bbf\u95ee\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0// \u4f7f\u7528init\u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230\u4e0d\u5305\u542b\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u96c6\u5408\n\u00a0\u00a0\u00a0\u00a0.filter(kv =&gt; `pages.init.`contains(kv._1))\n\u00a0\u00a0\u00a0\u00a0.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0.collect\n\u00a0\u00a0\u00a0\u00a0//\u8f6c\u6362\u6210Map\uff0c\u65b9\u4fbf\u540e\u9762\u76f4\u63a5\u6839\u636e\u9875\u9762\u53d6\u8bbf\u95ee\u603b\u6b21\u6570\n\u00a0\u00a0\u00a0\u00a0.toMap\n\n\u00a0\u00a0val bc = sc.broadcast(pageAccessSum)\n\n\u00a0\u00a0// TODO \u8ba1\u7b97\u5206\u5b50\n\u00a0\u00a0// \u8ba1\u7b97\u6307\u5b9a\u9875\u9762\u8df3\u8f6c\u7684\u603b\u6b21\u6570\uff0c\u5982\u4ece2\u53f7\u9875\u9762\u8df3\u52303\u53f7\u9875\u9762\u4e00\u5171100\u6b21 ((2,3),100)\n\u00a0\u00a0// \u601d\u8def\uff1a\n\u00a0\u00a0// 1.\u6309session\u5206\u7ec4\n\u00a0\u00a0// 2.\u6309\u65f6\u95f4\u6392\u5e8f(\u5347\u5e8f)\n\u00a0\u00a0// 3.\u62c9\u94fe\uff0c\u6bd4\u5982\u67d0\u4e2asession\u5185\u9875\u9762\u8bbf\u95ee\u987a\u5e8f\u662f3,5,7,6\uff0c\u90a3\u4e48\u9875\u9762\u8df3\u8f6c\u60c5\u51b5\u5c31\u662f(3,5)(5,7)(7,6)\uff0c\u4f7f\u7528\u6ed1\u7a97\u53ef\u4ee5\u5b8c\u6210\u8fd9\u4e2a\u6548\u679c\n\u00a0\u00a0// 4.\u8fc7\u6ee4\uff0c\u53ea\u7559\u4e0b\u6307\u5b9a\u9875\u9762\n\u00a0\u00a0// 5.\u8ba1\u7b97\u6307\u5b9a\u9875\u9762\u8df3\u8f6c\u7684\u603b\u6b21\u6570\uff0c\u53c8\u662fWordCount\n\u00a0\u00a0data.map(line =&gt; {\n\u00a0\u00a0\u00a0\u00a0val cols = line.split(\"_\")\n\u00a0\u00a0\u00a0\u00a0//(session_id, (page_id, action_time))\n\u00a0\u00a0\u00a0\u00a0(cols(2), (cols(3), cols(4)))\n\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0//\u4e0d\u80fd\u5728\u8fd9\u91cc\u8fc7\u6ee4\u9875\u9762\uff0c\u56e0\u4e3a\u5982\u679c\u9875\u9762\u8bbf\u95ee\u987a\u5e8f\u662f1,6,2\uff0c\u8fc7\u6ee4\u4e4b\u540e\u5c31\u4f1a\u662f1,2\uff0c\u4e8e\u662f(1,2)\u5c31\u589e\u52a0\u4e86\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0//.filter(kv =&gt; pages.contains(kv._2._1))\n\u00a0\u00a0\u00a0\u00a0//\u6309sessionID\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0.groupByKey()\n\u00a0\u00a0\u00a0\u00a0.flatMap {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case (_, page_action) =&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u6309\u65f6\u95f4\u6392\u5e8f\u540e\u53ea\u53d6page_id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val page = page_action.toList.sortBy(_._2).map(_._1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// page_id\u62c9\u94fe\uff0c(page_id, page_id)\uff0c\u62c9\u94fe\u540e\u8fc7\u6ee4\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u7136\u540e\u540e\u9762\u52a0\u4e2a1\uff0c((page_id, page_id),1)\uff0cWordCount\u5e38\u89c4\u505a\u6cd5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0page.zip(page.tail).filter(kv =&gt; hop.contains(kv)).map((_, 1))\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0//TODO \u8ba1\u7b97\u9875\u9762\u8df3\u8f6c\u7387\n\u00a0\u00a0\u00a0\u00a0.foreach(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u8ba1\u7b97\u6307\u5b9a\u9875\u9762\u7684\u8df3\u8f6c\u7387\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val percent = kv._2.toDouble / bc.value(kv._1._1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(s\"${kv._1._1} -&gt; ${kv._1._2} = ${percent}\")\n\u00a0\u00a0\u00a0\u00a0})\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/2-Spark%20%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%20%E5%92%8C%20Yarn%20Client%20%E6%A8%A1%E5%BC%8F/","title":"2-Spark \u6838\u5fc3\u7ec4\u4ef6 \u548c Yarn Client \u6a21\u5f0f","text":"<p> \u7ea6 1030 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 21 \u5206\u949f</p> <p>Spark \u6838\u5fc3\u7ec4\u4ef6 Driver Spark \u9a71\u52a8\u5668\u8282\u70b9\uff0c\u7528\u4e8e\u6267\u884c Spark \u4efb\u52a1\u4e2d\u7684 main \u65b9\u6cd5\uff0c \u4e3b\u8981\u8d1f\u8d23\uff1a</p> <ol> <li>\u5c06\u7528\u6237\u7a0b\u5e8f\u8f6c\u5316\u4e3a\u4f5c\u4e1a\uff08Job\uff09\uff1b</li> <li>\u5728 Executor \u4e4b\u95f4\u8c03\u5ea6\u4efb\u52a1\uff08Task\uff09\uff1b</li> <li>\u8ddf\u8e2a Executor \u7684\u6267\u884c\u60c5\u51b5\uff1b</li> <li>\u901a\u8fc7 UI \u5c55\u793a\u67e5\u8be2\u8fd0\u884c\u60c5\u51b5\uff1b</li> </ol> <p>Executor Spark Executor\u5bf9\u8c61\u662f\u8d1f\u8d23\u5728 Spark \u4f5c\u4e1a\u4e2d\u8fd0\u884c\u5177\u4f53\u4efb\u52a1\uff0c\u4efb\u52a1\u5f7c\u6b64\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb\u3002Spark \u5e94\u7528\u542f\u52a8\u65f6\uff0c ExecutorBackend \u8282\u70b9\u88ab\u540c\u65f6\u542f\u52a8\uff0c\u5e76\u4e14\u59cb\u7ec8\u4f34\u968f\u7740\u6574\u4e2a Spark \u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u800c\u5b58\u5728\u3002\u5982\u679c\u6709 ExecutorBackend \u8282\u70b9\u53d1\u751f\u4e86\u6545\u969c\u6216\u5d29\u6e83\uff0c Spark \u5e94\u7528\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u4f1a\u5c06\u51fa\u9519\u8282\u70b9\u4e0a\u7684\u4efb\u52a1\u8c03\u5ea6\u5230\u5176\u4ed6 Executor \u5bf9\u8c61\u4e0a\u7ee7\u7eed\u8fd0\u884c\u3002 Executor \u6709\u4e24\u4e2a\u6838\u5fc3\u529f\u80fd\uff1a</p> <ol> <li>\u8d1f\u8d23\u8fd0\u884ctask\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u9a71\u52a8\u5668\uff08Driver\uff09\uff1b</li> <li>\u5b83\u4eec\u901a\u8fc7\u81ea\u8eab\u7684\u5757\u7ba1\u7406\u5668\uff08Block Manager\uff09\u4e3a\u7528\u6237\u7a0b\u5e8f\u4e2d\u8981\u6c42\u7f13\u5b58\u7684 RDD \u63d0\u4f9b\u5185\u5b58\u5f0f\u5b58\u50a8\uff0c RDD \u662f\u76f4\u63a5\u7f13\u5b58\u5728 Executor \u8fdb\u7a0b\u5185\u7684\uff0c\u56e0\u6b64\u4efb\u52a1\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u5145\u5206\u5229\u7528\u7f13\u5b58\u6570\u636e\u52a0\u901f\u8fd0\u7b97\u3002</li> </ol> <p>Yarn Cluster\u6a21\u5f0f \u4e0e Yarn Client \u6a21\u5f0f\u7684\u533a\u522b\u4ec5\u5728\u4e8eDriver\u8fd0\u884c\u5730\u65b9\uff0cCluster\u6a21\u5f0f\u4e0bDriver\u8fd0\u884c\u5728Yarn\u96c6\u7fa4\u4e0a\uff0c\u800cclient\u6a21\u5f0f\u4e0bDriver\u8fd0\u884c\u5728\u63d0\u4ea4spark\u7a0b\u5e8f\u7684\u672c\u5730\u673a\u5668\u4e0a\uff0c\u4e24\u79cd\u6a21\u5f0f\u4e0b\u771f\u6b63\u505a\u8ba1\u7b97\u7684Executor\u90fd\u662f\u8fd0\u884c\u5728Yarn\u96c6\u7fa4\u4e0a\u3002</p> <p>Yarn Cluster \u6a21\u5f0f\uff1aCluster \u6a21\u5f0f\u5c06\u7528\u4e8e\u76d1\u63a7\u548c\u8c03\u5ea6\u7684 Driver \u6a21\u5757\u542f\u52a8\u5728 Yarn \u96c6\u7fa4\u8d44\u6e90\u4e2d\u6267\u884c\uff0c \u4e00\u822c\u5e94\u7528\u4e8e\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u3002 \u6ce8\u610f\uff1a SparkSubmit\u3001ApplicationMaster \u548c YarnCoarseGrainedExecutorBackend \u662f\u72ec\u7acb\u7684\u8fdb\u7a0b\uff1b Driver\u662f\u72ec\u7acb\u7684\u7ebf\u7a0b\uff1b Executor \u548c YarnClusterApplication \u662f\u5bf9\u8c61\u3002\u4f46\u662f\u7ecf\u5e38\u4e0d\u5177\u4f53\u533a\u5206YarnCoarseGrainedExecutorBackend \u548c Executor\u5bf9\u8c61\uff0c\u800c\u662f\u76f4\u63a5\u79f0\u4e3aExecutor\u3002 Yarn Cluster \u6a21\u5f0f\u4e0bSpark\u7a0b\u5e8f\u7684\u63d0\u4ea4\u6d41\u7a0b\u5982\u4e0b\uff1a  1. \u6267\u884c\u811a\u672c\u63d0\u4ea4\u4efb\u52a1\uff0c\u5b9e\u9645\u4e0a\u662f\u542f\u52a8\u4e00\u4e2a\u540d\u53eb SparkSubmit \u7684 JVM \u8fdb\u7a0b 2. SparkSubmit \u7c7b\u7684 main \u65b9\u6cd5\u53cd\u5c04\u8c03\u7528 YarnClusterApplication \u7684 main \u65b9\u6cd5\uff0cYarnClusterApplication \u521b\u5efa Yarn \u5ba2\u6237\u7aef\uff0c\u7136\u540e\u5411 ResourceManager \u53d1\u9001\u6267\u884c\u6307\u4ee4\uff1abin/java ApplicationMaster 3. ResourceManager \u6536\u5230\u6307\u4ee4\u540e\u4f1a\u5728\u6307\u5b9a\u7684 NodeManager \u4e2d\u542f\u52a8 ApplicationMaster 4. ApplicationMaster \u542f\u52a8 Driver \u7ebf\u7a0b\uff0c\u6267\u884c\u7528\u6237\u7684\u4f5c\u4e1a 5. ApplicationMaster \u5411 ResourceManager \u6ce8\u518c\uff0c\u7533\u8bf7\u8d44\u6e90 6. ResourceManager\u8fd4\u56de\u53ef\u7528\u8d44\u6e90\u5217\u8868 7. \u83b7\u53d6\u8d44\u6e90\u540e ApplicationMaster \u5411 NodeManager \u53d1\u9001\u6307\u4ee4\uff1a bin/java YarnCoarseGrainedExecutorBackend \u542f\u52a8 Executor 8. YarnCoarseGrainedExecutorBackend \u542f\u52a8\u540e\u5411 Driver \u6ce8\u518c 9. Driver \u8fd4\u56de\u6ce8\u518c\u6210\u529f\u7684\u6d88\u606f 10.YarnCoarseGrainedExecutorBackend\u521b\u5efaExecutor\u8ba1\u7b97\u5bf9\u8c61\u7b49\u5f85\u63a5\u6536\u4efb\u52a1</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/2-Spark%20%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%20%E5%92%8C%20Yarn%20Client%20%E6%A8%A1%E5%BC%8F/#spark","title":"Spark\u8fd0\u884c\u6a21\u5f0f\u6709\u54ea\u4e9b\uff1f\u5de5\u4f5c\u6d41\u7a0b\u662f\u600e\u4e48\u6837\u7684\uff1f","text":"<p>Spark\u7684\u8fd0\u884c\u6a21\u5f0f\u5305\u62ecLocal\u3001Standalone\u3001Yarn\u3001Mesos\u3001k8s\u51e0\u79cd\u3002\u5176\u4e2dLocal\u6a21\u5f0f\u4ec5\u7528\u4e8e\u672c\u5730\u5f00\u53d1\uff0cMesos\u6a21\u5f0f\u56fd\u5185\u51e0\u4e4e\u4e0d\u7528\u3002\u5728\u516c\u53f8\u4e2d\u56e0\u4e3a\u5927\u6570\u636e\u670d\u52a1\u57fa\u672c\u642d\u8f7dYarn\u96c6\u7fa4\u8c03\u5ea6\uff0c\u56e0\u6b64Spark On Yarn\u6a21\u5f0f\u4f1a\u7528\u7684\u6bd4\u8f83\u591a\u3002 Standalone\u6a21\u5f0f\uff1a Standalone\u6a21\u5f0f\u662fSpark\u5185\u7f6e\u7684\u8fd0\u884c\u6a21\u5f0f\uff0c\u5e38\u7528\u4e8e\u5c0f\u578b\u6d4b\u8bd5\u96c6\u7fa4\uff0c\u5176\u4e2d:</p> <ul> <li>Master\u4e3a\u8d44\u6e90\u8c03\u5ea6\u5668\uff0c\u8d1f\u8d23executors\u8d44\u6e90\u8c03\u5ea6</li> <li>Worker\u8d1f\u8d23Executor\u8fdb\u7a0b\u7684\u542f\u52a8\u548c\u76d1\u63a7</li> <li>Driver\u5728\u5ba2\u6237\u7aef\u542f\u52a8\uff0c\u8d1f\u8d23SparkContext\u521d\u59cb\u5316</li> </ul> <p></p> <ol> <li>Driver\u5728\u5ba2\u6237\u7aef\u542f\u52a8\uff0c\u5411\u5ba2\u6237\u7aef\u63d0\u4ea4job\u4e4b\u540e\uff0cDriver\u521d\u59cb\u5316SparkContext\uff0cSparkContext \u5305\u62ec DAGScheduler \u548c TaskScheduler\u3002DAGScheduler\u8d1f\u8d23\u4e3a\u6bcf\u4e2ajob\u751f\u6210DAG\u6709\u5411\u65e0\u73af\u56fe\u5e76\u5212\u5206stage\uff0c\u7136\u540e\u63d0\u4ea4taskset\u7ed9TaskScheduler\uff1bTaskScheduler\u8d1f\u8d23task\u4efb\u52a1\u8c03\u5ea6\u5de5\u4f5c\u3002</li> <li>Driver\u5411Master\u6ce8\u518c\u7533\u8bf7\u8d44\u6e90</li> <li>Master\u8ba9Worker\u542f\u52a8Executor</li> <li>Executor\u5411Driver\u53cd\u5411\u6ce8\u518c</li> <li>Driver\u628ataskset\u53d1\u9001\u5230Executor\u4e0a</li> <li>Executor\u542f\u52a8\u7ebf\u7a0b\u6267\u884ctask</li> </ol> <p>Yarn Client\u6a21\u5f0f\uff1a Yarn Client\u6a21\u5f0f \u548c Standalone\u6a21\u5f0f\u4e00\u6837\uff0cDriver\u5728\u5ba2\u6237\u7aef\u542f\u52a8</p> <p></p> <p>Yarn Cluster\u6a21\u5f0f\uff1a \u4e0eYarn Client\u6a21\u5f0f\u4e0d\u540c\uff0cYarn Cluster\u6a21\u5f0f\u7684Driver\u5728Yarn\u7684NodeManager\u4e0a\u542f\u52a8\u8fd0\u884c\u3002</p> <p></p> <ol> <li>\u5ba2\u6237\u7aef\u5411ResourceManager\u63d0\u4ea4\u4efb\u52a1\uff0cResourceManager\u5c06\u4efb\u52a1\u52a0\u5165\u5230\u961f\u5217\u4e2d\u3002</li> <li>NodeManager\u9886\u53d6\u4efb\u52a1\u542f\u52a8ApplicationMaster\uff0cApplicationMaster \u542f\u52a8 Driver\uff0cDriver\u521d\u59cb\u5316SparkContext\u3001DAGScheduler\u3001TaskScheduler\uff0cDAGScheduler\u8d1f\u8d23DAG\u751f\u6210\u3001Stage\u5212\u5206\uff0cTaskScheduler\u8d1f\u8d23\u5206\u9636\u6bb5\u8c03\u5ea6taskset\u6267\u884c\u3002</li> <li>Driver\u9996\u5148\u5c06\u7b2c\u4e00\u4e2a\u9636\u6bb5\u7684task\u52a0\u5165\u5230\u961f\u5217\u4e2d\uff0cNodeManager \u9886\u53d6\u5230\u4efb\u52a1\u4e4b\u540e\u542f\u52a8Executor\uff0cExecutor\u5411Driver\u53cd\u5411\u6ce8\u518c\uff0c\u4e4b\u540eExecutor\u542f\u52a8\u7ebf\u7a0b\u6267\u884ctask\u3002</li> <li>\u7136\u540eDriver\u8c03\u5ea6\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684taskset\u6267\u884c\u3002</li> </ol>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/20-SparkSQL%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E4%BD%BF%E7%94%A8/","title":"20-SparkSQL\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528","text":"<p> \u7ea6 1580 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 32 \u5206\u949f</p> <p>\u4e0b\u56fe\u662fSpark\u7684\u6838\u5fc3\u6a21\u5757\uff0c\u53ef\u89c1SparkSQL\u662f\u5728SparkCore\u4e0a\u7684\u4e00\u4e2a\u6269\u5c55\uff0c \u662f\u7528\u6765\u64cd\u4f5c\u7ed3\u6784\u5316\u6570\u636e\u7684\u7ec4\u4ef6\uff0c \u7528\u6237\u901a\u8fc7 SparkSQL \u53ef\u4ee5\u4f7f\u7528 SQL \u6216\u8005 Apache Hive \u7248\u672c\u7684 SQL \u65b9\u8a00\uff08HQL\uff09\u6765\u67e5\u8be2\u6570\u636e\uff0cSparkSQL\u4f1a\u5c06SQL\u8f6c\u6362\u6210RDD\u6765\u8fd0\u884c\u3002 </p> <p>SparkSQL\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7f16\u7a0b\u62bd\u8c61\uff1a DataFrame \u548c DataSet\u3002</p> <p>DataFrame \u56e0\u4e3aSparkSQL\u662f\u6784\u5efa\u5728SparkCore\u4e0a\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u6240\u4ee5DataFrame\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9RDD\u66f4\u8fdb\u4e00\u6b65\u7684\u5c01\u88c5\uff0cRDD\u5e76\u4e0d\u5173\u5fc3\u6570\u636e\u6e90\u662f\u4ec0\u4e48\u7ed3\u6784\uff08\u610f\u601d\u662fRDD\u5e76\u6ca1\u6709\u76f4\u63a5\u9488\u5bf9\u6570\u636e\u6e90\u6570\u636e\u7ed3\u6784\u67e5\u8be2\u7684API\uff0c\u9700\u8981\u7a0b\u5e8f\u5458\u76f4\u63a5\u53bb\u5904\u7406\u6bcf\u4e00\u6761\u6570\u636e\uff09\uff0c\u4f46DataFrame\u662f\u9488\u5bf9\u7ed3\u6784\u5316\u6570\u636e\u7684\u67e5\u8be2\uff0c\u6240\u4ee5DataFrame\u662f\u9700\u8981\u6570\u636e\u5177\u6709\u8868\u7ed3\u6784\u7684\uff0cDataFrame\u63d0\u4f9b\u9488\u5bf9\u6570\u636e\u7684\u7ed3\u6784\u8fdb\u884c\u67e5\u8be2\u7684API\uff0c\u5373\u53ef\u4ee5\u901a\u8fc7SQL\u8bed\u53e5\u6765\u67e5\u8be2\uff08\u4e0d\u9700\u8981\u7a0b\u5e8f\u5458\u76f4\u63a5\u5904\u7406\u6bcf\u4e00\u6761\u6570\u636e\uff0c\u800c\u662f\u76f4\u63a5\u901a\u8fc7SQL\u8bed\u53e5\u6765\u8868\u8fbe\u5148\u67e5\u8be2\u4ec0\u4e48\u6570\u636e\uff0cSparkSQL\u4f1a\u5c06SQL\u8bed\u53e5\u8f6c\u6362\u6210RDD\u6765\u8fd0\u884c\uff09\u3002 \u5728 Spark SQL \u4e2d SparkSession \u662f\u521b\u5efa DataFrame \u548c\u6267\u884c SQL \u7684\u5165\u53e3\uff0c\u521b\u5efa DataFrame \u6709\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>\u901a\u8fc7\u6570\u636e\u6e90\uff08\u6587\u4ef6\u7b49\uff09\u521b\u5efa</li> <li>\u4ece\u4e00\u4e2a\u5b58\u5728\u7684 RDD \u8fdb\u884c\u8f6c\u6362</li> <li>\u4ece HiveTable \u8fdb\u884c\u67e5\u8be2\u8fd4\u56de</li> </ol> <p>\u4e00\u3001\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528 \u547d\u4ee4\u884c\u4e2d\u7528\u4e8e\u521b\u5efaRDD\u7684\u73af\u5883\u5bf9\u8c61\u662fsc\uff0c\u7528\u4e8e\u521b\u5efaDataFrame\u7684\u73af\u5883\u5bf9\u8c61spark </p> <p>1 \u901a\u8fc7\u6587\u4ef6\u521b\u5efa DataFrame \uff0c\u4ee5\u4e0b\u76f4\u63a5\u4ecejson\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7ed3\u6784\u5316\u7684\u6570\u636e\uff1a Text Only<pre><code>{\"name\": \"zhangsan\", \"age\": 18}\n{\"name\": \"lisi\", \"age\": 20}\n{\"name\": \"wangwu\", \"age\": 21}\n</code></pre> Text Only<pre><code>val df = spark.read.json(\"../data/sql/user.json\")\n</code></pre> Text Only<pre><code>\u8fd4\u56de\u7ed3\u679c\uff1adf: org.apache.spark.sql.DataFrame = [age: bigint, name: string]\n</code></pre> \u5982\u679c\u4ece\u5185\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c spark \u53ef\u4ee5\u77e5\u9053\u6570\u636e\u7c7b\u578b\u5177\u4f53\u662f\u4ec0\u4e48\u3002 \u5982\u679c\u662f\u6570\u5b57\uff0c\u9ed8\u8ba4\u4f5c\u4e3a Int \u5904\u7406\uff1b\u4f46\u662f\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7684\u6570\u5b57\uff0c\u4e0d\u80fd\u786e\u5b9a\u662f\u4ec0\u4e48\u7c7b\u578b\uff0c\u6240\u4ee5\u7528 bigint \u63a5\u6536\uff0c\u53ef\u4ee5\u548cLong \u7c7b\u578b\u8f6c\u6362\uff0c\u4f46\u662f\u548c Int \u4e0d\u80fd\u8fdb\u884c\u8f6c\u6362\u3002</p> <p>2 \u5c55\u793a\u7ed3\u679c\uff1a Text Only<pre><code>df.show\n</code></pre> Text Only<pre><code>+---+--------+\n|age| \u00a0 \u00a0name|\n+---+--------+\n| 18|zhangsan|\n| 20| \u00a0 \u00a0lisi|\n| 21| \u00a0wangwu|\n+---+--------+\n</code></pre></p> <p>3 \u4f7f\u7528SQL\u8bed\u53e5\u67e5\u8be2\u9700\u8981\u5148\u5bf9 DataFrame \u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u89c6\u56fe: Text Only<pre><code>df.createTempView(\"user\")\u00a0 //\u521b\u5efa\u4e34\u65f6\u89c6\u56fe\uff0c\u5982\u679c\u5df2\u5b58\u5728\u5c31\u62a5\u9519\ndf.createOrReplaceTempView(\"user\")\u00a0 //\u521b\u5efa\u4e34\u65f6\u89c6\u56fe\uff0c\u5982\u679c\u5df2\u5b58\u5728\u5c31\u66ff\u6362\ndf.createGlobalTempView(\"user\") \u00a0//\u521b\u5efa\u5168\u5c40\u4e34\u65f6\u89c6\u56fe\uff0c\u5982\u679c\u5df2\u5b58\u5728\u5c31\u62a5\u9519\uff0c\u5168\u5c40\u89c6\u56fe\u53ef\u4ee5\u8de8\u4f1a\u8bdd\u4f7f\u7528\ndf.createOrReplaceGlobalTempView(\"user\") //\u521b\u5efa\u5168\u5c40\u4e34\u65f6\u89c6\u56fe\uff0c\u5982\u679c\u5df2\u5b58\u5728\u5c31\u66ff\u6362\uff0c\u5168\u5c40\u89c6\u56fe\u53ef\u4ee5\u8de8\u4f1a\u8bdd\u4f7f\u7528\n</code></pre></p> <p>4 \u4f7f\u7528SQL\u8bed\u53e5\u5728\u89c6\u56fe\u4e0a\u67e5\u8be2\uff0c\u8fd4\u56de\u7684\u8fd8\u662f\u4e00\u4e2aDataFrame Text Only<pre><code>val row = spark.sql(\"select * from user where age=18\")\nrow: org.apache.spark.sql.DataFrame = [age: bigint, name: string]\n</code></pre></p> <p>5 \u521b\u5efa\u5168\u5c40\u4e34\u65f6\u89c6\u56fe Text Only<pre><code>df.createOrReplaceGlobalTempView(\"emp\")\n</code></pre> \u8de8\u4f1a\u8bdd\u4f7f\u7528 Text Only<pre><code>spark.newSession.sql(\"select * from global_temp.emp\").show\n</code></pre></p> <p>\u4ece\u4e0a\u9762\u6267\u884cSQL\u8bed\u53e5\u7684\u8fc7\u7a0b\u53ef\u4ee5\u770b\u5230\uff0cspark.sql\u662f\u5728DataFrame\u521b\u5efa\u89c6\u56fe\u4e4b\u4e0a\u6267\u884c\u7684\uff0c\u6240\u4ee5saprk.sql\u6240\u6267\u884c\u7684sql\u8bed\u53e5\u662f\u4e0d\u80fd\u4fee\u6539\u6570\u636e\u7684\uff0c\u5f53\u7136\u6211\u4eec\u4e00\u76f4\u4e5f\u90fd\u4e0d\u9700\u8981\u4fee\u6539\u6570\u636e\uff0cRDD\u4e5f\u4e0d\u80fd\u4fee\u6539\u6570\u636e\u6e90\u4e2d\u7684\u6570\u636e\uff0cspark.sql\u548cRDD\u90fd\u53ea\u662f\u505a\u8ba1\u7b97\u5206\u6790\u7684\uff0c\u6570\u636e\u7684\u589e\u5220\u6539\u67e5\u662f\u6570\u636e\u5e93\u7684\u4e8b\u3002 \u53e6\u5916\u8fd8\u53ef\u4ee5\u770b\u5230DataFrame\u521b\u5efa\u89c6\u56fe\u540esql\u7684\u6267\u884c\u662f\u4e0eDataFrame\u65e0\u5173\u7684\uff0c\u90a3\u6211\u4eec\u80fd\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528DataFrame\u8fdb\u884c\u67e5\u8be2\u5462\uff0c\u5c31\u50cfRDD\u8c03\u7528\u7b97\u5b50\u4e00\u6837\uff0c\u7b54\u6848\u662f\u53ef\u4ee5\u7684\uff0c\u90a3\u5c31\u662f\u4f7f\u7528DSL (domain-specific language, DSL) \uff0c\u56e0\u4e3aDataFrame\u662f\u5305\u542b\u5217\u4fe1\u606f\u7684\uff0c\u6240\u4ee5\u4f7f\u7528\u5b83\u7684\u65b9\u6cd5\u6765\u67e5\u8be2\u548c\u8ba1\u7b97\u662f\u6bd4\u76f4\u63a5\u4f7f\u7528RDD\u66f4\u9ad8\u4e00\u5c42\u7684\uff0c\u53ef\u4ee5\u8bf4\u4f7f\u7528DSL\u5c31\u76f8\u5f53\u4e8e\u662f\u628aSQL\u8bed\u53e5\u6362\u6210API\u8c03\u7528\u7684\u65b9\u5f0f\uff0c\u5e76\u4e14DSL\u8fd8\u63d0\u4f9b\u4e86\u8bb8\u591a\u5176\u5b83\u529f\u80fd\u7684\u51fd\u6570\u3002 \u65e2\u7136\u76f4\u63a5\u4f7f\u7528DataFrame\u7684API\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f7f\u7528DSL\u4e0d\u7528\u518d\u521b\u5efa\u4e34\u65f6\u89c6\u56fe\u4e86\u3002 6 \u67e5\u770b DataFrame \u7684 Schema \u4fe1\u606f Text Only<pre><code>df.printSchema\n</code></pre> Text Only<pre><code>root\n|-- age: long (nullable = true)\n|-- name: string (nullable = true)\n</code></pre></p> <p>7 \u67e5\u770b\"age\"\u5217\u6570\u636e Text Only<pre><code>val res = df.select(\"age\")\nres: org.apache.spark.sql.DataFrame = [age: bigint]\n</code></pre> Text Only<pre><code>res.show\n</code></pre> Text Only<pre><code>+---+\n|age|\n+---+\n| 18|\n| 20|\n| 21|\n+---+\n</code></pre></p> <p>8 \u5c06\u67e5\u8be2\u5230\u7684age\u5217\u7684\u6570\u636e\u52a01\uff0c\u6d89\u53ca\u5230\u8fd0\u7b97\u7684\u65f6\u5019, \u6bcf\u5217\u90fd\u5fc5\u987b\u4f7f\u7528$, \u6216\u8005\u91c7\u7528\u5355\u5f15\u53f7\u8868\u8fbe\u5f0f\uff1a\u5355\u5f15\u53f7+\u5b57\u6bb5\u540d Text Only<pre><code>df.select($\"name\", $\"age\" + 1).show\ndf.select('name, 'age + 1).show\n</code></pre></p> <p>9 \u7ed9\u5217\u8d77\u4e00\u4e2a\u522b\u540d Text Only<pre><code>df.select('name, 'age + 1 as \"newage\").show\n</code></pre></p> <p>10 \u8fc7\u6ee4\u6570\u636e Text Only<pre><code>df.filter($\"age\"&gt;20).show\n</code></pre></p> <p>11 \u5206\u7ec4\u7edf\u8ba1 Text Only<pre><code>df.groupBy(\"age\").count.show\n</code></pre> Text Only<pre><code>+---+-----+\n|age|count|\n+---+-----+\n| 18|\u00a0\u00a0\u00a0\u00a01|\n| 21|\u00a0\u00a0\u00a0\u00a01|\n| 20|\u00a0\u00a0\u00a0\u00a01|\n+---+-----+\n</code></pre></p> <p>DataSet DataFrame\u63d0\u4f9b\u9488\u5bf9\u6570\u636e\u5177\u4f53\u7ed3\u6784\u7684\u67e5\u8be2\uff0c\u4f46\u662f\u8fd9\u79cd\u67e5\u8be2\u662f\u9488\u5bf9\u5217\u8fdb\u884c\uff0c\u6709\u65f6\u8fd8\u9700\u8981\u5c06\u4e00\u884c\u6570\u636e\u76f4\u63a5\u770b\u4f5c\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u6837\u901a\u8fc7\u5bf9\u8c61\u6765\u64cd\u4f5c\u6570\u636e\u5c31\u66f4\u52a0\u65b9\u4fbf\uff0c\u6240\u4ee5DataSet\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9DataFrame\u7684\u518d\u4e00\u6b21\u5c01\u88c5\uff0cDataSet\u5728\u67e5\u8be2\u6570\u636e\u65f6\u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528SQL\u53ea\u9488\u5bf9\u5217\u8fdb\u884c\uff0c\u8fd8\u53ef\u4ee5\u628a\u67e5\u8be2\u5230\u7684\u7ed3\u679c\u7684\u6bcf\u4e00\u884c\u90fd\u770b\u4f5c\u662f\u4e00\u4e2a\u5bf9\u8c61\u76f4\u63a5\u4f7f\u7528\u3002 \u4eceRDD\u4e2d\u521b\u5efaDataSet \u5148\u521b\u5efaRDD Text Only<pre><code>case class User(name: String, age: Int)\nval rdd = sc.makeRDD(List(User(\"zhangsan\",18), User(\"lisi\", 19), User(\"wangwu\", 20)))\nrdd: org.apache.spark.rdd.RDD[User] = ParallelCollectionRDD[55]\n</code></pre> RDD \u8f6c\u6362\u6210 DataSet Text Only<pre><code>val ds = rdd.toDS\n</code></pre> Text Only<pre><code>ds.show\n+--------+---+\n|\u00a0\u00a0\u00a0\u00a0name|age|\n+--------+---+\n|zhangsan| 18|\n|\u00a0\u00a0\u00a0\u00a0lisi| 19|\n|\u00a0\u00a0wangwu| 20|\n+--------+---+\n</code></pre></p> <p>RDD\u3001DataFrame\u3001DataSet \u4e09\u8005\u4e4b\u95f4\u7684\u8f6c\u6362\uff1a</p> <p>1.RDD \u4e0e DataFrame \u4e4b\u95f4\u7684\u8f6c\u6362 \u5148\u5b9a\u4e49\u4e00\u4e2a\u6837\u4f8b\u7c7b Text Only<pre><code>case class User(name: String, age: Int)\n</code></pre> \u518d\u521b\u5efa\u4e00\u4e2aRDD Text Only<pre><code>val rdd = sc.makeRDD(List(User(\"zhangsan\",18), User(\"lisi\", 19), User(\"wangwu\", 20)))\nrdd: org.apache.spark.rdd.RDD[User] = ParallelCollectionRDD[55]\n</code></pre> \u5c06 RDD \u8f6c\u6362\u4e3a DataFrame Text Only<pre><code>val df =\u00a0rdd.toDF\ndf: org.apache.spark.sql.DataFrame = [name: string, age: int]\n</code></pre> Text Only<pre><code>df.show\n+--------+---+\n|\u00a0\u00a0\u00a0\u00a0name|age|\n+--------+---+\n|zhangsan| 18|\n|\u00a0\u00a0\u00a0\u00a0lisi| 19|\n|\u00a0\u00a0wangwu| 20|\n+--------+---+\n</code></pre> \u518d\u5c06DataFrame\u8f6c\u6362\u6210RDD\uff0c\u4f1a\u53d1\u73b0RDD\u7684\u7c7b\u578b\u4e0d\u518d\u662fUser\uff0c\u800c\u662forg.apache.spark.sql.Row Text Only<pre><code>val rdd1 = df.rdd\nrdd1: org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = MapPartitionsRDD[63] at rdd at &lt;console&gt;:25\n</code></pre></p> <p>2.DataSet \u4e0e DataFrame \u4e4b\u95f4\u7684\u8f6c\u6362 DataFrame \u5230\u00a0 DataSet \u53ef\u4ee5\u770b\u4f5c\u662f\u7ed9\u8868\u7684\u6240\u6709\u5217\u52a0\u4e0a\u4e00\u4e2a\u7c7b\u578b\u4fe1\u606f Text Only<pre><code>val df = spark.read.json(\"../data/sql/user.json\")\ndf: org.apache.spark.sql.DataFrame = [age: bigint, name: string]\n</code></pre> \u6ce8\u610f\u4e0a\u9762\u7684age\u662fbigint\uff0c\u6240\u4ee5\u521b\u5efa\u7684\u6837\u4f8b\u7c7b\u7684age\u5fc5\u987b\u662fLong Text Only<pre><code>case class User(name: String, age: Long)\n</code></pre> DataFrame \u8f6c\u6362\u6210\u00a0 DataSet\uff0c\u5176\u5b9eDataFrame\u6b63\u5f0f\u7c7b\u578b\u662fDataset[Row]\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c06DataFrame \u8f6c\u6362\u6210 Dataset[User] \u53ea\u662f\u5c06Row\u7c7b\u578b\u53d8\u6210User\u7c7b\u578b\u3002 Text Only<pre><code>val ds = df.as[User]\nds: org.apache.spark.sql.Dataset[User] = [age: bigint, name: string]\n</code></pre> \u518d\u5c06DataSet\u8f6c\u6362\u6210DataFrame Text Only<pre><code>val df = ds.toDF\ndf: org.apache.spark.sql.DataFrame = [age: bigint, name: string]\n</code></pre></p> <p>3.RDD \u4e0e DataSet \u4e4b\u95f4\u7684\u8f6c\u6362 RDD \u8f6c\u6362\u6210 DataSet \u9700\u8981\u6bcf\u4e2a\u5143\u7d20\u6709\u7edf\u4e00\u7684\u7ed3\u6784\uff0c\u6700\u597d\u90fd\u662f\u4e00\u4e2a\u6837\u4f8b\u7c7b\u7684\u5bf9\u8c61\u3002 \u5148\u521b\u5efa\u4e00\u4e2aRDD Text Only<pre><code>case class User(name: String, age: Int)\nval rdd = sc.makeRDD(List(User(\"zhangsan\",18), User(\"lisi\", 19), User(\"wangwu\", 20)))\nrdd: org.apache.spark.rdd.RDD[User] = ParallelCollectionRDD[55]\n</code></pre> RDD \u8f6c\u6362\u6210 DataSet Text Only<pre><code>val ds = rdd.toDS\nds: org.apache.spark.sql.Dataset[User] = [name: string, age: int]\n</code></pre> DataSet\u00a0\u8f6c\u6362\u6210\u00a0RDD Text Only<pre><code>val rdd = ds.rdd\nrdd: org.apache.spark.rdd.RDD[User] = MapPartitionsRDD[30]\n</code></pre></p> <p></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/21-SparkSQL%20IDEA%E4%B8%AD%E4%BD%BF%E7%94%A8/","title":"21-SparkSQL IDEA\u4e2d\u4f7f\u7528","text":"<p> \u7ea6 628 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>\u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spark-sql_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>DataFrame 1.\u521b\u5efa\u548c\u5c55\u793a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0// TODO DataFrame\n\u00a0\u00a0val df: DataFrame = spark.read.json(\"data/user.json\")\n\u00a0\u00a0df.show()\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p> <p>2.SQL Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0// TODO DataFrameSQL\n\u00a0\u00a0val df: DataFrame = spark.read.json(\"data/user.json\")\n\u00a0 `df.createOrReplaceTempView(\"user\")`\n\u00a0\u00a0spark.sql(\"select name,age from user\").show\n\u00a0\u00a0spark.sql(\"select avg(age) from user\").show\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p> <p>3.DSL Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0// TODO DataFrame DSL\n `// \u5728\u4f7f\u7528DataFrame\u65f6\uff0c\u5982\u679c\u6d89\u53ca\u5230\u8f6c\u6362\u64cd\u4f5c\uff0c\u9700\u8981\u5f15\u5165\u8f6c\u6362\u89c4\u5219\uff0cimplicits\u662fspark\u5bf9\u8c61\u91cc\u9762\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u91cc\u9762\u5305\u542b\u7740\u6240\u6709\u9690\u5f0f\u8f6c\u6362\u6240\u9700\u8981\u7684\u4e1c\u897f`\n `import spark.implicits._`\n\u00a0\u00a0val df: DataFrame = spark.read.json(\"data/user.json\")\n `df.select($\"name\", $\"age\" + 1).show`\n `df.select('name, 'age + 1).show`\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p> <p>DataSet 1.\u521b\u5efa\u548c\u5c55\u793a Text Only<pre><code>case class User(name: String, age: Int)\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0import spark.implicits._\n\u00a0\u00a0// TODO DataSet\n\u00a0\u00a0val list = List(User(\"zhangsan\", 18), User(\"lisi\", 19), User(\"wangwu\", 20))\n `//toDS\u4e0d\u662fList\u7684\u65b9\u6cd5\uff0c\u8fd9\u91cc\u5e94\u8be5\u662f\u9690\u5f0f\u8f6c\u6362\uff0c\u9690\u5f0f\u8f6c\u6362\u771f\u7684\u7279\u522b\u590d\u5408\u5f00\u95ed\u539f\u5219`\n `val ds: Dataset[User] = list.toDS()`\n\u00a0\u00a0ds.show()\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p> <p>2.DataFrame\u5176\u5b9e\u5c31\u662f\u6cdb\u578b\u662fRow\u7684DataSet\uff0c\u6240\u4ee5DataFrame\u7684\u65b9\u6cd5DataSet\u90fd\u80fd\u7528 Text Only<pre><code>type DataFrame = org.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\n</code></pre></p> <p>RDD \u3001DataFrame \u3001DataSet \u4e09\u8005\u4e4b\u95f4\u7684\u8f6c\u6362 1.RDD \u4e0e DataFrame \u4e4b\u95f4\u7684\u8f6c\u6362 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0import spark.implicits._\n\n\u00a0\u00a0// TODO RDD \u4e0e DataFrame \u4e4b\u95f4\u7684\u8f6c\u6362\n\u00a0\u00a0// RDD =&gt; DataFrame\n `val rdd = spark.sparkContext.makeRDD(List((1, \"zhangsan\", 30), (2, \"lisi\", 40)))`\n `val df: DataFrame = rdd.toDF(\"id\", \"name\", \"age\")`\n\u00a0\u00a0df.show\n\n\u00a0\u00a0// DataFrame =&gt; RDD\n `val rowRDD: RDD[Row] = df.rdd`\n\u00a0\u00a0rowRDD.collect.foreach(println)\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p> <p>2.DataFrame \u4e0e DataSet \u4e4b\u95f4\u7684\u8f6c\u6362 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0import spark.implicits._\n\u00a0\u00a0val rdd = spark.sparkContext.makeRDD(List(User(\"zhangsan\",18), User(\"lisi\", 19), User(\"wangwu\", 20)))\n\u00a0\u00a0val df = rdd.toDF()\n\n\u00a0\u00a0// TODO DataFrame \u4e0e DataSet \u4e4b\u95f4\u7684\u8f6c\u6362\n\u00a0\u00a0// DataFrame =&gt; DataSet\n\u00a0 `val ds: Dataset[User] = df.as[User]`\n\u00a0\u00a0ds.show\n\n\u00a0\u00a0// DataSet =&gt; DataFrame\n `val df1 = ds.toDF()`\n\u00a0\u00a0df1.show\n\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\ncase class User(name: String, age: Int)\n</code></pre></p> <p>3.RDD \u4e0e DataSet \u4e4b\u95f4\u7684\u8f6c\u6362 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0import spark.implicits._\n\u00a0\u00a0val rdd = spark.sparkContext.makeRDD(List(User(\"zhangsan\", 18), User(\"lisi\", 19), User(\"wangwu\", 20)))\n\n\u00a0\u00a0// TODO RDD \u4e0e DataSet \u4e4b\u95f4\u7684\u8f6c\u6362\n\u00a0\u00a0// RDD =&gt; DataSet\n `val ds = rdd.toDS()`\n\u00a0\u00a0ds.show\n\n\u00a0\u00a0// DataSet =&gt; RDD\n `val userRDD: RDD[User] = ds.rdd`\n\u00a0\u00a0userRDD.collect.foreach(println)\n\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n\ncase class User(name: String, age: Int)\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/22-SparkSQL%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/","title":"22-SparkSQL\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p> \u7ea6 1018 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 20 \u5206\u949f</p> <p>UDF\uff0c\u4e00\u8fdb\u4e00\u51fa \u7528\u6237\u53ef\u4ee5\u901a\u8fc7 spark.udf \u529f\u80fd\u6dfb\u52a0\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u5b9e\u73b0\u81ea\u5b9a\u4e49\u529f\u80fd\u3002\u4ee5\u4e0b\u7ed9\u67e5\u8be2\u51fa\u6765\u7684name\u52a0\u4e00\u4e2a\u524d\u7f00 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0import spark.implicits._\n\n\u00a0val df = spark.read.json(\"data/user.json\")\n\u00a0df.createOrReplaceTempView(\"user\")\n `spark.udf.register(\"prefix\", (name: String) =&gt; {`\n `\"UDF: \" + name`\n `})`\n\n\u00a0spark.sql(\"select age, `prefix(name)` from user\").show\n\n\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0spark.close()\n}\n</code></pre></p> <p>UDAF\uff0c\u805a\u5408\u51fd\u6570\uff0c\u591a\u8fdb\u4e00\u51fa \u81ea\u5b9a\u4e49\u805a\u5408\u51fd\u6570\u7684\u8981\u7d20\u662f\u5b9a\u4e49\u7f13\u5b58\u533a\uff0c\u5373\u6bcf\u904d\u5386\u4e00\u6761\u6570\u636e\u5e94\u8be5\u5982\u4f55\u66f4\u65b0\u7f13\u51b2\u533a\u4e2d\u7684\u503c\uff0c\u4ee5\u53ca\u6700\u540e\u5982\u4f55\u901a\u8fc7\u7f13\u51b2\u533a\u4e2d\u7684\u503c\u8ba1\u7b97\u5f97\u5230\u6700\u540e\u7684\u7ed3\u679c\u3002  \u81ea\u5b9a\u4e49\u7b97\u5e73\u5747\u503c\u7684\u51fd\u6570 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0val df: DataFrame = spark.read.json(\"data/user.json\")\n\u00a0df.createOrReplaceTempView(\"user\")\n\n`//\u6ce8\u518c\u81ea\u5b9a\u4e49\u7684\u805a\u5408\u51fd\u6570`\n `spark.udf.register(\"myAvg\", functions.udaf(new MyAvgUDAF()))`\n\u00a0spark.sql(\"select myAvg(age) from user\").show\n\n\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0spark.close()\n}\n</code></pre> Text Only<pre><code>/**\n* \u7f13\u51b2\u533a\u6837\u4f8b\u7c7b\n* @param total \u6570\u636e\u7684\u603b\u548c\n* @param count \u6570\u636e\u7684\u603b\u6761\u6570\n*/\ncase class Buff(var total: Long, var count: Long)\n\n/**\n* \u81ea\u5b9a\u4e49\u805a\u5408\u51fd\u6570\u7c7b\uff1a\u8ba1\u7b97\u5e73\u5747\u503c\n* 1. \u7ee7\u627forg.apache.spark.sql.expressions.Aggregator, \u5b9a\u4e49\u6cdb\u578b\n* \u00a0IN : \u8f93\u5165\u7684\u6570\u636e\u7c7b\u578b Long\n* \u00a0BUF : \u7f13\u51b2\u533a\u7684\u6570\u636e\u7c7b\u578b Buff\n* \u00a0OUT : \u8f93\u51fa\u7684\u6570\u636e\u7c7b\u578b Long\n* 2. \u91cd\u51996\u4e2a\u65b9\u6cd5\n*/\nclass MyAvgUDAF extends Aggregator[Long, Buff, Long] {\n\u00a0// zero : \u521d\u59cb\u503c\u6216\u96f6\u503c\n\u00a0// \u7f13\u51b2\u533a\u7684\u521d\u59cb\u5316\n\u00a0override def zero: Buff = {\n\u00a0 \u00a0Buff(0L, 0L)\n\u00a0}\n\n\u00a0// \u6839\u636e\u8f93\u5165\u7684\u6570\u636e\u66f4\u65b0\u7f13\u51b2\u533a\u7684\u6570\u636e\n\u00a0override def reduce(buff: Buff, in: Long): Buff = {\n\u00a0 \u00a0buff.total = buff.total + in\n\u00a0 \u00a0buff.count = buff.count + 1\n\u00a0 \u00a0buff\n\u00a0}\n\n\u00a0// \u5408\u5e76\u7f13\u51b2\u533a\uff0c\u56e0\u4e3a\u662f\u5206\u5e03\u5f0f\u8ba1\u7b97\uff0c\u6240\u4ee5\u5728\u4e0d\u540c\u7684task\u4e0a\u5c31\u4f1a\u6709\u4e0d\u540c\u7684\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u9700\u8981\u5408\u5e76\n\u00a0// \u5408\u5e76\u7684\u8fc7\u7a0b\u662f\uff0c\u628a\u540e\u4e00\u4e2a\u7f13\u51b2\u533a\u7684\u6570\u636e\u52a0\u5230\u524d\u4e00\u4e2a\u7f13\u51b2\u533a\u4e2d\uff0c\u4e0d\u65ad\u8fd9\u6837\u5408\u5e76\uff0c\u6700\u540e\u5c31\u53ea\u5269\u4e0b\u4e00\u4e2a\u4e86\n\u00a0override def merge(buff1: Buff, buff2: Buff): Buff = {\n\u00a0 \u00a0buff1.total = buff1.total + buff2.total\n\u00a0 \u00a0buff1.count = buff1.count + buff2.count\n\u00a0 \u00a0buff1\n\u00a0}\n\n\u00a0// \u8ba1\u7b97\u5e73\u5747\u503c\n\u00a0override def finish(buff: Buff): Long = {\n\u00a0 \u00a0buff.total / buff.count\n\u00a0}\n\n\u00a0// \u7f13\u51b2\u533a\u7f16\u7801\u5668\uff0c\u7528\u4e8e\u5e8f\u5217\u5316\uff0c\u56fa\u5b9a\u5199\u6cd5\uff0c\u81ea\u5b9a\u4e49\u7c7b\u578b\u5c31\u662f product \u81ea\u5e26\u7c7b\u578b\u6839\u636e\u7c7b\u578b\u9009\u62e9\n\u00a0override def bufferEncoder: Encoder[Buff] = Encoders.product\n\u00a0// \u8f93\u51fa\u7684\u7f16\u7801\u5668\n\u00a0override def outputEncoder: Encoder[Long] = Encoders.scalaLong\n}\n</code></pre></p> <p>\u4ee5\u4e0a\u662f\u5728SQL\u8bed\u53e5\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u805a\u5408\u51fd\u6570\uff0c\u6211\u4eec\u77e5\u9053\u901a\u8fc7DataSet\u4f7f\u7528DSL\u4e0d\u4ec5\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5217\uff0c\u8fd8\u53ef\u4ee5\u5c06\u67e5\u8be2\u7ed3\u679c\u7684\u6bcf\u4e00\u884c\u5f53\u4f5c\u5bf9\u8c61\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u5982\u679c\u901a\u8fc7DSL\u4f7f\u7528\u805a\u5408\u51fd\u6570\uff0c\u90a3\u4e48\u805a\u5408\u51fd\u6570\u7684\u8f93\u5165\u5c31\u53ef\u4ee5\u662f\u4e00\u4e2a\u5bf9\u8c61\u4e86\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0import spark.implicits._\n\n\u00a0\u00a0val df: DataFrame = spark.read.json(\"data/user.json\")\n\u00a0\u00a0val ds: Dataset[User] = df.as[User]\n\u00a0\u00a0`// \u5c06UDAF\u51fd\u6570\u8f6c\u6362\u4e3a\u67e5\u8be2\u7684\u5217\u5bf9\u8c61`\n `val avgAge: TypedColumn[User, Long] = new MyAvgUDAF().toColumn`\n `//\u6ce8\u518c\u81ea\u5b9a\u4e49\u7684\u805a\u5408\u51fd\u6570`\n `ds.select(avgAge).show`\n\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre> Text Only<pre><code>case class User(name: String, age: Long)\n</code></pre> Text Only<pre><code>/**\n* \u7f13\u51b2\u533a\u6837\u4f8b\u7c7b\n* @param total \u6570\u636e\u7684\u603b\u548c\n* @param count \u6570\u636e\u7684\u603b\u6761\u6570\n*/\ncase class Buff(var total: Long, var count: Long)\n\n/**\n* \u81ea\u5b9a\u4e49\u805a\u5408\u51fd\u6570\u7c7b\uff1a\u8ba1\u7b97\u5e73\u5747\u503c\n* 1. \u7ee7\u627forg.apache.spark.sql.expressions.Aggregator, \u5b9a\u4e49\u6cdb\u578b\n*\u00a0\u00a0IN : \u8f93\u5165\u7684\u6570\u636e\u7c7b\u578b User\n*\u00a0\u00a0BUF : \u7f13\u51b2\u533a\u7684\u6570\u636e\u7c7b\u578b Buff\n*\u00a0\u00a0OUT : \u8f93\u51fa\u7684\u6570\u636e\u7c7b\u578b Long\n* 2. \u91cd\u51996\u4e2a\u65b9\u6cd5\n*/\nclass MyAvgUDAF extends Aggregator[`User`, Buff, Long] {\n\u00a0\u00a0// zero : \u521d\u59cb\u503c\u6216\u96f6\u503c\n\u00a0\u00a0// \u7f13\u51b2\u533a\u7684\u521d\u59cb\u5316\n\u00a0\u00a0override def zero: Buff = {\n\u00a0\u00a0\u00a0\u00a0Buff(0L, 0L)\n\u00a0\u00a0}\n\u00a0\u00a0// \u6839\u636e\u8f93\u5165\u7684\u6570\u636e\u66f4\u65b0\u7f13\u51b2\u533a\u7684\u6570\u636e\n\u00a0\u00a0override def reduce(buff: Buff, `in: User)`: Buff = {\n\u00a0\u00a0\u00a0\u00a0buff.total = buff.total + `in.age`\n\u00a0\u00a0\u00a0\u00a0buff.count = buff.count + 1\n\u00a0\u00a0\u00a0\u00a0buff\n\u00a0\u00a0}\n\u00a0\u00a0// \u5408\u5e76\u7f13\u51b2\u533a\uff0c\u56e0\u4e3a\u662f\u5206\u5e03\u5f0f\u8ba1\u7b97\uff0c\u6240\u4ee5\u5728\u4e0d\u540c\u7684task\u4e0a\u5c31\u4f1a\u6709\u4e0d\u540c\u7684\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u9700\u8981\u5408\u5e76\n\u00a0\u00a0// \u5408\u5e76\u7684\u8fc7\u7a0b\u662f\uff0c\u628a\u540e\u4e00\u4e2a\u7f13\u51b2\u533a\u7684\u6570\u636e\u52a0\u5230\u524d\u4e00\u4e2a\u7f13\u51b2\u533a\u4e2d\uff0c\u4e0d\u65ad\u8fd9\u6837\u5408\u5e76\uff0c\u6700\u540e\u5c31\u53ea\u5269\u4e0b\u4e00\u4e2a\u4e86\n\u00a0\u00a0override def merge(buff1: Buff, buff2: Buff): Buff = {\n\u00a0\u00a0\u00a0\u00a0buff1.total = buff1.total + buff2.total\n\u00a0\u00a0\u00a0\u00a0buff1.count = buff1.count + buff2.count\n\u00a0\u00a0\u00a0\u00a0buff1\n\u00a0\u00a0}\n\u00a0\u00a0// \u8ba1\u7b97\u5e73\u5747\u503c\n\u00a0\u00a0override def finish(buff: Buff): Long = {\n\u00a0\u00a0\u00a0\u00a0buff.total / buff.count\n\u00a0\u00a0}\n\u00a0\u00a0// \u7f13\u51b2\u533a\u7f16\u7801\u5668\uff0c\u7528\u4e8e\u5e8f\u5217\u5316\uff0c\u56fa\u5b9a\u5199\u6cd5\uff0c\u81ea\u5b9a\u4e49\u7c7b\u578b\u5c31\u662f product \u81ea\u5e26\u7c7b\u578b\u6839\u636e\u7c7b\u578b\u9009\u62e9\n\u00a0\u00a0override def bufferEncoder: Encoder[Buff] = Encoders.product\n\u00a0\u00a0// \u8f93\u51fa\u7684\u7f16\u7801\u5668\n\u00a0\u00a0override def outputEncoder: Encoder[Long] = Encoders.scalaLong\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/23-SparkSQL%20%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%92%8C%E4%BF%9D%E5%AD%98/","title":"23-SparkSQL \u6570\u636e\u7684\u52a0\u8f7d\u548c\u4fdd\u5b58","text":"<p> \u7ea6 791 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>\u52a0\u8f7d\u6570\u636e SparkSQL \u52a0\u8f7d\u6570\u636e\u7684\u65b9\u5f0f\uff0c\u6ce8\u610f\uff1a \u5982\u679c classpath \u4e2d\u6709\u914d\u597d\u7684hdfs-site.xml\uff08\u5e94\u8be5\u662f\u5982\u679c\u914d\u7f6e\u4e86HADOOP_HOME\uff09\uff0c\u90a3\u4e48\u9ed8\u8ba4\u7684\u6587\u4ef6\u7cfb\u7edf\u5c31\u662f HDFS\uff0c\u5426\u5219\u5c31\u662f\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002 Text Only<pre><code>scala&gt; spark.read.\ncsv\u00a0\u00a0\u00a0format\u00a0\u00a0\u00a0jdbc\u00a0\u00a0\u00a0json\u00a0\u00a0\u00a0load\u00a0\u00a0\u00a0option\u00a0\u00a0\u00a0options\u00a0\u00a0\u00a0orc\u00a0\u00a0\u00a0parquet\u00a0\u00a0\u00a0schema\u00a0\u00a0\u00a0table\u00a0\u00a0\u00a0text\u00a0\u00a0\u00a0textFile\n</code></pre> spark.read.load \u662f\u52a0\u8f7d\u6570\u636e\u7684\u901a\u7528\u65b9\u6cd5\uff0c\u4e0d\u4f7f\u7528format\u65b9\u6cd5\u6307\u5b9a\u7684\u8bdd\uff0c\u9ed8\u8ba4\u8bfb\u53d6\u7684\u6587\u4ef6\u683c\u5f0f\u662f parquet\uff0c\u8bfb\u5176\u5b83\u683c\u5f0f\u7684\u6587\u4ef6\u4f1a\u62a5\u9519\u3002 Text Only<pre><code>val df = spark.read.load(\"../examples/src/main/resources/users.parquet\")\n</code></pre> \u53ef\u4ee5\u4f7f\u7528format\u65b9\u6cd5\u6307\u5b9a\u8bfb\u53d6\u7684\u683c\u5f0f Text Only<pre><code>spark.read.format(\"\u2026\")[.option(\"\u2026\")].load(\"\u2026\")\n</code></pre></p> <ul> <li>format(\"\u2026\")\uff1a\u6307\u5b9a\u52a0\u8f7d\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5305\u62ec\"csv\"\u3001 \"jdbc\"\u3001 \"json\"\u3001 \"orc\"\u3001 \"parquet\"\u548c\u00a0\"textFile\"\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u5c31\u662fparquet</li> <li>option(\"\u2026\")\uff1a\u5728\"jdbc\"\u683c\u5f0f\u4e0b\u9700\u8981\u4f20\u5165 JDBC \u76f8\u5e94\u53c2\u6570\uff1a url\u3001 user\u3001 password \u548cdbtable</li> <li>load(\"\u2026\")\uff1a\u6570\u636e\u7684\u8def\u5f84</li> </ul> <p>\u6bd4\u5982\u6307\u5b9a\u8bfb\u53d6json\u683c\u5f0f\u7684\u6587\u4ef6\uff1a Text Only<pre><code>val df = spark.read.format(\"json\").load(\"../data/user.json\")\n</code></pre> \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528json\u65b9\u6cd5\u8bfb\u53d6\uff0cload\u53ea\u662f\u4e00\u4e2a\u6bd4\u8f83\u901a\u7528\u7684\u65b9\u6cd5\uff1a Text Only<pre><code>val df = spark.read.json(\"../data/user.json\")\n</code></pre> \u6ce8\u610f\uff1aSpark \u8bfb\u53d6\u7684 json \u683c\u5f0f\u7684\u6587\u4ef6\u4e0d\u662f\u6807\u51c6\u7684 JSON \u6587\u4ef6\uff0c\u6807\u51c6\u7684JSON\u6587\u4ef6\u8981\u6c42\u53ea\u80fd\u6709\u4e00\u4e2aJSON\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u53ea\u80fd\u6709\u4e00\u4e2a\u9876\u7ea7\u7684\u5143\u7d20\uff0c\u800cSpark \u8bfb\u53d6\u7684 json \u683c\u5f0f\u7684\u6587\u4ef6\u8981\u6c42\u6bcf\u4e00\u884c\u90fd\u662f\u4e00\u4e2ajson\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3aSpark\u662f\u4ee5\u884c\u4e3a\u5355\u4f4d\u8fdb\u884c\u8bfb\u53d6\u7684\u3002</p> <p>\u5176\u5b9e\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5728\u6267\u884csql\u65f6\u6307\u5b9a\u8981\u8bfb\u53d6\u7684\u6587\u4ef6\u683c\u5f0f\u53ca\u6587\u4ef6\u7684\u8def\u5f84\uff1a Text Only<pre><code>spark.sql(\"select * from json.`../data/user.json`\").show\n</code></pre></p> <p>\u4fdd\u5b58\u6570\u636e SparkSQL \u4fdd\u5b58\u6570\u636e\u7684\u65b9\u5f0f Text Only<pre><code>scala&gt; df.write.\nbucketBy\u00a0\u00a0\u00a0format\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0jdbc\u00a0\u00a0\u00a0mode\u00a0\u00a0\u00a0\u00a0\u00a0options\u00a0\u00a0\u00a0parquet\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0save\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sortBy\ncsv\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0insertInto\u00a0\u00a0\u00a0json\u00a0\u00a0\u00a0option\u00a0\u00a0\u00a0orc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0partitionBy\u00a0\u00a0\u00a0saveAsTable\u00a0\u00a0\u00a0text\n</code></pre> df.write.save \u662f\u4fdd\u5b58\u6570\u636e\u7684\u901a\u7528\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u7684\u4fdd\u5b58\u683c\u5f0f\u662f\u00a0parquet Text Only<pre><code>df.write.save(\"../output\")\n</code></pre> \u53ef\u4ee5\u4f7f\u7528format\u65b9\u6cd5\u6307\u5b9a\u4fdd\u5b58\u7684\u683c\u5f0f Text Only<pre><code>scala&gt;df.write.format(\"\u2026\")[.option(\"\u2026\")].save(\"\u2026\")\n</code></pre></p> <ul> <li>format(\"\u2026\")\uff1a\u6307\u5b9a\u4fdd\u5b58\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5305\u62ec\"csv\"\u3001 \"jdbc\"\u3001 \"json\"\u3001 \"orc\"\u3001 \"parquet\"\u548c\u00a0\"textFile\"\uff0c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u5c31\u662fparquet</li> <li>option(\"\u2026\")\uff1a\u5728\"jdbc\"\u683c\u5f0f\u4e0b\u9700\u8981\u4f20\u5165 JDBC \u76f8\u5e94\u53c2\u6570\uff1a url\u3001 user\u3001 password \u548c dbtable</li> <li>load(\"\u2026\")\uff1a\u6570\u636e\u7684\u8def\u5f84</li> </ul> <p>\u6bd4\u5982\u5c06\u6570\u636e\u4fdd\u5b58\u6210json\u683c\u5f0f\uff1a Text Only<pre><code>df.write.format(\"json\").save(\"../output\")\n</code></pre> \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528json\u65b9\u6cd5\u4fdd\u5b58\uff0csave\u53ea\u662f\u4e00\u4e2a\u6bd4\u8f83\u901a\u7528\u7684\u65b9\u6cd5\uff1a Text Only<pre><code>df.write.json(\"../output\")\n</code></pre></p> <p>\u4fdd\u5b58\u65f6\u8fd8\u53ef\u4ee5\u4f7f\u7528mode\u65b9\u6cd5\u6307\u5b9aSaveMode\uff0c\u4e0d\u4f7f\u7528mode\u65b9\u6cd5\u9ed8\u8ba4\u662fSaveMode.ErrorIfExists Text Only<pre><code>df.write.mode(\"append\").json(\"../output\")\n</code></pre> </p> <p>SparkSQL\u8bfb\u53d6\u548c\u4fdd\u5b58csv\u6587\u4ef6\uff0ccsv\u6587\u4ef6\u9ed8\u8ba4\u4ee5\u9017\u53f7,\u5206\u5272\u3002 \u8bfb\u53d6csv\u6587\u4ef6\uff0coption(\"sep\", \",\")\u8868\u793a\u4ee5,\u53f7\u5206\u5272\uff0coption(\"header\", \"true\")\u8868\u793a\u6709\u8868\u5934 Text Only<pre><code>spark.read.format(\"csv\").option(\"sep\", \",\").option(\"inferSchema\",\"true\").option(\"header\", \"true\").load(\"data/user.csv\")\n</code></pre> Text Only<pre><code>df.write.mode(\"overwrite\").option(\"header\", \"true\").csv(\"../data/csv\")\n</code></pre></p> <p>SparkSQL\u4eceMySQL\u4e2d\u8bfb\u53d6\u548c\u5199\u5165\u6570\u636e Spark SQL \u53ef\u4ee5\u901a\u8fc7 JDBC \u4ece\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u65b9\u5f0f\u521b\u5efa DataFrame\uff0c\u901a\u8fc7\u5bf9DataFrame \u4e00\u7cfb\u5217\u7684\u8ba1\u7b97\u540e\uff0c\u8fd8\u53ef\u4ee5\u5c06\u6570\u636e\u518d\u5199\u56de\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u3002 \u5728IEDA\u4e2d\u4f7f\u7528SparkSQL\u4e0eMySQL\u4ea4\u4e92\uff1a 1.\u5bfc\u5165MySQL\u9a71\u52a8 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;mysql&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;8.0.22&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> 2.\u4ee3\u7801 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder().config(sparkConf).getOrCreate()\n\u00a0\u00a0import spark.implicits._\n\n\u00a0\u00a0// \u8bfb\u53d6MySQL\u6570\u636e\n\u00a0\u00a0val df = spark.read\n\u00a0\u00a0\u00a0\u00a0.format(\"jdbc\")\n\u00a0\u00a0\u00a0\u00a0.option(\"url\", \"jdbc:mysql://localhost:3306/test?serverTimezone=UTC\")\n\u00a0\u00a0\u00a0\u00a0.option(\"driver\", \"com.mysql.cj.jdbc.Driver\")\n\u00a0\u00a0\u00a0\u00a0.option(\"user\", \"root\")\n\u00a0\u00a0\u00a0\u00a0.option(\"password\", \"079335\")\n\u00a0\u00a0\u00a0\u00a0.option(\"dbtable\", \"user\")\n\u00a0\u00a0\u00a0\u00a0.load()\n\n\u00a0\u00a0df.show\n\n\u00a0\u00a0// \u4fdd\u5b58\u6570\u636e\u5230MySQL\n\u00a0\u00a0df.write\n\u00a0\u00a0\u00a0\u00a0.format(\"jdbc\")\n\u00a0\u00a0\u00a0\u00a0.option(\"url\", \"jdbc:mysql://localhost:3306/test?serverTimezone=UTC\")\n\u00a0\u00a0\u00a0\u00a0.option(\"driver\", \"com.mysql.cj.jdbc.Driver\")\n\u00a0\u00a0\u00a0\u00a0.option(\"user\", \"root\")\n\u00a0\u00a0\u00a0\u00a0.option(\"password\", \"079335\")\n\u00a0\u00a0\u00a0\u00a0.option(\"dbtable\", \"user1\")\n\u00a0\u00a0\u00a0\u00a0.mode(SaveMode.Append)\n\u00a0\u00a0\u00a0\u00a0.save()\n\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/24-SparkSQL%20%E8%BF%9E%E6%8E%A5%20Hive/","title":"24-SparkSQL \u8fde\u63a5 Hive","text":"<p> \u7ea6 1506 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 30 \u5206\u949f</p> <p>Hive\u672c\u8eab\u53ea\u662f\u4e00\u4e2a\u6570\u636e\u4ed3\u5e93\uff08\u7ba1\u7406\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\uff09\uff0c\u5bf9\u4e8eSparkSQL\u6765\u8bf4Hive\u53ea\u662f\u4e00\u4e2a\u6570\u636e\u6e90\uff0c\u8fd9\u70b9\u548cSparkSQL\u4ece\u6587\u4ef6\u6216\u8005MySQL\u8bfb\u53d6\u6570\u636e\u7c7b\u4f3c\uff0c\u5c06SQL\u548cHQL\u7ffb\u8bd1\u6210RDD\u540e\u63d0\u4ea4\u5e76\u6267\u884c\u7684\u5de5\u4f5c\u662f\u7531SparkSQL\u5b8c\u6210\u7684\u3002\u4f46Hive\u5bf9\u4e8eSparkSQL\u6765\u8bf4\u4e0d\u4ec5\u4ec5\u53ea\u662f\u50cf\u4ece\u6587\u4ef6\u6216\u8005MySQL\u4e2d\u8bfb\u5199\u6570\u636e\u90a3\u4e48\u7b80\u5355\uff0c\u5728SparkSQL\u4e2d\u53ef\u4ee5\u4f7f\u7528SQL\u76f4\u63a5\u5bf9Hive\u8868\u8fdb\u884c\u589e\u5220\u6539\u67e5\uff0c\u8fd9\u6837SparkSQL\u624d\u662f\u771f\u6b63\u628aHive\u4f5c\u4e3a\u4e86\u4e00\u4e2a\u6570\u636e\u4ed3\u5e93\uff0c\u800c\u4e0d\u4ec5\u4ec5\u53ea\u662f\u4e00\u6b21\u8bfb\u53d6\u6216\u5199\u5165\u7684\u6570\u636e\u6e90\u3002</p> <p>SparkSQL\u8fde\u63a5Hive\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e00\u662f\u4f7f\u7528SparkSQL\u5185\u7f6e\u7684Hive\uff0c\u4e8c\u662f\u4f7f\u7528\u5916\u90e8\u7684Hive\u3002 1.\u4f7f\u7528SparkSQL\u5185\u7f6e\u7684Hive\uff0c\u5e76\u4e14\u4f7f\u7528Hive\u81ea\u5e26\u7684\u6570\u636e\u5e93derby\u6765\u4fdd\u5b58\u5143\u6570\u636e\u4fe1\u606f \u76f4\u63a5\u542f\u52a8spark-shell\uff0c\u7136\u540e\u8f93\u5165 Text Only<pre><code>spark.sql(\"show tables\").show\n</code></pre> \u8fd9\u65f6\u4f1a\u51fa\u73b0hive\u7684\u51e0\u4e2a\u914d\u7f6e\u4fe1\u606f\u6ca1\u627e\u5230\u7684\u8b66\u544a\uff0c\u7136\u540e\u5728spark-shell\u542f\u52a8\u7684\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2ametastore_db\u76ee\u5f55\uff0c\u8fd9\u4e2a\u5c31\u662f\u4fdd\u5b58hive\u8868\u7684\u5143\u6570\u636e\u5e93\uff0c\u6700\u540e\u4f1a\u8f93\u51fa\u6b64\u65f6hive\u4e2d\u6709\u54ea\u51e0\u5f20\u8868\u3002  \u63a5\u7740\u521b\u5efa\u4e00\u5f20\u8868 Text Only<pre><code>spark.sql(\"create table student(id int)\")\n</code></pre> SparkSQL\u4f1a\u628a\u8868\u7684\u6570\u636e\u4fdd\u5b58\u5728\u672c\u5730\uff0c\u4e5f\u5c31\u662f\u4f1a\u5728spark-shell\u542f\u52a8\u7684\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2aspark-warehouse\u76ee\u5f55\u7528\u6765\u4fdd\u5b58\u8868\u7684\u6570\u636e\uff0c\u6b64\u65f6\u521b\u5efa\u7684student\u8868\u4f1a\u5728spark-warehouse\u4e0b\u65b0\u5efa\u4e00\u4e2a\u5bf9\u5e94\u7684\u540d\u53ebstudent\u7684\u76ee\u5f55\u6765\u4fdd\u5b58\u8868\u7684\u6570\u636e\uff08\u6ce8\u610f\u533a\u522b\u4e8e\u8868\u7684\u5143\u6570\u636e\uff0cstudent\u8868\u7684\u5143\u6570\u636e\u8fd8\u662f\u5b58\u50a8\u5728metastore_db\u4e2d\u7684\uff09\u3002 \u67e5\u770bhive\u4e2d\u6709\u54ea\u4e9b\u8868\uff1a Text Only<pre><code>scala&gt; spark.sql(\"show tables\").show\n+--------+---------+-----------+\n|database|tableName|isTemporary|\n+--------+---------+-----------+\n| default|\u00a0\u00a0student|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0false|\n+--------+---------+-----------+\n</code></pre> \u5411student\u8868\u4e2d\u5bfc\u5165\u6570\u636e\uff0c\u8fd9\u65f6spark-warehouse/student\u76ee\u5f55\u4e0b\u5c31\u6709\u6570\u636e\u4e86\uff1a Text Only<pre><code>spark.sql(\"load data local inpath 'data/id.txt' into table student\")\n</code></pre> \u67e5\u770b\u8868\u7684\u6570\u636e\uff0cSparkSQL\u7684sql\u8bed\u53e5\u6267\u884c\u7684\u7ed3\u679c\u662f\u4fdd\u5b58\u5728DataFrame\u4e2d\u7684\uff1a Text Only<pre><code>scala&gt; val df = spark.sql(\"select * from student\")\ndf: org.apache.spark.sql.DataFrame = [id: int]\n\nscala&gt; df.show\n+---+\n| id|\n+---+\n|\u00a0\u00a01|\n|\u00a0\u00a02|\n|\u00a0\u00a03|\n|\u00a0\u00a04|\n+---+\n</code></pre></p> <p>\u6ce8\u610f\uff0c\u76f4\u63a5\u4eceDataFrame\u4e2d\u521b\u5efa\u7684\u4e34\u65f6\u89c6\u56fe\u4e0eHive\u8868\u6ca1\u6709\u5173\u7cfb\uff0c\u4e0d\u4f1a\u4fdd\u5b58\u5728Hive\u4e2d\uff1a Text Only<pre><code>scala&gt; df.createOrReplaceTempView(\"emp\")\n\nscala&gt; spark.sql(\"show tables\").show\n+--------+---------+-----------+\n|database|tableName|isTemporary|\n+--------+---------+-----------+\n| default|\u00a0\u00a0student|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0false|\n|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0emp|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0true|\n+--------+---------+-----------+\n</code></pre></p> <p>2.\u4f7f\u7528SparkSQL\u5185\u7f6e\u7684Hive\uff0c\u5c06\u5143\u6570\u636e\u4fe1\u606f\u4fdd\u5b58\u5728MySQL\u4e2d\uff0c\u5c06\u8868\u7684\u6570\u636e\u4fdd\u5b58\u5728HDFS\u4e0a 2.1 \u5728/opt/module/spark-yarn/conf\u76ee\u5f55\u4e0b\u521b\u5efahive-site.xml\uff08\u53ef\u4ee5\u76f4\u63a5\u628a\u524d\u9762\u5b66Hive\u65f6\u914d\u7f6e\u597d\u7684hive-site.xml\u62f7\u8d1d\u5230\u8fd9\u91cc\uff0c\u4f46\u6ce8\u610f\u8981\u5220\u9664\u6389\u6709\u5173\u4e8emetastore\u548chiveservice2\u7684\u914d\u7f6e\uff09\u3002 Text Only<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 URL --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;jdbc:mysql://192.168.10.1:3306/metastore?serverTimezone=UTC&amp;characterEncoding=utf-8&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 Driver--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 username--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;root&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 password --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;079335&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- Hive \u5143\u6570\u636e\u5b58\u50a8\u7248\u672c\u7684\u9a8c\u8bc1 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u5143\u6570\u636e\u5b58\u50a8\u6388\u6743 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- Hive \u9ed8\u8ba4\u5728 HDFS \u7684\u5de5\u4f5c\u76ee\u5f55 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;/user/hive/warehouse&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n&lt;/configuration&gt;\n</code></pre> 2.2 \u7136\u540e\u628aMySQL\u7684\u9a71\u52a8\u62f7\u8d1d\u5230/opt/module/spark-yarn/jars 2.3\u00a0\u542f\u52a8spark-shell\uff0c\u67e5\u770bHive\u4e2d\u6709\u54ea\u4e9b\u8868\uff0c\u56e0\u4e3a\u662f\u76f4\u63a5\u590d\u5236\u524d\u9762\u5b66Hive\u65f6\u914d\u7f6e\u7684hive-site.xml\uff0c\u6240\u4ee5\u5143\u6570\u636e\u5e93\u7684\u4fe1\u606f\u6ca1\u53d8\uff0c\u8fd9\u662f\u5728\u524d\u9762\u5b66Hive\u65f6\u521b\u5efa\u7684\u8868\u3002 </p> <p>2.4 \u5728spark-shell\u4e2d\u6267\u884csql\u8bed\u53e5\u8981\u901a\u8fc7SparkSession\u5bf9\u8c61spark\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u662fDataFrame\uff0c\u4f7f\u7528DataFrame\u6765\u64cd\u4f5c\u6570\u636e\u867d\u7136\u65b9\u4fbf\uff0c\u4f46\u662f\u6709\u65f6\u5019\u5728\u547d\u4ee4\u884c\u4e2d\u53ea\u662f\u60f3\u76f4\u63a5\u5f97\u5230sql\u8bed\u53e5\u6267\u884c\u7684\u7ed3\u679c\uff0c\u6240\u4ee5Spark\u8fd8\u63d0\u4f9b\u4e86\u4e0eHive\u7684hiveserver2\u7c7b\u4f3c\u7684 Spark Thrift Server\uff0c Spark Thrift Server \u7684\u63a5\u53e3\u548c\u901a\u4fe1\u534f\u8bae\u4e0e HiveServer2 \u5b8c\u5168\u4e00\u81f4\uff0c\u6240\u4ee5\u65e0\u8bba\u662f \u4f7f\u7528spark\u7684bin\u76ee\u5f55\u4e0b\u7684beeline\u5ba2\u6237\u7aef \u8fd8\u662f Hive\u7684beeline\u5ba2\u6237\u7aef\uff0c\u90fd\u53ef\u4ee5\u8fde\u63a5\u5230\u8be5\u670d\u52a1\u4e0a\uff0c\u56e0\u4e3a\u4e24\u4e2abeeline\u5176\u5b9e\u662f\u4e00\u6837\u7684\u4e1c\u897f\uff08\u7528Hive\u7684beeline\u5ba2\u6237\u7aef\u8fde\u63a5\u6ca1\u6709\u6d4b\u8bd5\u6210\u529f\uff09\u3002 \u5728spark\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8Spark Thrift Server\uff0cSpark Thrift Server \u4e0e\u00a0hiveserver2\u4e00\u6837\u4e5f\u4f9d\u8d56\u4e8e\u00a0metastore \u670d\u52a1\uff0c\u4ece\u8f93\u51fa\u7684\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u4f7f\u7528\u5185\u7f6e\u7684Hive\u65f6\uff0c\u542f\u52a8Spark Thrift Server\u7684\u540c\u65f6\u4f1a\u542f\u52a8metastore \u670d\u52a1\uff0c\u4e0d\u9700\u8981\u5355\u72ec\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u3002 Text Only<pre><code>[jmoon@hadoop102 spark-yarn]$ sbin/start-thriftserver.sh\nstarting org.apache.spark.sql.hive.thriftserver.HiveThriftServer2, logging to /opt/module/spark-yarn/logs/spark-jmoon-org.apache.spark.sql.hive.thriftserver.HiveThriftServer2-1-hadoop102.out\n[1]+\u00a0\u00a0\u9000\u51fa 143\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hive --service metastore\n</code></pre> \u5728spark\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u4f7f\u7528beeline\u8fde\u63a5\u5230Spark Thrift Server Text Only<pre><code>bin/beeline -u jdbc:hive2://hadoop102:10000 -n jmoon\n</code></pre> \u4e4b\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u4e2d\u6267\u884cSQL\u8bed\u53e5\u4e86\uff0c\u6b64\u65f6\u4f7f\u7528\u7684\u8ba1\u7b97\u5f15\u64ce\u5c31\u662fSpark\uff0c\u800c\u4e0d\u662fMapReduce\uff0c\u5982\u679cbeeline\u76f4\u63a5\u8fde\u63a5\u7684\u662fHive\u7684hiveserver2\uff0c\u90a3\u4e48\u8ba1\u7b97\u5f15\u64ce\u5c31\u662fMR\u3002 </p> <p>3.\u4f7f\u7528\u5916\u7f6e\u7684Hive\uff0c\u53ea\u662f\u4f7f\u7528\u5916\u7f6eHive\u7684\u5143\u6570\u636e\u670d\u52a1 3.1 \u628a\u524d\u9762\u62f7\u8d1d\u7684MySQL\u9a71\u52a8\u5220\u9664 3.2 \u5f00\u542f\u5916\u7f6ehive\u7684\u5143\u6570\u636e\u670d\u52a1metastore\uff0cSparkSQL\u53ea\u662f\u4f7f\u7528\u5916\u7f6eHive\u7684\u5143\u6570\u636e\u670d\u52a1\uff0c\u4e5f\u5c31\u662fHive\u4e2d\u7684\u90a3\u4e9b\u8868\u4fe1\u606f Text Only<pre><code>hive --service metastore &amp;\n</code></pre> 3.3 \u4fee\u6539/opt/module/spark-yarn/conf/hive-site.xml\uff0c\u53ea\u9700\u8981\u6dfb\u52a0metastore\u7684\u8fde\u63a5\u4fe1\u606f Text Only<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.uris&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;thrift://hadoop102:9083&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n&lt;/configuration&gt;\n</code></pre> 3.4 \u542f\u52a8spark-shell\uff0c\u67e5\u770bHive\u4e2d\u6709\u54ea\u4e9b\u8868\uff0c\u56e0\u4e3a\u8fd9\u91cc\u4f7f\u7528\u7684\u5916\u7f6e\u7684Hive\uff0c\u6240\u4ee5\u5c31\u662f\u524d\u9762\u5b66Hive\u65f6\u521b\u5efa\u7684\u8868  3.5 \u540c\u6837\u53ef\u4ee5\u5f00\u542fSpark Thrift Server\uff0c\u6b64\u65f6Spark Thrift Server\u4f1a\u8fde\u63a5\u5230\u524d\u9762\u5df2\u7ecf\u5f00\u542f\u7684\u5916\u7f6eHive\u7684metastore\u670d\u52a1\u4e0a Text Only<pre><code>sbin/start-thriftserver.sh\n</code></pre> \u5728spark\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u4f7f\u7528beeline\u8fde\u63a5\u5230Spark Thrift Server Text Only<pre><code>bin/beeline -u jdbc:hive2://hadoop102:10000 -n jmoon\n</code></pre> </p> <p>spark-sql \u9664\u4e86\u4f7f\u7528spark-shell\u548cbeeline\u5728\u547d\u4ee4\u884c\u6267\u884cSQL\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528spark-sql\u5728\u547d\u4ee4\u884c\u6267\u884cSQL\uff0cspark-sql\u548cbeeline\u4e00\u6837\u76f4\u63a5\u8fd4\u56deSQL\u7684\u7ed3\u679c\uff0c\u4e0d\u8fc7spark-sql\u5e76\u6ca1\u6709beeline\u7684\u8f93\u51fa\u597d\u770b\u3002 Text Only<pre><code>bin/spark-sql\n</code></pre></p> <p>4.\u5728SparkSQL\u4ee3\u7801\u4e2d\u64cd\u4f5cHive\uff0c\u8fd9\u548c\u5728Spark-shell\u4e2d\u4f7f\u7528SparkSQL\u5185\u7f6e\u7684Hive\uff08\u5c06\u5143\u6570\u636e\u4fe1\u606f\u4fdd\u5b58\u5728MySQL\u4e2d\uff0c\u5c06\u8868\u7684\u6570\u636e\u4fdd\u5b58\u5728HDFS\u4e0a\uff09\u7684\u65b9\u5f0f\u4e00\u6837\u3002 4.1 \u5f15\u5165spark-hive_2.12\u7684\u4f9d\u8d56\u548cMySQL\u7684\u9a71\u52a8\uff0c\uff08\u4e0d\u8981\u5f15\u5165hive-exec\u7684\u4f9d\u8d56\uff0c\u4f1a\u51b2\u7a81\uff09 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spark-hive_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!--&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.hive&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;hive-exec&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.1.2&lt;/version&gt;\n&lt;/dependency&gt;--&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;mysql&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;8.0.22&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> 4.2 \u628a\u4e0d\u5e26hiveservice2\u914d\u7f6e\u7684hive-site.xml\u62f7\u8d1d\u5e26resource\u76ee\u5f55\u4e0b\uff0c\u7531\u4e8e\u5728Windows\u73af\u5883\u4e0b\u7684\u73af\u5883\u53d8\u91cf HADOOP_HOME \u4e2d\u6ca1\u6709\u914d\u597d\u7684hdfs-site.xml\uff0c\u6240\u4ee5hive.metastore.warehouse.dir\u5e94\u8be5\u52a0\u4e0a hdfs://hadoop102:8020/\u00a0\uff0c\u4e0d\u7136\u4f7f\u7528\u7684\u5c31\u662f\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002 Text Only<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?&gt;\n&lt;configuration&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 URL --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;jdbc:mysql://192.168.10.1:3306/metastore?serverTimezone=UTC&amp;amp;characterEncoding=utf-8&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 Driver--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;com.mysql.cj.jdbc.Driver&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 username--&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;root&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- jdbc \u8fde\u63a5\u7684 password --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;079335&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- Hive \u5143\u6570\u636e\u5b58\u50a8\u7248\u672c\u7684\u9a8c\u8bc1 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n\u00a0\u00a0\u00a0\u00a0&lt;!-- \u5143\u6570\u636e\u5b58\u50a8\u6388\u6743 --&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&lt;value&gt;false&lt;/value&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;/property&gt;\n\n `&lt;!-- Hive \u9ed8\u8ba4\u5728 HDFS \u7684\u5de5\u4f5c\u76ee\u5f55 --&gt;`\n `&lt;property&gt;`\n `&lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;`\n `&lt;value&gt;hdfs://hadoop102:8020/user/hive/warehouse&lt;/value&gt;`\n `&lt;/property&gt;`\n\n&lt;/configuration&gt;\n</code></pre> 4.3 \u5728\u4ee3\u7801\u4e2d\u67e5\u770bHive\u4e2d\u6709\u54ea\u4e9b\u8868\uff0c\u8bbf\u95eeHDFS\u65f6\u9700\u8981\u52a0\u4e0aSystem.setProperty(\"HADOOP_USER_NAME\", \"jmoon\")\uff0c\u4e0d\u7136\u6ca1\u6709\u5199\u6743\u9650 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 `System.setProperty(\"HADOOP_USER_NAME\", \"jmoon\")`\n\u00a0\u00a0// TODO \u521b\u5efaSparkSQL\u7684\u8fd0\u884c\u73af\u5883\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"sparkSQL\")\n\u00a0\u00a0val spark = SparkSession.builder()`.enableHiveSupport()`.config(sparkConf).getOrCreate()\n\u00a0\u00a0// \u4f7f\u7528SparkSQL\u8fde\u63a5\u5916\u7f6e\u7684Hive\n\u00a0\u00a0// 1.\u589e\u52a0\u5bf9\u5e94\u7684\u4f9d\u8d56\u5173\u7cfb(\u5305\u542bMySQL\u9a71\u52a8)\n\u00a0\u00a0// 2.\u62f7\u8d1dHive-size.xml\u6587\u4ef6\u5230classpath\u4e0b\n\u00a0\u00a0`// 3.\u542f\u7528Hive\u7684\u652f\u6301`\n\u00a0\u00a0spark.sql(\"show tables\").show\n\u00a0\u00a0spark.sql(\"select * from student\").show\n\u00a0\u00a0// TODO \u5173\u95ed\u73af\u5883\n\u00a0\u00a0spark.close()\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/26-SparkStreaming%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F/","title":"26-SparkStreaming\u83b7\u53d6\u6570\u636e\u7684\u65b9\u5f0f","text":"<p> \u7ea6 430 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>WordCount 1.\u4ece\u5957\u63a5\u5b57\u4e2d\u91c7\u96c6\u6570\u636e Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efa\u73af\u5883\u5bf9\u8c61\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0// StreamingContext\u521b\u5efa\u65f6\uff0c\u9700\u8981\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u73af\u5883\u914d\u7f6e\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u6279\u91cf\u5904\u7406\u7684\u5468\u671f\uff08\u91c7\u96c6\u5468\u671f\uff09\n\u00a0\u00a0val ssc: StreamingContext = new StreamingContext(sparkConf, Seconds(3))\n\n\u00a0\u00a0// TODO \u903b\u8f91\u5904\u7406\n\u00a0\u00a0// \u83b7\u53d6\u7aef\u53e3\u6570\u636e\n\u00a0\u00a0val lines: ReceiverInputDStream[String] = ssc.socketTextStream(\"localhost\", 9999)\n\u00a0\u00a0val words = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0val wordToOne = words.map((_,1))\n\u00a0\u00a0val wordToCount: DStream[(String, Int)] = wordToOne.reduceByKey(_+_)\n\u00a0\u00a0wordToCount.print()\n\n\u00a0\u00a0// \u7531\u4e8eSparkStreaming\u91c7\u96c6\u5668\u662f\u957f\u671f\u6267\u884c\u7684\u4efb\u52a1\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u5173\u95edssc.stop()\n\u00a0\u00a0// 1. \u542f\u52a8\u91c7\u96c6\u5668\n\u00a0\u00a0ssc.start()\n\u00a0\u00a0// 2. \u7b49\u5f85\u91c7\u96c6\u5668\u7684\u5173\u95ed\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre> \u901a\u8fc7 netcat \u53d1\u9001\u6570\u636e\uff1a Text Only<pre><code>nc -l -p 9999\n</code></pre></p> <p>2.\u4ece\u961f\u5217\u4e2d\u91c7\u96c6\u6570\u636e Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0// TODO \u521b\u5efa\u73af\u5883\u5bf9\u8c61\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0// StreamingContext\u521b\u5efa\u65f6\uff0c\u9700\u8981\u4f20\u9012\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u73af\u5883\u914d\u7f6e\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u6279\u91cf\u5904\u7406\u7684\u5468\u671f\uff08\u91c7\u96c6\u5468\u671f\uff09\n\u00a0\u00a0val ssc: StreamingContext = new StreamingContext(sparkConf, Seconds(3))\n\n\u00a0\u00a0val rddQueue = new mutable.Queue[RDD[Int]]()\n\n\u00a0\u00a0val inputStream: InputDStream[Int] = ssc.queueStream(rddQueue, oneAtATime = false)\n\u00a0\u00a0val mappedStream: DStream[(Int, Int)] = inputStream.map((_, 1))\n\u00a0\u00a0val reducedStream: DStream[(Int, Int)] = mappedStream.reduceByKey(_ + _)\n\u00a0\u00a0reducedStream.print()\n\n\u00a0\u00a0ssc.start()\n\n\u00a0\u00a0for (_ &lt;- 1 to 5) {\n\u00a0\u00a0\u00a0\u00a0rddQueue += ssc.sparkContext.makeRDD(1 to 300, 10)\n\u00a0\u00a0\u00a0\u00a0Thread.sleep(2000)\n\u00a0\u00a0}\n\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p> <p>3\u4f7f\u7528\u81ea\u5b9a\u4e49\u6570\u636e\u91c7\u96c6\u5668 Text Only<pre><code>/**\n* \u81ea\u5b9a\u4e49\u6570\u636e\u91c7\u96c6\u5668\n* 1. \u7ee7\u627fReceiver\uff0c\u5b9a\u4e49\u6cdb\u578b, \u4f20\u9012\u53c2\u6570\n* 2. \u91cd\u5199\u65b9\u6cd5\n*/\nclass MyReceiver extends Receiver[String](StorageLevel.MEMORY_ONLY) {\n\u00a0\u00a0private var flag = true\n\n\u00a0\u00a0override def onStart(): Unit = {\n\u00a0\u00a0\u00a0\u00a0new Thread(() =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (flag) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val message = \"\u91c7\u96c6\u7684\u6570\u636e\u4e3a\uff1a\" + new Random().nextInt(10).toString\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0store(message)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread.sleep(500)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}).start()\n\u00a0\u00a0}\n\n\u00a0\u00a0override def onStop(): Unit = {\n\u00a0\u00a0\u00a0\u00a0flag = false;\n\u00a0\u00a0}\n}\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0val ssc = new StreamingContext(sparkConf, Seconds(3))\n\n\u00a0\u00a0//\u4f7f\u7528\u81ea\u5b9a\u4e49\u6570\u636e\u91c7\u96c6\u5668\n\u00a0\u00a0val messageDS: ReceiverInputDStream[String] = ssc.receiverStream(new MyReceiver())\n\u00a0\u00a0messageDS.print()\n\n\u00a0\u00a0ssc.start()\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p> <p>4.\u4eceKafka\u4e2d\u83b7\u53d6\u6570\u636e \u5f15\u5165\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;spark-streaming-kafka-0-10_2.12&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;jackson-core&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;2.10.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0val ssc: StreamingContext = new StreamingContext(sparkConf, Seconds(3))\n\n\u00a0 //Kafka \u53c2\u6570\n\u00a0\u00a0val kafkaPara: Map[String, Object] = Map[String, Object](\n\u00a0\u00a0\u00a0\u00a0ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG -&gt; \"hadoop102:9092,hadoop103:9092,hadoop104:9092\",\n\u00a0\u00a0\u00a0\u00a0ConsumerConfig.GROUP_ID_CONFIG -&gt; \"ssc\",\n\u00a0\u00a0\u00a0\u00a0\"key.deserializer\" -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\",\n\u00a0\u00a0\u00a0\u00a0\"value.deserializer\" -&gt; \"org.apache.kafka.common.serialization.StringDeserializer\"\n\u00a0\u00a0)\n\n\u00a0 //\u521b\u5efa\u7528\u4e8e\u8bfb\u53d6Kafka topic\u6570\u636e\u7684DStream\n\u00a0\u00a0val kafkaDataDS: InputDStream[ConsumerRecord[String, String]] = KafkaUtils.createDirectStream[String, String](\n\u00a0\u00a0\u00a0\u00a0ssc,\n\u00a0\u00a0\u00a0\u00a0LocationStrategies.PreferConsistent,\n\u00a0\u00a0\u00a0\u00a0ConsumerStrategies.Subscribe[String, String](Set(\"spark-streaming\"), kafkaPara)\n\u00a0\u00a0)\n\n\u00a0\u00a0//\u5c06\u6bcf\u6761\u6d88\u606f\u7684value\u53d6\u51fa\n\u00a0\u00a0kafkaDataDS.map(_.value()).print()\n\u00a0 ssc.start()\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/27-SparkStreaming%E5%8E%9F%E8%AF%AD/","title":"27-SparkStreaming\u539f\u8bed","text":"<p> \u7ea6 1564 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 31 \u5206\u949f</p> <p>\u548c SparkCore \u7684 RDD \u7684\u6982\u5ff5\u5f88\u76f8\u4f3c\uff0c SparkStreaming \u4f7f\u7528\u79bb\u6563\u5316\u6d41(discretized stream)\u4f5c\u4e3a\u62bd\u8c61\u8868\u793a\uff0c\u53eb\u4f5c DStream\u3002 DStream \u539f\u8bed\u7c7b\u4f3c\u4e8e RDD \u7684\u7b97\u5b50\uff0c\u90fd\u662f\u65b9\u6cd5\uff0c\u53ea\u662f\u4e3a\u4e86\u533a\u5206\u624d\u53d6\u540d\u4e3a\u539f\u8bed\uff0c\u4e0d\u8fc7\u4e5f\u6709\u533a\u522b\uff0c\u539f\u8bed\u53ef\u770b\u4f5c\u662f\u5bf9\u7b97\u5b50\u7684\u518d\u4e00\u6b21\u5c01\u88c5\u3002 DStream \u539f\u8bed\u5206\u4e3a Transformations\uff08\u8f6c\u6362\uff09\u548c Output Operations\uff08\u8f93\u51fa\uff09\u4e24\u79cd\u3002\u5176\u4e2dTransformations\uff08\u8f6c\u6362\uff09\u6709\u5206\u4e3a \u65e0\u72b6\u6001 \u548c \u6709\u72b6\u6001 \u4e24\u79cd\uff0c\u65e0\u72b6\u6001\u662f\u6307\u5bf9\u6bcf\u4e2a\u5468\u671f\u6570\u636e\u7684\u8ba1\u7b97\u662f\u72ec\u7acb\uff0c\u800c\u6709\u72b6\u6001\u66f4\u65b0\u662f\u6307\u4f1a\u5728\u524d\u9762\u5468\u671f\u8ba1\u7b97\u7684\u7ed3\u679c\u4e4b\u4e0a\u505a\u66f4\u65b0\u3002</p> <p>Transformations\uff08\u8f6c\u6362\uff09\u539f\u8bed 1.\u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c \u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c\u5c31\u662f\u628a\u7b80\u5355\u7684 RDD \u8f6c\u5316\u64cd\u4f5c\u5e94\u7528\u5230\u6bcf\u4e2a\u6279\u6b21\u4e0a\uff0c\u90e8\u5206\u65e0\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c\u5217\u5728\u4e86\u4e0b\u8868\u4e2d\u3002\u6ce8\u610f\uff0c\u9488\u5bf9\u952e\u503c\u5bf9\u7684 DStream \u8f6c\u5316\u64cd\u4f5c\uff08\u6bd4\u5982reduceByKey()\uff09\u8981\u6dfb\u52a0 import StreamingContext._\u624d\u80fd\u5728 Scala \u4e2d\u4f7f\u7528\u3002 </p> <p>1.1 transform DStream \u539f\u8bed\u662f\u5bf9RDD\u7684\u518d\u6b21\u5c01\u88c5\uff0c\u4f7f\u7528\u9664transform\u5916\u7684\u5176\u5b83\u539f\u8bed\u65f6\uff0c\u4f20\u5165\u7684\u53c2\u6570\u662fRDD\u7684\u8ba1\u7b97\u903b\u8f91\uff0c\u6bd4\u5982map\u539f\u8bed\u4f20\u5165\u7684\u533f\u540d\u51fd\u6570\u662f\u6bcf\u4e00\u4e2a\u5143\u7d20\u6620\u5c04\u7684\u903b\u8f91\uff0c\u4f46\u662f\u00a0DStream \u539f\u8bed\u7684\u5904\u7406\u6d41\u7a0b\u662f\u4e0d\u4f1a\u6539\u53d8\u7684\u3002\u800ctransform\u539f\u8bed\u5219\u76f4\u63a5\u628a\u5176\u5c01\u88c5\u7684 RDD \u4ea4\u7ed9\u7a0b\u5e8f\u5458\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u7528RDD\u7b97\u5b50\u7ec4\u5408\u6210\u66f4\u52a0\u590d\u6742\u7684\u529f\u80fd\uff0c\u4e0d\u8fc7transform\u7684\u533f\u540d\u51fd\u6570\u6700\u540e\u7684\u8fd4\u56de\u8fd8\u662fRDD\uff0c\u56e0\u4e3atransform\u539f\u8bed\u5c5e\u4e8e\u8f6c\u6362\u539f\u8bed\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0\u00a0\u00a0val ssc = new StreamingContext(sparkConf, Seconds(3))\n\u00a0\u00a0\u00a0\u00a0val lines = ssc.socketTextStream(\"localhost\", 9999)\n\n\u00a0\u00a0\u00a0\u00a0// transform\u65b9\u6cd5\u53ef\u4ee5\u5c06\u5e95\u5c42RDD\u83b7\u53d6\u5230\u540e\u8fdb\u884c\u64cd\u4f5c\n\u00a0\u00a0\u00a0\u00a0// 1. DStream\u529f\u80fd\u4e0d\u5b8c\u5584\n\u00a0\u00a0\u00a0\u00a0// 2. \u9700\u8981\u4ee3\u7801\u5468\u671f\u6027\u7684\u6267\u884c\n\n\u00a0\u00a0\u00a0\u00a0// Code : \u8fd9\u91cc\u7684\u4ee3\u7801\u53ea\u5728Driver\u7aef\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0val newDS: DStream[String] = lines.transform(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rdd =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`// Code : \u8fd9\u91cc\u7684\u4ee3\u7801\u4f1a\u5728Driver\u7aef\u5468\u671f\u6027\u6267\u884c`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0rdd.map(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0str =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 `// Code : \u8fd9\u91cc\u662fRDD\u7b97\u5b50\u91cc\u9762\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u4f1aExecutor\u7aef\u6267\u884c\uff0c\u4f1a\u5468\u671f\u6027\u5730\u6267\u884c\uff0c\u5e76\u4e14\u4e00\u4e2a\u5468\u671f\u5185\u6709\u51e0\u4e2atask\u5c31\u4f1a\u6267\u884c\u591a\u5c11\u6b21`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0str\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0)\n\n\u00a0\u00a0\u00a0\u00a0// Code : \u8fd9\u91cc\u7684\u4ee3\u7801\u53ea\u5728Driver\u7aef\u6267\u884c\u4e00\u6b21\n\u00a0\u00a0\u00a0\u00a0val newDS1: DStream[String] = lines.map(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0data =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Code : \u8fd9\u91cc\u662fRDD\u7b97\u5b50\u91cc\u9762\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u4f1aExecutor\u7aef\u6267\u884c\uff0c\u4e00\u4e2a\u5468\u671f\u5185\u6709\u51e0\u4e2atask\u5c31\u4f1a\u6267\u884c\u591a\u5c11\u6b21\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0data\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0)\n\n\u00a0\u00a0\u00a0\u00a0ssc.start()\n\u00a0\u00a0\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre> transform WordCount Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0val ssc = new StreamingContext(sparkConf, Seconds(3))\n\u00a0\u00a0val lineDStream: ReceiverInputDStream[String] = ssc.socketTextStream(\"localhost\", 9999)\n\n\u00a0\u00a0val wordAndCountDStream: DStream[(String, Int)] = lineDStream.transform(rdd =&gt; {\n\u00a0\u00a0\u00a0\u00a0val words: RDD[String] = rdd.flatMap(_.split(\" \"))\n\u00a0\u00a0\u00a0\u00a0val wordAndOne: RDD[(String, Int)] = words.map((_, 1))\n\u00a0\u00a0\u00a0\u00a0val value: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0\u00a0\u00a0\u00a0value\n\u00a0\u00a0})\n\u00a0\u00a0wordAndCountDStream.print\n\n\u00a0\u00a0ssc.start()\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p> <p>1.2 join\uff0c\u5bf9\u4e24\u4e2a\u6d41\u4e00\u4e2a\u5468\u671f\u5185\u7684\u6570\u636e\u8fdb\u884cjoin\u64cd\u4f5c Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0\u00a0\u00a0val ssc = new StreamingContext(sparkConf, Seconds(5))\n\u00a0\u00a0\u00a0\u00a0val data9999 = ssc.socketTextStream(\"localhost\", 9999)\n\u00a0\u00a0\u00a0\u00a0val data8888 = ssc.socketTextStream(\"localhost\", 8888)\n\n\u00a0 \u00a0 val map9999: DStream[(String, Int)] = data9999.map((_,9))\n\u00a0\u00a0\u00a0\u00a0val map8888: DStream[(String, Int)] = data8888.map((_,8))\n\n\u00a0\u00a0\u00a0\u00a0// \u6240\u8c13\u7684DStream\u7684Join\u64cd\u4f5c\uff0c\u5176\u5b9e\u5c31\u662f\u4e24\u4e2aRDD\u7684join\n\u00a0\u00a0\u00a0\u00a0val joinDS: DStream[(String, (Int, Int))] = map9999.join(map8888)\n\u00a0\u00a0\u00a0\u00a0joinDS.print()\n\n\u00a0\u00a0\u00a0\u00a0ssc.start()\n\u00a0\u00a0\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p> <p>1.3 window\uff0c \u6ed1\u52a8\u7a97\u53e3 \u57fa\u4e8e\u6ed1\u52a8\u7a97\u53e3\u7684\u64cd\u4f5c\u9700\u8981\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u4e3a\u7a97\u53e3\u65f6\u957f\u4ee5\u53ca\u6ed1\u52a8\u6b65\u957f\u3002 \u7a97\u53e3\u65f6\u957f\uff1a\u8ba1\u7b97\u5185\u5bb9\u7684\u65f6\u95f4\u8303\u56f4 \u6ed1\u52a8\u6b65\u957f\uff1a\u9694\u591a\u4e45\u89e6\u53d1\u4e00\u6b21\u8ba1\u7b97 \u6ce8\u610f\uff1a\u8fd9\u4e24\u4e2a\u53c2\u6570\u90fd\u5fc5\u987b\u4e3a\u91c7\u96c6\u5468\u671f\u5927\u5c0f\u7684\u6574\u6570\u500d\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0val ssc = new StreamingContext(sparkConf, Seconds(3))\n\n\u00a0 val lines = ssc.socketTextStream(\"localhost\", 9999)\n\u00a0\u00a0val wordToOne = lines.map((_, 1))\n\n\u00a0 // \u7a97\u53e3\u7684\u8303\u56f4\u5e94\u8be5\u662f\u91c7\u96c6\u5468\u671f\u7684\u6574\u6570\u500d\n\u00a0\u00a0// \u7a97\u53e3\u53ef\u4ee5\u6ed1\u52a8\u7684\uff0c\u4f46\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u91c7\u96c6\u5468\u671f\u8fdb\u884c\u6ed1\u52a8\uff0c\n\u00a0\u00a0// \u8fd9\u6837\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u91cd\u590d\u6570\u636e\u7684\u8ba1\u7b97\uff0c\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u6539\u53d8\u6ed1\u52a8\u7684\u6ed1\u52a8\uff08\u6b65\u957f\uff09\n\u00a0\u00a0val windowDS: DStream[(String, Int)] = wordToOne.window(Seconds(6), Seconds(6))\n\n\u00a0 val wordToCount = windowDS.reduceByKey(_ + _)\n\u00a0\u00a0wordToCount.print()\n\u00a0 ssc.start()\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p> <p>2. \u6709\u72b6\u6001\u8f6c\u5316\u64cd\u4f5c\uff0c\u5c31\u662f\u53ef\u4ee5\u5728 DStream \u4e2d\u7ef4\u62a4\u72b6\u6001\uff0c\u5b9e\u73b0\u8de8\u6279\u6b21\u7edf\u8ba1 UpdateStateByKey\uff0c\u4f7f\u7528 updateStateByKey \u9700\u8981\u5bf9\u68c0\u67e5\u70b9\u76ee\u5f55\u8fdb\u884c\u914d\u7f6e\uff0c\u4f1a\u4f7f\u7528\u68c0\u67e5\u70b9\u6765\u4fdd\u5b58\u72b6\u6001\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sparkConf = new SparkConf().setMaster(\"local[*]\").setAppName(\"SparkStreaming\")\n\u00a0\u00a0val ssc = new StreamingContext(sparkConf, Seconds(3))\n\u00a0\u00a0val datas = ssc.socketTextStream(\"localhost\", 9999)\n `// \u4f7f\u7528\u6709\u72b6\u6001\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u8bbe\u5b9a\u68c0\u67e5\u70b9\u8def\u5f84`\n `ssc.checkpoint(\"cp\")`\n\u00a0\u00a0val wordToOne = datas.map((_, 1))\n\u00a0\u00a0// \u65e0\u72b6\u6001\u6570\u636e\u64cd\u4f5c\uff0c\u53ea\u5bf9\u5f53\u524d\u7684\u91c7\u96c6\u5468\u671f\u5185\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u800c\u6709\u72b6\u6001\u64cd\u4f5c\u4f1a\u5728\u524d\u9762\u5468\u671f\u8ba1\u7b97\u7684\u7ed3\u679c\u4e4b\u4e0a\u505a\u66f4\u65b0\n\u00a0\u00a0// updateStateByKey\uff1a\u6839\u636ekey\u5bf9\u6570\u636e\u7684\u72b6\u6001\u8fdb\u884c\u66f4\u65b0\n\u00a0\u00a0// \u4f20\u9012\u7684\u53c2\u6570\u4e2d\u542b\u6709\u4e24\u4e2a\u503c\uff0c\u7b2c\u4e00\u4e2a\u503c\u8868\u793a\u76f8\u540c\u7684key\u7684value\u6570\u636e\uff0c\u7b2c\u4e8c\u4e2a\u503c\u8868\u793a\u7f13\u5b58\u533a\u76f8\u540ckey\u7684value\u6570\u636e\n\u00a0\u00a0val state = wordToOne.updateStateByKey(\n\u00a0\u00a0\u00a0\u00a0(seq: Seq[Int], buff: Option[Int]) =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0val newCount = buff.getOrElse(0) + seq.sum\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Option(newCount)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0)\n\u00a0\u00a0state.print()\n\u00a0\u00a0ssc.start()\n\u00a0\u00a0ssc.awaitTermination()\n}\n</code></pre></p> <p>Output Operations\uff08\u8f93\u51fa\uff09\u539f\u8bed \u8f93\u51fa\u64cd\u4f5c\u6307\u5b9a\u4e86\u5bf9\u6d41\u6570\u636e\u7ecf\u8f6c\u5316\u64cd\u4f5c\u5f97\u5230\u7684\u6570\u636e\u6240\u8981\u6267\u884c\u7684\u64cd\u4f5c(\u4f8b\u5982\u628a\u7ed3\u679c\u63a8\u5165\u5916\u90e8\u6570\u636e\u5e93\u6216\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a)\u3002\u4e0e RDD \u4e2d\u7684\u60f0\u6027\u6c42\u503c\u7c7b\u4f3c\uff0c\u5982\u679c\u4e00\u4e2a DStream \u53ca\u5176\u6d3e\u751f\u51fa\u7684 DStream \u90fd\u6ca1\u6709\u88ab\u6267\u884c\u8f93\u51fa\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e9b DStream \u5c31\u90fd\u4e0d\u4f1a\u88ab\u6c42\u503c\u3002\u5982\u679c StreamingContext \u4e2d\u6ca1\u6709\u8bbe\u5b9a\u8f93\u51fa\u64cd\u4f5c\uff0c\u6574\u4e2a context \u5c31\u90fd\u4e0d\u4f1a\u542f\u52a8\u3002 \u8f93\u51fa\u64cd\u4f5c\u5982\u4e0b\uff1a print()\uff1a\u5728\u8fd0\u884c\u6d41\u7a0b\u5e8f\u7684\u9a71\u52a8\u7ed3\u70b9\u4e0a\u6253\u5370 DStream \u4e2d\u6bcf\u4e00\u6279\u6b21\u6570\u636e\u7684\u6700\u5f00\u59cb 10 \u4e2a\u5143\u7d20\uff0c\u5e38\u7528\u4e8e\u5f00\u53d1\u548c\u8c03\u8bd5\u3002</p> <ul> <li>saveAsTextFiles(prefix, [suffix])\uff1a\u4ee5 text \u6587\u4ef6\u5f62\u5f0f\u5b58\u50a8\u8fd9\u4e2a DStream \u7684\u5185\u5bb9\u3002\u6bcf\u4e00\u6279\u6b21\u7684\u5b58\u50a8\u6587\u4ef6\u540d\u57fa\u4e8e\u53c2\u6570\u4e2d\u7684 prefix \u548c suffix\uff0c\"prefix-Time_IN_MS[.suffix]\"\u3002</li> <li>saveAsObjectFiles(prefix, [suffix])\uff1a\u4ee5 Java \u5bf9\u8c61\u5e8f\u5217\u5316\u7684\u65b9\u5f0f\u5c06 Stream \u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u4e3aSequenceFiles\u3002\u6bcf\u4e00\u6279\u6b21\u7684\u5b58\u50a8\u6587\u4ef6\u540d\u57fa\u4e8e\u53c2\u6570\u4e2d\u7684 prefix \u548c suffix\uff0c\"prefix-Time_IN_MS[.suffix]\"\u3002</li> <li>saveAsHadoopFiles(prefix, [suffix])\uff1a\u5c06 Stream \u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u4e3a Hadoop files\u3002\u6bcf\u4e00\u6279\u6b21\u7684\u5b58\u50a8\u6587\u4ef6\u540d\u57fa\u4e8e\u53c2\u6570\u4e2d\u7684 prefix \u548c suffix\uff0c\"prefix-Time_IN_MS[.suffix]\"\u3002</li> <li>foreachRDD(func)\uff1a\u8fd9\u662f\u6700\u901a\u7528\u7684\u8f93\u51fa\u64cd\u4f5c\uff0c\u5373\u5c06\u51fd\u6570 func \u7528\u4e8e\u4ea7\u751f\u4e8e stream \u7684\u6bcf\u4e00\u4e2aRDD\u3002\u5176\u4e2d\u53c2\u6570\u4f20\u5165\u7684\u51fd\u6570 func \u5e94\u8be5\u5b9e\u73b0\u5c06\u6bcf\u4e00\u4e2a RDD \u4e2d\u6570\u636e\u63a8\u9001\u5230\u5916\u90e8\u7cfb\u7edf\uff0c\u5982\u5c06RDD \u5b58\u5165\u6587\u4ef6\u6216\u8005\u901a\u8fc7\u7f51\u7edc\u5c06\u5176\u5199\u5165\u6570\u636e\u5e93\u3002</li> </ul> <p>foreachRDD\u539f\u8bed \u548c\u00a0transform\u539f\u8bed\u7c7b\u4f3c\uff0c\u90fd\u662f\u76f4\u63a5\u628aRDD\u4ea4\u7ed9\u7a0b\u5e8f\u5458\u6765\u64cd\u4f5c\uff0c\u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u7075\u6d3b\u6027\uff0c\u4f46\u662f foreachRDD\u662f\u8f93\u51fa\u539f\u8bed\uff0c\u6240\u4ee5 foreachRDD\u7684\u533f\u540d\u51fd\u6570\u7684\u8fd4\u56de\u503c\u662fUnit\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/3-RDD%E7%9A%84%E5%88%9B%E5%BB%BA/","title":"3-RDD\u7684\u521b\u5efa","text":"<p> \u7ea6 575 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 12 \u5206\u949f</p> <p>\u521b\u5efa RDD \u7684\u56db\u79cd\u65b9\u5f0f\uff1a 1. \u4ece\u96c6\u5408\uff08\u5185\u5b58\uff09\u4e2d\u521b\u5efa RDD \u4ece\u96c6\u5408\u4e2d\u521b\u5efa RDD\uff0c Spark \u4e3b\u8981\u63d0\u4f9b\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff1a parallelize \u548c makeRDD Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"RDD\")\n\u00a0val sc = new SparkContext(conf)\n\n\u00a0// \u4ece\u5185\u5b58\u4e2d\u521b\u5efaRDD\uff0c\u5c06\u5185\u5b58\u4e2d\u96c6\u5408\u7684\u6570\u636e\u4f5c\u4e3a\u5904\u7406\u7684\u6570\u636e\u6e90\n\u00a0val seq: Seq[Int] = Seq(1, 2, 3, 4)\n `//\u4f7f\u7528parallelize\u65b9\u6cd5\u521b\u5efa`\n `val rdd_1: RDD[Int] = sc.parallelize(seq)`\n\u00a0rdd_1.collect().foreach(println)\n\n `//\u4f7f\u7528makeRDD\u65b9\u6cd5\u521b\u5efa`\n `val rdd_2: RDD[Int] = sc.makeRDD(seq)`\n\u00a0rdd_2.collect().foreach(println)\n\n\u00a0sc.stop()\n}\n</code></pre> \u5176\u5b9emakeRDD \u65b9\u6cd5\u8c03\u7528\u4e86 parallelize \u65b9\u6cd5 Text Only<pre><code>def makeRDD[T: ClassTag](\n\u00a0 \u00a0seq: Seq[T],\n\u00a0 \u00a0numSlices: Int = defaultParallelism): RDD[T] = withScope {\n\u00a0parallelize(seq, numSlices)\n}\n</code></pre></p> <p>2. \u4ece\u5916\u90e8\u5b58\u50a8\uff08\u6587\u4ef6\uff09\u521b\u5efa RDD \u4ece\u5916\u90e8\u5b58\u50a8\u7cfb\u7edf\u7684\u6570\u636e\u96c6\u521b\u5efa RDD \u5305\u62ec\uff1a\u672c\u5730\u7684\u6587\u4ef6\u7cfb\u7edf\u3001HDFS \u7b49\u3002 2.1 \u4f7f\u7528textFile\u65b9\u6cd5\uff0ctextFile\u4ee5\u884c\u4e3a\u5355\u4f4d\u8bfb\u53d6\u6240\u6709\u6587\u4ef6\u7684\u5185\u5bb9 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val conf = new SparkConf().setMaster(\"local[*]\").setAppName(\"RDD\")\n\u00a0val sc = new SparkContext(conf)\n\n `//\u4ece\u672c\u5730\u6587\u4ef6\u4e2d\u521b\u5efaRDD\uff0c\u5c06\u672c\u5730\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u4f5c\u4e3a\u5904\u7406\u7684\u6570\u636e\u6e90`\n `//\u4ee5\u9879\u76ee\u7684\u6839\u8def\u5f84\u4f5c\u4e3a\u57fa\u51c6`\n `val rdd_1: RDD[String] = sc.textFile(\"data/1.txt\")`\n `//\u53ef\u4ee5\u6307\u5b9a\u76ee\u5f55\uff0c\u6b64\u65f6\u8bfb\u53d6\u76ee\u5f55\u4e2d\u6240\u6709\u6587\u4ef6\u7684\u6570\u636e`\n `val rdd_2: RDD[String] = sc.textFile(\"data\")`\n `//\u8fd8\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26\u6765\u6307\u5b9a\u6587\u4ef6\uff0c\u6bd4\u5982\u53ea\u8bfb\u53d6data\u76ee\u5f55\u4e0b\u4ee51\u5f00\u5934\u7684txt\u6587\u4ef6`\n `val rdd_3: RDD[String] = sc.textFile(\"data/1*.txt\")`\n `//\u4eceHDFS\u4e2d\u521b\u5efaRDD\uff0c\u5c06HDFS\u4e0a\u7684\u6570\u636e\u4f5c\u4e3a\u5904\u7406\u7684\u6570\u636e\u6e90`\n `val rdd_4: RDD[String] = sc.textFile(\"hdfs://hadoop102:8020/1.txt\")`\n\n\u00a0rdd_1.collect().foreach(print)\n\u00a0rdd_2.collect().foreach(print)\n\u00a0rdd_3.collect().foreach(print)\n\u00a0rdd_4.collect().foreach(print)\n\u00a0sc.stop()\n}\n</code></pre> 2.2 \u4f7f\u7528wholeTextFiles\u65b9\u6cd5\u53ef\u4ee5\u5728\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u83b7\u53d6\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002wholeTextFiles\u4f1a\u5c06\u6570\u636e\u5c01\u88c5\u8fdb\u4e00\u4e2a\u4e8c\u5143\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u503c\u662f\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u7684\u503c\u662f\u8be5\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u6570\u636e\u3002\u4e5f\u5c31\u662fwholeTextFiles\u4ee5\u6587\u4ef6\u4e3a\u5355\u4f4d\u8fdb\u884c\u8bfb\u53d6\uff0c\u800ctextFile\u5219\u662f\u4ee5\u884c\u4e3a\u5355\u4f4d\u8bfb\u53d6\u3002 Text Only<pre><code>`//\u4ece\u672c\u5730\u6587\u4ef6\u4e2d\u521b\u5efaRDD\uff0c\u5c06\u672c\u5730\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u4f5c\u4e3a\u5904\u7406\u7684\u6570\u636e\u6e90 ,\u4ee5\u9879\u76ee\u7684\u6839\u8def\u5f84\u4f5c\u4e3a\u57fa\u51c6`\n`val rdd_1: RDD[(String, String)] = sc.wholeTextFiles(\"data\")`\nval res: Array[(String, String)] = rdd_1.collect()\n</code></pre></p> <p>3. \u4ece\u5176\u4ed6 RDD \u521b\u5efa\uff0c\u5373\u4e00\u4e2a RDD \u8fd0\u7b97\u5b8c\u540e\u518d\u4ea7\u751f\u65b0\u7684 RDD 4. \u76f4\u63a5\u521b\u5efa RDD\uff08new\uff09\uff0c\u4f7f\u7528 new \u7684\u65b9\u5f0f\u76f4\u63a5\u6784\u9020 RDD\uff0c\u4e00\u822c\u7531 Spark \u6846\u67b6\u81ea\u8eab\u4f7f\u7528\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/4-RDD%E5%B9%B6%E8%A1%8C%E5%BA%A6%E4%B8%8E%E5%88%86%E5%8C%BA/","title":"4-RDD\u5e76\u884c\u5ea6\u4e0e\u5206\u533a","text":"<p> \u7ea6 2157 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 43 \u5206\u949f</p> <p>RDD \u5e76\u884c\u5ea6\u4e0e\u5206\u533a \u4e00\u4e2a\u9636\u6bb5\u5185\u5206\u533a\u6570\u7b49\u4e8etask\u6570\uff0cExecutor\u4f1a\u4e3a\u6bcf\u4e00\u4e2atask\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u540c\u4e00\u65f6\u523b\u5e76\u884c\u6267\u884c\u7684\u7ebf\u7a0b\u6570\u5c31\u662f\u5e76\u884c\u5ea6\uff0c\u53ef\u89c1task\u6570\u5e76\u4e0d\u7b49\u4e8e\u5e76\u884c\u5ea6\u3002\u6bd4\u5982Spark\u96c6\u7fa4\u670910\u53f0\u4e3b\u673a\uff0c\u6bcf\u53f0\u4e3b\u673a\u7684cpu\u7ebf\u7a0b\u6570\u4e3a4\uff0c\u5e76\u4e14\u6bcf\u53f0\u4e3b\u673a\u6709\u4e00\u4e2aExecutor\uff0c\u5047\u8bbe\u6b64\u65f6Spark\u6b63\u5728\u6267\u884c\u7684\u9636\u6bb5\u6709100\u4e2atask\uff0c\u90a3\u4e48\u8fd910\u4e2aExecutor\u4f1a\u542f\u52a8100\u7ebf\u7a0b\u6765\u6267\u884ctask\uff0c\u4f46\u662f\u56e0\u4e3a\u6574\u4e2a\u96c6\u7fa4\u6700\u591a\u53ea\u80fd\u5e76\u884c\u6267\u884c10x4=40\u4e2a\u7ebf\u7a0b\uff0c\u4e8e\u662f\u6b64\u65f6Spark\u96c6\u7fa4\u5e76\u884c\u5ea6\u6700\u5927\u53ea\u80fd\u662f40\uff0c\u6240\u4ee5\u5e94\u8be5\u8bf4task\u6570\u603b\u662f\u5927\u4e8e\u7b49\u4e8e\u5e76\u884c\u5ea6\u7684\u3002</p> <p>task\u6570\u7b49\u4e8e\u5206\u533a\u6570\uff0c\u53ef\u4ee5\u521b\u5efaRDD\u65f6\u6307\u5b9a\u5206\u533a\u7684\u6570\u91cf\u3002 1.\u96c6\u5408\uff08\u5185\u5b58\uff09\u4e2d\u6570\u636e\u7684\u5206\u533a 1.1 \u8bbe\u7f6e\u5206\u533a\u6570 1.1.1 \u660e\u786e\u6307\u5b9a\u5206\u533a\u6570 makeRDD\u65b9\u6cd5\u521b\u5efa\u7684\u662fParallelCollectionRDD\u7684\u5bf9\u8c61\uff0c\u53ef\u4ee5\u5728\u521b\u5efa\u65f6\u6307\u5b9a\u5206\u533a\u6570\u91cf\u3002makeRDD\u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570numSlices\u8868\u793a\u5206\u533a\u7684\u6570\u91cf\uff0csaveAsTextFile\u65b9\u6cd5\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u5206\u533a\u5904\u7406\u540e\u7684\u6570\u636e\u4fdd\u5b58\u6210\u6587\u4ef6\uff0c\u4e00\u4e2a\u5206\u533a\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u6587\u4ef6\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"RDD\")\n\u00a0 \u00a0// makeRDD\u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570numSlices\u8868\u793a\u5206\u533a\u7684\u6570\u91cf\n\u00a0 \u00a0val rdd_1: RDD[Int] = sc.makeRDD(List(1, 2, 3, 4), 2)\n\u00a0 \u00a0//\u5c06\u5904\u7406\u540e\u7684\u6570\u636e\u4fdd\u5b58\u6210\u6587\u4ef6\n\u00a0 \u00a0rdd_1.saveAsTextFile(\"output\")\n\u00a0 \u00a0 sc.stop()\n}\n</code></pre> 1.1.2 \u9ed8\u8ba4\u5206\u533a\u6570 makeRDD\u65b9\u6cd5\u7684numSlices\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u662fdefaultParallelism\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\uff0c\u6700\u7ec8\u6267\u884c\u7684\u662fLocalSchedulerBackend\u7684defaultParallelism\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u903b\u8f91\u5c31\u662f\u9ed8\u8ba4\u5206\u533a\u6570\u7684\u6307\u5b9a\u903b\u8f91\u3002 Text Only<pre><code>def makeRDD[T: ClassTag](\n\u00a0 \u00a0seq: Seq[T],\n\u00a0 \u00a0`numSlices: Int = defaultParallelism`): RDD[T] = withScope {\n\u00a0parallelize(seq, numSlices)\n}\n</code></pre> Text Only<pre><code>override def defaultParallelism(): Int =\n\u00a0scheduler.conf.getInt(\"spark.default.parallelism\", totalCores)\n</code></pre> \u5982\u679c\u6ca1\u6709\u5728\u521b\u5efa\u65f6\u6307\u5b9a\u5206\u533a\u6570\u91cf\uff0c\u5219\u5206\u533a\u6570\u91cf\u7b49\u4e8e\u9ed8\u8ba4\u5e76\u884c\u5ea6\u3002\u9ed8\u8ba4\u7684\u5e76\u884c\u5ea6\u7531setMaster(\"local[*]\")\u6307\u5b9a\uff0c*\u8868\u793a\u5e76\u884c\u5ea6\u7b49\u4e8e\u672c\u5730cpu\u7ebf\u7a0b\u6570\uff0cSpark\u4f1a\u4f7f\u7528\u4e0e\u672c\u5730CPU\u7ebf\u7a0b\u6570\u540c\u6837\u591a\u7684\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u3002setMaster(\"local[4]\")\u8868\u793a\u5e76\u884c\u5ea6\u7b49\u4e8e4\uff0cspark\u4f1a\u4f7f\u75284\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u3002setMaster(\"local\")\u8868\u793a\u4f7f\u7528\u5355\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u3002 \u4e5f\u53ef\u7531 SparkConf \u7684 spark.default.parallelism \u53c2\u6570\u6307\u5b9a\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff0c\u8fd9\u4e2a\u503c\u4f1a\u8986\u76d6setMaster(\"local[*]\")\u6307\u5b9a\u7684\u503c\u3002 \u6bd4\u5982\u5f53\u4f7f\u7528makeRDD\u521b\u5efaRDD\u65f6\u6ca1\u6709\u6307\u5b9a\u5206\u533a\u6570\u91cf\uff0c\u5e76\u4e14setMaster(\"local[*]\")\uff0c\u5982\u679c\u6709set(\"spark.default.parallelism\", \"8\")\uff0c\u90a3\u4e48\u5206\u533a\u6570\u7b49\u4e8e\u5e76\u884c\u5ea6\u7b49\u4e8e8\uff0csaveAsTextFile()\u6700\u540e\u5c31\u4f1a\u4fdd\u5b588\u4e2a\u6587\u4ef6\u3002 \u7efc\u4e0a\u5c31\u662f\uff0c \uff081\uff09\u4efb\u52a1\u6570\uff1d\u5206\u533a\u6570 \uff082\uff09\u5e76\u884c\u5ea6 \u2260 \u4efb\u52a1\u6570 \uff083\uff09\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u5206\u533a\u6570\uff0c\u90a3\u4e48\u5206\u533a\u6570\uff1d\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff1b\u5982\u679c\u8bbe\u7f6e\u4e86\u5206\u533a\u6570\uff0c\u90a3\u4e48\u5206\u533a\u6570\u5c31\u662f\u4f60\u6240\u8bbe\u7f6e\u7684\u6570\u91cf\u3002</p> <p>\u5206\u533a\u5c31\u662f\u6570\u636e\uff0c\u4efb\u52a1\u5c31\u662f\u8ba1\u7b97\uff0c\u5728\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\uff0c\u79fb\u52a8\u6570\u636e\u4e0d\u5982\u79fb\u52a8\u8ba1\u7b97\uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u597d\u5206\u533a\u6570\u4e4b\u540e\uff0c\u4f1a\u5c31\u8fd1\u5730\u5728HDFS\u4e0a\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540etask\u4f5c\u4e3a\u8ba1\u7b97\u5206\u53d1\u7ed9\u5206\u4e00\u4e2a\u8282\u70b9\u3002</p> <p>\u603b\u7ed3 \u6d41\u5f0f\u8ba1\u7b97 \u548c \u6279\u8ba1\u7b97 \u5206\u533a\u5e76\u884c\u7279\u70b9\u533a\u522b\uff1a \u6d41\u5f0f\u8ba1\u7b97Flink\u7684\u6bcf\u4e00\u6b65\u7b97\u5b50\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u5e76\u884c\u5ea6\uff0c\u56e0\u4e3a\u6d41\u5f0f\u8ba1\u7b97\u5728\u5f00\u59cb\u5904\u7406\u6570\u636e\u4e4b\u524d\u5c31\u6784\u5efa\u597d\u4e86\u6574\u4e2a\u8ba1\u7b97\u6d41\u56fe\uff1b\u800c\u6279\u8ba1\u7b97Spark\u53ea\u80fd\u5728\u6700\u5f00\u59cb\u8bfb\u6570\u636e\u7684\u65f6\u5019\u8bbe\u7f6e\u5206\u533a\u6570\uff08\u4e0d\u7b49\u4e8e\u5e76\u884c\u5ea6\uff0c\u5982\u679c\u5355\u6838cpu\uff0c\u90a3\u4e48\u6240\u6709task\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\uff09\uff0c\u6216\u8005\u5728shuffle\u65f6\u8bbe\u7f6e\u5206\u533a\u6570\uff08\u56e0\u4e3amap\u9636\u6bb5\u662f\u7a84\u4f9d\u8d56\u5206\u533a\u6570\u4e0d\u53d8\uff0cshuffle\u662f\u5bbd\u4f9d\u8d56\uff0c\u5206\u533a\u6570\u53ef\u4ee5\u53d1\u751f\u6539\u53d8\uff09\uff0c\u5982\u679c\u5728shuffle\u65f6\u6ca1\u6709\u8bbe\u7f6e\u5206\u533a\u6570\uff0c\u90a3\u4e48shuffle\u540e\u7684\u5206\u533a\u6570\u5e94\u8be5\u4e5f\u4e0d\u4f1a\u8d85\u8fc7\u6700\u5f00\u59cb\u65f6\u8bbe\u7f6e\u7684\u5206\u533a\u6570\u3002</p> <p>2.\u6570\u636e\u7684\u5206\u533a\u89c4\u5219 getPartitions\u4e3aRDD\u7c7b\u5b9a\u4e49\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u6bcf\u4e00\u4e2a\u5177\u4f53\u7684RDD\u90fd\u9700\u8981\u7ee7\u627fRDD\u5e76\u91cd\u5199getPartitions\u65b9\u6cd5\uff0c\u7528\u6765\u5b9e\u73b0\u81ea\u5df1\u7684\u5206\u533a\u89c4\u5219\u3002 2.1 ParallelCollectionRDD\u7684\u5206\u533a\u89c4\u5219 ParallelCollectionRDD\u7684getPartitions\u65b9\u6cd5\u7684\u6838\u5fc3\u903b\u8f91\u5728\u5176\u4f34\u751f\u5bf9\u8c61\u4e2d\uff0c\u6e90\u7801\u5982\u4e0b\uff0c\u8be5\u65b9\u6cd5\u8ba1\u7b97\u7684\u6bcf\u4e2a\u5206\u533a\u5728\u96c6\u5408\u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e\u548c\u7ed3\u675f\u4f4d\u7f6e\uff08\u5728\u771f\u6b63\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u7247\u65f6\u662f\u4e0d\u5305\u542b\u7ed3\u675f\u4f4d\u7f6e\u7684\u5143\u7d20\u7684\uff0c\u4e0d\u7136\u5143\u7d20\u5c31\u91cd\u590d\u4e86\uff09\u3002 Text Only<pre><code>def positions(length: Long, numSlices: Int): Iterator[(Int, Int)] = {\n\u00a0(0 until numSlices).iterator.map { i =&gt;\n\u00a0 \u00a0val start = ((i * length) / numSlices).toInt\n\u00a0 \u00a0val end = (((i + 1) * length) / numSlices).toInt\n\u00a0 \u00a0(start, end)\n\u00a0}\n}\n</code></pre> \u6bd4\u5982\u6267\u884c\u4ee5\u4e0b\u4ee3\u7801\u4f1a\u751f\u6210\u4e09\u4e2a\u6587\u4ef6\uff0c\u56e0\u4e3a\u8bbe\u7f6e\u7684\u5206\u533a\u6570\u662f3\uff0c\u4e09\u4e2a\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u5206\u522b\u662f[1]\u3001[2,3]\u3001[4,5] Text Only<pre><code>val rdd_1: RDD[Int] = sc.makeRDD(List(1, 2, 3, 4, 5), 3)\nrdd_1.saveAsTextFile(\"output\")\n</code></pre> \u8ba1\u7b97\u8fc7\u7a0b\u662f\uff1alength = 5 \uff0cnumSlices = 3 \uff0c\u7136\u540e\u6309\u6e90\u7801\u8ba1\u7b97\u5f97\u5230\u7684(start, end)\u7ed3\u679c\u662f(0,1)\u3001(1,3)\u3001(3,5)\uff0c\u4e8e\u662f\u4e09\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u4f9d\u6b21\u662f[1]\u3001[2,3]\u3001[4,5]</p> <p>2.2 \u6587\u4ef6\u4e2d\u6570\u636e\u7684\u5206\u533a textFile\u65b9\u6cd5\u521b\u5efa\u7684\u662fHadoopRDD\uff0ctextFile\u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570numSlices\u8868\u793a\u5206\u533a\u7684\u6570\u91cf\uff0c\u867d\u7136\u5728\u521b\u5efa\u65f6\u53ef\u4ee5\u6307\u5b9a\u6587\u4ef6\u6570\u636e\u7684\u5206\u533a\u6570\uff0c\u4f46\u662f\u6700\u7ec8\u7684\u5206\u533a\u6570\u5e76\u4e0d\u4e00\u5b9a\u662f\u6307\u5b9a\u7684\u5206\u533a\u6570\uff0cnumSlices\u53ea\u662fHadoopRDD\u7684getPartitions\u65b9\u6cd5\u8ba1\u7b97\u5206\u533a\u7684\u4e00\u4e2a\u57fa\u51c6\uff0c\u4e0d\u50cfParallelCollectionRDD\u7684getPartitions\u65b9\u6cd5\u4e00\u5b9a\u4f1a\u751f\u6210numSlices\u4e2a\u5206\u533a\uff08ParallelCollectionRDD\u7684getPartitions\u65b9\u6cd5\u7684\u8ba1\u7b97\u903b\u8f91\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u70b9\uff09\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 \u00a0val conf = new SparkConf().setMaster(\"local\").setAppName(\"RDD\")\n\u00a0 \u00a0val sc = new SparkContext(conf)\n\u00a0 \u00a0`//textFile\u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570numSlices\u8868\u793a\u5206\u533a\u7684\u6570\u91cf`\n `val rdd_2: RDD[String] = sc.textFile(\"data/1.txt\", 2)`\n\u00a0 \u00a0rdd_2.saveAsTextFile(\"output\")\n\u00a0 \u00a0sc.stop()\n}\n</code></pre> textFile\u65b9\u6cd5\u548cdefaultMinPartitions\u65b9\u6cd5\u5982\u4e0b\uff0c minPartitions\u7684\u9ed8\u8ba4\u503c\u662f\u9ed8\u8ba4\u5e76\u884c\u5ea6\u548c2\u4e2d\u7684\u5c0f\u503c\u3002 Text Only<pre><code>def textFile(\n\u00a0 \u00a0path: String,\n\u00a0 \u00a0`minPartitions: Int = defaultMinPartitions`): RDD[String] = withScope {\n\u00a0assertNotStopped()\n\u00a0hadoopFile(path, classOf[TextInputFormat], classOf[LongWritable], classOf[Text],\n\u00a0 \u00a0minPartitions).map(pair =&gt; pair._2.toString).setName(path)\n}\n</code></pre> Text Only<pre><code>def defaultMinPartitions: Int = math.min(defaultParallelism, 2)\n</code></pre> HadoopRDD\u7684getPartitions\u65b9\u6cd5\u4f1a\u6267\u884cFileInputFormat\u7684getSplits\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u662fMapReduce\u8ba1\u7b97\u5206\u7247\u8ba1\u5212\u7684\u65b9\u6cd5\uff08\u5e76\u4e0d\u662f\u6700\u65b0\u7248\u7684Hadoop\uff09\uff0cHadoopRDD\u7684\u5206\u533a\u903b\u8f91\u4e3b\u8981\u5728\u8fd9\uff1a 1.\u5982\u679c\u6307\u5b9a\u5206\u533a\u6570\u91cf\u4e3a0\u6216\u80051\u7684\u8bdd\uff0cdefaultMinPartitions\u503c\u4e3a1\uff0c\u5219\u6709\u591a\u5c11\u4e2a\u6587\u4ef6\uff0c\u5c31\u4f1a\u6709\u591a\u5c11\u4e2a\u5206\u533a\u3002 2.\u5982\u679c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u5206\u533a\u6570\u91cf\uff0c\u5219\u9ed8\u8ba4\u5206\u533a\u6570\u91cf\u4e3a2\uff0c\u5982\u679c\u6307\u5b9a\u5206\u533a\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e2\uff0c\u5219\u9ed8\u8ba4\u5206\u533a\u6570\u91cf\u4e3a\u6307\u5b9a\u503c\u3002FileInputFormat\u7684getSplits\u65b9\u6cd5\u5219\u4f1a\u8ba1\u7b97\u6240\u6709\u6587\u4ef6\u7684\u603b\u5b57\u8282\u5927\u5c0ftotalSize\uff0c\u7136\u540e\u9664\u4ee5\u5206\u533a\u6570\u91cfnumSlices\u7684\u503c\u5f97\u5230goalSize\uff0c\u63a5\u7740\u6bd4\u8f83goalSize\u548chdfs\u7684\u5757\u5927\u5c0f\uff08\u8fd9\u91cc\u662f32M\uff09\uff0c\u4ee5\u4e24\u8005\u4e2d\u7684\u5c0f\u503c\u4f5c\u4e3a\u5207\u7247\u7684\u5927\u5c0f\u3002\u63a5\u7740\u5bf9\u6bcf\u4e00\u4e2a\u6587\u4ef6\u6267\u884c\u5207\u7247\u903b\u8f91\uff0c\u5373\u5982\u679c\u8be5\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u5207\u7247\u5927\u5c0f\u76841.1\u500d\uff0c\u5219\u5c06\u8fd9\u4e2a\u6587\u4ef6\u6309\u4e00\u4e2a\u5207\u7247\u5927\u5c0f\u5207\u5f00\uff0c\u7136\u540e\u5bf9\u5269\u4f59\u90e8\u5206\u7ee7\u7eed\u6267\u884c\u5207\u7247\u903b\u8f91\u3002\u6700\u7ec8\u7684\u5207\u7247\u6570\u91cf\u7b49\u4e8e\u5206\u533a\u7684\u6570\u91cf\u3002\u6ce8\u610f\uff0c\u5207\u7247\u5e76\u4e0d\u662f\u771f\u7684\u5c06\u4e00\u4e2a\u6587\u4ef6\u5212\u5206\u6210\u4e86\u4e24\u4e2a\u6587\u4ef6\uff0c\u800c\u53ea\u662f\u8ba1\u7b97\u4e86\u6bcf\u4e00\u4e2a\u5206\u7247\u7684\u504f\u79fb\u91cf\u548c\u6700\u7ec8\u5206\u7247\u7684\u6570\u76ee\u3002 \u6240\u4ee5\uff0c\u4eceFileInputFormat\u7684getSplits\u65b9\u6cd5\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528textFile\u65b9\u6cd5\u521b\u5efaHadoopRDD\u65f6\u6307\u5b9a\u7684numSlices\u5e76\u4e0d\u662f\u6700\u7ec8\u7684\u5206\u533a\u6570\u91cf\uff0c\u800c\u662f\u4ee5getSplits\u65b9\u6cd5\u6700\u7ec8\u7684\u5207\u7247\u6570\u91cf\u6765\u51b3\u5b9a\uff0c\u5373\u5207\u7247\u6570\u91cf\u7b49\u4e8e\u5206\u533a\u7684\u6570\u91cf\u3002\u6ce8\u610f\uff0c\u867d\u7136\u5206\u533a\u6570\u5df2\u7ecf\u786e\u5b9a\uff0c\u4f46\u6bcf\u4e00\u4e2a\u5206\u533a\u7684\u4e2d\u6570\u636e\u5e76\u4e0d\u5b8c\u5168\u7b49\u540c\u6bcf\u4e00\u4e2a\u5207\u7247\u4e2d\u7684\u6570\u636e\uff0c\u56e0\u4e3aspark\u5728\u8bfb\u53d6\u6587\u4ef6\u4e2d\u6570\u636e\u65f6\u4f1a\u5c06\u540c\u4e00\u884c\u6570\u636e\u653e\u5230\u4e00\u4e2a\u5206\u533a\u4e2d\uff0c\u4e0d\u5b58\u5728\u628a\u4e00\u884c\u6570\u636e\u4ece\u4e2d\u95f4\u5206\u5f00\u8bfb\u5230\u4e24\u4e2a\u5206\u533a\u4e2d\u7684\u60c5\u51b5\u3002</p> <p>\u5e76\u884c\u5ea6\u8868\u793a\u53ef\u4ee5\u4f7f\u7528\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u5e76\u884c\u5ea6\u7b49\u4e8eCPU\u6838\u5fc3\u6570\uff1b\u5206\u533a\u6570\u5c31\u662f\u4efb\u52a1\u6570\uff0c\u5982\u679c\u5c0f\u4e8e\u5e76\u884c\u5ea6\uff0c\u90a3\u4e48\u53ea\u4f1a\u7528\u5230\u5206\u533a\u6570\u91cf\u4e2a\u7ebf\u7a0b\uff0c\u5982\u679c\u5927\u4e8e\u5e76\u884c\u5ea6\u5c31\u4f1a\u6709\u591a\u4e2a\u4efb\u52a1\u7531\u540c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\uff1b\u5e76\u884c\u5ea6\u548c\u5206\u533a\u6570\u8bbe\u7f6e\u5927\u4e0e\u8bbe\u7f6e\u5c0f\u90fd\u6709\u9053\u7406\uff0c\u62ff\u4e0d\u51c6\u5c31\u76f4\u63a5\u4f7f\u7528\u9ed8\u8ba4\u7b56\u7565\u5427\u3002</p> <p>spark\u5982\u4f55\u4fdd\u8bc1\u5185\u5b58\u4e0d\u6ea2\u51fa\uff1f \u4e0d\u7528\u7ba1spark\u5982\u4f55\u8bfb\u6570\u636e\uff0c\u6bd4\u5982\u670920\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u8d1f\u8d231G\u7684\u6570\u636e\uff0c\u5e76\u884c\u5ea616\uff0cCPU\u670916\u4e2a\u7ebf\u7a0b\uff0c\u5185\u5b58\u67098G\uff0c\u6b64\u914d\u7f6e\u4e0b\uff0c\u4f1a\u670916\u4e2a\u5206\u533a\u540c\u65f6\u5904\u7406\u6570\u636e\uff0c\u4f60\u8bf4Spark\u80fd\u4e00\u6b21\u6027\u628a16\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u90fd\u8bfb\u5230\u5185\u5b58\u5417\uff0c\u663e\u7136\u662f\u4e0d\u53ef\u4ee5\u7684\uff0c\u8fd916\u4e2a\u5206\u533a\u80af\u5b9a\u662f\u5728\u5206\u6279\u8bfb\u5916\u5b58\u7684\u6570\u636e\uff0c\u4fdd\u8bc1\u4e0d\u5185\u5b58\u6ea2\u51fa\uff0c\u8fd9\u4e2a\u8bfb\u53d6\u7684\u7b56\u7565\u80af\u5b9a\u5c31\u662f\u7531Spark\u6765\u5b8c\u6210\uff0c\u6240\u4ee5\u4f7f\u7528Spark\u7684\u65f6\u5019\uff0c\u4e0d\u7528\u7ba1\u6570\u636e\u5927\u5c0f\uff0c\u53ea\u9700\u8981\u8003\u8651\u8bbe\u7f6e\u5206\u533a\u6570\u548c\u5e76\u884c\u5ea6\uff0c\u4e0d\u9700\u8981\u8981\u8003\u8651\u5206\u533a\u5982\u4f55\u8bfb\u53d6\u6570\u636e\u3002</p> <p>https://www.zhihu.com/question/23079001/answer/23569986</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/5-RDD%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90%20%E4%B9%8B%20Value%20%E7%B1%BB%E5%9E%8B/","title":"5-RDD\u8f6c\u6362\u7b97\u5b50 \u4e4b Value \u7c7b\u578b","text":"<p> \u7ea6 1665 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 33 \u5206\u949f</p> <p>Spark\u4e09\u5927\u6570\u636e\u7ed3\u6784\u5206\u522b\u662f\uff1a</p> <ol> <li>RDD : \u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6</li> <li>\u7d2f\u52a0\u5668\uff1a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf</li> <li>\u5e7f\u64ad\u53d8\u91cf\uff1a\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u8bfb\u53d8\u91cf</li> </ol> <p>RDD\u7684\u65b9\u6cd5\u4e5f\u79f0\u4e3a\u7b97\u5b50(operator)\uff0c\u53ef\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662f\u8f6c\u6362(transform)\uff0c\u53e6\u5916\u4e00\u7c7b\u662f\u884c\u52a8(action)\u3002\u8f6c\u6362\u662f\u6307\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982map\u3001flatMap\u3001groupBy\u7b49\u64cd\u4f5c\uff0c\u8f6c\u6362\u53ea\u662f\u64cd\u4f5c\u7684\u58f0\u660e\uff0c\u5e76\u4e0d\u662f\u7acb\u5373\u5c31\u5df2\u7ecf\u5bf9\u6570\u636e\u8fdb\u884c\u4e86\u64cd\u4f5c\uff0c\u56e0\u4e3a\u6bcf\u4e00\u6b65\u8f6c\u6362\u64cd\u4f5c\u90fd\u662f\u5c06\u524d\u4e00\u4e2aRDD\u5bf9\u8c61\u7684\u5c01\u88c5\u540e\u4e00\u4e2aRDD\u5bf9\u8c61\u4e2d\uff0c\u771f\u6b63\u7684\u64cd\u4f5c\u6570\u636e\u8981\u7b49\u5230\u884c\u52a8\u65b9\u6cd5\u88ab\u8c03\u7528\u3002\u884c\u52a8\u7b97\u5b50\u662f\u6307\u4f1a\u89e6\u53d1\u4efb\u52a1\u7684\u8c03\u5ea6\u548c\u4f5c\u4e1a\u7684\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u5982collect\u3001saveAsTextFile\u7b49\u64cd\u4f5c\u3002 \u4e4b\u6240\u4ee5\u5c06RDD\u7684\u65b9\u6cd5\u79f0\u4e3a\u7b97\u5b50\uff0c\u662f\u4e3a\u4e86\u4e0eScala\u64cd\u4f5c\u96c6\u5408\u7684\u65b9\u6cd5\u533a\u5206\uff0c\u56e0\u4e3a\u4e8c\u8005\u5728\u5904\u7406\u6570\u636e\u7684\u601d\u60f3\u4e0a\u786e\u5b9e\u5f88\u50cf\uff0c\u4f46\u662fSpark\u7b97\u5b50\u5b9e\u9645\u7684\u6267\u884c\u539f\u7406\u5374\u4e0eScala\u64cd\u4f5c\u96c6\u5408\u7684\u65b9\u6cd5\u7684\u6267\u884c\u539f\u7406\u6709\u7740\u5f88\u5927\u533a\u522b\uff0c\u6bd4\u5982\u6b63\u5982\u4e0a\u9762\u6240\u8bf4\uff0c\u8f6c\u6362\u7b97\u5b50\u53ea\u662f\u58f0\u660e\u64cd\u4f5c\uff0c\u5e76\u6ca1\u771f\u6b63\u8ba1\u7b97\uff0c\u771f\u6b63\u7684\u8ba1\u7b97\u8981\u7b49\u5230\u884c\u52a8\u7b97\u5b50\u88ab\u6267\u884c\uff1b\u8fd8\u6709\u5c31\u662fSpark\u7684RDD\u7b97\u5b50\u662f\u5206\u5e03\u5f0f\u5e76\u884c\u6267\u884c\u7684\uff0c\u64cd\u4f5c\u7684\u662f\u4e0d\u540c\u4e3b\u673a\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u50cfScala\u7684\u96c6\u5408\u7684\u65b9\u6cd5\u53ea\u662f\u5bf9\u672c\u673a\u5185\u5b58\u4e2d\u6570\u636e\u7684\u64cd\u4f5c\u3002</p> <p>\u8f6c\u6362\u7b97\u5b50\u6839\u636e\u6570\u636e\u5904\u7406\u65b9\u5f0f\u7684\u4e0d\u540c\u5c06\u7b97\u5b50\u6574\u4f53\u4e0a\u5206\u4e3a Value \u7c7b\u578b\u3001\u53cc Value \u7c7b\u578b\u548c Key-Value \u7c7b\u578b\u3002</p> <ul> <li>Value \u7c7b\u578b\u6307\u7684\u662f\u53ef\u4ee5\u5bf9\u4efb\u4f55\u6570\u636e\u6e90\u8fdb\u884c\u64cd\u4f5c\u7684\u7b97\u5b50</li> <li>\u53ccvalue\u7c7b\u578b\u6307\u7684\u662f\u53ea\u80fd\u5bf9\u4e24\u4e2a\u6570\u636e\u6e90\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u7b97\u5b50</li> <li>Key-Value \u7c7b\u578b\u6307\u7684\u662f\u53ea\u80fd\u5bf9\u5143\u7d20\u662f\u4e8c\u5143\u7ec4\u7684\u6570\u636e\u6e90\u8fdb\u884c\u64cd\u4f5c\u7684\u7b97\u5b50</li> </ul> <p>\u4ee5\u4e0b\u4ee3\u7801\u5747\u662f\u4ee5Local\u6a21\u5f0f\u8fd0\u884c\uff0cLocal\u6a21\u5f0f\u4e0b\u53ea\u6709\u4e00\u4e2aExecutor\uff0c\u6240\u6709\u5206\u533a\u90fd\u5728\u8fd9\u4e2aExecutor\u91cc\u9762\uff0c\u6bcf\u4e2a\u5206\u533a\u5bf9\u5e94\u4e8e\u4e00\u4e2atask\uff0cExecutor\u4f1a\u4e3a\u6bcf\u4e2atask\u90fd\u4f1a\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u3002</p> <p>Value \u7c7b\u578b 1. map\uff0c\u6620\u5c04 \u5bf9\u6bcf\u4e00\u4e2a\u6570\u636e\u505a\u6620\u5c04\uff0c\u4ece\u4ee5\u4e0b\u7a0b\u5e8f\u8f93\u51fa\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u5230collect\u4e4b\u524d\u7684\u4e24\u4e2amap\u7b97\u5b50\u90fd\u662f\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u53ea\u4e0d\u8fc7\u662f\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u76f8\u540c\u7684\u64cd\u4f5c\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6570\u636e\u786e\u5b9e\u662f\u88ab\u5206\u6563\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\u8ba1\u7b97\u7684\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0 \u00a0val sc = new SparkContext(\"local[*]\", \"map\")\n\u00a0 \u00a0val rdd = sc.makeRDD(List(1, 2, 3, 4))\n\u00a0 \u00a0rdd.map(a =&gt; {\n\u00a0 \u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" -&gt; \" + a)\n\u00a0 \u00a0 \u00a0a * 2\n\u00a0 \u00a0}).map(a =&gt; {\n\u00a0 \u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" =&gt; \" + a)\n\u00a0 \u00a0 \u00a0a * 2\n\u00a0 \u00a0}).collect().foreach(a =&gt; {\n\u00a0 \u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n\u00a0 \u00a0})\n\u00a0 \u00a0sc.stop()\n}\n</code></pre> Text Only<pre><code>80:Executor task launch worker for task 3 -&gt; 1\n88:Executor task launch worker for task 11 -&gt; 3\n92:Executor task launch worker for task 15 -&gt; 4\n84:Executor task launch worker for task 7 -&gt; 2\n92:Executor task launch worker for task 15 =&gt; 8\n88:Executor task launch worker for task 11 =&gt; 6\n80:Executor task launch worker for task 3 =&gt; 2\n84:Executor task launch worker for task 7 =&gt; 4\n1:main &gt;&gt; 4\n1:main &gt;&gt; 8\n1:main &gt;&gt; 12\n1:main &gt;&gt; 16\n</code></pre></p> <p>\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u6570\u636e\u5206\u533a\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"map\")\n`val rdd = sc.makeRDD(List(1, 2, 3, 4), 1)`\nrdd.map(a =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" -&gt; \" + a)\n\u00a0 \u00a0a * 2\n}).map(a =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" =&gt; \" + a)\n\u00a0 \u00a0a * 2\n}).collect().foreach(a =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n})\nsc.stop()\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>`77:Executor task launch worker for task 0 -&gt; 1`\n`77:Executor task launch worker for task 0 =&gt; 2`\n77:Executor task launch worker for task 0 -&gt; 2\n77:Executor task launch worker for task 0 =&gt; 4\n77:Executor task launch worker for task 0 -&gt; 3\n77:Executor task launch worker for task 0 =&gt; 6\n77:Executor task launch worker for task 0 -&gt; 4\n77:Executor task launch worker for task 0 =&gt; 8\n`1:main &gt;&gt; 4`\n1:main &gt;&gt; 8\n1:main &gt;&gt; 12\n1:main &gt;&gt; 16\n</code></pre> \u4ece\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u6240\u6709\u6570\u636e\u7684\u8ba1\u7b97\u5c06\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u5e76\u4e14\u6570\u636e\u662f\u4e00\u4e2a\u63a5\u7740\u4e00\u4e2a\u8fdb\u884c\u8ba1\u7b97\uff0c\u53ea\u6709\u7b49\u4e0a\u4e00\u4e2a\u6570\u636e\u5904\u7406\u5b8c\u624d\u4f1a\u5904\u7406\u4e0b\u4e00\u6761\u6570\u636e\uff0c\u603b\u4e4b\u5c31\u662f\u5206\u533a\u5185\u6570\u636e\u7684\u5904\u7406\u662f\u6709\u5e8f\u7684\u3002</p> <p>2.mapPartitions map\u662f\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u4e00\u6761\u4e00\u6761\u7684\u505a\u6620\u5c04\u5904\u7406\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e\u662f\u5bf9\u6240\u6709\u6570\u636e\u4e00\u6761\u4e00\u6761\u7684\u505a\u6620\u5c04\u5904\u7406\uff0c\u800cmapPartitions\u662f\u5c06\u540c\u4e00\u4e2a\u5206\u533a\u5185\u7684\u6240\u6709\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u96c6\u5408\u8fdb\u884c\u6620\u5c04\u5904\u7406\uff0c\u6240\u4ee5mapPartitions\u53c2\u6570\u7684\u533f\u540d\u51fd\u6570\u8f93\u5165\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u8f93\u51fa\u4e5f\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u96c6\u5408\u6620\u5c04\u5230\u53e6\u4e00\u4e2a\u96c6\u5408\u3002\u4f7f\u7528Map\u662f\u6bcf\u4e00\u4e2atask\u90fd\u662f\u6765\u4e00\u6761\u6570\u636e\u5c31\u5904\u7406\u4e00\u6761\u6570\u636e\uff0c\u5904\u7406\u5b8c\u5c31\u53ef\u4ee5\u91ca\u653e\u6389\u8fd9\u6761\u6570\u636e\u7684\u5185\u5b58\u7a7a\u95f4\u4e86\uff0c\u4f46\u662f\u5728\u4f7f\u7528mapPartitions\u65f6\uff0c\u6bcf\u4e00\u4e2atask\u90fd\u9700\u8981\u7b49\u5f85\u8be5\u5206\u533a\u5185\u6240\u6709\u6570\u636e\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e4b\u540e\u624d\u80fd\u5f00\u59cb\u8ba1\u7b97\uff0c\u5e76\u4e14\u5982\u679c\u6ca1\u6709\u5904\u7406\u5b8c\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u8fd9\u4e2a\u96c6\u5408\u6240\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u65e0\u6cd5\u88ab\u91ca\u653e\u6389\uff0c\u8fd9\u5c31\u5bf9\u5185\u5b58\u538b\u529b\u6bd4\u8f83\u5927\u4e86\uff0c\u641e\u4e0d\u597d\u5c31\u5bb9\u6613OOM\u3002 \u6848\u4f8b\uff1a\u83b7\u53d6\u6bcf\u4e2a\u6570\u636e\u5206\u533a\u7684\u6700\u5927\u503c 3\u4e2a\u5206\u533a\uff0c\u83b7\u53d6\u6bcf\u4e2a\u5206\u533a\u7684\u6700\u5927\u503c\u7136\u540e\u8f93\u51fa Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"map\")\nval rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)\nrdd.mapPartitions(iter =&gt; {\n\u00a0 \u00a0val max = iter.max\n\u00a0 \u00a0println(Thread.currentThread().getName + \" -&gt; \" + max)\n\u00a0 \u00a0List(max).iterator\n}).collect().foreach(println)\nsc.stop()\n}\n</code></pre></p> <p>3.mapPartitionsWithIndex mapPartitionsWithIndex\u548cmapPartitions\u4e00\u6837\u662f\u5c06\u540c\u4e00\u4e2a\u5206\u533a\u5185\u7684\u6240\u6709\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u96c6\u5408\u8fdb\u884c\u6620\u5c04\u5904\u7406\uff0c\u4f46\u662fmapPartitionsWithIndex\u4f1a\u7ed9\u6bcf\u4e2a\u5206\u533a\u4e00\u4e2a\u7f16\u53f7\uff0c\u8fd9\u6837\u5c31\u80fd\u5728\u6bcf\u4e2atask\u6267\u884cmapPartitionsWithIndex\u4e2d\u7684\u533f\u540d\u51fd\u6570\u65f6\u8d70\u4e0d\u540c\u7684\u5206\u652f\uff0c\u4ece\u800c\u5b9e\u73b0\u4ee5\u4e0d\u540c\u7684\u903b\u8f91\u5904\u7406\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\u3002 \u6bd4\u5982\u4e0b\u9762\u7684\u4f8b\u5b50\uff0c\u539f\u6837\u4fdd\u7559\u7b2c\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u53bb\u6389\u7b2c\u4e8c\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u5c06\u7b2c\u4e09\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u4e58\u4ee52\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"mapPartitionsWithIndex\")\nval rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)\nrdd.mapPartitionsWithIndex((index, iter) =&gt; {\n\u00a0 \u00a0println(Thread.currentThread.getName+ \"&gt;&gt;\" + index)\n\u00a0 \u00a0index match {\n\u00a0 \u00a0 \u00a0case 0 =&gt; iter\n\u00a0 \u00a0 \u00a0case 1 =&gt; Nil.iterator\n\u00a0 \u00a0 \u00a0case _ =&gt; iter.map(_ * 2)\n\u00a0 \u00a0}\n}).collect().foreach(println)\nsc.stop()\n}\n</code></pre></p> <p>4.flatMap\uff0c\u6241\u5e73\u6620\u5c04 \u5bf9\u6bcf\u4e00\u6761\u6570\u636e\u5148\u505a\u6620\u5c04\u540e\u505a\u6241\u5e73\u5316\u5904\u7406\u3002\u4ee5\u4e0b\u7528\u6a21\u5f0f\u5339\u914d\uff08\u504f\u51fd\u6570\uff09\u5b9e\u73b0\u53ef\u4ee5\u5904\u7406\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"flatMap\")\nval rdd = sc.makeRDD(List(List(1, 2, 3), 4, 5, 6, List(7, 8, 9)))\nrdd.flatMap {\n\u00a0 \u00a0case list: List[_] =&gt; list\n\u00a0 \u00a0case elem =&gt; List(elem)\n}.collect().foreach(println)\nsc.stop()\n}\n</code></pre></p> <p>5.glom \u5c06\u540c\u4e00\u4e2a\u5206\u533a\u5185\u7684\u6240\u6709\u6570\u636e\u5305\u88c5\u6210\u4e00\u4e2a\u6570\u7ec4\uff0c\u65b9\u4fbf\u4f7f\u7528\u6570\u7ec4\u7684\u65b9\u6cd5\u8fdb\u884c\u8ba1\u7b97 \u5bf9\u6240\u6709\u5206\u533a\u7684\u6700\u5927\u503c\u6c42\u548c\uff08\u5206\u533a\u5185\u53d6\u6700\u5927\u503c\uff0c\u5206\u533a\u95f4\u6700\u5927\u503c\u6c42\u548c\uff09 Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"map\")\nval rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)\n//val sum = rdd.glom().map(_.max).reduce(_ + _)\nval glomRDD: RDD[Array[Int]] = rdd.glom()\nval maxRDD: RDD[Int] = glomRDD.map(array =&gt; {\n\u00a0 \u00a0println(Thread.currentThread.getName)\n\u00a0 \u00a0array.max\n})\nval sum = maxRDD.collect.sum\nprintln(sum)\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/6-RDD%20Value%20%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%AE%97%E5%AD%90%20%E4%B9%8B%20groupBy/","title":"6-RDD Value \u7c7b\u578b\u8f6c\u6362\u7b97\u5b50 \u4e4b groupBy","text":"<p> \u7ea6 2025 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 40 \u5206\u949f</p> <p>6. groupBy\uff0c\u5206\u7ec4 groupBy\u51fd\u6570\u7684\u5904\u7406\u7ed3\u679c\u662f\u4e00\u4e2a\u4e8c\u5143\u7ec4\u7684\u5217\u8868\uff0c\u4e8c\u5143\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5206\u7ec4\u7684key\uff0c\u4e8c\u5143\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u8be5\u5206\u7ec4\u7684\u6240\u6709\u5143\u7d20\u7684\u96c6\u5408\u3002 \u4ee5\u4e0b\u6309\u5947\u5076\u6027\u5bf9\u6570\u636e\u5206\u7ec4 Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"groupBy\")\n`val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)`\n`val groupRDD: RDD[(Int, Iterable[Int])] = rdd.groupBy(a =&gt; {`\n `val currentThread = Thread.currentThread`\n `println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)`\n `a % 2`\n`})`\nval mapRDD: RDD[(Int, Iterable[Int])] = groupRDD.map(kv =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + kv)\n\u00a0 \u00a0kv\n})\nval array: Array[(Int, Iterable[Int])] = mapRDD.collect\narray.foreach(kv =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + kv)\n})\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>77:Executor task launch worker for task 0 &gt;&gt; 1\n79:Executor task launch worker for task 2 &gt;&gt; 7\n78:Executor task launch worker for task 1 &gt;&gt; 4\n77:Executor task launch worker for task 0 &gt;&gt; 2\n78:Executor task launch worker for task 1 &gt;&gt; 5\n79:Executor task launch worker for task 2 &gt;&gt; 8\n78:Executor task launch worker for task 1 &gt;&gt; 6\n79:Executor task launch worker for task 2 &gt;&gt; 9\n77:Executor task launch worker for task 0 &gt;&gt; 3\n78:Executor task launch worker for task 3 &gt;&gt; (0,CompactBuffer(2, 4, 6, 8))\n79:Executor task launch worker for task 4 &gt;&gt; (1,CompactBuffer(1, 3, 5, 7, 9))\n1:main &gt;&gt; (0,CompactBuffer(2, 4, 6, 8))\n1:main &gt;&gt; (1,CompactBuffer(1, 3, 5, 7, 9))\n</code></pre> \u4ece\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0cgroupBy\u5206\u7ec4\u540e\u7684\u540c\u4e00\u7ec4\u7684\u6570\u636e\u4f1a\u53d1\u5f80\u4e00\u4e2a\u76f8\u540c\u7684\u5206\u533a\u4e2d\uff0c\u63a5\u4e0b\u7684map\u7b97\u5b50\u4f1a\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684task\uff0c\u7136\u540e\u88abexecutor\u6267\u884c\u3002</p> <p>\u5b9e\u9a8c\u4e00\uff1a \u5982\u679c\u5c06groupBy\u5206\u7ec4\u540e\u7684\u6570\u636e\u4f7fsaveAsTextFile\u51fd\u6570\u6309\u5206\u533a\u5199\u5230\u6587\u4ef6\u4e2d\uff0c\u4f1a\u53d1\u73b0\u8fd8\u662f3\u4e2a\u5206\u533a\uff0c\u5206\u533a\u6570\u5e76\u6ca1\u6709\u53d8\uff0c\u53ea\u4e0d\u8fc7\u53ea\u6709\u524d\u4e24\u4e2a\u5206\u533a\u6709\u6570\u636e\uff0c\u800c\u6700\u540e\u4e00\u4e2a\u5206\u533a\u6ca1\u6709\u6570\u636e\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"groupBy\")\n`val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)`\nval groupRDD: RDD[(Int, Iterable[Int])] = rdd.groupBy(a =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n `a % 2`\n})\ngroupRDD.saveAsTextFile(\"output\")\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>\u6587\u4ef61\uff1a\n(0,CompactBuffer(2, 4, 6, 8))\n\u6587\u4ef62\uff1a\n(1,CompactBuffer(1, 3, 5, 7, 9))\n\u6587\u4ef63\uff1a\n</code></pre></p> <p>\u5982\u679c\u5c06\u6570\u636e\u5206\u62104\u4e2a\u7ec4\uff0c\u8fd8\u662f\u7528saveAsTextFile\u51fd\u6570\u6309\u5206\u533a\u5c06\u6570\u636e\u5199\u5230\u6587\u4ef6\u4e2d\uff0c\u4f1a\u53d1\u73b0\u8fd8\u662f3\u4e2a\u5206\u533a\uff0c\u5206\u533a\u6570\u5e76\u6ca1\u6709\u53d8\uff0c\u53ea\u4e0d\u8fc7\u4f1a\u6709\u4e24\u7ec4\u6570\u636e\u8fdb\u5165\u5230\u4e00\u4e2a\u5206\u533a\u4e4b\u4e2d\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"groupBy\")\n`val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)`\nval groupRDD: RDD[(Int, Iterable[Int])] = rdd.groupBy(a =&gt; {\n\u00a0 val currentThread = Thread.currentThread\n\u00a0 println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n `a % 4`\n})\ngroupRDD.saveAsTextFile(\"output\")\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\uff1a Text Only<pre><code>\u6587\u4ef61\uff1a\n(0,CompactBuffer(4, 8))\n(3,CompactBuffer(3, 7))\n\u6587\u4ef62\uff1a\n(1,CompactBuffer(1, 5, 9))\n\u6587\u4ef63\uff1a\n(2,CompactBuffer(2, 6))\n</code></pre></p> <p>\u5b9e\u9a8c\u4e00\u7ed3\u8bba\uff1a\u7531\u6b64\u53ef\u89c1\u5c06\u6570\u636e\u6309 groupBy\u6307\u5b9a\u7684\u89c4\u5219\u8fdb\u884c\u5206\u7ec4\uff0c\u5206\u533a\u9ed8\u8ba4\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u53ea\u662f\u6570\u636e\u4f1a\u88ab\u6253\u4e71\u5e76\u91cd\u65b0\u7ec4\u5408\u8fdb\u5230\u4e0d\u540c\u5206\u533a\u4e4b\u4e2d\uff0c\u5982\u679c\u5206\u7ec4\u6570\u5c0f\u4e8e\u5206\u533a\u6570\uff0c\u90a3\u4e48\u4f1a\u6709\u5206\u533a\u6ca1\u6709\u6570\u636e\uff0c\u800c\u5982\u679c\u5206\u7ec4\u6570\u5927\u4e8e\u5206\u533a\u6570\uff0c\u90a3\u4e48\u4e00\u4e2a\u5206\u533a\u5185\u5c06\u4f1a\u6709\u591a\u7ec4\u6570\u636e\uff0c\u6240\u4ee5\u5206\u533a\u6570\u4e0e\u5206\u7ec4\u6570\u5e76\u6ca1\u6709\u592a\u5927\u7684\u5173\u7cfb\uff0c\u53ea\u4e0d\u8fc7\u662f\u4f1a\u4f18\u5148\u5c06\u5206\u7ec4\u5747\u5206\u7ed9\u6bcf\u4e2a\u5206\u533a\u3002</p> <p>\u5b9e\u9a8c\u4e8c\uff1a \u5f53\u67094\u4e2a\u5206\u7ec43\u4e2a\u5206\u533a\u65f6\uff0c\u5982\u679c\u5c06\u6bcf\u4e2a\u5206\u7ec4\u7684\u6570\u636e\u4e58\u4ee52\uff0c\u90a3\u4f1a\u6709\u591a\u5c11\u4e2atask\u5462\uff1f \uff08\u6ce8\u610f\uff1akv._2.map(_ * 2) \u8fd9map\u64cd\u4f5c\u4e0d\u662fRDD\u7684\u7b97\u5b50\uff0c\u53ea\u662fScala\u7684\u96c6\u5408\u64cd\u4f5c\u7684\u65b9\u6cd5\uff0c\u88ab\u5305\u542b\u5728RDD\u7b97\u5b50\u4e2d\u4e86\uff09 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0val sc = new SparkContext(\"local[*]\", \"groupBy\")\n `val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)`\n\u00a0rdd.groupBy(a =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n `a % 4`\n `}).map(kv =&gt; {`\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + kv)\n\u00a0 \u00a0kv._2.map(_ * 2)\n\u00a0}).collect\n}\n</code></pre> \u4ece\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u67093\u4e2atask\u5728\u6267\u884cmap\u7b97\u5b50\uff0c\u4e5f\u5c31\u662f\u8bf4\u5904\u4e8e\u540c\u4e00\u4e2a\u5206\u533a\u7684\u591a\u4e2a\u5206\u7ec4\u53ea\u7531\u4e00\u4e2atask\u8d1f\u8d23\u8ba1\u7b97 Text Only<pre><code>78:Executor task launch worker for task 1 &gt;&gt; 4\n79:Executor task launch worker for task 2 &gt;&gt; 7\n77:Executor task launch worker for task 0 &gt;&gt; 1\n79:Executor task launch worker for task 2 &gt;&gt; 8\n78:Executor task launch worker for task 1 &gt;&gt; 5\n79:Executor task launch worker for task 2 &gt;&gt; 9\n77:Executor task launch worker for task 0 &gt;&gt; 2\n77:Executor task launch worker for task 0 &gt;&gt; 3\n78:Executor task launch worker for task 1 &gt;&gt; 6\n`79:Executor task launch worker for task 3 &gt;&gt; (0,CompactBuffer(4, 8))`\n78:Executor task launch worker for task 4 &gt;&gt; (1,CompactBuffer(1, 5, 9))\n77:Executor task launch worker for task 5 &gt;&gt; (2,CompactBuffer(2, 6))\n`79:Executor task launch worker for task 3 &gt;&gt; (3,CompactBuffer(3, 7))`\n</code></pre></p> <p>\u4e0a\u9762\u6240\u8bf4\u7684\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u6307\u53ea\u4e3agroupBy\u6307\u5b9a\u4e00\u4e2a\u53c2\u6570\u7684\u60c5\u51b5\uff0c\u5176\u5b9e\u8fd8\u53ef\u4e3agroupBy\u6307\u5b9a\u5206\u533a\u6570\uff0c\u6bd4\u5982\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\nval sc = new SparkContext(\"local[*]\", \"groupBy\")\n`val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)`\nval groupRDD: RDD[(Int, Iterable[Int])] = rdd.groupBy(a =&gt; {\n\u00a0 \u00a0val currentThread = Thread.currentThread\n\u00a0 \u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n\u00a0 \u00a0a % 4\n`}, 4)`\ngroupRDD.saveAsTextFile(\"output\")\n}\n</code></pre> \u6b64\u65f6\u8f93\u51fa\u7684\u7ed3\u679c\u5c31\u662f\uff1a Text Only<pre><code>\u6587\u4ef61\uff1a\n(0,CompactBuffer(4, 8))\n\u6587\u4ef62\uff1a\n(1,CompactBuffer(1, 5, 9))\n\u6587\u4ef63\uff1a\n(2,CompactBuffer(2, 6))\n\u6587\u4ef64\uff1a\n(3,CompactBuffer(3, 7))\n</code></pre></p> <p>\u5f53\u5206\u533a\u4ece3\u4e2a\u53d8\u4e3a4\u4e2a\uff0c\u5206\u7ec4\u4ecd\u4e3a4\u4e2a\u65f6\uff0c\u540c\u6837\u5c06\u6bcf\u4e2a\u5206\u7ec4\u7684\u6570\u636e\u4e58\u4ee52\uff0c\u90a3\u4f1a\u6709\u591a\u5c11\u4e2atask\u5462\uff1f Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"groupBy\")\n\u00a0\u00a0`val rdd = sc.makeRDD(List(1, 2, 3, 4, 5, 6, 7, 8, 9), 3)`\n\u00a0\u00a0rdd.groupBy(a =&gt; {\n\u00a0\u00a0\u00a0\u00a0val currentThread = Thread.currentThread\n\u00a0\u00a0\u00a0\u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + a)\n `a % 4`\n `}, 4)`.map(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0val currentThread = Thread.currentThread\n\u00a0\u00a0\u00a0\u00a0println(currentThread.getId + \":\" + currentThread.getName + \" &gt;&gt; \" + kv)\n\u00a0\u00a0\u00a0\u00a0kv._2.map(_ * 2)\n\u00a0\u00a0}).collect\n}\n</code></pre> \u4ece\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u6b64\u65f6\u4f1a\u67094\u4e2atask\u6267\u884cmap\u7b97\u5b50 Text Only<pre><code>78:Executor task launch worker for task 1 &gt;&gt; 4\n77:Executor task launch worker for task 0 &gt;&gt; 1\n79:Executor task launch worker for task 2 &gt;&gt; 7\n79:Executor task launch worker for task 2 &gt;&gt; 8\n77:Executor task launch worker for task 0 &gt;&gt; 2\n78:Executor task launch worker for task 1 &gt;&gt; 5\n79:Executor task launch worker for task 2 &gt;&gt; 9\n77:Executor task launch worker for task 0 &gt;&gt; 3\n78:Executor task launch worker for task 1 &gt;&gt; 6\n`83:Executor task launch worker for task 6 &gt;&gt; (3,CompactBuffer(3, 7))`\n`79:Executor task launch worker for task 3 &gt;&gt; (0,CompactBuffer(4, 8))`\n`78:Executor task launch worker for task 4 &gt;&gt; (1,CompactBuffer(1, 5, 9))`\n`77:Executor task launch worker for task 5 &gt;&gt; (2,CompactBuffer(2, 6))`\n</code></pre></p> <p>\u5b9e\u9a8c\u4e8c\u7ed3\u8bba\uff1a\u5f53\u67093\u4e2a\u5206\u533a4\u4e2a\u5206\u7ec4\u65f6\uff0c\u4f1a\u67093\u4e2a\u65b0\u7684task\u6765\u6267\u884cmap\u7b97\u5b50\uff0c\u5206\u522b\u5904\u74063\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\uff1b\u5f53\u67094\u4e2a\u5206\u533a4\u4e2a\u5206\u7ec4\u65f6\uff0c\u4f1a\u67094\u4e2a\u65b0\u7684task\uff1b\u7531\u6b64\u53ef\u77e5\u4e00\u4e2a\u5206\u533a\u5bf9\u5e94\u4e8e\u4e00\u4e2atask\u3002</p> <p>\u4ece\u8f93\u51fa\u7ed3\u679c\u8fd8\u53ef\u4ee5\u770b\u5230\uff0c\u6267\u884cgrouoBy\u7b97\u5b50\u7684\u4efb\u52a1\u662ftask0\u3001task1\u3001task2\uff0c\u6267\u884cmap\u7b97\u5b50\u7684\u4efb\u52a1\u662ftask3\u3001task4\u3001task5\u3001task6\uff0c\u4e5f\u5c31\u662f\u8bf4\u540c\u4e00\u9636\u6bb5\u7684task\u5c01\u88c5\u7684\u662f\u76f8\u540c\u7684\u7b97\u5b50\uff0c\u5904\u7406\u7684\u662f\u4e0d\u540c\u5206\u533a\u7684\u6570\u636e\uff0c\u4e0d\u540c\u9636\u6bb5\u7684task\u5c01\u88c5\u4e0d\u540c\u7684\u7b97\u5b50\uff0c\u53ea\u6709\u524d\u4e00\u4e2a\u9636\u6bb5\u7684\u4efb\u52a1\u5b8c\u6210\u4e86\u624d\u4f1a\u6267\u884c\u540e\u4e00\u4e2a\u9636\u6bb5\u7684\u4efb\u52a1\u3002</p> <p>\u603b\u7ed3\uff0c\u5206\u533a\u3001task\u3001executor\u7684\u5173\u7cfb\uff1a 1.Spark\u628a\u6570\u636e\u5212\u5206\u5728\u5206\u533a\u91cc\uff0c\u628a\u64cd\u4f5c\u5212\u5206\u5728task\u91cc\uff08\u6839\u636e\u5bbd\u4f9d\u8d56\u5212\u5206\uff09\uff0c\u6240\u4ee5\u5206\u533a\u662f\u88c5\u6570\u636e\u7684\u5730\u65b9\uff0ctask\u662f\u88c5\u64cd\u4f5c\u7684\u5730\u65b9\uff0c\u800cExecutor\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff08\u5b9e\u9645\u4e0a\u8fdb\u7a0b\u7684\u540d\u5b57\u53ebYarnCoarseGrainedExecutorBackend\uff0cExecutor\u662fSpark\u6e90\u4ee3\u7801\u91cc\u7684\u4e00\u4e2a\u7c7b\uff09\uff0c\u6570\u636e\u548c\u64cd\u4f5c\u9700\u8981\u5728\u8fdb\u7a0b\u91cc\u7ed3\u5408\u624d\u80fd\u8d77\u6765\u8fd0\u4f5c\u3002 2.\u6839\u636e\u5bbd\u4f9d\u8d56\u5212\u5206\u7684\u6bcf\u4e00\u4e2a\u9636\u6bb5\u90fd\u4f1a\u6839\u636e\u6b64\u9636\u6bb5\u7684\u5206\u533a\u6570\u542f\u52a8\u5bf9\u5e94\u6570\u76ee\u7684task\uff0c\u6bcf\u4e2atask\u8d1f\u8d23\u5904\u7406\u5bf9\u5e94\u5206\u533a\u4e2d\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4e00\u4e2a\u9636\u6bb5\u5185\u7684task\u6570\u7b49\u4e8e\u5206\u533a\u6570\u3002\uff08\u6ca1\u6709\u6570\u636e\u7684\u7a7a\u5206\u533a\u4e5f\u4f1a\u6709task\uff0c\u4e5f\u4f1a\u5360\u7528task\u7f16\u53f7\uff0c\u53ea\u4e0d\u8fc7\u662f\u6ca1\u6709\u6570\u636e\u7684\u7a7a\u5206\u533a\u7684task\u5e76\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u6253\u5370\u7ed3\u679c\u4e2d\u6ca1\u6709\uff0c\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684task\u7684\u7f16\u53f7\u4f1a\u7ee7\u7eed\u4e0a\u4e00\u4e2a\u9636\u6bb5\u7684task\u7f16\u53f7\u3002\u5927\u6570\u636e\u7684\u573a\u666f\u4e0b\u662f\u6ca1\u6709\u7a7a\u5206\u533a\u7684\uff0c\u6240\u4ee5\u4e5f\u5c31\u6ca1\u6709\u5bf9\u7a7a\u5206\u533a\u6570\u91cf\u4f18\u5316\u7684\u4ee3\u7801\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u5f53\u6570\u636e\u91cf\u5f88\u5c0f\u65f6\u53d6\u6d88\u7a7a\u5206\u533a\u7b49\u7c7b\u4f3c\u7684\u4f18\u5316\u624b\u6bb5\uff0c\u5c0f\u6570\u636e\u91cf\u53ea\u5728\u6d4b\u8bd5\u65f6\u624d\u4f1a\u51fa\u73b0\uff0c\u5e76\u4e14\u6211\u4eec\u5728\u6d4b\u8bd5\u65f6\u4e5f\u5e0c\u671b\u6a21\u62df\u7684\u662f\u5927\u6570\u636e\u7684\u573a\u666f\uff0c\u6240\u4ee5\u4e5f\u5c31\u66f4\u52a0\u6ca1\u6709\u5fc5\u8981\u52a0\u4e0a\u7a7a\u5206\u533a\u4f18\u5316\u7684\u4ee3\u7801\u4e86\u3002\uff09 3.Yarn\u96c6\u7fa4\u4e2d\u7684\u4e00\u53f0\u4e3b\u673a\u6700\u591a\u542f\u52a8\u4e00\u4e2aExecutor\uff0c\u6240\u4ee5\u5206\u533a\u6570\u53ef\u80fd\u4f1a\u5927\u4e8eExecutor\u6570\uff0c\u5f53\u5206\u533a\u6570\u5927\u4e8eExecutor\u6570\u65f6\uff0c\u6bcf\u4e2aExecutor\u5c31\u4f1a\u88ab\u5206\u914d\u5230\u4e0d\u6b62\u4e00\u4e2a\u5206\u533a\u3002\uff08\u56e0\u4e3a\u4e00\u4e2aExecutor\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u591a\u4e2a\u7ebf\u7a0b\uff0c\u6240\u4ee5\u53ef\u80fd\u5373\u4f7f\u5f53\u5206\u533a\u6570\u5c0f\u4e8eExecutor\u6570\u65f6\uff0c\u4e00\u4e2aExecutor\u4f1a\u88ab\u5206\u914d\u5230\u4e0d\u6b62\u4e00\u4e2a\u5206\u533a\u3002\uff09 4.\u56e0\u4e3a\u6bcf\u4e2aExecutor\u4f1a\u88ab\u5206\u914d\u5230\u4e0d\u6b62\u4e00\u4e2a\u5206\u533a\uff0c\u6240\u4ee5\u6bcf\u4e2aExecutor\u4e5f\u5c31\u4f1a\u6709\u4e0d\u6b62\u4e00\u4e2atask\uff0c\u8fd9\u65f6Executor\u4f1a\u4e3a\u5206\u914d\u5230\u7684\u6bcf\u4e2atask\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/7-Spark%E7%9A%84%E7%90%86%E8%A7%A3/","title":"7-Spark\u7684\u7406\u89e3","text":"<p> \u7ea6 1502 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 30 \u5206\u949f</p> <p>\u901a\u8fc7\u4ee5\u4e0b\u7a0b\u5e8f\u8bf4\u660e\uff1aRDD\u7b97\u5b50\u3001\u5206\u533a\u3001task\u3001Executor\u4e4b\u95f4\u7684\u5173\u7cfb \u4ee5\u53ca \u6574\u4e2a\u5206\u5e03\u5f0f\u8ba1\u7b97\u6d41\u7a0b \u7b80\u5355\u8bf4\u660e\u4e00\u4e0b\u7a0b\u5e8f\u7684\u5904\u7406\u6d41\u7a0b\uff1a\u6570\u636e\u9996\u5148\u4f1a\u88ab\u5206\u62103\u4e2a\u5206\u533a\uff0cmap\u7b97\u5b50\u4f1a\u5c06\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e\u52a01\uff0cgroupBy\u4f1a\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u5206\u7ec4\u5e76\u5c06\u5206\u533a\u589e\u52a0\u81f34\u4e2a\uff0c\u7136\u540eflatMap\u4f1a\u5c06\u6240\u6709\u5206\u7ec4\u7684\u6570\u636e\u5c55\u5f00\uff0c\u6700\u540ereduce\u5bf9\u6240\u6709\u6570\u636e\u6c42\u548c\u3002\u6574\u4e2a\u7a0b\u5e8f\u7684\u6548\u679c\u5c31\u662f1\u52a0\u52309\u7b49\u4e8e45\uff0c\u4e0d\u8981\u5728\u610f\u4e3a\u4ec0\u4e48\u6574\u8fd9\u4e48\u591a\u6ca1\u6709\u7528\u7684\u64cd\u4f5c\uff0c\u8fd9\u7eaf\u7cb9\u662f\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\u6574\u4e2a\u5206\u5e03\u5f0f\u8ba1\u7b97\u7684\u6d41\u7a0b\u3002 Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"test\")\n\u00a0\u00a0val rdd = sc.makeRDD(List(0, 1, 2, 3, 4, 5, 6, 7, 8), `3)`\n\u00a0\u00a0val sum: Int = rdd.map(a =&gt; {\n\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $a\")\n\u00a0\u00a0\u00a0\u00a0a + 1\n\u00a0\u00a0}).groupBy(a =&gt; {\n\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $a\")\n `a % 4`\n\u00a0\u00a0`}, 4).`flatMap(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $kv\")\n\u00a0\u00a0\u00a0\u00a0kv._2\n\u00a0\u00a0}).reduce((a, b) =&gt; {\n\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $a+$b=${a + b}\")\n\u00a0\u00a0\u00a0\u00a0a + b\n\u00a0\u00a0})\n\u00a0\u00a0println(sum)\n}\n</code></pre> \u8f93\u51fa\u7ed3\u679c\u4e2d\u9ec4\u8272\u9ad8\u4eae\u7684\u662ftask0\u7684\u8ba1\u7b97\u4efb\u52a1\uff0c\u5904\u7406\u7684\u5206\u533a\u6570\u636e\u662f\u30101, 2, 3\u3011\uff0c\u53ef\u4ee5\u770b\u5230task0\u5305\u542bmap\u7b97\u5b50\u548cgroupBy\u7b97\u5b50\u7684\u4e24\u6b65\u8ba1\u7b97\uff0c\u5e76\u4e14\u5206\u533a\u5185\u6570\u636e\u7684\u5904\u7406\u662f\u6709\u5e8f\u3002 Text Only<pre><code>77 : Executor task launch worker for `task 0 &gt;&gt; 0`\n78 : Executor task launch worker for task 1 &gt;&gt; 3\n79 : Executor task launch worker for task 2 &gt;&gt; 6\n78 : Executor task launch worker for task 1 &gt;&gt; 4\n77 : Executor task launch worker for `task 0 &gt;&gt; 1`\n79 : Executor task launch worker for task 2 &gt;&gt; 7\n79 : Executor task launch worker for task 2 &gt;&gt; 7\n78 : Executor task launch worker for task 1 &gt;&gt; 4\n78 : Executor task launch worker for task 1 &gt;&gt; 5\n77 : Executor task launch worker for `task 0 &gt;&gt; 1`\n79 : Executor task launch worker for task 2 &gt;&gt; 8\n77 : Executor task launch worker for `task 0 &gt;&gt; 2`\n78 : Executor task launch worker for task 1 &gt;&gt; 5\n78 : Executor task launch worker for task 1 &gt;&gt; 6\n79 : Executor task launch worker for task 2 &gt;&gt; 8\n77 : Executor task launch worker for `task 0 &gt;&gt; 2`\n79 : Executor task launch worker for task 2 &gt;&gt; 9\n77 : Executor task launch worker for `task 0 &gt;&gt; 3`\n79 : Executor task launch worker for task 3 &gt;&gt; (0,CompactBuffer(4, 8))\n77 : Executor task launch worker for task 4 &gt;&gt; (1,CompactBuffer(1, 5, 9))\n83 : Executor task launch worker for task 6 &gt;&gt; (3,CompactBuffer(3, 7))\n78 : Executor task launch worker for task 5 &gt;&gt; (2,CompactBuffer(2, 6))\n77 : Executor task launch worker for task 4 &gt;&gt; 1+5=6\n83 : Executor task launch worker for task 6 &gt;&gt; 3+7=10\n78 : Executor task launch worker for task 5 &gt;&gt; 2+6=8\n79 : Executor task launch worker for task 3 &gt;&gt; 4+8=12\n77 : Executor task launch worker for task 4 &gt;&gt; 6+9=15\n70 : dag-scheduler-event-loop &gt;&gt; 8+12=20\n70 : dag-scheduler-event-loop &gt;&gt; 20+15=35\n70 : dag-scheduler-event-loop &gt;&gt; 35+10=45\n45\n</code></pre> \u8fd8\u53ef\u4ee5\u770b\u51fa\uff0ctask0\u3001task1\u3001task2\u90fd\u5305\u542b\u4e86map\u7b97\u5b50\u548cgroupBy\u7b97\u5b50\uff0c\u5c5e\u4e8e\u7b2c\u4e00\u9636\u6bb5\u7684\u4efb\u52a1\uff0c\u5206\u522b\u5904\u74063\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u3002task3\u3001task4\u3001task5\u3001task6\u5305\u542b\u4e86flatMap\u7b97\u5b50\u548creduce\u7b97\u5b50\u7684\u90e8\u5206\u8ba1\u7b97\uff08\u9884\u805a\u5408\uff09\uff0c\u5c5e\u4e8e\u7b2c\u4e8c\u9636\u6bb5\u7684\u4efb\u52a1\uff0c\u5206\u522b\u5904\u74064\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u3002\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\u662freduce\u7b97\u5b50\u7684\u805a\u5408\u4efb\u52a1dag-scheduler-event-loop\u3002</p> <p>\u5728\u4e0a\u9762\u7a0b\u5e8f\u672b\u5c3e\u6dfb\u52a0\u4e00\u884cTimeUnit.DAYS.sleep(1)\uff0c\u7136\u540e\u6253\u5f00\u00a0http://localhost:4040/\u00a0\u53ef\u4ee5\u770b\u5230Job\u7684\u6267\u884c\u60c5\u51b5\uff0c\u5176\u4e2dDAG\u56fe\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230groupBy\u662f\u6709Shuffle\u64cd\u4f5c\u7684\uff0c\u6240\u4ee5groupBy\u524d\u540e\u7684\u64cd\u4f5c\u88ab\u5212\u5206\u5230\u4e86\u4e0d\u540c\u7684\u9636\u6bb5\uff0c\u56e0\u4e3areduce\u662f\u884c\u52a8\u7b97\u5b50\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u5728DAG\u56fe\u4e0a\uff0c\u4f46\u662f\u5b83\u4e5f\u662f\u5728\u8fd9\u4e24\u4e2a\u9636\u6bb5\u4e4b\u5916\u6267\u884c\u7684\uff0c\u6240\u4ee5\u54b1\u4e5f\u53ef\u4ee5\u628a\u5b83\u5355\u72ec\u770b\u4f5c\u662f\u5728\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\u4e2d\u6267\u884c\u7684\u3002  \u6240\u4ee5\u53ef\u4ee5\u770b\u5230\uff0c\u50cfmap\u3001filter\u8fd9\u79cd\u53ea\u662f\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7b97\u5b50\uff0c\u65e0\u8bba\u88ab\u8fde\u7eed\u8c03\u7528\u591a\u5c11\u6b21\uff0c\u90fd\u53ea\u4f1a\u88ab\u5c01\u88c5\u5728\u4e00\u4e2a\u9636\u6bb5\u7684task\u91cc\u9762\uff0c\u800cgroupBy\u7b97\u5b50\u4f1a\u5c06\u6570\u636e\u6253\u6563\u91cd\u65b0\u5206\u914d\u5230\u5206\u533a\uff0c\u6240\u4ee5groupBy\u7b97\u5b50\u4e4b\u540e\u7684\u7b97\u5b50\u5c31\u5fc5\u987b\u88ab\u5c01\u88c5\u5728\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684task\u4e2d\u3002reduce\u5c5e\u4e8e\u884c\u52a8\u7b97\u5b50\uff0c\u4e0d\u4f1a\u653e\u5728DAG\u56fe\u4e2d\u8fdb\u884c\u5212\u5206\uff0creduce\u7684\u6267\u884c\u8fc7\u7a0b\u662f\u5148\u505a\u5206\u533a\u5185\u7684\u805a\u5408\uff0c\u7136\u540e\u518d\u505a\u5206\u533a\u95f4\u7684\u805a\u5408\u3002</p> <p>\u5728Local\u6a21\u5f0f\u4e0b\uff0c\u53ea\u4f1a\u6709\u4e00\u4e2aExecutor\uff0c\u6240\u6709\u4efb\u52a1\u90fd\u662f\u5728\u8fd9\u4e2aExecutor\u4e0a\u6267\u884c\u7684\uff0c\u4e00\u4e2a\u9636\u6bb5\u5185\u6709\u591a\u5c11\u4e2a\u5206\u533a\u5c31\u4f1a\u6709\u591a\u5c11\u4e2atask\uff0cExecutor\u4f1a\u4e3a\u6bcf\u4e2atask\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\uff0c\u4f1a\u4e0a\u9762\u7684\u8ba1\u7b97\u8fc7\u7a0b\u7684\u56fe\u89e3\uff1a 1.\u5f53\u6267\u884c\u5230reduce\u884c\u52a8\u7b97\u5b50\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u6574\u4e2a\u8ba1\u7b97\u5f00\u59cb\u6267\u884c\u3002Driver\u4f1a\u628a\u6570\u636e\u53d1\u5f80\u6bcf\u4e2a\u5206\u533a\uff0c\u5e76\u6839\u636e\u5bbd\u4f9d\u8d56\u5f00\u59cb\u5212\u5206 stage\uff0c\u4e00\u4e2a\u9636\u6bb5\u5185\uff0c\u6709\u591a\u5c11\u4e2a\u5206\u533a\u5c31\u4f1a\u6709\u591a\u5c11\u4e2atask\uff0c\u6709\u591a\u5c11\u4e2atask\u5c31\u4f1a\u542f\u52a8\u591a\u5c11\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u4e0a\u9762\u7a0b\u5e8f\u6253\u5370\u7ed3\u679c\u7684\u7b2c\u4e00\u4e2a\u6570\u5b57\u5c31\u662f\u7ebf\u7a0bid\u3002  2.task0\u3001task1\u3001task2\u90fd\u5305\u542b\u4e86map\u7b97\u5b50\u548cgroupBy\u7b97\u5b50\uff0c\u5c5e\u4e8e\u7b2c\u4e00\u9636\u6bb5\u7684\u4efb\u52a1\uff0c\u540c\u4e00\u4e2a\u9636\u6bb5\u7684task\u6240\u505a\u7684\u64cd\u4f5c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u53ea\u4e0d\u8fc7\u662f\u5904\u7406\u7684\u6570\u636e\u4e0d\u540c\u800c\u5df2\u3002groupBy\u4f1a\u6253\u6563\u6240\u6709\u6570\u636e\uff0c\u5c06\u6570\u636e\u5206\u7ec4\u540e\u91cd\u65b0\u53d1\u5f80\u6bcf\u4e00\u4e2a\u5206\u533a\uff0c\u540c\u4e00\u7ec4\u6570\u636e\u4f1a\u8fdb\u5165\u540c\u4e00\u4e2a\u5206\u533a\uff0c\u6b64\u65f6\u521a\u597d\u67094\u4e2a\u5206\u7ec44\u4e2a\u5206\u533a\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a\u5206\u533a\u4e00\u4e2a\u5206\u7ec4\u3002\u56e0\u4e3a\u7b2c\u4e00\u4e2a\u9636\u6bb5\u6267\u884c\u7ed3\u675f\u540e\u4f1a\u67094\u4e2a\u5206\u533a\uff0c\u6240\u4ee5\u4e0b\u4e00\u4e2a\u9636\u6bb5\u5c06\u4f1a\u67094\u4e2atask\u3002 \u56fe\u4e2d\u753b\u7684\u662f\uff0ctask0\u5c062\u548c3\u53d1\u9001\u5230\u5176\u5b83\u5206\u533a\uff0c\u5176\u5b83\u5206\u533a\u628a5\u548c9\u53d1\u5f80task0\u7684\u8fc7\u7a0b\uff0c\u5c06\u6570\u636e\u91cd\u65b0\u53d1\u9001\u5230\u4e0d\u540c\u5206\u533a\u7684\u8fc7\u7a0b\u53ebShuffle\u3002  3.task3\u3001task4\u3001task5\u3001task6\u5305\u542b\u4e86flatMap\u7b97\u5b50\u548c\u9884\u805a\u5408\uff0c\u5c5e\u4e8e\u7b2c\u4e8c\u9636\u6bb5\u7684\u4efb\u52a1\uff0c\u5206\u522b\u5904\u74064\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\u3002  4.\u6700\u540e\u662freduce\u7b97\u5b50\u7684\u805a\u5408\u4efb\u52a1dag-scheduler-event-loop\uff0c\u8be5\u4efb\u52a1\u572870\u53f7\u7ebf\u7a0b\u4e0a\uff0c\u4f1a\u5c06\u5176\u5b83\u5206\u533a\u5185\u7684\u9884\u805a\u5408\u7684\u7ed3\u679c\u62c9\u53d6\u8fc7\u6765\u7136\u540e\u518d\u505a\u5206\u533a\u95f4\u7684\u805a\u5408\u3002 </p> <p>\u5728\u96c6\u7fa4\u4e0a\u8fd0\u884c\u53ef\u80fd\u662f\u8fd9\u6837\u7684\uff1a \u7b2c\u4e00\u9636\u6bb5\uff1a  \u7b2c\u4e8c\u9636\u6bb5\uff1a </p> <p>\u603b\u4e4b\u5c31\u662f\uff0c\u628a\u6570\u636e\u5206\u533a\u53d1\u9001\u5230\u6bcf\u4e2aExecutor\uff0c\u5206\u533a\u6570\u5927\u4e8eExecutor\u65f6\uff0c\u5c31\u4f1a\u6709\u4e00\u4e2aExecutor\u6709\u591a\u4e2a\u5206\u533a\u3002\u6839\u636e\u5bbd\u4f9d\u8d56\u5bf9\u8f6c\u6362\u7b97\u5b50\u5212\u5206\u9636\u6bb5\uff0c\u6bcf\u4e2a\u9636\u6bb5\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u8f6c\u6362\u7b97\u5b50\uff0c\u5728\u4e00\u4e2a\u9636\u6bb5\u5185\uff0c\u4e3a\u6bcf\u4e00\u4e2a\u5206\u533a\u5c01\u88c5\u4e00\u4e2atask\uff0ctask\u91cc\u9762\u5c31\u662f\u8fd9\u4e2a\u9636\u6bb5\u7684\u7b97\u5b50\uff0c\u7136\u540e\u628atask\u53d1\u9001\u5230Executor\uff0cExecutor\u4e3a\u6bcf\u4e00\u4e2atask\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/8-%E5%90%91Yarn%E9%9B%86%E7%BE%A4%E6%8F%90%E4%BA%A4Spark%E5%BA%94%E7%94%A8/","title":"8-\u5411Yarn\u96c6\u7fa4\u63d0\u4ea4Spark\u5e94\u7528","text":"<p> \u7ea6 720 \u4e2a\u5b57  15 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>1.\u521b\u5efaMaven\u5de5\u7a0b\uff0c\u9009\u62e9Scala-tools\u7684\u9aa8\u67b6  2.\u4fee\u6539pom\u6587\u4ef6\u4e2d\u7684scala.version  3.\u6dfb\u52a0\u4f9d\u8d56 Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0&lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n\u00a0\u00a0&lt;artifactId&gt;spark-core_2.12&lt;/artifactId&gt;\n\u00a0\u00a0&lt;version&gt;3.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> 4.\u7ed9\u4e24\u4e2amaven\u63d2\u4ef6\u6dfb\u52a0\u7248\u672c\u4fe1\u606f\uff0c\u4e0d\u586b\u52a0\u7684\u8bdd\uff0c\u6bcf\u6b21\u6253\u5305\u90fd\u4f1a\u62a5\u8b66\u544a\uff0c\u5e76\u4e14\u4f1a\u53bb\u8fdc\u7a0b\u4ed3\u5e93\u91cc\u9762\u68c0\u67e5\u6700\u65b0\u7248\uff0c\u5982\u679c\u672c\u5730\u4ed3\u5e93\u5df2\u7ecf\u4e0b\u8f7d\u4e86\u6700\u65b0\u7248\u5219\u4e0d\u4f1a\u91cd\u590d\u4e0b\u8f7d\uff0c\u5982\u679c\u672c\u5730\u4ed3\u5e93\u4e0d\u662f\u6700\u65b0\u5219\u4f1a\u4e0b\u8f7d\u6700\u65b0\u7248\u3002 Text Only<pre><code>&lt;groupId&gt;org.scala-tools&lt;/groupId&gt;\n&lt;artifactId&gt;maven-scala-plugin&lt;/artifactId&gt;\n&lt;version&gt;2.15.2&lt;/version&gt;\n</code></pre> Text Only<pre><code>&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n&lt;artifactId&gt;maven-eclipse-plugin&lt;/artifactId&gt;\n&lt;version&gt;2.10&lt;/version&gt;\n</code></pre> \u5e76\u4e14\u7b2c\u4e00\u4e2a\u63d2\u4ef6maven-scala-plugin\u7684args\u6539\u6210jvm-1.8  5.spark\u7a0b\u5e8f\uff0c\u6ce8\u610f\u63d0\u4ea4\u65b9\u5f0f\u4e3ayarn\uff0c\u7136\u540e\u4f7f\u7528Maven\u6253\u5305 Text Only<pre><code>object Test {\n\u00a0\u00a0def main(args: Array[String]): Unit = {\n `val sparConf = new SparkConf().setMaster(\"yarn\").setAppName(\"TestStage\")`\n\u00a0\u00a0\u00a0\u00a0val sc = new SparkContext(sparConf)\n\u00a0\u00a0\u00a0\u00a0val rdd = sc.makeRDD(List(0, 1, 2, 3, 4, 5, 6, 7, 8), 3)\n\u00a0\u00a0\u00a0\u00a0val sum: Int = rdd.map(a =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $a\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a + 1\n\u00a0\u00a0\u00a0\u00a0}).groupBy(a =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $a\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a % 4\n\u00a0\u00a0\u00a0\u00a0}, 4).flatMap(kv =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $kv\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0kv._2\n\u00a0\u00a0\u00a0\u00a0}).reduce((a, b) =&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0println(s\"${Thread.currentThread.getId} : ${Thread.currentThread.getName} &gt;&gt; $a+$b=${a + b}\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0a + b\n\u00a0\u00a0\u00a0\u00a0})\n\u00a0\u00a0\u00a0\u00a0println(sum)\n\u00a0\u00a0\u00a0\u00a0sc.stop()\n\u00a0\u00a0}\n}\n</code></pre> 5.Yarn Client\u6a21\u5f0f\u63d0\u4ea4\uff0c\u6ce8\u610f\u5148\u542f\u52a8Hadoop\u96c6\u7fa4(HDFS\u548cYarn\u90fd\u8981\u542f\u52a8) \u548c Spark\u7684\u5386\u53f2\u670d\u52a1\u5668 Text Only<pre><code>bin/spark-submit \\\n--class org.example.Test \\\n--master yarn \\\n--deploy-mode client \\\n/opt/software/Stage-1.0-SNAPSHOT.jar\n</code></pre> Driver\u7aef\u7684\u8f93\u51fa\u7ed3\u679c\u6253\u5370\u5728\u63a7\u5236\u53f0\u4e0a  Yarn\u5386\u53f2\u670d\u52a1\u670d\u52a1\u5668\u4e0a\u6ca1\u6709Driver\u7aef\u7684\u6807\u51c6\u8f93\u51fa  RDD\u7b97\u5b50\u662f\u5728task\u4e0a\u6267\u884c\u7684\uff0ctask\u88ab\u5206\u914d\u7ed9\u4e86\u4e0d\u540c\u4e3b\u673a\u4e0a\u7684Executor\uff0c\u4eceSpark\u5386\u53f2\u670d\u52a1\u5668\u4e0a\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2atask\u662f\u88ab\u54ea\u53f0\u4e3b\u673a\u6267\u884c\u7684\uff0ctask\u4f1a\u8f93\u51fa\u4e24\u79cd\u7c7b\u578b\u7684\u65e5\u5fd7\uff0cstdout\u548cstderr\uff0cstdout\u662fprintln\u6253\u5370\u7684\uff0cstderr\u662fspark\u4f7f\u7528\u7684\u65e5\u5fd7\u6846\u67b6\u6253\u5370\u7684\u3002  \u70b9\u8fdbstdout\u91cc\u9762\u5c31\u4f1a\u53d1\u73b0Executor\u4e2d\u7684println\u4f1a\u8f93\u51fa\u5230Yarn\u7684\u5386\u53f2\u670d\u52a1\u5668\u4e0a\uff1a  \u540c\u6837\u70b9\u8fdbstderr\u4f1a\u53d1\u73b0\u662fExecutor\u7684\u65e5\u5fd7\uff0c\u4e5f\u662f\u8f93\u51fa\u5230Yarn\u7684\u5386\u53f2\u670d\u52a1\u5668\u4e0a\u4e86\uff1a </p> <p>6.Yarn Cluster\u6a21\u5f0f\u63d0\u4ea4 Text Only<pre><code>bin/spark-submit \\\n--class org.example.Test \\\n--master yarn \\\n--deploy-mode cluster \\\n/opt/software/Stage-1.0-SNAPSHOT.jar\n</code></pre> Driver\u7aef\u7684\u63a7\u5236\u53f0\u4e0a\u6ca1\u6709\u8f93\u51fa\u7ed3\u679c\uff0c\u7ed3\u679c\u88ab\u8f93\u51faYarn\u7684\u5386\u53f2\u670d\u52a1\u5668\u4e0a\u4e86   RDD\u7b97\u5b50\u7684\u8f93\u51fa\u540c\u6837\u53ef\u4ee5\u901a\u8fc7Spark\u5386\u53f2\u670d\u52a1\u5668\u7684task\u627e\u5230\u3002</p> <p>\u8be5\u7a0b\u5e8f\u4f1a\u88ab\u5206\u6210\u4e24\u4e2a\u9636\u6bb5\uff0c\u56e0\u4e3agroupBy\u6709\u4e00\u6b21Shuffle\u7684\u8fc7\u7a0b\u3002\u7b2c\u4e00\u4e2a\u9636\u6bb5\u67093\u4e2a\u4efb\u52a1\uff0c\u56e0\u4e3a\u5206\u533a\u67093\u4e2a\uff0c\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u67094\u4e2a\u4efb\u52a1\uff0c\u56e0\u4e3a\u5206\u533a\u67094\u4e2a\uff0c\u89c1\u4e0b\u56fe\u3002  \u4ece\u4e8b\u4ef6\u53d1\u751f\u7684\u4e8b\u4ef6\u7ebf\u6765\u770b\uff0c\u6700\u5148\u542f\u52a8driver\uff0c\u7136\u540e\u5728\u7b2c\u4e00\u9636\u6bb5\u4efb\u52a1\u5f00\u59cb\u4e4b\u524d\u5c31\u5148\u5206\u4e24\u6b21\u542f\u52a8\u4e863\u4e2aExecutor\uff0c\u5e76\u4e14\u5728\u7b2c\u4e00\u4e2a\u9636\u6bb5\u7ed3\u675f\u540e\u5c31\u7d27\u63a5\u7740\u5f00\u59cb\u4e86\u7b2c\u4e8c\u4e2a\u9636\u6bb5\u3002  \u7b2c\u4e00\u9636\u6bb5\u548c\u7b2c\u4e8c\u9636\u6bb5\u7684\u4efb\u52a1\u88ab\u5206\u914d\u5230\u7684\u4e3b\u673a\u89c1\u4e0b\u9762\u524d\u4e24\u5f20\u56fe\uff0c\u4ee5\u53ca\u6b64\u65f6\u4e3b\u673a\u5185\u7684\u8fdb\u7a0b\u89c1\u4e0b\u9762\u6700\u540e\u4e00\u5f20\u56fe\uff0c\u53ef\u89c1\uff0c\u4e00\u4e2aExecutor\u4f1a\u6267\u884c\u540c\u4e00\u9636\u6bb5\u7684\u4e24\u4e2a\u4efb\u52a1\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2aExecutor\u4f1a\u88ab\u5206\u914d\u5230\u591a\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u4e5f\u5c31\u8bf4\u660e\u4e00\u4e2atask\u5176\u5b9e\u662f\u5bf9\u5e94\u4e8eExecutor\u91cc\u9762\u7684\u4e00\u4e2a\u7ebf\u7a0b\u3002  </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Spark/9-RDD%E7%9A%84%20%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E3%80%81Shuffle%E3%80%81%E9%98%B6%E6%AE%B5%E5%88%92%E5%88%86%E3%80%81%E4%BB%BB%E5%8A%A1%E5%88%92%E5%88%86/","title":"9-RDD\u7684 \u4f9d\u8d56\u5173\u7cfb\u3001Shuffle\u3001\u9636\u6bb5\u5212\u5206\u3001\u4efb\u52a1\u5212\u5206","text":"<p> \u7ea6 1291 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 26 \u5206\u949f</p> <p>1.\u76f8\u90bbRDD\u4e4b\u95f4\u7684\u5173\u7cfb\u79f0\u4e3a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5373\u540e\u4e00\u4e2aRDD\u4f9d\u8d56\u4e8e\u524d\u4e00\u4e2aRDD\u3002 \u4f7f\u7528dependencies\u53ef\u4ee5\u83b7\u53d6RDD\u7684\u4f9d\u8d56\u5173\u7cfb\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n\u00a0\u00a0val lines: RDD[String] = sc.makeRDD(List(\"Hello Spark\", \"Hello Scala\", \"Hello Flink\"))\n\u00a0\u00a0println(lines.dependencies)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0println(words.dependencies)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val wordAndOne: RDD[(String, Int)] = words.map((_, 1))\n\u00a0\u00a0println(wordAndOne.dependencies)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0\u00a0println(wordToCount.dependencies)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val array: Array[(String, Int)] = wordToCount.collect()\n\u00a0\u00a0array.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>List()\n***********************\nList(org.apache.spark.OneToOneDependency@7cca01a8)\n***********************\nList(org.apache.spark.OneToOneDependency@3003827c)\n***********************\nList(org.apache.spark.ShuffleDependency@51bddd98)\n***********************\n(Flink,1)\n(Hello,3)\n(Scala,1)\n(Spark,1)\n</code></pre> \u53ef\u4ee5\u770b\u5230flatMap\u548cmap\u8fd9\u79cd\u53ea\u5bf9\u5206\u533a\u5185\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u7b97\u5b50\u7684\u4f9d\u8d56\u5173\u7cfb\u90fd\u79f0\u4e3aOneToOneDependency\uff0c\u800corg.apache.spark.OneToOneDependency\u7ee7\u627f\u81ea\u62bd\u8c61\u7c7bNarrowDependency\uff0c\u6240\u4ee5\u8fd9\u79cd\u4f9d\u8d56\u5173\u7cfb\u4e5f\u79f0\u4e3a\u7a84\u4f9d\u8d56\u3002\u800c\u5bf9\u4e8ereduceByKey\u8fd9\u79cd\u4f1a\u8fdb\u884cShuffle\u64cd\u4f5c\u7684\u7b97\u5b50\u7684\u4f9d\u8d56\u5173\u7cfb\u79f0\u4e3aShuffleDependency\uff0c\u867d\u7136\u662f\u76f4\u63a5\u7ee7\u627f\u81ea\u62bd\u8c61\u7c7bDependency\uff0c\u4f46\u4e5f\u5c06\u8fd9\u79cd\u4f9d\u8d56\u79f0\u4e3a\u5bbd\u4f9d\u8d56\uff0c\u56e0\u4e3areduceByKey\u64cd\u4f5c\u4f9d\u8d56\u4e8e\u591a\u4e2a\u5206\u533a\u4e4b\u4e2d\u7684\u6570\u636e\u3002 \u6240\u4ee5\u5bbd\u4f9d\u8d56\u610f\u5473\u7740\u4f1a\u6709Shuffle\u64cd\u4f5c\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u4f1a\u5f15\u8d77\u9636\u6bb5\u5212\u5206\uff0c\u6240\u4ee5 \u9636\u6bb5\u7684\u6570\u91cf=Shuffle\u7684\u6570\u91cf + 1\uff0c\u800c\u7a84\u4f9d\u8d56\u4e0d\u4f1a\u5f15\u8d77\u9636\u6bb5\u7684\u5212\u5206\u3002</p> <p>Shuffle \u5bf9\u5206\u533a\u95f4\u6570\u636e\u8fdb\u884c\u8c03\u6574\u7684\u8fc7\u7a0b\u53ebShuffle\u3002groupBy\u4f1a\u5bf9\u5206\u533a\u6570\u636e\u8fdb\u884c\u8c03\u6574\uff0c\u6240\u4ee5\u5b83\u6709Shuffle\u7684\u64cd\u4f5c\uff0c\u53ef\u89c1\u53ea\u8981\u6709shuffle\u64cd\u4f5c\u5c31\u4f1a\u65b0\u5f00\u542f\u4e00\u4e2a\u9636\u6bb5\u3002\u56e0\u4e3a\u5982\u679c\u53ea\u662f\u5bf9\u4e00\u4e2a\u5206\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff08\u5982map\u3001filter\u7b97\u5b50\uff09\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5176\u5b83\u5206\u533a\u6765\u8bf4\u5c31\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u5bf9\u5404\u4e2a\u5206\u533a\u7684\u64cd\u4f5c\u5c31\u662f\u5b8c\u5168\u53ef\u4ee5\u5f02\u6b65\u8fdb\u884c\uff0c\u4e8e\u662f\u5b83\u4eec\u5c31\u90fd\u5c5e\u4e8e\u540c\u4e00\u4e2a\u9636\u6bb5\u7684\u4efb\u52a1\u3002\u800c\u5982\u679c\u6d89\u53ca\u5206\u533a\u95f4\u6570\u636e\u7684\u8c03\u6574\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u7b97\u5b50\u5c31\u5fc5\u987b\u7b49\u5f85\u6570\u636e\u8c03\u6574\u5b8c\u6bd5\u4e4b\u540e\u624d\u80fd\u5f00\u59cb\uff0c\u6240\u4ee5\u5e94\u8be5\u628a\u8c03\u6574\u5206\u533a\u6570\u636e\u4e4b\u540e\u7684\u7b97\u5b50\u5c01\u88c5\u5728\u65b0\u7684task\u4e2d\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684\u9636\u6bb5\uff0c\u53ea\u6709\u5f53\u524d\u4e00\u4e2a\u9636\u6bb5\u7684\u6240\u6709task\u90fd\u5b8c\u6210\u4e86\u624d\u53ef\u4ee5\u5f00\u59cb\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684task\uff0c\u9636\u6bb5\u95f4\u7684\u987a\u5e8f\u6267\u884c\u6d41\u7a0b\u53ef\u4ee5\u770b\u4f5c\u662f\u540c\u6b65\u3002\u4e8e\u662f\uff0c\u9636\u6bb5\u7684\u6570\u91cf = Shuffle\u7684\u6570\u91cf + 1\uff0c\u56e0\u4e3a\u9636\u6bb5\u5212\u5206\u662f\u9488\u5bf9\u8f6c\u6362\u7b97\u5b50\u800c\u8a00\u7684\uff0c\u6240\u4ee5\u53ea\u6709\u8f6c\u6362\u7b97\u5b50\u624d\u4f1a\u6709Shuffle\uff0c\u5bf9\u4e8ereduce\u4f1a\u805a\u5408\u6240\u6709\u5206\u533a\u6570\u636e\u7684\u64cd\u4f5c\u4e0d\u53ebShuffle\u3002 \u4eceShuffle\u7684\u8fc7\u7a0b\u53ef\u4ee5\u770b\u5230\uff0cShuffle\u540e\u7684\u4e0b\u4e00\u4e2a\u7b97\u5b50\u6240\u5904\u7406\u7684\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\u6765\u81ea\u4e8eShuffle\u7b97\u5b50\u65f6\u7684\u591a\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u8fd9\u79cd\u4f9d\u8d56\u79f0\u4e3a\u5bbd\u4f9d\u8d56\uff0c\u6ca1\u6709Shuffle\u8fc7\u7a0b\u7684\u4e24\u4e2a\u7b97\u5b50\u5904\u7406\u7684\u662f\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u8fd9\u662f\u540e\u4e00\u4e2a\u7b97\u5b50\u6240\u5904\u7406\u7684\u5206\u533a\u5fc5\u5b9a\u6765\u81ea\u524d\u4e00\u4e2a\u7b97\u5b50\u6240\u5904\u7406\u7684\u5206\u533a\u7684\u6570\u636e\uff0c\u8fd9\u79cd\u4f9d\u8d56\u79f0\u4e3a\u7a84\u4f9d\u8d56\u3002 \u56e0\u4e3aShuffle\u662f\u5bf9\u5206\u533a\u95f4\u6570\u636e\u7684\u91cd\u65b0\u8c03\u6574\uff0c\u6240\u4ee5\u7b49\u5f85\u6570\u636e\u8c03\u6574\u7684\u8fc7\u7a0b\u4e0d\u80fd\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\uff0c\u56e0\u4e3a\u6570\u636e\u91cf\u592a\u5927\u4e86\uff0c\u6240\u4ee5Shuffle\u8fc7\u7a0b\u4e00\u5b9a\u4f34\u968f\u7740\u843d\u76d8\u3002Shuffle\u64cd\u4f5c\u65e2\u7136\u90fd\u5bf9\u5206\u533a\u95f4\u6570\u636e\u8fdb\u884c\u8c03\u6574\u4e86\uff0c\u90a3\u4e48\u8fd9\u65f6\u662f\u987a\u4fbf\u8c03\u6574\u5206\u533a\u6570\u91cf\u7684\u597d\u65f6\u673a\uff0c\u6240\u4ee5\u4e00\u822c\u6709Shuffle\u7684\u7b97\u5b50\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u5206\u533a\u6570\u91cf\u3002</p> <p>2.\u5f53\u524dRDD\u9700\u8981\u8bb0\u5f55\u5b83\u53ca\u5b83\u4e4b\u524d\u6240\u6709RDD\u7684\u4fe1\u606f\uff0c\u8fd9\u4e2a\u4fe1\u606f\u5c31\u662fRDD\u7684\u8840\u7f18\u5173\u7cfb\u3002 \u6bcf\u4e2aRDD\u90fd\u9700\u8981\u8bb0\u5f55\u8840\u7f18\u5173\u7cfb\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u63d0\u9ad8\u5bb9\u9519\u6027\uff0c\u56e0\u4e3aRDD\u4e0d\u4fdd\u5b58\u6570\u636e\uff0cRDD\u53ea\u662f\u5bf9\u6570\u636e\u7684\u8fdb\u884c\u64cd\u4f5c\u7684\u7b97\u5b50\uff0c\u6240\u4ee5\u4e00\u65e6\u5f53\u524dRDD\u64cd\u4f5c\u5931\u8d25\u5c31\u9700\u8981\u4ece\u5934\u5f00\u59cb\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u4ece\u8bfb\u53d6\u6570\u636e\u7684RDD\u64cd\u4f5c\u5f00\u59cb\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u4eceRDD\u8bb0\u5f55\u7684\u8840\u7f18\u5173\u7cfb\u4e2d\u6062\u590d\u4e4b\u524d\u7684\u64cd\u4f5c\u3002 \u4f7f\u7528toDebugString\u53ef\u4ee5\u83b7\u53d6RDD\u7684\u8840\u7f18\u5173\u7cfb\uff1a Text Only<pre><code>def main(args: Array[String]): Unit = {\n\u00a0\u00a0val sc = new SparkContext(\"local[*]\", \"WordCount\")\n\u00a0\u00a0val lines: RDD[String] = sc.makeRDD(List(\"Hello Spark\", \"Hello Scala\", \"Hello Flink\"))\n\u00a0\u00a0println(lines.toDebugString)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val words: RDD[String] = lines.flatMap(_.split(\" \"))\n\u00a0\u00a0println(words.toDebugString)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val wordAndOne: RDD[(String, Int)] = words.map((_, 1))\n\u00a0\u00a0println(wordAndOne.toDebugString)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val wordToCount: RDD[(String, Int)] = wordAndOne.reduceByKey(_ + _)\n\u00a0\u00a0println(wordToCount.toDebugString)\n\u00a0\u00a0println(\"***********************\")\n\u00a0\u00a0val array: Array[(String, Int)] = wordToCount.collect()\n\u00a0\u00a0array.foreach(println)\n\u00a0\u00a0sc.stop()\n}\n</code></pre> \u8f93\u51fa\uff1a Text Only<pre><code>(16) ParallelCollectionRDD[0] at makeRDD at WordCount.scala:9 []\n***********************\n(16) MapPartitionsRDD[1] at flatMap at WordCount.scala:12 []\n|\u00a0\u00a0\u00a0ParallelCollectionRDD[0] at makeRDD at WordCount.scala:9 []\n***********************\n(16) MapPartitionsRDD[2] at map at WordCount.scala:15 []\n|\u00a0\u00a0\u00a0MapPartitionsRDD[1] at flatMap at WordCount.scala:12 []\n|\u00a0\u00a0\u00a0ParallelCollectionRDD[0] at makeRDD at WordCount.scala:9 []\n***********************\n(16) ShuffledRDD[3] at reduceByKey at WordCount.scala:18 []\n+-(16) MapPartitionsRDD[2] at map at WordCount.scala:15 []\n\u00a0\u00a0\u00a0\u00a0|\u00a0\u00a0\u00a0MapPartitionsRDD[1] at flatMap at WordCount.scala:12 []\n\u00a0\u00a0\u00a0\u00a0|\u00a0\u00a0\u00a0ParallelCollectionRDD[0] at makeRDD at WordCount.scala:9 []\n***********************\n(Flink,1)\n(Hello,3)\n(Scala,1)\n(Spark,1)\n</code></pre></p> <p>\u4efb\u52a1\u5212\u5206</p> <ul> <li>RDD \u4efb\u52a1\u5207\u5206\u4e2d\u95f4\u5206\u4e3a\uff1a Application\u3001 Job\u3001 Stage \u548c Task</li> <li>Application\uff1a\u521d\u59cb\u5316\u4e00\u4e2a SparkContext \u5373\u751f\u6210\u4e00\u4e2a Application</li> <li>Job\uff1a\u4e00\u4e2a Action \u7b97\u5b50\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a Job</li> <li>Stage\uff1a Stage \u7b49\u4e8e\u5bbd\u4f9d\u8d56(ShuffleDependency)\u7684\u4e2a\u6570\u52a0 1</li> <li>Task\uff1a\u4e00\u4e2a Stage \u9636\u6bb5\u4e2d\uff0c\u5206\u533a\u4e2a\u6570\u5c31\u662f Task \u7684\u4e2a\u6570\uff08\u4e0d\u53ef\u80fd\u4f1a\u6709\u5728\u4e00\u4e2aStage\u5185\u7684\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u5904\u7406\u5206\u533a\u6570\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u5982\u679c\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u5904\u7406\u7684\u5206\u533a\u6570\u4e0d\u540c\u7684\u8bdd\uff0c\u4e2d\u95f4\u4e00\u5b9a\u4f1a\u53d1\u751fshuffle\uff0c\u4e8e\u662f\u8fd9\u4e24\u4e2a\u7b97\u5b50\u4e5f\u5c31\u4f1a\u88ab\u5212\u5206\u5230\u4e0d\u540c\u7684 Stage\u4e2d\u3002\uff09</li> </ul> <p>\u6ce8\u610f\uff1a Application-&gt;Job-&gt;Stage-&gt;Task \u6bcf\u4e00\u5c42\u90fd\u662f 1 \u5bf9 n \u7684\u5173\u7cfb\uff0c\u5373\u4e00\u4e2aApplication\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2aJob\uff0c\u4e00\u4e2aJob\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2aStage\uff0c\u4e00\u4e2aStage\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2aTask\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/ZooKeeper/1-Zookeeper%20%E7%9A%84%E7%90%86%E8%A7%A3/","title":"1-Zookeeper \u7684\u7406\u89e3","text":"<p> \u7ea6 2428 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 49 \u5206\u949f</p> <p>zookeeper\u662f\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0cZooKeeper\u5c31\u5e72\u4e24\u4ef6\u4e8b\uff1a1.\u63d0\u4f9b\u5206\u5e03\u5f0f\u5b58\u53d6\u6570\u636e\u7684\u670d\u52a1 2.\u901a\u77e5\u6b63\u5728\u76d1\u542c\u7684\u5ba2\u6237\u7aef</p> <p>1.\u63d0\u4f9b\u5206\u5e03\u5f0f\u5b58\u53d6\u6570\u636e\u7684\u670d\u52a1 ZooKeeper\u662f\u4e2a\u5b58\u6570\u636e\u7684\u5730\u65b9\uff0c\u672c\u8d28\u662f\u4e0a\u548cMySQL\u3001Redis\u4e00\u6837\uff1a ZooKeeper\u7528\u6811\u5f62\u7ed3\u6784\u6765\u7ba1\u7406\u6570\u636e\uff0c\u6811\u7684\u8282\u70b9\u53ef\u4ee5\u6709\u4e00\u4e2a\u540d\u5b57\uff0c\u8282\u70b9\u91cc\u9762\u8fd8\u53ef\u4ee5\u5b58\u50a8\u6570\u636e\uff0c\u4e0d\u8fc7\u6570\u636e\u91cf\u4e0d\u80fd\u8d85\u8fc71M\u3002\u8fd9\u5f88\u6709\u610f\u601d\uff0c\u4e00\u662f\u8282\u70b9\u7684\u5b8c\u6574\u8def\u5f84\u53ef\u4ee5\u770b\u4f5c\u662fkey\uff0c\u8282\u70b9\u91cc\u9762\u5b58\u7684\u6570\u636e\u53ef\u4ee5\u770b\u4f5c\u662fvalue\uff0c\u8fd9\u5c31\u5f88\u50cfredis\u4e86\uff0credis\u4e5f\u662fkey-value\uff0c\u4e0d\u8fc7redis\u7684key\u4e0d\u662f\u6811\u5f62\u7ed3\u6784\uff0c\u6ca1\u529e\u6cd5\u50cfzookeeper\u8fd9\u6837\u53ef\u4ee5\u83b7\u53d6\u67d0\u4e00\u4e2a\u8282\u70b9\u4e0b\u9762\u7684\u6240\u6709\u5b50\u8282\u70b9\uff0c\u4f46\u662f\u6211\u4eec\u5728\u4f7f\u7528redis\u65f6\u603b\u662f\u559c\u6b22\u7528\u6811\u5f62\u7ed3\u6784\u6765\u7ec4\u7ec7key\uff08\u6bd4\u5982a::b\uff0ca::c\uff0ca::d\uff09\u3002\u4e8c\u662f\u56e0\u4e3a\u53ef\u4ee5\u83b7\u53d6\u67d0\u4e00\u4e2a\u8282\u70b9\u4e0b\u9762\u7684\u6240\u6709\u5b50\u8282\u70b9\uff0c\u6240\u4ee5\u5728\u67d0\u4e9b\u5e94\u7528\u573a\u666f\u4e0b\uff0c\u8282\u70b9\u540d\u5b57\u53ef\u4ee5\u770b\u4f5c\u662fkey\uff0c\u5b83\u7684\u6240\u6709\u5b50\u8282\u70b9\u540d\u5b57\u53ef\u4ee5\u770b\u4f5c\u662fvalue\uff0c\u6b64\u65f6\u7684value\u5c31\u662f\u4e00\u4e2a\u96c6\u5408\uff08\u7528\u8282\u70b9\u7684\u540d\u5b57\u6765\u5b58\u6570\u636e\u8fd9\u79cd\u64cd\u4f5c\u5728\u5e73\u65f6\u4f7f\u7528windows\u6587\u4ef6\u4e5f\u633a\u5e38\u7528\u7684\uff0c\u6bd4\u5982\u7528txt\u6587\u4ef6\u7684\u540d\u5b57\u5b58\u63d0\u793a\u4fe1\u606f\uff09\u3002\u603b\u4e4b\u4e00\u53e5\u8bdd\uff0czookeeper\u63d0\u4f9b\u4e86\u4e00\u79cd\u8fd9\u6837\u7684\u6570\u636e\u5b58\u53d6\u7ed3\u6784\u4ee5\u53ca\u5f88\u65b9\u4fbf\u7684\u5b58\u53d6\u64cd\u4f5c\uff0c\u4f46\u5177\u4f53\u5982\u4f55\u4f7f\u7528\u5b83\u5c31\u770b\u4f60\u4e2a\u4eba\u4e86\u3002\uff08\u6709\u4eba\u628azookeeper\u7684\u8fd9\u79cd\u7ba1\u7406\u6570\u636e\u7684\u65b9\u5f0f\u79f0\u4e3a\u6587\u4ef6\u7cfb\u7edf\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97\u8fd9\u6837\u8bf4\u975e\u5e38\u5177\u6709\u8bef\u5bfc\u6027\uff0c\u867d\u7136\u7ec4\u7ec7\u65b9\u5f0f\u548c\u6587\u4ef6\u7cfb\u7edf\u4e00\u6837\uff0c\u90fd\u662f\u6811\u7ed3\u6784\u6784\uff0c\u5e76\u4e14\u9762\u5411\u7684\u95ee\u9898\u7684\u672c\u8d28\u4e5f\u4e00\u6837\u5373\u6570\u636e\u7684\u5b58\u53d6\uff0c\u4f46\u662f\uff0c\u4f46\u662f\uff0czookeeper\u7684\u6811\u91cc\u76f4\u63a5\u5b58\u7684\u5c31\u662f\u6570\u636e\uff0c\u5c31\u50cf\u6211\u4eec\u76f4\u63a5\u5728\u4ee3\u7801\u91cc\u5199\u7684\u6811\u4e00\u6837\uff0c\u800c\u6587\u4ef6\u7cfb\u7edf\u91cc\u7684\u6811\u5b58\u7684\u662f\u6587\u4ef6\u7684inode\uff0cinode\u6307\u5411\u6587\u4ef6\uff0c\u6240\u4ee5zookeeper\u7684\u6811\u548c\u6587\u4ef6\u7cfb\u7edf\u7684\u6811\u662f\u975e\u5e38\u4e0d\u540c\u7684\uff09\u3002\u867d\u7136zookeeper\u548credis\u5728k-v\u8fd9\u70b9\u4e0a\u5f88\u50cf\uff0c\u4f46\u662f\u5b83\u4fe9\u5728\u529f\u80fd\u548c\u7279\u6027\u4e0a\u8fd8\u662f\u5f88\u4e0d\u4e00\u6837\uff0c\u8fd9\u4e5f\u5bfc\u81f4\u5b83\u4eec\u6240\u89e3\u51b3\u7684\u95ee\u9898\u4e5f\u5f88\u4e0d\u4e00\u6837\u3002</p> <p>zookeeper\u662f\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\u7684\uff1a zookeeper\u7684\u5b58\u50a8\u7ba1\u7406\u6570\u636e\u8fd8\u6709\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u529f\u80fd\uff0c\u90a3\u5c31\u662f\u5b83\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u5e76\u4e14\u63d0\u4f9b\u6570\u636e\u4e00\u81f4\u6027\u7684\u652f\u6301\u3002\u56e0\u4e3azookeeper\u96c6\u7fa4\u7684\u6bcf\u4e2a\u4e3b\u673a\u90fd\u5b8c\u6574\u7684\u4fdd\u5b58\u7740\u6240\u6709\u6570\u636e\uff08\u5373\u6574\u68f5\u6811\uff09\uff0c\u6240\u4ee5\u6240\u6709\u4e3b\u673a\u4e0a\u7684\u6570\u636e\u7684\u4e00\u81f4\u6027\u5c31\u5c24\u4e3a\u91cd\u8981\u4e86\uff0c\u5ba2\u6237\u7aef\u5728\u67d0\u4e00\u4e2a\u4e3b\u673a\u4e0a\u7684\u589e\u5220\u6539\u64cd\u4f5c\u9700\u8981\u7acb\u5373\u540c\u6b65\u5230\u6574\u4e2a\u96c6\u7fa4\u4e0a\u3002\u8fd9\u70b9\u4e0eredis\u96c6\u7fa4\u7684\u5b58\u50a8\u5f88\u4e0d\u4e00\u6837\uff0credis\u96c6\u7fa4\u662f\u5c06\u6570\u636e\u5747\u5300\u7684\u6563\u5217\u5230\u6bcf\u4e00\u4e2aredis\u4e3b\u673a\u4e0a\uff0c\u6bcf\u4e2aredis\u4e3b\u673a\u5e76\u4e0d\u4fdd\u5b58\u6240\u6709\u7684\u6570\u636e\uff0c\u53ea\u662f\u4fdd\u5b58\u6570\u636e\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5redis\u6240\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\u6570\u636e\u6563\u5217\u5206\u533a\u5747\u5300\u6027\u7684\u95ee\u9898\uff0c\u800c\u4e0d\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\u526f\u672c\u7684\u4e00\u81f4\u6027\u95ee\u9898\uff08\u5f53\u7136redis\u7684\u4e3b\u4ece\u590d\u5236\u9700\u8981\u8003\u8651\u4e00\u81f4\u6027\u95ee\u9898\uff09\u3002Zookeeper\u7684\u8fd9\u79cd\u6bcf\u53f0\u4e3b\u673a\u5747\u4fdd\u6301\u5b8c\u6574\u6570\u636e\u7684\u526f\u672c\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u7b56\u7565\u7684\u53ef\u7528\u6027\u6bd4Redis\u66f4\u9ad8\u70b9\uff0c\u4e0d\u8fc7\u5728Redis\u96c6\u7fa4\u4e2d\u5f15\u5165\u4e3b\u4ece\u590d\u5236\u4e4b\u540e\uff0c\u4e24\u79cd\u5206\u5e03\u5f0f\u5b58\u50a8\u7b56\u7565\u7684\u53ef\u7528\u6027\u4e5f\u5dee\u4e0d\u591a\u3002 \u800c\u5bf9\u4e8eHDFS\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u800c\u8a00\uff0c\u5e76\u4e0d\u9700\u8981\u8003\u8651\u6570\u636e\u7684\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u56e0\u4e3a\u5b83\u5e76\u4e0d\u652f\u6301\u6587\u4ef6\u968f\u673a\u4fee\u6539\uff0c\u5e76\u4e14\u6240\u6709\u5bf9\u6587\u4ef6\u5143\u6570\u636e\u7684\u589e\u5220\u90fd\u53ea\u5728namenode\u4e0a\u8fdb\u884c\uff0c\u800c\u4e14\u8fd8\u6709\u6700\u91cd\u8981\u7684\u4e00\u70b9\u662f\uff0czookeeper\u7684\u8bfb\u53d6\u662f\u53ef\u4ee5\u5728\u96c6\u7fa4\u5185\u4efb\u610f\u4e00\u4e2a\u4e3b\u673a\u4e0a\u8fdb\u884c\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u4e3b\u673a\u90fd\u4fdd\u5b58\u7740\u5b8c\u6574\u7684\u526f\u672c\uff0c\u4f46\u4eceHDFS\u4e2d\u8bfb\u53d6\u6587\u4ef6\u9700\u8981\u7ecf\u8fc7namenode\u3002\u6240\u4ee5\u603b\u7ed3\u4e00\u70b9\u5c31\u662f\uff0c\u56e0\u4e3azookeeper\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5b8c\u6574\u5730\u4fdd\u5b58\u7740\u6570\u636e\u7684\u526f\u672c\uff0c\u5e76\u4e14\u8bfb\u53d6\u64cd\u4f5c\u53ef\u4ee5\u5728\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u4e0a\u8fdb\u884c\uff0c\u6240\u4ee5\u9700\u8981\u4fdd\u8bc1\u5199\u6570\u636e\u7684\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\uff0c\u8fd9\u91cc\u6570\u636e\u7684\u4e00\u81f4\u6027\u4e0e\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u8fd8\u6709\u70b9\u533a\u522b\uff0c\u8fd9\u91cc\u8bf4\u7684\u6570\u636e\u7684\u4e00\u81f4\u6027\u6307\u7684\u662f\u526f\u672c\u7684\u6570\u636e\u76f8\u540c\uff0c\u800c\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u6307\u7684\u662f\u6570\u636e\u5728\u4e8b\u52a1\u6267\u884c\u524d\u540e\u5728\u903b\u8f91\u4e0a\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u7efc\u4e0a\uff0czookeeper\u5b58\u50a8\u7ba1\u7406\u6570\u636e\u6709\u4e24\u4e2a\u7279\u70b9\uff0c\u4e00\u662f\u80fd\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\u7684\u4e2d\u95f4\u4ef6\uff0c\u4e8c\u662f\u53ef\u4ee5\u5206\u5e03\u5f0f\u5b58\u50a8\u3002 \u7b2c\u4e00\u4e2a\u7279\u70b9\uff0c\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\u7684\u4e2d\u95f4\u4ef6\uff0czookeeper\u6ca1\u6709\u50cfredis\u90a3\u6837\u5f3a\u608d\u7684\u529f\u80fd\uff0c\u4e0d\u80fd\u7528\u6765\u5b58\u50a8\u5927\u89c4\u6a21\u6570\u636e\uff0czookeeper\u7684\u6bcf\u4e2a\u8282\u70b9Znode\u53ea\u80fd\u7528\u6765\u5b58\u50a8\u5c11\u91cf\u7684\u72b6\u6001\u548c\u914d\u7f6e\u4fe1\u606f\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u6570\u636e\u6700\u5927\u4e0d\u80fd\u8d85\u8fc71MB\uff0c\u6240\u4ee5zookeeper\u4e0eredis\u89e3\u51b3\u7684\u95ee\u9898\u4e0d\u540c\uff0czookeeper\u53ea\u80fd\u63d0\u4f9b\u4e00\u4e9b\u7b80\u5355\u6570\u636e\u5b58\u53d6\u670d\u52a1\uff0c\u6bd4\u5982\uff1a\u914d\u7f6e\u4e2d\u5fc3\uff0c\u6ce8\u518c\u4e2d\u5fc3\u3002\u4f46\u8bf4\u7684\u662f\u4e2d\u5fc3\uff0c\u5176\u5b9e\u5e76\u4e0d\u662f\u771f\u7684\u50cfnacos\u90a3\u6837\u662f\u771f\u7684\u4e2d\u5fc3\uff0czookeeper\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u6709\u7740\u66f4\u9ad8\u7684\u53ef\u7528\u6027\uff08\u8fd9\u91cc\u8981\u91cd\u70b9\u533a\u5206\u4e00\u4e0b\u53ef\u9760\u6027\u548c\u53ef\u7528\u6027\uff0c\u53ef\u9760\u6027\u4e00\u822c\u662f\u6307\u6570\u636e\u5b58\u50a8\u7684\u53ef\u9760\u6027\uff0c\u6bd4\u5982\u5c06\u6570\u636e\u5b58\u5728\u78c1\u76d8\u4e0a\u5c31\u6bd4\u5b58\u5728\u5185\u5b58\u4e0a\u53ef\u9760\uff0c\u5206\u5e03\u7684\u5b58\u5728\u591a\u53f0\u673a\u5668\u4e0a\u5c31\u6bd4\u5b58\u5728\u5355\u53f0\u673a\u5668\u4e0a\u53ef\u9760\uff1b\u800c\u53ef\u7528\u6027\u5219\u6307\u7684\u662f\u7cfb\u7edf\u6216\u8005\u8bf4\u670d\u52a1\u7684\u53ef\u7528\u6027\uff0c\u542f\u7528\u591a\u53f0\u4e3b\u673a\u63d0\u4f9b\u670d\u52a1\u5c31\u6bd4\u5355\u53f0\u5177\u6709\u66f4\u9ad8\u7684\u53ef\u7528\u6027\uff09\u3002\u8fd8\u6709\u5c31\u662f\u7edf\u4e00\u547d\u540d\u670d\u52a1\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u628a\u4e00\u4e9b\u9700\u8981\u6620\u5c04\u7684\u4e1c\u897f\u5b58\u5728zookeeper\u4e2d\uff0c\u6bd4\u5982\u670d\u52a1\u540d\u4e0eip\u5730\u5740\u7684\u6620\u5c04\uff08\u8fd9\u597d\u50cf\u53c8\u56de\u5230\u4e86\u6ce8\u518c\u4e2d\u5fc3\uff09\u3002 \u7b2c\u4e8c\u4e2a\u7279\u70b9\uff0c\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u8fd9\u4e00\u70b9\u63d0\u4f9b\u7684\u5c31\u662f\u66f4\u9ad8\u7684\u53ef\u9760\u6027\u548c\u53ef\u7528\u6027\u3002</p> <p>\uff08\u9898\u5916\u8bdd\uff0cRPC\u4e3a\u4ec0\u4e48\u9700\u8981\u6ce8\u518c\u4e2d\u5fc3\uff0c\u6ca1\u6709\u6ce8\u518c\u4e2d\u5fc3\u5c31\u4e0d\u80fdRPC\u4e86\u5417\uff1f\u5f53\u7136\u4e0d\u662f\uff0c\u6ca1\u6709\u6ce8\u518c\u4e2d\u5fc3\u4e00\u6837\u53ef\u4ee5RPC\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6837RPC\u7684\u8c03\u7528\u5c31\u5199\u6b7b\u4e86\uff0c\u4e0d\u8fc7\u7075\u6d3b\uff0c\u52a0\u4e00\u5c42\u6ce8\u518c\u4e2d\u5fc3\u5c31\u53ef\u4ee5\u7cfb\u7edf\u89e3\u8026\u4e86\uff0c\u56e0\u4e3a\u8fd9\u6837\u670d\u52a1\u53ef\u4ee5\u7531\u591a\u53f0\u4e0d\u540c\u7684\u4e3b\u673a\u63d0\u4f9b\uff0c\u4ece\u800c\u53ef\u4ee5\u52a8\u6001\u7684\u4e0a\u4e0b\u7ebf\u4e3b\u673a\uff09</p> <p>2.\u901a\u77e5\u6b63\u5728\u76d1\u542c\u7684\u5ba2\u6237\u7aef \u8fd9\u70b9\u548c\u6d88\u606f\u961f\u5217\u5f88\u50cf\u2014\u2014\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff0c\u4f46\u662f\u4e5f\u6709\u5dee\u522b\uff0c\u53d1\u5e03\u8ba2\u9605\u7684\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u6d88\u8d39\u8005\u662f\u4e3b\u52a8\u8f6e\u8be2\u961f\u5217\u4e2d\u6709\u6ca1\u6709\u6570\u636e\uff0c\u800czookeeper\u662f\u4e3b\u52a8\u901a\u77e5\u6b63\u5728\u76d1\u542c\u7684\u5ba2\u6237\u7aef\u3002\u5f53\u8282\u70b9\u4e0a\u6570\u636e\u53d1\u751f\u53d8\u5316\u65f6\uff0czookeeper\u4f1a\u901a\u77e5\u6b63\u5728\u76d1\u542c\u6b64\u8282\u70b9\u7684\u5ba2\u6237\u7aef\uff0czookeeper\u7684\u8bb8\u591a\u5e94\u7528\u6b63\u662f\u57fa\u4e8e\u8fd9\u4e00\u70b9\uff0c\u6bd4\u5982\u8fd8\u662f\u914d\u7f6e\u4e2d\u5fc3\uff0c\u5f53\u914d\u7f6e\u53d1\u751f\u53d8\u5316\u65f6\u53ef\u4ee5\u53ca\u65f6\u901a\u77e5\u5ba2\u6237\u7aef\uff1b\u8fd8\u53ef\u4ee5\u7edf\u4e00\u7ba1\u7406\u96c6\u7fa4\uff0c\u7ba1\u7406\u670d\u52a1\u5668\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8bf4zookeeper\u662f\u5206\u5e03\u5f0f\u534f\u8c03\u7cfb\u7edf\uff1f\u4e24\u4e2a\u95ee\u9898\uff1a\u4e00\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\u6709\u54ea\u4e9b\u95ee\u9898\u9700\u8981\u534f\u8c03\uff1f\u4e8c\u662fzookeeper\u5982\u4f55\u5728\u8fdb\u884c\u534f\u8c03\uff1f</p> <p>\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u53f0\u4e3b\u673a \u5bf9\u4e8e\u96c6\u7fa4\u6240\u5171\u4eab\uff08\u8bfb\uff09\u548c\u5171\u540c\u7ba1\u7406\uff08\u5199\uff09\u7684\u4e00\u4e9b\u5143\u6570\u636e\u4fe1\u606f \u662f\u9700\u8981\u5177\u6709\u4e00\u81f4\u6027\u7684\uff0c\u6bd4\u5982Kafka\u96c6\u7fa4\u7684topic\u4fe1\u606f\u3002\u5bf9\u6b64\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff0c\u4e00\u662f\u4f7f\u7528\u4e00\u4e2a\u5355\u70b9\u6570\u636e\u5e93\u6765\u5b58\u50a8\u6570\u636e\uff0c\u5982MySQL\u548cRedis\uff0c\u4f46\u5bf9\u4e8e\u5206\u5e03\u5f0f\u96c6\u7fa4\u6765\u8bf4\uff0c\u5176\u5b83\u7ec4\u4ef6\u90fd\u662f\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\u7684\u4e86\uff0c\u5c31\u6570\u636e\u5b58\u53d6\u670d\u52a1\u4e0d\u662f\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\uff0c\u5b58\u5728\u7740\u5355\u70b9\u6545\u969c\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u4e5f\u5c31\u4e0d\u80fd\u7b97\u662f\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\u7684\uff1b\u4e8c\u662f\u96c6\u7fa4\u81ea\u5df1\u89e3\u51b3\u6570\u636e\u5728\u6bcf\u53f0\u4e3b\u673a\u7684\u540c\u6b65\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cKafka\u96c6\u7fa4\u9700\u8981\u81ea\u5df1\u5199\u4e00\u5957\u6570\u636e\u540c\u6b65\u7684\u4ee3\u7801\uff0cHBase\u4e5f\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u4e00\u5957\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u65e0\u7591\u5c31\u662f\u5728\u91cd\u590d\u5b9e\u73b0\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u8f6e\u5b50\u3002\u4f46\u5176\u5b9e\u96c6\u7fa4\u9700\u8981\u7684\u65e0\u975e\u5c31\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\u7684\u6570\u636e\u5b58\u53d6\u670d\u52a1\uff0c\u800c\u4e14\u8fd9\u4e2a\u6570\u636e\u7684\u6570\u636e\u91cf\u4e5f\u5e76\u4e0d\u5927\uff0c\u53ea\u662f\u4e00\u4e9b\u5143\u6570\u636e\u4fe1\u606f\uff0c\u5e76\u4e0d\u9700\u8981MySQL\u548cRedis\u63d0\u4f9b\u7684\u5927\u91cf\u6570\u636e\u7684\u5feb\u901f\u5b58\u53d6\u670d\u52a1\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u9700\u6c42\uff0czookeeper\u5c31\u8bde\u751f\u4e86\uff0czookeeper\u662f\u5206\u5e03\u5f0f\u9ad8\u53ef\u7528\u7684\uff0c\u5e76\u4e14\u6570\u636e\u5728zookeeper\u96c6\u7fa4\u4e2d\u80fd\u505a\u5230\u4e00\u81f4\u6027\uff0c\u6240\u4ee5zookeeper\u89e3\u51b3\u4e86\u5206\u5e03\u5f0f\u96c6\u7fa4\u7684\u6570\u636e\u534f\u8c03\u95ee\u9898\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u96c6\u7fa4\u6765\u8bf4\uff0c\u6709\u4e9b\u4e8b\u60c5\u662f\u53ea\u9700\u8981\u4e5f\u53ea\u80fd\u7531\u4e00\u4e2a\u4e3b\u673a\u6765\u5b8c\u6210\u7684\uff0c\u6bd4\u5982\u5c06\u4efb\u52a1\u5206\u914d\u7ed9\u96c6\u7fa4\u4e2d\u7684\u4e3b\u673a\uff08\u5982\u4e3aKafka\u9009\u4e3econtroller\uff0c\u4e3aHBase\u7684HMaster\u96c6\u7fa4\u9009\u4e3e\u4e3bHMaster\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e3a\u96c6\u7fa4\u9009\u51fa\u4e00\u4e2aLeader\uff0c\u8fd9\u5c31\u53ef\u4ee5\u7528\u5230zookeeper\u7684\u8282\u70b9\u521b\u5efa\u6765\u5b8c\u6210\uff0c\u56e0\u4e3a\u8282\u70b9\u53ea\u80fd\u88ab\u521b\u5efa\u4e00\u6b21\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u8282\u70b9\u521b\u5efa\u6210\u529f\u7684\u4e3b\u673a\u4f5c\u4e3aLeader\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u96c6\u7fa4\u6765\u8bf4\uff0c\u4e3b\u673a\u7684\u52a8\u6001\u4e0a\u7ebf\u9700\u8981\u901a\u77e5\u7ed9\u96c6\u7fa4\u4e2d\u7684\u5176\u5b83\u4e3b\u673a\uff0c\u8fd9\u6837\u96c6\u7fa4\u5c31\u80fd\u52a8\u6001\u7684\u8c03\u6574\u4efb\u52a1\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u5229\u7528zookeeper\u63d0\u4f9b\u7684\u901a\u77e5\u76d1\u542c\u670d\u52a1\u6765\u5b8c\u6210\uff0c\u6bcf\u4e00\u4e2a\u4e0a\u7ebf\u4e3b\u673a\u5728zookeeper\u4e2d\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u8282\u70b9\uff0c\u5176\u5b83\u4e3b\u673a\u90fd\u8d1f\u8d23\u76d1\u542c\uff0c\u5f53\u6709\u4e3b\u673a\u4e0b\u7ebf\u65f6\uff0c\u5176\u5b83\u4e3b\u673a\u5c31\u4f1a\u6536\u5230zookeeper\u7684\u901a\u77e5\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a\u4e00\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\u6709\u54ea\u4e9b\u95ee\u9898\u9700\u8981\u534f\u8c03\uff1f\u4e8c\u662fzookeeper\u5982\u4f55\u5728\u8fdb\u884c\u534f\u8c03\uff1f \u5206\u5e03\u5f0f\u96c6\u7fa4\u4e2d\u7684\u6570\u636e\u548c\u4e3b\u673a\u4e0a\u4e0b\u7ebf\u9700\u8981\u534f\u8c03\uff0c\u901a\u8fc7zookeeper\u7684\u5206\u5e03\u5f0f\u5b58\u53d6\u6570\u636e\u548c\u901a\u77e5\u76d1\u542c\u673a\u5236\u5c31\u80fd\u5b8c\u6210\u534f\u8c03\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/ZooKeeper/2-zookeeper%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE/","title":"2-zookeeper\u7684\u5b89\u88c5\u53ca\u914d\u7f6e","text":"<p> \u7ea6 644 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 13 \u5206\u949f</p> <p>\u4e0b\u8f7d\u5730\u5740\uff1a https://zookeeper.apache.org/</p> <p>\u672c\u5730\u6a21\u5f0f\u5b89\u88c5 1.\u5b89\u88c5 JDK 2.\u62f7\u8d1d apache-zookeeper-3.5.7-bin.tar.gz \u5b89\u88c5\u5305\u5230 Linux \u7cfb\u7edf\u4e0b 3.\u89e3\u538b \u00a0\u00a0 \u00a0tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/ 4.\u4fee\u6539\u76ee\u5f55\u7684\u540d\u5b57 \u00a0\u00a0 \u00a0mv apache-zookeeper-3.5.7-bin zookeeper-3.5.7 5. \u5c06/opt/module/zookeeper-3.5.7/conf \u8fd9\u4e2a\u8def\u5f84\u4e0b\u7684 zoo_sample.cfg \u4fee\u6539\u4e3a zoo.cfg \u00a0\u00a0 \u00a0 mv zoo_sample.cfg zoo.cfg 6.\u4fee\u6539zoo.cfg \u4e2d\u7684 dataDir=/opt/module/zookeeper-3.5.7/zkData 7.\u521b\u5efazkData\u8fd9\u4e2a\u76ee\u5f55\u00a0 mkdir zkData 8.\u542f\u52a8zookeeper \u00a0\u00a0 \u00a0 bin/zkServer.sh start 9.\u67e5\u770bzookeeper\u8fd0\u884c\u72b6\u6001 \u00a0\u00a0 \u00a0 bin/zkServer.sh status 10. \u542f\u52a8\u5ba2\u6237\u7aef \u00a0\u00a0 \u00a0 bin/zkCli.sh 11. \u9000\u51fa\u5ba2\u6237\u7aef \u00a0\u00a0 \u00a0 quit 12. \u505c\u6b62 Zookeeper \u00a0\u00a0 \u00a0 bin/zkServer.sh stop</p> <p>Zookeeper\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6zoo.cfg\u4e2d\u53c2\u6570\u542b\u4e49\u89e3\u8bfb\u5982\u4e0b\uff1a</p> <ol> <li>tickTime = 2000\uff1a\u901a\u4fe1\u5fc3\u8df3\u65f6\u95f4\uff0c Zookeeper\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u5fc3\u8df3\u65f6\u95f4\uff0c\u5355\u4f4d\u6beb\u79d2</li> <li>initLimit = 10\uff1aLeader\u548cFollower\u521d\u59cb\u901a\u4fe1\u65f6\u9650</li> <li>syncLimit = 5\uff1aLeader\u548cFollower\u540c\u6b65\u901a\u4fe1\u65f6\u9650</li> </ol> <p>Leader\u548cFollower\u4e4b\u95f4\u901a\u4fe1\u65f6\u95f4\u5982\u679c\u8d85\u8fc7syncLimit * tickTime\uff0cLeader\u8ba4\u4e3aFollwer\u6b7b\u6389\uff0c\u4ece\u670d\u52a1\u5668\u5217\u8868\u4e2d\u5220\u9664Follwer\u3002</p> <ol> <li>dataDir\uff1a\u4fdd\u5b58Zookeeper\u4e2d\u7684\u6570\u636e</li> </ol> <p>\u6ce8\u610f\uff1a \u9ed8\u8ba4\u7684tmp\u76ee\u5f55\uff0c\u5bb9\u6613\u88abLinux\u7cfb\u7edf\u5b9a\u671f\u5220\u9664\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u7528\u9ed8\u8ba4\u7684tmp\u76ee\u5f55</p> <ol> <li>clientPort = 2181\uff1a\u5ba2\u6237\u7aef\u8fde\u63a5\u7aef\u53e3\uff0c\u901a\u5e38\u4e0d\u505a\u4fee\u6539\u3002</li> </ol> <p>\u96c6\u7fa4\u5b89\u88c5\uff0c\u4fdd\u7559\u672c\u5730\u6a21\u5f0f\u7684\u914d\u7f6e\uff0c\u989d\u5916\u8fd8\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u7684\u914d\u7f6e\uff1a 1. \u5728/opt/module/zookeeper-3.5.7/zkData \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a myid \u7684\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u5fc5\u987b\u53ebmyid\uff0c\u8fd9\u4e2a\u662f\u786c\u7f16\u7801\u5728\u4ee3\u7801\u91cc\u7684 \u00a0\u00a0 \u00a0vim myid \u00a0\u00a0 \u00a0\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u672c\u53f0\u673a\u5668zookeeper\u7684\u7f16\u53f7\uff08\u6ce8\u610f\uff1a\u4e0a\u4e0b\u4e0d\u8981\u6709\u7a7a\u884c\uff0c\u5de6\u53f3\u4e0d\u8981\u6709\u7a7a\u683c\uff09\u5982\uff1a2\uff0c\u8fd9\u4e2a\u7f16\u53f7\u5728zookeeper\u96c6\u7fa4\u9009\u4e3e\u65f6\u7528\u3002 2.\u5728/opt/module/zookeeper-3.5.7/conf/zoo.cfg \u672b\u5c3e\u6dfb\u52a0\u4e00\u4e0b\u5185\u5bb9\uff1a Text Only<pre><code>##########cluster############\nserver.2=hadoop102:2888:3888\nserver.3=hadoop103:2888:3888\nserver.4=hadoop104:2888:3888\n</code></pre> \u00a0\u00a0 \u00a0\u914d\u7f6e\u53c2\u6570\u89e3\u8bfb\u00a0server.A=B:C:D \u00a0\u00a0 \u00a0A \u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u8fd9\u4e2a\u662f\u7b2c\u51e0\u53f7\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u503c\u5c31\u662fmyid\u6587\u4ef6\u91cc\u9762\u914d\u7f6e\u7684\u503c \u00a0\u00a0 \u00a0B \u662f\u8fd9\u4e2a\u670d\u52a1\u5668\u7684\u5730\u5740\uff1b \u00a0\u00a0 \u00a0C \u662f\u8fd9\u4e2a\u670d\u52a1\u5668 Follower \u4e0e\u96c6\u7fa4\u4e2d\u7684 Leader \u670d\u52a1\u5668\u4ea4\u6362\u4fe1\u606f\u7684\u7aef\u53e3\uff1b \u00a0\u00a0 \u00a0D \u662f\u4e07\u4e00\u96c6\u7fa4\u4e2d\u7684 Leader \u670d\u52a1\u5668\u6302\u4e86\uff0c\u9700\u8981\u4e00\u4e2a\u7aef\u53e3\u6765\u91cd\u65b0\u8fdb\u884c\u9009\u4e3e\uff0c\u9009\u51fa\u4e00\u4e2a\u65b0\u7684Leader\uff0c\u800c\u8fd9\u4e2a\u7aef\u53e3\u5c31\u662f\u7528\u6765\u6267\u884c\u9009\u4e3e\u65f6\u670d\u52a1\u5668\u76f8\u4e92\u901a\u4fe1\u7684\u7aef\u53e3\u3002 3.\u5206\u53d1\u914d\u7f6e\u597d\u7684 zookeeper \u5230\u5176\u4ed6\u673a\u5668\u4e0a \u00a0\u00a0 \u00a0xsync zookeeper-3.5.7 4. \u5206\u522b\u5728 hadoop103\u3001 hadoop104 \u4e0a\u4fee\u6539 myid \u6587\u4ef6\u4e2d\u5185\u5bb9\u4e3a 3\u30014 5. \u5728 hadoop102 \u7684/home/jmoon/bin \u76ee\u5f55\u4e0b\u521b\u5efa\u811a\u672c zk.sh\uff0c\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650chmod +x ~/bin/zk.sh\u540e\u5206\u53d1\u5230\u5176\u5b83\u673a\u5668\u4e0a Text Only<pre><code>#!/bin/bash\n\ncase $1 in\n\"start\"){\n\u00a0\u00a0\u00a0\u00a0for i in hadoop102 hadoop103 hadoop104\n\u00a0\u00a0\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo ---------- zookeeper $i \u542f\u52a8 ------------\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh $i \"/opt/module/zookeeper-3.5.7/bin/zkServer.sh start\"\n\u00a0\u00a0\u00a0\u00a0done\n};;\n\"stop\"){\n\u00a0\u00a0\u00a0\u00a0for i in hadoop102 hadoop103 hadoop104\n\u00a0\u00a0\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo ---------- zookeeper $i \u505c\u6b62 ------------\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh $i \"/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop\"\n\u00a0\u00a0\u00a0\u00a0done\n};;\n\"status\"){\n\u00a0\u00a0\u00a0\u00a0for i in hadoop102 hadoop103 hadoop104\n\u00a0\u00a0\u00a0\u00a0do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0echo ---------- zookeeper $i \u72b6\u6001 ------------\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ssh $i \"/opt/module/zookeeper-3.5.7/bin/zkServer.sh status\"\n\u00a0\u00a0\u00a0\u00a0done\n};;\nesac\n</code></pre></p> <p>6.\u7528\u811a\u672c\u542f\u52a8zookeeper\u96c6\u7fa4 zk.sh start</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/ZooKeeper/3-zookeeper%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4/","title":"3-zookeeper\u5ba2\u6237\u7aef\u547d\u4ee4","text":"<p> \u7ea6 792 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 16 \u5206\u949f</p> <p>ZooKeeper \u7ec4\u7ec7\u6570\u636e\u7684\u7ed3\u6784\u662f\u4e00\u68f5\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u79f0\u505a\u4e00\u4e2a ZNode\u3002\u6bcf\u4e00\u4e2a ZNode \u9ed8\u8ba4\u80fd\u591f\u5b58\u50a8 1MB \u7684\u6570\u636e\uff0c\u6bcf\u4e2a ZNode \u90fd\u53ef\u4ee5\u901a\u8fc7\u5176\u8def\u5f84\u552f\u4e00\u6807\u8bc6\u3002 </p> <p>Znode\u4e2d\u5b58\u50a8\u7684\u4fe1\u606f\uff1a  data\uff1aZnode\u5b58\u50a8\u7684\u6570\u636e\u4fe1\u606f\u3002 ACL\uff1a\u8bb0\u5f55Znode\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u5373\u54ea\u4e9b\u4eba\u6216\u54ea\u4e9bIP\u53ef\u4ee5\u8bbf\u95ee\u672c\u8282\u70b9\u3002 stat\uff1a\u5305\u542bZnode\u7684\u5404\u79cd\u5143\u6570\u636e\uff0c\u6bd4\u5982\u4e8b\u52a1ID\u3001\u7248\u672c\u53f7\u3001\u65f6\u95f4\u6233\u3001\u5927\u5c0f\u7b49\u7b49\u3002 child\uff1a\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u5f15\u7528\uff0c\u7c7b\u4f3c\u4e8e\u4e8c\u53c9\u6811\u7684\u5de6\u5b69\u5b50\u53f3\u5b69\u5b50\u3002</p> <p>ZooKeeper\u7684\u56db\u79cd\u8282\u70b9\u7c7b\u578b\uff1a\u6301\u4e45\u65e0\u5e8f\u53f7\u3001\u6301\u4e45\u6709\u5e8f\u53f7\u3001\u77ed\u6682\u6709\u5e8f\u53f7\u3001\u77ed\u6682\u65e0\u5e8f\u53f7 \u6301\u4e45\u4e0e\u77ed\u6682\u7684\u610f\u601d\u662f\uff1a \u5ba2\u6237\u7aef\u4e0eZookeeper\u65ad\u5f00\u8fde\u63a5\u540e\uff0c \u8be5\u8282\u70b9\u662f\u5426\u4f9d\u65e7\u5b58\u5728\u3002\u6301\u4e45\u4ee3\u8868\u4f9d\u65e7\u5b58\u5728\uff0c\u77ed\u6682\u8868\u793a\u65ad\u5f00\u8fde\u63a5\u4e4b\u540e\u8282\u70b9\u5c31\u88ab\u5220\u9664\u4e86\u3002 \u6709\u5e8f\u53f7\u548c\u65e0\u5e8f\u53f7\u7684\u610f\u601d\u662f\uff1aZookeeper\u662f\u5426\u5728\u7528\u6237\u7ed9\u8282\u70b9\u8d77\u7684\u540d\u5b57\u540e\u9762\u52a0\u4e0a\u9012\u589e\u7684\u987a\u5e8f\u7f16\u53f7\uff0c\u6709\u5e8f\u53f7\u8868\u793a\u52a0\u4e0a\uff0c\u65e0\u5e8f\u53f7\u8868\u793a\u4e0d\u52a0\u3002</p> <p>bin\u76ee\u5f55\u4e0b\u5e38\u7528\u7684\u811a\u672c\u89e3\u91ca zkCleanup.sh\u3000\u3000\u6e05\u7406Zookeeper\u5386\u53f2\u6570\u636e\uff0c\u5305\u62ec\u4e8b\u52a1\u65e5\u5fd7\u6587\u4ef6\u548c\u5feb\u7167\u6570\u636e\u6587\u4ef6 zkCli.sh\u3000\u3000\u3000\u3000\u00a0 \u542f\u52a8Zookeeper\u7684\u5ba2\u6237\u7aef zkEnv.sh\u3000\u3000\u3000\u3000\u8bbe\u7f6eZookeeper\u7684\u73af\u5883\u53d8\u91cf zkServer.sh\u3000\u3000 \u00a0 Zookeeper\u670d\u52a1\u5668\u7684\u542f\u52a8\u3001\u505c\u6b62\u3001\u548c\u91cd\u542f\u811a\u672c</p> <p>\u5ba2\u6237\u7aef\u547d\u4ee4: 1.\u663e\u793a\u6240\u6709\u64cd\u4f5c\u547d\u4ee4 \u00a0 \u00a0 help 2.\u4f7f\u7528 ls \u547d\u4ee4\u6765\u67e5\u770b\u5f53\u524d znode \u7684\u5b50\u8282\u70b9 [\u53ef\u76d1\u542c] \u00a0\u00a0 \u00a0ls [-s] [-w] [-R] path \u00a0\u00a0 \u00a0-s \u67e5\u770b\u8be6\u7ec6\u4fe1\u606f \u00a0\u00a0 \u00a0-w \u76d1\u542c\u5b50\u8282\u70b9\u53d8\u5316 3.\u521b\u5efa\u8282\u70b9\uff0c\u4e0d\u52a0\u4efb\u4f55\u53c2\u6570\u8868\u793a\u6301\u4e45\u65e0\u5e8f\u53f7 \u00a0\u00a0 \u00a0create [-s] [-e] [-c] [-t ttl] path [data] [acl] \u00a0\u00a0 \u00a0-s\u00a0\u542b\u6709\u5e8f\u5217  -e \u4e34\u65f6(\u91cd\u542f\u6216\u8005\u8d85\u65f6\u6d88\u5931)  path \u8def\u5f84 \u00a0\u00a0 \u00a0data \u8282\u70b9\u7684\u6570\u636e 4.\u83b7\u5f97\u8282\u70b9\u7684\u503c [\u53ef\u76d1\u542c] \u00a0\u00a0 \u00a0get [-s] [-w] path  -s \u67e5\u770b\u8be6\u7ec6\u4fe1\u606f  -w \u76d1\u542c\u8282\u70b9\u5185\u5bb9\u53d8\u5316 5.\u8bbe\u7f6e\u8282\u70b9\u7684\u5177\u4f53\u503c \u00a0\u00a0 \u00a0set [-s] [-v version] path data \u00a0\u00a0 \u00a0path \u8def\u5f84 \u00a0\u00a0 \u00a0data \u8282\u70b9\u7684\u6570\u636e 6.\u67e5\u770b\u8282\u70b9\u7684\u8be6\u7ec6\u4fe1\u606f \u00a0\u00a0 \u00a0stat [-w] path 7.\u5220\u9664\u8282\u70b9 \u00a0\u00a0 \u00a0delete [-v version] path \u00a0\u00a0 \u00a0path \u8def\u5f84 8.\u9012\u5f52\u5220\u9664\u8282\u70b9 \u00a0\u00a0 \u00a0deleteall path \u00a0\u00a0 \u00a0path \u8def\u5f84</p> <p>\u67e5\u770b\u8282\u70b9\u8be6\u7ec6\u6570\u636e stat\u00a0 Text Only<pre><code>[zk: localhost:2181(CONNECTED) 12] stat /\ncZxid = 0x0\nctime = Wed Dec 31 19:00:00 EST 1969\nmZxid = 0x0\nmtime = Wed Dec 31 19:00:00 EST 1969\npZxid = 0x10000001e\ncversion = 6\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 0\nnumChildren = 4\n</code></pre></p> <p>\uff081\uff09 czxid\uff1a \u521b\u5efa\u8282\u70b9\u65f6\u7684\u4e8b\u52a1 zxid\uff0c\u6bcf\u6b21\u6267\u884ccreate\u3001set\u3001delete\u8fd9\u6837\u7684\u4fee\u6539\u547d\u4ee4\u65f6\u90fd\u662f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u6bcf\u6b21\u4e8b\u52a1\u90fd\u4f1a\u90fd\u6709\u4e00\u4e2a\u4e8b\u52a1id\uff0c\u8fd9\u4e2aid\u662f\u5728\u6574\u4e2a\u96c6\u7fa4\u5168\u5c40\u552f\u4e00\u7684\uff0c\u6bcf\u6b21\u751f\u6210\u7684\u4e8b\u52a1id\u90fd\u662f\u5728\u8fd9\u4e2a\u5168\u5c40\u7684\u4e8b\u52a1id\u4e0a\u52a01\uff0cczxid\u5c31\u662fcreate\u8fd9\u4e2a\u8282\u70b9\u65f6\u7684\u4e8b\u52a1id\u3002 \uff082\uff09 ctime\uff1a\u00a0 \u521b\u5efaznode\u7684\u65f6\u95f4 \uff083\uff09 mzxid\uff1a znode \u6700\u540e\u66f4\u65b0\u7684\u4e8b\u52a1 zxid \uff084\uff09 mtime\uff1a znode \u6700\u540e\u4fee\u6539\u7684\u65f6\u95f4 \uff085\uff09 pZxid\uff1a \u6700\u540e\u521b\u5efa\u7684\u5b50\u8282\u70b9\u7684\u4e8b\u52a1 zxid \uff086\uff09 cversion\uff1a \u6dfb\u52a0\u5220\u9664\u5b50\u8282\u70b9\u7684\u6b21\u6570 \uff087\uff09 dataversion\uff1a znode \u6570\u636e\u53d8\u5316\u4e86\u591a\u5c11\u6b21 \uff088\uff09 aclVersion\uff1a znode \u8bbf\u95ee\u63a7\u5236\u5217\u8868\u53d8\u5316\u4e86\u591a\u5c11\u6b21 \uff089\uff09 ephemeralOwner\uff1a \u5982\u679c\u662f\u4e34\u65f6\u8282\u70b9\uff0c\u8fd9\u4e2a\u662f znode \u62e5\u6709\u8005\u7684 session id\uff0c\u5982\u679c\u4e0d\u662f\u4e34\u65f6\u8282\u70b9\u5219\u662f 0\u3002 \uff0810\uff09 dataLength\uff1a znode \u7684\u6570\u636e\u957f\u5ea6 \uff0811\uff09 numChildren\uff1a znode \u5b50\u8282\u70b9\u6570\u91cf</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/ZooKeeper/4-zookeeper%E7%9B%91%E5%90%AC%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6/","title":"4-zookeeper\u76d1\u542c\u901a\u77e5\u673a\u5236","text":"<p> \u7ea6 700 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 14 \u5206\u949f</p> <p>\u5ba2\u6237\u7aef\u6ce8\u518c\u76d1\u542c\u5b83\u5173\u5fc3\u7684\u76ee\u5f55\u8282\u70b9\uff0c\u5f53\u76ee\u5f55\u8282\u70b9\u53d1\u751f\u53d8\u5316\uff08\u6570\u636e\u6539\u53d8\u3001\u8282\u70b9\u5220\u9664\u3001\u5b50\u76ee\u5f55\u8282\u70b9\u589e\u52a0\u5220\u9664\uff09\u65f6\uff0c ZooKeeper \u4f1a\u5feb\u901f\u901a\u77e5\u76d1\u542c\u4e86\u8be5\u8282\u70b9\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u7c7b\u4f3c\u4e8e\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\u3002 </p> <p>\u6ce8\u610f\uff1a\u6ce8\u518c\u4e00\u6b21\uff0c\u53ea\u80fd\u76d1\u542c\u4e00\u6b21\uff0c\u60f3\u518d\u6b21\u76d1\u542c\uff0c\u9700\u8981\u518d\u6b21\u6ce8\u518c\u3002</p> <p>\u6848\u4f8b\uff1a \u76d1\u542c\u670d\u52a1\u5668\u52a8\u6001\u4e0a\u4e0b\u7ebf\uff0c\u548c\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3</p> <p>Server\u7aef\uff0c\u7b80\u5355\u7684\u4e00\u4e2a\u4e1a\u52a1\u903b\u8f91\uff0c\u63a5\u53d7\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u7684\u6570\u636e\u6253\u5370\u5230\u63a7\u5236\u53f0\uff0c\u91cd\u70b9\u662fargs[0]\u662f\u670d\u52a1\u540d\uff0cargs[1]\u662fip+\u7aef\u53e3\u53f7\uff0c\u4e5f\u5c31\u662f\u6211\u628a\u670d\u52a1\u540d\u548c\u8fde\u63a5\u5730\u5740\u4fdd\u5b58\u5230\u4e86zookeeper\uff0czookeeper\u4f5c\u4e3a\u6ce8\u518c\u4e2d\u5fc3\u3002 Text Only<pre><code>public class DistributeServer {\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6zk\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ZooKeeper zkCli = ZKUtils.getConnect();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u6ce8\u518c\u670d\u52a1\u5668\u5230zk\u96c6\u7fa4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (zkCli.exists(\"/servers\", false) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkCli.create(\"/servers\", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ZKUtils.serverRegister(zkCli, args[0], args[1]);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u542f\u52a8\u4e1a\u52a1\u903b\u8f91\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new DistributeServer().business(Integer.parseInt(args[1].split(\":\")[1]));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0private void business(int port) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Socket socket = new ServerSocket(port).accept();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while ((line = bufferedReader.readLine()) != null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u670d\u52a1\u7aef\u6536\u5230\uff1a\" + line);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (IOException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task).start();\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u5ba2\u6237\u7aef\uff0cargs[0]\u662f\u60f3\u8fde\u63a5\u7684\u670d\u52a1\u540d\uff0c\u5148\u4ecezookeeper\u4e2d\u83b7\u53d6\u670d\u52a1\u540d\u5bf9\u5e94\u7684\u5730\u5740\uff0c\u7136\u540e\u8fde\u63a5\u5230\u670d\u52a1 Text Only<pre><code>public class Client {\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 1 \u83b7\u53d6zk\u8fde\u63a5\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ZooKeeper zkCli = ZKUtils.getConnect();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 2 \u76d1\u542c/servers\u4e0b\u9762\u5b50\u8282\u70b9\u7684\u589e\u52a0\u548c\u5220\u9664\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ZKUtils.printServerList(zkCli);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// 3 \u4e1a\u52a1\u903b\u8f91\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Client().business(ZKUtils.getServerAddr(zkCli, args[0]));\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0private void business(String serverAddr) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String[] str = serverAddr.split(\":\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Socket socket = new Socket(str[0], Integer.parseInt(str[1]));\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PrintStream printStream = new PrintStream(socket.getOutputStream());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Scanner scanner = new Scanner(System.in);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.print(\"\u5ba2\u6237\u7aef\u53d1\u9001\uff1a\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String line = scanner.nextLine();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (line.equals(\"exit\")) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0socket.close();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0printStream.println(line);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>ZKUtils\u662f\u6838\u5fc3\u7684\u5de5\u5177\u7c7b\u3002getConnect()\u662f\u83b7\u53d6\u8fde\u63a5\uff1bserverRegister() \u662f\u670d\u52a1\u6ce8\u518c\uff1bprintServerList()\u662f\u67e5\u770b\u6240\u6709\u5728\u7ebf\u670d\u52a1\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u76d1\u542c\u670d\u52a1\u5668\u52a8\u6001\u4e0a\u4e0b\u7ebf\uff1bgetServerAddr()\u662f\u6839\u636e\u670d\u52a1\u540d\u83b7\u53d6\u670d\u52a1\u7684\u8fde\u63a5\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u4ece\u6ce8\u518c\u4e2d\u5fc3\u4e2d\u83b7\u53d6\u670d\u52a1\u5730\u5740\u3002\u56e0\u4e3a\u56de\u8c03\u51fd\u6570\u53ea\u4f1a\u56de\u8c03\u4e00\u6b21\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u8981\u80fd\u4e00\u76f4\u76d1\u542c\uff0c\u6280\u5de7\u5c31\u662f\u5728\u56de\u8c03\u51fd\u6570\u4e2d\u8c03\u7528\u81ea\u5df1\u5373\u53ef\uff0cserverRegister() \u548c printServerList()\u5c31\u662f\u8fd9\u6837\u505a\u7684\u3002 Text Only<pre><code>public class ZKUtils {\n\n\u00a0\u00a0\u00a0\u00a0private static final String SERVER = \"/servers/\";\n\n\u00a0\u00a0 \u00a0public static ZooKeeper getConnect() throws IOException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sessionTimeout = 2000;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String connectString = \"hadoop102:2181,hadoop103:2181,hadoop104:2181\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new ZooKeeper(connectString, sessionTimeout, null);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0 \u00a0public static void serverRegister(ZooKeeper zkCli, String serverName, String serverAddr) throws KeeperException, InterruptedException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\u521b\u5efa\u4e34\u65f6\u4e0d\u5e26\u5e8f\u53f7\u7684\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String create = zkCli.create(SERVER + serverName, serverAddr.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u670d\u52a1\uff1a\" + serverName + \" \u4e0a\u7ebf\");\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static void printServerList(ZooKeeper zkCli) throws Exception {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;String&gt; children = zkCli.getChildren(\"/servers\", watchedEvent -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ZKUtils.printServerList(zkCli);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"\u5df2\u4e0a\u7ebf\u7684\u670d\u52a1\uff1a\" + children);\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public static String getServerAddr(ZooKeeper zkCli, String serverName) throws InterruptedException, KeeperException {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0byte[] data = zkCli.getData(SERVER + serverName, watchedEvent -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String serverAddr = ZKUtils.getServerAddr(zkCli, serverName);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(serverName + \"\u7684\u5730\u5740\u6539\u53d8\u4e86\uff0c\u65b0\u5730\u5740\u662f\uff1a\" + serverAddr);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return new String(data);\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/ZooKeeper/5-ZooKeeper%20%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A1%88%E4%BE%8B/","title":"5-ZooKeeper \u5206\u5e03\u5f0f\u9501\u6848\u4f8b","text":"<p> \u7ea6 1523 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 30 \u5206\u949f</p> <p>\u5229\u7528zookeeper\u53ef\u4ee5\u5b9e\u73b0\u5206\u5e03\u5f0f\u6392\u4ed6\u9501\uff0c\u548c\u5206\u5e03\u5f0f\u5171\u4eab\u9501</p> <p>\u4ee5\u4e0b\u8bb2\u4e24\u79cd\u5206\u5e03\u5f0f\u6392\u4ed6\u9501\u7684\u5b9e\u73b0\u65b9\u6cd5 \u7b2c\u4e00\u79cd\u65b9\u6cd5\uff0c\u4e0d\u65ad\u5c1d\u8bd5\u521b\u5efa\u540c\u4e00\u4e2a\u4e34\u65f6\u8282\u70b9\uff0c\u5982\u679c\u521b\u5efa\u8282\u70b9\u6210\u529f\u5c31\u8868\u793a\u83b7\u5f97\u4e86\u9501\uff0c\u8fd9\u6837\u80fd\u884c\u662f\u56e0\u4e3a\u4e24\u70b9\uff0c\u4e00\u662fzookeeper\u4f1a\u987a\u5e8f\u6267\u884c\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u8fd9\u6837\u80fd\u4fdd\u8bc1\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u53ea\u6709\u4e00\u4e2a\u8bf7\u6c42\u80fd\u521b\u5efa\u8282\u70b9\u6210\u529f\uff1b\u4e8c\u662fzookeeper\u8fd8\u80fd\u4fdd\u8bc1\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4e5f\u53ea\u6709\u4e00\u4e2a\u8bf7\u6c42\u80fd\u521b\u5efa\u6210\u529f\u3002 \u603b\u4e4b\u4e00\u53e5\u8bdd\uff0c\u7528\u6237\u6839\u672c\u5c31\u4e0d\u7528\u53bb\u8003\u8651\u4ed6\u8fde\u63a5\u7684\u5177\u4f53\u662f\u54ea\u4e00\u53f0zookeeper\uff0c\u4e5f\u4e0d\u8981\u8003\u8651zookeeper\u96c6\u7fa4\u4e4b\u95f4\u7684\u6570\u636e\u662f\u5426\u4e00\u81f4\uff0c\u6700\u91cd\u8981\u7684\u662f\u7528\u6237\u4e0d\u7528\u8003\u8651\u5e76\u53d1\u7684\u4fee\u6539\u8bf7\u6c42\u4f1a\u4e0d\u4f1a\u6253\u4e71\u6574\u4e2a\u6811\u5f62\u7ed3\u6784\uff0c\u56e0\u4e3a\u5728\u7528\u6237\u770b\u6765zookeeper\u96c6\u7fa4\u5c31\u662f\u4e00\u4e2a\u5e76\u53d1\u5b89\u5168\u7684\u6811\u5f62\u5b58\u50a8\u7ed3\u6784\uff0c\u7c7b\u4f3c\u4e8e\u5e76\u53d1\u5b89\u5168\u7684CurrentHashMap\u3002 Text Only<pre><code>public class XLock {\n\n\u00a0\u00a0\u00a0\u00a0private ZooKeeper zkClient;\n\u00a0\u00a0\u00a0\u00a0private static final String LOCKNODE = \"/exclusive_lock/lock\";\n\n\u00a0\u00a0\u00a0\u00a0public XLock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String connectString = \"hadoop102:2181,hadoop103:2181,hadoop104:2181\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sessionTimeout = 2000;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient = new ZooKeeper(connectString, sessionTimeout, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5224\u65ad\u8282\u70b9 /locks \u662f\u5426\u5b58\u5728\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (zkClient.exists(\"/exclusive_lock\", false) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0d\u5b58\u5728\u5219\u521b\u5efa\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.create(\"/exclusive_lock\", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void lock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0while (true) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.create(LOCKNODE, null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u53d6\u9501\u6210\u529f\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0break;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.MILLISECONDS.sleep(300);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException ex) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ex.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void unlock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u91ca\u653e\u4e86\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.delete(LOCKNODE, -1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u7c7b\u9700\u8981new \u4e24\u4e2aXLock\u7684\u539f\u56e0\u662f\uff0c\u5728\u540c\u4e00\u53f0\u673a\u5668\u91cc\u7684\u5e76\u53d1\u7ebf\u7a0b\u90fd\u662f\u7528\u7684\u540c\u4e00\u4e2a\u9501\u5bf9\u8c61\uff0c\u800c\u5728\u5728\u4e0d\u540c\u4e3b\u673a\u91cc\u7684\u7ebf\u7a0b\u90a3\u5c31\u7528\u7684\u662f\u4e0d\u540c\u7684\u9501\u5bf9\u8c61\uff0c\u8fd9\u91cc\u6a21\u62df\u7684\u662f\u5206\u5e03\u5f0f\u9501\u7684\u573a\u666f\uff0c\u6240\u4ee5\u9700\u8981new \u4e24\u4e2a\u9501\u5bf9\u8c61\u3002 Text Only<pre><code>public class XLockTest {\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0XLock xLock01 = new XLock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task01 = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xLock01.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xLock01.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0XLock xLock02 = new XLock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task02 = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xLock02.lock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xLock02.unlock();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task01, \"server01-thread-\" + i).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task02, \"server02-thread-\" + i).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n</code></pre></p> <p>\u65b9\u6cd5\u4e00\u9700\u8981\u4e0d\u65ad\u91cd\u8bd5\uff0c\u6ca1\u6709\u5229\u7528\u5230zookeeper\u7684\u76d1\u542c\u673a\u5236\uff0c\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u5229\u7528\u901a\u77e5\u673a\u5236\u6765\u5524\u9192\u81ea\u5df1\uff0c\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u521b\u5efa\u4e00\u4e2a\u5e26\u5e8f\u53f7\u7684\u4e34\u65f6\u8282\u70b9\uff0c\u5176\u4e2d\u521b\u5efa\u5e8f\u53f7\u6700\u5c0f\u7684\u4e34\u65f6\u8282\u70b9\u7684\u7ebf\u7a0b\u83b7\u5f97\u9501\uff0c\u5176\u5b83\u7ebf\u7a0b\u6302\u8d77\u5e76\u76d1\u542c\u5b83\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u53d8\u5316\uff0c\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u5220\u9664\u4e86\uff0c\u90a3\u4e48\u5b83\u7684\u76d1\u542c\u7ebf\u7a0b\u6536\u5230\u901a\u77e5\uff0c\u7136\u540e\u5524\u9192\u5b83\u3002 threadLocal\u7528\u6765\u5728\u91ca\u653e\u9501\u65f6\u5220\u9664\u8282\u70b9\uff0c\u56e0\u4e3a\u8981threadMap\u5728\u56de\u8c03\u51fd\u6570\u91cc\u5524\u9192\u7ebf\u7a0b\uff0c\u6240\u4ee5\u5fc5\u987b\u8981\u628aThreadLocal\u5bf9\u8c61\u653e\u5728map\u4e2d\uff0c\u901a\u8fc7\u524d\u4e00\u4e2a\u8282\u70b9\u5220\u9664\u65f6\u8fd4\u56de\u7684\u8def\u5f84\u62ff\u5230Thread\u5bf9\u8c61</p> Text Only<pre><code>public class XLock {\n\n\u00a0\u00a0\u00a0\u00a0private ZooKeeper zkClient;\n\u00a0\u00a0\u00a0\u00a0private final ConcurrentHashMap&lt;String, Thread&gt; threadMap = new ConcurrentHashMap&lt;&gt;();\n\u00a0\u00a0\u00a0\u00a0ThreadLocal&lt;String&gt; threadLocal = new ThreadLocal&lt;&gt;();\n\n\u00a0\u00a0\u00a0\u00a0public XLock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String connectString = \"hadoop102:2181,hadoop103:2181,hadoop104:2181\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sessionTimeout = 2000;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient = new ZooKeeper(connectString, sessionTimeout, watchedEvent -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (watchedEvent.getType() == Watcher.Event.EventType.NodeDeleted) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String key = watchedEvent.getPath();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread thread = threadMap.remove(key);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LockSupport.unpark(thread);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5224\u65ad\u8282\u70b9 /exclusive_lock \u662f\u5426\u5b58\u5728\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (zkClient.exists(\"/exclusive_lock\", false) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0d\u5b58\u5728\u5219\u521b\u5efa\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.create(\"/exclusive_lock\", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void lock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u5bf9\u5e94\u7684\u4e34\u65f6\u5e26\u5e8f\u53f7\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String currentLockNode = zkClient.create(\"/exclusive_lock/\" + \"seq-\", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5224\u65ad\u521b\u5efa\u7684\u8282\u70b9\u662f\u5426\u662f\u6700\u5c0f\u7684\u5e8f\u53f7\u8282\u70b9\uff0c\u5982\u679c\u662f\u83b7\u53d6\u5230\u9501\uff1b\u5982\u679c\u4e0d\u662f\uff0c\u76d1\u542c\u4ed6\u5e8f\u53f7\u524d\u4e00\u4e2a\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;String&gt; children = zkClient.getChildren(\"/exclusive_lock\", false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679cchildren \u53ea\u6709\u4e00\u4e2a\u503c\uff0c\u90a3\u5c31\u76f4\u63a5\u83b7\u53d6\u9501\uff1b\u5982\u679c\u6709\u591a\u4e2a\u8282\u70b9\uff0c\u9700\u8981\u5224\u65ad\u8c01\u6700\u5c0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (children.size() &gt; 1) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Collections.sort(children);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u83b7\u53d6\u8282\u70b9\u540d\u79f0 seq-00000000\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String thisNode = currentLockNode.substring(\"/exclusive_lock/\".length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u901a\u8fc7seq-00000000 \u83b7\u53d6\u8be5\u8282\u70b9\u5728children\u96c6\u5408\u7684\u4f4d\u7f6e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int index = children.indexOf(thisNode);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u56e0\u4e3a\u5728zkClient.create\u548czkClient.getChildren(\"/exclusive_lock\", false);\u53ef\u80fd\u6709\u5176\u5b83\u7ebf\u7a0b\u4e5f\u521b\u5efa\u4e86\u8282\u70b9\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5\u5e76\u4e0d\u662f\u8bf4\u53ea\u6709 children.size() == 1 \u8fd9\u4e2a\u7ebf\u7a0b\u624d\u662f\u7b2c\u4e00\u4e2a\u521b\u5efa\u8282\u70b9\u7684\u7ebf\u7a0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (index == 0) {// \u5982\u679c\u81ea\u5df1\u5c31\u662f\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u83b7\u5f97\u9501\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u5f97\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadLocal.set(currentLockNode);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u76d1\u542c\u5b83\u524d\u4e00\u4e2a\u8282\u70b9\u53d8\u5316\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String preNode = \"/exclusive_lock/\" + children.get(index - 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.getData(preNode, true, null);\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0/**\n    * \u628a\u81ea\u5df1\u653e\u5230map\u4e2d\uff0ckey\u662f\u524d\u4e00\u4e2a\u8282\u70b9\u8def\u5f84\uff0c\u56e0\u4e3a\u524d\u4e00\u4e2a\u8282\u70b9\u5220\u9664\u65f6\u4f1a\u8fd4\u56de\u5b83\u7684\u8def\u5f84\uff0c\n    * \u8fd9\u6837\u5c31\u80fd\u901a\u8fc7\u524d\u4e00\u4e2a\u8282\u70b9\u8def\u5f84\u5728map\u4e2d\u627e\u5230\u81ea\u5df1\uff0c\u4ece\u800c\u8ba9\u76d1\u542c\u7ebf\u7a0b\u5524\u9192\u81ea\u5df1\n    */ \n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadMap.put(preNode, Thread.currentThread());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LockSupport.park();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadLocal.set(currentLockNode);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u5f97\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void unlock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u91ca\u653e\u4e86\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.delete(threadLocal.get(), -1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre> <p>\u628a\u56de\u8c03\u51fd\u6570\u5199\u5728\u521b\u5efazookeeper\u5ba2\u6237\u7aef\u90a3\u91cc\u6765\u5b9e\u73b0\u5524\u9192\uff0c\u5b9e\u5728\u592a\u9ebb\u70e6\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u56de\u8c03\u51fd\u6570\u5199\u5728getData\u91cc\uff0c\u8fd9\u6837\u5c31\u4e0d\u8981HashMap\u4e86\u3002 Text Only<pre><code>public class XLock {\n\n\u00a0\u00a0\u00a0\u00a0private ZooKeeper zkClient;\n\u00a0\u00a0\u00a0\u00a0ThreadLocal&lt;String&gt; threadLocal = new ThreadLocal&lt;&gt;();\n\n\u00a0\u00a0\u00a0\u00a0public XLock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String connectString = \"hadoop102:2181,hadoop103:2181,hadoop104:2181\";\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int sessionTimeout = 2000;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient = new ZooKeeper(connectString, sessionTimeout, null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5224\u65ad\u8282\u70b9 /exclusive_lock \u662f\u5426\u5b58\u5728\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (zkClient.exists(\"/exclusive_lock\", false) == null) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u4e0d\u5b58\u5728\u5219\u521b\u5efa\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.create(\"/exclusive_lock\", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void lock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u5bf9\u5e94\u7684\u4e34\u65f6\u5e26\u5e8f\u53f7\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String currentLockNode = zkClient.create(\"/exclusive_lock/\" + \"seq-\", null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5224\u65ad\u521b\u5efa\u7684\u8282\u70b9\u662f\u5426\u662f\u6700\u5c0f\u7684\u5e8f\u53f7\u8282\u70b9\uff0c\u5982\u679c\u662f\u83b7\u53d6\u5230\u9501\uff1b\u5982\u679c\u4e0d\u662f\uff0c\u76d1\u542c\u4ed6\u5e8f\u53f7\u524d\u4e00\u4e2a\u8282\u70b9\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0List&lt;String&gt; children = zkClient.getChildren(\"/exclusive_lock\", false);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u5982\u679cchildren \u53ea\u6709\u4e00\u4e2a\u503c\uff0c\u90a3\u5c31\u76f4\u63a5\u83b7\u53d6\u9501\uff1b\u5982\u679c\u6709\u591a\u4e2a\u8282\u70b9\uff0c\u9700\u8981\u5224\u65ad\u8c01\u6700\u5c0f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (children.size() &gt; 1) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Collections.sort(children);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u83b7\u53d6\u8282\u70b9\u540d\u79f0 seq-00000000\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String thisNode = currentLockNode.substring(\"/exclusive_lock/\".length());\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u901a\u8fc7 seq-00000000 \u83b7\u53d6\u8be5\u8282\u70b9\u5728children\u96c6\u5408\u7684\u4f4d\u7f6e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0int index = children.indexOf(thisNode);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/**\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u56e0\u4e3a\u5728zkClient.create\u548czkClient.getChildren(\"/exclusive_lock\", false);\u53ef\u80fd\u6709\u5176\u5b83\u7ebf\u7a0b\u4e5f\u521b\u5efa\u4e86\u8282\u70b9\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0* \u6240\u4ee5\u5e76\u4e0d\u662f\u8bf4\u53ea\u6709 children.size() == 1 \u8fd9\u4e2a\u7ebf\u7a0b\u624d\u662f\u7b2c\u4e00\u4e2a\u521b\u5efa\u8282\u70b9\u7684\u7ebf\u7a0b\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0*/\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (index == 0) {// \u5982\u679c\u81ea\u5df1\u5c31\u662f\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u83b7\u5f97\u9501\uff0c\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u5f97\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadLocal.set(currentLockNode);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String preNode = \"/exclusive_lock/\" + children.get(index - 1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Thread thread = Thread.currentThread();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u76d1\u542c\u5b83\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u53d8\u5316\uff0c\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u5220\u9664\u4e86\uff0c\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\u628a\u81ea\u5df1\u5524\u9192\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.getData(preNode, watchedEvent -&gt; LockSupport.unpark(thread), null);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u628a\u81ea\u5df1\u6302\u8d77\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0LockSupport.park();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0threadLocal.set(currentLockNode);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u5f97\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0public void unlock() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u91ca\u653e\u4e86\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0zkClient.delete(threadLocal.get(), -1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p> <p>\u4ece\u4e0a\u8ff0\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u5206\u5e03\u5f0f\u9501\u8fd8\u662f\u5f88\u590d\u6742\u7684\uff0c\u4e0b\u9762\u662f\u4f7f\u7528Curator \u6846\u67b6\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u4f8b\u5b50\uff1a \u5bfc\u5165\u4f9d\u8d56\uff1a Text Only<pre><code>&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;curator-framework&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;4.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;4.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;groupId&gt;org.apache.curator&lt;/groupId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;artifactId&gt;curator-client&lt;/artifactId&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;version&gt;4.3.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre></p> <p>\u5b9e\u4f8b\u4ee3\u7801\uff1a Text Only<pre><code>public class CuratorLockTest {\n\n\u00a0\u00a0\u00a0\u00a0public static void main(String[] args) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u5206\u5e03\u5f0f\u95011\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0InterProcessMutex lock01 = new InterProcessMutex(getCuratorFramework(), \"/locks\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u521b\u5efa\u5206\u5e03\u5f0f\u95012\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0InterProcessMutex lock02 = new InterProcessMutex(getCuratorFramework(), \"/locks\");\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task01 = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock01.acquire();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u5f97\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u91ca\u653e\u4e86\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock01.release();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Runnable task02 = () -&gt; {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock02.acquire();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u83b7\u5f97\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TimeUnit.SECONDS.sleep(1);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (InterruptedException e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(Thread.currentThread().getName() + \"\u91ca\u653e\u4e86\u9501\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0lock02.release();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (Exception e) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0e.printStackTrace();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0};\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for (int i = 0; i &lt; 10; i++) {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task01, \"server01-thread-\" + i).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0new Thread(task02, \"server02-thread-\" + i).start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0private static CuratorFramework getCuratorFramework() {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ExponentialBackoffRetry policy = new ExponentialBackoffRetry(3000, 3);\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CuratorFramework client = CuratorFrameworkFactory.builder().connectString(\"hadoop102:2181,hadoop103:2181,hadoop104:2181\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.connectionTimeoutMs(2000)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.sessionTimeoutMs(2000)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0.retryPolicy(policy).build();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// \u542f\u52a8\u5ba2\u6237\u7aef\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0client.start();\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0System.out.println(\"zookeeper Curator\u5ba2\u6237\u7aef\u542f\u52a8\u6210\u529f\");\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return client;\n\u00a0\u00a0\u00a0\u00a0}\n}\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/1-%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%E6%9E%B6%E6%9E%84/","title":"1-\u7535\u5546\u6570\u4ed3\u67b6\u6784","text":"<p> \u7ea6 66 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 1 \u5206\u949f</p> <p>\u6574\u4e2a\u79bb\u7ebf\u6570\u4ed3\u7684\u67b6\u6784\uff1a  \u4e24\u79cd\u6570\u636e\uff1a\u7528\u6237\u884c\u4e3a\u65e5\u5fd7 \u548c \u4e1a\u52a1\u6570\u636e \u65e5\u5fd7\u6709\u4e24\u79cd\u683c\u5f0f\uff1a \u9875\u9762\u57cb\u70b9\u65e5\u5fd7\uff1a  \u542f\u52a8\u65e5\u5fd7\uff1a  \u4e1a\u52a1\u6570\u636e\u5c31\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93MySQL\u4e2d\u8868\u7684\u6570\u636e\uff1a  </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/10-ADS%E5%B1%82/","title":"10-ADS\u5c42","text":"<p> \u7ea6 2334 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 47 \u5206\u949f</p> <p>ADS\u5c42\u662f\u4e3a\u76f4\u63a5\u4e3a\u5e94\u7528\u63d0\u4f9b\u6570\u636e\u7684\u4e00\u5c42\uff0c\u5982\u5404\u79cd\u62a5\u8868\u548c\u7edf\u8ba1\u56fe\uff0c\u6240\u4ee5\u4e00\u822c\u662f\u5e94\u7528\u9700\u8981\u4ec0\u4e48\u6837\u6570\u636e\uff0cADS\u5c42\u5c31\u4f1a\u76f8\u5e94\u5730\u5efa\u4ec0\u4e48\u6837\u7684\u8868\u7b49\u3002ADS\u5c42\u7684\u6570\u636e\u6765\u6e90\u662f ODS\u5c42\uff08\u7279\u6b8a\u8868\u53ea\u5728ODS\u5c42\u88c5\u8f7d\u4e00\u6b21\uff09\u3001DIM\u5c42\u3001DWD\u5c42\u3001DWS\u5c42\u3001DWT\u5c42\uff0c\u4e5f\u5c31\u662fADS\u5c42\u4f1a\u5145\u5206\u5229\u7528\u524d\u9762\u5404\u5c42\u7684\u6570\u636e\u8ba1\u7b97\u4e00\u4e9b\u65b0\u7684\u6307\u6807\u3002\u56e0\u4e3aADS\u5c42\u7684\u6570\u636e\u6765\u6e90\u5f88\u591a\uff0c\u7edf\u8ba1\u9700\u6c42\u4e0d\u56fa\u5b9a\uff0c\u4e0d\u50cf\u524d\u9762\u5404\u5c42\u7684\u6570\u636e\u6765\u6e90\u53ca\u53bb\u5411\u90a3\u4e48\u56fa\u5b9a\uff0c\u6240\u4ee5ADS\u5c42\u7684\u6570\u636e\u88c5\u8f7d\u4e0d\u533a\u5206\u9996\u65e5\u548c\u6bcf\u65e5\uff08\u540e\u8005\u8bf4\u89c6\u5177\u4f53\u7684\u7edf\u8ba1\u9700\u6c42\u800c\u5b9a\uff09\u3002 \u7531\u4e8eADS\u5c42\u6570\u636e\u91cf\u6bd4\u8f83\u5c0f\uff0c\u6240\u4ee5ADS\u5c42\u7684\u8868\u6ca1\u6709\u91c7\u7528parquet\u5217\u5f0f\u5b58\u50a8\u548clzo\u538b\u7f29\uff0c\u5982\u4e0b\u7528\u4e8e\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790\u7684\u8868\uff0c\u8868\u4e2d\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u5728\u67d0\u4e00\u5929\u7edf\u8ba1\u7684\u6700\u8fd11\u65e5\uff08\u6216\u8005\u6700\u8fd17\u65e5\u3001\u6216\u8005\u6700\u8fd130\u65e5\uff09\u7684\u805a\u5408\u503c\u3002\uff08DWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u7684\u4e00\u884c\u8868\u793a\u7684\u662f\u4e00\u4e2a\u7528\u6237\u7684\u7d2f\u79ef\u805a\u5408\u503c\uff0c\u800cADS\u5c42\u8ba1\u7b97\u7684\u662f\u6240\u6709\u7528\u6237\u7684\u7edf\u8ba1\u503c\uff0c\u6bd4\u5982DWT\u5c42\u7684\u7528\u6237\u4e3b\u9898\u8868\u7684\u4e00\u884c\u8868\u793a\u4e00\u4e2a\u7528\u6237\u6709\u6ca1\u6709\u5728\u4eca\u65e5\u4e0b\u5355\uff0c\u5982\u679c\u622a\u6b62\u5230\u4eca\u65e5\u6709\u4e00\u4ebf\u4e2a\u7528\u6237\uff0c\u90a3\u4e48DWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u5c31\u6709\u4e00\u4ebf\u6761\u6570\u636e\uff0c\u800cADS\u5c42\u5219\u662f\u901a\u8fc7DWT\u5c42\u6570\u636e\u8ba1\u7b97\u51fa\u4eca\u65e5\u7528\u6237\u4e0b\u5355\u6570\uff0c\u6240\u4ee5ADS\u5c42\u4eca\u65e5\u7684\u7edf\u8ba1\u6570\u636e\u53ea\u4f1a\u6709\u4e00\u884c\uff09\u3002 \u4eceADS\u5c42\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790\u7684\u8868\u7ed3\u6784\u53ef\u4ee5\u770b\u5230\uff0c\u4e0eDWT\u5c42\u4e00\u6837\uff0c\u6211\u4eec\u9700\u8981\u7edf\u8ba1\u6700\u8fd11\u5929\u3001\u6700\u8fd17\u5929\u3001\u6700\u8fd130\u5929\u7684\u5404\u79cd\u805a\u5408\u503c\uff0c\u4f46\u662fDWT\u5c42\u662f\u628a\u6bcf\u4e2a\u7edf\u8ba1\u6307\u6807\u90fd\u4f5c\u4e3a\u4e86\u4e00\u5217\uff0c\u800cADS\u5c42\u4f7f\u7528recent_days\u5b57\u6bb5\u6807\u8bc6\u8be5\u884c\u6570\u636e\u7edf\u8ba1\u7684\u662f\u54ea\u4e00\u79cd\u6307\u6807\uff0c\u5dee\u522b\u5c31\u662fDWT\u5c42\u4ee5\u6a2a\u5411\u6269\u5c55\u589e\u52a0\u5217\u7684\u65b9\u5f0f\u4fdd\u5b58\u6570\u636e\uff0c\u800cADS\u5c42\u4ee5\u7eb5\u5411\u6269\u5c55\u589e\u52a0\u884c\u7684\u65b9\u5f0f\u4fdd\u5b58\u6570\u636e\u3002 Text Only<pre><code>CREATE EXTERNAL TABLE `ads_user_action` (\n\u00a0\u00a0`dt` STRING COMMENT '\u7edf\u8ba1\u65e5\u671f',\n\u00a0\u00a0`recent_days` BIGINT COMMENT '\u6700\u8fd1\u5929\u6570,1:\u6700\u8fd11\u5929,7:\u6700\u8fd17\u5929,30:\u6700\u8fd130\u5929',\n\u00a0\u00a0`home_count` BIGINT COMMENT '\u6d4f\u89c8\u9996\u9875\u4eba\u6570',\n\u00a0\u00a0`good_detail_count` BIGINT COMMENT '\u6d4f\u89c8\u5546\u54c1\u8be6\u60c5\u9875\u4eba\u6570',\n\u00a0\u00a0`cart_count` BIGINT COMMENT '\u52a0\u5165\u8d2d\u7269\u8f66\u4eba\u6570',\n\u00a0\u00a0`order_count` BIGINT COMMENT '\u4e0b\u5355\u4eba\u6570',\n\u00a0\u00a0`payment_count` BIGINT COMMENT '\u652f\u4ed8\u4eba\u6570'\n) COMMENT '\u6f0f\u6597\u5206\u6790'\nROW FORMAT DELIMITED\u00a0\u00a0FIELDS TERMINATED BY '\\t'\nLOCATION '/warehouse/gmall/ads/ads_user_action/';\n</code></pre> \u6f0f\u6597\u5206\u6790\u662f\u4e00\u4e2a\u6570\u636e\u5206\u6790\u6a21\u578b\uff0c\u5b83\u80fd\u591f\u79d1\u5b66\u53cd\u6620\u4e00\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u4ece\u8d77\u70b9\u5230\u7ec8\u70b9\u5404\u9636\u6bb5\u7528\u6237\u8f6c\u5316\u60c5\u51b5\u3002\u7531\u4e8e\u5176\u80fd\u5c06\u5404\u9636\u6bb5\u73af\u8282\u90fd\u5c55\u793a\u51fa\u6765\uff0c\u6545\u54ea\u4e2a\u9636\u6bb5\u5b58\u5728\u95ee\u9898\uff0c\u5c31\u80fd\u4e00\u76ee\u4e86\u7136\u3002 </p> <p>\u5199ADS\u5c42\u8868\u88c5\u8f7d\u6570\u636esql\u7684\u4e00\u4e2a\u6280\u5de7\u662f\uff0c\u5148\u4e0d\u7ba1\u6240\u6709\u7ef4\u5ea6\u5b57\u6bb5\uff08\u6bd4\u5982recent_days\u7b49\uff09\uff0c\u76f4\u63a5\u8ba1\u7b97\u51fa\u6570\u636e\u7684\u5404\u9879\u805a\u5408\u503c\u540e\uff0c\u7136\u540e\u518d\u8003\u8651\u7ef4\u5ea6\u5b57\u6bb5\uff0c\u52a0\u4e0a\u7ef4\u5ea6\u5b57\u6bb5\u5c31\u76f8\u5f53\u4e8e\u5bf9\u6570\u636e\u6309\u8be5\u7ef4\u5ea6\u5206\u7ec4\u805a\u5408\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u6309\u8be5\u7ef4\u5ea6\u5b57\u6bb5group by\u3002</p> <p>\u6bd4\u5982\u7edf\u8ba1\u8fd9\u4fe9\u5b57\u6bb5\uff0c\u56e0\u4e3a\u6ca1\u6709DWT\u5c42\u6ca1\u6709\u5173\u4e8e\u9875\u9762\u7684\u4e3b\u9898\uff0c\u6240\u4ee5\u7edf\u8ba1\u9875\u9762\u6d4f\u89c8\u6b21\u6570\u5f97\u7528DWD\u5c42\u9875\u9762\u65e5\u5fd7\u8868 Text Only<pre><code>`home_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6d4f\u89c8\u9996\u9875\u4eba\u6570',\n`good_detail_count` BIGINT COMMENT '\u6d4f\u89c8\u5546\u54c1\u8be6\u60c5\u9875\u4eba\u6570',\n</code></pre> \u9996\u5148\u4e0d\u8003\u8651\u6700\u8fd1\u5929\u6570\u8fd9\u4e2a\u7ef4\u5ea6\uff0c\u76f4\u63a5\u5199\u51fa\u7edf\u8ba1\u5f53\u65e5\u5168\u91cf\u6570\u636e\u7684sql\uff1a Text Only<pre><code>select sum(if(array_contains(page_detail, 'home'), 1, 0))\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0home_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(array_contains(page_detail, 'good_detail'), 1, 0)) good_detail_count\nfrom (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select collect_set(page_id) page_detail\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwd_page_log\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = '2020-06-14'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and page_id in ('home', 'good_detail')\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by mid_id\n\u00a0\u00a0\u00a0\u00a0\u00a0);\n</code></pre> \u7136\u540e\u8003\u8651\u6700\u8fd11\u30017\u300130\u65e5\uff0c\u53ef\u4ee5\u76f4\u63a5\u5c06\u4e0a\u9762\u7684sql\u590d\u52363\u4efd\uff0c\u7136\u540e\u5728where\u91cc\u9762\u9650\u5236\u4e0d\u540c\u7684\u65f6\u95f4\u8303\u56f4\uff0c\u4f46\u662f\u8fd9\u8981\u67e5\u8fd9\u5f20\u88683\u6b21\u3002\u8fd8\u6709\u4e00\u79cd\u505a\u6cd5\u662f\u4f7f\u7528explode\u5c06\u6570\u636e\u6269\u5c55\u62103\u4efd\uff0c\u7136\u540e\u6309\u6700\u8fd11\u30017\u300130\u65e5\u5206\u7ec4\u7edf\u8ba1\u3002 Text Only<pre><code>select '2020-06-14',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(array_contains(page_detail, 'home'), 1, 0))\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0home_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(array_contains(page_detail, 'good_detail'), 1, 0)) good_detail_count\nfrom (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0collect_set(page_id) page_detail\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select mid_id, page_id, dt\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwd_page_log\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`-- 1.\u5148\u628a30\u5929\u7684\u6570\u636e\u8fc7\u6ee4\u51fa\u6765\uff0c\u4e0d\u7136\u4f1a\u626b\u63cf\u6240\u6709\u5206\u533a\u7684\u6570\u636e`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt &gt;= date_add('2020-06-14', -29)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and page_id in ('home', 'good_detail')\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`-- 2.\u7136\u540e\u4f7f\u7528lateral view explode\u628a\u6570\u636e\u6269\u62103\u500d`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0) t1 lateral view explode(array(1, 7, 30)) tmp as recent_days\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`-- 3.\u8fc7\u6ee4\u6389\u65f6\u95f4\u4e0e\u7edf\u8ba1\u5f53\u65e5\u76f8\u5dee\u7684\u5929\u6570\u4e0d\u7b26\u5408recent_days\u8981\u6c42\u7684\u6570\u636e`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt &gt;= date_add('2020-06-14', -recent_days + 1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0`-- \u6700\u540e\u6309recent_days\u5206\u7ec4\u5c31\u53ef\u4ee5\u5bf93\u4efd\u6570\u636e\u5206\u5f00\u8ba1\u7b97\u4e86`\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by recent_days, mid_id\n\u00a0\u00a0\u00a0\u00a0\u00a0) t2\n\u00a0\u00a0\u00a0\u00a0\u00a0-- \u52a0\u4e0a\u6309recent_days\u5206\u7ec4\ngroup by recent_days;\n</code></pre> 1.\u5148\u628a30\u5929\u7684\u6570\u636e\u8fc7\u6ee4\u51fa\u6765\uff0c\u4e0d\u7136\u4f1a\u626b\u63cf\u6240\u6709\u5206\u533a\u7684\u6570\u636e  2.\u7136\u540e\u4f7f\u7528lateral view explode\u628a\u6570\u636e\u6269\u62103\u500d  3.\u8fc7\u6ee4\u6389\u65f6\u95f4\u4e0e\u7edf\u8ba1\u5f53\u65e5\u76f8\u5dee\u7684\u5929\u6570\u4e0d\u7b26\u5408recent_days\u8981\u6c42\u7684\u6570\u636e </p> <p>\u518d\u7edf\u8ba1\u8fd9\u4ee8\u5b57\u6bb5\uff0c\u56e0\u4e3aDWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u4e2d\u6709\u6bcf\u4e2a\u7528\u6237\u6700\u8fd11\u30017\u300130\u65e5\u7684\u52a0\u8d2d\u6b21\u6570\u3001\u4e0b\u5355\u6b21\u6570 \u548c \u652f\u4ed8\u6b21\u6570\uff0c\u6240\u4ee5\u4e0b\u9762\u5b57\u6bb5\u7684\u8ba1\u7b97\u53ef\u4ee5\u76f4\u63a5\u4eceDWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u53d6\u6570\u3002 Text Only<pre><code>`cart_count` BIGINT COMMENT '\u52a0\u5165\u8d2d\u7269\u8f66\u4eba\u6570',\n`order_count` BIGINT COMMENT '\u4e0b\u5355\u4eba\u6570',\n`payment_count` BIGINT COMMENT '\u652f\u4ed8\u4eba\u6570'\n</code></pre> \u9996\u5148\u4e0d\u8003\u8651\u6700\u8fd1\u5929\u6570\u8fd9\u4e2a\u7ef4\u5ea6\uff0c\u76f4\u63a5\u5199\u51fa\u7edf\u8ba1\u5168\u91cf\u6570\u636e\u7684sql\uff0c\u6bd4\u5982\u7edf\u8ba1\u6700\u8fd11\u65e5\u7684\u52a0\u8d2d\u6b21\u6570\u3001\u4e0b\u5355\u6b21\u6570 \u548c \u652f\u4ed8\u6b21\u6570 Text Only<pre><code>select sum(if(cart_last_1d_count &gt; 0, 1, 0))\u00a0\u00a0\u00a0\u00a0cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(order_last_1d_count &gt; 0, 1, 0))\u00a0\u00a0\u00a0order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(payment_last_1d_count &gt; 0, 1, 0)) payment_count\nfrom dwt_user_topic\nwhere dt='2020-06-14';\n</code></pre> \u53ef\u4ee5\u76f4\u63a5\u628a\u4e0a\u9762\u8fd9\u6761sql\u590d\u52363\u4efd\uff0c\u7136\u540e\u6539\u4e00\u4e0bselect\u540e\u9762\u7684\u5b57\u6bb5\uff0c\u7136\u540eunion\u8d77\u6765\uff0c\u4f46\u662f\u8fd9\u8981\u67e5\u8fd9\u5f20\u88683\u6b21\u3002\u8fd8\u6709\u4e00\u79cd\u4e0e\u4e0a\u9762\u7edf\u8ba1\u9875\u9762\u6d4f\u89c8\u6b21\u6570\u7c7b\u4f3c\u7684\u505a\u6cd5\uff0c\u5373\u4e5f\u662f\u4f7f\u7528explode\u5c06\u6570\u636e\u6269\u5c55\u62103\u4efd\uff0c\u7136\u540e\u6309\u6700\u8fd11\u30017\u300130\u65e5\u5206\u7ec4\u7edf\u8ba1\u3002\u8fd9\u79cd\u505a\u6cd5\u76f8\u5f53\u4e8e\u662f\u628aDWT\u5c42\u6a2a\u5411\u4ee5\u5217\u8bb0\u5f55\u7684\u6570\u636e\u8f6c\u53d8\u6210\u4e86\u7eb5\u5411\u4ee5\u884c\u8bb0\u5f55\uff0c\u7136\u540e\u9760recent_days\u5217\u7684\u503c\u533a\u5206\uff0c\u6240\u4ee5\u76f4\u63a5\u6309recent_days\u5206\u7ec4\u7edf\u8ba1\uff0c\u5373\u53ef\u5206\u522b\u7b97\u51fa\u6700\u8fd11\u30017\u300130\u65e5\u5206\u7ec4\u7edf\u8ba1\u503c\u3002 Text Only<pre><code>select '2020-06-14',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(cart_count &gt; 0, 1, 0))\u00a0\u00a0\u00a0\u00a0cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(order_count &gt; 0, 1, 0))\u00a0\u00a0\u00a0order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(payment_count &gt; 0, 1, 0)) payment_count\nfrom (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 1 then cart_last_1d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 7 then cart_last_7d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 30 then cart_last_30d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0end cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 1 then order_last_1d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 7 then order_last_7d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 30 then order_last_30d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0end order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 1 then payment_last_1d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 7 then payment_last_7d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 30 then payment_last_30d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0end payment_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwt_user_topic lateral view explode(array(1, 7, 30)) tmp as recent_days\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = '2020-06-14'\n\u00a0\u00a0\u00a0\u00a0\u00a0) t1\ngroup by recent_days;\n</code></pre></p> <p>\u603b\u7ed3\uff0c\u5982\u679c\u6570\u636e\u6765\u81ea\u4e8eDWD\u5c42\uff0c\u90a3\u4e48\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u6cd5\u5c06\u6570\u636e\u6269\u5f20\u62103\u500d\uff0c\u5982\u679c\u6570\u636e\u6765\u81ea\u4e8eDWT\u5c42\uff0c\u5219\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff08\u8fd9\u79cd\u65b9\u5f0f\u6700\u7ec8\u7684\u6548\u679c\u5b9e\u9645\u4e0a\u662f\u5c06\u6570\u636e\u7531\u6a2a\u5411\u53d8\u6210\u4e86\u7eb5\u5411\uff0c\u7136\u540e\u7531recent_days\u5b57\u6bb5\u533a\u5206\uff09\uff0c\u7136\u540e\u6309recent_days\u5206\u7ec4\u5206\u522b\u7edf\u8ba1\u51fa\u6700\u8fd11\u30017\u300130\u65e5\u7684\u7ed3\u679c\u3002</p> <p>\u6700\u540e\u628a\u4e0a\u9762\u7684\u7ed3\u679c\u6309 recent_days \u8fde\u63a5\u8d77\u6765\uff0c\u5c31\u53ef\u5f97\u5230 2020-06-14 \u8fd9\u4e00\u5929\u7684\u6700\u8fd11\u30017\u300130\u65e5\u7edf\u8ba1\u6570\u636e\u4e86\uff1a Text Only<pre><code>with tmp_page as (select recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(array_contains(page_detail, 'home'), 1, 0))\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0home_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(array_contains(page_detail, 'good_detail'), 1, 0)) good_detail_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0collect_set(page_id) page_detail\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- \u5148\u628a30\u5929\u7684\u6570\u636e\u8fc7\u6ee4\u51fa\u6765\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select mid_id, page_id, dt\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwd_page_log\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt &gt;= date_add('2020-06-14', -29)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and page_id in ('home', 'good_detail')\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- \u4f7f\u7528explode\u628a\u6570\u636e\u6269\u62103\u500d\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0) t1 lateral view explode(array(1, 7, 30)) tmp as recent_days\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- \u8fc7\u6ee4\u6389\u65f6\u95f4\u4e0e\u7edf\u8ba1\u5f53\u65e5\u76f8\u5dee\u7684\u5929\u6570\u4e0d\u7b26\u5408recent_days\u8981\u6c42\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt &gt;= date_add('2020-06-14', -recent_days + 1)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- \u52a0\u4e0a\u6309recent_days\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by recent_days, mid_id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0) t2\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- \u52a0\u4e0a\u6309recent_days\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by recent_days),\n\u00a0\u00a0\u00a0\u00a0\u00a0tmp_count as (select recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(cart_count &gt; 0, 1, 0))\u00a0\u00a0\u00a0\u00a0cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(order_count &gt; 0, 1, 0))\u00a0\u00a0\u00a0order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(payment_count &gt; 0, 1, 0)) payment_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 1 then cart_last_1d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 7 then cart_last_7d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 30 then cart_last_30d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0end cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 1 then order_last_1d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 7 then order_last_7d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 30 then order_last_30d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0end order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0case\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 1 then payment_last_1d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 7 then payment_last_7d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0when recent_days = 30 then payment_last_30d_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0end payment_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwt_user_topic lateral view explode(array(1, 7, 30)) tmp as recent_days\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = '2020-06-14'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0) t1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by recent_days)\ninsert\noverwrite\ntable\nads_user_action\nselect *\nfrom ads_user_action\nunion all\nselect '2020-06-14',\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tmp_page.recent_days,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0home_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0good_detail_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0payment_count\nfrom tmp_page\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0join\n\u00a0\u00a0\u00a0\u00a0\u00a0tmp_count\n\u00a0\u00a0\u00a0\u00a0\u00a0on tmp_page.recent_days = tmp_count.recent_days;\n</code></pre> \u56e0\u4e3aADS\u4e00\u5f20\u8868\u6bcf\u5929\u7684\u7edf\u8ba1\u7ed3\u679c\u53ea\u67093\u884c\u6570\u636e\uff0c\u5373\u7edf\u8ba1\u5f53\u65e5\u6700\u8fd11\u30017\u300130\u65e5\u7684\u7edf\u8ba1\u503c\uff0c\u6240\u4ee5\u6bcf\u5929\u7684\u65b0\u589e\u6570\u636e\u91cf\u5f88\u5c11\uff0c\u5982\u679c\u76f4\u63a5\u4f7f\u7528hive\u7684insert into\u7684\u8bdd\u5c31\u4f1a\u5355\u72ec\u751f\u6210\u4e00\u4e2a\u5c0f\u6587\u4ef6\uff0c\u6240\u4ee5\u8fd9\u91cc\u91c7\u7528\u4e86\u5148\u5c06\u539f\u6765\u7684\u6570\u636e\u67e5\u51fa\u6765\uff0c\u7136\u540e\u518d\u4e0e\u4eca\u5929\u7684\u7ed3\u679cunion\uff0c\u6700\u540e\u518dinsert overwrite\u4f1a\u539f\u8868\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u5c0f\u6587\u4ef6\u8fc7\u591a\u7684\u95ee\u9898\u4e86\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/11-azkaban/","title":"11-azkaban","text":"<p> \u7ea6 296 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 6 \u5206\u949f</p> <p>\u4f7f\u7528\u5de5\u4f5c\u6d41\u8c03\u5ea6\u5de5\u5177\u7684\u4e24\u6b65\uff1a</p> <ol> <li>\u63cf\u8ff0\u5de5\u4f5c\u6d41\u7a0b</li> <li>\u8bbe\u7f6e\u5b9a\u65f6</li> </ol> <p>\u533a\u5206\u4e24\u4e2a\u6982\u5ff5\uff1ajob \u548c flow\uff0c\u5173\u7cfb\u662f\u7531job\u7ec4\u6210flow\u3002</p> <p>\u63cf\u8ff0\u5de5\u4f5c\u6d41\u7a0b\u7684\u6b65\u9aa4\uff1a 1. \u65b0\u5efa\u00a0azkaban.project \u6587\u4ef6\uff0c \u7f16\u8f91\u5185\u5bb9\u5982\u4e0b\uff1a Text Only<pre><code>azkaban-flow-version: 2.0\n</code></pre> \u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u544a\u8bc9azkaban\u4f7f\u7528yaml\u7684\u8bed\u6cd5\u89e3\u6790 .flow \u6587\u4ef6\uff0c\u5982\u679c\u662f1.0\uff0c\u90a3\u4e48\u4f1a\u4f7f\u7528properties\u7684\u683c\u5f0f\u89e3\u6790 .flow \u6587\u4ef6\u3002 2. \u65b0\u5efa\u00a0gmall.flow \u6587\u4ef6\uff0c\u63cf\u8ff0\u5de5\u4f5c\u6d41\u7a0b\uff1a  Text Only<pre><code>nodes:\n\u00a0\u00a0- name: mysql_to_hdfs\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/mysql_to_hdfs.sh all ${dt}\n\n\u00a0\u00a0- name: hdfs_to_ods_log\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/hdfs_to_ods_log.sh ${dt}\n\n\u00a0\u00a0- name: hdfs_to_ods_db\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- mysql_to_hdfs\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/hdfs_to_ods_db.sh all ${dt}\n\n\u00a0\u00a0- name: ods_to_dim_db\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- hdfs_to_ods_db\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/ods_to_dim_db.sh all ${dt}\n\n\u00a0\u00a0- name: ods_to_dwd_log\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- hdfs_to_ods_log\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/ods_to_dwd_log.sh all ${dt}\n\n\u00a0\u00a0- name: ods_to_dwd_db\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- hdfs_to_ods_db\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/ods_to_dwd_db.sh all ${dt}\n\n\u00a0\u00a0- name: dwd_to_dws\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- ods_to_dim_db\n\u00a0\u00a0\u00a0\u00a0\u00a0- ods_to_dwd_log\n\u00a0\u00a0\u00a0\u00a0\u00a0- ods_to_dwd_db\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/dwd_to_dws.sh all ${dt}\n\n\u00a0\u00a0- name: dws_to_dwt\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- dwd_to_dws\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/dws_to_dwt.sh all ${dt}\n\n\u00a0\u00a0- name: dwt_to_ads\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- dws_to_dwt\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/dwt_to_ads.sh all ${dt}\n\n\u00a0\u00a0- name: hdfs_to_mysql\n\u00a0\u00a0\u00a0\u00a0type: command\n\u00a0\u00a0\u00a0\u00a0dependsOn:\n\u00a0\u00a0\u00a0\u00a0\u00a0- dwt_to_ads\n\u00a0\u00a0\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0command: /home/jmoon/bin/hdfs_to_mysql.sh all\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/12-YAML/","title":"12-YAML","text":"<p> \u7ea6 515 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 10 \u5206\u949f</p> <p>YAML \u57fa\u672c\u8bed\u6cd5\u89c4\u5219\uff1a</p> <ul> <li>\u5927\u5c0f\u5199\u654f\u611f</li> <li>\u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb</li> <li>\u7f29\u8fdb\u65f6\u4e0d\u5141\u8bb8\u4f7f\u7528Tab\u952e\uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u7a7a\u683c\u3002</li> <li>\u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u76ee\u4e0d\u91cd\u8981\uff0c\u53ea\u8981\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u4fa7\u5bf9\u9f50\u5373\u53ef</li> <li># \u8868\u793a\u6ce8\u91ca</li> </ul> <p>YAML \u652f\u6301\u4e09\u79cd\u6570\u636e\u7ed3\u6784\uff1a</p> <ul> <li>\u5bf9\u8c61\uff1a\u952e\u503c\u5bf9\u7684\u96c6\u5408\uff0c\u53c8\u79f0\u4e3a\u6620\u5c04\uff08mapping\uff09/ \u54c8\u5e0c\uff08hashes\uff09 / \u5b57\u5178\uff08dictionary\uff09</li> <li>\u6570\u7ec4\uff1a\u4e00\u7ec4\u6309\u6b21\u5e8f\u6392\u5217\u7684\u503c\uff0c\u53c8\u79f0\u4e3a\u5e8f\u5217\uff08sequence\uff09 / \u5217\u8868\uff08list\uff09</li> <li>\u7eaf\u91cf\uff08scalars\uff09\uff1a\u5355\u4e2a\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u503c</li> </ul> <p>\u4efb\u4f55\u7f16\u7a0b\u8bed\u8a00\u6240\u80fd\u8868\u8fbe\u7684\u6570\u636e\u7ed3\u6784\u7684\u6700\u57fa\u672c\u7684\u5f62\u5f0f\u90fd\u65e0\u5916\u4e4e\u4e0a\u9762\u4e09\u79cd\uff0c\u590d\u6742\u6570\u636e\u7ed3\u6784\u5c31\u662f\u5bf9\u8fd9\u4e09\u79cd\u57fa\u672c\u5f62\u5f0f\u7684\u5d4c\u5957\uff0c\u53ea\u662f\u5404\u5bb6\u7f16\u7a0b\u8bed\u8a00\u5728\u5b9a\u4e49\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u65f6\u7684\u8bed\u6cd5\u4e0d\u540c\u800c\u5df2\u3002 yaml\u548cjson\u4e0d\u662f\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u4eec\u7684\u8bed\u6cd5\u89c4\u5b9a\u7684\u662f\u5982\u4f55\u5728\u6587\u672c\u6587\u4ef6\u4e2d\u8868\u793a\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e0e\u7f16\u7a0b\u8bed\u8a00\u4e2d\u5b9a\u4e49\u7684\u6570\u636e\u7ed3\u6784\u662f\u4e0d\u540c\u7684\uff0c\u5728\u7f16\u7a0b\u8bed\u8a00\u4e2d\u5b9a\u4e49\u7684\u6570\u636e\u7ed3\u6784\u4e00\u79cd\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u7684\u52a8\u6001\u7684\u80fd\u76f4\u63a5\u88ab\u8ba1\u7b97\u673a\uff08\u6216\u8005\u662f\u9ad8\u7ea7\u8bed\u8a00\u7684\u89e3\u91ca\u5668\uff09\u6240\u8bc6\u522b\u548c\u8ba1\u7b97\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6570\u5b57100\u5728\u5185\u5b58\u4e2d\u548c\u5728\u6587\u672c\u6587\u4ef6\u4e2d\u662f\u4e0d\u540c\u7684\uff0c\u800cyaml\u6587\u4ef6\u548cjson\u6587\u4ef6\u8868\u793a\u6570\u636e\u7684\u683c\u5f0f\u76f8\u5f53\u4e8e\u662f\u628a\u7f16\u7a0b\u8bed\u8a00\u5728\u5185\u5b58\u4e2d\u5b9a\u4e49\u7684\u6570\u636e\u7ed3\u6784\u5e8f\u5217\u5316\u5230\u6587\u672c\u6587\u4ef6\u7684\u5f62\u5f0f\u3002 \u548cjson\u6587\u4ef6\u4e00\u6837\uff0c\u4e00\u4e2ayaml\u6587\u4ef6\u7684\u5185\u5bb9\u5728\u6574\u4f53\u4e0a\u53ea\u80fd\u662f\u4e00\u4e2a\u6570\u636e\uff0c\u5373\u6574\u4f53\u4e0a\u4e5f\u5c31\u662f\u6700\u5916\u5c42\u5fc5\u987b\u662f\u4e00\u4e2a \u5bf9\u8c61 \u6216\u8005 \u6570\u7ec4 \u6216\u8005 \u7eaf\u91cf\u3002 \u7eaf\u91cf\u5c31\u662fJava\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u52a0\u4e0a\u5b57\u7b26\u4e32\uff0c\u6bd4\u5982\u5b57\u7b26\u4e32'abc'\u5728yaml\u6587\u4ef6\u4e2d\u8fd9\u6837\u8868\u793a\uff1a Text Only<pre><code>'abc'\n</code></pre> \u5bf9\u8c61\u5c31\u662fJava\u4e2d\u7c7b\u7684\u5bf9\u8c61\uff0c\u5728yaml\u6587\u4ef6\u4e2d\u8fd9\u6837\u8868\u793a\uff1a Text Only<pre><code>name: zhangsan\nage: 20\nsex: '\u7537'\n</code></pre> \u6570\u7ec4\u5c31\u662fJava\u4e2d\u6570\u7ec4\uff0c\u5728yaml\u6587\u4ef6\u4e2d\u8fd9\u6837\u8868\u793a\uff1a Text Only<pre><code>- name: zhangsan\n\u00a0\u00a0age: 20\n\u00a0\u00a0sex: '\u7537'\n- name: lisi\n\u00a0\u00a0age: 21\n\u00a0\u00a0sex: '\u7537'\n- name: wangwu\n\u00a0\u00a0age: 22\n\u00a0\u00a0sex: '\u7537'\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/13-%E6%95%B0%E4%BB%93%E5%85%B6%E5%AE%83/","title":"13-\u6570\u4ed3\u5176\u5b83","text":"<p> \u7ea6 1325 \u4e2a\u5b57  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 26 \u5206\u949f</p> <p>\u53ef\u89c6\u5316\u62a5\u8868 Apache Superset\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u8f7b\u91cf\u7ea7BI\uff08Business Intelligence\uff09\u5206\u6790\u5de5\u5177\uff0c\u80fd\u591f\u5bf9\u63a5\u591a\u79cd\u6570\u636e\u6e90\uff0c\u4ee5\u4e30\u5bcc\u7684\u56fe\u8868\u5c55\u793a\u6570\u636e\u3002 \u672c\u9879\u76ee\u7684Superset\u5bf9\u63a5\u7684\u662fMySQL\uff0c\u6240\u4ee5\u9700\u8981\u5c06ADS\u5c42\u6570\u636e\u5bfc\u5165\u5230MySQL\u4e2d\u65f6\uff0c\u7531\u4e8esqoop\u53ea\u652f\u6301\u5c06HDFS\u7684\u6587\u4ef6\u5bfc\u51fa\uff0c\u65e0\u6cd5\u505a\u5230\u4eceHive\u4e2d\u67e5\u8be2\u6570\u636e\u5bfc\u51fa\uff0c\u6240\u4ee5\u4f7f\u7528sqoop\u6bcf\u6b21\u5bfc\u51fa\u7684\u90fd\u662fADS\u5c42\u4e00\u6574\u5f20\u8868\u7684\u6570\u636e\uff08\u56e0\u4e3aADS\u5c42\u7684\u6570\u636e\u6ca1\u6709\u5206\u533a\uff0c\u5e76\u4e14\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff09\uff0c\u4e8e\u662f\u5728MySQL\u4e2d\u5efa\u8868\u65f6\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a 1.MySQL\u8868\u7684\u5217\u8981\u4e0eADS\u5c42\u8868\u7684\u5217\u4fdd\u6301\u4e00\u81f4\uff0c\u5373\u6570\u636e\u7c7b\u578b\u8981\u5bf9\u5e94\u4e0a\uff0c\u5217\u7684\u4e2a\u6570\u548c\u987a\u5e8f\u4e5f\u8981\u4e00\u6837\u3002 2.MySQL\u4e2d\u7684\u8868\u9700\u8981\u6709\u4e3b\u952e\uff0c\u56e0\u4e3a\u6bcf\u6b21\u90fd\u662f\u5bfc\u4e00\u6574\u5f20\u8868\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4e3a\u4e86\u9632\u6b62\u91cd\u590d\u63d2\u5165\u6570\u636e\uff0c\u5f97\u6709\u4e3b\u952e\uff0c\u8fd9\u4e2a\u4e3b\u952e\u5c31\u662f\u7edf\u8ba1ADS\u5c42\u6570\u636e\u65f6\u7684group by\u5b57\u6bb5\u3002\u8fd8\u8981\u6ce8\u610f\u4e00\u4e2a\u95ee\u9898\uff0cMySQL\u590d\u5408\u4e3b\u952e\u4e2d\u4e0d\u80fd\u6709null\u503c\uff0c\u6240\u4ee5\u5982\u679cgroup by\u5b57\u6bb5\u6709\u53ef\u80fd\u4e3anull\uff0c\u90a3\u5c31\u4e0d\u80fd\u5c06\u5176\u5b9a\u4e49\u4e3a\u4e3b\u952e\uff0c\u800c\u5e94\u8be5\u5b9a\u4e49\u4e3a\u552f\u4e00\u952e\uff0c\u552f\u4e00\u952e\u5141\u8bb8\u6709null\u503c\u3002\uff08\u4e5f\u53ef\u4ee5\u6b65\u8fd9\u4e48\u9ebb\u70e6\uff0c\u6bcf\u6b21\u5199\u5230MySQL\u524d\u5148truncate\u8868\u5c31\u884c\u4e86\uff09 sqoop\u5bfc\u51fa\u65f6\u9700\u8981\u52a0\u4e0a\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u4e0d\u4f7f\u7528\u8fd9\u4fe9\u53c2\u6570\uff0csqoop\u5bfc\u51fa\u65f6\u4f7f\u7528\u7684insert\uff0c\u5982\u679c\u552f\u4e00\u952e\u6709\u91cd\u590d\u4f1a\u62a5\u9519\uff0c\u5982\u679c\u4f7f\u7528\u8fd9\u4fe9\u4e24\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u4f1a\u4f7f\u7528\u66f4\u65b0\u6a21\u5f0f\u3002--update-key\u6307\u660e\u8868\u7684\u552f\u4e00\u952e\uff0c--update-mode\u8868\u793a\u66f4\u65b0\u6a21\u5f0f\uff0callowinsert\u8868\u793a\u5982\u679c\u66f4\u65b0\u6570\u636e\u7684\u552f\u4e00\u952e\u5b58\u5728\uff0c\u90a3\u4e48\u76f4\u63a5\u66f4\u65b0\uff0c\u5982\u679c\u66f4\u65b0\u6570\u636e\u7684\u552f\u4e00\u952e\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u76f4\u63a5\u5c06\u8fd9\u6761\u6570\u636e\u63d2\u5165\uff0c\u4f7f\u7528\u7684\u662fMySQL\u7684upsert\u5b9e\u73b0\u7684\u529f\u80fd\uff08INSERT INTO \u2026 ON DUPLICATE KEY UPDATE\uff09\uff0c--update-mode\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u53d6\u503cupdateonly\uff0c\u8868\u793a\u5982\u679c\u91cd\u590d\u5c31\u66f4\u65b0\uff0c\u5982\u679c\u6ca1\u6709\u91cd\u590d\u5c31\u4e0d\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u4f7f\u7528\u7684\u662fMySQL\u7684update\u5b9e\u73b0\u7684\u529f\u80fd\u3002 Text Only<pre><code>--update-key $2 \\\n--update-mode allowinsert \\\n</code></pre></p> <p>\u5373\u5e2d\u67e5\u8be2 Apache Kylin\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u5206\u6790\u5f15\u64ce\uff0c\u63d0\u4f9bHadoop/Spark\u4e4b\u4e0a\u7684SQL\u67e5\u8be2\u63a5\u53e3\uff0c\u5177\u6709\u8d85\u5927\u89c4\u6a21\u6570\u636eOLAP\u7684\u80fd\u529b\uff0c\u80fd\u5728\u4e9a\u79d2\u5185\u67e5\u8be2\u5de8\u5927\u7684Hive\u8868\u3002</p> <p>OLTP\u4e0eOLAP\uff1a OLTP\uff08on-line transaction processing\uff0c\u8054\u673a\u4e8b\u52a1\u5904\u7406\uff09\u662f\u6570\u636e\u5e93\u7684\u5e94\u7528\uff0c\u9488\u5bf9\u7684\u662f\u4e1a\u52a1\u7cfb\u7edf\u7684\u589e\u5220\u6539\u67e5\uff0c\u5f3a\u8c03\u7684\u662f\u5b9e\u65f6\u5730\u4e8b\u52a1\u5904\u7406\u3002 OLAP\uff08On-Line Analytical Processing\uff0c\u8054\u673a\u5206\u6790\u5904\u7406\uff09\u9488\u5bf9\u7684\u662f\u6570\u636e\u7684\u7edf\u8ba1\u67e5\u8be2\uff0c\u5373\u5bf9\u6570\u636e\u8fdb\u884c\u5b9e\u65f6\u5730\u7edf\u8ba1\u5e76\u83b7\u53d6\u7ed3\u679c\uff0c\u4ee5\u4fbf\u80fd\u53ca\u65f6\u5730\u5206\u6790\u5e76\u83b7\u53d6\u6709\u4ef7\u503c\u7684\u4fe1\u606f\uff0cOLAP\u7684\u6570\u636e\u6e90\u53ef\u4ee5\u6570\u636e\u4ed3\u5e93\u7684\u6d77\u91cf\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u662f\u4f20\u7edf\u5173\u7cfb\u6570\u636e\u5e93\u7684\u6570\u636e\u3002  OLAP\u7684\u6570\u636e\u6765\u6e90\u662f\u7531OLTP\u4ea7\u751f\u7684\uff0c\u6240\u4ee5OLAP\u4f9d\u8d56\u4e8eOLTP\uff0cOLAP\u53ef\u4ee5\u770b\u4f5c\u662fOLTP\u7684\u4e00\u79cd\u5ef6\u5c55\uff0c\u4e00\u4e2a\u53d1\u73b0OLTP\u4ea7\u751f\u6570\u636e\u7684\u4ef7\u503c\u7684\u8fc7\u7a0b\u3002</p> <p>OLAP\u7684\u5206\u7c7b\uff1aROLAP\uff08Relational OLAP\uff0c\u5173\u7cfb\u578b\u8054\u673a\u5206\u6790\u5904\u7406\uff09 \u548c MOLAP\uff08Multi-dimensional OLAP\uff0c\u591a\u7ef4\u8054\u673a\u5206\u6790\u5904\u7406\uff09\u3002 ROLAP \u57fa\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4e0d\u9700\u8981\u9884\u8ba1\u7b97\uff0c\u4ee3\u8868\u4ea7\u54c1\u6709\uff1aImpala\u3001ClickHouse\u3002 MOLAP \u57fa\u4e8e\u591a\u7ef4\u6570\u636e\u96c6\uff0c\u9700\u8981\u9884\u8ba1\u7b97\uff0c\u4ee3\u8868\u4ea7\u54c1\u6709\uff1aKylin\u3002</p> <p>\u591a\u7ef4\u5206\u6790\u7684\u4e24\u4e2a\u91cd\u8981\u6982\u5ff5\uff1a\u7ef4\u5ea6\uff08Dimension\uff09 \u548c \u5ea6\u91cf\uff08Measure\uff09  \u7ef4\u5ea6 \u548c \u5ea6\u91cf \u4e5f\u6b63\u662f\u7ef4\u5ea6\u6a21\u578b\u4e2d\u7684\u4e24\u4e2a\u6982\u5ff5\uff0c\u7ef4\u5ea6\u5c31\u662f\u7ef4\u5ea6\u8868\u7684\u5b57\u6bb5\uff0c\u5ea6\u91cf\u5c31\u662f\u4e8b\u5b9e\u8868\u4e2d\u5ea6\u91cf\u503c\uff0c\u5f53\u7136\u4e8b\u5b9e\u8868\u4e2d\u4e5f\u6709\u7ef4\u5ea6\u9000\u5316\u540e\u7684\u7ef4\u5ea6\u3002Kylin\u5bf9\u63a5\u7684\u6b63\u662f\u7ef4\u5ea6\u6a21\u578b\uff0c\u53ef\u4ee5\u662f\u661f\u578b\u6a21\u578b\uff0c\u4e5f\u53ef\u4ee5\u662f\u96ea\u82b1\u6a21\u578b\u3002  \u5bf9\u6570\u636e\u8fdb\u884c\u5206\u6790\u5176\u5b9e\u5c31\u662f\u4ece\u4e0d\u540c\u7ef4\u5ea6\u53bb\u89c2\u5bdf\u5ea6\u91cf\u503c\u7684\u53d8\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u9700\u8981\u4ee5\u4e0d\u540c\u7684\u7ef4\u5ea6\u5bf9\u5ea6\u91cf\u503c\u8fdb\u884c\u805a\u5408\u3002\u4e0a\u9762\u90a3\u5f20\u8868\u53ef\u4ee5\u4ece7\uff082^3-1\uff09\u4e2a\u7ef4\u5ea6\u53bb\u89c2\u5bdf\u5ea6\u91cf\u7684\u53d8\u5316\uff0c\u4e5f\u5c31\u8bf4\u89c2\u5bdf\u5ea6\u91cf\u503c\u53d8\u5316\u7684\u89d2\u5ea6\u662f\u53ef\u4ee5\u7a77\u4e3e\u51fa\u6765\u7684\uff0c\u90a3\u4e48\u53ea\u8981\u63d0\u524d\u8ba1\u7b97\u51fa\u6240\u6709\u89d2\u5ea6\u7684\u805a\u5408\u503c\uff0c\u5c31\u80fd\u505a\u5230\u7528\u6237\u5bf9\u6d77\u91cf\u6570\u636e\u7edf\u8ba1\u67e5\u8be2\u7684\u79d2\u7ea7\u54cd\u5e94\u4e86\uff0cKylin\u5c31\u662f\u8fd9\u4e48\u505a\u7684\u3002 </p> <p>Cuboid \u4e00\u4e2a\u89d2\u5ea6\u5f97\u5230\u7684\u6240\u6709\u805a\u5408\u503c\u5c31\u662f\u4e00\u4e2aCuboid\uff0c\u5982\u4e0b\u5c55\u793a\u4e863\u4e2aCuboid\uff0cCuboid\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5c0f\u65b9\u5757\u5c31\u662f\u901a\u8fc7\u5177\u4f53\u7684\u7ef4\u5ea6\u503c\u5206\u7ec4\u805a\u5408\u5f97\u5230\u503c\uff0c\u6bd4\u59823\u7ef4Cuboid\u4e2d\u53f3\u4e0a\u89d2\u90a3\u4e2a\u5c0f\u65b9\u5757\u8868\u793a\u4e1c\u5317\u5730\u533a\u5c45\u5bb6\u54c1\u7c7b2\u6708\u4efd\u7684\u9500\u552e\u603b\u989d\u3002\u6240\u6709Cuboid\u7ec4\u6210\u4e00\u4e2aCube\u3002Kylin\u5728\u8ba1\u7b97\u65f6\u662f\u5148\u8ba1\u7b97\u6700\u9ad8\u7ef4\u7684Cuboid\uff0c\u7136\u540e\u518d\u5bf9\u9ad8\u7ef4Cuboid\u964d\u7ef4\u805a\u5408\u5c31\u53ef\u4f4e\u7ef4Cuboid\u4e86\u3002 </p> <p>\u4f7f\u7528Kylin\u7684\u6b65\u9aa4\u5c31\u662f\u5148\u9009\u62e9\u4e00\u5927\u63a8\u8868\uff0c\u7136\u540e\u9009\u62e9\u8fd9\u4e9b\u8868\u7684join\u7c7b\u578b\u548cjoin\u5b57\u6bb5\uff0c\u63a5\u7740\u786e\u5b9a\u54ea\u4e9b\u5b57\u6bb5\u662f\u7ef4\u5ea6\uff0c\u54ea\u4e9b\u5b57\u6bb5\u662f\u5ea6\u91cf\uff0c\u6700\u540e\u9009\u62e9\u5ea6\u91cf\u503c\u7684\u805a\u5408\u51fd\u6570\u3002Kylin\u4f1a\u628a\u4f60\u9009\u62e9\u7684\u8868\u5148\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u7136\u540e\u7528\u7ef4\u5ea6\u5b57\u6bb5\u5206\u7ec4\uff0c\u5bf9\u5ea6\u91cf\u5b57\u6bb5\u805a\u5408\uff0c\u6700\u540e\u628a\u7ed3\u679c\u4fdd\u5b58\u5728cube\u4e2d\uff08cube\u4fdd\u5b58\u5728HBase\u4e2d\uff09\u3002\u6240\u4ee5\u4f7f\u7528Kylin\u6700\u91cd\u8981\u7684\u662f\u533a\u5206\u7ef4\u5ea6\u548c\u5ea6\u91cf\uff0c\u5efa\u6a21\u7684\u65b9\u5f0f\u5176\u5b9e\u5e76\u4e0d\u90a3\u4e48\u91cd\u8981\uff0c\u5efa\u6a21\u7684\u65b9\u6cd5\u53ea\u662f\u65b9\u6cd5\u8bba\uff0c\u6700\u540e\u843d\u5b9e\u7684\u8fd8\u662f\u8868\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/2-%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E9%80%9A%E9%81%93/","title":"2-\u6570\u636e\u91c7\u96c6\u901a\u9053","text":"<p> \u7ea6 1201 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 24 \u5206\u949f</p> <p>\u6570\u636e\u91c7\u96c6\u901a\u9053  \u65e5\u5fd7\u6570\u636e\u91c7\u7528Flume+Kafka+Flume\u7684\u65b9\u5f0f\u4e0a\u4f20\u5230HDFS\u4e0a\u3002 \u7b2c\u4e00\u5c42Flume\u90e8\u7f72\u5728\u6bcf\u4e2aSpringboot\u670d\u52a1\u5668\u4e0a\uff0c\u91c7\u7528TAILDIR\u7684source \u548c Kafka channel\uff0cKafka\u7684\u4f5c\u7528\u662f\u6d41\u91cf\u524a\u5cf0\u3002\u8be5\u5c42Flume\u6709\u4e00\u4e2a\u7528\u4e8e\u6821\u9a8c\u65e5\u5fd7\u662f\u5426\u4e3ajson\u683c\u5f0f\u7684\u62e6\u622a\u5668\u3002  \u7b2c\u4e8c\u5c42Flume\u90e8\u7f72\u5728\u975eSpringboot\u4e3b\u673a\u4e0a\uff0c\u8d1f\u8d23\u6d88\u8d39Kafka\u4e2d\u7684\u65e5\u5fd7\u6570\u636e\uff0c\u5e76\u4e0a\u4f20\u5230HDFS\u3002\u6b63\u5e38\u5e94\u8be5\u662f\u4f7f\u7528Kafka Channel \u548c HDFS Sink\u3002\u672c\u9879\u76ee\u4f7f\u7528\u4e86Kafka source \u3001Flie Channel \u548c HDFS Sink\uff0c\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u7528\u4e8e\u5411Event \u5934\u6dfb\u52a0timestamp\u7684\u62e6\u622a\u5668\uff0c\u7528\u4e8e\u89e3\u51b3\u96f6\u70b9\u504f\u79fb\u95ee\u9898\uff0c\u6240\u8c13\u96f6\u70b9\u504f\u79fb\u95ee\u9898\u662f\u6307\u7531\u4e8e\u6570\u636e\u6e90\u5230HDFS\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u9700\u8981\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5728\u6570\u636e23:59\u5206\u4ea7\u751f\u7684\u6570\u636e\u5230\u8fbeHDFS Sink\u65f6\u53ef\u80fd\u5c31\u5df2\u7ecf00:00\uff0c\u5bf9\u4e8e\u8fd9\u90e8\u5206\u6570\u636e\u4e0d\u80fd\u5c06\u5176\u653e\u5230\u7b2c\u4e8c\u5929\u521b\u5efa\u7684\u76ee\u5f55\u4e2d\uff0c\u800c\u662f\u5e94\u8be5\u653e\u5230\u524d\u4e00\u5929\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u4e3a\u4e86\u89e3\u51b3\u96f6\u70b9\u504f\u79fb\u95ee\u9898\uff0c\u9700\u8981\u4f7f\u7528\u62e6\u622a\u5668\u5c06\u65e5\u5fd7\u91cc\u7684\u65f6\u95f4\u6233\u6dfb\u52a0\u5230Event\u5934\u7684timestamp\u5b57\u6bb5\u4e2d\uff0c\u539f\u7406\u5176\u5b9e\u662f\uff0cHDFS Sink\u4f1a\u6839\u636eEvent\u5934\u91cc\u9762\u7684timestamp\u5b57\u6bb5\u7684\u503c\u5c06\u6570\u636e\u5199\u5165\u5230\u76f8\u5e94\u7684\u76ee\u5f55\u4e0b\u3002 \u5982\u679c\u672c\u5c42\u4e0d\u4f7f\u7528source\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528Kafka Channel\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u5728\u6dfb\u52a0\u62e6\u622a\u5668\u4e86\uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\u628a\u8fd9\u4e2a\u62e6\u622a\u5668\u7684\u529f\u80fd\u653e\u5230\u7b2c\u4e00\u5c42\u7684\u90a3\u4e2a\u62e6\u622a\u5668\u4e2d\uff0c\u4e5f\u5c31\u662fjson\u683c\u5f0f\u6821\u9a8c\u5408\u683c\u540e\u76f4\u63a5\u5411Event \u5934\u4e2d\u6dfb\u52a0timestamp\u3002 HDFS Sink\u91c7\u7528lzop\u7684\u538b\u7f29\u65b9\u5f0f\u5c06\u65e5\u5fd7\u5199\u5230HDFS\u4e0a\uff0c\u6ca1\u6709\u521b\u5efa\u7d22\u5f15\u3002 </p> <p>\u4e1a\u52a1\u6570\u636e\u91c7\u7528sqoop\u5c06MySQL\u7684\u6570\u636e\u5bfc\u5165HDFS\u4e0a\u3002\u4e1a\u52a1\u6570\u636e\u7684\u540c\u6b65\u7b56\u7565\u6709\u5982\u4e0b4\u79cd\uff1a</p> <ol> <li>\u5168\u91cf\u540c\u6b65\uff1a\u5b58\u50a8\u5b8c\u6574\u7684\u6570\u636e\u3002</li> </ol> <p>\u5168\u91cf\u540c\u6b65\u5c31\u662f\u6bcf\u5929\u90fd\u628a\u8868\u7684\u5168\u90e8\u6570\u636e\u5bfc\u5165\u5230HDFS\u4e0a\uff08\u8def\u5f84\u4e3a \u8868\u540d/\u65e5\u671f\uff09\u3002\u8fd9\u79cd\u540c\u6b65\u7b56\u7565\u9002\u7528\u4e8e\u8868\u7684\u6570\u636e\u91cf\u4e0d\u5927\uff0c\u4e14\u6bcf\u5929\u65e2\u4f1a\u6709\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u4e5f\u4f1a\u6709\u65e7\u6570\u636e\u7684\u4fee\u6539\u3002</p> <ol> <li>\u589e\u91cf\u540c\u6b65\uff1a\u5b58\u50a8\u65b0\u589e\u52a0\u7684\u6570\u636e\u3002</li> </ol> <p>\u53ea\u628a\u8868\u4e2d\u6bcf\u5929\u65b0\u589e\u52a0\u7684\u6570\u636e\u5bfc\u5165\u5230HDFS\u4e0a\uff08\u8def\u5f84\u4e3a \u8868\u540d/\u65e5\u671f\uff09\uff0c\u5373\u8fc7\u6ee4\u6761\u4ef6\u662fcreate_time=\u5f53\u524d\u65e5\u671f\u3002\u8fd9\u79cd\u540c\u6b65\u7b56\u7565\u9002\u7528\u4e8e\u8868\u6570\u636e\u91cf\u5f88\u5927\uff0c\u4e14\u6bcf\u5929\u53ea\u4f1a\u6709\u65b0\u6570\u636e\u63d2\u5165\u3002</p> <ol> <li>\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\uff1a\u5b58\u50a8\u65b0\u589e\u52a0\u7684\u6570\u636e\u548c\u53d8\u5316\u7684\u6570\u636e\u3002</li> </ol> <p>\u628a\u6bcf\u5929\u65b0\u589e\u548c\u4fee\u6539\u8fc7\u7684\u6570\u636e\u5bfc\u5165\u5230HDFS\u4e0a\uff08\u8def\u5f84\u4e3a \u8868\u540d/\u65e5\u671f\uff09\uff0c\u5373\u8fc7\u6ee4\u6761\u4ef6\u662fmodify_time=\u5f53\u5929\u65e5\u671f\u3002\u8fd9\u79cd\u540c\u6b65\u7b56\u7565\u9002\u7528\u4e8e\u8868\u7684\u6570\u636e\u91cf\u5f88\u5927\uff0c\u5e76\u4e14\u6bcf\u5929\u65e2\u4f1a\u6709\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u4e5f\u4f1a\u65e7\u6570\u636e\u7684\u4fee\u6539\u3002</p> <ol> <li>\u7279\u6b8a\u540c\u6b65\uff1a\u53ea\u9700\u8981\u5b58\u50a8\u4e00\u6b21\u3002</li> </ol> <p>\u6839\u636e\u8868\u7684\u7279\u70b9\uff0c\u6bcf\u4e2a\u8868\u7684\u540c\u6b65\u7b56\u7565\u5982\u4e0b\uff1a  \u6ce8\u610f\uff1a\u5bf9\u4e8e\u65e5\u5fd7\u6570\u636e\uff0c\u914d\u7f6e\u597dFlume\u7684\u65f6\u95f4\u6233\u62e6\u622a\u5668\u4e4b\u540e\uff0cFlume\u53ef\u4ee5\u4f9d\u7167\u65e5\u5fd7\u4e2d\u7684\u65f6\u95f4\u6233\u5c06\u6bcf\u4e00\u6761\u65e5\u5fd7\u5199\u5230HDFS\u76f8\u5e94\u7684\u76ee\u5f55\u4e0b\u3002\u800c\u5bf9\u4e8e\u4e1a\u52a1\u6570\u636e\uff0c\u9700\u8981\u6839\u636e\u6bcf\u5f20\u8868\u7684\u542b\u4e49\u53ca\u7279\u70b9\u6765\u9009\u62e9\u540c\u6b65\u7b56\u7565\uff0c\u4e0d\u8fc7\u7b2c\u4e00\u6b21\u5c06MySQL\u7684\u4e1a\u52a1\u6570\u636e\u5bfc\u5165\u5230HDFS\u4e0a\u65f6\uff0c\u6240\u6709\u8868\u90fd\u662f\u5168\u91cf\u540c\u6b65\uff0c\u79f0\u4e3a\u9996\u65e5\u540c\u6b65\uff0c\u65e5\u540e\u6bcf\u5929\u9700\u8981\u4e25\u683c\u6309\u7167\u540c\u6b65\u7b56\u7565\u8fdb\u884c\uff0c\u5bf9\u4e8e\u7279\u6b8a\u7684\u4e24\u5f20\u8868\u53ea\u9700\u8981\u518d\u9996\u65e5\u540c\u6b65\u5c06\u6570\u636e\u5bfc\u5165\u5230HDFS\u4e2d\uff0c\u6bcf\u65e5\u540c\u6b65\u4e0d\u9700\u8981\u518d\u7ba1\u8fd9\u4e24\u5f20\u8868\u4e86\u3002 sqoop\u4f7f\u7528sql\u8bed\u53e5\u5148\u628a\u6570\u636e\u67e5\u51fa\u6765\u7136\u540e\u5bfc\u5165\u5230HDFS\u4e0a\uff0c\u6240\u4ee5\u5982\u679c\u662f\u5168\u91cf\u540c\u6b65\u5219where 1=1\uff0c\u5982\u679c\u589e\u91cf\u540c\u6b65\u5219where create_time=do_date\uff0c\u5982\u679c\u662f\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u5219where operate_time=do_date or create_time=do_date\u3002 sqoop\u53ef\u4f7f\u7528\u53c2\u6570\u6307\u5b9a\u5bfc\u5165\u5230HDFS\u4e0a\u6587\u4ef6\u7684\u538b\u7f29\u65b9\u5f0f\uff0c\u672c\u9879\u76ee\u4f7f\u7528\u7684lzop\u3002\u7531\u4e8esqoop\u7684\u540c\u6b65\u547d\u4ee4\u662f\u5199\u5728shell\u811a\u672c\u4e2d\u7684\u6279\u4efb\u52a1\uff0c\u6240\u4ee5\u5728sqoop\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\uff0c\u53ef\u4ee5\u968f\u5373\u4f7f\u7528lzop\u7684jar\u5305\u4e3alzop\u6587\u4ef6\u5efa\u7acb\u7d22\u5f15\u3002\u800c\u65e5\u5fd7\u6587\u4ef6\u7684\u540c\u6b65\u662f\u6d41\u5f0f\u7684\uff0c\u5373Flume\u542f\u52a8\u540e\u4f1a\u4e00\u76f4\u8fd0\u884c\uff0c\u7b2c\u4e00\u5c42Flume\u4f1a\u4e0d\u95f4\u65ad\u5730\u8bfb\u53d6\u6e90\u65e5\u5fd7\u6587\u4ef6\u4e2d\u6570\u636e\u5199\u5165Kafka\uff0c\u7b2c\u4e8c\u5c42Flume\u4f1a\u4e0d\u95f4\u65ad\u8bfb\u53d6Kafka\u4e2d\u7684\u6570\u636e\u5199\u5165HDFS\uff0cHDFS\u4e0a\u6587\u4ef6\u7684\u751f\u6210\u7531Flume\u63a7\u5236\uff0c\u6240\u4ee5\u65e5\u5fd7\u540c\u6b65\u5230HDFS\u540e\u4e0d\u65b9\u4fbf\u4e3a\u5176\u521b\u5efa\u7684lzop\u6587\u4ef6\u5efa\u7acb\u7d22\u5f15\u3002</p> <p>sqoop\u5bfc\u5165\u547d\u4ee4\u7684\u8fd9\u4e24\u4e2a\u53c2\u6570\u7684\u4f5c\u7528\u662f\uff0c\u5f53\u9047\u5230MySQL\u4e2d\u7684null\u503c\u65f6\uff0c\u5728hive\u8868\u4e2d\u4f7f\u7528\\N\u4fdd\u5b58\uff0c\u8fd9\u6837\u5728hive\u4e2d\u4f7f\u7528is null \u624d\u4e0d\u4f1a\u5931\u6548\uff0c\u56e0\u4e3a\u4e0d\u52a0\u4e0a\u8fd9\u4fe9\u53c2\u6570sqoop\u9ed8\u8ba4\u4f1a\u5c06MySQL\u4e2d\u7684null\u503c\u5728hive\u8868\u4e2d\u4fdd\u5b58\u6210null\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837is null\u5c31\u5931\u6548\u4e86\u3002 Text Only<pre><code>--null-string '\\\\N' \\\n--null-non-string '\\\\N'\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/3-%E6%95%B0%E4%BB%93%E5%BB%BA%E6%A8%A1/","title":"3-\u6570\u4ed3\u5efa\u6a21","text":"<p> \u7ea6 2702 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 54 \u5206\u949f</p> <p>\u6570\u636e\u4ed3\u5e93\u4e0e\u6570\u636e\u96c6\u5e02\u7684\u533a\u522b\uff1a \u6570\u636e\u4ed3\u5e93\u662f\u4f01\u4e1a\u7ea7\u522b\u7684\uff0c\u80fd\u4e3a\u6574\u4e2a\u4f01\u4e1a\u7684\u5404\u4e2a\u90e8\u95e8\u63d0\u4f9b\u51b3\u7b56\u652f\u6301\u3002\u6570\u636e\u96c6\u5e02\u662f\u90e8\u95e8\u7ea7\u522b\u7684\u5fae\u578b\u6570\u636e\u4ed3\u5e93\uff0c\u6570\u636e\u96c6\u5e02\u5206\u4e3a\u4ece\u5c5e\u578b\u548c\u72ec\u7acb\u578b\u4e24\u79cd\uff0c\u4ece\u5c5e\u578b\u662f\u6307\u6570\u636e\u96c6\u5e02\u7684\u6570\u636e\u6765\u81ea\u4f01\u4e1a\u7ea7\u522b\u7684\u6570\u636e\u4ed3\u5e93\uff0c\u800c\u72ec\u7acb\u578b\u6570\u636e\u96c6\u5e02\u662f\u6307\u5404\u4e2a\u90e8\u95e8\u81ea\u5df1\u72ec\u7acb\u5efa\u7acb\u7684\u6570\u636e\u4ed3\u5e93\uff0c\u72ec\u7acb\u578b\u6570\u636e\u4ed3\u5e93\u6709\u6570\u636e\u5b64\u5c9b\u7684\u95ee\u9898\uff0c\u6574\u4e2a\u4f01\u4e1a\u7684\u5404\u4e2a\u90e8\u95e8\u4e4b\u95f4\u6570\u636e\u5b58\u5728\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002</p> <p>\u6570\u4ed3\u5206\u5c42\uff1a </p> <ul> <li>ODS\u5c42\uff1a\u539f\u59cb\u6570\u636e\u5c42\uff0c\u76f4\u63a5\u52a0\u8f7d\u539f\u59cb\u65e5\u5fd7\u3001\u4e1a\u52a1\u6570\u636e\uff0c\u4e0d\u5bf9\u6570\u636e\u505a\u4efb\u4f55\u5904\u7406\uff0c\u4fdd\u5b58\u7684\u662f\u6570\u636e\u7684\u539f\u8c8c\u3002</li> <li>DWD\u5c42\uff1a\u6570\u636e\u660e\u7ec6\u5c42\uff0c\u5bf9ODS\u5c42\u6570\u636e\u8fdb\u884c\u6e05\u6d17\uff08\u53bb\u9664\u7a7a\u503c\uff0c\u810f\u6570\u636e\uff0c\u8d85\u8fc7\u6781\u9650\u8303\u56f4\u503c\u7684\u6570\u636e\uff09\u3001\u8131\u654f\u7b49\uff0c\u4fdd\u5b58\u7684\u662f\u4e1a\u52a1\u4e8b\u5b9e\u660e\u7ec6\uff0c\u4e00\u884c\u6570\u636e\u4ee3\u8868\u4e00\u6b21\u4e1a\u52a1\u884c\u4e3a\uff0c\u5982\u4e00\u6b21\u4e0b\u5355\u884c\u4e3a\u3002</li> <li>DIM\u5c42\uff1a\u7ef4\u5ea6\u5c42\uff0c\u4fdd\u5b58\u7684\u662f\u7ef4\u5ea6\u6570\u636e\uff0c\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u4e8b\u5b9e\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4f8b\u5982\u4f55\u4eba\u3001\u4f55\u65f6\u3001\u4f55\u5730\u7b49\u3002</li> <li>DWS\u5c42\uff1a\u6570\u636e\u670d\u52a1\u5c42\uff0c\u5bf9DWD\u5c42\u6570\u636e\u6309\u5929\u8fdb\u884c\u8f7b\u5ea6\u6c47\u603b\uff0c\u4f8b\u5982\u4e00\u4e2a\u7528\u6237\u4e00\u5929\u7684\u4e0b\u5355\u6b21\u6570\u3002</li> <li>DWT\u5c42\uff1a\u6570\u636e\u4e3b\u9898\u5c42\uff0c\u5bf9DWS\u5c42\u6570\u636e\u8fdb\u884c\u7d2f\u79ef\u6c47\u603b\uff0c\u4f8b\u5982\u7528\u6237\u4ece\u6ce8\u518c\u8d77\u7684\u6240\u6709\u4e0b\u5355\u6b21\u6570\u3002</li> <li>ADS\u5c42\uff1a\u5e94\u7528\u6570\u636e\u5c42\uff0c\u4e3a\u7edf\u8ba1\u62a5\u8868\u63d0\u4f9b\u6570\u636e\u3002</li> </ul> <p>\u6570\u4ed3\u4e3a\u4ec0\u4e48\u8981\u5206\u6210\uff1f 1.\u628a\u590d\u6742\u95ee\u9898\u7b80\u5355\u5316\uff1a\u6bcf\u4e00\u5c42\u90fd\u53ea\u8d1f\u8d23\u5b8c\u6210\u8be5\u5c42\u7684\u4efb\u52a1\uff0c\u7ed3\u6784\u6e05\u6670\uff0c\u65b9\u4fbf\u5b9a\u4f4d\u95ee\u9898\u3002 2.\u51cf\u5c11\u91cd\u590d\u5f00\u53d1\uff1a\u901a\u8fc7\u4e2d\u95f4\u5c42\u6570\u636e\u80fd\u6781\u5927\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\uff0c\u589e\u52a0\u8ba1\u7b97\u7ed3\u679c\u7684\u590d\u7528\u6027\uff0c\u6bd4\u5982DIM\u5c42\u548cDWD\u5c42\u5c06\u4e1a\u52a1\u6570\u636e\u5e93\u7684\u5173\u7cfb\u6a21\u578b\u8f6c\u6362\u6210\u67e5\u8be2\u66f4\u4e3a\u9ad8\u6548\u7684\u7ef4\u5ea6\u6a21\u578b\uff0cDWS\u5c42\u548cDWT\u5c42\u5bf9\u6570\u636e\u6c47\u603b\uff0c\u8ba1\u7b97\u51fa\u5e38\u7528\u7684\u6307\u6807\uff0c\u65b9\u4fbf\u540e\u7eed\u590d\u7528\u3002 3.\u9694\u79bb\u539f\u59cb\u6570\u636e\uff1a\u6bcf\u4e00\u5c42\u6570\u636e\u90fd\u662f\u5c06\u4e0a\u4e00\u5c42\u6570\u636e\u505a\u4e86\u4e00\u6b21\u8ba1\u7b97\u548c\u8f6c\u6362\u540e\u7684\u518d\u6b21\u5b58\u50a8\uff08\u76f8\u5f53\u4e8e\u662f\u5bf9\u4e0a\u4e00\u5c42\u6570\u636e\u521b\u5efa\u4e86\u89c6\u56fe\uff0c\u5e76\u4e14\u8fd8\u628a\u8fd9\u4e2a\u89c6\u56fe\u4fdd\u5b58\u4e86\u4e0b\u6765\uff09\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u6570\u636e\u7684\u9694\u79bb\uff0c\u9694\u79bb\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u66f4\u52a0\u7ec6\u7c92\u5ea6\u63a7\u5236\u6570\u636e\uff0c\u6bd4\u5982\u53ea\u5bf9\u65b0\u624b\u5f00\u653e\u67d0\u4e00\u5c42\u7684\u6570\u636e\u3002</p> <p>\u6570\u4ed3\u547d\u540d\u89c4\u8303 \u8868\u547d\u540d</p> <ul> <li>ODS\u5c42\u547d\u540d\u4e3aods_\u8868\u540d</li> <li>DIM\u5c42\u547d\u540d\u4e3adim_\u8868\u540d</li> <li>DWD\u5c42\u547d\u540d\u4e3adwd_\u8868\u540d</li> <li>DWS\u5c42\u547d\u540d\u4e3adws_\u8868\u540d\u00a0\u00a0</li> <li>DWT\u5c42\u547d\u540d\u4e3adwt_\u8868\u540d</li> <li>ADS\u5c42\u547d\u540d\u4e3aads_\u8868\u540d</li> <li>\u4e34\u65f6\u8868\u547d\u540d\u4e3atmp_\u8868\u540d</li> </ul> <p>\u811a\u672c\u547d\u540d</p> <ul> <li>\u6570\u636e\u6e90_to_\u76ee\u6807_db/log.sh</li> <li>\u7528\u6237\u884c\u4e3a\u811a\u672c\u4ee5log\u4e3a\u540e\u7f00\uff1b\u4e1a\u52a1\u6570\u636e\u811a\u672c\u4ee5db\u4e3a\u540e\u7f00\u3002</li> </ul> <p>\u8868\u5b57\u6bb5\u7c7b\u578b</p> <ul> <li>\u6570\u91cf\u7c7b\u578b\u4e3abigint</li> <li>\u91d1\u989d\u7c7b\u578b\u4e3adecimal(16, 2)\uff0c\u8868\u793a\uff1a16\u4f4d\u6709\u6548\u6570\u5b57\uff0c\u5176\u4e2d\u5c0f\u6570\u90e8\u52062\u4f4d</li> <li>\u5b57\u7b26\u4e32(\u540d\u5b57\uff0c\u63cf\u8ff0\u4fe1\u606f\u7b49)\u7c7b\u578b\u4e3astring</li> <li>\u4e3b\u952e\u5916\u952e\u7c7b\u578b\u4e3astring</li> <li>\u65f6\u95f4\u6233\u7c7b\u578b\u4e3abigint</li> </ul> <p>\u5173\u7cfb\u5efa\u6a21\u4e0e\u7ef4\u5ea6\u5efa\u6a21 \u5173\u7cfb\u5efa\u6a21\u5c06\u590d\u6742\u7684\u6570\u636e\u62bd\u8c61\u4e3a\u4e24\u4e2a\u6982\u5ff5\uff1a\u5b9e\u4f53\u548c\u5173\u7cfb\uff0c\u9075\u5faa\u8303\u5f0f\u7406\u8bba\u7684\u8981\u6c42\u3002\u5176\u4f18\u70b9\u662f\u964d\u4f4e\u6570\u636e\u7684\u5197\u4f59\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u7f3a\u70b9\u662f\u67e5\u8be2\u6d89\u53ca\u591a\u5f20\u8868\u7684\u8fde\u63a5\uff0c\u6548\u7387\u8f83\u4f4e\u3002 \u800c\u7ef4\u5ea6\u5efa\u6a21\u4ee5\u6570\u636e\u5206\u6790\u4f5c\u4e3a\u51fa\u53d1\u70b9\uff0c\u4e0d\u9075\u5faa\u4e09\u8303\u5f0f\uff0c\u6240\u4ee5\u6570\u636e\u5b58\u5728\u4e00\u5b9a\u7684\u5197\u4f59\u3002\u7ef4\u5ea6\u6a21\u578b\u9762\u5411\u4e1a\u52a1\uff0c\u5c06\u4e1a\u52a1\u7528\u4e8b\u5b9e\u8868\u548c\u7ef4\u5ea6\u8868\u5448\u73b0\u51fa\u6765\uff0c\u8868\u7ed3\u6784\u7b80\u5355\uff0c\u6545\u67e5\u8be2\u7b80\u5355\uff0c\u67e5\u8be2\u6548\u7387\u8f83\u9ad8\u3002\uff08\u76f8\u5f53\u4e8e\u662f\u539f\u5148\u5728\u8fdb\u884c\u5173\u7cfb\u5efa\u6a21\u65f6\u62c6\u5f00\u7684\u8868\uff0c\u73b0\u5728\u5728\u6570\u4ed3\u5efa\u8bbe\u4f7f\u7528\u7ef4\u5ea6\u6a21\u578b\u65f6\u6709\u5408\u5e76\u56de\u6765\u4e86\uff0c\u56e0\u4e3a\u5177\u6709\u5197\u4f59\u5e26\u6765\u7684\u67e5\u8be2\u6548\u7387\u7684\u63d0\u5347\uff0c\u4e5f\u6709\u70b9\u50cf\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u67e5\u8be2\u5efa\u7acb\u89c6\u56fe\u7684\u90a3\u4e2a\u610f\u601d\uff0c\u6570\u4ed3\u6bcf\u4e00\u5c42\u7684\u8868\u76f8\u5f53\u4e8e\u662f\u5bf9\u5173\u7cfb\u578b\u6570\u636e\u5e93\u5efa\u7acb\u89c6\u56fe\u5e76\u4fdd\u5b58\u4e86\u4e0b\u6765\uff0c\u5f53\u7136\u7ef4\u5ea6\u5efa\u6a21\u5e76\u6ca1\u6709\u8fd9\u4e48\u7b80\u5355\uff0c\u5b83\u8fd8\u662f\u6709\u4e00\u5957\u5efa\u6a21\u601d\u60f3\u7684\uff0c\u5e76\u4e0d\u662f\u968f\u610f\u7684\u5408\u5e76\u5173\u7cfb\u6570\u636e\u5e93\u7684\u8868\uff09</p> <p>\u7ef4\u5ea6\u8868\u548c\u4e8b\u5b9e\u8868 \u7ef4\u5ea6\u8868\uff1a\u4e00\u822c\u662f\u5bf9\u4e8b\u5b9e\u7684\u63cf\u8ff0\u4fe1\u606f\u3002\u6bcf\u4e00\u5f20\u7ef4\u8868\u5bf9\u5e94\u73b0\u5b9e\u4e16\u754c\u4e2d\u7684\u4e00\u4e2a\u5bf9\u8c61\u6216\u8005\u6982\u5ff5\uff0c\u4f8b\u5982\uff1a\u7528\u6237\u3001\u5546\u54c1\u3001\u65e5\u671f\u3001\u5730\u533a\u7b49\u3002 \u7ef4\u5ea6\u8868\u7684\u7279\u5f81\uff1a</p> <ul> <li>\u56e0\u4e3a\u7ef4\u5ea6\u8868\u4e0d\u9075\u5faa\u4e09\u8303\u5f0f\uff0c\u6240\u4ee5\u7ef4\u5ea6\u8868\u4e00\u822c\u4e3a\u5bbd\u8868\uff0c\u5373\u5217\u6bd4\u8f83\u591a</li> <li>\u8ddf\u4e8b\u5b9e\u8868\u76f8\u6bd4\uff0c\u7ef4\u5ea6\u8868\u884c\u6570\u76f8\u5bf9\u8f83\u5c11\uff0c\u901a\u5e38\u5c0f\u4e8e10\u4e07\u6761</li> <li>\u7ef4\u5ea6\u8868\u5185\u5bb9\u76f8\u5bf9\u56fa\u5b9a\uff0c\u6bd4\u5982\u7f16\u7801\u8868</li> </ul> <p>\u4e8b\u5b9e\u8868\uff1a\u4e8b\u5b9e\u8868\u4e2d\u7684\u6bcf\u884c\u6570\u636e\u4ee3\u8868\u4e00\u4e2a\u4e1a\u52a1\u4e8b\u4ef6\uff0c\u5982\uff1a\u4e0b\u5355\u3001\u652f\u4ed8\u3001\u9000\u6b3e\u3001\u8bc4\u4ef7\u7b49\u3002\u4e8b\u5b9e\u8868\u7684\u5217\u4e00\u822c\u5206\u4e3a\u4e24\u7c7b\uff1a\u7ef4\u5ea6\u8868\u7684\u5916\u952e\u548c\u5ea6\u91cf\u503c\u3002 \u4e8b\u5b9e\u8868\u7684\u7279\u5f81\uff1a</p> <ul> <li>\u975e\u5e38\u7684\u5927\uff0c\u5373\u884c\u975e\u5e38\u591a</li> <li>\u5185\u5bb9\u76f8\u5bf9\u7684\u7a84\uff0c\u5373\u5217\u6570\u8f83\u5c11\uff0c\u4e3b\u8981\u662f\u7ef4\u5ea6\u5916\u952e\u548c\u5ea6\u91cf\u503c</li> <li>\u7ecf\u5e38\u53d1\u751f\u53d8\u5316\uff0c\u6bcf\u5929\u4f1a\u65b0\u589e\u52a0\u5f88\u591a</li> </ul> <p>\u4e8b\u5b9e\u8868\u4e00\u822c\u53ef\u5206\u4e3a3\u7c7b\uff1a 1.\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868 \u4ee5\u6bcf\u4e2a\u4e8b\u52a1\u6216\u4e8b\u4ef6\u4e3a\u5355\u4f4d\u4f5c\u4e3a\u4e8b\u5b9e\u8868\u91cc\u7684\u4e00\u884c\u6570\u636e\uff0c\u4f8b\u5982\u4e00\u4e2a\u9500\u552e\u8ba2\u5355\u8bb0\u5f55\uff0c\u4e00\u7b14\u652f\u4ed8\u8bb0\u5f55\u7b49\u3002\u4e00\u65e6\u4e8b\u52a1\u88ab\u63d0\u4ea4\uff0c\u6570\u636e\u88ab\u63d2\u5165\u4e8b\u5b9e\u8868\uff0c\u6570\u636e\u5c31\u4e0d\u518d\u4f1a\u88ab\u66f4\u6539\uff0c\u6545\u5176\u66f4\u65b0\u65b9\u5f0f\u4e3a\u589e\u91cf\u540c\u6b65\u3002 2.\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868 \u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e2d\u4e0d\u4fdd\u7559\u4e2d\u95f4\u72b6\u6001\uff0c\u53ea\u5728\u4fdd\u7559\u67d0\u4e2a\u65f6\u95f4\u70b9\u4fdd\u5b58\u6570\u636e\uff0c\u4f8b\u5982\u6bcf\u5929\u6216\u8005\u6bcf\u6708\u7684\u9500\u552e\u989d\u3001\u6bcf\u6708\u7684\u8d26\u6237\u4f59\u989d\u7b49\uff0c\u6545\u5176\u66f4\u65b0\u65b9\u5f0f\u4e3a\u5168\u91cf\u540c\u6b65\u3002 3.\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868 \u7d2f\u79ef\u5feb\u7167\u4e8b\u5b9e\u8868\u7528\u4e8e\u8ddf\u8e2a\u4e1a\u52a1\u4e8b\u5b9e\u7684\u53d8\u5316\uff0c\u5176\u66f4\u65b0\u65b9\u5f0f\u4e3a\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u3002</p> <p>\u7ef4\u5ea6\u6a21\u578b\u7684\u5206\u7c7b\uff1a \u7ef4\u5ea6\u6a21\u578b\u5206\u4e3a\uff1a\u661f\u578b\u6a21\u578b\u3001\u96ea\u82b1\u6a21\u578b\u3002\u4e24\u79cd\u6a21\u578b\u7684\u533a\u522b\u5728\u4e8e\u662f\u5426\u5bf9\u7ef4\u5ea6\u8868\u6309\u5173\u7cfb\u8303\u5f0f\u8fdb\u884c\u89c4\u8303\u5316\uff0c\u661f\u578b\u6a21\u578b\u4e0d\u8fdb\u884c\u89c4\u8303\u5316\uff0c\u800c\u96ea\u82b1\u6a21\u578b\u4f1a\u5bf9\u7ef4\u5ea6\u8868\u89c4\u8303\u5316\u3002   \u96ea\u82b1\u6a21\u578b\u4e0e\u661f\u578b\u6a21\u578b\u7684\u533a\u522b\u4e3b\u8981\u5728\u4e8e\u7ef4\u5ea6\u7684\u5c42\u7ea7\uff0c\u6807\u51c6\u7684\u661f\u578b\u6a21\u578b\u7684\u7ef4\u5ea6\u53ea\u6709\u4e00\u5c42\uff0c\u800c\u96ea\u82b1\u6a21\u578b\u4f1a\u6709\u591a\u7ea7\u3002 \u96ea\u82b1\u6a21\u578b\u6bd4\u8f83\u9760\u8fd13NF\uff0c\u4f46\u4e0d\u4f1a\u5b8c\u5168\u9075\u5b883NF\u7684\u8981\u6c42\uff0c\u56e0\u4e3a\u9075\u5faa3NF\u7684\u6027\u80fd\u6210\u672c\u592a\u9ad8\u4e86\u3002</p> <p>\u661f\u5ea7\u6a21\u578b\uff1a  \u661f\u5ea7\u6a21\u578b\u662f\u6307\u591a\u5f20\u4e8b\u5b9e\u8868\u5171\u7528\u7ef4\u5ea6\u8868\u3002\u8fd9\u662f\u6570\u4ed3\u7684\u5e38\u6001\uff0c\u661f\u5ea7\u6a21\u578b\u4e0e\u661f\u578b\u6a21\u578b\u5e76\u4e0d\u51b2\u7a81\uff0c\u661f\u578b\u6a21\u578b\u662f\u5355\u4e00\u7684\u4ece\u4e8b\u5b9e\u8868\u548c\u7ef4\u5ea6\u8868\u7684\u5173\u7cfb\u6765\u770b\uff0c\u800c\u661f\u5ea7\u6a21\u578b\u662f\u4ece\u6574\u4e2a\u6570\u4ed3\u7684\u8868\u7684\u5173\u7cfb\u6765\u770b\u3002</p> <p>\u6570\u4ed3\u5efa\u6a21\u8fc7\u7a0b ODS\u5c42 \u9488\u5bf9HDFS\u4e0a\u7684\u7528\u6237\u884c\u4e3a\u6570\u636e\u548c\u4e1a\u52a1\u6570\u636e\uff0c\u6211\u4eec\u5982\u4f55\u89c4\u5212\u5904\u7406\uff1f \uff081\uff09\u4fdd\u6301\u6570\u636e\u539f\u8c8c\u4e0d\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u8d77\u5230\u5907\u4efd\u6570\u636e\u7684\u4f5c\u7528\u3002 \uff082\uff09\u6570\u636e\u91c7\u7528\u538b\u7f29\uff0c\u51cf\u5c11\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\uff08\u4f8b\u5982\uff1a\u539f\u59cb\u6570\u636e100G\uff0c\u53ef\u4ee5\u538b\u7f29\u523010G\u5de6\u53f3\uff09 \uff083\uff09\u521b\u5efa\u5206\u533a\u8868\uff0c\u9632\u6b62\u540e\u7eed\u7684\u5168\u8868\u626b\u63cf</p> <p>DWD\u5c42\u548cDIM\u5c42 DIM\u5c42\u548cDWD\u5c42\u9700\u6784\u5efa\u7ef4\u5ea6\u6a21\u578b\uff0c\u4e00\u822c\u91c7\u7528\u661f\u578b\u6a21\u578b\uff0c\u5448\u73b0\u7684\u72b6\u6001\u4e00\u822c\u4e3a\u661f\u5ea7\u6a21\u578b\u3002DIM\u5c42\u5bf9\u5e94\u7684\u662f\u7ef4\u5ea6\u8868\uff0cDWD\u5c42\u5bf9\u5e94\u7684\u662f\u4e8b\u5b9e\u8868\u3002 DWD\u5c42\u548cDIM\u5c42\u4ee5\u4e1a\u52a1\u8fc7\u7a0b\u4e3a\u9a71\u52a8\uff0cDWD\u5c42\u7ef4\u5ea6\u5efa\u6a21\u4e00\u822c\u6309\u7167\u4ee5\u4e0b\u56db\u4e2a\u6b65\u9aa4\uff1a \u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b\u2192\u58f0\u660e\u7c92\u5ea6\u2192\u786e\u8ba4\u7ef4\u5ea6\u2192\u786e\u8ba4\u4e8b\u5b9e \uff081\uff09\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u5373\u786e\u5b9a\u6709\u54ea\u4e9b\u4e8b\u5b9e\u8868 \u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\uff0c\u6311\u9009\u6211\u4eec\u611f\u5174\u8da3\u7684\u4e1a\u52a1\u7ebf\uff0c\u6bd4\u5982\u4e0b\u5355\u4e1a\u52a1\uff0c\u652f\u4ed8\u4e1a\u52a1\uff0c\u9000\u6b3e\u4e1a\u52a1\uff0c\u7269\u6d41\u4e1a\u52a1\uff0c\u4e00\u6761\u4e1a\u52a1\u7ebf\u5bf9\u5e94\u4e00\u5f20\u4e8b\u5b9e\u8868\u3002 \uff082\uff09\u58f0\u660e\u7c92\u5ea6\uff0c\u5373\u786e\u5b9a\u4e8b\u5b9e\u8868\u7684\u6bcf\u884c\u6570\u636e\u662f\u4ec0\u4e48 \u5b9a\u4e49\u4e8b\u5b9e\u8868\u4e2d\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u4ec0\u4e48\uff0c\u5e94\u8be5\u5c3d\u53ef\u80fd\u9009\u62e9\u6700\u5c0f\u7c92\u5ea6\uff0c\u4ee5\u6b64\u6765\u5e94\u5404\u79cd\u5404\u6837\u7684\u9700\u6c42\u3002 \u6bd4\u5982\uff1a \u8ba2\u5355\u4e8b\u5b9e\u8868\u4e2d\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u5bf9\u4e00\u4e2a\u5546\u54c1\u7684\u8ba2\u5355\u3002 \u652f\u4ed8\u4e8b\u5b9e\u8868\u4e2d\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u4e00\u4e2a\u652f\u4ed8\u8bb0\u5f55\u3002 \uff083\uff09\u786e\u5b9a\u7ef4\u5ea6\uff0c\u5373\u786e\u5b9a\u4e8b\u5b9e\u8868\u6709\u54ea\u4e9b\u7ef4\u5ea6\u5916\u952e \u7ef4\u5ea6\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u63cf\u8ff0\u4e1a\u52a1\u4e8b\u5b9e\uff0c\u6bd4\u5982\u201c\u8c01\uff0c\u4f55\u5904\uff0c\u4f55\u65f6\u201d\u7b49\u4fe1\u606f\u3002\u786e\u5b9a\u7ef4\u5ea6\u7684\u539f\u5219\u662f\uff0c\u540e\u7eed\u9700\u6c42\u4e2d\u662f\u5426\u8981\u5206\u6790\u76f8\u5173\u7ef4\u5ea6\u7684\u6307\u6807\u3002 \u4f8b\u5982\uff0c\u9700\u8981\u7edf\u8ba1\u4ec0\u4e48\u65f6\u95f4\u4e0b\u7684\u8ba2\u5355\u591a\u3001\u54ea\u4e2a\u5730\u533a\u4e0b\u7684\u8ba2\u5355\u591a\u3001\u54ea\u4e2a\u7528\u6237\u4e0b\u7684\u8ba2\u5355\u591a\uff0c\u4e8e\u662f\u9700\u8981\u786e\u5b9a\u7684\u7ef4\u5ea6\u5c31\u5305\u62ec\uff1a\u65f6\u95f4\u7ef4\u5ea6\u3001\u5730\u533a\u7ef4\u5ea6\u3001\u7528\u6237\u7ef4\u5ea6\u3002 \uff084\uff09\u786e\u5b9a\u4e8b\u5b9e\uff0c\u5373\u786e\u5b9a\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c \u6b64\u5904\u7684\u201c\u4e8b\u5b9e\u201d\u4e00\u8bcd\u6307\u7684\u662f\u4e1a\u52a1\u4e2d\u7684\u5ea6\u91cf\u503c\uff08\u6b21\u6570\u3001\u4e2a\u6570\u3001\u4ef6\u6570\u3001\u91d1\u989d\uff0c\u53ef\u4ee5\u8fdb\u884c\u7d2f\u52a0\uff09\uff0c\u4f8b\u5982\u8ba2\u5355\u91d1\u989d\u3001\u4e0b\u5355\u6b21\u6570\u7b49\u3002</p> <p>DWS\u5c42\u4e0eDWT\u5c42 DWS\u5c42\u548cDWT\u5c42\u7edf\u79f0\u5bbd\u8868\u5c42\u3002DWD\u5c42\u548cDIM\u5c42\u5efa\u8868\u7684\u8fc7\u7a0b\u662f\uff0c\u4ee5\u4e1a\u52a1\u8fc7\u7a0b\u51fa\u53d1\u786e\u5b9a\u4e8b\u5b9e\u8868\uff0c\u7136\u540e\u518d\u786e\u5b9a\u7ef4\u5ea6\u8868\uff1b\u800cDWS\u5c42\u548cDWT\u5c42\u662f\u4ee5\u7ef4\u5ea6\u4e3a\u57fa\u51c6\u786e\u5b9a\u9700\u8981\u5efa\u54ea\u4e9b\u8868\u3002\u6bd4\u5982\u4e00\u5f20\u5730\u533a\u7ef4\u5ea6\u8868\u5173\u8054\u4e86\u8ba2\u5355\u4e8b\u5b9e\u8868\u3001\u9000\u5355\u4e8b\u5b9e\u8868\u3001\u652f\u4ed8\u4e8b\u5b9e\u8868\u3001\u9000\u6b3e\u4e8b\u5b9e\u8868\uff0c\u90a3\u4e48DWS\u5c42\u5c31\u4f1a\u76f8\u5e94\u6709\u4e00\u5f20\u8868\u5b58\u7684\u662f\uff0c\u6bcf\u4e2a\u5730\u533a\u6bcf\u5929\u7684\u8ba2\u5355\u6570\u91cf\u3001\u8ba2\u5355\u603b\u91d1\u989d\u3001\u9000\u5355\u6b21\u6570\u3001\u9000\u5355\u603b\u91d1\u989d\u3001\u652f\u4ed8\u6b21\u6570\u3001\u652f\u4ed8\u603b\u91d1\u989d\u3001\u9000\u6b3e\u6b21\u6570\u3001\u9000\u6b3e\u603b\u91d1\u989d\uff0c\u76f8\u5e94\u5730\uff0cDWT\u5c42\u5b58\u7684\u662f\u5bf9DWS\u5c42\u6570\u636e\u6309\u661f\u671f\u3001\u6708\u3001\u5e74\u7684\u7d2f\u79ef\u805a\u5408\u503c\u3002DWS\u5c42\u548cDWT\u5c42\u5c06\u4e0e\u7ef4\u5ea6\u8868\u5173\u8054\u7684\u6240\u6709\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\u6307\u6807\u7edf\u4e00\u8ba1\u7b97\u4e00\u904d\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u4fdd\u5b58\u5728\u5bbd\u8868\u4e2d\uff0c\u8fd9\u6837\u5c31\u80fd\u6709\u6548\u907f\u514d\u6570\u636e\u7684\u91cd\u590d\u8ba1\u7b97\u3002 \u603b\u7ed3\uff0cDWD\u5c42\u548cDIM\u5c42\u662f\u4ee5\u4e8b\u5b9e\u8868\u51fa\u53d1\u5efa\u8868\uff0c\u800c DWS\u5c42\u4e0eDWT\u5c42\u5219\u662f\u4ee5\u7ef4\u5ea6\u8868\u51fa\u53d1\u5efa\u8868\uff0c\u5373\u4ee5\u7ef4\u5ea6\u8868\u7684\u89d2\u5ea6\u53bb\u770b\u4e8b\u5b9e\u8868\u3002DWS\u5c42\u5b58\u7684\u662fDWD\u5c42\u548cDIM\u5c42\u6570\u636e\u7684\u8f7b\u5ea6\u6c47\u603b\u7ed3\u679c\uff0c\u5373\u4e0e\u6bcf\u5f20\u7ef4\u5ea6\u8868\u76f8\u5173\u8054\u7684\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\uff0cDWT\u5c42\u5b58\u7684\u662fDWS\u5c42\u6570\u636e\u7684\u7d2f\u79ef\u6c47\u603b\u3002DWD\u5c42\u548cDIM\u5c42\u7684\u76ee\u7684\u662f\u907f\u514d\u91cd\u590d\u8ba1\u7b97\u3002</p> <p>ADS\u5c42 \u53ef\u89c6\u5316\u9700\u8981\u54ea\u4e9b\u6570\u636e\u5c31\u5b58\u4ec0\u4e48\u6570\u636e\u3002</p> <p>\u603b\u7ed3 DWD\u5c42\u548cDIM\u5c42\u4ee5\u4e1a\u52a1\u8fc7\u7a0b\u4e3a\u9a71\u52a8\uff0cDWS\u5c42\u3001DWT\u5c42\u548cADS\u5c42\u90fd\u662f\u4ee5\u9700\u6c42\u4e3a\u9a71\u52a8\uff0c\u5df2\u7ecf\u548c\u7ef4\u5ea6\u5efa\u6a21\u6ca1\u6709\u5173\u7cfb\u4e86\u3002DWS\u548cDWT\u90fd\u662f\u5efa\u5bbd\u8868\uff0c\u6309\u7167\u4e3b\u9898\u53bb\u5efa\u8868\uff0c\u4e3b\u9898\u76f8\u5f53\u4e8e\u89c2\u5bdf\u95ee\u9898\u7684\u89d2\u5ea6\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/4-ODS%E5%B1%82/","title":"4-ODS\u5c42","text":"<p> \u7ea6 1042 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 21 \u5206\u949f</p> <p>ODS\u5c42\uff1a \uff081\uff09\u4fdd\u6301\u6570\u636e\u539f\u8c8c\u4e0d\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u8d77\u5230\u5907\u4efd\u6570\u636e\u7684\u4f5c\u7528\u3002 \uff082\uff09\u6570\u636e\u91c7\u7528LZO\u538b\u7f29\u5e76\u521b\u5efa\u7d22\u5f15\uff0c\u51cf\u5c11\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\u3002100G\u6570\u636e\u53ef\u4ee5\u538b\u7f29\u523010G\u4ee5\u5185\u3002 \uff083\uff09\u521b\u5efa\u5206\u533a\u8868\uff0c\u9632\u6b62\u540e\u7eed\u7684\u5168\u8868\u626b\u63cf\uff0c\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\u5927\u91cf\u4f7f\u7528\u5206\u533a\u8868\u3002 \uff084\uff09\u521b\u5efa\u5916\u90e8\u8868\u3002\u5728\u4f01\u4e1a\u5f00\u53d1\u4e2d\uff0c\u9664\u4e86\u81ea\u5df1\u7528\u7684\u4e34\u65f6\u8868\uff0c\u521b\u5efa\u5185\u90e8\u8868\u5916\uff0c\u7edd\u5927\u591a\u6570\u573a\u666f\u90fd\u662f\u521b\u5efa\u5916\u90e8\u8868\u3002</p> <p>1 \u65e5\u5fd7\u8868 \u7531\u4e8eODS\u9700\u8981\u4fdd\u5b58\u6570\u636e\u539f\u8c8c\uff0c\u6240\u4ee5\u65e5\u5fd7\u8868\u53ea\u6709\u4e00\u5217\uff0c\u6570\u636e\u7c7b\u578b\u4e3astring\u3002\u672c\u5c42\u8868\u7684\u6570\u636e\u5b58\u50a8\u65b9\u5f0f\u662flzo+\u7d22\u5f15\uff0c\u6240\u4ee5\u8981\u5728\u5efa\u8868\u65f6\u6307\u5b9aINPUTFORMAT\u548cOUTPUTFORMAT\uff08\u4e3a\u4ec0\u4e48\u662f\u6307\u5b9a\u8fd9\u4e24\u4e2a\uff0c\u800c\u4e0d\u662fTBLPROPERTIES (\"parquet.compression\"=\"lzo\");\u00a0\u4e0d\u662f\u5f88\u6e05\u695a\uff09 Text Only<pre><code>drop table if exists ods_log;\nCREATE EXTERNAL TABLE ods_log (`line` string)\nPARTITIONED BY (`dt` string) -- \u6309\u7167\u65f6\u95f4\u521b\u5efa\u5206\u533a\nSTORED AS -- \u6307\u5b9a\u5b58\u50a8\u65b9\u5f0f\uff0c\u8bfb\u6570\u636e\u91c7\u7528LzoTextInputFormat\uff1b\n\u00a0\u00a0INPUTFORMAT 'com.hadoop.mapred.DeprecatedLzoTextInputFormat'\n\u00a0\u00a0OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'\nLOCATION '/warehouse/gmall/ods/ods_log'\u00a0\u00a0-- \u6307\u5b9a\u6570\u636e\u5728hdfs\u4e0a\u7684\u5b58\u50a8\u4f4d\u7f6e\n;\n</code></pre> \u521b\u5efa\u5b8c\u8868\u540e\u9700\u8981\u4f7f\u7528load\u547d\u4ee4\u5c06\u524d\u9762\u4f7f\u7528Flume+Kafka+Flume\u7684\u65b9\u5f0f\u4e0a\u4f20\u5230HDFS\u7684\u65e5\u5fd7\u5bfc\u5165\u8fd9\u5f20Hive\u8868\u4e2d\u3002\u7531\u4e8e\u524d\u9762\u5bfc\u5165\u5230HDFS\u4e0a\u7684\u65e5\u5fd7\u6587\u4ef6\u867d\u7136\u662flzop\u7684\u538b\u7f29\u6587\u4ef6\uff0c\u4f46\u662f\u6ca1\u6709\u521b\u5efa\u7d22\u5f15\uff0c\u6240\u4ee5\u5728\u5c06\u6570\u636e\u5bfc\u5165\u5230\u65e5\u5fd7\u8868\u540e\u9700\u8981\u5bf9\u6587\u4ef6\u521b\u5efa\u7d22\u5f15\u3002\u6bcf\u5929\u5c06\u65e5\u5fd7\u6587\u4ef6\u5bfc\u5165\u5230\u65e5\u5fd7\u8868\u4e2d\u7684\u64cd\u4f5c\u5e94\u8be5\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u4e0d\u5206\u9996\u65e5\u540c\u6b65\u548c\u6bcf\u65e5\u540c\u6b65\uff0c\u5176\u6bcf\u65e5\u540c\u6b65\u811a\u672c\u5982\u4e0b\uff1a Text Only<pre><code>#!/bin/bash\n# \u5b9a\u4e49\u53d8\u91cf\u65b9\u4fbf\u4fee\u6539\nAPP=gmall\n# \u5982\u679c\u662f\u8f93\u5165\u7684\u65e5\u671f\u6309\u7167\u53d6\u8f93\u5165\u65e5\u671f\uff1b\u5982\u679c\u6ca1\u8f93\u5165\u65e5\u671f\u53d6\u5f53\u524d\u65f6\u95f4\u7684\u524d\u4e00\u5929\nif [ -n \"$1\" ] ;then\n\u00a0\u00a0\u00a0do_date=$1\nelse\n\u00a0\u00a0\u00a0do_date=`date -d \"-1 day\" +%F`\nfi\necho ================== \u65e5\u5fd7\u65e5\u671f\u4e3a $do_date ==================\nsql=\"\nload data inpath '/origin_data/$APP/log/topic_log/$do_date' into table ${APP}.ods_log partition(dt='$do_date');\n\"\nhive -e \"$sql\"\nhadoop jar /opt/module/hadoop-3.1.3/share/hadoop/common/hadoop-lzo-0.4.20.jar com.hadoop.compression.lzo.DistributedLzoIndexer /warehouse/$APP/ods/ods_log/dt=$do_date\n</code></pre></p> <p>2 \u4e1a\u52a1\u6570\u636e\u8868 \u540c\u6837\u7531\u4e8eODS\u53ea\u4fdd\u5b58\u6570\u636e\u7684\u539f\u8c8c\uff0c\u6240\u4ee5ODS\u5c42\u7684\u6240\u6709\u4e1a\u52a1\u6570\u636e\u7684\u8868\u7ed3\u6784\u4e0eMySQL\u4e2d\u8868\u7ed3\u6784\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u9700\u8981\u5bf9\u6bcf\u5929\u540c\u6b65\u7684\u6570\u636e\u6309\u5929\u5206\u533a\uff0c\u6240\u4ee5\u9700\u8981\u989d\u5916\u6307\u5b9a\u4e00\u4e2a\u5206\u533a\u5b57\u6bb5\uff0c\u6bd4\u5982\u6d3b\u52a8\u8868\uff1a Text Only<pre><code>DROP TABLE IF EXISTS ods_activity_info;\nCREATE EXTERNAL TABLE ods_activity_info(\n\u00a0\u00a0\u00a0\u00a0`id` STRING COMMENT '\u7f16\u53f7',\n\u00a0\u00a0\u00a0\u00a0`activity_name` STRING\u00a0\u00a0COMMENT '\u6d3b\u52a8\u540d\u79f0',\n\u00a0\u00a0\u00a0\u00a0`activity_type` STRING\u00a0\u00a0COMMENT '\u6d3b\u52a8\u7c7b\u578b',\n\u00a0\u00a0\u00a0\u00a0`start_time` STRING\u00a0\u00a0COMMENT '\u5f00\u59cb\u65f6\u95f4',\n\u00a0\u00a0\u00a0\u00a0`end_time` STRING\u00a0\u00a0COMMENT '\u7ed3\u675f\u65f6\u95f4',\n\u00a0\u00a0\u00a0\u00a0`create_time` STRING\u00a0\u00a0COMMENT '\u521b\u5efa\u65f6\u95f4'\n) COMMENT '\u6d3b\u52a8\u4fe1\u606f\u8868'\nPARTITIONED BY (`dt` STRING)\nROW FORMAT DELIMITED FIELDS TERMINATED BY '\\t'\nSTORED AS\n\u00a0\u00a0INPUTFORMAT 'com.hadoop.mapred.DeprecatedLzoTextInputFormat'\n\u00a0\u00a0OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'\nLOCATION '/warehouse/gmall/ods/ods_activity_info/';\n</code></pre> \u521b\u5efa\u5b8c\u8868\u540e\u9700\u8981\u4f7f\u7528load\u547d\u4ee4\u5c06\u524d\u9762\u4f7f\u7528sqoop\u5199\u5165\u5230HDFS\u7684\u6587\u4ef6\u5bfc\u5165\u8fd9\u5f20Hive\u8868\u4e2d\u3002\u7531\u4e8e\u524d\u9762\u4f7f\u7528sqoop\u5bfc\u5165\u6570\u636e\u5230HDFS\u65f6\u4f7f\u7528\u4e86lzo\u538b\u7f29\u5e76\u4e14\u521b\u5efa\u4e86\u7d22\u5f15\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528load\u547d\u4ee4\u5bfc\u5165\u6570\u636e\uff08load\u547d\u4ee4\u672c\u8eab\u662f\u4e0d\u80fd\u6539\u53d8\u5b58\u50a8\u683c\u5f0f\uff09\uff0c\u5e76\u4e14\u5bfc\u5165\u6570\u636e\u540e\u4e0d\u9700\u8981\u518d\u4e3a\u5176\u521b\u5efa\u7d22\u5f15\u4e86\u3002 \u7531\u4e8eODS\u53ea\u4fdd\u5b58\u6570\u636e\u7684\u539f\u8c8c\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5c06 sqoop\u540c\u6b65\u5230HDFS\u4e0a\u7684\u6570\u636e \u5bfc\u5165\u5230ODS\u5c42\u7684\u4e1a\u52a1\u8868\u4e2d\u3002\u5373\u9996\u65e5\u540c\u6b65\u76f4\u63a5\u5c06\u5168\u91cf\u6570\u636e\u5bfc\u5165\u5230ODS\u4e1a\u52a1\u8868\u4e2d\uff1b\u6bcf\u65e5\u540c\u6b65\u65f6\uff0c\u76f4\u63a5\u5c06 sqoop\u540c\u6b65\u7684\u6570\u636e \u5bfc\u5165\u5230ODS\u4e1a\u52a1\u8868\u4e2d\u5373\u53ef\uff0c\u56e0\u4e3asqoop\u540c\u6b65\u6570\u636e\u65f6\u662f\u6309\u7167\u540c\u6b65\u7b56\u7565\u6267\u884c\uff0c\u800cODS\u5c42\u4e0d\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528load\u547d\u4ee4\u5c06 sqoop\u540c\u6b65\u7684\u6570\u636e \u8fc1\u79fb\u5230ODS\u8868\u6240\u5728\u7684\u76ee\u5f55\u4e0b\uff08\u6548\u679c\u5c31\u662f\u628asqoop\u540c\u6b65\u7684\u6570\u636e\u6587\u4ef6\u79fb\u52a8\u5230\u4e86ODS\u8868\u6240\u5728\u7684\u76ee\u5f55\u4e0b\uff09\u3002\u540c\u6837\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9996\u65e5\u540c\u6b65\u65f6\u662f\u9700\u8981\u4f7f\u7528load\u547d\u4ee4\u5c06\u4e24\u5f20\u7279\u6b8a\u8868\uff08\u7701\u4efd\u8868 \u548c \u5730\u533a\u8868\uff09\u7684\u6570\u636e\u5bfc\u5165ODS\u5c42\u76f8\u5e94\u7684\u8868\u4e2d\uff0c\u800c\u6bcf\u65e5\u540c\u6b65\u4e0d\u9700\u8981\uff08\u6240\u4ee5\u9700\u8981\u7f16\u5199\u4e24\u4e2a\u540c\u6b65\u811a\u672c\uff09\u3002 \u770b\u4e0a\u53bb\u597d\u50cf\u53ef\u4ee5\u5c06 \u4f7f\u7528sqoop\u5c06\u6570\u636e\u5bfc\u5165HDFS\uff0c\u7136\u540e\u518d\u628aHDFS\u4e0a\u7684\u6570\u636e\u5bfc\u5165\u5230Hive \u7684\u4e24\u6b65\u64cd\u4f5c\u5408\u5e76\u4e3a\u4e00\u6b65\uff0c\u5373\u76f4\u63a5\u4f7f\u7528sqoop\u5c06MySQL\u4e2d\u7684\u6570\u636e\u5bfc\u5165\u5230Hive\u3002 </p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/5-Hive%20on%20Spark%20%E6%90%AD%E5%BB%BA/","title":"5-Hive on Spark \u642d\u5efa","text":"<p> \u7ea6 466 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 9 \u5206\u949f</p> <p>Hive on Spark \u642d\u5efa Hive\u5f15\u64ce\u5305\u62ec\uff1a\u9ed8\u8ba4MR\u3001tez\u3001spark Hive on Spark\uff1aHive\u65e2\u4f5c\u4e3a\u5b58\u50a8\u5143\u6570\u636e\u53c8\u8d1f\u8d23SQL\u7684\u89e3\u6790\u4f18\u5316\uff0c\u8bed\u6cd5\u662fHQL\u8bed\u6cd5\uff0c\u6267\u884c\u5f15\u64ce\u4e3aSpark\uff0cSpark\u8d1f\u8d23\u91c7\u7528RDD\u6267\u884c\u3002 Spark on Hive\uff1aHive\u53ea\u4f5c\u4e3a\u5b58\u50a8\u5143\u6570\u636e\uff0cSpark\u8d1f\u8d23SQL\u89e3\u6790\u4f18\u5316\uff0c\u8bed\u6cd5\u662fSpark SQL\u8bed\u6cd5\uff0cSpark\u8d1f\u8d23\u91c7\u7528RDD\u6267\u884c\u3002</p> <p>\u524d\u63d0\u662f\u628aHive\u642d\u5efa\u597d\uff0c\u7136\u540e\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u5c06Hive\u9ed8\u8ba4\u7684MR\u5f15\u64ce\u6362\u6210Spark\uff1a 1.\u89e3\u538bspark\u5e76\u66f4\u540d Text Only<pre><code>tar -zxvf spark-3.0.0-bin-hadoop3.2.tgz -C /opt/module/\n</code></pre> Text Only<pre><code>mv spark-3.0.0-bin-hadoop3.2/ spark-3.0.0\n</code></pre> 2.\u914d\u7f6eSPARK_HOME Text Only<pre><code>sudo vim /etc/profile.d/my_env.sh\n</code></pre> Text Only<pre><code># SPARK_HOME\nexport SPARK_HOME=/opt/module/spark-3.0.0\nexport PATH=$PATH:$SPARK_HOME/bin\n</code></pre> Text Only<pre><code>source /etc/profile.d/my_env.sh\n</code></pre> 3.\u5728hive\u4e2d\u521b\u5efaspark\u914d\u7f6e\u6587\u4ef6 Text Only<pre><code>vim /opt/module/hive-3.1.2/conf/spark-defaults.conf\n</code></pre> Text Only<pre><code>spark.master\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0yarn\nspark.yarn.queue\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0offline\nspark.eventLog.enabled\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0true\nspark.eventLog.dir\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hdfs://hadoop102:8020/spark/spark-history\nspark.executor.memory\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01g\nspark.driver.memory\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01g\n</code></pre> 4.\u5728HDFS\u521b\u5efa\u8def\u5f84\uff0c\u7528\u4e8e\u5b58\u50a8\u5386\u53f2\u65e5\u5fd7 Text Only<pre><code>hadoop fs -mkdir -p /spark/spark-history\n</code></pre> 5.\u5411HDFS\u4e0a\u4f20Spark\u7eaf\u51c0\u7248jar\u5305 \u8bf4\u660e1\uff1a\u7531\u4e8eSpark3.0.0\u975e\u7eaf\u51c0\u7248\u9ed8\u8ba4\u652f\u6301\u7684\u662fhive2.3.7\u7248\u672c\uff0c\u76f4\u63a5\u4f7f\u7528\u4f1a\u548c\u5b89\u88c5\u7684Hive3.1.2\u51fa\u73b0\u517c\u5bb9\u6027\u95ee\u9898\u3002\u6240\u4ee5\u91c7\u7528Spark\u7eaf\u51c0\u7248jar\u5305\uff0c\u4e0d\u5305\u542bhadoop\u548chive\u76f8\u5173\u4f9d\u8d56\uff0c\u907f\u514d\u51b2\u7a81\u3002 \u8bf4\u660e2\uff1aHive\u4efb\u52a1\u6700\u7ec8\u7531Spark\u6765\u6267\u884c\uff0cSpark\u4efb\u52a1\u8d44\u6e90\u5206\u914d\u7531Yarn\u6765\u8c03\u5ea6\uff0c\u8be5\u4efb\u52a1\u6709\u53ef\u80fd\u88ab\u5206\u914d\u5230\u96c6\u7fa4\u7684\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u3002\u6240\u4ee5\u9700\u8981\u5c06Spark\u7684\u4f9d\u8d56\u4e0a\u4f20\u5230HDFS\u96c6\u7fa4\u8def\u5f84\uff0c\u8fd9\u6837\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u90fd\u80fd\u83b7\u53d6\u5230\u3002 5.1\u00a0\u89e3\u538bspark-3.0.0-bin-without-hadoop.tgz Text Only<pre><code>tar -zxvf /opt/software/spark/spark-3.0.0-bin-without-hadoop.tgz -C /opt/software/spark/\n</code></pre> 5.2\u00a0\u5728HDFS\u521b\u5efa\u8def\u5f84 Text Only<pre><code>hadoop fs -mkdir -p /spark/spark-jars\n</code></pre> 5.3\u4e0a\u4f20spark\u7684jar\u5305 Text Only<pre><code>hadoop fs -put spark-3.0.0-bin-without-hadoop/jars/* /spark/spark-jars\n</code></pre> 6.\u4fee\u6539hive-site.xml\u6587\u4ef6 Text Only<pre><code>vim /opt/module/hive-3.1.2/conf/hive-site.xml\n</code></pre> Text Only<pre><code>&lt;!--Spark\u4f9d\u8d56\u4f4d\u7f6e\uff08\u6ce8\u610f\uff1a\u7aef\u53e3\u53f78020\u5fc5\u987b\u548cnamenode\u7684\u7aef\u53e3\u53f7\u4e00\u81f4\uff09--&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;spark.yarn.jars&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;hdfs://hadoop102:8020/spark/spark-jars/*&lt;/value&gt;\n&lt;/property&gt;\n&lt;!--Hive\u6267\u884c\u5f15\u64ce--&gt;\n&lt;property&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;name&gt;hive.execution.engine&lt;/name&gt;\n\u00a0\u00a0\u00a0\u00a0&lt;value&gt;spark&lt;/value&gt;\n&lt;/property&gt;\n</code></pre> 7.\u6d4b\u8bd5 Text Only<pre><code>bin/hive\n</code></pre> Text Only<pre><code>create table student(id int, name string);\n</code></pre> Text Only<pre><code>insert into table student values(1,'abc');\n</code></pre></p> <p>Hive\u542f\u52a8\u811a\u672c\uff1a Text Only<pre><code>#!/bin/bash\n\ncase $1 in\n\"start\"){\n\u00a0\u00a0\u00a0\u00a0echo \" --------\u542f\u52a8 MySQL-------\"\n\u00a0\u00a0\u00a0\u00a0sudo systemctl start mysqld\n\u00a0\u00a0\u00a0\u00a0echo \" --------\u542f\u52a8 hiveserver2-------\"\n\u00a0\u00a0\u00a0\u00a0nohup hive --service hiveserver2 &gt;/dev/null 2&gt;&amp;1 &amp;\n};;\n\"stop\"){\n\u00a0\u00a0\u00a0\u00a0echo \" --------\u5173\u95ed MySQL-------\"\n\u00a0\u00a0\u00a0\u00a0sudo systemctl stop mysqld\n\u00a0\u00a0\u00a0\u00a0echo \" --------\u5173\u95ed hiveserver2-------\"\n\u00a0\u00a0\u00a0\u00a0ps -ef | grep hiveserver2 | grep -v grep | awk '{print $2}' | xargs -n1 kill -9\n};;\nesac\n</code></pre></p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/6-DIM%E5%B1%82/","title":"6-DIM\u5c42","text":"<p> \u7ea6 1769 \u4e2a\u5b57  9 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 35 \u5206\u949f</p> <p>ODS\u5c42\u4ee5\u540e\u7684\u5404\u5c42\u7684\u5b58\u50a8\u683c\u5f0f\u4f7f\u7528parquet\uff0c\u538b\u7f29\u65b9\u5f0f\u4f7f\u7528lzo\u3002\u7531\u4e8eODS\u5c42\u5b58\u50a8\u7684\u683c\u5f0f\u662f\u6700\u666e\u901a\u7684TEXTFILE\uff0c\u538b\u7f29\u65b9\u5f0f\u662flzo+\u7d22\u5f15\uff0c\u56e0\u4e3ahive\u9ed8\u8ba4\u7684hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat\u00a0\u4f1a\u5c06\u7d22\u5f15\u5f53\u4f5c\u662f\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u6240\u4ee5\u5728\u5c06ODS\u5c42\u6570\u636e\u5199\u5230DIM\u5c42\u548cDWD\u5c42\u65f6\uff0c\u9700\u8981\u5c06\u5408\u5e76\u5c0f\u6587\u4ef6\u5173\u95ed\uff0c\u4e5f\u5c31\u9700\u8981\u8bbe\u7f6eset hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;\uff08\u4e0d\u662f\u5f88\u6e05\u695a\u4e3a\u4ec0\u4e48\u76f4\u63a5\u8bfbODS\u5c42\u8868\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u5c06ODS\u5c42\u6570\u636e\u5199\u5230DIM\u548cDWD\u5c42\u4f1a\u5408\u5e76\u5c0f\u6587\u4ef6\uff0c\u672c\u6765\u5199\u7684\u8fc7\u7a0b\u4e5f\u662f\u5148\u4eceODS\u5c42\u8bfb\u6570\u636e\u3002\uff09 DIM\u5c42\u548cDWD\u5c42\u9700\u8981\u8fdb\u884c\u7ef4\u5ea6\u5efa\u6a21\u786e\u5b9a\u6709\u54ea\u4e9b\u7ef4\u5ea6\u8868\u548c\u4e8b\u5b9e\u8868\uff0c\u6bcf\u5f20\u7ef4\u5ea6\u8868\u548c\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u6765\u81ea\u4e8eODS\u5c42\u4e00\u5f20\u6216\u8005\u591a\u5f20\u8868\uff0c\u4e5f\u5c31\u662fDIM\u5c42\u548cDWD\u5c42\u8868\u4e2d\u7684\u6570\u636e\u662fODS\u5c42\u591a\u5f20\u8868\u5408\u5e76\u7684\u7ed3\u679c\u3002</p> <p>DIM\u5c42\u4e00\u5171\u67096\u5f20\u7ef4\u5ea6\u8868\uff1a\u5546\u54c1\u7ef4\u5ea6\u8868\u3001\u4f18\u60e0\u5238\u7ef4\u5ea6\u8868\u3001\u6d3b\u52a8\u7ef4\u5ea6\u8868\u3001\u5730\u533a\u7ef4\u5ea6\u8868\u3001\u65f6\u95f4\u7ef4\u5ea6\u8868\u3001\u7528\u6237\u7ef4\u5ea6\u8868\u3002 1 \u5546\u54c1\u7ef4\u5ea6\u8868\uff08\u5168\u91cf\uff09 \u5546\u54c1\u7ef4\u5ea6\u8868\u7684\u5b57\u6bb5\u6765\u81ea\u4e8eODS\u5c42\u8fd9\u51e0\u5f20\u5168\u91cf\u540c\u6b65\u7684\u8868\uff1a  \u6240\u4ee5DIM\u5c42\u7684\u5546\u54c1\u7ef4\u5ea6\u8868\u7684\u540c\u6b65\u7b56\u7565\u4e5f\u662f\u6bcf\u65e5\u5168\u91cf\u540c\u6b65\uff0c\u4e5f\u5c31\u662f\u9996\u65e5\u540c\u6b65\u548c\u6bcf\u65e5\u540c\u6b65\u7684\u903b\u8f91\u662f\u76f8\u540c\u7684\uff0c\u90fd\u662f\u628aODS\u5c42\u51e0\u5f20\u8868\u7684\u5f53\u65e5\u5206\u533a\u7684\u6570\u636e\u8fde\u63a5\u4e4b\u540e\u67e5\u8be2\u51fa\u6765\u5199\u5230DIM\u5f53\u65e5\u7684\u8868\u4e2d\uff1a </p> <p>2\u00a0\u4f18\u60e0\u5238\u7ef4\u5ea6\u8868\uff08\u5168\u91cf\uff09 \u4f18\u60e0\u5238\u7ef4\u5ea6\u8868\u53ea\u6765\u81ea\u4e8eODS\u5c42\u7684\u4f18\u60e0\u5238\u8868\uff0c\u6240\u4ee5\u4f18\u60e0\u5238\u7ef4\u5ea6\u8868\u4e5f\u662f\u6bcf\u65e5\u5168\u91cf\u540c\u6b65\uff1a </p> <p>3 \u6d3b\u52a8\u7ef4\u5ea6\u8868\uff08\u5168\u91cf\uff09 \u6d3b\u52a8\u7ef4\u5ea6\u8868\u6765\u81ea\u4e8eODS\u5c42\u7684\u8fd9\u4e24\u5f20\u8868\uff1a  \u540c\u6837DIM\u5c42\u7684\u6d3b\u52a8\u8868\u7684\u540c\u6b65\u7b56\u7565\u662f\u5168\u91cf\u540c\u6b65\uff0c\u4e5f\u5c31\u662f\u628aODS\u7684\u8fd9\u4e24\u5f20\u8868\u7684\u6bcf\u65e5\u5168\u91cf\u6570\u636e\u8fde\u63a5\u4e4b\u540e\u67e5\u8be2\u51fa\u6765\uff0c\u518d\u5199\u5230DIM\u5c42\u7684\u6d3b\u52a8\u7ef4\u5ea6\u8868\u4e2d\uff1a </p> <p>4 \u5730\u533a\u7ef4\u5ea6\u8868 \u5730\u533a\u7ef4\u5ea6\u8868\u6765\u81ea\u4e8eODS\u5c42\u5730\u533a\u8868\u548c\u7701\u4efd\u8868\uff0c\u5730\u533a\u7ef4\u5ea6\u8868\u6bd4\u8f83\u7279\u6b8a\uff0c\u65e0\u9700\u6bcf\u65e5\u540c\u6b65\u88c5\u8f7d\uff0c\u53ea\u9700\u8981\u5728\u9996\u65e5\u540c\u6b65\u4e00\u6b21\u5373\u53ef\uff1a </p> <p>5 \u65f6\u95f4\u7ef4\u5ea6\u8868 \u65f6\u95f4\u7ef4\u5ea6\u8868\u4e5f\u6bd4\u8f83\u7279\u6b8a\uff0c\u65e0\u987b\u6bcf\u65e5\u5bfc\u5165\uff0c\u4e00\u822c\u53ef\u4e00\u6b21\u6027\u5bfc\u5165\u4e00\u5e74\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u5176\u5177\u6709\u53ef\u9884\u89c1\u6027\u3002</p> <p>6 \u7528\u6237\u7ef4\u5ea6\u8868\uff08\u62c9\u94fe\u8868\uff09 \u7528\u6237\u7ef4\u5ea6\u8868\u7684\u6570\u636e\u53ea\u6765\u81ea\u4e8eODS\u5c42\u7684\u7528\u6237\u8868\uff0c\u8fd9\u5f20\u8868\u7684\u540c\u6b65\u7b56\u7565\u662f\u65b0\u589e\u53ca\u53d8\u5316\uff0c\u5373ODS\u5c42\u6bcf\u4e2a\u5206\u533a\u5b58\u7684\u662f\u5f53\u65e5\u7684\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u4e00\u4e2a\u7528\u6237\u8bb0\u5f55\u6ca1\u6709\u53d1\u751f\u8fc7\u53d8\u5316\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7528\u6237\u7684\u8bb0\u5f55\u53ea\u4f1a\u51fa\u73b0\u5f88\u4e45\u4e4b\u524d\u7684\u540c\u6b65\u7684\u5206\u533a\u4e2d\uff0c\u6240\u4ee5\u5982\u679c\u8981\u5728ODS\u5c42\u67e5\u8be2\u8be5\u7528\u6237\u8bb0\u5f55\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5bf9\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u904d\u5386\uff0c\u8fd9\u5728ODS\u5c42\u662f\u5141\u8bb8\u7684\uff0c\u56e0\u4e3aODS\u5c42\u4e0d\u5bf9\u6570\u636e\u505a\u4efb\u4f55\u5904\u7406\uff0c\u53ea\u662f\u5bf9\u6570\u636e\u7684\u539f\u8c8c\u8fdb\u884c\u5907\u4efd\u3002\u4f46\u8fd9\u5728DIM\u548cDWD\u5c42\u662f\u4e0d\u5141\u8bb8\u51fa\u73b0\u7684\uff0cDIM\u548cDWD\u5c42\u5e94\u8be5\u5bf9\u6765\u81eaODS\u5c42\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u4fdd\u8bc1\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u5728\u8fd9\u4e24\u5c42\u4e2d\u67e5\u8be2\u65f6\u4e0d\u9700\u8981\u904d\u5386\u6240\u6709\u5206\u533a\u3002  \u5bf9\u4e8e\u7528\u6237\u8868\u800c\u8a00\uff0c\u5982\u679c\u4e00\u4e2a\u7528\u6237\u5f88\u4e45\u90fd\u6ca1\u6709\u4fee\u6539\u8fc7\u7528\u6237\u8bb0\u5f55\uff0c\u90a3\u4e48\u8be5\u7528\u6237\u7684\u8bb0\u5f55\u5c06\u4fdd\u5b58\u5728ODS\u5f88\u4e45\u4e4b\u524d\u7684\u67d0\u4e2a\u5206\u533a\u4e2d\uff0c\u4f46\u662f\u5728DIM\u5c42\u4e0d\u80fd\u8fd9\u6837\u4fdd\u5b58\uff0cDIM\u5c42\u5e94\u8be5\u5c06\u8fd9\u6761\u6570\u636e\u4fdd\u5b58\u5728\u6700\u65b0\u7684\u4e00\u4e2a\u5206\u533a\u4e2d\uff0c\u56e0\u4e3a\u8fd9\u6761\u7528\u6237\u8bb0\u5f55\u662f\u5f53\u524d\u7528\u6237\u7684\u6700\u65b0\u72b6\u6001\uff0c\u8fd9\u6837\u5728\u67e5\u8be2\u7528\u6237\u7684\u6700\u65b0\u7684\u72b6\u6001\u65f6\u5c31\u53ea\u9700\u8981\u5728\u6700\u65b0\u7684\u8fd9\u4e00\u4e2a\u5206\u533a\u4e2d\u8fdb\u884c\u5373\u53ef\u3002 \u5982\u679c\u7528\u6237\u4fee\u6539\u4e86\u7528\u6237\u6570\u636e\uff0c\u90a3\u4e48\u5728ODS\u5c42\u5f53\u65e5\u5206\u533a\u5c06\u4f1a\u65b0\u589e\u4e00\u6761\u8be5\u7528\u6237\u7684\u8bb0\u5f55\uff0c\u8be5\u7528\u6237\u4e4b\u524d\u7684\u90a3\u4e00\u6761\u8bb0\u5f55\u4f9d\u7136\u4fdd\u7559\u5728ODS\u5c42\u5f88\u4e45\u4e4b\u524d\u7684\u67d0\u4e2a\u5206\u533a\u4e2d\u3002\u5728DIM\u5c42\uff0c\u8fd9\u6761\u6700\u65b0\u7684\u7528\u6237\u8bb0\u5f55\u9700\u8981\u4fdd\u5b58\u5728\u6700\u65b0\u7684\u4e00\u4e2a\u5206\u533a\u4e2d\uff0c\u90a3\u6761\u5386\u53f2\u7684\u8bb0\u5f55\u5e94\u8be5\u4fdd\u5b58\u5728\u524d\u4e00\u65e5\u7684\u5206\u533a\u4e2d\uff0c\u56e0\u4e3a\u7528\u6237\u4eca\u5929\u66f4\u65b0\u7684\u4e86\u72b6\u6001\uff0c\u8868\u793a\u4e4b\u524d\u7684\u90a3\u6761\u8bb0\u5f55\u662f\u6628\u5929\u8fc7\u671f\u7684\u3002 \u6240\u4ee5DIM\u5c42\u7528\u6237\u7ef4\u5ea6\u8868\u4eceODS\u5c42\u7528\u6237\u8868\u540c\u6b65\u7684\u7b56\u7565\u5982\u4e0b\uff1a  \u9996\u65e5\u76f4\u63a5\u5c06ODS\u5c42\u7684\u5168\u91cf\u6570\u636e\u540c\u6b65\u5230DIM\u5c42\u6700\u65b0\u7684\u5206\u533a9999-99-99\u5373\u53ef\uff0c\u56e0\u4e3aMySQL\u4e2d\u7684\u7528\u6237\u8868\u4e0d\u4f1a\u4e5f\u4e0d\u80fd\u4fdd\u5b58\u7528\u6237\u7684\u5386\u53f2\u8bb0\u5f55\uff0c\u8868\u4e2d\u4fdd\u5b58\u7684\u4e00\u76f4\u90fd\u662f\u7528\u6237\u7684\u6700\u65b0\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u9996\u65e5\u4eceMySQL\u540c\u6b65\u5230ODS\u5c42\u7684\u6240\u6709\u8bb0\u5f55\u90fd\u662f\u7528\u6237\u7684\u6700\u65b0\u7684\u72b6\u6001\uff0c\u4e8e\u662f\u4eceODS\u5c42\u5230DIM\u5c42\u4e5f\u5c31\u662f\u6700\u65b0\u7684\u3002\u4e4b\u540e\u7684\u6bcf\u65e5\u540c\u6b65\u5c31\u4e0d\u540c\uff0c\u4eceMySQL\u5230ODS\u5c42\u7528\u6237\u8868\u662f\u76f4\u63a5\u5f53\u5929\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u540c\u6b65\u5230\u65b0\u7684\u5206\u533a\u4e2d\uff0c\u800c\u4eceODS\u5c42\u5230DIM\u5c42\u9700\u8981\u5c06\u8fd9\u90e8\u5206\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u4e0e9999-99-99\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u5408\u5e76\uff0c\u5408\u5e76\u7684\u903b\u8f91\u662f\u5c06\u65b0\u589e\u548c\u53d8\u5316\u7684\u6570\u636e\u4fdd\u5b58\u5728\u6700\u65b0\u76849999-99-99\u5206\u533a\u4e2d\uff0c\u5bf9\u4e8e\u53d8\u5316\u4e4b\u524d\u7684\u8bb0\u5f55\uff0c\u9700\u8981\u5c06\u5176\u79fb\u5230\u524d\u4e00\u5929\u7684\u5206\u533a\u4e2d\uff0c\u56e0\u4e3a\u8fd9\u90e8\u5206\u6570\u636e\u5df2\u7ecf\u5c5e\u4e8e\u5386\u53f2\u6570\u636e\u4e86\u3002 \u5b9e\u73b0\u4e0a\u8ff0\u6bcf\u65e5\u540c\u6b65\u7684\u903b\u8f91\u9700\u8981\u7ed9\u7528\u6237\u7ef4\u5ea6\u8868\u6dfb\u52a0\u4e24\u4e2a\u5b57\u6bb5start_date \u548c\u00a0end_date\uff0cstart_date\u662f\u4eceODS\u540c\u6b65\u5230DIM\u7684\u65e5\u671f\uff0cend_date\u662f\u8be5\u6761\u8bb0\u5f55\u8fc7\u671f\u7684\u65e5\u671f\uff0c\u6bd4\u59822020-06-15\u540c\u6b65\u8fc7\u6765\u7684\u6570\u636e\u5bfc\u81f49999-99-99\u5206\u533a\u4e2d\u90e8\u5206\u6570\u636e\u8fc7\u671f\u4e86\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u6570\u636e\u7684end_date\u5c31\u5e94\u8be5\u662f2020-06-14\uff0c\u56e0\u4e3a2020-06-15\u662f\u6700\u65b0\u6570\u636e\u7684start-time\uff0c\u5bf9\u4e8e9999-99-99\u5206\u533a\u4e2d\u7684\u6570\u636e\uff0cend_date\u662f9999-99-99\u3002\u5177\u4f53sql\u8bed\u53e5\u7684\u5b9e\u73b0\u601d\u8def\u5c31\u662fODS\u5c42\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u4e0eDIM\u5c429999-99-99\u7684\u5206\u533afull outer join\uff0c\u7136\u540e\u5c06ODS\u5c42\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u548cDIM\u5c429999-99-99\u7684\u5206\u533a\u6ca1\u6709join\u4e0a\u7684\u6570\u636eoverwrite\u5230DIM\u5c429999-99-99\u5206\u533a\uff0cDIM\u5c429999-99-99\u7684\u5206\u533a\u5176\u5b83join\u4e0a\u7684\u6570\u636e\u5199\u5230\u524d\u4e00\u5929\u7684\u5206\u533a\u4e2d\u3002  \u901a\u8fc7\u4ee5\u4e0a\u540c\u6b65\u7b56\u7565\uff0c\u5728DIM\u5c42\u67e5\u8be2\u7528\u6237\u6700\u65b0\u7684\u72b6\u6001 \u548c \u67d0\u4e00\u5929\u7684\u5386\u53f2\u8bb0\u5f55 \u90fd\u53ea\u9700\u8981\u626b\u63cf\u4e00\u4e2a\u5206\u533a\u5373\u53ef\u3002\u6bd4\u5982\u67e5\u8be22020-06-14\u7684\u6570\u636e\uff0c\u90a3\u4e48where\u00a0dt=2020-06-14\u5373\u53ef(dt\u662f\u5206\u533a\u5b57\u6bb5)\u3002 \u4e3a\u4ec0\u4e48\u53eb\u62c9\u94fe\u8868\uff1f\u56e0\u4e3a\u4e00\u4e2a\u7528\u6237\u7684\u6700\u65b0\u8bb0\u5f55\uff08\u4e00\u5b9a\u6709\u4e14end_date\u7b49\u4e8e9999-99-99\uff0cstart_date\u4e0d\u5b9a\uff09\u548c \u7528\u6237\u7684\u591a\u6761\u5386\u53f2\u8bb0\u5f55\uff08\u53ea\u6709\u5f53\u7528\u6237\u4fee\u6539\u8fc7\u4fe1\u606f\u624d\u4f1a\u6709\uff09 \u7684start_date \u548c\u00a0end_date\u662f\u9996\u4f4d\u76f8\u8fde\u4e0d\u5b58\u5728\u91cd\u53e0\u7684\uff0c\u5206\u522b\u5206\u6563\u5728\u4e0d\u540c\u7684\u5206\u533a\u4e2d\u3002</p> <p>\u603b\u7ed3\u5c31\u662f\uff0c\u867d\u7136\u5bf9\u4e8e\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u5728ODS\u4e5f\u80fd\u67e5\u5230\u6570\u636e\uff0c\u4f46\u662f\u6548\u7387\u6bd4\u8f83\u4f4e\uff0c\u5e76\u4e14sql\u4e5f\u8f83\u4e3a\u590d\u6742\uff0c\u5982\u679c\u6839\u636e\u8868\u7684\u7279\u70b9\uff0c\u5c06\u6570\u636e\u4ee5\u4e00\u5b9a\u7684\u7b56\u7565\u540c\u6b65\u5230DIM\u540e\uff0c\u53ef\u4ee5\u907f\u514d\u590d\u6742\u4f4e\u6548\u7684\u67e5\u8be2\uff0c\u8fd9\u6b63\u662f\u6570\u4ed3\u5206\u5c42\u7684\u4f18\u70b9\u6240\u5728\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/7-DWD%E5%B1%82/","title":"7-DWD\u5c42","text":"<p> \u7ea6 3340 \u4e2a\u5b57  15 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 67 \u5206\u949f</p> <p>DWD\u5c42\u9700\u8981\u5efa\u7acb\u4e8b\u5b9e\u8868\uff0c\u6570\u636e\u6765\u6e90\u4e8e\u6709\u4e24\u7c7b\uff1a\u7528\u6237\u884c\u4e3a\u6570\u636e \u548c \u4e1a\u52a1\u8868\u4e2d\u4e1a\u52a1\u6d41\u7a0b\u6709\u5173\u7684\u8868\u3002</p> <p>1 \u5bf9\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u5efa\u8868\uff1a ODS\u5c42\u53ea\u9700\u8981\u4fdd\u5b58\u6570\u636e\u7684\u539f\u8c8c\uff0c\u6240\u4ee5\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u8868\u53ea\u6709\u4e00\u5217\uff0c\u5e76\u4e14\u5c06\u4e24\u79cd\u65e5\u5fd7\u90fd\u4fdd\u5b58\u5728\u4e00\u5f20\u8868\u91cc\u4e86\u3002\u4f46\u662f\u5728DWD\u5c42\u9700\u8981\u5c06\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u62c6\u5f00\uff0c\u5206\u522b\u5efa\u7acb\u53ef\u4ee5\u7edf\u8ba1\u4e0d\u540c\u6307\u6807\u7684\u8868\uff1a\u542f\u52a8\u65e5\u5fd7\u8868\uff0c\u9875\u9762\u65e5\u5fd7\u8868\u3001\u52a8\u4f5c\u65e5\u5fd7\u8868\u3001\u66dd\u5149\u65e5\u5fd7\u8868\u3001\u9519\u8bef\u65e5\u5fd7\u8868\u3002 \u4eceODS\u5c42\u5230DWD\u5c42\uff0c\u65e5\u5fd7\u8868\u7684\u9996\u65e5\u548c\u6bcf\u65e5\u5747\u662f\u6bcf\u65e5\u589e\u91cf\u540c\u6b65 </p> <p>DWD\u5c42\u9700\u8981\u6839\u636e\u00a0\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b\u2192\u58f0\u660e\u7c92\u5ea6\u2192\u786e\u8ba4\u7ef4\u5ea6\u2192\u786e\u8ba4\u4e8b\u5b9e \u8fd94\u4e2a\u6b65\u9aa4\u5bf9\u4e1a\u52a1\u6570\u636e\u5efa\u7acb\u4e8b\u5b9e\u8868\uff0c\u6bcf\u4e2a\u4e8b\u5b9e\u8868\u6709\u4e24\u7c7b\u5b57\u6bb5\uff1a\u7ef4\u5ea6\u5916\u952e \u548c \u5ea6\u91cf\u503c\uff0c\u5982\u679c\u672c\u5e94\u8be5\u4e3a\u8be5\u4e8b\u5b9e\u8868\u5efa\u7acb\u7684\u7ef4\u5ea6\u8868\u7684\u5217\u592a\u5c11\uff0c\u53ef\u4ee5\u76f4\u63a5\u7ef4\u5ea6\u9000\u5316\u5c06\u7ef4\u5ea6\u8868\u7684\u5217\u653e\u5728\u4e8b\u5b9e\u8868\u4e2d\u3002 \u672c\u9879\u76ee\u6240\u5efa\u7acb\u7684\u4e8b\u5b9e\u8868\u6709\uff1a\u8bc4\u4ef7\u4e8b\u5b9e\u8868\u3001\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u3001\u9000\u5355\u4e8b\u5b9e\u8868\u3001\u52a0\u8d2d\u4e8b\u5b9e\u8868\u3001\u6536\u85cf\u4e8b\u5b9e\u8868\u3001\u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u3001\u652f\u4ed8\u4e8b\u5b9e\u8868\u3001\u9000\u6b3e\u4e8b\u5b9e\u8868\u3001\u8ba2\u5355\u4e8b\u5b9e\u8868\u3002 \u4e8b\u5b9e\u8868\u6839\u636e\u8868\u4e2d\u6570\u636e\u7684\u66f4\u65b0\u7279\u70b9\u5206\u4e3a3\u79cd\uff1a\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3001\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868 \u548c\u00a0\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002</p> <ul> <li>\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u7279\u70b9\u662f\u6570\u636e\u53ea\u4f1a\u65b0\u589e\uff0c\u539f\u6709\u7684\u6570\u636e\u4e0d\u4f1a\u6539\u53d8\uff0c\u6240\u4ee5\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u540c\u6b65\u662f\u589e\u91cf\u540c\u6b65\uff0c\u53ea\u9700\u8981\u5c06\u589e\u91cf\u6570\u636e\u5199\u5230\u6700\u65b0\u7684\u5206\u533a\u5373\u53ef\u3002</li> <li>\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7279\u70b9\u662f\u8868\u4e2d\u6240\u6709\u6570\u636e\u53d8\u5316\u9891\u7e41\uff0c\u4f46\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u8868\u4e2d\u6570\u636e\u53d8\u5316\u7684\u4e2d\u95f4\u72b6\u6001\uff0c\u53ea\u5728\u6bcf\u5929\u6216\u8005\u6bcf\u6708\u7684\u67d0\u4e2a\u65f6\u95f4\u70b9\u5bf9\u8be5\u8868\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u540c\u6b65\uff0c\u5c31\u50cf\u662f\u5728\u8fd9\u4e2a\u65f6\u95f4\u70b9\u4e3a\u6570\u636e\u62cd\u4e86\u4e00\u5f20\u5feb\u7167\uff0c\u6240\u4ee5\u79f0\u4e3a\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002</li> <li>\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7279\u70b9\u662f\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\u4e0d\u540c\u542b\u4e49\u7684\u65f6\u95f4\u5b57\u6bb5\uff0c\u65f6\u95f4\u5b57\u6bb5\u662f\u5426\u6709\u503c\u8868\u793a\u7740\u6570\u636e\u5904\u4e8e\u4e0d\u540c\u72b6\u6001\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u6bcf\u4e00\u6761\u6570\u636e\u7684\u72b6\u6001\u53d8\u5316\u5c06\u5b83\u5199\u5230\u4e0d\u540c\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u4e5f\u5c31\u628a\u72b6\u6001\u6ca1\u6709\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u6700\u65b0\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u628a\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u5176\u7ec8\u6b62\u65e5\u671f\u7684\u5206\u533a\u4e4b\u4e2d\u3002</li> </ul> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cDWD\u5c42\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u662f\u6765\u81ea\u4e8eMySQL\u7684\u591a\u5f20\u4e1a\u52a1\u8868\uff0c\u6240\u4ee5\u3000\u4eceMySQL\u5230ODS \u548c ODS\u5230DWD \u7684\u540c\u6b65\u7b56\u7565\u4e5f\u662f\u57fa\u672c\u76f8\u540c\uff0c\u4f46\u662f\u8981\u5f3a\u8c03\u6211\u4eec\u73b0\u5728\u8c08\u8bba\u7684\u662fDWD\u5c42\u7684\u4e8b\u5b9e\u8868\uff0c\u8fd9\u4e0eODS\u5c42\u7684\u8868\u662f\u4e0d\u540c\u7684\uff0c\u4e5f\u5c31\u662f\u867d\u7136\u540c\u6b65\u7b56\u7565\u76f8\u540c\uff0c\u4f46\u5177\u4f53\u7684\u66f4\u65b0\u884c\u4e3a\u5b8c\u5168\u4e0d\u540c\u3002</p> <p>2\u00a0\u8bc4\u4ef7\u4e8b\u5b9e\u8868 \u8bc4\u4ef7\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u53ea\u6765\u81eaODS\u5c42\u7684\u8bc4\u4ef7\u8868\uff0c\u8be5\u8868\u7684\u540c\u6b65\u7b56\u7565\u662f\u589e\u91cf\u540c\u6b65\uff0c\u6240\u4ee5\u8bc4\u4ef7\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002  Text Only<pre><code>CREATE EXTERNAL TABLE dwd_comment_info(\n\u00a0\u00a0\u00a0\u00a0`id` STRING COMMENT '\u7f16\u53f7',\n\u00a0\u00a0\u00a0\u00a0`user_id` STRING COMMENT '\u7528\u6237ID',\n\u00a0\u00a0\u00a0\u00a0`sku_id` STRING COMMENT '\u5546\u54c1sku',\n\u00a0\u00a0\u00a0\u00a0`spu_id` STRING COMMENT '\u5546\u54c1spu',\n\u00a0\u00a0\u00a0\u00a0`order_id` STRING COMMENT '\u8ba2\u5355ID',\n\u00a0\u00a0\u00a0\u00a0`appraise` STRING COMMENT '\u8bc4\u4ef7(\u597d\u8bc4\u3001\u4e2d\u8bc4\u3001\u5dee\u8bc4\u3001\u9ed8\u8ba4\u8bc4\u4ef7)',\n\u00a0\u00a0\u00a0\u00a0`create_time` STRING COMMENT '\u8bc4\u4ef7\u65f6\u95f4'\n) COMMENT '\u8bc4\u4ef7\u4e8b\u5b9e\u8868'\nPARTITIONED BY (`dt` STRING)\nSTORED AS PARQUET\nLOCATION '/warehouse/gmall/dwd/dwd_comment_info/'\nTBLPROPERTIES (\"parquet.compression\"=\"lzo\");\n</code></pre> \u8be5\u8868\u4e2duser_id\u3001sku_id\u3001create_time\u5206\u522b\u5c5e\u4e8e\u7528\u6237\u7ef4\u5ea6\u8868\u3001\u5546\u54c1\u7ef4\u5ea6\u8868 \u548c \u65f6\u95f4\u7ef4\u5ea6\u8868 \u7684\u7ef4\u5ea6\u5916\u952e\uff0cappraise\u662f\u7ef4\u5ea6\u9000\u5316\u7684\u5217\u3002 \u5bf9\u4e8e\u589e\u91cf\u540c\u6b65\u8868\uff0c\u8fd8\u662f\u90a3\u53e5\u8bdd\uff0cODS\u4e0d\u9700\u8981\u5bf9\u6570\u636e\u505a\u4efb\u4f55\u5904\u7406\uff0c\u6240\u4ee5\u65e0\u8bba\u662f\u90a3\u79cd\u540c\u6b65\u7b56\u7565\uff0cODS\u5c42\u7684\u9996\u65e5\u90fd\u662f\u5168\u91cf\u540c\u6b65\uff0c\u4f46DWD\u5c42\u4e0d\u80fd\u8fd9\u6837\uff0c\u5bf9\u4e8e\u589e\u91cf\u540c\u6b65\u7b56\u7565\u7684\u6570\u636e\uff0cDWD\u5c42\u5fc5\u987b\u5c06ODS\u9996\u65e5\u540c\u6b65\u7684\u5168\u91cf\u6570\u636e\u5c55\u5f00\uff0c\u6bcf\u4e2a\u5206\u533a\u4fdd\u5b58\u90fd\u662f\u5f53\u65e5\u7684\u8bb0\u5f55\u3002\u7136\u540e\u6bcf\u65e5\u540c\u6b65\u65f6\uff0c\u53ea\u9700\u8981\u76f4\u63a5\u5c06ODS\u5c42\u7684\u6570\u636e\u540c\u6b65\u5230DWD\u5c42\u5373\u53ef\u3002\u6240\u6709\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u540c\u6b65\u7b56\u7565\u90fd\u662f\u8fd9\u6837\u7684\u3002 </p> <p>3\u00a0\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868 \u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u4e3b\u8981\u7684\u6570\u636e\u6765\u81ea\u4e8eODS\u5c42\u7684ods_order_detail\u8ba2\u5355\u660e\u7ec6\u8868\uff0c\u9700\u8981\u5173\u8054\u7528\u6237\u548c\u5730\u533a\u7ef4\u5ea6\u8868\uff0c\u53ef\u4ee5\u4eceODS\u5c42\u7684\u8ba2\u5355\u8868ods_order_info\u4e2d\u62ff\u5230\u8fd9\u4e24\u4e2a\u5916\u952e\uff0c\u9700\u8981\u5173\u8054\u6d3b\u52a8\u7ef4\u5ea6\u8868\uff0c\u53ef\u4ee5\u4eceODS\u5c42\u7684\u8ba2\u5355\u660e\u7ec6\u6d3b\u52a8\u5173\u8054\u8868ods_order_detail_activity\u62ff\u5230\u6d3b\u52a8id\u548c\u6d3b\u52a8\u89c4\u5219id\u7684\u5916\u952e\uff0c\u9700\u8981\u5173\u8054\u4f18\u60e0\u5238\u7ef4\u5ea6\u8868\uff0c\u53ef\u4ee5\u4ece\u8ba2\u5355\u660e\u7ec6\u4f18\u60e0\u5238\u5173\u8054\u8868ods_order_detail_coupon\u4e2d\u62ff\u5230\u8fd9\u4e2a\u4f18\u60e0\u5238id\u8fd9\u4e2a\u5916\u952e\u3002 \u4eceMySQL\u5230ODS\u5c42\u7684ods_order_detail\u8ba2\u5355\u660e\u7ec6\u8868\u662f\u589e\u91cf\u540c\u6b65\uff0c\u6240\u4ee5\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002  \u4e8e\u662f\u4eceODS\u5c42\u5230DWD\u5c42\u7684\u9996\u65e5\u540c\u6b65\u5e94\u8be5\u5c06\u5168\u91cf\u6570\u636e\u6563\u5f00\uff0c\u6bcf\u65e5\u540c\u6b65\u76f4\u63a5\u540c\u6b65\u5f53\u5929\u7684\u589e\u91cf\u5373\u53ef\uff1a </p> <p>4\u00a0\u9000\u5355\u4e8b\u5b9e\u8868 \u9000\u5355\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u4e3b\u8981\u6765\u81ea\u4e8eODS\u7684ods_order_refund_info\u9000\u5355\u8868\uff0c\u9700\u8981\u5173\u8054\u5730\u533a\u7ef4\u5ea6\u8868\uff0c\u53ef\u4ee5\u4ece\u4eceODS\u5c42\u7684\u8ba2\u5355\u8868\u4e2d\u62ff\u5230\u8fd9\u4e2a\u7ef4\u5ea6\u5916\u952e\u3002 \u4eceMySQL\u5230ODS\u5c42\u7684ods_order_refund_info\u9000\u5355\u8868\u662f\u589e\u91cf\u540c\u6b65\uff0c\u6240\u4ee5\u9000\u5355\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002 </p> <p>5 \u52a0\u8d2d\u4e8b\u5b9e\u8868 \u52a0\u8d2d\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u4e3b\u8981\u6765\u81ea\u4e8eODS\u5c42\u7684ods_cart_info\u52a0\u8d2d\u8868\uff0c\u8fd9\u662f\u4e00\u5f20\u5168\u91cf\u540c\u6b65\u8868\uff0c\u6240\u4ee5\u52a0\u8d2d\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002  \u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u9996\u65e5\u548c\u6bcf\u65e5\u90fd\u76f4\u63a5\u91c7\u7528\u5168\u91cf\u540c\u6b65\uff1a </p> <p>6 \u6536\u85cf\u4e8b\u5b9e\u8868 \u6536\u85cf\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u4e3b\u8981\u6765\u81ea\u4e8eODS\u5c42\u7684ods_favor_info\u6536\u85cf\u8868\uff0c\u6240\u4ee5\u6536\u85cf\u4e8b\u5b9e\u8868\u4e5f\u662f\u4e00\u5f20\u5468\u671f\u6027\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u76f4\u63a5\u5168\u91cf\u540c\u6b65\u3002</p> <p>7 \u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868 \u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u4e3b\u8981\u6765\u81ea\u4e8eODS\u5c42\u7684ods_coupon_use\u8868\uff0c\u8fd9\u5f20\u8868\u4eceMySQL\u5230ODS\u5c42\u7684\u540c\u6b65\u7b56\u7565\u662f\u65b0\u589e\u53ca\u53d8\u5316\uff0c\u6240\u4ee5\u4eceODS\u5c42\u5230DWD\u5c42\u7684\u7b56\u7565\u4e5f\u5e94\u8be5\u662f\u65b0\u589e\u53ca\u53d8\u5316\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002  \u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u5bf9\u4e8e\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u7b56\u7565\u7684\u8868\uff0cODS\u5c42\u53ef\u4ee5\u4e0d\u505a\u5904\u7406\uff0c\u53ea\u8d1f\u8d23\u5c06\u6bcf\u5929\u7684\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u5b58\u5230\u5f53\u5929\u5206\u533a\u5373\u53ef\uff0c\u4f46\u662fDIM\u5c42\u548cDWD\u5c42\u5c31\u4e0d\u80fd\u8fd9\u4e48\u7b80\u5355\u7c97\u66b4\u4e86\uff0c\u8fd9\u4e24\u5c42\u7684\u8868\u662f\u7ef4\u5ea6\u5efa\u6a21\u7684\u7ed3\u679c\uff0c\u662f\u4e3a\u540e\u7eed\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u6790\u505a\u51c6\u5907\u7684\uff0c\u6240\u4ee5\u9700\u8981\u7ecf\u8fc7\u5904\u7406\u540e\u5c06\u6570\u636e\u653e\u5230\u76f8\u5e94\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u5904\u7406\u7684\u7b56\u7565\u5c31\u662f\u628a\u72b6\u6001\u6ca1\u6709\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u6700\u65b0\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u628a\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u5176\u7ec8\u6b62\u65e5\u671f\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u8fd9\u6837\u540e\u7eed\u67e5\u8be2\u5c31\u65b9\u4fbf\u4e86\u3002\u5982\u679c\u4e0d\u7ecf\u8fc7\u8fd9\u4e00\u5c42\u7684\u5904\u7406\uff0c\u76f4\u63a5\u4eceODS\u67e5\u67d0\u6761\u6570\u636e\u9700\u8981\u904d\u5386\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u624d\u80fd\u67e5\u5230\u3002 \u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u7684\u540c\u6b65\u903b\u8f91\u5982\u4e0b\uff0c\u8fd9\u4e5f\u662f\u6240\u6709\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u88c5\u8f7d\u903b\u8f91\u3002  \u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e4b\u6240\u4ee5\u79f0\u4e3a\u7d2f\u79ef\uff0c\u662f\u56e0\u4e3a\u8868\u4e2d\u6709\u8bb8\u591a\u4e8e\u65f6\u95f4\u76f8\u5173\u7684\u5b57\u6bb5\uff0c\u6bcf\u4e2a\u65f6\u95f4\u5b57\u6bb5\u90fd\u6709\u5176\u7279\u5b9a\u7684\u542b\u4e49\uff0c\u80fd\u53cd\u6620\u51fa\u8be5\u8bb0\u5f55\u6240\u5904\u7684\u72b6\u6001\u3002\u6bd4\u5982\u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u6709get_time\u3001used_time\u3001expire_time\uff0c\u5176\u4e2d\u5982\u679cused_time \u6216\u8005 expire_time\u4e0d\u4e3anull\uff0c\u5219\u8868\u793a\u8be5\u4f18\u60e0\u5238\u5df2\u7ecf\u4f7f\u7528\u4e86\uff0c\u6240\u4ee5\u8be5\u6570\u636e\u4e3a\u7ec8\u6b62\u72b6\u6001\uff0c\u5e94\u8be5\u5199\u5230\u7ec8\u6b62\u65e5\u671f\u5bf9\u5e94\u7684\u5206\u533a\u4e2d\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u4e0d\u4e3anull\uff0c\u5219\u8868\u793a\u8be5\u4f18\u60e0\u5238\u7684\u72b6\u6001\u8fd8\u6ca1\u6709\u7ec8\u6b62\uff0c\u5e94\u8be5\u628a\u8fd9\u6761\u6570\u636e\u5199\u5230\u6700\u65b0\u76849999-99-99\u5206\u533a\u4e2d\u3002\u4e5f\u5c31\u662f\uff0c\u7d2f\u79ef\u578b\u5feb\u7167\u88689999-99-99\u5206\u533a\u5b58\u7684\u662f\u672a\u5b8c\u6210\u7684\u8bb0\u5f55\uff0c\u5176\u5b83\u7684\u6bcf\u65e5\u5206\u533a\u5b58\u7684\u662f\u5df2\u7ecf\u5b8c\u6210\u7684\u8bb0\u5f55\u3002 \u9996\u65e5\u540c\u6b65\u65f6\uff0c\u6839\u636e\u6570\u636e\u7684used_time \u548c expire_time\u662f\u5426\u4e3anull\uff0c\u53ef\u4ee5\u786e\u5b9a\u6570\u636e\u662f\u5426\u4e3a\u7ec8\u6b62\u72b6\u6001\uff0c\u4ece\u800c\u5c06\u6570\u636e\u5199\u5165\u5230\u76f8\u5e94\u7684\u5206\u533a\u4e4b\u4e2d\u3002 \u6bcf\u65e5\u540c\u6b65\u65f6\uff0c\u5728\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u4e2d\uff0c\u65b0\u589e\u7684\u6570\u636e\u6709\u72b6\u6001\u672a\u7ec8\u6b62\u7684\u6570\u636e\uff0c\u4e5f\u6709\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u6570\u636e\uff0c\u9700\u8981\u5c06\u8fd9\u4e24\u90e8\u5206\u7684\u6570\u636e\u5206\u522b\u5199\u5230\u6700\u65b0\u76849999-99-99\u5206\u533a\u548c\u5f53\u65e5\u7684\u5206\u533a\u4e2d\uff08\u5f53\u65e5\u5206\u533a\u4e3a\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u5206\u533a\uff09\uff0c\u6bd4\u59822020-06-16\u5e94\u8be5\u6267\u884c\u811a\u672c\u540c\u6b65\u524d\u4e00\u65e52020-06-15\u7684\u6570\u636e\uff0c2020-06-15\u7684\u6570\u636e\u6709\u65b0\u589e\u7684\u5df2\u7ecf\u7ec8\u6b62\u7684\u6570\u636e\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u5c31\u5e94\u8be5\u5199\u52302020-06-15\u5206\u533a\u4e2d\u3002\u8fd8\u6709\u5c31\u662f\u53d8\u5316\u7684\u6570\u636e\uff0c\u53d8\u5316\u7684\u6570\u636e\u4e00\u5b9a\u8981\u4e48\u662f\u4f18\u60e0\u5238\u88ab\u4f7f\u7528\u4e86\uff0c\u8981\u4e48\u662f\u8fc7\u671f\u4e86\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u4e5f\u90fd\u5e94\u8be5\u5199\u5230\u5f53\u65e5\u7684\u5206\u533a\u4e2d\u3002 \u4ee5\u4e0a\u9996\u65e5\u540c\u6b65\u7684sql\u4f7f\u7528\u52a8\u6001\u5206\u533a\u5373\u53ef\u5b8c\u6210\uff0c\u6bcf\u65e5\u540c\u6b65\u5230\u7684sql\u9700\u8981\u5c06\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u4e0e9999-99-99\u5206\u533afull outer join\uff0c\u7136\u540e\u4f7f\u7528\u52a8\u6001\u5206\u533a\u5199\u5165\u5373\u53ef\u3002\u6bcf\u65e5\u88c5\u8f7dsql\u7684\u903b\u8f91\uff1a  \u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868 \u4e0e DIM\u5c42\u62c9\u94fe\u8868 \u7684\u76f8\u540c\u70b9\u90fd\u662f\u65b0\u589e\u53ca\u53d8\u5316\u7684\u540c\u6b65\u7b56\u7565\uff0c\u533a\u522b\u5c31\u5728\u4e8e\uff0c\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e2d\u5b58\u7684\u662f\u4e1a\u52a1\u6d41\u7a0b\uff0c\u4e5f\u5c31\u662f\u4e00\u6761\u6570\u636e\u5b8c\u6574\u7684\u4e1a\u52a1\u6d41\u7a0b\u90fd\u5728\u4e00\u6761\u6570\u636e\u4e2d\uff0c\u9760\u51e0\u4e2a\u65f6\u95f4\u5b57\u6bb5\u6765\u533a\u5206\uff0c\u6240\u4ee5\u6240\u6709\u6570\u636e\u90fd\u4f1a\u53ea\u5b58\u5728\u4e00\u6761\u8bb0\u5f55\uff0c\u8981\u4e48\u5728\u6700\u65b0\u7684 9999-99-99\u5206\u533a\u4e2d\uff0c\u8981\u4e48\u5728\u524d\u9762\u67d0\u5929\u7684\u5206\u533a\u4e2d\u3002\u800cDIM\u5c42\u62c9\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u6570\u636e\u90fd\u5b58\u5728\u7740\u6700\u65b0\u7684\u8bb0\u5f55\u5728 9999-99-99\u5206\u533a\u4e2d\uff0c\u8fd8\u5b58\u5728\u7740\u5f88\u591a\u5386\u53f2\u8bb0\u5f55\u5728\u4e4b\u524d\u7684\u5206\u533a\u4e2d\uff0c\u8fd9\u79cd\u540c\u4e00\u6761\u6570\u636e\u591a\u6761\u5386\u53f2\u8bb0\u5f55\u7684\u60c5\u51b5\u5e94\u8be5\u4e0d\u4f1a\u51fa\u73b0\u4e1a\u52a1\u6d41\u7a0b\u91cc\uff0c\u6240\u4ee5\u8fd9\u79cd\u8868\u5e94\u8be5\u53ea\u4f1a\u51fa\u73b0\u5728DIM\u5c42\u3002 DIM\u5c42\u62c9\u94fe\u8868\u7684\u5206\u533a\u5b57\u6bb5dt\u7684\u503c\u4e0e\u8be5\u5206\u533a\u4e2d\u6570\u636e\u7684end-time\u76f8\u540c\uff0c\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7531\u4e8e\u6709\u591a\u4e2a\u65f6\u95f4\u5b57\u6bb5\u4e0e\u7ec8\u6b62\u72b6\u6001\u6709\u5173\uff0c\u6240\u4ee5\u5176\u5206\u533a\u5b57\u6bb5dt\u7684\u503c\u53ea\u53ef\u80fd\u7b49\u4e8e\u8be5\u5206\u533a\u4e2d\u6570\u636e\u67d0\u4e2a\u65f6\u95f4\u5b57\u6bb5\u7684\u503c\uff08\u5982\u679c\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e00\u6761\u6570\u636e\u7684\u7ec8\u6b62\u72b6\u6001\u53ea\u4e0e\u4e00\u4e2a\u65f6\u95f4\u5b57\u6bb5\u7684\u503c\u6709\u5173\uff0c\u90a3\u4e48\u5206\u533a\u5b57\u6bb5dt\u7684\u503c\u5c31\u7b49\u4e8e\u8be5\u5b57\u6bb5\u7684\u503c\uff09\u3002 \u533a\u522b\u603b\u7ed3\u5c31\u662f\uff0c\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u76849999-99-99\u5206\u533a\u53ea\u4f1a\u4fdd\u7559\u72b6\u6001\u8fd8\u672a\u7ec8\u6b62\u7684\u8bb0\u5f55\uff0c\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u8bb0\u5f55\u4fdd\u5b58\u5728\u4e4b\u524d\u7684\u5206\u533a\u4e4b\u4e2d\uff1b\u800cDIM\u5c42\u62c9\u94fe\u8868\u76849999-99-99\u5206\u533a\u4f1a\u4fdd\u5b58\u6240\u6709\u6570\u636e\u6700\u65b0\u72b6\u6001\u7684\u8bb0\u5f55\uff0c\u5982\u679c\u6570\u636e\u6709\u5386\u53f2\u72b6\u6001\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u4f1a\u4fdd\u5b58\u5728\u4e4b\u524d\u7684\u5206\u533a\u7684\u4e2d\uff0c\u4e00\u6761\u6570\u636e\u6240\u6709\u72b6\u6001\u7684\u8bb0\u5f55\u7684start-time\u548cend-time\u662f\u9996\u4f4d\u76f8\u8fde\u7684\uff0c\u6240\u4ee5\u79f0\u4e3a\u62c9\u94fe\u8868\u3002</p> <p>8\u00a0\u652f\u4ed8\u4e8b\u5b9e\u8868 \u652f\u4ed8\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u4e3b\u8981\u6765\u81ea\u4e0eODS\u5c42ods_payment_info\u8868\uff0c\u9700\u8981\u901a\u8fc7order_info\u8868\u62ff\u5230\u5730\u533a\u7ef4\u5ea6\u8868\u7684\u5916\u952e\u3002  \u56e0\u4e3aods_payment_info\u8868\u662f\u4e00\u5f20\u65b0\u589e\u53ca\u53d8\u5316\u7684\u8868\uff0c\u6240\u4ee5\u652f\u4ed8\u4e8b\u5b9e\u8868\u7684\u4e5f\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002\u5176\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u5b57\u6bb5\u662fcreate_time\u3001callback_time\uff0ccallback_time\u4e0d\u4e3anull\uff0c\u8868\u793a\u652f\u4ed8\u5b8c\u6210\uff0c\u4e3anull\u5219\u8868\u793a\u652f\u4ed8\u672a\u5b8c\u6210\u3002 \u5176\u9996\u65e5\u4e0e\u6bcf\u65e5\u540c\u6b65\u903b\u8f91\u5982\u4e0b\uff0c\u548c\u5176\u5b83\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e00\u6837\uff0c\u9760callback_time\u662f\u5426\u4e3anull\u5c06\u6570\u636e\u5199\u5230\u76f8\u5e94\u7684\u5206\u533a\u4e2d\u3002 </p> <p>9\u00a0\u9000\u6b3e\u4e8b\u5b9e\u8868 \u9000\u6b3e\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u4e3b\u8981\u6765\u81ea\u4e0eODS\u5c42ods_refund_payment\u8868\u3002  \u56e0\u4e3aods_refund_payment\u8868\u662f\u4e00\u5f20\u65b0\u589e\u53ca\u53d8\u5316\u7684\u8868\uff0c\u6240\u4ee5\u9000\u6b3e\u4e8b\u5b9e\u8868\u7684\u4e5f\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002\u5176\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u5b57\u6bb5\u662fcreate_time\u3001callback_time\uff0ccallback_time\u4e0d\u4e3anull\uff0c\u8868\u793a\u9000\u6b3e\u5b8c\u6210\uff0c\u4e3anull\u5219\u8868\u793a\u9000\u6b3e\u672a\u5b8c\u6210\u3002\u548c\u5176\u5b83\u7d2f\u79ef\u578b\u4e8b\u5b9e\u8868\u4e00\u6837\uff0c\u9760callback_time\u662f\u5426\u4e3anull\u5c06\u6570\u636e\u5199\u5230\u76f8\u5e94\u7684\u5206\u533a\u4e2d\u3002</p> <p>10\u00a0\u8ba2\u5355\u4e8b\u5b9e\u8868 \u8ba2\u5355\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u4e3b\u8981\u6765\u81ea\u4e8eODS\u5c42\u7684ods_order_info\u8868 \u548c ods_order_status_log\u8868\uff0c\u4e3b\u8981\u8fd8\u662fods_order_info\u8868\uff0c\u53ea\u662f\u9700\u8981\u4eceods_order_status_log\u8868\u83b7\u53d6\u8ba2\u5355\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u3002\u6240\u4ee5\u8ba2\u5355\u4e8b\u5b9e\u8868\u4e5f\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002  \u8ba2\u5355\u4e8b\u5b9e\u8868\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u5982\u4e0b\uff1a</p> <ul> <li>create_time\u00a0\u00a0 \u00a0\u521b\u5efa\u65f6\u95f4(\u672a\u652f\u4ed8\u72b6\u6001)</li> <li>payment_time\u00a0\u00a0 \u00a0\u652f\u4ed8\u65f6\u95f4(\u5df2\u652f\u4ed8\u72b6\u6001)</li> <li>cancel_time\u00a0\u00a0 \u00a0\u53d6\u6d88\u65f6\u95f4(\u5df2\u53d6\u6d88\u72b6\u6001)</li> <li>finish_time\u00a0\u00a0 \u00a0\u5b8c\u6210\u65f6\u95f4(\u5df2\u5b8c\u6210\u72b6\u6001)</li> <li>refund_time\u00a0\u00a0 \u00a0\u9000\u6b3e\u65f6\u95f4(\u9000\u6b3e\u4e2d\u72b6\u6001)</li> <li>refund_finish_time\u00a0\u00a0 \u00a0\u9000\u6b3e\u5b8c\u6210\u65f6\u95f4(\u9000\u6b3e\u5b8c\u6210\u72b6\u6001)</li> <li>expire_time\u00a0\u00a0 \u00a0\u8fc7\u671f\u65f6\u95f4</li> </ul> <p>\u5176\u4e2d\u8868\u793a\u8ba2\u5355\u5b8c\u6210\u7684\u72b6\u6001\u6709\uff1a 1.cancel_time\u4e0d\u4e3anull\uff0c\u7ec8\u6b62\u65f6\u95f4\u4e3acancel_time 2.finish_time\u4e0d\u4e3anull\uff0c\u5e76\u4e14\u540c\u6b65\u7684\u65f6\u95f4\u5927\u4e8efinish_time 7\u5929\uff0c\u5e76\u4e14refund_time\u4e3anull\uff0c\u7ec8\u6b62\u65f6\u95f4\u4e3afinish_time+7\u5929 3.refund_finish_time\u4e0d\u4e3anull\uff0c\u7ec8\u6b62\u65f6\u95f4\u4e3arefund_finish_time 4.expire_time\u4e0d\u4e3anull\uff0c \u7ec8\u6b62\u65f6\u95f4\u4e3aexpire_time \u548c\u5176\u5b83\u7d2f\u79ef\u578b\u4e8b\u5b9e\u8868\u4e00\u6837\uff0c\u6839\u636e\u7ec8\u6b62\u65f6\u95f4\u5c06\u6570\u636e\u5199\u5230\u5bf9\u5e94\u7684\u5206\u533a\u4e2d\uff0c\u6ca1\u6709\u7ec8\u6b62\u7684\u6570\u636e\u5199\u52309999-99-99\u5206\u533a\u4e2d\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/8-DWS%E5%B1%82/","title":"8-DWS\u5c42","text":"<p> \u7ea6 5229 \u4e2a\u5b57  2 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 105 \u5206\u949f</p> <p>DWS\u5c42\u8868\u8bb0\u5f55\u7684\u662f\u4e0e\u7ef4\u5ea6\u8868\u76f8\u5173\u8054\u7684\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\uff08\u6309\u5929\u805a\u5408\uff09\uff0c\u6240\u4ee5DWS\u5c42\u7684\u5efa\u8868\u601d\u8def\u662f\u4ee5\u7ef4\u5ea6\u6a21\u578b\u4e2d\u7ef4\u5ea6\u8868\u4e3a\u57fa\u51c6\uff0c\u901a\u5e38\u662fDIM\u5c42\u6709\u51e0\u5f20\u7ef4\u5ea6\u8868\uff0cDWS\u5c42\u5c31\u76f8\u5e94\u6709\u51e0\u5f20\u4e3b\u9898\u8868\uff0c\u56e0\u4e3a\u4e0e\u7ef4\u5ea6\u8868\u76f8\u5173\u8054\u7684\u4e8b\u5b9e\u8868\u901a\u5e38\u4f1a\u6709\u5f88\u591a\uff0c\u5e76\u4e14\u6bcf\u5f20\u4e8b\u5b9e\u8868\u4e5f\u4f1a\u6709\u4e0d\u6b62\u4e00\u4e2a\u5ea6\u91cf\u503c\uff0c\u6240\u4ee5DWS\u5c42\u7684\u4e3b\u9898\u8868\u9700\u8981\u7edf\u8ba1\u7684\u805a\u5408\u503c\u4e5f\u4f1a\u6709\u5f88\u591a\uff0c\u4e5f\u5c31\u662fDWS\u5c42\u7684\u8868\u901a\u5e38\u6bd4\u8f83\u5bbd\u3002 DWS\u5c42\u7684\u4e3b\u9898\u5bbd\u8868\u5e76\u4e0d\u9700\u8981\u4fdd\u7559\u7ef4\u5ea6\u8868\u4e2d\u7684\u5b57\u6bb5\uff0c\u56e0\u4e3aDIM\u5c42\u7684\u7ef4\u5ea6\u8868\u672c\u8eab\u4fdd\u5b58\u7684\u5c31\u662f\u5b8c\u6574\u7684\u7ef4\u5ea6\u4fe1\u606f\uff0c\u6240\u4ee5DWS\u5c42\u7684\u4e3b\u9898\u5bbd\u8868\u53ea\u9700\u8981\u4e00\u4e2a\u4e0e\u7ef4\u5ea6\u8868\u5173\u8054\u7684\u7ef4\u5ea6\u5916\u952e\u5373\u53ef\uff0c\u5176\u4f59\u5b57\u6bb5\u5168\u662f\u4e0e\u8be5\u7ef4\u5ea6\u8868\u5173\u8054\u7684\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\u3002\u53c8\u56e0\u4e3a\u4e8b\u5b9e\u8868\u4e0e\u7ef4\u5ea6\u8868\u5173\u8054\uff0c\u6240\u4ee5\u4e8b\u5b9e\u8868\u4e2d\u4e5f\u6709\u7ef4\u5ea6\u5916\u952e\uff0c\u4e8e\u662f\u90a3\u4e2a\u7ef4\u5ea6\u5916\u952e\u4e5f\u53ef\u4ee5\u4ece\u4e8b\u5b9e\u8868\u4e2d\u62ff\u5230\uff08\u5bf9\u4e8b\u5b9e\u8868\u805a\u5408\u65f6\u7684group by\u5b57\u6bb5\u5c31\u662f\u8fd9\u4e2a\u7ef4\u5ea6\u5916\u952e\uff0c\u4e8b\u5b9e\u8868\u6709\u591a\u4e2a\u7ef4\u5ea6\u5916\u952e\uff0c\u5bf9\u6bcf\u4e2a\u7ef4\u5ea6\u5916\u952e\u8fdb\u884c\u5206\u7ec4\u805a\u5408\u7684\u7ed3\u679c\u4f1a\u88ab\u5206\u522b\u5199\u5230DWS\u5c42\u4e0d\u540c\u7684\u4e3b\u9898\u8868\u4e2d\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4DWS\u5c42\u4e00\u5f20\u4e3b\u9898\u8868\u7684\u6570\u636e\u5168\u90e8\u6765\u81ea\u4e8eDWD\u5c42\u591a\u5f20\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u3002</p> <p>\u5bf9\u4e8e\u7ef4\u5ea6\u8868\u4e2d\u7684\u6bcf\u884c\u6570\u636e\uff0c\u5e76\u4e0d\u662fDWS\u5c42\u5bf9\u5e94\u7684\u4e3b\u9898\u8868\u7684\u6bcf\u4e2a\u5206\u533a\u4e2d\u90fd\u6709\u5176\u7edf\u8ba1\u503c\uff0c\u800c\u662f\u53ea\u7edf\u8ba1\u5f53\u5929\u7684\u6d3b\u8dc3\u6570\u636e\u3002\u6bd4\u5982\u7528\u6237\u7ef4\u5ea6\u8868\u4e2d\u6709\u4e00\u4ebf\u6761\u7528\u6237\u6570\u636e\uff0c\u5728DWS\u5c42\u7528\u6237\u4e3b\u9898\u8868\u7684\u6bcf\u4e2a\u5206\u533a\u4e2d\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e00\u4e2a\u7528\u6237\u90fd\u6709\u4e00\u6761\u7edf\u8ba1\u6570\u636e\uff0c\u800c\u662f\u5f53\u5929\u5206\u533a\u53ea\u7edf\u8ba1\u5f53\u5929\u6d3b\u8dc3\u7528\u6237\u6240\u4ea7\u751f\u7684\u6570\u636e\u7684\u805a\u5408\u503c\u3002 \u56e0\u4e3aODS\u5c42\u7684\u6570\u636e\u7ecf\u8fc7DWD\u5c42\u7684\u88c5\u8f7d\u903b\u8f91\u4e4b\u540e\uff0c\u6570\u636e\u5728DWD\u5c42\u6309\u5929\u5206\u533a\u7684\u7ec4\u7ec7\u903b\u8f91\u5c31\u5341\u5206\u6e05\u6670\u4e86\uff0c\u5373\uff1a</p> <ol> <li>\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u6bcf\u4e2a\u5206\u533a\u5b58\u7684\u662f\u5f53\u65e5\u65b0\u589e\u7684\u6570\u636e</li> <li>\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u6bcf\u4e2a\u5206\u533a\u5b58\u7684\u662f\u5f53\u65e5\u96f6\u70b9\u7684\u5168\u91cf\u6570\u636e</li> <li>\u7d2f\u79ef\u578b\u5feb\u7167\u88689999-99-99\u5206\u533a\u5b58\u7684\u662f\u672a\u5b8c\u6210\u7684\u8bb0\u5f55\uff0c\u5176\u5b83\u7684\u6bcf\u65e5\u5206\u533a\u5b58\u7684\u662f\u5df2\u7ecf\u5b8c\u6210\u7684\u8bb0\u5f55</li> </ol> <p>\u6240\u4ee5\u5f88\u5bb9\u6613\u5b9e\u73b0DWS\u5c42\u6bcf\u4e2a\u5206\u533a\u53ea\u7edf\u8ba1\u5f53\u5929\u6d3b\u8dc3\u7528\u6237\uff0c\u5373DWS\u5c42\u6bcf\u5929\u53ea\u4eceDWD\u5c42\u5f53\u65e5\u7684\u5206\u533a\u4e2d\u53d6\u6570\u5373\u53ef\uff08\u5982\u679c\u662f\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u8fd8\u53ef\u80fd\u9700\u8981\u4ece9999-99-99\u5206\u533a\u4e2d\u53d6\u6570\uff1b~~\u4e00\u822c\u5f88\u5c11\u4f1a\u4ece\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u53d6\u6570\uff0c\u4e00\u662f\u56e0\u4e3a\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u6570\u636e\uff0c\u5373\u4f7f\u6ca1\u6709\u6d3b\u8dc3\u7684\u7528\u6237\u4e5f\u4f1a\u5728\u5f53\u65e5\u4fdd\u5b58\u4e00\u4efd\u8bb0\u5f55\uff0c\u4e8c\u662f\u56e0\u4e3a\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4fdd\u5b58\u7684\u67d0\u4e2a\u65f6\u95f4\u7684\u5207\u9762\uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a\u8fc7\u7a0b\u91cf\uff0c\u6240\u4ee5\u5f88\u5c11\u4f1a\u6709\u7edf\u8ba1\u6307\u6807\u9700\u8981\u7edf\u8ba1\u8fd9\u6837\u7684\u6570\u636e~~\uff09\u3002 </p> <p>DWS\u5c42\u6240\u6709\u8868\u7684\u88c5\u8f7d\u601d\u8def\u90fd\u76f8\u540c\uff1a  \u9996\u65e5\u88c5\u8f7d\u7684\u6570\u636e\u6765\u81eaDWD\u5c42\u4e8b\u5b9e\u8868\u7684\u6240\u6709\u5206\u533a\uff0c\u6240\u4ee5\u9996\u65e5\u88c5\u8f7d\u5bf9\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u8fdb\u884c\u805a\u5408\u7684sql\u7684group by \u5b57\u6bb5\u4e0d\u4ec5\u6709\u7ef4\u5ea6\u5916\u952e\uff0c\u8fd8\u6709\u65f6\u95f4\u5b57\u6bb5\uff0c\u56e0\u4e3a\u8981\u7edf\u8ba1\u7684\u662f\u6bcf\u65e5\u7684\u6c47\u603b\u3002\u6c47\u603b\u4e4b\u540e\u518d\u6839\u636e\u8fd9\u4e2a\u65f6\u95f4\u5b57\u6bb5\u5199\u5230DWS\u5c42\u5bf9\u5e94\u7684\u5206\u533a\u4e4b\u4e2d\u3002 \u6bcf\u65e5\u88c5\u8f7d\u65f6\uff0c\u5982\u679c\u662f\u662f\u5bf9\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u8fdb\u884c\u805a\u5408\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u4eceDWD\u5c42\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u5f53\u65e5\u5206\u533a\u4e2d\u603b\u53d6\u6570\uff0c\u5982\u679c\u662f\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u53ef\u80fd\u4e0d\u4ec5\u9700\u8981\u4ece\u5f53\u65e5\u5206\u533a\u4e2d\u53d6\u6570\uff0c\u8fd8\u53ef\u80fd\u9700\u8981\u4ece9999-99-99\u5206\u533a\u4e2d\u53d6\u6570\u3002\u4e0d\u8fc7\u6bcf\u65e5\u88c5\u8f7d\u7684sql\u7684group by\u5b57\u6bb5\u4e0d\u9700\u8981\u6709\u65f6\u95f4\u5b57\u6bb5\uff0c\u53ea\u9700\u8981\u6709\u7ef4\u5ea6\u5916\u952e\u5373\u53ef\uff0c\u56e0\u4e3a\u8fdb\u884c\u6c47\u603b\u7684\u6240\u6709\u6570\u636e\u90fd\u6765\u81ea\u4e8e\u5f53\u65e5\uff08\u5728sql\u7684where\u4e2d\u4f1a\u5148\u6839\u636e\u5206\u533a\u5b57\u6bb5\u5c06\u6570\u636e\u8fc7\u6ee4\u51fa\u6765\u4e86\uff0c\u5982\u679c\u6570\u636e\u8fd8\u6765\u81ea\u4e8e9999-99-99\u5206\u533a\uff0c\u90a3\u4e48\u9664\u4e86\u7528\u5206\u533a\u5b57\u6bb5\u8fc7\u6ee4\u6570\u636e\u5916\uff0c\u80af\u5b9a\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u65f6\u95f4\u5b57\u6bb5\u7528\u4e8e\u8fc7\u6ee4\u6570\u636e\uff09\u3002\u6c47\u603b\u4e4b\u540e\u53ea\u9700\u8981\u5199\u5230DWS\u5c42\u5f53\u65e5\u7684\u5206\u533a\u4e2d\u5373\u53ef\u3002</p> <p>\u4e0b\u9762\u4ee5DWS\u5c42\u7528\u6237\u4e3b\u9898\u5bbd\u8868\u4e3a\u4f8b\u8bf4\u660eDWS\u5c42\u7684\u8868\u5230\u5e95\u4fdd\u5b58\u4e86\u54ea\u4e9b\u6570\u636e\uff0c\u4ee5\u53ca\u5176\u5177\u4f53\u662f\u5982\u4f55\u4eceDWD\u5c42\u8868\u7684\u5206\u533a\u4e2d\u53d6\u6570\u7684\u3002</p> <p>\u7528\u6237\u4e3b\u9898\u5bbd\u8868\u7684\u8868\u7ed3\u6784\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u53ea\u6709user_id\u662fDIM\u5c42\u7528\u6237\u7ef4\u5ea6\u8868\u7684\u7ef4\u5ea6\u5916\u952e\uff0c\u5176\u4f59\u5b57\u6bb5\u5168\u662f\u4e0e\u7528\u6237\u7ef4\u5ea6\u8868\u6709\u5173\u8054\u7684\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\uff1a Text Only<pre><code>DROP TABLE IF EXISTS dws_user_action_daycount;\nCREATE EXTERNAL TABLE dws_user_action_daycount\n(\n\u00a0\u00a0\u00a0\u00a0`user_id` STRING COMMENT '\u7528\u6237id',\n\u00a0\u00a0\u00a0\u00a0`login_count` BIGINT COMMENT '\u767b\u5f55\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`cart_count` BIGINT COMMENT '\u52a0\u5165\u8d2d\u7269\u8f66\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`favor_count` BIGINT COMMENT '\u6536\u85cf\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_count` BIGINT COMMENT '\u4e0b\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_count` BIGINT COMMENT '\u8ba2\u5355\u53c2\u4e0e\u6d3b\u52a8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_reduce_amount` DECIMAL(16,2) COMMENT '\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u6d3b\u52a8)',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_count` BIGINT COMMENT '\u8ba2\u5355\u7528\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_reduce_amount` DECIMAL(16,2) COMMENT '\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u4f18\u60e0\u5238)',\n\u00a0\u00a0\u00a0\u00a0`order_original_amount` DECIMAL(16,2)\u00a0\u00a0COMMENT '\u8ba2\u5355\u5355\u539f\u59cb\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_final_amount` DECIMAL(16,2) COMMENT '\u8ba2\u5355\u603b\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`payment_count` BIGINT COMMENT '\u652f\u4ed8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`payment_amount` DECIMAL(16,2) COMMENT '\u652f\u4ed8\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_order_count` BIGINT COMMENT '\u9000\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_num` BIGINT COMMENT '\u9000\u5355\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_amount` DECIMAL(16,2) COMMENT '\u9000\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_count` BIGINT COMMENT '\u9000\u6b3e\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_num` BIGINT COMMENT '\u9000\u6b3e\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_amount` DECIMAL(16,2) COMMENT '\u9000\u6b3e\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`coupon_get_count` BIGINT COMMENT '\u4f18\u60e0\u5238\u9886\u53d6\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_using_count` BIGINT COMMENT '\u4f18\u60e0\u5238\u4f7f\u7528(\u4e0b\u5355)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_used_count` BIGINT COMMENT '\u4f18\u60e0\u5238\u4f7f\u7528(\u652f\u4ed8)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_good_count` BIGINT COMMENT '\u597d\u8bc4\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_mid_count` BIGINT COMMENT '\u4e2d\u8bc4\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_bad_count` BIGINT COMMENT '\u5dee\u8bc4\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_default_count` BIGINT COMMENT '\u9ed8\u8ba4\u8bc4\u4ef7\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_detail_stats` array&lt;struct&lt;sku_id:string,sku_num:bigint,order_count:bigint,activity_reduce_amount:decimal(16,2),coupon_reduce_amount:decimal(16,2),original_amount:decimal(16,2),final_amount:decimal(16,2)&gt;&gt; COMMENT '\u4e0b\u5355\u660e\u7ec6\u7edf\u8ba1'\n) COMMENT '\u6bcf\u65e5\u7528\u6237\u884c\u4e3a'\nPARTITIONED BY (`dt` STRING)\nSTORED AS PARQUET\nLOCATION '/warehouse/gmall/dws/dws_user_action_daycount/'\nTBLPROPERTIES (\"parquet.compression\"=\"lzo\");\n</code></pre></p> <p>\u9996\u65e5\u88c5\u8f7d\uff1a</p> <p>Text Only<pre><code>`login_count` BIGINT COMMENT '\u767b\u5f55\u6b21\u6570',\n`cart_count` BIGINT COMMENT '\u52a0\u5165\u8d2d\u7269\u8f66\u6b21\u6570',\n`favor_count` BIGINT COMMENT '\u6536\u85cf\u6b21\u6570',\n</code></pre> cart_count\u5b57\u6bb5 \u548c favor_count\u5b57\u6bb5 \u770b\u4f3c\u53ef\u4ee5\u4ece\u52a0\u8d2d\u4e8b\u5b9e\u8868 \u548c \u6536\u85cf\u4e8b\u5b9e\u8868 \u4e2d\u53d6\u6570\uff0c\u4f46\u662f\u8fd9\u4e24\u5f20\u8868\u662f\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u4e0d\u4fdd\u5b58\u4e2d\u95f4\u8fc7\u7a0b\uff0c\u53ea\u4fdd\u5b58\u96f6\u70b9\u7684\u5168\u91cf\u6570\u636e\uff0c\u6240\u4ee5\u4e0d\u80fd\u4ece\u4e2d\u53d6\u6570\u3002\u5176\u5b9e\u4ee5\u4e0a3\u4e2a\u5b57\u6bb5\u5168\u90fd\u662f\u5bf9\u65e5\u5fd7\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u805a\u5408\u7684\u6bcf\u65e5\u7edf\u8ba1\u503c\uff0cDWD\u5c42\u7684\u65e5\u5fd7\u8868\u53ef\u4ee5\u770b\u4f5c\u662f\u7ef4\u5ea6\u5168\u90e8\u9000\u5316\u4e86\u7684\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u5373\u7ef4\u5ea6\u4fe1\u606f\u5168\u90e8\u5b58\u5728\u65e5\u5fd7\u8868\u91cc\u4e86\u3002 \u7edf\u8ba1login_count\uff0c\u6309\u7528\u6237\u548c\u5206\u533a\u5b57\u6bb5\u5206\u7ec4\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5206\u533a\u4fdd\u5b58\u7684\u5c31\u662f\u5f53\u65e5\u7684\u65e5\u5fd7\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u6309\u7528\u6237\u548c\u65e5\u5fd7\u7684\u65f6\u95f4\u6233\u5b57\u6bb5\u5206\u7ec4\uff0c\u4f46\u662f\u56e0\u4e3a\u5206\u533a\u662f\u6309\u65f6\u95f4\u6233\u5b57\u6bb5\u52a8\u6001\u5206\u533a\u751f\u6210\u7684\uff0c\u6240\u4ee5\u65e5\u5fd7\u7684\u5206\u533a\u5b57\u6bb5\u4e0e\u65f6\u95f4\u6233\u5b57\u6bb5\u76f8\u7b49\uff0c\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u5206\u533a\u5b57\u6bb5dt\u5206\u7ec4\uff0c\u8fd9\u6837\u6548\u7387\u66f4\u9ad8\uff09\uff1a Text Only<pre><code>select dt,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) login_count\nfrom dwd_page_log\nwhere user_id is not null\n\u00a0\u00a0and last_page_id is null\ngroup by dt, user_id;\n</code></pre> \u7edf\u8ba1cart_count \u548c\u00a0 favor_count\uff1a Text Only<pre><code>select dt,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(action_id = 'cart_add', 1, 0))\u00a0\u00a0cart_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(action_id = 'favor_add', 1, 0)) favor_count\nfrom dwd_action_log\n-- \u80fd\u52a0\u8d2d\u548c\u4e0b\u5355\u7684\u4e00\u5b9a\u662f\u767b\u5f55\u7528\u6237\uff0c\u6240\u4ee5user_id\u4e00\u5b9a\u4e0d\u4e3anull\uff0c\u53ef\u4ee5\u4e0d\u52a0user_id is not null\nwhere user_id is not null\n\u00a0\u00a0and action_id in ('favor_add', 'cart_add')\ngroup by dt, user_id;\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u9996\u65e5\u88c5\u8f7d\u65f6\uff0c\u5bf9\u4e8e\u6570\u636e\u6765\u81ea\u4e8e\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u805a\u5408\u503c\uff0c\u53ea\u9700\u8981\u5bf9\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u6309 \u7ef4\u5ea6\u5916\u952e \u548c \u5206\u533a\u5b57\u6bb5 \u8fdb\u884c\u5206\u7ec4\u805a\u5408\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5206\u533a\u4fdd\u5b58\u7684\u5c31\u662f\u5f53\u65e5\u7684\u6570\u636e\u3002</p> <p>Text Only<pre><code>`order_count` BIGINT COMMENT '\u4e0b\u5355\u6b21\u6570',\n`order_activity_count` BIGINT COMMENT '\u8ba2\u5355\u53c2\u4e0e\u6d3b\u52a8\u6b21\u6570',\n`order_activity_reduce_amount` DECIMAL(16,2) COMMENT '\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u6d3b\u52a8)',\n`order_coupon_count` BIGINT COMMENT '\u8ba2\u5355\u7528\u5238\u6b21\u6570',\n`order_coupon_reduce_amount` DECIMAL(16,2) COMMENT '\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u4f18\u60e0\u5238)',\n`order_original_amount` DECIMAL(16,2)\u00a0\u00a0COMMENT '\u8ba2\u5355\u5355\u539f\u59cb\u91d1\u989d',\n`order_final_amount` DECIMAL(16,2) COMMENT '\u8ba2\u5355\u603b\u91d1\u989d',\n</code></pre> \u4ee5\u4e0a\u5b57\u6bb5\u662f\u5bf9\u8ba2\u5355\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\u7684\u6bcf\u65e5\u7edf\u8ba1\u503c\uff08\u8ba2\u5355\u4e8b\u5b9e\u8868\u8fd8\u53ef\u4ee5\u6309\u5176\u5b83\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\u7136\u540e\u5199\u5230\u5176\u5b83DWS\u5c42\u7684\u4e3b\u9898\u8868\u4e2d\uff09\uff0c\u6240\u4ee5group by\u5b57\u6bb5\u6709 user_id \u548c create_time\u3002\u56e0\u4e3a\u8ba2\u5355\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5176\u5206\u533a\u5b57\u6bb5\u5e76\u4e0d\u662f\u4e0b\u5355\u65e5\u671f(create_time)\uff0c\u800c\u662f\u8ba2\u5355\u5b8c\u6210\u7684\u65e5\u671f\uff08\u6709\u53ef\u80fd\u662fcancel_time\uff0c\u6216\u8005finish_time\u7b49\uff09\uff0c\u6240\u4ee5group by \u7684\u65f6\u95f4\u5b57\u6bb5\u4e0d\u80fd\u7528\u5206\u533a\u5b57\u6bb5dt\u4ee3\u66ffcreate_time\uff0c\u800c\u53ea\u80fd\u4f7f\u7528create_time\uff0c\u867d\u7136\u8fd9\u4f1a\u9020\u6210\u5168\u8868\u626b\u63cf\u3002 Text Only<pre><code>select date_format(create_time, 'yyyy-MM-dd')\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0dt,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(activity_reduce_amount &gt; 0, 1, 0)) order_activity_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(activity_reduce_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_activity_reduce_amount,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(coupon_reduce_amount &gt; 0, 1, 0))\u00a0\u00a0\u00a0order_coupon_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(coupon_reduce_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_coupon_reduce_amount,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(original_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_original_amount,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(final_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_final_amount\nfrom dwd_order_info\ngroup by date_format(create_time, 'yyyy-MM-dd'), user_id;\n</code></pre></p> <p>Text Only<pre><code>`payment_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u652f\u4ed8\u6b21\u6570',\n`payment_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u652f\u4ed8\u91d1\u989d',\n</code></pre> \u8fd9\u4e24\u4e2a\u5b57\u6bb5\u662f\u5bf9\u652f\u4ed8\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\u7684\u6bcf\u65e5\u7edf\u8ba1\u503c\uff0c\u56e0\u4e3a\u652f\u4ed8\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5e76\u4e14\u7edf\u8ba1\u7684\u662f\u652f\u4ed8\u5b8c\u6210\u8bb0\u5f55\u7684\u6b21\u6570\u548c\u91d1\u989d\uff0c\u6240\u4ee5\u9996\u5148\u53ef\u4ee5\u7528where\u8fc7\u6ee4\u6389\u652f\u4ed8\u672a\u5b8c\u6210\u76849999-99-99\u5206\u533a\uff0c\u7136\u540e\u53ef\u4ee5\u4f7f\u7528\u5206\u533a\u5b57\u6bb5dt\u5206\u7ec4\uff0c\u56e0\u4e3adt\u662f\u6309\u652f\u4ed8\u5b8c\u6210\u7684\u65f6\u95f4callback_time\u52a8\u6001\u5206\u533a\u751f\u6210\u7684\uff0c\u6240\u4ee5callback_time\u4e0edt\u76f8\u7b49\uff0c\u4f7f\u7528dt\u5206\u7ec4\u6548\u7387\u66f4\u9ad8\u3002 Text Only<pre><code>select dt,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) payment_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(payment_amount) payment_amount\nfrom dwd_payment_info\nwhere dt != '9999-99-99'\ngroup by user_id, dt;\n</code></pre> \u603b\u7ed3\uff0c\u9996\u65e5\u88c5\u8f7d\u65f6\uff0c\u5bf9\u4e8e\u6570\u636e\u6765\u81ea\u4e8e\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u805a\u5408\u503c\uff0c\u5982\u679c\u662f\u6309\u7167\u5b8c\u6210\u65f6\u95f4\u5206\u7ec4\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u5206\u533a\u5b57\u6bb5dt\u5206\u533a\uff08\u4e0d\u8fc7\u524d\u63d0\u662f\u5b8c\u6210\u7684\u6807\u5fd7\u53ea\u80fd\u53d6\u51b3\u4e8e\u4e00\u4e2a\u65f6\u95f4\u5b57\u6bb5\u7684\u53d6\u503c\uff09\uff0c\u5982\u679c\u4e0d\u662f\u6309\u5b8c\u6210\u65f6\u95f4\u5206\u533a\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6309\u4e1a\u52a1\u903b\u8f91\u4f7f\u7528\u76f8\u5e94\u7684\u65f6\u95f4\u5206\u7ec4\uff0c\u4e0d\u8fc7\u8fd9\u4f1a\u9020\u6210\u5bf9\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u626b\u63cf\u3002</p> <p>Text Only<pre><code>`refund_order_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u9000\u5355\u6b21\u6570',\n`refund_order_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u9000\u5355\u4ef6\u6570',\n`refund_order_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u9000\u5355\u91d1\u989d',\n</code></pre> \u8fd93\u4e24\u4e2a\u5b57\u6bb5\u662f\u5bf9\u9000\u5355\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\u7684\u6bcf\u65e5\u7edf\u8ba1\u503c\uff0c\u9000\u5355\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u6bcf\u4e2a\u5206\u533a\u4fdd\u5b58\u7684\u662f\u5f53\u65e5\u4ea7\u751f\u7684\u9000\u5355\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6309\u7528\u6237\u548c\u5206\u533a\u5b57\u6bb5\u5206\u7ec4\u805a\u5408\u3002\uff08\u4e0b\u5355\u548c\u652f\u4ed8 \u4e0e \u9000\u5355\u548c\u9000\u6b3e \u90fd\u662f\u5206\u5f00\u7684\u4e24\u5f20\u8868\uff0c\u6ce8\u610f\u7406\u6e05\u5173\u7cfb\u3002\u9000\u5355\u662f\u6ca1\u6709\u72b6\u6001\u7684\u8868\uff0c\u6240\u4ee5\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u9000\u6b3e\u8bb0\u5f55\u662f\u6709\u72b6\u6001\uff0c\u6240\u4ee5\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002\uff09 Text Only<pre><code>select dt,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) refund_order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(refund_num) refund_order_num,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(refund_amount) refund_order_amount\nfrom dwd_order_refund_info\ngroup by user_id, dt;\n</code></pre></p> <p>Text Only<pre><code>`coupon_get_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u4f18\u60e0\u5238\u9886\u53d6\u6b21\u6570',\n`coupon_using_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u4f18\u60e0\u5238\u4f7f\u7528(\u4e0b\u5355)\u6b21\u6570',\n`coupon_used_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u4f18\u60e0\u5238\u4f7f\u7528(\u652f\u4ed8)\u6b21\u6570',\n</code></pre> \u8fd93\u4e24\u4e2a\u5b57\u6bb5\u662f\u5bf9\u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\u7684\u6bcf\u65e5\u7edf\u8ba1\u503c\uff0c\u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5176\u5206\u533a\u5b57\u6bb5\u7531used_time \u548cexpire_time \u786e\u5b9a\uff0c\u5982\u679cused_time \u6216\u8005 expire_time\u4e0d\u4e3anull\uff0c\u5219\u8868\u793a\u8be5\u4f18\u60e0\u5238\u5df2\u7ecf\u4f7f\u7528\u4e86\uff0c\u5e94\u8be5\u5c06\u8bb0\u5f55\u5199\u5230used_time \u6216\u8005 expire_time\u5bf9\u5e94\u65f6\u95f4\u7684\u5206\u533a\u4e2d\uff0c\u5426\u5219\u5e94\u8be5\u628a\u6570\u636e\u5199\u52309999-99-99\u5206\u533a\u4e2d\u3002 coupon_get_count\u4f18\u60e0\u5238\u9886\u53d6\u6b21\u6570\u7684\u5206\u7ec4\u5b57\u6bb5\u5e94\u8be5\u662fget_time\uff0c\u6240\u4ee5\u65e0\u6cd5\u5229\u7528\u5230\u5206\u533a\u5b57\u6bb5dt\uff0c\u4e8e\u662f\u4f1a\u5168\u8868\u626b\u63cf\uff1a Text Only<pre><code>select get_time,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) coupon_get_count\nfrom dwd_coupon_use\nwhere get_time is not null\ngroup by user_id, get_time;\n</code></pre> coupon_using_count\u4f18\u60e0\u5238\u4f7f\u7528(\u4e0b\u5355)\u6b21\u6570\u7684\u5206\u7ec4\u5b57\u6bb5\u662fusing_time\uff0c\u6240\u4ee5\u65e0\u6cd5\u5229\u7528\u5230\u5206\u533a\u5b57\u6bb5dt\uff0c\u4e8e\u662f\u4f1a\u5168\u8868\u626b\u63cf\uff1a Text Only<pre><code>select using_time,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) coupon_using_count\nfrom dwd_coupon_use\nwhere using_time is not null\ngroup by user_id, using_time;\n</code></pre> coupon_used_count\u4f18\u60e0\u5238\u4f7f\u7528(\u652f\u4ed8)\u6b21\u6570\u7684\u5206\u7ec4\u5b57\u6bb5\u662fused_time\uff0c\u53ef\u4ee5\u5229\u7528\u5230\u5206\u533a\u5b57\u6bb5dt\uff0c\u56e0\u4e3a\u9700\u8981\u7edf\u8ba1\u7684\u662f\u4f18\u60e0\u5238\u4f7f\u7528(\u652f\u4ed8)\u6b21\u6570\uff0c\u6240\u4ee5\u8bb0\u5f55\u7684used_time\u4e0d\u80fd\u4e3anull\uff0c\u53c8\u56e0\u4e3aused_time\u4e0d\u80fd\u4e3anull\u7684\u8bb0\u5f55\u4e00\u5b9a\u4e0d\u57289999-99-99\u5206\u533a\u4e2d\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528dt != '9999-99-99'\u5148\u8fc7\u6ee4\u4e00\u90e8\u5206\u6570\u636e\uff0c\u7136\u540e\u518d\u5229\u7528used_time \u548c \u7528\u6237 \u5206\u7ec4\u7edf\u8ba1\uff0c\u8fd9\u6837\u6548\u7387\u66f4\u9ad8\u3002 Text Only<pre><code>select used_time,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) coupon_used_count\nfrom dwd_coupon_use\nwhere used_time is not null\n\u00a0\u00a0and dt != '9999-99-99'\ngroup by user_id, date_format(used_time, 'yyyy-MM-dd');\n</code></pre></p> <p>\u628a\u4ee5\u4e0a3\u4e2a\u67e5\u8be2\u7ed3\u679c\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u6ce8\u610f\u9700\u8981\u4f7f\u7528\u5168\u5916\u8fdefull outer join\uff0c\u56e0\u4e3a\u4e00\u4e2a\u7528\u6237\u53ef\u80fd\u53ea\u9886\u5238\u4e86\u5374\u6ca1\u6709\u7528\u5238\u4e0b\u5355\u6216\u652f\u4ed8\uff0c\u4ee5\u53ca\u7c7b\u4f3c\u7684\u60c5\u51b5\u3002 Text Only<pre><code>select coalesce(t1.get_time, t2.using_time, t3.used_time) dt,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0coalesce(t1.user_id, t2.user_id, t3.user_id)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(coupon_get_count, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0coupon_get_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(coupon_using_count, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0coupon_using_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(coupon_used_count, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0coupon_used_count\nfrom (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select get_time,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) coupon_get_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwd_coupon_use\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where get_time is not null\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by user_id, get_time\n\u00a0\u00a0\u00a0\u00a0\u00a0) t1\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0full join\n\u00a0\u00a0\u00a0\u00a0\u00a0(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select using_time,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) coupon_using_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwd_coupon_use\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where using_time is not null\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by user_id, using_time\n\u00a0\u00a0\u00a0\u00a0\u00a0) t2\n\u00a0\u00a0\u00a0\u00a0\u00a0on t1.user_id = t2.user_id and t1.get_time = t2.using_time\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0full join\n\u00a0\u00a0\u00a0\u00a0\u00a0(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select used_time,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) coupon_used_count\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwd_coupon_use\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where used_time is not null\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and dt != '9999-99-99'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0group by user_id, date_format(used_time, 'yyyy-MM-dd')\n\u00a0\u00a0\u00a0\u00a0\u00a0) t3\n\u00a0\u00a0\u00a0\u00a0\u00a0on nvl(t1.user_id, t2.user_id) = t3.user_id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0and nvl(t1.get_time, t2.using_time) = t3.used_time;\n</code></pre> \u6ce8\u610f\uff0c2\u4e2a\u4ee5\u4e0a\u8868\u505a\u5168\u5916\u8fde\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u4f7f\u7528nvl\u6216\u8005coalesce\u51fd\u6570\u5904\u7406\u524d\u9762\u591a\u5f20\u8868\u8fde\u63a5\u7ed3\u679c\u7684\u8fde\u63a5\u5b57\u6bb5\u540e\uff0c\u518d\u4e0e\u540e\u9762\u7684\u8868\u505a\u8fde\u63a5\u3002</p> <p>\u6bcf\u65e5\u88c5\u8f7d\uff1a \u6bcf\u65e5\u88c5\u8f7d\u7684sql\u4e0e\u9996\u65e5\u88c5\u8f7d\u7684sql\u53ea\u6709\u4e00\u70b9\u4e0d\u540c\uff0c\u90a3\u5c31\u662f\u6bcf\u65e5\u88c5\u8f7dsql\u7684group by\u4e0d\u5728\u9700\u8981\u4f7f\u7528\u65f6\u95f4\u5b57\u6bb5\u4e86\uff0c\u56e0\u4e3a\u4f1a\u4f7f\u7528where\u8fc7\u6ee4\u51faDWD\u5c42\u5f53\u65e5\u7684\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6309\u7ef4\u5ea6\u5916\u952e\u5206\u7ec4\u805a\u5408\u7136\u540e\u5199\u5230DWS\u5c42\u5f53\u65e5\u5206\u533a\u5373\u53ef\u3002 \u5bf9\u4e8eDWD\u5c42\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u56e0\u4e3a\u589e\u91cf\u6570\u636e\u53ea\u4f1a\u5199\u5230\u5f53\u65e5\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u6240\u4ee5\u6bcf\u65e5\u88c5\u8f7d\u7684sql\u53ea\u9700\u8981\u5148\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' \u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\uff0c\u7136\u540e\u518d\u4f7f\u7528\u5176\u5b83\u8fc7\u6ee4\u6761\u4ef6\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0c\u6bd4\u5982\u4f7f\u7528\u65e5\u5fd7\u8868\u7edf\u8ba1login_count Text Only<pre><code>`login_count` BIGINT COMMENT '\u767b\u5f55\u6b21\u6570',\n</code></pre> Text Only<pre><code>select user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*) login_count\nfrom dwd_page_log\n`where dt = '2020-06-15'`\n\u00a0\u00a0and user_id is not null\n\u00a0\u00a0and last_page_id is null\ngroup by user_id;\n</code></pre></p> <p>\u5bf9\u4e8eDWD\u5c42\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u56e0\u4e3a\u589e\u91cf\u6570\u636e\u53ea\u53ef\u80fd\u4f1a\u5199\u5230\u4e24\u4e2a\u5206\u533a\u4e2d\uff0c\u5373\u5f53\u65e5\u65b0\u589e\u5b8c\u6210\u7684\u8bb0\u5f55\u5199\u5230\u5f53\u65e5\u5206\u533a\uff0c\u5f53\u65e5\u65b0\u589e\u672a\u5b8c\u6210\u7684\u8bb0\u5f55\u5199\u52309999-99-99\u5206\u533a\uff0c\u6240\u4ee5\u9700\u8981\u7ed3\u5408\u5177\u4f53\u4e1a\u52a1\u573a\u666f\u6765\u9009\u62e9\u8fc7\u6ee4\u6761\u4ef6\uff0c\u5373\u4ece\u8fd93\u4e2a\u6761\u4ef6\u4e2d\u9009\u51fa\u4e00\u4e2a\uff1awhere dt='\u5f53\u65e5\u65e5\u671f' \u6216\u8005 where dt='9999-99-99' \u6216\u8005\u00a0where dt='\u5f53\u65e5\u65e5\u671f' or where dt='9999-99-99'\uff0c\u4f5c\u4e3a\u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\u7684\u6761\u4ef6\uff0c\u7136\u540e\u518d\u4f7f\u7528\u5176\u5b83\u8fc7\u6ee4\u6761\u4ef6\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u3002 \u6bd4\u5982\u5bf9\u8ba2\u5355\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\uff0c\u56e0\u4e3a\u8ba2\u5355\u4e8b\u5b9e\u8868\u8fd9\u91cc\u9700\u8981\u901a\u8fc7\u7684\u4e0b\u5355\u6b21\u6570\u7b49\u4e0e\u8ba2\u5355\u72b6\u6001\u65e0\u5173\uff0c\u53ea\u4e0e\u4e0b\u5355\u65e5\u671f\u6709\u5173\u7684\u805a\u5408\u503c\uff0c\u6240\u4ee5\u8fd9\u91cc\u5fc5\u987b\u4f7f\u7528create_time\u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\uff0c\u53c8\u56e0\u4e3a\u5f53\u65e5\u65b0\u589e\u8ba2\u5355\u8981\u4e48\u662f\u5df2\u5b8c\u6210\u7684\uff0c\u8981\u4e48\u672a\u5b8c\u6210\u7684\uff0c\u53cd\u6b63\u4e00\u5b9a\u662f\u5728\u5f53\u65e5\u5206\u533a\u548c9999-99-99\u5206\u533a\u4e2d\uff0c\u6240\u4ee5\u53ef\u4ee5\u5148\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' or where dt='9999-99-99' \u6309\u5206\u533a\u8fc7\u6ee4\u4e00\u4e0b\uff0c\u7136\u540e\u518d\u4f7f\u7528create_time\u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\uff0c\u8fd9\u6837\u6548\u7387\u66f4\u9ad8\u3002 Text Only<pre><code>select user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(activity_reduce_amount &gt; 0, 1, 0)) order_activity_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(activity_reduce_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_activity_reduce_amount,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(coupon_reduce_amount &gt; 0, 1, 0))\u00a0\u00a0\u00a0order_coupon_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(coupon_reduce_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_coupon_reduce_amount,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(original_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_original_amount,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(final_amount)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0order_final_amount\nfrom dwd_order_info\n`where (dt = '9999-99-99' or dt = '2020-06-15')`\n\u00a0\u00a0and date_format(create_time, 'yyyy-MM-dd') = '2020-06-15'\ngroup by user_id;\n</code></pre></p> <p>\u518d\u6bd4\u5982\u5bf9\u652f\u4ed8\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\uff0c\u56e0\u4e3a\u662f\u5bf9\u5f53\u65e5\u5df2\u5b8c\u6210\u7684\u8ba2\u5355\u8fdb\u884c\u7edf\u8ba1\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f'\u8fc7\u6ee4\u51fa\u6570\u636e\uff1a Text Only<pre><code>select user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0payment_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(payment_amount) payment_amount\nfrom dwd_payment_info\n`where dt = '2020-06-15'`\ngroup by user_id;\n</code></pre></p> <p>\u518d\u6bd4\u5982\u5bf9\u4f18\u60e0\u5238\u9886\u7528\u4e8b\u5b9e\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\uff0c\u56e0\u4e3a\u53bb\u6389\u9996\u65e5\u88c5\u8f7d3\u6761sql\u7684group by\u540e\u9762\u7684\u65f6\u95f4\u5b57\u6bb5\u540e\uff0c3\u4e2a\u5b50\u67e5\u8be2\u7684\u6bcf\u65e5\u88c5\u8f7d\u7684sql\u7684group by\u5b57\u6bb5\u76f8\u540c\uff0c\u53ea\u5269\u4e0b\u4e00\u4e2auser_id\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c063\u4e2a\u805a\u5408\u503c\u7684\u8ba1\u7b97\u653e\u5728\u4e00\u6761sql\u8bed\u53e5\u4e2d\uff0c\u53c8\u56e0\u4e3a\u5f53\u65e5\u7684\u6570\u636e\u53ef\u80fd\u6765\u81ea\u5f53\u65e5\u5206\u533a\u548c9999-99-99\u5206\u533a\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' or where dt='9999-99-99' \u6309\u5206\u533a\u8fc7\u6ee4\u4e00\u4e0b\uff1a Text Only<pre><code>select user_id,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(get_time = '2020-06-15', 1, 0)),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(using_time = '2020-06-15', 1, 0)),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(`if`(used_time = '2020-06-15', 1, 0))\nfrom dwd_coupon_use\n`where (dt = \"2020-06-15\" or dt = '9999-99-99')`\n\u00a0\u00a0and (get_time = '2020-06-15'\n\u00a0\u00a0\u00a0\u00a0or using_time = '2020-06-15'\n\u00a0\u00a0\u00a0\u00a0or used_time = '2020-06-15')\ngroup by user_id;\n</code></pre></p> <p>\u6700\u540e\u662f\u5c06\u4e0a\u9762\u9996\u65e5\u88c5\u8f7d\u548c\u6bcf\u65e5\u88c5\u8f7d\u7684sql\u5206\u522b\u62fc\u88c5\u5728\u4e00\u8d77\u7ec4\u6210\u9996\u65e5\u548c\u6bcf\u65e5\u5b8c\u6574\u7684\u7528\u4e8e\u88c5\u8f7dDWS\u5c42\u7528\u6237\u4e3b\u9898\u5bbd\u8868\u7684sql\uff0c\u9700\u8981\u6ce8\u610f3\u70b9\uff1a 1.\u9700\u8981\u4f7f\u7528\u5168\u5916\u8fde\u5c06\u4e0a\u8ff0sql\u67e5\u8be2\u7684\u7ed3\u679c\u5173\u8054\u5728\u4e00\u8d77\uff0c\u56e0\u4e3a\u4eca\u65e5\u6d3b\u8dc3\u7528\u6237\u6709\u6781\u5927\u53ef\u80fd\u662f\u53ea\u67d0\u51e0\u9879\u805a\u5408\u503c\u6709\u503c\u3002 2.2\u5f20\u4ee5\u4e0a\u5168\u5916\u8fde\u65f6\u9700\u8981\u4f7f\u7528nvl\u51fd\u6570 \u6216\u8005 coalesce\u51fd\u6570\u5904\u7406\u524d\u9762\u8fde\u63a5\u7ed3\u679c\u4e0e\u540e\u9762\u8868\u505a\u8fde\u63a5\u65f6\u7684\u8fde\u63a5\u6761\u4ef6 3.select\u4e2d\u9700\u8981\u4f7f\u7528coalesce\u51fd\u6570\u5904\u7406\u6700\u540e\u8fde\u63a5\u7ed3\u679c\u7684\u8fde\u63a5\u5b57\u6bb5\uff0c\u4f7f\u7528nvl\u51fd\u6570\u5904\u7406\u5176\u5b83\u5b57\u6bb5\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u4e0d\u4f7f\u7528\u5168\u5916\u8fde\uff0c\u4f46\u53ef\u4ee5\u5b9e\u73b0\u5168\u5916\u8fde\u6548\u679c\u7684\u65b9\u6cd5\u6765\u62fc\u63a5\u8fd9\u4e9b\u5b50\u67e5\u8be2\uff0c\u5373\u4f7f\u7528union\u3002\u5177\u4f53\u8fc7\u7a0b\u662f\uff0c\u5148\u5c06\u6240\u6709\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u8865\u96f6\u5bf9\u9f50\uff0c\u7136\u540euion\u5728\u4e00\u8d77\u4e4b\u540e\uff0c\u6309group by \u65f6\u7684\u5b57\u6bb5\u5206\u7ec4\u805a\u5408\u3002\u867d\u7136\u4f7f\u7528union\u5b9e\u73b0\u5168\u5916\u8fde\u8981\u6bd4\u76f4\u63a5\u4f7f\u7528\u5168\u5916\u8fde\u7684\u6548\u7387\u9ad8\uff0c\u4f46\u662f\u5e76\u4e0d\u662f\u6240\u6709\u6761\u4ef6\u90fd\u53ef\u4f7f\u7528uion\u6765\u4ee3\u66fffull join\uff0cunion\u5b9e\u73b0\u5168\u5916\u8fde\u53ea\u9002\u7528\u4e8e\u7528\u805a\u5408\u503c\u5168\u662f\u6570\u5b57\u7c7b\u578b\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u8865\u96f6\u4e4b\u540e\u5206\u7ec4\u518d\u53ef\u4ee5\u7528sum\u6c42\u548c\uff0c\u6bd4\u5982\u7528\u6237\u4e3b\u9898\u8868\u56e0\u4e3a\u5305\u542barray\u7c7b\u578b\u7684\u805a\u5408\u503c\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528union\u5b9e\u73b0\u5168\u5916\u8fde\u3002</p> <p>\u603b\u7ed3\uff1a ~~1.\u5bf9\u4e8e\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7edf\u8ba1\uff0c\u6570\u636e\u4e00\u822c\u4e0d\u6765\u81ea\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u800c\u662f\u6765\u81ea\u65e5\u5fd7\u8868\uff0cDWD\u5c42\u7684\u65e5\u5fd7\u8868\u53ef\u4ee5\u770b\u4f5c\u662f\u7ef4\u5ea6\u5168\u90e8\u9000\u5316\u4e86\u7684\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002~~ 2.\u4e00\u5f20\u4e8b\u5b9e\u8868\u6709\u591a\u4e2a\u7ef4\u5ea6\u5916\u952e\uff0c\u5bf9\u6bcf\u4e2a\u7ef4\u5ea6\u5916\u952e\u5206\u7ec4\u805a\u5408\u7684\u7edf\u8ba1\u503c\u4f1a\u5199\u5230\u4e0d\u540c\u7684DWS\u5c42\u7684\u4e3b\u9898\u8868\u4e2d\uff0c\u4e5f\u5c31\u662fDWS\u5c42\u7684\u6bcf\u5f20\u4e3b\u9898\u8868\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9DWD\u5c42\u4e8b\u5b9e\u8868\u4e0d\u540c\u89d2\u5ea6\u7684\u805a\u5408\u3002</p> <p>3.\u9996\u65e5\u88c5\u8f7d\u5206\u7ec4\u805a\u5408\u7684sql\u7684group by\u9700\u8981\u4f7f\u7528 \u7ef4\u5ea6\u5916\u952e \u548c \u65f6\u95f4\u5b57\u6bb5\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5206\u533a\u4fdd\u5b58\u7684\u5c31\u662f\u5f53\u65e5\u7684\u6570\u636e\u3002 4.\u5982\u679c\u9996\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u8be5\u65f6\u95f4\u5b57\u6bb5\u53ef\u4ee5\u662f \u5206\u533a\u5b57\u6bb5\u3002 5.\u5982\u679c\u9996\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5982\u679c\u662f\u6309\u7167\u5b8c\u6210\u65f6\u95f4\u5206\u7ec4\uff0c\u90a3\u4e48\u65f6\u95f4\u5b57\u6bb5\u53ef\u4ee5\u4f7f\u7528\u5206\u533a\u5b57\u6bb5dt\uff08\u4e0d\u8fc7\u524d\u63d0\u662f\u5b8c\u6210\u7684\u6807\u5fd7\u53ea\u662f\u4e00\u4e2a\u65f6\u95f4\u5b57\u6bb5\u7684\u53d6\u503c\uff09\uff0c\u5982\u679c\u4e0d\u662f\u6309\u5b8c\u6210\u65f6\u95f4\u5206\u7ec4\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6309\u4e1a\u52a1\u903b\u8f91\u4f7f\u7528\u76f8\u5e94\u7684\u65f6\u95f4\u5b57\u6bb5\u5206\u7ec4\uff0c\u4e0d\u8fc7\u8fd9\u4f1a\u9020\u6210\u5bf9\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u626b\u63cf\u3002</p> <p>6.\u6bcf\u65e5\u88c5\u8f7dsql\u7684group by\u4e0d\u5728\u9700\u8981\u4f7f\u7528\u65f6\u95f4\u5b57\u6bb5\u4e86\uff0c\u53ea\u9700\u8981\u6309\u7ef4\u5ea6\u5b57\u6bb5\u5206\u7ec4\u5373\u53ef\u3002\u56e0\u4e3a\u4f1a\u4f7f\u7528where\u8fc7\u6ee4\u51faDWD\u5c42\u5f53\u65e5\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u4f7f\u7528\u5176\u5b83\u8fc7\u6ee4\u6761\u4ef6\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0c\u6700\u540e\u4f7f\u7528\u7ef4\u5ea6\u5916\u952e\u5206\u7ec4\u805a\u5408\u3002 7.\u5982\u679c\u6bcf\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u90a3\u4e48\u9700\u8981\u5148\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' \u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\u3002 8.\u5982\u679c\u6bcf\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u90a3\u4e48\u9700\u8981\u5148\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' \u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\uff0c\u90a3\u4e48\u9700\u8981\u4ece\u8fd93\u4e2a\u6761\u4ef6\u4e2d\u9009\u51fa\u4e00\u4e2a\uff1awhere dt='\u5f53\u65e5\u65e5\u671f' \u6216\u8005 where dt='9999-99-99' \u6216\u8005\u00a0where dt='\u5f53\u65e5\u65e5\u671f' or where dt='9999-99-99'\uff0c\u4f5c\u4e3a\u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\u7684\u6761\u4ef6\u3002</p>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/9-DWT%E5%B1%82/","title":"9-DWT\u5c42","text":"<p> \u7ea6 3421 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 68 \u5206\u949f</p> <p>DWS\u5c42\u662f\u5bf9DWD\u5c42\u4e8b\u5b9e\u8868\u6bcf\u65e5\u6570\u636e\u7684\u6c47\u603b\uff0c\u800cDWT\u5c42\u662f\u5bf9DWD\u5c42\u6700\u8fd1n\u5929\u6570\u636e\u7684\u7d2f\u79ef\u6c47\u603b\uff0c\u5373\u53ef\u4ee5\u662f\u6700\u8fd11\u5929\u3001\u6700\u8fd17\u5929\u3001\u6700\u8fd130\u5929 \u548c \u4ece\u5f00\u59cb\u81f3\u4eca\u7684\u7d2f\u79ef\u6c47\u603b\u3002\u56e0\u4e3aDWS\u5c42\u5df2\u7ecf\u7edf\u8ba1\u4e86DWD\u5c42\u6bcf\u4e00\u5929\u7684\u6570\u636e\uff0c\u6240\u4ee5DWT\u5c42\u76f4\u63a5\u5bf9DWS\u5c42\u6570\u636e\u8fdb\u884c\u6c47\u603b\u5373\u53ef\uff0c\u4e5f\u5c31\u662f\u8bf4DWT\u5c42\u7684\u8868\u4e0eDWS\u5c42\u8868\u5177\u6709\u5bf9\u5e94\u5173\u7cfb\uff0cDWS\u5c42\u6709\u51e0\u5f20\u8868DWT\u5c42\u5c31\u6709\u51e0\u5f20\u8868\uff0c\u6bcf\u5f20DWT\u5c42\u8868\u7684\u6570\u636e\u662f\u5bf9DWS\u5c42\u5bf9\u5e94\u8868\u7684\u6570\u636e\u7684\u7d2f\u79ef\u6c47\u603b\uff0c\u6bd4\u5982DWT\u5c42\u7528\u6237\u4e3b\u9898\u7684\u6570\u636e\u6765\u81ea\u4e8eDWS\u5c42\u7528\u6237\u4e3b\u9898\u8868\u7684\u6570\u636e\uff0c\u6240\u4ee5DWT\u5c42\u8868\u7684\u5b57\u6bb5\u6570\u91cf\u4e00\u822c\u662fDWS\u5c42\u5bf9\u5e94\u8868\u5b57\u6bb5\u6570\u91cf\u7684\u82e5\u5e72\u500d\u3002 \u6bd4\u5982DWT\u5c42\u7684\u7528\u6237\u4e3b\u9898\u8868\uff1a Text Only<pre><code>CREATE EXTERNAL TABLE dwt_user_topic\n(\n\u00a0\u00a0\u00a0\u00a0`user_id`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u7528\u6237id',\n\u00a0\u00a0\u00a0\u00a0`login_date_first`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u9996\u6b21\u6d3b\u8dc3\u65e5\u671f',\n\u00a0\u00a0\u00a0\u00a0`login_date_last`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u672b\u6b21\u6d3b\u8dc3\u65e5\u671f',\n\u00a0\u00a0\u00a0\u00a0`login_date_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u6700\u8fd11\u65e5\u767b\u5f55\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_last_1d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u767b\u5f55\u5929\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u767b\u5f55\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_last_7d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u767b\u5f55\u5929\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u767b\u5f55\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_last_30d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u767b\u5f55\u5929\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u767b\u5f55\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`login_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u767b\u5f55\u5929\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_date_first`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u9996\u6b21\u4e0b\u5355\u65f6\u95f4',\n\u00a0\u00a0\u00a0\u00a0`order_date_last`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u672b\u6b21\u4e0b\u5355\u65f6\u95f4',\n\u00a0\u00a0\u00a0\u00a0`order_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u4e0b\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u8ba2\u5355\u53c2\u4e0e\u6d3b\u52a8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_reduce_last_1d_amount`\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u6d3b\u52a8)',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u4e0b\u5355\u7528\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_reduce_last_1d_amount`\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u4f18\u60e0\u5238)',\n\u00a0\u00a0\u00a0\u00a0`order_last_1d_original_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u539f\u59cb\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_last_1d_final_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u6700\u7ec8\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u4e0b\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u8ba2\u5355\u53c2\u4e0e\u6d3b\u52a8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_reduce_last_7d_amount`\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u6d3b\u52a8)',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u4e0b\u5355\u7528\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_reduce_last_7d_amount`\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u4f18\u60e0\u5238)',\n\u00a0\u00a0\u00a0\u00a0`order_last_7d_original_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u539f\u59cb\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_last_7d_final_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u6700\u7ec8\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u4e0b\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u8ba2\u5355\u53c2\u4e0e\u6d3b\u52a8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_reduce_last_30d_amount` DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u6d3b\u52a8)',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u4e0b\u5355\u7528\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_reduce_last_30d_amount`\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u4f18\u60e0\u5238)',\n\u00a0\u00a0\u00a0\u00a0`order_last_30d_original_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u539f\u59cb\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_last_30d_final_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u6700\u7ec8\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u4e0b\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u8ba2\u5355\u53c2\u4e0e\u6d3b\u52a8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_activity_reduce_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u6d3b\u52a8)',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u4e0b\u5355\u7528\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`order_coupon_reduce_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u8ba2\u5355\u51cf\u514d\u91d1\u989d(\u4f18\u60e0\u5238)',\n\u00a0\u00a0\u00a0\u00a0`order_original_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u539f\u59cb\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`order_final_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u6700\u7ec8\u4e0b\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`payment_date_first`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u9996\u6b21\u652f\u4ed8\u65f6\u95f4',\n\u00a0\u00a0\u00a0\u00a0`payment_date_last`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u672b\u6b21\u652f\u4ed8\u65f6\u95f4',\n\u00a0\u00a0\u00a0\u00a0`payment_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u652f\u4ed8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`payment_last_1d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u652f\u4ed8\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`payment_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u652f\u4ed8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`payment_last_7d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u652f\u4ed8\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`payment_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u652f\u4ed8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`payment_last_30d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u652f\u4ed8\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`payment_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u652f\u4ed8\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`payment_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u652f\u4ed8\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u9000\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_1d_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u9000\u5355\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_1d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u9000\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u9000\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_7d_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u9000\u5355\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_7d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u9000\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u9000\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_30d_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u9000\u5355\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_last_30d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u9000\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_order_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u9000\u5355\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u9000\u5355\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_order_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u9000\u5355\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u9000\u6b3e\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_1d_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u9000\u6b3e\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_1d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd11\u65e5\u9000\u6b3e\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u9000\u6b3e\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_7d_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u9000\u6b3e\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_7d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd17\u65e5\u9000\u6b3e\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u9000\u6b3e\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_30d_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u9000\u6b3e\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_last_30d_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u6700\u8fd130\u65e5\u9000\u6b3e\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u9000\u6b3e\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_num`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u9000\u6b3e\u4ef6\u6570',\n\u00a0\u00a0\u00a0\u00a0`refund_payment_amount`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0DECIMAL(16, 2) COMMENT '\u7d2f\u79ef\u9000\u6b3e\u91d1\u989d',\n\u00a0\u00a0\u00a0\u00a0`cart_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u52a0\u5165\u8d2d\u7269\u8f66\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`cart_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u52a0\u5165\u8d2d\u7269\u8f66\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`cart_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u52a0\u5165\u8d2d\u7269\u8f66\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`cart_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u52a0\u5165\u8d2d\u7269\u8f66\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`favor_last_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u6536\u85cf\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`favor_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u6536\u85cf\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`favor_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u6536\u85cf\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`favor_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u6536\u85cf\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_1d_get_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u9886\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_1d_using_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u7528\u5238(\u4e0b\u5355)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_1d_used_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u7528\u5238(\u652f\u4ed8)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_7d_get_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u9886\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_7d_using_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u7528\u5238(\u4e0b\u5355)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_7d_used_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u7528\u5238(\u652f\u4ed8)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_30d_get_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u9886\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_30d_using_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u7528\u5238(\u4e0b\u5355)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_last_30d_used_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u7528\u5238(\u652f\u4ed8)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_get_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u9886\u5238\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_using_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u7528\u5238(\u4e0b\u5355)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`coupon_used_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u7528\u5238(\u652f\u4ed8)\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_1d_good_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u597d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_1d_mid_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u4e2d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_1d_bad_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u5dee\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_1d_default_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u9ed8\u8ba4\u8bc4\u4ef7\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_7d_good_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u597d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_7d_mid_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u4e2d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_7d_bad_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u5dee\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_7d_default_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u9ed8\u8ba4\u8bc4\u4ef7\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_30d_good_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u597d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_30d_mid_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u4e2d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_30d_bad_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u5dee\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_last_30d_default_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u9ed8\u8ba4\u8bc4\u4ef7\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_good_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u597d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_mid_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u4e2d\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_bad_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u5dee\u8bc4\u6b21\u6570',\n\u00a0\u00a0\u00a0\u00a0`appraise_default_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u9ed8\u8ba4\u8bc4\u4ef7\u6b21\u6570'\n) COMMENT '\u4f1a\u5458\u4e3b\u9898\u5bbd\u8868'\n\u00a0\u00a0\u00a0\u00a0PARTITIONED BY (`dt` STRING)\n\u00a0\u00a0\u00a0\u00a0STORED AS PARQUET\n\u00a0\u00a0\u00a0\u00a0LOCATION '/warehouse/gmall/dwt/dwt_user_topic/'\n\u00a0\u00a0\u00a0\u00a0TBLPROPERTIES (\"parquet.compression\" = \"lzo\");\n</code></pre></p> <p>DWT\u5c42\u6570\u636e\u7684\u88c5\u8f7d\u903b\u8f91\uff1a  \u9996\u65e5\u88c5\u8f7d\u65f6\u76f4\u63a5\u5bf9DWS\u5c42\u5bf9\u5e94\u8868\u7684\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u6c47\u603b\uff0c\u7136\u540e\u5199\u5230DWT\u5c42\u8868\u7684\u5f53\u65e5\u5206\u533a\u4e2d\uff08\u56e0\u4e3a\u662f\u7d2f\u79ef\u6c47\u603b\u884c\u4e3a\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5199\u5230DWT\u5f53\u65e5\u7684\u5206\u533a\u4e2d\uff09\u3002 \u6bcf\u65e5\u88c5\u8f7d\u65f6\uff0c\u53ef\u4ee5\u50cf\u9996\u65e5\u88c5\u8f7d\u90a3\u6837\u540c\u6837\u76f4\u63a5\u5bf9DWS\u5c42\u5bf9\u5e94\u8868\u7684\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u6c47\u603b\uff0c\u4f46\u662f\u8fd9\u6837\u6548\u7387\u592a\u4f4e\uff0c\u800c\u662f\u91c7\u7528\u5c06DWS\u5c42\u5f53\u65e5\u65b0\u589e\u7684\u6570\u636e\u4e0eDWT\u5c42\u524d\u4e00\u65e5\u6c47\u603b\u7684\u6570\u636e\u8fdb\u884c\u6c47\u603b\u7684\u65b9\u5f0f\u5f97\u5230DWT\u5c42\u4eca\u65e5\u7684\u6c47\u603b\u662f\u6570\u636e\uff0c\u8fd9\u6837\u6548\u7387\u66f4\u9ad8\u3002 \u56e0\u4e3aDWT\u5c42\u6570\u636e\u7684\u6700\u8fd1n\u5929\u7684\u7edf\u8ba1\u503c\u7684\u65f6\u6548\u6027\u5f88\u9ad8\uff0c\u6240\u4ee5\u4e00\u822c\u53ea\u4f1a\u4fdd\u7559\u4e24\u5929\u6570\u636e\uff0c\u4e8e\u662f\u5728\u6bcf\u65e5\u88c5\u8f7d\u65f6\u4f1a\u5220\u9664DWT\u5c42\u4e24\u5929\u524d\u7684\u5206\u533a\u3002</p> <p>\u4eceDWT\u5c42\u9996\u65e5\u88c5\u8f7d\u548c\u6bcf\u65e5\u88c5\u8f7d\u7684\u903b\u8f91\u53ef\u4ee5\u770b\u51fa\uff0cDWT\u5c42\u6bcf\u4e2a\u5206\u533a\u662f\u5bf9\u622a\u6b62\u5230\u5f53\u65e5DWS\u5c42\u6240\u6709\u5206\u533a\u6570\u636e\u7684\u6c47\u603b\uff0c\u6240\u4ee5DWT\u5c42\u7684\u6bcf\u65e5\u5206\u533a\u4fdd\u5b58\u7684\u662f\u5bf9\u5e94\u7ef4\u5ea6\u8868\u6240\u6709\u8bb0\u5f55\u7684\u7edf\u8ba1\u503c\uff0c\u5373DWT\u5c42\u7684\u6570\u636e\u662f\u5168\u91cf\u7684\uff0c\u6bd4\u5982DWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u4fdd\u5b58\u7684\u662f\u6240\u6709\u7684\u7528\u6237\u7684\u6700\u8fd11\u5929\u3001\u6700\u8fd17\u5929\u3001\u6700\u8fd130\u5929\u3001\u4ece\u5f00\u59cb\u81f3\u4eca\u7684\u7edf\u8ba1\u503c\uff0c\u8fd9\u662f\u4e0eDWS\u5c42\u4e0d\u540c\u7684\u5730\u65b9\uff0cDWS\u5c42\u6bcf\u65e5\u5206\u533a\u53ea\u4fdd\u5b58\u5f53\u65e5\u6d3b\u8dc3\u8bb0\u5f55\u7684\u5f53\u65e5\u7edf\u8ba1\u503c\u3002</p> <p>\u9996\u65e5\u88c5\u8f7d\uff1a \u6bd4\u5982\u7edf\u8ba1DWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u7684\u8fd9\u51e0\u4e2a\u5b57\u6bb5 Text Only<pre><code>`login_date_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u6700\u8fd11\u65e5\u767b\u5f55\u6b21\u6570',\n`login_last_1d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u767b\u5f55\u5929\u6570',\n`login_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u767b\u5f55\u6b21\u6570',\n`login_last_7d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u767b\u5f55\u5929\u6570',\n`login_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u767b\u5f55\u6b21\u6570',\n`login_last_30d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u767b\u5f55\u5929\u6570',\n`login_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u767b\u5f55\u6b21\u6570',\n`login_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u767b\u5f55\u5929\u6570',\n</code></pre> \u9700\u8981\u4eceDWS\u5c42\u7528\u6237\u4e3b\u9898\u8868\u7684\u6240\u6709\u5206\u533a\u4e2d\u53d6\u6570\uff0c\u7136\u540e\u6309\u7528\u6237\u5206\u7ec4\uff0c\u63a5\u7740\u6309\u65f6\u95f4\u805a\u5408\uff1a Text Only<pre><code>select sum(if(dt = '2020-06-14'), login_count, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0login_date_1d_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(dt = '2020-06-14'), 1, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0login_last_1d_day_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(date_add(dt, 6) &gt;= '2020-06-14'), login_count, 0)\u00a0\u00a0login_last_7d_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(date_add(dt, 6) &gt;= '2020-06-14'), 1, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0login_last_7d_day_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(date_add(dt, 29) &gt;= '2020-06-14'), login_count, 0) login_last_30d_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(if(date_add(dt, 29) &gt;= '2020-06-14'), 1, 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0login_last_30d_day_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0sum(login_count)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0login_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0count(*)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0login_day_count\nfrom dws_user_action_daycount\ngroup by user_id;\n</code></pre> \u6ce8\u610f\uff1asum(if())\u3001max(if())\u3001min(if())\u5728\u6839\u636e\u4e0d\u540c\u6761\u4ef6\u7b97\u805a\u5408\u503c\u65f6\u975e\u5e38\u6709\u7528</p> <p>\u6bcf\u65e5\u88c5\u8f7d\uff1a \u6bcf\u65e5\u88c5\u8f7d\u7684\u601d\u8def\u662f\u5c06DWS\u5c42\u5f53\u65e5\u65b0\u589e\u7684\u6570\u636e\u4e0eDWT\u5c42\u524d\u4e00\u65e5\u6c47\u603b\u7684\u6570\u636e\u8fdb\u884c\u6c47\u603b\uff0c\u518d\u5199\u5230DWT\u5c42\u5f53\u65e5\u7684\u5206\u533a\u4e2d\u3002\u5177\u4f53\u7684sql\u5b9e\u73b0\u8fc7\u7a0b\u5982\u4e0b\uff1a 1.\u67e5\u51faDWT\u5c42\u524d\u4e00\u65e5\u5206\u533a\u4e2d\u6570\u636e\u3001DWS\u5c42\u6700\u65b01\u5929\u5206\u533a\u7684\u6570\u636e\u3001DWS\u5c427\u5929\u524d\u7684\u5206\u533a \u548c DWS\u5c4230\u5929\u524d\u7684\u5206\u533a\uff0c\u7136\u540e\u628a\u8fd94\u5f20\u8868\u8fde\u63a5\u5728\u4e00\u8d77\u3002\u56e0\u4e3aDWS\u5c42\u6700\u65b01\u5929\u5206\u533a\u4f1a\u6709\u65b0\u7528\u6237\uff0c \u6240\u4ee5DWT\u5c42\u524d\u4e00\u65e5\u5206\u533a\u4e2d\u6570\u636e \u4e0e DWS\u5c42\u6700\u65b01\u5929\u5206\u533a\u7684\u6570\u636e \u505afull join\uff0c\u56e0\u4e3aDWS\u5c427\u5929\u524d\u7684\u5206\u533a \u548c DWS\u5c4230\u5929\u524d\u7684\u5206\u533a\u7684\u6240\u6709\u7528\u6237\u6570\u636e\u5df2\u7ecf\u6c47\u603b\u5728DWT\u5c42\u524d\u4e00\u65e5\u5206\u533a\u4e2d\u4e86\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u5206\u533a\u7684\u6570\u636e\u53ea\u9700\u8981\u4e0eDWT\u5c42\u524d\u4e00\u65e5\u5206\u533a\u505aleft join\u5373\u53ef\u3002  2.\u7528\u6237id\u5373\u7ef4\u5ea6\u5916\u952e\u53d6\u503c\u7684\u601d\u8def\u5982\u4e0b\uff0c\u56e0\u4e3aDWS\u5c42\u6700\u65b01\u5929\u5206\u533a\u4f1a\u6709\u65b0\u7528\u6237\uff0c\u6240\u4ee5\u5e94\u8be5nvl(dws_1d_ago.user_id, dwt_user_topic.user_id)  3.\u8fd11\u65e5\u6c47\u603b\u7ed3\u679c\u7684\u8ba1\u7b97\u601d\u8def\u5982\u4e0b\uff0c\u56e0\u4e3a\u7edf\u8ba1\u7684\u6700\u65b0\u4e00\u5929\u7684\u6570\u636e\uff0c\u6240\u4ee5\u5e94\u8be5\u628adws\u5c42\u6700\u65b01\u5929\u5206\u533a\u5199\u5230DWT\u5c42  4.\u8fd17\u65e5\u6c47\u603b\u7ed3\u679c\u7684\u8ba1\u7b97\u601d\u8def\u5982\u4e0b\uff0cDWS\u5c42\u6700\u65b01\u5929\u7684\u6570\u636e\u52a0\u4e0aDWT\u5c42\u524d1\u65e5\u7684\u6c47\u603b\u7ed3\u679c\uff0c\u7136\u540e\u51cf\u53bbDWS\u5c427\u5929\u524d\u7684\u6570\u636e  5.\u8fd130\u65e5\u6c47\u603b\u7ed3\u679c\u7684\u8ba1\u7b97\u601d\u8def\u5982\u4e0b\uff0c\u4e0e\u8fd17\u65e5\u7684\u8ba1\u7b97\u601d\u8def\u76f8\u540c  6.\u7d2f\u79ef\u6c47\u603b\u7ed3\u679c\u8ba1\u7b97\u601d\u8def\u5982\u4e0b\uff0c\u5c06DWT\u5c42\u524d\u4e00\u65e5\u7684\u6c47\u603b\u7ed3\u679c \u4e0e DWS\u5c42\u6700\u65b0\u4e00\u5929\u7684\u6c47\u603b\u7ed3\u679c\u52a0\u8d77\u6765\u5373\u53ef\u3002  \u6bd4\u5982\u6bcf\u65e5\u88c5\u8f7dDWT\u5c42\u7528\u6237\u4e3b\u9898\u8868\u7684\u8fd9\u51e0\u4e2a\u5b57\u6bb5 Text Only<pre><code>`login_date_1d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0STRING COMMENT '\u6700\u8fd11\u65e5\u767b\u5f55\u6b21\u6570',\n`login_last_1d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd11\u65e5\u767b\u5f55\u5929\u6570',\n`login_last_7d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u767b\u5f55\u6b21\u6570',\n`login_last_7d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd17\u65e5\u767b\u5f55\u5929\u6570',\n`login_last_30d_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u767b\u5f55\u6b21\u6570',\n`login_last_30d_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u6700\u8fd130\u65e5\u767b\u5f55\u5929\u6570',\n`login_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u767b\u5f55\u6b21\u6570',\n`login_day_count`\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0BIGINT COMMENT '\u7d2f\u79ef\u767b\u5f55\u5929\u6570',\n</code></pre></p> Text Only<pre><code>select nvl(dws_new_1d.user_id, dwt_1d_ago.user_id),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dws_new_1d.login_count, 0) login_date_1d_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if(dws_new_1d.user_id is not null, 1, 0) login_last_1d_day_count,\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dwt_1d_ago.login_last_7d_count, 0) + nvl(dws_new_1d.login_count, 0) - nvl(dws_7d_ago.login_count, 0) login_date_7d_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dwt_1d_ago.login_last_7d_day_count, 0) + if(dws_new_1d.user_id is not null, 1, 0) - if(dws_7d_ago.user_id is not null, 1, 0) login_date_7d_day_count,\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dwt_1d_ago.login_last_30d_count, 0) + nvl(dws_30d_ago.login_count, 0) - nvl(dws_30d_ago.login_count, 0) login_last_30d_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dwt_1d_ago.login_last_30d_day_count, 0) + if(dws_30d_ago.user_id is not null, 1, 0) - if(dws_30d_ago.user_id is not null, 1, 0) login_last_30d_day_count,\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dws_new_1d.login_count) + nvl(dws_new_1d.login_count, 0) login_count,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0nvl(dwt_1d_ago.login_day_count, 0) + if(dws_new_1d.user_id is not null, 1, 0) login_day_count\nfrom (\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- DWT\u5c42\u524d\u4e00\u65e5\u5206\u533a\u4e2d\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select *\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dwt_user_topic\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = date_add('2020-06-15', -1)\n\u00a0\u00a0\u00a0\u00a0\u00a0) dwt_1d_ago\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0full join\n\u00a0\u00a0\u00a0\u00a0\u00a0(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- DWS\u5c42\u6700\u65b01\u5929\u5206\u533a\u7684\u6570\u636e\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select *\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dws_user_action_daycount\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = '2020-06-15'\n\u00a0\u00a0\u00a0\u00a0\u00a0) dws_new_1d\n\u00a0\u00a0\u00a0\u00a0\u00a0on dws_new_1d.user_id = dws_new_1d.user_id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0left join\n\u00a0\u00a0\u00a0\u00a0\u00a0(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- DWS\u5c427\u5929\u524d\u7684\u5206\u533a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select *\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dws_user_action_daycount\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = date_add('2020-06-15', -7)\n\u00a0\u00a0\u00a0\u00a0\u00a0) dws_7d_ago\n\u00a0\u00a0\u00a0\u00a0\u00a0on dws_new_1d.user_id = dws_7d_ago.user_id\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0left join\n\u00a0\u00a0\u00a0\u00a0\u00a0(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- DWS\u5c4230\u5929\u524d\u7684\u5206\u533a\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select *\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0from dws_user_action_daycount\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0where dt = date_add('2020-06-15', -30)\n\u00a0\u00a0\u00a0\u00a0\u00a0) dws_30d_ago\n\u00a0\u00a0\u00a0\u00a0\u00a0on dws_new_1d.user_id = dws_30d_ago.user_id\n;\n</code></pre>"},{"location":"%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/","title":"\u9879\u76ee\u603b\u7ed3","text":"<p> \u7ea6 2015 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 40 \u5206\u949f</p> <p>\u6570\u636e\u6e90 -&gt; ODS\u5c42 1.\u672c\u9879\u76ee\u4f7f\u7528 Flume+Kafka+Flume \u7684\u65b9\u6848\u5c06\u65e5\u5fd7\u4f20\u5230HDFS\u4e0a\uff0c\u4f7f\u7528sqoop\u5c06\u4e1a\u52a1\u6570\u636e\u4f20\u5230HDFS\u4e0a\uff0c\u7136\u540e\u4f7f\u7528load\u547d\u4ee4\u5c06\u540c\u6b65\u5230HDFS\u4e0a\u7684\u6587\u4ef6\u52a0\u8f7d\u5230ODS\u5c42\u7684\u8868\u4e2d\u3002 2.\u4ece\u4e1a\u52a1\u6570\u636e\u5e93MySQL\u5230\u6570\u4ed3ODS\u5c42\uff0c\u6839\u636e\u4e1a\u52a1\u8868\u7684\u7279\u70b9\u67093\u4e2d\u540c\u6b65\u65b9\u5f0f\uff1a\u5168\u91cf\u540c\u6b65\u3001\u589e\u91cf\u540c\u6b65\u3001\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u3002\u4f7f\u7528sqoop\u540c\u6b65\u4e1a\u52a1\u6570\u636e\u4f20\u5230HDFS\u65f6\u9700\u8981\u8003\u8651\u6bcf\u5f20\u8868\u5c5e\u4e8e\u54ea\u79cd\u540c\u6b65\u65b9\u5f0f\uff0c\u5982\u679c\u662f\u5168\u91cf\u540c\u6b65\u5219where 1=1\uff0c\u5982\u679c\u589e\u91cf\u540c\u6b65\u5219where create_time=do_date\uff0c\u5982\u679c\u662f\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u5219where operate_time=do_date or create_time=do_date\u3002 3.\u5bf9\u4e8e\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u4e0d\u7528\u8003\u8651\u540c\u6b65\u65b9\u5f0f\uff0c\u56e0\u4e3aFlume\u7684HDFS Sink\u4f1a\u6839\u636eEvent\u5934\u91cc\u9762timestamp\u5c06\u6bcf\u4e00\u5929\u65e5\u5fd7\u5199\u5230\u5f53\u5929\u7684\u5206\u533a\u4e2d\uff0c\u76f8\u5f53\u4e8e\u6bcf\u65e5\u589e\u91cf\u3002 ODS\u5c42 -&gt; DIM\u5c42 \u548c DWD\u5c42 4.\u56e0\u4e3aODS\u5c42\u4e0d\u5bf9\u6570\u636e\u505a\u4efb\u4f55\u5904\u7406\uff0c\u53ea\u662f\u5bf9\u6570\u636e\u7684\u539f\u8c8c\u8fdb\u884c\u5907\u4efd\uff0c\u6240\u4ee5\u65e0\u8bba\u662f\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u8fd8\u662f\u4e1a\u52a1\u6570\u636e\uff0cODS\u5c42\u90fd\u53ea\u662f\u7b80\u5355\u7c97\u66b4\u7684\u5c06\u6570\u636e\u5199\u5230\u5f53\u65e5\u7684\u5206\u533a\u4e2d\u3002\u4f46DIM\u548cDWD\u5c42\u4e0d\u80fd\u8fd9\u6837\uff0c\u56e0\u4e3a\u8fd9\u4e24\u5c42\u7684\u8868\u662f\u7ef4\u5ea6\u5efa\u6a21\u7684\u7ed3\u679c\uff0c\u662f\u4e3a\u540e\u7eed\u5bf9\u6570\u636e\u5206\u6790\u505a\u51c6\u5907\u7684\uff0c\u6240\u4ee5DIM\u548cDWD\u5c42\u9700\u8981\u5bf9\u6765\u81eaODS\u5c42\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u5c06\u6570\u636e\u4ee5\u4e00\u5b9a\u7684\u7b56\u7565\u5199\u5230DIM\u548cDWD\u5c42\u8868\u7684\u5206\u533a\u4e2d\uff0c\u8fd9\u6837\u624d\u80fd\u6839\u636e\u5206\u533a\u66f4\u52a0\u9ad8\u6548\u5730\u67e5\u8be2\u5230\u6570\u636e\u3002 ODS\u5c42 -&gt; DIM\u5c42 5.\u6570\u636e\u6765\u81eaODS\u5c42\u591a\u5f20\u5168\u91cf\u540c\u6b65\u8868\u7684DIM\u7ef4\u5ea6\u8868\uff0c\u4e5f\u662f\u9996\u65e5\u548c\u6bcf\u65e5\u76f4\u63a5\u5168\u91cf\u540c\u6b65\u5373\u53ef\u3002 6.\u6570\u636e\u6765\u81eaODS\u5c42\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u8868\u7684DIM\u7ef4\u5ea6\u8868\uff0c\u9700\u8981\u4f7f\u7528\u62c9\u94fe\u8868\u6765\u5b9e\u73b0DIM\u5c42\u65b0\u589e\u53ca\u53d8\u5316\u7684\u903b\u8f91\u3002 ODS\u5c42 -&gt; DWD\u5c42 7.\u6570\u636e\u6765\u81eaODS\u5c42\u65e5\u5fd7\u8868\u7684DWD\u65e5\u5fd7\u8868\uff0c\u9700\u8981\u5c06ODS\u5c42\u7684\u65e5\u5fd7\u62c6\u6210\u591a\u5f20\u65e5\u5fd7\u8868\uff0c\u6bcf\u4e00\u5f20DWD\u65e5\u5fd7\u8868\u90fd\u662f\u6709\u7ed3\u6784\u7684\uff0c\u65b9\u4fbf\u540e\u7eed\u5bf9\u65e5\u5fd7\u8fdb\u884c\u5206\u6790\u3002 8.\u6570\u636e\u6765\u81eaODS\u5c42\u5168\u91cf\u540c\u6b65\u8868\u7684DWD\u4e8b\u5b9e\u8868\u79f0\u4e3a\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u9996\u65e5\u548c\u6bcf\u65e5\u76f4\u63a5\u5168\u91cf\u540c\u6b65\u5373\u53ef\u3002 9.\u6570\u636e\u6765\u81eaODS\u5c42\u589e\u91cf\u540c\u6b65\u8868\u7684DWD\u4e8b\u5b9e\u8868\u79f0\u4e3a\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u9996\u65e5\u9700\u8981\u5c06ODS\u5c42\u7684\u6570\u636e\u6839\u636ecreate_time\u6563\u5f00\u5230\u591a\u4e2a\u5206\u533a\u4e2d\uff0c\u6bcf\u65e5\u76f4\u63a5\u540c\u6b65\u589e\u91cf\u6570\u636e\u5373\u53ef\u3002 10.\u6570\u636e\u6765\u81eaODS\u5c42\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u8868\u7684DWD\u4e8b\u5b9e\u8868\u79f0\u4e3a\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u9996\u65e5\u548c\u6bcf\u65e5\u540c\u6b65\u90fd\u8981\u6839\u636e\u6bcf\u4e00\u6761\u6570\u636e\u7684\u72b6\u6001\u53d8\u5316\u5c06\u6570\u636e\u5199\u5230\u4e0d\u540c\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u4e5f\u5c31\u628a\u72b6\u6001\u6ca1\u6709\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u6700\u65b0\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u628a\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u5176\u7ec8\u6b62\u65e5\u671f\u7684\u5206\u533a\u4e4b\u4e2d\u3002 DWD\u5c42 -&gt; DWS\u5c42 1.\u4eceDIM\u5c42\u7ef4\u5ea6\u8868\u7684\u89d2\u5ea6\u51fa\u53d1\uff0cDWS\u5c42\u4e00\u5f20\u8868\u5bf9\u5e94\u4e8eDIM\u5c42\u7684\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u5176\u7684\u6570\u636e\u662fDWD\u5c42\u4e0e\u8be5\u7ef4\u5ea6\u5173\u8054\u7684\u591a\u5f20\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\u3002 2.\u6216\u8005\u4eceDWD\u5c42\u4e8b\u5b9e\u8868\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u4e00\u5f20\u4e8b\u5b9e\u8868\u6709\u591a\u4e2a\u7ef4\u5ea6\u5916\u952e\uff0c\u5bf9\u6bcf\u4e2a\u7ef4\u5ea6\u5916\u952e\u5206\u7ec4\u805a\u5408\u7684\u7edf\u8ba1\u503c\u4f1a\u5199\u5230\u4e0d\u540c\u7684DWS\u5c42\u7684\u4e3b\u9898\u8868\u4e2d\uff0c\u4e5f\u5c31\u662fDWS\u5c42\u7684\u6bcf\u5f20\u4e3b\u9898\u8868\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9DWD\u5c42\u4e8b\u5b9e\u8868\u4e0d\u540c\u89d2\u5ea6\u7684\u805a\u5408\u3002 3.\u5bf9\u4e8e\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7edf\u8ba1\uff0c\u6570\u636e\u4e00\u822c\u4e0d\u6765\u81ea\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u800c\u662f\u6765\u81ea\u65e5\u5fd7\u8868\uff0cDWD\u5c42\u7684\u65e5\u5fd7\u8868\u53ef\u4ee5\u770b\u4f5c\u662f\u7ef4\u5ea6\u5168\u90e8\u9000\u5316\u4e86\u7684\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002 4.\u9996\u65e5\u88c5\u8f7d\u5206\u7ec4\u805a\u5408\u7684sql\u7684group by\u9700\u8981\u4f7f\u7528 \u7ef4\u5ea6\u5916\u952e \u548c \u65f6\u95f4\u5b57\u6bb5\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5206\u533a\u4fdd\u5b58\u7684\u5c31\u662f\u5f53\u65e5\u7684\u6570\u636e\u3002 5.\u5982\u679c\u9996\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u8be5\u65f6\u95f4\u5b57\u6bb5\u53ef\u4ee5\u662f \u5206\u533a\u5b57\u6bb5\u3002 6.\u5982\u679c\u9996\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5982\u679c\u662f\u6309\u7167\u5b8c\u6210\u65f6\u95f4\u5206\u7ec4\uff0c\u90a3\u4e48\u65f6\u95f4\u5b57\u6bb5\u53ef\u4ee5\u4f7f\u7528\u5206\u533a\u5b57\u6bb5dt\uff08\u4e0d\u8fc7\u524d\u63d0\u662f\u5b8c\u6210\u7684\u6807\u5fd7\u53ea\u662f\u4e00\u4e2a\u65f6\u95f4\u5b57\u6bb5\u7684\u53d6\u503c\uff09\uff0c\u5982\u679c\u4e0d\u662f\u6309\u5b8c\u6210\u65f6\u95f4\u5206\u7ec4\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6309\u4e1a\u52a1\u903b\u8f91\u4f7f\u7528\u76f8\u5e94\u7684\u65f6\u95f4\u5b57\u6bb5\u5206\u7ec4\uff0c\u4e0d\u8fc7\u8fd9\u4f1a\u9020\u6210\u5bf9\u6240\u6709\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u626b\u63cf\u3002 7.\u6bcf\u65e5\u88c5\u8f7dsql\u7684group by\u4e0d\u5728\u9700\u8981\u4f7f\u7528\u65f6\u95f4\u5b57\u6bb5\u4e86\uff0c\u56e0\u4e3a\u4f1a\u4f7f\u7528where\u8fc7\u6ee4\u51faDWD\u5c42\u5f53\u65e5\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u4f7f\u7528\u5176\u5b83\u8fc7\u6ee4\u6761\u4ef6\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0c\u6700\u540e\u4f7f\u7528\u7ef4\u5ea6\u5916\u952e\u5206\u7ec4\u805a\u5408\u3002 8.\u5982\u679c\u6bcf\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u90a3\u4e48\u9700\u8981\u5148\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' \u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\uff0c\u7136\u540e\u518d\u6839\u636e\u4e1a\u52a1\u903b\u8f91\u9009\u62e9\u5176\u5b83\u6761\u4ef6\u5bf9\u5f53\u65e5\u5206\u533a\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\u3002 9.\u5982\u679c\u6bcf\u65e5\u88c5\u8f7d\u65f6\u7684\u6570\u636e\u6765\u81ea\u4e8e\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u90a3\u4e48\u9700\u8981\u5148\u4f7f\u7528where dt='\u5f53\u65e5\u65e5\u671f' \u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\uff0c\u90a3\u4e48\u9700\u8981\u4ece\u8fd93\u4e2a\u6761\u4ef6\u4e2d\u9009\u51fa\u4e00\u4e2a\uff1awhere dt='\u5f53\u65e5\u65e5\u671f' \u6216\u8005 where dt='9999-99-99' \u6216\u8005 where dt='\u5f53\u65e5\u65e5\u671f' or where dt='9999-99-99'\uff0c\u4f5c\u4e3a\u8fc7\u6ee4\u51fa\u5f53\u65e5\u6570\u636e\u7684\u6761\u4ef6\uff0c\u7136\u540e\u518d\u6839\u636e\u4e1a\u52a1\u903b\u8f91\u9009\u62e9\u5176\u5b83\u6761\u4ef6\u5bf9\u5f53\u65e5\u5206\u533a\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\u3002 DWS\u5c42 -&gt; DWT\u5c42 1.DWS\u5c42\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u662f\u540c\u6b65\u65e5\u671f\u524d\u4e00\u65e5\u6570\u636e\u7684\u805a\u5408\u7ed3\u679c\uff0c\u800cDWT\u5c42\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u662f\u622a\u6b62\u5230\u540c\u6b65\u65e5\u671f\uff0c\u524d1\u65e5\u3001\u524d7\u65e5\u3001\u524d30\u65e5 \u548c \u4ece\u5f00\u59cb\u81f3\u4eca\u7684\u7d2f\u79ef\u805a\u5408\u503c\uff0c\u53ef\u7531DWS\u5c42\u6570\u636e\u805a\u5408\u5f97\u5230\uff0c\u6240\u4ee5DWT\u5c42\u7684\u6570\u636e\u662f\u5bf9DWS\u5c42\u6570\u636e\u7684\u7d2f\u79ef\u805a\u5408\uff0cDWT\u5c42\u6bcf\u4e00\u5f20\u8868\u7684\u6570\u636e\u90fd\u6765\u81eaDWS\u5c42\u4e0e\u4e4b\u5bf9\u5e94\u7684\u8868\u3002 2.DWT\u5c42\u9996\u65e5\u88c5\u8f7d\u76f4\u63a5\u5bf9DWS\u5c42\u6240\u54df\u5206\u533a\u805a\u5408\u5373\u53ef\u3002 3.DWT\u5c42\u6bcf\u65e5\u88c5\u8f7d\u662f\u5c06DWS\u5c42\u5f53\u65e5\u65b0\u589e\u7684\u6570\u636e\u4e0eDWT\u5c42\u524d\u4e00\u65e5\u6c47\u603b\u7684\u6570\u636e\u8fdb\u884c\u6c47\u603b\u3002 4.DWT\u5c42\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u6570\u636e\u3002 5.DWT\u5c42\u4e00\u822c\u53ea\u4f1a\u4fdd\u7559\u4e24\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u5373\u4e24\u5929\u524d\u7684\u6570\u636e\u90fd\u4f1a\u5220\u9664\u6389\u3002 ADS\u5c42 1.ADS\u5c42\u4e3a\u62a5\u8868\u3001\u7edf\u8ba1\u56fe\u63d0\u4f9b\u6570\u636e\uff0c\u6240\u4ee5\u4e00\u822c\u662f\u5bf9\u6240\u6709\u6570\u636e\u7684\u7edf\u8ba1\uff0c\u6bd4\u5982\u67d0\u65e5\u6ce8\u518c\u7528\u6237\u603b\u6570\uff0c\u67d0\u65e5\u4e0b\u5355\u603b\u6570\u7b49\uff0c\u800c\u4e0d\u662f\u67d0\u4e2a\u7528\u6237\u7684\u7edf\u8ba1\u6570\u636e\u3002 2.ADS\u7684\u7edf\u8ba1\u9700\u6c42\u4e0d\u56fa\u5b9a\uff0c\u4e8e\u662f\u6570\u636e\u6570\u636e\u7684\u88c5\u8f7d\u903b\u8f91\u4e5f\u4e0d\u56fa\u5b9a\uff0c\u7ee7\u800cADS\u5c42\u6ca1\u6709\u9996\u65e5\u88c5\u8f7d\u548c\u6bcf\u65e5\u88c5\u8f7d\uff08\u6216\u8005\u8bf4\u89c6\u5177\u4f53\u7684\u9700\u6c42\u800c\u5b9a\uff09\u3002 ADS\u5c42 -&gt; MySQL \u7531\u4e8e\u62a5\u8868\u7cfb\u7edf\u7684\u6570\u636e\u4e00\u822c\u4e0d\u662fHive\uff0c\u800c\u662fMySQL\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u5c06ADS\u5c42\u7684\u6570\u636e\u5bfc\u51fa\u5230MySQL\u4e2d\u3002 \u5de5\u4f5c\u6d41\u8c03\u5ea6\u7cfb\u7edf \u4ee5\u4e0a\u6570\u636e\u540c\u6b65\u7684\u811a\u672c\u7684\u8c03\u5ea6\u5de5\u4f5c\u7531Azkaban\u5b8c\u6210\u3002 \u62a5\u8868\u7cfb\u7edf</p> <p>\u4ece\u7528\u6237\u884c\u4e3a\u8fd9\u4e2a\u5bbd\u6cdb\u7684\u89d2\u5ea6\u770b\u6570\u4ed3\u6bcf\u4e00\u5c42\u7684\u8868\u7684\u6bcf\u4e00\u884c\u6570\u636e\u8868\u793a\u4ec0\u4e48\uff1f 1.ODS\u5c42\u4fdd\u5b58\u7684\u662f\u539f\u59cb\u6570\u636e\uff0c\u6240\u4ee5ODS\u5c42\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u7528\u6237\u7684\u4e00\u6b21\u884c\u4e3a 2.DWD\u5c42\u53ea\u662f\u5bf9ODS\u5c42\u6309\u4e1a\u52a1\u6570\u636e\u7684\u7279\u70b9\u91cd\u65b0\u6309\u5206\u533a\u7ec4\u7ec7\u4e86\u6570\u636e\uff0c\u6240\u4ee5DWD\u5c42\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u4e5f\u662f\u7528\u6237\u7684\u4e00\u6b21\u884c\u4e3a 3.DWS\u5c42\u5bf9DWD\u5c42\u6570\u636e\u8f7b\u5ea6\u6c47\u603b\uff0c\u6240\u4ee5DWS\u5c42\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u6d3b\u8dc3\u7528\u6237\u5728\u8fd9\u4e00\u5929\u6240\u6709\u884c\u4e3a\u7684\u7d2f\u79ef\u503c 4.DWT\u5c42\u5bf9DWS\u5c42\u6240\u6709\u6570\u636e\u8fdb\u884c\u7d2f\u79ef\u6c47\u603b\uff0c\u6240\u4ee5DWT\u5c42\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u662f\u4e00\u4e2a\u7528\u6237\u5728\u6700\u8fd1n\u5929\u7684\u6240\u6709\u884c\u4e3a\u7684\u7d2f\u79ef\u503c\uff0c\u56e0\u4e3a\u662f\u5bf9DWS\u5c42\u6240\u6709\u6570\u636e\u7684\u7d2f\u79ef\uff0c\u6240\u4ee5DWT\u5c42\u4f1a\u4fdd\u5b58\u6240\u6709\u7528\u6237\u7684\u7edf\u8ba1\u503c\u3002 5.ADS\u5c42\u8ba1\u7b97\u7684\u662f\u6240\u6709\u7528\u6237\u5728\u6700\u8fd1n\u5929\u7684\u4e00\u4e2a\u7edf\u8ba1\u503c\uff0c\u6240\u4ee5ADS\u5c42\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u7684\u6700\u8fd1n\u5929\u6240\u6709\u7528\u6237\u7684\u7edf\u8ba1\u503c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/","title":"Flink","text":"<p> \u7ea6 6702 \u4e2a\u5b57  3 \u884c\u4ee3\u7801  6 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 134 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#filnk","title":"Filnk\u7684\u90e8\u7f72\u6a21\u5f0f\uff1f","text":"<ul> <li> <p>Standalone\u6a21\u5f0f\uff1a\u4f7f\u7528Flink\u81ea\u5e26\u7684\u8d44\u6e90\u7ba1\u7406\u5668\u90e8\u7f72Flink\u96c6\u7fa4\uff0cStandaloneSessionClusterEntrypoint\u7c7b\u4f3c\u4e8eyarn\u7684ResourceManager\uff0cTaskManagerRunner\u7c7b\u4f3c\u4e8eyarn\u7684NodeManager</p> </li> <li> <p>Yarn\u6a21\u5f0f\uff08Session-Cluster\u6a21\u5f0f\u3001Per-Job-Cluster\u6a21\u5f0f\uff09</p> </li> <li> <p>Session-Cluster\u6a21\u5f0f\uff1aSession-Cluster\u6a21\u5f0f\u662f\u5148\u5728 yarn \u4e2d\u521d\u59cb\u5316\u4e00\u4e2a flink \u96c6\u7fa4\uff08yarn\u7684\u4e00\u4e2aapplication\uff09\uff0c\u5f00\u8f9f\u6307\u5b9a\u7684\u8d44\u6e90\uff0c\u4ee5\u540e\u63d0\u4ea4\u4efb\u52a1\u90fd\u5411\u8fd9\u91cc\u63d0\u4ea4\uff0c\u8fd9\u4e2a flink \u96c6\u7fa4\u4f1a\u5e38\u9a7b\u5728 yarn \u96c6\u7fa4\u4e2d\uff0c \u9664\u975e\u624b\u5de5\u505c\u6b62\uff08\u4e0estandalone\u6a21\u5f0f\u5f88\u7c7b\u4f3c\uff09\u3002Session-Cluster\u6a21\u5f0f\u9700\u8981\u5148\u521d\u59cb\u5316 flink \u96c6\u7fa4\u5e76\u6307\u5b9a\u8d44\u6e90\u7684\u6570\u91cf\uff0c\u5982\u679c\u4e0d\u80fd\u6ee1\u8db3\u4e0b\u4e00\u4e2a\u4f5c\u4e1a\u6240\u9700\u8981\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u8be5\u4f5c\u4e1a\u5c31\u65e0\u6cd5\u63d0\u4ea4\uff0c\u53ea\u80fd\u7b49\u5230\u524d\u9762\u7684\u4f5c\u4e1a\u6267\u884c\u5b8c\u6210\u540e\uff0c \u91ca\u653e\u4e86\u8d44\u6e90\uff0c \u8be5\u4f5c\u4e1a\u624d\u4f1a\u80fd\u63d0\u4ea4\u6210\u529f\u3002</p> </li> <li> <p>Per-Job-Cluster\u6a21\u5f0f\uff1a\u6bcf\u6b21\u63d0\u4ea4\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 flink \u96c6\u7fa4\uff0c\u4efb\u52a1\u4e4b\u95f4\u4e92\u76f8\u72ec\u7acb\uff0c\u4e92\u4e0d\u5f71\u54cd\uff0c\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u521b\u5efa\u7684\u96c6\u7fa4\u4e5f\u4f1a\u6d88\u5931\u3002\u00a0Per-Job-Cluster\u6a21\u5f0f\u4e0b\uff0c\u4e00\u4e2a Job \u4f1a\u5bf9\u5e94\u4e00\u4e2a\u96c6\u7fa4\uff0c\u6bcf\u63d0\u4ea4\u4e00\u4e2a\u4f5c\u4e1a\u4f1a\u6839\u636e\u81ea\u8eab\u7684\u60c5\u51b5\uff0c\u90fd\u4f1a\u5355\u72ec\u5411 yarn \u7533\u8bf7\u8d44\u6e90\uff0c\u76f4\u5230\u4f5c\u4e1a\u6267\u884c\u5b8c\u6210\uff0c\u4e00\u4e2a\u4f5c\u4e1a\u7684\u5931\u8d25\u4e0e\u5426\u5e76\u4e0d\u4f1a\u5f71\u54cd\u4e0b\u4e00\u4e2a\u4f5c\u4e1a\u7684\u6b63\u5e38\u63d0\u4ea4\u548c\u8fd0\u884c\uff0c\u9002\u5408\u89c4\u6a21\u5927\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4f5c\u4e1a\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink","title":"\u8be6\u7ec6\u4ecb\u7ecd\u4e00\u4e0bFlink\u7684\u8fd0\u884c\u67b6\u6784\uff1f","text":"<p>\u7531 Client \u63d0\u4ea4\u4efb\u52a1\u7ed9 JobManager\uff0cJobManager \u518d\u8c03\u5ea6\u4efb\u52a1\u5230\u5404\u4e2aTaskManager \u53bb\u6267\u884c\u3002</p> <ul> <li>Client</li> </ul> <p>Client\u662f\u7528\u6765\u63d0\u4ea4 job \u5230 Flink \u96c6\u7fa4\u7684\uff0cClient \u8d1f\u8d23 StreamGraph (\u6d41\u56fe)\u548c JobGraph (\u4f5c\u4e1a\u56fe)\u7684\u6784\u5efa\u3002</p> <ul> <li>JobManager</li> </ul> <p>JobManager \u6839\u636e\u5e76\u884c\u5ea6\u5c06 Flink \u5ba2\u6237\u7aef\u63d0\u4ea4\u7684Flink \u5e94\u7528\u5206\u89e3\u4e3a\u5b50\u4efb\u52a1\uff08\u5c06JobGraph\u8f6c\u6362\u6210ExecutionGraph\uff09\uff0c\u4ece\u8d44\u6e90\u7ba1\u7406\u5668 ResourceManager \u7533\u8bf7\u6240\u9700\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u8d44\u6e90\u5177\u5907\u4e4b\u540e\uff0c\u5f00\u59cb\u5206\u53d1\u4efb\u52a1\u5230 TaskManager \u6267\u884c Task\uff0c\u5e76\u8d1f\u8d23\u5e94\u7528\u5bb9\u9519\uff0c\u8ddf\u8e2a\u4f5c\u4e1a\u7684\u6267\u884c\u72b6\u6001\uff0c\u53d1\u73b0\u5f02\u5e38\u5219\u6062\u590d\u4f5c\u4e1a\u7b49\u3002</p> <ul> <li>TaskManager</li> </ul> <p>TaskManager \u63a5\u6536 JobManage \u5206\u53d1\u7684\u5b50\u4efb\u52a1\u540e\uff0c\u8d1f\u8d23\u4efb\u52a1\u7684\u542f\u52a8\u3001 \u505c\u6b62\u3001\u9500\u6bc1\u3001\u5f02\u5e38\u6062\u590d\u7b49\u751f\u547d\u5468\u671f\u9636\u6bb5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#slot","title":"slot \u548c \u5e76\u884c\u5ea6 \u7684\u5173\u7cfb\uff1f","text":"<p>TaskManager \u5728\u542f\u52a8\u524d\u5c31\u8bbe\u7f6e\u597d\u4e86\u69fd\u4f4d\u6570\uff08slot\uff09\uff0cslot\u6570\u5c31\u662f\u6bcf\u4e2aTaskManager\u80fd\u542f\u52a8\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002</p> <p>\u4e00\u4e2a\u4f5c\u4e1a\u7531\u8bb8\u591a\u7b97\u5b50\u6784\u6210\u4e00\u4e2a\u6570\u636e\u6d41\u56fe\uff0c\u4e00\u4e2a\u7b97\u5b50\u4f1a\u88ab\u5305\u88c5\u6210\u8bb8\u591a\u76f8\u540c\u7684\u4efb\u52a1task\uff0c\u5728\u76f8\u540c\u6216\u8005\u4e0d\u540c\u7684TaskManager\u7684\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e0a\u6267\u884c\uff0c\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u4efb\u52a1\u79f0\u4e3a\u8fd9\u4e2a\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\uff0c\u5b50\u4efb\u52a1\u6570\u91cf\u4e5f\u5c31\u662f\u8fd9\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u3002\u4e0d\u540c\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u4f1a\u5171\u4eabslot\u3002</p> <p>TaskManager \u4ece JobManager \u5904\u63a5\u6536\u5b50\u4efb\u52a1\u540e\uff0c\u5c31\u4f1a\u542f\u52a8\u7ebf\u7a0b\u6765\u6267\u884c\u5b50\u4efb\u52a1\u3002\u56e0\u4e3a\u540c\u4e00\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u5fc5\u987b\u5728\u4e0d\u540c\u7684slot\u4e0a\u6267\u884c\uff0c\u6240\u4ee5\u4e00\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u4e0d\u80fd\u8d85\u8fc7\u6240\u6709TaskManager\u603b\u7684slot\u6570\uff0c\u4e0d\u7136\u5c31\u65e0\u6cd5\u6ee1\u8db3\u4f5c\u4e1a\u6267\u884c\u7684\u6700\u5c11\u8d44\u6e90\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_1","title":"\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u5982\u4f55\u8bbe\u7f6e\uff1f","text":"<p>\u4ece\u56db\u4e2a\u4e0d\u540c\u5c42\u9762\u8bbe\u7f6e\u5e76\u884c\u5ea6\uff1a</p> <ul> <li> <p>\u64cd\u4f5c\u7b97\u5b50\u5c42\u9762(Operator Level)\uff0c\u7b97\u5b50\u7684<code>setParallelism(2)</code>\u65b9\u6cd5</p> </li> <li> <p>\u6267\u884c\u73af\u5883\u5c42\u9762(Execution Environment Level)\uff0c\u6267\u884c\u73af\u5883\u4e2d\u8bbe\u7f6e\u6240\u6709\u7b97\u5b50\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff1a<code>env.setParallelism(4);</code></p> </li> <li> <p>\u5ba2\u6237\u7aef\u5c42\u9762(Client Level)\uff0c\u63d0\u4ea4\u4f5c\u4e1a\u65f6\u5728\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u6307\u5b9a\u5e76\u884c\u5ea6\uff1a-p\u53c2\u6570</p> </li> <li> <p>\u7cfb\u7edf\u5c42\u9762(System Level)\uff0c\u914d\u7f6e\u6587\u4ef6flink-conf.yaml\u4e2d\u7684\u8bbe\u7f6e\u7684\u6240\u6709\u7b97\u5b50\u7684\u9ed8\u8ba4\u5e76\u884c\u5ea6\uff1aparallelism.default: 1</p> </li> </ul> <p>\u4f18\u5148\u7ea7\uff1a\u7b97\u5b50\u5c42\u9762&gt;\u73af\u5883\u5c42\u9762&gt;\u5ba2\u6237\u7aef\u5c42\u9762&gt;\u7cfb\u7edf\u5c42\u9762\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_1","title":"Flink\u7f16\u7a0b\u6a21\u578b\uff1f","text":"<p>Flink \u4f5c\u4e1a\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u6e90\u00a0Source\u3001\u8f6c\u6362\u00a0transformation\u3001\u8f93\u51fa\u00a0sink\u3002Source \u8d1f\u8d23\u8bfb\u53d6\u6570\u636e\u6e90\uff0c Transformation \u5229\u7528\u5404\u79cd\u7b97\u5b50\u8fdb\u884c\u5904\u7406\u52a0\u5de5\uff0c Sink\u8d1f\u8d23\u8f93\u51fa\u3002\u00a0\u6bcf\u4e00\u4e2adataflow\u4ee5\u4e00\u4e2a\u6216\u591a\u4e2asources\u5f00\u59cb\u4ee5\u4e00\u4e2a\u6216\u591a\u4e2asinks\u7ed3\u675f\uff0c dataflow\u662f\u4e00\u4e2a\u6709\u5411\u65e0\u73af\u56fe\uff08 DAG\uff09\u3002</p> <p>\u5e38\u7528Source\u7b97\u5b50\uff1a </p> <ul> <li> <p>\u4ece\u5185\u5b58\u8bfb\uff1afromElements</p> </li> <li> <p>\u4ece\u6587\u4ef6\u8bfb\uff1areadTextFile</p> </li> <li> <p>Socket \u63a5\u5165 \uff1asocketTextStream</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u8bfb\u53d6\uff1acreateInput</p> </li> </ul> <p>\u5e38\u7528transformation\u7b97\u5b50\uff1a Map\uff08\u5355\u8f93\u5165\u5355\u8f93\u51fa\uff09\u3001FlatMap\uff08\u5355\u8f93\u5165\u3001\u591a\u8f93\u51fa\uff09\u3001Filter\uff08\u8fc7\u6ee4\uff09\u3001KeyBy\uff08\u5206\u7ec4\uff09\u3001Reduce\uff08\u805a\u5408\uff09\u3001Window\uff08\u7a97\u53e3\uff09\u3001Connect\uff08\u8fde\u63a5\uff09\u3001Split\uff08\u5206\u5272\uff09\u7b49\u3002</p> <p>\u5e38\u7528sink\u7b97\u5b50\uff1a print\u3001writeToSocket\u3001\u81ea\u5b9a\u4e49Sink</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flinkwordcount","title":"\u7b80\u5355\u8bf4\u4e00\u4e0bflink\u8ba1\u7b97wordcount\u7684\u6b65\u9aa4\uff1f","text":"<p>\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li> <p>\u83b7\u53d6\u8fd0\u884c\u73af\u5883\u00a0\u00a0<code>StreamExecutionEnvironment.getExecutionEnvironment();</code></p> </li> <li> <p>\u63a5\u5165source\u6e90</p> </li> <li> <p>\u6267\u884c\u8f6c\u6362\u64cd\u4f5c\uff0c\u5982map()\u3001flatmap()\u3001keyby\uff08\uff09\u3001sum()</p> </li> <li> <p>\u8f93\u51fasink\u6e90\uff0c\u5982print()</p> </li> <li> <p>\u6267\u884c <code>env.execute();</code></p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_2","title":"Flink\u7684\u5206\u533a\u7b56\u7565\uff08\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\uff09\uff1f","text":"<p>\u76ee\u524d Flink \u652f\u63018\u79cd\u5206\u533a\u7b56\u7565\u7684\u5b9e\u73b0\uff1a</p> <p></p> <ol> <li>ForwardPartitioner</li> </ol> <p>\u5728API\u5c42\u9762\u4e0aForwardPartitioner\u5e94\u7528\u5728DataStream\u4e0a\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684 DataStream\u3002\u5982\u679c\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u76f8\u540c\uff0c\u5e76\u4e14\u6ca1\u6709\u8c03\u7528\u4e0b\u9762\u7684\u7b97\u5b50\u5c06\u6570\u636e\u6253\u4e71\uff0c\u90a3\u4e48\u9ed8\u8ba4\u5c31\u662fforward\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u4f1a\u8c03\u7528\u8fd9\u4e2a\u7b97\u5b50\u3002\u5982\u679c\u8c03\u7528\u8fd9\u4e2a\u7b97\u5b50\uff0c\u90a3\u4e48\u8981\u6c42\u524d\u540e\u4e24\u4e2a\u7b97\u5b50\u7684\u5e76\u884c\u5ea6\u5fc5\u987b\u76f8\u540c\u3002</p> <ol> <li>RebalancePartitioner</li> </ol> <p>\u4ee5Round-robin\uff08\u8f6e\u8be2\uff09\u7684\u65b9\u5f0f\u4e3a\u6bcf\u4e2a\u5143\u7d20\u5206\u914d\u5206\u533a\uff0c\u786e\u4fdd\u4e0b\u6e38\u7684 Task \u53ef\u4ee5\u5747\u5300\u5730\u83b7\u5f97\u6570\u636e\uff0c\u907f\u514d\u6570\u636e\u503e\u659c\u3002</p> <ol> <li>KeyGroupStreamPartitioner</li> </ol> <p>\u5728API\u5c42\u9762\u4e0a\uff0cKeyGroupStreamPartitioner\u5e94\u7528\u5728\u00a0DataStream\u4e0a\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684 KeyedStream\u3002\u4f1a\u5c06\u6570\u636e\u6309 Key \u7684 Hash \u503c\u8f93\u51fa\u5230\u4e0b\u6e38\u7b97\u5b50\u5b9e\u4f8b\u4e2d\u3002\u8be5\u5206\u533a\u5668\u4e0d\u662f\u63d0\u4f9b\u7ed9\u7528\u6237\u6765\u7528\u7684\u3002</p> <ol> <li>ShufflePartitioner</li> </ol> <p>\u968f\u673a\u7684\u5c06\u5143\u7d20\u8fdb\u884c\u5206\u533a\uff0c\u53ef\u4ee5\u786e\u4fdd\u4e0b\u6e38\u7684Task\u80fd\u591f\u5747\u5300\u5730\u83b7\u5f97\u6570\u636e\u3002</p> <ol> <li>BroadcastPartitioner</li> </ol> <p>\u5c06\u8be5\u8bb0\u5f55\u5e7f\u64ad\u7ed9\u6240\u6709\u5206\u533a\uff0c\u5373\u6709N\u4e2a\u5206\u533a\uff0c\u5c31\u628a\u6570\u636e\u590d\u5236N\u4efd\uff0c\u6bcf\u4e2a\u5206\u533a1\u4efd\u3002</p> <ol> <li>GlobalPartitioner</li> </ol> <p>\u6570\u636e\u4f1a\u88ab\u5206\u53d1\u5230\u4e0b\u6e38\u7b97\u5b50\u7684\u7b2c\u4e00\u4e2a\u5b9e\u4f8b\u4e2d\u8fdb\u884c\u5904\u7406\u3002</p> <ol> <li>RescalePartitioner</li> </ol> <p>\u5c06\u4e0a\u6e38\u7b97\u5b50\u7684\u90e8\u5206\u5b50\u4efb\u52a1\u7684\u6570\u636e\u8f6e\u8be2\u5730\u53d1\u9001\u7ed9\u4e0b\u6e38\u7b97\u5b50\u7684\u90e8\u5206\u5b50\u4efb\u52a1\uff0c\u6bd4\u5982\u4e0a\u6e38\u7b97\u5b50\u67092\u4e2a\u5b50\u4efb\u52a1\uff0c\u4e0b\u6e38\u7b97\u5b50\u67094\u4e2a\u5b50\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u4f1a1\u5bf92\u7684\u8f6e\u8be2\u53d1\u9001\u6570\u636e\u3002</p> <ol> <li>CustomPartitionerWrapper</li> </ol> <p>\u7528\u6237\u81ea\u5b9a\u4e49\u5206\u533a\u5668\uff0c\u9700\u8981\u7528\u6237\u81ea\u5df1\u5b9e\u73b0Partitioner\u63a5\u53e3\uff0c\u6765\u5b9a\u4e49\u81ea\u5df1\u7684\u5206\u533a\u903b\u8f91\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_3","title":"Flink\u7684\u5e7f\u64ad\u673a\u5236\u4e86\u89e3\uff1f\u5e7f\u64ad\u6d41\uff1f","text":"<p>\u5e7f\u64ad\u53d8\u91cf\u662f\u53d1\u7ed9TaskManager\u7684\u5185\u5b58\u4e2d\uff0c\u5c06\u4e00\u4e2a\u6570\u636e\u5e7f\u64ad\u540e\uff0c\u4e0d\u540c\u7684TaskManager\u90fd\u53ef\u4ee5\u5728\u8282\u70b9\u4e0a\u83b7\u53d6\u5230\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u5b58\u4e00\u4efd\uff0c\u00a0\u5982\u679c\u4e0d\u4f7f\u7528\u5e7f\u64ad\uff0c\u6bcf\u4e00\u4e2aslot\u90fd\u4f1a\u62f7\u8d1d\u4e00\u4efd\u6570\u636e\u96c6\uff0c\u9020\u6210\u5185\u5b58\u8d44\u6e90\u6d6a\u8d39\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_2","title":"\u8bf4\u4e00\u4e0b\u5bcc\u51fd\u6570\uff1f","text":"<p>Transform\u7b97\u5b50\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u4ee5Function\u7ed3\u5c3e\u63a5\u53e3\u6216\u8005\u62bd\u8c61\u7c7b\u7684\u5b9e\u73b0\u7c7b\u7684\u5bf9\u8c61\uff0c\u5176\u76ee\u7684\u5c31\u662f\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u65b9\u6cd5\uff0c\u5176\u4e2d\u6709\u4e00\u7c7b\u51fd\u6570\u662f\u4ee5Rich\u5f00\u5934\u4ee5Function\u7ed3\u5c3e\u7684\u62bd\u8c61\u5b50\u7c7b\uff0c\u4e8e\u662f\u79f0\u4e3a\u5bcc\u51fd\u6570\uff0c\u5b83\u63d0\u4f9b\u4e86\u6bd4\u539f\u6709\u63a5\u53e3\u548c\u62bd\u8c61\u7c7b\u66f4\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u53ef\u4ee5\u83b7\u53d6\u8fd0\u884c\u73af\u5883\u7684\u4e0a\u4e0b\u6587\uff08\u53ef\u4ee5\u4ece\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u4e2d\u83b7\u53d6\u72b6\u6001\uff09\uff0c\u62e5\u6709\u4e00\u4e9b\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5b9e\u73b0\u66f4\u590d\u6742\u7684\u529f\u80fd\u3002</p> <p>RichFunction \u6709\u4e24\u4e2a\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff1a</p> <p><code>open()</code>\u65b9\u6cd5\u662f RichFunction \u5b50\u7c7b\u5bf9\u8c61\u53cd\u5e8f\u5217\u5316\u65f6\u4f1a\u8c03\u7528\u7684\u65b9\u6cd5\u3002</p> <p><code>close()</code>\u65b9\u6cd5\u662fRichFunction \u5b50\u7c7b\u5bf9\u8c61\u9500\u6bc1\u65f6\u8c03\u7528\u7684\u65b9\u6cd5\uff0c\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\u3002</p> <p>RichMapFunction\u7684\u533f\u540d\u5b50\u7c7b\u5b9e\u4f8b\u53ea\u5728\u4e3b\u7ebf\u7a0b\uff08JobManager\uff09\u4e0a\u5b9e\u4f8b\u5316\u4e00\u6b21\uff0c\u7136\u540e\u88ab\u5e8f\u5217\u5316\u4f20\u9001\u5230\u6bcf\u4e00\u4e2amap\u7b97\u5b50\u5b50\u4efb\u52a1\u6240\u5728\u7684slot\u4e2d\uff0c\u6240\u4ee5\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u6709\u4e00\u4efdRichMapFunction\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\u3002\u5e76\u4e14\u5f53taskManager\u7684slot\u53cd\u5e8f\u5217\u5316RichMapFunction\u533f\u540d\u5b50\u7c7b\u5bf9\u8c61\u65f6\u4f1a\u8c03\u7528open()\u65b9\u6cd5\u3002\u5f53\u4efb\u52a1\u7ed3\u675f\u65f6\uff0c\u4f1a\u8c03\u7528close()\u65b9\u6cd5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_4","title":"Flink\u7684\u56db\u5927\u57fa\u77f3\uff1f","text":"<ol> <li> <p>Time\uff08\u65f6\u95f4\uff09</p> </li> <li> <p>Window\uff08\u7a97\u53e3\uff09</p> </li> <li> <p>State\uff08\u72b6\u6001\uff09</p> </li> <li> <p>Checkpoint\uff08\u68c0\u67e5\u70b9\uff09</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_5","title":"Flink\u7684\u65f6\u95f4\u8bed\u4e49\uff1f","text":"<p>Flink\u67093\u79cd\u65f6\u95f4\u8bed\u4e49\uff1aEvent Time\u3001Ingestion Time\u3001Processing Time</p> <ul> <li> <p>Event Time\u6307\u7684\u662f\u6570\u636e\u4ea7\u751f\u7684\u65f6\u95f4\uff0c\u9700\u8981\u5916\u90e8\u6570\u636e\u6e90\u5728\u4ea7\u751f\u6570\u636e\u65f6\u5e26\u4e0a\u65f6\u95f4\u6233\u3002</p> </li> <li> <p>Ingestion Time\u6307\u7684\u662f\u6570\u636e\u5230\u8fbeFlink\u7684Source\u65f6\u7684\u65f6\u95f4\uff0c\u4ee5systemTime\u4e3a\u51c6\u3002</p> </li> <li> <p>Processing Time\u662f\u6307\u5230\u8fbe\u7b97\u5b50\u7684\u65f6\u95f4\uff0c\u4ee5systemTime\u4e3a\u51c6\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#watermark","title":"WaterMark\u539f\u7406\uff1f","text":"<p>watermark\u5b9e\u9645\u4e0a\u4e5f\u662f\u4e00\u6761\u6570\u636e\uff0c\u4e0e\u666e\u901a\u7684\u4e1a\u52a1\u6570\u636eStreamRecord\u90fd\u7ee7\u627f\u81eaStreamElement\u62bd\u8c61\u7c7b\uff0c\u4ece\u8c03\u7528assignTimestampsAndWatermarks()\u6307\u5b9a\u5982\u4f55\u751f\u6210watermark\u5f00\u59cb\uff0cwatermark\u4f1a\u4e0e\u4e1a\u52a1\u6570\u636e\u4e00\u8d77\u4ece\u4e0a\u6e38\u5411\u4e0b\u6e38\u4f20\u9012\u3002</p> <p>\u5f53\u6570\u636e\u53d1\u751fRedistributing \u65f6\uff0cwatermark\u4f1a\u4ee5\u5e7f\u64ad\u7684\u65b9\u5f0f\u5411\u4e0b\u6e38\u5206\u533a\u4f20\u9012\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u6240\u6709Redistributing\u540e\u7684\u4e0b\u6e38\u5206\u533a\u63a5\u6536\u5230\u76f8\u540c\u7684watermark\uff0c\u7136\u540e\u4e0b\u6e38\u7b97\u5b50\u4f1a\u9009\u51fa\u6700\u5c0f\u7684\u90a3\u4e2awatermark\u518d\u5411\u4e0b\u6e38\u4f20\u9012\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u5f53\u53d1\u751f\u7b2c\u4e00\u6b21Redistributing\u540e\uff0c\u540e\u9762\u4e0d\u7ba1\u662fone-to-one\u8fd8\u662f\u518d\u53d1\u751fRedistributing\uff0c\u6240\u6709\u5e76\u884c\u6d41\u4e2dwatermark\u90fd\u4f1a\u662f\u76f8\u540c\u7684\uff0c\u56e0\u4e3a\u7b2c\u4e00\u6b21Redistributing\u540e\u7684\u7b2c\u4e00\u4e2a\u7b97\u5b50\u7684\u6240\u6709\u5b50\u4efb\u52a1\u5411\u4e0b\u6e38\u53d1\u9001\u7684\u662f\u76f8\u540c\u7684watermark\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#watermark_1","title":"WaterMark\u751f\u6210\u7684\u7b56\u7565\uff1f","text":"<p>\u9996\u5148\u8981\u8bbe\u7f6e\u4e3a\u4e8b\u4ef6\u65f6\u95f4\u8bed\u4e49EventTime<code>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</code>\u3002</p> <p>\u901a\u8fc7DataStream\u7684<code>assignTimestampsAndWatermarks()</code>\u65b9\u6cd5\u8bbe\u7f6e\u5c06\u65f6\u95f4\u6233\u8d4b\u503c\u7ed9watermark\u7684\u7b56\u7565\uff0cassignTimestampsAndWatermarks()\u65b9\u6cd5\u9700\u8981\u4f20\u5165<code>AssignerWithPeriodicWatermarks</code>\u63a5\u53e3 \u6216\u8005\u00a0<code>AssignerWithPunctuatedWatermarks</code>\u63a5\u53e3\u7684\u5b50\u7c7b\u5b9e\u73b0\uff0c\u8fd9\u4e24\u4e2a\u63a5\u53e3\u5747\u662f\u7ee7\u627f\u81eaTimestampAssigner\u63a5\u53e3\u3002</p> <p>\u5982\u679c\u662fAssignerWithPeriodicWatermarks\u63a5\u53e3\uff0cFlink\u4f1a\u5468\u671f\u6027\u5730\u751f\u6210watermark\uff0c\u8fd9\u4e2a\u5468\u671f\u7684\u9ed8\u8ba4\u503c\u662f200ms\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e<code>env.getConfig().setAutoWatermarkInterval(200);</code>\u3002\u5982\u679c\u662fAssignerWithPunctuatedWatermarks \u63a5\u53e3\uff0cFlink\u6bcf\u63a5\u6536\u4e00\u6761\u6570\u636e\u90fd\u4f1a\u751f\u6210watermark\u3002</p> <p>AssignerWithPeriodicWatermarks\u63a5\u53e3\u7684\u4e24\u4e2a\u5b50\u62bd\u8c61\u7c7b\u5b9e\u73b0\uff0c\u5373AscendingTimestampExtractor \u548c\u00a0BoundedOutOfOrdernessTimestampExtractor\u3002\u9996\u5148\u5728\u4e24\u4e2a\u7c7b\u4e2d\u90fd\u6709\u4e00\u4e2a\u5f53\u524d\u65f6\u95f4\u6233\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\u662f\u5f53\u524dassignTimestampsAndWatermarks\u7b97\u5b50\u6536\u5230\u6570\u636e\u4e2d\u7684\u6700\u5927\u65f6\u95f4\u6233\u3002AscendingTimestampExtractor\u00a0\u76f4\u63a5\u5c06\u6700\u5927\u65f6\u95f4\u6233-1\u8d4b\u503c\u7ed9\u4e86watermark\uff0c\u4e5f\u5c31\u662fwatermark\u662f\u5f53\u524dFlink\u63a5\u6536\u5230\u7684\u6570\u636e\u7684\u6700\u5927\u65f6\u95f4\u6233-1ms\u3002BoundedOutOfOrdernessTimestampExtractor \u4f1a\u5c06\u6700\u5927\u65f6\u95f4\u6233\u51cf\u53bb <code>maxOutOfOrderness</code>\u6700\u5927\u4e71\u5e8f\u65f6\u95f4\u540e\u8d4b\u7ed9 watermark\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2aflink\u7684EventTime\u8c03\u6162\u4e86\u4e00\u4e2amaxOutOfOrderness\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#filnk_1","title":"filnk\u6709\u54ea\u51e0\u79cd\u7a97\u53e3\uff1f","text":"<ol> <li> <p>\u65f6\u95f4\u7a97\u53e3\uff08 Time Window\uff09\uff1a</p> </li> <li> <p>\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3</p> </li> <li> <p>\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3</p> </li> <li> <p>\u8ba1\u6570\u7a97\u53e3\uff08 Count Window\uff09\uff1a</p> </li> <li> <p>\u6eda\u52a8\u8ba1\u6570\u7a97\u53e3</p> </li> <li> <p>\u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3</p> </li> <li> <p>\u4f1a\u8bdd\u7a97\u53e3</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#windowedstream","title":"WindowedStream\u7684\u805a\u5408\u7b97\u5b50\u4f20\u5165\u7684\u51fd\u6570\u6709\u54ea\u4e24\u7c7b\uff1f","text":"<p>\u589e\u91cf\u805a\u5408\u51fd\u6570\uff08 incremental aggregation functions\uff09\u548c \u5168\u7a97\u53e3\u51fd\u6570\uff08 full window functions\uff09\u3002</p> <ul> <li> <p>\u589e\u91cf\u805a\u5408\u51fd\u6570\u5305\u62ec\uff1aReduceFunction \u548c AggregateFunction\u3002\u589e\u91cf\u805a\u5408\u7684\u610f\u601d\u662f\uff0c\u7a97\u53e3\u4e2d\u6bcf\u6765\u4e00\u6761\u6570\u636e\uff0c\u7b97\u5b50\u5c31\u4f1a\u8c03\u7528\u589e\u91cf\u805a\u5408\u51fd\u6570\u5bf9\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u8ba1\u7b97\uff0c\u6bcf\u6b21\u8ba1\u7b97\u90fd\u4f1a\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c\uff0c\u8fd9\u4e2a\u4e2d\u95f4\u7ed3\u679c\u79f0\u4e3a\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u8ba1\u7b97\u5176\u5b9e\u662f\u5bf9\u8be5\u72b6\u6001\u7684\u66f4\u65b0\u3002</p> </li> <li> <p>\u5168\u7a97\u53e3\u51fd\u6570\u5305\u62ec\uff1aProcessWindowFunction \u548c WindowFunction\u3002\u5168\u7a97\u53e3\u805a\u5408\u7684\u610f\u601d\u662f\uff0c\u7a97\u53e3\u4e2d\u6bcf\u6765\u4e00\u6761\u6570\u636e\uff0c\u7b97\u5b50\u5e76\u4e0d\u4f1a\u7acb\u5373\u8fdb\u884c\u8ba1\u7b97\uff0c\u800c\u662f\u5148\u628a\u7a97\u53e3\u5185\u7684\u6240\u6709\u6570\u636e\u6536\u96c6\u8d77\u6765\uff0c\u7b49\u5230\u7a97\u53e3\u5173\u95ed\u65f6\u518d\u8c03\u7528\u5168\u7a97\u53e3\u51fd\u6570\u904d\u5386\u6240\u6709\u6570\u636e\u4e00\u6b21\u6027\u5730\u8ba1\u7b97\uff0c\u7c7b\u4f3c\u4e8e\u6279\u5904\u7406\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#window_api","title":"Window API\u8c03\u7528\u987a\u5e8f\uff1f","text":"<ul> <li> <p>WindowAssigner\uff1a\u521b\u5efaWindowedStream\u7684window()\u65b9\u6cd5\u9700\u8981\u4f20\u5165\u62bd\u8c61\u7c7bWindowAssigner\uff08\u7a97\u53e3\u5206\u914d\u5668\uff09\u7684\u4e00\u4e2a\u5b50\u7c7b\u5bf9\u8c61\u6765\u6307\u5b9a\u521b\u5efa\u7a97\u53e3\u7684\u7c7b\u578b\u4ee5\u53ca\u4e00\u4e9b\u5c5e\u6027\u3002</p> </li> <li> <p>Trigger\uff1atrigger()\u65b9\u6cd5\u53ef\u9009\uff0c\u5728\u5f00\u7a97\u4e4b\u540e\uff0c\u4f7f\u7528\u7a97\u53e3\u805a\u5408\u7b97\u5b50\u4e4b\u524d\u8c03\u7528\uff0c\u4f20\u5165Trigger\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u5bf9\u8c61\u3002\u6bcf\u5f53\u6709\u5143\u7d20\u52a0\u5165\u5230\u8be5\u7a97\u53e3\uff0c\u6216\u8005\u4e4b\u524d\u6ce8\u518c\u7684\u5b9a\u65f6\u5668\u8d85\u65f6\u4e86\uff0c\u90a3\u4e48Trigger\u90fd\u4f1a\u88ab\u8c03\u7528\u3002</p> </li> </ul> <p>Trigger\u7684\u8fd4\u56de\u7ed3\u679c\u53ef\u4ee5\u662f \uff1a</p> <ol> <li> <p><code>CONTINUE</code>\uff08\u7ee7\u7eed\u3001\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\uff09</p> </li> <li> <p><code>FIRE</code>\uff08\u89e6\u53d1\u8ba1\u7b97\uff0c\u5904\u7406\u7a97\u53e3\u6570\u636e\uff09</p> </li> <li> <p><code>PURGE</code>\uff08\u89e6\u53d1\u6e05\u7406\uff0c\u79fb\u9664\u7a97\u53e3\u548c\u7a97\u53e3\u4e2d\u7684\u6570\u636e\uff09</p> </li> <li> <p><code>FIRE_AND_PURGE</code>\uff08\u89e6\u53d1\u8ba1\u7b97+\u6e05\u7406\uff0c\u5904\u7406\u6570\u636e\u5e76\u79fb\u9664\u7a97\u53e3\u548c\u7a97\u53e3\u4e2d\u7684\u6570\u636e\uff09</p> </li> <li> <p>Evictor\uff1aevictor()\u65b9\u6cd5\u53ef\u9009\uff0c\u5728trigger()\u4e4b\u540e\uff0c\u4f7f\u7528\u7a97\u53e3\u805a\u5408\u7b97\u5b50\u4e4b\u524d\u8c03\u7528\uff0c\u4f20\u5165Evictor\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u5bf9\u8c61\u3002Evictor \u4e3b\u8981\u7528\u6765\u904d\u5386\u7a97\u53e3\u4e2d\u7684\u5143\u7d20\u5217\u8868\uff0c\u5e76\u51b3\u5b9a\u6700\u5148\u8fdb\u5165\u7a97\u53e3\u7684\u591a\u5c11\u4e2a\u5143\u7d20\u9700\u8981\u88ab\u79fb\u9664\u3002\u5269\u4f59\u7684\u5143\u7d20\u4f1a\u4ea4\u7ed9\u7528\u6237\u6307\u5b9a\u7684\u51fd\u6570\u8fdb\u884c\u7a97\u53e3\u7684\u8ba1\u7b97\u3002\u5982\u679c\u6ca1\u6709 Evictor \u7684\u8bdd\uff0c\u7a97\u53e3\u4e2d\u7684\u6240\u6709\u5143\u7d20\u4f1a\u4e00\u8d77\u4ea4\u7ed9\u51fd\u6570\u8fdb\u884c\u8ba1\u7b97\u3002</p> </li> <li> <p>allowedLateness()\uff1a\u4f7f\u7528WindowedStream\u7684allowedLateness()\u65b9\u6cd5\u8bbe\u7f6e\u4e00\u4e2a\u5141\u8bb8\u8fdf\u5230\u7684\u65f6\u95f4\uff0c\u6bd4\u5982allowedLateness(Time.seconds(2))\u8868\u793a\u5141\u8bb8\u6570\u636e\u8fdf\u52302s\u3002\u8bbe\u7f6e\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u4e4b\u540e\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff0c\u5728\u7a97\u53e3\u5173\u95ed\u65f6\uff0c\u4f1a\u5bf9\u7a97\u53e3\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u8ba1\u7b97\u7136\u540e\u8f93\u51fa\u7ed3\u679c\uff0c\u5728\u5141\u8bb8\u8fdf\u5230\u65f6\u95f4\u5185\u6765\u7684\u8fdf\u5230\u6570\u636e\uff0c\u6bcf\u6765\u4e00\u6761\u90fd\u4f1a\u4e0e\u5df2\u5173\u95ed\u7a97\u53e3\u4e2d\u7684\u6570\u636e\u91cd\u65b0\u505a\u4e00\u6b21\u8ba1\u7b97\u5f97\u5230\u7ed3\u679c\uff0c\u7136\u540e\u8f93\u51fa\u8fd9\u4e2a\u7ed3\u679c\u3002</p> </li> <li> <p>sideOutputLateData()\uff1a\u4f7f\u7528WindowedStream\u7684sideOutputLateData()\u65b9\u6cd5\u8bbe\u7f6e\u4fa7\u8f93\u51fa\u6d41\uff0c\u5bf9\u4e8e\u5728\u5141\u8bb8\u65f6\u95f4\u4e4b\u540e\u8fdf\u5230\u7684\u6570\u636e\u76f4\u63a5\u6254\u8fdb\u4fa7\u8f93\u51fa\u6d41\u4e2d\uff0c\u518d\u5728\u4fa7\u8f93\u51fa\u6d41\u4e2d\u505a\u5904\u7406\u3002</p> </li> <li> <p>getSideOutput()\uff1a\u4f7f\u7528getSideOutput()\u65b9\u6cd5\u62ff\u5230\u4fa7\u8f93\u51fa\u6d41\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_6","title":"Flink\u6709\u54ea\u51e0\u79cd\u72b6\u6001\u53ca\u5176\u7279\u70b9\uff1f","text":"<p>\u6d41\u5f0f\u8ba1\u7b97\u5206\u4e3a\u65e0\u72b6\u6001\u548c\u6709\u72b6\u6001\u4e24\u79cd\u60c5\u51b5\u3002\u72b6\u6001\u662f\u6307\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\u3002\u65e0\u72b6\u6001\u4e0d\u4f1a\u4fdd\u5b58\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\uff0c\u6570\u636e\u6765\u4e00\u6761\u5904\u7406\u4e00\u6761\uff0c\u6bd4\u5982map\u7b97\u5b50\uff1b\u6709\u72b6\u6001\u4f1a\u4fdd\u5b58\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\uff0c\u6570\u636e\u6765\u4e00\u6761\u5c31\u4f1a\u57fa\u4e8e\u4e4b\u524d\u4fdd\u5b58\u7684\u72b6\u6001\u8ba1\u7b97\u4e00\u4e2a\u7ed3\u679c\uff0c\u5e76\u628a\u8fd9\u4e2a\u7ed3\u679c\u66f4\u65b0\u5230\u72b6\u6001\u4e2d\uff0c\u6bd4\u5982\u805a\u5408\u7b97\u5b50\u5c31\u662f\u6709\u72b6\u6001\u7684\u8ba1\u7b97\u3002</p> <p>\u72b6\u6001\u6709\u4e24\u4e2a\u4f5c\u7528\uff1a \u4e00\u662f\u5bf9\u4e8e\u6709\u72b6\u6001\u7b97\u5b50\uff0c\u72b6\u6001\u4f5c\u4e3a\u4e2d\u95f4\u8ba1\u7b97\u7ed3\u679c\uff1b\u4e8c\u662f\u72b6\u6001\u662fcheckpoint\u7684\u57fa\u7840\uff0c\u5bf9\u4e8eflink\u7684\u9ad8\u53ef\u7528\u5bb9\u707e\u610f\u4e49\u91cd\u5927\u3002</p> <p>\u72b6\u6001\u53c8\u5206\u4e3a\u7c7b\u578b\uff1a</p> <ul> <li> <p>\u7b97\u5b50\u72b6\u6001\uff08 Operator State\uff09</p> </li> <li> <p>\u952e\u63a7\u72b6\u6001\uff08 Keyed State\uff09</p> </li> </ul> <p>Operator State\u7279\u70b9\uff1a</p> <ol> <li> <p>\u53ef\u4ee5\u7528\u4e8e\u6240\u6709\u7b97\u5b50\uff0c\u4f46\u6574\u4e2a\u7b97\u5b50\u53ea\u5bf9\u5e94\u4e00\u4e2astate\u3002</p> </li> <li> <p>\u5b9e\u73b0 <code>CheckpointedFunction</code>\u6216\u8005 <code>ListCheckpointed</code>\u63a5\u53e3\u3002</p> </li> <li> <p>\u76ee\u524d\u53ea\u652f\u6301 <code>ListState</code>\u6570\u636e\u7ed3\u6784\u3002</p> </li> </ol> <p>keyed State\u7279\u70b9\uff1a</p> <ol> <li> <p>\u53ea\u80fd\u7528\u5728keyedStream\u4e0a\u7684\u7b97\u5b50\u4e2d\uff0c\u72b6\u6001\u8ddf\u7279\u5b9a\u7684key\u7ed1\u5b9a</p> </li> <li> <p>\u901a\u8fc7RuntimeContext\u8bbf\u95ee\uff0c\u5b9e\u73b0RichFunction\u63a5\u53e3\u3002</p> </li> </ol> <p>\u6bcf\u4e2a\u5206\u7ec4\u4e00\u4e2a\u72b6\u6001\u9700\u8981\u4f7f\u7528\u952e\u63a7\u72b6\u6001\u63a5\u53e3\uff0c\u4ee5\u4e0b\u952e\u63a7\u72b6\u6001\u63a5\u53e3\u5747\u7ee7\u627f\u81eaState\u63a5\u53e3\uff1a</p> <ul> <li> <p>\u503c\u72b6\u6001\uff08 <code>ValueState&lt;T&gt;</code>\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u5355\u4e2a\u7684\u503c</p> </li> <li> <p>\u5217\u8868\u72b6\u6001\uff08<code>ListState&lt;T&gt;</code>\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u4e00\u7ec4\u6570\u636e\u7684\u5217\u8868</p> </li> <li> <p>\u6620\u5c04\u72b6\u6001\uff08 <code>MapState&lt;K, V&gt;</code>\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u4e00\u7ec4 Key-Value \u5bf9</p> </li> <li> <p>\u805a\u5408\u72b6\u6001\uff08<code>ReducingState&lt;T&gt;</code> &amp; <code>AggregatingState&lt;I, O&gt;</code>\uff09\uff1a\u5c06\u72b6\u6001\u8868\u793a\u4e3a\u4e00\u4e2a\u7528\u4e8e\u805a\u5408\u64cd\u4f5c\u7684\u5217\u8868</p> </li> </ul> <p>\u4f7f\u7528\u952e\u63a7\u72b6\u6001\u5fc5\u987b\u5b9e\u73b0\u5bcc\u51fd\u6570\uff0c\u56e0\u4e3a\u952e\u63a7\u72b6\u6001\u9700\u8981\u4ece\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u4e2d\u83b7\u53d6\uff0c\u800c\u4e14\u952e\u63a7\u72b6\u6001\u7684\u521d\u59cb\u5316\u53ea\u80fd\u5728open()\u65b9\u6cd5\u4e2d\u8fdb\u884c\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5b50\u4efb\u52a1\u7684\u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\u662f\u4e0d\u540c\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_3","title":"\u72b6\u6001\u5982\u4f55\u5b58\u50a8\uff1f","text":"<p>\u72b6\u6001\u7531\u72b6\u6001\u540e\u7aefStateBackend\u8d1f\u8d23\u5b58\u50a8\u00a0, \u5b83\u5177\u5907\u4e24\u79cd\u80fd\u529b\uff1a</p> <p>\uff081\uff09\u7ef4\u62a4\u672c\u5730\u72b6\u6001\u3002\u5728\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u63d0\u4f9b\u8bbf\u95eeState\u80fd\u529b\uff0c\u5f00\u53d1\u8005\u5728\u7f16\u5199\u4e1a\u52a1\u903b\u8f91\u4e2d\u80fd\u591f\u4f7f\u7528StateBackend\u7684\u63a5\u53e3\u8bfb\u5199\u6570\u636e\u3002</p> <p>\uff082\uff09\u751f\u6210checkpoint\u3002\u5c06State\u6301\u4e45\u5316\u5230\u5916\u90e8\u5b58\u50a8\u5c31\u53ebcheckpoint\u68c0\u67e5\u70b9\uff0c\u63d0\u4f9b\u5bb9\u9519\u80fd\u529b\u3002</p> <p>Flink\u63d0\u4f9b\u4e86\u4e09\u79cd\u72b6\u6001\u540e\u7aef\uff1a  </p> <ol> <li> <p>MemoryStateBackend\uff1a\u5185\u5b58\u7ea7\u7684\u72b6\u6001\u540e\u7aef\uff0c\u4f1a\u5c06\u72b6\u6001\u653e\u5728 TaskManager \u7684 JVM \u5806\u5185\u5b58\u4e2d\u4f5c\u4e3a\u5bf9\u8c61\u8fdb\u884c\u7ba1\u7406\uff0cState \u5b58\u50a8\u5728 TaskManager\u7684\u5185\u5b58\u4e2d\uff0c\u53d7\u9650\u4e8e TaskManager\u7684\u5185\u5b58\u5927\u5c0f\uff1b\u800c\u5c06 checkpoint \u5b58\u50a8\u5728 JobManager \u7684\u5185\u5b58\u4e2d\u3002\u9002\u7528\u4e8e\u9a8c\u8bc1\u3001\u6d4b\u8bd5\u3001\u4e0d\u63a8\u8350\u751f\u4ea7\u4f7f\u7528\u3002</p> </li> <li> <p>FsStateBackend\uff1a\u5bf9\u4e8e\u672c\u5730\u72b6\u6001\uff0c \u8ddf MemoryStateBackend \u4e00\u6837\uff0c\u653e\u5728 TaskManager \u7684 JVM \u5806\u4e0a\uff0cState \u5b58\u50a8\u5728 TaskManager\u7684\u5185\u5b58\u4e2d\uff0c\u53d7\u9650\u4e8e TaskManager\u7684\u5185\u5b58\u5927\u5c0f\uff1b\u800c\u5c06 checkpoint \u5b58\u5230\u8fdc\u7a0b\u7684\u6301\u4e45\u5316\u6587\u4ef6\u7cfb\u7edf\uff08 FileSystem\uff09 \u4e0a\uff0c \u6bd4\u5982HDFS\uff0c\u6b64\u79cd\u65b9\u5f0f\u540c\u65f6\u62e5\u6709\u5185\u5b58\u7ea7\u7684\u672c\u5730\u8bbf\u95ee\u901f\u5ea6\uff0c\u5bf9\u4e8echeckpoint\u4e5f\u6709\u5bb9\u9519\u4fdd\u8bc1\uff0c\u751f\u4ea7\u73af\u5883\u9996\u9009\u3002</p> </li> <li> <p>RocksDBStateBackend\uff1a\u5bf9\u4e8e\u672c\u5730\u72b6\u6001\uff0cRocksDBStateBackend \u4f7f\u7528\u5d4c\u5165\u5f0f\u7684\u672c\u5730\u6570\u636e\u5e93 RocksDB\u00a0\u5c06\u6d41\u8ba1\u7b97\u6570\u636e\u72b6\u6001\u5b58\u50a8\u5728\u672c\u5730\u78c1\u76d8\u4e2d\uff0c\u4e0d\u4f1a\u53d7\u9650\u4e8eTaskManager \u7684\u5185\u5b58\u5927\u5c0f\uff0c\u5728\u6267\u884ccheckpoint\u7684\u65f6\u5019\uff0c\u518d\u5c06\u6574\u4e2a RocksDB \u4e2d\u4fdd\u5b58\u7684State\u6570\u636e\u5168\u91cf\u6216\u8005\u589e\u91cf\u6301\u4e45\u5316\u5230\u914d\u7f6e\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u6bd4\u5982HDFS\u3002RocksDBStateBackend\u00a0\u76f8\u6bd4\u57fa\u4e8e\u5185\u5b58\u7684StateBackend\uff0c\u8bbf\u95eeState\u7684\u6210\u672c\u9ad8\u5f88\u591a\uff0c\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u6d41\u7684\u541e\u5410\u91cf\u5267\u70c8\u4e0b\u964d\uff0c\u751a\u81f3\u53ef\u80fd\u964d\u4f4e\u4e3a\u539f\u6765\u7684 1/10\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_4","title":"\u72b6\u6001\u6301\u4e45\u5316\u5230\u6587\u4ef6\u7cfb\u7edf\u7684\u7b56\u7565\uff1f","text":"<p>\u6301\u4e45\u5316\u7b56\u7565\u6709\u4e24\u79cd\uff1a</p> <ul> <li> <p>\u5168\u91cf\u6301\u4e45\u5316\u7b56\u7565 \uff1a\u6bcf\u6b21\u5c06\u5168\u91cf\u7684State\u5199\u5165\u5230\u72b6\u6001\u5b58\u50a8\u4e2d\uff08HDFS\uff09\uff0c\u5185\u5b58\u578b\u3001\u6587\u4ef6\u578b\u3001RocksDB\u7c7b\u578b\u7684StataBackend \u90fd\u652f\u6301\u5168\u91cf\u6301\u4e45\u5316\u7b56\u7565\u3002</p> </li> <li> <p>\u589e\u91cf\u6301\u4e45\u5316\u7b56\u7565 \uff1a\u589e\u91cf\u6301\u4e45\u5316\u5c31\u662f\u6bcf\u6b21\u6301\u4e45\u5316\u589e\u91cf\u7684State\uff0c\u53ea\u6709RocksDBStateBackend \u652f\u6301\u589e\u91cf\u6301\u4e45\u5316\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#filnkcheckpoint","title":"Filnk\u7684\u5bb9\u9519\u673a\u5236\uff1fcheckpoint\uff1f","text":"<p>Flink \u4f7f\u7528\u8f7b\u91cf\u7ea7\u5206\u5e03\u5f0f\u5feb\u7167\uff0c\u751f\u6210\u68c0\u67e5\u70b9\uff08checkpoint\uff09\u5b9e\u73b0\u53ef\u9760\u5bb9\u9519\u3002\u5c06State\u6301\u4e45\u5316\u5230\u5916\u90e8\u5b58\u50a8\u540e\u5c31\u53ebcheckpoint\u68c0\u67e5\u70b9\u3002</p> <p>Flink \u4f7f\u7528\u7684\u5206\u5e03\u5f0f\u5feb\u7167\u7b97\u6cd5\u4e5f\u53ebChandy-Lamport \u7b97\u6cd5\uff0c\u5927\u81f4\u539f\u7406\u662f\uff0c\u5f53\u8981\u751f\u6210checkpoint\u7684\u65f6\u5019\uff0cJobManager\u4f1a\u5411\u6240\u6709source\u53d1\u9001\u4e00\u6761\u5e26\u6709\u68c0\u67e5\u70b9ID\u7684\u6d88\u606f\uff0c\u8fd9\u65f6\u6bcf\u4e2asource\u4f1a\u751f\u6210\u4e00\u6761\u4e0ewatermark\u7c7b\u4f3c\u7684\u7279\u6b8a\u6570\u636e\u2014\u2014\u68c0\u67e5\u70b9\u5206\u754c\u7ebf\uff08 Checkpoint Barrier\uff09\uff0c\u6240\u6709\u6709\u72b6\u6001\u5b50\u4efb\u52a1\u6536\u5230Barrier\u4e4b\u540e\u90fd\u4f1a\u4fdd\u5b58checkpoint\uff0c\u8fd9\u6761\u6570\u636e\u7684\u4f20\u9012\u548cwatermark\u4e00\u6837\uff0c\u5f53\u53d1\u751f\u6570\u636e\u7684Redistributing\uff0c\u5c31\u4f1a\u4ee5\u5e7f\u64ad\u7684\u65b9\u5f0f\u4f20\u9012\u5230\u4e0b\u6e38\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e0b\u6e38\u7684\u6240\u6709\u5b50\u4efb\u52a1\u90fd\u4f1a\u6536\u5230\u8fd9\u6761\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#barrier","title":"\u4ec0\u4e48\u662fBarrier\u5bf9\u9f50\uff1f","text":"<p>\u5f53\u4e00\u4e2a\u4e0b\u6e38\u5b50\u4efb\u52a1\u4f1a\u6536\u5230\u591a\u4e2a\u4e0a\u6e38\u5b50\u4efb\u52a1\u7684\u6570\u636e\u65f6\uff0c\u4e5f\u5c31\u4f1a\u6536\u5230\u591a\u4e2abarrier\uff0c\u4e0ewatermark\u53d6\u6700\u5c0f\u503c\u4e0d\u540c\u7684\u662f\uff0c\u6b64\u65f6\u4e0b\u6e38\u5b50\u4efb\u52a1\u4f1a\u7b49\u6240\u6709source\u7684barrier\u5230\u9f50\u4e4b\u540e\u624d\u5f00\u59cb\u4fdd\u5b58\u72b6\u6001\u5230checkpoint\uff08\u79f0\u4e3abarrier\u5bf9\u9f50\uff09\uff0c\u8fd9\u662f\u56e0\u4e3abarrier\u542b\u4e49\u662f\u6240\u6709barrier\u4e4b\u524d\u7684\u6570\u636e\u90fd\u5e94\u8be5\u662f\u5df2\u7ecf\u5904\u7406\u5b8c\u4fdd\u5b58\u5728\u72b6\u6001\u4e2d\u4e86\uff0c\u800cbarrier\u4e4b\u540e\u7684\u6570\u636e\u5e94\u8be5\u4fdd\u5b58\u5728\u4e0b\u4e00\u4e2a\u72b6\u6001\u4e2d\uff0c\u6240\u4ee5\u5728barrier\u5c1a\u672a\u5230\u9f50\u4e4b\u524d\uff0c\u5bf9\u4e8ebarrier\u5df2\u7ecf\u5230\u8fbe\u7684\u5206\u533a\uff0c\u7ee7\u7eed\u5230\u8fbe\u7684\u6570\u636e\u4f1a\u88ab\u7f13\u5b58\uff0c \u800cbarrier\u5c1a\u672a\u5230\u8fbe\u7684\u5206\u533a\uff0c\u6570\u636e\u4f1a\u88ab\u6b63\u5e38\u5904\u7406\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#savepoint","title":"\u4ec0\u4e48\u662fSavepoint\u4fdd\u5b58\u70b9\uff1f","text":"<p>\u4fdd\u5b58\u70b9\u4e0e\u68c0\u67e5\u70b9\u539f\u7406\u4e00\u6837\uff0c\u4e5f\u53ef\u7528\u4e8e\u6062\u590d\u7a0b\u5e8f\u3002\u4fdd\u5b58\u70b9\u4e0e\u68c0\u67e5\u70b9\u4e0d\u540c\u4e4b\u5904\u5c31\u5728\u4e8e\uff1a</p> <p>1.\u4fdd\u5b58\u70b9\u9700\u8981\u4eba\u4e3a\u624b\u52a8\u5730\u89e6\u53d1\uff0c\u800c\u68c0\u67e5\u70b9\u662f\u7531Flink\u5468\u671f\u6027\u5730\u751f\u6210\u3002</p> <p>2.\u4ece\u4fdd\u5b58\u70b9\u4e2d\u6062\u590d\u7a0b\u5e8f\u9700\u8981\u5728\u63d0\u4ea4\u5e94\u7528\u65f6\u6307\u5b9a\u4fdd\u5b58\u70b9\u7684\u4f4d\u7f6e\uff0c\u9002\u7528\u4e8e\u5e94\u7528\u5347\u7ea7\u3001\u96c6\u7fa4\u8fc1\u79fb\u3001 Flink \u96c6\u7fa4\u7248\u672c\u66f4\u65b0\u3001A/B\u6d4b\u8bd5\u4ee5\u53ca\u5047\u5b9a\u573a\u666f\u3001\u6682\u505c\u548c\u91cd\u542f\u3001\u5f52\u6863\u7b49\u573a\u666f\u3002\u800c\u68c0\u67e5\u70b9\u662f\u7528\u4e8e\u6545\u969c\u6062\u590d\u7684\uff0c\u5176\u6062\u590d\u8fc7\u7a0b\u7531Flink\u81ea\u52a8\u8fdb\u884c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#checkpoint","title":"Checkpoint\u4e2d\u4fdd\u5b58\u7684\u662f\u4ec0\u4e48\u4fe1\u606f\uff1f","text":"<p>\u5bf9\u4e8eSource\uff0ccheckpoint\u603b\u4fdd\u5b58\u7684\u662f\u8bfb\u53d6\u6570\u636e\u6e90\u7684\u504f\u79fboffset\uff1b\u5bf9\u4e8etransform\u7b97\u5b50\uff0ccheckpoint\u4fdd\u5b58\u7684\u662fState\uff1bsink\u7b97\u5b50\u867d\u7136\u6ca1\u6709checkpoint\u9700\u8981\u4fdd\u5b58\uff0c\u4f46\u662fsink\u4efb\u52a1\u6536\u5230barrier\u4e4b\u540e\u9700\u8981\u5411JobManager\u53d1\u9001\u786e\u8ba4\u6d88\u606f\uff0c\u5f53\u6240\u6709sink\u4efb\u52a1\u90fd\u53d1\u9001\u5b8c\u6d88\u606f\u540e\uff0c\u68c0\u67e5\u70b9\u624d\u7b97\u771f\u6b63\u4fdd\u5b58\u5b8c\u6210\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_5","title":"\u5f53\u4f5c\u4e1a\u5931\u8d25\u540e\uff0c\u68c0\u67e5\u70b9\u5982\u4f55\u6062\u590d\u4f5c\u4e1a\uff1f","text":"<p>Flink\u63d0\u4f9b\u4e86\u4e24\u79cd\u6062\u590d\u673a\u5236\uff1a\u00a0\u5e94\u7528\u81ea\u52a8\u6062\u590d\u673a\u5236\u00a0\u548c\u00a0\u624b\u52a8\u4f5c\u4e1a\u6062\u590d\u673a\u5236\u3002</p> <p>\u5e94\u7528\u81ea\u52a8\u6062\u590d\u673a\u5236\uff1a</p> <ol> <li>\u5b9a\u671f\u6062\u590d\u7b56\u7565\uff1afixed-delay</li> </ol> <p>\u56fa\u5b9a\u5ef6\u8fdf\u91cd\u542f\u7b56\u7565\u4f1a\u5c1d\u8bd5\u4e00\u4e2a\u7ed9\u5b9a\u7684\u6b21\u6570\u6765\u91cd\u542fJob\uff0c\u5982\u679c\u8d85\u8fc7\u6700\u5927\u7684\u91cd\u542f\u6b21\u6570\uff0cJob\u6700\u7ec8\u5c06\u5931\u8d25\uff0c\u5728\u8fde\u7eed\u4e24\u6b21\u91cd\u542f\u5c1d\u8bd5\u4e4b\u95f4\uff0c\u91cd\u542f\u7b56\u7565\u4f1a\u7b49\u5f85\u4e00\u4e2a\u56fa\u5b9a\u65f6\u95f4\uff0c\u9ed8\u8ba4Integer.MAX_VALUE\u6b21</p> <ol> <li> <p>\u5931\u8d25\u6bd4\u7387\u7b56\u7565\uff1afailure-rate</p> </li> <li> <p>\u76f4\u63a5\u5931\u8d25\u7b56\u7565\uff1aNone \uff0c\u5931\u8d25\u4e0d\u91cd\u542f</p> </li> </ol> <p>\u624b\u52a8\u4f5c\u4e1a\u6062\u590d\u673a\u5236\uff1a\u63d0\u4ea4\u5e94\u7528\u65f6\u6307\u5b9acheckpoint\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_7","title":"\u4ec0\u4e48\u662f\u72b6\u6001\u4e00\u81f4\u6027\uff0cFlink\u63d0\u4f9b\u4e86\u54ea\u4e00\u4e2a\u7ea7\u522b\u7684\u72b6\u6001\u4e00\u81f4\u6027\uff1f","text":"<p>\u5bf9\u4e8e\u5206\u5e03\u5f0f\u5e94\u7528\u800c\u8a00\uff0c\u4efb\u4f55\u4e00\u4e2a\u73af\u8282\u51fa\u73b0\u5f02\u5e38\u90fd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u7684\u4e22\u5931\u6216\u8005\u91cd\u590d\u8ba1\u7b97\uff0c\u4e8e\u662f\u72b6\u6001\u4e00\u81f4\u6027\u53ef\u5206\u4e3a3\u4e2a\u7b49\u7ea7\uff1a</p> <ul> <li> <p>at-most-once\uff1a\u6570\u636e\u6700\u591a\u88ab\u6d88\u8d39\u4e00\u6b21</p> </li> <li> <p>at-least-once\uff1a\u6570\u636e\u6700\u5c11\u6d88\u8d39\u4e00\u6b21</p> </li> <li> <p>exactly-once\uff1a\u6570\u636e\u6070\u597d\u88ab\u6d88\u8d39\u4e00\u6b21</p> </li> </ul> <p>Flink\u7684checkpoint\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1Flink\u5185\u90e8\u72b6\u6001exactly-once\uff0c\u4f46\u6574\u4e2a\u6570\u636e\u5904\u7406\u6d41\u7a0b\u7684\u72b6\u6001\u4e00\u81f4\u6027\u7ea7\u4e0d\u4ec5\u53d6\u51b3\u4e8eFlink\u5185\u90e8\uff0c\u8fd8\u53d6\u51b3\u4e8eFlink\u7684source\u4e0esink\u8fde\u63a5\u7684\u5916\u90e8\u7cfb\u7edf\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u6574\u4e2a\u7cfb\u7edf\u7684\u72b6\u6001\u4e00\u81f4\u6027\u7ea7\u522b\u53d6\u51b3\u4e8e\u6240\u6709\u7ec4\u4ef6\u4e2d\u4e00\u81f4\u6027\u6700\u5f31\u7684\u90a3\u4e00\u4e2a\uff0c\u8fd9\u4e5f\u88ab\u79f0\u4e3a\u7aef\u5230\u7aef\uff08end-to-end\uff09\u72b6\u6001\u4e00\u81f4\u6027\u3002</p> <p>Flink source\u7aef\u4e00\u81f4\u6027\u7ea7\u522b\u53d6\u51b3\u4e8e\u5916\u90e8\u7cfb\u7edf\u53ef\u4e0d\u53ef\u4ee5\u91cd\u7f6e\u6570\u636e\u7684\u8bfb\u53d6\u4f4d\u7f6e\uff0c\u6bd4\u5982socket\u4e0d\u53ef\u4ee5\u91cd\u8bbe\u8bfb\u53d6\u4f4d\u7f6e\uff0c\u90a3\u4e48source\u7aef\u4e00\u81f4\u6027\u7ea7\u522b\u5c31\u662fat-most-once\uff0cKafka\u53ef\u4ee5\u8bbe\u7f6eoffset\uff0c\u90a3\u4e48source\u7aef\u5c31\u662fexactly-once\uff0c\u6b64\u65f6offset\u4fdd\u5b58\u5728Flink\u7684\u72b6\u6001\u4e2d\uff0c\u4e0d\u662f\u4fdd\u5b58\u5728Kafka\u7684\u9ed8\u8ba4topic\u91cc\uff0c\u4e0d\u9700\u8981\u63d0\u4ea4offset\u3002</p> <p>\u8981\u4fdd\u8bc1sink\u7aefexactly-once\uff0c\u5c31\u9700\u8981\u4fdd\u8bc1\u4ece\u6545\u969c\u6062\u590d\u65f6\uff0c\u6570\u636e\u4e0d\u4f1a\u91cd\u590d\u5199\u5165\u5916\u90e8\u7cfb\u7edf\uff0c\u5177\u4f53\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff1a\u5e42\u7b49\uff08Idempotent\uff09\u5199\u5165 \u548c \u4e8b\u52a1\u6027\uff08Transactional\uff09\u5199\u5165\u3002</p> <ul> <li> <p>\u5e42\u7b49\u5199\u5165\u662f\u6307\u5916\u90e8\u7cfb\u7edf\u5bf9\u4e8e\u91cd\u590d\u7684\u5199\u5165\u64cd\u4f5c\u53ea\u4f1a\u4fdd\u7559\u4e00\u6b21\u7ed3\u679c\u3002\u6bd4\u5982\u6570\u636e\u5e93\u7684\u552f\u4e00\u4e3b\u952e\u53ef\u4ee5\u963b\u6b62\u91cd\u590d\u7684\u63d2\u5165\u64cd\u4f5c\uff1bRedis\u7684setnx\u547d\u4ee4\u7684\u8bed\u4e49\u672c\u4e8b\u5c31\u5177\u6709\u5e42\u7b49\u6027\uff0c\u4f46\u662f\u5bf9\u4e8emap\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5728Flink\u6545\u969c\u6062\u590d\u4e4b\u540e\u7684\u91cd\u65b0\u8ba1\u7b97\u53ef\u80fd\u4f1a\u5f15\u8d77\u77ed\u6682\u5730\u7ed3\u679c\u56de\u9000\uff0c\u4f46\u662f\u6700\u7ec8\u8fd8\u662f\u53ef\u4ee5\u8fbe\u5230\u72b6\u6001\u4e00\u81f4\u6027\uff1bKafka\u53ef\u4ee5\u5f00\u542f<code>acks=all</code>\u548c\u5e42\u7b49\u3002</p> </li> <li> <p>\u4e8b\u52a1\u6027\u5199\u5165\u662f\u6307\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u5f0f\u2014\u2014\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\uff082PC\uff09\u3002Flink\u7684 TwoPhaseCommitSinkFunction \u51fd\u6570\u63d0\u53d6\u5e76\u5c01\u88c5\u4e86\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u4e2d\u7684\u516c\u5171\u903b\u8f91\uff0c\u4fdd\u8bc1Flink \u53d1\u9001Sink\u7aef\u65f6\u5b9e\u73b0\u4e25\u683c\u4e00\u6b21\u5904\u7406\u8bed\u4e49\u3002\u4e8b\u52a1\u6027\u5199\u5165\u8fd8\u9700\u8981\u5916\u90e8\u7cfb\u7edf\u652f\u6301\u4e8b\u52a1\uff0c\u901a\u8fc7\u6784\u5efa\u4e8b\u52a1\u6765\u5199\u5165\u5916\u90e8\u7cfb\u7edf\uff0c\u5177\u6709\u4e8b\u52a1\u7684\u7279\u70b9\uff0c\u5373\u8981\u4e48\u5168\u90e8\u5199\u5165\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u4e0d\u4f1a\u91cd\u590d\u6570\u636e\u3002\u4e8b\u52a1\u7684\u5f00\u59cb\u5bf9\u5e94\u7740\u4fdd\u5b58checkpoint\u7684\u5f00\u59cb\uff0ccheckpoint\u771f\u6b63\u5b8c\u6210\u65f6\u4e8b\u52a1\u7ed3\u675f\uff0c\u8fd9\u65f6\u624d\u628a\u6240\u6709\u7ed3\u679c\u63d0\u4ea4\u5230sink\u6240\u8fde\u63a5\u7684\u5916\u90e8\u7cfb\u7edf\u4e2d\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_8","title":"Flink\u53cd\u538b\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Flink/#_6","title":"\u4ec0\u4e48\u662f\u53cd\u538b\uff1f","text":"<p>\u5f53\u4e0b\u6e38\u4efb\u52a1\u5904\u7406\u6570\u636e\u7684\u901f\u5ea6 \u8fdc\u4f4e\u4e8e \u4e0a\u6e38\u4efb\u52a1\u53d1\u9001\u6570\u636e\u7684\u901f\u5ea6 \u65f6\uff0c\u5982\u679c\u4e0d\u9650\u5236\u4e0a\u6e38\u4efb\u52a1\u7684\u53d1\u9001\u901f\u5ea6\uff0c\u5c31\u53ef\u80fd\u4f1a\u9020\u6210OOM\uff0c\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\uff0c\u53cd\u538b\u6b63\u662f\u7528\u6765\u5f53\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u65f6\u9650\u5236\u4e0a\u6e38\u53d1\u9001\u901f\u5ea6\u7684\u4e00\u79cd\u673a\u5236\uff0c\u80fd\u9632\u6b62\u7cfb\u7edf\u5d29\u6e83\u3002\u5f15\u5165\u53cd\u538b\u673a\u5236\u4e4b\u540e\uff0c\u5f53\u53d1\u751f\u4e0b\u6e38\u5904\u7406\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u4e0a\u6e38\u5904\u7406\u901f\u5ea6\u65f6\uff0c\u4e0b\u6e38\u4f1a\u53ca\u65f6\u5411\u4e0a\u6e38\u53cd\u9988\uff0c\u4ece\u800c\u6291\u5236\u4e0a\u6e38\u7684\u53d1\u9001\u901f\u5ea6\uff0c\u7136\u540e\u5982\u679c\u76f4\u63a5\u4e0a\u6e38\u6ca1\u6709\u7f13\u5b58\u6570\u636e\u7684\u80fd\u529b\uff0c\u4f1a\u63a5\u7740\u7ee7\u7eed\u5411\u4e0a\u6e38\u53cd\u538b\uff0c\u76f4\u5230source\u653e\u6162\u8bfb\u6570\u636e\u3002\u6240\u4ee5\u53cd\u538b\u6cbf\u7740\u76f8\u53cd\u7684\u65b9\u5411\u4f20\u64ad\uff0c\u6cbf\u7740\u6570\u636e\u6d41\u5411\u4e0a\u6e38\u4f20\u64ad\u3002\u51fa\u73b0\u53cd\u538b\u4e4b\u540e\uff0c\u867d\u7136\u7cfb\u7edf\u4e0d\u81f3\u4e8e\u7acb\u5373\u5d29\u6e83\uff0c\u4f46\u8fd9\u8868\u793a\u7cfb\u7edf\u6027\u80fd\u5df2\u7ecf\u4e25\u91cd\u964d\u4f4e\uff0c\u6240\u4ee5\u6211\u4eec\u6211\u4eec\u5fc5\u987b\u53ca\u65f6\u6392\u67e5\u5bfc\u81f4\u53cd\u538b\u7684\u95ee\u9898\u5e76\u52a0\u4ee5\u89e3\u51b3\uff08\u5c31\u50cf\u4eba\u611f\u89c9\u5230\u5bd2\u51b7\u4f1a\u6253\u5bd2\u98a4\u4e00\u6837\uff0c\u5982\u679c\u4eba\u6ca1\u6709\u6253\u5bd2\u98a4\u673a\u5236\uff0c\u90a3\u4e48\u4eba\u4f1a\u56e0\u4e3a\u4f53\u6e29\u6d41\u5931\u800c\u6b7b\u4ea1\uff0c\u4eba\u5f15\u5165\u6253\u5bd2\u98a4\u673a\u5236\u4e4b\u540e\u6709\u4e24\u4e2a\u4f5c\u7528\uff0c\u4e00\u662f\u4ea7\u751f\u5c11\u91cf\u70ed\u91cf\uff0c\u4e0d\u81f3\u4e8e\u7acb\u523b\u55dd\u5c41\uff0c\u4e8c\u662f\u7ed9\u5927\u8111\u62a5\u8b66\uff0c\u4f46\u662f\u5bd2\u51b7\u7684\u95ee\u9898\u5fc5\u987b\u8981\u5c3d\u5feb\u89e3\u51b3\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_7","title":"\u51fa\u73b0\u53cd\u538b\u4f1a\u9020\u6210\u54ea\u4e9b\u5f71\u54cd\uff1f","text":"<p>\u9996\u5148\u8bf4\u660e\u53cd\u538b\u662f\u7cfb\u7edf\u7684\u4e00\u4e2a\u6b63\u5411\u8c03\u8282\u673a\u5236\uff0c\u4e0d\u662f\u5bfc\u81f4\u95ee\u9898\u51fa\u73b0\u7684\u8d1f\u5411\u539f\u56e0\uff0c\u4ed6\u4eec\u4e4b\u95f4\u662f\u6709\u56e0\u679c\u5173\u7cfb\u7684\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\u63d0\u95ee\uff1f\u56e0\u4e3a\u4ed6\u4eec\u603b\u662f\u540c\u65f6\u51fa\u73b0\uff0c\u6240\u4ee5\u8fd9\u4e9b\u6982\u5ff5\u7ecf\u5e38\u4f1a\u6df7\u5728\u4e00\u8d77\u63d0\u53ca\u3002\u6bd4\u5982\u6570\u636e\u503e\u659c\u662f\u9020\u6210\u53cd\u538b\u7684\u539f\u56e0\uff0c\u4e0b\u6e38\u4efb\u52a1\u5904\u7406\u6570\u636e\u7684\u901f\u5ea6 \u8fdc\u4f4e\u4e8e \u4e0a\u6e38\u4efb\u52a1\u53d1\u9001\u6570\u636e\u7684\u901f\u5ea6\u662f\u6570\u636e\u503e\u659c\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u53cd\u538b\u662f\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\u7684\u624b\u6bb5\u3002\u4e0b\u6e38\u5904\u7406\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u4e0a\u6e38\u5904\u7406\u901f\u5ea6\u4f1a\u5bfc\u81f4checkpoint\u65f6\u95f4\u8fc7\u957f\uff0c\u56e0\u4e3a checkpoint barrier \u662f\u4e0d\u4f1a\u8d8a\u8fc7\u666e\u901a\u6570\u636e\u7684\uff0c\u6570\u636e\u5904\u7406\u88ab\u963b\u585e\u4e5f\u4f1a\u5bfc\u81f4\u00a0checkpoint barrier \u6d41\u7ecf\u6574\u4e2a\u6570\u636e\u7ba1\u9053\u7684\u65f6\u957f\u53d8\u957f\uff0c\u56e0\u800c checkpoint \u603b\u4f53\u65f6\u95f4\uff08End to End Duration\uff09\u53d8\u957f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_9","title":"Flink\u662f\u5982\u4f55\u5b9e\u73b0\u53cd\u538b\u7684\uff1f","text":"<p>flink\u7684\u53cd\u538b\u7ecf\u5386\u4e86\u4e24\u4e2a\u53d1\u5c55\u9636\u6bb5,\u5206\u522b\u662f\u57fa\u4e8eTCP\u7684\u53cd\u538b(&lt;1.5)\u548c\u57fa\u4e8ecredit\u7684\u53cd\u538b(&gt;1.5)</p> <ul> <li> <p>\u57fa\u4e8e TCP\u7684\u6ed1\u52a8\u7a97\u53e3\u673a\u5236\u7684\u53cd\u538b\uff0c\u57fa\u4e8eTCP\u7684\u53cd\u538b\u6700\u5927\u7684\u95ee\u9898\u662f\u4f1a\u9020\u6210\u6574\u4e2aTaskManager\u7aef\u7684\u53cd\u538b\uff0c\u6240\u6709\u7684task\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd</p> </li> <li> <p>\u57fa\u4e8e Credit \u7684\u53cd\u538b\uff0cRS\u4e0eIC\u4e4b\u95f4\u901a\u8fc7backlog\u548ccredit\u6765\u786e\u5b9a\u53cc\u65b9\u53ef\u4ee5\u53d1\u9001\u548c\u63a5\u53d7\u7684\u6570\u636e\u91cf\u7684\u5927\u5c0f\u4ee5\u63d0\u524d\u611f\u77e5\uff0c\u800c\u4e0d\u662f\u901a\u8fc7TCP\u6ed1\u52a8\u7a97\u53e3\u7684\u5f62\u5f0f\u6765\u786e\u5b9abuffer\u7684\u5927\u5c0f\u4e4b\u540e\u518d\u8fdb\u884c\u53cd\u538b</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_8","title":"\u600e\u4e48\u6837\u624d\u80fd\u77e5\u9053\u7cfb\u7edf\u51fa\u73b0\u4e86\u53cd\u538b\uff1f","text":"<p>webUI\u9875\u9762\u76d1\u63a7\u53cd\u538b</p>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#_9","title":"\u6709\u54ea\u4e9b\u95ee\u9898\u4f1a\u5bfc\u81f4\u53cd\u538b\uff1f\u6362\u53e5\u8bdd\u8bf4\uff0c\u51fa\u73b0\u53cd\u538b\u6211\u4eec\u5e94\u8be5\u4ece\u54ea\u4e9b\u65b9\u9762\u53bb\u6392\u67e5\uff1f","text":"<ol> <li> <p>\u7cfb\u7edf\u8d44\u6e90\u4e0d\u8db3\uff0c\u4e3b\u8981\u662fcpu\u548c\u5185\u5b58\u8d44\u6e90\uff0c\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u589e\u52a0\u670d\u52a1\u5668\u7684\u6570\u91cf\uff1b\u8fd8\u6709\u4e2a\u529e\u6cd5\u53ef\u4ee5\u7f13\u89e3\u4e00\u4e0b\u5185\u5b58\u8d44\u6e90\u4e0d\u8db3\u95ee\u9898\uff0c\u90a3\u5c31\u662f<code>\u7b97\u5b50\u94fe</code>\u673a\u5236\uff0c\u7b97\u5b50\u94fe\u5c31\u662f\u628a\u5e76\u884c\u5ea6\u76f8\u540c\u7684\u4e24\u4e2a\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u5408\u5e76\u6210\u4e00\u4e2a\u5b50\u4efb\u52a1\u3002</p> </li> <li> <p>\u6570\u636e\u503e\u659c</p> </li> <li> <p>\u5916\u90e8IO\u4f9d\u8d56\uff0cIO\u5c5e\u4e8e\u5f88\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u7b97\u5b50\u7684\u5b50\u4efb\u52a1\u5728\u8fdb\u884cIO\u64cd\u4f5c\u5c31\u4f1a\u9020\u6210\u5904\u7406\u901f\u5ea6\u5f88\u91cd\u964d\u4f4e\uff0c\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u4f7f\u7528Flink\u63d0\u4f9b\u7684\u5f02\u6b65IO\u64cd\u4f5c\uff0c\u6216\u8005\u8fd8\u53ef\u4ee5\u52a0\u5165\u7f13\u5b58\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Flink/#flinkjvm","title":"Flink\u4e3a\u4ec0\u4e48\u4f7f\u7528\u81ea\u4e3b\u5185\u5b58\u7ba1\u7406\u800c\u4e0d\u7528JVM\u5185\u5b58\u7ba1\u7406\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Flink/#flink_10","title":"Flink\u5185\u5b58\u6a21\u578b\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Flink/#cep","title":"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bCEP\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Flink/#join","title":"\u53cc\u6d41join?","text":""},{"location":"%E9%97%AE%E7%AD%94/Flink/#io","title":"\u5f02\u6b65IO?","text":"Java<pre><code>public static &lt;IN, OUT&gt; SingleOutputStreamOperator&lt;OUT&gt; orderedWait(DataStream&lt;IN&gt; in, AsyncFunction&lt;IN, OUT&gt; func, long timeout, TimeUnit timeUnit, int capacity) {\n        return addOperator(in, func, timeUnit.toMillis(timeout), capacity, AsyncDataStream.OutputMode.ORDERED);\n    }\n</code></pre> Text Only<pre><code>AsyncDataStream.unorderedWait()\n</code></pre> <p>\u4e3b\u7ebf\u7a0b\u8c03\u7528<code>AsyncDataStream.unorderedWait()</code>\u5c31\u542f\u52a8\u4e86\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u540e\u9762\u6765\u7684\u6d41\u6570\u636e\uff0c\u6bcf\u6765\u4e00\u6761\u6570\u636e\u90fd\u4f1a\u5728\u8fd9\u4e2a\u7ebf\u7a0b\u4e0a\u8c03\u7528<code>AsyncFunction.asyncInvoke()</code>\u65b9\u6cd5\u5904\u7406\u6570\u636e\uff0c\u5728\u8fd9asyncInvoke()\u65b9\u6cd5\u5982\u679c\u4e0d\u53e6\u5916\u4e3a\u6bcf\u6b21\u5230\u6765\u7684\u6570\u636e\u5f00\u8f9f\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u7684\u8bdd\uff0c\u90a3\u4e48\u6570\u636e\u5c31\u662f\u4f9d\u6b21\u6392\u597d\u5e8f\u7b49\u5f85\u53bbHBase\u67e5\u5230\u7ef4\u5ea6\u6570\u636e\u5173\u8054\u597d\u4e4b\u540e\u518d\u5904\u7406\u4e0b\u4e00\u6761\u6570\u636e\uff0c\u6240\u4ee5\u4e00\u822c\u53c8\u4f1a\u5728asyncInvoke()\u65b9\u6cd5\u91cc\u628a\u67e5\u8be2HBase\u7684\u8fc7\u7a0b\u63d0\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u3002</p> <p>~~\u5728\u4e3b\u7ebf\u7a0b\u91cc\u591a\u6b21\u8c03\u7528AsyncDataStream.unorderedWait()\u6548\u679c\u7684\u662f\u8fd9\u4e9b\u7ebf\u7a0b\u5728\u540c\u65f6\u5904\u7406\u6570\u636e\uff0c\u6bd4\u5982\u5982\u679c\u4e0d\u662f\u5f02\u6b65\uff0c\u90a3\u4e48\u6548\u679c\u662f\u5148\u67e5A\u7ef4\u8868\u5904\u7406\u597d\u8fd9\u4e00\u6761\u6570\u636e\uff0c\u7136\u540e\u8fd9\u6761\u6570\u636e\u6d41\u5230\u4e0b\u6e38\u518d\u67e5B\u7ef4\u8868\u5173\u8054\u7ef4\u5ea6\uff1b\u5982\u679c\u4f7f\u7528\u4e86AsyncDataStream.unorderedWait()\uff0c\u90a3\u4e48\u8fd9\u6761\u6570\u636e\u4f1a\u540c\u65f6\u51fa\u73b0\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u67e5\u5bf9\u5e94\u7684\u7ef4\u8868\u5173\u8054\u7ef4\u5ea6\u3002~~</p> <p>\u53c2\u8003\uff1a\u53f2\u4e0a\u6700\u5168\u5e72\u8d27\uff01Flink\u9762\u8bd5\u5927\u5168\u603b\u7ed3\uff08\u5168\u65876\u4e07\u5b57\u3001110\u4e2a\u77e5\u8bc6\u70b9\u3001160\u5f20\u56fe\uff09</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/","title":"HBase","text":"<p> \u7ea6 3120 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 62 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase","title":"HBase\u8868\u7684\u903b\u8f91\u7ed3\u6784\uff1f","text":"<p>HBase\u8868\u7684\u903b\u8f91\u7ed3\u6784\u53ea\u6d89\u53ca\u8fd9\u4e2a\u6982\u5ff5\uff1aRowKey\u3001\u5217\u65cf\u3001\u5217\u3001timestamp\u3002\u901a\u8fc7 RowKey + \u5217\u65cf + \u5217 \u786e\u5b9a\u4e00\u4e2a\u5355\u5143\u683c\uff0c\u4e00\u4e2a\u5355\u5143\u683c\u6709\u591a\u4e2a\u7248\u672c\u7684\u5386\u53f2\u6570\u636e\uff0c\u9760timestamp\u6807\u8bc6\u3002</p> <ul> <li> <p>RowKey\uff1a\u6bcf\u4e00\u884c\u6570\u636e\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684RowKey\uff0c\u5728\u5efa\u8868\u65f6\u4e0d\u9700\u8981\u6307\u5b9a\uff0c\u4f46\u662f\u5728\u63d2\u5165\u6570\u636e\u65f6\u5fc5\u987b\u7ed9\u51fa\uff0c\u53ef\u4ee5\u662f\u4efb\u610f\u5b57\u7b26\u4e32(\u6700\u5927\u957f\u5ea6\u662f 64KB)\uff0c\u6570\u636e\u662f\u6309\u7167 RowKey\u7684\u5b57\u5178\u987a\u5e8f\u5b58\u50a8\u7684\uff0c\u5728\u67e5\u8be2\u6570\u636e\u65f6\u4e5f\u5fc5\u987b\u7ed9\u51faRowKey\u3002</p> </li> <li> <p>\u65f6\u95f4\u6233\uff08timestamp\uff09\uff1a\u4e00\u4e2a\u5355\u5143\u683c\u4f1a\u4fdd\u5b58\u591a\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u6bcf\u4e2a\u7248\u672c\u90fd\u6709\u81ea\u5df1\u7684\u65f6\u95f4\u6233\uff0c\u65f6\u95f4\u6233\u6700\u5927\u7684\u6570\u636e\u4e3a\u6700\u65b0\u7248\u672c\uff0c\u65f6\u95f4\u6233\u7684\u7c7b\u578b\u662f 64 \u4f4d\u6574\u578b\uff0c\u7cbe\u786e\u5230\u6beb\u79d2\uff0c\u53ef\u4ee5\u5728\u6570\u636e\u5199\u5165\u65f6\u81ea\u52a8\u8d4b\u503c\uff0c\u4e5f\u53ef\u4ee5\u7531\u5ba2\u6237\u663e\u5f0f\u8d4b\u503c\u3002</p> </li> <li>\u5355\u5143\u683c\u9700\u8981\u4fdd\u7559\u591a\u5c11\u4e2a\u7248\u672c\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u5efa\u8868\u65f6\u901a\u8fc7\u6307\u5b9a\u8be5\u5355\u5143\u683c\u6240\u5728\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u7684\u503c\u6765\u786e\u5b9a\uff0c\u9ed8\u8ba4\u53ea\u4fdd\u7559\u4e00\u4e2a\u7248\u672c\uff0c\u4e5f\u53ef\u4ee5\u5728\u5efa\u8868\u4ee5\u540e\u4fee\u6539\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u7684\u503c\uff0c\u6bcf\u4e2a\u5217\u65cf\u7684VERSIONS\u5c5e\u6027\u7684\u503c\u53ef\u4ee5\u4e0d\u540c\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_1","title":"HBase\u8868\u7684\u7269\u7406\u7ed3\u6784\uff1f","text":"<p>\u7269\u7406\u7ed3\u6784\u6d89\u53ca\u7684\u6982\u5ff5\uff1aRegion\u3001store\u3001HFile\u3002</p> <ul> <li> <p>Region\uff1a\u8868\u7684\u6570\u636e\u91cf\u5927\u4e86\u4e4b\u540e\uff0cHBase\u4f1a\u5c06\u8868\u8fdb\u884c\u6a2a\u5411\u5207\u5206\uff0c\u6bcf\u4e00\u90e8\u5206\u88ab\u79f0\u4e3aRegion\uff0c\u4e5f\u53ef\u4ee5\u5728\u5efa\u8868\u7684\u65f6\u5019\u8fdb\u884c\u9884\u5206\u533a\uff0c\u5373\u63d0\u524d\u8bbe\u7f6e\u597dRegion\u7684\u4e2a\u6570\u4ee5\u53ca\u6bcf\u4e2aRegion\u7684rowkey\u8303\u56f4\u3002\u4e00\u5f20HBase\u8868\u7684\u6570\u636e\u4ee5Region\u4e3a\u5355\u4f4d\u4ea4\u7ed9\u4e0d\u540c\u7684RegionServer\u8fdb\u884c\u7ef4\u62a4\u3002</p> </li> <li> <p>Store\uff1a\u4e00\u4e2aRegion\u7684\u4e00\u4e2a\u5217\u65cf\u7684\u6570\u636e\u5c31\u662fStore\u3002\u4e00\u4e2aRegion\u4ee5Store\u4e3a\u5355\u4f4d\u8fdb\u884c\u7ef4\u62a4</p> </li> <li> <p>HFile\uff1a\u6bcf\u6b21\u5c06Store\u5237\u5199\u5230HDFS\u751f\u6210\u7684\u6587\u4ef6\u79f0\u4e3aHFile\uff0c\u6216\u8005\u79f0\u4e3aStoreFile\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_2","title":"HBase\u67b6\u6784\uff1f","text":"<p>HBase\u7684\u4e3b\u8981\u7ec4\u6210\u662f\uff1aMaster\u3001RegionServer\u3001Client</p> <p>\u6d89\u53ca\u7684\u5916\u90e8\u7ec4\u4ef6\uff1aZookeeper\u3001HDFS</p> <p>Master\uff1a</p> <ul> <li> <p>\u5904\u7406\u5ba2\u6237\u7aef\u5bf9\u547d\u540d\u7a7a\u95f4\u548c\u8868\u7684ddl\u64cd\u4f5c\uff1aMaster\u4f1a\u628a\u547d\u540d\u7a7a\u95f4\u7684\u5143\u6570\u636e\u5199\u5230hbase:namespace\u8868\uff1b\u628a\u8868\u7684\u5143\u6570\u636e\u5199\u5230hbase:meta\u8868\u4e2d\u3002</p> </li> <li> <p>\u7ba1\u7406RegionServer\u96c6\u7fa4\uff1a</p> </li> <li> <p>Master\u4f1a\u628a\u6240\u6709\u8868\u7684Region\u5206\u644a\u5230\u6bcf\u4e2aRegionServer\u4e2d\u8fdb\u884c\u7ef4\u62a4\uff0c\u5b9e\u73b0RegionServer\u96c6\u7fa4\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u63a5\u7740Master\u8fd8\u4f1a\u628a\u8868\u7684Region\u6b63\u5728\u88ab\u54ea\u4e9bRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u5199\u5230hbase:meta\u8868\u4e2d\uff0c\u7136\u540e\u628ahbase:meta\u8868\u6b63\u5728\u88ab\u54ea\u4e2aRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u5199\u5230zookeeper\u4e2d\u3002</p> </li> <li>\u5f53\u6709RegionServer\u6302\u6389\u4e86\uff0cMaster\u4f1a\u628a\u6302\u6389\u7684RegionServer\u6240\u7ef4\u62a4\u7684Region\u7684\u4efb\u52a1\u5206\u7ed9\u5176\u5b83\u7684\u5b58\u6d3b\u7684RegionServer\uff0c\u63a5\u7740Master\u4f1a\u4fee\u6539hbase:meta\u8868\u4e2d\u5173\u4e8eRegion\u6b63\u5728\u88ab\u54ea\u4e9bRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\u3002</li> </ul> <p>hbase:meta\u8868\u5b58\u4e86\u54ea\u4e9b\u6570\u636e\uff1a\u8868\u7684\u5143\u6570\u636e\uff0c\u4ee5\u53ca\u8868\u7684Region\u6b63\u5728\u88ab\u54ea\u4e9bRegionServer\u6240\u7ef4\u62a4</p> <p>RegionServer\uff1aRegionServer\u8d1f\u8d23\u7ef4\u62a4\u8868\u7684Region\uff0c\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u5bf9Region\u7684\u8bfb\u5199\u8bf7\u6c42\u3002\u4e00\u4e2aRegionServer\u53ef\u4ee5\u7ef4\u62a4\u8bb8\u591a\u6765\u81ea\u4e0d\u540c\u8868\u7684Region\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u662f\u540c\u4e00\u5f20\u8868\u7684\u4e0d\u540cRegion\u3002</p> <ul> <li>MemStore\uff1a\u8868\u7684Store\u7684\u6570\u636e\u5728\u5185\u5b58\u4e2d\u5c31\u662fMemStore\uff0c\u4e00\u4e2aRegion\u6709\u591a\u4e2a\u5217\u65cf\uff0c\u4ece\u800c\u6709\u4e00\u4e2aRegion\u6709\u591a\u4e2aMemStore\u3002\u6570\u636e\u5728MemStore\u4e2d\u6309rowkey\u7ec4\u7ec7\u6210\u8df3\u8868\uff0c\u6240\u4ee5\u6570\u636e\u5728MemStore\u662f\u6709\u5e8f\u7684\u3002</li> </ul> <p>zookeeper\uff1a</p> <ul> <li>zookeeper\u7684\u6570\u636e\u5b58\u50a8\u670d\u52a1\uff1azookeeper\u4fdd\u5b58\u4e86hbase:meta\u8868\u6b63\u5728\u88ab\u54ea\u4e2aHRegionServer\u6240\u7ef4\u62a4\u7684\u4fe1\u606f\uff0c\u4ee5\u53ca\u5176\u5b83\u5f88\u591a\u4fe1\u606f\uff0c\u6bd4\u5982master\u548c/backup-masters\u6240\u5728\u7684\u4e3b\u673a\uff1b</li> <li>zookeeper\u7684\u76d1\u542c\u901a\u77e5\u670d\u52a1\uff1amaster\u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u4e5f\u4f9d\u8d56\u4e8ezookeeper\uff0c\u6240\u6709Master\u4f1a\u5728zookeeper\u4e0a\u521b\u5efa\u4e34\u65f6\u8282\u70b9\uff0c\u5f53\u4e3bMaster\u6302\u6389\u4e4b\u540e\uff0c\u5176\u5b83\u5907\u4efdMaster\u5c31\u4f1a\u6536\u5230\u901a\u77e5\uff0c\u4e4b\u540e\u4e89\u62a2\u521b\u5efa\u65b0\u7684\u4e34\u65f6\u8282\u70b9\uff0c\u521b\u5efa\u6210\u529f\u7684\u4f1a\u6210\u4e3a\u65b0\u7684\u4e3bMaster\u3002</li> </ul> <p>Client\uff1aHBase\u7684\u5ba2\u6237\u7aef\u5e76\u4e0d\u9700\u8981\u4e0eHMaster\u8fde\u63a5\uff0c\u56e0\u4e3aHMaster\u5df2\u7ecf\u5c06Client\u6240\u9700\u8981\u7684\u96c6\u7fa4\u7684\u4fe1\u606f\u5b58\u5230zookeeper\u4e86\uff0c\u6240\u4ee5HBase\u7684\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u4e0ezookeeper\u5efa\u7acb\u8fde\u63a5\u5373\u53ef\uff0cClient\u4f1a\u4ecezookeeper\u4e2d\u83b7\u53d6\u5230\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u7136\u540e\u518d\u4e0e\u5177\u4f53\u7684\u4e3b\u673a\u8fde\u63a5\u5b8c\u6210\u8bf7\u6c42\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_3","title":"HBase\u5199\u6570\u636e\u6d41\u7a0b\uff1f","text":"<p>\u5728HBase\u4e2d\uff0c\u4efb\u4f55\u5f62\u5f0f\u7684\u5199\u6570\u636e\uff0c\u6bd4\u5982\u63d2\u5165\u3001\u5220\u9664\u3001\u4fee\u6539\uff0c\u90fd\u662f\u65b0\u589e\u4e00\u6761\u5e26\u6709\u65f6\u95f4\u6233\u7684\u65b0\u6570\u636e\u3002</p> <ol> <li>Client \u5148\u8bbf\u95ee zookeeper\uff0c\u83b7\u53d6 hbase:meta \u8868\u4f4d\u4e8e\u54ea\u4e2a RegionServer\uff0c\u5e76\u5c06 meta \u8868\u7684\u4f4d\u7f6e\u4fe1\u606f\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u8bbf\u95eehbase:meta \u8868\u4f4d\u4e8e\u7684 RegionServer\uff0c\u67e5\u8be2\u8981\u63d2\u5165\u7684rowkey\uff08<code>namespace:table/rowkey</code>\uff09\u4f4d\u4e8e\u54ea\u4e2a RegionServer \u4e2d\u7684\u54ea\u4e2a Region \u4e2d\uff0c\u5e76\u5c06region \u4fe1\u606f\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u5c06\u5199\u8bf7\u6c42\u53d1\u9001\u5230\u76ee\u6807RegionServer\u3002</li> <li>RegionServer \u5148\u5c06\u5199\u8bf7\u6c42\u987a\u5e8f\u5199\u5165 WAL\u3002</li> <li>\u7136\u540eRegionServer \u6839\u636e\u5217\u65cf\u5c06\u6570\u636e\u5199\u5165\u5bf9\u5e94\u7684MemStore\u3002\u5728MemStore\u4e2d\uff0c\u6570\u636e\u4ee5\u8df3\u8868\u7684\u5f62\u5f0f\u7ef4\u6301\u6709\u5e8f\u6027\u3002</li> <li>\u5411\u5ba2\u6237\u7aef\u8fd4\u56deack\u6d88\u606f\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\u5df2\u7ecf\u5b8c\u6210\uff0c\u4f46\u4fee\u6539\u7684\u6570\u636e\u6ca1\u6709\u4fdd\u5b58\u5230HDFS\u4e2d\uff0c\u56e0\u4e3a\u8981\u7b49\u5230 MemStore \u7684\u5237\u5199\uff0c\u624d\u4f1a\u5c06\u6570\u636e\u5199\u5230 HFile\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#memstore","title":"MemStore\u7684\u5237\u5199\uff1f","text":"<p>\u6bcf\u4e2aMemStore\u4f1a\u7ecf\u5386\u591a\u6b21\u5237\u5199\uff0c\u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u5c06MemStore\u4e2d\u7684\u6570\u636e\u53ea\u4fdd\u7559\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS\u4e2a\u7248\u672c\uff0c\u7136\u540e\u5c06\u6570\u636e\u5199\u5230HDFS\u4e0a\u751f\u6210HFile\uff0c\u6700\u540e\u6e05\u7a7aMemStore\u3002</p> <p>MemStore Flush \u7684\u65f6\u673a\uff1a</p> <ul> <li>RegionServer \u4e2d MemStore \u7684\u603b\u5927\u5c0f\u8fbe\u5230\u4f4e\u6c34\u4f4d\u9608\u503c\uff0c\u4f1a\u5bf9\u6240\u6709MemStore \u8fdb\u884c\u5237\u5199\uff0c\u6b64\u65f6RegionServer \u4ecd\u4f1a\u5904\u7406\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\uff0c\u5f53MemStore \u7684\u603b\u5927\u5c0f\u8fbe\u5230\u9ad8\u6c34\u4f4d\u9608\u503c\uff0cRegionServer\u5c06\u4f1a\u963b\u585e\u7528\u6237\u7684\u5199\u8bf7\u6c42\uff0c\u76f4\u5230MemStore \u7684\u603b\u5927\u5c0f\u8fbe\u5230\u4f4e\u6c34\u4f4d\u9608\u503c\u3002</li> <li>\u67d0\u4e2aMemStore\u7684\u5927\u5c0f\u8fbe\u5230\u4e86\u4e00\u5b9a\u7684\u9608\u503c\u3002</li> <li>\u8ddd\u79bbMemStore\u6700\u540e\u4e00\u6b21\u5199\u5165\u7684\u65f6\u95f4\u95f4\u9694\u5230\u8fbe\u8bbe\u7f6e\u7684\u81ea\u52a8\u5237\u5199\u7684\u65f6\u95f4\u95f4\u9694\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hfile","title":"HFile\u7684\u5408\u5e76\uff1f","text":"<p>memstore\u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684HFile\uff0c\u4ece\u800c\u4e00\u4e2a\u5355\u5143\u683c\u7684\u4e0d\u540c\u7248\u672c\uff08timestamp\uff09\u7684\u6570\u636e\u4f1a\u5206\u5e03\u5728\u4e0d\u540c\u7684 HFile \u4e2d\uff0c\u56e0\u6b64\u67e5\u8be2\u53ef\u80fd\u9700\u8981\u904d\u5386\u591a\u4e2a\u7684 HFile\u3002 \u4e3a\u4e86\u51cf\u5c11 HFile \u7684\u4e2a\u6570\uff0c\u4ee5\u53ca\u6e05\u9664\u8fc7\u671f\uff08\u8d85\u8fc7\u8868\u5217\u65cf\u8bbe\u7f6e\u7684VERSIONS\uff09\u548c \u5220\u9664\uff08type=Delete\uff09\u7684\u6570\u636e\uff0cHBase\u4f1a\u5bf9HFile\u8fdb\u884c\u5408\u5e76\u3002</p> <p>Compaction \u5206\u4e3a\u4e24\u79cd\uff0c\u5206\u522b\u662f Minor Compaction \u548c Major Compaction\u3002</p> <ul> <li>Minor Compaction\u53ea\u662f\u5355\u7eaf\u5730\u5c06\u4e34\u8fd1\u7684\u82e5\u5e72\u4e2a\u8f83\u5c0f\u7684 HFile \u5408\u5e76\u6210\u4e00\u4e2a\u8f83\u5927\u7684 HFile\uff0c\u4e0d\u4f1a\u6e05\u7406\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\u3002</li> <li>Major Compaction \u4f1a\u5c06\u4e00\u4e2a Store \u4e0b\u7684\u6240\u6709\u7684 HFile \u5408\u5e76\u6210\u4e00\u4e2a\u5927 HFile\uff0c\u5e76\u4e14\u4f1a\u6e05\u7406\u6389\u8fc7\u671f\u548c\u5220\u9664\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_4","title":"HBase\u8bfb\u6570\u636e\u6d41\u7a0b\uff1f","text":"<ol> <li>Client \u5148\u8bbf\u95ee zookeeper\uff0c\u83b7\u53d6 hbase:meta \u8868\u4f4d\u4e8e\u54ea\u4e2a HRegionServer\uff0c\u5e76\u5c06 meta \u8868\u7684\u4f4d\u7f6e\u4fe1\u606f\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u8bbf\u95eehbase:meta \u8868\u4f4d\u4e8e\u7684 RegionServer\uff0c\u67e5\u8be2rowkey\uff08<code>namespace:table/rowkey</code>\uff09\u4f4d\u4e8e\u54ea\u4e2a RegionServer \u4e2d\u7684\u54ea\u4e2a Region \u4e2d\uff0c\u5e76\u5c06region \u4fe1\u606f\u7f13\u5b58\u5728\u5ba2\u6237\u7aef\u7684 meta cache\u3002</li> <li>\u5c06\u8bfb\u6570\u636e\u8bf7\u6c42\u53d1\u9001\u5230\u76ee\u6807 HRegionServer\u3002</li> <li>HRegionServer \u5148\u4ece MemStore \u627e\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u518d\u5230 BlockCache \u91cc\u9762\u8bfb\uff0cBlockCache \u8fd8\u6ca1\u6709\uff0c\u518d\u5230 HFile \u4e0a\u8bfb\u3002\u5982\u679c\u662f\u4ece HFile \u91cc\u9762\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u5219\u5c06\u67e5\u8be2\u5230\u7684\u6570\u636e\u7f13\u5b58\u5230 Block Cache\u3002</li> <li>\u5c06\u67e5\u8be2\u5230\u7684\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ol> <p>Block\u7f13\u5b58\u4e0eMemstore\u7684\u533a\u522b\uff1aBlock\u4e2d\u7f13\u5b58\u7684\u662f\u5df2\u7ecf\u5237\u5199\u5230HFile\u4e2d\u53c8\u88ab\u8bfb\u51fa\u6765\u7684\u5757\uff0c\u800cMemstore\u662f\u65b0\u5199\u5165\u8fd8\u6ca1\u6709\u5237\u5199\u5230HFile\u4e2d\u7684\u5757\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hfile_1","title":"HFile\u7684\u7ed3\u6784\uff1f","text":"<p>HFile\u6587\u4ef6\u7684\u7279\u70b9\uff1a</p> <ol> <li>HFile\u7531DataBlock\uff08datablock\u5927\u5c0f\u9ed8\u8ba4\u4e3a64KB\uff09\u3001Meta\u4fe1\u606f\uff08Index\u3001BloomFilter\uff09\u3001Info\u7b49\u4fe1\u606f\u7ec4\u6210\u3002</li> <li>\u6574\u4e2aDataBlock\u7531\u4e00\u4e2a\u6216\u8005\u591a\u4e2aKeyValue\u7ec4\u6210\u3002</li> <li>\u6570\u636e\u5728\u6587\u4ef6\u5185\u6309Key\u6392\u5e8f\u3002</li> </ol> <p>\u6839\u636eHFile\u6587\u4ef6\u7684\u7279\u70b9\uff0cRegionServer\u6839\u636erowkey\u8bfb\u53d6HFile\u6587\u4ef6\u7684\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ol> <li>\u5148\u628a \u7d22\u5f15 \u548c \u5e03\u9686\u8fc7\u6ee4\u5668 \u8bfb\u5230\u5185\u5b58\u4e2d</li> <li>\u7136\u540e\u5148\u6839\u636e\u5e03\u9686\u8fc7\u6ee4\u5668\u67e5\u8fd9\u4e2arowkey\u5728\u4e0d\u5728\u8fd9\u4e2aHFile\u4e2d\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u8fd4\u56defalse\uff0c\u90a3\u5c31\u8868\u793a\u4e0d\u5728\uff0c\u4e8e\u662f\u63a5\u4e0b\u6765\u5e94\u8be5\u8bfb\u4e0b\u4e00\u4e2aHFile\uff0c\u5982\u679c\u8fd4\u56detrue\uff0c\u8868\u793a\u53ef\u80fd\u5728</li> <li>\u53ef\u80fd\u5728\u7684\u8bdd\uff0c\u63a5\u4e0b\u6765\u5e94\u8be5\u6839\u636erowkey\u67e5\u7d22\u5f15\uff0c\u770b\u6570\u636e\u5728HFile\u7684\u54ea\u4e2a\u5757\u4e2d</li> <li>\u518d\u7136\u540e\u8bfb\u8fd9\u4e2a\u5757\u7684\u6570\u636e</li> <li>\u5982\u679c\u5728\u8fd9\u4e2a\u5757\u4e2d\uff0c\u90a3\u4e48\u5c31\u8fd4\u56de\uff0c\u4e0d\u5728\u7684\u8bdd\uff0c\u8fd8\u662f\u8981\u63a5\u7740\u8bfb\u4e0b\u4e00\u4e2aHFile</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#wal","title":"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bWAL\uff1f","text":"<p>WAL\u662f\u6570\u636e\u5e93\u4fdd\u8bc1\u6570\u636e\u5199\u5165\u7684\u4f4e\u5ef6\u65f6\u548c\u6301\u4e45\u6027\u5e38\u7528\u7684\u6280\u672f\u3002\u4e0d\u53ea\u662fHBase\u3002</p> <p>\u5982\u679c\u6570\u636e\u5e93\u5728\u5185\u5b58\u5bf9\u6570\u636e\u4fee\u6539\u8fc7\u540e\u5c31\u76f4\u63a5\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\uff0c\u7136\u540e\u518d\u7b49\u5230\u5408\u9002\u7684\u65f6\u673a\u518d\u5237\u5199\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u5feb\u662f\u5feb\u4e86\uff0c\u4f46\u662f\u6ca1\u6709\u4fdd\u8bc1\u6301\u4e45\u6027\uff0c\u5982\u679c\u7b49\u5230\u6bcf\u6b21\u5c06\u4fee\u6539\u8fc7\u540e\u7684\u6570\u636e\u843d\u76d8\u4e4b\u540e\u518d\u8fd4\u56de\u4fee\u6539\u6210\u529f\u5462\uff0c\u8fd9\u6837\u867d\u7136\u4fdd\u8bc1\u4e86\u6301\u4e45\u6027\uff0c\u4f46\u662f\u53c8\u589e\u52a0\u5ef6\u65f6\u3002WAL\uff08Write Ahead Log\uff0c\u9884\u5199\u65e5\u5fd7\uff09\u89e3\u51b3\u4e86\u8fd9\u4e00\u95ee\u9898\uff0c\u540c\u65f6\u4fdd\u8bc1\u6570\u636e\u5199\u5165\u7684\u4f4e\u5ef6\u65f6\u548c\u6301\u4e45\u6027\u3002</p> <p>\u4f4e\u5ef6\u65f6\uff1aWAL\u5e76\u4e0d\u9700\u8981\u771f\u6b63\u7b49\u5230\u5185\u5b58\u4e2d\u5df2\u4fee\u6539\u7684\u6570\u636e\u5237\u5199\u5230\u78c1\u76d8\u540e\u624d\u5411\u7528\u6237\u8fd4\u56de\u4fee\u6539\u6210\u529f\uff0c\u800c\u662f\u5148\u5c06\u589e\u5220\u6539\u64cd\u4f5c\u8ffd\u52a0\u5199\u5230\u78c1\u76d8\u4e0a\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u518d\u66f4\u65b0\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u5b8c\u6210\u5373\u53ef\u5411\u7528\u6237\u8fd4\u56de\u6210\u529f\uff0c\u56e0\u4e3a\u5c06\u589e\u5220\u6539\u64cd\u4f5c\u8ffd\u52a0\u5230\u65e5\u5fd7\u6587\u4ef6\u662f\u987a\u5e8f\u5199\u78c1\u76d8\uff0c\u6548\u7387\u5f88\u9ad8\uff0c\u6240\u4ee5\u5bf9\u4e8e\u7528\u6237\u6765\u8bf4\u53ef\u4ee5\u505a\u5230\u5feb\u901f\u66f4\u65b0\u3002</p> <p>\u6301\u4e45\u6027\uff1a\u5982\u679c\u6570\u636e\u5e93\u5b95\u673a\uff0c\u90a3\u4e48\u4e0b\u6b21\u91cd\u542f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6839\u636eWAL\u6062\u590d\u6570\u636e\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u6301\u4e45\u6027\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#lsm-tree_log_structured_merge_tree","title":"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bLSM-Tree\uff08 Log Structured Merge Tree\uff09\uff1f","text":"<p>LSM-Tree\u662f\u7528\u4e8e\u6784\u5efa\u80fd\u5b58\u50a8\u6d77\u91cf\u6570\u636e\u7684\u9ad8\u6027\u80fdKV\u6570\u636e\u5e93\u7684\u4e00\u79cd\u601d\u60f3\u3002LSM-Tree\u7684\u6838\u5fc3\u5c31\u662f\u987a\u5e8f\u5199\u78c1\u76d8\u6548\u7387\u9ad8\u3002\u4ee5\u4e0aHBase\u7684\u6570\u636e\u7ec4\u7ec7\u65b9\u5f0f\u53ca\u5176\u8bfb\u5199\u6d41\u7a0b\u5c31\u662fLSM-Tree\u7684\u601d\u60f3\u3002LSM-Tree\u7684\u7279\u70b9\u603b\u7ed3\u5982\u4e0b\uff1a</p> <ol> <li>\u6570\u636e\u987a\u5e8f\u78c1\u76d8\u5230WAL\u4e2d\uff0c\u63a5\u7740\u66f4\u65b0\u5185\u5b58\uff08Memtable\uff09\u4e2d\u6570\u636e\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u6309key\u8fdb\u884c\u6392\u5e8f\u3002</li> <li>Memtable\u4f1a\u88ab\u5237\u5199\u5230\u78c1\u76d8\uff0c\u6bcf\u6b21\u5237\u5199\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\uff0c\u7cfb\u7edf\u9700\u8981\u5b9a\u671f\u5408\u5e76\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5220\u9664\u8fc7\u671f\u7684\u6570\u636e</li> </ol> <p>\u6df1\u5165\u7406\u89e3\u4ec0\u4e48\u662fLSM-Tree</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_5","title":"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bHBase\uff1f","text":"<p>HBase\u662f\u4e00\u4e2a\u652f\u6301\u5bf9\u6d77\u91cf\u6570\u636e\u968f\u673a\u5b9e\u65f6\u8bfb\u5199\u7684NoSQL\u6570\u636e\u5e93\u3002\u4e09\u4e2a\u5173\u952e\u5b57\uff1a\u6d77\u91cf\u6570\u636e\u3001\u968f\u673a\u8bfb\u5199\u3001\u5b9e\u65f6\u8bfb\u5199\u3002</p> <p>\u6d77\u91cf\u6570\u636e\u5b58\u50a8\uff1a\u628a\u6570\u636e\u5b58\u50a8\u5728HDFS\u4e0a\uff0cHDFS\u80fd\u5b9e\u73b0\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8\uff0c\u4f46\u4e0d\u80fd\u5b9e\u73b0\u968f\u673a\u8bfb\u5199\uff0cHDFS\u53ea\u80fd\u8ffd\u52a0\u5199\uff0c\u8bfb\u7684\u8bdd\u53ea\u80fd\u5148\u4e0b\u8f7d\u4e0b\u6765\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_6","title":"HBase\u662f\u5982\u4f55\u505a\u5230\u968f\u673a\u5b9e\u65f6\u8bfb\u5199\u7684\uff1f","text":"<ul> <li> <p>\u968f\u673a\u5199\u662f\u56e0\u4e3a\u4efb\u4f55\u5f62\u5f0f\u7684\u5199\u6570\u636e\uff0c\u6bd4\u5982\u63d2\u5165\u3001\u5220\u9664\u3001\u4fee\u6539\uff0c\u90fd\u662f\u65b0\u589e\u4e00\u6761\u5e26\u6709\u65f6\u95f4\u6233\u7684\u65b0\u6570\u636e\u3002</p> </li> <li> <p>\u5b9e\u65f6\u5199\u662f\u56e0\u4e3aHBase\u628a\u6570\u636e\u5199\u5230MemStore\uff0c\u628a\u64cd\u4f5c\u5199\u5230WAL\u5c31\u8fd4\u56de\u4e86\u3002</p> </li> <li> <p>\u968f\u673a\u8bfb\u662fHBase\u628a\u8868\u5206\u6210\u5f88\u591aRegion\uff0c\u7136\u540eRegion\u53c8\u5206\u6210\u4e86\u5f88\u591aHFile\uff0c\u53ef\u4ee5\u901a\u8fc7RowKey\u5b9a\u4f4d\u5230\u6570\u636e\u5728\u54ea\u4e2aRegion\u4e0a\uff0c\u7136\u540e\u901a\u8fc7\u5217\u65cf\u627e\u5230\u5bf9\u5e94\u7684HFile\uff0c\u6700\u540e\u904d\u5386StoreFile\u5c31\u80fd\u627e\u5230\u6570\u636e\u4e86\u3002</p> </li> <li> <p>\u5b9e\u65f6\u8bfb\u662f\u56e0\u4e3aHBase\u5bf9\u8bfb\u505a\u4e86\u5f88\u591a\u6027\u80fd\u4f18\u5316\uff0c\u6bd4\u5982MemStore\u3001Block\u7f13\u5b58\u3001\u7d22\u5f15\u3001\u5e03\u9686\u8fc7\u6ee4\u5668\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#hbase_7","title":"HBase\u7684\u7f3a\u70b9\uff1f","text":"<p>HBase\u652f\u6301\u6d77\u91cf\u6570\u636e\u7684\u968f\u673a\u5b9e\u65f6\u8bfb\u5199\u662fHBase\u7684\u4f18\u70b9\uff0cHBase\u7684\u7f3a\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>\u4e0d\u652f\u6301\u4e8b\u52a1</li> <li>\u4e0d\u80fd\u652f\u6301\u6761\u4ef6\u67e5\u8be2\uff0c\u53ea\u652f\u6301\u6309\u7167Row key\u6765\u67e5\u8be2\u3002</li> <li>\u6682\u65f6\u4e0d\u80fd\u652f\u6301Master server\u7684\u6545\u969c\u5207\u6362\uff0c\u5f53Master\u5b95\u673a\u540e,\u6574\u4e2a\u5b58\u50a8\u7cfb\u7edf\u5c31\u4f1a\u6302\u6389\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/HBase/#rowkey","title":"RowKey\u5982\u4f55\u8bbe\u8ba1\uff1f","text":"<ul> <li>\u6563\u5217\u539f\u5219\uff1a\u5c3d\u91cf\u5c06\u4e0d\u540c\u7c7b\u7684\u6570\u636e\u5747\u5300\u7684\u5206\u6563\u5728\u4e0d\u540c\u7684Region\u4e2d\uff0c\u5c06\u540c\u4e00\u7c7b\u6570\u636e\u653e\u5728\u540c\u4e00\u4e2aRegion\u4e2d\u3002\u901a\u5e38\u7684\u505a\u6cd5\u662f\uff0c\u5bf9\u539f RowKey \u6216\u539fRowKey \u7684\u4e00\u90e8\u5206\u8ba1\u7b97 Hash \u503c\uff0c\u540c\u5c06hash\u503c\u6700\u4e3a\u4f5c\u4e3a\u539f RowKey \u7684\u524d\u7f00\u3002</li> <li>\u957f\u5ea6\u539f\u5219\uff1aHBase\u4e2dRowKey\u7684\u6700\u5927\u957f\u5ea6\u662f64kb\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u4e00\u822c\u4e3a 10-100bytes\uff0c\u5efa\u8bae\u8d8a\u77ed\u8d8a\u597d\uff0c\u4e0d\u8981\u8d85\u8fc7 16 \u4e2a\u5b57\u8282\uff0c\u56e0\u4e3a\u8d8a\u957f\uff0cRowKey\u5360\u7528\u7684\u7a7a\u95f4\u4e5f\u5c31\u8d8a\u591a\uff0c\u5bf9\u4e8e MemStore \u548c BlockCache\uff0c\u5982\u679c RowKey \u5b57\u6bb5\u8fc7\u957f\uff0c\u5185\u5b58\u7684\u6709\u6548\u5229\u7528\u7387\u5c31\u4f1a\u964d\u4f4e\uff0c\u7cfb\u7edf\u4e0d\u80fd\u7f13\u5b58\u66f4\u591a\u7684\u6570\u636e\uff0c\u8fd9\u6837\u4f1a\u964d\u4f4e\u68c0\u7d22\u6548\u7387\u3002</li> <li>\u552f\u4e00\u539f\u5219\uff1a\u7531\u4e8e RowKey \u7528\u6765\u552f\u4e00\u6807\u8bc6\u4e00\u884c\u8bb0\u5f55\uff0c\u6240\u4ee5\u5fc5\u987b\u5728\u8bbe\u8ba1\u4e0a\u4fdd\u8bc1 RowKey \u7684\u552f\u4e00\u6027\u3002\u5982\u679c\u5411 HBase \u4e2d\u540c\u4e00\u5f20\u8868\u63d2\u5165\u76f8\u540c RowKey \u7684\u6570\u636e\uff0c\u5219\u539f\u5148\u5b58\u5728\u7684\u6570\u636e\u4f1a\u88ab\u65b0\u7684\u6570\u636e\u7ed9\u8986\u76d6\u6389\uff08\u548c HashMap \u6548\u679c\u76f8\u540c\uff09\u3002</li> <li>\u6392\u5e8f\u539f\u5219\uff1a\u65e0\u8bba\u662f\u5728 MemStore \u8fd8\u662f HFile \u4e2d\uff0c\u6570\u636e\u90fd\u662f\u6309 RowKey \u7684\u5b57\u5178\u987a\u5e8f\u6392\u5e8f\u5b58\u50a8\u7684\uff0c\u56e0\u6b64\uff0c\u8bbe\u8ba1 RowKey \u7684\u65f6\u5019\uff0c\u8981\u5145\u5206\u5229\u7528\u8fd9\u4e2a\u6392\u5e8f\u7684\u7279\u70b9\uff0c\u5c06\u7ecf\u5e38\u8bfb\u53d6\u7684\u6570\u636e\u5b58\u50a8\u5230\u4e00\u5757\uff0c\u5c06\u6700\u8fd1\u53ef\u80fd\u4f1a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u653e\u5230\u4e00\u5757\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/","title":"Hadoop","text":"<p> \u7ea6 4242 \u4e2a\u5b57  7 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 85 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#hdfs","title":"HDFS\u67b6\u6784\uff1f","text":"<p>HDFS\u91c7\u7528\u4e3b\u4ece\uff08Master/Slave\uff09\u67b6\u6784\uff0c\u7531HDFSClient\u3001NameNode\u3001DataNode\u548cSecondaryNameNode\u56db\u90e8\u5206\u7ec4\u6210\u3002</p> <p>HDFSClient\uff1a</p> <ul> <li> <p>\u4e0eNameNode\u4ea4\u4e92\uff0c \u83b7\u53d6\u6587\u4ef6\u7684\u5143\u6570\u636e\u4fe1\u606f\u3002</p> </li> <li> <p>\u4e0eDataNode\u4ea4\u4e92\uff0c \u8bfb\u53d6\u6216\u8005\u5199\u5165\u6570\u636e\u3002</p> </li> </ul> <p>NameNode\uff1a</p> <ul> <li> <p>\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u7740\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u4fe1\u606f\uff08\u6bd4\u5982\u6587\u4ef6\u7cfb\u7edf\u6811\u578b\u7ed3\u6784\u7684\u76ee\u5f55\u3001\u6bcf\u4e2a\u6587\u4ef6\u5404\u4e2a\u5757\u6240\u5728\u8282\u70b9\u7684\u4fe1\u606f\uff09\u3002\u5bf9\u4e8e\u6587\u4ef6\u7cfb\u7edf\u7684\u6811\u578b\u7ed3\u6784\u76ee\u5f55\uff0cNameNode\u4f1a\u5c06\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u4fee\u6539\u4ee5\u8ffd\u52a0\u5199\u7684\u65b9\u5f0f\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e0a\uff1b\u5bf9\u4e8e\u6bcf\u4e2a\u6587\u4ef6\u5404\u4e2a\u5757\u6240\u5728\u8282\u70b9\u7684\u4fe1\u606f\uff0cNameNode\u5e76\u4e0d\u4f1a\u5728\u6301\u4e45\u5316\u8fd9\u4e9b\u4fe1\u606f\uff0c\u800c\u662f\u7531DataNode\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u5728HDFS\u542f\u52a8\u65f6\uff0cDataNode\u4f1a\u5411NameNode\u6c47\u62a5\u8fd9\u4e9b\u4fe1\u606f\u3002</p> </li> <li> <p>\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u3002</p> </li> </ul> <p>DataNode\uff1a\u6587\u4ef6\u7cfb\u7edf\u7684\u5de5\u4f5c\u8282\u70b9\uff0c \u6267\u884c\u6570\u636e\u5757\u7684\u8bfb/\u5199\u64cd\u4f5c\u3002DataNode\u6bcf3s\u4f1a\u5411NameNode\u53d1\u9001\u5fc3\u8df3\uff0c\u5982\u679c\u8d85\u8fc710\u5206\u949f\u6ca1\u6709\u6536\u5230\u67d0\u4e2aDataNode\u7684\u5fc3\u8df3\uff0c\u5219\u8ba4\u4e3a\u8be5\u8282\u70b9\u4e0d\u53ef\u7528\uff1b\u6bcf6\u5c0f\u65f6\u4f1a\u5411NameNode\u4e0a\u62a5\u6240\u6709\u7684\u5757\u4fe1\u606f\u3002</p> <p>SecondaryNameNode\uff082NN\uff09\uff1a\u8f85\u52a9NameNode\uff0c\u8d1f\u8d23\u5408\u5e76Fsimage\u548cEdits\uff0c \u5e76\u63a8\u9001\u7ed9NameNode\u3002NN\u8ffd\u52a0\u5199\u65f6\u5c06\u4fee\u6539\u64cd\u4f5c\u4fdd\u5b58\u5230edits_inprogress\u6587\u4ef6\u4e2d\uff0c\u5f53edits_inprogress\u8fbe\u52301kb\u505c\u6b62\u5f80\u8fd9\u4e2a\u6587\u4ef6\u4e0a\u5199\uff0c\u628a\u8fd9\u4e2aedits_inprogress\u66f4\u540d\u4e3aedits\uff0c\u7136\u540e\u518d\u65b0\u5efa\u53e6\u5916\u4e00\u4e2aedits_inprogress\u7ee7\u7eed\u8ffd\u52a0\u5199\uff0c2NN\u8d1f\u8d23\u62c9\u53d6NN\u4e0a\u7684edits\u4e0e\u81ea\u5df1\u4e4b\u524d\u7684fsimage\u5408\u5e76\uff0c\u5408\u5e76\u5b8c\u4e4b\u540e\u518d\u628afsimage\u4f20\u9001\u7ed9NN\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#hdfs_1","title":"HDFS\u5199\u6570\u636e\u6d41\u7a0b\uff1f","text":"<ol> <li>\u5ba2\u6237\u7aef\u901a\u8fc7Distributed FileSystem\u6a21\u5757\u5411NameNode\u8bf7\u6c42\u4e0a\u4f20\u6587\u4ef6\u3002</li> <li>NameNode\u68c0\u67e5\u76ee\u6807\u6587\u4ef6\u662f\u5426\u5df2\u5b58\u5728\uff0c\u7236\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0cNameNode\u8fd4\u56de\u662f\u5426\u53ef\u4ee5\u4e0a\u4f20\u3002</li> <li>\u5ba2\u6237\u7aef\u8bf7\u6c42\u7b2c\u4e00\u4e2a Block\u4e0a\u4f20\u5230\u54ea\u51e0\u4e2aDataNode\u670d\u52a1\u5668\u4e0a\u3002</li> <li>NameNode\u8fd4\u56de3\u4e2aDataNode\u8282\u70b9\uff0c\u5206\u522b\u4e3adn1\u3001dn2\u3001dn3\u3002</li> <li>\u5ba2\u6237\u7aef\u901a\u8fc7FSDataOutputStream\u6a21\u5757\u8bf7\u6c42dn1\u4e0a\u4f20\u6570\u636e\uff0cdn1\u6536\u5230\u8bf7\u6c42\u4f1a\u7ee7\u7eed\u8c03\u7528dn2\uff0c\u7136\u540edn2\u8c03\u7528dn3\uff0c\u5c06\u8fd9\u4e2a\u901a\u4fe1\u7ba1\u9053\u5efa\u7acb\u5b8c\u6210\u3002</li> <li>\u5ba2\u6237\u7aef\u5f00\u59cb\u5f80dn1\u4e0a\u4f20\u7b2c\u4e00\u4e2aBlock\uff08\u5148\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u653e\u5230\u4e00\u4e2a\u672c\u5730\u5185\u5b58\u7f13\u5b58\uff09\uff0c\u4ee5Packet\u4e3a\u5355\u4f4d\uff0cdn1\u6536\u5230\u4e00\u4e2aPacket\u5c31\u4f1a\u4f20\u7ed9dn2\uff0cdn2\u4f20\u7ed9dn3\uff1bdn1\u6bcf\u4f20\u4e00\u4e2apacket\u4f1a\u653e\u5165\u4e00\u4e2a\u5e94\u7b54\u961f\u5217\u7b49\u5f85\u5e94\u7b54\u3002</li> <li>\u5f53\u4e00\u4e2aBlock\u4f20\u8f93\u5b8c\u6210\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6b21\u8bf7\u6c42NameNode\u4e0a\u4f20\u7b2c\u4e8c\u4e2aBlock\u7684\u670d\u52a1\u5668\u3002\uff08\u91cd\u590d\u6267\u884c3-7\u6b65\uff09\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#hdfs_2","title":"HDFS\u8bfb\u6570\u636e\u6d41\u7a0b\uff1f","text":"<ol> <li>\u5ba2\u6237\u7aef\u901a\u8fc7DistributedFileSystem\u5411NameNode\u8bf7\u6c42\u4e0b\u8f7d\u6587\u4ef6\uff0cNameNode\u901a\u8fc7\u67e5\u8be2\u5143\u6570\u636e\uff0c\u627e\u5230\u6587\u4ef6\u5757\u6240\u5728\u7684DataNode\u5730\u5740\u3002</li> <li>\u6311\u9009\u4e00\u53f0DataNode\uff08\u5c31\u8fd1\u539f\u5219\uff0c\u7136\u540e\u968f\u673a\uff09\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u8bfb\u53d6\u6570\u636e\u3002</li> <li>DataNode\u5f00\u59cb\u4f20\u8f93\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\uff08\u4ece\u78c1\u76d8\u91cc\u9762\u8bfb\u53d6\u6570\u636e\u8f93\u5165\u6d41\uff0c\u4ee5Packet\u4e3a\u5355\u4f4d\u6765\u505a\u6821\u9a8c\uff09\u3002</li> <li>\u5ba2\u6237\u7aef\u4ee5Packet\u4e3a\u5355\u4f4d\u63a5\u6536\uff0c\u5148\u5728\u672c\u5730\u7f13\u5b58\uff0c\u7136\u540e\u5199\u5165\u76ee\u6807\u6587\u4ef6\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#_1","title":"\u5c0f\u6587\u4ef6\u6709\u54ea\u4e9b\u5371\u5bb3\uff1f","text":"<ul> <li> <p>NameNode\u5728\u5185\u5b58\u7ef4\u62a4\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bcf\u4e00\u4e2a\u5c0f\u6587\u4ef6\u90fd\u9700\u8981\u5404\u81ea\u7ef4\u62a4\u4e00\u4efd\uff0c\u4f1a\u5360\u7528\u5927\u91cf\u5185\u5b58\uff0c\u4e25\u91cd\u5f71\u54cdNameNode\u7684\u6027\u80fd\u3002</p> </li> <li> <p>\u5e76\u4e14\u5c0f\u6587\u4ef6\u7684\u5bfb\u5740\u65f6\u95f4\u8d85\u8fc7\u8bfb\u53d6\u65f6\u95f4\uff0c\u8fd9\u4e2a\u6210\u672c\u4e0d\u5212\u7b97\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#_2","title":"\u5c0f\u6587\u4ef6\u89e3\u51b3\u65b9\u6cd5\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#maptask","title":"MapTask\u7684\u4e2a\u6570?","text":"<p>MapTask \u5e76\u884c\u5ea6\u5b8c\u5168\u7531\u5207\u7247\u4e2a\u6570\u51b3\u5b9a\uff0c\u4e00\u4e2a\u5207\u7247\u4f1a\u5bf9\u5e94\u542f\u52a8\u4e00\u4e2a MapTask\u6765\u5904\u7406\uff0c\u800c\u5207\u7247\u4e2a\u6570\u7531\u8f93\u5165\u6587\u4ef6\u5927\u5c0f\u3001\u6570\u91cf\u4ee5\u53ca\u5207\u7247\u89c4\u5219\u51b3\u5b9a\u3002</p> <p>InputFormat\u62bd\u8c61\u7c7b\u662f\u6700\u9876\u7ea7\u7684\u62bd\u8c61\u7c7b\uff0c\u5b83\u4e00\u5171\u4e5f\u5c31\u53ea\u5b9a\u4e49\u4e86\u4e24\u4e2a\u62bd\u8c61\u65b9\u6cd5getSplits()\u548ccreateRecordReader()\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u9700\u8981\u7531\u5176\u5b50\u7c7b\u90fd\u5b9e\u73b0\u3002getSplits()\u5728\u4efb\u52a1\u63d0\u4ea4\u524d\u8ba1\u7b97\u5206\u7247\u4ee5\u4fbf\u51b3\u5b9aMapTask\u7684\u5e76\u884c\u5ea6\uff1bcreateRecordReader()\u521b\u5efaRecordReader\uff0c\u7528\u4e8e\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u3002</p> <p>InputFormat\u6709\u4f17\u591a\u7684\u5b50\u7c7b\uff0c\u6bd4\u8f83\u91cd\u8981\u7684\u5b50\u7c7b\u662f\u62bd\u8c61\u7c7bFileInputFormat\uff0cFileInputFormat\u5b9e\u73b0\u4e86getSplits()\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u5207\u7247\u8ba1\u7b97\u903b\u8f91\u4e3b\u8981\u662f\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u8fdb\u884c\u5207\u7247\uff0cFileInputFormat\u6bd4\u8f83\u91cd\u8981\u7684\u5b50\u7c7b\u6709TextInputFormat\u548c\u62bd\u8c61\u7c7bCombineFileInputFormat\uff0cCombineFileInputFormat\u91cd\u5199\u4e86FileInputFormat\u7684getSplits()\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u5207\u7247\u8ba1\u7b97\u903b\u8f91\u4e3b\u8981\u662f\u5c06\u5c0f\u6587\u4ef6\u5408\u5e76\u4e4b\u540e\u4e00\u8d77\u5207\uff0cCombineFileInputFormat\u6bd4\u8f83\u91cd\u8981\u7684\u5b50\u7c7b\u662fCombineTextInputFormat\u3002</p> <p></p> <p>\u5207\u7247\u53ea\u662f\u903b\u8f91\u4e0a\u7684\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u5c06\u6587\u4ef6\u62c6\u5206\uff0c\u610f\u601d\u662fgetSplits()\u65b9\u6cd5\u53ea\u662f\u8ba1\u7b97\u5f97\u5230\u4e86MaskTask\u8fd0\u884c\u65f6\u7684\u8bfb\u53d6\u6570\u636e\u7684\u8ba1\u5212\uff0cMaskTask\u5728\u8fd0\u884c\u65f6\u4f1a\u6309\u7167\u5207\u7247\u8ba1\u7b97\u7684\u7ed3\u679c\u8bfb\u53d6\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#textinputformat","title":"TextInputFormat\u7684\u5207\u7247\u903b\u8f91\uff1f","text":"<p>TextInputFormat\u7684getSplits()\u65b9\u6cd5\u7ee7\u627f\u81eaFileInputFormat\uff0c\u5b83\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff1a</p> <p>\uff081\uff09\u7a0b\u5e8f\u5148\u627e\u5230\u6570\u636e\u5b58\u50a8\u7684\u76ee\u5f55\u3002</p> <p>\uff082\uff09\u5f00\u59cb\u904d\u5386\u5904\u7406\uff08\u89c4\u5212\u5207\u7247\uff09\u76ee\u5f55\u4e0b\u7684\u6bcf\u4e00\u4e2a\u6587\u4ef6</p> <p>\uff083\uff09\u904d\u5386\u7b2c\u4e00\u4e2a\u6587\u4ef6ss.txt</p> <p>a. \u83b7\u53d6\u6587\u4ef6\u5927\u5c0ffs.sizeOf(ss.txt)  </p> <p>b. \u8ba1\u7b97\u5207\u7247\u5927\u5c0f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5207\u7247\u5927\u5c0f=blocksize=128M \uff0c\u8ba1\u7b97\u8fc7\u7a0b\u662f \uff1a         <code>computeSplitSize(Math.max(minSize,Math.min(maxSize,blocksize)))=blocksize=128M\uff08424\u884c\uff09</code></p> <p>c. \u5f00\u59cb\u5207\uff0c\u5f62\u6210\u7b2c1\u4e2a\u5207\u7247\uff1a ss.txt\u20140:128M \u7b2c2\u4e2a\u5207\u7247ss.txt\u2014128:256M \u7b2c3\u4e2a\u5207\u7247ss.txt\u2014256M:300M\uff08 \u6bcf\u6b21\u5207\u7247\u65f6\uff0c\u90fd\u8981\u5224\u65ad\u8981\u5207\u7684\u90e8\u5206\u662f\u5426\u5927\u4e8e\u5757\u76841.1\u500d\uff0c\u4e0d\u5927\u4e8e1.1\u500d\u7684\u8bdd\u5c31\u4e0d\u5207\uff0c\u5f62\u6210\u4e00\u6574\u5757\u5207\u7247\uff0c\u5927\u4e8e\u7684\u8bdd\u5c31\u5207\u7247\uff0c\u7b2c\u4e00\u7247128M\uff0c\u5269\u4f59\u4f5c\u4e3a\u4e00\u4e2a\u5207\u7247\u518d\u6b21\u5224\u65ad\u662f\u5426\u8981\u5207\u7247\uff09</p> <p>d. \u5c06\u5207\u7247\u4fe1\u606f\u5199\u5230\u4e00\u4e2a\u5207\u7247\u89c4\u5212\u6587\u4ef6\u4e2d\uff0c\u53ea\u8bb0\u5f55\u4e86\u5207\u7247\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bd4\u5982\u8d77\u59cb\u4f4d\u7f6e\u3001\u957f\u5ea6\u4ee5\u53ca\u6240\u5728\u7684\u8282\u70b9\u5217\u8868\u7b49\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#combinetextinputformat","title":"CombineTextInputFormat\u7684\u5207\u7247\u903b\u8f91\uff1f","text":"<p>TextInputFormat \u5207\u7247\u673a\u5236\u662f\u5bf9\u4efb\u52a1\u6309\u6587\u4ef6\u89c4\u5212\u5207\u7247\uff0c\u4e0d\u7ba1\u6587\u4ef6\u591a\u5c0f\uff0c\u90fd\u4f1a\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u5207\u7247\uff0c \u90fd\u4f1a\u4ea4\u7ed9\u4e00\u4e2a MapTask\uff0c \u8fd9\u6837\u5982\u679c\u6709\u5927\u91cf\u5c0f\u6587\u4ef6\uff0c \u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684MapTask\uff0c \u5904\u7406\u6548\u7387\u4f4e\u3002\u800cCombineTextInputFormat \u7528\u4e8e\u5c0f\u6587\u4ef6\u8fc7\u591a\u7684\u573a\u666f\uff0c \u5b83\u53ef\u4ee5\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u4ece\u903b\u8f91\u4e0a\u89c4\u5212\u5230\u4e00\u4e2a\u5207\u7247\u4e2d\uff0c \u8fd9\u6837\u591a\u4e2a\u5c0f\u6587\u4ef6\u5c31\u53ef\u4ee5\u4ea4\u7ed9\u4e00\u4e2a MapTask \u5904\u7406\u3002</p> <p>CombineTextInputFormat\u7684\u5207\u7247\u5305\u62ec\u4e24\u4e2a\u8fc7\u7a0b\uff1a \u865a\u62df\u5b58\u50a8\u8fc7\u7a0b\u3001\u5207\u7247\u8fc7\u7a0b</p> <p>1.\u865a\u62df\u5b58\u50a8\u8fc7\u7a0b\uff1a  \u5c06\u8f93\u5165\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u7684\u5927\u5c0f \u4f9d\u6b21\u548c\u8bbe\u7f6e\u7684 setMaxInputSplitSize \u503c\u6bd4\u8f83\uff0c \u5982\u679c\u4e0d\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u503c\uff0c \u903b\u8f91\u4e0a\u5212\u5206\u4e00\u4e2a\u5757\u3002\u5982\u679c\u8f93\u5165\u6587\u4ef6\u5927\u4e8e\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e14\u5927\u4e8e\u4e24\u500d\uff0c\u90a3\u4e48\u4ee5\u6700\u5927\u503c\u5207\u5272\u4e00\u5757\uff1b \u5f53\u5269\u4f59\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u4e14\u4e0d\u5927\u4e8e\u6700\u5927\u503c2 \u500d\uff0c\u6b64\u65f6\u5c06\u6587\u4ef6\u5747\u5206\u6210 2 \u4e2a\u865a\u62df\u5b58\u50a8\u5757\uff08\u9632\u6b62\u51fa\u73b0\u592a\u5c0f\u5207\u7247\uff09 \u3002\u4f8b\u5982 setMaxInputSplitSize \u503c\u4e3a 4M\uff0c \u8f93\u5165\u6587\u4ef6\u5927\u5c0f\u4e3a 8.02M\uff0c\u5219\u5148\u903b\u8f91\u4e0a\u5206\u6210\u4e00\u4e2a4M\u3002 \u5269\u4f59\u7684\u5927\u5c0f\u4e3a 4.02M\uff0c\u5982\u679c\u6309\u7167 4M \u903b\u8f91\u5212\u5206\uff0c\u5c31\u4f1a\u51fa\u73b0 0.02M \u7684\u5c0f\u7684\u865a\u62df\u5b58\u50a8\u6587\u4ef6\uff0c \u6240\u4ee5\u5c06\u5269\u4f59\u7684 4.02M \u6587\u4ef6\u5207\u5206\u6210\uff082.01M \u548c 2.01M\uff09\u4e24\u4e2a\u6587\u4ef6\u3002 2.\u5207\u7247\u8fc7\u7a0b\uff1a </p> <p>\uff08a\uff09 \u5224\u65ad\u865a\u62df\u5b58\u50a8\u7684\u6587\u4ef6\u5927\u5c0f\u662f\u5426\u5927\u4e8e setMaxInputSplitSize \u503c\uff0c\u5927\u4e8e\u7b49\u4e8e\u5219\u5355\u72ec\u5f62\u6210\u4e00\u4e2a\u5207\u7247\u3002</p> <p>\uff08b\uff09 \u5982\u679c\u4e0d\u5927\u4e8e\u5219\u8ddf\u4e0b\u4e00\u4e2a\u865a\u62df\u5b58\u50a8\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u5171\u540c\u5f62\u6210\u4e00\u4e2a\u5207\u7247\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#reducetask","title":"ReduceTask\u7684\u4e2a\u6570\uff1f","text":"<p>ReduceTask \u6570\u91cf\u662f\u5728Driver\u7c7b\u4e2d\u624b\u52a8\u8bbe\u7f6e\u51b3\u5b9a\u7684\uff0cReduceTask\u6570\u91cf\u4e00\u822c\u8981\u4e0e\u5206\u533a\u6570\u91cf\u8bbe\u7f6e\u76f8\u540c\uff0c\u6240\u4ee5\u53ef\u4ee5\u8bf4ReduceTask\u7684\u5e76\u884c\u5ea6\u662f\u7531\u5206\u533a\u6570\u91cf\u51b3\u5b9a\u7684\uff08\u5f53\u7136\u53ef\u4ee5\u628aReduceTask \u6570\u91cf\u8bbe\u7f6e\u6210\u4e0e\u5206\u533a\u6570\u91cf\u4e0d\u4e00\u81f4\uff0c\u4f46\u8fd9\u6837\u4f1a\u51fa\u73b0\u95ee\u9898\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#reducetask_1","title":"ReduceTask\u4e2a\u6570\u4e0e\u5206\u533a\u6570\u7684\u5173\u7cfb\uff1f","text":"<p>\u5982\u679c\u4e0d\u8bbe\u7f6eReduceTask\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u6b64\u65f6\u5206\u533a\u4e5f\u5c31\u53ea\u6709\u4e00\u4e2a\uff0cmap\u7aef\u6240\u6709\u6570\u636e\u90fd\u4f1a\u8fdb\u5165\u5230\u4e00\u4e2areduce\u4e2d\uff0c\u81ea\u5b9a\u4e49\u7684\u5206\u533a\u65b9\u6cd5\u4f1a\u5931\u6548\u3002</p> <p>\u5f53\u8bbe\u7f6e\u7684ReduceTask\u7684\u6570\u91cf\u5927\u4e8e1\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u81ea\u5b9a\u4e49\u5206\u533a\u65b9\u6cd5\uff0c\u90a3\u4e48\u9ed8\u8ba4\u6309\u7167key\u7684hash\u503c\u53d6\u4f59\u5206\u533a\uff0c\u5982\u679c\u6709\u81ea\u5b9a\u4e49\u5206\u533a\u65b9\u6cd5\uff0c\u90a3\u5c31\u6309\u7167\u81ea\u5b9a\u4e49\u7684\u5206\u533a\u65b9\u6cd5\u5206\u533a\uff0c\u4f46\u8981\u6ce8\u610f\u4e00\u4e2a\u95ee\u9898\uff0c\u81ea\u5b9a\u4e49\u5206\u533a\u65b9\u6cd5\u7684\u5206\u533a\u6570\u4e00\u5b9a\u8981\u5c0f\u4e8e\u7b49\u4e8e\u8bbe\u7f6e\u7684RreduceTask\u6570\uff0c\u4e0d\u7136\u4f1a\u629b\u5f02\u5e38\u3002</p> <p>MapReduce\u4e2d\u5206\u533a\u4e0ekey\u7684\u5173\u7cfb\u662f\uff0c\u4e00\u4e2areduce\u53ea\u4f1a\u5904\u7406\u4e00\u4e2a\u5206\u533a\u4e2d\u7684\u6570\u636e\uff0c\u4e00\u4e2a\u5206\u533a\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u4e0d\u540c\u7684key\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#mapreduce","title":"MapReduce\u7684\u8fc7\u7a0b\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#map","title":"map\u7aef\uff1a","text":"<p>\uff081\uff09Read\u9636\u6bb5\uff1aMapTask\u901a\u8fc7InputFormat\u83b7\u5f97\u7684RecordReader\uff0c\u7136\u540e\u7531RecordReader\u6309\u884c\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\u89e3\u6790\u51fa\u4e00\u4e2a\u4e2a<code>&lt;key, value&gt;</code>\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662f\u9ed8\u8ba4\u7684TextInputFormat\uff0c\u90a3\u4e48key\u662f\u884c\u8d77\u59cb\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\uff0cvalue\u662f\u8be5\u884c\u7684\u5185\u5bb9\u3002</p> <p>\uff082\uff09Map\u9636\u6bb5\uff1a\u5c06\u89e3\u6790\u51fa\u7684<code>&lt;key, value&gt;</code>\u4ea4\u7ed9\u7528\u6237\u7f16\u5199map()\u51fd\u6570\u5904\u7406\uff0c\u5e76\u4ea7\u751f\u4e00\u7cfb\u5217\u65b0\u7684<code>&lt;key, value&gt;</code>\u3002</p> <p>\uff083\uff09Collect\u6536\u96c6\u9636\u6bb5\uff1a\u8be5\u9636\u6bb5\u5c31\u662f\u5c06\u6570\u636emap()\u5904\u7406\u540e\u7684\u6570\u636e\u5199\u5230\u73af\u5f62\u7f13\u51b2\u533a\u4e2d\uff0c\u6b64\u65f6\u4f1a\u8c03\u7528\u5206\u533a\u5668Partitioner\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u533a\u3002</p> <p>\uff084\uff09Spill\u9636\u6bb5\uff1a\u5373\u6ea2\u5199\u9636\u6bb5\uff0c\u5f53\u73af\u5f62\u7f13\u51b2\u533a\u6ee1\u540e\uff08\u5f53\u8f93\u5165\u6570\u636e\u91cf\u672c\u8eab\u5c31\u6bd4\u8f83\u5c0f\uff0cCollect\u9636\u6bb5\u7ed3\u675f\u540e\u73af\u5f62\u7f13\u51b2\u533a\u6ca1\u6ee1\u4e5f\u4f1a\u6ea2\u5199\uff09\uff0c\u6570\u636e\u4f1a\u88ab\u6ea2\u5199\u5230\u672c\u5730\u78c1\u76d8\u751f\u6210\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5c06\u6570\u636e\u5199\u5165\u672c\u5730\u78c1\u76d8\u4e4b\u524d\uff0c\u5148\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5feb\u6392\uff0c\u6392\u5e8f\u7684\u8fc7\u7a0b\u662f\u5148\u6309\u5206\u533a\u6392\uff0c\u518d\u6309key\u6392\uff0c\u5982\u679c\u6709\u8bbe\u7f6ecombiner\uff0c\u8fd8\u4f1a\u5bf9\u6570\u636e\u8fdb\u884ccombine\uff0c\u6ea2\u5199\u540e\u7684\u6587\u4ef6\u4f1a\u6709\u4e00\u4e2a\u7d22\u5f15\u6587\u4ef6\u6765\u8bb0\u5f55\u6bcf\u4e2a\u5206\u533a\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u6bcf\u4e2a\u5206\u533a\u518d\u5728\u4e34\u65f6\u6587\u4ef6\u4e2d\u7684\u504f\u79fb\u91cf\u7b49\u3002</p> <p>\uff085\uff09Merge\u9636\u6bb5\uff1a\u5f53\u6240\u6709\u6570\u636e\u5904\u7406\u5b8c\u6210\u540e\uff0cMapTask\u4f1a\u5bf9\u6240\u6709\u4e34\u65f6\u6587\u4ef6\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f\uff0c\u5982\u679c\u6709\u8bbe\u7f6ecombiner\uff0c\u8fd8\u4f1a\u5bf9\u6570\u636e\u8fdb\u884ccombine\uff0c\u4ee5\u786e\u4fdd\u6700\u7ec8\u53ea\u4f1a\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\u548c\u7d22\u5f15\u6587\u4ef6\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#_3","title":"\u4e3a\u4ec0\u4e48\u8981\u6392\u5e8f\uff1f","text":"<p>\u77e5\u4e4e\u641c\u7d22MapReduce\u6392\u5e8f\u3002\u7528\u7684\u662f\u4ec0\u4e48\u6392\u5e8f\u7b97\u6cd5\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u7528\u5e76\u884c\u6392\u5e8f\u7b97\u6cd5\uff1f</p> <p>\u601d\u8003\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff1a\u5185\u5b58\u88c5\u4e0d\u4e0b\uff0c\u5982\u4f55\u501f\u52a9\u5916\u5b58\u5408\u5e76\u4e24\u4e2aMap\uff08\u628a\u76f8\u540ckey\u7684value\u5408\u5e76\uff09\uff1f</p> <p>\u7b54\uff1a\u53ea\u80fd\u5148\u6392\u5e8f\uff0c\u6b65\u9aa4\u662f\uff0c\u5148\u5206\u5757\u8bfb\u6587\u4ef6\u5bf9key\u8fdb\u884c\u5feb\u6392\u5e8f\uff0c\u7136\u540e\u628a\u6392\u597d\u5e8f\u7684\u6587\u4ef6\u5199\u5230\u5916\u5b58\uff0c\u518d\u501f\u52a9\u5916\u5b58\u5bf9\u6587\u4ef6\u8fdb\u884c\u5f52\u5e76\u6392\u5e8f\uff0c\u6700\u540e\u987a\u5e8f\u8bfb\u6587\u4ef6\u5bf9value\u8fdb\u884c\u805a\u5408\u3002</p> <p>\u6240\u4ee5\uff0c\u805a\u5408\u65f6\u5982\u679c\u5185\u5b58\u88c5\u5f97\u4e0b\u6240\u6709\u6570\u636e\u662f\u53ef\u4ee5\u4e0d\u6392\u5e8f\u7684\uff0c\u4f46\u662f\u5982\u679c\u5185\u5b58\u88c5\u4e0d\u4e0b\u5219\u5fc5\u987b\u5148\u6392\u5e8f\u3002Shuffle\u8fc7\u7a0b\u76f4\u63a5\u91c7\u53d6\u4e86\u6392\u5e8f\u7684\u65b9\u5f0f\uff0c\u4e0d\u7ba1\u5185\u5b58\u662f\u5426\u88c5\u5f97\u4e0b\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#_4","title":"\u4e3a\u4ec0\u4e48\u8981\u5408\u5e76\u591a\u4e2a\u6587\u4ef6\uff1f","text":"<ol> <li>\u907f\u514d\u4ea7\u751f\u8fc7\u591a\u5c0f\u6587\u4ef6\uff1a\u8ba9\u6bcf\u4e2aMapTask\u6700\u7ec8\u53ea\u751f\u6210\u4e00\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u907f\u514d\u540c\u65f6\u8bfb\u53d6\u5927\u91cf\u5c0f\u6587\u4ef6\u4ea7\u751f\u7684\u968f\u673a\u8bfb\u53d6\u5e26\u6765\u7684\u5f00\u9500</li> <li>\u5e76\u4e14\u5728map\u7aef\u5bf9\u540c\u4e00\u5206\u533a\u6570\u636e\u6392\u5e8f\u540e\uff0c\u53ef\u4ee5\u51cf\u5c11reduce\u7aef\u6392\u5e8f\u7684\u5de5\u4f5c\u91cf\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#reduce","title":"reduce\u7aef\uff1a","text":"<p>\uff086\uff09Copy\u9636\u6bb5\uff1aReduceTask\u4ece\u5404\u4e2aMapTask\u4e0a\u8fdc\u7a0b\u62f7\u8d1d\u5c5e\u4e8e\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u5982\u679c\u5176\u5927\u5c0f\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u5426\u5219\u76f4\u63a5\u653e\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\uff087\uff09Sort\u9636\u6bb5\uff1a\u5728\u8fdc\u7a0b\u62f7\u8d1d\u6570\u636e\u7684\u540c\u65f6\uff0cReduceTask\u542f\u52a8\u4e86\u4e24\u4e2a\u540e\u53f0\u7ebf\u7a0b\u5bf9\u5185\u5b58\u548c\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u4ee5\u9632\u6b62\u5185\u5b58\u4f7f\u7528\u8fc7\u591a\u6216\u78c1\u76d8\u4e0a\u6587\u4ef6\u8fc7\u591a\u3002\u7531\u4e8e\u5404\u4e2aMapTask\u5df2\u7ecf\u5b9e\u73b0\u5bf9\u81ea\u5df1\u7684\u5904\u7406\u7ed3\u679c\u8fdb\u884c\u4e86\u5c40\u90e8\u6392\u5e8f\uff0c\u56e0\u6b64\uff0cReduceTask\u53ea\u9700\u5bf9\u6240\u6709\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f\u5373\u53ef\u3002</p> <p>\uff088\uff09Reduce\u9636\u6bb5\uff1areduce()\u51fd\u6570\u5c06\u8ba1\u7b97\u7ed3\u679c\u5199\u5230HDFS\u4e0a\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#shuffle","title":"shuffle\u7684\u8fc7\u7a0b\uff1f","text":"<p>\u9996\u5148map\u7684\u8f93\u51fa\u4f1a\u5199\u5230\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9ed8\u8ba4\u4e3a100MB\uff0c\u53ef\u4ee5\u901a\u8fc7<code>io.sort.mb</code>\u5c5e\u6027\u8c03\u6574\u3002\u4e00\u65e6\u7f13\u51b2\u7684\u5185\u5bb9\u8fbe\u5230\u9884\u8bbe\u7684\u9600\u503c(\u901a\u8fc7<code>io.sort.spill.percent</code>\uff0c\u9ed8\u8ba4\u662f0.8\u621680%)\uff0c\u4e00\u4e2a\u540e\u53f0\u8fdb\u7a0b\u4fbf\u628a\u5185\u5bb9\u6ea2\u51fa(spill)\u5230\u78c1\u76d8\u3002\u5728\u6ea2\u51fa\u8fc7\u7a0b\u4e2d\uff0cmap\u4f1a\u7ee7\u7eed\u5f80\u73af\u5f62\u7f13\u51b2\u533a\u4e2d\u53cd\u5411\u5199\uff0c\u5982\u679c\u5728\u6b64\u671f\u95f4\u73af\u5f62\u7f13\u51b2\u533a\u88ab\u88ab\u586b\u6ee1\u4e86\uff0c\u5c31\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u76f4\u5230\u5199\u78c1\u76d8\u8fc7\u7a0b\u5b8c\u6210\u3002\u6ea2\u51fa\u65f6\u4f1a\u5c06\u6570\u636e\u5199\u5230<code>mapreduce.cluster.local.dir</code>\u6307\u5b9a\u7684\u76ee\u5f55\u5185\uff0c\u5728\u5199\u786c\u76d8\u4e4b\u524d\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u533a\u5e76\u6392\u5e8f\uff0c\u5982\u679c\u6709combiner\u51fd\u6570\uff0c\u5219\u5728\u6392\u5e8f\u4e4b\u540e\u6267\u884ccombiner\u3002\u6bcf\u6b21\u6ea2\u5199\u90fd\u4f1a\u751f\u4ea7\u4e00\u4e2a\u6ea2\u5199\u6587\u4ef6(spill file)\uff0cmap\u6700\u7ec8\u4f1a\u5c06\u6240\u6709\u6ea2\u51fa\u6587\u4ef6\u4f1a\u88ab\u5408\u5e76\u6210\u4e00\u4e2a\u5df2\u5206\u533a\u4e14\u5df2\u6392\u5e8f\u7684\u8f93\u51fa\u6587\u4ef6\u3002ReduceTask\u7684Shuffle\u9636\u6bb5\u9996\u5148\u4f1a\u4ece\u5404\u53f0Map\u4e3b\u673a\u4e0a\u62c9\u53d6\u540c\u4e00\u5206\u533a\u7684\u6587\u4ef6\uff0c\u7136\u540e\u5f52\u5e76\u6392\u5e8f\uff08\u5982\u679c\u5185\u5b58\u4e0d\u80fd\u5b58\u5f97\u4e0b\u5f52\u5e76\u540e\u7684\u6587\u4ef6\uff0c\u90a3\u4e48\u8fd8\u9700\u501f\u52a9\u78c1\u76d8\u5b58\u50a8\uff09\uff0c\u6392\u5b8c\u5e8f\u540e\u518d\u8fdb\u884cReduce\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#bean","title":"\u81ea\u5b9a\u4e49bean\u5bf9\u8c61\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\uff1f","text":"<p>key\u5fc5\u987b\u5b9e\u73b0WritableCompare\u63a5\u53e3\uff0cvalue\u53ef\u4ee5\u53ea\u5b9e\u73b0Writable\u63a5\u53e3\u3002\u56e0\u4e3akey\u548cvalue\u9700\u8981\u4ecemap\u7aef\u4f20\u9001reduce\u7aef\uff0c\u6240\u4ee5\u5fc5\u987b\u8981\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u8981\u5b9e\u73b0Writable\u63a5\u53e3\uff0c\u53c8\u56e0\u4e3aMapReduce\u7684shuffle\u662f\u5f3a\u5236\u8981\u6c42\u6392\u5e8f\u7684\uff0c\u6240\u4ee5key\u5fc5\u987b\u8fd8\u8981\u80fd\u6bd4\u8f83\u5927\u5c0f\uff0c\u4e5f\u5c31\u662fkey\u5fc5\u987b\u5b9e\u73b0WritableCompare\u63a5\u53e3\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#shuffle_1","title":"shuffle\u5e8f\u5217\u5316\u9700\u8981\u6ce8\u610f\u7684\u4e8b\u9879\uff1f","text":"<p>\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u7c7b\u9700\u8981\u4ee5\u4e0b7\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u5fc5\u987b\u5b9e\u73b0 Writable \u63a5\u53e3</li> <li>\u5fc5\u987b\u6709\u7a7a\u53c2\u6784\u9020\uff0c\u56e0\u4e3a\u53cd\u5e8f\u5217\u5316\u65f6\u9700\u8981\u53cd\u5c04\u8c03\u7528\u7a7a\u53c2\u6784\u9020\u51fd\u6570</li> <li>\u5fc5\u987b\u91cd\u5199\u5e8f\u5217\u5316\u65b9\u6cd5 public void write(DataOutput out) throws IOException</li> <li>\u5fc5\u987b\u91cd\u5199\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5 public void readFields(DataInput in) throws IOException</li> <li>\u53cd\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u548c\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u9700\u8981\u5b8c\u5168\u4e00\u81f4</li> <li>\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\u9700\u8981toString()\u65b9\u6cd5\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u5199toString()\u65b9\u6cd5\uff0c \u53ef\u7528\"\\t\"\u5206\u9694\u6bcf\u4e2a\u5b57\u6bb5</li> <li>\u5982\u8be5\u5e8f\u5217\u5316\u5bf9\u8c61\u662fmap\u8f93\u51fa\u7ed3\u679c\u7684key\uff0c\u90a3\u4e48 \u8fd8\u9700\u8981\u5b9e\u73b0 Comparable \u63a5\u53e3\uff0c\u56e0\u4e3aMapReduce \u6846\u67b6\u4e2d\u7684 Shuffle \u8fc7\u7a0b\u8981\u6c42\u5bf9 key \u5fc5\u987b\u80fd\u6392\u5e8f</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#yarn","title":"Yarn\u67b6\u6784\u548c\u5de5\u4f5c\u6d41\u7a0b\uff1f","text":"<p>\u4e3b\u8981\u8bb0\u4f4f\u8fd9\u4e2a\u4e1c\u897f\uff1a</p> <ul> <li> <p>ResoureManager</p> </li> <li> <p>NodeManager</p> </li> <li> <p>ApplicationMaster</p> </li> <li> <p>Container</p> </li> </ul> <p>yarn\u7531ResoureManager\u548cNodeManager\u7ec4\u6210\uff0c\u8fd9\u4e24\u4e2a\u8fdb\u7a0b\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\u91cc\u7684\u5e38\u9a7b\u8fdb\u7a0b\u3002ResoureManager\u8d1f\u8d23\u7b49\u5f85\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u548c\u76d1\u63a7NodeManager\uff0c\u638c\u7ba1\u7740yarn\u96c6\u7fa4\u7684\u8fd0\u884c\uff1bNodeManager\u5728\u5206\u5e03\u5f0f\u96c6\u7fa4\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u4e0a\u90fd\u6709\u4e00\u4e2a\uff0c\u8d1f\u8d23\u76d1\u63a7\u548c\u5206\u914d\u672c\u673a\u8d44\u6e90\uff08\u76d1\u63a7\u80af\u5b9a\u5c31\u662fNodeManager\u5b9a\u65f6\u5411ResoureManager\u53d1\u9001\u5fc3\u8df3\uff0c\u5206\u914d\u672c\u673a\u8d44\u6e90\u5c31\u662f\u5904\u7406\u6765\u81eaResoureManager\u7684\u8d44\u6e90\u5206\u914d\u8bf7\u6c42\uff09\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u5411ResoureManager\u8bf7\u6c42\u6267\u884c\u4efb\u52a1\u7684\u65f6\u5019\uff0cResoureManager\u9996\u5148\u4f1a\u628a\u4efb\u52a1\u52a0\u5165\u5230\u961f\u5217\u4e2d\u7b49\u5f85\u88ab\u8c03\u5ea6\u8fd0\u884c\uff0c\u5f53\u8f6e\u5230\u8fd9\u4e2a\u4efb\u52a1\u7684\u65f6\u5019\uff0cNodeManager\u9886\u53d6\u4efb\u52a1\u542f\u52a8\u4e00\u4e2aContainer\uff0cContainer\u5c31\u662f YARN\u4e2d\u7684\u8d44\u6e90\u62bd\u8c61\uff0c\u662f\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\uff0c\u7136\u540e\u5728\u8fd9\u4e2aContainer\u4e0a\u542f\u52a8ApplicationMaster\uff0c\u4e4b\u540e\u5c31\u4ea4\u7531ApplicationMaster\u6765\u8c03\u5ea6MapReduce\u4efb\u52a1\u7684\u8fd0\u884c\uff0c\u8fc7\u7a0b\u5c31\u662f\u5148\u8c03\u5ea6Map\u4efb\u52a1\uff0c\u6839\u636eMapTask\u7684\u6570\u91cf\u5c06MapTask\u4efb\u52a1\u52a0\u5165\u5230\u961f\u5217\u4e2d\uff0c\u4e4b\u540eNodeManager\u9886\u53d6\u4efb\u52a1\u542f\u52a8MapTask\uff0cMapTask\u5168\u90e8\u7ed3\u675f\u4e4b\u540e\uff0cApplicationMaster\u518d\u628aReduce\u4efb\u52a1\u52a0\u5165\u5230\u961f\u5217\u4e2d\uff0c\u7136\u540eNodeManager\u9886\u53d6\u4efb\u52a1\u542f\u52a8ReduceTask\uff0creduce\u4efb\u52a1\u5b8c\u6210\u4e4b\u540e\uff0cApplicationMaster\u5411ResoureManager\u7533\u8bf7\u6ce8\u9500\uff0c\u81f3\u6b64\u8fd9\u4e2aMapReduce\u4efb\u52a1\u5c31\u5b8c\u6210\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hadoop/#yarn_1","title":"Yarn\u6709\u54ea\u4e9b\u8c03\u5ea6\u5668\uff1f","text":"<p>\u4e09\u79cd\uff1a FIFO\u8c03\u5ea6\u5668\u3001 \u5bb9\u91cf\u8c03\u5ea6\u5668\uff08Capacity Scheduler\uff09 \u548c \u516c\u5e73\u8c03\u5ea6\u5668\uff08Fair\u00a0Scheduler\uff09\u3002</p> <p>FIFO\u8c03\u5ea6\u5668\uff1a\u628a\u5e94\u7528\u6309\u63d0\u4ea4\u7684\u987a\u5e8f\u6392\u6210\u4e00\u4e2a\u961f\u5217\uff0c\u8fd9\u662f\u4e00\u4e2a\u5148\u8fdb\u5148\u51fa\u961f\u5217\uff0c\u5728\u8fdb\u884c\u8d44\u6e90\u5206\u914d\u7684\u65f6\u5019\uff0c\u5148\u7ed9\u961f\u5217\u4e2d\u6700\u5934\u4e0a\u7684\u5e94\u7528\u8fdb\u884c\u5206\u914d\u8d44\u6e90\uff0c\u5f85\u6700\u5934\u4e0a\u7684\u5e94\u7528\u9700\u6c42\u6ee1\u8db3\u540e\u518d\u7ed9\u4e0b\u4e00\u4e2a\u5206\u914d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>\u5bb9\u91cf\u8c03\u5ea6\u5668\uff1aCapacity \u8c03\u5ea6\u5668\u5141\u8bb8\u591a\u4e2a\u7ec4\u7ec7\u5171\u4eab\u6574\u4e2a\u96c6\u7fa4\uff0c\u6bcf\u4e2a\u7ec4\u7ec7\u53ef\u4ee5\u83b7\u5f97\u96c6\u7fa4\u7684\u4e00\u90e8\u5206\u8ba1\u7b97\u80fd\u529b\u3002\u901a\u8fc7\u4e3a\u6bcf\u4e2a\u7ec4\u7ec7\u5206\u914d\u4e13\u95e8\u7684\u961f\u5217\uff0c\u7136\u540e\u518d\u4e3a\u6bcf\u4e2a\u961f\u5217\u5206\u914d\u4e00\u5b9a\u7684\u96c6\u7fa4\u8d44\u6e90\uff0c\u8fd9\u6837\u6574\u4e2a\u96c6\u7fa4\u5c31\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u591a\u4e2a\u961f\u5217\u7684\u65b9\u5f0f\u7ed9\u591a\u4e2a\u7ec4\u7ec7\u63d0\u4f9b\u670d\u52a1\u4e86\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u961f\u5217\u5185\u90e8\u53c8\u53ef\u4ee5\u5782\u76f4\u5212\u5206\uff0c\u8fd9\u6837\u4e00\u4e2a\u7ec4\u7ec7\u5185\u90e8\u7684\u591a\u4e2a\u6210\u5458\u5c31\u53ef\u4ee5\u5171\u4eab\u8fd9\u4e2a\u961f\u5217\u8d44\u6e90\u4e86\uff0c\u5728\u4e00\u4e2a\u961f\u5217\u5185\u90e8\uff0c\u8d44\u6e90\u7684\u8c03\u5ea6\u662f\u91c7\u7528\u7684\u662f\u5148\u8fdb\u5148\u51fa(FIFO)\u7b56\u7565\u3002</p> <p></p> <p>\u516c\u5e73\u8c03\u5ea6\u5668\uff1a\u516c\u5e73\u8c03\u5ea6\u5668\u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u4e3a\u6240\u6709\u7684\u5e94\u7528\u5206\u914d\u516c\u5e73\u7684\u8d44\u6e90\uff08\u5bf9\u516c\u5e73\u7684\u5b9a\u4e49\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6765\u8bbe\u7f6e\uff09\uff0c\u516c\u5e73\u8c03\u5ea6\u5728\u4e5f\u53ef\u4ee5\u5728\u591a\u4e2a\u961f\u5217\u95f4\u5de5\u4f5c\u3002</p> <p>\u4f8b\u5b50\uff1a\u5047\u8bbe\u6709\u4e24\u4e2a\u7528\u6237A\u548cB\uff0c\u4ed6\u4eec\u5206\u522b\u62e5\u6709\u4e00\u4e2a\u961f\u5217\u3002\u5f53A\u542f\u52a8\u4e00\u4e2ajob\u800cB\u6ca1\u6709\u4efb\u52a1\u65f6\uff0cA\u4f1a\u83b7\u5f97\u5168\u90e8\u96c6\u7fa4\u8d44\u6e90\uff1b\u5f53B\u542f\u52a8\u4e00\u4e2ajob\u540e\uff0cA\u7684job\u4f1a\u7ee7\u7eed\u8fd0\u884c\uff0c\u4e0d\u8fc7\u4e00\u4f1a\u513f\u4e4b\u540e\u4e24\u4e2a\u4efb\u52a1\u4f1a\u5404\u81ea\u83b7\u5f97\u4e00\u534a\u7684\u96c6\u7fa4\u8d44\u6e90\u3002\u5982\u679c\u6b64\u65f6B\u518d\u542f\u52a8\u7b2c\u4e8c\u4e2ajob\u5e76\u4e14\u5176\u5b83job\u8fd8\u5728\u8fd0\u884c\uff0c\u5219\u5b83\u5c06\u4f1a\u548cB\u7684\u7b2c\u4e00\u4e2ajob\u5171\u4eabB\u8fd9\u4e2a\u961f\u5217\u7684\u8d44\u6e90\uff0c\u4e5f\u5c31\u662fB\u7684\u4e24\u4e2ajob\u4f1a\u7528\u4e8e\u56db\u5206\u4e4b\u4e00\u7684\u96c6\u7fa4\u8d44\u6e90\uff0c\u800cA\u7684job\u4ecd\u7136\u7528\u4e8e\u96c6\u7fa4\u4e00\u534a\u7684\u8d44\u6e90\uff0c\u7ed3\u679c\u5c31\u662f\u8d44\u6e90\u6700\u7ec8\u5728\u4e24\u4e2a\u7528\u6237\u4e4b\u95f4\u5e73\u7b49\u7684\u5171\u4eab\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/","title":"Hive","text":"<p> \u7ea6 2462 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 49 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hivehive_sql","title":"Hive\u7684\u67b6\u6784\uff1fhive sql\u7684\u6267\u884c\u8fc7\u7a0b\uff1f","text":"<p>Hive\u65e2\u4e0d\u8d1f\u8d23\u6570\u636e\u7684\u5b58\u50a8\u4e5f\u4e0d\u8d1f\u8d23\u6570\u636e\u7684\u8ba1\u7b97\uff0chive\u7684\u4e3b\u8981\u5de5\u4f5c\u662f\u8d1f\u8d23SQL\u89e3\u6790\u548c\u7ef4\u62a4\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6570\u636e\u50a8\u5b58\u5728HDFS\u4e0a\uff0c\u8ba1\u7b97\u53ef\u4ee5\u9009\u62e9MapReduce\u3001Tez\u6216\u8005Spark\uff0c\u5143\u6570\u636e\u53ef\u4ee5\u5b58\u50a8\u5728MySQL\u6216\u8005deby\u7b49\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u3002</p> <p></p> <p>hive sql\u7684\u6267\u884c\u8fc7\u7a0b\uff1a</p> <ol> <li>client\u5c06hive sql\u63d0\u4ea4\u7ed9Driver\u3002</li> <li>Driver\u8c03\u7528SQL\u89e3\u6790\u5668\u3001\u7f16\u8bd1\u5668\u3001\u4f18\u5316\u5668\u751f\u6210\u7269\u7406\u6267\u884c\u8ba1\u5212\uff0c\u8fd9\u4e2d\u95f4\u4f1a\u8fdb\u884c\u5143\u6570\u636e\u7684\u8bbf\u95ee\u3002</li> <li>\u5982\u679c\u8ba1\u7b97\u5f15\u64ce\u4f7f\u7528\u7684\u662fSpark\u7684\u8bdd\uff0c\u6267\u884c\u5668\u4f1a\u628a\u7269\u7406\u6267\u884c\u8ba1\u5212\u63d0\u4ea4\u8d44\u6e90\u8c03\u5ea6\u5668Yarn\uff0c\u7531Yarn\u6765\u8c03\u5ea6Spark\u4efb\u52a1\u6267\u884c\uff0cSpark\u4efb\u52a1\u6267\u884c\u7684\u65f6\u5019\u4f1a\u4eceHDFS\u4e0a\u8bfb\u53d6\u6570\u636e\u3002</li> <li>\u6700\u540e\u628a\u67e5\u8be2\u7ed3\u679c\u8fd4\u56de\u7ed9Driver\uff0cDriver\u518d\u8fd4\u56de\u7ed9client\u3002</li> </ol> <p>Hive SQL\u7f16\u8bd1\u6210MapReduce\u6216Spark\u7a0b\u5e8f\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <ol> <li>\u8bcd\u6cd5\u3001\u8bed\u6cd5\u89e3\u6790: Antlr \u5b9a\u4e49 SQL \u7684\u8bed\u6cd5\u89c4\u5219\uff0c\u5b8c\u6210 SQL \u8bcd\u6cd5\uff0c\u8bed\u6cd5\u89e3\u6790\uff0c\u5c06 SQL \u8f6c\u5316\u4e3a\u62bd\u8c61\u8bed\u6cd5\u6811 AST Tree\uff1b</li> <li>\u8bed\u4e49\u89e3\u6790: \u904d\u5386 AST Tree\uff0c\u62bd\u8c61\u51fa\u67e5\u8be2\u7684\u57fa\u672c\u7ec4\u6210\u5355\u5143 QueryBlock\uff1b</li> <li>\u751f\u6210\u903b\u8f91\u6267\u884c\u8ba1\u5212: \u904d\u5386 QueryBlock\uff0c\u7ffb\u8bd1\u4e3a\u6267\u884c\u64cd\u4f5c\u6811 OperatorTree\uff1b</li> <li>\u4f18\u5316\u903b\u8f91\u6267\u884c\u8ba1\u5212: \u903b\u8f91\u5c42\u4f18\u5316\u5668\u8fdb\u884c OperatorTree \u53d8\u6362\uff0c\u5408\u5e76 Operator\uff0c\u8fbe\u5230\u51cf\u5c11 MapReduce Job\uff0c\u51cf\u5c11\u6570\u636e\u4f20\u8f93\u53ca shuffle \u6570\u636e\u91cf\uff1b</li> <li>\u751f\u6210\u7269\u7406\u6267\u884c\u8ba1\u5212: \u904d\u5386 OperatorTree\uff0c\u7ffb\u8bd1\u4e3a MapReduce \u4efb\u52a1\uff1b</li> <li>\u4f18\u5316\u7269\u7406\u6267\u884c\u8ba1\u5212: \u7269\u7406\u5c42\u4f18\u5316\u5668\u8fdb\u884c MapReduce \u4efb\u52a1\u7684\u53d8\u6362\uff0c\u751f\u6210\u6700\u7ec8\u7684\u6267\u884c\u8ba1\u5212\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hive","title":"hive \u5185\u90e8\u8868\u548c\u5916\u90e8\u8868\u7684\u533a\u522b\uff1f","text":"<p>\u5220\u9664\u5185\u90e8\u8868\u4f1a\u76f4\u63a5\u5220\u9664\u5143\u6570\u636e\uff08metadata\uff09\u53ca\u5b58\u50a8\u6570\u636e\uff1b\u5220\u9664\u5916\u90e8\u8868\u4ec5\u4ec5\u4f1a\u5220\u9664\u5143\u6570\u636e\uff0cHDFS\u4e0a\u7684\u6587\u4ef6\u5e76\u4e0d\u4f1a\u88ab\u5220\u9664\uff1b</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#row_numberrankdense_rank","title":"row_number()\u3001rank()\u3001dense_rank() \u533a\u522b\uff1f","text":"<ul> <li>rank()\uff1a1\u30012\u30012\u30014</li> <li>dense_rank()\uff1a1\u30012\u30012\u30013</li> <li>row_number()\uff1a1\u30012\u30013\u30014</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hive_1","title":"hive\u5e38\u7528\u5f00\u7a97\u51fd\u6570\uff1f","text":"<ul> <li> <p>\u805a\u5408\u51fd\u6570\uff1asum()\u3001max()\u7b49</p> </li> <li> <p>LAG(col,n,default_val)\uff1a\u53d6\u5f80\u524dn\u884c\u7684\u503c</p> </li> </ul> <p>\u200b       LEAD(col,n, default_val)\uff1a\u53d6\u5f80\u540en\u884c\u7684\u503c</p> <p>\u200b       FIRST_VALUE(col,[boolean])\uff1a\u53d6\u7b2c\u4e00\u4e2a\u6570\u636e</p> <p>\u200b       LAST_VALUE(col,[boolean])\uff1a\u53d6\u6700\u540e\u4e00\u4e2a\u6570\u636e</p> <ul> <li>row_number()\u3001rank()\u3001dense_rank() </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#4","title":"4\u79cd\u6392\u5e8f\u7684\u533a\u522b\uff1f","text":"<ul> <li>order by\uff1a\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u5168\u5c40\u6392\u5e8f\uff0c\u6b64\u65f6\u8bbe\u7f6ereduce\u4e2a\u6570\u65e0\u6548\uff0c\u53ea\u4f1a\u6709\u4e00\u4e2areduce\uff0c\u4f1a\u9020\u6210\u6570\u636e\u503e\u659c\u95ee\u9898\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e25\u683c\u6a21\u5f0f\u7981\u6b62\u4e0d\u5e26limit\u7684order by\u6267\u884c\uff0c\u5373set hive.mapred.mode=strict\u3002</li> <li>sort by\uff1a\u53ea\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u4e5f\u5c31\u662f\u53ea\u4f1a\u5bf9\u540c\u4e00\u4e2areduce\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u4e0d\u8fdb\u884c\u5168\u5c40\u6392\u5e8f\uff0c\u5982\u679c\u8bbe\u7f6e\u7684reduce\u7684\u4e2a\u6570\u7b49\u4e8e1\uff0c\u90a3\u4e48\u6b64\u65f6\u7684sort by \u548c order by\u7684\u6548\u679c\u4e00\u6837\uff0csort by \u7ecf\u5e38\u548cdistribute by\u8fde\u7528\u3002</li> <li>distribute by\uff1a\u7528\u4e8e\u6307\u5b9a\u6309\u54ea\u4e2a\u5217\u7684\u503c\u8fdb\u884c\u5206\u533a\uff0c\u4e5f\u5c31\u662f\u5177\u6709\u76f8\u540c\u503c\u7684\u6570\u636e\u4f1a\u8fdb\u5230\u540c\u4e00\u4e2areduce\u4e2d\u3002</li> <li>cluster by\uff1acluster by\u662fdistribute by \u548c sort by \u5b57\u6bb5\u76f8\u540c\u4e14\u6309\u5347\u5e8f\u6392\u5e8f\u65f6\u7684\u7b80\u5199\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hive_2","title":"Hive\u652f\u6301\u7684\u538b\u7f29\u683c\u5f0f\u548c\u5b58\u50a8\u683c\u5f0f\uff1f","text":"<p>TextFile\u548cSequenceFile\u662f\u884c\u5f0f\u5b58\u50a8\uff1borc\u548cparquet\u662f\u5217\u5f0f\u5b58\u50a8\u3002</p> <p>\u884c\u5f0f\u5b58\u50a8\uff1a</p> <ul> <li>\u7f3a\u70b9\uff1a\u56e0\u4e3a\u6570\u636e\u662f\u6309\u5757\u5b58\u53d6\uff0c\u6240\u4ee5\u5f53\u67e5\u8be2\u53ea\u6d89\u53ca\u67d0\u51e0\u4e2a\u5217\u65f6\uff0c\u8fd8\u662f\u4f1a\u628a\u6574\u884c\u6570\u636e\u90fd\u8bfb\u53d6\u51fa\u6765\uff0c\u4e0d\u80fd\u8df3\u8fc7\u4e0d\u5fc5\u8981\u7684\u5217\u8bfb\u53d6\uff1b\u53e6\u5916\u7531\u4e8e\u6bcf\u4e00\u884c\u4e2d\uff0c\u5217\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u4e0d\u5bb9\u6613\u83b7\u5f97\u4e00\u4e2a\u6781\u9ad8\u7684\u538b\u7f29\u6bd4\uff0c\u4e5f\u5c31\u662f\u7a7a\u95f4\u5229\u7528\u7387\u4e0d\u9ad8\u3002</li> <li>\u4f18\u70b9\uff1a\u9002\u5408\u67e5\u8be2\u660e\u7ec6\u3002</li> </ul> <p>\u5217\u5f0f\u5b58\u50a8\uff1a</p> <ul> <li>\u7f3a\u70b9\uff1a\u4e0d\u9002\u5408\u67e5\u8be2\u660e\u7ec6\uff0c\u6570\u636e\u7684INSERT\u3001UPDATE\u64cd\u4f5c\u6548\u7387\u4f4e\u3002</li> <li>\u4f18\u70b9\uff1a\u9002\u5408\u805a\u5408\u5206\u6790\u3002</li> </ul> <p>ORC\u7684\u5b58\u50a8\u683c\u5f0f\u662f\uff1a\u6570\u636e\u6309\u884c\u5206\u5757\uff0c\u6bcf\u5757\u6309\u7167\u5217\u5b58\u50a8\u3002\u53ea\u6709Bzip\u548cLZO\u7684\u538b\u7f29\u683c\u5f0f\u652f\u6301\u5206\u5272\uff0c\u5176\u4ed6\u4e0d\u652f\u6301\u3002</p> <p></p> <p>\u4e00\u6587\u641e\u61c2Hive\u7684\u5b58\u50a8\u683c\u5f0f\u4e0e\u538b\u7f29\u683c\u5f0f</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#map_join_reduce_join","title":"map join \u548c reduce join\uff1f","text":"<p>reduce join\uff1areduce join\u5c31\u662f\u6bd4\u8f83\u5e38\u89c4\u7684\u601d\u8def\uff0c\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u628ajoin\u5b57\u6bb5\u5f53\u4f5ckey\uff0c\u7136\u540e\u76f8\u540ckey\u7b49\u6570\u636e\u4f1a\u53d1\u5230\u540c\u4e00\u4e2areduce\u4e2d\uff0c\u4ece\u800c\u5b8c\u6210join\uff0c\u5176\u5b9e\u5c31\u662fHash join\u7684\u505a\u6cd5\u3002</p> <p>map join\uff1amap join\u662f\u5bf9reduce join\u7684\u4e00\u79cd\u4f18\u5316\uff0c\u4e0d\u8fc7\u4ec5\u9650\u4e8e\u5927\u8868join\u5c0f\u8868\u7684\u573a\u666f\uff0c\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u628a\u6574\u5f20\u5c0f\u8868\u52a0\u8f7d\u5230\u6240\u6709MapTask\u4e2d\uff08\u5982\u679c\u662fSpark\uff0c\u5219\u53ef\u4f7f\u7528\u5e7f\u64ad\u53d8\u91cf\u5c06\u5c0f\u8868\u5e7f\u64ad\u5230Executor\u5185\u5b58\u4e2d\uff09\uff0c\u7136\u540eMapTask\u518d\u5206\u5f00\u8bfb\u5927\u8868\u5b8c\u6210join\uff0c\u6700\u540e\u518d\u5728reduce\u5b8c\u6210\u805a\u5408\u3002map join\u53ef\u4ee5\u907f\u514d\u6570\u636e\u503e\u659c\uff0c\u964d\u4f4ereduce\u7aef\u7684\u538b\u529b\u3002\u7c7b\u4f3c\u4e8e\u57fa\u4e8e\u5757\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u7b97\u6cd5\uff0c\u9a71\u52a8\u8868\u7684\u53ef\u4ee5\u5b8c\u5168\u88c5\u8fdb\u5185\u5b58\u7684\u60c5\u51b5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hive_3","title":"hive\u7684\u6570\u636e\u503e\u659c\u95ee\u9898\uff1f","text":"<p>\u6570\u636e\u503e\u659c\u95ee\u9898\u662f\u6307\u6570\u636e\u5206\u914d\u4e0d\u5747\u5bfc\u81f4\u67d0\u4e9b\u8282\u70b9\u5904\u7406\u7f13\u6162\uff0c\u800c\u5176\u4ed6\u8282\u70b9\u5374\u5f88\u7a7a\u95f2\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u6574\u4e2a\u4efb\u52a1\u7684\u5904\u7406\u6548\u7387\u3002</p> <p>\u6570\u636e\u503e\u659c\u4e3b\u8981\u53d1\u751fReduce\u7aef\uff0c\u56e0\u4e3a\u76f8\u540cKey\u7684\u6570\u636e\u4f1a\u8fdb\u5165\u5230\u540c\u4e00\u4e2aReduce\u7aef\uff0c\u5982\u679c\u5176\u4e2d\u67d0\u51e0\u4e2aKey\u7684\u6570\u636e\u91cf\u76f8\u6bd4\u4e8e\u5176\u4ed6key\u7684\u6570\u636e\u91cf\u7279\u522b\u5927\uff0c\u90a3\u4e48\u5c31\u4f1a\u5f15\u53d1\u6570\u636e\u503e\u659c\uff0c\u6bd4\u5982 join \u548c group by\u7684\u65f6\u5019\u5c31\u6bd4\u8f83\u5bb9\u6613\u53d1\u751f\u6570\u636e\u503e\u659c\u3002</p> <p>join\u65f6\u7684\u6570\u636e\u503e\u659c\uff1a</p> <p>inner join\u7684\u6570\u636e\u503e\u659c\u662f\u7531\u4e8e\u67d0\u51e0\u4e2aKey\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u9020\u6210\u7684\uff0c\u89e3\u51b3\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li>\u5982\u679c\u662f\u5927\u8868join\u5c0f\u8868\uff0c\u53ef\u4ee5\u5f00\u542f Map join\uff08\u9ed8\u8ba4\u5c31\u662f\u5f00\u542f\uff09\u3002</li> <li>~~\u4f7f\u7528\u5206\u6876\u8868\u6765\u4f18\u5316\u4e24\u5f20\u5927\u8868\u7684join\u3002\u4e0ereduce join\u7684\u533a\u522b\u5c31\u662f\uff0c\u4f7f\u7528\u5206\u6876\u8868\u53ef\u4ee5\u5728Map\u7aef\u5b8c\u6210join\uff1b\u4e0eMap join\u7684\u533a\u522b\u5c31\u662f\uff0c\u4f7f\u7528\u5206\u6876\u8868\u4e0d\u7528\u5c06\u67d0\u4e00\u5f20\u8868\u5b8c\u5168\u52a0\u8f7d\u5230Map\u7684\u5185\u5b58\u4e2d\u3002~~</li> </ul> <p>left join\u548cfull join \u9664\u4e86\u6709inner join\u7684\u95ee\u9898\u5916\uff0c\u8fd8\u6709\u5f53\u8fde\u63a5\u5b57\u6bb5\u6709\u5f88\u591anull\u65f6\uff0c\u4e5f\u4f1a\u5f15\u53d1\u6570\u636e\u503e\u659c\uff0c\u56e0\u4e3a\u503c\u4e3anull\u7684\u6570\u636e\u4f1a\u8fdb\u5230\u4e00\u4e2areduce\u4e2d\uff0cinner join\u6ca1\u6709\u8fd9\u6837\u7684\u95ee\u9898\u662f\u56e0\u4e3a\u5185\u8fde\u63a5\u7684\u65f6\u5019\uff0cnull\u4f1a\u88ab\u81ea\u52a8\u8fc7\u6ee4\uff0c\u4e0d\u53c2\u4e0e\u8fde\u63a5\u3002\u89e3\u51b3null\u503c\u5f15\u53d1\u7684\u6570\u636e\u503e\u659c\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u5982\u679c\u8fde\u63a5\u5b57\u6bb5\u4e3anull\u7684\u6570\u636e\u5e76\u4e0d\u9700\u8981\u4fdd\u7559\uff0c\u53ef\u4ee5\u5148\u8fc7\u6ee4\u6389null\u503c\u518d\u505a\u8fde\u63a5 </li> <li>\u5982\u679c\u8fde\u63a5\u5b57\u6bb5\u4e3anull\u7684\u6570\u636e\u9700\u8981\u4fdd\u7559\uff0c\u53ef\u4ee5\u7ed9null\u5b57\u6bb5\u8d4b\u4e00\u4e2a\u968f\u673a\u503c\uff0c\u4e0d\u8fc7\u9700\u8981\u4fdd\u8bc1\u968f\u673a\u503c\u5173\u8054\u4e0d\u4e0a</li> </ul> <p>group by\u7684\u6570\u636e\u503e\u659c\uff1a</p> <p>group by\u7684\u6570\u636e\u503e\u659c\u662f\u7531\u4e8e\u67d0\u51e0\u4e2aKey\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u9020\u6210\u7684\uff0c\u89e3\u51b3\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li>\u5f00\u542f Map \u7aef\u805a\u5408\uff1a<code>set hive.map.aggr=true</code>\u3002\uff08Spark\u81ea\u52a8\u5c31\u6709\uff09</li> <li>\u5f00\u542f\u8d1f\u8f7d\u5747\u8861\uff1a<code>set hive.groupby.skewindata=true</code>\uff0c\u5f00\u542f\u8be5\u914d\u7f6e\u4f1a\u5c06\u4f5c\u4e1a\u62c6\u89e3\u6210\u4e24\u4e2a\u4f5c\u4e1a\uff0c\u5148\u628a\u6570\u636e\u91cf\u5927\u7684key\u62fc\u63a5\u4e00\u4e9b\u968f\u673a\u6570\u4f7f\u5176\u5206\u6563\u5230\u4e0d\u540c\u7684reduce\u4e2d\u805a\u5408\uff0c\u4e4b\u540e\u518d\u628a\u62fc\u63a5\u7684\u968f\u673a\u6570\u53bb\u6389\u8fdb\u884c\u4e00\u6b21\u805a\u5408\u3002</li> </ul> <p>\u9664\u4e86Reduce\u7aef\u4f1a\u51fa\u73b0\u6570\u636e\u503e\u659c\u4e4b\u5916\uff0cMap\u7aef\u4e5f\u53ef\u80fd\u4f1a\uff0cMap\u7aef\u7684\u6570\u636e\u503e\u659c\u4e3b\u8981\u662f\uff0c\u6570\u636e\u5b58\u50a8\u95ee\u9898\u9020\u6210\u7684\uff0c\u6bd4\u5982\u4f7f\u7528GZIP\u7b49\u4e0d\u53ef\u5206\u5272\u7684\u538b\u7f29\u65b9\u5f0f\u5b58\u50a8\u5927\u6587\u4ef6\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5904\u7406\u8fd9\u4e2a\u538b\u7f29\u6587\u4ef6\u7684MapTask\u4efb\u52a1\u6bd4\u5176\u4ed6\u4efb\u52a1\u66f4\u6162\u3002\u89e3\u51b3\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528Bzip\u548cLZO\u7b49\u652f\u6301\u5206\u5272\u7684\u538b\u7f29\u683c\u5f0f\u3002</p> <p>\u8fd8\u6709\u5c31\u662f\u6709\u4e9bsql\u8bed\u53e5\u672c\u8eab\u5c31\u4f1a\u9020\u6210\u6570\u636e\u503e\u659c\uff0c\u6bd4\u5982<code>count(distinct)</code>\u53ea\u80fd\u7528\u4e00\u4e2a reduce \u6765\u5b8c\u6210\uff0c\u6240\u4ee5\u5f53\u6570\u636e\u91cf\u5f88\u5927\u65f6\u4f1a\u9020\u6210\u6570\u636e\u503e\u659c\uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\uff1a\u4f7f\u7528\u5148 GROUP BY \u5206\u6563\u5230\u4e0d\u540c\u7684reduce\u4e2d\u53bb\u91cd\uff0c\u7136\u540e\u518d\u4f7f\u7528COUNT\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hive_4","title":"Hive\u7684\u4f18\u5316\u63aa\u65bd\uff1f","text":"<ol> <li> <p>\u672c\u5730\u6a21\u5f0f\uff1a\u6ca1\u6709\u5f00\u542f\u672c\u5730\u6a21\u5f0f\u65f6\uff0c\u6240\u6709\u4efb\u52a1\u90fd\u4f1a\u63d0\u4ea4\u7ed9yarn\u6765\u8c03\u5ea6\u6267\u884c\uff0c\u5f00\u542f\u672c\u5730\u6a21\u5f0f\u4e4b\u540e\uff0chive\u4f1a\u5148\u5224\u65ad\u67e5\u8be2\u7684\u6570\u636e\u91cf\u5927\u4e0d\u5927\uff0c\u5982\u679c\u4e0d\u5927\u5c31\u76f4\u63a5\u5728\u672c\u5730\u8fd0\u884c\uff0c\u4e0d\u63d0\u4ea4\u7ed9yarn\u3002\u2714</p> </li> <li> <p>\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\uff0c\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u53ef\u4ee5\u51cf\u5c11MapTask\u7684\u6570\u91cf</p> </li> </ol> <p><code>set hive.input.format = org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;</code></p> <ol> <li> <p>\u5408\u7406\u8bbe\u7f6eReduce\u7684\u4e2a\u6570\uff0creduce \u4e2a\u6570\u5e76\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0c\u56e0\u4e3a\u8fc7\u591a\u7684\u542f\u52a8\u548c\u521d\u59cb\u5316 reduce \u4e5f\u4f1a\u6d88\u8017\u65f6\u95f4\u548c\u8d44\u6e90\u3002</p> </li> <li> <p>\u8bbe\u7f6e\u4e25\u683c\u6a21\u5f0f\u2714</p> </li> <li> <p>\u5bf9\u4e8e\u5206\u533a\u8868\uff0c\u8981\u6c42 where \u8bed\u53e5\u4e2d\u5fc5\u987b\u542b\u6709\u5206\u533a\u5b57\u6bb5\u7684\u8fc7\u6ee4\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f\u4e0d\u5141\u8bb8\u7528\u6237\u626b\u63cf\u6240\u6709\u5206\u533a\uff1a<code>set hive.strict.checks.no.partition.filter=true;</code></p> </li> <li> <p>order by \u5fc5\u987b\u548c limit \u8fde\u7528\uff1a<code>set hive.strict.checks.orderby.no.limit=true;</code> </p> </li> <li> <p>\u7981\u6b62join\u65f6\u4e0d\u52a0on\u8fde\u63a5\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f\u4e0d\u5141\u8bb8\u51fa\u73b0\u7b1b\u5361\u5c14\u79ef\uff1a<code>set hive.strict.checks.cartesian.product=true;</code></p> </li> <li> <p>\u5f00\u542fjvm\u91cd\u7528</p> </li> <li> <p>\u8bbe\u7f6e\u6570\u636e\u5b58\u50a8\u683c\u5f0f\u548c\u538b\u7f29\u65b9\u5f0f\uff1a\u9488\u5bf9 hive \u4e2d\u8868\u7684\u5b58\u50a8\u683c\u5f0f\u901a\u5e38\u6709 orc \u548c parquet\uff0c\u538b\u7f29\u683c\u5f0f\u4e00\u822c\u4f7f\u7528 snappy\u2714</p> </li> <li> <p>\u8bbe\u7f6eFetch\uff0cFetch\u662f\u6307Hive \u4e2d\u5bf9\u4e00\u4e9b\u7b80\u5355\u7684\u67e5\u8be2\u53ef\u4ee5\u4e0d\u5fc5\u4f7f\u7528 MapReduce \u8ba1\u7b97\u3002\u2714</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#hive_5","title":"Hive \u5c0f\u6587\u4ef6\u8fc7\u591a\u600e\u4e48\u89e3\u51b3\uff1f","text":"<ol> <li>\u4f7f\u7528 hive \u81ea\u5e26\u7684 concatenate \u547d\u4ee4\uff0c\u81ea\u52a8\u5408\u5e76\u5c0f\u6587\u4ef6\u3002\u2714</li> </ol> Text Only<pre><code>#\u5bf9\u4e8e\u975e\u5206\u533a\u8868\nalter\u00a0table\u00a0A\u00a0concatenate;\n#\u5bf9\u4e8e\u5206\u533a\u8868\nalter\u00a0table\u00a0B\u00a0partition(day=20201224)\u00a0concatenate;\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <p>1\u3001concatenate \u547d\u4ee4\u53ea\u652f\u6301 RCFILE \u548c ORC \u6587\u4ef6\u7c7b\u578b\u3002</p> <p>2\u3001\u4f7f\u7528 concatenate \u547d\u4ee4\u5408\u5e76\u5c0f\u6587\u4ef6\u65f6\u4e0d\u80fd\u6307\u5b9a\u5408\u5e76\u540e\u7684\u6587\u4ef6\u6570\u91cf\uff0c\u4f46\u53ef\u4ee5\u591a\u6b21\u6267\u884c\u8be5\u547d\u4ee4\u3002</p> <p>3\u3001\u5f53\u591a\u6b21\u4f7f\u7528 concatenate \u540e\u6587\u4ef6\u6570\u91cf\u4e0d\u5728\u53d8\u5316\uff0c\u8fd9\u4e2a\u8ddf\u53c2\u6570 <code>mapreduce.input.fileinputformat.split.minsize=256mb</code> \u7684\u8bbe\u7f6e\u6709\u5173\uff0c\u53ef\u8bbe\u5b9a\u6bcf\u4e2a\u6587\u4ef6\u7684\u6700\u5c0f size\u3002</p> <ol> <li> <p>map\u7aef\u8f93\u5165\u65f6\u53ef\u4ee5\u4f7f\u7528<code>CombineHiveInputFormat</code>\u5bf9\u5c0f\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u3002</p> </li> <li> <p>\u51cf\u5c11 Reduce \u7684\u6570\u91cf\uff0creduce \u7684\u4e2a\u6570\u51b3\u5b9a\u4e86\u8f93\u51fa\u7684\u6587\u4ef6\u7684\u4e2a\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u8c03\u6574 reduce \u7684\u4e2a\u6570\u63a7\u5236\u6587\u4ef6\u6570\u91cf\u3002</p> </li> <li> <p>\u4f7f\u7528 hadoop \u7684 archive \u5c06\u5c0f\u6587\u4ef6\u5f52\u6863\u3002\u2714</p> </li> </ol> <p>Hadoop Archive \u7b80\u79f0 HAR\uff0c\u662f\u4e00\u4e2a\u9ad8\u6548\u5730\u5c06\u5c0f\u6587\u4ef6\u653e\u5165 HDFS \u5757\u4e2d\u7684\u6587\u4ef6\u5b58\u6863\u5de5\u5177\uff0c\u5b83\u80fd\u591f\u5c06\u591a\u4e2a\u5c0f\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a HAR \u6587\u4ef6\uff0c\u8fd9\u6837\u5728\u51cf\u5c11 namenode \u5185\u5b58\u4f7f\u7528\u7684\u540c\u65f6\uff0c\u4ecd\u7136\u5141\u8bb8\u5bf9\u6587\u4ef6\u8fdb\u884c\u900f\u660e\u7684\u8bbf\u95ee\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Hive/#_1","title":"\u65f6\u95f4\u5904\u7406\u51fd\u6570\uff1f","text":"\u51fd\u6570 \u4f5c\u7528 <code>unix_timestamp(\"2020-10-28\",'yyyy-MM-dd');</code> \u83b7\u53d6\u6307\u5b9a\u65f6\u95f4\u7684\u65f6\u95f4\u6233 <code>from_unixtime(1603843200);</code> \u5c06\u65f6\u95f4\u6233\u8f6c\u4e3a\u65e5\u671f\u683c\u5f0f <code>date_format('2020-10-28 12:12:12','yyyy/MM/dd HH:mm:ss');</code> \u683c\u5f0f\u5316\u65e5\u671f"},{"location":"%E9%97%AE%E7%AD%94/JVM/","title":"JVM","text":"<p> \u7ea6 9420 \u4e2a\u5b57  8 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 188 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jvm","title":"JVM\u7684\u5185\u5b58\u7ed3\u6784\uff1f\u2b50","text":"<p>JVM\u7684\u5185\u5b58\u7ed3\u6784\u5305\u62ec\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u3001\u5806\u3001\u65b9\u6cd5\u533a\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668\u3002\u5176\u4e2d\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff0c\u968f\u7ebf\u7a0b\u4e00\u8d77\u521b\u5efa\u548c\u9500\u6bc1\uff0c\u800c\u5806\u548c\u65b9\u6cd5\u533a\u662f\u6240\u6709\u7ebf\u7a0b\u6240\u5171\u4eab\u7684\u3002</p> <ul> <li> <p>\u7ebf\u7a0b\u521b\u5efa\u65f6\uff0cjvm\u4f1a\u4e3a\u5176\u521b\u5efa\u5bf9\u5e94\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u4f5c\u7528\u662f\u6307\u793a\u4e0b\u4e00\u6761\u9700\u8981\u6267\u884c\u7684\u5b57\u8282\u7801\u6307\u4ee4\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5728\u7ebf\u7a0b\u5207\u6362\u4e4b\u540e\u80fd\u6062\u590d\u5230\u6b63\u786e\u7684\u6267\u884c\u4f4d\u7f6e\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u521b\u5efa\u65f6\uff0cjvm\u4f1a\u4e3a\u5176\u521b\u5efa\u5bf9\u5e94\u7684\u865a\u62df\u673a\u6808\uff0c\u7ebf\u7a0b\u6267\u884c\u65b9\u6cd5\u65f6\u4f1a\u521b\u5efa\u6808\u5e27\uff0c\u65b9\u6cd5\u6267\u884c\u7684\u8fc7\u7a0b\u5c31\u662f\u5bf9\u5e94\u6808\u5e27\u5728\u865a\u62df\u673a\u6808\u91cc\u5165\u6808\u548c\u51fa\u6808\u7684\u8fc7\u7a0b\u3002</p> </li> </ul> <p>\u4e00\u4e2a\u6808\u5e27\u5305\u62ec\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u65b9\u6cd5\u8fd4\u56de\u5730\u5740\u3001\u52a8\u6001\u8fde\u63a5\u548c\u4e00\u4e9b\u989d\u5916\u7684\u9644\u52a0\u4fe1\u606f\u3002</p> <ul> <li> <p>\u5c40\u90e8\u53d8\u91cf\u8868\u7528\u4e8e\u5b58\u653e\u65b9\u6cd5\u53c2\u6570\u548c\u65b9\u6cd5\u5185\u90e8\u5b9a\u4e49\u7684\u5c40\u90e8\u53d8\u91cf\u3002\u5728Java\u7a0b\u5e8f\u88ab\u7f16\u8bd1\u6210\u5b57\u8282\u7801\u6587\u4ef6\u65f6\uff0c\u65b9\u6cd5code\u5c5e\u6027\u7684max_locals\u6570\u636e\u9879\u5c31\u786e\u5b9a\u4e86\u8be5\u65b9\u6cd5\u6240\u9700\u5206\u914d\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u7684\u6700\u5927\u5bb9\u91cf\u3002\u5b9e\u4f8b\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\uff0c\u5c40\u90e8\u53d8\u91cf\u8868\u7684\u7b2c0\u4f4d\u7d22\u5f15\u7684\u53d8\u91cf\u69fd\u5b58\u653e\u7684\u662fthis\u3002\u4e3a\u4e86\u8282\u7701\u6808\u5e27\u6240\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5c40\u90e8\u53d8\u91cf\u8868\u7684\u53d8\u91cf\u69fd\u53ef\u4ee5\u6839\u636e\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u8fdb\u884c\u590d\u7528\u3002</p> </li> <li> <p>\u64cd\u4f5c\u6570\u6808\u7684\u6700\u5927\u6df1\u5ea6\u5728\u7f16\u8bd1\u65f6\u5df2\u7ecf\u88ab\u5199\u5728\u65b9\u6cd5Code\u5c5e\u6027\u7684\u7684max_satcks\u6570\u636e\u9879\u4e2d\u3002</p> </li> <li> <p>\u672c\u5730\u65b9\u6cd5\u6808\u662f\u4e3a\u865a\u62df\u673a\u4f7f\u7528\u672c\u5730\u65b9\u6cd5\u670d\u52a1\u7684\u3002HotSpot\u76f4\u63a5\u628a\u865a\u62df\u673a\u6808\u548c\u672c\u5730\u65b9\u6cd5\u5408\u4e8c\u4e3a\u4e00\u4e86\u3002</p> </li> <li> <p>\u5806\u662f\u7528\u6765\u5b58\u653e\u5bf9\u8c61\u5b9e\u4f8b\u7684\uff0c\u51e0\u4e4e\u6240\u6709\u5bf9\u8c61\u90fd\u5728\u5806\u4e0a\u5206\u914d\u3002\u5806\u5185\u5b58\u88ab\u5212\u5206\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u6bd4\u4f8b\u9ed8\u8ba4\u662f1:2\uff0c\u65b0\u751f\u4ee3\u4e2d\u53c8\u5206\u4e3aEden\u533a\u3001Survivor0\u548cSurvivor1\u533a\uff0c\u6bd4\u4f8b\u662f8:1:1\u3002</p> </li> <li> <p>\u65b9\u6cd5\u533a\u4e3b\u8981\u662f\u7528\u4e8e\u5b58\u653e\u7c7b\u578b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7f13\u5b58\u3002</p> </li> <li> <p>\u7c7b\u578b\u4fe1\u606f\uff1a\u7c7b\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u5305\u62ec\u7c7b\u540d\u3001\u5b57\u6bb5\u63cf\u8ff0\u3001\u65b9\u6cd5\u63cf\u8ff0\u7b49\uff0c\u5360\u5927\u5934\u7684\u662f\u65b9\u6cd5\uff0c\u65b9\u6cd5\u7f16\u8bd1\u6210\u7684\u5b57\u8282\u7801\u5360\u7684\u7a7a\u95f4\u662f\u6700\u591a\u7684\uff0c\u6240\u4ee5\u53eb\u65b9\u6cd5\u533a\u3002</p> </li> <li>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff1a\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u548c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e0d\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\uff0cJDK6\u65f6\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u5305\u542b\u4e86\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0cJDK7\u53ca\u4e4b\u540e\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u642c\u5230\u4e86\u5806\uff0c\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u8fd8\u5728\u65b9\u6cd5\u533a\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_1","title":"\u5185\u5b58\u6ea2\u51fa\u548c\u5185\u5b58\u6cc4\u6f0f\uff1f","text":"<p>\u5185\u5b58\u6ea2\u51fa\uff1aOut Of Memory\uff0c\u7a0b\u5e8f\u5728\u7533\u8bf7\u4e0d\u5230\u8db3\u591f\u7684\u5185\u5b58\u4e86\u5c31\u4f1a\u62a5OOM\u3002 \u5185\u5b58\u6cc4\u9732\uff1aMemory Leak\uff0c\u6307\u6709\u4e9b\u5185\u5b58\u7a7a\u95f4\u867d\u7136\u5df2\u7ecf\u6ca1\u7528\u4e86\uff0c\u4f46\u662f\u53c8\u65e0\u6cd5\u88ab\u56de\u6536\u3002</p> <p>\u5bfc\u81f4\u5185\u5b58\u6cc4\u9732\u7684\u573a\u666f\uff1a</p> <ul> <li>\u9759\u6001\u5c5e\u6027\u5bfc\u81f4\u5185\u5b58\u6cc4\u9732</li> </ul> <p>\u9759\u6001\u5c5e\u6027\u7684\u751f\u547d\u5468\u671f\u901a\u5e38\u4f34\u968f\u7740\u5e94\u7528\u6574\u4e2a\u751f\u547d\u5468\u671f(\u9664\u975eClassLoader\u7b26\u5408\u5783\u573e\u56de\u6536\u7684\u6761\u4ef6)\uff0c\u6240\u4ee5\u5373\u4f7f\u5f53\u4e00\u4e2a\u9759\u6001\u5c5e\u6027\u518d\u4e5f\u4e0d\u4f1a\u88ab\u4f7f\u7528\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u88ab\u56de\u6536\u3002\u5355\u4f8b\u6a21\u5f0f\u5c31\u662f\u5178\u578b\u7684\u9759\u6001\u5c5e\u6027\u573a\u666f\u3002</p> <ul> <li>\u672a\u5173\u95ed\u7684\u8d44\u6e90</li> </ul> <p>\u6bd4\u5982\u5404\u79cd\u8fde\u63a5\uff1a\u6570\u636e\u5e93\u8fde\u63a5\u3001\u7f51\u7edc\u8fde\u63a5\u3001io\u8fde\u63a5\uff0c\u9664\u975e\u5176\u663e\u5f0f\u7684\u8c03\u7528\u4e86\u5176close\u65b9\u6cd5\u5c06\u5176\u8fde\u63a5\u5173\u95ed\uff0c\u5426\u5219\u662f\u4e0d\u4f1a\u81ea\u52a8\u88abGC \u56de\u6536\u7684\u3002</p> <ul> <li>ThreadLocal</li> </ul> <p>\u5982\u679c\u4e00\u4e2a\u4f7f\u7528\u4e86ThreadLocal\u5e76\u4e14\u6ca1\u6709\u8c03\u7528\u5176remove()\u65b9\u6cd5\u7684\u7ebf\u7a0b\u8fdf\u8fdf\u4e0d\u7ed3\u675f\uff0c\u90a3\u4e48ThreadLocalMap\u91cc\u9762\u7684value\u5c31\u4e0d\u4f1a\u88ab\u56de\u6536\uff0c\u4e8e\u662f\u5c31\u4f1a\u9020\u6210\u5185\u5b58\u6cc4\u9732\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#gcoomstackoverflow","title":"\u6709GC\u7684\u533a\u57df\uff1f\u6709OOM\u7684\u533a\u57df\uff1f\u6709StackOverflow\u7684\u533a\u57df\uff1f\u2b50","text":"<p>\u6709GC\u7684\u533a\u57df\uff1a\u5806\u3001\u65b9\u6cd5\u533a \u6709OOM\u7684\u533a\u57df\uff1a\u5806\u3001\u65b9\u6cd5\u533a\u3001\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u3002\u4e5f\u5c31\u662f\u8bf4\u51fa\u6765\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e4b\u5916\u76844\u4e2a\u533a\u57df\u90fd\u6709OOM\u3002 \u6709StackOverflow\u7684\u533a\u57df\uff1a\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jdk678","title":"\u65b9\u6cd5\u533a\u5728JDK6\u30017\u30018\u4e2d\u7684\u53d8\u5316\uff1f\u2b50","text":"<p>JDK6\u548cJDK7\u7684\u65b9\u6cd5\u533a\u5728HotSpot\u865a\u62df\u673a\u4e2d\u7684\u843d\u5730\u5b9e\u73b0\u662f\u6c38\u4e45\u4ee3\uff0c\u4e4b\u6240\u4ee5\u79f0\u4e4b\u4e3a\u6c38\u4e45\u4ee3\uff0c\u662f\u56e0\u4e3aHotSpot\u865a\u62df\u673a\u5c06\u5206\u4ee3\u56de\u6536\u7684\u8bbe\u8ba1\u6269\u5c55\u81f3\u65b9\u6cd5\u533a\u4e0a\uff0c\u4f7f\u5f97\u5783\u573e\u56de\u6536\u5668\u80fd\u50cf\u7ba1\u7406\u5806\u5185\u5b58\u4e00\u6837\u7ba1\u7406\u65b9\u6cd5\u533a\u3002\u4f46\u4eceJDK6\u5230JDK7\uff0c\u65b9\u6cd5\u533a\u505a\u4e86\u4e00\u4e9b\u6539\u52a8\uff0c\u5728JDK6\u4e2d\uff0c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u548c\u9759\u6001\u53d8\u91cf\u90fd\u662f\u653e\u5728\u65b9\u6cd5\u533a\u4e2d\uff1b\u5230\u4e86JDK7\u65f6\u5df2\u7ecf\u5c06\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u548c\u9759\u6001\u53d8\u91cf\u79fb\u5230\u4e86\u5806\u5185\u5b58\u4e2d\uff0c\u4f46\u662f\u65b9\u6cd5\u533a\u8fd8\u662f\u6c38\u4e45\u4ee3\u3002\u5230\u4e86JDK8\u5c31\u5b8c\u5168\u5e9f\u9664\u4e86\u6c38\u4e45\u4ee3\uff0c\u6539\u4e3a\u5143\u7a7a\u95f4\uff0c\u6240\u8c13\u5143\u7a7a\u95f4\u5c31\u6307\u662f\u672c\u5730\u5185\u5b58\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#permgen_metaspace","title":"\u4e3a\u4ec0\u4e48\u8981\u5c06\u6c38\u4e45\u4ee3 (PermGen) \u66ff\u6362\u4e3a\u5143\u7a7a\u95f4 (MetaSpace) ?","text":"<p>\u65b9\u6cd5\u533a\u5b58\u653e\u7684\u7c7b\u578b\u4fe1\u606f\u548c\u5e38\u91cf\u7b49\u5176\u5b83\u4fe1\u606f\u90fd\u662f\u52a8\u6001\u53d8\u5316\u7684\uff0c\u800c\u6c38\u4e45\u4ee3\u7684\u5927\u5c0f\u53d7\u5230\u8bbe\u7f6e\u7684\u9650\u5236\uff08\u4f7f\u7528-XX:MaxPermSize\u7684\u6307\u5b9a\uff0c\u5373\u4f7f\u4e0d\u6307\u5b9a\u4e5f\u6709\u9ed8\u8ba4\u7684\u5927\u5c0f\uff09\uff0c\u8fd9\u6837\u5f88\u5bb9\u6613\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa\u95ee\u9898\u3002\u4f46\u5143\u7a7a\u95f4\u7684\u5927\u5c0f\u53ea\u53d7\u5230\u672c\u673a\u7269\u7406\u5185\u5b58\u7684\u9650\u5236\uff0c\u6240\u4ee5\u5185\u5b58\u6ea2\u51fa\u7684\u53ef\u80fd\u6027\u66f4\u5c0f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_2","title":"\u5b9e\u4f8b\u5bf9\u8c61\u662f\u600e\u6837\u5b58\u50a8\u7684\uff1f","text":"<p>\u5bf9\u8c61\u7684\u5b9e\u4f8b\u5b58\u50a8\u5728\u5806\u7a7a\u95f4\uff1b\u5bf9\u8c61\u7684\u7c7b\u5143\u4fe1\u606f\u5b58\u50a8\u5728\u65b9\u6cd5\u533a\uff08\u5143\u7a7a\u95f4\uff09\uff0c\u88ab\u5bf9\u8c61\u5934\u4e2d\u7684\u7c7b\u578b\u6307\u9488\u6240\u6307\u5411\uff1b\u5bf9\u8c61\u7684\u5f15\u7528\u5b58\u50a8\u5728\u865a\u62df\u673a\u6808 </p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_3","title":"\u5806\u5185\u5b58\u4e2d\u7684\u5bf9\u8c61\u7531\u54ea\u4e9b\u90e8\u5206\u7ec4\u6210\uff1f","text":"<p>\u5bf9\u8c61\u5934\uff08MarkWord \u548c \u7c7b\u578b\u6307\u9488\uff0c\u5982\u4e0b\u56fe\uff09\u3001\u5b9e\u4f8b\u6570\u636e\u3001\u5bf9\u9f50\u586b\u5145</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#markword","title":"markword\u5305\u542b\u54ea\u4e9b\u4fe1\u606f\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/JVM/#_4","title":"\u5bf9\u8c61\u5206\u914d\u7684\u8fc7\u7a0b\uff1f\u2b50","text":"<p>1.\u5b57\u8282\u7801\u6307\u4ee4new\u4f1a\u9996\u5148\u68c0\u67e5\u7b26\u53f7\u5f15\u7528\u6240\u4ee3\u8868\u7684\u7c7b\u662f\u5426\u5b8c\u6210\u4e86\u7c7b\u52a0\u8f7d\u8fc7\u7a0b</p> <p>2.\u7136\u540e\u4f1a\u4e3a\u5bf9\u8c61\u5206\u914d\u5185\u5b58\u7a7a\u95f4 \u5206\u914d\u2f45\u5f0f\u6709 \u201c\u6307\u9488\u78b0\u649e\u201d \u548c \u201c\u7a7a\u95f2\u5217\u8868\u201c \u4e24\u79cd\uff0c\u9009\u62e9\u54ea\u79cd\u5206\u914d\u65b9\u5f0f\u7531 Java \u5806\u662f\u5426\u89c4\u6574\u51b3\u5b9a\uff0c\u2f7d Java\u5806\u662f\u5426\u89c4\u6574\u2f1c\u7531\u6240\u91c7\u2f64\u7684\u5783\u573e\u6536\u96c6\u5668\u662f\u5426\u5e26\u6709\u538b\u7f29\u6574\u7406\u529f\u80fd\u51b3\u5b9a\u3002</p> <p>3.\u521d\u59cb\u5316\u4e3a\u96f6\u503c</p> <p>4.\u8bbe\u7f6e\u5bf9\u8c61\u5934\u4fe1\u606f</p> <p>5.\u6267\u884c<code>&lt;init&gt;()</code>\u65b9\u6cd5</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_5","title":"\u5bf9\u8c61\u7684\u8bbf\u95ee\u5b9a\u4f4d\u6709\u54ea\u4e24\u79cd\u65b9\u5f0f\uff1f","text":"<p>\u2460\u53e5\u67c4\uff08\u5305\u542b\u6307\u5411\u5b9e\u4f8b\u5bf9\u8c61\u7684\u6307\u9488 \u548c \u6307\u5411\u7c7b\u578b\u6570\u636e\u7684\u6307\u9488\uff09</p> <p>\u2461\u76f4\u63a5\u6307\u9488\uff08\u76f4\u63a5\u6307\u5411\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u7c7b\u578b\u6307\u9488\u5728\u5b9e\u4f8b\u5bf9\u8c61\u4e2d\uff09</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_6","title":"\u9003\u9038\u5206\u6790\u3001\u6808\u4e0a\u5206\u914d\u3001\u6807\u91cf\u66ff\u6362\uff1f","text":"<p>\u9003\u9038\u5206\u6790\uff1a\u5c31\u662f\u770b\u4e00\u4e2a\u5bf9\u8c61\u80fd\u5426\u88ab\u5176\u4ed6\u65b9\u6cd5\u6216\u7ebf\u7a0b\u8bbf\u95ee\u5230\u3002</p> <p>\u5982\u679c\u80fd\u8bc1\u660e\u4e00\u4e2a\u5bf9\u8c61\u4e0d\u4f1a\u9003\u9038\u5230\u65b9\u6cd5\u6216\u7ebf\u7a0b\u5916\uff08\u5373\u522b\u7684\u65b9\u6cd5\u6216\u7ebf\u7a0b\u65e0\u6cd5\u901a\u8fc7\u4efb\u4f55\u9014\u5f84\u8bbf\u95ee\u5230\u8be5\u5bf9\u8c61\uff09\uff0c\u6216\u9003\u9038\u7a0b\u5ea6\u8f83\u4f4e\uff08\u53ea\u9003\u9038\u51fa\u65b9\u6cd5\u800c\u4e0d\u9003\u9038\u51fa\u7ebf\u7a0b\uff09\uff0c\u5219\u53ef\u80fd\u4e3a\u8fd9\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\u91c7\u53d6\u4e0d\u540c\u7a0b\u5ea6\u7684\u4f18\u5316\uff1a</p> <p>\u6808\u4e0a\u5206\u914d\uff1a\u5982\u679c\u786e\u5b9a\u4e00\u4e2a\u5bf9\u8c61\u4e0d\u4f1a\u9003\u9038\u51fa\u7ebf\u7a0b\uff0c\u90a3\u8ba9\u8be5\u5bf9\u8c61\u5728\u6808\u4e0a\u5206\u914d\u5185\u5b58\u662f\u4e2a\u4e0d\u9519\u4e3b\u610f\uff0c\u5bf9\u8c61\u6240\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u5c31\u53ef\u968f\u6808\u5e27\u51fa\u6808\u800c\u9500\u6bc1\uff0c\u51cf\u5c11GC\u538b\u529b\u3002\u6808\u4e0a\u5206\u914d\u53ef\u652f\u6301\u65b9\u6cd5\u9003\u9038\uff0c\u4f46\u4e0d\u80fd\u652f\u6301\u7ebf\u7a0b\u9003\u9038\u3002</p> <p>\u6807\u91cf\u66ff\u6362\uff1a\u5047\u5982\u9003\u9038\u5206\u6790\u80fd\u591f\u8bc1\u660e\u4e00\u4e2a\u5bf9\u8c61\u4e0d\u4f1a\u5728\u65b9\u6cd5\u5916\u90e8\u88ab\u8bbf\u95ee\uff0c\u5e76\u4e14\u8be5\u5bf9\u8c61\u53ef\u88ab\u5206\u89e3\uff0c\u90a3\u4e48\u7a0b\u5e8f\u771f\u6b63\u6267\u884c\u65f6\u5c06\u53ef\u80fd\u4e0d\u53bb\u521b\u5efa\u8be5\u5bf9\u8c61\uff0c\u800c\u6539\u4e3a\u76f4\u63a5\u521b\u5efa\u5b83\u7684\u82e5\u5e72\u4e2a\u88ab\u8fd9\u65b9\u6cd5\u4f7f\u7528\u7684\u6210\u5458\u53d8\u91cf\u4ee3\u66ff\u3002\u5c06\u5bf9\u8c61\u62c6\u5206\u540e\uff0c\u9664\u53ef\u8ba9\u5bf9\u8c61\u7684\u6210\u5458\u53d8\u91cf\u5728\u6808\u4e0a \uff08\u6808\u4e0a\u5b58\u50a8\u7684\u6570\u636e\uff0c\u5f88\u5927\u673a\u4f1a\u88ab\u865a\u62df\u673a\u5206\u914d\u81f3\u7269\u7406\u673a\u5668\u7684\u9ad8\u901f\u5bc4\u5b58\u5668\u4e2d\u5b58\u50a8\uff09\u5206\u914d\u548c\u8bfb\u5199\u5916\uff0c\u8fd8\u53ef\u4e3a\u540e\u7eed\u8fdb\u6b65\u4f18\u5316\u521b\u5efa\u6761\u4ef6\u3002\u6807\u91cf\u66ff\u6362\u53ef\u89c6\u4f5c\u6808\u4e0a\u5206\u914d\u4e00\u79cd\u7279\u4f8b\uff0c\u5b9e\u73b0\u66f4\u7b80\u5355\uff08\u4e0d\u7528\u8003\u8651\u5bf9\u8c61\u5b8c\u6574\u7ed3\u6784\u7684\u5206\u914d\uff09\uff0c\u4f46\u5bf9\u9003\u9038\u7a0b\u5ea6\u7684\u8981\u6c42\u66f4\u9ad8\uff0c\u5b83\u4e0d\u5141\u8bb8\u5bf9\u8c61\u9003\u9038\u51fa\u65b9\u6cd5\u8303\u56f4\u5185\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_7","title":"\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b\u7684\u4e24\u79cd\u65b9\u6cd5\uff1f\u2b50","text":"<p>\u2460\u5f15\u7528\u8ba1\u6570\u7b97\u6cd5 \u4e00\u4e2a\u5bf9\u8c61\u88ab\u5f15\u75281\u6b21\u5219\u8ba1\u6570\u52a01\uff0c\u5f53\u5f15\u7528\u5931\u6548\u65f6\u8ba1\u6570-1\uff0c\u90a3\u4e9b\u8ba1\u6570\u4e3a0\u7684\u5bf9\u8c61\u5c31\u4ee3\u8868\u6ca1\u6709\u4efb\u4f55\u5f15\u7528\uff0c\u53ef\u4ee5\u6267\u884c\u56de\u6536\uff1b\u65e0\u6cd5\u89e3\u51b3\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\u3002 \u2461\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5 \u4eceGC Roots\u4e2d\u7684\u6839\u5bf9\u8c61\u4f5c\u4e3a\u8d77\u59cb\u8282\u70b9\uff0c\u6839\u636e\u5f15\u7528\u5173\u7cfb\u5411\u641c\u7d22\uff0c\u6240\u8d70\u8fc7\u7684\u8def\u5f84\u79f0\u4e3a\u201c\u5f15\u7528\u94fe\u201d\uff0c\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u6ca1\u6709\u4e0e\u4efb\u4f55\u5f15\u7528\u94fe\u76f8\u8fde\uff0c\u5219\u5c06\u88ab\u5224\u5b9a\u4e3a\u5783\u573e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#gc_roots","title":"\u54ea\u4e9b\u80fd\u4f5c\u4e3aGC roots\uff1f","text":"<ol> <li> <p>\u6808\u4e0a\u7684\u5c40\u90e8\u53d8\u91cf\u8868</p> </li> <li> <p>\u65b9\u6cd5\u533a\u4e2d\u7684\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60</p> </li> <li> <p>\u5806\u4e0a\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60</p> </li> <li> <p>\u5806\u4e0aclass\u5bf9\u8c61\u4e2d\u7684\u9759\u6001\u53d8\u91cf</p> </li> <li> <p>...</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#java","title":"Java \u4e2d\u90fd\u6709\u54ea\u4e9b\u5f15\u7528\u7c7b\u578b\uff1f\u2b50","text":"<p>\u5f3a\u5f15\u7528\u3001\u8f6f\u5f15\u7528\u3001\u5f31\u5f15\u7528\u3001\u865a\u5f15\u7528 \u2460\u5f3a\u5f15\u7528\uff1a\u6211\u4eecnew\u65b9\u5f0f\u521b\u5efa\u7684\u5bf9\u8c61\u5c31\u662f\u5f3a\u5f15\u7528\u7c7b\u578b\u7684\uff0c\u53ea\u8981\u5f3a\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u53ef\u89e6\u53ca\u7684\uff0c\u5219\u5783\u573e\u6536\u96c6\u5668\u6c38\u8fdc\u4e0d\u4f1a\u6267\u884c\u56de\u6536 \u2461\u8f6f\u5f15\u7528\uff1a\u5185\u5b58\u5145\u8db3\u65f6\u5019\u4e0d\u4f1a\u56de\u6536\uff0c\u53ea\u6709\u5728\u5185\u5b58\u6ea2\u51fa\u524d\u624d\u8fdb\u884c\u56de\u6536\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u7f13\u5b58\uff0c\u5c06\u4e34\u65f6\u7684\u6570\u636e\u5b58\u50a8\u4e0b\u6765\uff0c\u5373\u4f7f\u6ca1\u6709\u5185\u5b58\u4e86\uff0c\u5783\u573e\u6536\u96c6\u5668\u4e5f\u80fd\u5c06\u5176\u56de\u6536\u3002java\u63d0\u4f9b\u4e86SoftReference\u6765\u5b9e\u73b0\u8f6f\u5f15\u7528\uff0c\u5728\u56de\u6536\u8f6f\u5f15\u7528\u65f6\uff0c\u53ef\u4ee5\u5c06\u5f15\u7528\u653e\u5230\u8fd9\u4e2aReferenceQueue\u5f15\u7528\u961f\u5217\u4e2d\uff0c\u53ef\u4ee5\u83b7\u53d6\u5230\u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u8fdb\u884c\u989d\u5916\u7684\u5904\u7406\u3002 \u2462\u5f31\u5f15\u7528\uff1a\u53ea\u8981\u53d1\u751f\u4e86GC\uff0c\u90a3\u4e48\u5f31\u5f15\u7528\u76f4\u63a5\u88ab\u56de\u6536\u3002\u4e5f\u80fd\u5b9e\u73b0\u7f13\u5b58\u529f\u80fd\uff0c\u56e0\u4e3a\u4e00\u65e6GC\u5c31\u4f1a\u56de\u6536\uff0c\u4e0d\u4f1a\u8ba9\u7cfb\u7edf\u6709\u8fc7\u591a\u7684\u5185\u5b58\u538b\u529b\u3002java\u63d0\u4f9b\u4e86WeakReference\u6765\u5b9e\u73b0\u5f31\u5f15\u7528\uff0c\u4e0e\u8f6f\u5f15\u7528\u4e00\u6837\uff0c\u5728\u56de\u6536\u65f6\u53ef\u4ee5\u5c06\u5f31\u5f15\u7528\u653e\u8fdb\u4e00\u4e2a\u5f15\u7528\u961f\u5217\uff0c\u53ef\u4ee5\u83b7\u53d6\u5230\u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u8ddf\u8e2a\u56de\u6536\u60c5\u51b5\u3002ThreadLocal\u7c7b\u7684\u9759\u6001\u5185\u90e8\u7c7bThreadLocalMap\u7684key\u5c31\u662fWeakReference\u3002 \u2463\u865a\u5f15\u7528\uff1a\u7528\u4e8e\u5bf9\u8c61\u56de\u6536\u8ddf\u8e2a\uff0c\u662f\u5f15\u7528\u7c7b\u578b\u4e2d\u6700\u5f31\u7684\u4e00\u4e2a\u3002\u865a\u5f15\u7528\u4e0d\u80fd\u50cf\u5f3a\u8f6f\u5f31\u4e00\u6837\u5355\u72ec\u4f7f\u7528\uff0c\u8981\u914d\u5408\u5f15\u7528\u961f\u5217\u8fdb\u884c\u4f7f\u7528\uff0c\u4e5f\u65e0\u6cd5\u901a\u8fc7\u865a\u5f15\u7528\u6765\u83b7\u53d6\u88ab\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u5f53\u4f7f\u7528get()\u65b9\u6cd5\u65f6\uff0c\u603b\u4f1a\u8fd4\u56denull\u3002\u865a\u5f15\u7528\u7684\u4f5c\u7528\u5c31\u662f\u80fd\u5728\u8fd9\u4e2a\u5bf9\u8c61\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u65f6\u6536\u5230\u4e00\u4e2a\u7cfb\u7edf\u901a\u77e5\uff0c\u5e76\u4e14\u80fd\u8ddf\u8e2a\u5bf9\u8c61\u7684\u56de\u6536\u65f6\u95f4\u3002java\u63d0\u4f9b\u4e86PhantomReference\u6765\u5b9e\u73b0\u865a\u5f15\u7528\uff0c\u4e0d\u8fc7\u5728\u521b\u5efa\u5f15\u7528\u65f6\uff0c\u9700\u8981\u6307\u5b9a\u5f15\u7528\u961f\u5217ReferenceQueue\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#gcgc","title":"\u4e3a\u4ec0\u4e48\u8981\u6709GC\uff1fGC\u539f\u7406\u662f\u4ec0\u4e48\uff1f\u4ec0\u4e48\u60c5\u51b5\u4e0b\u89e6\u53d1\u5783\u573e\u56de\u6536\uff1f","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u6709GC\uff1a\u56e0\u4e3a\u7a0b\u5e8f\u4e0d\u65ad\u8fd0\u884c\uff0c\u4e0d\u65ad\u6709\u65b0\u7684\u5bf9\u8c61\u4ea7\u751f\uff0c\u4e3a\u4e86\u907f\u514d\u65e0\u7528\u5bf9\u8c61\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u5bfc\u81f4\u5185\u5b58\u4e0d\u8db3\uff0c\u56e0\u6b64\u8981\u8fdb\u884c\u56de\u6536 \u3002</p> <p>GC\u539f\u7406\uff1a\u5229\u7528\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u5224\u5b9a\u5bf9\u8c61\u7684\u6b7b\u6d3b\uff0c\u7136\u540e\u5229\u7528\u5783\u573e\u56de\u6536\u7b97\u6cd5\u8fdb\u884c\u6e05\u9664\uff0c\u6bd4\u5982\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\u3001\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\u548c\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p>\u4ec0\u4e48\u60c5\u51b5\u4e0b\u89e6\u53d1\u5783\u573e\u56de\u6536\uff1a\u5f53\u65b0\u751f\u4ee3\u6ee1\u65f6\u89e6\u53d1Young GC\uff08\u51c6\u786e\u7684\u8bf4\u662fEden\u6ee1\u7684\u65f6\u5019\uff09\uff0c\u5f53\u8001\u5e74\u4ee3\u6ee1\u65f6\u89e6\u53d1Full GC/Major GC\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_8","title":"\u6709\u54ea\u51e0\u79cd\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff0c\u5b83\u4eec\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f\u2b50","text":"<p>\u6709\u4e09\u79cd\u5783\u573e\u56de\u6536\u7b97\u6cd5\uff1a\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\u3001\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\u548c\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p>\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\uff1a\u4f18\u70b9\u5c31\u662f\u7b80\u5355\uff0c\u4e0d\u7528\u590d\u5236\uff1b\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u4e00\u662f\u6267\u884c\u6548\u7387\u4e0d\u591f\u7a33\u5b9a\uff0c\u6807\u8bb0\u548c\u6e05\u9664\u8fc7\u7a0b\u7684\u6267\u884c\u6548\u7387\u968f\u5bf9\u8c61\u6570\u91cf\u7684\u589e\u52a0\u800c\u964d\u4f4e\uff0c\u4e8c\u662f\u4ea7\u751f\u5927\u91cf\u4e0d\u8fde\u7eed\u7684\u788e\u7247\u3002 \u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff1a\u4f18\u70b9\u5c31\u662f\u4e0d\u4f1a\u4ea7\u751f\u5927\u91cf\u788e\u7247\uff1b\u7f3a\u70b9\u662f\u4e00\u662f\u5f88\u5927\u7684\u5185\u5b58\u590d\u5236\u5f00\u9500\uff0c\u4e8c\u662f\u5982\u679c\u6807\u8bb0\u590d\u5236\u7b97\u6cd5\u4e0d\u7ed3\u5408\u5206\u4ee3\u6536\u96c6\u7406\u8bba\u7684\u8bdd\uff0c\u662f\u9700\u8981\u5c06\u53ef\u7528\u5185\u5b58\u7f29\u5c0f\u4e3a\u539f\u6765\u7684\u4e00\u534a\uff0c\u6709\u70b9\u6d6a\u8d39\u7a7a\u95f4\u3002 \u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\uff1a\u6807\u8bb0\u6574\u7406\u662f\u5728\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5\u7684\u57fa\u7840\u4e4b\u4e0a\u589e\u52a0\u4e00\u4e2a\u6574\u7406\u5185\u5b58\u7684\u8fc7\u7a0b\uff0c\u4f18\u70b9\u662f\u4e0d\u4ea7\u751f\u788e\u7247\uff0c\u7f3a\u70b9\u662f\u590d\u5236\u79fb\u52a8\u5bf9\u8c61\u590d\u6742\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_9","title":"\u4ec0\u4e48\u662f\u5206\u4ee3\u56de\u6536\uff1f","text":"<p>\u5206\u4ee3\u56de\u6536\u5efa\u7acb\u5728\u5206\u4ee3\u5047\u8bf4\u4e4b\u4e0a\uff0c\u4e5f\u5c31\u662f\u7edd\u5927\u591a\u6570\u5bf9\u8c61\u90fd\u662f\u671d\u751f\u5915\u706d\u7684\uff0c\u71ac\u8fc7\u591a\u6b21\u5783\u573e\u6536\u96c6\u8fc7\u7a0b\u7684\u5bf9\u8c61\u96be\u4ee5\u6d88\u4ea1\u3002\u6839\u636e\u8fd9\u4e2a\u5047\u8bf4\uff0c\u5c06\u5185\u5b58\u5206\u4e3a\u4e0d\u540c\u7684\u533a\u57df\uff0c\u6bd4\u5982\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u5bf9\u4e0d\u540c\u7684\u533a\u57df\u91c7\u53d6\u4e0d\u540c\u7684\u56de\u6536\u65b9\u5f0f\u4ee5\u63d0\u9ad8\u56de\u6536\u6548\u7387\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jvm_1","title":"\u7b80\u8ff0\u5206\u4ee3\u5783\u573e\u56de\u6536\u5668\u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1fJVM\u600e\u4e48\u56de\u6536\u5185\u5b58\uff1f\u2b50","text":"<p>\uff08\u57fa\u4e8e\u5206\u4ee3\u56de\u6536\u7684\u601d\u60f3\u5bf9\u5185\u5b58\u8fdb\u884c\u5212\u5206\uff0c\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u5224\u5b9a\u5bf9\u8c61\u7684\u6b7b\u6d3b\uff0c\u6700\u540e\u518d\u5229\u7528\u5783\u573e\u56de\u6536\u7b97\u6cd5\u8fdb\u884c\u6e05\u9664\uff09</p> <p>\u4e00\u822c\u5206\u4e3a\u4e24\u4e2a\u5206\u4ee3\uff0c\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\uff0c\u9ed8\u8ba4\u5360\u6bd4\u4e3a1:2\u3002\u65b0\u751f\u4ee3\u67093\u4e2a\u5206\u533a\uff0c\u4e00\u4e2aEden\u533a\uff0c\u4e24\u4e2aSurvivor\u533a\uff0c\u4e24\u4e2aSurvivor\u533a\u53c8\u5206\u522b\u79f0\u4e3aFrom\u533a\u548cTo\u533a\uff0c\u4e09\u4e2a\u5206\u533a\u9ed8\u8ba4\u7684\u6bd4\u4f8b\u662f8:1:1\u3002\u65b0\u751f\u4ee3\u91c7\u7528\u7684\u662f\u590d\u5236\u7b97\u6cd5\uff0c\u800c\u8001\u5e74\u4ee3\u91c7\u7528\u7684\u662f\u6807\u8bb0\u6574\u7406\u6216\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5\u3002\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u4f1a\u5148\u653e\u5230Eden\u533a\u4e2d\uff0c\u5f53Eden\u533a\u6ee1\u65f6\uff0c\u4f1a\u89e6\u53d1YoungGC\uff0c\u5bf9Eden\u533a\u548cFrom\u533a\u8fdb\u884c\u5783\u573e\u56de\u6536\uff0c\u5b58\u6d3b\u7684\u5bf9\u8c61\u653e\u8fdbTo\u533a\u4e2d\uff0c\u5e76\u4e14\u5e74\u9f84\u8ba1\u6570+1\uff0c\u82e5\u5e74\u9f84\u8ba1\u6570\u5668\u4e3a15\uff0c\u5c31\u664b\u5347\u5230\u8001\u5e74\u4ee3\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_10","title":"\u5bf9\u8c61\u4f55\u65f6\u8fdb\u5165\u5230\u8001\u5e74\u4ee3\uff1f\u2b50","text":"<ol> <li> <p>\u957f\u671f\u5b58\u6d3b\u7684\u5bf9\u8c61\u5c06\u4f1a\u8fdb\u5165\u8001\u5e74\u4ee3\u3002\u65b0\u751f\u4ee3\u4e2d\u7684\u5bf9\u8c61\u7684\u5e74\u9f84\u5230\u8fbe\u8bbe\u7f6e\u7684\u9608\u503c\u5c06\u4f1a\u8fdb\u5165\u8001\u5e74\u4ee3\uff0c\u9ed8\u8ba4\u662f15\uff0c\u4e5f\u53ef\u901a\u8fc7-XX:MaxTenuringThreshold\u8bbe\u7f6e\uff1b</p> </li> <li> <p>\u6216\u8005\u52a8\u6001\u5bf9\u8c61\u5e74\u9f84\u5224\u5b9a\uff0c\u5f53Survivor\u533a\u4e2d\u76f8\u540c\u5e74\u9f84\u7684\u6240\u6709\u5bf9\u8c61\u7684\u603b\u548c\u5927\u4e8eSurvivor\u533a\u7684\u4e00\u534a\u65f6\uff0c\u5927\u4e8e\u7b49\u4e8e\u8be5\u5e74\u9f84\u7684\u5bf9\u8c61\u5c06\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3\uff0c\u65e0\u9700\u8fbe\u5230\u8981\u6c42\u7684\u9608\u503c\u3002</p> </li> <li> <p>\u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u907f\u514d\u5728Eden\u533a\u53ca\u4e24\u4e2aSurvivor\u533a\u4e4b\u95f4\u6765\u56de\u590d\u5236\uff0c\u4ea7\u751f\u5927\u91cf\u7684\u590d\u5236\u5f00\u9500\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#minor_gcyoung_gcmajor_gcold_gcmixed_gcfull_gc","title":"Minor GC/Young GC\u3001Major GC/Old GC\u3001Mixed GC\u3001Full GC \uff1f\u2b50","text":"<p>\u4e66\u672c\u4e0a\u7684\u5b9a\u4e49\uff1a Minor GC/Young GC\uff1a\u65b0\u751f\u4ee3\u7684\u5783\u573e\u6536\u96c6\u3002 Major GC/Old GC\uff1a\u8001\u5e74\u4ee3\u7684\u5783\u573e\u6536\u96c6\uff0c\u76ee\u524d\u53ea\u6709CMS\u4f1a\u5355\u72ec\u6536\u96c6\u8001\u5e74\u4ee3\u3002 Mixed GC\uff1a\u6574\u4e2a\u65b0\u751f\u4ee3\u4ee5\u53ca\u90e8\u5206\u8001\u5e74\u4ee3\u7684\u5783\u573e\u6536\u96c6\uff0c\u76ee\u524d\u53ea\u6709G1\u6536\u96c6\u5668\u4f1a\u6709\u8fd9\u79cd\u884c\u4e3a\u3002 Full GC\uff1a\u5806\u548c\u65b9\u6cd5\u533a\u7684\u5783\u573e\u6536\u96c6\u3002</p> <p>\u4f46\u662f\uff0c\u597d\u50cf\u4e00\u822c\u53ea\u6709Young GC\u548cFull GC\u4e24\u79cd\uff0c\u89e6\u53d1Young GC\u548cFull GC\u7684\u6761\u4ef6\u89c1\u4e0b\u4e00\u4e2a\u95ee\u9898\u7684\u56fe\u793a\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#gc","title":"\u4ec0\u4e48\u65f6\u5019\u4f1a\u89e6\u53d1GC\uff08\u5305\u542b\u6709\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\u539f\u5219\uff09\uff1f\u2b50","text":"<p>\u5f53Eden\u533a\u6ee1\u7684\u65f6\u5019\u4f1a\u89e6\u53d1Young GC\uff0c\u5728Young GC\u4e4b\u524d\u4f1a\u68c0\u67e5\u8001\u5e74\u4ee3\u7684\u53ef\u7528\u7a7a\u95f4\u662f\u5426\u5927\u4e8e\u65b0\u751f\u4ee3\u5b58\u6d3b\u5bf9\u8c61\u7684\u603b\u5927\u5c0f\uff0c\u5982\u679c\u5927\u4e8e\u4ee3\u8868\u6b64\u6b21Young GC\u6ca1\u6709\u98ce\u9669\u76f4\u63a5\u6267\u884cYoung GC\uff0c\u4f46\u5982\u679c\u5c0f\u4e8e\u5219\u8868\u793a\u6709\u98ce\u9669\uff0c\u90a3\u4e48\u5c31\u8981\u68c0\u67e5\u662f\u5426\u5f00\u542f\u4e86\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\u3002\u5982\u679c\u6ca1\u6709\u5f00\u542f\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\uff0c\u90a3\u4e48\u76f4\u63a5\u8fdb\u884cFull GC\uff1b\u5982\u679c\u5f00\u542f\u4e86\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u68c0\u67e5\u8001\u5e74\u4ee3\u53ef\u7528\u7a7a\u95f4\u662f\u5426\u5927\u4e8e\u5386\u6b21\u664b\u5347\u5230\u8001\u5e74\u4ee3\u5bf9\u8c61\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u5982\u679c\u4e0d\u5927\u4e8e\u90a3\u5c31Full GC\uff0c\u5982\u679c\u5927\u4e8e\u5c31\u4f1a\u5148\u5c1d\u8bd5\u8fdb\u884c\u4e00\u6b21Young GC\uff0cYoung GC\u5b8c\u4e4b\u540e\u5982\u679c\u5b58\u6d3b\u7684\u5bf9\u8c61\u53ef\u4ee5\u653e\u8fdbSurvivor\u533a\uff0c\u90a3\u4e48\u76f4\u63a5\u653e\u8fdbSurvivor\u533a\uff0c\u5982\u679c\u653e\u4e0d\u4e0b\uff0c\u5c31\u770b\u4e00\u4e0b\u8001\u5e74\u4ee3\u7684\u53ef\u7528\u7a7a\u95f4\u662f\u5426\u653e\u7684\u4e0b\uff0c\u653e\u5f97\u4e0b\u5c31\u653e\uff0c\u653e\u4e0d\u4e0b\u5c31\u9700\u8981\u518d\u8fdb\u884c\u4e00\u6b21Full GC\uff0c\u6bcf\u6b21Full GC\u5b8c\u4e4b\u540e\u5982\u679c\u8001\u5e74\u4ee3\u8fd8\u653e\u4e0d\u4e0b\u5b58\u6d3b\u7684\u5bf9\u8c61\uff0c\u90a3\u5c31\u62a5OOM\u4e86\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#cmsg1","title":"\u8bf4\u4e00\u4e0b\u4f60\u77e5\u9053\u7684\u5783\u573e\u56de\u6536\u5668\uff0c\u91cd\u70b9\u8bb2\u4e00\u4e0bCMS\u548cG1\u548c\u5404\u81ea\u7684\u7279\u70b9\u3002\u2b50","text":"<p>Serial/Serial Old\uff1a\u90fd\u662f\u4e32\u884c\u56de\u6536\uff0c\u7b80\u5355\u9ad8\u6548\uff0c\u53ea\u9002\u5408\u5355\u6838CPU\uff1bSerial\u662f\u65b0\u751f\u4ee3\u6536\u96c6\u5668\uff0c\u57fa\u4e8e\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0cSerial Old\u662f\u8001\u5e74\u4ee3\u6536\u96c6\u5668\uff0c\u57fa\u4e8e\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p>Parallel Scavenge/Parallel Old\uff1a\u90fd\u662f\u591a\u6761GC\u7ebf\u7a0b\u5e76\u884c\u6267\u884c\uff0c\u5e76\u975e\u4e0e\u7528\u6237\u7ebf\u7a0b\u5e76\u53d1\uff0c\u6240\u4ee5\u5783\u573e\u6536\u96c6\u65f6\u4ecd\u662fSTW\uff1bParallel Scavenge\u662f\u65b0\u751f\u4ee3\u6536\u96c6\u5668\uff0c\u57fa\u4e8e\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0c\u7279\u70b9\u662f\u53ef\u63a7\u5236\u7684\u541e\u5410\u91cf\u548c\u81ea\u9002\u5e94\u8c03\u8282\uff1bParallel Old\u8001\u5e74\u4ee3\u6536\u96c6\u5668\uff0c\u57fa\u4e8e\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\u3002</p> <p>ParNew\uff1a\u65b0\u751f\u4ee3\u6536\u96c6\u5668\uff0c\u57fa\u4e8e\u6807\u8bb0-\u590d\u5236\u7b97\u6cd5\uff0cSerial\u7684\u591a\u7ebf\u7a0b\u7248\u672c\uff0c\u591a\u6761GC\u7ebf\u7a0b\u5e76\u884c\u6267\u884c\u3002</p> <p>CMS\uff1a\u8001\u5e74\u4ee3\u6536\u96c6\u5668\uff0c\u57fa\u4e8e\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\uff0c\u76ee\u6807\u662f\u6700\u77ed\u56de\u6536\u505c\u987f\u65f6\u95f4\uff0c\u80fd\u591f\u5b9e\u73b0\u7528\u6237\u7ebf\u7a0b\u4e0eGC\u7ebf\u7a0b\u540c\u65f6\u8fd0\u884c\uff0c\u6574\u4e2a\u6e05\u7406\u8fc7\u7a0b\u5206\u4e3a\u56db\u6b65\uff1a     \u2460 \u521d\u59cb\u6807\u8bb0\uff08\u4f1aSTW\uff09\uff1a\u4ec5\u4ec5\u6807\u8bb0\u5904GC Roots\u80fd\u76f4\u63a5\u5173\u8054\u5230\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u65f6\u5019\u662fSTW\u7684\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u5c0f\u90e8\u5206\u7684GC Roots\u4f1a\u88ab\u6807\u8bb0\uff0c\u56e0\u6b64\u505c\u987f\u662f\u975e\u5e38\u77ed\u6682\u7684\u3002     \u2461 \u5e76\u53d1\u6807\u8bb0\uff1a\u4eceGC Roots\u5f00\u59cb\u904d\u5386\u6574\u4e2a\u5bf9\u8c61\u5f15\u7528\u94fe\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5e76\u53d1\u7684\uff0c\u4e0e\u7528\u6237\u7ebf\u7a0b\u540c\u65f6\u8fdb\u884c\uff0c\u4e0d\u4f1aSTW\u3002     \u2462 \u91cd\u65b0\u6807\u8bb0\uff08\u4f1aSTW\uff09\uff1a\u5bf9\u5728\u5e76\u53d1\u6807\u8bb0\u671f\u95f4\u56e0\u7528\u6237\u7a0b\u5e8f\u7ee7\u7eed\u8fd0\u4f5c\u800c\u5bfc\u81f4\u6807\u8bb0\u4ea7\u751f\u53d8\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u5bf9\u8c61\u8fdb\u884c\u91cd\u65b0\u6807\u8bb0\u3002\u6b64\u8fc7\u7a0b\u662fSTW\u7684\uff0c\u4f46\u56e0\u4e3a\u8fd9\u4e9b\u5bf9\u8c61\u5360\u5c11\u6570\uff0c\u6240\u4ee5\u4e0d\u4f1a\u505c\u987f\u8fc7\u957f\u65f6\u95f4\u3002     \u2463 \u5e76\u53d1\u6e05\u7406\uff1a\u6e05\u7406\u6807\u8bb0\u9636\u6bb5\u672a\u88ab\u6807\u8bb0\u7684\u5bf9\u8c61\uff0c\u91ca\u653e\u5185\u5b58\u7a7a\u95f4\uff0c\u6b64\u8fc7\u7a0b\u662f\u5e76\u53d1\u7684\uff0c\u53ef\u4ee5\u548c\u7528\u6237\u7ebf\u7a0b\u4e00\u8d77\u8fd0\u4f5c\u3002 \u56e0\u4e3a\u6700\u8017\u8d39\u65f6\u95f4\u7684\u5e76\u53d1\u6e05\u9664\u548c\u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\u662f\u5e76\u53d1\u7684\uff0c\u4e0d\u9700\u8981\u6682\u505c\u5de5\u4f5c\uff0c\u6240\u4ee5\u6574\u4f53\u7684\u56de\u6536\u8fd8\u662f\u4f4e\u5ef6\u8fdf\u7684\u3002\u800c\u521d\u59cb\u6807\u8bb0\u548c\u91cd\u65b0\u6807\u8bb0\u4ecd\u7136\u9700\u8981\u6682\u505c\u7528\u6237\u7ebf\u7a0b\uff0c\u6240\u4ee5CMS\u4ecd\u7136\u4f1a\u6709STW\u3002CMS\u65e0\u6cd5\u6536\u96c6\u6d6e\u52a8\u5783\u573e\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u5e76\u53d1\u6536\u96c6\u5931\u8d25\uff0c\u4ece\u800c\u5bfc\u81f4FULL GC\u3002\u56e0\u4e3a\u4f7f\u7528\u7684\u662f\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u5bfc\u81f4\u51fa\u73b0\u65e0\u6cd5\u4e3a\u65b0\u5bf9\u8c61\u5206\u914d\u5185\u5b58\uff0c\u8fd9\u65f6\u4e5f\u4f1a\u51fa\u73b0\u5e76\u53d1\u5931\u8d25\uff0c\u4ece\u800c\u4e34\u65f6\u542f\u7528Serial Old\u8fdb\u884c\u4e00\u6b21\u8001\u5e74\u4ee3\u7684\u6536\u96c6\u3002</p> <p>G1\uff1aG1\uff08Garbage First\uff09\u56de\u6536\u5668\u91c7\u7528\u9762\u5411\u5c40\u90e8\u6536\u96c6\u7684\u8bbe\u8ba1\u601d\u8def\u548c\u57fa\u4e8eRegion\u7684\u5185\u5b58\u5e03\u5c40\u5f62\u5f0f\uff0c\u662f\u4e00\u6b3e\u4e3b\u8981\u9762\u5411\u670d\u52a1\u7aef\u5e94\u7528\u7684\u5783\u573e\u56de\u6536\u5668\u3002G1\u8bbe\u8ba1\u521d\u8877\u5c31\u662f\u66ff\u6362 CMS\uff0c\u6210\u4e3a\u4e00\u79cd\u5168\u529f\u80fd\u6536\u96c6\u5668\u3002G1 \u5728JDK9 \u4e4b\u540e\u6210\u4e3a\u670d\u52a1\u7aef\u6a21\u5f0f\u4e0b\u7684\u9ed8\u8ba4\u5783\u573e\u56de\u6536\u5668\uff0c\u53d6\u4ee3\u4e86 Parallel Scavenge \u52a0 Parallel Old \u7684\u9ed8\u8ba4\u7ec4\u5408\uff0c\u800c CMS \u88ab\u58f0\u660e\u4e3a\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\u5783\u573e\u56de\u6536\u5668\u3002G1\u4ece\u6574\u4f53\u6765\u770b\u662f\u57fa\u4e8e \u6807\u8bb0-\u6574\u7406 \u7b97\u6cd5\u5b9e\u73b0\u7684\u56de\u6536\u5668\uff0c\u4f46\u4ece\u5c40\u90e8\uff08\u4e24\u4e2aRegion\u4e4b\u95f4\uff09\u4e0a\u770b\u53c8\u662f\u57fa\u4e8e \u6807\u8bb0-\u590d\u5236 \u7b97\u6cd5\u5b9e\u73b0\u7684\u3002</p> <p>G1\u628a\u8fde\u7eed\u7684Java\u5806\u5212\u5206\u4e3a\u8bb8\u591a\u5927\u5c0f\u76f8\u7b49\u7684\u72ec\u7acb\u533a\u57dfRegion\uff0c\u6bcf\u4e00\u4e2aRegion\u90fd\u53ef\u4ee5\u6839\u636e\u9700\u8981\u626e\u6f14\u65b0\u751f\u4ee3\u7684Eden\u3001Survivor\u6216\u8005\u8001\u5e74\u4ee3\u3002\u867d\u7136G1\u8fd8\u4fdd\u7559\u7740\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u7684\u6982\u5ff5\uff0c\u4f46\u662f\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u4e0d\u518d\u662f\u56fa\u5b9a\u7684\u4e86\uff0c\u5b83\u4eec\u90fd\u662f\u4e00\u7cfb\u5217Region\u7684\u52a8\u6001\u96c6\u5408\u3002G1 \u56de\u6536\u5668\u7684\u8fd0\u4f5c\u8fc7\u7a0b\u5927\u81f4\u53ef\u5206\u4e3a\u56db\u4e2a\u6b65\u9aa4\uff1a </p> <p>\u200b    \u2460\u521d\u59cb\u6807\u8bb0\uff08\u4f1aSTW\uff09\uff1a\u4ec5\u4ec5\u53ea\u662f\u6807\u8bb0\u4e00\u4e0b GC Roots \u80fd\u76f4\u63a5\u5173\u8054\u5230\u7684\u5bf9\u8c61\uff0c\u5e76\u4e14\u4fee\u6539TAMS\u6307\u9488\u7684\u503c\uff0c\u8ba9\u4e0b\u4e00\u9636\u6bb5\u7528\u6237\u7ebf\u7a0b\u5e76\u53d1\u8fd0\u884c\u65f6\uff0c\u80fd\u6b63\u786e\u5730\u5728\u53ef\u7528\u7684Region\u4e2d\u5206\u914d\u65b0\u5bf9\u8c61\u3002\u8fd9\u4e2a\u9636\u6bb5\u9700\u8981\u505c\u987f\u7ebf\u7a0b\uff0c\u4f46\u8017\u65f6\u5f88\u77ed\uff0c\u800c\u4e14\u662f\u501f\u7528\u8fdb\u884cMinor GC\u7684\u65f6\u5019\u540c\u6b65\u5b8c\u6210\u7684\uff0c\u6240\u4ee5G1\u6536\u96c6\u5668\u5728\u8fd9\u4e2a\u9636\u6bb5\u5b9e\u9645\u5e76\u6ca1\u6709\u989d\u5916\u7684\u505c\u987f\u3002 </p> <p>\u200b    \u2461 \u5e76\u53d1\u6807\u8bb0\uff1a\u4ece GC Roots \u5f00\u59cb\u5bf9\u5806\u4e2d\u5bf9\u8c61\u8fdb\u884c\u53ef\u8fbe\u6027\u5206\u6790\uff0c\u9012\u5f52\u626b\u63cf\u6574\u4e2a\u5806\u91cc\u7684\u5bf9\u8c61\u56fe\uff0c\u627e\u51fa\u8981\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u8fd9\u9636\u6bb5\u8017\u65f6\u8f83\u957f\uff0c\u4f46\u53ef\u4e0e\u7528\u6237\u7a0b\u5e8f\u5e76\u53d1\u6267\u884c\u3002\u5f53\u5bf9\u8c61\u56fe\u626b\u63cf\u5b8c\u6210\u4ee5\u540e\uff0c\u8fd8\u8981\u91cd\u65b0\u5904\u7406\u5728\u5e76\u53d1\u65f6\u6709\u5f15\u7528\u53d8\u52a8\u7684\u5bf9\u8c61\u3002 </p> <p>\u200b    \u2462 \u6700\u7ec8\u6807\u8bb0\uff08\u4f1aSTW\uff09\uff1a\u5bf9\u7528\u6237\u7ebf\u7a0b\u505a\u77ed\u6682\u7684\u6682\u505c\uff0c\u5904\u7406\u5e76\u53d1\u9636\u6bb5\u7ed3\u675f\u540e\u4ecd\u6709\u5f15\u7528\u53d8\u52a8\u7684\u5bf9\u8c61\u3002 </p> <p>\u200b    \u2463 \u7b5b\u9009\u56de\u6536\uff08\u4f1aSTW\uff09\uff1a\u66f4\u65b0Region\u7684\u7edf\u8ba1\u6570\u636e\uff0c\u5bf9\u5404\u4e2aRegion\u7684\u56de\u6536\u4ef7\u503c\u548c\u6210\u672c\u8fdb\u884c\u6392\u5e8f\uff0c\u6839\u636e\u7528\u6237\u6240\u671f\u671b\u7684\u505c\u987f\u65f6\u95f4\u6765\u5236\u5b9a\u56de\u6536\u8ba1\u5212\uff0c\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u4efb\u610f\u591a\u4e2aRegion\u6784\u6210\u56de\u6536\u96c6\uff0c\u7136\u540e\u628a\u51b3\u5b9a\u56de\u6536\u7684\u90a3\u4e00\u90e8\u5206Region\u7684\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230\u7a7a\u7684Region\u4e2d\uff0c\u518d\u6e05\u7406\u6389\u6574\u4e2a\u65e7Region\u7684\u5168\u90e8\u7a7a\u95f4\u3002\u8fd9\u91cc\u7684\u64cd\u4f5c\u6d89\u53ca\u5b58\u6d3b\u5bf9\u8c61\u7684\u79fb\u52a8\uff0c\u5fc5\u987b\u6682\u505c\u7528\u6237\u7ebf\u7a0b\uff0c\u7531\u591a\u6761\u56de\u6536\u5668\u7ebf\u7a0b\u5e76\u884c\u5b8c\u6210\u7684\u3002</p> <p>\u603b\u7ed3\uff1a</p> <ol> <li>\u9664CMS\u548cG1\u5916\uff0c\u5176\u4ed6\u5783\u573e\u6536\u96c6\u5668\u90fd\u4e0d\u5206\u9636\u6bb5\uff0c\u90fd\u662f\u76f4\u63a5STW\u505a\u4e00\u6b21\u56de\u6536\u3002</li> <li>GCRoots\u679a\u4e3e\u548c\u79fb\u52a8\u5bf9\u8c61\u90fd\u5fc5\u987bSTW\uff0c\u6240\u4ee5\u5728CMS\u548cG1\u4e2d\u521d\u59cb\u6807\u8bb0\u90fd\u4f1aSTW\uff0c\u4f46\u662fCMS\u5e76\u53d1\u6e05\u7406\u4e0d\u7528STW\uff0c\u56e0\u4e3a\u5b83\u662f\u57fa\u4e8e\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\u8fdb\u884c\u7684\uff0c\u800cG1\u7684\u7b5b\u9009\u56de\u6536\u9700\u8981STW\uff0c\u56e0\u4e3a\u57fa\u4e8e\u6807\u8bb0-\u590d\u5236\u9700\u8981\u79fb\u52a8\u5bf9\u8c61\u3002</li> <li>\u4e09\u6b3e\u5e74\u8f7b\u4ee3\u5783\u573e\u6536\u96c6\u5668Serial\u3001ParNew\u3001Parallel Scavenge\u90fd\u662f\u57fa\u4e8e \u6807\u8bb0-\u590d\u5236 \u7b97\u6cd5\u3002</li> <li>\u9664CMS\u5916\uff0c\u4f7f\u7528\u5176\u4ed6\u8001\u5e74\u4ee3\u5783\u573e\u56de\u6536\u5668\u7684\u65f6\u5019\u90fd\u4f1a\u8fde\u5e26\u7740\u542f\u52a8\u5e74\u8f7b\u4ee3\u7684\u56de\u6536\uff0c\u53ea\u6709CMS\u5b58\u5728\u53ea\u9488\u5bf9\u8001\u5e74\u4ee3\u7684\u5783\u573e\u56de\u6536\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#cms","title":"CMS\u56de\u6536\u505c\u987f\u4e86\u51e0\u6b21\uff1f\u4e3a\u4ec0\u4e48\u8981\u505c\u987f\uff1f","text":"<p>\u505c\u987f\u4e86\u4e24\u6b21\uff0c\u56e0\u4e3aCMS\u867d\u7136\u662f\u4e3b\u6253\u4f4e\u5ef6\u8fdf\u7684\uff0c\u4f46\u521d\u59cb\u6807\u8bb0\u9636\u6bb5\u548c\u91cd\u65b0\u6807\u8bb0\u9636\u6bb5\u4e0d\u5f97\u4e0d\u6682\u505c\u7528\u6237\u7ebf\u7a0b\uff0c\u521d\u59cb\u6807\u8bb0\u4e3a\u4e86\u6807\u8bb0\u51faGC Roots\u80fd\u76f4\u63a5\u5173\u8054\u5230\u7684\u5bf9\u8c61\uff0c\u91cd\u65b0\u6807\u8bb0\u9636\u6bb5\u7684\u505c\u987f\u662f\u4e3a\u4e86\u5bf9\u5728\u5e76\u53d1\u6807\u8bb0\u671f\u95f4\u56e0\u7528\u6237\u7a0b\u5e8f\u7ee7\u7eed\u8fd0\u4f5c\u800c\u5bfc\u81f4\u6807\u8bb0\u4ea7\u751f\u53d8\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u5bf9\u8c61\u8fdb\u884c\u91cd\u65b0\u6807\u8bb0\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#g1","title":"\u7b80\u5355\u8bf4\u4e00\u4e0bG1\uff1f","text":"<p>G1\u5c06\u6574\u4e2a\u5806\u5206\u4e3a\u5927\u5c0f\u76f8\u7b49\u7684\u591a\u4e2aRegion\uff08\u533a\u57df\uff09\uff0c\u5e76\u8ddf\u8e2a\u6bcf\u4e2a\u533a\u57df\u7684\u5783\u573e\u5927\u5c0f\uff0c\u5728\u540e\u53f0\u7ef4\u62a4\u4e00\u4e2a\u4f18\u5148\u7ea7\u5217\u8868\uff0c\u6bcf\u6b21\u6839\u636e\u5141\u8bb8\u7684\u6536\u96c6\u65f6\u95f4\uff0c\u4f18\u5148\u56de\u6536\u4ef7\u503c\u6700\u5927\u7684\u533a\u57df\uff0c\u8fbe\u5230\u5728\u6709\u9650\u65f6\u95f4\u5185\u83b7\u53d6\u5c3d\u53ef\u80fd\u9ad8\u7684\u56de\u6536\u6548\u7387\uff0c\u5e76\u4e14\u4e0d\u4f1a\u4ea7\u751f\u7a7a\u95f4\u788e\u7247\u3002\u5b83\u7684\u8fd0\u4f5c\u6d41\u7a0b\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\uff1a\u521d\u59cb\u6807\u8bb0\uff0c\u5e76\u53d1\u6807\u8bb0\uff0c\u6700\u7ec8\u6807\u8bb0\uff0c\u7b5b\u9009\u56de\u6536\u3002\u9664\u4e86\u5e76\u53d1\u6807\u8bb0\u9636\u6bb5\u4e0d\u4f1a\u4ea7\u751fSTW\u4e4b\u5916\uff0c\u5176\u4f59\u4e09\u4e2a\u9636\u6bb5\u90fd\u4f1aSTW\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jvm_2","title":"\u5e38\u7528\u7684 jvm \u8c03\u4f18\u7684\u53c2\u6570\u90fd\u6709\u54ea\u4e9b\uff1f","text":"<p>-Xms\uff1a\u521d\u59cb\u5806\u7a7a\u95f4\u5185\u5b58\uff08\u9ed8\u8ba4\u4e3a\u7269\u7406\u5185\u5b58\u76841/64\uff09 -Xmx\uff1a\u6700\u5927\u5806\u7a7a\u95f4\u5185\u5b58\uff08\u9ed8\u8ba4\u4e3a\u7269\u7406\u5185\u5b58\u76841/4\uff09 -XX:NewRatio\uff1a\u8bbe\u7f6e\u8001\u5e74\u4ee3\u4e0e\u65b0\u751f\u4ee3\u5728\u5806\u7ed3\u6784\u7684\u5360\u6bd4 -XX:SurvivorRatio\uff1a\u8bbe\u7f6e\u65b0\u751f\u4ee3\u4e2dEden\u548cS0/S1\u7a7a\u95f4\u7684\u6bd4\u4f8b -XX:+PrintGCDetails\uff1a\u8f93\u51fa\u8be6\u7ec6\u7684GC\u5904\u7406\u65e5\u5fd7 -XX:PermSize\uff1a\u8bbe\u7f6e\u521d\u59cb\u5206\u914d\u7684\u6c38\u4e45\u4ee3\u5927\u5c0f -XX:MaxPermSize\uff1a\u8bbe\u7f6e\u6c38\u4e45\u4ee3\u6700\u5927\u53ef\u5206\u914d\u7a7a\u95f4 -XX:MetaspaceSize\uff1a\u8bbe\u7f6e\u5143\u7a7a\u95f4\u521d\u59cb\u5206\u914d\u7a7a\u95f4 -XX:MaxMetaspaceSize\uff1a\u8bbe\u7f6e\u5143\u7a7a\u95f4\u6700\u5927\u53ef\u5206\u914d\u7a7a\u95f4</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jvm_3","title":"\u8bf4\u4e00\u4e0b jvm \u8c03\u4f18\u7684\u5de5\u5177\uff1f","text":"<p>jdk\u81ea\u5e26\u7684\u6709jconcole\uff0cjvisualvm eclipse\u63d0\u4f9b\u7684MAT</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jvm_4","title":"\u8bf4\u4e00\u4e0b JVM \u8c03\u4f18\u7684\u547d\u4ee4\uff1f","text":"<p>jps\uff1aJVM Process Status Too\uff0c\u663e\u793a\u6307\u5b9a\u7cfb\u7edf\u5185\u6240\u6709\u7684HotSpot\u865a\u62df\u673a\u8fdb\u7a0b\u3002</p> <p>jstat\uff1aJVM statistics Monitoring\uff0c\u662f\u7528\u4e8e\u76d1\u89c6\u865a\u62df\u673a\u8fd0\u884c\u65f6\u72b6\u6001\u4fe1\u606f\u7684\u547d\u4ee4\uff0c\u5b83\u53ef\u4ee5\u663e\u793a\u51fa\u865a\u62df\u673a\u8fdb\u7a0b\u4e2d\u7684\u7c7b\u88c5\u8f7d\u3001\u5185\u5b58\u3001\u5783\u573e\u6536\u96c6\u3001JIT\u7f16\u8bd1\u7b49\u8fd0\u884c\u6570\u636e\u3002</p> <p>jstack\uff1ajstack\u7528\u4e8e\u751f\u6210java\u865a\u62df\u673a\u5f53\u524d\u65f6\u523b\u7684\u7ebf\u7a0b\u5feb\u7167\u3002jstack\u6765\u67e5\u770b\u5404\u4e2a\u7ebf\u7a0b\u7684\u8c03\u7528\u5806\u6808\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u6ca1\u6709\u54cd\u5e94\u7684\u7ebf\u7a0b\u5230\u5e95\u5728\u540e\u53f0\u505a\u4ec0\u4e48\u4e8b\u60c5\uff0c\u6216\u8005\u7b49\u5f85\u4ec0\u4e48\u8d44\u6e90\u3002 \u5982\u679cjava\u7a0b\u5e8f\u5d29\u6e83\u751f\u6210core\u6587\u4ef6\uff0cjstack\u5de5\u5177\u53ef\u4ee5\u7528\u6765\u83b7\u5f97core\u6587\u4ef6\u7684java stack\u548cnative stack\u7684\u4fe1\u606f\uff0c\u4ece\u800c\u53ef\u4ee5\u8f7b\u677e\u5730\u77e5\u9053java\u7a0b\u5e8f\u662f\u5982\u4f55\u5d29\u6e83\u548c\u5728\u7a0b\u5e8f\u4f55\u5904\u53d1\u751f\u95ee\u9898\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#jvm_5","title":"\u8c08\u8c08 JVM \u4e2d\u7684\u5e38\u91cf\u6c60\uff1f","text":"<p>JVM\u4e2d\u7684\u5e38\u91cf\u6c60\u6709\uff1aClass\u6587\u4ef6\u5e38\u91cf\u6c60\u3001\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff0c\u5168\u5c40\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u4ee5\u53ca\u57fa\u672c\u7c7b\u578b\u5305\u88c5\u7c7b\u5bf9\u8c61\u5e38\u91cf\u6c60</p> <p>Class\u6587\u4ef6\u5e38\u91cf\u6c60\uff1a\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u7684\u5e38\u91cf\u6c60\uff0c\u9759\u6001\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u3002</p> <p>\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\uff1a\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u5728\u65b9\u6cd5\u533a\uff0cClass\u6587\u4ef6\u5e38\u91cf\u6c60\u5728\u7c7b\u52a0\u8f7d\u540e\u4f1a\u5b58\u653e\u5728\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u3002\u7531\u7b26\u53f7\u5f15\u7528\u7ffb\u8bd1\u51fa\u6765\u7684\u76f4\u63a5\u5f15\u7528\u4e5f\u5b58\u50a8\u5728\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u4e2d\u3002</p> <p>\u5168\u5c40\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff1aJDK7\u4e4b\u540e\u4ece\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u79fb\u5230\u4e86\u5806\u3002</p> <p>\u57fa\u672c\u7c7b\u578b\u5305\u88c5\u7c7b\u5bf9\u8c61\u5e38\u91cf\u6c60\uff1ajava\u4e2d\u57fa\u672c\u7c7b\u578b\u7684\u5305\u88c5\u7c7b\u7684\u5927\u90e8\u5206\u90fd\u5b9e\u73b0\u4e86\u5e38\u91cf\u6c60\u6280\u672f\uff0c\u5373Byte\u3001Short\u3001Integer\u3001Long\u3001Character\u3001Boolean\uff0c\u53e6\u5916\u4e24\u79cd\u6d6e\u70b9\u6570\u7c7b\u578b\u7684\u5305\u88c5\u7c7b\u6ca1\u6709\u5b9e\u73b0\u3002\u8fd95\u79cd\u5305\u88c5\u7c7b\u578b\u53ea\u662f\u5728\u503c\u5c0f\u4e8e\u7b49\u4e8e127\u65f6\u624d\u53ef\u4f7f\u7528\u5e38\u91cf\u6c60\u4e2d\u7684\u5bf9\u8c61\uff0c\u5927\u4e8e127\u4e4b\u540e\u4f1a\u65b0\u521b\u5efa\u5bf9\u8c61\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_11","title":"\u7c7b\u52a0\u8f7d\u548c\u5378\u8f7d\u65f6\u673a\uff1f","text":"<p>\u5378\u8f7d\u65f6\u673a\uff1a\u7531JVM\u81ea\u5e26\u7684\u7c7b\u52a0\u8f7d\u5668\u6240\u52a0\u8f7d\u7684\u7c7b\uff0c\u5728JVM\u7684\u751f\u547d\u5468\u671f\u4e2d\uff0c\u59cb\u7ec8\u4e0d\u4f1a\u88ab\u5378\u8f7d\u3002\uff08JVM\u672c\u8eab\u4f1a\u59cb\u7ec8\u5f15\u7528\u8fd9\u4e9b\u7c7b\u52a0\u8f7d\u5668\uff0c\u800c\u8fd9\u4e9b\u7c7b\u52a0\u8f7d\u5668\u59cb\u7ec8\u5f15\u7528\u5b83\u4eec\u6240\u52a0\u8f7d\u7684\u7c7b\u7684Class\u5bf9\u8c61\uff0c\u6240\u4ee5\u8bf4\u8fd9\u4e9bClass\u5bf9\u8c61\u59cb\u7ec8\u662f\u53ef\u89e6\u53ca\u7684\u3002 \uff09\u800c\u7531\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u6240\u52a0\u8f7d\u7684\u7c7b\u662f\u53ef\u4ee5\u88ab\u5378\u8f7d\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_12","title":"\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\uff1f\u2b50","text":"<p>\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u603b\u7684\u6765\u8bf4\u5206\u4e3a\u52a0\u8f7d\u3001\u8fde\u63a5\u3001\u521d\u59cb\u5316\u4e09\u4e2a\u6b65\u9aa4\uff0c\u5176\u4e2d\u8fde\u63a5\u53c8\u5206\u4e3a\u9a8c\u8bc1\u3001\u51c6\u5907\u3001\u89e3\u6790\u4e09\u6b65\u3002</p> <p></p> <p>\u52a0\u8f7d\uff1a</p> <p>\u5728\u7b2c\u4e00\u6b65\u52a0\u8f7d\u9636\u6bb5\u865a\u62df\u673a\u4e3b\u8981\u9700\u8981\u5b8c\u6210\u4e09\u4ef6\u4e8b\uff0c\u4e00\u662f\u901a\u8fc7\u7c7b\u52a0\u8f7d\u5668\u83b7\u53d6\u6b64\u7c7b\u7684\u4e8c\u8fdb\u5236\u5b57\u8282\u6d41\u6d41\uff0c\u4e8c\u662f\u5c06\u6b64\u5b57\u8282\u6d41\u6240\u8868\u793a\u7684\u9759\u6001\u5b58\u50a8\u7ed3\u6784\u8f6c\u6362\u6210\u65b9\u6cd5\u533a\u7684\u8fd0\u884c\u65f6\u6570\u636e\u7ed3\u6784\uff0c\u4e09\u662f\u5728\u5806\u4e2d\u751f\u6210\u4e00\u4e2a\u4ee3\u8868\u6b64\u7c7b\u7684Class\u5bf9\u8c61\u3002</p> <p>\u8fde\u63a5\uff1a</p> <p>\u63a5\u4e0b\u6765\u662f\u8fde\u63a5\u4e2d\u7684\u9a8c\u8bc1\u9636\u6bb5\uff0c\u4e3b\u8981\u4f1a\u5b8c\u6210\u56db\u4e2a\u9636\u6bb5\u7684\u9a8c\u8bc1\uff1a\u6587\u4ef6\u683c\u5f0f\u9a8c\u8bc1\u3001\u5143\u6570\u636e\u9a8c\u8bc1\u3001\u5b57\u8282\u7801\u9a8c\u8bc1\u548c\u7b26\u53f7\u5f15\u7528\u9a8c\u8bc1\uff0c\u76ee\u7684\u662f\u4fdd\u8bc1\u8fd9\u4e9b\u4fe1\u606f\u88ab\u5f53\u4f5c\u4ee3\u7801\u8fd0\u884c\u4e4b\u540e\u4e0d\u4f1a\u5371\u5bb3\u5230\u865a\u62df\u673a\u81ea\u8eab\u7684\u5b89\u5168\u3002</p> <p>\u518d\u63a5\u4e0b\u6765\u662f\u8fde\u63a5\u4e2d\u7684\u51c6\u5907\u9636\u6bb5\uff0c\u4e3b\u8981\u662f\u4e3a\u7c7b\u53d8\u91cf\u5206\u914d\u5185\u5b58\u548c\u8d4b\u521d\u59cb\u503c\u3002\u4e3a\u7c7b\u53d8\u91cf\u8d4b\u521d\u59cb\u503c\u5206\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u662f\u6ca1\u6709final\u4fee\u9970\uff0c\u4e5f\u5373\u53ea\u6709static\u7684\u53d8\u91cf\uff0c\u5b83\u4f1a\u88ab\u8d4b\u9ed8\u8ba4\u7684\u96f6\u503c\uff0c\u7136\u540e\u5728\u6700\u540e\u7684\u521d\u59cb\u5316\u9636\u6bb5\u624d\u4f1a\u88ab\u8d4b\u7a0b\u5e8f\u4e2d\u6307\u5b9a\u7684\u503c\uff1b\u53e6\u5916\u4e00\u79cd\u60c5\u51b5\u662f\u6709final\u4fee\u9970\u7684\u7c7b\u53d8\u91cf\uff0c\u4e5f\u5373\u5e38\u91cf\uff0c\u5728\u7f16\u8bd1\u9636\u6bb5\u5c31\u4f1a\u4e3a\u8fd9\u4e2a\u5b57\u6bb5\u751f\u6210ConstantValue\u5c5e\u6027\uff0c\u6b64\u5c5e\u6027\u4e2d\u5b58\u653e\u7740\u7a0b\u5e8f\u4e2d\u6307\u5b9a\u7684\u503c\uff0c\u7136\u540e\u5728\u51c6\u5907\u9636\u6bb5\u5c31\u4f1a\u88ab\u8d4b\u4e0a\u8be5\u503c\u3002</p> <p>\u8fde\u63a5\u7684\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\u662f\u89e3\u6790\uff0c\u5b83\u6240\u505a\u7684\u5de5\u4f5c\u662f\u5c06\u5e38\u91cf\u6c60\u4e2d\u7684\u7b26\u53f7\u5f15\u7528\u8f6c\u6362\u6210\u76f4\u63a5\u5f15\u7528\uff0c\u4f8b\u5982\u7c7b\u3001\u63a5\u53e3\u3001\u65b9\u6cd5\u548c\u5b57\u6bb5\u7684\u7b26\u53f7\u5f15\u7528\u3002\u76f4\u63a5\u5f15\u7528\u7406\u89e3\u6210\u80fd\u76f4\u63a5\u5b9a\u4f4d\u5230\u76ee\u6807\u7684\u5185\u5b58\u5730\u5740\uff0c\u800c\u7b26\u53f7\u5f15\u7528\u662f\u4e00\u4e2a\u4e0e\u865a\u62df\u673a\u5185\u5b58\u5e03\u5c40\u65e0\u5173\uff0c\u7528\u4e8e\u5728\u5b57\u8282\u7801\u4e2d\u63cf\u8ff0\u3002\u89e3\u6790\u9636\u6bb5\u5e76\u4e0d\u4e00\u5b9a\u5728\u521d\u59cb\u5316\u9636\u6bb5\u4e4b\u524d\u5f00\u59cb\uff0c\u4e5f\u6709\u53ef\u80fd\u5728\u521d\u59cb\u5316\u4e4b\u540e\u5f00\u59cb\u3002</p> <p>\u521d\u59cb\u5316\uff1a</p> <p>\u7c7b\u52a0\u8f7d\u7684\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\u521d\u59cb\u5316\u6240\u505a\u7684\u5de5\u4f5c\u662f\u6267\u884c\u7c7b\u6784\u9020\u5668<code>&lt;clinit&gt;()</code>\u65b9\u6cd5\uff0c<code>&lt;clinit&gt;()</code>\u65b9\u6cd5\u662f\u7f16\u8bd1\u5668\u5c06\u7a0b\u5e8f\u4e2d\u6240\u6709\u7c7b\u53d8\u91cf\u8d4b\u503c\u548c\u9759\u6001\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\u5408\u5e76\u4e4b\u540e\u7f16\u8bd1\u7684\u7ed3\u679c\u3002\u516d\u79cd\u4e3b\u52a8\u5f15\u7528\u7684\u573a\u666f\u4f1a\u89e6\u53d1\u7c7b\u7684\u521d\u59cb\u5316\uff0c\u9664\u6b64\u4e4b\u5916\u7684\u90fd\u79f0\u4e3a\u88ab\u52a8\u5f15\u7528\uff0c\u4e0d\u4f1a\u89e6\u53d1\u7c7b\u7684\u521d\u59cb\u5316\u3002\uff08\u5e94\u8be5\u4e0d\u4f1a\u95ee\u7684\u8fd9\u4e48\u7ec6\uff0c\u8ba9\u6211\u628a\u516d\u79cd\u4e3b\u52a8\u5f15\u7528\u573a\u666f\u8bf4\u51fa\u6765\uff0c\u6216\u8005\u8bf4\u51fa\u4e66\u4e0a\u90a3\u51e0\u4e2a\u88ab\u52a8\u5f15\u7528\u7684\u4f8b\u5b50\uff09</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#clinitinit","title":"<code>&lt;clinit&gt;</code>\u65b9\u6cd5\u548c<code>&lt;init&gt;</code>\u65b9\u6cd5\u7684\u533a\u522b\uff1f\u2b50","text":"<p><code>&lt;clinit&gt;()</code>\u65b9\u6cd5\u662f\u7f16\u8bd1\u5668\u5c06\u7a0b\u5e8f\u4e2d\u6240\u6709\u7c7b\u53d8\u91cf\u8d4b\u503c\u548c\u9759\u6001\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\u5408\u5e76\u4e4b\u540e\u7f16\u8bd1\u7684\u7ed3\u679c\uff0c\u5728\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u7684\u521d\u59cb\u5316\u9636\u6bb5\u88ab\u8c03\u7528\u3002\u800c<code>&lt;init&gt;()</code>\u65b9\u6cd5\u662f\u7f16\u8bd1\u5668\u5c06\u7a0b\u5e8f\u4e2d\u6240\u6709\u5b9e\u4f8b\u53d8\u91cf\u76f4\u63a5\u8d4b\u503c\u548c\u6784\u9020\u5668\u4e2d\u7684\u4ee3\u7801\u5408\u5e76\u4e4b\u540e\u7f16\u8bd1\u7684\u7ed3\u679c\uff0c\u5728\u5b9e\u4f8b\u5316\u5bf9\u8c61\u7684\u65f6\u5019\u8c03\u7528\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_13","title":"\u7c7b\u52a0\u8f7d\u5668\uff1f\u2b50","text":"<p>\u7c7b\u52a0\u8f7d\u5668\u5b8c\u6210\u7684\u662f\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\u52a0\u8f7d\u9636\u6bb5\u7684\u7b2c\u4e00\u4ef6\u4e8b\uff0c\u5373\u901a\u8fc7\u4e00\u4e2a\u7c7b\u7684\u5168\u7c7b\u540d\u6765\u83b7\u53d6\u63cf\u8ff0\u8be5\u7c7b\u7684\u4e8c\u8fdb\u5236\u5b57\u8282\u6d41\u3002\u6bcf\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u90fd\u62e5\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u7c7b\u540d\u79f0\u7a7a\u95f4\uff0c\u4e00\u4e2a\u7c7b\u7684\u552f\u4e00\u6027\u7531\u8fd9\u4e2a\u7c7b\u7684\u5168\u7c7b\u540d\u548c\u52a0\u8f7d\u5b83\u7684\u7c7b\u52a0\u8f7d\u5668\u5171\u540c\u51b3\u5b9a\u3002\u7ad9\u5728JVM\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u53ef\u5c06\u7c7b\u52a0\u8f7d\u5668\u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff0c\u8fd9\u4e2a\u662f\u7528C++\u7f16\u5199\u7684\uff0c\u662f\u865a\u62df\u673a\u7684\u4e00\u90e8\u5206\uff1b\u53e6\u4e00\u79cd\u5c31\u662f\u5176\u5b83\u6240\u6709\u7684\u7c7b\u52a0\u8f7d\u5668\uff0c\u5305\u62ec\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u3001\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff08\u6216\u79f0\u4e4b\u4e3a\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\uff09\u548c\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\uff0c\u8fd9\u4e9b\u90fd\u662f\u7528Java\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u90fd\u7ee7\u627f\u81ea\u62bd\u8c61\u7c7bjava.lang.ClassLoader\u3002\u5728JDK8\u4e4b\u524d\u90fd\u4f7f\u7528\u7684\u4e09\u5c42\u7c7b\u52a0\u8f7d\u5668\u67b6\u6784\uff0c\u52a0\u8f7d\u8fc7\u7a0b\u5c31\u662f\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff0c\u5728JDK9\u5f15\u5165\u6a21\u5757\u5316\u7cfb\u7edf\u4e4b\u540e\u53d1\u751f\u5f88\u5927\u7684\u53d8\u5316\u3002</p> <ul> <li>Bootstrap ClassLoader\u662f\u7531C/C++\u7f16\u5199\u7684\uff0c\u5b83\u672c\u8eab\u662f\u865a\u62df\u673a\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u5b83\u5e76\u4e0d\u662f\u4e00\u4e2aJAVA\u7c7b\uff0c\u4e5f\u5c31\u662f\u65e0\u6cd5\u5728java\u4ee3\u7801\u4e2d\u83b7\u53d6\u5b83\u7684\u5f15\u7528\uff0cJVM\u542f\u52a8\u65f6\u901a\u8fc7Bootstrap\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d%JRE_HOME%\\lib\u4e0b\u7684rt.jar\u3001resources.jar\u3001charsets.jar\u7b49\u6838\u5fc3jar\u5305\u4e2d\u7684class\u6587\u4ef6\uff0c\u6bd4\u5982int.class,String.class\u90fd\u662f\u7531\u5b83\u52a0\u8f7d\uff0c\u53ef\u4ee5\u901a\u8fc7\u542f\u52a8jvm\u65f6\u6307\u5b9a-Xbootclasspath\u8def\u5f84\u6765\u6539\u53d8Bootstrap ClassLoader\u7684\u52a0\u8f7d\u76ee\u5f55\uff0c\u6bd4\u5982<code>java -Xbootclasspath/a:path</code>\u6307\u5b9a\u7684\u6587\u4ef6\u8ffd\u52a0\u5230\u9ed8\u8ba4\u7684bootstrap\u8def\u5f84\u4e2d\u3002</li> <li>ExtClassLoader\uff0c\u6269\u5c55\u7684\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d%JRE_HOME%\\lib\\ext\u76ee\u5f55\u4e0b\u7684jar\u5305\u548cclass\u6587\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u52a0\u8f7d<code>-D java.ext.dirs</code>\u9009\u9879\u6307\u5b9a\u7684\u76ee\u5f55\u3002</li> <li>AppclassLoader\uff08\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff09\u4e5f\u79f0\u4e3aSystemAppClass\uff0c\u56e0\u4e3a\u5728ClassLoader\u7c7b\u4e2d\u7684<code>getSystemClassLoader()</code>\u65b9\u6cd5\u62ff\u5230\u7684\u5c31\u662fAppclassLoader\uff0cAppclassLoader\u7528\u4e8e \u52a0\u8f7d\u5f53\u524d\u5e94\u7528\u7684classpath\u7684\u6240\u6709\u7c7b\u3002</li> </ul> <p>ExtClassLoader\uff08\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\uff09\u548c AppClassLoader\uff08\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\uff09\u90fd\u7ee7\u627f\u81eaURLClassLoader\uff0c\u5982\u4e0b\uff1a</p> <p></p> <p>ExtClassLoader \u548c AppClassLoader \u90fd\u662f\u5728 sun.misc.Launcher \u4e2d\u5b9a\u4e49\u5e76\u521b\u5efa\u5b9e\u4f8b\u7684\uff0cAppClassLoader\u7684\u7236\u52a0\u8f7d\u5668\u4e5f\u5c31\u662f\u5728\u8fd9\u91cc\u88ab\u8bbe\u7f6e\u6210ExtClassLoader \u7684\u3002</p> <p>\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u53ef\u4ee5\u76f4\u63a5\u7ee7\u627fClassLoader\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u7ee7\u627fURLClassLoader\u3002ClassLoader\u6700\u91cd\u8981\u7684\u65b9\u6cd5\u662f<code>loadClass()</code>\uff0c\u53cc\u4eb2\u59d4\u6d3e\u673a\u5236\u7684\u903b\u8f91\u5c31\u662f\u5728\u8fd9\u91cc\u5b9e\u73b0\u7684\uff1b\u5176\u6b21\u91cd\u8981\u7684\u65b9\u6cd5\u662f<code>findClass()</code>\uff0c\u5b9e\u9645\u52a0\u8f7d\u7c7b\u5230\u5185\u5b58\u7684\u903b\u8f91\u5e94\u8be5\u5728\u8fd9\u91cc\u5b9e\u73b0\uff0c\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u9700\u8981\u8986\u76d6\u8fd9\u4e2a\u65b9\u6cd5\uff1b\u6700\u540e\u662f<code>defineClass()</code>\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u6700\u6838\u5fc3\u7684\uff0c\u5b83\u662f\u4e00\u4e2anative\u65b9\u6cd5\uff0c\u80fd\u5c06class\u4e8c\u8fdb\u5236\u5185\u5bb9\u8f6c\u6362\u6210Class\u5bf9\u8c61\uff0c\u5982\u679c\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u4f1a\u629b\u51fa\u5404\u79cd\u5f02\u5e38\uff0c\u7f16\u5199\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u7684<code>findClass()</code>\u9700\u8981\u7528\u5230\u5b83\u3002</p> <p>\u7c7b\u52a0\u8f7d\u5668\u7684\u5e94\u7528\uff1a</p> <ol> <li>\u70ed\u90e8\u7f72</li> <li>\u5b57\u8282\u7801\u52a0\u5bc6</li> <li>\u9694\u79bb\u52a0\u8f7d\uff0c\u89e3\u51b3\u4f9d\u8d56\u51b2\u7a81\u3002\u5168\u7c7b\u540d\u76f8\u540c\u7684\u7c7b\u4e0d\u80fd\u7528\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u4f46\u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_14","title":"\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff1f\u2b50","text":"<p>\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u7684\u5de5\u4f5c\u8fc7\u7a0b\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u6536\u5230\u4e86\u7c7b\u52a0\u8f7d\u8bf7\u6c42\uff0c\u4ed6\u9996\u5148\u4e0d\u4f1a\u5c1d\u8bd5\u53bb\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\uff0c\u800c\u662f\u5c06\u52a0\u8f7d\u8bf7\u6c42\u59d4\u6d3e\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u533a\u5b8c\u6210\uff0c\u7236\u7c7b\u518d\u59d4\u6d3e\u7ed9\u7236\u7c7b\uff0c\u6bcf\u4e00\u5c42\u90fd\u5982\u6b64\uff0c\u76f4\u5230\u52a0\u8f7d\u8bf7\u6c42\u5230\u8fbe\u6700\u9876\u5c42\u7684\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\uff0c\u7136\u540e\u624d\u5f00\u59cb\u5c1d\u8bd5\u52a0\u8f7d\uff0c\u5f53\u7236\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u5b8c\u6210\u8fd9\u4e2a\u52a0\u8f7d\u8bf7\u6c42\u65f6\uff0c\u5b50\u52a0\u8f7d\u5668\u624d\u4f1a\u5c1d\u8bd5\u53bb\u81ea\u5df1\u52a0\u8f7d\u3002\u503c\u5f97\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u8fd9\u79cd\u7236\u5b50\u5173\u7cfb\u5e76\u4e0d\u662f\u901a\u8fc7\u7ee7\u627f\u5173\u7cfb\u6765\u5b9e\u73b0\u7684\uff0c\u800c\u662f\u7ec4\u5408\u5173\u7cfb\uff0c\u901a\u8fc7\u7ec4\u5408\u5173\u7cfb\u6765\u590d\u7528\u4ee3\u7801\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_15","title":"\u65b9\u6cd5\u8c03\u7528\uff1f\u89e3\u6790\u548c\u5206\u6d3e\uff1f\u9759\u6001\u5206\u6d3e\u548c\u52a8\u6001\u5206\u6d3e\uff1f\u2b50","text":"<p>\u65b9\u6cd5\u8c03\u7528\u7684\u552f\u4e00\u4efb\u52a1\u5c31\u662f\u786e\u5b9a\u88ab\u8c03\u65b9\u6cd5\u7684\u7248\u672c\uff0c\u4e5f\u5c31\u662f\u786e\u5b9a\u5230\u5e95\u8981\u8c03\u7528\u90a3\u4e2a\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5bf9\u5177\u6709\u76f8\u540c\u540d\u5b57\u7684\u65b9\u6cd5\u800c\u8a00\uff0c\u6709\u91cd\u8f7d\u548c\u91cd\u5199\u4f17\u591a\u7248\u672c\u3002\u800c\u8c08\u5bf9\u65b9\u6cd5\u8c03\u7528\u7684\u7406\u89e3\uff0c\u90a3\u80af\u5b9a\u5c31\u662f\u8981\u7406\u6e05\u89e3\u6790\u548c\u5206\u6d3e\u7684\u533a\u522b\uff0c\u4ee5\u53ca\u5206\u6d3e\u4e2d\u9759\u6001\u5206\u6d3e\u548c\u52a8\u6001\u5206\u6d3e\u7684\u533a\u522b\u3002\u5728\u300a\u6df1\u5165\u7406\u89e3Java\u865a\u62df\u673a\u300b\u4e2d\u662f\u4ece\u89e3\u6790\u548c\u5206\u6d3e\u4e24\u4e2a\u65b9\u9762\u8fdb\u884c\u8bb2\u89e3\u7684\uff0c\u6211\u60f3\u4ece\u7f16\u8bd1\u548c\u8fd0\u884c\u4e24\u4e2a\u9636\u6bb5\u6765\u770b\u65b9\u6cd5\u8c03\u7528\u7684\u8fc7\u7a0b\uff0c\u8fd9\u6837\u80fd\u628a\u4e66\u4e0a\u77e5\u8bc6\u70b9\u4e32\u8d77\u6765\u4e86\u3002</p> <p>\u5728\u7f16\u8bd1\u9636\u6bb5\u901a\u8fc7\u65b9\u6cd5\u63a5\u6536\u8005\u7684\u9759\u6001\u7c7b\u578b\u548c\u65b9\u6cd5\u53c2\u6570\u7684\u9759\u6001\u7c7b\u578b\u6765\u786e\u5b9a\u8ddf\u5728\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4\u540e\u9762\u7684\u7b26\u53f7\u5f15\u7528(CONSTANT_Methodref_info)\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u9759\u6001\u591a\u5206\u6d3e\u3002</p> <p>\u7136\u540e\u5728\u8fd0\u884c\u9636\u6bb5\uff0c\u6839\u636e\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4\u7684\u5206\u6d3e\u903b\u8f91\u6765\u51b3\u5b9a\u65b9\u6cd5\u7684\u6700\u7ec8\u7248\u672c\uff0c\u5bf9\u4e8einvokestatic\u6307\u4ee4\u548cinvokespecial\u6307\u4ee4\u6765\u8bf4\uff0c\u4ed6\u4eec\u7684\u5206\u6d3e\u903b\u8f91\u662f\u76f4\u63a5\u628a\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\u7684\u89e3\u6790\u9636\u6bb5\u89e3\u6790\u5230\u7684\u65b9\u6cd5\u7684\u76f4\u63a5\u5f15\u7528\u4f5c\u4e3a\u65b9\u6cd5\u8c03\u7528\u7684\u6700\u7ec8\u7248\u672c\uff0c\u800c\u865a\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4invokevirtual\u5374\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u76f4\u63a5\u5f15\u7528\uff0c\u5b83\u7684\u5206\u6d3e\u903b\u8f91\u662f\u5728\u6267\u884c\u9636\u6bb5\u9996\u5148\u6839\u636e\u5f15\u7528\u627e\u5230\u65b9\u6cd5\u63a5\u6536\u8005\u7684\u5b9e\u9645\u7c7b\u578b\uff08\u627e\u5b9e\u9645\u7c7b\u578b\u7684\u8fc7\u7a0b\u662f\uff0c\u9996\u5148\u6839\u636e\u5f15\u7528\u627e\u5230\u5806\u4e0a\u7684\u5bf9\u8c61\uff0c\u518d\u901a\u8fc7\u5bf9\u8c61\u7684\u7c7b\u578b\u6307\u9488\u5c31\u53ef\u4ee5\u627e\u5230\u5b9e\u9645\u7c7b\u578b\uff09\uff0c\u7136\u540e\u5728\u5b9e\u9645\u7c7b\u578b\u91cc\u627e\uff0c\u770b\u6709\u6ca1\u6709\u548c\u7b26\u53f7\u5f15\u7528\u91cc\u7684\u63cf\u8ff0\u7b26\u548c\u7b80\u5355\u540d\u79f0\u90fd\u76f8\u7b26\u7684\u65b9\u6cd5\uff0c\u6709\u5c31\u8fd4\u56de\u8fd9\u4e2a\u65b9\u6cd5\u7684\u76f4\u63a5\u5f15\u7528\u4f5c\u4e3a\u65b9\u6cd5\u8c03\u7528\u7684\u6700\u7ec8\u7248\u672c\uff0c\u6ca1\u6709\u5c31\u53bb\u7236\u7c7b\u91cc\u9762\u627e\uff0c\u627e\u5230Object\u91cc\u9762\u8fd8\u6ca1\u6709\u5c31\u629b\u5f02\u5e38\u3002\u8fd9\u5c31\u662f\u6240\u8c13\u52a8\u6001\u5355\u5206\u6d3e\uff0c\u4e5f\u5c31\u662f\u5206\u6d3e\u7684\u8fc7\u7a0b\u4e0d\u770b\u65b9\u6cd5\u63a5\u6536\u8005\u7684\u9759\u6001\u7c7b\u578b\uff0c\u53ea\u505a\u65b9\u6cd5\u7684\u5339\u914d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_16","title":"\u865a\u65b9\u6cd5\u548c\u975e\u865a\u65b9\u6cd5\u662f\u4ec0\u4e48\uff1f","text":"<p>\u975e\u865a\u65b9\u6cd5\u5c31\u662f\u5728\u7f16\u8bd1\u65f6\u7f16\u8bd1\u5668\u80fd\u76f4\u63a5\u786e\u5b9a\u65b9\u6cd5\u8c03\u7528\u7248\u672c\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982\u9759\u6001\u65b9\u6cd5\u3001\u7236\u7c7b\u65b9\u6cd5\u3001final\u4fee\u9970\u7684\u65b9\u6cd5\u3001\u5b9e\u4f8b\u6784\u9020\u5668\u3001\u79c1\u6709\u65b9\u6cd5\uff0c\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u7f16\u8bd1\u5668\u7ed9\u51fa\u7684\u6307\u4ee4\u662finvokestatic\u6216invokespecial\u3002\u865a\u65b9\u6cd5\u5c31\u662f\u5728\u7f16\u8bd1\u65f6\u7f16\u8bd1\u5668\u4e0d\u80fd\u786e\u5b9a\u6700\u7ec8\u8c03\u7528\u7248\u672c\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u9664\u4e0a\u97625\u79cd\u65b9\u6cd5\u4e4b\u5916\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u6709\u53ef\u80fd\u662f\u4ece\u7236\u7c7b\u7ee7\u627f\u8fc7\u6765\u7684\uff0c\u4e5f\u6709\u53ef\u80fd\u4f1a\u88ab\u5b50\u7c7b\u91cd\u5199\uff0c\u6240\u4ee5\u53ea\u80fd\u7b49\u5f85\u8fd0\u884c\u65f6\u6839\u636e\u5f15\u7528\u6307\u5411\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\u5230\u5e95\u662f\u7236\u7c7b\u5bf9\u8c61\u8fd8\u662f\u5b50\u7c7b\u5bf9\u8c61\u6765\u51b3\u5b9a\u6700\u7ec8\u8c03\u7528\u65b9\u6cd5\u7684\u7248\u672c\uff0c\u5bf9\u4e8e\u865a\u65b9\u6cd5\u7f16\u8bd1\u5668\u7ed9\u51fa\u7684\u6307\u4ee4\u662finvokevirtual\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_17","title":"\u591a\u6001\uff1f\u2b50","text":"<p>\u591a\u6001\u5c31\u662f\u7236\u7c7b\u5f15\u7528\u53ef\u4ee5\u6307\u5411\u5b50\u7c7b\u5bf9\u8c61\uff0c\u5982\u679c\u7236\u7c7b\u65b9\u6cd5\u88ab\u5b50\u7c7b\u91cd\u5199\uff0c\u90a3\u4e48\u901a\u8fc7\u7236\u7c7b\u5f15\u7528\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u9645\u4e0a\u4f1a\u8c03\u7528\u5b50\u7c7b\u91cd\u5199\u7684\u65b9\u6cd5\u3002\u591a\u6001\u6027\u7684\u6839\u6e90\u5728\u4e8e\u865a\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4invokevirtual\u7684\u6267\u884c\u903b\u8f91\uff0c\u6240\u4ee5\u5b57\u6bb5\u6ca1\u6709\u591a\u6001\u6027\u3002</p> <p>\uff08\u4e00\u70b9\u6742\u8c08\uff1a\u591a\u6001\u662f\u7a0b\u5e8f\u5177\u6709\u7075\u6d3b\u591a\u53d8\u7684\u52a8\u6001\u6269\u5c55\u6027\u7684\u6839\u672c\u3002\u6bd4\u5982\u4f60\u5728\u65b9\u6cd5\u91cc\u8c03\u7528\u4e86\u63a5\u53e3\u7684\u65b9\u6cd5\uff0c\u8fd9\u65f6\u4f60\u662f\u4e0d\u786e\u5b9a\u65b9\u6cd5\u8c03\u7528\u7684\u6700\u7ec8\u7248\u672c\uff0c\u7136\u540e\u4f60\u5728main\u65b9\u6cd5\u6216\u8005\u5176\u4ed6\u5730\u65b9\u7ed9\u8fd9\u4e2a\u65b9\u6cd5\u4f20\u9012\u4e86\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\uff0c\u90a3\u4e48\u8fd9\u65f6\u65b9\u6cd5\u8c03\u7528\u7684\u6700\u7ec8\u7248\u672c\u5c31\u786e\u5b9a\u4e0b\u6765\u4e86\uff0c\u6216\u8005\u4f60\u53c8\u4f20\u9012\u4e86\u63a5\u53e3\u7684\u53e6\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u90a3\u4e48\u65b9\u6cd5\u8c03\u7528\u7684\u6700\u7ec8\u7248\u672c\u5c31\u53c8\u53d8\u4e86\uff0c\u8fd9\u5c31\u591a\u6001\u7684\u9b45\u529b\uff0c\u5f88\u591a\u8bbe\u8ba1\u6a21\u5f0f\u90fd\u662f\u8fd9\u4e2a\u539f\u7406\uff1b\u518d\u6bd4\u5982\uff0c\u4f60\u5728\u7f16\u5199\u7a0b\u5e8f\u7684\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u90fd\u6ca1\u6709\u786e\u5b9a\u5b9e\u73b0\u7c7b\uff0c\u53ea\u662f\u5199\u4e86\u4e00\u4e2a\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u7684\u7c7b\u540d\u53cd\u5c04\u5b9e\u4f8b\u5316\u5bf9\u8c61\u7136\u540e\u4f20\u5165\u5230\u65b9\u6cd5\u4e2d\uff0c\u8fd9\u4e2a\u53cd\u5c04\u5b9e\u4f8b\u5316\u7684\u5bf9\u8c61\u5c31\u662f\u8fd9\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u5bf9\u8c61\uff0c\u4e8e\u662f\u5176\u4ed6\u4eba\u5728\u4f7f\u7528\u8fd9\u4e2a\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5bfc\u5305\uff0c\u7136\u540e\u5199\u914d\u7f6e\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u4f60\u7f16\u5199\u7684\u7a0b\u5e8f\u4e86\uff0c\u8fd9\u5c31\u662f\u591a\u6001\u7684\u9b45\u529b\uff0cjdbc\u5c31\u662f\u8fd9\u79cd\u601d\u60f3\uff0cJava\u6807\u51c6\u5e93\u91cc\u7684jdbc\u5168\u662f\u63a5\u53e3\uff0c\u6240\u4ee5\u7528\u6237\u5728\u7f16\u5199\u7a0b\u5e8f\u7684\u65f6\u5019\u80fd\u7f16\u8bd1\u901a\u8fc7\uff0c\u53ea\u9700\u8981\u5bfc\u5165\u4e0d\u540c\u6570\u636e\u5e93\u63d0\u4f9b\u4e0d\u540c\u7684jdbc\u5b9e\u73b0\u7c7b\uff0c\u5c31\u53ef\u4e0e\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4ea4\u4e92\u3002\uff09</p>"},{"location":"%E9%97%AE%E7%AD%94/JVM/#_18","title":"\u865a\u62df\u673a\u52a8\u6001\u5206\u6d3e\u7684\u5b9e\u73b0\uff1f\u6216\u8005\u8bf4\u865a\u65b9\u6cd5\u8868\u662f\u4ec0\u4e48\uff1f\u2b50","text":"<p>\u56e0\u4e3a\u52a8\u6001\u5206\u6d3e\u9700\u8981\u53cd\u590d\u53bb\u641c\u7d22\u7c7b\u578b\u7684\u5143\u6570\u636e\uff0c\u6240\u4ee5\u6700\u5e38\u7528\u7684\u4f18\u5316\u624b\u6bb5\u5c31\u662f\u5728\u65b9\u6cd5\u533a\u4e3a\u6bcf\u4e2a\u7c7b\u5efa\u7acb\u4e00\u4e2a\u865a\u65b9\u6cd5\u8868\uff0c\u865a\u65b9\u6cd5\u8868\u4e2d\u5b58\u653e\u7740\u6bcf\u4e2a\u65b9\u6cd5\u7684\u5b9e\u9645\u5165\u53e3\u5730\u5740\uff0c\u5305\u62ec\u4ece\u7236\u7c7b\u4e2d\u7ee7\u627f\u8fc7\u6765\u7684\u65b9\u6cd5\uff0c\u5728\u7c7b\u52a0\u8f7d\u9636\u6bb5\u8fd9\u5f20\u8868\u5c31\u5b8c\u6210\u4e86\u521d\u59cb\u5316\uff0c\u6240\u4ee5\u5c31\u4e0d\u7528\u50cf\u4e4b\u524d\u9700\u8981\u5148\u5728\u5b50\u7c7b\u4e2d\u641c\u7d22\uff0c\u5b50\u7c7b\u4e2d\u6ca1\u6709\u518d\u53bb\u7236\u7c7b\u4e2d\u641c\u7d22\uff0c\u73b0\u5728\u53ea\u9700\u8981\u67e5\u8868\u5373\u53ef\u83b7\u5f97\u6700\u7ec8\u7684\u76f4\u63a5\u5f15\u7528\u3002\u865a\u65b9\u6cd5\u8868\u5176\u5b9e\u7b97\u662f\u4e00\u79cd\u5f88\u6162\u7684\u5206\u6d3e\u65b9\u5f0f\uff0c\u53ea\u5728\u89e3\u91ca\u6267\u884c\u65f6\u7528\uff0c\u5728\u5373\u65f6\u7f16\u8bd1\u65f6\uff0c\u4f1a\u6709\u66f4\u591a\u7684\u6027\u80fd\u4f18\u5316\u63aa\u65bd\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/","title":"Java\u57fa\u7840","text":"<p> \u7ea6 2211 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 44 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#_1","title":"\u89e3\u91ca\u4e00\u4e0b\u4ec0\u4e48\u662f\u9762\u5411\u5bf9\u8c61\uff1f","text":"<p>\u4ece\u9762\u5411\u5bf9\u8c61\u548c\u9762\u5411\u8fc7\u7a0b\u7684\u5dee\u5f02\u6765\u89e3\u91ca\u4ec0\u4e48\u662f\u9762\u5411\u5bf9\u8c61\u6bd4\u8f83\u597d\u3002\u9762\u5411\u8fc7\u7a0b\u7684\u7f16\u7a0b\u601d\u60f3\u662f\u628a\u6570\u636e\u548c\u8fc7\u7a0b\u5206\u522b\u4f5c\u4e3a\u72ec\u7acb\u7684\u90e8\u5206\u6765\u8003\u8651\uff0c\u6570\u636e\u4ee3\u8868\u95ee\u9898\u7a7a\u95f4\u4e2d\u7684\u5ba2\u4f53\uff0c\u8fc7\u7a0b\u5219\u7528\u4e8e\u5904\u7406\u8fd9\u4e9b\u6570\u636e\uff1b\u800c\u9762\u5411\u5bf9\u8c61\u5219\u7ad9\u5728\u73b0\u5b9e\u4e16\u754c\u7684\u89d2\u5ea6\u53bb\u62bd\u8c61\u95ee\u9898\uff0c\u628a\u6570\u636e\u548c\u8fc7\u7a0b\u90fd\u770b\u4f5c\u662f\u5bf9\u8c61\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#5io","title":"5\u79cd\u7f51\u7edcIO\u6a21\u578b\uff1f","text":"<p>\u963b\u585eIO\u3001\u975e\u963b\u585eIO\u3001IO\u591a\u8def\u590d\u7528\u3001\u4fe1\u53f7\u9a71\u52a8IO\u3001\u5f02\u6b65IO\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#bionioaio","title":"BIO\u3001NIO\u3001AIO\u7684\u533a\u522b\uff1f","text":"<p>BIO\u5373\u963b\u585eIO\uff0c\u662fJDK\u6700\u65e9\u5c31\u63d0\u4f9b\u7684IO\u65b9\u5f0f\uff0cBIO\u7684\u7f16\u7a0b\u601d\u60f3\u662f\u9762\u5411\u6587\u4ef6\u6d41\u3002</p> <p>NIO\u662fNew IO\u7684\u610f\u601d\uff0cNIO\u7f16\u7a0b\u6a21\u578b\u57fa\u4e8e\u4e09\u4e2a\u57fa\u672c\u7ec4\u4ef6\uff1a\u901a\u9053\u3001\u7f13\u51b2\u533a\u3001\u9009\u62e9\u5668\u3002\u6570\u636e\u662f\u4ece\u901a\u9053\u8bfb\u5165\u7f13\u51b2\u533a\uff0c\u4ece\u7f13\u51b2\u533a\u5199\u5165\u901a\u9053\u4e2d\u7684\u3002\u9009\u62e9\u5668\u662f\u7528\u4e8e\u7f51\u7edcIO\u5b9e\u73b0IO\u591a\u8def\u590d\u7528\u7684\u3002</p> <p>AIO\u5373\u5f02\u6b65IO\uff0cBIO\u548cIO\u591a\u8def\u590d\u7528\u90fd\u6709\u963b\u585e\uff0c\u5f02\u6b65IO\u5b8c\u5168\u6ca1\u6709\u963b\u585e\uff0c\u4e5f\u5c31\u662fAIO\u518d\u5411\u64cd\u4f5c\u7cfb\u7edf\u53d1\u51fa\u8bfb\u5199\u8bf7\u6c42\u4e4b\u540e\u5c31\u8fd4\u56de\u63a5\u7740\u505a\u81ea\u5df1\u7684\u4e8b\u60c5\u4e86\uff0c\u7b49\u5230\u64cd\u4f5c\u7cfb\u7edf\u51c6\u5907\u597d\u6570\u636e\u5e76\u628a\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u590d\u5236\u5230\u7528\u6237\u7a7a\u95f4\u4e4b\u540e\uff0cAIO\u624d\u4f1a\u53bb\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u8bf4AIO\u5168\u7a0b\u90fd\u4e0d\u4f1a\u963b\u585e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#statementexpression","title":"\u8bed\u53e5\uff08statement\uff09\u548c\u8868\u8fbe\u5f0f\uff08expression\uff09\u7684\u533a\u522b\uff1f","text":"<p>\u5206\u547d\u4ee4\u5f0f\u7f16\u7a0b\u8bed\u8a00\u548c\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\u770b</p> <p>\u547d\u4ee4\u5f0f\u7f16\u7a0b\u8bed\u8a00\u91cc\u9762\uff0c\u6709\u8868\u8fbe\u5f0f\u548c\u8bed\u53e5\u548c\u51fd\u6570\uff0c\u51fd\u6570\u4e0d\u5728\u8fd9\u4e2alevel\u4e0a\uff0c\u5b83\u662f\u8bed\u53e5\u7684\u96c6\u5408\uff0c\u73b0\u5728\u53ea\u8c08\u8bba\u8868\u8fbe\u5f0f\u548c\u8bed\u53e5\uff0c\u4ed6\u4fe9\u4e2a\u90fd\u662f\u7f16\u7a0b\u8bed\u8a00\u7684\u57fa\u7840\uff0c\u533a\u522b\u7684\u662f+-*/=ifwhile\u7b49\u5173\u952e\u5b57\uff0c\u547d\u4ee4\u5f0f\u7f16\u7a0b\u8bed\u8a00\u91cc\u9762\u8868\u8fbe\u5f0f\u4e0d\u80fd\u5355\u72ec\u4f5c\u4e3a\u4e00\u884c\uff0c\u4ed6\u5c31\u50cf\u662f\u6ca1\u6709\u8bf4\u5b8c\u7684\u8bdd\uff0c\u5fc5\u987b\u53d8\u6210\u8bed\u53e5\u624d\u884c\u3002</p> <p>\u51fd\u6570\u5f0f\u7f16\u7a0b\u91cc\u9762\u90fd\u662f\u8868\u8fbe\u5f0f\uff0c\u53ef\u4ee5\u5355\u72ec\u5b58\u5728\uff1f\uff1f\uff1f</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#arraylist","title":"ArrayList\u7684\u6269\u5bb9\u673a\u5236\uff1f","text":"<p>\u6269\u5bb9\u7684\u65f6\u673a\uff1a\u5982\u679c\u4f7f\u7528\u65e0\u53c2\u6784\u9020\u5668\uff0c\u5219\u521d\u59cb\u5316\u5bb9\u91cf\u662f0\uff0c\u5728\u7b2c\u4e00\u6b21\u6dfb\u52a0\u65f6\u4f1a\u6269\u5bb9\u523010\uff0c\u4ee5\u540e\u6bcf\u6b21\u6269\u5bb9\u90fd\u662f\u6269\u5230\u539f\u6765\u76841.5\uff0c\u6bd4\u598210\u4f1a\u6269\u5bb9\u523015\uff1b\u5982\u679c\u4f7f\u7528\u6307\u5b9a\u5927\u5c0f\u7684\u6709\u53c2\u6784\u9020\u5668\uff0c\u5219\u521d\u59cb\u5316\u65f6\u5c31\u662f\u8fd9\u4e2a\u5bb9\u91cf\uff0c\u4ee5\u540e\u6bcf\u6b21\u6269\u5bb9\u4e5f\u662f\u6269\u5230\u539f\u6765\u76841.5\u3002</p> <p>\u6269\u5bb9\u7684\u8fc7\u7a0b\uff1a\u8c03\u7684\u662f<code>Arrays.copyOf()</code>\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53c8\u8c03\u4e86<code>System.arraycopy()</code>\uff0c\u662f\u4e2anative\u65b9\u6cd5\uff0c\u57fa\u672c\u539f\u7406\u662f\u5148\u7533\u8bf7\u4e00\u4e2a\u65b0\u5bb9\u91cf\u7684\u6570\u7ec4\uff0c\u7136\u540e\u518d\u590d\u5236\u65e7\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#hashmapput","title":"HashMap\u63d2\u5165\u5143\u7d20\u7684\u6d41\u7a0b\uff1fput()\u65b9\u6cd5\u7684\u6d41\u7a0b\uff1f","text":"<p>\u9996\u5148\u6839\u636ekey\u7684hash\u503c\uff08\u8c03\u7528key\u7684<code>hashCode()</code>\u65b9\u6cd5\uff09\u627e\u5230\u5728\u6570\u7ec4\u4e2d\u5e94\u8be5\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u5148\u5224\u65ad\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u5426\u4e3a\u7a7a\uff0c\u82e5\u4e3a\u7a7a\u5c31\u76f4\u63a5\u63d2\u5728\u6570\u7ec4\u7684\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u5426\u5219\u5c31\u4f9d\u6b21\u68c0\u67e5\u94fe\u8868\u4e0a\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\uff08\u6216\u5728\u7ea2\u9ed1\u6811\u4e0a\u67e5\u627e\uff09\uff0c\u5224\u65adkey\u503c\u662f\u5426\u76f8\u7b49\uff08\u8c03\u7528key\u7684<code>equals()</code>\u65b9\u6cd5\uff09\uff0c\u82e5\u76f8\u7b49\uff0c\u5c31\u66ff\u6362value\u503c\uff0c\u82e5\u90fd\u4e0d\u76f8\u7b49\uff0c\u5c31\u63d2\u5165\uff0c\u63d2\u5165\u540e\u5206\u4e24\u79cd\u60c5\u51b5\u68c0\u67e5\uff1a\u2460 \u5982\u679c\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\uff0c\u82e5\u8282\u70b9\u603b\u6570\u5927\u4e8e\u9608\u503c\uff08<code>\u6570\u7ec4\u957f\u5ea6 x \u8d1f\u8f7d\u56e0\u5b50</code>\uff09\uff0c\u6216\u67d0\u4e2a\u94fe\u8868\u7684\u957f\u5ea6\u5927\u4e8e\u6811\u5316\u7684\u9608\u503c8\uff0c\u51fa\u73b0\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\u60c5\u51b5\u5c31\u4f1a\u5c06\u6570\u7ec4\u6269\u5bb9\u4e3a\u539f\u6765\u7684\u4e24\u500d\uff1b\u2461 \u5982\u679c\u6570\u7ec4\u957f\u5ea6\u5927\u4e8e64\uff0c\u53ea\u4f1a\u5728\u8282\u70b9\u603b\u6570\u5927\u4e8e\u9608\u503c\u65f6\u6269\u5bb9\uff0c\u5982\u679c\u6ca1\u6709\u8fbe\u5230\u6269\u5bb9\u9608\u503c\uff0c\u4f46\u662f\u94fe\u8868\u957f\u5ea6\u5927\u4e8e8\uff0c\u5219\u4f1a\u628a\u94fe\u8868\u53d8\u6210\u7ea2\u9ed1\u6811\u3002</p> <p>\u6ce8\u610f\uff1a\u68c0\u67e5\u5934\u8282\u70b9\u548c\u68c0\u67e5\u94fe\u8868\u540e\u9762\u7684\u8282\u70b9\u5e76\u4e0d\u662f\u5728\u4e00\u8d77\uff08\u5373\u4e00\u4e2a\u5faa\u73af\u91cc\u9762\uff09\u7684\u64cd\u4f5c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#hashmap","title":"HashMap\u7684\u6269\u5bb9\u673a\u5236\uff1f","text":"<p>\u6269\u5bb9\u7684\u65f6\u673a\uff1a\u5f53\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u65f6\uff0c\u82e5\u8282\u70b9\u603b\u6570\u5927\u4e8e\u9608\u503c\uff08\u6570\u7ec4\u957f\u5ea6 * \u8d1f\u8f7d\u56e0\u5b50\uff09\uff0c\u6216\u67d0\u4e2a\u94fe\u8868\u7684\u957f\u5ea6\u5927\u4e8e\u6811\u5316\u7684\u9608\u503c8\uff0c\u51fa\u73b0\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\u60c5\u51b5\u5c31\u4f1a\u5c06\u6570\u7ec4\u6269\u5bb9\u4e3a\u539f\u6765\u7684\u4e24\u500d\uff1b\u5f53\u6570\u7ec4\u957f\u5ea6\u5927\u4e8e64\u65f6\uff0c\u53ea\u4f1a\u5728\u8282\u70b9\u603b\u6570\u5927\u4e8e\u9608\u503c\u65f6\u6269\u5bb9\uff0c\u82e5\u67d0\u4e2a\u94fe\u8868\u7684\u957f\u5ea6\u7b49\u4e8e\u6811\u5316\u7684\u9608\u503c8\uff0c\u5219\u4f1a\u5c06\u94fe\u8868\u53d8\u6210\u7ea2\u9ed1\u6811\u3002</p> <p>\u6269\u5bb9\u7684\u8fc7\u7a0b\uff1a\u5148\u7533\u8bf7\u4e00\u4e2a\u65b0\u5bb9\u91cf\u7684\u6570\u7ec4\uff0c\u7136\u540e\u518d\u628a\u6bcf\u4e2a\u5143\u7d20\u91cd\u65b0hash\u5230\u65b0Map\u4e2d\u3002\u8fd9\u4e2d\u95f4\u6709\u4e2a\u89c4\u5f8b\uff0c\u5904\u4e8e\u540c\u4e00\u4e2a\u6876\u4e2d\u7684\u6570\u636e\uff0c\u4e00\u90e8\u5206\u4f1a\u6563\u5217\u5230\u65b0\u6570\u7ec4\u7684\u76f8\u540c\u4f4d\u7f6e<code>i</code>\u4e0a\uff0c\u53e6\u4e00\u90e8\u5206\u4f1a\u6563\u5217\u5230<code>n+i</code>\u4e0a\uff0c\u8fd9\u662f\u56e0\u4e3a\u4f4d\u7f6e\u662f\u901a\u8fc7<code>hash &amp; (n-1)</code>\u8ba1\u7b97\u5f97\u5230\u7684\uff0cn\u662f\u6570\u7ec4\u5bb9\u91cf\u3002\u6bd4\u5982\u6269\u5bb9\u524d\u4e3a16\uff0c\u6269\u5bb9\u540e\u5bb9\u91cf\u4e3a32\uff0c\u5143\u7d20\u7684hash\u503c\u548c15\u300131\u505a\u4e0e\u8fd0\u7b97\u7684\u4f4e4\u4f4d\u662f\u76f8\u540c\u7684\uff0c\u53ea\u6709\u7b2c5\u4f4d\u4e0d\u540c\uff0c\u56e0\u4e3a15\u7684\u7b2c5\u4f4d\u4e3a0\uff0c\u800c31\u7684\u7b2c5\u4f4d\u4e3a1\u3002</p> <p>\u6ce8\u610f\u4e24\u70b9\uff1a</p> <ol> <li>\u662f\u8282\u70b9\u603b\u6570\u4e0e\u6570\u7ec4\u957f\u5ea6*\u8d1f\u8f7d\u56e0\u5b50\u6bd4\u8f83\uff0c\u800c\u4e0d\u662f\u6570\u7ec4\u4e0a\u5df2\u88ab\u5360\u6709\u7684\u4f4d\u7f6e</li> <li>\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u65f6\uff0c\u94fe\u8868\u957f\u5ea6\u7b49\u4e8e8\u4e0d\u4f1a\u89e6\u53d1\u6811\u5316\uff0c\u800c\u662f\u89e6\u53d1\u6269\u5bb9</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Java%E5%9F%BA%E7%A1%80/#mb-b","title":"\u4e8c\u53c9\u6392\u5e8f\u6811\u3001\u5e73\u8861\u4e8c\u53c9\u6811\u3001\u7ea2\u9ed1\u6811\u3001\u5e73\u8861m\u53c9\u67e5\u627e\u6811\u3001B-\u6811\u3001B+\u6811\uff1f","text":"<p>\u4e8c\u53c9\u6392\u5e8f\u6811\u5c31\u662f\u6839\u8282\u70b9\u7684\u5de6\u5b50\u6811\u5c0f\u4e8e\u6839\u8282\u70b9\u7684\u503c\uff0c\u6839\u8282\u70b9\u7684\u53f3\u5b50\u6811\u5927\u4e8e\u6839\u8282\u70b9\u7684\u503c\uff0c\u7136\u540e\u5de6\u53f3\u5b50\u6811\u90fd\u662f\u4e8c\u53c9\u6392\u5e8f\u6811\u7684\u6811\uff0c\u4e00\u4e2a\u9012\u5f52\u7684\u5b9a\u4e49\u3002\u4ece\u4e8c\u53c9\u6392\u5e8f\u6811\u7684\u6027\u8d28\u53ef\u4ee5\u770b\u51fa\u5176\u4e2d\u5e8f\u904d\u5386\u7684\u7ed3\u679c\u7684\u662f\u6709\u5e8f\u7684\u3002</p> <p>\u5e73\u8861\u4e8c\u53c9\u6811\u5c31\u662f\u5728\u4e8c\u53c9\u6392\u5e8f\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u4e86\u7684\u81ea\u5e73\u8861\u7b97\u6cd5\uff0c\u4fdd\u8bc1\u63d2\u5165\u548c\u5220\u9664\u65f6\uff0c\u5de6\u53f3\u5b50\u6811\u7684\u9ad8\u5ea6\u5dee\u4e0d\u4f1a\u8d85\u8fc71\u3002</p> <p></p> <p>\u7ea2\u9ed1\u6811\u7684\u6027\u8d28\uff1a</p> <p>\u6027\u8d281\uff1a\u6bcf\u4e2a\u8282\u70b9\u53ea\u6709\u4e24\u79cd\u989c\u8272\uff1a\u7ea2\u8272 \u548c \u9ed1\u8272    </p> <p>\u6027\u8d282\uff1a\u6839\u8282\u70b9\u662f\u9ed1\u8272\u7684</p> <p>\u6027\u8d283\uff1a\u6bcf\u4e2a\u53f6\u5b50\u8282\u70b9\uff08NIL\uff09\u662f\u9ed1\u8272\u7684\u7a7a\u8282\u70b9</p> <p>\u6027\u8d284\uff1a\u4e0d\u4f1a\u51fa\u73b0\u4e24\u4e2a\u8fde\u7eed\u7684\u7ea2\u8272\u8282\u70b9\uff0c\u6216\u8005\u8bf4 \u7ea2\u8272\u7ed3\u70b9\u7684\u4e24\u4e2a\u5b50\u7ed3\u70b9\u4e00\u5b9a\u90fd\u662f\u9ed1\u8272\uff0c\u6216\u8005\u8bf4\u7ea2\u8272\u8282\u70b9\u7684\u7236\u8282\u70b9\u4e00\u5b9a\u662f\u9ed1\u8272\u7684</p> <p>\u6027\u8d285\uff1a\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u5230\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u8def\u5f84\u4e0a\u7684\u9ed1\u8272\u8282\u70b9\u6570\u76f8\u540c</p> <p>\u7ea2\u9ed1\u6811\u662f\u4e00\u9897\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u4f46\u662f\u5b83\u7684\u5e73\u8861\u5e76\u4e0d\u662f\u50cf\u5e73\u8861\u4e8c\u53c9\u6811\u90a3\u6837\u5de6\u53f3\u5b50\u6811\u9ad8\u5ea6\u5dee\u4e0d\u8d85\u8fc71\u4e2a\uff0c\u800c\u662f\u5de6\u53f3\u5b50\u6811\u9ad8\u5ea6\u5dee\u4e0d\u4f1a\u8d85\u8fc71\u500d\uff0c\u4f46\u662f\u7ea2\u9ed1\u6811\u5de6\u53f3\u5b50\u6811\u9ed1\u8272\u8282\u70b9\u7684\u9ad8\u5ea6\u662f\u76f8\u7b49\u7684\uff0c\u6240\u4ee5\u7ea2\u9ed1\u6811\u7684\u5de6\u53f3\u5b50\u6811\u662f\u201c\u8fd1\u4f3c\u5e73\u8861\u201d \u548c \u201c\u9ed1\u8272\u5b8c\u7f8e\u5e73\u8861\u201d\u3002</p> <p>\u6b63\u56e0\u4e3a\u7ea2\u9ed1\u6811\u7684\u5e73\u8861\u6027\u6ca1\u6709\u5e73\u8861\u4e8c\u53c9\u6811\u7684\u5e73\u8861\u6027\u597d\uff0c\u6240\u4ee5\u7ea2\u9ed1\u6811\u7684\u67e5\u627e\u6548\u7387\u8981\u7565\u4f4e\u4e8e\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u4f46\u662f\u7ea2\u9ed1\u6811\u7684\u63d2\u5165\u5220\u9664\u6548\u7387\u8981\u6bd4\u5e73\u8861\u4e8c\u53c9\u6811\u9ad8\u3002</p> <p>\u7ea2\u9ed1\u6811\u4f9d\u9760\u4e24\u79cd\u64cd\u4f5c\u4fdd\u8bc1\u4e0a\u97625\u6761\u6027\u8d28\uff1a\u53d8\u8272 \u548c \u65cb\u8f6c</p> <p>\u6bd4\u5982\u63d2\u5165\u6570\u636e\u65f6\uff0c\u63d2\u5165\u8282\u70b9\u7684\u989c\u8272\u662f\u7ea2\u8272\uff0c\u5927\u81f4\u6709\u5982\u4e0b\u60c5\u5f62\uff1a</p> <ol> <li> <p>\u63d2\u5165\u8282\u70b9\u7684\u7236\u8282\u70b9\u662f\u9ed1\u8272\u7684\uff0c\u76f4\u63a5\u63d2\u5165\u5373\u53ef</p> </li> <li> <p>\u63d2\u5165\u8282\u70b9\u7684\u7236\u8282\u70b9\u662f\u7ea2\u8272\u7684\uff1a    2.1 \u53d4\u53d4\u8282\u70b9\u662f\u7ea2\u8272\uff0c\u90a3\u4e48\u5168\u7a0b\u9760\u53d8\u8272\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4e0a\u97625\u6761\u6027\u8d28    2.2 \u53d4\u53d4\u8282\u70b9\u662f\u9ed1\u8272\uff0c\u90a3\u4e48\u8fd8\u5206\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\uff0c\u90fd\u662f\u9760\u53d8\u8272\u52a0\u65cb\u8f6c\u6765\u4fdd\u8bc1\u7ea2\u9ed1\u6811\u76845\u6761\u6027\u8d28\uff1a      2.2.1 \u63d2\u5165\u8282\u70b9\u662f\u7236\u8282\u70b9\u7684\u5de6\u5b69\u5b50      2.2.2 \u63d2\u5165\u8282\u70b9\u662f\u7236\u8282\u70b9\u7684\u53f3\u5b69\u5b50</p> </li> </ol> <p>B-\u6811\u5c31\u662f\u4e00\u9897\u5e73\u8861m\u53c9\u67e5\u627e\u6811\uff0c\u4f46\u662fB-\u6811\u8981\u6bd4\u5e73\u8861m\u53c9\u67e5\u627e\u6811\u8981\u4e25\u683c\uff0c\u5c31\u662fB-\u6811\u7684\u6240\u6709\u53f6\u5b50\u8282\u70b9\u5fc5\u987b\u5728\u540c\u4e00\u5c42\u4e0a\uff0c\u800c\u5e73\u8861m\u53c9\u67e5\u627e\u6811\u53ea\u9700\u8981\u5de6\u53f3\u5b50\u6811\u9ad8\u5ea6\u4e0d\u76f8\u5dee1\u3002</p> <p>B+\u6811\u662fB-\u6811\u7684\u53d8\u5f62\uff0c\u4e0d\u540c\u4e8eB-\u6811\u7684\u662f\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u6570\u636e\uff08\u6216\u6307\u5411\u6570\u636e\u7684\u6307\u9488\uff09\uff0c\u6240\u6709\u6570\u636e\u6216\u6307\u5411\u6570\u636e\u7684\u6307\u9488\u90fd\u662f\u5b58\u5728\u53f6\u5b50\u8282\u70b9\u4e0a\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u662f\u5bf9\u53f6\u5b50\u8282\u70b9\u7684\u591a\u7ea7\u7d22\u5f15\u3002</p> <p>MySQL\u7684\u7d22\u5f15\u7ed3\u6784\u5c31\u662fB+\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u662f\u5927\u5c0f\u4e3a16KB\u7684\u9875\uff0c\u5bf9\u4e8e\u805a\u7c07\u7d22\u5f15\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u7684\u4e00\u6761\u6761\u8bb0\u5f55\u5305\u62ec\u4e3b\u952e + \u4e0b\u4e00\u5c42\u8282\u70b9\u7684\u9875\u53f7\uff0c\u8fd9\u4e2a\u4e0b\u4e00\u5c42\u8282\u70b9\u9875\u9762\u91cc\u9762\u5b58\u7684\u90fd\u662f\u6bd4\u8be5\u4e3b\u952e\u5927\u7684\u8bb0\u5f55\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u7684\u4e00\u6761\u6761\u8bb0\u5f55\u662f\u5b8c\u6574\u7684\u6570\u636e\uff1b\u5bf9\u4e8e\u975e\u805a\u7c07\u7d22\u5f15\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u5b58\u7684\u4e00\u6761\u6761\u8bb0\u5f55\u5305\u62ec\u67e5\u627e\u952e + \u4e0b\u4e00\u5c42\u8282\u70b9\u7684\u9875\u53f7\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u7684\u4e00\u6761\u6761\u8bb0\u5f55\u662f \u67e5\u627e\u952e + \u4e3b\u952e\uff0c\u6240\u4ee5\u5728\u975e\u805a\u7c07\u7d22\u5f15\u4e0a\u627e\u5230\u8bb0\u5f55\u540e\u8981\u56de\u8868\uff0c\u4e5f\u5c31\u662f\u5230\u805a\u7c07\u7d22\u5f15\u4e0a\u627e\u5b8c\u6574\u7684\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/","title":"Kafka","text":"<p> \u7ea6 5589 \u4e2a\u5b57  1 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 112 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafka","title":"Kafka\u7684\u67b6\u6784\uff1f","text":"<p>\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u6309topic\u751f\u4ea7\u548c\u6d88\u8d39\u6d88\u606f\uff0cKafka\u7684\u6bcf\u4e00\u4e2atopic\u53ef\u4ee5\u88ab\u5206\u6210\u591a\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u53ef\u4ee5\u6709\u591a\u4e2a\u526f\u672c\uff0c\u591a\u4e2a\u526f\u672c\u4e2d\u6709\u4e00\u4e2aleader\u548c\u591a\u4e2afollower\uff0c\u5ba2\u6237\u7aef\u53ea\u4e0eleader\u8fdb\u884c\u4ea4\u4e92\uff0cfollower\u53ea\u8d1f\u8d23\u5907\u4efd\u6570\u636e\uff0c\u540c\u4e00\u4e2a\u5206\u533a\u7684\u526f\u672c\u5fc5\u987b\u5206\u5e03\u5728\u4e0d\u540c\u7684broker\u4e0a\uff0c\u6240\u4ee5\u5206\u533a\u7684\u526f\u672c\u6570\u4e0d\u80fd\u8bbe\u7f6e\u8d85\u8fc7Kafka\u96c6\u7fa4\u4e2d\u7684broker\u6570\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafka_1","title":"Kafka\u9ad8\u541e\u5410\u7684\u539f\u56e0\uff1f","text":"<p>\u4e00\u662f\u5206\u5e03\u5f0f\u67b6\u6784\u3002</p> <p>\u4e8c\u662f\u5199\u6570\u636e\u65f6\u91c7\u7528\u987a\u5e8f\u5199\u78c1\u76d8\u548c\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u6bcf\u4e2a\u5206\u533a\u7684\u526f\u672c\u7684\u4fdd\u5b58\u91c7\u7528\u4e86\u5206\u7247\u548c\u7d22\u5f15\u673a\u5236\uff0c\u5206\u7247\u5c31\u662f\u5c06\u6570\u636e\u5206\u6210\u591a\u4e2asegment\uff0c\u6bcf\u4e2asegment\u5bf9\u5e94\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u6bcf\u4e2asegment\u4e2d\u90fd\u521b\u5efa\u4e86\u7d22\u5f15\uff1b\u8bfb\u6570\u636e\u65f6\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u5b9a\u4f4d\u6d88\u606f\u5728\u54ea\u4e00\u4e2asegment\uff0c\u7136\u540e\u5229\u7528segment\u5bf9\u5e94\u7684\u7d22\u5f15\u5c31\u80fd\u5feb\u901f\u627e\u5230\u6d88\u606f\u7684\u4f4d\u7f6e\u3002</p> <p>Kafka\u4f7f\u7528\u7684\u96f6\u62f7\u8d1d\u6280\u672f\u662fsendfile+SGDMA(Scatter-Gather DMA)\uff0c\u6d89\u53ca\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u2460 \u751f\u4ea7\u8005-&gt;Kafka\uff1a\u4ece\u7f51\u5361\u4e2d\u8bfb\u6570\u636e\u7136\u540e\u5199\u5230\u78c1\u76d8\u4e2d\uff0c\u2461Kafka-&gt;\u6d88\u8d39\u8005\uff1a\u4ece\u78c1\u76d8\u4e2d\u8bfb\u6570\u636e\u7136\u540e\u5199\u5230\u7f51\u5361\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_1","title":"\u96f6\u62f7\u8d1d\u6280\u672f\uff1f","text":"<p>\u4ece\u78c1\u76d8\u8bfb\u6570\u636e\uff0c\u7136\u540e\u5199\u5230\u7f51\u7edc\u8bbe\u5907\u4e2d\u53d1\u51fa\u53bb\uff0cread+write\u662f\u6700\u4f20\u7edf\u7684\u65b9\u5f0f\uff0c\u4ee5\u4e0b\u662f\u5b9e\u73b0\u96f6\u62f7\u8d1d\u5e38\u7528\u7684\u6280\u672f\uff1a</p> <ol> <li> <p>mmap\uff1a\u76f4\u63a5\u5c06\u6570\u636e\u4ece \u5185\u6838\u8bfb\u7f13\u51b2\u533a \u5199\u5230 \u5185\u6838\u5199\u7f13\u51b2\u533a\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u5c06\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\u7684\u6210\u672c\u3002</p> </li> <li> <p>sendfile\uff1a\u76f8\u6bd4\u4e8emmap\u53ea\u662f\u51cf\u5c11\u4e00\u6b21\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\uff0c\u6570\u636e\u540c\u6837\u662f\u76f4\u63a5\u4ece\u5185\u6838\u7684\u8bfb\u7f13\u51b2\u533a\u5199\u5230\u4e86\u5185\u6838\u5199\u7f13\u51b2\u533a\u3002\u56e0\u4e3a\u53ea\u5728\u5185\u6838\u6001\u8fdb\u884c\uff0c\u6240\u4ee5\u7528\u6237\u8fdb\u7a0b\u65e0\u6cd5\u64cd\u4f5c\u6570\u636e\uff0c\u4ee3\u7801\u4e0a\u7684\u4f53\u73b0\u5c31\u662f\uff0c\u4f7f\u7528mmap\u662f\u4e24\u90e8\u641e\u5b9a\u7684\uff0c\u6240\u4ee5\u4e2d\u95f4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u4f46\u662f\u4f7f\u7528snedfile\u662f\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u6ca1\u6709\u64cd\u4f5c\u6570\u636e\u7684\u4f59\u5730\u3002</p> </li> <li> <p>sendfile+SGDMA(Scatter-Gather DMA)\uff1a\u76f8\u6bd4\u4e8e\u53ea\u4f7f\u7528sendfile\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u6570\u636e\u76f4\u63a5\u4ece\u5185\u6838\u8bfb\u7f13\u51b2\u533a\u6620\u5c04\u5230\u5185\u6838\u5199\u7f13\u51b2\u533a\u7684\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#zookeeperkafak","title":"zookeeper\u5bf9\u4e8eKafak\u7684\u4f5c\u7528\uff1f","text":"<p>1.\u501f\u52a9Zookeeper\u5b8c\u6210Kafka\u96c6\u7fa4\u4e2d\u4e3b\u673a\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf\u3002</p> <p>2.\u501f\u52a9Zookeeper\u5b8c\u6210controller\u7684\u9009\u4e3e\u3002</p> <p>3.\u501f\u52a9Zookeeper\u4fdd\u5b58\u96c6\u7fa4\u7684\u516c\u5171\u4fe1\u606f\uff0c\u4f7f\u5f97\u6bcf\u53f0Kafka\u4e3b\u673a\u80fd\u540c\u6b65\u83b7\u53d6\u5230\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5982\u6709\u591a\u5c11\u4e2atopic\uff0c\u6bcf\u4e2atopic\u6709\u591a\u5c11\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u6709\u591a\u5c11\u4e2a\u526f\u672c\uff0c\u90fd\u653e\u5728\u54ea\uff0c\u526f\u672c\u4e2d\u8c01\u662fleader\uff0c\u8c01\u662ffollower\u3002</p> <p>4.\u501f\u52a9Zookeeper\u5b8c\u6210\u6d88\u8d39\u8005\u7684\u52a8\u6001\u4e0a\u4e0b\u7ebf\uff0c\u6d88\u8d39\u8005\u7ec4\u91cc\u6709\u6d88\u8d39\u8005\u52a8\u6001\u4e0a\u4e0b\u7ebf\u65f6\uff0cKafka\u5c31\u80fd\u53ca\u65f6\u6536\u5230\u901a\u77e5\uff0c\u7136\u540e\u8fdb\u884cRebalance\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafka_controller","title":"Kafka controller \u7684\u4f5c\u7528\uff1f","text":"<p>Kafka controller \u7684\u4f5c\u7528\u662f\u7ba1\u7406\u548c\u534f\u8c03Kafka\u96c6\u7fa4\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ol> <li>\u4e3b\u9898\u7ba1\u7406\uff1a\u521b\u5efa\u3001\u5220\u9664Topic\uff0c\u4ee5\u53ca\u589e\u52a0Topic\u5206\u533a\u7b49\u64cd\u4f5c\u90fd\u662f\u7531\u63a7\u5236\u5668\u6267\u884c\u3002</li> <li>\u5206\u533a\u5206\u914d\uff1a\u5c06\u5206\u533a\u7684\u5206\u914d\u5230broker\uff0c\u4e5f\u662f\u7531controller\u5b9e\u73b0\u3002</li> <li>\u526f\u672cleader\u7684\u9009\u4e3e\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#controller","title":"\u9632\u6b62controller\u8111\u88c2\uff1f","text":"<p>\u5982\u679ccontroller\u6240\u5728broker\u6302\u6389\u4e86\uff0c\u6216\u8005Full GC\u505c\u987f\u65f6\u95f4\u592a\u957f\u8d85\u8fc7zookeeper<code>session timeout</code>\u51fa\u73b0\u5047\u6b7b\uff0cKafka\u96c6\u7fa4\u5fc5\u987b\u9009\u4e3e\u51fa\u65b0\u7684controller\uff0c\u4f46\u4e4b\u540e\u88ab\u53d6\u4ee3\u7684controller\u53c8\u6062\u590d\u6b63\u5e38\u4e86\uff0c\u5b83\u4f9d\u65e7\u662fcontroller\u8eab\u4efd\uff0c\u8fd9\u6837\u96c6\u7fa4\u5c31\u4f1a\u51fa\u73b0\u4e24\u4e2acontroller\uff0c\u8fd9\u5c31\u662fcontroller\u8111\u88c2\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3Controller\u8111\u88c2\u95ee\u9898\uff0cZooKeeper\u4e2d\u8fd8\u6709\u4e00\u4e2a\u4e0eController\u6709\u5173\u7684\u6301\u4e45\u8282\u70b9/controller_epoch\uff0c\u5b58\u653e\u7684\u662f\u4e00\u4e2a\u6574\u578b\u503c\u7684epoch number\uff08\u7eaa\u5143\u7f16\u53f7\uff0c\u4e5f\u79f0\u4e3a\u9694\u79bb\u4ee4\u724c\uff09\uff0c\u96c6\u7fa4\u4e2d\u6bcf\u9009\u4e3e\u4e00\u6b21\u63a7\u5236\u5668\uff0c\u5c31\u4f1a\u901a\u8fc7Zookeeper\u521b\u5efa\u4e00\u4e2a\u6570\u503c\u66f4\u5927\u7684epoch number\uff0c\u5982\u679c\u6709broker\u6536\u5230\u6bd4\u8fd9\u4e2aepoch\u6570\u503c\u5c0f\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u5ffd\u7565\u6d88\u606f\u3002</p> <p>\u5206\u533aleader\u7684\u8111\u88c2\u95ee\u9898\u4e5f\u662f\u9760epoch\u89e3\u51b3\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#leader","title":"\u526f\u672cleader\u7684\u9009\u4e3e\uff1f","text":"<p>\u5206\u533a\u526f\u672c\u7684leader\u7531controller\u6765\u9009\u4e3e\uff0c\u5f53\u5206\u533aleader\u4e0d\u53ef\u7528\u7684\u65f6\u5019\uff0cKafka\u4f1a\u4eceZookeeper\u4e2d\u8bfb\u53d6\u5f53\u524d\u5206\u533a\u7684ISR(in-sync replicas)\u96c6\u5408\uff0c\u7136\u540e\u8c03\u7528\u914d\u7f6e\u7684\u5206\u533a\u9009\u62e9\u7b97\u6cd5\u4eceISR\u4e2d\u9009\u62e9\u5206\u533a\u7684leader\u3002\u6781\u7aef\u60c5\u51b5\uff0c\u5982\u679cISR\u96c6\u5408\u4e2d\u7684\u6240\u6709\u5206\u533a\u90fd\u6302\u4e86\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9009\u62e9\u662f\u5426\u8fdb\u884cunclean leader\u9009\u4e3e\u3002</p> <p>unclean leader\u9009\u4e3e\uff1aKafka\u628a\u4e0d\u5728ISR\u5217\u8868\u4e2d\u7684\u5b58\u6d3b\u526f\u672c\u79f0\u4e3a\u201c\u975e\u540c\u6b65\u526f\u672c\u201d\uff0c\u8fd9\u4e9b\u526f\u672c\u4e2d\u7684\u6d88\u606f\u8fdc\u8fdc\u843d\u540e\u4e8eleader\uff0c\u5982\u679c\u9009\u4e3e\u8fd9\u79cd\u526f\u672c\u4f5c\u4e3aleader\u7684\u8bdd\u5c31\u53ef\u80fd\u9020\u6210\u6570\u636e\u4e22\u5931\u3002Kafka broker\u7aef\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53c2\u6570<code>unclean.leader.election.enable</code>\uff0c\u7528\u4e8e\u63a7\u5236\u662f\u5426\u5141\u8bb8\u975e\u540c\u6b65\u526f\u672c\u53c2\u4e0eleader\u9009\u4e3e\uff1b\u5982\u679c\u5f00\u542f\uff0c\u5219\u5f53ISR\u4e3a\u7a7a\u65f6\u5c31\u4f1a\u4ece\u8fd9\u4e9b\u526f\u672c\u4e2d\u9009\u4e3e\u65b0\u7684leader\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3aUnclean leader\u9009\u4e3e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafka_2","title":"\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u7684\u6d88\u606f\u4e22\u5931 \uff1f","text":"<p>acks=0\uff1abroker\u4e0d\u4f1a\u53d1\u9001ack\uff0c\u4e8e\u662fproducer\u53d1\u9001\u6d88\u606f\u4e0d\u4f1a\u7b49\u5f85 broker \u7684 ack\u3002\u8fd9\u79cd\u7b56\u7565\u4e0b\u6709\u4e24\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\uff0c\u7b2c\u4e00\u79cd\u60c5\u51b5\u662f\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u4e22\u5931\u6d88\u606f\uff0c\u56e0\u4e3a\u8fde\u63a5\u662ftcp\uff0c\u6240\u4ee5\u53ea\u6709\u80fd\u5728\u8fd0\u8f93\u5c42\u548c\u5e94\u7528\u5c42\u4e4b\u95f4\u4e22\u5931\u6d88\u606f\uff0c\u6240\u4ee5\u51fa\u73b0\u6d88\u606f\u4e22\u5931\u7684\u6982\u7387\u662f\u5f88\u5c0f\uff1b\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u662fFollwer\u540c\u6b65\u6570\u636e\u5b8c\u6210\u4e4b\u524dLeader\u5b95\u673a\u4e5f\u4f1a\u5bfc\u81f4\u4e22\u5931\u6570\u636e\u3002</p> <p>acks=1\uff1aproducer\u6536\u5230broker\u53d1\u9001\u7684ack\u4e4b\u540e\u624d\u4f1a\u8ba4\u4e3a\u6d88\u606f\u53d1\u9001\u6210\u529f\uff0c\u4f46\u662fbroker\u63a5\u6536\u5230producer\u53d1\u9001\u7684\u6570\u636e\u4fdd\u5b58\u6210\u529f\u540e\u5c31\u4f1a\u5411producer\u53d1\u9001ack\uff0c\u4e0d\u4f1a\u7b49\u5230Follower\u540c\u6b65\u5b8cleader\u7684\u6570\u636e\u624d\u53d1\u9001ack\uff0c\u6240\u4ee5\u8fd9\u79cd\u7b56\u7565\u867d\u7136\u4e0d\u4f1a\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u4e22\u5931\u6570\u636e\uff0c\u4f46\u662f\u4f1a\u56e0\u4e3aFollwer\u540c\u6b65\u5b8c\u6210\u4e4b\u524dLeader\u5b95\u673a\u4e22\u5931\u6570\u636e\u3002</p> <p>acks=-1 \u6216 \"all\"\uff1abroker\u4f1a\u7b49ISR\u96c6\u5408\u4e2d\u7684follower\u540c\u6b65\u5b8cleader\u7684\u6570\u636e\u4e4b\u540e\u624d\u53d1\u9001ack\uff0c\u6240\u4ee5\u8fd9\u79cd\u7b56\u7565\u4e0d\u4f1a\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u4e22\u5931\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3aFollwer\u540c\u6b65\u5b8c\u6210\u4e4b\u524dLeader\u5b95\u673a\u4e22\u5931\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#isrin-sync_replica_set","title":"ISR(in-sync replica set)\u96c6\u5408\uff1f","text":"<p>acks=all\u65f6\uff0c\u56e0\u4e3a\u7b49\u5f85\u6240\u6709follower\u90fd\u540c\u6b65\u5b8c\u6570\u636e\u624d\u53d1\u9001ack\u6548\u7387\u592a\u6162\uff0c\u6240\u4ee5Kafka\u91c7\u53d6\u7684\u7b56\u7565\u662f\uff0c\u7ef4\u62a4\u4e00\u4e2a\u540c\u6b65\u6570\u636e\u6bd4\u8f83\u5feb\u7684Follower\u96c6\u5408\uff0c\u5e76\u4e0d\u662f\u6240\u6709follower\uff0c\u5f53\u8fd9\u4e2a\u96c6\u5408\u4e2d\u7684follower\u90fd\u540c\u6b65\u5b8c\u6570\u636e\u5c31\u4f1a\u5411\u751f\u4ea7\u8005\u53d1\u9001ack\uff0c\u8fd9\u4e2a\u96c6\u5408\u5c31\u53ebISR\uff0c\u5982\u679cleader\u6302\u6389\u4e86\u5c31\u4f1a\u5728ISR\u91cc\u9762\u9009\u4e3e\u65b0\u7684leader\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#brokertcp","title":"\u751f\u4ea7\u8005\u3001\u6d88\u8d39\u8005\u4e0eBroker\u4e4b\u95f4\u662f\u4ee5tcp\u7684\u65b9\u5f0f\u5728\u8fdb\u884c\u901a\u4fe1\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u4f1a\u51fa\u73b0\u6d88\u606f\u4e22\u5931\uff1f","text":"<p>producer\u4e0ebroker\u4e4b\u95f4\u662ftcp\u8fde\u63a5\uff0c\u6240\u4ee5\u6d88\u606f\u4e00\u5b9a\u4f1a\u88ab\u53ef\u9760\u4f20\u9001\u5230broker\u4e3b\u673a\u7684\uff0c\u4e0d\u8fc7\u8fd9\u53ea\u662f\u8fd0\u8f93\u5c42\u7684ack\uff0c\u4ece\u8fd0\u8f93\u5c42\u5230\u5e94\u7528\u5c42\u4e4b\u95f4\u4e5f\u53ef\u80fd\u51fa\u73b0\u95ee\u9898\uff0c\u6240\u4ee5\u53ef\u80fd\u4f1a\u6d88\u606f\u4e22\u5931\uff0c\u4e8e\u662f\u4e5f\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u6d88\u606f\u4e71\u5e8f\u7684\u60c5\u51b5\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_2","title":"\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931\uff1f","text":"<ol> <li> <p>\u8bbe\u7f6eProducer\u7aef\u8bbe\u7f6e<code>acks</code>=all</p> </li> <li> <p>topic\u8bbe\u7f6e<code>replication.factor</code>&gt;=3</p> </li> <li> <p>\u8bbe\u7f6e<code>min.insync.replicas</code>&gt;1</p> </li> <li> <p>\u8bbe\u7f6e<code>unclean.leader.election.enable</code>=false\uff0c\u5373\u4e0d\u5141\u8bb8Unclean leader\u9009\u4e3e</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafka_3","title":"\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u7684\u6d88\u606f\u91cd\u590d\uff1f","text":"<p>acks=0\u65f6\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u91cd\u590d\u7684\u95ee\u9898\uff0c\u56e0\u4e3aproducer\u53ea\u4f1a\u53d1\u9001\u4e00\u6b21\u6d88\u606f\uff0c\u4f46\u662facks=1\u548cacks=-1\u5747\u4f1a\u51fa\u73b0\u6570\u636e\u91cd\u590d\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u5728ack\u7684\u7b56\u7565\u4e0b\uff0cproducer\u5747\u53ef\u80fd\u4f1a\u91cd\u590d\u53d1\u9001\u6d88\u606f\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u6d88\u606f\u91cd\u590d\uff0cKafka\u5f15\u5165\u4e86\u5e42\u7b49\u6027\uff0c\u5f00\u542f\u5e42\u7b49\u6027\u4e4b\u540e\uff08<code>enable.idempotence=true</code>\uff0c\u5f00\u542f\u5e42\u7b49\u540e\uff0c\u751f\u4ea7\u8005\u7684ack\u56fa\u5b9a\u4e3a-1\uff09\uff0c\u751f\u4ea7\u8005\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u88ab\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684 PID\uff08\u8be5 PID \u5bf9\u7528\u6237\u5b8c\u5168\u900f\u660e\uff0c\u4e0d\u4f1a\u66b4\u9732\u7ed9\u7528\u6237\uff09\uff0c\u4e4b\u540e\u751f\u4ea7\u8005\u7ed9\u6bcf\u4e2a\u5206\u533a\u7684\u6d88\u606f\u7ef4\u62a4\u4e00\u4e2a\u4ece 0 \u5f00\u59cb\u5355\u8c03\u9012\u589e\u7684<code>Sequence Number</code>\uff0c\u6bcf\u6761\u6d88\u606f\u53d1\u9001\u65f6\u90fd\u4f1a\u9644\u5e26\u4e0a\u8fd9\u4e2a<code>Sequence Number</code>\uff0cBroker \u7aef\u4e5f\u4f1a\u4e3a\u6bcf\u4e00\u4e2a<code>&lt;PID, Topic, Partition&gt;</code>\u7ef4\u62a4\u4e00\u4e2a<code>SeqNumber</code>\uff0c\u53ea\u6709\u5f53\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u7684\u5e8f\u5217\u53f7\u6bd4broker\u7ef4\u62a4\u7684\u5e8f\u5217\u53f7\u59271\u65f6\uff0cbroker\u624d\u4f1a\u63a5\u6536\u5b83\uff0c\u5982\u679c\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u7684\u5e8f\u53f7\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u7ef4\u62a4\u7684<code>SeqNumber</code>\uff0c\u5219\u4e3a\u91cd\u590d\u6d88\u606f\uff08Producer \u629b\u51fa<code>DuplicateSequenceNumber</code>\u5f02\u5e38\uff09\uff0c\u5982\u679c\u751f\u4ea7\u8005\u53d1\u9001\u8fc7\u6765\u7684\u6d88\u606f\u7684\u5e8f\u53f7\u5927\u4e8e\u5f53\u524d\u7ef4\u62a4\u7684<code>SeqNumber</code>+1\uff0c\u5219\u662f\u4e71\u5e8f\u6d88\u606f\uff08Producer \u629b\u51fa<code>InvalidSequenceNumber</code>\u5f02\u5e38\uff09\uff0c\u4e2d\u95f4\u53ef\u80fd\u51fa\u73b0\u4e86\u6d88\u606f\u4e22\u5931\uff08<code>max.in.flight.requests.per.connection=5</code>\uff0c\u8be5\u914d\u7f6e\u9879\u7528\u4e8e\u6307\u5b9a\u6700\u5927\u4e71\u5e8f\u7a0b\u5ea6\uff0c\u7c7b\u4f3c\u4e8e\u6ed1\u52a8\u7a97\u53e3\uff09\u3002\u6240\u4ee5\u5f00\u542f\u5e42\u7b49\u540e\uff0cKafka\u4e0d\u4f46\u80fd\u89e3\u51b3\u6d88\u606f\u91cd\u590d\u7684\u95ee\u9898\uff0c\u8fd8\u80fd\u89e3\u51b3\u6d88\u606f\u4e71\u5e8f\u7684\u95ee\u9898\u3002</p> <p>PID\u662f\u751f\u4ea7\u8005\u548cKafka\u4e00\u6b21\u4f1a\u8bdd\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u6240\u4ee5\u5982\u679c\u751f\u4ea7\u8005\u65ad\u5f00\u8fde\u63a5\u540e\u91cd\u8fdeKafka\u4f1a\u518d\u6b21\u751f\u6210\u4e00\u4e2a\u65b0\u7684PID\uff0c\u8fd9\u65f6\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u5c31\u4e0e\u4e0a\u6b21\u4f1a\u8bdd\u53d1\u9001\u7684\u6d88\u606f\u5c31\u6ca1\u6709\u91cd\u590d\u7684\u5173\u7cfb\u4e86\uff0c\u6240\u4ee5\u5f53\u751f\u4ea7\u8005\u5728\u53d1\u9001\u5b8c\u6d88\u606f\u4e4b\u540e\uff0c\u6ca1\u6709\u63a5\u6536broker\u7684ack\u4e4b\u524d\u6302\u6389\u4e86\uff0c\u4e4b\u540e\u91cd\u542f\u91cd\u53d1\u4e0a\u6b21\u7684\u6d88\u606f\uff0c\u8fd9\u65f6\u56e0\u4e3a\u91cd\u542f\u4e4b\u540ePID\u6539\u53d8\u4e86\uff0c\u6240\u4ee5Broker\u4e0d\u8ba4\u4e3a\u8fd9\u662f\u91cd\u590d\u6d88\u606f\uff0c\u4e8e\u662f\u4ea7\u751f\u91cd\u590d\u6d88\u606f\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u751f\u4ea7\u8005\u91cd\u542f\u5bfc\u81f4\u7684\u6d88\u606f\u91cd\u590d\uff0c\u53ef\u4ee5\u5f00\u542fKafka\u7684\u4e8b\u52a1\uff0cKafka\u7684\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u751f\u4ea7\u8005\u8de8\u5206\u533a\u548c\u8de8\u4f1a\u8bdd\u7684\u539f\u5b50\u5199\u5165\u3002Kafka\u7684\u4e8b\u52a1\u673a\u5236\u4f9d\u8d56\u4e8e\u5e42\u7b49\uff0c\u5f00\u542f kafka\u4e8b\u52a1\u65f6\uff0ckafka \u4f1a\u81ea\u52a8\u5f00\u542f\u5e42\u7b49\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafka_4","title":"Kafka\u4e8b\u52a1\uff1f","text":"<p>Kafka\u4e8b\u52a1\u7684\u5e94\u7528\u573a\u666f\uff1a</p> <p>Kafka\u7684\u4e8b\u52a1\u5bf9\u4e8e\u751f\u4ea7\u8005\u800c\u8a00\u63d0\u4f9b\u4e86\u539f\u5b50\u5199\u5165\uff08<code>transactional.id = 'some unique id'</code>\uff09\uff0c\u751f\u4ea7\u8005\u4e8b\u52a1\u53ef\u4ee5\u662f\u8de8\u5206\u533a\u548c\u8de8\u4f1a\u8bdd\u7684\uff1b\u5bf9\u4e8e\u6d88\u8d39\u8005\u800c\u8a00\uff0c\u63d0\u4f9b\u4e86 \u8bfb\u672a\u63d0\u4ea4 \u548c \u8bfb\u5df2\u63d0\u4ea4 \u4e24\u79cd\u9694\u79bb\u7ea7\u522b\uff08<code>isolation.level=\"read_committed\"</code> \u6216 <code>\"isolation.level=read_uncommitted\"</code>\uff09\uff0c\u4e0d\u5305\u542boffset\u7684\u63d0\u4ea4\u3002</p> <p>\u53e6\u5916\uff0cKafka\u4e8b\u52a1\u8fd8\u4fdd\u8bc1\u4e86\u4e00\u79cd\u7279\u5b9a\u573a\u666f\u4fdd\u8bc1\u7684\u539f\u5b50\u6027\uff0c\u5373<code>conumser-transform-produce</code> \u5e94\u7528\u6a21\u5f0f\uff08\u4ece\u67d0\u4e2a Topic \u6d88\u8d39\u6570\u636e\uff0c\u7ecf\u8fc7\u4e00\u7cfb\u5217\u8f6c\u6362\u540e\u5199\u56de\u53e6\u4e00\u4e2a Topic\uff0c\u4e3b\u8981\u662f\u9488\u5bf9 Kafka Stream \u5e94\u7528\u800c\u8a00\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_3","title":"\u5982\u4f55\u5b9e\u73b0\u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u5185\u8de8\u5206\u533a\u7684\u539f\u5b50\u5199\u5165\uff1f","text":"<p>~~\u4e3a\u652f\u6301\u4e8b\u52a1\uff0cKafka\u5f15\u5165\u4e86\u4e24\u4e2a\u65b0\u7684\u7ec4\u4ef6\uff1aTransaction Coordinator \u548c Transaction Log\uff0ctransaction coordinator \u662f\u8fd0\u884c\u5728\u6bcf\u4e2a kafka broker \u4e0a\u7684\u4e00\u4e2a\u7ebf\u7a0b\uff0ctransaction log \u662f kafka \u7684\u4e00\u4e2a\u5185\u90e8 topic\uff0ctransaction log \u6709\u591a\u4e2a\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u90fd\u6709\u4e00\u4e2a leader\uff0c\u8be5 leader\u5bf9\u5e94\u54ea\u4e2a kafka broker\uff0c\u54ea\u4e2a broker \u4e0a\u7684 transaction coordinator \u5c31\u8d1f\u8d23\u5bf9\u8fd9\u4e9b\u5206\u533a\u7684\u5199\u64cd\u4f5c\uff0ctransaction log \u5185\u90e8\u5b58\u50a8\u7684\u53ea\u662f\u4e8b\u52a1\u7684\u6700\u65b0\u72b6\u6001\u548c\u5176\u76f8\u5173\u5143\u6570\u636e\u4fe1\u606f\uff0cKafka\u5206\u533a\u7684\u526f\u672c\u673a\u5236\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u72b6\u6001\u7684\u5bb9\u9519\u3002~~</p> <p>\u8de8\u5206\u533a\u4e8b\u52a1\u7684\u539f\u5b50\u5199\u5165\u4f7f\u7528\u4e86\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\uff082pc, 2 Phase Commit\uff09\uff0c2pc\u534f\u8bae\u662f\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u4e00\u79cd\u65b9\u6cd5\uff0c2pc\u534f\u8bae\u7684\u5b9e\u73b0\u9700\u8981\u4e00\u4e2a\u534f\u8c03\u8005\uff0c\u548c\u591a\u4e2a\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\uff0c\u7136\u540e\u4e8b\u52a1\u7684\u63d0\u4ea4\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>\u51c6\u5907\u9636\u6bb5\uff1a\u53c8\u53eb\u4f5c\u6295\u7968\u9636\u6bb5\uff0c\u5728\u8fd9\u4e00\u9636\u6bb5\uff0c\u534f\u8c03\u8005\u8be2\u95ee\u4e8b\u52a1\u7684\u6240\u6709\u53c2\u4e0e\u8005\u662f\u5426\u51c6\u5907\u597d\u63d0\u4ea4\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u534f\u8c03\u8005\u5411\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u53d1\u51faPrepare\u547d\u4ee4\u65f6\uff0c\u8868\u793a\u6b64\u65f6\u6240\u6709\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u90fd\u5df2\u7ecf\u5b8c\u6210\u4e86\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u6240\u6709redo\u65e5\u5fd7\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u53ea\u5dee\u6700\u540e\u4e00\u4e2a\u63d0\u4ea4\u64cd\u4f5c\u4e86\u3002</li> <li>\u63d0\u4ea4\u9636\u6bb5\uff1a\u534f\u8c03\u8005\u5411\u53c2\u4e0e\u8005\u53d1\u9001 Commit \u6307\u4ee4 \u6216\u8005 Abort\u6307\u4ee4\u3002</li> </ul> <p>Kafka\u7684transaction coordinator\u5c31\u662f2pc\u7684\u534f\u8c03\u8005\uff0c\u6bcf\u4e2a\u5206\u533a\u7684\u6240\u5728\u7684broker\u5c31\u662f\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_4","title":"\u5982\u4f55\u4fdd\u8bc1\u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u5185\u8de8\u4f1a\u8bdd\u6d88\u606f\u4e0d\u91cd\u590d\uff1f","text":"<p>Kafka\u4e8b\u52a1\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u4e00\u4e2a\u7a33\u5b9a\u7684\uff0c\u5e76\u4e14\u91cd\u542f\u540e\u4e0d\u53d8\u7684\uff0c\u552f\u4e00\u7684<code>Transaction ID</code>\uff0c\u5e76\u5c06<code>Transactin ID</code>\u4e0e<code>PID</code>\u7ed1\u5b9a\uff0c\u8fd9\u6837\u5f53Producer\u91cd\u542f\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u6b63\u5728\u8fd0\u884c\u7684 <code>Transaction ID</code> \u83b7\u5f97\u539f\u6765\u7684 <code>PID</code>\u3002\uff08\u6ce8\u610f\uff1a<code>Transaction ID</code>\u7531\u7528\u6237\u63d0\u4f9b\uff0c\u91cd\u542f\u540e\u4e0d\u4f1a\u53d8\uff0c\u800c<code>PID</code>\u662f\u5185\u90e8\u7684\u5b9e\u73b0\uff0c\u5bf9\u7528\u6237\u900f\u660e\u3002\u6ca1\u6709\u5f00\u542f\u4e8b\u52a1\u65f6\uff0c\u751f\u4ea7\u8005\u6bcf\u6b21\u91cd\u542f\u90fd\u4f1a\u5206\u914d\u65b0\u7684<code>PID</code>\uff0c\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u662f\u901a\u8fc7<code>Transactin ID</code>\u83b7\u53d6\u539f\u6765\u7684<code>PID</code>\uff0c\u6240\u4ee5\u751f\u4ea7\u8005\u7684<code>PID</code>\u4e0d\u4f1a\u53d8\uff0c\u4e8e\u662fKafka\u7684\u5e42\u7b49\u5199\u5165\u6709\u6548\u3002\uff09</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#transactionalid","title":"\u5982\u4f55\u9009\u7528\u4e00\u4e2a\u5168\u5c40\u4e00\u81f4\u7684 <code>transactional.id</code>\uff1f","text":"<p>\u901a\u8fc7\u67d0\u79cd\u673a\u5236\u6765\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 <code>transactional.id</code>\uff0c\u7136\u540e\u901a\u8fc7\u4e00\u4e2a\u7edf\u4e00\u7684\u5916\u90e8\u5b58\u50a8\uff0c\u6765\u8bb0\u5f55\u751f\u4ea7\u8005\u4f7f\u7528\u7684 <code>transactional.id</code> \u548c\u8be5\u751f\u4ea7\u8005\u6d89\u53ca\u5230\u7684 <code>&lt;topic, partition&gt;</code> \u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#zombie_producers","title":"\u5982\u4f55\u5c4f\u853d\u50f5\u5c38\u751f\u4ea7\u8005 \uff08zombie producers\uff09\uff1f","text":"<p>\u6240\u8c13\u50f5\u5c38\u751f\u4ea7\u8005\u5c31\u662f\uff0c\u65e7\u7684\u751f\u4ea7\u8005\u5b95\u673a\u4e4b\u540e\uff0c\u5728\u751f\u4ea7\u8005\u96c6\u7fa4\u91cc\u7684\u53e6\u4e00\u53f0\u4e3b\u673a\u63a5\u66ff\u8fd9\u4e2a\u751f\u4ea7\u8005\u7684\u804c\u8d23\uff0c\u4e5f\u5c31\u662f\u8981\u5230\u4e86\u5b83\u7684<code>Transaction ID</code>\u7ee7\u7eed\u5de5\u4f5c\uff08\u8fd9\u4e0e\u5355\u4e2a\u751f\u4ea7\u8005\u91cd\u542f\u4e0d\u540c\uff09\uff0c\u4e0d\u5c31\u4e4b\u540e\u4e4b\u524d\u7684\u90a3\u4e2a\u751f\u4ea7\u8005\u91cd\u542f\u6210\u529f\u4e86\uff0c\u6b64\u65f6\u5c31\u4f1a\u5bfc\u81f4\u6709\u4e24\u4e2a\u76f8\u540c\u7684\u751f\u4ea7\u8005\u5177\u6709\u76f8\u540c\u7684<code>Transaction ID</code>\u548c<code>PID</code>\uff0c\u8fd9\u663e\u7136\u4f1a\u5bfc\u81f4\u6d88\u606f\u91cd\u590d\uff0c\u91cd\u542f\u540e\u7684\u8fd9\u4e2a\u751f\u4ea7\u8005\u5c31\u662f\u6240\u8c13\u7684\u50f5\u5c38\u751f\u4ea7\u8005 \uff08zombie producers\uff09\u3002</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u65b0\u7684 Producer \u542f\u52a8\u540e\uff0c\u65e7\u7684\u5177\u6709\u76f8\u540c<code>Transaction ID</code>\u7684 Producer \u5373\u5931\u6548\uff0c\u6bcf\u6b21 Producer \u901a\u8fc7<code>Transaction ID</code>\u62ff\u5230 <code>PID</code> \u7684\u540c\u65f6\uff0c<code>transactional coordinator</code>\u4f1a\u9012\u589e\u7684 epoch\uff0c\u7531\u4e8e\u65e7\u7684 Producer \u7684 epoch \u6bd4\u65b0 Producer \u7684 epoch \u5c0f\uff0c\u6240\u4ee5Kafka \u53ef\u4ee5\u5f88\u5bb9\u6613\u8bc6\u522b\u51fa\u8be5 Producer \u662f\u8001\u7684 Producer \u5e76\u62d2\u7edd\u5176\u8bf7\u6c42\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_5","title":"\u751f\u4ea7\u8005\u53d1\u9001\u6d88\u606f\u7684\u6d41\u7a0b\uff1f","text":"<p>\u9996\u5148\u7ecf\u8fc7\u62e6\u622a\u5668\uff0c\u7136\u540e\u7ecf\u8fc7\u5e8f\u5217\u5316\u5668\uff0c\u6700\u540e\u7ecf\u8fc7\u5206\u533a\u5668\u5199\u5230\u53d1\u9001\u7ebf\u7a0b\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u4e4b\u540e\u53d1\u9001\u7ebf\u7a0b\u4f1a\u628a\u6570\u636e\u53d1\u9001\u5230\u76f8\u5e94\u7684broker\u4e0a\u3002\u56e0\u4e3a\u662f\u53e6\u5916\u4e00\u4e2a\u5355\u72ec\u7684\u53d1\u9001\u7ebf\u7a0b\u5728\u53d1\u9001\u6570\u636e\uff0c\u6240\u4ee5\u4e0e\u751f\u4ea7\u8005\u7684\u4e3b\u7ebf\u7a0b\u662f\u5f02\u6b65\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#producerrecord","title":"ProducerRecord\u7684\u6570\u636e\u7ed3\u6784\uff1f","text":"<ul> <li><code>Topic</code> - \u4e3b\u9898</li> <li><code>Partition</code> - \u5206\u533a\uff08\u975e\u5fc5\u586b\uff09</li> <li><code>Key</code> - \u952e\uff08\u975e\u5fc5\u586b\uff09</li> <li><code>Value</code> - \u503c</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_6","title":"\u751f\u4ea7\u8005\u5982\u4f55\u786e\u5b9a\u5c06\u6d88\u606f\u53d1\u9001\u5230\u54ea\u4e2a\u5206\u533a\uff1f","text":"<ol> <li> <p>\u5728ProducerRecord \u6307\u660e partition \u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u5c06\u6307\u660e\u7684\u503c\u76f4\u63a5\u4f5c\u4e3a partiton \u503c\u3002</p> </li> <li> <p>\u5728ProducerRecord \u6ca1\u6709\u6307\u660e partition \u503c\u4f46\u6709 key \u7684\u60c5\u51b5\u4e0b\uff0c\u5c06 key \u7684 hash \u503c\u4e0e topic \u7684 partition \u6570\u8fdb\u884c\u53d6\u4f59\u5f97\u5230 partition \u503c\uff0c\u8be5\u65b9\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u5177\u6709\u76f8\u540ckey\u7684\u6d88\u606f\u8fdb\u5165\u5230\u540c\u4e00\u4e2a\u5206\u533a</p> </li> <li> <p>ProducerRecord \u65e2\u6ca1\u6709 partition \u503c\u53c8\u6ca1\u6709 key \u503c\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c06\u8fde\u7eed\u7684\u6d88\u606f\u53d1\u9001\u7ed9\u4e00\u4e2a\u5206\u533a\uff0c\u7136\u540e\u518d\u5c06\u4e0b\u4e00\u6ce2\u8fde\u7eed\u6d88\u606f\u53d1\u9001\u7ed9\u4e0b\u4e00\u4e2a\u5206\u533a\u3002\u63a7\u5236\u53f0\u5ba2\u6237\u7aef\u751f\u4ea7\u8005\u5c31\u662f\u8fd9\u79cd\u7b56\u7565\uff0c\u56e0\u4e3a\u63a7\u5236\u53f0\u751f\u4ea7\u8005\u53ea\u80fd\u63d0\u4f9bvalue\u3002</p> </li> <li> <p>\u7528\u6237\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5206\u533a\u7b56\u7565</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#broker_broker_leaderbroker","title":"\u751f\u4ea7\u8005 \u5411 Broker \u53d1\u9001\u6d88\u606f\u65f6\u662f\u600e\u4e48\u786e\u5b9a\u5411\u54ea\u4e00\u4e2a Broker \u53d1\u9001\u6d88\u606f\uff1f\u6362\u8a00\u4e4b\u5c31\u662f\u600e\u4e48\u77e5\u9053\u5206\u533aleader\u5728\u54ea\u4e00\u53f0Broker\u4e0a\u7684\uff1f","text":"<p>\u751f\u4ea7\u8005\u4f1a\u5411\u4efb\u610f broker \u53d1\u9001\u4e00\u4e2a\u5143\u6570\u636e\u8bf7\u6c42\uff08<code>MetadataRequest</code>\uff09\uff0c\u83b7\u53d6\u5230\u6bcf\u4e00\u4e2a\u5206\u533a\u5bf9\u5e94\u7684 Leader \u4fe1\u606f\uff0c\u5e76\u7f13\u5b58\u5230\u672c\u5730\u3002\u7136\u540e\u751f\u4ea7\u8005\u5728\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u4f1a\u6307\u5b9a Partition \u6216\u8005\u901a\u8fc7 key \u5f97\u5230\u5230\u4e00\u4e2a Partition\uff0c\u7136\u540e\u6839\u636e Partition \u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u76f8\u5e94\u7684 Leader \u4fe1\u606f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafkaoffset","title":"Kafka\u5982\u4f55\u7ef4\u62a4\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u72b6\u6001\uff1f\u6d88\u8d39\u8005\u7ec4\u7684offset\u662f\u4ec0\u4e48\uff1f","text":"<p>\u6d88\u8d39\u8005\u7ec4\u4f9d\u9760offset\u6765\u7ef4\u62a4\u6d88\u8d39\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6d88\u8d39\u8005\u7ec4\u4e0b\u7ebf\u540e\u518d\u4e0a\u7ebf\u65f6\uff0c\u80fd\u77e5\u9053\u4e0a\u4e00\u6b21\u6d88\u8d39\u7684\u4f4d\u7f6e\u3002\u6d88\u8d39\u8005\u662f\u4ee5\u6d88\u8d39\u8005\u7ec4\u4e3a\u5355\u4f4d\u6d88\u8d39topic\u4e2d\u7684\u6d88\u606f\uff0c\u53c8\u56e0\u4e3a\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u7684\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u6d88\u8d39\u8005\u4e0d\u80fd\u540c\u65f6\u6d88\u8d39\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u4f5c\u4e3akey\u6765\u7ef4\u62a4\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u5728\u4e00\u4e2a\u5206\u533a\u4e0a\u7684\u6d88\u8d39\u4f4d\u7f6e\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0boffset\u4fdd\u5b58\u5728Kafka\u7684\u4e00\u4e2atopic\u91cc\u3002"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#offset","title":"offset\u7684\u63d0\u4ea4\u65b9\u5f0f\uff1f","text":"<p>Kafka\u4f9d\u9760offset\u6765\u7ef4\u62a4\u6d88\u8d39\u8005\u7ec4\u5728\u6bcf\u4e2a\u5206\u533a\u4e0a\u7684\u6d88\u8d39\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u6d88\u8d39\u4f4d\u7f6e\u53ea\u4e0e\u6d88\u8d39\u8005\u6709\u5173\uff0c\u6240\u4ee5offset\u503c\u7684\u6539\u53d8\u9700\u8981\u6d88\u8d39\u8005\u6765\u786e\u5b9a\uff0c\u4e5f\u5c31\u662fKafka\u9700\u8981\u6d88\u8d39\u8005\u81ea\u5df1\u6765\u7ef4\u62a4\u8fd9\u4e2aoffset\u3002\u4e0d\u8fc7Kafka\u7ed9\u6d88\u8d39\u8005\u63d0\u4f9b\u4e86\u7ef4\u62a4offset\u7684\u9ed8\u8ba4\u65b9\u5f0f\uff1a\u81ea\u52a8\u63d0\u4ea4 \u548c \u624b\u52a8\u63d0\u4ea4\uff0c</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_7","title":"\u4e3a\u4ec0\u4e48\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u7684\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u6d88\u8d39\u8005\u4e0d\u80fd\u540c\u65f6\u6d88\u8d39\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\uff1f","text":"<p>\u56e0\u4e3aoffset\u662f\u4ee5\u6d88\u8d39\u8005\u4e3a\u5355\u4f4d\u8fdb\u884c\u7ef4\u62a4\u7684\uff0c\u800c\u4e0d\u662f\u4ee5\u5355\u4e2a\u6d88\u8d39\u8005\u4e3a\u5355\u4f4d\uff0c\u6bd4\u5982\u8bf4\u5982\u679c\u6709\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u7684A\u3001B\u4e24\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\uff0cA\u6d88\u8d39\u8005\u6d88\u8d39\u8fd9\u4e2a\u5206\u533a\u76841\u30012\u30013\u53f7\u6d88\u606f\uff0cB\u6d88\u8d39\u8005\u6d88\u8d39\u8fd9\u4e2a\u5206\u533a\u76844\u30015\u30016\u53f7\u6d88\u606f\uff0c\u7136\u540eB\u6d88\u8d39\u8005\u5148\u63d0\u4ea4\u4fee\u6539offset\u4e3a6\uff0c\u63a5\u7740A\u6d88\u8d39\u8005\u63d0\u4ea4\u4fee\u6539offset\u4e3a3\uff0c\u90a3\u4e48\u5c31\u51fa\u73b0\u95ee\u9898\u4e86\uff0c\u8fd9\u4e0e\u591a\u7ebf\u7a0b\u4fee\u6539\u540c\u4e00\u4e2a\u53d8\u91cf\u7c7b\u4f3c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_8","title":"\u4ec0\u4e48\u662f\u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565\uff1f","text":"<p>\u5c06\u4e00\u4e2atopic\u7684\u591a\u4e2a\u5206\u533a\u5206\u914d\u7ed9\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5c31\u662f\u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565\u3002\u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565\u8981\u5728\u4fdd\u8bc1\u540c\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u7684\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u6d88\u8d39\u8005\u4e0d\u80fd\u540c\u65f6\u6d88\u8d39\u540c\u4e00\u4e2a\u5206\u533a\u7684\u6d88\u606f\u7684\u524d\u63d0\u4e0b\uff0c\u5b9e\u73b0\u5404\u4e2a\u6d88\u8d39\u8005\u8d1f\u8f7d\u5747\u8861\u3002Kafka\u6d88\u8d39\u8005\u7ec4\u7684\u5206\u533a\u5206\u914d\u7b56\u7565\u6709\uff1a</p> <ul> <li>RangeAssignor</li> <li>RoundRobinAssignor</li> <li>StickyAssignor</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#rebalance","title":"\u4ec0\u4e48\u662fRebalance\uff1f","text":"<p>\u5f53\u6709\u65b0\u7684\u6d88\u8d39\u8005\u52a0\u5165\u6d88\u8d39\u8005\u7ec4\uff0c\u6216\u8005\u6709\u6d88\u8d39\u8005\u9000\u51fa\u6d88\u8d39\u8005\u7ec4\uff0c\u6216\u8005topic\u65b0\u589e\u5206\u533a\u65f6\uff0c\u90fd\u9700\u8981\u5c06\u5206\u533a\u91cd\u65b0\u5206\u914d\u7ed9\u6d88\u8d39\u8005\u7ec4\u91cc\u9762\u7684\u591a\u4e2a\u6d88\u8d39\u8005\uff0c\u8fd9\u5c31\u53ebRebalance\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_9","title":"\u6d88\u8d39\u8005\u7684 \u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39 \u95ee\u9898\uff1f","text":"<p>\u5728\u624b\u52a8\u63d0\u4ea4offset \u548c \u81ea\u52a8\u63d0\u4ea4offset\u4e24\u79cd\u65b9\u5f0f\u4e2d\uff0c\u90fd\u4f1a\u51fa\u73b0\u6d88\u8d39\u8005\u7684 \u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39 \u95ee\u9898\u3002</p> <p>\u81ea\u52a8\u63d0\u4ea4\u7684\u65f6\u95f4\u95f4\u9694\u8bbe\u7f6e\u5f97\u592a\u77ed\uff0c\u4f1a\u9020\u6210\u6d88\u8d39\u8005\u8fd8\u6ca1\u6709\u6d88\u8d39\u5b8c\u8fd9\u6279\u6570\u636e\u65f6\u5c31\u63d0\u524d\u63d0\u4ea4\uff0c\u5982\u679c\u8fd9\u65f6\u6d88\u8d39\u8005\u6302\u6389\u4e86\uff0c\u91cd\u542f\u540e\u5c31\u4e0d\u4f1a\u7ee7\u7eed\u6d88\u8d39\u4e0a\u6b21\u8fd8\u6ca1\u6709\u6d88\u8d39\u5b8c\u7684\u6570\u636e\uff0c\u800c\u76f4\u63a5\u6d88\u8d39\u4e0b\u4e00\u6279\u6570\u636e\uff0c\u9020\u6210\u6d88\u8d39\u8005\u6d88\u606f\u4e22\u5931\u7684\u95ee\u9898\uff08\u6216\u8005\u79f0\u4e3a\u6570\u636e\u6f0f\u6d88\u8d39\u3001\u6d88\u8d39\u4e22\u5931\uff09\u3002\u8bbe\u7f6e\u5f97\u592a\u957f\uff0c\u4f1a\u9020\u6210\u6d88\u8d39\u8005\u5df2\u7ecf\u6d88\u8d39\u5b8c\u8fd9\u6279\u6570\u636e\uff0c\u4f46\u662f\u5374\u8fdf\u8fdf\u6ca1\u6709\u63d0\u4ea4\uff0c\u5982\u679c\u8fd9\u65f6\u6d88\u8d39\u8005\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u91cd\u542f\u4e4b\u540e\u6d88\u8d39\u8005\u4f1a\u5c06\u4e0a\u6b21\u5df2\u7ecf\u6d88\u8d39\u4e86\u7684\u6570\u636e\u518d\u6b21\u91cd\u65b0\u6d88\u8d39\u4e00\u6b21\uff0c\u8fd9\u5c31\u662f\u91cd\u590d\u6d88\u8d39\u95ee\u9898\u3002</p> <p>\u5728\u624b\u52a8\u63d0\u4ea4\u65b9\u5f0f\u4e2d\uff0c\u5982\u679c\u5148\u63d0\u4ea4 offset \u540e\u6d88\u8d39\uff0c\u53ef\u80fd\u9020\u6210\u6d88\u8d39\u4e22\u5931\u95ee\u9898\uff1b\u5982\u679c\u5148\u6d88\u8d39\u540e\u63d0\u4ea4 offset\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u91cd\u590d\u6d88\u8d39\u95ee\u9898\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_10","title":"\u5982\u4f55\u89e3\u51b3\u6d88\u8d39\u8005\u7684 \u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39 \u95ee\u9898\uff1f","text":"<p>\u53ef\u4ee5\u628aoffset\u5b58\u50a8\u5728Mysql\u4e2d\uff0c\u7136\u540e\u628a \u6d88\u8d39\u6570\u636e\u7684\u8fc7\u7a0b \u548c \u63d0\u4ea4offset\u7684\u8fc7\u7a0b \u653e\u5728\u4e00\u4e2a\u4e8b\u52a1\u91cc\u9762\u8fdb\u884c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u51fa\u73b0 \u6d88\u8d39\u4e22\u5931 \u548c \u91cd\u590d\u6d88\u8d39 \u95ee\u9898\u4e86\u3002</p> <p>\u5982\u679c\u5c06offset\u4fdd\u5b58\u5728MySQL\u4e2d\uff0c\u90a3\u4e48\u8868\u7684\u5217\u5e94\u8be5\u662f\u3010\u6d88\u8d39\u8005\u7ec4\uff0ctopic\uff0c\u5206\u533a\uff0coffset\u3011\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#high_watermark_leolong_end_offset","title":"High Watermark\uff08\u9ad8\u6c34\u4f4d\uff09\u548c LEO\uff08Long End Offset\uff09\u662f\u4ec0\u4e48\uff1f","text":"<p>\u5f53Follower\u6b63\u5728\u540c\u6b65Leader\u6570\u636e\u65f6\uff0cLeader\u6302\u4e86\uff0c\u8fd9\u65f6Follower\u4eec\u53ea\u540c\u6b65\u5230\u4e86\u90e8\u5206\u6570\u636e\uff0c\u5e76\u4e14\u6bcf\u4e2afollower\u540c\u6b65\u5230\u7684\u6570\u636e\u91cf\u8fd8\u4e0d\u76f8\u540c\uff0c\u8fd9\u65f6\u5f53Follower\u91cd\u65b0\u9009\u4e3e\u51faLeader\u4e4b\u540e\uff0c\u6d88\u8d39\u8be5\u5982\u4f55\u6d88\u8d39\u65b0Leader\u4e2d\u7684\u6570\u636e\u662f\u4e2a\u95ee\u9898\uff0cHigh Watermark\u5c31\u662f\u6240\u6709\u526f\u672c\u4e2d\u6570\u636e\u7684\u6700\u5c0f\u5e8f\u53f7\uff0c\u53ea\u6709High Watermark\u4e4b\u524d\u7684\u6570\u636e\u624d\u5bf9\u6d88\u8d39\u8005\u53ef\u89c1\uff0c\u4ece\u800c\u4fdd\u8bc1\u65e0\u8bba\u54ea\u4e2afollower\u88ab\u9009\u4e3aleader\u4e4b\u540e\uff0c\u6d88\u8d39\u8005\u90fd\u53ef\u4ee5\u6b63\u5e38\u6d88\u8d39\u6570\u636e\u3002</p> <p>LEO\uff08Long End Offset\uff09\u6307\u7684\u662f\u6bcf\u4e2a\u526f\u672c\u6570\u636e\u4e2d\u7684\u6700\u5927\u5e8f\u53f7\uff0c\u5f53\u65b0Leader\u4ea7\u751f\u4e4b\u540e\uff0cLeader\u548cFollower\u4f1a\u9996\u5148\u540c\u6b65\u5230\u6700\u5927\u7684LEO\u5904\uff0c\u7136\u540e\u518d\u5411\u751f\u4ea7\u8005\u53d1\u9001ack\uff0c\u4ee5\u514d\u8ba9\u751f\u4ea7\u8005\u91cd\u590d\u53d1\u9001\u592a\u591a\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#_11","title":"\u5982\u4f55\u4fdd\u8bc1\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u7684\u987a\u5e8f\u6027\uff1f","text":"<p>\u5206\u533a\u5185\u6d88\u606f\u662f\u6709\u5e8f\u7684\uff0c\u5206\u533a\u4e4b\u95f4\u6d88\u606f\u662f\u65e0\u5e8f\u7684\uff0c\u53ef\u4ee5\u901a\u591a\u5b9a\u4e49message\u7684key\u6765\u4fdd\u8bc1\u76f8\u540c key \u7684 message \u53d1\u9001\u5230\u540c\u4e00\u4e2a Partition\u3002</p> <p>\u5982\u679c\u60f3\u8981\u4fdd\u8bc1\u5168\u5c40\u6709\u5e8f\u5c31\u53ea\u80fd\u6709\u4e00\u4e2a\u5206\u533a\uff0c\u5e76\u4e14\u8fd8\u8981\u5f00\u542fKafka\u7684\u5e42\u7b49\u6027\uff0c\u4fdd\u8bc1\u6d88\u606f\u4e0d\u80fd\u4e71\u5e8f\u3002\u4e0d\u8fc7\uff0c\u7edd\u5927\u591a\u6570\u4e1a\u52a1\u90fd\u4e0d\u9700\u8981\u4fdd\u8bc1\u5168\u5c40\u6709\u5e8f\uff0c\u53ea\u9700\u8981\u4fdd\u8bc1\u5c40\u90e8\u6709\u5e8f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Kafka/#kafkaexactly_once","title":"Kafka\u600e\u4e48\u5b9e\u73b0Exactly Once\uff1f","text":"<p>\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u7684Exactly Once\uff1a</p> <p>1.\u751f\u4ea7\u8005\u8bbe\u7f6eacks=all\uff0c\u4fdd\u8bc1\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u4e0d\u4e22\u5931\u6d88\u606f</p> <p>2.Kafka\u5f00\u542f\u5e42\u7b49\u4fdd\u8bc1\u6d88\u606f\u4e0d\u91cd\u590d\uff0c\u4f46\u662f\u5e42\u7b49\u4e0d\u80fd\u4fdd\u8bc1\u8de8\u4f1a\u8bdd\u6d88\u606f\u4e0d\u91cd\u590d\uff0c\u5982\u679c\u60f3\u8981\u4fdd\u8bc1\u8de8\u4f1a\u8bdd\u6d88\u606f\u4e0d\u91cd\u590d\u8fd8\u8981\u5f00\u542f\u4e8b\u52a1\u3002</p> <p>Kafka\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7684Exactly Once\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u5982\u679c\u662f\u5148\u6d88\u8d39\u518d\u63d0\u4ea4offset\uff0c\u90a3\u4e48\u9700\u8981\u4fdd\u8bc1\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u7684\u5e42\u7b49\u6027</p> </li> <li> <p>\u628a\u6d88\u8d39\u8005\u6d88\u8d39\u548c\u63d0\u4ea4offset\u7684\u8fc7\u7a0b\u653e\u5728\u4e00\u4e2a\u5916\u90e8\u4e8b\u52a1\u4e4b\u4e2d\uff0c\u6bd4\u5982\u628aoffset\u4fdd\u5b58\u5728MySQL\u4e2d\uff0c\u7136\u540e\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u7684\u7ed3\u679c\u4e5f\u662f\u4fdd\u5b58\u5728MySQL\u4e2d\u7684\u8bdd\uff0c\u53ef\u4ee5\u628a\u8fd9\u4e24\u6b65\u64cd\u4f5c\u90fd\u5305\u542b\u5728MySQL\u7684\u4e8b\u52a1\u4e2d\u3002</p> </li> </ul> <p>\u5982\u679c\u6d88\u8d39\u8005\u662fFlink\uff0c\u90a3\u4e48\u5c31\u662fFlink\u7684Source\u7aef\u628aoffset\u4fdd\u5b58\u5728\u72b6\u6001\u540e\u7aef\uff0c\u7136\u540eFlink\u7684Sink\u7aef\u5f00\u542f\u5e42\u7b49\u5199\u5165\u6216\u8005\u4e8b\u52a1\u578b\u5199\u5165\uff0c\u5bf9\u4e8eFlink\u5185\u90e8\uff0c\u57fa\u4e8eFlink\u7684state\u548ccheckpoint\u673a\u5236\u53ef\u4ee5\u5b9e\u73b0Flink\u5185\u90e8\u7684\u72b6\u6001\u4e00\u81f4\u6027\uff0c\u4ece\u800c\u4f7f\u5f97 Flink -&gt; Kafka -&gt; Flink\u7684\u6570\u636e\u94fe\u8def\u5b9e\u73b0Exactly once\u3002</p> <p>\u5982\u679c\u6d88\u8d39\u8005\u662fFlink\uff0c\u5177\u4f53\u4e00\u70b9\uff1a</p> <p>\u5982\u679c\u662f\u5148\u6d88\u8d39\u518d\u63d0\u4ea4offset\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u91cd\u590d\u6d88\u8d39\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u9700\u8981\u4fdd\u8bc1\u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\u7684\u5e42\u7b49\u6027\u3002Flink\u7684Source\u7aef\u628aoffset\u4fdd\u5b58\u5728\u72b6\u6001\u540e\u7aef\uff0c\u7136\u540eFlink\u7684Sink\u7aef\u5f00\u542f\u5e42\u7b49\u5199\u5165\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u7684\u552f\u4e00\u4e3b\u952e\u53ef\u4ee5\u963b\u6b62\u91cd\u590d\u7684\u63d2\u5165\u64cd\u4f5c\uff0cRedis\u7684setnx\u547d\u4ee4\u7684\u8bed\u4e49\u672c\u4e8b\u5c31\u5177\u6709\u5e42\u7b49\u6027\u3002</p> <p>\u5982\u679c\u662f\u5148\u63d0\u4ea4offset\u518d\u6d88\u8d39\u6d88\u606f\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u6d88\u606f\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u628a\u6d88\u8d39\u8005\u6d88\u8d39\u548c\u63d0\u4ea4offset\u7684\u8fc7\u7a0b\u653e\u5728\u4e00\u4e2a\u5916\u90e8\u4e8b\u52a1\u4e4b\u4e2d\u3002Flink\u7684Source\u7aef\u628aoffset\u4fdd\u5b58\u5728\u72b6\u6001\u540e\u7aef\uff0c\u7136\u540eFlink\u7684Sink\u7aef\u5f00\u542f\u4e8b\u52a1\u6027\uff08Transactional\uff09\u5199\u5165\uff0c\u4e8b\u52a1\u7684\u5f00\u59cb\u5bf9\u5e94\u7740\u4fdd\u5b58checkpoint\u7684\u5f00\u59cb\uff0ccheckpoint\u771f\u6b63\u5b8c\u6210\u65f6\u4e8b\u52a1\u7ed3\u675f\uff0c\u8fd9\u65f6\u624d\u628a\u6240\u6709\u7ed3\u679c\u63d0\u4ea4\u5230sink\u6240\u8fde\u63a5\u7684\u5916\u90e8\u7cfb\u7edf\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/","title":"MySQL\u9ad8\u7ea7","text":"<p> \u7ea6 17259 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 345 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#innodb","title":"InnoDB\u884c\u683c\u5f0f\uff1f","text":"<p>InnoDB\u67094\u79cd\u884c\u683c\u5f0f\uff1aCOMPACT\u3001REDUNDANT\u3001DYNAMIC\u3001COMPRESSED\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#compact","title":"COMPACT\u884c\u683c\u5f0f\uff1f","text":"<p>COMPACT\u884c\u683c\u5f0f\u5305\u542b\u4e24\u90e8\u5206\uff1a\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f \u548c \u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u3002</p> <p>\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u53c8\u5305\u62ec\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li> <p>\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\uff1a\u6240\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u90fd\u9006\u5e8f\u5b58\u653e\u5728\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u3002\u5982\u679c\u8868\u7684\u6240\u6709\u5217\u90fd\u4e0d\u662f\u53d8\u957f\u7684\u6570\u636e\u7c7b\u578b\u6216\u8005\u6240\u6709\u5217\u7684\u503c\u90fd\u662fNULL\u7684\u8bdd\uff0c\u5c31\u4e0d\u9700\u8981\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u3002</p> </li> <li> <p>NULL\u503c\u5217\u8868\uff1a\u5141\u8bb8\u4e3aNULL\u7684\u5217\u4f1a\u9006\u5e8f\u5c06\u662f\u5426\u4e3aNULL\u7684\u4fe1\u606f\u5b58\u653e\u5728NULL\u5217\u8868\u4e2d\uff08\u4e8c\u8fdb\u5236\u4f4d\u4e3a1\u8868\u793a\u4e0d\u4e3aNULL\uff0c\u53cd\u4e4b\u5219\u4e3aNULL\uff09\u3002\u5982\u679c\u8868\u4e2d\u6ca1\u6709\u5141\u8bb8\u4e3aNULL\u7684\u5217\uff0c\u5219NULL\u503c\u5217\u8868\u4e0d\u5b58\u5728\u3002</p> </li> <li> <p>\u8bb0\u5f55\u5934\u4fe1\u606f\uff1a\u8bb0\u5f55\u5934\u4fe1\u606f\u7531\u56fa\u5b9a\u76845\u4e2a\u5b57\u8282\u7ec4\u6210\u3002\u4e3b\u8981\u5305\u62ec\uff1a</p> </li> <li> <p>deleted_flag\uff1a\u8bb0\u5f55\u662f\u5426\u5220\u9664\u3002</p> </li> <li> <p>min_rec_flag\uff1a\u6bcf\u5c42\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6700\u5c0f\u7684\u76ee\u5f55\u9879\u4f1a\u6dfb\u52a0\u8be5\u6807\u8bb0\u3002</p> </li> <li> <p>n_owned\uff1a\u7531\u6bcf\u7ec4\u6700\u5927\u7684\u8bb0\u5f55\u4f1a\u5c06\u8be5\u7ec4\u7684\u8bb0\u5f55\u6570\u8bb0\u5f55\u5728n_owned\u4e2d\uff0c\u5176\u4f59\u8bb0\u5f55\u7684n_owned\u4e3a0\u3002</p> </li> <li> <p>heap_no\uff1a\u8bb0\u5f55\u5728\u9875\u9762\u4e2d\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u5373\u7b2c\u51e0\u4e2a\u8bb0\u5f55\u3002</p> </li> <li> <p>record_type\uff1a0\u8868\u793a\u666e\u901a\u8bb0\u5f55\u30011\u8868\u793a\u975e\u53f6\u5b50\u8282\u70b9\u76ee\u5f55\u9879\u8bb0\u5f55\u30012\u8868\u793aInfimum\u8bb0\u5f55\uff0c3\u8868\u793aSupremum\u8bb0\u5f55\u3002</p> </li> <li> <p>next_record\uff1a\u4e0b\u4e00\u4e2a\u8bb0\u5f55\u7684\u4f4d\u7f6e\u3002</p> </li> </ul> <p>\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u9664\u4e86\u81ea\u5df1\u5b9a\u4e49\u7684\u5217\u5916\uff0cInnoDB\u8fd8\u4f1a\u4e3a\u6bcf\u4e2a\u8bb0\u5f55\u9ed8\u8ba4\u6dfb\u52a0\u51e0\u4e2a\u9690\u85cf\u5217\uff1a</p> <ul> <li>row_id\uff1a\u4e3b\u952eid\uff0c\u5982\u679c\u7528\u6237\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\uff0c\u90a3\u4e48\u4f1a\u9ed8\u8ba4\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3arow_id\u7684\u9690\u85cf\u5217\u4f5c\u4e3a\u4e3b\u952e\u3002</li> <li>trx_id\uff1a\u4e8b\u52a1id\uff0c\u4fee\u6539\u8be5\u8bb0\u5f55\u7684\u4e8b\u52a1id\u3002</li> <li>roll_pointer\uff1a\u56de\u6eda\u6307\u9488\uff0c\u6307\u5411undo\u65e5\u5fd7\u5f62\u6210\u7248\u672c\u94fe\uff0c\u4f5c\u7528\u662f\u4e8b\u52a1\u56de\u6eda\u548cMVCC\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#dynamic","title":"DYNAMIC\u884c\u683c\u5f0f\uff1f","text":"<p>InnoDB\u9ed8\u8ba4\u7684\u884c\u683c\u5f0f\u662fDYNAMIC\uff0c\u5b83\u4e0eCOMPACT\u884c\u683c\u5f0f\u552f\u4e00\u7684\u4e0d\u540c\u662f\u5728\u5904\u7406\u6ea2\u51fa\u5217\u65f6\u91c7\u53d6\u7684\u65b9\u6848\u3002\u5bf9\u4e8eCOMPACT\u884c\u683c\u5f0f\uff0c\u53ea\u4f1a\u5728\u771f\u5b9e\u6570\u636e\u5904\u5b58\u50a8\u8be5\u5217\u524d768\u4e2a\u5b57\u8282\uff0c\u7136\u540e\u7d27\u63a5\u7740\u752820\u4e2a\u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\u548c\u5269\u4f59\u5b57\u8282\u6570\u3002\u5bf9\u4e8eDYNAMIC\u884c\u683c\u5f0f\uff0c\u53ea\u4f1a\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u752820\u4e2a\u5b57\u8282\u5b58\u50a8\u6267\u884c\u6ea2\u51fa\u9875\u7684\u5730\u5740\u548c\u5b57\u8282\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#row_id","title":"\u9690\u85cf\u4e3b\u952erow_id\u7684\u751f\u6210\u7b56\u7565\uff1f","text":"<p>MySQL\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u6240\u6709\u6ca1\u6709\u8bbe\u7f6e\u4e3b\u952e\u7684\u8868\u90fd\u7528\u8fd9\u4e2a\u53d8\u91cf\u5206\u914d\u4e3b\u952e\uff0c\u6bcf\u6b21\u5206\u914d\u540e\u4f1a\u589e\u52a01\uff0c\u6bcf\u5f53\u53d8\u91cf\u503c\u8fbe\u5230256\u7684\u500d\u6570\u65f6\uff0c\u5c31\u4f1a\u628a\u503c\u5237\u5230\u7cfb\u7edf\u8868\u7a7a\u95f47\u53f7\u9875\u9762\u7684Max Row ID\u5c5e\u6027\u4e2d\uff0c\u8fd9\u4e2a\u5c5e\u6027\u53608\u4e2a\u5b57\u8282\uff0c\u7cfb\u7edf\u4e0b\u6b21\u91cd\u542f\u65f6\u4f1a\u628aMax Row ID\u52a0\u8f7d\u5230\u5185\u5b58\u5e76\u52a0\u4e0a256\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u5206\u914d\u7684\u8d77\u59cb\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u81ea\u589e\u65f6\u90fd\u8981\u5199\u78c1\u76d8\uff0c\u5e76\u4fdd\u8bc1\u4e0d\u91cd\u590d\u5206\u914d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#innodb_1","title":"InnoDB\u9875\u7ed3\u6784\uff1f","text":"<p>\u9875\u7684\u5927\u5c0f\u4e3a16KB\uff0cInnoDB\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4e4b\u95f4\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\u3002InnoDB\u4e3a\u4e86\u4e0d\u540c\u7684\u76ee\u7684\u8bbe\u8ba1\u4e86\u5f88\u591a\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u9875\uff0c\u6bd4\u5982\uff1a\u5b58\u50a8\u8868\u7a7a\u95f4\u5934\u90e8\u4fe1\u606f\u7684\u9875\u3001\u5b58\u50a8\u6bb5\u4fe1\u606f\u7684\u9875\u3001\u5b58\u50a8\u533a\u4fe1\u606f\u7684\u9875\u3001\u5b58\u50a8\u7cfb\u7edf\u4fe1\u606f\u7684\u9875\u3001\u5b58\u50a8\u4e8b\u52a1\u4fe1\u606f\u7684\u9875\u3001undo\u65e5\u5fd7\u9875\u3001\u6ea2\u51fa\u9875\u3001\u7d22\u5f15\u9875\u3002\u7528\u6765\u5b58\u653e\u6570\u636e\u7684\u9875\u5c31\u662f\u7d22\u5f15\u9875\uff0c\u4e0d\u8fc7\u6ea2\u51fa\u9875\u662f\u4e00\u79cd\u5355\u72ec\u7c7b\u578b\u7684\u9875\u3002</p> <p>\u4e00\u4e2a\u9875\u75317\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a</p> <ul> <li>File Header\uff1aFile Header\u662f\u5404\u79cd\u7c7b\u578b\u9875\u9762\u7684\u901a\u7528\u7ec4\u6210\u90e8\u5206\uff0c\u5360\u7528\u56fa\u5b9a\u768438\u4e2a\u5b57\u8282\uff0c\u4e3b\u8981\u5305\u542b\u9875\u53f7\u3001\u4e0a\u4e00\u4e2a\u9875\u7684\u9875\u53f7\u3001\u4e0b\u4e00\u4e2a\u9875\u7684\u9875\u53f7\u3001\u9875\u7684\u7c7b\u578b\u3001\u9875\u6240\u5c5e\u8868\u7a7a\u95f4ID\u3001\u6821\u9a8c\u548c\u3002</li> <li>Page Header\uff1a\u5b58\u50a8\u7d22\u5f15\u9875\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982\u9875\u9762\u7684\u8bb0\u5f55\u6570\u3001Free Space\u7684\u5730\u5740\u504f\u79fb\u3001\u5220\u9664\u8bb0\u5f55\u7ec4\u6210\u7684\u5355\u9879\u94fe\u8868\u7684\u5934\u8282\u70b9\u7684\u504f\u79fb\u7b49\u3002\u5982\u679c\u662f\u6839\u8282\u70b9\u9875\u9762\u8fd8\u4f1a\u5b58\u53f6\u5b50\u8282\u70b9\u6bb5\u548c\u975e\u53f6\u5b50\u8282\u70b9\u6bb5\u7684INODE Entry\u4f4d\u7f6e\u3002</li> <li>Infimum + Supremum\uff1a\u4e24\u4e2a\u865a\u62df\u8bb0\u5f55\uff0cInfimum\u6bd4\u5176\u4ed6\u6240\u6709\u8bb0\u5f55\u90fd\u5c0f\uff0cSupremum\u6bd4\u5176\u4ed6\u6240\u6709\u8bb0\u5f55\u90fd\u5927\u3002</li> <li>User Records\uff1a\u7528\u6237\u8bb0\u5f55\u5b58\u50a8\u7684\u5730\u65b9\u3002</li> <li>Free Space\uff1a\u9875\u9762\u5c1a\u672a\u4f7f\u7528\u7684\u5730\u65b9\u3002</li> <li>Page Directory\uff1a\u9875\u76ee\u5f55\uff0c\u69fd\uff08slot\uff09\u5b58\u653e\u7684\u5730\u65b9\uff0c\u6bcf\u4e2a\u69fd\u53602\u4e2a\u5b57\u8282\u3002</li> <li>File Trailler\uff1aFile Trailler\u4e5f\u662f\u5404\u79cd\u7c7b\u578b\u9875\u9762\u7684\u901a\u7528\u7ec4\u6210\u90e8\u5206\uff0c\u5b58\u50a8\u9875\u9762\u7684\u6821\u9a8c\u548c\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_1","title":"\u8bb0\u5f55\u5728\u9875\u9762\u4e2d\u662f\u5982\u4f55\u5b58\u50a8\u7684\uff1f","text":"<p>\u6240\u6709\u8bb0\u5f55\u90fd\u901a\u8fc7\u884c\u683c\u5f0f\u4e2d\u7684next_record\u4e32\u6210\u4e00\u4e2a\u94fe\u8868\uff0cInfimum\u662f\u8fd9\u4e2a\u94fe\u8868\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0cSupremum\u662f\u8fd9\u4e2a\u94fe\u8868\u7684\u5c3e\u8282\u70b9\u3002next_record\u6307\u5411\u7684\u4f4d\u7f6e\u662f \u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f \u548c \u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e \u4e2d\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e5f\u5c31\u89e3\u91ca\u4e86\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u4e3a\u4ec0\u4e48\u8981\u9006\u5e8f\u5b58\u653e\u3002</p> <p>\u94fe\u8868\u4e0a\u7684\u8bb0\u5f55\u4f1a\u88ab\u5212\u5206\u6210\u51e0\u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff08\u4e5f\u5c31\u662f\u7ec4\u5185\u6700\u5927\u7684\u90a3\u6761\u8bb0\u5f55\uff09\u7684\u5934\u4fe1\u606f\u4e2d\u7684n_owned\u5c5e\u6027\u4f1a\u5b58\u50a8\u8be5\u7ec4\u6709\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u8fd9\u6761\u8bb0\u5f55\u7684\u9875\u5185\u504f\u79fb\u5730\u5740\u4f1a\u88ab\u5b58\u50a8\u5728Page Directory\uff08\u9875\u76ee\u5f55\uff09\u5904\uff0c\u6bcf\u4e2a\u5730\u5740\u79f0\u4e3a\u69fd\uff08slot\uff09\uff0c\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u4f7f\u7528\u4e8c\u5206\u6cd5\u5b9e\u73b0\u5feb\u901f\u67e5\u627e\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cInfimum\u8bb0\u5f55\u53ea\u80fd\u5355\u72ec\u4f5c\u4e3a\u4e00\u7ec4\uff0c\u6240\u4ee5Infimum\u8bb0\u5f55\u7684n_owned\u7684\u503c\u4e3a1\uff0cSupremum\u8bb0\u5f55\u6240\u5728\u7684\u5206\u7ec4\u7684\u8bb0\u5f55\u57281~8\u6761\u4e4b\u95f4\uff0c\u5176\u4f59\u5206\u7ec4\u7684\u8bb0\u5f55\u6570\u57284~8\u6761\u4e4b\u95f4\uff0c\u5f53\u4e00\u4e2a\u5206\u7ec4\u67098\u6761\u8bb0\u5f55\u4e4b\u540e\u518d\u63d2\u5165\u4e00\u6761\uff0c\u4f1a\u5c06\u8be5\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u62c6\u5206\u6210\u4e24\u4e2a\u7ec4\uff0c\u4e00\u4e2a\u7ec4\u662f4\u6761\u8bb0\u5f55\uff0c\u53e6\u4e00\u4e2a\u7ec4\u5219\u662f5\u6761\u8bb0\u5f55\u3002</p> <p>\u5982\u679c\u67d0\u4e2a\u8bb0\u5f55\u88ab\u5220\u9664\u4e86\uff0c\u5219\u4f1a\u4ece\u8fd9\u4e2a\u94fe\u8868\u4e2d\u5254\u9664\uff0c\u7136\u540e\u6240\u6709\u88ab\u5220\u9664\u7684\u8bb0\u5f55\u901a\u8fc7next_record\u4e32\u6210\u4e00\u4e2a\u5783\u573e\u94fe\u8868\uff0c\u540e\u9762\u53ef\u4ee5\u91cd\u7528\u8fd9\u90e8\u5206\u7a7a\u95f4\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#innodb_2","title":"InnoDB\u5982\u4f55\u7ba1\u7406\u5b58\u50a8\u7a7a\u95f4\uff1f\u8868\u7a7a\u95f4\uff1f","text":"<p>InnoDB\u901a\u8fc7\u8868\u7a7a\u95f4\u7ba1\u7406\u5b58\u50a8\u7a7a\u95f4\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_2","title":"\u8868\u7a7a\u95f4","text":"<p>InnoDB\u6709\u5f88\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u8868\u7a7a\u95f4\uff1a\u7cfb\u7edf\u8868\u7a7a\u95f4\u3001\u72ec\u7acb\u8868\u7a7a\u95f4\u3001\u901a\u7528\u8868\u7a7a\u95f4\u3001undo\u8868\u7a7a\u95f4\u3001\u4e34\u65f6\u8868\u7a7a\u95f4\u3002\u6ce8\u610f\uff0cMyISAM\u6ca1\u6709\u8868\u7a7a\u95f4\u7684\u6982\u5ff5\u3002</p> <p>\u4e00\u4e2aMySQL\u670d\u52a1\u5668\u53ea\u6709\u4e00\u4e2a\u7cfb\u7edf\u8868\u7a7a\u95f4\uff0c\u5bf9\u5e94\u662f\u6570\u636e\u76ee\u5f55\u4e0b\u7684ibdata1\u6587\u4ef6\u3002\u6bcf\u5f20\u8868\u90fd\u4f1a\u5728\u6570\u636e\u5e93\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5.idb\u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5c31\u662f\u72ec\u7acb\u8868\u7a7a\u95f4\uff0c\u8868\u7684\u6570\u636e\u4f1a\u5b58\u50a8\u5728\u8fd9\u4e2a\u72ec\u7acb\u8868\u7a7a\u95f4\u4e2d\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4fee\u6539\u914d\u7f6e\u5c06\u8868\u7684\u6570\u636e\u5b58\u5230\u7cfb\u7edf\u8868\u7a7a\u95f4\u4e2d\u3002</p> <p>\u8868\u7a7a\u95f4\u7684\u7ed3\u6784\uff1a\u8868\u7a7a\u95f4 -&gt; \u7ec4 -&gt; \u533a -&gt; \u9875\u3002\u4e00\u4e2a\u987516KB\uff0c\u8fde\u7eed64\u4e2a\u9875\u662f\u4e00\u4e2a\u533a\uff0c\u5373\u533a\u7684\u5927\u5c0f\u662f1M\uff0c\u6bcf256\u4e2a\u533a\u88ab\u5212\u5206\u4e3a\u4e00\u4e2a\u7ec4\u3002InnoDB\u4e0d\u7528\u9875\u800c\u662f\u7528\u533a\u4f5c\u4e3a\u5206\u914d\u5355\u4f4d\u7684\u539f\u56e0\u662f\u5c3d\u53ef\u80fd\u8fde\u7eed\u5206\u914d\u7a7a\u95f4\u4ee5\u51cf\u5c11\u968f\u673aIO\u3002</p> <p>\u6bb5\uff1a\u6bb5\u662f\u7a7a\u95f4\u7ba1\u7406\u7684\u903b\u8f91\u5355\u4f4d\uff0c\u4e00\u4e2a\u7d22\u5f15\u5206\u6210\u4e24\u4e2a\u6bb5\uff1a\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u6bb5 \u548c \u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\u6bb5\u3002\u5f15\u5165\u6bb5\u7684\u76ee\u7684\u662f\u5c06 \u53f6\u5b50\u8282\u70b9 \u548c \u975e\u53f6\u5b50\u8282\u70b9 \u7a7a\u95f4\u7684\u5206\u914d\u548c\u56de\u6536\u5206\u5f00\u3002\u4e00\u822c\u6765\u8bf4InnoDB\u6bcf\u6b21\u4f1a\u5c06\u4e00\u4e2a\u5b8c\u6574\u7684\u533a\u5206\u914d\u7ed9\u6bb5\uff0c\u4f46\u662f\u8868\u5f88\u5c0f\u4f1a\u586b\u4e0d\u6ee1\u4e00\u4e2a\u533a\uff0c\u90a3\u5c31\u4f1a\u9020\u6210\u5b58\u50a8\u7a7a\u95f4\u7684\u6d6a\u8d39\uff0c\u6240\u4ee5InnoDB\u5f15\u5165\u4e86\u788e\u7247\u533a\uff0c\u788e\u7247\u533a\u76f4\u5c5e\u4e8e\u8868\u7a7a\u95f4\uff0c\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u4e00\u4e2a\u6bb5\uff0c\u56e0\u6b64\u5728\u4e3a\u4e00\u4e2a\u6bb5\u5206\u914d\u7a7a\u95f4\u7684\u65f6\u5019\u9996\u5148\u4f1a\u4ece\u788e\u7247\u533a\u4e2d\u5206\u914d\u5355\u4e2a\u9875\u9762\uff0c\u5f53\u5206\u914d\u5b8c32\u4e2a\u9875\u9762\u4e4b\u540e\u518d\u5206\u914d\u5b8c\u6574\u7684\u533a\u3002\u6bcf\u4e2a\u6bb5\u5bf9\u5e94\u4e00\u4e2aINODE Entry\uff0c\u4f5c\u7528\u662f\u7ba1\u7406\u6bb5\u4e2d\u533a\u7684\u5206\u914d\u548c\u56de\u6536\uff0cINODE Entry\u653e\u5728\u8868\u7a7a\u95f4\u7684\u7b2c\u4e09\u4e2a\u9875\u9762\u4e2d\u3002INODE Entry\u7684\u4f4d\u7f6e\u53c8\u5982\u4f55\u627e\u5230\uff1f\u6bcf\u4e2a\u7d22\u5f15\u7684\u6839\u8282\u70b9\u9875\u9762\u4e2d\u4fdd\u5b58\u7740\u53f6\u5b50\u8282\u70b9\u6bb5\u548c\u975e\u53f6\u5b50\u8282\u70b9\u6bb5\u7684INODE Entry\u4f4d\u7f6e\u3002</p> <p>XDES Entry\uff1a\u6bcf\u4e00\u4e2a\u533a\u90fd\u5bf9\u5e94\u4e00\u4e2aXDES Entry\uff08extent descriptor\uff09\uff0c\u5927\u5c0f40\u4e2a\u5b57\u8282\uff0c\u4f5c\u7528\u662f\u7ba1\u7406\u533a\u4e2d\u7684\u9875\u9762\u7684\u5206\u914d\u548c\u56de\u6536\uff0c\u6bcf\u4e2a\u7ec4\u7684\u6240\u6709\u533a\u7684XDES Entry\u90fd\u653e\u5728\u8be5\u7ec4\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\u4e2d\u3002\u6bcf\u4e2aXDES Entry\u67094\u4e2d\u72b6\u6001\uff1aFREE\uff08\u7a7a\u95f2\u7684\u533a\uff09\u3001FREE_FRAG\uff08\u6709\u5269\u4f59\u7a7a\u95f2\u9875\u9762\u7684\u788e\u7247\u533a\uff09\u3001FULL_FRAG\uff08\u6ca1\u6709\u5269\u4f59\u7a7a\u95f4\u7684\u788e\u7247\u533a\uff09\u3001FSEG\uff08\u9644\u5c5e\u4e8e\u67d0\u4e2a\u6bb5\u7684\u533a\uff09\u3002\u524d\u4e09\u79cd\u76f4\u5c5e\u4e8e\u8868\u7a7a\u95f4\u7684\u533a\u4f1a\u5206\u522b\u4e32\u6210\u4e09\u4e2a\u94fe\u8868\uff0c\u94fe\u8868\u7684\u57fa\u8282\u70b9\u653e\u5728\u7b2c\u4e00\u4e2a\u7ec4\u7684\u7b2c\u4e00\u4e2a\u533a\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\u4e2d\uff08\u4e5f\u5c31\u662f\u8868\u7a7a\u95f4\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\uff09\u3002\u7b2c\u56db\u79cd\u72b6\u6001\u7684\u533a\u96b6\u5c5e\u4e8e\u67d0\u4e00\u4e2a\u6bb5\uff0c\u5728\u6bb5\u4e2d\u540c\u6837\u53c8\u53ef\u4ee5\u5c06\u533a\u5206\u4e3a\u4e09\u79cd\u7c7b\u578b\u5e76\u4e32\u6210\u4e09\u4e2a\u94fe\u8868\uff1aFREE\u94fe\u8868\uff08\u9875\u9762\u5168\u90e8\u7a7a\u95f2\u7684\u533a\uff09\u3001NOT_FULL\u94fe\u8868\uff08\u9875\u9762\u90e8\u5206\u7a7a\u95f2\u7684\u533a\uff09\u3001FULL\u94fe\u8868\uff08\u6ca1\u6709\u7a7a\u95f2\u9875\u9762\u7684\u533a\uff09\uff0c\u8fd9\u4e09\u4e2a\u94fe\u8868\u7684\u57fa\u8282\u70b9\u653e\u5728INODE Entry\u4e2d\u3002</p> <p>\u603b\u7ed3\uff1a\u6bb5\u662f\u7a7a\u95f4\u7ba1\u7406\u7684\u903b\u8f91\u5355\u4f4d\uff0c\u9875\u662f\u7a7a\u95f4\u7ba1\u7406\u7684\u6700\u5c0f\u7269\u7406\u5355\u4f4d\uff0c\u7c7b\u4f3c\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u7ba1\u7406\uff0c\u533a\u662f\u4e3a\u4e86\u8fde\u7eed\u5206\u914d\u800c\u5f15\u5165\u7684\u7a7a\u95f4\u7ba1\u7406\u7684\u7269\u7406\u5355\u4f4d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_3","title":"\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684\u7ed3\u6784\uff1f\u6570\u636e\u5b57\u5178\uff1f","text":"<p>\u7cfb\u7edf\u8868\u7a7a\u95f4\u6bd4\u72ec\u7acb\u8868\u7a7a\u95f4\u591a\u7528\u4e865\u4e2a\u9875\u9762\u6765\u63cf\u8ff0\u7cfb\u7edf\u5c5e\u6027\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u662f\u7b2c7\u4e2a\u9875\u9762\u4e2d\u8bb0\u5f55\u7684\u6570\u636e\u5b57\u5178\u4fe1\u606f\u3002\u7cfb\u7edf\u7684\u5143\u6570\u636e\u4fe1\u606f\u5305\u62ec9\u5f20\u7cfb\u7edf\u8868\uff0c\u5176\u4e2d\u67094\u5f20\u8868\u5c24\u5176\u91cd\u8981\uff0c\u53ea\u8981\u628a\u8fd94\u5f20\u8868\u7684\u6839\u8282\u70b9\u627e\u5230\uff0c\u90a3\u4e48\u6240\u6709\u7684\u8868\uff08\u5305\u62ec\u7528\u6237\u5efa\u7684\u8868\uff09\u7684\u6839\u8282\u70b9\u5c31\u90fd\u53ef\u4ee5\u627e\u5230\u4e86\uff0c\u8fd94\u5f20\u8868\u7684\u6839\u8282\u70b9\u6240\u5728\u7684\u9875\u53f7\u5c31\u4fdd\u5b58\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684\u7b2c7\u9875\u9762\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_4","title":"\u5982\u4f55\u5206\u914d\u548c\u56de\u6536\u788e\u7247\u533a\u4e2d\u7684\u9875\u9762\uff1f","text":"<p>\u627e\u5230\u8868\u7a7a\u95f4\u7b2c\u4e00\u4e2a\u9875\u9762\u4e2d\u7684\u4e09\u4e2aXDES Entry\u94fe\u8868\u7684\u5934\u8282\u70b9\u540e\u5c31\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u5b8c\u6210\u5206\u914d\u548c\u56de\u6536\u788e\u7247\u533a\u7684\u9875\u9762\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_5","title":"\u5982\u4f55\u5206\u914d\u548c\u56de\u6536\u6bb5\u4e2d\u7684\u9875\u9762\uff1f","text":"<p>\u9996\u5148\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684\u7b2c7\u4e2a\u9875\u9762\u4e2d\u627e\u52304\u5f20\u7cfb\u7edf\u8868\u7684\u6839\u8282\u70b9\uff0c\u7136\u540e\u4ece4\u5f20\u7cfb\u7edf\u8868\u4e2d\u627e\u5230\u6bb5\u6240\u5728\u7d22\u5f15\u7684\u6839\u8282\u70b9\uff0c\u518d\u63a5\u7740\u4ece\u6839\u8282\u70b9\u9875\u9762Page Header\u4e2d\u627e\u5230\u53f6\u5b50\u8282\u70b9\u6bb5\u548c\u975e\u53f6\u5b50\u8282\u70b9\u6bb5\u7684Segment Header\uff08INODE Entry\u5730\u5740\uff09\uff0c\u7136\u540e\u627e\u5230INODE Entry\uff0c\u4ece\u800c\u5c31\u62ff\u5230\u4e86\u4e09\u4e2aXDES Entry\u94fe\u8868\u7684\u57fa\u8282\u70b9\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u5f88\u7b80\u5355\u5730\u5b8c\u6210\u6bb5\u4e2d\u9875\u9762\u7684\u5206\u914d\u548c\u56de\u6536\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_6","title":"\u7d22\u5f15","text":""},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#innodb_3","title":"InnoDB\u7684\u7d22\u5f15\u65b9\u6848\uff1f\u805a\u7c07\u7d22\u5f15\uff1f","text":"<p>\u805a\u7c07\u7d22\u5f15\u662f\u4e00\u4e2aB+\u6811\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u662f\u5b8c\u6574\u7528\u6237\u8bb0\u5f55\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u662f\u4e3b\u952e+\u9875\u53f7\u7ec4\u6210\u7684\u76ee\u5f55\u9879\u8bb0\u5f55\u3002\u9875\u5185\u7684\u8bb0\u5f55\u6309\u7167\u4e3b\u952e\u7684\u5927\u5c0f\u987a\u5e8f\u6392\u6210\u4e00\u4e2a\u5355\u5411\u94fe\u8868\uff0c\u540c\u4e00\u5c42\u7ea7\u4e4b\u95f4\u7684\u9875\u9762\u6309\u7167\u4e3b\u952e\u5927\u5c0f\u6392\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u3002InnoDB\u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u521b\u5efa\u805a\u7c07\u7d22\u5f15\uff0c\u805a\u7c07\u7d22\u5f15\u5c31\u662f\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_7","title":"\u4e8c\u7ea7\u7d22\u5f15\uff1f\u8054\u5408\u7d22\u5f15\uff1f","text":"<p>\u4f7f\u7528\u975e\u4e3b\u952e\u5217\u5efa\u7acb\u7684B+\u6811\u7d22\u5f15\u79f0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\uff0c\u8be5\u5217\u4e5f\u79f0\u4e3a\u67e5\u627e\u952e\uff0c\u5b83\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0a\u5b58\u7684\u662f\u67e5\u627e\u952e+\u4e3b\u952e+\u9875\u53f7\uff0c\u53f6\u5b50\u8282\u70b9\u4e0d\u50cf\u805a\u7c07\u7d22\u5f15\u90a3\u6837\u5b58\u7684\u662f\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\uff0c\u800c\u662f\u67e5\u627e\u952e+\u4e3b\u952e\uff0c\u6240\u4ee5\u5728\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6700\u540e\u67e5\u5230\u662f\u4e3b\u952e\uff0c\u4e0d\u662f\u5b8c\u6574\u7684\u8bb0\u5f55\uff0c\u5982\u679c\u8981\u62ff\u5230\u5b8c\u6574\u7684\u8bb0\u5f55\uff0c\u5c31\u8fd8\u9700\u8981\u56de\u8868\uff0c\u4e5f\u5c31\u662f\u6839\u636e\u4e3b\u952e\u5728\u805a\u7c07\u7d22\u5f15\u4e0a\u518d\u67e5\u4e00\u904d\u3002</p> <p>\u8054\u5408\u7d22\u5f15\u5c31\u662f\u540c\u65f6\u4ee5\u591a\u4e2a\u5217\u5efa\u7acb\u7684\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p>\u4e00\u4e2aB+\u6811\u7d22\u5f15\u7684\u6839\u8282\u70b9\u81ea\u521b\u5efa\u4e4b\u65e5\u8d77\u5c31\u4e0d\u4f1a\u518d\u79fb\u52a8\uff0c\u4e5f\u5c31\u662f\u9875\u53f7\u4e0d\u4f1a\u518d\u6539\u53d8\uff0c\u8fd9\u4e2a\u9875\u53f7\u4f1a\u88ab\u5b58\u50a8\u5728\u90a34\u5f20\u7cfb\u7edf\u8868\u4e2d\uff0c\u4e5f\u5c31\u662f\u5b58\u5728\u6570\u636e\u5b57\u5178\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#myisam","title":"MyISAM\u7684\u7d22\u5f15\u65b9\u6848\uff1f","text":"<p>MyISAM\u4f7f\u7528\u7684\u662fB \u6811\uff0c\u7d22\u5f15\u548c\u6570\u636e\u5206\u5f00\u5b58\u50a8\u3002\u6570\u636e\u6309\u63d2\u5165\u987a\u5e8f\u5355\u72ec\u5b58\u50a8\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u5e76\u4e0d\u4f1a\u6309\u7167\u4e3b\u952e\u6392\u5e8f\u3002\u4e3a\u4e3b\u952e\u521b\u5efa\u7684\u7d22\u5f15\u5355\u72ec\u653e\u5728\u7d22\u5f15\u6587\u4ef6\u4e2d\uff0c\u7d22\u5f15\u8282\u70b9\u4e0d\u662f\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\uff0c\u800c\u662f\u4e3b\u952e+\u5730\u5740\u3002\u6240\u4ee5MyISAM\u6ca1\u6709\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u4e4b\u5206\uff0c\u4e5f\u6ca1\u6709\u56de\u8868\u4e00\u8bf4\uff0c\u6216\u8005\u8bf4MyISAM\u7684\u7d22\u5f15\u90fd\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5229\u7528\u7d22\u5f15\u7684\u67e5\u8be2\u90fd\u5f97\u56de\u4e00\u6b21\u8868\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_8","title":"\u7d22\u5f15\u7684\u4ee3\u4ef7\uff1f","text":"<ul> <li>\u7a7a\u95f4\uff1a\u989d\u5916\u5360\u7528\u5b58\u50a8\u7a7a\u95f4\u3002</li> <li>\u65f6\u95f4\uff1a\u589e\u5220\u6539\u9700\u8981\u7ef4\u62a4\u7d22\u5f15\uff1b\u67e5\u8be2\u65f6\u6210\u672c\u5206\u6790\u8017\u65f6\u589e\u52a0\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_9","title":"\u7d22\u5f15\u7684\u4f5c\u7528\uff1f","text":"<p>\u7d22\u5f15\u53ef\u7528\u4e8e\u67e5\u627e\uff0c\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li> <p>\u7d22\u5f15\u5931\u6548\uff1a</p> </li> <li> <p>\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\u4e0d\u6ee1\u8db3\u6700\u5de6\u524d\u7f00\u539f\u5219\uff0c\u5373\u8df3\u8fc7\u4e86\u524d\u9762\u7684\u7d22\u5f15\u5217\u3002</p> </li> <li> <p>\u5728\u7d22\u5f15\u5217\u4e0a\u505a\u8ba1\u7b97\u3001\u4f7f\u7528\u51fd\u6570 \u6216 \u7c7b\u578b\u8f6c\u6362\uff08\u624b\u52a8\u6216\u81ea\u52a8\u7684\uff09\u3002</p> </li> <li> <p>\u6a21\u7cca\u67e5\u8be2like\u4ee5%\u5f00\u59cb\u3002</p> </li> <li> <p>\u56de\u8868\u4ee3\u4ef7\u592a\u5927\u5bfc\u81f4\u4e0d\u8d70\u7d22\u5f15\uff0c\u5178\u578b\u573a\u666f\u5c31\u662f\u7d22\u5f15\u5217\u91cd\u590d\u503c\u8fc7\u591a\u3002</p> </li> <li> <p>\u7d22\u5f15\u5217\u7684\u91cd\u590d\u503c\u4e0d\u5b9c\u8fc7\u591a\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5bfc\u81f4\u56de\u8868\u4ee3\u4ef7\u5927\uff0c\u53ef\u80fd\u6700\u7ec8\u6267\u884c\u8ba1\u5212\u4e0d\u4f1a\u7528\u5230\u8fd9\u4e2a\u7d22\u5f15\uff0c\u4f46\u662f\u5374\u8981\u4e00\u76f4\u7ef4\u62a4\u8fd9\u4e2a\u7d22\u5f15\u3002</p> </li> <li>\u7d22\u5f15\u5217\u5360\u7684\u5b58\u50a8\u7a7a\u95f4\u8d8a\u5c0f\u8d8a\u597d\uff0c\u56e0\u4e3a\u6570\u636e\u7c7b\u578b\u8d8a\u5c0f\uff0c\u7d22\u5f15\u5360\u7684\u5b58\u50a8\u7a7a\u95f4\u4e5f\u5c31\u8d8a\u5c0f\uff0c\u78c1\u76d8IO\u7684\u6027\u80fd\u635f\u8017\u4e5f\u5c31\u8d8a\u5c0f\u3002\u8fd9\u4e2a\u5efa\u8bae\u5bf9\u4e8e\u4e3b\u952e\u5c24\u4e3a\u91cd\u8981\uff0c\u56e0\u4e3a\u5176\u4ed6\u4e8c\u7ea7\u7d22\u5f15\u7684\u6bcf\u6761\u8bb0\u5f55\u4e5f\u4f1a\u5b58\u50a8\u4e3b\u952e\u3002</li> <li>\u4e3a\u5217\u524d\u7f00\u5efa\u7d22\u5f15\uff1a\u5982\u679c\u5b57\u7b26\u4e32\u5f88\u957f\u53ef\u4ee5\u53ea\u628a\u5b57\u7b26\u4e32\u524d\u51e0\u4e2a\u5b57\u7b26\u653e\u5230\u7d22\u5f15\u4e2d\u3002</li> <li>\u4e0d\u8981\u5efa\u5197\u4f59\u548c\u91cd\u590d\u7684\u7d22\u5f15\u3002\u6bd4\u5982\u7ed9\u8054\u5408\u7d22\u5f15\u7684\u7b2c\u4e00\u4e2a\u5217\u53c8\u5efa\u7acb\u4e86\u4e00\u4e2a\u7d22\u5f15\uff0c\u8fd9\u4e2a\u7d22\u5f15\u5c31\u662f\u91cd\u590d\u7d22\u5f15\u3002</li> </ul> <p>\u7d22\u5f15\u7528\u4e8e\u6392\u5e8f\uff0c\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\uff0corder by\u540e\u9762\u5217\u7684\u987a\u5e8f\u5fc5\u987b\u548c\u8054\u5408\u7d22\u5f15\u5217\u7684\u987a\u5e8f\u4e00\u81f4\uff0c\u53ef\u4ee5\u53ea\u4f7f\u7528\u7d22\u5f15\u5217\u4e2d\u5de6\u8fb9\u8fde\u7eed\u7684\u5217\u8fdb\u884c\u6392\u5e8f\uff0c\u4e2d\u95f4\u4e0d\u80fd\u65ad\uff0c\u9664\u975e\u524d\u9762\u7684\u5217\u5df2\u7ecf\u5728where\u6761\u4ef6\u4e2d\u9650\u5236\u6b7b\u4e86\uff0c\u6bd4\u5982<code>select * from single_table where key_part1='a' and key_part2='b' order by key_part3</code>\u6216\u8005<code>select * from single_table where key_part1='a' and key_part2='b' order by key_part3, id</code>\u3002</li> <li>ASC\u3001DESC\u4e0d\u80fd\u6df7\u7528\uff0c\u8981\u4e48\u90fd\u6309ASC\u6392\u5e8f\uff0c\u8981\u4e48\u90fd\u6309DESC\u6392\u5e8f\u3002</li> <li>\u6392\u5e8f\u7684\u591a\u4e2a\u5217\u90fd\u5206\u522b\u5efa\u4e86\u7d22\u5f15\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7d22\u5f15\u5747\u4e0d\u80fd\u7528\u4e8e\u6392\u5e8f\u3002</li> <li>\u641c\u7d22\u6761\u4ef6\u7684\u7d22\u5f15\u5217\u548c\u6392\u5e8f\u5217\u4e0d\u540c\u65f6\u65e0\u6cd5\u4f7f\u7528\u7d22\u5f15\u5217\u6392\u5e8f\u3002\u6bd4\u5982<code>select * from single_table where key1='a' order by key2</code>\u3002</li> <li>\u6392\u5e8f\u5217\u4e0d\u80fd\u505a\u8ba1\u7b97\u6216\u8005\u4f7f\u7528\u51fd\u6570\u3002</li> </ul> <p>\u7d22\u5f15\u7528\u4e8e\u5206\u7ec4\uff0c\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u548c\u4f7f\u7528\u7d22\u5f15\u6392\u5e8f\u4e00\u6837\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_10","title":"\u56de\u8868\u7684\u4ee3\u4ef7\uff1f","text":"<p>\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u7684\u4e3b\u952eid\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u56de\u8868\u4f1a\u9020\u6210\u5927\u91cf\u7684\u968f\u673aIO\uff0c\u6240\u4ee5\u9700\u8981\u56de\u8868\u7684\u8bb0\u5f55\u6570\u8d8a\u591a\uff0c\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u7684\u6027\u80fd\u4e5f\u5c31\u8d8a\u4f4e\uff0c\u4e8e\u662f\u53ef\u80fd\u4f7f\u7528\u5168\u8868\u626b\u63cf\u7684\u4ee3\u4ef7\u66f4\u4f4e\u3002MySQL\u53ef\u4ee5\u8bbe\u7f6e\u5148\u67e5\u4e8c\u7ea7\u7d22\u5f15\uff0c\u7b49\u83b7\u53d6\u5230\u5168\u90e8\u4e3b\u952eid\u4e4b\u540e\u518d\u6392\u5e8f\uff0c\u6700\u540e\u518d\u56de\u8868\uff08MRR\uff0cDisk-Sweep Multi-Range Read\uff0c\u591a\u8303\u56f4\u8bfb\u53d6\uff09\u3002\u5982\u679c\u6ca1\u6709\u5f00\u542f\u8fd9\u9879\u529f\u80fd\uff0c\u90a3\u4e48\u67e5\u8be2\u8fc7\u7a0b\u662f\uff0c\u6bcf\u6b21\u67e5\u4e8c\u7ea7\u7d22\u5f15\u83b7\u53d6\u4e3b\u952eid\u540e\u90fd\u4f1a\u56de\u8868\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_11","title":"\u8986\u76d6\u7d22\u5f15\uff1f","text":"<p>select\u3001where\u3001order by\u3001group by \u540e\u9762\u7684\u5217\u90fd\u5728\u67d0\u4e00\u4e2a\u7d22\u5f15\u4e2d\uff0c\u8fd9\u79cd\u67e5\u8be2\u65b9\u5f0f\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002\u4e0d\u4e00\u5b9a\u975e\u5f97\u4ece\u6839\u8282\u70b9\u641c\u7d22\u7684\u67e5\u8be2\u624d\u53eb\u8986\u76d6\u7d22\u5f15\uff0c\u76f4\u63a5\u4ece\u53f6\u5b50\u8282\u70b9\u8fdb\u884c\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\u4e5f\u53ef\u4ee5\u53eb\u8986\u76d6\u7d22\u5f15\u3002\u8986\u76d6\u7d22\u5f15\u53ef\u4ee5\u5b8c\u5168\u907f\u514d\u56de\u8868\uff0c\u6240\u4ee5\u5982\u65e0\u5fc5\u8981\uff0c\u4e0d\u8981<code>select *</code>\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_12","title":"\u7d22\u5f15\u4e0b\u63a8\uff1f","text":"<p>\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0c\u5982\u679c\u6709\u5176\u5b83\u6ca1\u6709\u5bf9\u5f62\u6210\u8be5\u626b\u63cf\u533a\u95f4\u8d77\u5230\u4f5c\u7528\u4f46\u662f\u4e5f\u53ef\u4ee5\u5728\u8be5\u7d22\u5f15\u4e0a\u63d0\u524d\u5224\u65ad\u7684\u6761\u4ef6\uff0c\u5f00\u542f\u7d22\u5f15\u4e0b\u63a8\u540e\u5b58\u50a8\u5f15\u64ce\u4f1a\u63d0\u524d\u5224\u65ad\uff0c\u907f\u514d\u56de\u8868\u540e\u5728server\u5c42\u5224\u65ad\uff0c\u8fbe\u5230\u51cf\u5c11\u56de\u8868\u6b21\u6570\u7684\u76ee\u7684\uff0c\u8fd9\u5c31\u662f\u7d22\u5f15\u4e0b\u63a8\u3002\u7d22\u5f15\u4e0b\u63a8\u8fd9\u4e2a\u7279\u6027\u53ea\u9002\u5408\u9700\u8981\u56de\u8868\u7684\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4e0d\u9002\u5408\u805a\u7c07\u7d22\u5f15\u548c\u8986\u76d6\u7d22\u5f15\u3002\u7d22\u5f15\u4e0b\u63a8\u53ea\u9002\u7528\u4e8eSELECT\uff0c\u4e0d\u9002\u7528UPDATE\u548cDELETE\u4e2d\u7684WHERE\u6761\u4ef6\u3002\u6bd4\u5982\uff1a</p> <ul> <li><code>select * from s1 where key_part1 = 'a' and key_part3 = 'a';</code> \uff0c\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u7684\u8054\u5408\u7d22\u5f15\uff0cwhere\u6761\u4ef6\u6ca1\u6709\u8fde\u7eed\u4f7f\u7528\u7d22\u5f15\u5217\uff0c\u4ece\u4e2d\u95f4\u65ad\u4e86\uff0c\u5982\u679c\u5f00\u542f\u4e86\u7d22\u5f15\u4e0b\u63a8\uff0c\u90a3\u4e48\u5b58\u50a8\u5f15\u64ce\u4f1a\u7acb\u523b\u5224\u65ad\u4e8c\u7ea7\u7d22\u5f15\u662f\u5426\u6ee1\u8db3\u540e\u9762\u8fc7\u6ee4\u6761\u4ef6\uff0c\u7136\u540e\u518d\u6267\u884c\u56de\u8868\uff0c\u5982\u679c\u6ca1\u6709\u5f00\u542f\u7d22\u5f15\u4e0b\u63a8\uff0c\u90a3\u4e48\u4f1a\u5148\u6267\u884c\u56de\u8868\uff0c\u83b7\u53d6\u5230\u5b8c\u6574\u8bb0\u5f55\u540e\u518d\u5728server\u5c42\u5224\u65ad\u662f\u5426\u6ee1\u8db3\u540e\u9762\u7684\u8fc7\u6ee4\u6761\u4ef6\u3002<code>select key_part2 from s1 where key_part1 = 'a' and key_part3 = 'a';</code>\u8fd9\u79cd\u5c5e\u4e8e\u8986\u76d6\u7d22\u5f15\uff0c<code>key_part3 = 'a'</code>\u8fd9\u4e2a\u6761\u4ef6\u4f1a\u5728server\u5c42\u5224\u65ad\uff0c\u4e0d\u4f1a\u7528\u5230\u7d22\u5f15\u4e0b\u63a8\u3002\u8fd9\u662f\u56e0\u4e3a\u4ece\u4e8c\u7ea7\u7d22\u5f15\u56de\u8868\u5230\u805a\u7c07\u7d22\u5f15\u7684\u6574\u4e2a\u8fc7\u7a0b\u90fd\u662f\u5728\u5b58\u50a8\u5f15\u64ce\u5c42\uff0c\u56de\u8868\u540e\u628a\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9server\u5c42\u5224\u65ad\u5269\u4e0b\u7684\u6761\u4ef6\uff0c\u800c\u7d22\u5f15\u4e0b\u63a8\u53ea\u53d1\u751f\u5728\u5b58\u50a8\u5f15\u64ce\u5c42\u7684\u56de\u8868\u8fc7\u7a0b\uff0c\u6240\u4ee5\u8986\u76d6\u7d22\u5f15\u4e0d\u4f1a\u7528\u5230\u7d22\u5f15\u4e0b\u63a8\u3002</li> <li><code>select * from s1 where key1 &gt; 'z' and key1 like '%b';</code>\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e5f\u53ef\u5e94\u7528\u7d22\u5f15\u4e0b\u63a8\u3002</li> </ul> <p>EXPLAIN\u7684Extra\u5217\u6709<code>Using index condition</code>\u8868\u793a\u4f7f\u7528\u5230\u4e86\u7d22\u5f15\u4e0b\u63a8\uff0c\u4f46\u662f\u5176\u4ed6\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u9700\u8981\u56de\u8868\u7684\u5e38\u89c4\u60c5\u51b5\uff08\u9664\u4e86\u4f7f\u7528\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u6bd4\u8f83\uff09\u4e5f\u4f1a\u4f7f\u7528<code>Using index condition</code>\u7684\u63d0\u793a\uff0c\u6240\u4ee5MySQL\u5c06\u9664\u4e86\u4f7f\u7528\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u6bd4\u8f83\u7684\u60c5\u51b5\u5916\uff0c\u5176\u4ed6\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u540e\u9700\u8981\u56de\u8868\u7684\u60c5\u51b5\u90fd\u53eb\u7d22\u5f15\u4e0b\u63a8\uff0c\u8bbe\u7f6e\u5f00\u542f\u7d22\u5f15\u4e0b\u63a8\u53ea\u662f\u5728\u56de\u8868\u65f6\u989d\u5916\u589e\u52a0\u4e0a\u9762\u7684\u903b\u8f91\u800c\u5df2\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_13","title":"\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\uff1f","text":"<p>InnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u5728\u540e\u53f0\u9ed8\u9ed8\u5730\u76d1\u63a7\u5bf9\u7d22\u5f15\u7684\u67e5\u8be2\u64cd\u4f5c\uff0c\u5f53\u53d1\u73b0\u67d0\u4e9b\u7d22\u5f15\u7684\u7b49\u503c\u67e5\u8be2\u8db3\u591f\u9891\u7e41\u65f6\uff0cInnoDB \u4f1a\u81ea\u52a8\u5728\u5185\u5b58\u4e2d\u57fa\u4e8e\u8fd9\u4e9b\u7d22\u5f15\u6784\u5efa\u54c8\u5e0c\u7d22\u5f15\u3002\u54c8\u5e0c\u7d22\u5f15\u5bf9\u4e8e\u7b49\u503c\u67e5\u8be2\u5177\u6709\u975e\u5e38\u9ad8\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u5b83\u901a\u8fc7\u54c8\u5e0c\u51fd\u6570\u76f4\u63a5\u5b9a\u4f4d\u5230\u6570\u636e\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u800c\u4e0d\u50cf B - Tree \u7d22\u5f15\u90a3\u6837\u9700\u8981\u4ece\u6839\u8282\u70b9\u5f00\u59cb\u5c42\u5c42\u904d\u5386\u3002\u8fd9\u79cd\u54c8\u5e0c\u7d22\u5f15\u662f\u81ea\u9002\u5e94\u7684\uff0c\u5982\u679c\u67e5\u8be2\u6a21\u5f0f\u53d1\u751f\u53d8\u5316\uff0c\u4f8b\u5982\u67d0\u4e2a\u539f\u672c\u9891\u7e41\u4f7f\u7528\u7b49\u503c\u67e5\u8be2\u7684\u7d22\u5f15\u73b0\u5728\u5f88\u5c11\u88ab\u8fd9\u6837\u8bbf\u95ee\uff0c\u6216\u8005\u6570\u636e\u5206\u5e03\u53d1\u751f\u4e86\u8f83\u5927\u7684\u53d8\u5316\uff0cInnoDB \u4f1a\u81ea\u52a8\u8c03\u6574\u54c8\u5e0c\u7d22\u5f15\uff0c\u53ef\u80fd\u4f1a\u51cf\u5c11\u751a\u81f3\u5220\u9664\u90a3\u4e9b\u4e0d\u518d\u6709\u7528\u7684\u54c8\u5e0c\u7d22\u5f15\u90e8\u5206\u3002\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u5b58\u50a8\u5728Buffer Pool\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_14","title":"\u67e5\u8be2\u4f18\u5316","text":""},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_15","title":"\u5355\u8868\u8bbf\u95ee\u65b9\u6cd5\uff1f","text":"<p>\u5355\u8868\u8bbf\u95ee\u65b9\u6cd5\uff1a</p> <ul> <li>const\uff1a\u901a\u8fc7\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u4e0e\u5e38\u6570\u7684\u7b49\u503c\u6bd4\u8f83\u6765\u5b9a\u4f4d\u4e00\u6761\u8bb0\u5f55\u7684\u67e5\u8be2\uff0c\u8054\u5408\u7d22\u5f15\u9700\u8981\u6bcf\u4e2a\u7d22\u5f15\u5217\u90fd\u8fdb\u884c\u7b49\u503c\u6bd4\u8f83\u3002\u5b9a\u4f4d\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u503c\u4e3aNULL\u7684\u8bb0\u5f55\u7684\u8fd9\u79cd\u67e5\u8be2\u4e0d\u662fconst\uff0c\u56e0\u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5e76\u4e0d\u9650\u5236NULL\u503c\u7684\u6570\u91cf\uff0c\u53ef\u80fd\u4f1a\u67e5\u51fa\u5f88\u591a\u8bb0\u5f55\u3002</li> <li>ref\uff1a\u901a\u8fc7\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15\u4e0e\u5e38\u6570\u7684\u7b49\u503c\u6bd4\u8f83\u7684\u67e5\u8be2\uff0c\u4e0d\u9700\u8981\u8054\u5408\u7d22\u5f15\u6bcf\u4e2a\u7d22\u5f15\u5217\u90fd\u8fdb\u884c\u7b49\u503c\u6bd4\u8f83\u3002\u8fd9\u79cd\u67e5\u8be2\u641c\u7d22\u5230\u7b2c\u4e00\u6761\u8bb0\u5f55\u540e\u8fd8\u9700\u8981\u6cbf\u7740\u5355\u5411\u94fe\u8868\u7ee7\u7eed\u5411\u540e\u641c\u7d22\u3002\u6240\u4ee5\u67e5\u8be2\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u503c\u4e3aNULL\u7684\u8bb0\u5f55\u7684\u8bbf\u95ee\u65b9\u6cd5\u662fref\u3002</li> <li>ref_or_null\uff1a\u4e8c\u7ea7\u7d22\u5f15\u4e0e\u5e38\u6570\u8fdb\u884c\u7b49\u503c\u6bd4\u8f83\u7684\u540c\u65f6\u8fd8\u67e5\u8be2\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u503c\u4e3aNULL\u7684\u8bb0\u5f55\u3002</li> <li>range\uff1a\u4f7f\u7528\u7d22\u5f15\u67e5\u8be2\u65f6\uff0c\u5bf9\u5e94\u7684\u626b\u63cf\u533a\u95f4\u4e3a\u82e5\u5e72\u4e2a\u5355\u70b9\u626b\u63cf\u533a\u95f4\u6216\u8005\u8303\u56f4\u626b\u63cf\u533a\u95f4\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3arange\u3002\u524d\u9762\u4e09\u79cd\u8bbf\u95ee\u65b9\u6cd5\u90fd\u662f\u7b49\u503c\u6bd4\u8f83\uff0c\u4e00\u4e2a\u7b49\u503c\u6bd4\u8f83\u662f\u4e00\u4e2a\u5355\u70b9\u626b\u63cf\u533a\u95f4\uff0crange\u9700\u8981\u591a\u4e2a\u5355\u70b9\u626b\u63cf\u533a\u95f4\uff0c\u6216\u8005\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8303\u56f4\u662f(-\u65e0\u7a77\u5927\uff0c+\u65e0\u7a77\u5927)\u7684\u67e5\u8be2\u4e0d\u662frange\u3002</li> <li>index\uff1a\u5168\u8868\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u4e0d\u9700\u8981\u56de\u8868\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3aindex\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u5728\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u7684\u626b\u63cf\u8303\u56f4\u662f(-\u65e0\u7a77\u5927\uff0c+\u65e0\u7a77\u5927)\u3002</li> <li>index_merge\uff1a\u4f7f\u7528Intersection\u3001Union\u3001Sort-Union\u8fd93\u79cd\u7d22\u5f15\u5408\u5e76\u65b9\u5f0f\u6267\u884c\u7684\u67e5\u8be2\u3002</li> <li>all\uff1a\u5168\u8868\u626b\u63cf\u805a\u7c07\u7d22\u5f15\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3aall\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_16","title":"\u7d22\u5f15\u5408\u5e76\uff1f","text":"<ul> <li>Intersection\u7d22\u5f15\u5408\u5e76\uff1aand\u6761\u4ef6\u4f7f\u7528\u5230\u7684\u6240\u6709\u7d22\u5f15\u90fd\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5e76\u4e14\u4ece\u6bcf\u4e2a\u7d22\u5f15\u4e2d\u83b7\u53d6\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u90fd\u662f\u6309\u7167\u4e3b\u952e\u503c\u6392\u5e8f\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f1a\u5bf9\u591a\u4e2a\u7d22\u5f15\u67e5\u8be2\u7ed3\u679c\u53d6\u4ea4\u96c6\u3002</li> <li>Union\u7d22\u5f15\u5408\u5e76\uff1aor\u6761\u4ef6\u4f7f\u7528\u5230\u7684\u6240\u6709\u7d22\u5f15\u90fd\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5e76\u4e14\u4ece\u6bcf\u4e2a\u7d22\u5f15\u4e2d\u83b7\u53d6\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u90fd\u662f\u6309\u7167\u4e3b\u952e\u503c\u6392\u5e8f\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u624d\u4f1a\u5bf9\u591a\u4e2a\u7d22\u5f15\u67e5\u8be2\u7ed3\u679c\u53d6\u5e76\u96c6\u3002</li> <li>Sort-Union\u7d22\u5f15\u5408\u5e76\uff1aor\u6761\u4ef6\u4f7f\u7528\u5230\u7684\u6240\u6709\u7d22\u5f15\u90fd\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u83b7\u53d6\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\u5e76\u4e0d\u90fd\u662f\u6392\u597d\u5e8f\u7684\uff0c\u90a3\u4e48\u4f1a\u5c06\u4ece\u5404\u4e2a\u7d22\u5f15\u4e2d\u626b\u63cf\u5230\u7684\u4e3b\u952e\u503c\u6392\u5e8f\uff0c\u7136\u540e\u518d\u4f7f\u7528Union\u7d22\u5f15\u5408\u5e76\u3002</li> </ul> <p>\u53ea\u6709Sort-Union\u7d22\u5f15\u5408\u5e76\uff0c\u6ca1\u6709Sort-Intersection\u7d22\u5f15\u5408\u5e76\uff08MariaDB\u6709Sort-Intersection\u7d22\u5f15\u5408\u5e76\uff09\u7684\u53ef\u80fd\u539f\u56e0\u662f\uff1a\u5982\u679c\u4e0d\u4f7f\u7528Union\u7d22\u5f15\u5408\u5e76\uff0c\u53ea\u4f7f\u7528\u5176\u4e2d\u4e00\u4e2a\u7d22\u5f15\uff0c\u90a3\u4e48\u6700\u7ec8\u8fd8\u662f\u9700\u8981\u5168\u8868\u626b\u63cf\u5224\u65ad\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u662f\u5426\u6210\u7acb\uff0c\u76f8\u5f53\u4e8e\u4e24\u4e2a\u7d22\u5f15\u90fd\u6ca1\u6709\u7528\u5230\uff0c\u6240\u4ee5\u5f15\u5165Sort-Union\u7d22\u5f15\u5408\u5e76\u662f\u5f88\u6709\u7528\u7684\u3002\u4f46\u662f\u5bf9\u4e8eIntersection\u7d22\u5f15\u5408\u5e76\u800c\u8a00\uff0c\u5982\u679c\u53ea\u4f7f\u7528\u4e00\u4e2a\u7d22\u5f15\uff0c\u53e6\u4e00\u4e2a\u5224\u65ad\u6761\u4ef6\u53ef\u4ee5\u518d\u56de\u8868\u4e4b\u540e\u8fdb\u884c\uff0c\u5176\u6210\u672c\u53ef\u80fd\u6bd4\u4f7f\u7528\u4e24\u4e2a\u7d22\u5f15\u7684Sort-Intersection\u7d22\u5f15\u5408\u5e76\u66f4\u4f4e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_17","title":"\u591a\u8868\u8fde\u63a5\u7684\u65b9\u6cd5\uff1f","text":"<ul> <li>\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\uff08Index Nested-Loop Join\uff0cNLJ\uff09\uff1a\u6bcf\u6b21\u67e5\u8be2\u9a71\u52a8\u8868\u5f97\u5230\u4e00\u6761\u8bb0\u5f55\u4e4b\u540e\u5c31\u6839\u636e\u8fd9\u6761\u8bb0\u5f55\u7acb\u523b\u67e5\u8be2\u88ab\u9a71\u52a8\u8868\u7684\u65b9\u5f0f\u79f0\u4e3a\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u3002</li> <li>\u9a71\u52a8\u8868\u53ea\u8bbf\u95ee\u4e00\u6b21\uff0c\u88ab\u9a71\u52a8\u8868\u8bbf\u95ee\u7684\u6b21\u6570\u53d6\u51b3\u4e8e\u5bf9\u9a71\u52a8\u8868\u5355\u8868\u67e5\u8be2\u540e\u7684\u7ed3\u679c\u96c6\u4e2d\u6709\u591a\u5c11\u6761\u8bb0\u5f55\u3002</li> <li>\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u4f1a\u4f7f\u7528\u7d22\u5f15\u52a0\u5feb\u9a71\u52a8\u8868\u548c\u88ab\u9a71\u52a8\u8868\u7684\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0c\u90a3\u4e48\u76f4\u63a5\u9009\u62e9\u57fa\u4e8e\u5757\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u65b9\u6cd5\u3002</li> <li>\u901a\u8fc7\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5bf9\u5355\u8868\u8fdb\u884c\u5e38\u6570\u7b49\u503c\u67e5\u8be2\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3aconst\uff0c\u800c\u5728\u8fde\u63a5\u67e5\u8be2\u4e2d\u5bf9\u88ab\u9a71\u52a8\u8868\u901a\u8fc7\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3aeq_ref\u3002</li> <li>\u6bcf\u6b21\u67e5\u8be2\u9a71\u52a8\u8868\u5f97\u5230\u4e00\u6761\u8bb0\u5f55\u540e\u5c31\u7acb\u523b\u8bbf\u95ee\u88ab\u9a71\u52a8\u8868\u53ef\u80fd\u4f1a\u9020\u6210\u5927\u91cf\u7684\u968f\u673aIO\uff0c\u548c\u56de\u8868\u7684\u4ee3\u4ef7\u4e00\u6837\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u4f7f\u7528MRR\u8fdb\u884c\u4f18\u5316\uff0c\u5c06\u8bb0\u5f55\u6309\u5173\u8054\u952e\u6392\u5e8f\u4e4b\u540e\u518d\u4e00\u6b21\u6027\u8bbf\u95ee\u88ab\u9a71\u52a8\u8868\uff0c\u8fd9\u79cd\u5728\u8fde\u63a5\u65f6\u4f7f\u7528MRR\u7684\u65b9\u6cd5\u79f0\u4e3aBatched Key Acess(BKA)\u7b97\u6cd5\u3002</li> <li>\u57fa\u4e8e\u5757\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\uff08Block Nested-Loop Join\uff0cBNL\uff09\uff1a\u5728\u6267\u884c\u8fde\u63a5\u67e5\u8be2\u524d\u7533\u8bf7\u4e00\u5757\u56fa\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\uff08Join Buffer\uff0c\u8fde\u63a5\u7f13\u51b2\u533a\uff09\uff0c\u5148\u628a\u82e5\u5e72\u6761\u9a71\u52a8\u8868\u7ed3\u679c\u96c6\u4e2d\u7684\u8bb0\u5f55\u88c5\u5728\u8fd9\u4e2aJoin Buffer\u4e2d\uff0c\u7136\u540e\u626b\u63cf\u88ab\u9a71\u52a8\u8868\uff0c\u6bcf\u4e00\u6761\u88ab\u9a71\u52a8\u8868\u7684\u8bb0\u5f55\u4e00\u6b21\u6027\u5730\u4e0eJoin Buffer\u4e2d\u7684\u591a\u6761\u9a71\u52a8\u8868\u8bb0\u5f55\u8fdb\u884c\u5339\u914d\u3002</li> <li>\u6700\u597d\u662f\u9a71\u52a8\u8868\u80fd\u4e00\u6b21\u5168\u90e8\u88c5\u8fdbJoin Buffer\u4e2d\uff0c\u4e5f\u5c31\u662f\u5c0f\u8868\u9a71\u52a8\u5927\u8868\u3002</li> <li>Hash JOIN\uff1aHash Join\u5c06\u9a71\u52a8\u8868\u548c\u88ab\u9a71\u52a8\u8868\u6309\u5173\u8054\u952ehash\u4e4b\u540e\u518d\u505a\u8fde\u63a5\uff0c\u53ea\u9002\u7528\u4e8e\u7b49\u503c\u8fde\u63a5\uff0cHash Join\u6700\u5927\u7684\u4f18\u52bf\u5e94\u8be5\u662f\u53ef\u4ee5\u5e76\u884cJoin\u3002</li> <li>Hash join\u4f7f\u7528\u7684\u4e5f\u662fJoin Buffer\uff0c\u6700\u597d\u662f\u9a71\u52a8\u8868\u80fd\u4e00\u6b21\u5168\u90e8\u88c5\u8fdb\u5185\u5b58\uff0c\u5982\u679c\u5185\u5b58\u653e\u4e0d\u4e0b\u4f1a\u6ea2\u5199\u5230\u78c1\u76d8\u6587\u4ef6\u3002</li> <li>MySQL 8.0.18 \u5f15\u5165\u4e86Hash Join\uff0c\u5bf9\u4e8eMySQL\u6765\u8bf4\uff0cHash join\u5c5e\u4e8e\u5728BNL\uff08\u57fa\u4e8e\u5757\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\uff09\u7b97\u6cd5\u7684\u4e00\u90e8\u5206\uff0c\u5f00\u542fBNL\uff08<code>block_nested_loop=on</code>\uff09\uff0cMySQL\u4f1a\u5c3d\u53ef\u80fd\u5148\u4f7f\u7528Hash join\uff0c\u5982\u679c\u7528\u4e0d\u4e86Hash join\u518d\u4f7f\u7528\u4f20\u7edf\u7684BNL\u3002</li> </ul> <p>\u53c2\u8003\uff1aMySQL\u4e2d\u7684Join \u7684\u7b97\u6cd5\uff08NLJ\u3001BNL\u3001BKA\uff09-\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u793e\u533a</p> <p>\u6280\u672f\u5206\u4eab | Hash join in MySQL 8 - \u4e2a\u4eba\u6587\u7ae0 - SegmentFault \u601d\u5426</p> <p>MySQL :: MySQL 8.4 Reference Manual :: 10.2.1.4 Hash Join Optimization</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_18","title":"\u67e5\u8be2\u4f18\u5316\uff1f","text":"<p>\u67e5\u8be2\u4f18\u5316\u6709\u4e24\u79cd\u624b\u6bb5\uff1a</p> <ul> <li>\u57fa\u4e8e\u6210\u672c\u8fdb\u884c\u4f18\u5316\uff1a\u4ece\u591a\u4e2a\u6267\u884c\u8ba1\u5212\u4e2d\u627e\u51fa\u6210\u672c\u6700\u4f4e\u7684\u65b9\u6848\u3002</li> <li>\u57fa\u4e8e\u89c4\u5219\u8fdb\u884c\u4f18\u5316\uff1a\u4f9d\u636e\u4e00\u4e9b\u89c4\u5219\u5bf9\u67e5\u8be2\u8fdb\u884c\u91cd\u5199\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_19","title":"\u67e5\u8be2\u6210\u672c\uff1f","text":"<p>MySQL\u6267\u884c\u6210\u672c\u7531\u4e24\u65b9\u9762\u7ec4\u6210\uff1a</p> <ul> <li>IO\u6210\u672c\uff1aInnoDB\u65e0\u6cd5\u51c6\u786e\u9884\u6d4b\u9875\u9762\u662f\u5426\u5df2\u7ecf\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u6240\u4ee5\u9ed8\u8ba4\u8bfb\u53d6\u4e00\u4e2a\u9875\u9762\u7684\u6210\u672c\u662f1.0\u3002</li> <li>CPU\u6210\u672c\uff1a\u68c0\u6d4b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u7b26\u5408\u641c\u7d22\u6761\u4ef6\u7684\u6210\u672c\u9ed8\u8ba4\u662f0.2\uff0c\u4e0d\u7ba1\u662f\u5426\u5b58\u5728where\u6761\u4ef6\u90fd\u4e00\u6837\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_20","title":"\u5355\u8868\u67e5\u8be2\u6210\u672c\uff1f","text":"<p>\u627e\u51fa\u6210\u672c\u6700\u4f4e\u7684\u6267\u884c\u8ba1\u5212\u7684\u4e00\u822c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u8ba1\u7b97\u5168\u8868\u626b\u63cf\u7684\u4ee3\u4ef7\u3002</li> <li>\u8ba1\u7b97\u4f7f\u7528\u4e0d\u540c\u7d22\u5f15\u6267\u884c\u67e5\u8be2\u7684\u4ee3\u4ef7\u3002</li> <li>\u627e\u51fa\u6210\u672c\u6700\u4f4e\u7684\u65b9\u6848\u3002</li> </ol> <p>\u5168\u8868\u626b\u63cf\u7684\u4ee3\u4ef7\u662f\u4e0b\u9762\u4e24\u90e8\u5206\u4e4b\u548c\uff0c\u5176\u4e2d\u8868\u4e2d\u7684\u8bb0\u5f55\u6570n_rows\u53ef\u4ee5\u76f4\u63a5\u4eceInnoDB\u6536\u96c6\u7684\u7edf\u8ba1\u6570\u636e\u4e2d\u83b7\u53d6\uff0c\u662f\u4e00\u4e2a\u4f30\u8ba1\u503c\uff1a</p> <ul> <li>IO\u6210\u672c = \u805a\u7c07\u7d22\u5f15\u5360\u7528\u7684\u9875\u9762\u6570 * 1.0</li> <li>CPU\u6210\u672c = \u8bb0\u5f55\u6570 * 0.2</li> </ul> <p>\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u7684\u4ee3\u4ef7\u7b49\u4e8e\u4ee5\u4e0b4\u90e8\u5206\u4e4b\u548c\uff1a</p> <ul> <li>\u4e8c\u7ea7\u7d22\u5f15\u7684IO\u6210\u672c\uff1a\u67e5\u8be2\u4f18\u5316\u5668\u7b80\u5355\u7c97\u66b4\u5730\u8ba4\u4e3a\u8bfb\u53d6\u4e8c\u7ea7\u7d22\u5f15\u7684\u4e00\u4e2a\u626b\u63cf\u533a\u95f4\u7684IO\u6210\u672c\u7b49\u4e8e\u8bfb\u53d6\u4e00\u4e2a\u9875\u9762\u7684IO\u6210\u672c\u3002</li> <li>\u4e8c\u7ea7\u7d22\u5f15\u7684CPU\u6210\u672c\uff1a\u8ba1\u7b97\u67d0\u4e2a\u626b\u63cf\u533a\u95f4\u5230\u5e95\u5305\u542b\u591a\u5c11\u6761\u8bb0\u5f55\u7684\u8fc7\u7a0b\u662f\uff0c\u9996\u5148\u627e\u5230\u626b\u63cf\u533a\u95f4\u6700\u5de6\u8fb9\u548c\u6700\u53f3\u8fb9\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u53f6\u5b50\u8282\u70b9\u9875\u9762\u7684\u53cc\u5411\u94fe\u8868\u5411\u53f3\u6700\u591a\u8bfb\u53d610\u9875\u9762\uff0c\u76f4\u81f3\u9047\u5230\u6700\u53f3\u8bb0\u5f55\u6240\u5728\u7684\u9875\u9762\uff0c\u5982\u679c\u63d0\u524d\u9047\u5230\u5c31\u63d0\u524d\u7ed3\u675f\uff0c\u5982\u679c\u8bfb\u5b8c10\u4e2a\u9875\u9762\u8fd8\u9047\u4e0d\u5230\u4e5f\u4e0d\u518d\u8bfb\u4e86\uff0c\u6700\u540e\u5c06\u9875\u9762Page Header\u4e2d\u8bb0\u5f55\u8be5\u9875\u9762\u7684\u8bb0\u5f55\u6570\u7684\u6570\u503c\u52a0\u8d77\u6765\uff0c\u5982\u679c\u6700\u53f3\u8bb0\u5f55\u572810\u4e2a\u9875\u9762\u4e4b\u5185\uff0c\u90a3\u4e48\u8bb0\u5f55\u6570\u4e4b\u548c\u5c31\u662f\u9700\u8981\u56de\u8868\u7684\u8bb0\u5f55\u6570\uff0c\u5982\u679c\u6700\u53f3\u8bb0\u5f55\u572810\u4e2a\u9875\u9762\u4e4b\u5916\uff0c\u90a3\u5c31\u5c06\u8bb0\u5f55\u6570\u636e\u4e4b\u548c\u9664\u4ee510\u5f97\u5230\u5e73\u5747\u6bcf\u4e2a\u9875\u9762\u7684\u8bb0\u5f55\u6570\uff0c\u4e4b\u540e\u4e58\u4ee5\u6700\u5de6\u8bb0\u5f55\u548c\u6700\u53f3\u8bb0\u5f55\u4e4b\u95f4\u76f8\u9694\u7684\u9875\u9762\u6570\uff0c\u5373\u53ef\u9884\u4f30\u9700\u8981\u56de\u8868\u7684\u8bb0\u5f55\u6570\u3002\u4e8c\u7ea7\u7d22\u5f15\u7684CPU\u6210\u672c\u5c31\u7b49\u4e8e\u9700\u8981\u56de\u8868\u7684\u8bb0\u5f55\u6570 * 0.2\u3002</li> <li>\u5982\u4f55\u5f97\u5230\u6700\u5de6\u8bb0\u5f55\u548c\u6700\u53f3\u8bb0\u5f55\u4e4b\u95f4\u76f8\u9694\u591a\u5c11\u4e2a\u9875\u9762\uff1f\u53ef\u4ee5\u5206\u522b\u4ece\u6700\u5de6\u8bb0\u5f55\u548c\u6700\u53f3\u8bb0\u5f55\u5411\u4e0a\u9012\u5f52\u76f4\u81f3\u627e\u5230\u540c\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u7684\u76ee\u5f55\u9879\u8ba1\u7b97\u5f97\u5230\u4ed6\u4fe9\u4e4b\u95f4\u76f8\u5dee\u7684\u9875\u9762\u6570\u3002</li> <li>\u56de\u8868\u7684IO\u6210\u672c\uff1a\u67e5\u8be2\u4f18\u5316\u5668\u7b80\u5355\u7c97\u66b4\u7684\u8ba4\u4e3a\u6bcf\u6b21\u56de\u8868\u90fd\u76f8\u5f53\u4e8e\u8bbf\u95ee\u4e86\u4e00\u4e2a\u9875\u9762\uff0c\u6240\u4ee5\u56de\u8868\u7684IO\u6210\u672c\u7b49\u4e8e\u56de\u8868\u7684\u8bb0\u5f55\u6570 * 1.0\u3002</li> <li>\u56de\u8868\u7684CPU\u6210\u672c\uff1a\u7b49\u4e8e\u56de\u8868\u7684\u8bb0\u5f55\u6570 * 0.2\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_21","title":"\u591a\u8868\u8fde\u63a5\u7684\u6210\u672c\uff1f","text":"<p>\u4e24\u8868\u8fde\u63a5\u67e5\u8be2\u603b\u6210\u672c  = \u5355\u6b21\u8bbf\u95ee\u9a71\u52a8\u8868\u7684\u6210\u672c + \u9a71\u52a8\u8868\u6247\u51fa\u503c * \u5355\u6b21\u8bbf\u95ee\u88ab\u9a71\u52a8\u8868\u7684\u6210\u672c\u3002\uff08\u8fd9\u4e2a\u6210\u672c\u8ba1\u7b97\u65b9\u5f0f\u5f88\u7c97\u7565\u7684\uff0c\u5bf9\u4e8e\u57fa\u4e8e\u7d22\u5f15\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u5927\u81f4\u9002\u7528\uff0c\u4f46\u662f\u5bf9\u4e8e\u57fa\u4e8e\u5757\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u548c\u54c8\u5e0c\u8fde\u63a5\u5c31\u4e0d\u592a\u9002\u7528\uff09</p> <p>\u6247\u51fa\uff08fanout\uff09\u662f\u6307\u9a71\u52a8\u8868\u4e2d\u6ee1\u8db3where\u6761\u4ef6\u7684\u8bb0\u5f55\u6570\uff0c\u771f\u5b9e\u7684\u6247\u51fa\u503c\u53ea\u80fd\u5728\u771f\u6b63\u6267\u884c\u5b8c\u9a71\u52a8\u8868\u67e5\u8be2\u4e4b\u540e\u624d\u80fd\u5f97\u5230\uff0c\u6240\u4ee5\u8ba1\u7b97\u8fde\u63a5\u6210\u672c\u65f6\u6247\u51fa\u503c\u53ea\u80fd\u9760\u731c\u6d4b\uff08\u901a\u8fc7\u4e00\u4e9b\u542f\u53d1\u5f0f\u89c4\u5219\u8fdb\u884c\u731c\u6d4b\uff09\uff0c\u8fd9\u4e2a\u731c\u6d4b\u8fc7\u7a0b\u79f0\u4e3a\u6761\u4ef6\u8fc7\u6ee4\uff08Condition Filtering\uff09\u3002</p> <p>\u5bf9\u4e8e\u5916\u8fde\u63a5\u6765\u8bf4\uff0c\u9a71\u52a8\u8868\u662f\u56fa\u5b9a\u7684\uff0c\u4e0d\u80fd\u8f7b\u6613\u4e92\u6362\uff08\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\u5916\u8fde\u63a5\u53ef\u4ee5\u4f18\u5316\u4e3a\u5185\u8fde\u63a5\uff09\uff0c\u4f46\u662f\u5bf9\u4e8e\u5185\u8fde\u63a5\u6765\u8bf4\uff0c\u9a71\u52a8\u8868\u548c\u88ab\u9a71\u52a8\u8868\u53ef\u4ee5\u4e92\u6362\uff0c\u6240\u4ee5\u9700\u8981\u9009\u53d6\u4e0d\u540c\u7684\u8868\u4f5c\u4e3a\u9a71\u52a8\u8868\u6765\u8ba1\u7b97\u5185\u8fde\u63a5\u7684\u6210\u672c\uff0c\u6700\u540e\u9009\u62e9\u6210\u672c\u6700\u4f4e\u7684\u65b9\u6848\u3002</p> <p>\u591a\u8868\u5185\u8fde\u63a5\u6709n\u7684\u9636\u4e58\u79cd\u8fde\u63a5\u987a\u5e8f\uff0cMySQL\u4f1a\u901a\u8fc7\u4e00\u4e9b\u65b9\u6cd5\u63d0\u524d\u4f18\u5316\u6389\u67d0\u4e9b\u8fde\u63a5\u987a\u5e8f\uff0c\u538b\u6839\u5c31\u4f1a\u8ba1\u7b97\u8fd9\u4e9b\u8fde\u63a5\u987a\u5e8f\u7684\u6210\u672c\uff0c\u4ece\u800c\u51cf\u5c11\u6210\u672c\u5206\u6790\u7684\u6210\u672c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#innodb_4","title":"InnoDB\u7edf\u8ba1\u6570\u636e\u662f\u5982\u4f55\u6536\u96c6\u7684\uff1f","text":"<p>InnoDB\u4f1a\u628a\u7edf\u8ba1\u6570\u636e\u4fdd\u5b58\u5230\u4e24\u4e2a\u8868\u4e2d\uff0cInnoDB\u53ef\u4ee5\u8bbe\u7f6e\u5b9a\u671f\u81ea\u52a8\u66f4\u65b0\u7edf\u8ba1\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u624b\u52a8\u8c03\u7528ANALYZE TABLE\u547d\u4ee4\u66f4\u65b0\u7edf\u8ba1\u4fe1\u606f\uff0c\u8fd8\u53ef\u4ee5\u624b\u52a8update\u8fd9\u4e24\u5f20\u8868\uff1a</p> <ul> <li>innodb_table_stats\uff1a\u5b58\u653e\u5173\u4e8e\u8868\u7684\u7edf\u8ba1\u6570\u636e\uff0c\u6bcf\u4e00\u6761\u8bb0\u5f55\u5bf9\u5e94\u7740\u4e00\u4e2a\u8868\u7684\u7edf\u8ba1\u6570\u636e\u3002</li> <li>innodb_index_stats\uff1a\u5b58\u653e\u5173\u4e8e\u7d22\u5f15\u7684\u7edf\u8ba1\u6570\u636e\uff0c\u6bcf\u4e00\u6761\u8bb0\u5f55\u5bf9\u5e94\u7740\u4e00\u4e2a\u7d22\u5f15\u7684\u4e00\u4e2a\u7edf\u8ba1\u9879\u7684\u7edf\u8ba1\u6570\u636e\u3002</li> </ul> <p>innodb_table_stats\u4e2d\u6709\u4e09\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u5217\uff1a</p> <ul> <li>n_rows\uff1a\u8868\u4e2d\u7684\u8bb0\u5f55\u6570\u3002</li> <li>clustered_index_size\uff1a\u8868\u7684\u805a\u7c07\u7d22\u5f15\u5360\u7528\u7684\u9875\u9762\u6570\u91cf\u3002</li> <li>sum_od_other_index_sizes\uff1a\u8868\u4e2d\u5176\u4ed6\u7d22\u5f15\u5360\u7528\u7684\u9875\u9762\u6570\u91cf\u3002</li> </ul> <p>n_rows\u7684\u503c\u662f\u8fd9\u6837\u4f30\u8ba1\u7684\uff1a\u6309\u7167\u4e00\u5b9a\u7684\u7b97\u6cd5\u4ece\u805a\u7c07\u7d22\u5f15\u4e2d\u9009\u53d6\u51e0\u4e2a\u53f6\u5b50\u8282\u70b9\u9875\u9762\uff0c\u7edf\u8ba1\u6bcf\u4e2a\u9875\u9762\u4e2d\u5305\u542b\u7684\u8bb0\u5f55\u6570\u91cf\uff0c\u7136\u540e\u8ba1\u7b97\u5e73\u5747\u6bcf\u4e2a\u9875\u9762\u5305\u542b\u7684\u8bb0\u5f55\u6570\uff0c\u4e4b\u540e\u518d\u4e58\u4ee5\u5168\u90e8\u53f6\u5b50\u8282\u70b9\u6570\u636e\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662fn_rows\u503c\u3002n_rows\u503c\u7684\u7cbe\u5ea6\u53d6\u51b3\u4e8e\u7edf\u8ba1\u65f6\u91c7\u6837\u7684\u9875\u9762\u6570\u91cf\uff0c\u8fd9\u4e2a\u91c7\u6837\u9875\u9762\u6570\u91cf\u53ef\u4ee5\u914d\u7f6e\uff0c\u9ed8\u8ba4\u503c\u662f20\u3002</p> <p>clustered_index_size\u548csum_od_other_index_sizes\u53ef\u4ee5\u901a\u8fc7\u7edf\u8ba1\u5404\u4e2a\u7d22\u5f15\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\u6bb5\u548c\u975e\u53f6\u5b50\u8282\u70b9\u6bb5\u5206\u522b\u5360\u7528\u7684\u9875\u9762\u6570\u91cf\u4e4b\u540e\u52a0\u548c\u5f97\u5230\u3002\u6bb5\u5bf9\u5e94\u7684INODE Entry\u7ed3\u6784\u53ef\u4ee5\u5728\u6839\u8282\u70b9\u9875\u9762Page Header\u4e2d\u627e\u5230\uff0c\u6839\u8282\u70b9\u9875\u9762\u7684\u9875\u53f7\u53ef\u4ee5\u5728\u6570\u636e\u5b57\u5178\u4e2d\u627e\u5230\uff0c\u6570\u636e\u5b57\u5178\u7684\u6839\u8282\u70b9\u9875\u9762\u53ef\u4ee5\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684\u7b2c7\u4e2a\u9875\u9762\u4e2d\u627e\u5230\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_22","title":"\u57fa\u4e8e\u89c4\u5219\u4f18\u5316\uff1f","text":"<p>\u57fa\u4e8e\u89c4\u5219\u7684\u4f18\u5316\u6709\uff1a\u6761\u4ef6\u5316\u7b80\u3001\u5916\u8fde\u63a5\u6d88\u9664\u3001\u5b50\u67e5\u8be2\u4f18\u5316\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_23","title":"\u6761\u4ef6\u5316\u7b80\uff1f","text":"<ul> <li>\u79fb\u9664\u4e0d\u5fc5\u8981\u7684\u62ec\u53f7</li> <li>\u5e38\u91cf\u4f20\u9012\uff1aa=5 and b&gt;a \u53ef\u4ee5\u5316\u7b80\u6210 a=5 and b&gt;5\uff0c\u5982\u679c\u662for\uff0c\u5219\u4e0d\u53ef\u4ee5\u5e38\u91cf\u4f20\u9012\u3002 </li> <li>\u79fb\u9664\u6ca1\u7528\u7684\u6761\u4ef6\uff1a\u4f18\u5316\u5668\u4f1a\u79fb\u9664\u6052\u4e3aTRUE\u6216FALSE\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u3002</li> <li>\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff1a\u5982\u679c\u8868\u8fbe\u5f0f\u4e2d\u53ea\u5305\u542b\u5e38\u91cf\uff0c\u5b83\u7684\u503c\u4f1a\u88ab\u5148\u8ba1\u7b97\u51fa\u6765\u3002</li> <li>\u5e38\u91cf\u8868\u68c0\u6d4b\uff1a\u9488\u5bf9\u8868\u4e2d\u53ea\u6709\u4e00\u6761\u8bb0\u5f55\u6216\u8005\u4e00\u6761\u8bb0\u5f55\u90fd\u6ca1\u6709\uff0c\u53c8\u6216\u8005\u4f7f\u7528\u4e3b\u952e\u3001\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u5339\u914d\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u8fd9\u4e24\u79cd\u67e5\u8be2\u82b1\u8d39\u7684\u65f6\u95f4\u5f88\u5c11\uff0c\u53ef\u4ee5\u5ffd\u7565\uff0c\u6240\u4ee5\u628a\u901a\u8fc7\u8fd9\u4e24\u79cd\u65b9\u5f0f\u67e5\u8be2\u7684\u8868\u79f0\u4e3a\u5e38\u91cf\u8868\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u4f1a\u5148\u6267\u884c\u5bf9\u5e38\u91cf\u8868\u7684\u67e5\u8be2\uff0c\u7136\u540e\u628a\u67e5\u8be2\u4e2d\u6d89\u53ca\u5230\u8be5\u8868\u7684\u6761\u4ef6\u90fd\u6362\u6210\u5e38\u6570\uff0c\u6700\u540e\u518d\u5206\u6790\u5176\u4f59\u8868\u7684\u67e5\u8be2\u6210\u672c\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_24","title":"\u5916\u8fde\u63a5\u6d88\u9664\uff1f","text":"<p>\u5728\u5916\u8fde\u63a5\u540e\u7684where\u6761\u4ef6\u4e2d\u9650\u5b9a\u88ab\u9a71\u52a8\u8868\u7684\u5217\u4e0d\u4e3aNULL\uff0c\u6216\u8005\u9690\u542b\u5730\u5305\u542b\u8fd9\u4e2a\u610f\u601d\uff0c\u90a3\u4e48\u5916\u8fde\u63a5\u5c31\u548c\u5185\u8fde\u63a5\u6ca1\u6709\u533a\u522b\u4e86\uff0c\u5c06\u5916\u8fde\u63a5\u8f6c\u6362\u6210\u5185\u8fde\u63a5\u7684\u597d\u5904\u662f\u4f18\u5316\u5668\u53ef\u4ee5\u8bc4\u4f30\u4e0d\u7528\u8fde\u63a5\u987a\u5e8f\u7684\u6210\u672c\uff0c\u4ece\u4e2d\u9009\u51fa\u6210\u672c\u6700\u4f4e\u7684\u8fde\u63a5\u987a\u5e8f\u6765\u6267\u884c\u67e5\u8be2\u3002\u628a\u5728\u5916\u8fde\u63a5\u4e2d\u6307\u5b9awhere\u5305\u542b\u88ab\u9a71\u52a8\u8868\u5217\u4e0d\u4e3aNULL\u7684\u6761\u4ef6\u6210\u4e3a\u7a7a\u503c\u62d2\u7edd\uff08reject-NULL\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_25","title":"\u5b50\u67e5\u8be2\u4f18\u5316\uff1f","text":"<p>\u5b50\u67e5\u8be2\u6700\u5e38\u51fa\u73b0\u5728\uff1aselect\u5b50\u53e5\u4e2d\u3001from\u5b50\u53e5\u4e2d\u3001where\u5b50\u53e5\u4e2d\u3002</p> <p>\u5b50\u67e5\u8be2\u6309\u8fd4\u56de\u7684\u7ed3\u679c\u96c6\u53ef\u5206\u4e3a\uff1a</p> <ul> <li>\u6807\u91cf\u5b50\u67e5\u8be2\uff1a\u53ea\u8fd4\u56de\u4e00\u4e2a\u5355\u4e00\u503c\u7684\u5b50\u67e5\u8be2\u3002</li> <li>\u884c\u5b50\u67e5\u8be2\uff1a\u8fd4\u56de\u4e00\u6761\u8bb0\u5f55\u7684\u5b50\u67e5\u8be2\u3002</li> <li>\u5217\u5b50\u67e5\u8be2\uff1a\u8fd4\u56de\u4e00\u5217\u6570\u636e\u7684\u5b50\u67e5\u8be2\uff0c\u8fd9\u4e00\u5217\u5305\u542b\u591a\u6761\u8bb0\u5f55\u3002</li> <li>\u8868\u5b50\u67e5\u8be2\uff1a\u8fd4\u56de\u591a\u6761\u8bb0\u5f55\u7684\u5b50\u67e5\u8be2\u3002</li> </ul> <p>\u5b50\u67e5\u8be2\u90a3\u4e0e\u5916\u5c42\u67e5\u8be2\u7684\u5173\u7cfb\u53ef\u5206\u4e3a\uff1a</p> <ul> <li>\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\uff1a\u5b50\u67e5\u8be2\u4e0d\u4f9d\u8d56\u5916\u5c42\u67e5\u8be2\u7684\u503c\uff0c\u53ef\u4ee5\u5355\u72ec\u6267\u884c\u3002</li> <li>\u76f8\u5173\u5b50\u67e5\u8be2\uff1a\u5b50\u67e5\u8be2\u7684\u6267\u884c\u9700\u8981\u4f9d\u8d56\u5916\u5c42\u67e5\u8be2\u7684\u503c\u3002</li> </ul> <p>\u4e0d\u76f8\u5173\u7684\u6807\u91cf\u5b50\u67e5\u8be2\u548c\u884c\u5b50\u67e5\u8be2\u53ef\u76f4\u63a5\u5148\u6267\u884c\uff0c\u4e0d\u9700\u8981\u4f18\u5316\uff0c\u5b50\u67e5\u8be2\u4f18\u5316\u7684\u91cd\u70b9\u662f\uff1a\u51fa\u73b0\u5728from\u5b50\u53e5\u4e2d\u5b50\u67e5\u8be2\u3001where\u4e2dIN\u5b50\u67e5\u8be2\u3001where\u4e2dEXISTS\u5b50\u67e5\u8be2\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#from","title":"FROM\u5b50\u67e5\u8be2\u4f18\u5316\uff1f","text":"<p>FROM\u540e\u9762\u7684\u5b50\u67e5\u8be2\u79f0\u4e3a\u6d3e\u751f\u8868\u3002FROM\u5b50\u67e5\u8be2\u4f18\u5316\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u628a\u6d3e\u751f\u8868\u7269\u5316\uff0c\u8fd9\u91cc\u7684\u7269\u5316\u662f\u6307\u628a\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u4fdd\u5b58\u5230\u4e34\u65f6\u8868\u4e2d\uff0c\u6ca1\u6709\u53bb\u91cd\u3002</li> <li>\u628a\u6d3e\u751f\u8868\u548c\u5916\u5c42\u67e5\u8be2\u5408\u5e76\uff0c\u76f4\u63a5\u63d0\u51fa\u6765\uff0c\u514d\u53bb\u521b\u5efa\u548c\u8bbf\u95ee\u4e34\u65f6\u8868\u7684\u6210\u672c\u3002</li> </ul> <p>MySQL\u5728\u6267\u884c\u5e26\u6709\u6d3e\u751f\u8868\u7684\u67e5\u8be2\u65f6\u4f1a\u4f18\u5148\u5c1d\u8bd5\u628a\u6d3e\u751f\u8868\u548c\u5916\u5c42\u67e5\u8be2\u8fdb\u884c\u5408\u5e76\uff0c\u5982\u679c\u4e0d\u884c\u518d\u628a\u6d3e\u751f\u8868\u7269\u5316\uff0c\u7136\u540e\u6267\u884c\u67e5\u8be2\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#in","title":"IN\u5b50\u67e5\u8be2\u4f18\u5316\uff1f","text":"<p>IN\u5b50\u67e5\u8be2\u4e0d\u7ba1\u662f\u5426\u662f\u76f8\u5173\u5b50\u67e5\u8be2\uff0c\u90fd\u662f\u4e24\u5f20\u8868\u7684\u4e4b\u95f4\u7684\u67e5\u8be2\uff0c\u65e2\u7136\u662f\u4e24\u5f20\u8868\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u90a3\u5c31\u53ef\u4ee5\u8f6c\u6362\u6210\u8fde\u63a5\u67e5\u8be2\uff0c\u4ece\u800c\u4f7f\u7528\u8fde\u63a5\u67e5\u8be2\u7684\u67e5\u8be2\u4f18\u5316\u65b9\u6cd5\uff0c\u4f46\u662fIN\u5b50\u53e5\u6709\u53bb\u91cd\u7684\u6548\u679c\uff0c\u4f46\u8fde\u63a5\u67e5\u8be2\u4e0d\u884c\uff0c\u8fde\u63a5\u67e5\u8be2\u5173\u8054\u952e\u91cd\u590d\u4f1a\u5bfc\u81f4\u6570\u636e\u7ffb\u500d\uff0c\u6240\u4ee5MySQL\u9488\u5bf9IN\u5b50\u67e5\u8be2\u63d0\u51fa\u4e86\u534a\u8fde\u63a5\uff08semi-join\uff09\uff0c\u5373a\u8868\u4e0eb\u8868\u8fdb\u884c\u534a\u8fde\u63a5\u53ea\u5173\u5fc3b\u8868\u4e2d\u662f\u5426\u5b58\u5728\u4e0e\u4e4b\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u800c\u4e0d\u5173\u5fc3\u5177\u4f53\u6709\u591a\u5c11\u8bb0\u5f55\u80fd\u5339\u914d\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u53ea\u4fdd\u7559a\u8868\u4e2d\u7684\u8bb0\u5f55\u3002\u534a\u8fde\u63a5\u7684\u5b9e\u73b0\u65b9\u5f0f\u6709\u5982\u4e0b\u51e0\u79cd\uff0c\u57fa\u672c\u4e0a\u90fd\u662f\u5728\u8fde\u63a5\u67e5\u8be2\u7684\u57fa\u7840\u4e0a\u7684\u6539\u9020\uff1a</p> <ul> <li>Semi-join Materialization\uff08\u534a\u8fde\u63a5\u7269\u5316\uff09\uff1a\u5148\u628aIN\u4e2d\u7684\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\u7269\u5316\uff08\u8fd9\u91cc\u7684\u7269\u5316\u662f\u6307\u628a\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u5b58\u5230\u5177\u6709\u552f\u4e00\u6027\u7684\u4e34\u65f6\u8868\u4e2d\uff09\uff0c\u7136\u540e\u518d\u5c06\u5916\u5c42\u67e5\u8be2\u7684\u8868\u4e0e\u7269\u5316\u8868\u8fdb\u884c\u8fde\u63a5\u3002\u5bf9\u4e8e\u76f8\u5173\u5b50\u67e5\u8be2\u4e0d\u80fd\u4f7f\u7528\u8fd9\u79cd\u534a\u8fde\u63a5\u5b9e\u73b0\u65b9\u5f0f\u3002</li> <li>Table pullout\uff08\u5b50\u67e5\u8be2\u8868\u4e0a\u62c9\uff09\uff1a\u5f53\u5b50\u67e5\u8be2\u7684\u67e5\u8be2\u5217\u8868\uff08select\u540e\u9762\u7684\u5217\uff09\u53ea\u6709\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7d22\u5f15\u5217\u65f6\uff0c\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u672c\u6765\u5c31\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5c06\u5b50\u67e5\u8be2\u4e2d\u7684\u8868\u4e0a\u62c9\u4e0e\u5916\u5c42\u67e5\u8be2\u4e2d\u7684\u8868join\u3002</li> <li>Duplicate Weedout\uff08\u91cd\u590d\u503c\u6d88\u9664\uff09\uff1a\u76f4\u63a5\u5c06\u5b50\u67e5\u8be2\u4e2d\u7684\u8868\u4e0a\u62c9\u4e0e\u5916\u5c42\u67e5\u8be2\u4e2d\u7684\u8868join\uff0c\u4e4b\u540e\u4e3a\u4e86\u6d88\u9664\u91cd\u590d\uff0c\u5c06\u7ed3\u679c\u96c6\u6309\u4e3b\u952eid\u53bb\u91cd\uff0c\u53bb\u91cd\u7684\u65b9\u6cd5\u662f\u6309\u4e3b\u952eid\u5efa\u4e00\u5f20\u4e34\u65f6\u8868\u3002</li> <li>LooseScan\uff08\u677e\u6563\u626b\u63cf\uff09\uff1a\u5b50\u67e5\u8be2\u7684\u67e5\u8be2\u5217\u8868\u662f\u67d0\u4e2a\u7d22\u5f15\u7684\u952e\u503c\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u5b50\u67e5\u8be2\u4e2d\u7684\u8868\u4f5c\u4e3a\u9a71\u52a8\u8868\uff0c\u6bcf\u6b21\u626b\u63cf\u5230\u503c\u76f8\u540c\u7684\u952e\u503c\u65f6\u53ea\u53d6\u7b2c\u4e00\u4e2a\uff0c\u7136\u540e\u6839\u636e\u952e\u503c\u67e5\u8be2\u5916\u5c42\u7684\u88ab\u9a71\u52a8\u8868\u3002</li> <li>FirstMatch\uff08\u9996\u6b21\u5339\u914d\uff09\uff1a\u9996\u6b21\u5339\u914d\u662f\u4e00\u79cd\u6700\u539f\u59cb\u7684\u534a\u8fde\u63a5\u6267\u884c\u65b9\u5f0f\uff0c\u5373\u5148\u53d6\u4e00\u6761\u5916\u5c42\u67e5\u8be2\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u6267\u884c\u5b50\u67e5\u8be2\u5224\u65ad\u662f\u5426\u6ee1\u8db3\u6761\u4ef6\uff0c\u5982\u6b64\u5faa\u73af\uff0c\u548c\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u4e00\u6837\u3002</li> </ul> <p>\u5e76\u975e\u6240\u6709IN\u5b50\u67e5\u8be2\u90fd\u53ef\u4ee5\u4f7f\u7528\u534a\u8fde\u63a5\uff0c\u534a\u8fde\u63a5\u7684\u9002\u7528\u6761\u4ef6\u5982\u4e0b\uff1a</p> <ul> <li>\u4f7f\u7528\u7684\u662fIN\uff0c\u800c\u4e0d\u662fNOT IN\u3002NOT IN\u4f7f\u7528\u53cd\u8fde\u63a5\uff08antijoin\uff09\u3002</li> <li>IN\u5fc5\u987b\u5728\u5916\u5c42\u67e5\u8be2\u4e2d\u7684WHERE\u6216\u8005ON\u5b50\u53e5\u4e2d\uff0c\u4e0d\u80fd\u4f4d\u4e8eSELECT\u4e2d\u3002</li> <li>\u5916\u5c42\u67e5\u8be2\u53ef\u4ee5\u6709\u5176\u4ed6\u6761\u4ef6\uff0c\u4f46\u662f\u5fc5\u987b\u4f7f\u7528and\u8fde\u63a5\uff0c\u4e0d\u80fd\u4f7f\u7528or\u64cd\u4f5c\u7b26\u3002</li> <li>\u5b50\u67e5\u8be2\u5fc5\u987b\u662f\u4e00\u4e2a\u5355\u4e00\u7684\u67e5\u8be2\uff0c\u4e0d\u80fd\u662f\u7531UNION\u8fde\u63a5\u8d77\u6765\u7684\u82e5\u5e72\u4e2a\u67e5\u8be2\u3002</li> <li>\u5b50\u67e5\u8be2\u4e2d\u4e0d\u80fd\u5305\u542bGOUP BY\u3001HAVING\u6216\u8005\u805a\u96c6\u51fd\u6570\u3002</li> </ul> <p>~~\u5bf9\u4e8e\u4e0d\u80fd\u8f6c\u6362\u6210\u534a\u8fde\u63a5\u7684\u5b50\u67e5\u8be2\uff0cMySQL\u8fd8\u6709\u4e24\u4e2a\u4f18\u5316\u65b9\u6cd5\uff0c\u6700\u540e\u4f1a\u4ece\u4e2d\u627e\u51fa\u6210\u672c\u66f4\u4f4e\u7684\u65b9\u6cd5\u6267\u884c\uff1a~~</p> <ul> <li>~~\u5bf9\u4e8e\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\uff0c\u53ef\u4ee5\u628a\u5b83\u7269\u5316\u540e\u518d\u53c2\u4e0e\u5916\u5c42\u67e5\u8be2\uff0c\u6bd4\u5982NOT IN\u5b50\u67e5\u8be2\u3002~~</li> <li>~~\u65e0\u8bba\u662f\u76f8\u5173\u8fd8\u662f\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\uff0c\u90fd\u53ef\u4ee5\u628aIN\u5b50\u67e5\u8be2\u8f6c\u6362\u6210EXISTS\u5b50\u67e5\u8be2\u3002~~</li> </ul> <p>\u5e94\u8be5\u6240\u6709IN\u5b50\u67e5\u8be2\u90fd\u53ef\u4ee5\u4f7f\u7528\u534a\u8fde\u63a5\u5427\uff0c\u56e0\u4e3aFirstMatch\uff08\u9996\u6b21\u5339\u914d\uff09\u5c31\u662f\u515c\u5e95\u4f7f\u7528\u7684\u65b9\u6cd5\uff0c\u4efb\u4f55IN\u5b50\u67e5\u8be2\u90fd\u80fd\u7528\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#exists","title":"EXISTS\u5b50\u67e5\u8be2\u4f18\u5316\uff1f","text":"<ul> <li>~~\u5982\u679c\u5b50\u67e5\u8be2\u662f\u4e0d\u76f8\u5173\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u5148\u6267\u884c\u5b50\u67e5\u8be2\u3002~~</li> <li>~~\u5982\u679c\u5b50\u67e5\u8be2\u662f\u76f8\u5173\u7684\uff0c\u90a3\u4e48\u5c31\u662f\u4f7f\u7528\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u5176\u4e2d\u5916\u5c42\u67e5\u8be2\u7684\u8868\u662f\u9a71\u52a8\u8868\uff0cEXISTS\u5b50\u67e5\u8be2\u7684\u8868\u662f\u88ab\u9a71\u52a8\u8868\u3002\u540c\u6837\u5982\u679c\u6709\u7d22\u5f15\u53ef\u4ee5\u52a0\u5feb\u67e5\u8be2\u7684\u901f\u5ea6\u3002NOT EXISTS\u4f7f\u7528\u53cd\u8fde\u63a5\uff08antijoin\uff09\u3002~~</li> </ul> <p>EXISTS\u5b50\u67e5\u8be2\u548cIN\u5b50\u67e5\u8be2\u4e00\u6837\uff0c\u53ef\u4ee5\u4f18\u5316\u6210\u534a\u8fde\u63a5\u3002NOT EXISTS\u4f18\u5316\u6210\u53cd\u8fde\u63a5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#explain","title":"EXPLAIN","text":"<p>explain\u53ef\u4ee5\u67e5\u770b\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u8ba1\u5212\uff0c\u8f93\u51fa\u7684\u5404\u4e2a\u5217\u7684\u4f5c\u7528\u5982\u4e0b\uff1a</p> Text Only<pre><code>mysql&gt; explain select * from user;\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+\n|  1 | SIMPLE      | user  | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | NULL  |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+\n1 row in set, 1 warning (0.02 sec)\n</code></pre> <ul> <li>table\uff1aexplain\u8f93\u51fa\u7684\u6bcf\u4e00\u884c\u90fd\u5bf9\u5e94\u7740\u4e00\u5f20\u5355\u8868\u7684\u8bbf\u95ee\u65b9\u6cd5\uff0ctable\u5217\u662f\u8be5\u8868\u7684\u8868\u540d\u3002</li> <li>id\uff1a\u6bcf\u4e2aselect\u5173\u952e\u5b57\u90fd\u5bf9\u5e94\u4e00\u4e2a\u552f\u4e00\u7684id\u3002</li> <li>\u5bf9\u4e8e\u8fde\u63a5\u67e5\u8be2\uff0c\u6bcf\u4e2a\u8868\u90fd\u4f1a\u8f93\u51fa\u4e00\u884c\uff0c\u4f46\u662f\u8fd9\u4e9b\u884c\u7684id\u662f\u76f8\u540c\u7684\uff0c\u51fa\u73b0\u5728\u524d\u9762\u7684\u8868\u662f\u9a71\u52a8\u8868\uff0c\u51fa\u73b0\u5728\u540e\u9762\u7684\u8868\u662f\u88ab\u9a71\u52a8\u8868\u3002</li> <li>\u67e5\u8be2\u4f18\u5316\u5668\u53ef\u80fd\u5bf9\u5b50\u67e5\u8be2\u8fdb\u884c\u91cd\u5199\uff0c\u8f6c\u6210\u534a\u8fde\u63a5\u67e5\u8be2\uff0c\u8fd9\u4e2a\u65f6\u5019\u5916\u5c42select\u548c\u5b50\u67e5\u8be2\u7684select\u7684id\u503c\u662f\u76f8\u540c\u7684\u3002</li> <li> <p>UNION\u5b50\u53e5\u4f1a\u5efa\u5185\u90e8\u4e34\u65f6\u8868\u53bb\u91cd\uff0c\u6b64\u65f6\u8fd9\u4e2a\u4e34\u65f6\u8868\u5bf9\u5e94\u884c\u7684id\u4e3aNULL\u3002</p> </li> <li> <p>select_type\uff1a\u6bcf\u5f20\u5355\u8868\u67e5\u8be2\u5728\u6574\u4e2a\u67e5\u8be2\u8bed\u53e5\u4e2d\u626e\u6f14\u7684\u89d2\u8272\u3002select_type\u53d6\u503c\u5982\u4e0b\uff1a</p> </li> <li>SIMPLE\uff1a\u67e5\u8be2\u8bed\u53e5\u4e2d\u4e0d\u5305\u542bUNION\u6216\u8005\u5b50\u67e5\u8be2\u7684\u67e5\u8be2\u90fd\u662fSIMPLE\u3002</li> <li>PRIMARY\uff1a\u5bf9\u4e8e\u5305\u542bUNION\u3001UNION ALL\u6216\u8005\u5b50\u67e5\u8be2\u7684\u5927\u67e5\u8be2\uff0c\u6700\u5de6\u8fb9\u90a3\u4e2a\u67e5\u8be2\u7684select_type\u5c31\u662fPRIMARY\u3002</li> <li>UNION\uff1aUNION\u5b50\u67e5\u8be2\u4e2d\u9664\u6700\u5de6\u8fb9\u7684\u5b50\u67e5\u8be2\u5916\uff0c\u5176\u4f59\u5b50\u67e5\u8be2\u7684select_type\u5c31\u662fUNION\u3002</li> <li>UNION RESULT\uff1a\u4f7f\u7528\u4e34\u65f6\u8868\u5b8c\u6210UNION\u67e5\u8be2\u7684\u53bb\u91cd\u5de5\u4f5c\uff0c\u4e34\u65f6\u8868\u7684select_type\u5c31\u662fUNION RESULT\u3002</li> <li>SUBQUERY\uff1aIN\u5b50\u67e5\u8be2\u4e0d\u80fd\u8f6c\u6362\u6210\u534a\u8fde\u63a5\uff0c\u4f46\u662f\u662f\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\uff0c\u5e76\u4e14\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u7269\u5316\u8be5\u5b50\u67e5\u8be2\uff0c\u90a3\u4e48\u8be5\u5b50\u67e5\u8be2\u7684select_type\u5c31\u662fSUBQUERY\u3002</li> <li>DEPENDENT SUBQUERY\uff1aIN\u5b50\u67e5\u8be2\u4e0d\u80fd\u8f6c\u6362\u6210\u534a\u8fde\u63a5\uff0c\u6700\u540e\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u8f6c\u6362\u6210EXISTS\u5b50\u67e5\u8be2\uff0c\u90a3\u4e48\u8be5\u5b50\u67e5\u8be2\u7684select_type\u5c31\u662fDEPENDENT SUBQUERY\u3002</li> <li>DEPENDENT UNION\uff1a\u5b50\u67e5\u8be2\u91cc\u9762\u5305\u542bUNION\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u53d6\u503c\u3002</li> <li>DERIVED\uff1a\u4ee5\u6d3e\u751f\u8868\u7269\u5316\u7684\u65b9\u5f0f\u6267\u884c\u5b50\u67e5\u8be2\uff0c\u6d3e\u751f\u8868\u5bf9\u5e94\u7684\u5b50\u67e5\u8be2\u7684select_type\u5c31\u662fDERIVED\u3002</li> <li>MATERIALIZED\uff1a\u9009\u62e9\u5c06\u5b50\u67e5\u8be2\u7269\u5316\u540e\u4e0e\u5916\u5c42\u67e5\u8be2\u8fdb\u884c\u8fde\u63a5\u7684\u5b50\u67e5\u8be2\u7684select_type\u5c31\u662fMATERIALIZED\uff0c\u5e94\u8be5\u662fSemi-join Materialization\uff08\u534a\u8fde\u63a5\u7269\u5316\uff09\u7684\u4e13\u5c5e\u3002</li> <li>type\uff1a\u5355\u8868\u7684\u8bbf\u95ee\u65b9\u6cd5\u3002\u5e38\u7528\u53d6\u503c\u5c31\u662f\u524d\u9762\u4ecb\u7ecd\u7684\u5355\u8868\u8bbf\u95ee\u65b9\u6cd5\u3002</li> <li>possible_keys\u548ckey\uff1apossible_keys\u8868\u793a\u5355\u8868\u67e5\u8be2\u53ef\u80fd\u7528\u5230\u7684\u7d22\u5f15\uff1bkey\u8868\u793a\u5b9e\u9645\u7528\u5230\u7684\u7d22\u5f15\u3002possible_keys\u5e76\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u7d22\u5f15\u8d8a\u591a\uff0c\u8ba1\u7b97\u67e5\u8be2\u6210\u672c\u7684\u65f6\u95f4\u5c31\u8d8a\u957f\u3002</li> <li>key_len\uff1a\u4f7f\u7528\u7684\u7d22\u5f15\u7684\u5217\u7684\u957f\u5ea6\u3002\u5982\u679c\u53ea\u662f\u5355\u4e2a\u5217\u7684\u7d22\u5f15\uff0c\u90a3\u4e48\u5c31\u662f\u8fd9\u4e2a\u5217\u7684\u957f\u5ea6\uff0c\u5982\u679c\u662f\u8054\u5408\u7d22\u5f15\uff0c\u5b9e\u9645\u4f7f\u7528\u4e86\u8054\u5408\u7d22\u5f15\u4e2d\u591a\u5c11\u4e2a\u5217\uff0c\u90a3key_len\u5c31\u662f\u8fd9\u4e9b\u5217\u7684\u957f\u5ea6\u4e4b\u548c\u3002key_len\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u4e3a\u4e86\u8ba9\u6211\u4eec\u77e5\u9053\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\u5177\u4f53\u4f7f\u7528\u5230\u4e86\u591a\u5c11\u4e2a\u5217\u3002</li> <li>ref\uff1a\u5f53\u5355\u8868\u8bbf\u95ee\u65b9\u6cd5\u662fconst\u3001ref\u3001ref_or_null\u3001eq_ref\u7b49\u65f6\uff0cref\u5217\u5c55\u793a\u4e86\u4e0e\u7d22\u5f15\u5217\u8fdb\u884c\u7b49\u503c\u6bd4\u8f83\u7684\u4e1c\u897f\u3002</li> <li>rows\uff1a\u626b\u63cf\u533a\u95f4\u9884\u8ba1\u8981\u626b\u63cf\u7684\u8bb0\u5f55\u6570\u3002</li> <li>filtered\uff1a\u626b\u63cf\u533a\u95f4\u4e2d\u6ee1\u8db3\u5176\u4f59\u641c\u7d22\u6761\u4ef6\u7684\u8bb0\u5f55\u6570\u7684\u767e\u5206\u6bd4\u3002\u5bf9\u4e8e\u8fde\u63a5\u67e5\u8be2\u7684\u9a71\u52a8\u8868\uff0cfiltered * rows\u5c31\u662f\u9a71\u52a8\u8868\u7684\u6247\u51fa\u6570\u3002</li> <li>Extra\uff1a\u67e5\u8be2\u7684\u989d\u5916\u4fe1\u606f\u3002\u5e38\u89c1\u7684\u6bd4\u8f83\u91cd\u8981\u7684\u6709\uff1a</li> <li>No tables used\uff1a\u6ca1\u6709FROM\u5b50\u53e5\u65f6\u662f\u8fd9\u4e2a\u63d0\u793a\u3002</li> <li>Zero limit\uff1alimit\u5b50\u53e5\u7684\u53c2\u6570\u4e3a0\u65f6\u662f\u8fd9\u4e2a\u63d0\u793a\u3002</li> <li>Impossible WHERE\uff1awhere\u6761\u4ef6\u6c38\u8fdc\u4e3aFALSE\u3002</li> <li>Using Index\uff1a\u4f7f\u7528\u8986\u76d6\u7d22\u5f15\u6267\u884c\u67e5\u8be2\u3002</li> <li>Using index condition\uff1a\u4f7f\u7528\u5230\u4e86\u7d22\u5f15\u4e0b\u63a8\u3002</li> <li>Using where\uff1a\u641c\u7d22\u6761\u4ef6\u9700\u8981\u5728server\u5c42\u5224\u65ad\u3002</li> <li>Using join buffer(Block Nested Loop)\uff1a\u4f7f\u7528\u57fa\u4e8e\u5757\u7684\u5d4c\u5957\u5faa\u73af\u8fde\u63a5\u7b97\u6cd5\u6267\u884c\u8fde\u63a5\u67e5\u8be2\u3002</li> <li>Using join buffer (hash join)\uff1a\u4f7f\u7528Hash join\u3002</li> <li>Using intersect(...)\u3001Using union(...)\u3001Using sort_union(...)\uff1a\u4f7f\u7528\u7d22\u5f15\u5408\u5e76\u7684\u65b9\u5f0f\u6267\u884c\u67e5\u8be2\uff0c\u62ec\u53f7\u4e2d\u8868\u793a\u8981\u8fdb\u884c\u5408\u5e76\u7684\u7d22\u5f15\u3002</li> <li>Using filesort\uff1a\u8981\u5bf9\u7ed3\u679c\u96c6\u4e2d\u7684\u8bb0\u5f55\u6392\u5e8f\u3002\u65e0\u8bba\u662f\u5728\u5185\u5b58\u4e2d\u8fd8\u662f\u8981\u501f\u52a9\u78c1\u76d8\u7edf\u79f0\u4e3afilesort\u3002</li> <li>Using temporary\uff1a\u4f7f\u7528\u4e34\u65f6\u8868\u5b8c\u6210\u53bb\u91cd\u3001\u6392\u5e8f\u7b49\u529f\u80fd\u3002</li> <li>Start temporary\uff0cEnd temporary\uff1a\u5f53IN\u5b50\u67e5\u8be2\u7684\u534a\u8fde\u63a5\u7b56\u7565\u662fDuplicate Weedout\u65f6\uff0c\u4f1a\u5efa\u4e34\u65f6\u8868\u7ed9\u7ed3\u679c\u53bb\u91cd\uff0c\u6b64\u65f6\u9a71\u52a8\u8868\u7684Extra\u663e\u793aStart temporary\uff0c\u88ab\u9a71\u52a8\u8868\u7684Extra\u663e\u793aEnd temporary\u3002</li> <li>LooseScan\uff1aIN\u5b50\u67e5\u8be2\u7684\u534a\u8fde\u63a5\u7b56\u7565\u662fLooseScan\uff0c\u9a71\u52a8\u8868\u7684Extra\u663e\u793aLooseScan\u3002</li> <li>FirstMatch(tbl_name)\uff1aIN\u5b50\u67e5\u8be2\u7684\u534a\u8fde\u63a5\u7b56\u7565\u662fFirstMatch\uff0c\u88ab\u9a71\u52a8\u8868\u7684Extra\u663e\u793aFirstMatch(tbl_name)\u3002</li> </ul> <p>EXPLAIN\u8fd8\u652f\u6301\u5176\u4ed6\u683c\u5f0f\u7684\u6267\u884c\u8ba1\u5212\uff0c\u4f7f\u7528FORMAT\u9650\u5236\uff0c\u6bd4\u5982\u4f7f\u7528JSON\u683c\u5f0f\uff1a<code>EXPLAIN format=json</code>\uff0c\u4f7f\u7528tree\u683c\u5f0f\uff1a<code>EXPLAIN format=tree</code>\u3002\u4f7f\u7528JSON\u683c\u5f0f\u7684\u6267\u884c\u8ba1\u5212\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u5230\u6bcf\u4e00\u6b65\u7684\u67e5\u8be2\u6210\u672c\u3002</p> <p>EXPLAIN ANALYZE \u4f1a\u5b9e\u9645\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff0c\u63d0\u4f9b\u5b9e\u9645\u6267\u884c\u67e5\u8be2\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#buffer_pool","title":"Buffer Pool","text":"<p>Buffer Pool\u88ab\u5212\u5206\u6210\u82e5\u5e72\u9875\u9762\u7684\u4e00\u7247\u5185\u5b58\uff0cBuffer Pool\u4e2d\u7684\u9875\u9762\u79f0\u4e3a\u7f13\u5b58\u9875\uff0c\u548c\u78c1\u76d8\u4e0a\u8868\u7a7a\u95f4\u4f7f\u7528\u7684\u9875\u9762\u5927\u5c0f\u4e00\u6837\uff0c\u90fd\u662f16KB\uff0c\u6bcf\u4e2a\u7f13\u51b2\u9875\u5bf9\u5e94\u4e00\u4e2a\u63a7\u5236\u5757\uff0c\u7528\u4e8e\u7ba1\u7406\u7f13\u51b2\u9875\uff0c\u63a7\u5236\u5757\u5305\u542b\u7f13\u51b2\u9875\u5bf9\u5e94\u7684\u8868\u7a7a\u95f4\u7f16\u53f7\u3001\u9875\u53f7\u3001\u7f13\u51b2\u9875\u5728Buffer Pool\u4e2d\u7684\u5730\u5740\u3001\u5404\u79cd\u94fe\u8868\u8282\u70b9\u7b49\uff0c\u6240\u4ee5BUffer Pool\u4e3b\u8981\u5305\u542b\u4e24\u90e8\u5206\uff1a\u7f13\u51b2\u9875 \u548c \u63a7\u5236\u5757\u3002</p> <p>InnoDB\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2aBUffer Pool\u5b9e\u4f8b\uff0c\u76ee\u7684\u662f\u63d0\u9ad8\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u56e0\u4e3a\u4fee\u6539\u94fe\u8868\u9700\u8981\u52a0\u9501\u3002</p> <p>InnoDB\u4ee5chunk\u4e3a\u5355\u4f4d\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7a7a\u95f4\uff0c\u652f\u6301\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u8c03\u6574BUffer Pool\u7684\u5927\u5c0f\u3002chunk\u662f\u6307MySQL\u7684\u914d\u7f6e\u9879innodb_buffer_pool_chunk_size\u3002</p> <p>InnoDB\u4f7f\u7528\u5404\u79cd\u94fe\u8868\u6765\u7ba1\u7406Buffer Pool\u7684\u7f13\u51b2\u9875\uff0c\u8fd9\u4e9b\u94fe\u8868\u8282\u70b9\u90fd\u5728\u63a7\u5236\u5757\u4e2d\uff0c\u4e3b\u8981\u662f\u8fd9\u4e09\u4e2a\u94fe\u8868\uff1a</p> <ul> <li>free\u94fe\u8868\uff1a\u5305\u542b\u6240\u6709\u7a7a\u95f2\u7684\u7f13\u51b2\u9875\u3002</li> <li>flush\u94fe\u8868\uff1a\u88ab\u4fee\u6539\u8fc7\u4f46\u8fd8\u6ca1\u6709\u5237\u76d8\u7684\u7f13\u51b2\u9875\u79f0\u4e3a\u810f\u9875\uff0c\u6240\u6709\u810f\u9875\u90fd\u88ab\u653e\u5728flush\u94fe\u8868\u4e2d\u3002</li> <li>LRU\u94fe\u8868\uff1a\u8bb0\u5f55\u4e86\u6240\u6709\u6b63\u5728\u4f7f\u7528\u7684\u7f13\u51b2\u9875\uff0c\u5176\u4e2d\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u7f13\u51b2\u9875\u4f1a\u88ab\u653e\u5728LRU\u94fe\u8868\u7684\u5c3e\u90e8\uff0c\u5f53\u7f13\u51b2\u9875\u4e0d\u8db3\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u6dd8\u6c70\u5c3e\u90e8\u7f13\u51b2\u9875\u3002</li> </ul> <p>\u5982\u4f55\u5feb\u901f\u5b9a\u4f4d\u4e00\u4e2a\u9875\u662f\u5426\u5728\u7f13\u51b2\u533a\u4e2d\uff1f\u4f7f\u7528\u54c8\u5e0c\u8868\uff0c\u8868\u7a7a\u95f4+\u9875\u53f7\u4f5c\u4e3akey\uff0c\u7f13\u51b2\u9875\u63a7\u5236\u5757\u7684\u5730\u5740\u4f5c\u4e3avalue\u3002\u5728\u8bbf\u95ee\u67d0\u4e2a\u9875\u9762\u65f6\uff0c\u5148\u4ece\u54c8\u5e0c\u8868\u4e2d\u6839\u636e\u8868\u7a7a\u95f4+\u9875\u53f7\u627e\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u5c31\u4ecefree\u94fe\u8868\u4e2d\u53d6\u4e00\u4e2a\u7a7a\u95f4\u7f13\u51b2\u9875\u3002</p> <p>free\u94fe\u8868 + LRU\u94fe\u8868 \u5305\u542b\u4e86\u6240\u6709\u7f13\u51b2\u9875\uff0cflush\u94fe\u8868\u53ea\u662fLRU\u94fe\u8868\u7684\u5b50\u96c6\uff0c\u54c8\u5e0c\u8868\u548cLRU\u94fe\u8868\u5305\u542b\u7684\u7f13\u51b2\u9875\u8303\u56f4\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#lru","title":"\u5982\u4f55\u907f\u514d\u9884\u8bfb\u548c\u5168\u8868\u626b\u63cf\u5bf9LRU\u94fe\u8868\u7684\u5f71\u54cd\uff1f","text":"<p>\u9884\u8bfb\u548c\u5168\u8868\u626b\u63cf\u5bf9LRU\u94fe\u8868\u7684\u5f71\u54cd\uff1a\u9884\u8bfb\u7684\u9875\u9762\u540e\u9762\u4e0d\u4e00\u5b9a\u4f1a\u7528\u5230\uff0c\u5168\u8868\u626b\u63cf\u7684\u9875\u9762\u4e4b\u540e\u7684\u4f7f\u7528\u9891\u7387\u4e5f\u5f88\u4f4e\uff0c\u8fd9\u4e9b\u9875\u9762\u52a0\u8f7d\u5230Buffer Pool\u4e2d\u4f1a\u628aLRU\u94fe\u8868\u4e2d\u4f7f\u7528\u9891\u7387\u66f4\u9ad8\u7684\u9875\u9762\u6dd8\u6c70\u6389\u3002</p> <p>\u5982\u4f55\u907f\u514d\uff1aLRU\u94fe\u8868\u5206\u4e3a\u4e24\u4e2a\u533a\u57df\uff1ayoung\u533a \u548c old\u533a\uff0cold\u533a\u9ed8\u8ba4\u536037%\u3002\u521d\u6b21\u5c06\u78c1\u76d8\u4e2d\u7684\u9875\u52a0\u8f7d\u5230\u7f13\u51b2\u533a\u65f6\u4f1a\u653e\u5230old\u533a\u7684\u5934\u90e8\uff0c\u5e76\u5728\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4e0a\u8bb0\u5f55\u8bbf\u95ee\u65f6\u95f4\uff0c\u7136\u540e\u4e0b\u4e00\u6b21\u8bbf\u95ee\u65f6\u68c0\u67e5\u65f6\u95f4\u95f4\u9694\uff0c\u5982\u679c\u4e24\u6b21\u8bbf\u95ee\u65f6\u95f4\u8d85\u8fc7\u8bbe\u7f6e\u7684\u9608\u503c\uff08\u9ed8\u8ba4\u662f1s\uff09\u624d\u4f1a\u5c06\u7f13\u51b2\u9875\u653e\u5230young\u533a\uff0c\u5f53Buffer Pool\u4e2d\u6ca1\u6709\u7a7a\u95f2\u7f13\u51b2\u9875\u65f6\u4f1a\u4f18\u5148\u6dd8\u6c70old\u533a\u4e2d\u7684\u7f13\u51b2\u9875\u3002\u8981\u8d85\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u539f\u56e0\u662f\uff0c\u4e00\u4e2a\u7f13\u51b2\u9875\u4e2d\u6709\u5f88\u591a\u6761\u8bb0\u5f55\uff0c\u6bcf\u6b21\u8bbf\u95ee\u4e00\u6761\u8bb0\u5f55\u90fd\u7b97\u4f5c\u662f\u4e00\u6b21\u8bbf\u95ee\uff0c\u5bf9\u4e8e\u5168\u8868\u626b\u63cf\u7684\u573a\u666f\uff0c\u4e5f\u5c31\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u8bbf\u95ee\u4e00\u4e2a\u7f13\u51b2\u9875\u591a\u6b21\uff0c\u6240\u4ee5\u4e0d\u80fd\u4ee5\u6b21\u6570\u6765\u5224\u5b9a\u662f\u5426\u5c06\u7f13\u51b2\u9875\u52a0\u5165\u5230young\u533a\uff0c\u89e3\u51b3\u7684\u529e\u6cd5\u53ea\u80fd\u662f\u7528\u65f6\u95f4\u95f4\u9694\u6765\u5224\u5b9a\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_26","title":"\u5237\u5199\u810f\u9875\u7684\u65f6\u673a\uff1f","text":"<ul> <li>\u540e\u53f0\u7ebf\u7a0b\u4f1a\u5b9a\u65f6\u4eceLRU\u94fe\u8868old\u533a\u6216\u8005flush\u94fe\u8868\u5c3e\u90e8\u5237\u810f\u3002</li> <li>\u7cfb\u7edf\u7e41\u5fd9\u65f6\uff0c\u9996\u5148\u770bLRU\u94fe\u8868\u5c3e\u90e8\u6709\u6ca1\u6709\u53ef\u4ee5\u76f4\u63a5\u91ca\u653e\u7684\u672a\u4fee\u6539\u7684\u7f13\u51b2\u9875\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u7528\u6237\u7ebf\u7a0b\u76f4\u63a5\u4eceLRU\u94fe\u8868\u6216\u8005flush\u94fe\u8868\u5c3e\u90e8\u5237\u810f\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#redo","title":"redo\u65e5\u5fd7","text":"<p>redo\u65e5\u5fd7\u7528\u4e8e\u5b9e\u73b0\u4e8b\u52a1\u7684\u6301\u4e45\u6027\uff0c\u662fWAL\u6280\u672f\u7684\u5b9e\u73b0 \u3002\u5b9e\u73b0\u4e8b\u52a1\u6301\u4e45\u6027\u9009\u62e9redo\u65e5\u5fd7\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5237\u5199\u810f\u9875\u7684\u539f\u56e0\uff1a</p> <ol> <li>\u810f\u9875\u592a\u5927\uff0c\u5373\u4f7f\u53ea\u4fee\u6539\u4e86\u4e00\u5904\uff0c\u4e5f\u9700\u8981\u628a\u6574\u9875\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800credo\u65e5\u5fd7\u5360\u7528\u7a7a\u95f4\u66f4\u5c0f\u3002</li> <li>\u5237\u5199\u810f\u9875\u662f\u968f\u673aIO\uff0c\u4ee3\u4ef7\u592a\u5927\uff0c\u800credo\u65e5\u5fd7\u843d\u76d8\u662f\u987a\u5e8fIO\u3002</li> </ol> <p>\u4e3a\u4e86\u4fdd\u8bc1\u4fee\u6539\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u5fc5\u987b\u4ee5\u7ec4\u7684\u5f62\u5f0f\u8bb0\u5f55redo\u65e5\u5fd7\uff0c\u6bcf\u4e00\u7ec4redo\u65e5\u5fd7\u4f1a\u4ee5\u4e00\u6761\u7279\u6b8a\u7684redo\u65e5\u5fd7\u7ed3\u5c3e\uff0c\u5d29\u6e83\u6062\u590d\u65f6\u5fc5\u987b\u8981\u80fd\u8bfb\u5230\u8fd9\u6761\u8868\u793a\u7ed3\u5c3e\u7684redo\u65e5\u5fd7\uff0c\u5426\u5219\u6574\u7ec4\u65e5\u5fd7\u90fd\u4e0d\u4f1a\u6062\u590d\uff0cInnoDB\u628a\u8fd9\u79cd\u4e0d\u53ef\u5206\u5272\u7684\u4e00\u7ec4\u65e5\u5fd7\u79f0\u4e3amtr(mini-transaction)\uff0c\u4e8e\u662f\u4e00\u4e2a\u4e8b\u52a1\u7531\u591a\u4e2a\u8bed\u53e5\u7ec4\u6210\uff0c\u4e00\u4e2a\u8bed\u53e5\u7531\u591a\u4e2amtr\u7ec4\u6210\uff0c\u4e00\u4e2amtr\u53c8\u7531\u591a\u6761redo\u65e5\u5fd7\u7ec4\u6210\u3002</p> <p>redo\u65e5\u5fd7\u5e76\u4e0d\u662f\u76f4\u63a5\u5199\u78c1\u76d8\uff0c\u800c\u662f\u5148\u5f80\u5185\u5b58\u4e2d\u7684log buffer\u5199\uff0c\u5f85\u4e8b\u52a1\u63d0\u4ea4\u65f6\u518d\u5168\u90e8\u5237\u5199\u5230\u78c1\u76d8\u3002log buffer\u548c\u78c1\u76d8\u6587\u4ef6\u90fd\u7531512\u5b57\u8282\u7684redo log block\u7ec4\u6210\uff0c\u4e0d\u540c\u4e8b\u52a1\u7684mtr\u53ef\u4ee5\u4ea4\u53c9\u5199\uff0c\u4f46\u662f\u4e00\u4e2amtr\u662f\u4e0d\u80fd\u88ab\u5206\u5f00\u7684\u3002log buffer\u9ed8\u8ba416MB\u3002\u78c1\u76d8\u4e0a\u7684redo\u65e5\u5fd7\u4e0d\u50cfundo\u65e5\u5fd7\uff0credo\u65e5\u5fd7\u5b58\u50a8\u7a7a\u95f4\u5e76\u4e0d\u662f\u5728\u8868\u7a7a\u95f4\u4e2d\u5206\u914d\u7684\uff0c\u800c\u662f\u5355\u72ec\u7684\u51e0\u4e2a\u6587\u4ef6\uff0c\u9ed8\u8ba4\u662f2\u4e2a\uff0c\u6bcf\u4e2a\u6587\u4ef6\u7684\u5927\u5c0f\u662f48M\uff0c\u8fd92\u4e2a\u6587\u4ef6\u53c8\u79f0\u4e3aredo\u65e5\u5fd7\u6587\u4ef6\u7ec4\uff0credo\u65e5\u5fd7\u4f1a\u4ee5\u5faa\u73af\u7684\u65b9\u5f0f\u5f80\u6587\u4ef6\u7ec4\u4e2d\u5199\uff0c\u6ee1\u4e86\u4e4b\u540e\u4f1a\u8986\u76d6\u6389\u524d\u9762\u7684\uff0c\u80fd\u88ab\u8986\u76d6\u7684redo\u65e5\u5fd7\u5176\u5bf9\u5e94\u7684\u810f\u9875\u5fc5\u987b\u5df2\u7ecf\u5237\u5199\u5230\u78c1\u76d8\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#redo_1","title":"\u5982\u4f55\u4fdd\u8bc1redo\u65e5\u5fd7\u5faa\u73af\u5199\u5165\u65f6\u88ab\u8986\u76d6\u65e5\u5fd7\u7684\u810f\u9875\u5df2\u7ecf\u5237\u5199\u5230\u78c1\u76d8\uff1f","text":"<p>InnoDB\u5f15\u5165\u4e86checkpoint\u673a\u5236\uff0c\u5176\u4e2d\u6709\u4e09\u4e2a\u5173\u952e\u7684\u53d8\u91cf\uff0c\u4e0d\u8fc7\u6700\u91cd\u8981\u662fcheckpoint_lsn\uff0ccheckpoint_lsn\u88ab\u6301\u4e45\u5316\u5728\u7b2c\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u7684\u524d4\u4e2ablock\u4e2d\uff1a</p> <ul> <li>lsn(log sequence number)\uff1a\u8bb0\u5f55\u5f53\u524d\u603b\u5171\u5199\u5165log buffer\u7684\u65e5\u5fd7\u91cf\u3002</li> <li>flushed_to_disk_lsn\uff1a\u8bb0\u5f55\u5df2\u7ecf\u5237\u5199\u5230\u78c1\u76d8\u7684\u65e5\u5fd7\u91cf\u3002</li> <li>checkpoint_lsn\uff1a\u8bb0\u5f55\u53ef\u4ee5\u88ab\u8986\u76d6\u7684\u65e5\u5fd7\u91cf\u3002redo\u65e5\u5fd7\u6062\u590d\u7684\u8d77\u70b9\u4e5f\u662fcheckpoint_lsn\u3002</li> </ul> <p>\u8fd9\u4e09\u4e2a\u53d8\u91cf\u53ea\u4f1a\u4e0d\u65ad\u9012\u589e\uff0c\u800c\u65e5\u5fd7\u6587\u4ef6\u7ec4\u7684\u5927\u5c0f\u662f\u4e0d\u53d8\u7684\uff0c\u4e0d\u8fc7\u5f88\u5bb9\u6613\u5c31\u53ef\u4ee5\u5c06lsn\u7684\u503c\u6362\u7b97\u6210\u65e5\u5fd7\u6587\u4ef6\u4e2d\u4f4d\u7f6e\u3002</p> <p>Buffer Pool\u4e2d\u7684flush\u94fe\u8868\u8bb0\u5f55\u7684\u662f\u88ab\u4fee\u6539\u8fc7\u7684\u810f\u9875\uff0c\u5728\u6bcf\u4e2a\u94fe\u8868\u8282\u70b9\uff08\u63a7\u5236\u5757\uff09\u4e2d\u8fd8\u8bb0\u5f55\u4e86\u4e24\u4e2a\u53d8\u91cf\uff1a</p> <ul> <li>oldest_modification \uff1a\u7b2c\u4e00\u6b21\u4fee\u6539\u7f13\u51b2\u9875\u7684lsn\u3002</li> <li>newest_modification\uff1a\u6700\u8fd1\u4e00\u6b21\u4fee\u6539\u7f13\u51b2\u9875\u7684lsn\u3002</li> </ul> <p>\u7b2c\u4e00\u6b21\u4fee\u6539\u9875\u9762\u65f6\u4f1a\u628a\u9875\u9762\u653e\u5728flush\u94fe\u8868\u7684\u5934\u90e8\uff0c\u4e4b\u540e\u6bcf\u6b21\u4fee\u6539\u4e0d\u4f1a\u8c03\u6574\u4f4d\u7f6e\uff0c\u53ea\u4f1a\u66f4\u65b0newest_modification\uff0c\u6240\u4ee5flush\u94fe\u8868\u4e2d\u7684\u810f\u9875\u662f\u6309\u7167\u9875\u9762\u7b2c\u4e00\u6b21\u4fee\u6539\u65f6\u95f4\u6392\u5e8f\u7684\uff0c\u6240\u4ee5flush\u94fe\u8868\u7684\u5c3e\u90e8\u5bf9\u5e94\u7684oldest_modification\u4e4b\u524d\u7684redo\u65e5\u5fd7\u53ef\u4ee5\u88ab\u8986\u76d6\uff0ccheckpoint\u673a\u5236\u5c31\u662fflush\u94fe\u8868\u5c3e\u90e8\u7684oldest_modification\u8d4b\u503c\u7ed9checkpoint_lsn\uff0c\u6240\u4ee5checkpoint\u5e76\u4e0d\u662f\u4e00\u5b9a\u8981\u4eceflush\u94fe\u8868\u5c3e\u90e8\u5f00\u59cb\u5237\u810f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#redo_2","title":"redo\u65e5\u5fd7\u5237\u76d8\u65f6\u673a\uff1f","text":"<ul> <li>log buffer\u7a7a\u95f4\u4e0d\u8db3\u65f6\u3002log buffer\u5bb9\u91cf\u5df2\u4f7f\u752850%\u5de6\u53f3\u65f6\u5c31\u9700\u8981\u5f00\u59cb\u5237\u76d8\u4e86\u3002</li> <li>\u4e8b\u52a1\u63d0\u4ea4\u65f6\u3002\u4e3a\u4e86\u4fdd\u8bc1\u4e8b\u52a1\u7684\u6301\u4e45\u6027\uff0c\u5fc5\u987b\u8981\u4e8b\u52a1\u63d0\u4ea4\u65f6\u628aredo\u65e5\u5fd7\u5237\u76d8\uff0c\u5237\u76d8\u6210\u529f\u540e\u624d\u80fd\u8fd4\u56de\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u3002</li> <li>\u5237\u5199\u810f\u9875\u65f6\u4f1a\u4fdd\u8bc1\u5148\u628a\u5176\u5bf9\u5e94\u7684redo\u65e5\u5fd7\u5237\u76d8\u3002</li> <li>\u540e\u53f0\u7ebf\u7a0b\u5927\u7ea6\u6bcf\u79d2\u5237\u4e00\u6b21\u76d8\u3002</li> <li>checkpoint\u65f6\u3002checkpoint\u65f6\u5982\u679cflush\u94fe\u8868\u5c3e\u90e8\u7684oldest_modification\u524d\u7684redo\u65e5\u5fd7\u8fd8\u6ca1\u6709\u5237\u76d8\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5148\u5c06redo\u65e5\u5fd7\u5237\u76d8\uff0c\u7136\u540e\u518d\u505acheckpoint\u3002</li> <li>\u670d\u52a1\u5668\u6b63\u5e38\u5173\u95ed\u65f6\u3002</li> </ul> <p>redo\u65e5\u5fd7\u5237\u5199\u7ebf\u7a0b\u3001checkpoint\u7ebf\u7a0b\u3001\u5237\u5199\u810f\u9875\u7684\u7ebf\u7a0b\uff0c\u8fd9\u4e09\u4e2a\u901a\u5e38\u662f\u4e0d\u540c\u7684\u7ebf\u7a0b\uff0c\u4f46\u662f\u5f53\u6570\u636e\u5e93\u7cfb\u7edf\u4fee\u6539\u64cd\u4f5c\u7279\u522b\u9891\u7e41\u65f6\uff0c\u8fd9\u4e09\u9879\u5de5\u4f5c\u53ef\u80fd\u4f1a\u90fd\u7531\u7528\u6237\u7ebf\u7a0b\u505a\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#redo_3","title":"\u4eceredo\u65e5\u5fd7\u4e2d\u5d29\u6e83\u6062\u590d\u65f6\uff0c\u5982\u679c\u9047\u5230\u810f\u9875\u5df2\u7ecf\u5237\u76d8\u7684\u60c5\u51b5\u5982\u4f55\u5904\u7406\uff1f","text":"<p>\u9875\u9762\u7684File Header\u6709\u4e00\u4e2a\u8bb0\u5f55\u7740\u6700\u8fd1\u4e00\u6b21\u4fee\u6539\u9875\u9762\u65f6\u5bf9\u5e94\u7684lsn\uff0c\u5982\u679c\u810f\u9875\u5df2\u7ecf\u5237\u76d8\uff0c\u51e1\u662f\u65e5\u5fd7\u5bf9\u5e94\u7684lsn\u5c0f\u4e8e\u9875\u9762\u7684lsn\uff0c\u90fd\u4e0d\u7528\u7ba1\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#undo","title":"undo\u65e5\u5fd7","text":"<p>undo\u65e5\u5fd7\u7528\u4e8e\u4e8b\u52a1\u56de\u6eda\uff0c\u4fdd\u8bc1\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u3002InnoDB\u7684\u884c\u683c\u5f0f\u4f1a\u81ea\u52a8\u6dfb\u52a0\u4e24\u4e2a\u9690\u85cf\u5217\uff0c\u4e00\u4e2a\u662ftrx_id\uff0c\u8868\u793a\u4e8b\u52a1id\uff0c\u53ea\u5728\u4e8b\u52a1\u5bf9\u67d0\u5f20\u8868\u6267\u884c\u589e\u5220\u6539\u64cd\u4f5c\u65f6\uff0c\u624d\u4f1a\u4e3a\u8fd9\u4e2a\u4e8b\u52a1\u5206\u914d\u4e00\u4e2a\u4e8b\u52a1id\uff0c\u5426\u5219\u4e0d\u4f1a\u5206\u914d\u4e8b\u52a1id\uff0c\u9ed8\u8ba4\u4e3a0\uff1b\u53e6\u4e00\u4e2a\u662froll_pointer\uff0c\u6307\u5411\u8bb0\u5f55\u6240\u5bf9\u5e94\u7684undo\u65e5\u5fd7\u7684\u6307\u9488\u3002undo\u65e5\u5fd7\u4e2d\u4e5f\u6709\u8fd9\u4e24\u5217\uff0c\u901a\u8fc7roll_pointer\u53ef\u4ee5\u4e3a\u4e00\u6761\u8bb0\u5f55\u5f62\u6210\u4e00\u4e2a\u7248\u672c\u94fe\uff0c\u8fd9\u4e5f\u662fMVCC\u5b9e\u73b0\u7684\u5173\u952e\u3002                                                                                                                                                                                           </p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#undo_1","title":"\u589e\u5220\u6539\u64cd\u4f5c\u5bf9\u5e94\u7684undo\u65e5\u5fd7\uff1f","text":"<p>INSERT\u64cd\u4f5c\u5bf9\u5e94\u7684undo\u65e5\u5fd7\u7c7b\u578b\u662fTRX_UNDO_UPD_EXIST_REC\uff0c\u8fd9\u79cd\u65e5\u5fd7\u91cd\u70b9\u662f\u628a\u4e3b\u952e\u8bb0\u5f55\u4e0b\u6765\u3002\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684roll_pointer\u4f1a\u6307\u5411\u8be5\u6761undo\u65e5\u5fd7\uff0ctrx_id\u4fee\u6539\u6210\u63d2\u5165\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1id\u3002</p> <p>DELETE\u64cd\u4f5c\u4f1a\u7ecf\u5386\u4e24\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>\u9636\u6bb51\uff1a\u4e5f\u79f0\u4e3adelete_mark\u64cd\u4f5c\u3002\u5c06\u8bb0\u5f55\u7684deleted_flag\u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a1\uff0cDELETE\u64cd\u4f5c\u5bf9\u5e94\u7684undo\u65e5\u5fd7\u662fTRX_UNDO_DEL_MARK_REC\uff0c\u7136\u540e\u5c06\u88ab\u5220\u9664\u8bb0\u5f55\u7684roll_pointer\u548ctrx_id\u8d4b\u503c\u7ed9undo\u65e5\u5fd7\uff0c\u4e4b\u540e\u5c06\u88ab\u5220\u9664\u8bb0\u5f55\u7684roll_pointer\u6307\u5411\u8be5\u6761undo\u65e5\u5fd7\uff0ctrx_id\u4fee\u6539\u6210\u5220\u9664\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1id\u3002</li> <li>\u9636\u6bb52\uff1a\u5220\u9664\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0cpurge\u7ebf\u7a0b\u4f1a\u771f\u6b63\u628a\u8bb0\u5f55\u4ece\u9875\u9762\u7684\u6b63\u5e38\u8bb0\u5f55\u94fe\u8868\u4e2d\u5220\u9664\uff0c\u52a0\u5165\u5230\u5783\u573e\u94fe\u8868\u4e2d\u7684\u5934\u90e8\u3002</li> </ul> <p>UPDATE\u64cd\u4f5c\u5bf9\u4e0d\u66f4\u65b0\u4e3b\u952e\u548c\u66f4\u65b0\u4e3b\u952e\u7684\u5904\u7406\u65b9\u5f0f\u4e0d\u540c\uff1a</p> <ul> <li>\u9488\u5bf9\u4e0d\u66f4\u65b0\u4e3b\u952e\u7684\u60c5\u51b5\uff0cUPDATE\u64cd\u4f5c\u5bf9\u5e94\u7684undo\u65e5\u5fd7\u662fTRX_UNDO_UPD_EXIST_REC\uff0c\u5c06\u88ab\u66f4\u65b0\u8bb0\u5f55\u7684roll_pointer\u548ctrx_id\u8d4b\u503c\u7ed9undo\u65e5\u5fd7\uff0c\u4e4b\u540e\u5c06\u88ab\u66f4\u65b0\u8bb0\u5f55\u7684roll_pointer\u6307\u5411\u8be5\u6761undo\u65e5\u5fd7\uff0ctrx_id\u4fee\u6539\u6210\u66f4\u65b0\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1id\u3002</li> </ul> <p>\u4e0d\u66f4\u65b0\u4e3b\u952e\u5728\u5177\u4f53\u7684\u64cd\u4f5c\u4e0a\u53c8\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u5c31\u5730\u66f4\u65b0\uff1a\u5bf9\u88ab\u66f4\u65b0\u7684\u6bcf\u4e2a\u5217\uff0c\u5982\u679c\u66f4\u65b0\u524d\u540e\u5217\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u4e0d\u53d8\uff0c\u5219\u79f0\u4e3a\u5c31\u5730\u66f4\u65b0\u3002</p> </li> <li> <p>\u5148\u5220\u9664\u65e7\u8bb0\u5f55\uff0c\u518d\u63d2\u5165\u65b0\u8bb0\u5f55\uff1a\u5982\u679c\u66f4\u65b0\u524d\u540e\u5217\u7684\u5b58\u50a8\u7a7a\u95f4\u53d8\u5927\u6216\u8005\u53d8\u5c0f\u4e86\uff0c\u5219\u4f1a\u5148\u771f\u6b63\u5220\u9664\u539f\u8bb0\u5f55\uff08\u4e0d\u662fdelete_mark\u64cd\u4f5c\uff09\uff0c\u7136\u540e\u63d2\u5165\u65b0\u8bb0\u5f55\u3002</p> </li> <li> <p>\u9488\u5bf9\u66f4\u65b0\u4e3b\u952e\u7684\u60c5\u51b5\uff0c\u4f1a\u5148\u5bf9\u539f\u8bb0\u5f55\u4f5cDELETE\u64cd\u4f5c\uff08\u662fdelete_mark\u64cd\u4f5c\uff09\uff0c\u4ea7\u751f\u7684undo\u65e5\u5fd7\u662fTRX_UNDO_DEL_MARK_REC\uff0c\u7136\u540e\u518d\u505aINSERT\u64cd\u4f5c\uff0c\u4ea7\u751f\u7684undo\u65e5\u5fd7\u662fTRX_UNDO_UPD_EXIST_REC\uff0c\u4e5f\u5c31\u662f\u8bf4UPDATE\u66f4\u65b0\u4e3b\u952e\u5176\u5b9e\u662fINSERT\u548cDELETE\u7684\u7ec4\u5408\u64cd\u4f5c\u3002</p> </li> </ul> <p>\u4e0a\u8ff0\u4e09\u79cdundo\u65e5\u5fd7\u53ef\u4ee5\u88ab\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p> <ul> <li>TRX_UNDO_INSERT\uff08insert undo\u65e5\u5fd7\uff09\uff1aINSERT\u64cd\u4f5c\u4ea7\u751f\u7684TRX_UNDO_UPD_EXIST_REC\u65e5\u5fd7\u5c5e\u4e8e\u8fd9\u79cd\u7c7b\u578b\u3002\u8fd9\u7c7b\u65e5\u5fd7\u6ca1\u6709trx_id\u548croll_pointer\u4e24\u5217\uff0c\u6240\u4ee5\u53ea\u4f1a\u4f5c\u4e3a\u7248\u672c\u94fe\u7684\u5c3e\u8282\u70b9\u3002</li> <li>TRX_UNDO_UPDATE\uff08update undo\u65e5\u5fd7\uff09\uff1aDELETE\u548cUPDATE\u4e0d\u66f4\u65b0\u4e3b\u952e\u64cd\u4f5c\u4ea7\u751fTRX_UNDO_DEL_MARK_REC\u548cTRX_UNDO_UPD_EXIST_REC\u662f\u8fd9\u79cd\u7c7b\u578b\u3002\u8fd9\u7c7b\u65e5\u5fd7\u6709trx_id\u548croll_pointer\u4e24\u5217\uff0c\u901a\u8fc7roll_pointer\u53ef\u4ee5\u4e3a\u4e00\u6761\u8bb0\u5f55\u5f62\u6210\u4e00\u4e2a\u7248\u672c\u94fe\u3002</li> </ul> <p>\u533a\u5206\u8fd9\u4e24\u79cd\u7c7b\u578bundo\u65e5\u5fd7\u7684\u539f\u56e0\u662f\uff0c\u8fd9\u4e24\u79cd\u65e5\u5fd7\u4f1a\u5206\u522b\u5b58\u653e\u5728\u4e0d\u540c\u7c7b\u578b\u7684\u9875\u9762\u4e2d\uff0c\u5f53\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0cinsert undo\u65e5\u5fd7\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\u6389\uff0c\u800cupdate undo\u65e5\u5fd7\u4e0d\u80fd\uff0cupdate undo\u65e5\u5fd7\u8fd8\u9700\u8981\u4e3aMVCC\u670d\u52a1\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#undo_2","title":"undo\u65e5\u5fd7\u5b58\u50a8\u7a7a\u95f4\u662f\u5982\u4f55\u5206\u914d\u548c\u56de\u6536\u7684\uff1f","text":"<p>undo\u65e5\u5fd7\u5b58\u50a8\u5728\u8868\u7a7a\u95f4\u4e2d\uff0c\u5bf9\u5e94\u7684\u9875\u9762\u662f\u7c7b\u578b\u4e3aFIL_PAGE_UNDO_LOG\uff0c\u4e0e\u5b58\u50a8\u6570\u636e\u7684\u9875\u9762\u7c7b\u578b\u4e0d\u540c\u3002undo\u9875\u9762\u53ef\u4ee5\u901a\u8fc7\u4fdd\u5b58\u5728\u5176\u4e2d\u7684\u94fe\u63a5\u8282\u70b9\u4e32\u8054\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u65e5\u5fd7\uff08insert undo\u65e5\u5fd7\u548cupdate undo\u65e5\u5fd7\uff09\u4f1a\u88ab\u5b58\u653e\u5728\u4e0d\u540c\u7684\u94fe\u8868\u4e2d\uff0c\u4e8b\u52a1\u63d0\u4ea4\u540einsert undo\u65e5\u5fd7\u94fe\u8868\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\uff0c\u4f46\u662fupdate undo\u65e5\u5fd7\u94fe\u8868\u4e0d\u80fd\uff0c\u56e0\u4e3a\u5176\u8fd8\u9700\u8981\u4e3aMVCC\u670d\u52a1\u3002\u53c8\u6839\u636e\u4e8b\u52a1\u64cd\u4f5c\u7684\u8868\u7684\u7c7b\u578b\u4e0d\u540c\uff0c\u4e00\u4e2a\u4e8b\u52a1\u7684\u6700\u591a\u53ef\u4ee5\u67094\u4e2a\u94fe\u8868\uff1a\u666e\u901a\u8868\u7684insert undo\u94fe\u8868\u3001\u666e\u901a\u8868\u7684update undo\u94fe\u8868\u3001\u4e34\u65f6\u8868\u7684insert undo\u94fe\u8868\u3001\u4e34\u65f6\u8868\u7684update undo\u94fe\u8868\u3002\u6bcf\u4e00\u4e2aundo\u9875\u9762\u94fe\u8868\u90fd\u5bf9\u5e94\u7740\u4e00\u4e2a\u6bb5\uff0c\u7528\u4e8e\u5206\u914d\u548c\u56de\u6536\u94fe\u8868\u4e2d\u9875\u9762\uff0c\u8be5\u6bb5\u5bf9\u5e94\u7684Segment Header\u5b58\u653e\u5728undo\u94fe\u8868\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\u4e2d\uff0c\u901a\u8fc7Segment Header\u53ef\u4ee5\u627e\u5230\u6bb5\u5bf9\u5e94\u7684INODE Entry\u3002</p> <p>\u90a3\u5982\u4f55\u627e\u5230undo\u94fe\u8868\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\uff1fundo\u94fe\u8868\u7684\u7b2c\u4e00\u4e2a\u9875\u9762\u7684\u9875\u53f7\u5b58\u653e\u5728\u4e00\u4e2a\u53ebRollback Segment Header\u7684\u9875\u9762\u4e2d\uff0c\u8fd9\u4e2a\u9875\u9762\u4e00\u5171\u53ef\u4ee5\u5b58\u653e1024\u4e2aundo\u94fe\u8868\u7b2c\u4e00\u9875\u9875\u53f7\uff0c\u6bcf\u4e2a\u9875\u53f7\u90fd\u79f0\u4e3a\u4e00\u4e2aundo slot\u3002Rollback Segment Header\u9875\u9762\u4e5f\u79f0\u4e3a\u56de\u6eda\u6bb5\uff0c\u8fd9\u4e2a\u9875\u9762\u4e5f\u4f7f\u7528\u4e00\u4e2a\u6bb5\u6765\u7ba1\u7406\u7a7a\u95f4\uff0c\u8be5\u6bb5\u5bf9\u5e94\u7684Segment Header\u5c31\u5b58\u653e\u5728\u8fd9\u4e2a\u9875\u9762\u4e2d\uff0c\u4e00\u4e2a\u9875\u9762\u4e5f\u8981\u4f7f\u7528\u4e00\u4e2a\u6bb5\u662f\u56e0\u4e3a\u8981\u7edf\u4e00\u6982\u5ff5\uff0c\u5373\u6bb5\u662f\u7a7a\u95f4\u7ba1\u7406\u7684\u903b\u8f91\u5355\u4f4d\u3002</p> <p>\u90a3\u53c8\u5982\u4f55\u627e\u5230Rollback Segment Header\u9875\u9762\u7684\u9875\u53f7\uff1f\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684\u7b2c5\u53f7\u9875\u9762\u5b58\u653e\u4e86128\u4e2aRollback Segment Header\u9875\u9762\u9875\u53f7\u3002\u6bcf\u4e2a\u9875\u53f7\u5305\u62ec\u8868\u7a7a\u95f4\u53f7\u548c\u9875\u53f7\uff0c\u6240\u4ee5\u6bcf\u4e2a\u56de\u6eda\u6bb5\u90fd\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u8868\u7a7a\u95f4\u4e2d\u3002InnoDB\u89c4\u5b9a\u7b2c0\u53f7\u3001\u7b2c33~127\u53f7\u56de\u6eda\u6bb5\u5c5e\u4e8e\u4e00\u7c7b\uff0c\u53ea\u80fd\u5b58\u653e\u666e\u901a\u8868\u7684undo\u65e5\u5fd7\uff0c\u5176\u4e2d\u7b2c0\u53f7\u56de\u6eda\u6bb5\u5fc5\u987b\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u4e2d\uff0c\u7b2c33~127\u53f7\u53ef\u4ee5\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5728undo\u8868\u7a7a\u95f4\u4e2d\uff1b\u7b2c1~32\u53f7\u56de\u6eda\u6bb5\u5c5e\u4e8e\u53e6\u4e00\u7c7b\uff0c\u53ea\u80fd\u5b58\u653e\u4e34\u65f6\u8868\u7684undo\u65e5\u5fd7\uff0c\u5fc5\u987b\u5728\u4e34\u65f6\u8868\u7a7a\u95f4\uff08\u5bf9\u5e94\u6570\u636e\u76ee\u5f55\u7684ibtmp1\u6587\u4ef6\uff09\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#mvcc","title":"MVCC","text":"<p>READ COMMITTED \u548c REPEATABLE READ \u9694\u79bb\u7ea7\u522b\u7684\u5b9e\u73b0\u65b9\u5f0f\u662fMVCC\uff0c\u800cSERIALIZABLE\u9694\u79bb\u7ea7\u522b\u7684\u5b9e\u73b0\u4e0eMVCC\u65e0\u5173\u3002MVCC\u5b9e\u73b0\u7684\u5173\u952e\u6709\u4e24\u70b9\uff1a\u7248\u672c\u94fe \u548c ReadView\uff08\u4e00\u81f4\u6027\u89c6\u56fe\uff09\u3002</p> <p>InnoDB\u805a\u7c07\u7d22\u5f15\u7684\u884c\u683c\u5f0f\u67093\u4e2a\u9690\u85cf\u5217\uff1arow_id\u3001trx_id\u3001roll_pointer\uff0ctrx_id\u8868\u793a\u4fee\u6539\u8be5\u8bb0\u5f55\u7684\u4e8b\u52a1id\uff0croll_pointer\u6307\u5411undo\u65e5\u5fd7\u3002delete\u548cupdate\u64cd\u4f5c\u751f\u6210\u7684\u65e5\u5fd7\u4e5f\u6709trx_id\u548croll_pointer\u4e24\u5217\uff0c\u751f\u6210\u8fd9\u4e24\u79cdundo\u65e5\u5fd7\u65f6\u4f1a\u5c06\u8bb0\u5f55\u7684trx_id\u548croll_pointer\u8d4b\u503c\u7ed9undo\u65e5\u5fd7\uff0c\u4ece\u800c\u5c31\u5f62\u6210\u4e86\u7248\u672c\u94fe\u3002insert\u64cd\u4f5c\u662f\u4e00\u6761\u8bb0\u5f55\u7684\u5f00\u59cb\uff0c\u6ca1\u6709\u518d\u6bd4insert undo\u65e5\u5fd7\u66f4\u65e9\u751f\u6210\u7684undo\u65e5\u5fd7\uff0c\u4e5f\u5c31\u662f\u8bf4insert undo\u65e5\u5fd7\u4e0d\u9700\u8981\u518d\u6307\u5411\u5176\u4ed6undo\u65e5\u5fd7\uff0c\u6240\u4ee5insert undo\u65e5\u5fd7\u6ca1\u6709trx_id\u548croll_pointer\uff0c\u5b83\u662f\u7248\u672c\u94fe\u7684\u5c3e\u8282\u70b9\u3002</p> <p>ReadView\u7528\u4e8e\u5224\u65ad\u7248\u672c\u94fe\u4e2d\u54ea\u4e2a\u7248\u672c\u65f6\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u7684\uff0c\u5b83\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u5305\u542b4\u9879\u5185\u5bb9\uff1a</p> <ul> <li>m_ids\uff1a\u751f\u6210ReadView\u65f6\u5f53\u524d\u7cfb\u7edf\u4e2d\u6d3b\u8dc3\u7684\u8bfb\u5199\u4e8b\u52a1\u7684\u4e8b\u52a1id\u5217\u8868\u3002</li> <li>min_trx_id\uff1a\u751f\u6210ReadView\u65f6\u5f53\u524d\u7cfb\u7edf\u4e2d\u6d3b\u8dc3\u8bfb\u5199\u4e8b\u52a1\u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1id\uff0c\u4e5f\u5c31\u662fm_ids\u4e2d\u7684\u6700\u5c0f\u503c\u3002</li> <li>max_trx_id\uff1a\u751f\u6210ReadView\u65f6\u7cfb\u7edf\u5e94\u8be5\u5206\u914d\u7ed9\u4e0b\u4e00\u4e2a\u4e8b\u52a1\u7684\u4e8b\u52a1id\u3002\u6ce8\u610fmax_trx_id\u5e76\u4e0d\u662fm_ids\u4e2d\u7684\u6700\u5927\u503c\uff0cmax_trx_id &gt;= m_ids\u4e2d\u7684\u6700\u5927\u503c\u3002</li> <li>creator_trx_id\uff1a\u751f\u6210\u8be5ReadView\u7684\u4e8b\u52a1id\u3002</li> </ul> <p>\u7136\u540e\u5229\u7528ReadView\u901a\u8fc7\u4ee5\u4e0b\u89c4\u5219\u5728\u7248\u672c\u94fe\u4e2d\u9010\u4e2a\u5224\u65ad\u67d0\u4e2a\u7248\u672c\u5bf9\u5f53\u524d\u4e8b\u52a1\u662f\u5426\u53ef\u89c1\uff1a</p> <ol> <li>\u5982\u679c\u7248\u672c\u7684trx_id\u4e0eReadView\u7684creator_trx_id\u76f8\u540c\uff0c\u90a3\u4e48\u8868\u793a\u4e8b\u52a1\u6b63\u5728\u8bbf\u95ee\u5b83\u81ea\u5df1\u4fee\u6539\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u5bf9\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u3002</li> <li>\u5982\u679c\u7248\u672c\u7684trx_id\u5c0f\u4e8eReadView\u7684min_trx_id\uff0c\u90a3\u4e48\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u5bf9\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u3002</li> <li>\u5982\u679c\u7248\u672c\u7684trx_id\u5927\u4e8eReadView\u7684max_trx_id\uff0c\u90a3\u4e48\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5728\u5f53\u524d\u4e8b\u52a1\u751f\u6210ReadView\u540e\u624d\u5f00\u542f\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u5bf9\u5f53\u524d\u4e8b\u52a1\u4e0d\u53ef\u89c1\u3002</li> <li>\u5982\u679c\u7248\u672c\u7684trx_id\u5728ReadView\u7684min_trx_id\u548cmax_trx_id\u4e4b\u95f4\uff0c\u5219\u9700\u8fdb\u4e00\u6b65\u5224\u65ad\u662f\u5426\u5728m_ids\u4e2d\uff0c\u5982\u679c\u5728m_ids\u4e2d\uff0c\u90a3\u4e48\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u8fd8\u6ca1\u63d0\u4ea4\uff0c\u6240\u4ee5\u5f53\u524d\u4e8b\u52a1\u4e0d\u53ef\u89c1\u8be5\u7248\u672c\uff0c\u4f46\u5982\u679c\u4e0d\u5728m_ids\u4e2d\uff0c\u90a3\u4e48\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u7684\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u5bf9\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u3002</li> </ol> <p>READ COMMITTED \u548c REPEATABLE READ \u4e4b\u95f4\u7684\u533a\u522b\u5c31\u662fReadView\u751f\u6210\u7684\u65f6\u673a\u4e0d\u540c\uff0cREAD COMMITTED\u5728\u6bcf\u6b21\u8bfb\u53d6\u65f6\u4e8b\u52a1\u90fd\u4f1a\u751f\u6210\u4e00\u4e2aReadView\uff0c\u800cREPEATABLE READ\u53ea\u5728\u4e8b\u52a1\u7b2c\u4e00\u6b21\u8bfb\u53d6\u65f6\u751f\u6210\u4e00\u4e2aReadView\uff0c\u5f80\u540e\u7684\u6bcf\u6b21\u8bfb\u53d6\u90fd\u91cd\u590d\u5229\u7528\u8fd9\u4e2aReadView\u3002</p> <p>MVCC\u53ea\u7528\u4e8eREAD COMMITTED \u548c REPEATABLE READ\u9694\u79bb\u7ea7\u522b\u4e0b\u7684SELECT\uff0c\u4e0d\u9002\u7528UPDATE\u548cDELETE\u7684where\u6761\u4ef6\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#id","title":"\u4e8b\u52a1id\u5982\u4f55\u751f\u6210\uff1f","text":"<p>\u53ea\u6709\u5f53\u4e8b\u52a1\u6267\u884c\u589e\u5220\u6539\u64cd\u4f5c\u4e4b\u540e\u624d\u4f1a\u5206\u914d\u4e8b\u52a1id\uff0c\u5982\u679c\u4e8b\u52a1\u6ca1\u6709\u6267\u884c\u8fc7\u589e\u5220\u6539\u64cd\u4f5c\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u8be5\u4e8b\u52a1\u5206\u914d\u4e8b\u52a1id\uff0c\u76f4\u63a5\u9ed8\u8ba4\u76840\u4f5c\u4e3a\u4e8b\u52a1id\uff0c\u5bf9\u524d\u9762\u5224\u65ad\u89c4\u5219\u6ca1\u6709\u5f71\u54cd\u3002</p> <p>\u4e8b\u52a1id\u7684\u751f\u6210\u7b56\u7565\u548c\u9690\u85cf\u4e3b\u952erow_id\u662f\u4e00\u6837\u7684\uff0cMySQL\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u6bcf\u6b21\u5206\u914d\u540e\u4f1a\u589e\u52a01\uff0c\u6bcf\u5f53\u53d8\u91cf\u503c\u8fbe\u5230256\u7684\u500d\u6570\u65f6\uff0c\u5c31\u4f1a\u628a\u503c\u5237\u5230\u7cfb\u7edf\u8868\u7a7a\u95f45\u53f7\u9875\u9762\u7684Max Trx ID\u5c5e\u6027\u4e2d\uff0c\u8fd9\u4e2a\u5c5e\u6027\u53608\u4e2a\u5b57\u8282\uff0c\u7cfb\u7edf\u4e0b\u6b21\u91cd\u542f\u65f6\u4f1a\u628aMax Trx ID\u52a0\u8f7d\u5230\u5185\u5b58\u5e76\u52a0\u4e0a256\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u5206\u914d\u7684\u8d77\u59cb\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u81ea\u589e\u65f6\u90fd\u8981\u5199\u78c1\u76d8\uff0c\u5e76\u4fdd\u8bc1\u4e0d\u91cd\u590d\u5206\u914d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#mvcc_1","title":"\u4e8c\u7ea7\u7d22\u5f15\u5982\u4f55MVCC\uff1f","text":"<p>\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u7684\u8bb0\u5f55\u6ca1\u6709undo\u65e5\u5fd7\uff0c\u4e5f\u5c31\u6ca1\u6709trx_id\u548croll_pointer\uff0c\u4f46\u4e8c\u7ea7\u7d22\u5f15\u9875\u9762\u7684Page Header\u90e8\u5206\u6709\u4e00\u4e2aPAGE_MAX_TRX_ID\u5c5e\u6027\uff0cPAGE_MAX_TRX_ID\u8bb0\u5f55\u7740\u4fee\u6539\u8be5\u4e8c\u7ea7\u7d22\u5f15\u9875\u9762\u7684\u6700\u5927\u4e8b\u52a1id\u3002\u5f53select\u8bed\u53e5\u8bbf\u95ee\u67d0\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u9875\u9762\u65f6\uff0c\u4f1a\u6bd4\u8f83ReadView\u7684min_trx_id\u662f\u5426\u5927\u4e8ePAGE_MAX_TRX_ID\uff0c\u5982\u679c\u5927\u4e8e\uff0c\u8868\u793a\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\uff0c\u4e8c\u7ea7\u7d22\u5f15\u9875\u9762\u4e2d\u6240\u6709\u8bb0\u5f55\u90fd\u5bf9\u8be5\u4e8b\u52a1\u53ef\u89c1\uff0c\u5426\u5219\u5fc5\u987b\u56de\u8868\u540e\u518d\u5224\u65ad\u53ef\u89c1\u6027\uff0c\u6240\u4ee5\u8986\u76d6\u7d22\u5f15\u5e76\u4e0d\u4e00\u5b9a\u4e0d\u7528\u56de\u8868\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#purge","title":"purge?","text":"<p>\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540einsert undo\u65e5\u5fd7\u9875\u9762\u94fe\u8868\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\uff0c\u4f46\u662fupdate undo\u65e5\u5fd7\u4e0d\u80fd\uff0c\u5fc5\u987b\u7b49\u5230\u7cfb\u7edf\u4e2d\u6ca1\u6709\u4e00\u4e2aReadView\u80fd\u8bbf\u95ee\u5176\u4e2d\u4efb\u610f\u4e00\u4e2a\u7248\u672c\u624d\u884c\uff0c\u8d1f\u8d23\u6e05\u9664update undo\u65e5\u5fd7\u7684\u7ebf\u7a0b\u53ebpurge\u3002purge\u7ebf\u7a0b\u5e76\u4e0d\u662f\u7b80\u5355\u5220\u9664update undo\u9875\u9762\u5c31\u5b8c\u4e8b\u4e86\uff0cupdate undo\u9875\u9762\u94fe\u8868\u7b2c\u4e00\u4e2a\u9875\u9762\u4e2d\u7684TRX_UNDO_DEL_MARKS\u5c5e\u6027\u6807\u8bc6\u4e86\u672c\u7ec4undo\u65e5\u5fd7\u4e2d\u662f\u5426\u6709\u56e0delete mark\u64cd\u4f5c\u4ea7\u751f\u7684\u65e5\u5fd7\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u90a3\u4e48purge\u7ebf\u7a0b\u8fd8\u9700\u8981\u6267\u884cdelete\u64cd\u4f5c\u7684\u7b2c\u4e8c\u4e2a\u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u628a\u88ab\u5220\u9664\u7684\u8bb0\u5f55\u52a0\u5165\u5230\u5783\u573e\u94fe\u8868\u4e2d\uff0c\u5e76\u8c03\u6574\u9875\u9762\u4e2d\u5c5e\u6027\u7684\u503c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_27","title":"\u957f\u4e8b\u52a1\u7684\u5371\u5bb3\uff1f","text":"<ul> <li>\u5bf9\u4e8e\u53ef\u91cd\u590d\u8bfb\u4e8b\u52a1\uff0c\u7b2c\u4e00\u6b21\u751f\u6210\u7684ReadView\u8981\u4e00\u76f4\u4fdd\u6301\u5230\u4e8b\u52a1\u7ed3\u675f\uff0c\u5982\u679c\u8be5\u4e8b\u52a1\u8fdf\u8fdf\u4e0d\u7ed3\u675f\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u5176\u5b83\u65e9\u5df2\u63d0\u4ea4\u7684\u4e8b\u52a1\u7684update undo\u65e5\u5fd7\u7684\u7a7a\u95f4\u4e00\u76f4\u65e0\u6cd5\u88ab\u91ca\u653e\u3002</li> <li>undo slot\u6709\u9650\uff0c\u5bfc\u81f4\u65e0\u6cd5\u521b\u5efa\u65b0\u7684\u589e\u5220\u6539\u4e8b\u7269\uff0c\u4e0d\u8fc7undo slot\u6709128*1024=131072\u4e2a\uff0c\u5f88\u96be\u8fbe\u5230\u8fd9\u4e2a\u9650\u5236\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_28","title":"\u9501","text":"<p>\u4e3a\u4e86\u907f\u514d\u810f\u5199\uff0c\u5728\u6240\u6709\u9694\u79bb\u7ea7\u522b\u4e0b\u5199\u64cd\u4f5c\u5fc5\u987b\u52a0\u9501\uff0c\u800c\u8bfb\u64cd\u4f5c\u5219\u4e0d\u540c\uff0c\u5728READ UNCOMMITTED\u3001READ COMMITTED\u3001REPEATABLE READ\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e3a\u4e86\u63d0\u5347\u5e76\u53d1\u5ea6\uff08\u53ef\u7528\u6027\uff09\uff0c\u8bfb\u64cd\u4f5c\u90fd\u4e0d\u52a0\u9501\uff0c\u653e\u5f03\u4e86\u90e8\u5206\u8bfb\u5199\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u5728SERIALIZABLE\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u8bfb\u64cd\u4f5c\u4f1a\u52a0\u9501\uff0c\u4fdd\u8bc1\u4e86\u8bfb\u5199\u4e00\u81f4\u6027\u3002</p> <p>\u9501\u5b9a\u8bfb\u64cd\u4f5c\u6bd4\u8f83\u7279\u522b\uff0c\u53ef\u4ee5\u5728\u8bfb\u6570\u636e\u65f6\u663e\u5f0f\u4e3b\u52a8\u52a0\u9501\uff1a</p> Text Only<pre><code>SELECT ... LOCK IN SHARE MODE; -- \u5bf9\u8bfb\u53d6\u8bb0\u5f55\u52a0S\u9501\nSELECT ... FOR UPDATE; -- \u5bf9\u8bfb\u53d6\u8bb0\u5f55\u52a0X\u9501\n</code></pre>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#innodb_5","title":"InnoDB\u5b58\u50a8\u5f15\u64ce\u9501\u7684\u7c7b\u578b\uff1f","text":"<p>\u9501\u53ef\u4ee5\u6309\u4e0b\u9762\u4e24\u4e2a\u7ef4\u5ea6\u533a\u5206\uff1a</p> <ul> <li>\u6309\u9501\u7684\u7c92\u5ea6\u533a\u5206\uff1a\u8868\u9501\u3001\u884c\u9501\u3002</li> <li>\u6309\u8bfb\u5199\u64cd\u4f5c\u5206\uff1aS\u9501\uff08share\uff0c\u5171\u4eab\u9501\uff09\u3001X\u9501\uff08exclusive\u3001\u6392\u5b83\u9501\uff09\u3002</li> </ul> <p>\u8868\u9501\uff1a</p> <ul> <li>S\u9501\u548cX\u9501\uff1a\u76f4\u63a5\u9501\u6574\u5f20\u8868\u7684\u60c5\u51b5\u57fa\u672c\u9047\u4e0d\u5230\uff0c\u9664\u975e\u663e\u5f0f\u7528MySQL\u63d0\u4f9b\u7684\u9501\u8868\u8bed\u53e5\u52a0\u9501\u3002</li> <li>\u610f\u5411\u9501\uff08Intention\u9501\uff0cIS\u9501\u548cIX\u9501\uff09\uff1a\u5bf9\u8868\u4e2d\u67d0\u4e9b\u8bb0\u5f55\u52a0S\u9501\u5f0f\u4e4b\u524d\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0IS\u9501\uff0c\u5bf9\u8868\u4e2d\u67d0\u4e9b\u8bb0\u5f55\u52a0X\u9501\u5f0f\u4e4b\u524d\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0IX\u9501\u3002IS\u9501\u548cIX\u9501\u662f\u4e3a\u4e86\u540e\u7eed\u52a0\u8868\u9501\u65f6\uff0c\u907f\u514d\u4f7f\u7528\u904d\u5386\u7684\u65b9\u5f0f\u67e5\u770b\u8868\u4e2d\u6709\u6ca1\u6709\u4e0a\u9501\u7684\u8bb0\u5f55\u3002IS\u9501\u548cIX\u9501\u662f\u76f8\u5bb9\u7684\uff0cIX\u9501\u548cIX\u9501\u4e5f\u662f\u76f8\u5bb9\u7684\u3002</li> <li>AUTO-INC\u9501\uff1a\u5982\u679c\u8868\u4e2d\u67d0\u5217\u6dfb\u52a0\u4e86AUTO_INCREMENT\u5c5e\u6027\uff0c\u6267\u884cinsert\u8bed\u53e5\u5c31\u4f1a\u6dfb\u52a0\u8868\u7ea7\u522bAUTO_INC\u9501\u3002</li> </ul> <p>\u884c\u9501\uff1a</p> <ul> <li>Record Lock\uff1a\u8bb0\u5f55\u9501\u3002\u4ec5\u7ed9\u4e00\u6761\u8bb0\u5f55\u52a0\u9501\u3002</li> <li>Gap Lock\uff1a\u95f4\u9699\u9501\u3002\u7ed9\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u52a0\u9501\uff0c\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u3002\u7ed9Supremum\u8bb0\u5f55\u52a0gap\u9501\u53ef\u4ee5\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5411\u6b63\u65e0\u7a77\u5927\u7684\u533a\u95f4\u4e2d\u63d2\u5165\u8bb0\u5f55\u3002</li> <li>Next-Key Lock\uff1a\u4e34\u952e\u9501\u3002\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u5408\u4f53\uff0c\u65e2\u53ef\u4ee5\u9501\u4f4f\u8bb0\u5f55\uff0c\u53c8\u53ef\u4ee5\u9501\u4f4f\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u3002</li> <li>Insert Intention Lock\uff1a\u63d2\u5165\u610f\u5411\u9501\u3002\u4e8b\u52a1\u63d2\u5165\u8bb0\u5f55\u9047\u5230Gap Lock\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u8868\u660e\u81ea\u5df1\u6b63\u5728\u7b49\u5f85\u63d2\u5165\uff0c\u7b49\u5f85\u88ab\u6301\u6709Gap Lock\u9501\u7684\u4e8b\u52a1\u5524\u9192\u3002\u63d2\u5165\u610f\u5411\u9501\u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u4efb\u4f55\u9501\u3002</li> <li>\u9690\u5f0f\u9501\uff1ainsert\u64cd\u4f5c\u5982\u679c\u6ca1\u6709\u78b0\u5230Gap\u9501\u5c31\u4e0d\u4f1a\u5728\u65b0\u63d2\u5165\u7684\u8bb0\u5f55\u4e0a\u751f\u6210\u4efb\u4f55\u9501\u7ed3\u6784\uff0c\u800c\u662f\u5229\u7528\u9690\u5f0f\u9501\u6765\u907f\u514d\u5e76\u53d1\u95ee\u9898\u3002\u9690\u5f0f\u9501\u4e3b\u8981\u662f\u9488\u5bf9insert\u64cd\u4f5c\uff08UPDATE\u548cDELETE\u66f4\u65b0\u4e8c\u7ea7\u7d22\u5f15\u65f6\u52a0\u7684\u4e5f\u662f\u9690\u5f0f\u9501\uff09\uff0c\u53ef\u4ee5\u51cf\u5c11\u751f\u6210\u548c\u7ef4\u62a4\u9501\u7ed3\u6784\u7684\u5f00\u9500\u3002</li> </ul> <p>Record Lock\u3001Gap Lock\u3001Next-Key Lock\u90fd\u6709S\u9501\u548cX\u9501\u4e24\u79cd\uff0c\u4f46Insert Intention Lock\u548c\u9690\u5f0f\u9501\u4e0d\u533a\u5206S\u9501\u548cX\u9501\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_29","title":"\u9690\u5f0f\u9501\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u6709\u4e2atrx_id\u9690\u85cf\u5217\uff0c\u8bb0\u5f55\u7740\u6700\u540e\u4fee\u6539\u8bb0\u5f55\u7684\u4e8b\u52a1id\uff0c\u65b0\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u540e\u8bb0\u5f55\u7684trx_id\u5c31\u662finsert\u4e8b\u52a1\u7684id\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u60f3\u5bf9\u8be5\u8bb0\u5f55\u52a0Record Lock\uff0c\u9996\u5148\u4f1a\u770b\u4e00\u4e0b\u8bb0\u5f55\u7684trx_id\u662f\u5426\u662f\u5f53\u524d\u6d3b\u8dc3\u7684\u4e8b\u52a1\uff0c\u5982\u679c\u4e0d\u662f\u5c31\u53ef\u4ee5\u6b63\u5e38\u52a0\u9501\uff0c\u5426\u5219\u5c31\u5e2e\u524d\u9762\u7684insert\u4e8b\u52a1\u751f\u6210\u4e00\u4e2aX\u578b\u7684Record Lock\uff0c\u7136\u540e\u81ea\u5df1\u518d\u751f\u6210\u4e00\u4e2aRecord Lock\u5e76\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u4e8c\u7ea7\u7d22\u5f15\u6ca1\u6709trx_id\u9690\u85cf\u5217\uff0c\u4f46\u4e8c\u7ea7\u7d22\u5f15\u9875\u9762\u7684Page Header\u90e8\u5206\u6709\u4e00\u4e2aPAGE_MAX_TRX_ID\u5c5e\u6027\uff0cPAGE_MAX_TRX_ID\u8bb0\u5f55\u7740\u4fee\u6539\u8be5\u9875\u9762\u7684\u6700\u5927\u4e8b\u52a1id\uff0c\u5982\u679cPAGE_MAX_TRX_ID\u5c0f\u4e8e\u5f53\u524d\u6700\u5c0f\u7684\u6d3b\u8dc3\u4e8b\u52a1id\uff0c\u90a3\u4e48\u8868\u793a\u5bf9\u9875\u9762\u505a\u4fee\u6539\u7684\u4e8b\u52a1\u5df2\u7ecf\u63d0\u4ea4\uff0c\u53ef\u4ee5\u76f4\u63a5\u5bf9\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u9501\uff0c\u5426\u5219\u5c31\u9700\u8981\u56de\u8868\u4e4b\u540e\u518d\u5bf9\u805a\u7c07\u7d22\u5f15\u52a0\u9501\uff0c\u91cd\u590d\u4e0a\u9762\u7684\u903b\u8f91\u3002</p> <p>\u9690\u5f0f\u9501\u8d77\u5230\u4e86\u5bf9insert\u7684\u65b0\u8bb0\u5f55\u5ef6\u8fdf\u52a0\u9501\u7684\u4f5c\u7528\uff0c\u51cf\u5c11\u4e86\u751f\u6210\u9501\u7ed3\u6784\u7684\u5f00\u9500\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#_30","title":"\u884c\u9501\u5728\u5185\u5b58\u4e2d\u7684\u7ed3\u6784\uff1f","text":"<p>\u9664\u4e86\u9690\u5f0f\u9501\u4e4b\u5916\uff0c\u5176\u4ed6\u9501\u90fd\u9700\u8981\u5728\u5185\u5b58\u4e2d\u751f\u6210\u4e00\u4e2a\u9501\u7ed3\u6784\uff0c\u5982\u679c\u591a\u4e2a\u9501\u7b26\u5408\u4e00\u4e0b\u6761\u4ef6\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a\u8fd9\u4e9b\u9501\u653e\u5728\u4e00\u4e2a\u9501\u7ed3\u6784\u4e2d\uff0c\u907f\u514d\u6bcf\u884c\u8bb0\u5f55\u90fd\u521b\u5efa\u4e00\u4e2a\u9501\u7ed3\u6784\uff0c\u4ee5\u51cf\u5c11\u521b\u5efa\u9501\u7ed3\u6784\u7684\u5f00\u9500\uff1a</p> <ul> <li>\u540c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u52a0\u7684\u9501\u3002</li> <li>\u88ab\u52a0\u9501\u7684\u8bb0\u5f55\u5728\u7528\u4e00\u4e2a\u9875\u9762\u4e2d\u3002</li> <li>\u9501\u7684\u7c7b\u578b\u662f\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u90fd\u662fX\u578b\u7684Record Lock\u3002</li> <li>\u7b49\u5f85\u72b6\u6001\u662f\u4e00\u6837\u7684\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#updatedelete","title":"UPDATE\u548cDELETE\u5982\u4f55\u52a0\u9501\uff1f","text":"<p>\u9501\u5b9a\u8bfb\u3001UPDATE\u3001DELETE\u7684\u52a0\u9501\u903b\u8f91\u5927\u81f4\u76f8\u540c\uff1a</p> <ul> <li>\u5728\u4e0d\u5927\u4e8eREAD COMMITTED\u9694\u79bb\u7ea7\u522b\u4e0b\u52a0\u7684\u662fRecord Lock\uff1b\u800c\u5728\u4e0d\u5c0f\u4e8eREPEATABLE READ\u9694\u79bb\u7ea7\u522b\u4e0b\u52a0\u7684\u662fNext-Key Lock\u3002\u5982\u679c\u8bbf\u95ee\u65b9\u6cd5\u662fconst\uff08\u552f\u4e00\u6027\u641c\u7d22\uff09\uff0c\u65e0\u8bba\u54ea\u4e2a\u9694\u79bb\u7ea7\u522b\u90fd\u662f\u52a0Record Lock\u3002</li> <li>\u76f4\u63a5\u626b\u63cf\u805a\u7c07\u7d22\u5f15\u7684\u60c5\u51b5\uff0c\u5728\u4e0d\u5927\u4e8eREAD COMMITTED\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u51e1\u662f\u6ee1\u8db3where\u6761\u4ef6\u7684\u8bb0\u5f55\u90fd\u52a0\u9501\uff0c\u4e0d\u6ee1\u8db3\u7684\u4e0d\u52a0\u9501\uff1b\u5728\u4e0d\u5c0f\u4e8eREPEATABLE READ\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ea\u8981\u662f\u5728\u626b\u63cf\u533a\u95f4\u4e2d\u88ab\u626b\u8fc7\u7684\u8bb0\u5f55\u90fd\u4f1a\u88ab\u52a0\u9501\u3002\u6ce8\u610f\uff0c\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u6761\u4ef6\u53ea\u662fwhere\u6761\u4ef6\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u626b\u63cf\u533a\u95f4\u7684\u8303\u56f4\u8981\u6bd4where\u6761\u4ef6\u5927\u3002</li> <li>\u5982\u679c\u662f\u5148\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u518d\u56de\u8868\u7684\u60c5\u51b5\uff0c\u5728\u4e0d\u5927\u4e8eREAD COMMITTED\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u51e1\u662f\u6ee1\u8db3where\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u548c\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u90fd\u52a0\u9501\uff0c\u4e0d\u6ee1\u8db3\u7684\u4e0d\u52a0\u9501\uff1b\u5728\u4e0d\u5c0f\u4e8eREPEATABLE READ\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ea\u8981\u662f\u5728\u626b\u63cf\u533a\u95f4\u4e2d\u88ab\u626b\u8fc7\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u90fd\u4f1a\u88ab\u52a0\u9501\uff0c\u4f46\u662f\u5982\u679c\u4e0d\u6ee1\u8db3\u56de\u8868\u6761\u4ef6\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u56de\u8868\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u5bf9\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u52a0\u9501\uff0c\u5373\u53ea\u6709\u6ee1\u8db3where\u6761\u4ef6\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u624d\u4f1a\u88ab\u52a0\u9501\u3002</li> </ul> <p>\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7279\u6b8a\u60c5\u51b5\u6709\u7740\u7279\u6b8a\u7684\u52a0\u9501\u903b\u8f91\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u4e00\u822c\u51fa\u73b0\u5728\u8fb9\u754c\u6761\u4ef6\u7684\u8bb0\u5f55\u4e0a\u3002</p> <p>\u9501\u5b9a\u8bfb\u3001UPDATE\u3001DELETE\u7684\u52a0\u9501\u903b\u8f91\u4e5f\u5404\u81ea\u6709\u72ec\u7279\u7684\u5730\u65b9\uff1a</p> <ul> <li>\u9501\u5b9a\u8bfb\u53ef\u4ee5\u9009\u62e9\u52a0S\u9501\u6216\u8005X\u9501\uff0cUPDATE\u3001DELETE\u53ea\u80fd\u52a0X\u9501\u3002</li> <li>UPDATE\u5373\u4f7f\u641c\u7d22\u65f6\u4f7f\u7528\u4e0d\u5230\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u53ef\u80fd\u66f4\u65b0\u7684\u5b57\u6bb5\u6709\u7d22\u5f15\uff0c\u8fd9\u4e2a\u65f6\u5019\u540c\u6837\u9700\u8981\u5bf9\u4e8c\u7ea7\u7d22\u5f15\u52a0\u9501\u3002</li> <li>UPDATE\u3001DELETE\u5bf9\u88ab\u66f4\u65b0\u6216\u8005\u5220\u9664\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f\u9690\u5f0f\u9501\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#insert","title":"INSERT\u5982\u4f55\u52a0\u9501\uff1f","text":"<p>INSERT\u5982\u679c\u9047\u5230gap\u9501\uff08gap\u9501\u6216next-key\u9501\uff09\u4f1a\u4f7f\u7528\u63d2\u5165\u610f\u5411\u9501\uff1b\u5982\u679c\u6ca1\u6709\u9047\u5230\u4e00\u822c\u4f1a\u4f7f\u7528\u9690\u5f0f\u9501\uff0c\u4e0d\u8fc7\u4e5f\u6709\u7279\u6b8a\u60c5\u51b5\uff1a</p> <ul> <li>\u9047\u5230\u91cd\u590d\u4e3b\u952e\uff0c\u4f1a\u7ed9\u88ab\u91cd\u590d\u7684\u8bb0\u5f55\u52a0\u9501\uff0c\u4e0d\u5927\u4e8eREAD COMMITTED\u52a0\u7684\u662fS\u578bRecord Lock\uff0c\u4e0d\u5c0f\u4e8eREPEATABLE READ\u52a0\u7684\u662fS\u578bNext-Key Lock\u3002</li> <li>\u9047\u5230\u5916\u952e\u68c0\u67e5\uff0c\u5982\u679c\u5916\u952e\u5728\u7236\u8868\u4e2d\u5b58\u5728\uff0c\u76f4\u63a5\u7ed9\u7236\u8868\u8bb0\u5f55\u52a0S\u578bRecord Lock\uff1b\u5982\u679c\u5728\u7236\u8868\u4e2d\u4e0d\u5b58\u5728\uff0c\u6b64\u65f6\u63d2\u5165\u867d\u7136\u5931\u8d25\uff0c\u4f46\u662f\u5982\u679c\u9694\u79bb\u7ea7\u522b\u4e0d\u5c0f\u4e8eREPEATABLE READ\uff0c\u5219\u4f1a\u7ed9\u7236\u8868\u5927\u4e8e\u6307\u5b9a\u5916\u952e\u7684\u8bb0\u5f55\u52a0\u4e0agap\u9501\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/MySQL%E9%AB%98%E7%BA%A7/#sql","title":"\u5982\u4f55\u4f18\u5316\u4e00\u6761SQL\uff1f","text":"<p>\u5f85\u6574\u7406............</p> <p>\u5148\u60f3\u4e00\u4e0b\u8fd9\u6761SQL\u8be5\u600e\u4e48\u6267\u884c\u6700\u597d\uff0c\u5355\u8868\u8d70\u4ec0\u4e48\u7d22\u5f15\uff0c\u4f7f\u7528\u4ec0\u4e48\u8fde\u63a5\u7b97\u6cd5\uff0c\u8d70\u7d22\u5f15\u5417\uff0c\u5b50\u67e5\u8be2\u5e94\u8be5\u600e\u4e48\u6267\u884c\uff0c\u534a\u8fde\u63a5\u8fd8\u662f\u7269\u5316\uff1f\u7136\u540eexplain\u770b\u4e00\u4e0b\u7b26\u4e0d\u7b26\u5408\u9884\u671f\u3002\u8fd9\u4e2a\u95ee\u9898\u592a\u590d\u6742\u4e86\uff0c\u5305\u542b\u7684\u5185\u5bb9\u592a\u591a\u4e86\uff0c\u771f\u7684\u4e0d\u597d\u56de\u7b54\u3002\u6700\u591a\u7684\u5c31\u662f\u770b\u8d70\u6ca1\u8d70\u7d22\u5f15\uff0c\u4e3a\u4ec0\u4e48\u6ca1\u8d70\u7d22\u5f15\uff0c\u8fd8\u9700\u4e0d\u9700\u8981\u518d\u5efa\u7d22\u5f15\uff0c\u50cfpg\u6211\u8fd8\u53ef\u4ee5vuccum\u4e00\u4e0b\u8868\uff0c\u8c03\u6574fillfactor\u7b49\u53c2\u6570\uff0cMySQL\u597d\u50cf\u6ca1\u4ec0\u4e48\u53c2\u6570\u53ef\u8c03\uff1f\u8c03\u6574\u53c2\u6570\u4e5f\u53ef\u6574\u7406\u4e00\u4e0b\u3002\u7136\u540e\u5c31\u6280\u672f\u4e0a\u7684\u4f18\u5316\u5c31\u6ca1\u4e86\uff0c\u5269\u4e0b\u7684\u53ef\u4ee5\u7ed3\u5408\u4e1a\u52a1\u8fdb\u884c\u4f18\u5316\uff0c\u6bd4\u5982\u8868\u7ed3\u6784\u5408\u4e0d\u5408\u7406\uff0c\u67d0\u4e9b\u5b57\u6bb5\u662f\u4e0d\u662f\u7c7b\u578b\u592a\u5927\u4e86\uff0c\u8868\u662f\u4e0d\u662f\u8fd8\u53ef\u518d\u89c4\u8303\u5316\uff0c\u6ee1\u8db3\u4e09\u8303\u5f0f\u539f\u5219\uff0c\u7b49\u7b49\u3002</p> <p>\u4f7f\u7528\u7cfb\u7edf\u53d8\u91cfoptimizer_switch\u63a7\u5236\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u522b\u4f7f\u7528hash join\u3002</p> <p>\u5bf9\u6bd4\u6570\u636e\u5e93\u7684redo\u65e5\u5fd7\u65b9\u6848\u548clog\u5408\u5e76\u6811\u7684\u65b9\u6848\uff1f</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/","title":"Redis","text":"<p> \u7ea6 1938 \u4e2a\u5b57  8 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 39 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#hash","title":"\u4e00\u81f4\u6027Hash\u7b97\u6cd5\uff1f","text":"<p>\u4f20\u7edf\u7684Hash\u7b97\u6cd5\u5728\u589e\u52a0\u5220\u9664\u670d\u52a1\u5668\u7684\u65f6\u5019\u90fd\u9700\u8981\u91cd\u65b0Hash\u6240\u6709\u6570\u636e\u624d\u53ef\u4ee5\u4fdd\u8bc1\u4e0b\u4e00\u6b21\u53d6\u6570\u636e\u7684\u4e0d\u51fa\u9519\uff0c\u8fd9\u6837\u6027\u80fd\u592a\u4f4e\u4e86\u3002\u4e00\u81f4\u6027hash\u5c31\u662f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u3002</p> <p>\u9996\u5148\u8bf4\u4e00\u4e0b\u4f20\u7edf\u7684Hash\u7b97\u6cd5\u5728\u589e\u52a0\u5220\u9664\u670d\u52a1\u5668\u7684\u95ee\u9898\u3002\u6bd4\u5982\u8bf4\u6700\u5f00\u59cb\u67093\u53f0\u670d\u52a1\u5668\uff0c\u6302\u4e86\u4e00\u53f0\uff0c\u90a3\u4e48\u53d6\u6570\u65f6\u4f60\u662f\u5bf93\u53d6\u4f59\u8fd8\u662f\u5bf92\u53d6\u4f59\uff0c\u5bf93\u53d6\u4f59\u7684\u8bdd\uff0c\u65b0\u6dfb\u52a0\u7684\u6570\u636e\u5c31\u6709\u53ef\u80fd\u52a0\u4e0d\u8fdb\u53bb\uff0c\u5bf92\u53d6\u4f59\u7684\u8bdd\uff0c\u90a3\u4e48\u6570\u636e\u539f\u672c\u5728\u6ca1\u6709\u6302\u76840\u53f7\u673a\u4e0a\uff0c\u5c31\u6709\u80fd\u53d6\u4f59\u7684\u7ed3\u679c\u53d8\u6210\u4e861\u3002\u5982\u679c\u8bf4\u5bf9\u539f\u6765\u6570\u636e\u75283\u53d6\u4f59\uff0c\u5bf9\u6dfb\u52a0\u7684\u6570\u636e\u75282\u53d6\u4f59\u90a3\u5c31\u6ca1\u95ee\u9898\u4e86\uff0c\u4f46\u662f\u4f60\u53d6\u6570\u7684\u65f6\u5019\u600e\u4e48\u77e5\u9053\u8fd9\u662f\u539f\u6765\u7684\u6570\u636e\u5462\u3002</p> <p>\u65b0\u589e\u52a0\u4e00\u53f0\u673a\u5668\u4e5f\u662f\u540c\u6837\u7684\u9053\u7406\uff0c\u90fd\u5fc5\u987b\u91cd\u65b0\u6563\u5217\u6240\u6709\u6570\u636e\u3002</p> <p>\u4e00\u81f4\u6027Hash\u7b97\u6cd5\u7684\u505a\u6cd5\u662f\uff0c\u4f7f\u7528\u4e00\u4e2a\u73af\u72b6\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5373\u4e00\u81f4\u6027Hash\u73af\uff0c\u628a\u6570\u636e\u548c\u670d\u52a1\u5668\u90fdhash\u5230\u8fd9\u4e2a\u73af\u4e0a\uff0c\u670d\u52a1\u5668\u5c31\u7528ip\u6216\u4e3b\u673a\u540dhash\u5373\u53ef\uff0c\u6570\u636e\u6240\u5b58\u653e\u7684\u673a\u5668\u5c31\u662f\u987a\u65f6\u9488\u6700\u8fd1\u7684\u90a3\u53f0\u670d\u52a1\u5668\u3002\u8fd9\u6837\u5982\u679c\u6302\u4e86\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u90a3\u4e48\u5bf9\u67e5\u5269\u4f59\u7684\u6570\u636e\u6ca1\u5f71\u54cd\u7684\uff0c\u53ea\u662f\u5728\u67e5\u4fdd\u5b58\u5728\u6302\u4e86\u7684\u90a3\u53f0\u673a\u5668\u4e0a\u7684\u6570\u636e\u65f6\uff0c\u4f1a\u5728\u73af\u4e0a\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\u4e2d\u627e\uff0c\u4f46\u662f\u627e\u4e0d\u5230\uff0c\u8fd4\u56de\u9519\u8bef\u5373\u53ef\u3002\u5bf9\u4e8e\u589e\u52a0\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u53ea\u9700\u8981\u628a\u5b83\u987a\u65f6\u9488\u7684\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\u90e8\u5206\u6570\u636e\u8f6c\u79fb\u5230\u8fd9\u53f0\u673a\u5668\u4e0a\u5373\u53ef\uff0c\u4e0d\u7528\u8c03\u6574\u5168\u90e8\u6570\u636e\u3002\u4e0d\u8fc7\u8fd9\u91cc\u8fd8\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u65b0\u589e\u52a0\u7684\u670d\u52a1\u5668\u53ea\u5206\u62c5\u4e00\u53f0\u670d\u52a1\u5668\u7684\u538b\u529b\uff0c\u5bf9\u5176\u5b83\u670d\u52a1\u5668\u6ca1\u6709\u4e1d\u6beb\u5f71\u54cd\uff0c\u6240\u4ee5\u65b0\u7684\u89e3\u51b3\u65b9\u6cd5\u5c31\u662f\u628a\u6bcf\u53f0\u670d\u52a1\u5668\u4f5c\u4e3a\u8bb8\u591a\u4e2a\u865a\u62df\u8282\u70b9\u5206\u6563\u7684hash\u5230\u8fd9\u4e2a\u73af\u4e0a\uff0c\u6bcf\u53f0\u673a\u5668\u90fd\u5982\u6b64\uff0c\u8fd9\u6837\u65b0\u673a\u5668\u52a0\u5165\u7684\u65f6\u5019\u4e5f\u662f\u4f5c\u4e3a\u8bb8\u591a\u865a\u62df\u8282\u70b9\u6563\u5f00\u8fd9\u4e2a\u73af\u4e0a\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u968f\u673a\u7684\u5206\u62c5\u5176\u5b83\u8bb8\u591a\u670d\u52a1\u5668\u7684\u5b58\u50a8\u538b\u529b\u4e86\u3002</p> <p>Redis\u5206\u5e03\u5f0f\u5b58\u50a8\u6570\u636e\u5c31\u662f\u8fd9\u4e2a\u539f\u7406\uff0c\u4e0eHDFS\u5206\u5e03\u5f0f\u5b58\u50a8\u5b8c\u5168\u4e0d\u540c\uff0cHDFS\u9700\u8981\u4e00\u4e2aNameNode\u6765\u4fdd\u5b58\u6587\u4ef6\u7684\u5206\u5e03\u7684\u4fe1\u606f\uff0c\u4f46\u662fRedis\u4e0d\u7528\uff0c\u4e0d\u8fc7\u8fd9\u4e5f\u4e3b\u8981\u662f\u56e0\u4e3a\u5b83\u4eec\u9762\u5411\u7684\u6570\u636e\u4e0d\u540c\uff0cRedis\u9762\u5411\u7684\u662f\u4e00\u6761\u6570\u636e\uff0cHDFS\u9762\u5411\u4e00\u4e2a\u6587\u4ef6\u3002</p> <p>\u6309\u7167\u5e38\u7528\u7684hash\u7b97\u6cd5\u6765\u5c06\u5bf9\u5e94\u7684key\u54c8\u5e0c\u5230\u4e00\u4e2a\u5177\u67092^32\u6b21\u65b9\u4e2a\u6876\u7684\u7a7a\u95f4\u4e2d\uff0c\u5373<code>0 ~ (2^32)-1</code>\u7684\u6570\u5b57\u7a7a\u95f4\u4e2d\u3002\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u6570\u5b57\u5934\u5c3e\u76f8\u8fde\uff0c\u60f3\u8c61\u6210\u4e00\u4e2a\u95ed\u5408\u7684\u73af\u5f62\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6570\u636e \u548c \u673a\u5668\u7684\u552f\u4e00\u6807\u8bc6 \u90fd\u8fdb\u884chash\uff0c\uff1a</p> <p></p> <p>\u6570\u636e\u987a\u65f6\u9488\u5b58\u5230\u6700\u8fd1\u7684\u673a\u5668\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#redis","title":"Redis\u7684\u6570\u636e\u7ed3\u6784\uff1f","text":"<p>String\uff1a\u5b57\u7b26\u4e32\u3001\u6574\u6570\u6216\u8005\u6d6e\u70b9\u6570\uff0c\u53ef\u5bf9\u5bf9\u6574\u6570\u548c\u6d6e\u70b9\u6570\u6267\u884c\u81ea\u589e\u6216\u8005\u81ea\u51cf\u64cd\u4f5c\u3002</p> <p>List\uff1a\u5e94\u7528\u5982 \u8bc4\u8bba\u5217\u8868\u3001\u6d88\u606f\u961f\u5217\uff08\u6570\u636e\u7684\u751f\u4ea7\u8005\u53ef\u4ee5\u901a\u8fc7Lpush\u547d\u4ee4\u4ece\u5de6\u8fb9\u63d2\u5165\u6570\u636e\uff0c\u591a\u4e2a\u6570\u636e\u6d88\u8d39\u8005\uff0c\u53ef\u4ee5\u4f7f\u7528BRpop\u547d\u4ee4\u963b\u585e\u7684\u201c\u62a2\u201d\u5217\u8868\u5c3e\u90e8\u7684\u6570\u636e\uff09\u3002</p> <p>Set\uff1a\u65e0\u5e8f\u96c6\u5408\uff0c\u81ea\u52a8\u53bb\u91cd\u7684\u90a3\u3002</p> <p>Sorted Set\uff1a\u53bb\u91cd\u5e76\u6392\u5e8f\uff0c\u5199\u8fdb\u53bb\u7684\u65f6\u5019\u7ed9\u4e00\u4e2a\u5206\u6570\uff0c\u81ea\u52a8\u6839\u636e\u5206\u6570\u6392\u5e8f\uff0c\u5e94\u7528\u5982 \u6392\u884c\u699c\u3002</p> <p>Hash\uff1a\u5305\u542b\u952e\u503c\u5bf9\u7684\u65e0\u5e8f\u6563\u5217\u8868\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#redis_1","title":"Redis\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1f","text":"<p>https://i6448038.github.io/2019/12/01/redis-data-struct/</p> <p>1.\u52a8\u6001\u5b57\u7b26\u4e32SDS\uff1a</p> <ul> <li>\u7a7a\u95f4\u9884\u5206\u914d</li> <li>\u60f0\u6027\u7a7a\u95f4\u91ca\u653e</li> </ul> <p>2.\u53cc\u5411\u94fe\u8868</p> <p>3.\u538b\u7f29\u5217\u8868ziplist\uff1a\u6b64\u6570\u636e\u7ed3\u6784\u662f\u4e3a\u4e86\u8282\u7ea6\u5185\u5b58\u800c\u8bbe\u8ba1\u7684\uff0c\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\uff0c</p> <ul> <li>\u5143\u7d20\u7684\u904d\u5386\uff1a\u5148\u627e\u5230\u5217\u8868\u5c3e\u90e8\u5143\u7d20\uff0c\u7136\u540e\u518d\u6839\u636eziplist\u8282\u70b9\u5143\u7d20\u4e2d\u7684<code>previous_entry_length</code>\u5c5e\u6027\uff0c\u6765\u9010\u4e2a\u904d\u5386\u3002</li> </ul> <p>4.\u54c8\u5e0c\u8868\uff1a\u91c7\u7528\u4e86\u6e10\u8fdb\u5f0f\u54c8\u5e0c\u7684\u65b9\u5f0f\u5b8c\u6210\u6536\u7f29\u548c\u6269\u5bb9\u7684\u6b65\u9aa4\uff0c\u9996\u5148\u662f\u5728\u54c8\u5e0c\u8868\u7684\u6570\u636e\u7ed3\u6784\u91cc\u9762\u6709\u4e24\u4e2a\u8868\u5934\uff08ht[0]\u548cht[1]\uff09\uff0c\u4e5f\u5c31\u662f\u4e24\u5f20\u54c8\u5e0c\u8868\uff0c\u521a\u5f00\u59cb\u7684\u65f6\u5019\u53ea\u5728\u7b2c\u4e00\u5f20\u54c8\u5e0c\u8868\u91cc\u589e\u52a0\u548c\u5220\u9664\u5143\u7d20\uff0c\u7136\u540erehash\u7684\u65f6\u5019\uff0c\u4f1a\u5728\u7ed9\u7b2c\u4e8c\u5f20\u54c8\u5e0c\u8868\u5f00\u8f9f\u7a7a\u95f4\uff0c\u63a5\u7740\u5206n\u6b65\u6162\u6162\u5730\u5c06\u7b2c\u4e00\u5f20\u8868\u7684\u5143\u7d20rehash\u5230\u53e6\u5916\u4e00\u5f20\u8868\u4e0a\uff0c\u5176\u8fc7\u7a0b\u4f9d\u9760rehashidx\u53d8\u91cf\u5b8c\u6210\uff0crehashidx \u7684\u6570\u503c\u5c31\u662f\u73b0\u5728rehash\u7684\u5143\u7d20\u4f4d\u7f6e\uff0crehashidx \u7b49\u4e8e -1 \u7684\u65f6\u5019\u8bf4\u660e\u6ca1\u6709\u5728\u8fdb\u884crefresh\uff0crehash\u5b8c\u6210\u4e4b\u540e\u4f1a\u5c06ht[0]\u548cht[1]\u4e92\u6362\uff0c\u4e5f\u5c31\u662f\u4fdd\u6301ht[0]\u8fd8\u662f\u5f53\u524d\u6709\u5143\u7d20\u7684\u90a3\u5f20hash\u8868\uff0cht[1]\u8fd8\u662f\u6ca1\u6709\u5143\u7d20\u7684\u90a3\u5f20hash\u8868\u3002</p> <p>5.\u8df3\u8868</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#_1","title":"\u5b57\u7b26\u4e32","text":"<p>\u5176\u4e2d\uff1aembstr\u548craw\u90fd\u662f\u7531SDS\u52a8\u6001\u5b57\u7b26\u4e32\u6784\u6210\u7684\u3002\u552f\u4e00\u533a\u522b\u662f\uff1araw\u662f\u5206\u914d\u5185\u5b58\u7684\u65f6\u5019\uff0credisobject\u548c sds \u5404\u5206\u914d\u4e00\u5757\u5185\u5b58\uff0c\u800cembstr\u662fredisobject\u548craw\u5728\u4e00\u5757\u513f\u5185\u5b58\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#_2","title":"\u5217\u8868","text":""},{"location":"%E9%97%AE%E7%AD%94/Redis/#hash_1","title":"hash","text":""},{"location":"%E9%97%AE%E7%AD%94/Redis/#set","title":"set","text":""},{"location":"%E9%97%AE%E7%AD%94/Redis/#zset","title":"zset","text":""},{"location":"%E9%97%AE%E7%AD%94/Redis/#redis_2","title":"redis\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5feb\uff1f","text":"<p>1.\u5b8c\u5168\u57fa\u4e8e\u5185\u5b58</p> <p>2.\u91c7\u7528\u5355\u7ebf\u7a0b\uff0c\u907f\u514d\u4e86\u9891\u7e41\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u9501\u8d44\u6e90\u4e89\u7528\u7684\u5f00\u9500</p> <p>3.\u91c7\u7528\u4e86\u975e\u963b\u585eI/O\u591a\u8def\u590d\u7528\u673a\u5236</p> <p>4.\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#rediscpu","title":"Redis\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u5982\u4f55\u5145\u5206\u5229\u7528\u591a\u6838CPU\u670d\u52a1\u5668\u7684\u6027\u80fd\uff1f","text":"<p>Reids\u7684\u6027\u80fd\u74f6\u9888\u901a\u5e38\u662f\u7f51\u5361\u7684\u541e\u5410\u91cf\u548c\u5185\u5b58\u7684\u5927\u5c0f\uff0c\u6bd4\u5982\u53ef\u80fd\u51fa\u73b0\u5343\u5146\u7f51\u5361\u6253\u6ee1\u4e5f\u6253\u4e0d\u6ee1CPU\u7684\u5355\u6838\u6027\u80fd\u3002\u5f53\u5355\u6838\u6027\u80fd\u4e0d\u80fd\u6ee1\u8db3\uff0c\u9700\u8981\u80fd\u538b\u69a8\u591a\u6838\u670d\u52a1\u5668\u7684\u6027\u80fd\u65f6\uff0c\u53ef\u4ee5\u5728\u5355\u53f0\u670d\u52a1\u5668\u4e0a\u90e8\u7f72\u591a\u4e2aRedis\u5b9e\u4f8b\uff0c\u6bcf\u4e2aRedis\u8fdb\u7a0b\u90fd\u4e0eCPU\u7684\u4e00\u4e2a\u6838\u5fc3\u7ed1\u5b9a\uff0c\u7136\u540e\u7ec4\u6210Redis-cluster\u6a21\u5f0f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#_3","title":"\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f","text":"<p>\u53ef\u4ee5\u8bbe\u7f6e\u5185\u5b58\u6700\u5927\u4f7f\u7528\u91cf\uff0c\u5f53\u5185\u5b58\u4f7f\u7528\u91cf\u8d85\u51fa\u65f6\uff0c\u4f1a\u65bd\u884c\u6570\u636e\u6dd8\u6c70\u7b56\u7565\u3002Redis \u5177\u4f53\u6709 6 \u79cd\u6dd8\u6c70\u7b56\u7565\uff1a</p> \u7b56\u7565 \u63cf\u8ff0 volatile-lru \u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl \u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random \u4ece\u5df2\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u96c6\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 allkeys-lru \u4ece\u6240\u6709\u6570\u636e\u96c6\u4e2d\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random \u4ece\u6240\u6709\u6570\u636e\u96c6\u4e2d\u4efb\u610f\u9009\u62e9\u6570\u636e\u8fdb\u884c\u6dd8\u6c70 noeviction \u7981\u6b62\u9a71\u9010\u6570\u636e <p>Redis 4.0 \u5f15\u5165\u4e86 volatile-lfu \u548c allkeys-lfu \u6dd8\u6c70\u7b56\u7565\uff0cLFU \u7b56\u7565\u901a\u8fc7\u7edf\u8ba1\u8bbf\u95ee\u9891\u7387\uff0c\u5c06\u8bbf\u95ee\u9891\u7387\u6700\u5c11\u7684\u952e\u503c\u5bf9\u6dd8\u6c70\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Redis/#_4","title":"\u6301\u4e45\u5316\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Redis/#aof","title":"AOF \u6301\u4e45\u5316","text":"<p>\u5c06\u5199\u547d\u4ee4\u6dfb\u52a0\u5230 AOF \u6587\u4ef6\uff08Append Only File\uff09\u7684\u672b\u5c3e\u3002</p> <p>\u4f7f\u7528 AOF \u6301\u4e45\u5316\u9700\u8981\u8bbe\u7f6e\u540c\u6b65\u9009\u9879\uff0c\u4ece\u800c\u786e\u4fdd\u5199\u547d\u4ee4\u540c\u6b65\u5230\u78c1\u76d8\u6587\u4ef6\u4e0a\u7684\u65f6\u673a\u3002\u8fd9\u662f\u56e0\u4e3a\u5bf9\u6587\u4ef6\u8fdb\u884c\u5199\u5165\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u5c06\u5185\u5bb9\u540c\u6b65\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5b58\u50a8\u5230\u7f13\u51b2\u533a\uff0c\u7136\u540e\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u540c\u6b65\u5230\u78c1\u76d8\u3002\u6709\u4ee5\u4e0b\u540c\u6b65\u9009\u9879\uff1a</p> \u9009\u9879 \u540c\u6b65\u9891\u7387 always \u6bcf\u4e2a\u5199\u547d\u4ee4\u90fd\u540c\u6b65 everysec \u6bcf\u79d2\u540c\u6b65\u4e00\u6b21 no \u8ba9\u64cd\u4f5c\u7cfb\u7edf\u6765\u51b3\u5b9a\u4f55\u65f6\u540c\u6b65 <ul> <li>always \u9009\u9879\u4f1a\u4e25\u91cd\u51cf\u4f4e\u670d\u52a1\u5668\u7684\u6027\u80fd\uff1b</li> <li>everysec \u9009\u9879\u6bd4\u8f83\u5408\u9002\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u5d29\u6e83\u65f6\u53ea\u4f1a\u4e22\u5931\u4e00\u79d2\u5de6\u53f3\u7684\u6570\u636e\uff0c\u5e76\u4e14 Redis \u6bcf\u79d2\u6267\u884c\u4e00\u6b21\u540c\u6b65\u5bf9\u670d\u52a1\u5668\u6027\u80fd\u51e0\u4e4e\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\uff1b</li> <li>no \u9009\u9879\u5e76\u4e0d\u80fd\u7ed9\u670d\u52a1\u5668\u6027\u80fd\u5e26\u6765\u591a\u5927\u7684\u63d0\u5347\uff0c\u800c\u4e14\u4e5f\u4f1a\u589e\u52a0\u7cfb\u7edf\u5d29\u6e83\u65f6\u6570\u636e\u4e22\u5931\u7684\u6570\u91cf\u3002</li> </ul> <p>\u968f\u7740\u670d\u52a1\u5668\u5199\u8bf7\u6c42\u7684\u589e\u591a\uff0cAOF \u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002Redis \u63d0\u4f9b\u4e86\u4e00\u79cd\u5c06 AOF \u91cd\u5199\u7684\u7279\u6027\uff0c\u80fd\u591f\u53bb\u9664 AOF \u6587\u4ef6\u4e2d\u7684\u5197\u4f59\u5199\u547d\u4ee4\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/","title":"Spark","text":"<p> \u7ea6 2697 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 54 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#mapreducespark","title":"\u76f8\u6bd4\u8f83\u4e8eMapReduce\uff0cSpark\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5feb\uff1f","text":"<ol> <li> <p>shuffle\uff1a \u4f7f\u7528MapReduce\u6846\u67b6\u548cSpark\u6846\u67b6\u7f16\u5199map-reduce\u7a0b\u5e8f\uff0c\u5728\u7406\u8bba\u4e0ashuffle\u6b21\u6570\u5e94\u8be5\u662f\u4e00\u6837\u591a\u7684\uff0c\u56e0\u4e3a\u90fd\u662f\u57fa\u4e8emap-reduce\u601d\u60f3\u7684\uff0c\u4f46\u662f\u7531\u4e8e\u4f7f\u7528MapReduce\u6846\u67b6\u4e0d\u591f\u7075\u6d3b\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u7ecf\u8fc7\u826f\u597d\u7684\u8bbe\u8ba1\u5f88\u5bb9\u6613\u9020\u6210\u4f7f\u7528MapReduce\u6846\u67b6\u6bd4\u4f7f\u7528Spark\u6846\u67b6shuffle\u6b21\u6570\u591a\u3002\u8fd9\u662f\u4e00\u4e2a\u539f\u56e0\uff0c\u4f46\u4e0d\u662f\u4e3b\u8981\u7684\u539f\u56e0\uff0c\u56e0\u4e3ashuffle\u6b21\u6570\u4e00\u6837\u591a\u3002\u4e3b\u8981\u539f\u56e0\u8fd8\u662fMapReduce\u6846\u67b6\u7684shuffle\u5fc5\u987b\u82b1\u8d39\u4e0d\u5c11\u7684\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\u64cd\u4f5c\uff0c\u4f46\u662f\u6709\u65f6\u5019\u6392\u5e8f\u64cd\u4f5c\u5e76\u4e0d\u662f\u5fc5\u987b\uff0cSpark\u6846\u67b6\u7684shuffle\u5c31\u662f\u8fd9\u6837\u7684\uff0c\u66f4\u52a0\u7075\u6d3b\u3002</p> </li> <li> <p>DAG\u8ba1\u7b97\u6a21\u578b\uff1a Spark\u6846\u67b6\u6bd4MapReduce\u6846\u67b6\u5feb\u7684\u6839\u672c\u539f\u56e0\u5728\u4e8eDAG\u8ba1\u7b97\u6a21\u578b\u3002\u7f16\u5199\u590d\u6742\u7684map-reduce\u7a0b\u5e8f\uff0c\u5728Spark\u6846\u67b6\u4e2d\u7528\u6237\u53ea\u9700\u8981\u7f16\u5199\u4e00\u4e2aDAG\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e86\uff0c\u800c\u4f7f\u7528MapReduce\u6846\u67b6\u7684\u65f6\u5019\uff0c\u7528\u6237\u53ef\u80fd\u9700\u8981\u5199\u597d\u51e0\u4e2amap-reduce\uff0c\uff08\u56e0\u4e3amap-reduce\u5fc5\u987b\u6210\u5bf9\u51fa\u73b0\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u5199reduce\uff09\uff0c\u7136\u540e\u591a\u4e2amap-reduce\u7a0b\u5e8f\u4ee5\u8fdb\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u524d\u4e00\u4e2a\u8fdb\u7a0breduce\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2a\u8fdb\u7a0b\u7684map\u8f93\u5165\uff0c\u6211\u4eec\u77e5\u9053\u4e00\u4e2aMapReduce\u7a0b\u5e8f\u6700\u540ereduce\u7684\u8f93\u51fa\u662f\u4e00\u5b9a\u4f1a\u843d\u76d8\u7684\uff0c\u6240\u4ee5\u4f1a\u9020\u6210reduce\u5230map\u4e2d\u95f4\u7ed3\u679c\u7684IO\uff0c\u800c\u5728Spark\u7684DAG\u4e2d\uff0creduce\u4e4b\u540e\u7684map\u4e0d\u5fc5shuffle\uff0c\u51cf\u5c11\u4e86\u4e2d\u95f4\u7ed3\u679c\u7684\u843d\u76d8\u3002</p> </li> <li> <p>\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\uff1a MapReduce\u6846\u67b6\u57fa\u4e8e\u8fdb\u7a0b\uff0c\u524d\u4e00\u4e2aMapReduce\u8fdb\u7a0b\u7ed3\u675f\u4e4b\u540e\u518d\u542f\u52a8\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\uff1b\u800cSpark\u662f\u57fa\u4e8e\u7ebf\u7a0b\u7684\uff0ctask\u8fd0\u884c\u5728\u7ebf\u7a0b\u4e0a\uff0c\u4e0d\u540cstage\u7684task\u53ef\u4ee5\u590d\u7528\u7ebf\u7a0b\uff1b\u8fdb\u7a0b\u7684\u521b\u5efa\u548c\u9500\u6bc1\u6bd4\u7ebf\u7a0b\u7684\u521b\u5efa\u548c\u9500\u6bc1\u5f00\u9500\u5927\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#jobstagetasktasktask","title":"job\u3001stage\u548ctask\u7684\u5173\u7cfb\uff1f\u5206\u533a\u548ctask\u7684\u5173\u7cfb\uff1ftask\u548c\u7ebf\u7a0b\u7684\u5173\u7cfb\uff1f","text":"<p>\u67091\u4e2aDriver\u548c\u591a\u4e2aExecutor\uff0cDriver\u8d1f\u8d23\u628a\u7528\u6237\u7a0b\u5e8f\u8f6c\u5316\u4e3a\u4f5c\u4e1a\uff08job\uff09\uff0c\u6839\u636e\u5bbd\u4f9d\u8d56\u5c06job\u5212\u5206\u4e3a\u591a\u4e2a\u9636\u6bb5stage\uff0c\u6bcf\u4e2a\u9636\u6bb5\u6839\u636e\u5206\u533a\u6570\u5c06\u751f\u4ea7\u76f8\u5e94\u7684task\uff0cDriver\u5c06task\u5206\u914d\u7ed9Executor\u6267\u884c\uff0c\u524d\u4e00\u4e2a\u9636\u6bb5\u6240\u6709task\u6267\u884c\u5b8c\u4e86\u4e4b\u540e\u624d\u4f1a\u6267\u884c\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684task\u3002</p> <p>\u6ce8\u610f\uff1a\u540c\u4e00\u4e2a\u9636\u6bb5\u5185\u7684task\u6570\u5e76\u4e0d\u7b49\u4e8eExecutors\u542f\u52a8\u7684\u7ebf\u7a0b\u6570\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u591a\u4e8etask\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u505a\u5230\u4e00\u4e2atask\u4f7f\u7528\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u5982\u679ctask\u6570\u591a\u4e8e\u7ebf\u7a0b\u6570\uff0c\u90a3\u4e48\u540c\u4e00\u4e2a\u9636\u6bb5\u7684task\u5c31\u4f1a\u590d\u7528\u540c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u4e0d\u540c\u9636\u6bb5\u7684task\u80af\u5b9a\u4f1a\u590d\u7528\u7ebf\u7a0b\u3002</p> <p>\u5206\u533a\u6570\u5982\u4f55\u786e\u5b9a\uff1f\u521b\u5efaRDD\u65f6\u53ef\u4ee5\u6307\u5b9a\u5206\u533a\u6570\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u9ed8\u8ba4\u7b49\u4e8e\u5e76\u884c\u5ea6\uff08local\u6a21\u5f0f\u4e0b\uff09\uff1b\u6b64\u5916\uff0cshuffle\u4f1a\u8c03\u6574\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u4e00\u822c\u6709shuffle\u7684\u8f6c\u6362\u7b97\u5b50\u90fd\u53ef\u4ee5\u91cd\u65b0\u6307\u5b9a\u5206\u533a\u6570\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#spark","title":"Spark\u8fd0\u884c\u6a21\u5f0f\u6709\u54ea\u4e9b\uff1f\u5de5\u4f5c\u6d41\u7a0b\u662f\u600e\u4e48\u6837\u7684\uff1f","text":"<p>Spark\u7684\u8fd0\u884c\u6a21\u5f0f\u5305\u62ec<code>Local</code>\u3001<code>Standalone</code>\u3001<code>Yarn</code>\u3001<code>Mesos</code>\u3001<code>k8s</code>\u51e0\u79cd\u3002\u5176\u4e2dLocal\u6a21\u5f0f\u4ec5\u7528\u4e8e\u672c\u5730\u5f00\u53d1\uff1bStandalone\u6a21\u5f0f\u4f7f\u7528\u7684\u662fSpark\u81ea\u5e26\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\uff1bYARN\u662f\u4e00\u6b3e\u66f4\u52a0\u6210\u719f\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\uff0cSpark On Yarn\u6a21\u5f0f\u7528\u7684\u66f4\u591a\u3002</p> <p>\u8d44\u6e90\u8c03\u5ea6\u5668\u90fd\u662fMaster-slaves\u67b6\u6784\uff0c\u53ea\u662f\u5728\u4e0d\u540c\u7684\u8d44\u6e90\u8c03\u5ea6\u5668\u91cc\u7684\u53eb\u6cd5\u4e0d\u540c\u3002Standalone\u6a21\u5f0f\u662fMaster\u548cWorker\uff1bYARN\u662fResourceManager\u548cNodeManager\u3002</p> <p>Spark\u4f5c\u4e1a\u5206\u9636\u6bb5\u6267\u884c\u4e5f\u9700\u8981\u8c03\u5ea6\uff0c\u540c\u6837\u4e5f\u662fMaster-slaves\u67b6\u6784\uff0c\u5177\u4f53\u540d\u79f0\u662fDriver\u548cExecutor\u3002\u8fd9\u5c5e\u4e8eSpark\u8ba1\u7b97\u5f15\u64ce\u5185\u90e8\u7684\u5de5\u4f5c\uff0c\u548c\u8d44\u6e90\u8c03\u5ea6\u5668\u7684\u5de5\u4f5c\u4e0d\u540c\uff0c\u8d44\u6e90\u8c03\u5ea6\u5668\u7684\u5de5\u4f5c\u662f\u7269\u7406\u673a\u8d44\u6e90\u7684\u5206\u914d\uff0cSpark\u4f5c\u4e1a\u5206\u914d\u5f97\u5230\u7269\u7406\u673a\u8d44\u6e90\u4e4b\u540e\u5c31\u53ef\u4ee5\u542f\u52a8Driver\u548cExecutor\u4e86\uff0c\u4e4b\u540e\u7531Driver\u548cExecutor\u914d\u5408\u5b8c\u6210\u4f5c\u4e1a\u3002</p> <p>\u4ee5YARN\u6a21\u5f0f\u4e3a\u4f8b\uff0c\u7a0d\u5fae\u5177\u4f53\u7684\u6d41\u7a0b\u662f\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u5411ResourceManager\u63d0\u4ea4\u4efb\u52a1\uff0c\u5c06\u4efb\u52a1\u52a0\u5165\u5230\u961f\u5217\u4e2d\u3002</li> <li>NodeManager\u9886\u53d6\u4efb\u52a1\uff0c\u542f\u52a8Driver\u5b8c\u6210\u4e00\u7cfb\u5217\u521d\u59cb\u5316\uff0c\u6bd4\u5982\u521d\u59cb\u5316SparkContext\uff0c\u751f\u6210DAG\u3001\u5212\u5206Stage\u7b49\u3002</li> <li>Driver\u5c06\u7b2c\u4e00\u4e2a\u9636\u6bb5\u7684task\u52a0\u5165\u5230\u961f\u5217\u4e2d\uff0c\u4e5f\u5c31\u662f\u5411ResourceManager\u7533\u8bf7\u8d44\u6e90\u6267\u884ctask\u3002</li> <li>NodeManager \u9886\u53d6\u5230\u4efb\u52a1\u4e4b\u540e\u542f\u52a8Executor\uff0cExecutor\u5411Driver\u53cd\u5411\u6ce8\u518c\uff0c\u4e4b\u540eExecutor\u542f\u52a8\u7ebf\u7a0b\u6267\u884ctask\u3002</li> <li>\u7136\u540eDriver\u8c03\u5ea6\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684taskset\u6267\u884c\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#spark_1","title":"Spark\u4e09\u5927\u6570\u636e\u7ed3\u6784\uff1f","text":"<p>RDD\uff08\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6\uff09\u3001\u7d2f\u52a0\u5668\uff08\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf\uff09\u3001\u5e7f\u64ad\u53d8\u91cf\uff08\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u8bfb\u53d8\u91cf\uff09</p> <p>RDD( Resilient Distributed Dataset\uff0c\u5f39\u6027\u5206\u5e03\u5f0f\u6570\u636e\u96c6)\uff0cResilient\u5f39\u6027\u662f\u6307RDD\u5177\u6709\u5bb9\u9519\u7684\u7279\u6027\uff1bDistributed\u5206\u5e03\u5f0f\u662f\u6307\u6570\u636e\u5b58\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff1bDataset\u6570\u636e\u96c6\u662f\u6307\u6570\u636e\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0cRDD\u5e76\u4e0d\u771f\u6b63\u5b58\u50a8\u6570\u636e\u3002\u603b\u7684\u6765\u8bf4RDD\u5b58\u4e86\u4e00\u4e0b\u4fe1\u606f\uff1a</p> <ol> <li> <p>\u5206\u533a\uff1a \u8bb0\u5f55\u6570\u636e\u5206\u533a\u7684\u4fe1\u606f\uff0c\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u4ea4\u7ed9\u4e00\u4e2atask\u5904\u7406\u3002</p> </li> <li> <p>task\uff1a RDD\u6709\u5f88\u591a\u64cd\u4f5c\u7b97\u5b50\uff0c\u4f7f\u7528\u8fd9\u4e9b\u64cd\u4f5c\u7b97\u5b50\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u8ba1\u7b97\uff0c\u4ece\u800c\u8ba9\u4e00\u4e2aRDD\u8f6c\u6362\u6210\u53e6\u5916\u4e00\u4e2aRDD\uff0c\u8fd9\u65f6RDD\u4e4b\u95f4\u5c31\u5177\u6709\u4e86\u4f9d\u8d56\u5173\u7cfb\u3002</p> </li> <li> <p>\u8840\u7f18\u5173\u7cfb\uff1a \u8bb0\u5f55\u4e86\u4e0e\u5176\u4f9d\u8d56\u7684RDD\u7684\u8840\u7f18\u5173\u7cfb\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u8840\u7f18\u5173\u7cfb\u91cd\u65b0\u8ba1\u7b97\u4e22\u5931\u7684\u5206\u533a\u6570\u636e\uff0c\u4f53\u73b0\u4e86RDD\u5bb9\u9519\u7684\u7279\u70b9\u3002</p> </li> </ol> <p>\u7d2f\u52a0\u5668\uff1a \u7d2f\u52a0\u5668\u662f\u5206\u5e03\u5f0f\u5171\u4eab\u53ea\u5199\u53d8\u91cf\uff0cSaprk\u81ea\u5e26\u4e863\u4e2a\u7b80\u5355\u7684\u7d2f\u52a0\u5668\uff1alongAccumulator\u3001doubleAccumulator\u3001collectionAccumulator\u3002\u7d2f\u52a0\u5668\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\uff0cDriver\u628a\u7d2f\u52a0\u5668\u53d1\u9001\u5230\u6bcf\u4e2atask\uff0ctask\u8ba1\u7b97\u5b8c\u6bd5\u540e\u628a\u7d2f\u52a0\u5668\u8fd4\u56de\u5230Driver\u7aef\u805a\u5408\u3002</p> <p>\u5e7f\u64ad\u53d8\u91cf\uff1a \u5904\u4e8e\u540c\u4e00Executor\u7684task\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u53d8\u91cf\uff08\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u5806\u5185\u5b58\u4e0a\u7684\u4e00\u4efd\u526f\u672c\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#spark_2","title":"Spark\u7b97\u5b50\uff1f","text":"<p>\u8f6c\u6362\u7b97\u5b50\uff1a</p> <ul> <li>\u76f8\u5f53\u4e8emap\u64cd\u4f5c\uff1afilter\u3001map\u3001mapPartitions\u3001mapPartitionsWithIndex\u3001flatMap</li> <li>\u6709shuffle\u7684\u64cd\u4f5c\uff1agroupBy\u3001sortBy\u3001repartition\u3001partitionBy\u3001reduceByKey\u3001groupByKey\u3001aggregateByKey</li> </ul> <p>\u884c\u52a8\u7b97\u5b50\uff1areduce\u3001collect\u3001count\u3001aggregate\u3001fold\u3001save\u76f8\u5173\u3001foreach</p> <p>map\u3001mapPartitions\u3001mapPartitionsWithIndex\uff1a</p> <ul> <li> <p>map\u662f\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u4e00\u6761\u4e00\u6761\u7684\u505a\u6620\u5c04\u5904\u7406\uff0c\u5904\u7406\u5b8c\u5c31\u53ef\u4ee5\u91ca\u653e\u6389\u8fd9\u6761\u6570\u636e\u7684\u5185\u5b58\u7a7a\u95f4\u4e86</p> </li> <li> <p>\u800cmapPartitions\u662f\u5c06\u540c\u4e00\u4e2a\u5206\u533a\u5185\u7684\u6240\u6709\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u96c6\u5408\u8fdb\u884c\u5904\u7406\uff0c\u9700\u8981\u7b49\u5f85\u8be5\u5206\u533a\u5185\u6240\u6709\u6570\u636e\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e4b\u540e\u624d\u80fd\u5f00\u59cb\u8ba1\u7b97\uff0c\u641e\u4e0d\u597d\u5c31\u5bb9\u6613OOM</p> </li> <li> <p>mapPartitionsWithIndex\u548cmapPartitions\u4e00\u6837\u662f\u5c06\u540c\u4e00\u4e2a\u5206\u533a\u5185\u7684\u6240\u6709\u6570\u636e\u4f5c\u4e3a\u4e00\u4e2a\u96c6\u5408\u8fdb\u884c\u6620\u5c04\u5904\u7406\uff0c\u4f46\u662fmapPartitionsWithIndex\u4f1a\u7ed9\u6bcf\u4e2a\u5206\u533a\u4e00\u4e2a\u7f16\u53f7</p> </li> </ul> <p>repartition\u3001partitionBy\uff1a</p> <ul> <li> <p>repartition\u53ef\u4ee5\u5bf9\u975ek-v\u7c7b\u578b\u7684RDD\u5408\u5e76\u6216\u8005\u589e\u52a0\u5206\u533a</p> </li> <li> <p>partitionBy\u53ef\u4ee5\u5bf9k-v\u7c7b\u578b\u7684RDD\u6309key\u91cd\u65b0\u5206\u533a\uff0c\u9ed8\u8ba4\u7684\u5206\u533a\u5668\u662f HashPartitioner</p> </li> </ul> <p>groupBy \u4e0e groupByKey\uff1a</p> <ul> <li> <p>groupBy\u5bf9\u975ek-v\u7c7b\u578b\u7684RDD\u8fdb\u884c\u5206\u7ec4\uff0c\u5fc5\u987b\u6307\u5b9a\u5206\u7ec4\u7684\u89c4\u5219</p> </li> <li> <p>groupByKey\u5bf9k-v\u7c7b\u578bRDD\u8fdb\u884c\u5206\u7ec4\uff0c\u9ed8\u8ba4\u5c31\u662f\u6309key\u5206\u7ec4</p> </li> </ul> <p>reduce \u4e0e reduceByKey \u540c\u4e0a\uff0c\u5982\u679c\u80fd\u7528 reduceByKey \u4ee3\u66ff groupByKey+ mapValues\uff0c\u5c31\u5c3d\u91cf\u7528reduceByKey\uff0c\u56e0\u4e3areduceByKey\u4f1a\u5728map\u7aef\u9884\u805a\u5408\u3002</p> <p>reduceByKey \u4e0e aggregateByKey\uff1a reduceBykey\u5728\u5bf9\u5206\u533a\u95f4\u6570\u636e\u8fdb\u884c\u805a\u5408\u4e4b\u524d\u4f1a\u5148\u5bf9\u5206\u533a\u5185\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u9884\u805a\u5408\uff0c\u4e24\u6b21\u805a\u5408\u64cd\u4f5c\u7684\u8ba1\u7b97\u903b\u8f91\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002aggregateByKey\u4e5f\u6709\u5206\u533a\u5185\u548c\u5206\u533a\u95f4\u7684\u4e24\u6b21\u805a\u5408\u64cd\u4f5c\uff0c\u4f46\u4e24\u6b21\u805a\u5408\u7684\u8ba1\u7b97\u903b\u8f91\u53ef\u4ee5\u5206\u522b\u6307\u5b9a\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#rdd","title":"RDD\u7684\u95ed\u5305\uff1f","text":"<p>RDD\u7b97\u5b50\u5185\u7684\u533f\u540d\u51fd\u6570\u4e0d\u4ec5\u4f1a\u95ed\u5305\u53d8\u91cf\uff0c\u8fd8\u8981\u6c42\u88ab\u95ed\u5305\u7684\u53d8\u91cf\u80fd\u88ab\u5e8f\u5217\u5316\uff0c\u56e0\u4e3a\u7b97\u5b50\u4ee5\u5916\u7684\u4ee3\u7801\u90fd\u662f\u5728 Driver \u7aef\u6267\u884c\uff0c\u4f46\u7b97\u5b50\u91cc\u9762\u7684\u4ee3\u7801\u90fd\u662f\u5728 Executor\u7aef\u6267\u884c\u7684\uff0c\u6240\u4ee5\u5982\u679c\u4f7f\u7528\u7684\u7b97\u5b50\u5916\u7684\u6570\u636e\u65e0\u6cd5\u5e8f\u5217\u5316\uff0c\u5c31\u610f\u5473\u7740\u65e0\u6cd5\u4f20\u503c\u7ed9 Executor\u7aef\u6267\u884c\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d1\u751f\u9519\u8bef\uff0cSpark\u9700\u8981\u5728\u6267\u884c\u4efb\u52a1\u8ba1\u7b97\u524d\uff0c\u68c0\u6d4b\u95ed\u5305\u5185\u7684\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u79f0\u4e4b\u4e3a\u95ed\u5305\u68c0\u6d4b\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#_1","title":"\u95ed\u5305\u53d8\u91cf \u4e0e \u5e7f\u64ad\u53d8\u91cf \u7684\u533a\u522b\uff1f","text":"<p>\u95ed\u5305\u7684\u53d8\u91cf\u4f1a\u88ab\u5b8c\u6574\u5730\u53d1\u9001\u5230\u6bcf\u4e2atask\u4e2d\uff0c\u6240\u4ee5\u5f53\u6709\u591a\u4e2atask\u5728\u540c\u4e00Executor\u4e0a\u6267\u884c\u65f6\uff0c\u8be5Executor\u8fdb\u7a0b\u5c31\u4f1a\u6709\u540c\u4e00\u4e2a\u95ed\u5305\u53d8\u91cf\u7684\u591a\u4e2a\u526f\u672c\u3002\u4f7f\u7528\u5e7f\u64ad\u53d8\u91cf\uff0c\u53ef\u4ee5\u8ba9Executor\u53ea\u4fdd\u5b58\u53d8\u91cf\u7684\u4e00\u4e2a\u526f\u672c\uff0c\u8ba9\u5904\u4e8e\u8fd9\u4e2aExecutor\u4e0a\u7684task\u5171\u4eab\u8fd9\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u5e7f\u64ad\u53d8\u91cf\u662f\u53ea\u8bfb\u53d8\u91cf\uff0c\u4e0d\u53ef\u4ee5\u4fee\u6539\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#rdd_1","title":"RDD\u7684\u5bbd\u4f9d\u8d56\u548c\u7a84\u4f9d\u8d56\uff1f","text":"<ul> <li> <p>\u5bbd\u4f9d\u8d56: \u7236RDD\u6bcf\u4e2a\u5206\u533a\u88ab\u591a\u4e2a\u5b50RDD\u5206\u533a\u4f7f\u7528</p> </li> <li> <p>\u7a84\u4f9d\u8d56: \u7236RDD\u6bcf\u4e2a\u5206\u533a\u88ab\u5b50RDD\u7684\u4e00\u4e2a\u5206\u533a\u4f7f\u7528</p> </li> </ul> <p>\u5bbd\u4f9d\u8d56\u4f1a\u4ea7\u751fshuffle\uff0cshuffle\u4f1a\u843d\u76d8\uff0c\u7a84\u4f9d\u8d56\u4e0d\u4f1a\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#spark_3","title":"Spark\u5bb9\u9519\u673a\u5236\uff1f","text":"<p>Spark\u7684\u5bb9\u9519\u4f9d\u8d56 RDD\u7684\u8840\u7f18\u5173\u7cfb \u548c \u6301\u4e45\u5316\u3002\u5f53task\u8ba1\u7b97\u5931\u8d25\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7RDD\u7684\u8840\u7f18\u5173\u7cfb\u627e\u5230\u6700\u8fd1\u4e00\u6b21shuffle\u6216\u8005\u4f7f\u7528\u6301\u4e45\u5316\u7684\u4f4d\u7f6e\u91cd\u65b0\u5f00\u59cb\uff0c\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u4e0a\u51cf\u5c11\u5197\u4f59\u8ba1\u7b97\u5f00\u9500\u3002\u6301\u4e45\u5316\u6709\u4e09\u79cd\u65b9\u5f0f\uff1ashuffle\u843d\u76d8\u3001cache \u548c checkpoint\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#shuffle","title":"shuffle\u4f1a\u843d\u76d8\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u505a\u6301\u4e45\u5316\uff1f","text":"<p>lineage\u8fc7\u957f\u4f1a\u9020\u6210\u5bb9\u9519\u6210\u672c\u8fc7\u9ad8\uff0c\u8fd9\u65f6\u5728\u4e2d\u95f4\u9636\u6bb5\u505a\u68c0\u67e5\u70b9\u5bb9\u9519\uff0c\u4ece\u505a\u68c0\u67e5\u70b9\u7684RDD\u5f00\u59cb\u91cd\u505aLineage\uff0c\u53ef\u4ee5\u51cf\u5c11\u5bb9\u9519\u6210\u672c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#_2","title":"\u6301\u4e45\u5316\uff1f","text":"<p>spark\u4e3b\u52a8\u6301\u4e45\u5316\u6709\u4e24\u79cd\u65b9\u5f0f\uff1acache \u548c checkpoint\u3002</p> <p>cache\u9ed8\u8ba4\u5c06\u6570\u636e\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u7f13\u5b58\u5728\u78c1\u76d8\u4e0a\uff0c\u4f46\u662f\u65e0\u8bba\u54ea\u4e00\u79cd\uff0c\u5728\u8ba1\u7b97\u7ed3\u675f\u65f6\u90fd\u662f\u4f1a\u5220\u9664\u7684\u3002cache\u6709\u4e24\u4e2a\u4f5c\u7528\uff0c\u4e00\u662f\u5f53Application\u6709\u591a\u4e2ajob\uff0c\u4e5f\u5c31\u662f\u6709\u591a\u4e2a\u884c\u52a8\u7b97\u5b50\u65f6\uff0c\u4ee3\u7801\u4e2d\u590d\u7528\u7684\u8f6c\u6362\u7b97\u5b50\u7684\u8ba1\u7b97\u7ed3\u679c\u4e5f\u53ef\u4ee5\u590d\u7528\uff0c\u5982\u679c\u6ca1\u6709\u7528cache\u662f\u4e0d\u80fd\u590d\u7528\u7684\uff0c\u6bcf\u4e2a\u884c\u52a8\u7b97\u5b50\u90fd\u4f1a\u4ece\u5934\u5f00\u59cb\u7b97\u8d77\u3002\u7b2c\u4e8c\u4e2a\u4f5c\u7528\u662f\u53ef\u4ee5\u7528\u4e8e\u5bb9\u9519\uff0c\u505a\u6545\u969c\u6062\u590d\u7528\uff0c\u4e5f\u5c31\u662f\u5f53\u7b97\u5b50\u8ba1\u7b97\u4efb\u52a1\u5931\u8d25\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u8840\u7f18\u5173\u7cfb\u627e\u5230cache\u7f13\u5b58\u7684\u6570\u636e\uff0c\u4e0d\u5fc5\u4ece\u5934\u5f00\u59cb\u91cd\u65b0\u8ba1\u7b97\uff0c\u4e0d\u8fc7\u5f53cache\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u6570\u636e\u4e22\u5931\u4e86\u7684\u8bdd\uff0c\u8fd8\u662f\u4f1a\u901a\u8fc7\u8840\u7f18\u5173\u7cfb\u4ece\u5934\u5f00\u59cb\u8ba1\u7b97\uff08\u4e2d\u95f4\u6709shuffle\u5c31\u662f\u4eceshuffle\u843d\u76d8\u7684\u5730\u65b9\u5f00\u59cb\u7b97\uff09\u3002</p> <p>checkpoint\u4f1a\u6539\u53d8job\u7684\u8840\u7f18\u5173\u7cfb\uff0c\u56e0\u4e3acheckpoint\u662f\u5c06\u6570\u636e\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\uff0c\u5e76\u4e14\u5728\u7a0b\u5e8f\u7ed3\u675f\u7684\u65f6\u5019\u4e5f\u4e0d\u4f1a\u5220\u9664\uff0c\u6240\u4ee5\u5373\u4f7f\u6539\u53d8\u4e86\u8840\u7f18\u4e5f\u4e0d\u7528\u62c5\u5fc3\u540e\u9762\u7684\u8ba1\u7b97\u4e0d\u80fd\u6062\u590d\u3002\u5f53\u6709\u591a\u4e2a\u884c\u52a8\u7b97\u5b50\u65f6\uff0ccheckpoint\u4e0d\u80fd\u590d\u7528\u4e2d\u95f4\u7ed3\u679c\uff0c\u56e0\u4e3a\u5b83\u53ea\u5bf9\u4e00\u4e2ajob\u8d77\u4f5c\u7528\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#cachepersist","title":"cache\u548cpersist\u7684\u5f02\u540c\uff1f","text":"<p>cache()\u65b9\u6cd5\u5176\u5b9e\u8c03\u7528\u7684\u662fpersist()\u65b9\u6cd5\uff0cpersist()\u65b9\u6cd5\u9ed8\u8ba4\u5c06\u6570\u636e\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528persist(StorageLevel.DISK_ONLY)\u5c06\u6570\u636e\u7f13\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u7a0b\u5e8f\u7ed3\u675f\u65f6\u5220\u9664\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#spark_sql","title":"Spark SQL\u7684\u4e24\u79cd\u4ea4\u4e92\u63a5\u53e3","text":"<p>Spark SQL\u7684\u4e24\u79cd\u4ea4\u4e92\u63a5\u53e3\uff1aSQL\u3001DataSet API\u3002DataSet\u6709\u6cdb\u578b\uff0c\u662f\u5f3a\u7c7b\u578b\u7684\uff0c\u5982\u679c\u7c7b\u578b\u662fRow\uff0c\u90a3\u4e48<code>DataSet&lt;Row&gt;</code>\u4e5f\u79f0\u4e3aDataFrame\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spark/#spark_on_hivehive_on_spark","title":"Spark  on Hive\u548cHive on Spark\u7684\u533a\u522b?","text":""},{"location":"%E9%97%AE%E7%AD%94/Spring/","title":"Spring","text":"<p> \u7ea6 5096 \u4e2a\u5b57  3 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 102 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring","title":"Spring\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\uff1f","text":"<p>\u6784\u9020\u5668\u6ce8\u5165\u548csetter\u6ce8\u5165\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring_bean","title":"Spring \u4e2d\u7684 bean \u751f\u547d\u5468\u671f?","text":"<p>Spring Bean\u751f\u547d\u5468\u671f\u7684\u4e3b\u8981\u9636\u6bb5\uff1a</p> <ol> <li>\u5b9e\u4f8b\u5316\uff1aSpring\u5bb9\u5668\u9996\u5148\u6839\u636ebean\u5b9a\u4e49\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u6216\u5de5\u5382\u65b9\u6cd5\u6765\u5b8c\u6210\u3002</li> <li>\u5c5e\u6027\u586b\u5145\uff1a\u4e00\u65e6\u5b9e\u4f8b\u88ab\u521b\u5efa\uff0cSpring\u5c31\u4f1a\u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u5c5e\u6027\u503c\u6ce8\u5165\u5230\u8fd9\u4e2a\u5b9e\u4f8b\u4e2d\u3002\u5982\u679c\u9700\u8981\uff0c\u8fd8\u4f1a\u8c03\u7528setter\u65b9\u6cd5\u8fdb\u884c\u4f9d\u8d56\u6ce8\u5165\u3002</li> <li>Aware\u63a5\u53e3\u56de\u8c03\uff1a\u5982\u679cBean\u5b9e\u73b0\u4e86BeanNameAware, BeanFactoryAware, \u6216 ApplicationContextAware\u7b49\u63a5\u53e3\uff0c\u90a3\u4e48\u76f8\u5e94\u7684setBeanName(), setBeanFactory(), \u6216 setApplicationContext()\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\u3002\u8fd9\u4e9b\u56de\u8c03\u5141\u8bb8Bean\u83b7\u53d6\u81ea\u5df1\u7684\u540d\u79f0\u3001\u6240\u5c5e\u7684BeanFactory\u6216ApplicationContext\u3002</li> <li>\u540e\u7f6e\u5904\u7406\u5668\uff1a\u5982\u679c\u6ce8\u518c\u4e86\u4efb\u4f55BeanPostProcessor\uff0c\u5b83\u4eec\u7684postProcessBeforeInitialization()\u65b9\u6cd5\u5c06\u4f1a\u5728\u6b64\u65f6\u88ab\u8c03\u7528\u3002\u8fd9\u5141\u8bb8\u5bf9Bean\u8fdb\u884c\u4e00\u4e9b\u5b9a\u5236\u5316\u7684\u5904\u7406\uff0c\u6bd4\u5982\u4fee\u6539\u5c5e\u6027\u503c\u6216\u6267\u884c\u4e00\u4e9b\u81ea\u5b9a\u4e49\u903b\u8f91\u3002</li> <li>\u521d\u59cb\u5316\u65b9\u6cd5\uff1a\u5982\u679cBean\u5b9e\u73b0\u4e86InitializingBean\u63a5\u53e3\uff0c\u5219\u5176afterPropertiesSet()\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\u3002\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7@PostConstruct\u6ce8\u89e3\u6216\u8005\u5728XML\u914d\u7f6e\u4e2d\u7684init-method\u5c5e\u6027\u6307\u5b9a\u7684\u65b9\u6cd5\u6765\u5b9a\u4e49\u81ea\u5b9a\u4e49\u7684\u521d\u59cb\u5316\u903b\u8f91\u3002</li> <li>\u540e\u7f6e\u5904\u7406\u5668\uff1a\u5728\u6240\u6709\u4e0a\u8ff0\u521d\u59cb\u5316\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5982\u679c\u6709\u6ce8\u518cBeanPostProcessor\uff0c\u5219\u5b83\u4eec\u7684postProcessAfterInitialization()\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\u3002\u8fd9\u662f\u6700\u540e\u4e00\u6b21\u4fee\u6539Bean\u7684\u673a\u4f1a\u3002</li> <li>\u4f7f\u7528\u9636\u6bb5\uff1a\u6b64\u65f6\uff0cBean\u5df2\u7ecf\u5b8c\u5168\u51c6\u5907\u597d\u5e76\u53ef\u4ee5\u88ab\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u4e86\u3002</li> <li>\u9500\u6bc1\u65b9\u6cd5\uff1a\u5f53\u5bb9\u5668\u5173\u95ed\u65f6\uff0c\u5982\u679cBean\u5b9e\u73b0\u4e86DisposableBean\u63a5\u53e3\uff0c\u5176destroy()\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\u3002\u540c\u6837\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7@PreDestroy\u6ce8\u89e3\u6216XML\u914d\u7f6e\u4e2d\u7684destroy-method\u5c5e\u6027\u6765\u6307\u5b9a\u81ea\u5b9a\u4e49\u7684\u9500\u6bc1\u903b\u8f91\u3002</li> </ol> <p>\u603b\u7ed3\uff1aSpring Bean\u7684\u751f\u547d\u5468\u671f\u4ece\u5b9e\u4f8b\u5316\u5f00\u59cb\uff0c\u7ecf\u8fc7\u5c5e\u6027\u586b\u5145\u3001\u521d\u59cb\u5316\u524d\u3001\u521d\u59cb\u5316\u3001\u521d\u59cb\u5316\u540e\u7684\u6b65\u9aa4\uff0c\u76f4\u5230Bean\u53ef\u4ee5\u88ab\u4f7f\u7528\u4e3a\u6b62\u3002\u5f53Spring\u5e94\u7528\u4e0a\u4e0b\u6587\u5173\u95ed\u65f6\uff0c\u4f1a\u89e6\u53d1Bean\u7684\u9500\u6bc1\u6d41\u7a0b\u3002\u7406\u89e3\u8fd9\u4e9b\u9636\u6bb5\u53ef\u4ee5\u5e2e\u52a9\u4f60\u66f4\u6709\u6548\u5730\u7ba1\u7406\u548c\u4f18\u5316\u4f60\u7684Spring\u5e94\u7528\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5229\u7528\u521d\u59cb\u5316\u548c\u9500\u6bc1\u65b9\u6cd5\u6765\u91ca\u653e\u8d44\u6e90\u3001\u6e05\u7406\u7f13\u5b58\u6216\u8bb0\u5f55\u65e5\u5fd7\u7b49\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring_bean_scope","title":"Spring \u4e2d\u7684 bean \u7684\u4f5c\u7528\u57df\uff08scope\uff09\uff1f","text":"<ul> <li>singleton (\u5355\u4f8b)\uff1a\u5bb9\u5668\u4e2d\u53ea\u4f1a\u5b58\u5728\u4e00\u4e2a\u5171\u4eab\u7684\u5b9e\u4f8b\u3002</li> <li>prototype (\u539f\u578b)\uff1a\u6bcf\u6b21\u5bf9\u8fd9\u4e2aBean\u7684\u8bf7\u6c42\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b\u3002</li> <li>request (\u8bf7\u6c42)\uff1a\u6bcf\u4e00\u6b21 HTTP \u8bf7\u6c42\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b\uff0c\u5e76\u4e14\u8be5 bean \u4ec5\u5728\u5f53\u524d HTTP \u8bf7\u6c42\u5185\u6709\u6548\u3002</li> <li>session (\u4f1a\u8bdd)\uff1a\u5728\u4e00\u4e2aHTTP Session\u4e2d\uff0c\u5bb9\u5668\u4f1a\u8fd4\u56de\u8be5Bean\u7684\u540c\u4e00\u4e2a\u5b9e\u4f8b\u3002</li> <li>application (\u5168\u5c40\u4f1a\u8bdd)\uff1a\u5728ServletContext\u7ea7\u522b\u4e0a\uff0c\u5bb9\u5668\u4f1a\u8fd4\u56de\u8be5Bean\u7684\u540c\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u6574\u4e2aWeb\u5e94\u7528\u5171\u4eab\u4e00\u4e2a\u5b9e\u4f8b\u3002</li> </ul> <p>request/session/application\uff1a\u8fd9\u4e9b\u4f5c\u7528\u57df\u4e3b\u8981\u7528\u4e8eWeb\u5f00\u53d1\u4e2d\uff0c\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u4f5c\u7528\u57df\u6765\u7ba1\u7406Bean\u7684\u751f\u547d\u5468\u671f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring_1","title":"Spring \u600e\u4e48\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u95ee\u9898\uff1f","text":"<p>\u5faa\u73af\u4f9d\u8d56\u6709\u4e09\u79cd\u60c5\u51b5\uff1a</p> <ol> <li>\u6784\u9020\u5668\u6ce8\u5165\u5b58\u5728\u5faa\u73af\u4f9d\u8d56\uff0cSpring\u5c06\u629b\u51faBeanCurrentlylnCreationException\u5f02\u5e38\u3002</li> <li>\u539f\u578b\uff08prototype\uff09\u4f5c\u7528\u57df\u7684Bean\uff0cSpring\u4e5f\u4e0d\u80fd\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u3002</li> <li>\u5355\u4f8b\uff08singleton\uff09\u4f5c\u7528\u57dfBean\u7684\u5c5e\u6027\u6ce8\u5165\uff08setter\u6ce8\u5165\uff09\uff0cSpring\u4f7f\u7528\u4e09\u7ea7\u7f13\u5b58\u6765\u89e3\u51b3\u5faa\u73af\u4f9d\u8d56\u3002</li> </ol> <p>\u4e09\u7ea7\u7f13\u5b58\uff1a</p> <ol> <li>\u7b2c\u4e00\u7ea7\u7f13\u5b58\uff1a\u4fdd\u5b58\u5b8c\u5168\u521d\u59cb\u5316\u597d\u7684Bean\u5b9e\u4f8b\u3002</li> <li>\u7b2c\u4e8c\u7ea7\u7f13\u5b58\uff1a\u4fdd\u5b58\u5df2\u7ecf\u521b\u5efa\u4f46\u8fd8\u672a\u5b8c\u6210\u5c5e\u6027\u586b\u5145\u7684Bean\u5b9e\u4f8b\u3002</li> <li>\u7b2c\u4e09\u7ea7\u7f13\u5b58\uff1a\u4fdd\u5b58\u5de5\u5382\u5bf9\u8c61\uff0c\u7528\u4e8e\u521b\u5efaBean\u5b9e\u4f8b\u3002</li> </ol> <p>\u89e3\u51b3\u6b65\u9aa4\uff1a</p> <ul> <li>\u521b\u5efa\u9636\u6bb5\uff1a\u5f53Spring\u5bb9\u5668\u5f00\u59cb\u521b\u5efa\u4e00\u4e2aBean\u65f6\uff0c\u9996\u5148\u4f1a\u68c0\u67e5\u4e00\u7ea7\u7f13\u5b58\uff08\u5df2\u5b8c\u5168\u521d\u59cb\u5316\u7684Bean\uff09\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u5219\u5c06\u521b\u5efa\u7684\u65b0\u5b9e\u4f8b\u653e\u5165\u4e8c\u7ea7\u7f13\u5b58\u3002</li> <li>\u5c5e\u6027\u586b\u5145\u9636\u6bb5\uff1a\u63a5\u7740Spring\u4f1a\u5c1d\u8bd5\u5bf9\u8fd9\u4e2a\u65b0\u521b\u5efa\u7684Bean\u8fdb\u884c\u5c5e\u6027\u586b\u5145\uff0c\u5982\u679c\u6b64\u65f6\u9700\u8981\u6ce8\u5165\u53e6\u4e00\u4e2aBean\uff0c\u800c\u8be5Bean\u4e5f\u6b63\u5728\u88ab\u521b\u5efa\uff08\u5373\u5b58\u5728\u5faa\u73af\u4f9d\u8d56\uff09\uff0c\u5219\u53ef\u4ee5\u4ece\u4e8c\u7ea7\u7f13\u5b58\u4e2d\u83b7\u53d6\u90e8\u5206\u521d\u59cb\u5316\u7684Bean\u5b9e\u4f8b\u3002</li> <li>\u521d\u59cb\u5316\u540e\u9636\u6bb5\uff1a\u4e00\u65e6\u6240\u6709\u5c5e\u6027\u90fd\u586b\u5145\u5b8c\u6bd5\u4e14\u521d\u59cb\u5316\u5b8c\u6210\u540e\uff0c\u8be5Bean\u4f1a\u88ab\u4ece\u4e8c\u7ea7\u7f13\u5b58\u79fb\u81f3\u4e00\u7ea7\u7f13\u5b58\uff0c\u5e76\u4ece\u4e09\u7ea7\u7f13\u5b58\u4e2d\u79fb\u9664\u5bf9\u5e94\u7684\u5de5\u5382\u5bf9\u8c61\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#aop","title":"AOP\u6709\u54ea\u4e9b\u5b9e\u73b0\u65b9\u5f0f\uff1f","text":"<ul> <li>\u9759\u6001\u4ee3\u7406\uff1a\u7f16\u8bd1\u65f6\u7f16\u7ec7\uff0c\u5728\u7f16\u8bd1\u9636\u6bb5\u751f\u6210 AOP \u4ee3\u7406\u7c7b\uff0c\u5178\u578b\u4ee3\u8868\u662fAspectJ\u3002</li> <li>\u52a8\u6001\u4ee3\u7406\uff1a \u8fd0\u884c\u65f6\u5728\u5185\u5b58\u4e2d\u751f\u6210 AOP \u52a8\u6001\u4ee3\u7406\u7c7b\uff0c\u5178\u578b\u4ee3\u8868\u662fJDK \u52a8\u6001\u4ee3\u7406 \u548c CGLIB\u52a8\u6001\u4ee3\u7406\u3002</li> <li>JDK \u52a8\u6001\u4ee3\u7406\uff1a\u8981\u6c42\u88ab\u4ee3\u7406\u7684\u7c7b\u5fc5\u987b\u5b9e\u73b0\u4e00\u4e2a\u63a5\u53e3\uff0c\u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210\u7684\u4ee3\u7406\u7c7b\u4e5f\u4f1a\u5b9e\u73b0\u76f8\u540c\u7684\u63a5\u53e3\u3002</li> <li>CGLIB\u52a8\u6001\u4ee3\u7406\uff1a\u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210\u88ab\u4ee3\u7406\u7c7b\u7684\u5b50\u7c7b\uff0c\u91cd\u5199\u88ab\u4ee3\u7406\u7c7b\u7684\u65b9\u6cd5\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#jdk_cglib","title":"JDK \u52a8\u6001\u4ee3\u7406\u548cCGLIB\u52a8\u6001\u4ee3\u7406\u7684\u5c40\u9650\uff1f","text":"<p>JDK\u52a8\u6001\u4ee3\u7406\u65e0\u6cd5\u4ee3\u7406\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>JDK\u52a8\u6001\u4ee3\u7406\u53ea\u80fd\u4ee3\u7406\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u90fd\u662fpublic\u7684\uff0c\u6240\u4ee5JDK\u52a8\u6001\u4ee3\u7406\u53ea\u80fd\u4ee3\u7406public\u65b9\u6cd5\u3002</li> <li>\u63a5\u53e3\u4e2d\u4e5f\u53ef\u4ee5\u6709static\u65b9\u6cd5\uff0c\u540c\u6837\u56e0\u4e3astatic\u65b9\u6cd5\u6ca1\u6709\u591a\u6001\uff0c\u6240\u4ee5JDK\u52a8\u6001\u4ee3\u7406\u4e0d\u80fd\u4ee3\u7406static\u65b9\u6cd5\u3002</li> </ul> <p>CGLIB\u52a8\u6001\u4ee3\u7406\u65e0\u6cd5\u4ee3\u7406\u7684\u65b9\u6cd5\uff1a * \u56e0\u4e3afinal\u4fee\u9970\u7684\u7c7b\u548c\u65b9\u6cd5\u4e0d\u80fd\u88ab\u7ee7\u627f\uff0c\u6240\u4ee5CGLIB\u4e0d\u80fd\u4ee3\u7406final\u4fee\u9970\u7684\u7c7b\u548c\u65b9\u6cd5\u3002 * private\u65b9\u6cd5\u53ef\u4ee5\u88ab\u7ee7\u627f\uff0c\u4f46\u662fCGLIB\u4f9d\u7136\u4e0d\u80fd\u4ee3\u7406private\u65b9\u6cd5\uff0c\u539f\u56e0\u662fprivate\u65b9\u6cd5\u6ca1\u6709\u591a\u6001\u3002 * static\u65b9\u6cd5\u6ca1\u6709\u7ee7\u627f\u4e00\u8bf4\uff0c\u4e5f\u5c31\u6ca1\u6709\u591a\u6001\uff0c\u6240\u4ee5CGLIB\u4e0d\u80fd\u4ee3\u7406static\u65b9\u6cd5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring_aop","title":"Spring AOP\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1f","text":"<p>Spring AOP\u4f7f\u7528CGLIB \u548c JDK\u52a8\u6001\u4ee3\u7406\u5b9e\u73b0\u4e86\u4ee3\u7406\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4f7f\u7528JDK\u52a8\u6001\u4ee3\u7406\uff08SpringBoot2.x\u9ed8\u8ba4\u4f7f\u7528cglib\u52a8\u6001\u4ee3\u7406\uff09\u3002<code>&lt;aop:aspectj-autoproxy proxy-target-class=\"false\"/&gt;</code> \u65f6\uff0c\u5982\u679c\u76ee\u6807\u7c7b\u6709\u5b9e\u73b0\u63a5\u53e3\uff0c\u5219\u4f7f\u7528JDK\u52a8\u6001\u4ee3\u7406\uff0c\u53cd\u4e4b\u5219\u4f7f\u7528cglib\u52a8\u6001\u4ee3\u7406\u3002<code>&lt;aop:aspectj-autoproxy proxy-target-class=\"true\"/&gt;</code> \u65f6\uff0c\u76f4\u63a5\u4f7f\u7528cglib\u52a8\u6001\u4ee3\u7406\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring_aop_1","title":"Spring AOP\u6709\u51e0\u79cd\u901a\u77e5\u65b9\u6cd5\uff1f","text":"<p>\u4e94\u79cd\u901a\u77e5\uff1a 1. @Before\uff1a\u524d\u7f6e\u901a\u77e5 2. @AfterReturning\uff1a\u8fd4\u56de\u901a\u77e5 3. @AfterThrowing\uff1a\u5f02\u5e38\u901a\u77e5 4. @After\uff1a\u540e\u7f6e\u901a\u77e5 5. @Around\uff1a\u73af\u7ed5\u901a\u77e5</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#spring_2","title":"Spring \u58f0\u660e\u5f0f\u4e8b\u52a1\u7684\u4f20\u64ad\u65b9\u5f0f\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/Spring/#springmvc","title":"SpringMVC\u62e6\u622a\u5668\uff1f","text":"<p>SpringMVC\u62e6\u622a\u5668\u5728Controller\u65b9\u6cd5\u6267\u884c\u524d\u540e\u6267\u884c\uff0c\u9700\u8981\u5b9e\u73b0HandlerInterceptor\u63a5\u53e3\uff0c\u63d0\u4f9b\u4e09\u4e2a\u65b9\u6cd5\uff1a * preHandle\uff1a\u63a7\u5236\u5668\u65b9\u6cd5\u6267\u884c\u4e4b\u524d\u6267\u884cpreHandle()\uff0c\u5176boolean\u7c7b\u578b\u7684\u8fd4\u56de\u503c\u8868\u793a\u662f\u5426\u62e6\u622a\u6216\u653e\u884c\uff0c\u8fd4\u56detrue\u4e3a\u653e\u884c\uff0c\u5373\u8c03\u7528\u63a7\u5236\u5668\u65b9\u6cd5\uff1b\u8fd4\u56defalse\u8868\u793a\u62e6\u622a\uff0c\u5373\u4e0d\u8c03\u7528\u63a7\u5236\u5668\u65b9\u6cd5\u3002 * postHandle\uff1a\u63a7\u5236\u5668\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u6267\u884cpostHandle()\u3002 * afterComplation\uff1a\u5904\u7406\u5b8c\u89c6\u56fe\u548c\u6a21\u578b\u6570\u636e\uff0c\u6e32\u67d3\u89c6\u56fe\u5b8c\u6bd5\u4e4b\u540e\u6267\u884cafterComplation()\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#springmvc_1","title":"SpringMVC\u5f02\u5e38\u5904\u7406\u5668\uff1f","text":"<p>@ControllerAdvice\u5c06\u4e00\u4e2a\u7c7b\u5b9a\u4e49\u4e3a\u5168\u5c40\u7684\u5f02\u5e38\u5904\u7406\u7c7b\uff0c@ExceptionHandler\u7528\u4e8e\u8bbe\u7f6e\u6240\u6807\u8bc6\u65b9\u6cd5\u5904\u7406\u7684\u5f02\u5e38\uff0c@ExceptionHandler\u8fd8\u53ef\u4ee5\u6807\u6ce8\u5728@Controller\u7c7b\u91cc\u7684\u65b9\u6cd5\u4e0a\uff0c\u8be5\u65b9\u6cd5\u53ea\u4f1a\u89e3\u51b3\u672c\u7c7b\u53d1\u751f\u7684\u5f02\u5e38\uff0c\u5373\u53ea\u8981\u8be5\u7c7b\u7684@RequestMapping\u65b9\u6cd5\u53d1\u751f\u4e86@ExceptionHandler\u65b9\u6cd5\u80fd\u89e3\u51b3\u7684\u5f02\u5e38\uff0c\u90fd\u4f1a\u8df3\u5230\u8fd9\u4e2a\u65b9\u6cd5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#springboot","title":"SpringBoot\u81ea\u52a8\u914d\u7f6e\u539f\u7406\uff1f","text":"<ul> <li>@SpringBootApplication \u662f @SpringBootConfiguration\u3001@EnableAutoConfiguration\u3001@ComponentScan \u8fd9\u4e09\u4e2a\u6ce8\u89e3\u7684\u5408\u6210\u6ce8\u89e3\u3002@ComponentScan\u7684\u9ed8\u8ba4\u626b\u63cf\u8303\u56f4\u662f\u914d\u7f6e\u7c7b\u6240\u5728\u7684\u5305\u53ca\u5176\u6240\u6709\u5b50\u5305\uff0c\u5e76\u4e0d\u4f1a\u626b\u63cf\u5230spring-boot-autoconfigure\u5305\uff0c\u8d77\u5173\u952e\u4f5c\u7528\u7684\u662f@EnableAutoConfiguration\u6ce8\u89e3\u3002</li> <li>@EnableAutoConfiguration\u6ce8\u89e3\u4f1a\u627eMETA-INF/spring.factories\u6587\u4ef6\uff08SpringBoot2.0\u662f\u8fd9\u4e2a\u6587\u4ef6\uff0c3.0\u6362\u6587\u4ef6\u540d\u4e86\uff09\uff0cspring.factories\u6587\u4ef6\u4e2d\u6307\u660e\u4e86\u81ea\u52a8\u914d\u7f6e\u7c7b\u7684\u5168\u7c7b\u540d\u3002</li> <li>spring-boot-starter\u5bfc\u5165\u4e86 spring-boot-autoconfigure\uff0cspring-boot-autoconfigure\u56ca\u62ec\u4e86\u6240\u6709\u5185\u7f6e\u573a\u666f\u5668\u7684\u6240\u6709\u914d\u7f6e\u7c7b\u3002</li> <li>\u6279\u91cf\u52a0\u8f7d\u8fd9\u4e9b\u81ea\u52a8\u914d\u7f6e\u7c7b\u3002\u914d\u7f6e\u7c7b\u6839\u636e\u6761\u4ef6\u6ce8\u89e3\u548cxxxProperties\u5c5e\u6027\u7c7b\u5b8c\u6210\u81ea\u52a8\u914d\u7f6e\u4e86\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#starter","title":"\u81ea\u5b9a\u4e49Starter\u6b65\u9aa4\uff1f","text":"<ol> <li>\u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u7c7b\uff0c\u5e76\u4f7f\u7528@Configuration\u548c\u6761\u4ef6\u6ce8\u89e3\uff08\u5982@ConditionalOnClass\u3001@ConditionalOnMissingBean\u7b49\uff09\u6765\u6307\u5b9a\u4f55\u65f6\u5e94\u7528\u8fd9\u4e9b\u914d\u7f6e\u3002</li> <li>\u5728src/main/resources/META-INF/spring.factories\u6587\u4ef6\u4e2d\u6dfb\u52a0\u76f8\u5e94\u7684\u914d\u7f6e\uff0c\u8ba9Spring Boot\u80fd\u591f\u53d1\u73b0\u4f60\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u3002</li> <li>\u521b\u5efa\u4e24\u4e2a\u6a21\u5757\uff1a\u4e00\u4e2a\u662f\u81ea\u52a8\u914d\u7f6e\u6a21\u5757\uff0c\u53e6\u4e00\u4e2a\u662fstarter\u6a21\u5757\u3002starter\u6a21\u5757\u53ea\u5305\u542bpom.xml\u6587\u4ef6\uff0c\u7528\u4e8e\u5f15\u5165\u81ea\u52a8\u914d\u7f6e\u6a21\u5757\u548c\u5176\u4ed6\u5fc5\u8981\u7684\u4f9d\u8d56\u3002</li> <li>\u5f15\u5165\u81ea\u5b9a\u4e49\u7684Starter\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#springcloud","title":"SpringCloud\u7684\u7ec4\u4ef6\uff1f","text":"<ul> <li>Consul\uff1a\u6ce8\u518c\u4e2d\u5fc3\uff08\u670d\u52a1\u53d1\u73b0\uff09 \u548c \u914d\u7f6e\u4e2d\u5fc3\u3002</li> <li>spring-cloud-loadbalancer\uff1a\u8d1f\u8f7d\u5747\u8861\u3002</li> <li>RestTemplate\uff1a\u670d\u52a1\u8c03\u7528\u3002</li> <li>OpenFeign\uff1a\u670d\u52a1\u8c03\u7528\u3002</li> <li>Gateway\uff1a\u7f51\u5173\u3002</li> <li>Resilience4j\uff1aCircuitBreaker\u65ad\u8def\u5668 \u548c RateLimiter\u9650\u6d41\u5668\u3002</li> <li>Micrometer Tracing + Zipkin\uff1a\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u3002</li> <li>seata\uff1a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#circuitbreaker","title":"CircuitBreaker\u65ad\u8def\u5668\uff1f","text":"<p>CircuitBreaker\u63d0\u4f9b\u4e86\u4e09\u79cd\u4e3b\u8981\u7684\u72b6\u6001\uff1aclosed\u3001open\u3001half_open\uff0c\u548c\u4e24\u79cd\u7279\u6b8a\u7684\u72b6\u6001\uff1aDISABLED \u548c FORCED_OPEN\u3002closed\u662f\u5141\u8bb8\u8bbf\u95ee\u72b6\u6001\uff0copen\u662f\u7981\u6b62\u8bbf\u95ee\u72b6\u6001\uff0chalf_open\u662f\u90e8\u5206\u53ef\u8bbf\u95ee\u72b6\u6001\u3002DISABLED\u662f\u59cb\u7ec8\u5141\u8bb8\u8bbf\u95ee\uff0cFORCED_OPEN\u662f\u59cb\u7ec8\u7981\u6b62\u8bbf\u95ee\u3002</p> <p>CircuitBreaker\u5904\u4e8eCOLSED\uff08\u95ed\u5408\uff09\u72b6\u6001\u5141\u8bb8\u6b63\u5e38\u8bbf\u95ee\uff0c\u5f53\u5931\u8d25\u7387\u6216\u8005\u6162\u8c03\u7528\u7387\u8d85\u8fc7\u8bbe\u5b9a\u7684\u9608\u503c\u65f6\uff0cCircuitBreaker\u4f1a\u8f6c\u6362\u6210OPEN\uff08\u6253\u5f00\uff09\u72b6\u6001\uff0c\u8fd9\u65f6\u4e0d\u5141\u8bb8\u8fdb\u884c\u8bbf\u95ee\uff0c\u7b49\u5f85\u4e00\u5b9a\u7684\u65f6\u95f4\u4e4b\u540eCircuitBreaker\u8f6c\u53d8\u6210HALF_OPEN\uff08\u534a\u5f00\uff09\u72b6\u6001\uff0c\u8fd9\u65f6\u5141\u8bb8\u6307\u5b9a\u6570\u91cf\u7684\u8bf7\u6c42\u6b63\u5e38\u8bbf\u95ee\uff0c\u5982\u679c\u8fd9\u4e9b\u8bf7\u6c42\u7684\u5931\u8d25\u7387\u4ecd\u7136\u8d85\u8fc7\u9608\u503c\uff0c\u90a3\u4e48\u518d\u6b21\u8fdb\u5165OPEN\u72b6\u6001\uff0c\u5426\u5219\u8fdb\u5165CLOSED\u72b6\u6001\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#ratelimiter","title":"RateLimiter\u9650\u6d41\u5668\uff1f","text":"<p>\u5e38\u89c1\u9650\u6d41\u7b97\u6cd5\uff1a 1. \u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\uff1a\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7ed9\u6bcf\u4e00\u4e2a\u65f6\u95f4\u7a97\u53e3\u8bbe\u7f6e\u4e00\u4e2a\u6700\u5927\u8bf7\u6c42\u91cf\uff0c\u5728\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u67d0\u4e2a\u65f6\u523b\u8fbe\u5230\u6700\u5927\u8bf7\u6c42\u91cf\u4e4b\u540e\uff0c\u7a97\u53e3\u5269\u4e0b\u7684\u65f6\u95f4\u4f1a\u76f4\u63a5\u62d2\u7edd\u6216\u963b\u585e\u5230\u6765\u7684\u8bf7\u6c42\uff0c\u6bcf\u4e2a\u7a97\u53e3\u4e4b\u95f4\u6ca1\u6709\u91cd\u53e0\u3002\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7b80\u5355\u7c97\u66b4\uff0c\u4f46\u5728\u4e24\u4e2a\u7a97\u53e3\u7684\u4e34\u754c\u70b9\u5904\u53ef\u80fd\u4f1a\u51fa\u73b0\u6d41\u91cf\u5c16\u5cf0\u7684\u95ee\u9898\uff0c\u6bd4\u59820.9\u79d2\u65f6\u6709100\u4e2a\u8bf7\u6c42\uff0c1.1\u79d2\u65f6\u4e5f\u6709100\u4e2a\u8bf7\u6c42\uff0c\u867d\u7136\u7b2c\u4e00\u79d2\u548c\u7b2c\u4e8c\u79d2\u786e\u5b9e\u90fd\u5728\u5404\u81ea\u7684\u65f6\u95f4\u8303\u56f4\u5185\u9650\u5236\u4e86100\u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u4ece0.5\u79d21.5\u79d2\u8fd9\u4e00\u79d2\u4e4b\u95f4\u5374\u6709200\u4e2a\u8bf7\u6c42\u3002 2. \u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\uff1a\u4e3a\u4e86\u907f\u514d\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u6d41\u91cf\u5c16\u5cf0\u95ee\u9898\uff0c\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u66f4\u52a0\u7cbe\u7ec6\u5730\u5212\u5206\u65f6\u95f4\u7a97\u53e3\uff0c\u6bd4\u5982\u518d\u5c061\u79d2\u5212\u5206\u621010\u4e2a\u683c\u5b50\uff0c\u7136\u540e\u968f\u65f6\u95f4\u7684\u6d41\u901d\uff0c\u7a97\u53e3\u8ddf\u7740\u65f6\u95f4\u6ed1\u52a8\uff0c\u6bcf\u6b21\u90fd\u662f\u8ba1\u7b97\u6700\u8fd110\u4e2a\u683c\u5b50\u7684\u8bf7\u6c42\u91cf\uff0c\u5982\u679c\u524d9\u4e2a\u683c\u5b50\u7684\u8bf7\u6c42\u91cf\u5df2\u7ecf\u8fbe\u5230100\u4e2a\u8bf7\u6c42\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a100\u6beb\u79d2\u4f1a\u76f4\u63a5\u62d2\u7edd\u6216\u963b\u585e\u5230\u6765\u7684\u8bf7\u6c42\uff0c\u6ed1\u52a8\u7a97\u53e3\u7684\u7f3a\u70b9\u662f\uff0c\u5b58\u50a8\u548c\u8ba1\u7b97\u7684\u5f00\u9500\u66f4\u5927\u3002 3. \u6f0f\u6876\u7b97\u6cd5\uff1a\u6f0f\u6876\u7684\u51fa\u6c34\u53e3\u5927\u5c0f\u4e00\u5b9a\uff0c\u4ece\u800c\u4fdd\u8bc1\u8bf7\u6c42\u5904\u7406\u901f\u5ea6\u6c38\u8fdc\u4e0d\u4f1a\u8d85\u8fc7\u8bbe\u5b9a\u7684\u503c\uff0c\u6700\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u4f7f\u7528\u4fe1\u53f7\u91cfSemaphore\u6765\u9650\u5236\u5e76\u53d1\u91cf\u3002 4. \u4ee4\u724c\u6876\u7b97\u6cd5\uff1a\u6709\u4e00\u4e2a\u56fa\u5b9a\u5bb9\u91cf\u7684\u6876\uff0c\u7136\u540e\u4ee5\u7a33\u5b9a\u7684\u901f\u7387\u751f\u6210\u4ee4\u724c\u653e\u5728\u6876\u4e2d\uff0c\u56e0\u4e3a\u6876\u7684\u5bb9\u91cf\u56fa\u5b9a\uff0c\u4ee4\u724c\u6ee1\u4e86\u5c31\u4e0d\u751f\u4ea7\u4e86\u3002\u5f53\u6709\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u83b7\u53d6\u4ee4\u724c\u624d\u80fd\u901a\u8fc7\uff0c\u6876\u4e2d\u6709\u5145\u8db3\u7684\u4ee4\u724c\u65f6\uff0c\u7a81\u53d1\u7684\u6d41\u91cf\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u4ee4\u724c\u901a\u8fc7\uff0c\u5f53\u4ee4\u724c\u53d6\u5149\u540e\uff0c\u540e\u9762\u7684\u8bf7\u6c42\u5c31\u5f97\u7b49\u751f\u6210\u4ee4\u724c\u540e\u624d\u80fd\u901a\u8fc7\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8bf7\u6c42\u901a\u8fc7\u7684\u901f\u7387\u5c31\u53d8\u5f97\u7a33\u5b9a\u4e86\u3002\u4ee4\u724c\u6876\u7684\u4f18\u70b9\u662f\u53ef\u7528\u5904\u7406\u7a81\u53d1\u6d41\u91cf\uff0c\u6240\u4ee5\u88ab\u5e7f\u6cdb\u7684\u5e94\u7528\u4e8e\u5404\u79cd\u9650\u6d41\u5de5\u5177\u4e2d\uff0c\u6bd4\u5982Guava\u7684RateLimiter\u3002</p> <p>Resilience4j\u7684AtomicRateLimiter\u662f\u6eda\u52a8\u65f6\u95f4\u7a97\u53e3\u7b97\u6cd5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#2pc","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1f2PC\uff1f","text":"<p>\u4e24\u9636\u6bb5\u63d0\u4ea4\uff082PC, two-phase commit\uff09\u7b97\u6cd5\u662f\u4e00\u79cd\u5171\u8bc6\u7b97\u6cd5\uff0c\u89e3\u51b3\u4e86\u539f\u5b50\u63d0\u4ea4\u95ee\u9898\u30022PC\u6709\u4e24\u79cd\u89d2\u8272\uff1a\u534f\u8c03\u8005\uff08coordinator\uff09\uff08\u4e5f\u79f0\u4e3a\u4e8b\u52a1\u7ba1\u7406\u5668\uff08transaction manager\uff09\uff09 \u548c \u53c2\u4e0e\u8005\uff08participants\uff09\u3002\u534f\u8c03\u8005\u901a\u5e38\u5728\u8bf7\u6c42\u4e8b\u52a1\u7684\u76f8\u540c\u5e94\u7528\u8fdb\u7a0b\u4e2d\u4ee5\u5e93\u7684\u5f62\u5f0f\u5b9e\u73b0\uff08\u4f8b\u5982\uff0c\u5d4c\u5165\u5728Java EE\u5bb9\u5668\u4e2d\uff09\uff0c\u4f46\u4e5f\u53ef\u4ee5\u662f\u5355\u72ec\u7684\u8fdb\u7a0b\u6216\u670d\u52a1\u3002</p> <p>\u4e24\u9636\u6bb5\u6307\u7684\u662f \u51c6\u5907\u9636\u6bb5 \u548c \u63d0\u4ea4\u9636\u6bb5\uff1a</p> <ol> <li>\u51c6\u5907\u9636\u6bb5\uff1a\u534f\u8c03\u8005\u53d1\u9001\u4e00\u4e2a\u51c6\u5907\uff08prepare\uff09\u8bf7\u6c42\u5230\u6bcf\u4e2a\u53c2\u4e0e\u8005\uff0c\u8be2\u95ee\u5b83\u4eec\u662f\u5426\u80fd\u591f\u63d0\u4ea4\u3002</li> <li>\u63d0\u4ea4\u9636\u6bb5\uff1a</li> <li>\u5982\u679c\u6240\u6709\u53c2\u4e0e\u8005\u90fd\u56de\u7b54\u201c\u662f\u201d\uff0c\u8868\u793a\u5b83\u4eec\u5df2\u7ecf\u51c6\u5907\u597d\u63d0\u4ea4\uff0c\u90a3\u4e48\u534f\u8c03\u8005\u5728\u9636\u6bb5 2 \u53d1\u51fa\u63d0\u4ea4\uff08commit\uff09\u8bf7\u6c42\uff0c\u7136\u540e\u63d0\u4ea4\u771f\u6b63\u53d1\u751f\u3002</li> <li>\u5982\u679c\u4efb\u610f\u4e00\u4e2a\u53c2\u4e0e\u8005\u56de\u590d\u4e86\u201c\u5426\u201d\uff0c\u5219\u534f\u8c03\u8005\u5728\u9636\u6bb52 \u4e2d\u5411\u6240\u6709\u8282\u70b9\u53d1\u9001\u4e2d\u6b62\uff08abort\uff09\u8bf7\u6c42\u3002</li> </ol> <p>\u7406\u89e32PC\u7684\u5173\u952e\u5728\u4e8e\u4e24\u4e2a\u5173\u952e\u7684\u201c\u4e0d\u5f52\u8def\u201d\u70b9\uff0c\u8fd9\u4e24\u4e2a\u627f\u8bfa\u4fdd\u8bc1\u4e862PC\u7684\u539f\u5b50\u6027\uff1a</p> <ul> <li>\u5f53\u53c2\u4e0e\u8005\u6295\u7968\u201c\u662f\u201d\u65f6\uff0c\u5b83\u627f\u8bfa\u5b83\u7a0d\u540e\u80af\u5b9a\u80fd\u591f\u63d0\u4ea4\uff08\u5c3d\u7ba1\u534f\u8c03\u8005\u53ef\u80fd\u4ecd\u7136\u9009\u62e9\u653e\u5f03\uff09\u3002</li> <li>\u4e00\u65e6\u534f\u8c03\u8005\u505a\u51fa\u51b3\u5b9a\uff0c\u8fd9\u4e00\u51b3\u5b9a\u662f\u4e0d\u53ef\u64a4\u9500\u7684\u3002</li> </ul> <p>\u5173\u4e8e\u7b2c2\u70b9\uff1a\u534f\u8c03\u8005\u505a\u51fa\u51b3\u5b9a\u4e4b\u540e\u5fc5\u987b\u628a\u8fd9\u4e2a\u51b3\u5b9a\u5199\u5230\u78c1\u76d8\uff0c\u8fd9\u88ab\u79f0\u4e3a\u63d0\u4ea4\u70b9\uff08commit point\uff09\uff0c\u4e00\u65e6\u534f\u8c03\u8005\u7684\u51b3\u5b9a\u843d\u76d8\uff0c\u5c31\u6ca1\u6709\u56de\u5934\u8def\u4e86\uff0c\u4e00\u5b9a\u8981\u5c06\u63d0\u4ea4\u6216\u56de\u6eda\u7684\u51b3\u5b9a\u53d1\u9001\u7ed9\u6240\u6709\u53c2\u4e0e\u8005\uff0c\u5982\u679c\u8fd9\u4e2a\u8bf7\u6c42\u5931\u8d25\u6216\u8d85\u65f6\uff08\u6bd4\u5982\u53c2\u4e0e\u8005\u5728\u6b64\u671f\u95f4\u5d29\u6e83\uff0c\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\u7b49\uff09\uff0c\u534f\u8c03\u8005\u5fc5\u987b\u6c38\u8fdc\u4fdd\u6301\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\uff08\u53ef\u4ee5\u662f\u6545\u969c\u81ea\u52a8\u6062\u590d\uff0c\u5b9e\u5728\u4e0d\u884c\u5c31\u4eba\u4e3a\u4ecb\u5165\u89e3\u51b3\u95ee\u9898\uff0c\u53cd\u6b63\u6700\u540e\u4e00\u5b9a\u8981\u80fd\u63d0\u4ea4\uff09\u3002\u534f\u8c03\u8005\u628a\u6700\u7ec8\u7684\u51b3\u5b9a\u5199\u5230\u78c1\u76d8\u8fd9\u4e00\u52a8\u4f5c\u548c\u6570\u636e\u5e93\u5e38\u89c4\u7684\u5355\u70b9\u4e8b\u52a1\u63d0\u4ea4\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u5c31\u662f\u8bf42PC\u7684\u63d0\u4ea4\u70b9\u5f52\u7ed3\u4e3a\u534f\u8c03\u8005\u4e0a\u7684\u5e38\u89c4\u5355\u8282\u70b9\u539f\u5b50\u63d0\u4ea4\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#2pc_1","title":"2PC\u5b58\u5728\u7684\u95ee\u9898\uff1f","text":"<p>2pc\u534f\u8bae\u552f\u4e00\u5b58\u5728\u7684\u95ee\u9898\u662f\u534f\u8c03\u8005\u7684\u5355\u70b9\u6545\u969c\u95ee\u9898\uff1a\u5728\u63d0\u4ea4\u9636\u6bb5\uff0c\u4efb\u4f55\u51c6\u5907\u597d\u4e86\u4f46\u672a\u6536\u5230\u534f\u8c03\u8005\u6700\u7ec8\u51b3\u5b9a\u7684\u53c2\u4e0e\u8005\u90fd\u4f1a\u5728\u7591\u8651\u4e2d\u5361\u6b7b\uff0c\u7b49\u5f85\u534f\u8c03\u8005\u6062\u590d\uff0c\u534f\u8c03\u8005\u6062\u590d\u540e\uff0c\u901a\u8fc7\u8bfb\u53d6\u5176\u4e8b\u52a1\u65e5\u5fd7\u6765\u786e\u5b9a\u6240\u6709\u5b58\u7591\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u4efb\u4f55\u5728\u534f\u8c03\u8005\u65e5\u5fd7\u4e2d\u6ca1\u6709\u63d0\u4ea4\u8bb0\u5f55\u7684\u4e8b\u52a1\u90fd\u4f1a\u4e2d\u6b62\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u534f\u8c03\u8005\u5fc5\u987b\u5728\u5411\u53c2\u4e0e\u8005\u53d1\u9001\u63d0\u4ea4\u6216\u4e2d\u6b62\u8bf7\u6c42\u4e4b\u524d\uff0c\u5c06\u5176\u63d0\u4ea4\u6216\u4e2d\u6b62\u51b3\u5b9a\u5199\u5165\u78c1\u76d8\u4e0a\u7684\u4e8b\u52a1\u65e5\u5fd7\u3002</p> <p>\u89e3\u51b3\u534f\u8c03\u8005\u5355\u70b9\u6545\u969c\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u4f7f\u7528Paxos\u3001Raft\u7b49\u534f\u8bae\u5b9e\u73b0\u534f\u8c03\u8005\u7684\u9ad8\u53ef\u7528\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#2pc_2","title":"2PC\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1f","text":"<p>\u5f3a\u4e00\u81f4\u6027\u65b9\u6848\uff1a</p> <ul> <li>XA\uff1aX/Open XA\uff08\u6269\u5c55\u67b6\u6784\uff08eXtended Architecture\uff09\u7684\u7f29\u5199\uff09\u662f\u8de8\u5f02\u6784\u6280\u672f\u5b9e\u73b0\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u6807\u51c6\u3002\u8bb8\u591a\u4f20\u7edf\u5173\u7cfb\u6570\u636e\u5e93\uff08\u5305\u62ecPostgreSQL\uff0cMySQL\uff0cDB2\uff0cSQL Server\u548cOracle\uff09\u548c\u6d88\u606f\u4ee3\u7406\uff08\u5305\u62ecActiveMQ\uff0cHornetQ\uff0cMSMQ\u548cIBM MQ\uff09 \u90fd\u652f\u6301XA\u3002\u7b80\u5355\u7406\u89e3\uff0cXA\u662f\u53c2\u4e0e\u8005\u5b9e\u73b0\u7684\u534f\u8bae\uff0c\u5f02\u6784\u7cfb\u7edf\u53ea\u8981\u5b9e\u73b0\u4e86XA\u534f\u8bae\uff0c\u5c31\u80fd\u88ab\u7ec4\u5408\u5728\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\u3002</li> </ul> <p>\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\uff1a</p> <p>XA\u662f\u5f3a\u4e00\u81f4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u6848\uff0c\u5728\u6ca1\u6709\u6536\u5230\u7b2c\u4e8c\u9636\u6bb5\u7684\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u8bf7\u6c42\u4e4b\u524d\u672c\u5730\u4e8b\u52a1\u4e0d\u4f1a\u7ed3\u675f\uff0c\u5404\u4e2a\u53c2\u4e0e\u8005\u5bf9\u672c\u5730\u8d44\u6e90\u4e00\u76f4\u5360\u6709\uff0c\u4e0d\u4f1a\u91ca\u653e\uff0c\u6027\u80fd\u8f83\u4f4e\uff0c\u4e8e\u662f\u51fa\u73b0\u727a\u7272\u90e8\u5206\u4e00\u81f4\u6027\u6362\u53d6\u66f4\u9ad8\u6027\u80fd\u7684\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\u7684\u5b9e\u73b0\u65b9\u5f0f\u5f88\u6734\u7d20\uff0c\u90a3\u5c31\u662f\u5728\u51c6\u5907\u9636\u6bb5\u76f4\u63a5\u63d0\u4ea4\u672c\u5730\u4e8b\u52a1\uff0c\u540e\u7eed\u7b2c\u4e8c\u9636\u6bb5\u5982\u679c\u9700\u8981\u56de\u6eda\uff0c\u90a3\u5c31\u518d\u4f7f\u7528\u53e6\u5916\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u8fdb\u884c\u8865\u507f\uff0c\u6240\u4ee5\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\u4e5f\u79f0\u4e3a\u8865\u507f\u6027\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u5141\u8bb8\u51fa\u73b0\u4e2d\u95f4\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u7cfb\u7edf\u6700\u7ec8\u8981\u8fbe\u5230\u4e00\u81f4\u72b6\u6001\u3002</p> <p>\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ed3\u679c\u6709\u53ef\u80fd\u901a\u8fc7\u4e8b\u540e\u6267\u884c\u53e6\u4e00\u4e2a\u8865\u507f\u4e8b\u52a1\u6765\u53d6\u6d88\uff0c\u4f46\u4ece\u6570\u636e\u5e93\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u4e8b\u52a1\uff0c\u56e0\u6b64\u4efb\u4f55\u5173\u4e8e\u8de8\u4e8b\u52a1\u6b63\u786e\u6027\u7684\u4fdd\u8bc1\u90fd\u662f\u5e94\u7528\u81ea\u5df1\u7684\u95ee\u9898\u3002XA\u534f\u8bae\u4f9d\u8d56\u6570\u636e\u5e93\u5c42\u7684\u5b9e\u73b0\uff0c\u4f46\u662f\u8865\u507f\u6027\u5206\u5e03\u5f0f\u4e8b\u52a1\u5219\u5b8c\u5168\u4f9d\u8d56\u5e94\u7528\u5c42\u7684\u5b9e\u73b0\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u4e8b\u52a1\u7684\u5178\u578b\u4ee3\u8868\u662fTCC\uff0c\u6b64\u5916\u8fd8\u6709\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\u3001\u6700\u5927\u52aa\u529b\u901a\u77e5\uff1a</p> <ul> <li>TCC\u6a21\u5f0f\uff1aTry-Confirm-Cancel\u3002</li> <li> <p>\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\uff1a\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\u662f\u591a\u4e2a\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7\u6d88\u606f\u961f\u5217\u4f20\u9012\u8fdc\u7a0b\u8c03\u7528\u7684\u6d88\u606f\uff0c\u8fd9\u79cd\u65b9\u6848\u80fd\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u6838\u5fc3\u539f\u7406\u662f\u6d88\u606f\u961f\u5217\u4e3a\u670d\u52a1\u8c03\u7528\u63d0\u4f9b\u4e86\u4e00\u79cd\u53ef\u9760\u7684\u901a\u4fe1\u65b9\u5f0f\uff08\u4fdd\u8bc1\u8fdc\u7a0b\u8c03\u7528\u4e00\u5b9a\u80fd\u4f20\u9012\u5230\uff09\uff0c\u800c\u8fd9\u79cd\u53ef\u9760\u901a\u4fe1\u7684\u5b9e\u73b0\u539f\u7406\u5176\u5b9e\u662f\u6d88\u606f\u961f\u5217\u5229\u7528 2pc \u6216\u8005 ack+\u5e42\u7b49 \u5b8c\u6210\u4e86\u751f\u4ea7\u8005\u548c\u6d88\u606f\u961f\u5217\u4e4b\u95f4 \u4ee5\u53ca \u6d88\u8d39\u8005\u548c\u6d88\u606f\u961f\u5217 \u4e4b\u95f4 \u7684exactly-once\u3002</p> </li> <li> <p>\u6700\u5927\u52aa\u529b\u901a\u77e5\uff1a\u4e8b\u52a1A\u6267\u884c\u5b8c\u4e4b\u540e\u901a\u77e5\u4e8b\u52a1B\u6267\u884c\uff0c\u4e8b\u52a1B\u6700\u597d\u80fd\u6267\u884c\u6210\u529f\uff0c\u5373\u4f7f\u5931\u8d25\u4e86\u4e5f\u4e0d\u8981\u7d27\uff0c\u4e8b\u52a1A\u4e5f\u4e0d\u5fc5\u56de\u6eda\uff08\u4e2a\u4eba\u8ba4\u4e3a\u6700\u5927\u52aa\u529b\u901a\u77e5\u8fd9\u79cd\u65b9\u6848\u5e94\u8be5\u4e0d\u80fd\u7b97\u4f5c\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u6848\uff09\u3002</p> </li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#tcc","title":"TCC\u6a21\u5f0f\u7684\u4e09\u4e2a\u95ee\u9898\uff1f","text":"<p>TCC\u6709\u4e09\u4e2a\u95ee\u9898\uff1a 1. \u7a7a\u56de\u6eda\uff1aTry\u8fd8\u6ca1\u6267\u884c\u5374\u6267\u884c\u4e86Cancel\u3002 2. \u60ac\u6302\uff1aCancel\u90fd\u6267\u884c\u4e86\u5374\u53c8\u6267\u884c\u4e86\u8fdf\u5230\u7684Try\u3002 3. \u5e42\u7b49\uff1aTry\u3001Confirm\u3001Cancel\u4e09\u4e2a\u9636\u6bb5\u90fd\u6709\u53ef\u80fd\u91cd\u590d\u6267\u884c\u3002</p> <p>\u89e3\u51b3\u8fd9\u4e09\u4e2a\u95ee\u9898\u7684\u5171\u540c\u601d\u60f3\u662f\uff0c\u4e09\u4e2a\u65b9\u6cd5\u90fd\u4f5c\u4e3a\u672c\u5730\u4e8b\u52a1\u65b9\u6cd5\uff0c\u5728\u4e8b\u52a1\u5373\u5c06\u7ed3\u675f\u7684\u65f6\u5019\u5411\u6570\u636e\u5e93\u65e5\u5fd7\u8868\u4e2d\u63d2\u5165\u4e00\u6761\u6570\u636e\u8868\u793a\u672c\u65b9\u6cd5\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\uff0c\u5728\u4e8b\u52a1\u5f00\u59cb\u7684\u65f6\u5019\u9996\u5148\u68c0\u67e5\u65b9\u6cd5\u6709\u6ca1\u6709\u6267\u884c\u8fc7\u3002</p> <ol> <li>\u9488\u5bf9\u7a7a\u56de\u6eda\u95ee\u9898\uff1aCancel\u65b9\u6cd5\u5f00\u59cb\u65f6\u68c0\u67e5Try\u65b9\u6cd5\u6709\u6ca1\u6709\u6267\u884c\u8fc7\uff0c\u5982\u679c\u6570\u636e\u5e93\u4e2d\u5b58\u5728\u76f8\u540cXID\u7684Try\u65b9\u6cd5\u65e5\u5fd7\uff0c\u5c31\u8868\u793a\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\uff0c\u6b64\u65f6Cancel\u65b9\u6cd5\u76f4\u63a5\u8fd4\u56de\uff0c\u4ece\u800c\u907f\u514d\u7a7a\u56de\u6eda\u3002</li> <li>\u9488\u5bf9\u60ac\u6302\u95ee\u9898\uff1aTry\u65b9\u6cd5\u5f00\u59cb\u65f6\u68c0\u67e5Cancel\u65b9\u6cd5\u6709\u6ca1\u6709\u6267\u884c\u8fc7\uff0c\u5982\u679c\u5df2\u7ecf\u6267\u884c\u8fc7\u4e86\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u907f\u514dTry\u9501\u5b9a\u7684\u8d44\u6e90\u6c38\u5f97\u4e0d\u5230\u91ca\u653e\uff0c\u4e5f\u5373\u60ac\u6302\u3002</li> <li>\u9488\u5bf9\u5e42\u7b49\u95ee\u9898\uff1aTry\u3001Confirm\u3001Cancel\u4e09\u4e2a\u65b9\u6cd5\u5728\u5f00\u59cb\u65f6\u68c0\u67e5\u81ea\u5df1\u6709\u6ca1\u6709\u6267\u884c\u8fc7\uff0c\u5982\u679c\u6267\u884c\u8fc7\u5c31\u76f4\u63a5\u8fd4\u56de\uff0c\u4ece\u800c\u5b9e\u73b0\u5e42\u7b49\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#seata","title":"Seata\uff1f","text":"<p>Seata\u5bf9\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u533a\u5206\uff1a * \u5168\u5c40\u4e8b\u52a1\uff08Global Transaction\uff09\uff1a\u4e5f\u5c31\u662f\u6574\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 * \u5206\u652f\u4e8b\u52a1\uff08Branch Transaction\uff09\uff1a\u6bcf\u4e00\u4e2a\u53c2\u4e0e\u8005\u7684\u4e8b\u52a1\uff0c\u4e5f\u88ab\u79f0\u4e3a\u672c\u5730\u4e8b\u52a1\u3002</p> <p>Seata\u4e2d\u7684\u89d2\u8272\uff1a</p> <ul> <li>\u4e8b\u52a1\u534f\u8c03\u8005\uff08Transaction Coordinator\uff0cTC\uff09\uff1a\u7ef4\u62a4\u5168\u5c40\u548c\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u9a71\u52a8\u5168\u5c40\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002</li> <li>\u4e8b\u52a1\u7ba1\u7406\u8005\uff08Transaction Manager\uff0cTM\uff09\uff1a\u5b9a\u4e49\u5168\u5c40\u4e8b\u52a1\u7684\u8303\u56f4\uff1a\u5f00\u59cb\u5168\u5c40\u4e8b\u52a1\u3001\u63d0\u4ea4\u6216\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u3002</li> <li>\u8d44\u6e90\u7ba1\u7406\u8005\uff08Resource Manager\uff0cRM\uff09\uff1a\u7ba1\u7406\u5206\u652f\u4e8b\u52a1\u5904\u7406\u7684\u8d44\u6e90\uff0c\u4e0eTC\u4ea4\u8c08\u4ee5\u6ce8\u518c\u5206\u652f\u4e8b\u52a1\u548c\u62a5\u544a\u5206\u652f\u4e8b\u52a1\u7684\u72b6\u6001\uff0c\u5e76\u9a71\u52a8\u5206\u652f\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u3002</li> </ul> <p>Seata\u7ba1\u7406\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6d41\u7a0b\uff1a</p> <ol> <li>TM\u544a\u8bc9TC\u5f00\u542f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0cTC\u751f\u6210\u4e00\u4e2a\u4ee3\u8868\u5168\u5c40\u4e8b\u52a1\u7684XID</li> <li>\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u5f00\u59cb\u8c03\u7528\u5e76\u4f20\u9012XID</li> <li>RM\u6536\u5230XID\u4e4b\u540e\u5411TC\u6ce8\u518c\u672c\u5730\u4e8b\u52a1</li> <li>TM\u544a\u8bc9TC\u53ef\u4ee5\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u5168\u5c40\u4e8b\u52a1\u4e86\uff08\u610f\u601d\u662f\u524d\u9762\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u5df2\u7ecf\u505a\u5b8c\u4e86\uff0c\u73b0\u5728\u544a\u8bc9TC\u53ef\u4ee5\u5f00\u59cb\u4e24\u9636\u6bb5\u63d0\u4ea4\u4e86\u3002@GlobalTransactional\u6ce8\u89e3\u6807\u6ce8\u7684\u65b9\u6cd5\u6b63\u5e38\u7ed3\u675f\u7684\u8bdd\u5c31\u53ef\u4ee5\u544a\u8bc9TC\u53ef\u4ee5\u63d0\u4ea4\u4e86\uff0c\u81f3\u4e8e\u6700\u7ec8\u662f\u5426\u53ef\u4ee5\u63d0\u4ea4\u8fd8\u8981\u770b\u63a5\u4e0b\u6765\u4e24\u9636\u6bb5\u7684\u7ed3\u679c\uff0c\u5982\u679c\u65b9\u6cd5\u53d1\u751f\u5f02\u5e38\uff0c\u90a3\u80af\u5b9a\u662f\u76f4\u63a5\u544a\u8bc9TC\u53ef\u4ee5\u56de\u6eda\u4e86\uff09</li> <li>TC\u9a71\u52a8\u6240\u6709\u5206\u652f\u4e8b\u52a1\u63d0\u4ea4\u6216\u8005\u56de\u6eda\uff08TC\u5148\u8be2\u95ee\u6240\u6709\u53c2\u4e0e\u8005\u662f\u5426\u51c6\u5907\u597d\u4e86\uff0c\u7136\u540e\u518d\u51b3\u5b9a\u63d0\u4ea4\u6216\u8005\u56de\u6eda\uff09</li> </ol> <p>\u603b\u7ed3\u6765\u8bf4\uff0cSeata\u628a2pc\u7684\u534f\u8c03\u8005\u5206\u6210\u4e86\u4e24\u4e2a\u89d2\u8272\uff0cTM\u548cTC\uff0c\u72ec\u7acbTC\u7684\u8fdb\u7a0b\u65b9\u4fbf\u4f7f\u7528Paxos\u7b49\u5171\u8bc6\u7b97\u6cd5\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u63d0\u4ea4\u70b9\u80af\u5b9a\u662f\u6301\u4e45\u5316\u5728TC\u4e2d\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/Spring/#at","title":"AT\u6a21\u5f0f\uff1f","text":"<p>AT\u6a21\u5f0f\u662fSeata\u63d0\u4f9b\u7684\u4e00\u79cd\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\uff0c\u5b83\u4e0eTCC\u6a21\u5f0f\u539f\u7406\u57fa\u672c\u4e0a\u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7TCC\u7684\u8865\u507f\u4e8b\u52a1\u9700\u8981\u7528\u6237\u7f16\u5199\uff0cAT\u6a21\u5f0f\u5219\u662f\u81ea\u52a8\u751f\u6210\u56de\u6edaSQL\uff0c\u4e0d\u8fc7\u81ea\u52a8\u751f\u6210\u4e5f\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff0c\u5e76\u4e0d\u662f\u6240\u6709DML\u8bed\u53e5\u90fd\u53ef\u4ee5\u751f\u6210\u76f8\u5e94\u7684\u56de\u6edaSQL\u3002AT\u6a21\u5f0f\u662fSeata\u4e3b\u63a8\u7684\u65b9\u5f0f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/","title":"Zookeeper","text":"<p> \u7ea6 1736 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 35 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper","title":"zookeeper\u63d0\u4f9b\u4e86\u4ec0\u4e48\u529f\u80fd\uff1f","text":"<ol> <li> <p>\u6570\u636e\u5b58\u50a8</p> </li> <li> <p>\u76d1\u542c\u901a\u77e5</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_1","title":"zookeeper\u6570\u636e\u5b58\u50a8\u7684\u7279\u70b9\uff1f","text":"<ul> <li>ZooKeeper \u7ec4\u7ec7\u6570\u636e\u7684\u7ed3\u6784\u662f\u4e00\u68f5\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u901a\u8fc7\u5176\u8def\u5f84\u552f\u4e00\u6807\u8bc6\u3002</li> <li>\u8282\u70b9\u6700\u5927\u53ea\u80fd\u5b58\u50a8 1MB \u7684\u6570\u636e\u3002</li> <li>ZooKeeper\u6709\u56db\u79cd\u7c7b\u578b\u7684\u8282\u70b9\uff1a\u6301\u4e45\u65e0\u5e8f\u53f7\u3001\u6301\u4e45\u6709\u5e8f\u53f7\u3001\u77ed\u6682\u6709\u5e8f\u53f7\u3001\u77ed\u6682\u65e0\u5e8f\u53f7\u3002</li> <li>\u6301\u4e45\u4e0e\u77ed\u6682\u7684\u610f\u601d\u662f\uff1a \u5ba2\u6237\u7aef\u4e0eZookeeper\u65ad\u5f00\u8fde\u63a5\u540e\uff0c \u8be5\u8282\u70b9\u662f\u5426\u4f9d\u65e7\u5b58\u5728\u3002\u6301\u4e45\u4ee3\u8868\u4f9d\u65e7\u5b58\u5728\uff0c\u77ed\u6682\u8868\u793a\u65ad\u5f00\u8fde\u63a5\u4e4b\u540e\u8282\u70b9\u5c31\u88ab\u5220\u9664\u4e86\u3002</li> <li>\u6709\u5e8f\u53f7\u548c\u65e0\u5e8f\u53f7\u7684\u610f\u601d\u662f\uff1aZookeeper\u662f\u5426\u5728\u7528\u6237\u7ed9\u8282\u70b9\u8d77\u7684\u540d\u5b57\u540e\u9762\u52a0\u4e0a\u9012\u589e\u7684\u987a\u5e8f\u7f16\u53f7\uff0c\u6709\u5e8f\u53f7\u8868\u793a\u52a0\u4e0a\uff0c\u65e0\u5e8f\u53f7\u8868\u793a\u4e0d\u52a0\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_2","title":"\u4f7f\u7528zookeeper\u53ef\u4ee5\u505a\u4ec0\u4e48\uff1f","text":"<p>\u6ce8\u518c\u4e2d\u5fc3\u3001\u914d\u7f6e\u4e2d\u5fc3\u3001\u547d\u540d\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u9501\u3001\u96c6\u7fa4\u7ba1\u7406\uff08HA\u9ad8\u53ef\u7528\uff09</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_3","title":"\u5982\u4f55\u4f7f\u7528zookeeper\u8fdb\u884c\u914d\u7f6e\u7ba1\u7406\uff1f","text":"<p>\u7a0b\u5e8f\u5206\u5e03\u5f0f\u7684\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u5c06\u7a0b\u5e8f\u7684\u914d\u7f6e\u4fe1\u606f\u653e\u5728zk\u7684znode\u4e0b\uff0c\u5f53\u6709\u914d\u7f6e\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u4e5f\u5c31\u662fznode\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u6539\u53d8zk\u4e2d\u67d0\u4e2a\u76ee\u5f55\u8282\u70b9\u7684\u5185\u5bb9\uff0c\u5229\u7528watcher\u901a\u77e5\u7ed9\u5404\u4e2a\u5ba2\u6237\u7aef\uff0c\u4ece\u800c\u66f4\u6539\u914d\u7f6e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_4","title":"\u5982\u4f55\u4f7f\u7528zookeeper\u8fdb\u884c\u96c6\u7fa4\u7ba1\u7406\uff1f","text":"<p>\u96c6\u7fa4\u7ba1\u7406\u65e0\u5728\u4e4e\u4e24\u70b9\uff1a\u673a\u5668\u9000\u51fa\u548c\u52a0\u5165\u3001master\u7684\u9009\u4e3e\u3002</p> <p>\u673a\u5668\u52a0\u5165\u5c31\u662f\u521b\u5efa\u4e34\u65f6\u8282\u70b9\uff0c\u9000\u51fa\u5c31\u662f\u901a\u77e5\u96c6\u7fa4\u4e2d\u76d1\u542c\u8fd9\u4e2a\u4e34\u65f6\u8282\u70b9\u7684\u6240\u6709\u4e3b\u673a\u3002</p> <p>master\u7684\u9009\u4e3e\u5c31\u662f\u9760\u96c6\u7fa4\u4e2d\u7684\u4e3b\u673a\u4e89\u62a2\u521b\u5efa\u4e34\u65f6\u8282\u70b9\uff0c\u8c01\u521b\u5efa\u6210\u529f\u8c01\u5c31\u662fmaster\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_5","title":"zookeeper\u8bfb\u5199\u6570\u636e\u6d41\u7a0b\uff1f","text":"<p>\u5199\uff1a</p> <ol> <li>follower\u6536\u5230\u5199\u8bf7\u6c42\u4f1a\u8f6c\u53d1\u7ed9leader\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u5199\u8bf7\u6c42\u90fd\u4f1a\u4ea4\u7ed9leader\u6765\u5904\u7406</li> <li>leader\u4f1a\u7ed9\u6bcf\u4e2a\u5199\u8bf7\u6c42\u5206\u914d\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u9012\u589e\u7684zxid\uff0c\u7136\u540e\u8bb0\u5f55\u4e0b\u8fd9\u4e2a\u5199\u8bf7\u6c42\u7684\u65e5\u5fd7\uff0c\u4e0d\u63d0\u4ea4</li> <li>leader\u5e7f\u64ad\u8fd9\u4e2a\u5199\u8bf7\u6c42\u7684\u63d0\u6848\uff0c\u5f53\u5f97\u5230\u534a\u6570\u4ee5\u4e0afollower\u7684\u54cd\u5e94\u4e4b\u540e\uff0cleader\u63d0\u4ea4</li> <li>leader\u5411\u5ba2\u6237\u7aef\u54cd\u5e94\u6210\u529f\uff0c\u540c\u65f6\u5411\u6240\u6709follower\u5e7f\u64ad\u63d0\u4ea4\u6d88\u606f</li> </ol> <p>\u8bfb\uff1a\u65e0\u8bba\u8bf7\u6c42\u7684\u662fLeader \u8fd8\u662f Follower\uff0c\u90fd\u5c06\u4f1a\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\uff0cZK\u5e76\u4e0d\u4fdd\u8bc1\u8bfb\u53d6\u7684\u4e3a\u6700\u65b0\u6570\u636e\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u8bfb\u53d6\u5230\u7684\u662f\u65e7\u6570\u636e\u3002</p> <p>\u8bfb\u561b\u65e0\u6240\u8c13\uff0c\u56e0\u4e3a\u8bfb\u4e0d\u4f1a\u7834\u574fzookeeper\u4e2d\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u5c31\u50cfMySQL\u7684\u9694\u79bb\u7ea7\u522b\u4e00\u6837\uff0c\u4f46\u662f\u5199\u4e0d\u4e00\u6837\uff0c\u5199\u6570\u636e\u4f1a\u5bfc\u81f4\u6570\u636e\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u5199\u8bf7\u6c42\u5fc5\u987b\u7ecf\u8fc7leader\uff0c\u5e76\u5fc5\u987b\u4fdd\u8bc1\u534a\u6570\u4ee5\u4e0a\u8282\u70b9\u5199\u6210\u529f\u624d\u80fd\u8fd4\u56de\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zabzookeeper_atomic_broadcast_zk","title":"zab\u534f\u8bae\uff08Zookeeper Atomic Broadcast\uff0c ZK\u539f\u5b50\u5e7f\u64ad\u534f\u8bae\uff09\uff1f","text":"<p>zab\u534f\u8bae\u4e3b\u8981\u5305\u542b\uff1a\u5d29\u6e83\u6062\u590d\u6a21\u5f0f\uff08\u9009\u4e3b\uff09\u548c \u6d88\u606f\u5e7f\u64ad\u6a21\u5f0f\uff08\u540c\u6b65\uff09\u4e24\u4e2a\u8fc7\u7a0b\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_6","title":"zookeeper\u4e2d\u7684\u89d2\u8272\uff1f","text":"<p>leader\u3001follower\u3001observer</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_7","title":"zookeeper\u9009\u4e3e\u673a\u5236\uff1f\u5d29\u6e83\u6062\u590d\u6a21\u5f0f\uff1f","text":"<p>\u9009\u4e3e\u72b6\u6001\uff1a</p> <ul> <li>LOOKING\uff1a\u7ade\u9009\u72b6\u6001</li> <li>FOLLOWING\uff1a\u968f\u4ece\u72b6\u6001\uff0c\u540c\u6b65 leader \u72b6\u6001\uff0c\u53c2\u4e0e\u6295\u7968</li> <li>OBSERVING\uff1a\u89c2\u5bdf\u72b6\u6001\uff0c\u540c\u6b65 leader \u72b6\u6001\uff0c\u4e0d\u53c2\u4e0e\u6295\u7968</li> <li>LEADING\uff1a\u9886\u5bfc\u8005\u72b6\u6001</li> </ul> <p>\u9009\u7968\u5185\u5bb9\uff1a</p> <p>myid\uff1a\u8282\u70b9\u7684id</p> <p>zxid\uff1a\u4e8b\u52a1id\uff0c\u5927\u5c0f\u4e3a8\u4e2a\u5b57\u8282\uff0c\u524d32\u4f4d\u8868\u793aepoch\uff0c\u540e32\u4f4d\u5728\u6bcf\u6b21\u5bf9\u6570\u636e\u505a\u51fa\u4fee\u6539\u65f6\u52a01\u3002</p> <p>\u96c6\u7fa4\u542f\u52a8\u65f6\u5019\u7684\u9009\u4e3e\u6d41\u7a0b\u662f\uff1a</p> <p>\u6bcf\u4e2a\u8282\u70b9\u542f\u52a8\u7684\u65f6\u5019\u90fd\u662fLOOKING\u72b6\u6001\uff0c\u7136\u540e\u6bcf\u4e2a\u8282\u70b9\u90fd\u4e3a\u81ea\u5df1\u6295\u7968\uff08myid, zxid\uff09\uff0c\u7136\u540e\u6240\u6709\u8282\u70b9\u6536\u5230\u5176\u5b83\u8282\u70b9\u7684\u6295\u7968\u540e\u5f00\u59cb\u8fdb\u884c\u6bd4\u8f83\uff0c\u5148\u6bd4\u8f83zxid\uff0czxid\u5927\u7684\u4f18\u5148\u4f5c\u4e3aleader\uff0c\u5f53\u7136\u5728\u96c6\u7fa4\u521a\u542f\u52a8\u65f6zxid\u90fd\u76f8\u540c\uff0czxid\u76f8\u540c\u540e\u518d\u6bd4\u8f83myid\uff0cmyid\u5927\u7684\u4f18\u5148\u4f5c\u4e3aleader\uff0c\u6bcf\u4e2a\u8282\u70b9\u6839\u636e\u8fd9\u4e2a\u6bd4\u8f83\u89c4\u5219\u68c0\u67e5\u4e4b\u540e\u4f1a\u518d\u6b21\u6295\u7968\uff0c\u6700\u540e\u5f53\u96c6\u7fa4\u4e2d\u67d0\u4e2a\u8282\u70b9\u83b7\u5f97\u7684\u9009\u7968\u8fc7\u534a\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8282\u70b9\u5c31\u6210\u4e3aleader\uff0c\u72b6\u6001\u53d8\u4e3aLEADING\uff0c\u7136\u540e\u5411\u96c6\u7fa4\u5e7f\u64ad\u6d88\u606f\uff0c\u5176\u5b83\u8282\u70b9\u7684\u72b6\u6001\u5c31\u8f6c\u53d8\u6210\u4e86FOLLOWING\u3002\u6bcf\u6b21\u9009\u4e3e\u51fa\u65b0\u7684leader\u4e4b\u540e\uff0czxid\u7684\u524d32\u4f4d\u4f1a\u52a01\uff0c\u540e32\u4f4d\u4f1a\u6e05\u96f6\uff0czxid\u7684\u524d32\u4f4d\u5c31\u662f\u6240\u8c13\u7684epoch\u3002</p> <p>\u5d29\u6e83\u6062\u590d\u6a21\u5f0f\uff1a</p> <p>\u5728\u96c6\u7fa4\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5982\u679cleader\u6302\u4e86\uff0c\u90a3\u4e48\u4e5f\u4f1a\u8fdb\u5165leader\u9009\u4e3e\uff0c\u5176\u6d41\u7a0b\u4e0e\u96c6\u7fa4\u542f\u52a8\u65f6\u5019\u7684\u9009\u4e3e\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u65f6\u5019\u6bcf\u4e2a\u8282\u70b9\u7684zxid\u53ef\u80fd\u4f1a\u4e0d\u4e00\u6837\uff0c\u6839\u636e\u6bd4\u8f83\u89c4\u5219\uff0c\u4f1a\u628azxid\u5927\u7684\u9009\u4e3aleader\uff0c\u8fd9\u53ef\u4ee5\u4fdd\u8bc1\u6301\u6709\u6700\u65b0\u6570\u636e\u7684\u8282\u70b9\u4f5c\u4e3aleader\u3002\u6bcf\u6b21\u9009\u4e3e\u51fa\u65b0\u7684leader\u4e4b\u540e\uff0czxid\u7684\u524d32\u4f4d\u4f1a\u52a01\uff0c\u540e32\u4f4d\u4f1a\u6e05\u96f6\uff0czxid\u7684\u524d32\u4f4d\u5c31\u662f\u6240\u8c13\u7684epoch\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zxidleader","title":"\u4e3a\u4ec0\u4e48\u9009zxid\u5927\u7684\u53ef\u4ee5\u4fdd\u8bc1leader\u6301\u6709\u6700\u65b0\u66f4\u65b0\u7684\u6570\u636e\uff1f","text":"<p>\uff08\u9996\u5148\u5199\u8bf7\u6c42\u53ea\u8981\u534a\u6570follower\u54cd\u5e94\u5c31\u4f1a\u8fd4\u56de\u6210\u529f\uff0c\u6240\u4ee5\u96c6\u7fa4\u4e2d\u5b58\u5728\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002\uff09\u53c8\u56e0\u4e3a\u6240\u6709\u5199\u8bf7\u6c42\u90fd\u4f1a\u4ea4\u7ed9\u96c6\u7fa4\u7684leader\uff0cleader\u4f1a\u7ed9\u6bcf\u4e2a\u5199\u8bf7\u6c42\u5206\u914d\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u9012\u589e\u7684zxid\uff0c\u6240\u4ee5\u6301\u6709\u6301\u6709\u6700\u5927zxid\u7684follower\u62e5\u6709\u6700\u65b0\u7684\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#_1","title":"\u6d88\u606f\u5e7f\u64ad\u6a21\u5f0f\uff1f","text":"<p>\u6d88\u606f\u5e7f\u64ad\u6a21\u5f0f\u5c31\u662f\u5904\u7406\u5199\u8bf7\u6c42\u7684\u8fc7\u7a0b\uff0c\u6240\u6709\u7684\u5199\u8bf7\u6c42\u90fd\u662f\u7531leader\u6765\u5904\u7406\u7684\uff0c\u5176\u5b83follower\u63a5\u6536\u5230\u7684\u5199\u8bf7\u6c42\u4e5f\u90fd\u4f1a\u8f6c\u53d1\u5230leader\u4e0a\uff0cleader\u4f1a\u7ed9\u6bcf\u4e2a\u5199\u8bf7\u6c42\u5206\u914d\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u9012\u589e\u7684zxid\uff0c\u7136\u540e\u8bb0\u5f55\u4e0b\u8fd9\u4e2a\u5199\u8bf7\u6c42\u7684\u65e5\u5fd7\uff0c\u4e0d\u63d0\u4ea4\uff0c\u7136\u540e\u5e7f\u64ad\u8fd9\u4e2a\u5199\u8bf7\u6c42\u7684\u63d0\u6848\uff0c\u5f53\u5f97\u5230\u534a\u6570\u4ee5\u4e0afollower\u7684\u54cd\u5e94\u4e4b\u540e\uff0cleader\u63d0\u4ea4\uff0c\u7136\u540e\u5411\u5ba2\u6237\u7aef\u54cd\u5e94\u6210\u529f\uff0c\u540c\u65f6\u5411\u6240\u6709follower\u5e7f\u64ad\u63d0\u4ea4\u6d88\u606f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zookeeper_8","title":"zookeeper\u8111\u88c2\u95ee\u9898\uff1f","text":"<p>\u7f51\u7edc\u5206\u533a\u4f1a\u5bfc\u81f4\u51fa\u73b0\u4e24\u79cd\u60c5\u51b5\uff1a</p> <p>\u4e00\u662fleader\u5728\u7f51\u7edc\u5206\u533a\u4e4b\u540e\u5904\u4e8e\u591a\u6570\u6d3e\uff0c\u8fd9\u4e2a\u65f6\u5019\u5176\u5b83\u7f51\u7edc\u5206\u533a\u56e0\u4e3a\u4e3b\u673a\u6570\u5c11\u4e8e\u534a\u6570\uff0c\u6240\u4ee5\u662f\u4e00\u5b9a\u9009\u4e0d\u51faleader\u7684\uff0c\u4e8e\u662f\u7f51\u7edc\u5206\u533a\u6062\u590d\u4e4b\u540e\uff0c\u96c6\u7fa4\u4e2d\u4e5f\u4f1a\u53ea\u6709\u4e00\u4e2aleader\uff0c\u4e0d\u5b58\u5728\u8111\u88c2\u95ee\u9898\uff0c\u5c11\u6570\u6d3e\u5728\u7f51\u7edc\u5206\u533a\u6062\u590d\u4e4b\u540e\u9700\u8981\u540c\u6b65leader\u7684\u6570\u636e\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u5c31\u662f\u7f51\u7edc\u5206\u533a\u4e4b\u540eleader\u5728\u5c11\u6570\u6d3e\u4e2d\uff0c\u8fd9\u4e2a\u65f6\u5019\u5269\u4e0b\u7684follower\u56e0\u4e3a\u6570\u91cf\u8fc7\u534a\uff0c\u6240\u4ee5\u53ef\u4ee5\u9009\u51fa\u4e00\u4e2aleader\uff0c\u4e8e\u662f\u6574\u4e2a\u96c6\u7fa4\u5c31\u4f1a\u51fa\u73b0\u4e24\u4e2aleader\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u8111\u88c2\u95ee\u9898\uff0c\u4f46\u662f\u4e0d\u7528\u62c5\u5fc3\uff0c\u4e00\u662f\u539f\u5148leader\u6240\u5728\u7f51\u7edc\u5206\u533a\u65e0\u6cd5\u63d0\u4ea4\u6570\u636e\uff0c\u56e0\u4e3a\u5199\u8bf7\u6c42\u4ea4\u7ed9leader\u4e4b\u540e\uff0cleader\u65e0\u6cd5\u5c06\u6570\u636e\u5199\u5230\u8fc7\u534a\u7684\u4e3b\u673a\u4e0a\uff0c\u6240\u4ee5\u4f1a\u4e00\u76f4\u5904\u4e8e\u672a\u63d0\u4ea4\u7684\u72b6\u6001\uff0c\u4e8c\u662f\u9009\u51fa\u6765\u7684\u65b0leader\u7684epoch\u4f1a\u52a01\uff0c\u4e5f\u5c31\u662fzxid\u7684\u524d32\u4f4d\u4f1a\u52a01\uff0c\u540e32\u4f4d\u4f1a\u6e05\u96f6\uff0c\u7136\u540e\u5f53\u7f51\u7edc\u5206\u533a\u6062\u590d\u6b63\u5e38\u4e4b\u540e\uff0c\u539fleader\u4f1a\u53d1\u73b0\u73b0\u5728\u96c6\u7fa4\u4e2d\u6700\u5927epoch\u6bd4\u81ea\u5df1\u8981\u5927\uff0c\u4e8e\u662f\u5b83\u4f1a\u53d8\u4e3afollower\uff0c\u7136\u540e\u56de\u6eda\u4e4b\u524d\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u5e76\u4e14\u540c\u6b65\u65b0leader\u7684\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/Zookeeper/#zab","title":"\u9664\u4e86ZAB\uff0c\u8fd8\u77e5\u9053\u54ea\u4e9b\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u534f\u8bae\uff1f","text":"<p>paxos\uff08\u9f3b\u7956\uff09\u3001multi-paxos\u3001raft</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/","title":"\u5927\u6570\u636e\u9762\u8bd5\u9898","text":"<p> \u7ea6 2710 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 54 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#topk","title":"\u6d77\u91cf\u6570\u636e\u627eTopk\u7684\u95ee\u9898\uff1f","text":"<p>\u6d77\u91cf\u6570\u636e\u627eTopk\u5927\u81f4\u6709\u4e24\u7c7b\u95ee\u9898\uff0c\u4e00\u79cd\u5c31\u662f\u5355\u7eaf\u7684\u627e\u6700\u5927\u7684K\u4e2a\u6570\uff0c\u53e6\u5916\u4e00\u79cd\u662f\u627e\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684K\u4e2a\u6570\uff08\u7ecf\u5178\u7684WordCount\uff09\u3002\u8fd9\u4e24\u79cd\u60c5\u51b5\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff0c\u5355\u7eaf\u7684\u627eTopK\u53ef\u4ee5\u5148\u627e\u6bcf\u4e2a\u5206\u5757\u7684TopK\uff0c\u7136\u540e\u6700\u540e\u627e\u4e00\u4e2a\u603b\u7684TopK\uff1b\u4f46\u662f\u627e\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684TopK\u5374\u4e0d\u884c\uff0c\u5fc5\u987b\u8981\u6700\u540e\u628a\u6240\u6709\u5206\u5757\u7684\u8ba1\u7b97\u7ed3\u679c\u5408\u5e76\u4e4b\u540e\u518d\u627eTopK\uff0c\u4ee5\u4e0b\u5206\u522b\u5bf9\u8fd9\u4e24\u4e2a\u95ee\u9898\u8fdb\u884c\u8ba8\u8bba\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#10k","title":"10\u4ebf\u4e2a\u6570\uff0c\u627e\u6700\u5927\u7684K\u4e2a\u6570\uff1f","text":"<p>10\u4ebf=10^9\uff0c\u5927\u6982\u7b49\u4e8e2^30\uff0c\u663e\u7136int\u7c7b\u578b\u7684\u53d6\u503c\u8303\u56f4\u80af\u5b9a\u662f\u8d85\u8fc710\u4ebf\u7684\uff0c\u5982\u679c\u6570\u7684\u7c7b\u578b\u662fint\uff0c\u90a3\u4e4810\u4ebf\u4e2aint\u5927\u6982\u9700\u89814GB\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u5355\u673a</p> <p>\u5982\u679c\u5355\u673a\u5185\u5b58\u88c5\u5f97\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u76f4\u63a5\u5c06\u6570\u636e\u5168\u90e8\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u5355\u7ebf\u7a0b\u4e0b\u9664\u4e86\u5168\u6392\u5e8f\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528\u53e6\u5916\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ol> <li>\u4f7f\u7528\u5feb\u901f\u6392\u5e8f\u8fdb\u884c\u5212\u5206\u7684\u65b9\u6cd5\u627e\u5230\u7b2ck\u5927\u7684\u6570\u5373\u53ef\u3002</li> <li>\u7ef4\u62a4\u4e00\u4e2aK\u4e2a\u5143\u7d20\u7684\u5c0f\u6839\u5806\uff0c\u7136\u540e\u904d\u5386\u5269\u4e0b\u7684\u5143\u7d20\uff0c\u5982\u679c\u5143\u7d20\u5927\u4e8e\u5806\u9876\u5143\u7d20\u5219\u5c06\u5806\u9876\u5143\u7d20\u66ff\u6362\u6210\u8be5\u5143\u7d20\uff0c\u7136\u540e\u518d\u8c03\u6574\u5806\uff0c\u8fd9\u6837\u6700\u540e\u904d\u5386\u5b8c\u6240\u6709\u5143\u7d20\u4e4b\u540e\u7684\u5806\u5c31\u662f\u6700\u5927\u7684k\u4e2a\u6570\u3002</li> </ol> <p>\u5982\u679c\u4f7f\u7528\u591a\u7ebf\u7a0b\uff0c\u5047\u8bbe\u6709n\u4e2a\u7ebf\u7a0b\uff0c\u90a3\u4e48\u601d\u8def\u5c31\u662f\u5c06\u6570\u636e\u5206\u6210n\u4efd\uff0c\u7136\u540e\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f7f\u7528\u4e0a\u8ff0\u65b9\u6cd5\u627e\u5230TopK\uff0c\u6700\u540e\u7531\u4e3b\u7ebf\u7a0b\u4ece\u6240\u6709\u7684TopK\u4e2d\u627e\u5230\u6700\u540e\u7684TopK\u3002</p> <p>\u5982\u679c\u5355\u673a\u5185\u5b58\u88c5\u4e0d\u4e0b\uff0c\u4e0a\u8ff0\u65b9\u6cd5\u4f9d\u7136\u4f7f\u7528\uff0c\u53ea\u4e0d\u8fc7\u9700\u8981\u5c06\u6570\u636e\u5206\u6279\u8bfb\u8fdb\u5185\u5b58\uff0c\u7136\u540e\u4f7f\u7528\u4e0a\u8ff0\u65b9\u6cd5\u627eTopK\uff0c\u6700\u540e\u518d\u4ece\u6240\u6709\u7684TopK\u4e2d\u627e\u5230\u6700\u540e\u7684TopK\u3002</p> <p>\u591a\u673a</p> <p>\u591a\u7ea7\u548c\u4e0a\u8ff0\u591a\u7ebf\u7a0b\u627eTopK\u7684\u601d\u60f3\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u6570\u636e\u5728\u591a\u53f0\u4e3b\u673a\u7684\u4e0d\u540c\u7ebf\u7a0b\u4e0a\u5904\u7406\u800c\u5df2\u3002\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\u6765\u7f16\u7a0b\u7a0b\u5e8f\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u81ea\u5df1\u4ece\u5934\u5b9e\u73b0\u591a\u673a\u5206\u5e03\u5f0f\u8ba1\u7b97\u534f\u8c03\u5904\u7406\u7684\u4ee3\u7801\uff0c\u53ea\u8981\u5173\u6ce8\u4e3b\u8981\u7684\u8ba1\u7b97\u903b\u8f91\u5373\u53ef\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#4g100","title":"4G\u5b57\u7b26\u4e32\u627e\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684100\u4e2a\uff1f","text":"<p>\u9996\u5148\u662fWordCount\u90e8\u5206\uff0c\u5373\u8ba1\u7b97\u6bcf\u4e2a\u5b57\u7b26\u4e32\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u8fd9\u91cc\u540c\u6837\u4e5f\u53ef\u4ee5\u5206\u5355\u673a\u591a\u7ebf\u7a0b\u6216\u8005\u591a\u673a\u7684\u5206\u5e03\u5f0f\u8ba1\u7b97\u4e24\u79cd\u5f62\u5f0f\u6765\u8ba8\u8bba\u3002</p> <p>\u5355\u673a\u5355\u7ebf\u7a0b\u5c31\u662f\u628a\u5355\u673a\u591a\u7ebf\u7a0b\u7684\u5904\u7406\u6b65\u9aa4\u5206\u6b65\u8fdb\u884c\u5b8c\u6210\uff0c\u6240\u4ee5\u5c31\u4e0d\u518d\u8fc7\u591a\u8fdb\u884c\u9610\u8ff0\u4e86\uff0c\u8fd9\u91cc\u76f4\u63a5\u8ba8\u8bba\u5355\u673a\u591a\u7ebf\u7a0b\u5e76\u4e14\u5185\u5b58\u53ea\u6709512M\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\u7684\u5904\u7406\u6d41\u7a0b\uff1a</p> <p>\u76f4\u63a5\u8bfb\u5165512M\u6570\u636e\u5230\u5185\u5b58\uff0c\u7136\u540e\u6bcf\u4e2a\u7ebf\u7a0b\u5e73\u5206\u5904\u7406\u8fd9\u4e9b\u6570\u636e\uff0c\u5904\u7406\u7684\u6d41\u7a0b\u5c31\u662f\u904d\u5386\u52a0\u5165\u5230\u5404\u81ea\u7684HashMap\u4e2d\uff0c\u6700\u540e\u7531\u4e3b\u7ebf\u7a0b\u5c06\u6240\u6709\u7684HashMap\u5408\u5e76\u3002\u7136\u540e\u518d\u8bfb\u53d6\u4e0b\u4e00\u4e2a512M\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u6700\u540e\u628a\u6240\u6709\u7684HashMap\u5408\u5e76\uff0c\u7136\u540e\u4f7f\u7528\u4e0a\u4e00\u4e2a\u627eTopK\u7684\u65b9\u6cd5\u6765\u627e\u51fa\u73b0\u6b21\u6570\u6700\u591a\u7684K\u4e2a\u6570\u5373\u53ef\u3002</p> <p>\u4e0a\u8ff0\u65b9\u6cd5\u6709\u4e2a\u53ef\u80fd\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u7b97\u6700\u7ec8\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u5185\u5b58\u53ef\u4ee5\u653e\u4e0d\u4e0b\u6240\u6709HashMap\uff0c\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u7684\u539f\u56e0\u5c31\u662f\u6bcf\u6b21\u7684512M\u5206\u5757\u5b57\u7b26\u4e32\u7684\u91cd\u590d\u7387\u592a\u4f4e\u7684\uff0c\u5bfc\u81f4\u5f97\u5230HashMap\u592a\u5927\u4e86\u3002\u89e3\u51b3\u7684\u65b9\u6cd5\u5c31\u662f\u53ef\u4ee5\u5148\u5c06HashMap\u4fdd\u5b58\u4fdd\u5b58\u5230\u5916\u5b58\u4e2d\uff0c\u4e0d\u8fc7\u5728\u4fdd\u5b58\u65f6\u518d\u4f7f\u7528Hash\u5206\u6876\u7684\u601d\u60f3\uff0c\u628akey\u5206\u6563\u5728\u4e0d\u540c\u7684\u6876\u91cc\uff08\u6876\u53ef\u4ee5\u662f\u6587\u4ef6\u5939\uff0c\u6216\u8005\u662f\u6587\u4ef6\u3002\u5982\u679c\u662f\u6587\u4ef6\u5939\uff0c\u90a3\u4e48\u6bcf\u6b21\u4fdd\u5b58\u90fd\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u5982\u679c\u662f\u6587\u4ef6\uff0c\u90a3\u4e48\u6bcf\u6b21\u4fdd\u5b58\u90fd\u8ffd\u52a0\u5199\u5230\u4e0a\u4e00\u6b21\u4fdd\u5b58\u7684\u6587\u4ef6\u4e2d\uff09\uff0c\u6700\u540e\u5408\u5e76\u7684\u65f6\u5019\uff0c\u5148\u8bfb\u53d6\u4e00\u4e2a\u6876\u7684\u6570\u636e\u8fdb\u884c\u5408\u5e76\uff0c\u7136\u540e\u5c06\u6240\u6709\u6876\u7684\u6570\u636e\u8fdb\u884c\u5408\u5e76\u3002</p> <p>\u591a\u673a\u5206\u5e03\u5f0f\u8ba1\u7b97\u601d\u60f3\u548c\u5355\u673a\u591a\u7ebf\u7a0b\u5dee\u4e0d\u591a\uff0c\u8fd9\u91cc\u540c\u6837\u53ef\u4ee5\u501f\u52a9\u4e8e\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\u6765\u5b8c\u6210\uff0c\u4e3b\u8981\u5c31\u662fMapReduce\u7684\u601d\u60f3\uff0cMap\u7aef\u5148\u5904\u7406\u6570\u636e\uff0c\u7136\u540eHash\u5206\u6876\u53d1\u9001\u4e0d\u540c\u7684reduce\u8fdb\u884c\u805a\u5408\uff0c\u6bcf\u4e2aReduce\u8f93\u51faTopK\uff0c\u6700\u540e\u518d\u805a\u5408\u4e00\u6b21\uff0c\u4e5f\u5c31\u662f\u627e\u6700\u540e\u7684TopK\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#prestosparksql","title":"\u7b80\u5355\u8bf4\u4e00\u4e0bPresto\u548cSparkSQL\u7684\u533a\u522b\uff1f","text":"<p>Presto\u548cSparkSQL\u90fd\u662f\u57fa\u4e8e\u5185\u5b58\u7684\u5206\u5e03\u5f0f\u8ba1\u7b97\u5f15\u64ce\uff0c\u7b80\u5355\u7406\u89e3\u5b83\u4fe9\u7684\u533a\u522b\u5c31\u662f\uff0cPresto\u7684\u67b6\u6784\u5f88\u76f4\u63a5\uff0c\u5b83\u662f\u4e13\u95e8\u4e3a\u5927\u6570\u636e\u573a\u666fSQL\u67e5\u8be2\u5b9a\u5236\u7684\u5206\u5e03\u5f0fSQL\u67e5\u8be2\u5f15\u64ce\uff0c\u800cSparkSQL\u662f\u6784\u5efa\u5728SparkCore\u4e0a\u7684\uff0cSparkCore\u662f\u4e00\u4e2a\u53ef\u4ee5\u5904\u7406\u7ed3\u6784\u5316\u548c\u534a\u7ed3\u6784\u5316\u6570\u636e\u7684\u8ba1\u7b97\u5f15\u64ce\uff0c\u901a\u7528\u6027\u66f4\u5f3a\uff0cSparkSQL\u901a\u8fc7\u5c06SQL\u7ffb\u8bd1\u6210SparkCore\u7684RDD\u7b97\u5b50\u6765\u6267\u884c\uff0c\u6240\u4ee5\u901a\u5e38\u6765\u8bb2SparkSQL\u5728\u6267\u884c\u6027\u80fd\u4e0a\u53ef\u80fd\u8981\u7a0d\u900a\u4e8ePresto\uff0c\u56e0\u4e3apresto\u4e13\u7528\u6027\u66f4\u5f3a\uff0c\u9488\u5bf9sql\u548c\u7ed3\u6784\u5316\u6570\u636e\u6709\u66f4\u597d\u7684\u4f18\u5316\uff0c\u800cSpark\u56e0\u4e3a\u8981\u517c\u987e\u901a\u7528\u6027\uff0c\u6240\u4ee5\u9700\u8981\u5728\u5904\u7406SQL\u548c\u7ed3\u6784\u5316\u6570\u636e\u4e0a\u727a\u7272\u4e00\u70b9\u6027\u80fd\uff0c\u6784\u5efa\u5728SparkCore\u4e0a\u7684\u5e94\u7528\u4e0d\u4ec5\u6709SparkSQL\uff0c\u8fd8\u6709Spark Streaming\u3001Spark MLib\u3001Spark GraphX\u3002</p> <p>\u66f4\u7ec6\u8282\u4e00\u70b9\uff1a</p> <p>\u67b6\u6784\u65b9\u9762\uff0cPresto\u7684\u4e3b\u4ece\u8282\u70b9\u5e38\u9a7b\u5185\u5b58\uff0c\u65f6\u523b\u51c6\u5907\u7740\u63a5\u6536SQL\u67e5\u8be2\uff0c\u4f46\u662fSparkSQL\u8f6c\u6362\u6210SparkRDD\u4efb\u52a1\u4e4b\u540e\u9700\u8981Yarn\u7b49\u8d44\u6e90\u8c03\u5ea6\u5668\u8c03\u5ea6\u6267\u884c\uff0c\u5bf9\u96c6\u7fa4\u8d44\u6e90\u7684\u5229\u7528Presto\u8981\u505a\u7684\u66f4\u597d\u3002\uff08on yarn\u6a21\u5f0f\u4e5f\u53ef\u4ee5\u505a\u5230\u5e38\u9a7b\u5185\u5b58\uff0c\u5373\u5206\u914d\u5b8c\u8d44\u6e90\u4ee5\u540e\u4e0d\u91ca\u653e\u5c31\u884c\uff0c\u4e00\u76f4\u8fd0\u884c\u5c31\u53ef\u4ee5\uff0c\u6240\u4ee5\u5e38\u9a7b\u5185\u5b58\u4e0d\u7b97\u662f\u4f18\u70b9\u3002\uff09</p> <p>\u4f46Presto\u5e76\u4e0d\u662f\u6837\u6837\u90fd\u6bd4Spark SQL\u5f3a\uff0c\u9488\u5bf9\u590d\u6742\u67e5\u8be2\u7684\u65f6\u5019\uff0cSparkSQL\u6709\u57fa\u4e8e\u6210\u672c\u7684\u4f18\u5316\uff0c\u6bd4Presto\u505a\u7684\u8981\u597d\uff1b\u53e6\u5916\uff0cPresto\u4e3a\u4e86\u5c3d\u53ef\u80fd\u964d\u4f4eSQL\u67e5\u8be2\u7684\u5ef6\u65f6\uff0c\u653e\u5f03\u4e86\u5bb9\u9519\u673a\u5236\uff0c\u800cSpark\u7684\u5bb9\u9519\u505a\u7684\u5f88\u597d\uff0c\u6240\u4ee5\u5f53\u4efb\u52a1\u51fa\u9519\u7684\u65f6\u5019\uff0cPresto\u9700\u8981\u91cd\u542f\uff0c\u800cSparkSQL\u4e0d\u9700\u8981\uff0c\u4f46\u8fd9\u4e5f\u9020\u6210Spark SQL\u751f\u6210SQL\u6267\u884c\u8ba1\u5212\u4ee5\u53ca\u8c03\u5ea6\u5f00\u9500\u90fd\u8981\u6bd4Presto\u9ad8\u5f88\u591a\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0cSpark\u66f4\u9002\u5408\u5904\u7406\u975e\u7ed3\u6784\u5316\u6570\u636e\uff0cPresto\u4e13\u6ce8\u4e8e\u5927\u6570\u636e\u7684SQL\u67e5\u8be2\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#prestosparksqlclickhousedruid","title":"Presto\u3001SparkSQL\u4e0eClickHouse\u3001Druid\u7684\u533a\u522b\uff1f","text":"<p>\u9996\u5148\u4ed6\u4eec\u90fd\u662f\u6784\u5efaOLAP\u7684\u76f8\u5173\u6280\u672f\uff0c\u5176\u6b21\u5b83\u4eec\u662f\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u8bbe\u8ba1\u7684\u67b6\u6784\uff0c\u5bfc\u81f4\u4ed6\u4eec\u7684\u957f\u5904\u4e5f\u5404\u4e0d\u76f8\u540c\uff0c\u4e0d\u5b58\u5728\u4e00\u4e2a\u6280\u672f\u9002\u914d\u6240\u6709\u573a\u666f\u7684\u8bf4\u6cd5\u3002</p> <p>Presto\u3001SparkSQL\u662f\u8ba1\u7b97\u5f15\u64ce\uff0c\u4e0d\u6d89\u53ca\u5b58\u50a8\uff0c\u53ef\u4ee5\u5bf9\u63a5\u591a\u79cd\u6570\u636e\u6e90\uff0c\u800cClickHouse\u3001Druid\u662f\u5b58\u50a8\u8ba1\u7b97\u4e00\u4f53\u7684\u3002\u56e0\u4e3aClickHouse\u548cDruid\u662f\u5b58\u50a8\u8ba1\u7b97\u4e00\u4f53\u7684\uff0c\u6240\u4ee5\u5b83\u4fe9\u9488\u5bf9\u67e5\u8be2\u8bbe\u8ba1\u6709\u4e13\u95e8\u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u4f18\u70b9\u662f\u67e5\u8be2\u5ef6\u65f6\u4f4e\uff0c\u4f46\u662f\u7f3a\u70b9\u662f\u652f\u6301\u6570\u636e\u91cf\u4e0d\u5927\uff08\u8fd9\u91cc\u7684\u4e0d\u5927\u662f\u9488\u5bf9Presto\u3001SparkSQL\u800c\u8a00\u7684\uff0c\u5bf9\u4e8e\u4f20\u7edf\u9488\u5bf9OLTP\u573a\u666f\u7684\u6570\u636e\u5e93\u6765\u8bf4\uff0c\u7b97\u662f\u5f88\u5927\u4e86\uff09\uff0c\u5e76\u4e14\u4e5f\u4e0d\u9002\u5408\u590d\u6742\u67e5\u8be2\u3002Presto \u548c SparkSQL\u4e13\u6ce8\u4e8e\u8ba1\u7b97\uff0c\u80fd\u5904\u7406\u66f4\u5927\u6570\u636e\u91cf\uff0c\u5bf9\u6570\u636e\u7684\u5b58\u50a8\u683c\u5f0f\u4e5f\u6ca1\u6709\u8981\u6c42\uff0c\u53ef\u4ee5\u8fdb\u884c\u590d\u6742\u67e5\u8be2\uff0c\u4f46\u7f3a\u70b9\u662f\u67e5\u8be2\u5ef6\u65f6\u9ad8\u3002</p> <p>\u6240\u4ee5Presto\u3001SparkSQL\u9002\u5408\u6570\u4ed3\u4f8b\u884c\u4efb\u52a1\uff0c\u56e0\u4e3a\u90fd\u662f\u590d\u6742\u67e5\u8be2\uff0c\u5e76\u4e14\u5bf9\u5ef6\u65f6\u6ca1\u6709\u5565\u592a\u5927\u7684\u8981\u6c42\uff1bClickHouse\u3001Druid\u9002\u5408\u7528\u4e8eBI\u5de5\u5177\u7684\u5e95\u5c42\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#kylin","title":"Kylin\u7ef4\u5ea6\u7206\u70b8\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#cap","title":"CAP\uff1f","text":"<p>CAP\u5b9a\u7406\u63cf\u8ff0\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u7cfb\u7edf\u4e2d\uff0c\u6d89\u53ca\u5171\u4eab\u6570\u636e\u95ee\u9898\u65f6\uff0c\u4ee5\u4e0b\u4e09\u4e2a\u7279\u6027\u6700\u591a\u53ea\u80fd\u540c\u65f6\u6ee1\u8db3\u5176\u4e2d\u4e24\u4e2a\uff1a</p> <ul> <li>\u4e00\u81f4\u6027\uff08Consistency\uff09\uff1a\u4ee3\u8868\u6570\u636e\u5728\u4efb\u4f55\u65f6\u523b\u3001\u4efb\u4f55\u5206\u5e03\u5f0f\u8282\u70b9\u4e2d\u6240\u770b\u5230\u7684\u90fd\u662f\u7b26\u5408\u9884\u671f\u7684\u3002\u4e00\u81f4\u6027\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u9762\u5411\u526f\u672c\u590d\u5236\u7684\u4e00\u81f4\u6027 \u548c \u9762\u5411\u6570\u636e\u5e93\u72b6\u6001\u7684\u4e00\u81f4\u6027\u3002</li> <li>\u53ef\u7528\u6027\uff08Availability\uff09\uff1a\u4ee3\u8868\u7cfb\u7edf\u4e0d\u95f4\u65ad\u5730\u63d0\u4f9b\u670d\u52a1\u7684\u80fd\u529b\u3002</li> <li>\u5206\u533a\u5bb9\u5fcd\u6027\uff08Partition Tolerance\uff09\uff1a\u4ee3\u8868\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\u90e8\u5206\u8282\u70b9\u56e0\u7f51\u7edc\u539f\u56e0\u800c\u5f7c\u6b64\u5931\u8054\u540e\uff0c\u5373\u4e0e\u5176\u4ed6\u8282\u70b9\u5f62\u6210\u201c\u7f51\u7edc\u5206\u533a\u201d\u65f6\uff0c\u7cfb\u7edf\u4ecd\u80fd\u6b63\u786e\u5730\u63d0\u4f9b\u670d\u52a1\u7684\u80fd\u529b\u3002</li> </ul> <p>P \u662f\u5206\u5e03\u5f0f\u7f51\u7edc\u7684\u5929\u7136\u5c5e\u6027\uff0c\u6c38\u8fdc\u53ef\u9760\u7684\u901a\u4fe1\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u5fc5\u5b9a\u4e0d\u6210\u7acb\u7684\uff0c\u8fd9\u4e0d\u662f\u4f60\u60f3\u4e0d\u60f3\u7684\u95ee\u9898\uff0c\u800c\u662f\u53ea\u8981\u7528\u5230\u7f51\u7edc\u6765\u5171\u4eab\u6570\u636e\uff0c\u5206\u533a\u73b0\u8c61\u5c31\u4f1a\u59cb\u7ec8\u5b58\u5728\u3002\u6240\u4ee5\u5fc5\u987bP\u662f\u5fc5\u987b\u4fdd\u7684\uff0c\u4e5f\u5c31\u662f\u5728\u53d1\u751f\u7f51\u7edc\u5206\u533a\u7684\u65f6\u5019\u7cfb\u7edf\u5fc5\u987b\u8981\u6709\u63d0\u4f9b\u670d\u52a1\u7684\u80fd\u529b\uff0c\u4e0d\u7136\u5c31\u4e0d\u80fd\u79f0\u4e4b\u4e3a\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u4e8e\u662f\u63a5\u4e0b\u6765\u5c31\u53ea\u80fd\u5728C \u548c A\u4e4b\u95f4\u8fdb\u884c\u6743\u8861\u3002</p> <p>CP\uff1a\u4fddC\uff0c\u653e\u5f03A\u3002\u610f\u5473\u7740\u5728\u6570\u636e\u8fbe\u5230\u4e00\u81f4\u6027\u4e4b\u524d\u7cfb\u7edf\u4e0d\u80fd\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0cHBase \u5c31\u662f\u5c5e\u4e8e CP \u7cfb\u7edf\uff0c\u4ee5 HBase \u96c6\u7fa4\u4e3a\u4f8b\uff0c\u5047\u5982\u67d0\u4e2a RegionServer \u5b95\u673a\u4e86\uff0c\u8fd9\u4e2a RegionServer \u6301\u6709\u7684\u6240\u6709\u952e\u503c\u8303\u56f4\u90fd\u5c06\u79bb\u7ebf\uff0c\u76f4\u5230\u6570\u636e\u6062\u590d\u8fc7\u7a0b\u5b8c\u6210\u4e3a\u6b62\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u8981\u6d88\u8017\u7684\u65f6\u95f4\u662f\u65e0\u6cd5\u9884\u5148\u4f30\u8ba1\u7684\u3002</p> <p>AP\uff1a\u4fddA\uff0c\u653e\u5f03C\u3002\u610f\u5473\u7740\u7cfb\u7edf\u65f6\u523b\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u6709\u4e9b\u8bf7\u6c42\u8fd4\u56de\u7684\u6570\u636e\u662f\u9519\u7684\u3002\u9009\u62e9\u653e\u5f03\u4e00\u81f4\u6027\u7684 AP \u7cfb\u7edf\u76ee\u524d\u662f\u8bbe\u8ba1\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u4e3b\u6d41\u9009\u62e9\uff0c\u56e0\u4e3a P \u662f\u5206\u5e03\u5f0f\u7f51\u7edc\u7684\u5929\u7136\u5c5e\u6027\uff0c\u4f60\u518d\u4e0d\u60f3\u8981\u4e5f\u65e0\u6cd5\u4e22\u5f03\uff0c\u800c A \u901a\u5e38\u662f\u5efa\u8bbe\u5206\u5e03\u5f0f\u7684\u76ee\u7684\uff0c\u76ee\u524d\u5927\u591a\u6570 NoSQL \u5e93\u548c\u652f\u6301\u5206\u5e03\u5f0f\u7684\u7f13\u5b58\u6846\u67b6\u90fd\u662f AP \u7cfb\u7edf\uff0c\u4ee5 Redis \u96c6\u7fa4\u4e3a\u4f8b\uff0c\u5982\u679c\u67d0\u4e2a Redis \u8282\u70b9\u51fa\u73b0\u7f51\u7edc\u5206\u533a\uff0c\u90a3\u4ecd\u4e0d\u59a8\u788d\u5404\u4e2a\u8282\u70b9\u4ee5\u81ea\u5df1\u672c\u5730\u5b58\u50a8\u7684\u6570\u636e\u5bf9\u5916\u63d0\u4f9b\u7f13\u5b58\u670d\u52a1\uff0c\u4f46\u8fd9\u65f6\u6709\u53ef\u80fd\u51fa\u73b0\u8bf7\u6c42\u5206\u914d\u5230\u4e0d\u540c\u8282\u70b9\u65f6\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u662f\u4e0d\u4e00\u81f4\u7684\u6570\u636e\u3002</p> <p>\u867d\u7136\u201d\u4e00\u81f4\u6027\u201d\u901a\u5e38\u662f\u88ab\u727a\u7272\u3001\u88ab\u653e\u5f03\u7684\u90a3\u4e00\u9879\u5c5e\u6027\uff0c\u4f46\u65e0\u8bba\u5982\u4f55\uff0c\u6211\u4eec\u5efa\u8bbe\u4fe1\u606f\u7cfb\u7edf\uff0c\u7ec8\u7a76\u8fd8\u662f\u8981\u786e\u4fdd\u64cd\u4f5c\u7ed3\u679c\u81f3\u5c11\u5728\u6700\u7ec8\u4ea4\u4ed8\u7684\u65f6\u5019\u662f\u6b63\u786e\u7684\uff0c\u4e5f\u5c31\u662f\u5141\u8bb8\u6570\u636e\u5728\u4e2d\u95f4\u8fc7\u7a0b\u51fa\u9519\uff08\u4e0d\u4e00\u81f4\uff09\uff0c\u4f46\u5e94\u8be5\u5728\u8f93\u51fa\u65f6\u88ab\u4fee\u6b63\u8fc7\u6765\uff0c\u5373\u628a\u727a\u7272\u4e86 C \u7684 AP \u7cfb\u7edf\u53c8\u8981\u5c3d\u53ef\u80fd\u83b7\u5f97\u6b63\u786e\u7684\u7ed3\u679c\u7684\u884c\u4e3a\u79f0\u4e3a\u8ffd\u6c42\u201c\u5f31\u4e00\u81f4\u6027\u201d \u6216\u8005 \u201c\u6700\u7ec8\u4e00\u81f4\u6027\u201d\uff0c\u4e8e\u662f\u6f14\u5316\u6210\u4e86BASE\u7406\u8bba\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9D%A2%E8%AF%95%E9%A2%98/#kafkaapcp","title":"Kafka\u662fAP\u8fd8\u662fCP?","text":"<p>\u5982\u679c\u628aKafka\u8bbe\u7f6e\u6210\u4fdd\u8bc1\u751f\u4ea7\u8005\u548cKafka\u4e4b\u95f4\u6d88\u606f\u4e0d\u4e22\u5931\uff0c\u90a3\u4e48\u6b64\u65f6Kafka\u5c31\u662fCP\u3002</p> <ol> <li>\u8bbe\u7f6eProducer\u7aef\u8bbe\u7f6e<code>acks</code>=all</li> <li>topic\u8bbe\u7f6e<code>replication.factor</code>&gt;=3</li> <li>\u8bbe\u7f6e<code>min.insync.replicas</code>&gt;1</li> <li>\u8bbe\u7f6e<code>unclean.leader.election.enable</code>=false\uff0c\u5373\u4e0d\u5141\u8bb8Unclean leader\u9009\u4e3e</li> </ol> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5982\u679c\u628a<code>acks</code>\u8bbe\u7f6e\u4e3a0\u6216\u80051\uff0c\u90a3\u4e48\u6b64\u65f6Kafka\u5c31\u662fAP\u3002</p> <p>\u603b\u7ed3\uff0c\u5305\u62ecKafka\u5728\u5185\u7684\u5f88\u591a\u5206\u5e03\u5f0f\u7cfb\u7edf\u5176\u5b9e\u90fd\u4e0d\u662f\u4e25\u683cAP\u6216\u8005CP\u7cfb\u7edf\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/","title":"\u5e76\u53d1\u7f16\u7a0b","text":"<p> \u7ea6 10199 \u4e2a\u5b57  10 \u884c\u4ee3\u7801  10 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 204 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_1","title":"\u5e94\u7528","text":""},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_2","title":"\u7ebf\u7a0b\u7684\u72b6\u6001\uff1f","text":"<p>\u4ee5\u4e0a\u662f\u4ecejvm\u7684synchronized\u9501\u7684\u89d2\u5ea6\u51fa\u53d1\u7684\uff0csynchronized\u662fJVM\u5b9e\u73b0\u7684\uff0c\u800cJUC\u7684Lock\u662f\u7528\u6237\u5c42\u9762\u7684\u5b9e\u73b0\uff0c\u6240\u4ee5LockSupprot.park()\u662f\u7b49\u5f85\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u6bd5\u7adf\u4e0d\u662f\u9501\uff0c\u53ea\u662f\u5b9e\u73b0\u9501\u7684\u4e00\u4e2a\u5173\u952e\u64cd\u4f5c\u3002synchronized\u7684\u89d2\u5ea6\u533a\u5206\u4e86\u963b\u585e\u548c\u7b49\u5f85\u4e24\u79cd\u72b6\u6001\uff0c\u8fd9\u4e24\u79cd\u72b6\u6001\u7684\u533a\u522b\u5728\u4e8e\uff0c\u963b\u585e\u72b6\u6001\u5728\u7b49\u5f85\u83b7\u53d6\u4e00\u4e2a\u6392\u5b83\u9501\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u53d1\u751f\u5728\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u653e\u5f03\u8fd9\u4e2a\u7684\u9501\u7684\u65f6\u5019\uff1b\u800c\u7b49\u5f85\u72b6\u6001\u5728\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u6216\u8005\u5524\u9192\u52a8\u4f5c\u7684\u53d1\u751f\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u628aJUC\u7684Lock\u9501\u7684\u64cd\u4f5c\u52a0\u5728\u4e0a\u9762\uff0c\u6bd4\u5982ReentrantLock\u7684lock()\u4e0eunlock()\u52a0\u5728\u963b\u585e\u90a3\u91cc\uff0cawait()\u548csignalAll()\u653e\u5728\u7b49\u5f85\u90a3\u91cc\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u91cc\u8fdb\u7a0b\u7684\u4e09\u79cd\u72b6\u6001\uff08\u5c31\u7eea\u3001\u8fd0\u884c\u3001\u963b\u585e\uff09\u4e0d\u540c\uff1f\u5f53\u7136\u95ee\u9898\u7684\u539f\u56e0\u4e0d\u5728\u4e8eJava\u91cc\u662f\u7ebf\u7a0b\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u91cc\u662f\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u91cc\u7ebf\u7a0b\u4e5f\u662f\u8fd93\u79cd\u72b6\u6001\u3002\u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u5728\u4e8e\u4e0a\u9762\u662fJava\u63d0\u9ad8\u7684\u4e00\u79cd\u7edf\u4e00\u7684\u5e76\u53d1\u7f16\u7a0b\u6a21\u578b\uff0c\u89e3\u51b3\u8de8\u5e73\u53f0\u95ee\u9898\u7684Java\u4e00\u76f4\u90fd\u662f\u5728\u5982\u6b64\u5730\u505a\uff0c\u4e0a\u56fe\u4e2d\u6240\u8bb2\u7684waiting\u7b49\u5f85\u72b6\u6001\u548cblocked\u963b\u585e\u72b6\u6001\u5176\u5b9e\u90fd\u662f\u4f9d\u9760\u64cd\u4f5c\u7cfb\u7edf\u63d0\u9ad8\u7684park\u7cfb\u7edf\u8c03\u7528\u5b8c\u6210\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u770b\u6765\u90fd\u662f\u7ebf\u7a0b\u963b\u585e\uff08Java\u7ebf\u7a0b\u7684\u5b9e\u73b0\u65b9\u6cd5\u662f1:1\uff0c\u6240\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u80fd\u611f\u77e5Java\u6240\u521b\u5efa\u7684\u7ebf\u7a0b\uff09\uff0c\u5176\u533a\u522b\u662f\u5728Java\u8fd9\u4e00\u5c42\u5b9e\u73b0\u7684\uff0c\u4e3b\u8981\u662fwaiting\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u53ea\u5728\u8c03\u7528notify\u4e4b\u540e\u88ab\u52a0\u5165\u5230\u7b49\u5f85\u5524\u9192\u7684\u961f\u5217\u4e2d\uff0c\u800cblocked\u963b\u585e\u72b6\u6001\u7684\u7ebf\u7a0b\u5728\u6bcf\u6b21\u89e3\u9501\u64cd\u4f5c\u4e4b\u65f6\u90fd\u4f1a\u88ab\u52a0\u5165\u5230\u7b49\u5f85\u5524\u9192\u7684\u961f\u5217\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#3","title":"\u521b\u5efa\u7ebf\u7a0b\u76843\u65b9\u5f0f\uff1f","text":"<p>1.\u7ee7\u627fThread\u7c7b</p> <p>2.\u5b9e\u73b0Runnable\u63a5\u53e3</p> <p>3.\u5b9e\u73b0Callable\u63a5\u53e3\uff1a\u5b9e\u73b0Callable\u63a5\u53e3 -&gt; \u521b\u5efaFutureTask\u5bf9\u8c61<code>new FutureTask(new MyThreadCallable());</code> -&gt; <code>new Thread(futureTask, \"A\").start()</code>;</p> <p>\u672c\u8d28\u4e0a\u53ea\u6709\u4e00\u79cd\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff0c\u5373 <code>new Thread().start()</code>;</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#jvm","title":"\u7ebf\u7a0b\u629b\u5f02\u5e38\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u6574\u4e2aJVM\u8fdb\u7a0b\u7ed3\u675f\uff1f","text":"<p>\u4e0d\u4f1a\uff0cjava\u865a\u62df\u673a\u9000\u51fa\u7684\u6761\u4ef6\u662f\uff1a\u865a\u62df\u673a\u5185\u4e0d\u5b58\u5728\u975e\u5b88\u62a4\u7ebf\u7a0b\u3002</p> <p>\u5728Linux\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u5f53\u7ebf\u7a0b\u53d1\u751f\u9519\u8bef\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u7ed9\u7ebf\u7a0b\u53d1\u9001kill\u4fe1\u53f7\uff08\u6bd4\u5982\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u53d1\u9001\u7684\u662fkill -11\uff0c\u5373SIGSEGV\uff09\uff0c\u4e4b\u540e\u7ebf\u7a0b\u6267\u884c\u81ea\u5b9a\u4e49\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u5982\u679c\u7ebf\u7a0b\u4e0d\u5728\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u91cc\u5782\u6b7b\u6323\u624e\u6062\u590d\u8fdb\u7a0b\uff0c\u90a3\u4e48\u5728\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u5b8c\u540e\uff0c\u8fdb\u7a0b\u76f4\u63a5\u7ed3\u675f\uff08kill -9 \u9664\u5916\uff0c\u4e0d\u7ba1\u8fdb\u7a0b\u662f\u5426\u5b9a\u4e49\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u90fd\u4f1a\u9a6c\u4e0a\u88ab\u5e72\u6389\uff09\u3002\u7ebf\u7a0b\u5d29\u6e83\u4e0d\u4f1a\u5bfc\u81f4 JVM \u5d29\u6e83\u662f\u56e0\u4e3a JVM \u81ea\u5b9a\u4e49\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002</p> <p>\u7f8e\u56e2\u4e00\u9762\uff1a\u4e3a\u4ec0\u4e48\u7ebf\u7a0b\u5d29\u6e83\u5d29\u6e83\u4e0d\u4f1a\u5bfc\u81f4 JVM \u5d29\u6e83 (qq.com)</p> <p>OOM\u5f02\u5e38\u4f1a\u5bfc\u81f4JVM\u9000\u51fa\u5417\uff1f - \u77e5\u4e4e (zhihu.com)</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_3","title":"\u7ebf\u7a0b\u6c60\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_4","title":"\u8bf4\u4e00\u4e0b\u7ebf\u7a0b\u6c60\u7684\u6838\u5fc3\u53c2\u6570\uff1f","text":"Java<pre><code>public ThreadPoolExecutor(int corePoolSize,\n                          int maximumPoolSize,\n                          long keepAliveTime,\n                          TimeUnit unit,\n                          BlockingQueue&lt;Runnable&gt; workQueue,\n                          ThreadFactory threadFactory,\n                          RejectedExecutionHandler handler);\n</code></pre> <ul> <li>corePoolSize\uff1a\u7ebf\u7a0b\u6c60\u4e2d\u5e38\u9a7b\u7684\u7ebf\u7a0b\u6570\uff0c\u8d85\u51fa\u5e38\u9a7b\u7684\u7ebf\u7a0b\u6570\u540e\u4efb\u52a1\u4f1a\u8fdb\u5165\u963b\u585e\u961f\u5217</li> <li>maximumPoolSize\uff1a\u7ebf\u7a0b\u6c60\u4e2d\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u8d85\u51fa\u6700\u5927\u7ebf\u7a0b\u6570\u540e\u6267\u884c\u62d2\u7edd\u7b56\u7565</li> <li>keepAliveTime\uff1a\u8d85\u8fc7\u5e38\u9a7b\u7ebf\u7a0b\u6570\u7684\u7ebf\u7a0b\u5728\u7a7a\u95f2\u4e0b\u6765keepAliveTime\u540e\u4f1a\u88ab\u9500\u6bc1</li> <li>unit\uff1akeepAliveTime\u7684\u65f6\u95f4\u5355\u4f4d</li> <li>workQueue\uff1a\u963b\u585e\u961f\u5217\uff0c\u963b\u585e\u961f\u5217\u6ee1\u4e86\u4e4b\u540e\u4f1a\u521b\u5efa\u975e\u6838\u5fc3\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1</li> <li>threadFactory\uff1a\u7ebf\u7a0b\u5de5\u5382\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u65f6\u4f7f\u7528\u7684\u5de5\u5382\uff0c\u53ef\u4ee5\u7528\u6765\u8bbe\u5b9a\u7ebf\u7a0b\u540d\u3001\u662f\u5426\u4e3adaemon\u7ebf\u7a0b\u7b49</li> <li>handler\uff1a\u62d2\u7edd\u7b56\u7565</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_5","title":"\u7ebf\u7a0b\u6c60\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1f","text":"<p>\u5f53\u8c03\u7528 execute() \u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u65f6\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u505a\u5982\u4e0b\u5224\u65ad\uff1a</p> <ol> <li>\u5982\u679c\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\u6570\u91cf\u5c0f\u4e8e corePoolSize\uff0c\u90a3\u4e48\u9a6c\u4e0a\u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\u8fd9\u4e2a\u4efb\u52a1\uff1b</li> <li>\u5982\u679c\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\u6570\u91cf\u5927\u4e8e\u6216\u7b49\u4e8e corePoolSize\uff0c\u90a3\u4e48\u5c06\u8fd9\u4e2a\u4efb\u52a1\u52a0\u5165\u963b\u585e\u961f\u5217\uff1b</li> <li>\u5982\u679c\u8fd9\u65f6\u5019\u961f\u5217\u6ee1\u4e86\uff0c\u800c\u4e14\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\u6570\u91cf\u5c0f\u4e8e maximumPoolSize\uff0c\u90a3\u4e48\u8fd8\u662f\u8981\u521b\u5efa\u975e\u6838\u5fc3\u7ebf\u7a0b\u7acb\u523b\u8fd0\u884c\u8fd9\u4e2a\u4efb\u52a1\uff1b</li> <li>\u5982\u679c\u961f\u5217\u6ee1\u4e86\u5e76\u4e14\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\u6570\u91cf\u7b49\u4e8e maximumPoolSize\uff0c\u90a3\u4e48\u7ebf\u7a0b\u6c60\u4f1a\u6839\u636e\u62d2\u7edd\u7b56\u7565\u6765\u5bf9\u5e94\u5904\u7406\u3002</li> </ol> <p>\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u4efb\u52a1\u65f6\uff0c\u5b83\u4f1a\u4ece\u961f\u5217\u4e2d\u53d6\u4e0b\u4e00\u4e2a\u4efb\u52a1\u6765\u6267\u884c\u3002</p> <p>\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u65e0\u4e8b\u53ef\u505a\uff0c\u8d85\u8fc7\u4e00\u5b9a\u7684\u65f6\u95f4\uff08keepAliveTime\uff09\u65f6\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u5224\u65ad\uff0c\u5982\u679c\u5f53\u524d\u8fd0\u884c\u7684\u7ebf\u7a0b\u6570\u5927\u4e8e corePoolSize\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ebf\u7a0b\u5c31\u88ab\u9500\u6bc1\uff0c\u4e5f\u5c31\u662f\u7ebf\u7a0b\u6c60\u7684\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u6700\u7ec8\u4f1a\u6536\u7f29\u5230 corePoolSize \u7684\u5927\u5c0f\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_6","title":"\u62d2\u7edd\u7b56\u7565\uff1f","text":"<p>\u4e3b\u8981\u67094\u79cd\u62d2\u7edd\u7b56\u7565\uff1a</p> <ol> <li>AbortPolicy\uff08\u9ed8\u8ba4\u7b56\u7565\uff09\uff1a\u629b\u51fa\u5f02\u5e38</li> <li>CallerRunsPolicy\uff1a\u628a\u4efb\u52a1\u4ea4\u7ed9\u8c03\u7528\u8005\u7ebf\u7a0b\u6267\u884c</li> <li>DiscardOldestPolicy\uff1a\u4e22\u5f03\u7b49\u5f85\u961f\u5217\u4e2d\u6700\u65e7\u7684\u4efb\u52a1\uff08\u961f\u5934\uff0c\u4e5f\u5c31\u662f\u4e0b\u4e00\u4e2a\u5373\u5c06\u6267\u884c\u7684\u4efb\u52a1\uff09\uff0c\u5e76\u6267\u2f8f\u5f53\u524d\u4efb\u52a1</li> <li>DiscardPolicy\uff1a\u76f4\u63a5\u4e22\u5f03\u4efb\u52a1\uff0c\u4e5f\u4e0d\u629b\u51fa\u5f02\u5e38</li> </ol> <p>\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u62d2\u7edd\u7b56\u7565\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_7","title":"\u5e38\u89c1\u963b\u585e\u961f\u5217\uff1f","text":"<p>BolckingQueue\u53ea\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u4e3b\u8981\u7528\u5b83\u7684\u4e09\u4e2a\u5b9e\u73b0\u7c7b\uff1a</p> <ol> <li>ArrayBlockingQueue \uff1a\u7531\u6570\u7ec4\u7ed3\u6784\u7ec4\u6210\u7684\u6709\u754c\u963b\u585e\u961f\u5217</li> <li>LinkedBlockingQueue \uff1a\u7531\u94fe\u8868\u7ed3\u6784\u7ec4\u6210\u7684\u6709\u754c\u963b\u585e\u961f\u5217</li> <li>SynchronousQueue\uff1a\u4e0d\u5b58\u50a8\u5143\u7d20\u7684\u963b\u585e\u961f\u5217</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#threadpoolexecutor_submitexecute","title":"ThreadPoolExecutor submit\u548cexecute\u65b9\u6cd5\u7684\u533a\u522b\uff1f","text":"<ol> <li> <p>execute\u53ea\u80fd\u63d0\u4ea4Runnable\u7c7b\u578b\u7684\u4efb\u52a1\uff0c\u800csubmit\u65e2\u80fd\u63d0\u4ea4Runnable\u7c7b\u578b\u4efb\u52a1\u4e5f\u80fd\u63d0\u4ea4Callable\u7c7b\u578b\u4efb\u52a1</p> </li> <li> <p>execute\u4f1a\u76f4\u63a5\u629b\u51fa\u4efb\u52a1\u6267\u884c\u65f6\u7684\u5f02\u5e38\uff0csubmit\u4f1a\u5403\u6389\u5f02\u5e38\uff0c\u53ef\u901a\u8fc7Future\u7684get\u65b9\u6cd5\u5c06\u4efb\u52a1\u6267\u884c\u65f6\u7684\u5f02\u5e38\u91cd\u65b0\u629b\u51fa\u3002</p> </li> </ol> <p></p> <ul> <li>execute()\u65b9\u6cd5\u5728Executor\u63a5\u53e3\u4e2d\u3002</li> <li>submit()\u65b9\u6cd5\u5728ExecutorService\u63a5\u53e3\u4e2d\u3002</li> <li>AbstractExecutorService\u62bd\u8c61\u7c7b\u5b9e\u73b0\u4e86submit()\u65b9\u6cd5\uff0csubmit()\u65b9\u6cd5\u7684\u5b9e\u73b0\u662f\uff0csubmit\u4f1a\u5148\u5c06\u4f20\u5165\u7684Runnable\u6216\u8005Callable\u6784\u9020\u6210\u4e00\u4e2aRunnableFuture\uff0c\u7136\u540e\u8c03\u7528\u4e86execute()\u3002</li> <li>ThreadPoolExecutor\u5b9e\u73b0\u4e86execute\u65b9\u6cd5\uff0c\u5e76\u4eceAbstractExecutorService\u62bd\u8c61\u7c7b\u4e2d\u7ee7\u627f\u4e86submit()\u65b9\u6cd5\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_8","title":"\u6709\u54ea\u51e0\u79cd\u5e38\u89c1\u7684\u7ebf\u7a0b\u6c60\uff1f","text":"<ul> <li> <p>FixedThreadPool</p> </li> <li> <p>\u5b9a\u957f\u7684\u7ebf\u7a0b\u6c60\uff0c\u6838\u5fc3\u7ebf\u7a0b\u6570\u91cf = \u6700\u5927\u7684\u7ebf\u7a0b\u6570\u91cf\uff0c\u6ca1\u6709\u975e\u6838\u5fc3\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u4f7f\u7528\u7684\u662f\u65e0\u754c\u7b49\u5f85\u961f\u5217<code>LinkedBlockingQueue</code>\u3002</p> </li> <li> <p>SingleThreadPool</p> </li> <li> <p>\u53ea\u6709\u5355\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\uff0c\u6838\u5fc3\u7ebf\u7a0b\u6570\u91cf = \u6700\u5927\u7684\u7ebf\u7a0b\u6570\u91cf = 1\uff0c\u6ca1\u6709\u975e\u6838\u5fc3\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u4f7f\u7528\u7684\u662f\u65e0\u754c\u7b49\u5f85\u961f\u5217<code>LinkedBlockingQueue</code>\u3002</p> </li> <li> <p>CachedThreadPool</p> </li> <li> <p>\u6838\u5fc3\u7ebf\u7a0b\u6570\u91cf = 0\uff0c\u6700\u5927\u7684\u7ebf\u7a0b\u6570\u91cf = Integer.MAX_VALUE\uff0c\u4e5f\u5c31\u662f\u65e0\u9650\u5927\u3002</p> </li> <li> <p>\u4f7f\u7528\u7684\u662f\u4e0d\u5b58\u50a8\u5143\u7d20\u7684\u963b\u585e\u961f\u5217<code>SynchronousQueue</code>\uff08SynchronousQueue\u5c31\u662f\u53ea\u8981\u7ebf\u7a0b\u5f80\u91cc\u9762put\uff0c\u5982\u679c\u6ca1\u6709\u5176\u5b83\u7ebf\u7a0b\u53ca\u65f6\u53d6\u51fa\u6765\uff0c\u90a3\u4e48\u8be5put\u7ebf\u7a0b\u5c31\u4f1a\u963b\u585e\uff09\uff0c\u4e5f\u5c31\u662f\u53ea\u8981\u6765\u4e86\u4efb\u52a1\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7ebf\u7a0b\u5c31\u4f1a\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u7a7a\u95f2\u7ebf\u7a0b\u7684keepAliveTime\u7b49\u4e8e\u4e00\u5206\u949f\u3002</p> </li> <li> <p>ScheduledThreadPoolExecutor</p> </li> </ul> <p>\u5468\u671f\u6027\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b\u6c60\uff0c\u6709\u6838\u5fc3\u7ebf\u7a0b\uff0c\u4f46\u4e5f\u6709\u975e\u6838\u5fc3\u7ebf\u7a0b\uff0c\u975e\u6838\u5fc3\u7ebf\u7a0b\u7684\u5927\u5c0f\u4e5f\u4e3a\u65e0\u9650\u5927\uff0c\u9002\u7528\u4e8e\u6267\u884c\u5468\u671f\u6027\u7684\u4efb\u52a1\u3002\u6784\u9020\u51fd\u6570\u8c03\u7528\u7684\u8fd8\u662f<code>ThreadPoolExecutor</code>\u6784\u9020\u51fd\u6570\uff0c\u533a\u522b\u4e0d\u540c\u70b9\u5728\u4e8e\u4efb\u52a1\u961f\u5217\u662f\u7528\u7684<code>DelayedWorkQueue</code>\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#java","title":"Java\u4e2d\u90fd\u6709\u54ea\u4e9b\u9501\uff1f","text":"<p>synchronized \u548c JUC\u5305\u4e0b\u7684Lock\u7684\u5b9e\u73b0\u7c7b\uff08ReentrantLock\u3001ReentrantReadWriteLock\u4e2d\u7684ReadLock\u548cWriteLock\uff09</p> <p>Lock\u4e2d\u7684\u4e3b\u8981\u65b9\u6cd5\uff1a</p> <ul> <li>lock\uff1a\u7528\u6765\u83b7\u53d6\u9501\uff0c\u5982\u679c\u9501\u88ab\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\uff0c\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002</li> <li>lockInterruptibly\uff1a\u5982\u679c\u7ebf\u7a0b\u4f7f\u7528\u6b64\u65b9\u6cd5\u83b7\u53d6\u9501\u65f6\uff0c\u5982\u679c\u53d1\u751f\u7b49\u5f85\uff0c\u5219\u8fd9\u4e2a\u7ebf\u7a0b\u80fd\u591f\u54cd\u5e94\u4e2d\u65ad\uff0c\u5373\u53ef\u4e2d\u65ad\u7ebf\u7a0b\u7684\u7b49\u5f85\u72b6\u6001\u3002</li> <li>tryLock\uff1atryLock\u65b9\u6cd5\u662f\u6709\u8fd4\u56de\u503c\u7684\uff0c\u5b83\u8868\u793a\u7528\u6765\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u5982\u679c\u83b7\u53d6\u6210\u529f\uff0c\u5219\u8fd4\u56detrue\uff0c\u5982\u679c\u83b7\u53d6\u5931\u8d25\uff08\u5373\u9501\u5df2\u88ab\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\uff09\uff0c\u5219\u8fd4\u56defalse\u3002</li> <li>tryLock\uff08long\uff0cTimeUnit\uff09\uff1a\u4e0etryLock\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u6709\u7b49\u5f85\u65f6\u95f4\uff0c\u5728\u7b49\u5f85\u65f6\u95f4\u5185\u83b7\u53d6\u5230\u9501\u8fd4\u56detrue\uff0c\u8d85\u65f6\u8fd4\u56defalse\u3002</li> <li>unlock\uff1a\u91ca\u653e\u9501\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#reentrantlocksynchronized","title":"ReentrantLock\u4e0esynchronized\u7684\u533a\u522b\uff1f","text":"<p>\u76f8\u540c\u70b9\u662f\u90fd\u662f\u53ef\u91cd\u5165\u9501\u3002</p> <p>\u4e0d\u540c\u70b9\u662f\uff1a</p> <ol> <li> <p>synchronized\u662fJava\u7684\u5173\u952e\u5b57\uff0c\u5b8c\u5168\u7531JVM\u5b9e\u73b0\uff1bLock \u662fJUC\u5305\u4e0b\u7684\u4e00\u4e2a\u63a5\u53e3\uff0cReentrantLock\u662fLock\u7684\u5b50\u7c7b\uff0c\u57fa\u4e8eAQS\u5b9e\u73b0\u3002</p> </li> <li> <p>synchronized\u80fd\u63d0\u4f9b\u7684\u529f\u80fd\uff0cReentrantLock\u90fd\u80fd\u63d0\u4f9b\uff0cReentrantLock\u76f8\u6bd4\u4e8esynchronized\u8fd8\u80fd\u63d0\u4f9b\u4e00\u4e9b\u66f4\u9ad8\u7ea7\u7684\u529f\u80fd\uff0c\u5305\u62ec\uff1a</p> </li> <li> <p>\u7b49\u5f85\u53ef\u4e2d\u65ad\uff1a\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\u53ef\u4ee5\u653e\u5f03\u7b49\u5f85\u3002</p> </li> <li> <p>\u516c\u5e73\u9501\uff1asynchronized\u662f\u975e\u516c\u5e73\u9501\uff0cReentrantLock\u9ed8\u8ba4\u4e5f\u662f\u975e\u516c\u5e73\u9501\u3002ReentrantLock\u53ef\u4ee5\u8bbe\u7f6e\u6210\u516c\u5e73\u9501\uff0c\u4e00\u65e6\u8bbe\u7f6e\u6210\u516c\u5e73\u9501\u4e4b\u540e\uff0c\u6027\u80fd\u4f1a\u6025\u5267\u4e0b\u964d\u3002</p> </li> <li> <p>\u652f\u6301\u591a\u4e2a\u6761\u4ef6\u53d8\u91cf</p> </li> <li> <p>\u5f02\u5e38\u662f\u5426\u91ca\u653e\u9501\uff1asynchronized \u5728\u53d1\u751f\u5f02\u5e38\u65f6\u5019\u4f1a\u81ea\u52a8\u91ca\u653e\u5360\u6709\u7684\u9501\uff0c\u56e0\u6b64\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u800c lock \u53d1\u751f\u5f02\u5e38\u65f6\u5019\uff0c\u4e0d\u4f1a\u4e3b\u52a8\u91ca\u653e\u5360\u6709\u7684\u9501\uff0c\u5fc5\u987b\u624b\u52a8 unlock \u6765\u91ca\u653e\u9501\uff0c\u53ef\u80fd\u5f15\u8d77\u6b7b\u9501\u7684\u53d1\u751f\u3002</p> </li> </ol> <p>\u6548\u7387\u65b9\u9762\uff0cJDK6\u5bf9synchronized\u8fdb\u884c\u9501\u4f18\u5316\u4e4b\u540e\uff0c\u4e8c\u8005\u5728\u6548\u7387\u5df2\u7ecf\u6ca1\u6709\u9ad8\u4f4e\u4e4b\u5206\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#semaphorecountdownlatchcyclicbarrier","title":"Semaphore\u3001CountDownLatch\u3001CyclicBarrier\uff1f","text":"<ul> <li>Semaphore(\u4fe1\u53f7\u91cf)\uff1a\u53ef\u4ee5\u6307\u5b9a\u8d44\u6e90\u6570\u76ee\uff0c\u62a2\u5230\u4e86\u5c31\u51cf1\uff0c\u7528\u5b8c\u540e\u91ca\u653e\u4f1a\u52a01\uff0c\u76f8\u5f53\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u91cc\u5b66\u7684pv\u64cd\u4f5c\u91cc\u7684\u4fe1\u53f7\u91cf</li> <li>CountDownLatch(\u5012\u8ba1\u65f6\u5668)\uff1a\u8c03\u7528countDownLatch.countDown();\u7684\u7ebf\u7a0b\u4f1a\u5c06\u8ba1\u6570\u5668\u51cf\u4e00\uff0c\u8c03\u7528countDownLatch.await();\u7684\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u8ba1\u6570\u5668\u51cf\u4e3a0\u3002\u4e5f\u5c31\u662f\u8c03\u7528countDownLatch.await();\u7684\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85\u6240\u6709\u8c03\u7528countDownLatch.countDown();\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u540e\u518d\u6267\u884c\u3002</li> <li>CyclicBarrier(\u5faa\u73af\u6805\u680f)\uff1a \u6bcf\u4e2a\u7ebf\u7a0bawait\u7684\u65f6\u5019\u4f1a\u505c\u4e0b\u6765\u7b49\u5f85\uff0c\u5f53\u5230\u8fbe10\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u89e6\u53d1CyclicBarrier\u4e2d\u7684\u4efb\u52a1\uff0cCyclicBarrier\u4e2d\u7684\u4efb\u52a1\u4e2d\u7684\u4efb\u52a1\u5b8c\u6210\u65f6\u5c31\u4f1a\u5524\u9192\u6240\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0cCyclicBarrier \u7684\u5b57\u9762\u610f\u601d\u662f\u53ef\u5faa\u73af\u4f7f\u7528\uff0c\u6240\u4ee5\u79f0\u4e3a\u5faa\u73af\u8ba1\u6570\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#java_1","title":"Java\u4e2d\u54ea\u4e9b\u96c6\u5408\u7c7b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff1f","text":"<p>JDK1.0\u5c31\u6709\u7684\u4e09\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b\uff1aVector\u3001HashTable\u3001Stack</p> <p>Collections\u7684\u5305\u88c5\u65b9\u6cd5</p> Java<pre><code>List&lt;E&gt; synArrayList = Collections.synchronizedList(new ArrayList&lt;E&gt;());\nSet&lt;E&gt; synHashSet = Collections.synchronizedSet(new HashSet&lt;E&gt;());\nMap&lt;K,V&gt; synHashMap = Collections.synchronizedMap(new HashMap&lt;K,V&gt;());\n</code></pre> <p>JUC\u5305\uff1a</p> <ul> <li>CopyOnWriteArrayList \u3001CopyOnWriteArraySet\uff0c\u5199\u65f6\u590d\u5236\uff0c\u8bfb\u5199\u4e0d\u4e92\u65a5\uff0c\u5199\u5199\u4e92\u65a5\uff0c\u4e5f\u5c31\u662f\u5199\u7684\u65f6\u5019\u4f1a\u52a0\u9501\uff0c\u8bfb\u7684\u65f6\u5019\u4e0d\u4f1a\u52a0\u9501\u3002</li> <li>ConcurrentHashMap\u3001ConcurrentSkipListMap\u3001ConcurrentSkipListSet</li> <li>\u975e\u963b\u585e\u7ebf\u7a0b\u5b89\u5168\u961f\u5217\uff1aConcurrentLinkedQueue\u3001ConcurrentLinkedDeque</li> <li>\u963b\u585eBolckingQueue\u7684\u5b9e\u73b0\u7c7b\uff1aArrayBlockingQueue\u3001LinkedBlockingQueue\u3001SynchronousQueue\u3001PriorityBlockingQueue\u3001DelayQueue</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_9","title":"\u5e76\u53d1\u7f16\u7a0b\u603b\u7ed3","text":"<p>\u5e76\u53d1\u7f16\u7a0b\u5927\u81f4\u5305\u62ec\u4e24\u5757\uff1a</p> <ul> <li>\u521b\u5efa\u7ebf\u7a0b\uff1aThread\u7c7b\u548cRunnable\u63a5\u53e3 -&gt; \u7ebf\u7a0b\u6c60 -&gt; Callable\u63a5\u53e3\u548cFutureTask -&gt; CompletableFuture</li> <li>\u7ebf\u7a0b\u540c\u6b65\uff1a\u9501\uff08synchronized\u3001ReentrantLock\u3001ReadWriteLock\uff09 -&gt; volatile -&gt; \u540c\u6b65\u5668\uff08CountDownLatch\u3001CyclicBarrier\u3001Semaphore\uff09 -&gt; \u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\uff08Collections.synchronizedList(new ArrayList&lt;&gt;())\u3001CopyOnWriteArrayList\u3001ConcurrentHashMap\u3001BolckingQueue\uff09-&gt; \u539f\u5b50\u7c7b\uff08AtomicInteger\u3001AtomicReference\u3001LongAdder\uff09 -&gt; \u65e0\u9501\uff08CAS\uff09</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_10","title":"\u539f\u7406","text":""},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_11","title":"\u4ec0\u4e48\u662f\u7f13\u5b58\u4e00\u81f4\u6027\uff1f","text":"<p>\u4ec0\u4e48\u662f\u9ad8\u901f\u7f13\u5b58\uff1f\u7531\u4e8e\u5904\u7406\u5668\u7684\u8ba1\u7b97\u901f\u5ea6\u4e0e\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u5b58\u5728\u7740\u51e0\u4e2a\u6570\u91cf\u7ea7\u7684\u5dee\u5f02\uff0c\u6240\u4ee5\u4e0d\u5f97\u4e0d\u5728\u5904\u7406\u5668\u548c\u5185\u5b58\u4e4b\u95f4\u52a0\u4e00\u5c42\u6216\u8005\u591a\u5c42\u8bfb\u5199\u901f\u5ea6\u5c3d\u53ef\u80fd\u63a5\u8fd1\u5904\u7406\u5668\u8fd0\u7b97\u901f\u5ea6\u7684\u9ad8\u901f\u7f13\u5b58\uff08cache\uff09\u3002\u8fd0\u7b97\u65f6\u5c06\u6240\u9700\u8981\u7684\u6570\u636e\u5148\u590d\u5236\u5230\u7f13\u5b58\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u5904\u7406\u5668\u66f4\u5feb\u8bbf\u95ee\u5230\u6570\u636e\uff0c\u8fd0\u7b97\u7ed3\u675f\u540e\u518d\u628a\u7f13\u5b58\u4e2d\u7684\u7ed3\u679c\u540c\u6b65\u5230\u5185\u5b58\uff0c\u8fd9\u6837\u867d\u7136\u89e3\u51b3\u4e86\u5904\u7406\u5668\u4e0e\u5185\u5b58\u5728\u901f\u5ea6\u4e0a\u7684\u77db\u76fe\uff0c\u4f46\u53c8\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff0c\u5373\u7f13\u5b58\u4e00\u81f4\u6027\u3002</p> <p>\u4ec0\u4e48\u662f\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898\uff1f\u5728\u6709\u591a\u4e2a\u5904\u7406\u5668\u7684\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e2a\u5904\u7406\u5668\u90fd\u6709\u81ea\u5df1\u7684\u9ad8\u901f\u7f13\u5b58\uff0c\u5f53\u591a\u4e2a\u5904\u7406\u5668\u7684\u8fd0\u7b97\u4efb\u52a1\u90fd\u6d89\u53ca\u540c\u4e00\u5757\u4e3b\u5185\u5b58\u533a\u57df\u65f6\uff0c\u5c06\u5bfc\u81f4\u5404\u81ea\u7684\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c06\u6570\u636e\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u65f6\u4ee5\u8c01\u7684\u6570\u636e\u4e3a\u51c6\u662f\u4e2a\u95ee\u9898\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898\u3002\u4e3a\u89e3\u51b3\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u9700\u8981\u5404\u4e2a\u5904\u7406\u5668\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\u9075\u5faa\u4e00\u4e9b\u534f\u8bae\u4ee5\u8fbe\u5230\u7f13\u5b58\u4e00\u81f4\u6027\uff0c\u5982MESI\u534f\u8bae\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#java_2","title":"Java\u5185\u5b58\u6a21\u578b\uff1f","text":"<p>\uff08\u4e66\u9762\u5316\uff1aJava\u5185\u5b58\u6a21\u578b\uff08JMM\uff09\u662f\u5bf9\u5185\u5b58\u4e2d\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u8bbf\u95ee\u8fc7\u7a0b\u7684\u4e00\u4e2a\u62bd\u8c61\uff0c\u4e3a\u7684\u662f\u5c4f\u853d\u5404\u79cd\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u8bbf\u95ee\u5dee\u5f02\uff0c\u5b9e\u73b0\u4e00\u79cd\u4e00\u81f4\u7684\u5185\u5b58\u8bbf\u95ee\u6548\u679c\u3002JMM\u5b9a\u4e49\u4e86\u7a0b\u5e8f\u4e2d\u53d8\u91cf\u7684\u8bbf\u95ee\u89c4\u5219\uff0c\u5373\u89c4\u5b9a\u6240\u6709\u53d8\u91cf\u90fd\u5b58\u50a8\u5728\u4e3b\u5b58\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58\uff0c\u5de5\u4f5c\u5185\u5b58\u4fdd\u5b58\u4e86\u7ebf\u7a0b\u4f7f\u7528\u5230\u7684\u4e3b\u5185\u5b58\u53d8\u91cf\u7684\u526f\u672c\uff0c\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u7684\u64cd\u4f5c\u5fc5\u987b\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u8fdb\u884c\uff0c\u4e0d\u80fd\u76f4\u63a5\u8bfb\u5199\u4e3b\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u4e5f\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5bf9\u65b9\u7684\u5de5\u4f5c\u5185\u5b58\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u53d8\u91cf\u503c\u7684\u4f20\u9012\u5fc5\u987b\u901a\u8fc7\u4e3b\u5185\u5b58\u5b8c\u6210\u3002\uff09</p> <p>\u53e3\u8bed\u5316\uff1aJava\u5185\u5b58\u6a21\u578b\u662fJava\u865a\u62df\u673a\u89c4\u8303\u4e3a\u5c4f\u853d\u5404\u79cd\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u8bbf\u95ee\u5dee\u5f02\u6240\u5b9a\u4e49\u7684\u4e00\u79cd\u7edf\u4e00\u7684\u5185\u5b58\u8bbf\u95ee\u6a21\u578b\u3002JMM\u5206\u4e3a\u4e3b\u5185\u5b58\u548c\u5de5\u4f5c\u5185\u5b58\u4e24\u90e8\u5206\uff0c\u4e3b\u5185\u5b58\u53ea\u6709\u4e00\u4e2a\uff0c\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\uff0c\u6240\u6709\u53d8\u91cf\u90fd\u5b58\u50a8\u5728\u4e3b\u5b58\u4e2d\uff1b\u800c\u5de5\u4f5c\u5185\u5b58\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u72ec\u6709\u7684\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u5de5\u4f5c\u5185\u5b58\uff0c\u5de5\u4f5c\u5185\u5b58\u4fdd\u5b58\u4e86\u7ebf\u7a0b\u4f7f\u7528\u5230\u7684\u4e3b\u5185\u5b58\u53d8\u91cf\u7684\u526f\u672c\uff0c\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u7684\u64cd\u4f5c\u5fc5\u987b\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u8fdb\u884c\uff0c\u4e0d\u80fd\u76f4\u63a5\u8bfb\u5199\u4e3b\u5185\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u4e5f\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5bf9\u65b9\u7684\u5de5\u4f5c\u5185\u5b58\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u53d8\u91cf\u503c\u7684\u4f20\u9012\u5fc5\u987b\u901a\u8fc7\u4e3b\u5185\u5b58\u5b8c\u6210\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_12","title":"\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u3001\u6709\u5e8f\u6027\uff1f","text":"<p>\u60f3\u8981\u5b9e\u73b0\u5e76\u53d1\uff0c\u9996\u5148\u8981\u89e3\u51b3\u5e95\u5c42\u6307\u4ee4\u5e76\u53d1\u64cd\u4f5c\u5e26\u6765\u7684\u4e09\u4e2a\u57fa\u672c\u95ee\u9898\uff1a\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\uff0c\u8fd9\u4e09\u4e2a\u7279\u6027\u662f\u5e76\u53d1\u7a0b\u5e8f\u8fd0\u884c\u7684\u57fa\u7840\uff08\u5728\u601d\u8003\u8fd9\u4e9b\u57fa\u672c\u539f\u5219\u7684\u65f6\u5019\u8981\u8df3\u51fa\u4f60\u7684\u60ef\u6027\u601d\u7ef4\uff0c\u7406\u6240\u5e94\u5f53\u7684\u4e1c\u897f\u5728\u5e95\u5c42\u4e5f\u662f\u9700\u8981\u4f9d\u9760\u5408\u7406\u7684\u8bbe\u8ba1\u6765\u5b9e\u73b0\u7684\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_13","title":"\u539f\u5b50\u6027\uff1f","text":"<p>\u9996\u5148\u8981\u89e3\u51b3\u7684\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u539f\u5b50\u8bfb\u5199\uff0c\u4e0d\u80fd\u51fa\u73b0\u4e00\u4e2a\u7ebf\u7a0blong\u53d8\u91cf\u5199\u4e00\u534a\uff0c\u7136\u540e\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5374\u8bfb\u5230\u4e86\u8fd9\u4e2along\u53d8\u91cf\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u8fd9\u4e2a\u7531Java\u5185\u5b58\u6a21\u578b\u76f4\u63a5\u4fdd\u8bc1\uff08\u901a\u5e38\u6765\u8bf432\u4f4d\u8ba1\u7b97\u673a\u5bf932\u4f4d\u7684\u53d8\u91cf\u7684\u64cd\u4f5c\u90fd\u662f\u5177\u6709\u539f\u5b50\u6027\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e64\u4f4d\u7684\u53d8\u91cf\u5982long\u4e0d\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u6240\u4ee5\u9700\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff09\u3002\u7136\u540e\u66f4\u8fdb\u4e00\u6b65\u7684\u9700\u8981\u89e3\u51b3\u7684\u66f4\u5927\u8303\u56f4\u7684\u539f\u5b50\u6027\u4fdd\u8bc1\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7531synchronized\u6765\u4fdd\u8bc1\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_14","title":"\u53ef\u89c1\u6027\uff1f","text":"<p>\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u7684\u5199\u8981\u80fd\u88ab\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u8bfb\u5230\uff08\u6ce8\u610f\u8fd9\u91cc\u4e0d\u662f\u7acb\u5373\u8bfb\u5230\uff09\uff0c\u8fd9\u4e2a\u770b\u4f3c\u5e73\u5e38\u5e76\u4e14\u7406\u6240\u5e94\u5f53\u7684\u8981\u6c42\u540c\u6837\u9700\u8981\u4f9d\u9760jvm\u6765\u5b9e\u73b0\uff0cJava\u5185\u5b58\u6a21\u578b\u89c4\u5b9a\u5728\u53d8\u91cf\u4fee\u6539\u4e4b\u540e\u8981\u5c06\u65b0\u503c\u540c\u6b65\u5230\u4e3b\u5185\u5b58\uff0c\u5728\u53d8\u91cf\u8bfb\u53d6\u524d\u9700\u8981\u4ece\u4e3b\u5185\u5b58\u5237\u65b0\u53d8\u91cf\u503c\uff0c\u901a\u8fc7\u8fd9\u79cd\u4f9d\u8d56\u4e3b\u5185\u5b58\u4f5c\u4e3a\u4f20\u9012\u5a92\u4ecb\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u53ef\u89c1\u6027\u3002\u5982\u679c\u60f3\u8981\u4fdd\u8bc1\u53d8\u91cf\u7684\u4fee\u6539\u53ef\u4ee5\u7acb\u5373\u88ab\u5176\u4ed6\u7ebf\u7a0b\u8bfb\u5230\uff0c\u53ef\u4ee5\u52a0\u4e0avolatile\u5173\u952e\u5b57\u3002\u9664volatile\u5916\uff0csynchronized\u548cfinal\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u8fd9\u79cd\u7acb\u5373\u53ef\u89c1\u6027\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_15","title":"\u6709\u5e8f\u6027\uff1f","text":"<p>\u9996\u5148\u7a0b\u5e8f\u6700\u57fa\u672c\u7684\u7406\u6240\u5e94\u5f53\u7684\u6709\u5e8f\u6027\u662f\u4f9d\u9760\u5148\u884c\u53d1\u751f\u539f\u5219\u6765\u4fdd\u8bc1\u7684\uff0c\u7136\u540e\u5bf9\u4e8e\u5e76\u53d1\u7a0b\u5e8f\u7684\u6709\u5e8f\u6027\u53ef\u4ee5\u4f9d\u9760volatile\u548csynchronized\u6765\u4fdd\u8bc1\uff0c\u5176\u4e2dvolatile\u53ea\u80fd\u7981\u6b62volatile\u53d8\u91cf\u524d\u540e\u6307\u4ee4\u91cd\u6392\u5e8f\u7684\u8bed\u4e49\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#happens-before","title":"Happens-Before\u539f\u5219\u662f\u4ec0\u4e48\uff1f","text":"<p>Happens-Before\uff08\u5148\u884c\u53d1\u751f\u539f\u5219\uff09\u662fJava\u5185\u5b58\u6a21\u578b\u4e2d\u5b9a\u4e49\u7684\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u7684\u504f\u5e8f\u5173\u7cfb\uff0c\u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u6ee1\u8db3Happens-Before\u539f\u5219\uff0c\u90a3\u4e48Java\u865a\u62df\u673a\u5c06\u4e0d\u80fd\u5bf9\u5176\u8fdb\u884c\u91cd\u6392\u5e8f\u3002Happens-Before\u539f\u5219\u67098\u6761\u3002\u5148\u884c\u53d1\u751f\u539f\u5219\u4fdd\u8bc1\u4e86\u7a0b\u5e8f\u7684\u90a3\u79cd\u7406\u6240\u5e94\u5f53\u7684\u6709\u5e8f\u6027\uff0c\u8fd9\u79cd\u7406\u6240\u5e94\u5f53\u7684\u6709\u5e8f\u6027\u5176\u5b9e\u4e5f\u662f\u9700\u8981\u4f9d\u8d56\u5e95\u5c42\u7684\u8bbe\u8ba1\u53bb\u5b9e\u73b0\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#volatilesynchronized","title":"volatile\u548csynchronized\u7684\u533a\u522b\uff1f","text":"<p>volatile\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u9501\uff0cvolatile\u4fdd\u8bc1\u4e86\u53d8\u91cf\u8bbf\u95ee\u7684\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\uff0c\u4f46\u6ca1\u6709\u4fdd\u8bc1\u539f\u5b50\u6027\uff1bsynchronized\u90fd\u4fdd\u8bc1\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#volatile","title":"\u8c08\u8c08\u4f60\u5bf9volatile\u5173\u952e\u5b57\u7684\u7406\u89e3\uff1f","text":"<ul> <li> <p>\u4fdd\u8bc1\u4e86\u53d8\u91cf\u7684\u53ef\u89c1\u6027\uff0cvolatile\u53ef\u4ee5\u4fdd\u8bc1\u53d8\u91cf\u5bf9\u6240\u6709\u7ebf\u7a0b\u7684\u53ef\u89c1\u6027\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u8bbf\u95eevolatile\u53d8\u91cf\u90fd\u80fd\u4fdd\u8bc1\u5b83\u7684\u503c\u662f\u4e3b\u5185\u5b58\u4e2d\u7684\u6700\u65b0\u503c\u3002\u4e0d\u52a0volatile\u65f6\uff0c\u7ebf\u7a0b\u5bf9\u5de5\u4f5c\u5185\u5b58\u4e2d\u53d8\u91cf\u7684\u4fee\u6539\u4e0d\u80fd\u53ca\u65f6\u88ab\u5176\u5b83\u540c\u6837\u4e5f\u4f7f\u7528\u4e86\u8be5\u53d8\u91cf\u7684\u7ebf\u7a0b\u611f\u77e5\u5230\uff0c\u52a0\u4e0a\u4e4b\u540e\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u503c\u7684\u4fee\u6539\u5c31\u80fd\u591f\u7acb\u5373\u88ab\u5176\u5b83\u7ebf\u7a0b\u6240\u611f\u77e5\u5230\u3002</p> </li> <li> <p>\u53ef\u4ee5\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u3002\u4e5f\u5c31\u662f\u7981\u6b62\u91cd\u6392\u8bfb\u5199volatile\u5173\u952e\u5b57\u4fee\u9970\u7684\u53d8\u91cf\u524d\u540e\u7684\u6307\u4ee4\u3002</p> </li> </ul> <p>\u5b9e\u73b0\u539f\u7406\uff1a\u5728\u7a0b\u5e8f\u751f\u6210\u6c47\u7f16\u4ee3\u7801\u540e\uff0c\u8bbf\u95eevolatile\u53d8\u91cf\u7684\u6307\u4ee4\u7684\u540e\u9762\u4f1a\u6dfb\u52a0\u4e00\u4e2a\u7a7a\u64cd\u4f5c\u7684\u6c47\u7f16\u6307\u4ee4\uff0c\u8fd9\u4e2a\u7a7a\u64cd\u4f5c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5185\u5b58\u5c4f\u969c\uff0c\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u5c06\u672c\u5904\u7406\u5668\u7684\u7f13\u5b58\u5199\u5230\u5185\u5b58\u4e2d\uff0c\u5e76\u4e14\u4f1a\u5f15\u8d77\u5176\u5b83\u6838\u7684\u7f13\u5b58\u5931\u6548\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u53ef\u89c1\u6027\uff0c\u5e76\u4e14\u8fd9\u4e2a\u7a7a\u64cd\u4f5c\u8fd8\u53ef\u4ee5\u4fdd\u8bc1\u6307\u4ee4\u91cd\u6392\u5e8f\u65e0\u6cd5\u8d8a\u8fc7\u5185\u5b58\u5c4f\u969c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#cas","title":"CAS\u64cd\u4f5c\uff1f","text":"<p>CAS\u64cd\u4f5c\u6307\u7684\u662f\u6bd4\u8f83\u5e76\u4ea4\u6362\uff08Compare And Swap\uff09\uff0c\u7531\u786c\u4ef6\u6307\u4ee4\u63d0\u4f9b\u652f\u6301\uff0c\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u3002\u5728Java\u4e2d\u7684CAS\u64cd\u4f5c\u5c31\u662fUnsafe\u7c7b\u63d0\u4f9b\u7684\u51e0\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u51e0\u4e2a\u65b9\u6cd5\u5373\u65f6\u7f16\u8bd1\u7684\u7ed3\u679c\u5c31\u662f\u4e0e\u5904\u7406\u5668\u76f8\u5173\u7684CAS\u6307\u4ee4\uff0c\u4e0d\u8fc7\u6211\u4eec\u4e00\u822c\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528Unsafe\u7c7b\uff0c\u9700\u8981\u901a\u8fc7\u5176\u5b83\u7684\u7c7b\u5982\u539f\u5b50\u7c7b\u6765\u95f4\u63a5\u7684\u8bbf\u95ee\u5b83\u3002</p> <p>CAS\u64cd\u4f5c\u7684\u6267\u884c\u8fc7\u7a0b\u662f\uff0c\u6301\u6709\u4e00\u4e2a\u53d8\u91cf\u7684\u5185\u5b58\u4f4d\u7f6e\uff0c\u65e7\u7684\u9884\u671f\u503c\u548c\u51c6\u5907\u8bbe\u7f6e\u7684\u65b0\u503c\uff0c\u66f4\u65b0\u65f6\u5148\u68c0\u67e5\u53d8\u91cf\u7684\u503c\u662f\u5426\u4e0e\u65e7\u7684\u9884\u671f\u503c\u76f8\u540c\uff0c\u5982\u679c\u76f8\u540c\u5219\u66f4\u65b0\u4e3a\u65b0\u503c\uff0c\u8fd4\u56detrue\uff1b\u5982\u679c\u4e0d\u540c\u5219\u66f4\u65b0\u5931\u8d25\uff0c\u8fd4\u56defalse\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#aba","title":"ABA\u95ee\u9898\uff1f","text":"<p>\u8fd9\u662fCAS\u7684\u64cd\u4f5c\u903b\u8f91\u5e26\u6765\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u66f4\u65b0\u65f6\u53d8\u91cf\u7684\u503c\u7b49\u4e8e\u65e7\u7684\u9884\u671f\u503c\u5e76\u4e0d\u4ee3\u8868\u8fd9\u4e2d\u95f4\u53d8\u91cf\u7684\u503c\u6ca1\u6709\u53d1\u751f\u8fc7\u53d8\u5316\uff0c\u4f46\u6309CAS\u64cd\u4f5c\u7684\u903b\u8f91\u662f\u53ef\u4ee5\u66f4\u65b0\u6210\u529f\u7684\uff0c\u8fd9\u5c31\u662fABA\u95ee\u9898\uff0c\u6bd4\u5982\u6709\u65f6\u5019\u9700\u8981\u53cc\u5199\u53cc\u5220\u6765\u786e\u4fdd\u6570\u636e\u7684\u51c6\u786e\u6027\uff0c\u8fd9\u4e2a\u91cd\u590d\u5199\u5165\u548c\u5220\u9664\u5c31\u53ef\u80fd\u4f1a\u56e0\u4e3aABA\u9020\u6210\u95ee\u9898\uff0c\u4f8b\u5982\u60f3\u4ece100\u4e0a\u51cf\u53bb50\uff0c\u4e3a\u786e\u4fdd\u6210\u529f\u51cf\u53bb50\uff0c100-50\u8981\u64cd\u4f5c\u4e24\u6b21\uff0c\u4f46\u53ea\u80fd\u6210\u529f\u4e00\u6b21\uff0c\u4e0d\u5de7\u7684\u662f\u5728\u4e24\u6b21\u51cf50\u7684\u64cd\u4f5c\u4e2d\u95f4\uff0c\u6709\u5176\u4ed6\u7ebf\u7a0b\u52a0\u4e8650\uff0c\u90a3\u4e48\u5c31\u4f1a\u9020\u6210\u4e24\u6b21\u51cf50\u7684\u64cd\u4f5c\u90fd\u80fd\u6210\u529f\uff0c\u4e8e\u662fABA\u5c31\u9020\u6210\u4e86\u95ee\u9898\u3002</p> <p>\u89e3\u51b3\uff1a\u4f7f\u7528\u5e26\u6233\u7684\u539f\u5b50\u5f15\u7528\u7c7bAtomicStampedReference\uff0c\u6233\u5c31\u662f\u4e00\u4e2a\u8868\u793a\u7248\u672c\u7684\u53d8\u91cf\uff0c\u6bcf\u6b21\u66f4\u65b0\u503c\u6210\u529f\u4e4b\u540e\u90fd\u9700\u8981\u5c06\u6233\u7684\u503c\u52a01\u3002\u8fd9\u6837\u6bcf\u6b21\u4f7f\u7528\u8be5\u539f\u5b50\u5f15\u7528\u7c7b\u66f4\u65b0\u503c\u7684\u65f6\u5019\uff0c\u4e0d\u4f46\u8981\u6bd4\u8f83\u6b64\u65f6\u7684\u503c\u662f\u4e0d\u662f\u539f\u6765\u7684\u503c\uff0c\u8fd8\u8981\u6bd4\u8f83\u6b64\u65f6\u7684\u6233\u662f\u4e0d\u662f\u539f\u6765\u7684\u6233\uff0c\u5f53\u51fa\u73b0ABA\u95ee\u9898\u65f6\uff0c\u7531\u4e8e\u6233\u662f\u9012\u589e\u7684\uff0c\u6240\u4ee5\u5e76\u4e0d\u4f1a\u66f4\u65b0\u6210\u529f\uff0c\u4ece\u800c\u89e3\u51b3ABA\u95ee\u9898\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_16","title":"\u60b2\u89c2\u9501\u548c\u4e50\u89c2\u9501\uff1f","text":"<p>\u60b2\u89c2\u9501\u662f\u4e00\u79cd\u963b\u585e\u540c\u6b65\u673a\u5236\uff0c\u800c\u4e50\u89c2\u9501\u662f\u4e00\u79cd\u975e\u963b\u585e\u540c\u6b65\u673a\u5236\uff0c\u4e5f\u79f0\u4e3a\u65e0\u9501\u3002</p> <p>\u60b2\u89c2\u9501\u5728\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u4e4b\u524d\u603b\u662f\u5148\u52a0\u9501\uff0c\u65e0\u8bba\u662f\u5426\u51fa\u73b0\u7ade\u4e89\uff0c\u53ea\u6709\u52a0\u9501\u6210\u529f\u624d\u80fd\u8fdb\u884c\u64cd\u4f5c\uff0c\u52a0\u9501\u5931\u8d25\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u963b\u585e\u548c\u5524\u9192\u7ebf\u7a0b\u4f1a\u5e26\u6765\u6027\u80fd\u4e0a\u7684\u5f00\u9500\u3002</p> <p>\u4f46\u4e50\u89c2\u9501\u4e0d\u4e00\u6837\uff0c\u4ed6\u5728\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u4e4b\u524d\u5e76\u4e0d\u4f1a\u52a0\u9501\uff0c\u800c\u662f\u5148\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u64cd\u4f5c\u6570\u636e\uff0c\u6700\u540e\u518d\u628a\u7ed3\u679c\u5199\u56de\u53bb\uff0c\u4e0d\u8fc7\u5728\u5199\u56de\u53bb\u7684\u65f6\u5019\u8981\u68c0\u67e5\u4e00\u4e0b\u6570\u636e\u662f\u5426\u4e0e\u8bfb\u7684\u65f6\u5019\u4e00\u6837\uff0c\u4e00\u6837\u5c31\u66f4\u65b0\u6210\u529f\uff0c\u4e0d\u4e00\u6837\u5c31\u4f1a\u66f4\u65b0\u5931\u8d25\uff0c\u5931\u8d25\u4e4b\u540e\u7684\u8865\u507f\u63aa\u65bd\u662f\u4e0d\u65ad\u91cd\u8bd5\u76f4\u81f3\u6210\u529f\uff0c\u8fd9\u79cd\u4e50\u89c2\u7684\u5e76\u53d1\u7b56\u7565\u4e0d\u9700\u8981\u5c06\u7ebf\u7a0b\u963b\u585e\u6302\u8d77\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4e3a\u975e\u963b\u585e\u540c\u6b65\uff08\u6570\u636e\u5e93\u4e2d\u7684\u4e50\u89c2\u9501\u66f4\u65b0\u5931\u8d25\u7684\u7ed3\u679c\u662f\u5c31\u662f\u66f4\u65b0\u5931\u8d25\uff0c\u6ca1\u6709\u7ebf\u7a0b\u963b\u585e\u6302\u8d77\u7684\u64cd\u4f5c\uff09\u3002</p> <p>\u4e50\u89c2\u9501\u5e95\u5c42\u5b9e\u73b0\u9700\u8981\u786c\u4ef6\u6307\u4ee4\u7684\u652f\u6301\uff0c\u901a\u5e38\u662f\u5b8c\u6210CAS\u64cd\u4f5c\u7684\u539f\u5b50\u6307\u4ee4\uff0c\u5728Java\u4e2d\u7684\u4f7f\u7528\u4e50\u89c2\u9501\u662f\u901a\u8fc7\u7531Unsafe\u7c7b\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#aqs","title":"AQS\uff1f","text":"<p>AQS\u662fJUC\u5305\u4e0b\u7684\u4e00\u4e2a\u62bd\u8c61\u7c7bAbstractQueuedSynchronizer\uff0c\u57fa\u4e8eUnsafe\u7c7b\u63d0\u4f9b\u7684CAS\u64cd\u4f5c\u4ee5\u53capark()\u4e0eunpark()\u65b9\u6cd5\u5b9e\u73b0\uff0c\u662f\u4e00\u4e2a\u7528\u4e8e\u5b9e\u73b0\u9501\u548c\u5404\u79cd\u7ebf\u7a0b\u540c\u6b65\u5de5\u5177\u7684\u57fa\u4e8e\u6a21\u677f\u65b9\u6cd5\u7684\u6846\u67b6\uff0cJUC\u4e0b\u7684\u9501\u4ee5\u540c\u6b65\u5668\uff08Semaphore\u3001CountDownLatch\u3001CyclicBarrier\uff09\u90fd\u662f\u57fa\u4e8eAQS\u5b9e\u73b0\u7684\u3002</p> <p>AQS \u4f7f\u2f64\u2f00\u4e2a int \u6210\u5458\u53d8\u91cfstate\u6765\u8868\u793a\u540c\u6b65\u72b6\u6001\uff0c\u4f7f\u2f64 CAS \u5bf9\u8be5\u540c\u6b65\u72b6\u6001\u8fdb\u2f8f\u539f\u2f26\u64cd\u4f5c\u5b9e\u73b0\u5bf9\u5176\u7684\u4fee\u6539\uff0c\u901a\u8fc7LockSupport\u7684park()\u4e0eunpark()\u5b9e\u73b0\u7ebf\u7a0b\u7684\u963b\u585e\u548c\u5524\u9192\uff0c\u901a\u8fc7\u5185\u90e8\u7684 FIFO \u961f\u5217\u6765\u5b8c\u6210\u7ebf\u7a0b\u7684\u6392\u961f\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#reentrantlock","title":"ReentrantLock\u7684\u5b9e\u73b0\uff1f","text":"<p>AQS\u5bf9\u8c61\u5185\u90e8\u6709\u4e00\u4e2a\u6838\u5fc3\u7684\u53d8\u91cf\u53eb\u505astate\uff08\u7c7b\u4f3c\u4e8esynchronized monitor\u7684recursions\uff09\uff0c\u662fint\u7c7b\u578b\u7684\uff0c\u4ee3\u8868\u4e86\u52a0\u9501\u7684\u72b6\u6001\uff0c\u521d\u59cb\u72b6\u6001\u4e0b\uff0c\u8fd9\u4e2astate\u7684\u503c\u662f0\u3002</p> <p>\u8fd9\u4e2aAQS\u5185\u90e8\u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u53d8\u91cf\u53eb\u505aexclusiveOwnerThread\uff08AQS\u4eceAbstractOwnableSynchronizer\u7ee7\u627f\u800c\u6765\uff0c\uff08\u7c7b\u4f3c\u4e8esynchronized monitor\u7684owner\uff09\uff0c\u7528\u6765\u8bb0\u5f55\u5f53\u524d\u52a0\u9501\u7684\u662f\u54ea\u4e2a\u7ebf\u7a0b\uff0c\u521d\u59cb\u5316\u72b6\u6001\u4e0b\uff0c\u8fd9\u4e2a\u53d8\u91cf\u662fnull\u3002</p> <p>ReentrantLock\u975e\u516c\u5e73\u9501\u7684\u52a0\u9501\u8fc7\u7a0b\uff1a\u9996\u5148\u8c03\u7528CAS\u64cd\u4f5c\u5c06state\u503c\u4ece0\u53d8\u4e3a1\uff0c\u5982\u679cCAS\u64cd\u4f5c\u6210\u529f\uff0c\u5219\u8868\u793a\u52a0\u9501\u6210\u529f\uff0c\u63a5\u7740\u628aexclusiveOwnerThread\u8bbe\u7f6e\u4e3a\u81ea\u5df1\uff0c\u5982\u679cCAS\u64cd\u4f5c\u5931\u8d25\u4e86\u5c31\u518d\u68c0\u67e5\u4e00\u4e0bexclusiveOwnerThread\u662f\u4e0d\u662f\u81ea\u5df1\uff0c\u5982\u679c\u662f\u81ea\u5df1\uff0c\u5c31\u628astate\u52a01\uff0c\u8fd9\u5c31\u662f\u53ef\u91cd\u5165\u7684\u903b\u8f91\uff0c\u5982\u679c\u4e0d\u662f\u81ea\u5df1\uff0c\u5c31\u628a\u81ea\u5df1\u6302\u8d77\u5230\u7b49\u5f85\u961f\u5217\u4e2d\u3002</p> <p>ReentrantLock\u975e\u516c\u5e73\u9501\u7684\u91ca\u653e\u9501\u8fc7\u7a0b\uff1a\u5148\u628astate\u53d8\u91cf\u51cf1\uff0c\u5982\u679c\u51cf\u5b8c\u4e4b\u540e\u53d8\u91cf\u7684\u503c\u53d8\u4e3a0\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u628aexclusiveOwnerThread\u8bbe\u7f6e\u4e3anull\uff0c\u7136\u540e\u5524\u9192\u7b49\u5f85\u961f\u5217\u961f\u9996\u7684\u7ebf\u7a0b\uff0c\u81f3\u6b64\u8be5\u7ebf\u7a0b\u4e5f\u5c31\u5f7b\u5e95\u91ca\u653e\u4e86\u9501\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_17","title":"\u4e3a\u4ec0\u4e48\u975e\u516c\u5e73\u9501\u6bd4\u516c\u5e73\u9501\u7684\u6027\u80fd\u66f4\u9ad8\uff1f","text":"<p>\u516c\u5e73\u9501\u4f1a\u5728\u83b7\u53d6\u9501\u7684\u65f6\u5019\u5148\u68c0\u67e5\u7b49\u5f85\u961f\u5217\u662f\u5426\u7a7a\uff0c\u5982\u679c\u4e3a\u7a7a\u5219\u76f4\u63a5\u83b7\u53d6\uff0c\u5982\u679c\u4e0d\u4e3a\u7a7a\u5219\u8fdb\u5165\u7b49\u5f85\u961f\u5217\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u516c\u5e73\uff0c\u5373\u5148\u6765\u7ebf\u7a0b\u5148\u83b7\u53d6\u9501\uff1b\u800c\u975e\u516c\u5e73\u9501\u5e76\u4e0d\u4f1a\u4fdd\u8bc1\u5148\u5230\u5148\u5f97\uff0c\u5728\u83b7\u53d6\u975e\u516c\u5e73\u9501\u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u76f4\u63a5\u5c1d\u8bd5\u83b7\u53d6\uff0c\u5982\u679c\u6210\u529f\u5c31\u83b7\u5f97\u4e86\u9501\uff0c\u5982\u679c\u5931\u8d25\u624d\u4f1a\u8fdb\u5165\u7b49\u5f85\u961f\u5217\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u7ebf\u7a0b\u88ab\u6302\u8d77\u548c\u5524\u9192\u7684\u6b21\u6570\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u7684\u6302\u8d77\u548c\u5524\u9192\u90fd\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u6d89\u53ca\u5230\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\u4ee5\u53ca\u4e0a\u4e0b\u6587\u7684\u5207\u6362\uff0c\u51cf\u5c11\u7ebf\u7a0b\u88ab\u6302\u8d77\u548c\u5524\u9192\u7684\u6b21\u6570\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u5f00\u9500\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#jdk6synchronized","title":"JDK6\u5bf9synchronized\u9501\u8fdb\u884c\u4e86\u90a3\u4e48\u4f18\u5316\uff1f","text":"<p>JDK6\u5b9e\u73b0\u4e86\u5404\u79cd\u9501\u4f18\u5316\u6280\u672f\uff0c\u5305\u62ec\u9002\u5e94\u6027\u81ea\u65cb\u3001\u9501\u6d88\u9664\u3001\u504f\u5411\u9501\u3001\u8f7b\u91cf\u7ea7\u9501\u7b49\u3002</p> <p>\u9002\u5e94\u6027\u81ea\u65cb\uff1a\u6240\u8c13\u81ea\u65cb\u5c31\u662f\u8ba9\u540e\u8bf7\u6c42\u9501\u7684\u7ebf\u7a0b\u4e0d\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u800c\u662f\u7ee7\u7eed\u5360\u7528cpu\u65f6\u95f4\u7247\uff0c\u5fd9\u7b49\u5f85\u4e00\u4f1a\uff0c\u770b\u770b\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u662f\u5426\u4f1a\u5f88\u5feb\u7684\u91ca\u653e\u9501\u3002\u8fd9\u79cd\u81ea\u65cb\u9700\u8981\u5728\u591a\u6838cpu\u8fdb\u884c\u624d\u6709\u610f\u4e49\uff0c\u5728\u5355\u6838cpu\u4e0a\u81ea\u65cb\u6ca1\u6709\u610f\u4e49\u3002\u9002\u5e94\u6027\u6307\u7684\u662f\u865a\u62df\u673a\u4f1a\u6839\u636e\u81ea\u65cb\u83b7\u5f97\u9501\u6210\u529f\u7684\u60c5\u51b5\u81ea\u52a8\u8c03\u6574\u81ea\u65cb\u7684\u6b21\u6570\u3002</p> <p>\u9501\u6d88\u9664\uff1a\u6307\u5373\u65f6\u7f16\u8bd1\u5668\u4f1a\u5bf9\u4e00\u4e9b\u4e0d\u53ef\u80fd\u5b58\u5728\u7ade\u4e89\u5171\u4eab\u6570\u636e\u7684\u52a0\u9501\u64cd\u4f5c\u8fdb\u884c\u6d88\u9664\u3002</p> <p>\u9501\u7c97\u5316\uff1a\u6307\u7f16\u8bd1\u5668\u4f1a\u628a\u4e00\u4e9b\u8fde\u7eed\u7684\u52a0\u9501\u64cd\u4f5c\u653e\u5728\u4e00\u8d77\uff0c\u907f\u514d\u9891\u7e41\u5730\u8fdb\u884c\u52a0\u9501\u548c\u89e3\u9501\u7684\u64cd\u4f5c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#synchronized","title":"synchronized\u52a0\u89e3\u9501\u8fc7\u7a0b\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_18","title":"\u91cd\u91cf\u7ea7\u9501\u52a0\u89e3\u9501\u8fc7\u7a0b\uff1f","text":"<p>\u91cd\u91cf\u7ea7\u9501\u4f9d\u9760\u64cd\u4f5c\u7cfb\u7edf\u5e95\u5c42\u7684\u540c\u6b65\u673a\u5236\u5b9e\u73b0\uff0c\u52a0\u9501\u548c\u89e3\u9501\uff08\u53ef\u80fd\u4f1a\uff09\u6d89\u53ca\u64cd\u4f5c\u7cfb\u7edf\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u6240\u4ee5\u79f0\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002</p> <p></p> <p>\u91cd\u91cf\u7ea7\u9501\u5b9e\u73b0\u6240\u4f9d\u8d56\u7684\u6570\u636e\u7ed3\u6784\u662fMonitor\uff0c\u5176\u7b80\u5316\u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li><code>WaitSet</code>\u6307\u5411\u56e0\u4e3a\u8c03\u7528<code>Object::wait</code>\u800c\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u96c6\u5408\u3002</li> <li><code>cxq</code>\u6307\u5411\u56e0\u4e3a\u7ade\u4e89\u9501\u5931\u8d25\u800c\u963b\u585e\u7684\u7ebf\u7a0b\u96c6\u5408\u3002</li> <li><code>EntryList</code>\u6307\u5411\u5373\u5c06\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\u961f\u5217\uff0c\u6bcf\u6b21\u5f53\u9501\u88ab\u91ca\u653e\u65f6\u4f1a\u5524\u9192EntryList\u961f\u9996\u7684\u7ebf\u7a0b\u3002</li> <li><code>Owner</code>\u6307\u5411\u7684\u83b7\u5f97\u9501\u7684\u7ebf\u7a0b\u3002</li> <li><code>recursions</code>\u662f\u9501\u91cd\u5165\u8ba1\u6570\u3002</li> </ul> <p>\u91cd\u91cf\u7ea7\u9501\u52a0\u89e3\u9501\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5728\u5bf9\u8c61\u4e0a\u52a0\u91cd\u91cf\u7ea7\u9501\u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u68c0\u67e5\u5bf9\u8c61<code>MarkWord</code>\u6700\u540e\u4e24\u4f4d\u662f\u4e0d\u662f<code>01</code>\uff0c\u5373\u662f\u5426\u5904\u4e8e<code>Heavyweight Locked</code>\u91cd\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u5148\u7ed9\u5bf9\u8c61\u521d\u59cb\u5316\u4e00\u4e2aMonitor\u7ba1\u7a0b\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u5bf9\u8c61\u5934\u7684MarkWord\u7528cas\u64cd\u4f5c\u7f6e\u4e3a\u91cd\u91cf\u7ea7\u9501\u72b6\uff08MarkWord\u7684\u524d62\u4f4d\u662f\u6307\u5411Monitor\u5bf9\u8c61\u7684\u6307\u9488\uff0c\u540e\u4e24\u4f4d\u662f<code>01</code>\uff09\uff0c\u4e4b\u540e\u518d\u5c06Monitor\u7684Owner\u6307\u5411\u8be5\u7ebf\u7a0b\uff0c\u5e76\u8bbe\u7f6erecursions\u4e3a1\uff0c\u6b64\u65f6\u8be5\u7ebf\u7a0b\u5c31\u52a0\u9501\u6210\u529f\u4e86\u3002</li> <li>\u5982\u679c\u53d1\u73b0\u5bf9\u8c61\u5df2\u7ecf\u5904\u4e8e\u91cd\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff0c\u90a3\u4e48\u9996\u5148\u4f1a\u901a\u8fc7MarkWord\u7684\u524d62\u4f4d\u627e\u5230Monitor\uff0c\u7136\u540e\u68c0\u67e5Owner\u662f\u5426\u6307\u5411\u81ea\u5df1\uff0c\u5982\u679c\u662f\uff0c\u90a3\u4e48\u9501\u91cd\u5165\uff0c\u76f4\u63a5\u5c06recursions\u52a01\u5373\u53ef\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u5c31\u5c06\u7ebf\u7a0b\u52a0\u5165\u5230cxq\u7ade\u4e89\u961f\u5217\u4e2d\u7136\u540e\u6302\u8d77\u3002</li> <li>\u5982\u679c\u7ebf\u7a0b\u5728\u89e3\u9501\u4e4b\u524d\u8c03\u7528<code>Object::wait</code>\uff0c\u90a3\u4e48\u8be5\u7ebf\u7a0b\u4e5f\u4f1a\u91ca\u653e\u9501\uff0c\u7136\u540e\u52a0\u5165\u5230WaitSet\u961f\u5217\u4e2d\u7136\u540e\u6302\u8d77\u3002\u5f53\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528<code>Object::notifyAll</code>\uff0c\u4f1a\u5c06WaitSet\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\u3002</li> <li>\u5f53 synchronized\u5757\u7ed3\u675f \u6216\u8005 \u4f7f\u7528<code>Object::wait</code> \u91ca\u653e\u9501\u65f6\uff0c\u4f1a\u5148\u5c06cxq\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\uff0c\u7136\u540e\u5524\u9192EntryList\u961f\u9996\u7684\u7ebf\u7a0b\u3002</li> </ol> <p>\u603b\u7ed3\uff1a\u9501\u91ca\u653e\u65f6\uff0c\u53ea\u4f1a\u5524\u9192EntryList\u961f\u9996\u7684\u7ebf\u7a0b\u3002\u6240\u4ee5\u5bf9\u4e8e\u5904\u4e8ewaiting\u72b6\u6001\u7684\u7ebf\u7a0b\uff0c\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528notify\u65b9\u6cd5\uff0c\u90a3\u4e48\u4ed6\u5c31\u4e0d\u4f1a\u88ab\u52a0\u5165\u5230EntryList\u961f\u5217\u4e2d\uff0c\u4e5f\u5c31\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u5524\u9192\uff1b\u5bf9\u4e8e\u56e0\u4e3a\u7ade\u4e89\u9501\u5931\u8d25\u800c\u963b\u585e\u7684\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u6bcf\u6b21\u91ca\u653e\u9501\u90fd\u4f1a\u5c06cxq\u961f\u5217\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\u961f\u5217\uff0c\u6240\u4ee5\u53ea\u8981\u9501\u88ab\u91ca\u653e\uff0c\u5b83\u4eec\u5c31\u6709\u88ab\u5524\u9192\u7684\u673a\u4f1a\uff08\u53ef\u4ee5\u7b80\u5355\u5730\u5c06cxq\u961f\u5217\u548cEntryList\u961f\u5217\u770b\u4f5c\u662f\u4e00\u8d77\u7684\uff0c\u7136\u540e\u6bcf\u6b21\u8c03\u7528notify\u65b9\u6cd5\u90fd\u4f1a\u5c06WaitSet\u4e2d\u7684\u7ebf\u7a0b\u52a0\u5165\u5230EntryList\u961f\u5217\uff09\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_19","title":"\u8f7b\u91cf\u7ea7\u9501\u52a0\u89e3\u9501\u8fc7\u7a0b\uff1f","text":"<p>\u8f7b\u91cf\u7ea7\u9501\u5b9e\u73b0\u4f9d\u9760\u7684\u6570\u636e\u7ed3\u6784\u662f<code>Lock Record</code>\uff0c<code>Lock Record</code>\u5305\u542b\u4e24\u90e8\u5206\uff1a<code>Displaced Mark Word</code> \u548c <code>Object reference</code>\uff0c<code>Displaced Mark Word</code> \u8bb0\u5f55\u7684\u662f\u9501\u5bf9\u8c61\u7684MarkWord\uff0c<code>Object reference</code>\u8bb0\u5f55\u7684\u9501\u5bf9\u8c61\u7684\u5f15\u7528\u3002</p> <p>\u52a0\u9501\u6d41\u7a0b\uff1a</p> <ol> <li>\u7ebf\u7a0b\u6bcf\u6b21\u52a0\u8f7b\u91cf\u7ea7\u9501\u90fd\u4f1a\u5728\u6808\u4e2d\u521b\u5efa\u4e00\u4e2a<code>Lock Record</code>\uff0c\u7136\u540e\u5c06\u5c1d\u8bd5\u4f7f\u7528cas\u64cd\u4f5c\u5c06\u9501\u5bf9\u8c61\u7684Mark Word\u8bbe\u7f6e\u4e3a\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff08\u524d62\u4f4d\u662f<code>Lock Record</code>\u7684\u5730\u5740\uff0c\u540e\u4e24\u4f4d\u662f00\uff09\uff0c\u5982\u679c\u9501\u5bf9\u8c61\u540e\u4e24\u4f4d\u662f<code>01</code>\uff08\u5373\u5904\u4e8e\u672a\u9501\u5b9a\u72b6\u6001\u6216\u8005\u504f\u5411\u9501\u72b6\u6001\uff09\uff0c\u90a3\u4e48cas\u64cd\u4f5c\u53ef\u4ee5\u6210\u529f\uff0c\u4e5f\u5c31\u662f\u52a0\u9501\u6210\u529f\u3002</li> <li>\u5426\u5219\u5982\u679ccas\u64cd\u4f5c\u5931\u8d25\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u60c5\u51b5\uff1a</li> <li>\u5982\u679c\u5176\u5b83\u7ebf\u7a0b\u5df2\u7ecf\u6301\u6709\u4e86\u8be5 Object \u7684\u8f7b\u91cf\u7ea7\u9501\uff0c\u90a3\u4e48cas\u64cd\u4f5c\u4f1a\u5931\u8d25\uff0c\u56e0\u4e3acas\u671f\u671bMark Word\u7684\u540e\u4e24\u4f4d\u662f01\uff0c\u800c\u6b64\u65f6\u662f00\u5904\u4e8e\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\uff0c\u5728\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u4e0b\u51fa\u73b0\u9501\u7ade\u4e89\u60c5\u51b5\uff0c\u4f1a\u5bfc\u81f4\u8fdb\u5165\u9501\u81a8\u80c0\u8fc7\u7a0b\u3002</li> <li>\u5982\u679c\u662f\u672c\u7ebf\u7a0b\u91cd\u590d\u5bf9\u9501\u5bf9\u8c61\u52a0\u9501\u4e5f\u4f1a\u5bfc\u81f4cas\u64cd\u4f5c\u5931\u8d25\uff0c\u4e0d\u8fc7\u8fd9\u662f\u9501\u91cd\u5165\u73b0\u8c61\uff0c\u4f1a\u518d\u6dfb\u52a0\u4e00\u6761<code>Lock Record</code>\u4f5c\u4e3a\u91cd\u5165\u7684\u8ba1\u6570\uff0c\u8be5<code>Lock Record</code>\u7684\u7b2c\u4e00\u90e8\u5206<code>Displaced Mark Word</code> \u7f6e\u4e3anull\u3002</li> </ol> <p>\u89e3\u9501\u6d41\u7a0b\uff1a</p> <ol> <li>\u5982\u679c<code>Lock Record</code>\u7684<code>Displaced Mark Word</code>\u4e3anull\uff0c\u4ee3\u8868\u8fd9\u662f\u4e00\u6b21\u91cd\u5165\uff0c\u5220\u9664\u9501\u8bb0\u5f55\u7ee7\u7eed\u6267\u884c\u3002</li> <li>\u5982\u679c<code>Lock Record</code>\u7684<code>Displaced Mark Word</code>\u4e0d\u4e3anull\uff0c\u5219\u5229\u7528CAS\u6307\u4ee4\u5c06\u5bf9\u8c61\u5934\u7684<code>mark word</code>\u6062\u590d\u6210\u4e3a<code>Displaced Mark Word</code>\u3002\u5982\u679c\u6210\u529f\uff0c\u5219continue\uff0c\u5426\u5219\u81a8\u80c0\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#synchronizedhashcode","title":"\u4f7f\u7528synchronized\u52a0\u9501\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u8c61\u7684hashcode\u503c\u90fd\u4f1a\u4fdd\u5b58\u5728\u54ea\u91cc\uff1f","text":"<p>\u5728Java\u4e2d\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u8ba1\u7b97\u8fc7hash\u503c\uff0c\u90a3\u4e48\u5c31\u5e94\u8be5\u4e00\u81f4\u4fdd\u6301\u4e0d\u53d8\uff0c\u4e0d\u7136\u4f1a\u8ba9\u5f88\u591a\u57fa\u4e8ehash\u503c\u7684\u5e94\u7528\u51fa\u9519\u3002\u800c\u5bf9\u8c61\u7684hash\u503c\u662f\u4fdd\u5b58\u5728\u5bf9\u8c61\u5934\u7684MarkWord\u91cc\u9762\u7684\uff08\u800c\u4e0d\u4f7f\u7528\u5b9e\u4f8b\u5b57\u6bb5\u7684\u539f\u56e0\u662f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u5bf9\u8c61\u90fd\u9700\u8981\u8ba1\u7b97hash\u503c\uff0c\u5982\u679c\u628a\u5bf9\u8c61\u7684hash\u503c\u4fdd\u5b58\u5728\u5bf9\u8c61\u5934\u91cc\u9762\uff0c\u5f53\u5bf9\u8c61\u4e0d\u9700\u8981\u8ba1\u7b97hash\u503c\u65f6\uff0c\u53ef\u4ee5\u590d\u7528\u5176\u7a7a\u95f4\uff09\uff0c\u5f53\u4f7f\u7528synchronized\u52a0\u9501\u65f6\uff0cMarkWord\u4e2d\u4fdd\u5b58hash\u503c\u7684\u4f4d\u4f1a\u88ab\u590d\u7528\uff0c\u6bd4\u5982\u88ab\u504f\u5411\u9501\u5b58\u7ebf\u7a0bid\uff0c\u88ab\u8f7b\u91cf\u7ea7\u9501\u5b58\u6307\u5411lock record\u7684\u6307\u9488\uff0c\u88ab\u91cd\u91cf\u7ea7\u9501\u5b58\u6307\u5411monitor\u7684\u6307\u9488\uff0c\u90a3\u5982\u679c\u5bf9\u8c61\u8981\u8ba1\u7b97hash\u503c\uff0c\u5176hash\u503c\u4f1a\u88ab\u4fdd\u5b58\u5728\u54ea\u91cc\u5462\uff1f\u5bf9\u4e8e\u4e0d\u540c\u7684\u72b6\u6001\uff0c\u5bf9\u8c61\u7684hash\u503c\u4fdd\u5b58\u7684\u5730\u65b9\u90fd\u4e0d\u4e00\u6837\uff1a</p> <ol> <li>\u5bf9\u4e8e\u5904\u4e8e\u672a\u9501\u5b9a\u7684\u5bf9\u8c61\uff0c\u5176hash\u503c\u76f4\u63a5\u4fdd\u5b58\u5728\u5bf9\u8c61\u5934\u7684MarkWord\u4e2d\u3002</li> <li>\u5982\u679c\u5bf9\u8c61\u8ba1\u7b97\u8fc7hash\u503c\uff0c\u90a3\u4e48\u5bf9\u8c61\u5c31\u4e0d\u4f1a\u518d\u8fdb\u5165\u504f\u5411\u9501\u72b6\u6001\u4e86\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u8fdb\u5165\u504f\u5411\u9501\u72b6\u6001\u7684\u5bf9\u8c61\uff0c\u4e5f\u4f1a\u64a4\u9500\u504f\u5411\u8fdb\u884c\u9501\u5347\u7ea7\u3002</li> <li>\u5bf9\u4e8e\u5904\u4e8e\u8f7b\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u7684\u5bf9\u8c61\uff0c\u5176hash\u503c\u4f1a\u88ab\u4fdd\u5b58\u5728lock record\u4e2d\u3002</li> <li>\u5bf9\u4e8e\u5904\u4e8e\u91cd\u91cf\u7ea7\u9501\u5b9a\u72b6\u6001\u7684\u5bf9\u8c61\uff0c\u5176hash\u503c\u4f1a\u88ab\u4fdd\u5b58\u5728monitor\u4e2d\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#treadlocal","title":"TreadLocal\uff1f","text":""},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#treadlocal_1","title":"TreadLocal\u7684\u4f7f\u7528\u573a\u666f\uff1f","text":"<p>TreadLocal\u7684\u4f7f\u7528\u573a\u666f\uff1a\u5982\u679c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u9700\u8981\u7528\u81ea\u5df1\u7684\u6570\u636e\u6765\u6267\u884c\u67d0\u4e2a\u65b9\u6cd5\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5728\u8fd9\u4e2a\u65b9\u6cd5\u6240\u5c5e\u7684\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2aTreadLocal\uff0c\u7136\u540e\u5728\u8be5\u65b9\u6cd5\u4e2d\u4f7f\u7528<code>TreadLocal::get()</code>\u65b9\u6cd5\u4e86\u3002TreadLocal\u5178\u578b\u7684\u5e94\u7528\u662f\u8fde\u63a5\u7ba1\u7406\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u4e00\u4e2a\u8fde\u63a5\uff0c\u8fde\u63a5\u5bf9\u8c61\u53ef\u4ee5\u88ab\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u4e0d\u540c\u65b9\u6cd5\u4f7f\u7528\uff0c\u800c\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u4e0d\u5171\u4eab\u8fde\u63a5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#treadlocal_2","title":"TreadLocal\u539f\u7406\uff1f","text":"<p>TreadLocal\u539f\u7406\uff1aThreadLocal\u7c7b\u91cc\u9762\u6709\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7bThreadLocalMap\u7c7b\uff0c\u6bcf\u4e2aThread\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2aThreadLocalMap\u5bf9\u8c61\uff0c\u8c03\u7528ThreadLocal\u5bf9\u8c61\u7684set\u65b9\u6cd5\u5c31\u662f\u5728\u5f80\u7ebf\u7a0b\u81ea\u5df1\u7684ThreadLocalMap\u5bf9\u8c61\u91cc\u9762\u8bbe\u7f6e\u503c\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u5e76\u53d1\u4fee\u6539\u95ee\u9898\uff0cThreadLocalMap\u7684key\u5c31\u662f\u8c03\u7528set\u65b9\u6cd5\u7684ThreadLocal\u5bf9\u8c61\uff0c\u6240\u4ee5\u5982\u679c\u9700\u8981\u4fdd\u5b58\u591a\u4e2a\u503c\uff0c\u9700\u8981new\u591a\u4e2aThreadLocal\u5bf9\u8c61\uff08\u6240\u4ee5\u503c\u5e76\u4e0d\u662f\u4fdd\u5b58ThreadLocal\u5bf9\u8c61\u91cc\u9762\uff0c\u800c\u662f\u4fdd\u5b58\u5728\u7ebf\u7a0b\u81ea\u5df1\u7684ThreadLocalMap\u5bf9\u8c61\u91cc\u9762\uff09\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#threadlocal","title":"ThreadLocal\u7684\u5185\u5b58\u6cc4\u9732\u95ee\u9898\uff1f","text":"<p>ThreadLocal\u7684\u5185\u5b58\u6cc4\u9732\u95ee\u9898\uff1a\u5982\u679c\u4e00\u4e2a\u4f7f\u7528\u4e86ThreadLocal\u7684\u7ebf\u7a0b\u8fdf\u8fdf\u4e0d\u7ed3\u675f\uff08\u6bd4\u5982\u4f7f\u7528\u7ebf\u7a0b\u6c60\u91cc\u9762\u7684\u7ebf\u7a0b\uff09\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u4e00\u76f4\u6301\u6709ThreadLocalMap\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u6240\u4ee5ThreadLocalMap\u5bf9\u8c61\u4e5f\u5c31\u4e0d\u80fd\u88ab\u56de\u6536\uff0cThreadLocalMap\u5bf9\u8c61\u91cc\u9762\u4fdd\u5b58\u7740key\u548cvalue\uff0c\u5b83\u4eec\u4e5f\u662f\u5f15\u7528\uff0c\u4e0d\u8fc7key\u662fThreadLocal\u5bf9\u8c61\u7684\u5f31\u5f15\u7528\uff0c\u6240\u4ee5\u4e0d\u4f1a\u7ed9ThreadLocal\u5bf9\u8c61\u7684\u56de\u6536\u9020\u6210\u8d1f\u62c5\uff0c\u4f46\u662fvalue\u662f\u7528\u6237\u8bbe\u7f6e\u7684\u5f3a\u5f15\u7528\uff0c\u6240\u4ee5\u53ea\u8981ThreadLocalMap\u5bf9\u8c61\u4e0d\u91ca\u653e\uff0cvalue\u6240\u6307\u5411\u7684\u5bf9\u8c61\u4e5f\u5c31\u4e0d\u80fd\u88ab\u91ca\u653e\uff0c\u5e76\u4e14\u8fd8\u4f1a\u51fa\u73b0key\u6240\u6307\u5411\u7684ThreadLocalMap\u5bf9\u8c61\u5df2\u7ecf\u88ab\u56de\u6536\uff0c\u6b64\u65f6key\u4e3anull\uff0c\u4f46\u662fkey\u5bf9\u5e94\u7684value\u5374\u4e0d\u80fd\u56de\u6536\u7684\u60c5\u51b5\uff0c\u8fd9\u5c31\u662f\u59a5\u59a5\u7684\u5185\u5b58\u6cc4\u9732\u3002\uff08ThreadLocalMap\u7684Entry\u7684key\u662f\u5f31\u5f15\u7528\uff0c\u6240\u4ee5Entry\u7684key\u4e0d\u4f1a\u4f5c\u4e3aThreadLocal\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\uff0c\u5f53\u53d1\u751fgc\u65f6\uff0c\u5982\u679ckey\u6240\u6307\u5411\u7684ThreadLocal\u5bf9\u8c61\u6ca1\u6709\u5f3a\u5f15\u7528\u4e86\uff08\u5178\u578b\u7684\u5c31\u662f\u6700\u521d\u521b\u5efaThreadLocal\u5bf9\u8c61\u65f6\u7684\u5f15\u7528\uff09\uff0cThreadLocal\u5bf9\u8c61\u53ef\u4ee5\u88ab\u987a\u5229\u56de\u6536\uff0c\u6b64\u65f6ThreadLocalMap\u7684Entry\u7684key\u4e3anull\u3002\uff09</p> <p>\u89e3\u51b3\u5185\u5b58ThreadLocal\u7684\u5185\u5b58\u6cc4\u9732\u7684\u65b9\u6cd5\u5c31\u662f\u5f53\u7ebf\u7a0b\u4e0d\u518d\u4f7f\u7528ThreadLocal\u65f6\uff0c\u9700\u8981\u8c03\u7528\u5176<code>remove()</code>\u65b9\u6cd5\u5220\u9664ThreadLocalMap\u5bf9\u8c61\u91cc\u7684Entry\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#concurrenthashmap","title":"ConcurrentHashMap\u539f\u7406\uff1f","text":"<p>ConcurrentHashMap\u7684\u6570\u636e\u7ed3\u6784\u548cHashMap\u4e00\u6837\uff1a\u6570\u7ec4+\u94fe\u8868+\u7ea2\u9ed1\u6811\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#sizectl","title":"sizeCtl\u542b\u4e49\uff1f","text":"<ul> <li>sizeCtl\u4e3a0\uff0c\u8868\u793a\u6570\u7ec4\u672a\u521d\u59cb\u5316\uff0c \u4e14\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\u4e3a16\u3002</li> <li>sizeCtl\u4e3a\u6b63\u6570\uff0c\u5982\u679c\u6570\u7ec4\u672a\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u5176\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u7684\u521d\u59cb\u5bb9\u91cf\uff0c\u5982\u679c\u6570\u7ec4\u5df2\u7ecf\u521d\u59cb\u5316\uff0c\u90a3\u4e48\u5176\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u7684\u6269\u5bb9\u9608\u503c\u3002</li> <li>sizeCtl\u4e3a-1\uff0c\u8868\u793a\u6570\u7ec4\u6b63\u5728\u8fdb\u884c\u521d\u59cb\u5316\u3002</li> <li>sizeCtl\u5c0f\u4e8e0\uff0c\u4e14\u4e0d\u4e3a-1\uff0c\u8868\u793a\u6570\u7ec4\u6b63\u5728\u6269\u5bb9\uff0c -(1+n)\uff0c\u8868\u793a\u6b64\u65f6\u6709n\u4e2a\u7ebf\u7a0b\u6b63\u5728\u5171\u540c\u5b8c\u6210\u6570\u7ec4\u7684\u6269\u5bb9\u64cd\u4f5c\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#put","title":"put\u65b9\u6cd5\u7684\u5e76\u53d1\u6d41\u7a0b\uff1f","text":"<p>put\u65b9\u6cd5\u5b9e\u73b0\u5e76\u53d1\u5b89\u5168\u7684\u4e3b\u8981\u601d\u60f3\u662f cas+\u81ea\u65cb \u7684\u65e0\u9501\u5e76\u53d1\u7b56\u7565\uff0c\u5927\u81f4\u6d41\u7a0b\u662f\uff1a</p> <ol> <li>\u9996\u5148\u68c0\u67e5\u662f\u5426\u662f\u7b2c\u4e00\u6b21put\u5143\u7d20\uff0c\u5982\u679c\u662f\uff0c\u9700\u8981\u5148\u521d\u59cb\u5316\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u5728new ConcurrentHashMap\u7684\u65f6\u5019\u5e76\u6ca1\u6709\u521d\u59cb\u5316\u6570\u7ec4\uff0c\u771f\u6b63\u505a\u6570\u7ec4\u521d\u59cb\u5316\u662f\u5728\u7b2c\u4e00\u6b21\u6dfb\u52a0\u5143\u7d20\u65f6\u5b8c\u6210\uff0c\u5373\u61d2\u521d\u59cb\u5316\uff08Lazily initialized\uff09\u3002\u521d\u59cb\u5316\u5b8c\u6210\u540e\u81ea\u65cb\u8fdb\u884c\u6dfb\u52a0\u5143\u7d20\u3002</li> <li>\u5c06keyhash\u4e4b\u540e\u627e\u5230key\u6240\u5728\u6876\uff0c\u7136\u540e\u68c0\u67e5\u4e3anull\uff0c\u5982\u679c\u662f\uff0c\u5c1d\u8bd5\u4f7f\u7528cas\u8bbe\u7f6evalue\uff0ccas\u6210\u529f\u5c31\u76f4\u63a5break\uff0c\u8868\u793a\u6dfb\u52a0\u6210\u529f\uff0c\u5982\u679c\u5931\u8d25\u4e86\uff0c\u81ea\u65cb\u91cd\u65b0\u5c1d\u8bd5\u5176\u4ed6\u60c5\u51b5\u7684\u6dfb\u52a0\u64cd\u4f5c\u3002</li> <li>\u4e0a\u4e00\u6b65\u5931\u8d25\u540e\u8868\u793a\u6876\u7684\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u4e00\u5b9a\u6709\u4e86\u5143\u7d20\uff0c\u6240\u4ee5\u9700\u8981\u68c0\u67e5\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u662fforwarding\u8282\u70b9\uff0c\u5982\u679c\u662f\uff0c\u8868\u793a\u5f53\u524d\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u4e86\uff0c\u5e76\u4e14\u6269\u5bb9\u64cd\u4f5c\u8fd8\u6ca1\u6709\u7ed3\u675f\uff0c\u6b64\u7ebf\u7a0b\u9700\u8981\u53bb\u534f\u52a9\u6269\u5bb9\u3002</li> <li>\u5982\u679c\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e0d\u662fforwarding\u8282\u70b9\uff0c\u90a3\u4e48\u53ef\u80fd\u7684\u60c5\u51b5\u67093\u79cd\uff1a\u3010\u6ca1\u6709\u8fdb\u884c\u6269\u5bb9\u3011\u3001\u6216\u8005\u3010\u6b63\u5728\u6269\u5bb9\uff0c\u4f46\u662f\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u3011\u3001\u6216\u8005\u3010\u6b63\u5728\u6269\u5bb9\uff0c\u4f46\u662f\u6876\u8fd8\u6ca1\u6709\u88ab\u8fc1\u79fb\u5b8c\uff0c\u53ea\u88ab\u8fc1\u79fb\u4e86\u4e00\u90e8\u5206\u3011\u3002\u7531\u4e8e\u6267\u884c\u6dfb\u52a0\u64cd\u4f5c\u9700\u8981\u4fee\u6539\u94fe\u8868\u6216\u8005\u6811\uff0c\u6240\u4ee5\u9700\u8981\u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u52a0\u4e92\u65a5\u9501\uff0c\u5bf9\u4e8e\u524d\u4e24\u79cd\u60c5\u51b5\uff0c\u8be5\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u52a0\u9501\u5e76\u6dfb\u52a0\u6210\u529f\uff08\u9664\u975e\u6709\u5176\u4ed6\u7ebf\u7a0b\u5df2\u7ecf\u9501\u5b9a\u8fd9\u4e2a\u6876\u5e76\u6dfb\u52a0\u5143\u7d20\uff0c\u5982\u679c\u662f\u8fd9\u6837\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85\uff0c\u5524\u9192\u4e4b\u540e\u62a2\u5230\u9501\u7136\u540edouble check\u4e00\u4e0b\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u662f\u4e4b\u524d\u6765\u7684\u65f6\u5019\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u662f\u76f4\u63a5\u6dfb\u52a0\uff0c\u5982\u679c\u4e0d\u662f\u81ea\u65cb\u91cd\u8bd5\u5373\u53ef\uff09\uff0c\u4f46\u662f\u5bf9\u4e8e\u7b2c3\u79cd\u60c5\u51b5\uff0c\u8be5\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u6269\u5bb9\u7ebf\u7a0b\u6b63\u5728\u8fc1\u79fb\u6876\u7684\u65f6\u5019\u4e5f\u4f1a\u5bf9\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u52a0\u4e92\u65a5\u9501\uff0c\u7b49\u5230\u6269\u5bb9\u7ebf\u7a0b\u91ca\u653e\u9501\u4e4b\u540e\uff0c\u8be5\u7ebf\u7a0b\u62a2\u5230\u9501\u4e5f\u4e0d\u80fd\u6dfb\u52a0\u6210\u529f\uff0c\u56e0\u4e3a\u4f1adouble check\u4e00\u4e0b\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u8fd8\u662f\u539f\u6765\u7684\u90a3\u4e2a\u5143\u7d20\uff0c\u663e\u7136\u7b2c\u4e00\u4e2a\u5143\u7d20\u88ab\u6269\u5bb9\u7ebf\u7a0b\u6362\u6210\u4e86forwarding\u8282\u70b9\uff0c\u4e8e\u662f\u8be5\u7ebf\u7a0b\u6dfb\u52a0\u5931\u8d25\uff0c\u81ea\u65cb\u91cd\u65b0\u5c1d\u8bd5\u540e\u5230\u7b2c3\u6b65\u53bb\u534f\u52a9\u6269\u5bb9\u3002</li> <li>\u6dfb\u52a0\u5b8c\u6210\u540e\u9700\u8981\u68c0\u67e5\u6876\u7684\u8282\u70b9\u6570\u91cf\uff0c\u5982\u679c\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c\uff0c\u9700\u8981\u8fdb\u884c\u6811\u5316\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0eHashMap\u4e00\u6837\uff0c\u5f53\u6570\u7ec4\u957f\u5ea6\u5c0f\u4e8e64\u5e76\u4e14\u94fe\u8868\u957f\u5ea6\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c8\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u8fdb\u884c\u6811\u5316\u64cd\u4f5c\uff0c\u800c\u662f\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\u3002</li> <li>\u6700\u540e\u4f1a\u8c03\u7528<code>addcount</code>\u65b9\u6cd5\u7ef4\u62a4\u8282\u70b9\u4e2a\u6570\uff0c\u5e76\u4e14\u5f53\u8282\u70b9\u4e2a\u6570\u8fbe\u5230\u6269\u5bb9\u9608\u503c\u65f6<code>addCount</code>\u65b9\u6cd5\u8fd8\u4f1a\u8c03\u7528\u6269\u5bb9\u65b9\u6cd5\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#concurrenthashmap_1","title":"ConcurrentHashMap\u7ef4\u62a4\u8282\u70b9\u4e2a\u6570\u7684\u65b9\u6cd5\uff1f","text":"<p>ConcurrentHashMap\u5b9a\u4e49\u4e24\u4e2a\u6210\u5458\u53d8\u91cf\uff1a<code>baseCount</code>\u548c<code>CounterCell[]</code>\u6570\u7ec4\u3002</p> <p></p> <p>\u8282\u70b9\u6570\u52a01\u7684\u6d41\u7a0b\u662f\uff1a</p> <ol> <li>\u5148\u5bf9baseCount\u505a\u52a01\u7684cas\u64cd\u4f5c\uff0c\u5982\u679c\u6210\u529f\u5c31\u8fd4\u56de\uff08\u5927\u90e8\u5206\u60c5\u51b5\u90fd\u53ef\u4ee5\u6210\u529f\uff09\uff0c</li> <li>\u5982\u679c\u5931\u8d25\u4e86\uff0c\u8868\u793a\u53d1\u751f\u4e86\u7ade\u4e89\uff0c\u90a3\u5c31\u5bf9<code>CounterCell[]</code>\u6570\u7ec4\u4e2d\u67d0\u4e2a\u5143\u7d20\u505a\u52a01\u7684cas\u64cd\u4f5c\uff0c\u5982\u679c\u6210\u529f\u5c31\u8fd4\u56de\uff0c</li> <li>\u5982\u679c\u5931\u8d25\u4e86\uff0c\u8868\u793a\u53d1\u751f\u4e86\u7ade\u4e89\uff0c\u90a3\u5c31\u5c06<code>CounterCell[]</code>\u6570\u7ec4\u6269\u5bb9\u4e3a\u539f\u6765\u4e24\u500d\uff0c\u4e4b\u540e\u81ea\u65cb\u5bf9<code>CounterCell[]</code>\u6570\u7ec4\u4e2d\u67d0\u4e2a\u5143\u7d20\u505a\u52a01\u7684cas\u64cd\u4f5c\u3002</li> </ol> <p>\u56e0\u6b64<code>size()</code>\u65b9\u6cd5\u7684\u8ba1\u7b97\u8fc7\u7a0b\u5c31\u5e94\u8be5\u662fbaseCount\u52a0\u4e0a<code>CounterCell[]</code>\u6570\u7ec4\u7684\u548c\u3002</p> <p>ConcurrentHashMap\u7ef4\u62a4\u8282\u70b9\u4e2a\u6570\u7684\u65b9\u6cd5\u4e0e\u539f\u5b50\u7c7b\u7d2f\u52a0\u5668LongAdder\u4e00\u6837\uff0c\u80fd\u5b9e\u73b0\u9ad8\u6548\u7684\u7d2f\u52a0\u64cd\u4f5c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_20","title":"\u5e76\u53d1\u6269\u5bb9\u7684\u6d41\u7a0b\uff1f","text":"<ol> <li> <p>\u6bcf\u4e00\u4e2a\u53c2\u4e0e\u6269\u5bb9\u7684\u7ebf\u7a0b\u9996\u5148\u4f1a\u7528cas\u64cd\u4f5c\u8bbe\u7f6e<code>sizeCtl+1</code>\u3002</p> </li> <li> <p>\u7136\u540e\u8fdb\u5165\u5230\u6269\u5bb9\u65b9\u6cd5\u91cc\u9762\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u4e2a\u6269\u5bb9\u7ebf\u7a0b\u4f1a\u5148\u65b0\u5efa<code>nextTable</code>\uff0c\u4e4b\u540e\u53c2\u4e0e\u6269\u5bb9\u7684\u7ebf\u7a0b\u5c31\u4e0d\u7528\u5efa\u4e86\uff0c\u76f4\u63a5\u8fdb\u884c\u534f\u52a9\u6269\u5bb9\u3002</p> </li> <li> <p>\u6bcf\u4e2a\u6269\u5bb9\u7ebf\u7a0b\u4f1a\u6839\u636e\u65e7\u6570\u7ec4\u7684\u957f\u5ea6\u8ba1\u7b97\u4e00\u4e2a\u6b65\u957f<code>stride</code>\uff0c\u7136\u540e\u5728\u65e7\u6570\u7ec4\u4e0a\u4ece<code>transferIndex</code>\u5904\u9886\u53d6\u4e00\u4e2a\u957f\u4e3a<code>stride</code>\u7684\u4efb\u52a1\uff0c\u8fd9\u4e2a\u4efb\u52a1\u5206\u914d\u7684\u65b9\u5411\u662f\u4ece\u53f3\u5f80\u5de6\uff0c\u6bd4\u5982\u65e7\u6570\u7ec4\u957f\u4e3a64\uff0c<code>stride</code>\u4e3a16\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u4efb\u52a1\u662f<code>[48,63]</code>\uff0c\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u662f<code>[32,47]</code>\u3002\u7ebf\u7a0b\u9886\u53d6\u5230\u4efb\u52a1\u4e4b\u540e\u4f1a\u5c06<code>bound</code>\u8bbe\u7f6e\u4e3a\u4efb\u52a1\u7684\u4e0b\u754c\uff0c<code>i</code>\u4e3a\u5f53\u524d\u6269\u5bb9\u7ebf\u7a0b\u6b63\u5728\u8fc1\u79fb\u7684\u6876\u7684\u4e0b\u6807\uff0c\u7136\u540e\u5c06<code>transferIndex</code>\u8bbe\u7f6e\u4e3a<code>bound</code>\uff0c\u56e0\u4e3a<code>transferIndex</code>\u662f\u6210\u5458\u53d8\u91cf\uff0c\u800c<code>bound</code>\u548c<code>i</code>\u662f\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u6240\u4ee5<code>transferIndex</code>\u603b\u8bb0\u5f55\u7684\u662f\u6570\u7ec4\u6700\u5927\u672a\u5206\u914d\u6570\u7ec4\u7684\u4e0b\u6807+1\uff0c\u5373\u6700\u5927\u672a\u5206\u914d\u6570\u7ec4\u7684\u957f\u5ea6\u3002</p> </li> <li> <p>\u4e4b\u540e\u7ebf\u7a0b\u4ece\u53f3\u5f80\u5de6\u8fc1\u79fb\u6bcf\u4e00\u4e2a\u6876\u5230\u65b0\u7684\u6570\u7ec4\uff0c\u76f4\u5230<code>i</code>\u5230\u8fbe<code>bound</code>\uff0c\u6bcf\u8fc1\u79fb\u5b8c\u4e00\u4e2a\u6876\uff0c\u7ebf\u7a0b\u4f1a\u628a\u6570\u7ec4\u5bf9\u5e94\u7684\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a<code>ForwardingNode</code>\u8282\u70b9\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5904\u7406\u5b8c\u5f53\u524d\u7684\u4efb\u52a1\u4e4b\u540e\uff0c\u5982\u679c\u53d1\u73b0<code>transferIndex&gt;0</code>\uff0c\u5373\u8fd8\u6709\u4efb\u52a1\u6ca1\u6709\u88ab\u9886\u53d6\uff0c\u90a3\u4e48\u7ebf\u7a0b\u4f1a\u63a5\u7740\u7ee7\u7eed\u4ece<code>transferIndex</code>\u5904\u9886\u53d6\u4e0b\u4e00\u4e2a\u4efb\u52a1\u3002</p> </li> <li> <p>\u6700\u540e\u4e00\u4e2a\u9000\u51fa\u7684\u6269\u5bb9\u7ebf\u7a0b\u4f1a\u5bf9\u65e7\u6570\u7ec4\u4e0a\u7684\u6bcf\u4e2a\u4f4d\u7f6e\u8fdb\u884c\u4e00\u6b21\u68c0\u67e5\uff0c\u4ee5\u514d\u9057\u6f0f\u672a\u8fc1\u79fb\u7684\u6876\uff0c\u6700\u540e\u9000\u51fa\u65f6\u4f1a\u5c06\u6269\u5bb9\u540e\u7684\u6570\u7ec4<code>nextTable</code>\u8d4b\u7ed9table\uff0c\u7136\u540e<code>nextTable</code>\u7f6e\u4e3anull\u3002</p> </li> </ol> <p></p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff1a\u94fe\u8868\u548c\u6811\u7684\u8fc1\u79fb\u65f6\uff0c\u662f\u5bf9\u6bcf\u4e2a\u8282\u70b9\u8fdb\u884c\u590d\u5236\uff0c\u4e5f\u5c31\u662f\u65b0Map\u4e2d\u7684\u8282\u70b9\u90fd\u662fnew\u51fa\u6765\u7684\uff0c\u800c\u4e0d\u662f\u53ea\u5c06\u6876\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u590d\u5236\u5230\u4e86\u65b0\u6570\u7ec4\uff0c\u8fd9\u4e48\u505a\u7684\u539f\u56e0\u5c31\u662f\u786e\u4fdd\u8bfb\u5199\u53ef\u4ee5\u5e76\u53d1\uff0c\u5373\u5199\u65f6\u590d\u5236\u7684\u601d\u60f3\uff0c\u4fdd\u8bc1\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u8bfb\u4e0d\u53d7\u5f71\u54cd\uff08\u8fc1\u79fb\u65f6\u540c\u4e00\u4e2a\u6876\u4e0a\u7684\u5143\u7d20\u4f1a\u88ab\u5206\u6563\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u7684\u4e24\u4e2a\u4e0d\u540c\u7684\u6876\u4e2d\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5bf9\u8282\u70b9\u8fdb\u884c\u590d\u5236\u5fc5\u7136\u4f1a\u5bf9\u8bfb\u64cd\u4f5c\u6df7\u4e71\uff09\uff0c\u8fc1\u79fb\u5b8c\u4e4b\u540e\u4f1a\u5c06forwarding\u8282\u70b9\u8bbe\u7f6e\u5230\u65e7\u6876\u4e0a\uff0c\u4e4b\u540e\u7684\u8bfb\u4f1a\u88ab\u8f6c\u53d1\u5230\u65b0\u6570\u7ec4\u4e0a\u8fdb\u884c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#stride","title":"\u6269\u5bb9\u6b65\u957f<code>stride</code>\u662f\u5982\u4f55\u8ba1\u7b97\u7684\uff1f","text":"<p>\u82e5cpu\u662f\u5355\u6838\uff0c\u5373NCPU=1\uff0c\u90a3\u4e48stride\u5c31\u7b49\u4e8e\u6574\u4e2a\u6570\u7ec4\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u53ea\u7528\u4e00\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u6574\u4e2amap\u7684\u8fc1\u79fb\uff0c\u5426\u5219\u901a\u8fc7cpu\u6838\u6570\u4e0e\u6570\u7ec4\u957f\u5ea6\u4e00\u8d77\u8ba1\u7b97\u51fa<code>stride</code>\uff0c\u7136\u540e\u82e5\u6b65\u957f\u5c0f\u4e8e\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u6700\u5c0f\u8fc1\u79fb\u6b65\u957f16\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#_21","title":"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u7ebf\u7a0b\u624d\u4f1a\u8fdb\u884c\u6269\u5bb9\u6216\u52a0\u5165\u6269\u5bb9\uff1f","text":"<ol> <li>put\u7ebf\u7a0b\u53d1\u73b0\u6876\u5df2\u88ab\u8fc1\u79fb\uff0c\u5373\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u662fForwardingNode\uff0c\u90a3\u4e48\u4ed6\u4f1a\u52a0\u5165\u6269\u5bb9\u3002</li> <li> <p>put\u7ebf\u7a0bput\u6210\u529f\u4e4b\u540e\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u7136\u540e\u53d1\u73b0\u8fbe\u5230\u6269\u5bb9\u9608\u503c\u5e76\u4e14\u6ca1\u6709\u7ebf\u7a0b\u5728\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\u4ed6\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u542f\u52a8\u6269\u5bb9\u6d41\u7a0b\u3002</p> </li> <li> <p>put\u7ebf\u7a0bput\u6210\u529f\u4e4b\u540e\uff0c\u8fbe\u5230\u6811\u5316\u7684\u9608\u503c\uff0c\u4f46\u662f\u6570\u7ec4\u957f\u5ea6\u5374\u5c0f\u4e8e64\uff0c\u90a3\u4e48\u4ed6\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u542f\u52a8\u6269\u5bb9\u6d41\u7a0b\u3002</p> </li> <li> <p>put\u7ebf\u7a0bput\u4e00\u4e2a\u65b0\u8282\u70b9\u6210\u529f\u4e4b\u540e\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u7136\u540e\u53d1\u73b0\u6709\u7ebf\u7a0b\u5728\u8fdb\u884c\u6269\u5bb9\uff0c\u90a3\u4e48\u5b83\u4f1a\u52a0\u5165\u6269\u5bb9\uff08\u6ce8\u610fput\u7684\u662f\u5df2\u6709value\uff0c\u90a3\u4e48\u5b83\u4e0d\u9700\u8981\u5bf9\u8282\u70b9\u6570\u52a01\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u52a0\u5165\u6269\u5bb9\uff09\u3002</p> </li> </ol> <p>\u603b\u7ed3\uff1a\u4e00\u4e2a\u589e\u52a0\u65b0\u8282\u70b9\u7684\u7ebf\u7a0b\u89e6\u53d1\u4e86\u6269\u5bb9\u64cd\u4f5c\uff0c\u7136\u540e\u5f00\u59cb\u8fc1\u79fb\u6876\uff0c\u540e\u9762\u6765\u7684\u5199\u7ebf\u7a0b\u5982\u679c\u6876\u8fd8\u6ca1\u88ab\u8fc1\u79fb\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u8bbe\u7f6e\u6210\u529f\uff0c\u5982\u679c\u8be5\u7ebf\u7a0b\u4e5f\u662f\u65b0\u589e\u8282\u70b9\uff0c\u90a3\u4e48\u4f1a\u8fdb\u884c\u534f\u52a9\u6269\u5bb9\uff0c\u5982\u679c\u8be5\u7ebf\u7a0b\u4e0d\u662f\u65b0\u589e\u8282\u70b9\uff0c\u800c\u662f\u4fee\u6539\u5df2\u6709\u8282\u70b9\u7684value\uff0c\u5219\u4e0d\u4f1a\u8fdb\u884c\u8fdb\u884c\u534f\u52a9\u6269\u5bb9\uff1b\u5982\u679c\u540e\u9762\u6765\u7684\u5199\u7ebf\u7a0b\u7684\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u4e86\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u65b0\u589e\u8282\u70b9\u7684\u7ebf\u7a0b\u8fd8\u662f\u4fee\u6539\u5df2\u6709\u8282\u70b9\u7684value\u7684\u7ebf\u7a0b\uff0c\u90fd\u4f1a\u56e0\u4e3a\u53d1\u73b0\u6876\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u662f<code>ForwardingNode</code>\uff0c\u800c\u88ab\u52a0\u5165\u534f\u52a9\u6269\u5bb9\u7684\u5927\u519b\u4e2d\uff0c\u76f4\u5230\u6269\u5bb9\u5b8c\u6bd5\uff0c\u7ebf\u7a0b\u624d\u80fd\u5b8c\u6210\u65b0\u589e\u8282\u70b9\u6216\u8005\u4fee\u6539\u8282\u70b9value\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/#get","title":"\u4e3a\u4ec0\u4e48get\u65b9\u6cd5\u4e0d\u9700\u8981\u8fdb\u884c\u4efb\u4f55\u5e76\u53d1\u63a7\u5236\u5c31\u80fd\u4fdd\u8bc1\u8bfb\u7684\u5e76\u53d1\u5b89\u5168\uff1f","text":"<ol> <li>Node\u7684val\u7528volatile\u4fee\u9970\uff0c\u6240\u4ee5\u5982\u679c\u5199\u7ebf\u7a0b\u5148\u4fee\u6539\u4e86\uff0c\u8bfb\u7ebf\u7a0b\u80fd\u53ca\u65f6\u8bfb\u5230\u3002</li> <li>\u6269\u5bb9\u7ebf\u7a0b\u8fc1\u79fb\u6876\u7684\u65f6\u5019\u4f1a\u590d\u5236\u8282\u70b9\uff0c\u5e76\u4e0d\u4f1a\u6539\u53d8\u539f\u6709\u6876\u7684\u7ed3\u6784\uff0c\u6240\u4ee5\u5373\u4f7f\u8bfb\u7ebf\u7a0b\u8bfb\u7684\u6876\u6b63\u5728\u88ab\u8fc1\u79fb\uff0c\u8bfb\u7ebf\u7a0b\u4e5f\u80fd\u5b89\u5168\u8bfb\u5230\u6570\u636e\u3002</li> <li>\u5982\u679c\u6b63\u5728\u53d1\u751f\u6269\u5bb9\uff0c\u5e76\u4e14\u8bfb\u7ebf\u7a0b\u8bfb\u7684\u6876\u5df2\u7ecf\u88ab\u8fc1\u79fb\u4e86\uff0c\u90a3\u4e48\u8bfb\u7ebf\u7a0b\u4f1a\u6839\u636e\u65e7\u6570\u7ec4\u4e0a\u7684forwarding\u8282\u70b9\u7684nextTable\u5c5e\u6027\u627e\u5230\u65b0\u7684\u6570\u7ec4\uff0c\u7136\u540e\u5728\u65b0\u6570\u7ec4\u4e0a\u67e5\u627e\uff0c\u8fd9\u4e5f\u5c31\u662fforwarding\u8282\u70b9\u540d\u5b57\u7684\u7531\u6765\uff0c\u5373\u5c06\u8bfb\u8bf7\u6c42\u8f6c\u53d1\u5230\u65b0\u7684\u6269\u5bb9\u6570\u7ec4\u3002</li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","title":"\u64cd\u4f5c\u7cfb\u7edf","text":"<p> \u7ea6 4166 \u4e2a\u5b57  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 83 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_1","title":"\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\uff1f","text":"<p>\u7ebf\u7a0b\u6982\u5ff5\u8fd8\u6ca1\u6709\u63d0\u51fa\u6765\u7684\u65f6\u5019\uff0c\u5982\u679c\u60f3\u8981\u5728\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\u7684\u540c\u65f6\u5145\u5206\u5229\u7528cpu\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u53ef\u4ee5\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u65f6\u8fdb\u7a0b\u4e0d\u4ec5\u662f\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u8fd8\u662f\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\u3002</p> <p>\u4f5c\u4e3a\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u5982\u679c\u662f\u8fd0\u884c\u5728\u5355\u6838cpu\u4e0a\uff0c\u5f53\u67d0\u4e2a\u8fdb\u7a0b\u56e0\u9700\u8981\u7b49\u5f85IO\u5b8c\u6210\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u53ef\u4ee5\u5148\u628a\u5b83\u6302\u8d77\uff0c\u628acpu\u8d44\u6e90\u8ba9\u51fa\u6765\u7ed9\u5176\u5b83\u8fdb\u7a0b\u6267\u884c\uff0c\u4ece\u800c\u5145\u5206\u5229\u7528\u4e86cpu\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u5982\u679c\u662f\u591a\u6838cpu\uff0c\u8fd9\u4e9b\u8fdb\u7a0b\u8fd8\u53ef\u4ee5\u5e76\u884c\u6267\u884c\u3002\u8fd9\u6837\u867d\u7136\u53ef\u4ee5\u5145\u5206\u5229\u7528cpu\u7684\u8ba1\u7b97\u8d44\u6e90\uff0c\u4f46\u662f\u5728\u5bf9\u8fdb\u7a0b\u8fdb\u884c\u8c03\u5ea6\u65f6\uff0c\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u4ee3\u4ef7\u592a\u5927\u3002</p> <p>\u4f5c\u4e3a\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u62e5\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4e92\u8865\u5e72\u6270\uff0c\u56e0\u4e3a\u521b\u5efa\u591a\u4e2a\u8fdb\u7a0b\u662f\u4e3a\u5171\u540c\u5b8c\u6210\u540c\u4e00\u4ef6\u4e8b\u60c5\uff0c\u6240\u4ee5\u8fdb\u7a0b\u4e4b\u95f4\u514d\u4e0d\u4e86\u8981\u8fdb\u884c\u4fe1\u606f\u7684\u4ea4\u6d41\uff0c\u8fd9\u65f6\u53ea\u80fd\u4f9d\u9760\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u5b8c\u6210\uff0c\u6bd4\u5982\u9700\u8981\u4f9d\u9760\u4fe1\u53f7\u91cf\u5b8c\u6210\u540c\u6b65\u4e92\u65a5\u3001\u9700\u8981\u4f9d\u9760\u6d88\u606f\u961f\u5217\u6216\u8005\u5171\u4eab\u5185\u5b58\u7b49\u65b9\u5f0f\u5b8c\u6210\u6570\u636e\u7684\u4f20\u9012\u3002\u8fd9\u79cd\u901a\u4fe1\u4e0d\u4ec5\u4ee3\u4ef7\u5927\uff0c\u56e0\u4e3a\u90fd\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u9700\u8981\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u800c\u4e14\u7f16\u7a0b\u6a21\u578b\u8fd8\u6bd4\u8f83\u590d\u6742\uff0c\u8fdc\u6ca1\u6709\u50cf\u7ebf\u7a0b\u76f4\u63a5\u4f9d\u9760\u5171\u4eab\u5730\u5740\u7a7a\u95f4\u90a3\u6837\u6765\u7684\u76f4\u63a5\u65b9\u4fbf\u3002</p> <p>\u6240\u4ee5\u7ebf\u7a0b\u5c31\u88ab\u63d0\u51fa\u6765\u4e86\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u4f5c\u4e3a\u8d44\u6e90\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u8fdb\u7a0b\u5c31\u4e0d\u518d\u88ab\u4f5c\u4e3a\u8c03\u5ea6\u7684\u5355\u4f4d\uff0c\u53ea\u4f5c\u4e3a\u8d44\u6e90\u5206\u914d\u7684\u5355\u4f4d\uff0c\u5404\u4e2a\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff08\u5982Java\u4e2d\u7684\u5806\u548c\u65b9\u6cd5\u533a\uff09\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u4fdd\u7559\u5c11\u91cf\u81ea\u5df1\u79c1\u6709\u7684\u8d44\u6e90\uff08\u5982Java\u4e2d\u7684\u6808\u548c\u7a0b\u5e8f\u8ba1\u7b97\u5668\uff09\u3002\u7ebf\u7a0b\u5f15\u5165\u4e4b\u540e\uff0c\u53ef\u4ee5\u4f9d\u9760\u591a\u4e2a\u7ebf\u7a0b\u6765\u5408\u4f5c\u5b8c\u6210\u4e4b\u524d\u7528\u591a\u4e2a\u8fdb\u7a0b\u5b8c\u6210\u7684\u5de5\u4f5c\u3002</p> <p>\u7ebf\u7a0b\u89e3\u51b3\u4e86\u4e4b\u524d\u8fdb\u7a0b\u5207\u6362\u5f00\u9500\u5927\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u5207\u6362\u9700\u8981\u4fdd\u7559\u7684\u6267\u884c\u73b0\u573a\u53ea\u662f\u81ea\u5df1\u62e5\u6709\u7684\u54ea\u4e9b\u5c11\u7559\u7684\u8d44\u6e90\uff0c\u5e76\u4e0d\u9700\u8981\u7ba1\u6574\u4e2a\u8fdb\u7a0b\u3002\u7ebf\u7a0b\u4e4b\u95f4\u534f\u4f5c\u5b8c\u6210\u67d0\u9879\u5de5\u4f5c\u4e5f\u4e0d\u9700\u8981\u50cf\u8fdb\u7a0b\u76f4\u63a5\u901a\u4fe1\u90a3\u4e48\u9ebb\u70e6\u4e86\uff0c\u76f4\u63a5\u4f9d\u9760\u5171\u4eab\u7684\u5730\u5740\u7a7a\u95f4\u5373\u53ef\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_2","title":"\u89e3\u91ca\u4e00\u4e0b\u5b64\u513f\u8fdb\u7a0b\u548c\u50f5\u5c38\u8fdb\u7a0b\uff1f","text":"<p>\u5b64\u513f\u8fdb\u7a0b\uff1a\u4e00\u4e2a\u7236\u8fdb\u7a0b\u9000\u51fa\uff0c\u800c\u5b83\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5b50\u8fdb\u7a0b\u8fd8\u5728\u8fd0\u884c\uff0c\u90a3\u4e48\u90a3\u4e9b\u5b50\u8fdb\u7a0b\u5c06\u6210\u4e3a\u5b64\u513f\u8fdb\u7a0b\u3002\u5b64\u513f\u8fdb\u7a0b\u5c06\u88abinit\u8fdb\u7a0b(\u8fdb\u7a0b\u53f7\u4e3a1)\u6240\u6536\u517b\uff0c\u5e76\u7531init\u8fdb\u7a0b\u5bf9\u5b83\u4eec\u5b8c\u6210\u72b6\u6001\u6536\u96c6\u5de5\u4f5c\u3002</p> <p>\u50f5\u5c38\u8fdb\u7a0b\uff1a\u4e00\u4e2a\u8fdb\u7a0b\u4f7f\u7528fork\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0c\u800c\u7236\u8fdb\u7a0b\u5e76\u6ca1\u6709\u8c03\u7528wait\u6216waitpid\u83b7\u53d6\u5b50\u8fdb\u7a0b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u90a3\u4e48\u5b50\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u4ecd\u7136\u4fdd\u5b58\u5728\u7cfb\u7edf\u4e2d\u3002\u8fd9\u79cd\u8fdb\u7a0b\u79f0\u4e4b\u4e3a\u50f5\u6b7b\u8fdb\u7a0b\u3002</p> <p>\u5b64\u513f\u8fdb\u7a0b\u4e0e\u50f5\u5c38\u8fdb\u7a0b\u603b\u7ed3</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#java","title":"\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u5b9e\u73b0\u7684\u65b9\u5f0f\uff0cJava\u662f\u54ea\u4e00\u79cd\uff1f","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u5b9e\u73b0\u7684\u65b9\u5f0f\u67091:1\u5b9e\u73b0\u3001N:1\u5b9e\u73b0\u3001N:M\u5b9e\u73b0\u3002</p> <ul> <li> <p>1:1\u5b9e\u73b0\u7279\u70b9\uff1a\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u652f\u6301\u7ebf\u7a0b\uff1b\u7528\u6237\u7ebf\u7a0b\u4f1a1:1\u6620\u5c04\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u7ebf\u7a0b\u4e0a\uff0c\u6240\u4ee5\u7528\u6237\u7ebf\u7a0b\u7684\u9700\u8981\u4f9d\u9760\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\uff0c\u9700\u8981\u5728\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u4e4b\u95f4\u6765\u56de\u5207\u6362\uff0c\u5f00\u9500\u6bd4\u8f83\u5927\u3002</p> </li> <li> <p>N:1\u5b9e\u73b0\u7279\u70b9\uff1a\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u652f\u6301\u7ebf\u7a0b\uff0c\u53ea\u9700\u8981\u51fd\u6570\u5e93\u652f\u6301\u5c31\u884c\uff0c\u4e5f\u5c31\u662f\u5728\u4e0d\u652f\u6301\u7ebf\u7a0b\u53ea\u652f\u6301\u8fdb\u7a0b\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u4e5f\u80fd\u5b9e\u73b0\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6240\u4ee5\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u79f0\u4e3a\u7528\u6237\u7ebf\u7a0b\u3002\u7528\u6237\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u8c03\u5ea6\u548c\u9500\u6bc1\u5b8c\u5168\u5728\u7528\u6237\u6001\u5b8c\u6210\uff0c\u5f00\u9500\u66f4\u5c0f\u3002</p> </li> <li> <p>N:M\u5b9e\u73b0\u7279\u70b9\uff1a\u7efc\u5408\u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u7684\u4f18\u70b9\u3002</p> </li> </ul> <p>\u4e3b\u6d41Java\u865a\u62df\u673a\u91c7\u7528\u7684\u662f1:1\uff0c\u8fd9\u5f53\u7136\u662f\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u652f\u63011:1\uff0c\u975e\u4e3b\u6d41\u7684JVM\u4e5f\u6709\u652f\u63011:N\u5b9e\u73b0\u3001N:M\u5b9e\u73b0\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_3","title":"\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u7684\u65b9\u5f0f\uff1f","text":"<ol> <li>\u4fe1\u53f7</li> </ol> <p>\u5728Linux \u4e2d\u4fe1\u53f7\u53d1\u9001\u548c\u6355\u83b7\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u662f\u4e00\u79cd\u5728\u65e9\u671funix\u7cfb\u7edf\u91cc\u9762\u5c31\u5b58\u5728\u7684\u901a\u4fe1\u65b9\u5f0f\uff0cshell\u547d\u4ee4kill -9\u5c31\u662f\u5728\u5411\u8fdb\u7a0b\u53d1\u9001\u7ed3\u675f\u7684\u4fe1\u53f7\u3002</p> <ol> <li>\u7ba1\u9053</li> </ol> <p>\u65e0\u540d\u7ba1\u9053\u4ec5\u7528\u4e8e\u7236\u5b50\u8fdb\u7a0b\u6216\u5144\u5f1f\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u9012\u3002\u65e9\u671funix\u7684\u65e0\u540d\u7ba1\u9053\u53ea\u652f\u6301\u534a\u53cc\u5de5\u65b9\u5f0f\uff0c\u4f46\u662f\u73b0\u4ee3unix\u652f\u6301\u5168\u53cc\u5de5\u65b9\u5f0f\u4e86\u3002</p> <p>\u6709\u540d\u7ba1\u9053\u4e5f\u79f0FIFO\u7ba1\u9053\uff0c\u6709\u540d\u7ba1\u9053\u548c\u65e0\u540d\u7ba1\u9053\u672c\u8d28\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u6709\u540d\u7ba1\u9053\u4f1a\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u751f\u6210\u4e00\u4e2a\u76ee\u5f55\u9879\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u5141\u8bb8\u4e0e\u5176\u5b83\u4e0d\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u7684\u8fdb\u7a0b\u8fdb\u884c\u901a\u4fe1\u4e86\u3002</p> <ol> <li> <p>\u6d88\u606f\u961f\u5217</p> </li> <li> <p>\u5171\u4eab\u5b58\u50a8\u533a</p> </li> <li> <p>\u4fe1\u53f7\u91cf</p> </li> <li> <p>\u5957\u63a5\u5b57</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_4","title":"\u7528\u6237\u6001\u548c\u5185\u6838\u6001\uff1f","text":"<p>\u7b80\u5355\u7684\u7406\u89e3\u5c31\u662f\u7528\u6237\u6001\u65f6cpu\u6267\u884c\u7684\u662f\u7528\u6237\u4ee3\u7801\uff0c\u5185\u6838\u6001\u65f6cpu\u6267\u884c\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u4ee3\u7801\uff0c\u533a\u522b\u5c31\u662f\u5728\u5185\u6838\u6001\u6bd4\u7528\u6237\u6001\u5177\u6709\u66f4\u9ad8\u7684\u6743\u9650\uff0c\u80fd\u591f\u6267\u884c\u4e00\u4e9b\u7279\u6743\u6307\u4ee4\u3002</p> <p>\u672c\u8d28\u4e0a\u5c31\u662fcpu\u6709\u4e00\u4e2a\u72b6\u6001\u6307\u793a\u5bc4\u5b58\u5668\uff0c\u8fd9\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u63a7\u5236\u7740CPU\u5f53\u524d\u7684\u5de5\u4f5c\u72b6\u6001\uff08ring0\u3001ring1\u3001ring2\u3001ring3\uff09\uff0ccpu\u5728\u4e0d\u540c\u7684\u72b6\u6001\u4e0b\u80fd\u6267\u884c\u4e0d\u540c\u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u6539\u53d8\u8fd9\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\u5c31\u662f\u6240\u8c13\u7684\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\u3002</p> <p>\u7cfb\u7edf\u8c03\u7528\u4f1a\u5bfc\u81f4\u8fdb\u7a0b\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u3002</p> <p>CAS\u64cd\u4f5c\u5728X86\u4e0b\u4f9d\u9760\u7684\u662fcmpxchg\u6307\u4ee4\uff0c\u8fd9\u6761\u6307\u4ee4\u5e76\u4e0d\u662f\u7279\u6743\u6307\u4ee4\uff0c\u6240\u4ee5\u5b8c\u5168\u53ef\u4ee5\u5728\u7528\u6237\u6001\u4e0b\u6267\u884c\uff0c\u4e8e\u662fCAS\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u5bfc\u81f4\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_5","title":"\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff1f","text":"<p>\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u5207\u6362\u65f6\uff0c\u4f1a\u5c06cpu\u4e2d\u5404\u79cd\u5bc4\u5b58\u5668\u7684\u503c\u4fdd\u5b58\u5230PCB\u4e2d\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_6","title":"\u6a21\u5f0f\u5207\u6362\uff1a","text":"<p>\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u5e76\u6ca1\u6709\u8fdb\u884c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u56e0\u4e3a\u7cfb\u7edf\u8c03\u7528\u4f7f\u5f97\u8fdb\u7a0b\u4ece\u7528\u6237\u6001\u8fdb\u5165\u5185\u6838\u6001\u662f\u5728\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u6210\u7684\uff0c\u53ea\u4e0d\u8fc7\u662f\u7528\u6237\u6001\u6267\u884c\u7684\u7528\u6237\u4ee3\u7801\uff0c\u800c\u5185\u6838\u6001\u6267\u884c\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u4ee3\u7801\u3002\u4f46\u662f\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u4f1a\u6539\u53d8\u7a0b\u5e8f\u6267\u884c\u7684\u6808\u7a7a\u95f4\uff0c\u5373\u4ece\u7528\u6237\u7a7a\u95f4\u7684\u7528\u6237\u6808\u5207\u6362\u5230\u5185\u6838\u7a7a\u95f4\u7684\u5185\u6838\u6808\uff0c\u56e0\u4e3a\u6267\u884c\u7684\u4e0d\u540c\u7684\u4ee3\u7801\uff0c\u6539\u53d8\u6808\u7a7a\u95f4\u5e95\u5c42\u5176\u5b9e\u5c31\u662f\u6539\u53d8cpu\u4e2d\u6709\u5173\u5730\u5740\u7684\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u8bf4\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u4f1a\u8fdb\u884c\u5bc4\u5b58\u5668\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u53ea\u4e0d\u8fc7\u76f8\u6bd4\u4e8e\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5bc4\u5b58\u5668\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u4ee3\u4ef7\u8981\u66f4\u4f4e\uff0c\u628a\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\u79f0\u4e3a\u6a21\u5f0f\u5207\u6362\uff0c\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_7","title":"\u89e3\u91ca\u4e00\u4e0b\u6587\u4ef6\u7684\u903b\u8f91\u7ed3\u6784\u548c\u7269\u7406\u7ed3\u6784\uff1f\u7528\u6237\u7a0b\u5e8f\u4ece\u78c1\u76d8\u4e0a\u8bfb\u53d6\u6570\u636e\u7684\u6d41\u7a0b\uff1f","text":"<p>\u7a0b\u5e8f\u5458\u5728\u5199\u4ee3\u7801\u65f6\u5176\u5b9e\u8003\u8651\u7684\u90fd\u662f\u6587\u4ef6\u7684\u903b\u8f91\u7ed3\u6784\uff0c\u6bd4\u5982\u987a\u5e8f\u6587\u4ef6\uff0c\u7d22\u5f15\u6587\u4ef6\uff08\u4ec0\u4e48\u4e00\u7ea7\u7d22\u5f15\uff0c\u591a\u7ea7\u7d22\u5f15\uff0cB\u6811\u7d22\u5f15\uff0cHash\u7d22\u5f15\u90fd\u662f\u6587\u4ef6\u7684\u903b\u8f91\u7ed3\u6784\uff09\uff0c\u4e5f\u5c31\u662f\u7a0b\u5e8f\u5728\u5199\u4ee3\u7801\u65f6\u601d\u8003\u5982\u4f55\u4ece\u6587\u4ef6\u4e2d\u8bfb\u6570\u636e\u65f6\uff0c\u8111\u888b\u91cc\u9762\u88c5\u7684\u90fd\u662f\u6587\u4ef6\u7684\u903b\u8f91\uff0c\u628a\u6587\u4ef6\u89c6\u4e3a\u4e00\u4e2a\u6574\u4f53\uff0c\u4e00\u6574\u5757\u7684\u3002</p> <p>\u6bd4\u5982\u5bf9\u4e8e\u903b\u8f91\u7ed3\u6784\u5305\u542b\u7d22\u5f15\u7684\u6587\u4ef6\uff0c\u7a0b\u5e8f\u5458\u5199\u4ee3\u7801\u65f6\u9996\u5148\u4f1a\u4f7f\u7528c\u8bed\u8a00\u7684read\u7cfb\u7edf\u8c03\u7528\u8bfb\u6587\u4ef6\u4e2d\u7684\u7d22\u5f15\uff0c\u4f20\u5165\u7684\u53c2\u6570\u662f\u7d22\u5f15\u5728\u54ea\u4e2a\u6587\u4ef6\u3001\u76f8\u5bf9\u4e8e\u6587\u4ef6\u5f00\u5934\u591a\u5c11\u504f\u79fb\u3001\u591a\u5c11\u5b57\u8282\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u90fd\u662f\u5728\u6839\u636e\u6587\u4ef6\u7684\u903b\u8f91\u5728\u601d\u8003\u6570\u636e\u7684\u4f4d\u7f6e\u3002</p> <p>\u7136\u540e\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5f00\u59cb\u6839\u636e\u6587\u4ef6\u7684\u7269\u7406\u7ed3\u6784\u6765\u8bfb\u6570\u636e\u7684\u3002</p> <p>\u9996\u5148\u662f\u64cd\u4f5c\u7cfb\u7edf\u6839\u636e\u7b2c\u4e00\u4e2a\u53c2\u6570\u5373\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u627e\u6587\u4ef6\uff0c\u8fc7\u7a0b\u662f\uff0c\u6839\u636e\u7f13\u5b58\u5728\u5185\u6838\u7a7a\u95f4\u7684\u6839\u76ee\u5f55\u6587\u4ef6\u627e\u5230\u4e8c\u7ea7\u76ee\u5f55\u7684inode\u8282\u70b9\uff0c\u7136\u540e\u542f\u52a8\u78c1\u76d8IO\u4ece\u78c1\u76d8\u7684\u7d22\u5f15\u8282\u70b9\u533a\u8bfb\u53d6\u7d22\u5f15\u8282\u70b9\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u63a5\u7740\u5c31\u53ef\u4ee5\u6839\u636e\u7d22\u5f15\u8282\u70b9\u627e\u5230\u4e8c\u7ea7\u76ee\u5f55\u5bf9\u5e94\u7684\u6587\u4ef6\u5728\u78c1\u76d8\u6587\u4ef6\u6570\u636e\u533a\u6240\u5728\u7684\u4f4d\u7f6e\u4e86\uff0c\u7136\u540e\u518d\u542f\u52a8\u78c1\u76d8IO\u8bfb\u53d6\u8fd9\u4e2a\u76ee\u5f55\u6587\u4ef6\uff0c\u518d\u6839\u636e\u8fd9\u4e2a\u76ee\u5f55\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u627e\u4e09\u7ea7\u76ee\u5f55\u7684inode\u8282\u70b9\uff0c\u4e00\u76f4\u8fd9\u6837\u64cd\u4f5c\u7cfb\u7edf\u5c31\u53ef\u4ee5\u627e\u5230\u4f60\u8981\u8bfb\u53d6\u7684\u6587\u4ef6\u7684\u7d22\u5f15\u8282\u70b9\u4e86\u3002</p> <p>\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u6839\u636e\u7b2c\u4e8c\u3001\u4e09\u4e2a\u53c2\u6570\u5728inode\u8282\u70b9\u4e2d\u627e\u5230\u4f60\u6240\u8981\u8bfb\u53d6\u6570\u636e\u5757\uff0c\u63a5\u7740\u542f\u52a8\u78c1\u76d8IO\u5c06\u6570\u636e\u5757\u4ece\u78c1\u76d8\u8bfb\u5230\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7a7a\u95f4\uff0c\u6700\u540e\u628a\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u3002</p> <p>\u4e8e\u662f\u4f60\u5c31\u62ff\u5230\u6587\u4ef6\u903b\u8f91\u7684\u7d22\u5f15\u4e86\uff0c\u63a5\u7740\u4f60\u6839\u636e\u8fd9\u4e2a\u7d22\u5f15\u627e\u5230\u4f60\u6240\u9700\u8981\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u4e5f\u662f\u76f8\u5bf9\u4e8e\u6587\u4ef6\u5f00\u5934\u591a\u5c11\u504f\u79fb\uff0c\u7136\u540e\u4f60\u62ff\u7740\u8fd9\u4e2a\u903b\u8f91\u5730\u5740\u7ee7\u7eed\u8c03\u7528read\u7cfb\u7edf\u8c03\u7528\uff0c\u64cd\u4f5c\u7cfb\u7edf\u91cd\u590d\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u4e8e\u662f\u4f60\u5c31\u62ff\u5230\u6570\u636e\u4e86\u3002</p> <p>\u6240\u4ee5\u6587\u4ef6\u7684\u903b\u8f91\u7ed3\u6784\u548c\u7269\u7406\u7ed3\u6784\u90fd\u4f1a\u5f71\u54cd\u6587\u4ef6\u7684\u8bfb\u53d6\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_8","title":"\u4e3a\u4ec0\u4e48\u8981\u6709\u865a\u62df\u5185\u5b58\uff1f","text":"<p>\u5982\u679c\u6ca1\u6709\u865a\u62df\u5185\u5b58\uff0c\u9700\u8981\u5c06\u6574\u4e2a\u7a0b\u5e8f\u90fd\u88c5\u8fdb\u5185\u5b58\u624d\u80fd\u8fd0\u884c\uff0c\u8fd9\u6837\u5c31\u4f1a\u56e0\u4e3a\u5185\u5b58\u5bb9\u91cf\u7684\u9650\u5236\uff0c\u5bfc\u81f4\u88c5\u5165\u5185\u5b58\u7684\u7a0b\u5e8f\u6709\u9650\uff0c\u4ece\u800ccpu\u7684\u5229\u7528\u7387\u5c31\u4f1a\u5927\u5927\u964d\u4f4e\uff0c\u56e0\u4e3a\u53ef\u5e76\u53d1\u6267\u884c\u7a0b\u5e8f\u6709\u9650\uff0c\u4e00\u65e6\u6240\u6709\u5728\u5185\u5b58\u4e2d\u7684\u7a0b\u5e8f\u7531\u4e8eIO\u963b\u585e\u4e86\uff0c\u90a3\u4e48cpu\u5c31\u5b8c\u5168\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u4e86\uff0c\u6709\u4e86\u865a\u62df\u5185\u5b58\u4e4b\u540e\uff0c\u5c06\u7a0b\u5e8f\u90e8\u5206\u8f6c\u5165\u5185\u5b58\u5c31\u53ef\u8fd0\u884c\u4e86\uff0c\u8fd9\u6837\u540c\u65f6\u8f6c\u5165\u5185\u5b58\u7684\u7a0b\u5e8f\u7684\u6570\u91cf\u5c31\u5927\u5927\u589e\u52a0\u4e86\uff0c\u5f53\u7a0b\u5e8f\u6267\u884c\u5230\u67d0\u5904\u8981\u5c06\u903b\u8f91\u5730\u5740\u7ecf\u9875\u8868\u8f6c\u6362\u6210\u7269\u7406\u5730\u5740\u65f6\uff0c\u53d1\u73b0\u9875\u8868\u8be5\u903b\u8f91\u5730\u5740\u5bf9\u5e94\u7684\u7269\u7406\u5730\u5740\u4e0d\u5b58\u5728\uff0c\u5c31\u4f1a\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\uff0c\u8fd9\u4e2a\u65f6\u5019\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u5916\u5b58\u7684\u9875\u8c03\u5230\u5185\u5b58\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_9","title":"\u5185\u5b58\u7684\u7ba1\u7406\u65b9\u5f0f\u6709\u54ea\u4e9b\uff1f","text":"<p>\u65e0\u8bba\u662f\u5185\u5b58\u8fd8\u662f\u5916\u5b58\uff0c\u5bf9\u5b58\u50a8\u7a7a\u95f4\u7684\u7ba1\u7406\uff0c\u90fd\u6709\u4e24\u4e2a\u65b9\u9762\uff0c\u4e00\u662f\u5bf9\u6b63\u5728\u4f7f\u7528\u7684\u7a7a\u95f4\u7684\u7ba1\u7406\uff0c\u53e6\u4e00\u4e2a\u662f\u5bf9\u6ca1\u6709\u4f7f\u7528\u7684\u7a7a\u95f4\u7684\u7ba1\u7406\u3002\u5bf9\u5185\u5b58\u6b63\u5728\u4f7f\u7528\u7684\u7a7a\u95f4\u7684\u7ba1\u7406\u65b9\u5f0f\u5c31\u662f\u9875\u8868\u548c\u6bb5\u8868\uff0c\u5bf9\u5185\u5b58\u672a\u4f7f\u7528\u7a7a\u95f4\u7684\u7ba1\u7406\u65b9\u5f0f\u662f\u4e00\u4e9b\u52a8\u6001\u5206\u533a\u5206\u914d\u7b97\u6cd5\uff0c\u6bd4\u5982\u9996\u6b21\u9002\u5e94\u7b97\u6cd5\u3001\u5faa\u73af\u9996\u6b21\u9002\u5e94\u7b97\u6cd5\u3001\u4f19\u4f34\u7cfb\u7edf\u7b49\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_10","title":"\u5916\u5b58\u7684\u7ba1\u7406\u65b9\u5f0f\uff1f","text":"<p>\u5bf9\u5df2\u4f7f\u7528\u7684\u7a7a\u95f4\u7684\u7ba1\u7406\u65b9\u5f0f\u6709 Windows\u7684FAT\u3001NTFS\uff0cunix\u7684\u589e\u91cf\u5f0f\u7d22\u5f15\u3002\u5bf9\u672a\u4f7f\u7528\u7a7a\u95f4\u7684\u7ba1\u7406\u65b9\u5f0f\u6709\u7a7a\u95f2\u94fe\u8868\u6cd5\u3001\u4f4d\u793a\u56fe\u6cd5\u3001\u6210\u7ec4\u94fe\u63a5\u6cd5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_11","title":"\u9875\u8868\u548c\u6bb5\u8868\uff1f","text":"<p>\u5982\u679c\u6ca1\u6709\u865a\u62df\u5185\u5b58\uff0c\u9700\u8981\u5c06\u6574\u4e2a\u7a0b\u5e8f\u90fd\u88c5\u8fdb\u5185\u5b58\u624d\u80fd\u8fd0\u884c\uff0c\u8fd9\u65f6\uff0c\u5982\u679c\u662f\u5185\u5b58\u4e0d\u662f\u6bb5\u5f0f\u6216\u9875\u5f0f\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u90a3\u4e48\u9700\u8981\u7ed9\u7a0b\u5e8f\u5206\u914d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u4e3a\u9700\u8981\u4e00\u6b21\u6027\u5c06\u7a0b\u5e8f\u4e2d\u7684\u903b\u8f91\u5730\u5740\u8f6c\u53d8\u6210\u5185\u5b58\u7269\u7406\u5730\u5740\uff0c\u5982\u679c\u5185\u5b58\u662f\u6bb5\u5f0f\u6216\u9875\u5f0f\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u90a3\u4e48\u4e0d\u5fc5\u5148\u8fdb\u884c\u5730\u5740\u8f6c\u6362\uff0c\u8fd0\u884c\u7684\u65f6\u5019\u518d\u901a\u8fc7\u9875\u8868\u6216\u6bb5\u8868\u8fdb\u884c\u903b\u8f91\u5730\u5740\u5230\u5185\u5b58\u7269\u7406\u5730\u5740\u7684\u8f6c\u6362\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#dma","title":"DMA\uff1f","text":"<p>\u6ca1\u6709DMA\u65f6\uff0c\u5916\u90e8IO\u8bbe\u5907\u7684\u6570\u636e\u5230\u5185\u5b58\u9700\u8981CPU\u7684\u53c2\u4e0e\uff0c\u8fc7\u7a0b\u662fCPU\u5148\u628a\u5916\u90e8\u8bbe\u5907\u7684\u6570\u636e\u8bfb\u5230CPU\u5bc4\u5b58\u5668\uff0c\u7136\u540e\u518d\u628aCPU\u5bc4\u5b58\u5668\u7684\u6570\u636e\u5199\u5230\u5185\u5b58\u3002\u6b64\u65f6\u7684IO\u6709\u4e24\u79cd\u65b9\u5f0f\uff08\u4ee5\u78c1\u76d8IO\u4e3a\u4f8b\uff09\uff1a</p> <ol> <li> <p>\u8f6e\u8be2\u65b9\u5f0f\uff1a\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u78c1\u76d8\u9a71\u52a8\u7a0b\u5e8f\u540e\uff0c\u4f1a\u4e00\u76f4\u8f6e\u8be2\u68c0\u67e5\u78c1\u76d8\u63a7\u5236\u5668\u7f13\u51b2\u533a\uff08\u5916\u90e8IO\u8bbe\u5907\u90fd\u6709\u81ea\u5df1\u7684\u7f13\u51b2\u533a\uff0c\u5bb9\u91cf\u5e76\u4e0d\u5927\uff09\u6709\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u5982\u679c\u51c6\u5907\u597d\u4e86\u5c31\u628a\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\uff08PageCache\uff09\u4e2d\u3002</p> </li> <li> <p>\u4e2d\u65ad\u65b9\u5f0f\uff1a\u6b64\u79cd\u65b9\u5f0f\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u4f1a\u4e00\u76f4\u8f6e\u8be2\uff0c\u800c\u662f\u5728\u8c03\u7528\u78c1\u76d8\u9a71\u52a8\u7a0b\u5e8f\u540e\u76f4\u63a5\u8fd4\u56de\uff0c\u5f53\u78c1\u76d8\u63a7\u5236\u5668\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u51c6\u5907\u597d\u4e4b\u540e\u4f1a\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u53d1\u9001\u4e00\u4e2a\u4e2d\u65ad\u4fe1\u53f7\uff0c\u7136\u540e\u7531CPU\u54cd\u5e94\u4e2d\u65ad\uff0c\u8fd9\u65f6CPU\u4f1a\u628a\u78c1\u76d8\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230CPU\u5bc4\u5b58\u5668\uff0c\u7136\u540e\u518d\u5199\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u3002</p> </li> </ol> <p>\u6709\u4e86DMA\u4e4b\u540e\uff0c\u5916\u90e8IO\u8bbe\u5907\u7684\u6570\u636e\u5230\u5185\u5b58\u5c31\u4e0d\u9700\u8981CPU\u53c2\u4e0e\u4e86\uff0c\u800c\u662f\u7531DMA\u76f4\u63a5\u63a7\u5236\uff0cDMA\u5c06\u6570\u636e\u4ece\u5916\u90e8IO\u8bbe\u5907\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e4b\u540e\u4f1a\u7ed9CPU\u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\u3002</p> <p>\u6ce8\u610f\uff1aDMA\u7684\u4f5c\u7528\u662f\u5c06\u5916\u90e8IO\u8bbe\u5907\u7684\u6570\u636e\u62f7\u8d1d\u5230\u5185\u5b58\uff0c\u5185\u5b58\u4e2d\u6570\u636e\u7684\u590d\u5236\u4e0eDMA\u65e0\u5173\uff0c\u5185\u5b58\u4e2d\u6570\u636e\u7684\u590d\u5236\u9700\u8981\u7ecf\u8fc7CPU\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u5728\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7684\u590d\u5236\uff0c\u4ee5\u53ca\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\u7684\u590d\u5236\u90fd\u662f\u5728CPU\u7684\u63a7\u5236\u4e0b\u5b8c\u6210\u7684\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#pagecache","title":"PageCache?","text":"<p>PageCache\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u7f13\u5b58\u5916\u90e8IO\u8bbe\u5907\u6570\u636e\u7684\u90e8\u5206\uff0c\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u7cfb\u7edf\u8c03\u7528\u8bfb\u53d6\u5916\u90e8\u8bbe\u5907\u6570\u636e\u65f6\uff0c\u64cd\u4f5c\u9996\u5148\u4f1a\u5c06\u6570\u636e\u8bfb\u5230PageCache\uff0c\u7136\u540e\u518d\u7531CPU\u5c06\u6570\u636e\u590d\u5236\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\uff0c\u8fd9\u79cdIO\u65b9\u5f0f\u4e5f\u79f0\u4e3a\u7f13\u5b58IO\u3002</p> <p>\u5f53\u7136\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u63d0\u4f9b\u4e86\u7ed5\u5f00PageCache\u7684IO\u65b9\u5f0f\uff0c\u79f0\u4e3a\u76f4\u63a5IO\uff0c\u4e5f\u5c31\u662f\u5916\u90e8\u8bbe\u5907\u76f4\u63a5\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u7f13\u51b2\u533a\u8fdb\u884cIO\u3002\u7528\u6237\u6001\u76f4\u63a5 I/O \u53ea\u80fd\u9002\u7528\u4e8e\u4e0d\u9700\u8981\u5185\u6838\u7f13\u51b2\u533a\u5904\u7406\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u4e9b\u5e94\u7528\u7a0b\u5e8f\u901a\u5e38\u5728\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u6709\u81ea\u5df1\u7684\u6570\u636e\u7f13\u5b58\u673a\u5236\uff0c\u79f0\u4e3a\u81ea\u7f13\u5b58\u5e94\u7528\u7a0b\u5e8f\uff0c\u5982\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u5c31\u662f\u4e00\u4e2a\u4ee3\u8868\uff08MySQL\u7684buffer pool\uff09\u3002\u53e6\u5916\uff0c\u5f02\u6b65IO\u65b9\u5f0f\u652f\u6301\u76f4\u63a5IO\u3002</p> <p>\u4f7f\u7528PageCache\u7684\u597d\u5904\uff1a</p> <ol> <li> <p>\u7f13\u5b58\u547d\u4e2d\uff0c\u51cf\u5c11\u8bfb\u3002PageCache\u4e2d\u7f13\u5b58\u7684\u662f\u6700\u8fd1\u88ab\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u6839\u636e\u7a0b\u5e8f\u8fd0\u884c\u7684\u5c40\u90e8\u6027\uff0c\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u5728\u77ed\u65f6\u95f4\u5185\u518d\u6b21\u88ab\u8bbf\u95ee\u7684\u6982\u7387\u5f88\u9ad8\uff0c\u6240\u4ee5\u5f53\u4e0b\u6b21\u8bbf\u95ee\u540c\u6837\u7684\u6570\u636e\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5fc5\u518d\u6b21\u8fdb\u884cIO\uff0c\u800c\u662f\u76f4\u63a5PageCache\u4e2d\u7f13\u5b58\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\u5373\u53ef\u3002</p> </li> <li> <p>\u9884\u8bfb\uff0c\u51cf\u5c11\u8bfb\u3002PageCache\u63d0\u4f9b\u9884\u8bfb\u529f\u80fd\uff0c\u6240\u8c13\u7684\u9884\u8bfb\u529f\u80fd\u5c31\u662f\uff0c\u78c1\u76d8IO\u65f6\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u591a\u8bfb\u4e00\u70b9\u6570\u636e\u3002\u6bd4\u5982\u4f60\u53ea\u60f3\u8bfb32KB\u7684\u6570\u636e\uff0c\u8fdb\u884c\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u8bfb\u53d664KB\u7684\u6570\u636e\u5230PageCache\u4e2d\u3002</p> </li> <li> <p>\u987a\u5e8f\u5199\uff0c\u51cf\u5c11\u968f\u673a\u5199\u3002\u64cd\u4f5c\u7cfb\u7edf\u7684 I/O \u8c03\u5ea6\u7b97\u6cd5\u4f1a\u7f13\u5b58\u5c3d\u53ef\u80fd\u591a\u7684 I/O \u8bf7\u6c42\u5728PageCahche\uff0c\u6700\u540e\u5408\u5e76\u6210\u4e00\u4e2a\u66f4\u5927\u7684 I/O \u8bf7\u6c42\u518d\u53d1\u7ed9\u78c1\u76d8\uff0c\u51cf\u5c11\u968f\u673a\u5199\uff0c\u589e\u52a0\u987a\u5e8f\u5199\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_12","title":"\u96f6\u62f7\u8d1d\u6280\u672f\uff1f","text":"<p>\u4ece\u78c1\u76d8\u8bfb\u6570\u636e\uff0c\u7136\u540e\u5199\u5230\u7f51\u7edc\u8bbe\u5907\u4e2d\u53d1\u51fa\u53bb\uff0cread+write\u662f\u6700\u4f20\u7edf\u7684\u65b9\u5f0f\uff0c\u4ee5\u4e0b\u662f\u5b9e\u73b0\u96f6\u62f7\u8d1d\u5e38\u7528\u7684\u6280\u672f\uff1a</p> <ol> <li> <p>mmap+write\uff1a\u76f4\u63a5\u5c06\u6570\u636e\u4ece \u5185\u6838\u8bfb\u7f13\u51b2\u533a \u62f7\u8d1d\u5230 \u5185\u6838\u5199\u7f13\u51b2\u533a\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u5c06\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7528\u6237\u5730\u5740\u7a7a\u95f4\u7684\u6210\u672c\u3002</p> </li> <li> <p>sendfile\uff1a\u76f8\u6bd4\u4e8emmap\u53ea\u662f\u51cf\u5c11\u4e00\u6b21\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u5207\u6362\uff0c\u6570\u636e\u540c\u6837\u662f\u76f4\u63a5\u4ece\u5185\u6838\u7684\u8bfb\u7f13\u51b2\u533a\u5199\u5230\u4e86\u5185\u6838\u5199\u7f13\u51b2\u533a\u3002\u56e0\u4e3a\u53ea\u5728\u5185\u6838\u6001\u8fdb\u884c\uff0c\u6240\u4ee5\u7528\u6237\u8fdb\u7a0b\u65e0\u6cd5\u64cd\u4f5c\u6570\u636e\uff0c\u4ee3\u7801\u4e0a\u7684\u4f53\u73b0\u5c31\u662f\uff0c\u4f7f\u7528mmap\u662f\u4e24\u6b65\u641e\u5b9a\u7684\uff0c\u6240\u4ee5\u4e2d\u95f4\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u4f46\u662f\u4f7f\u7528snedfile\u662f\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u6ca1\u6709\u64cd\u4f5c\u6570\u636e\u7684\u4f59\u5730\u3002</p> </li> <li> <p>sendfile+SGDMA(Scatter-Gather DMA)\uff1a\u76f8\u6bd4\u4e8e\u53ea\u4f7f\u7528sendfile\uff0c\u51cf\u5c11\u4e86\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u6570\u636e\u76f4\u63a5\u4ece\u5185\u6838\u8bfb\u7f13\u51b2\u533a\u6620\u5c04\u5230\u5185\u6838\u5199\u7f13\u51b2\u533a\u7684\uff0c\u4ecd\u7136\u65e0\u6cd5\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\u3002\u8fd9\u624d\u662f\u771f\u6b63\u7684\u96f6\u62f7\u8d1d\uff08Zero-copy\uff09\u6280\u672f\uff0c\u56e0\u4e3a\u6ca1\u6709\u5728\u5185\u5b58\u5c42\u9762\u53bb\u62f7\u8d1d\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\u5168\u7a0b\u6ca1\u6709\u901a\u8fc7 CPU \u6765\u642c\u8fd0\u6570\u636e\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7 DMA \u6765\u8fdb\u884c\u4f20\u8f93\u7684\u3002\u5982\u679c\u7f51\u5361\u652f\u6301SG-DMA\uff08The Scatter-Gather Direct Memory Access\uff09\u6280\u672f\uff0c\u4f7f\u7528sendfile() \u7cfb\u7edf\u8c03\u7528\u76f4\u63a5\u5c31\u662fsendfile+SGDMA\u7684\u65b9\u5f0f\uff0c\u5982\u679c\u4e0d\u652f\u6301\uff0c\u90a3\u5c31\u662fsendfile\u65b9\u5f0f\u3002</p> </li> </ol> <p>\u96f6\u62f7\u8d1d\u6280\u672f-\u5c0f\u6797coding</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/","title":"\u79bb\u7ebf\u6570\u4ed3","text":"<p> \u7ea6 3768 \u4e2a\u5b57  8 \u884c\u4ee3\u7801  5 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 75 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_1","title":"\u4ec0\u4e48\u662f\u6570\u636e\u4ed3\u5e93\uff1f","text":"<p>\u540e\u53f0\u7cfb\u7edf\u6bcf\u5929\u90fd\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6570\u636e\u5e93MySQL\u4e2d\u7684\u4e1a\u52a1\u6570\u636e\uff0c\u548c\u901a\u8fc7\u57cb\u70b9\u65e5\u5fd7\u4ea7\u751f\u7684\u7528\u6237\u884c\u4e3a\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u4e2d\u8574\u542b\u7740\u5927\u91cf\u6709\u4ef7\u503c\u7684\u4fe1\u606f\uff0c\u4f46\u662f\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f\u8fd9\u4e9b\u6570\u636e\u5e76\u6ca1\u6709\u88ab\u5408\u7406\u7ec4\u7ec7\u548c\u50a8\u5b58\u8d77\u6765\uff0c\u8fd9\u4f1a\u7ed9\u6570\u636e\u4ef7\u503c\u7684\u6316\u6398\u5e26\u6765\u6781\u5927\u7684\u56f0\u96be\uff0c\u6bd4\u5982\u4e1a\u52a1\u6570\u636e\u5e93MySQL\u4e0d\u4f1a\u5b58\u50a8\u5386\u53f2\u6570\u636e\uff0cMySQL\u4e2d\u7684\u6570\u636e\u53cd\u6620\u7684\u53ea\u662f\u5f53\u524d\u4e1a\u52a1\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u800c\u5728\u65f6\u95f4\u7ef4\u5ea6\u4e0a\u5bf9\u5386\u53f2\u6570\u636e\u7684\u5206\u6790\u662f\u5177\u6709\u6781\u5927\u4ef7\u503c\u7684\uff0c\u518d\u6bd4\u5982\u5982\u679c\u76f4\u63a5\u4f7f\u7528\u65e5\u5fd7\u6570\u636e\uff0c\u90a3\u4e48\u9488\u5bf9\u4e0d\u540c\u7684\u9700\u6c42\uff0c\u4e0d\u540c\u7684\u5f00\u53d1\u4eba\u5458\u90fd\u9700\u8981\u81ea\u5df1\u5bf9\u539f\u59cb\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u91cd\u590d\u5f00\u53d1\uff0c\u4e25\u91cd\u964d\u4f4e\u5f00\u53d1\u6548\u7387\u3002\u6570\u4ed3\u5c31\u662f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\uff0c\u6570\u4ed3\u5e76\u4e0d\u662f\u6570\u636e\u8d77\u70b9\u4e5f\u4e0d\u662f\u6570\u636e\u7684\u7ec8\u70b9\uff0c\u5b83\u5904\u5728\u4e00\u4e2a\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u6570\u4ed3\u6240\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u5c06\u4e1a\u52a1\u6570\u636e\u548c\u65e5\u5fd7\u6570\u636e\u5408\u7406\u7684\u7ec4\u7ec7\u548c\u5b58\u50a8\u8d77\u6765\uff0c\u6bd4\u5982\u6e05\u6d17\u3001\u5907\u4efd\u3001\u805a\u5408\u3001\u7edf\u8ba1\uff0c\u800c\u4e14\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u662f\uff0c\u6570\u4ed3\u4f1a\u50a8\u5b58\u5386\u53f2\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u6570\u4ed3\u4f1a\u5bf9\u540e\u53f0\u7cfb\u7edf\u6bcf\u65e5\u65b0\u589e\u7684\u6570\u636e\u8fdb\u884c\u540c\u6b65\uff0c\u901a\u8fc7\u6570\u4ed3\u7684\u5206\u5c42\u88c5\u8f7d\u4e4b\u540e\uff0c\u6781\u5927\u5730\u65b9\u4fbf\u4e86\u540e\u7eed\u5bf9\u6570\u636e\u7684\u5229\u7528\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_2","title":"\u6570\u636e\u5e93\u4e0e\u6570\u636e\u4ed3\u5e93\u7684\u533a\u522b\uff1f","text":"<p>1.\u6570\u636e\u5e93\u9762\u5411\u4e8b\u52a1\u5904\u7406\uff1b\u800c\u6570\u4ed3\u9762\u5411\u6570\u636e\u5206\u6790\u3002</p> <p>2.\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u7684\u662f\u7cfb\u7edf\u5f53\u524d\u7684\u6570\u636e\uff1b\u6570\u4ed3\u4e2d\u4fdd\u5b58\u6709\u5386\u53f2\u6570\u636e\u3002</p> <p>3.\u6570\u636e\u5e93\u4f7f\u7528\u5173\u7cfb\u5efa\u6a21\uff0c\u9075\u5faa\u4e09\u8303\u5f0f\uff1b\u6570\u4ed3\u4f7f\u7528\u7ef4\u5ea6\u5efa\u6a21\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_3","title":"\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u9879\u76ee\uff1f","text":"<p>\u8fd9\u4e2a\u9879\u76ee\u662f\u5bf9\u7535\u5546\u5e73\u53f0\u5efa\u7acb\u7684\u79bb\u7ebf\u6570\u4ed3\uff0c\u4e00\u5171\u5206\u4e3a\u4e86ODS\u5c42\u3001DIM \u5c42\u3001DWD \u5c42\u3001DWS \u5c42\u3001DWT \u5c42 \u548c ADS\u5c42\u3002</p> <p>\u57cb\u70b9\u65e5\u5fd7\u901a\u8fc7Flume+Kafka+Flume\u7684\u6570\u636e\u91c7\u96c6\u901a\u9053\u540c\u6b65\u5230HDFS\u4e0a\uff0cMySQL\u4e2d\u7684\u4e1a\u52a1\u6570\u636e\u901a\u8fc7sqoop\u540c\u6b65\u5230HDFS\u4e0a\uff0c\u7136\u540e\u4f7f\u7528Hive\u7684load\u547d\u4ee4\u5c06\u6570\u636e\u5bfc\u5165\u5230ODS\u5c42\u7684\u8868\u4e2d\u3002\u5bf9\u4e8e\u65e5\u5fd7\u6570\u636e\uff0c\u5c06\u6bcf\u5929\u7684\u589e\u91cf\u6570\u636e\u540c\u6b65\u5230HDFS\u4e2d\uff1b\u5bf9\u4e8e\u4e1a\u52a1\u6570\u636e\uff0cODS\u5c42\u6709\u4e09\u79cd\u540c\u6b65\u7b56\u7565\uff1a\u5168\u91cf\u540c\u6b65\u3001\u589e\u91cf\u540c\u6b65\u3001\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u3002\u5f53\u7136\u56e0\u4e3a\u662f\u7ec3\u624b\u7684\u9879\u76ee\uff0c\u6240\u4ee5\u8fd9\u4e24\u79cd\u6570\u636e\u90fd\u662f\u4f7f\u7528\u811a\u672c\u6a21\u62df\u751f\u6210\u7684\u3002</p> <p>DIM\u5c42\u548cDWD\u5c42\u6839\u636e\u7ef4\u5ea6\u5efa\u6a21\u5bf9ODS\u5c42\u7684\u6570\u636e\u8fdb\u884c\u52a0\u5de5\uff0cDIM\u5c42\u5b58\u7684\u662f\u7ef4\u5ea6\u8868\uff0c\u6709\u4e24\u79cd\u540c\u6b65\u7b56\u7565\uff0c\u5373\u5168\u91cf\u8868\u548c\u62c9\u94fe\u8868\uff0cDWD\u5c42\u5b58\u7684\u662f\u4e8b\u5b9e\u8868\uff0c\u6709\u4e09\u79cd\u7c7b\u578b\u7684\u540c\u6b65\u7b56\u7565\uff0c\u5373\u5bf9\u5e94\u4e09\u79cd\u7c7b\u578b\u7684\u8868\uff1a\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3001\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3001\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002</p> <p>DWS\u5c42\u548cDWT\u5c42\u6309\u4e3b\u9898\u5bf9DWD\u5c42\u4e8b\u5b9e\u8868\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u533a\u522b\u6709\u51e0\u70b9\uff1a</p> <ol> <li>DWS\u5c42\u5b58\u7684\u662f\u5bf9\u6570\u636e\u7684\u6bcf\u65e5\u6c47\u603b\uff0c\u800cDWT\u5c42\u5b58\u7684\u662f\u8fd17\u65e5\u3001\u8fd130\u65e5\u3001\u4ee5\u53ca\u7d2f\u79ef\u6c47\u603b\u7684\u805a\u5408\u503c\u3002</li> <li>DWS\u5c42\u662f\u5bf9DWD\u5c42\u6d3b\u8dc3\u6307\u6807\u7684\u7edf\u8ba1\uff0c\u4e5f\u5c31\u662f\u5f53\u5929\u6709\u6d3b\u8dc3\u7684\u6570\u636e\u624d\u4f1a\u88ab\u805a\u5408\uff0c\u6bd4\u5982DWS\u5c42\u5546\u54c1\u4e3b\u9898\u8868\u5f53\u5929\u7684\u5206\u533a\u4e2d\u5b58\u7684\u5c31\u662f\u5f53\u5929\u6709\u4ea7\u751f\u4e0b\u5355\u9000\u5355\u7684\u5546\u54c1\u7684\u805a\u5408\u503c\uff0c\u5728sql\u7684\u5b9e\u73b0\u4e0a\u5c31\u662f\uff0c\u53d6dwd\u5c42\u4e8b\u5b9e\u8868\u5f53\u5929\u5206\u533a\u7684\u6570\u636e\u8fdb\u884c\u805a\u5408\uff0c\u7136\u540eleft join\u5173\u8054\u7ef4\u5ea6\u8868\uff0c\u5173\u8054\u7684\u76ee\u7684\u662f\u7ef4\u5ea6\u9000\u5316\uff0c\u7ef4\u5ea6\u9000\u5316\u7684\u4f18\u70b9\u5c31\u662f\u53ef\u4ee5\u5728\u6709\u9700\u8981\u7684\u65f6\u5019\u52a0\u5feb\u67e5\u8be2\uff0c\u4e0d\u7528\u518d\u53bb\u5173\u8054\u7ef4\u5ea6\u8868\uff0c\u7f3a\u70b9\u5c31\u662f\u589e\u52a0\u4e86\u5b58\u50a8\u5f00\u9500\u3002</li> <li>DWT\u5c42\u7684\u6570\u636e\u6765\u6e90\u662fDWS\u5c42\uff0c\u662f\u5bf9DWS\u5c42\u6570\u636e\u7684\u8fdb\u4e00\u6b65\u805a\u5408\uff0c\u5b58\u7684\u662f\u8fd17\u65e5\u3001\u8fd130\u65e5\u3001\u4ee5\u53ca\u7d2f\u79ef\u6c47\u603b\u7684\u805a\u5408\u503c\u3002DWT\u5c42\u76f8\u5bf9DWS\u5c42\u800c\u8a00\u5b58\u7684\u662f\u5168\u91cf\u6570\u636e\u7684\u805a\u5408\u503c\uff0c\u6bd4\u5982DWT\u5c42\u7684\u5546\u54c1\u4e3b\u9898\u8868\u4e2d\u5b58\u7684\u662f\u6240\u6709\u5546\u54c1\u7684\u7d2f\u79ef\u805a\u5408\u503c\uff0c\u5728sql\u7684\u5b9e\u73b0\u4e0a\u5c31\u662f\uff0c\u6bcf\u5929\u5168\u91cf\u7684\u7ef4\u8868left join dws\u5c42\u5f53\u5929\u5206\u533a\u548cdwt\u5c42\u524d\u4e00\u65e5\u5206\u533a\u7684\u805a\u5408\u503c\uff0c\u4e5f\u5c31\u662f\u81ea\u4f9d\u8d56\u5b9e\u73b0\u3002</li> </ol> <p>ADS\u5c42\u662f\u6570\u636e\u5e94\u7528\u5c42\uff0c\u6839\u636e\u9700\u6c42\u5efa\u8868\u5e76\u7edf\u8ba1\u805a\u5408\u503c\u3002</p> <p>\u7136\u540e\u5c06ADS\u5c42\u7684\u6570\u636e\u540c\u6b65\u5230MySQL\u4e2d\uff0c\u4f7f\u7528SuperSet\u8bfb\u53d6MySQL\u4e2d\u7684\u6570\u636e\u5e76\u53ef\u89c6\u5316\u3002</p> <p>\u6700\u540e\u4f7f\u7528Azkaban\u5b9e\u73b0\u5168\u6d41\u7a0b\u8c03\u5ea6\uff0c\u4f7f\u7528 Kylin \u5b9e\u73b0\u5373\u5e2d\u67e5\u8be2\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#ods","title":"ODS\u5c42\u7684\u540c\u6b65\u7b56\u7565\uff1f","text":"<p>\u5bf9\u4e8e\u65e5\u5fd7\u6570\u636e\uff0c\u662f\u5c06\u5f53\u5929\u4ea7\u751f\u7684\u6570\u636e\u540c\u6b65\u5230ODS\u5c42\u5f53\u5929\u7684\u5206\u533a\u4e2d\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u589e\u91cf\u540c\u6b65\u7b56\u7565\u3002</p> <p>\u5bf9\u4e8e\u4e1a\u52a1\u6570\u636e\u67094\u79cd\u540c\u6b65\u65b9\u5f0f\uff1a\u5168\u91cf\u540c\u6b65\u3001\u589e\u91cf\u540c\u6b65\u3001\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65 \u548c \u7279\u6b8a\u540c\u6b65\u3002</p> <ul> <li>\u5168\u91cf\u540c\u6b65\u5c31\u662f\u6bcf\u5929\u90fd\u540c\u6b65\u4e1a\u52a1\u6570\u636e\u5e93\u4e2d\u8868\u7684\u5168\u90e8\u6570\u636e\uff0c\u8fc7\u6ee4\u6761\u4ef6\u662f<code>where 1=1</code>\uff0c\u8fd9\u79cd\u540c\u6b65\u7b56\u7565\u9002\u7528\u4e8e\u8868\u7684\u6570\u636e\u91cf\u4e0d\u5927\uff0c\u6bcf\u5929\u65e2\u4f1a\u6709\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u4e5f\u4f1a\u6709\u65e7\u6570\u636e\u7684\u4fee\u6539\u3002</li> <li>\u589e\u91cf\u540c\u6b65\u5c31\u662f\u6bcf\u5929\u90fd\u53ea\u540c\u6b65\u8868\u4e2d\u65b0\u589e\u52a0\u7684\u6570\u636e\uff0c\u8fc7\u6ee4\u6761\u4ef6\u662f<code>where create_time=\u5f53\u524d\u65e5\u671f</code>\uff0c\u8fd9\u79cd\u540c\u6b65\u7b56\u7565\u9002\u7528\u4e8e\u8868\u6570\u636e\u91cf\u5f88\u5927\uff0c\u4e14\u6bcf\u5929\u53ea\u4f1a\u6709\u65b0\u6570\u636e\u63d2\u5165\u3002</li> <li>\u65b0\u589e\u53ca\u53d8\u5316\u540c\u6b65\u5c31\u662f\u6bcf\u5929\u53ea\u540c\u6b65\u65b0\u589e\u52a0\u7684\u6570\u636e\u548c\u53d8\u5316\u7684\u6570\u636e\uff0c\u8fc7\u6ee4\u6761\u4ef6\u662f <code>where modify_time=\u5f53\u5929\u65e5\u671f</code>\uff0c\u8fd9\u79cd\u540c\u6b65\u7b56\u7565\u9002\u7528\u4e8e\u8868\u7684\u6570\u636e\u91cf\u5f88\u5927\uff0c\u5e76\u4e14\u6bcf\u5929\u65e2\u4f1a\u6709\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u4e5f\u4f1a\u65e7\u6570\u636e\u7684\u4fee\u6539\u3002</li> <li>\u7279\u6b8a\u540c\u6b65\u5c31\u662f\u53ea\u5bf9\u4e1a\u52a1\u6570\u636e\u5e93\u4e2d\u7684\u8868\u505a\u4e00\u6b21\u540c\u6b65\uff0c\u6bd4\u5982\u5730\u533a\u8868\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_4","title":"\u9879\u76ee\u4e2d\u6709\u54ea\u51e0\u79cd\u65e5\u5fd7\uff1f","text":"<p>\u6709\u4e24\u79cd\u65e5\u5fd7\uff0c\u5206\u522b\u662f \u542f\u52a8\u65e5\u5fd7 \u548c \u9875\u9762\u65e5\u5fd7\uff0c\u90fd\u662fjson\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u542f\u52a8\u65e5\u5fd7\u5728app\u542f\u52a8\u7684\u65f6\u5019\u4ea7\u751f\uff0c\u5305\u542b\u542f\u52a8\u65f6\u95f4\u6bb5\u3001\u516c\u5171\u4fe1\u606f\u3001\u542f\u52a8\u4fe1\u606f\u548c\u9519\u8bef\u4fe1\u606f\u3002\u516c\u5171\u4fe1\u606f\u5c31\u662f\u6709\u5173\u624b\u673a\u578b\u53f7\u7b49\u4fe1\u606f\uff0c\u542f\u52a8\u4fe1\u606f\u5305\u542b\u542f\u52a8\u65f6\u95f4\uff0c\u5e7f\u544aid\u7b49\u3002\u542f\u52a8\u65e5\u5fd7\u5728app\u542f\u52a8\u4e4b\u540e\u4e0a\u62a5\u3002</p> <p>\u9875\u9762\u65e5\u5fd7\u5728\u6d4f\u89c8\u9875\u9762\u7684\u65f6\u5019\u4ea7\u751f\uff0c\u5728\u79bb\u5f00\u9875\u9762\u7684\u65f6\u5019\u4e0a\u62a5\u3002\u6bcf\u4e00\u6761\u9875\u9762\u65e5\u5fd7\u90fd\u5305\u62ec\u516c\u5171\u4fe1\u606f\u3001\u9875\u9762\u4fe1\u606f \u548c \u8df3\u5165\u9875\u9762\u7684\u65f6\u95f4\uff0c\u53e6\u5916\u6839\u636e\u9875\u9762\u7684\u4e0d\u540c\u548c\u7528\u6237\u5728\u4e00\u4e2a\u9875\u9762\u6240\u505a\u7684\u52a8\u4f5c\uff0c\u8fd8\u4f1a\u4ea7\u751f\u4e0d\u540c\u7684\u65e5\u5fd7\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u90fd\u662fjson\u4e32\u91cc\u7684\u4e00\u4e2a\u5b57\u6bb5\u7684\u503c\uff0c\u6700\u540e\u5728\u7528\u6237\u79bb\u5f00\u9875\u9762\u7684\u65f6\u5019\uff0c\u7528\u6237\u5728\u8fd9\u4e2a\u9875\u9762\u6240\u4ea7\u751f\u6240\u6709\u65e5\u5fd7\u4fe1\u606f\u90fd\u662f\u4f5c\u4e3a\u4e00\u4e2ajson\u4e32\u53d1\u9001\u5230\u65e5\u5fd7\u670d\u52a1\u5668\u4e0a\u7684\u3002</p> <p>\u6bd4\u5982\u7528\u6237\u5728\u6d4f\u89c8\u4e00\u4e2a\u9875\u9762\u65f6\uff0c\u4f1a\u4ea7\u751f\u4e0d\u540c\u7684\u4e8b\u4ef6\uff0c\u6bd4\u5982\u6dfb\u52a0\u6536\u85cf\u3001\u53d6\u6d88\u6536\u85cf\u7b49\uff0c\u8fd9\u4e9b\u52a8\u4f5c\u65e5\u5fd7\u90fd\u662f\u4f5c\u4e3ajson\u4e32\u91cc\u7684actions\u5b57\u6bb5\u7684\u503c\uff0cactions\u5b57\u6bb5\u662f\u4e00\u4e2a\u6570\u7ec4\uff1b\u518d\u6bd4\u5982\u7528\u6237\u5982\u679c\u662f\u5728\u6d4f\u89c8\u5546\u54c1\uff0c\u90a3\u4e48\u5546\u54c1\u9875\u8fd8\u4f1a\u4ea7\u751f\u66dd\u5149\u65e5\u5fd7\uff0c\u6bcf\u4e00\u4e2a\u88ab\u66dd\u5149\u7684\u5546\u54c1\u4f1a\u4f5c\u4e3adisplays\u6570\u7ec4\u7684\u4e00\u9879\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_5","title":"\u65e5\u5fd7\u6570\u636e\u662f\u5982\u4f55\u88ab\u5904\u7406\u7684\uff1f","text":"<p>ODS\u5c42\u76f4\u63a5\u5b58\u50a8\u65e5\u5fd7\u7684\u539f\u59cb\u5f62\u5f0f\uff0c\u4e5f\u5c31\u662fODS\u5c42\u65e5\u5fd7\u8868\u91cc\u9762\u53ea\u6709\u4e00\u4e2a\u5217\uff0c\u8fd9\u4e2a\u5217\u7684\u7c7b\u578b\u662fString\u3002</p> <p>DWD\u5c42\u5982\u4f55\u5904\u7406\u65e5\u5fd7\u6570\u636e\uff1f</p> <p>\u5bf9\u542f\u52a8\u65e5\u5fd7\u5efa\u7acb\u542f\u52a8\u65e5\u5fd7\u8868\uff0c\u542f\u52a8\u65e5\u5fd7\u89e3\u6790\u601d\u8def\uff1a\u5148\u5c06\u6240\u6709\u5305\u542bstart\u5b57\u6bb5\u7684\u65e5\u5fd7\u8fc7\u6ee4\u51fa\u6765 <code>get_json_object(line,'$.start') is not null</code>\uff0c\u7136\u540e\u4f7f\u7528get_json_object\u51fd\u6570\u89e3\u6790\u6bcf\u4e2a\u5b57\u6bb5\u3002</p> <p>\u5bf9\u9875\u9762\u65e5\u5fd7\u5efa\u7acb\u4e0d\u540c\u7684\u4e8b\u5b9e\u8868\uff1a\u9875\u9762\u65e5\u5fd7\u8868\u3001\u52a8\u4f5c\u65e5\u5fd7\u8868\u3001\u66dd\u5149\u65e5\u5fd7\u8868\u3001\u9519\u8bef\u65e5\u5fd7\u8868\u3002\u6bcf\u79cd\u65e5\u5fd7\u8868\u89e3\u6790\u65e5\u5fd7\u7684\u601d\u8def\u90fd\u662f\uff0c\u5c06\u5305\u542b\u8be5\u5b57\u6bb5\u7684\u65e5\u5fd7\u8fc7\u6ee4\u51fa\u6765\uff0c\u7136\u540e\u4f7f\u7528get_json_object\u51fd\u6570\u89e3\u6790\u6bcf\u4e2a\u5b57\u6bb5\uff0c\u5f53\u7136\u5982\u679c\u6709\u7684\u5b57\u6bb5\u662f\u6570\u7ec4\uff0c\u8fd8\u8981\u5148\u5c06\u8be5\u5b57\u6bb5explode\u3002</p> <p>DWS\u548cDWT\u5c42\u6309\u7ef4\u5ea6\u805a\u5408DWD\u5c42\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\uff0c\u5982\u679c\u6709\u9700\u8981\u4f1a\u4eceDWD\u5c42\u65e5\u5fd7\u8868\u4e2d\u53d6\u6570\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_6","title":"\u6570\u4ed3\u4e3a\u4ec0\u4e48\u8981\u5206\u5c42\uff1f","text":"<ol> <li> <p>\u590d\u6742\u95ee\u9898\u7b80\u5355\u5316\uff1a \u5206\u5c42\u53ef\u4ee5\u4f7f\u590d\u6742\u95ee\u9898\u7b80\u5355\u5316\uff0c\u7ed3\u6784\u66f4\u52a0\u6e05\u6670\uff0c\u6bcf\u4e00\u5c42\u90fd\u6709\u5404\u81ea\u7684\u804c\u8d23\u3002</p> </li> <li> <p>\u51cf\u5c11\u91cd\u590d\u5f00\u53d1\uff1a \u901a\u8fc7\u5bf9\u4e2d\u95f4\u5c42\u6570\u636e\u7684\u590d\u7528\uff0c\u53ef\u4ee5\u6781\u5927\u51cf\u5c11\u91cd\u590d\u5f00\u53d1\uff0c\u6bd4\u5982DIM\u5c42\u548cDWD\u5c42\u5c06\u4e1a\u52a1\u6570\u636e\u5e93\u7684\u5173\u7cfb\u6a21\u578b\u8f6c\u6362\u6210\u67e5\u8be2\u66f4\u4e3a\u9ad8\u6548\u7684\u7ef4\u5ea6\u6a21\u578b\uff0cDWS\u5c42\u548cDWT\u5c42\u5bf9\u6570\u636e\u6c47\u603b\uff0c\u90fd\u662f\u4e3a\u4e86\u65b9\u4fbf\u540e\u7eed\u590d\u7528\u3002</p> </li> <li> <p>\u9694\u79bb\u6570\u636e\uff1a \u6bcf\u4e00\u5c42\u90fd\u662f\u5c06\u4e0a\u4e00\u5c42\u6570\u636e\u505a\u4e86\u4e00\u6b21\u8ba1\u7b97\u548c\u8f6c\u6362\u540e\u7684\u518d\u6b21\u5b58\u50a8\uff0c\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u6570\u636e\u7684\u9694\u79bb\uff0c\u9694\u79bb\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u66f4\u52a0\u7ec6\u7c92\u5ea6\u63a7\u5236\u6570\u636e\u3002</p> </li> <li> <p>\u65b9\u4fbf\u6570\u636e\u8840\u7f18\u8ffd\u8e2a\uff1a \u6570\u636e\u7684\u8840\u7f18\u5173\u7cfb\u6307\u7684\u662f\u6bcf\u5f20\u8868\u6570\u636e\u7684\u6765\u6e90\u4ee5\u53ca\u53bb\u5411\uff0c\u6570\u4ed3\u5206\u5c42\u4f7f\u5f97\u6570\u636e\u7684\u8840\u7f18\u5173\u7cfb\u66f4\u52a0\u6e05\u6670\uff0c\u5982\u679c\u6709\u4e00\u5f20\u8868\u7684\u6570\u636e\u6e90\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_7","title":"\u6570\u4ed3\u6709\u54ea\u4e9b\u5c42\uff1f\u6bcf\u4e00\u5c42\u7684\u4f5c\u7528\uff1f","text":"<p>\u6570\u4ed3\u6700\u57fa\u672c\u7684\u5206\u5c42\u601d\u60f3\u662f\u5206\u4e3a3\u5c42\uff1aODS\u5c42\uff08\u539f\u59cb\u6570\u636e\u5c42\uff09\u3001DW\u5c42\uff08\u6570\u636e\u4ed3\u5e93\u5c42\uff09\u3001ADS\u5c42\uff08\u6570\u636e\u5e94\u7528\u5c42\uff09\u3002\u963f\u91cc\u628a\u7b2c\u4e8c\u5c42DW\u5c42\u6362\u4e86\u79f0\u547c\uff0c\u53ebCDM\u5c42\uff08common data model\uff0c\u516c\u5171\u6570\u636e\u5c42\uff09\u3002</p> <p>\u672c\u9879\u76ee\u5c06\u7b2c\u4e8c\u5c42\u53c8\u7ec6\u5206\u6210\u4e86\uff1aDIM \u5c42\u3001DWD \u5c42\u3001DWS \u5c42\u3001DWT \u5c42\uff0c\u4e5f\u5373\u79bb\u7ebf\u6570\u636e\u4ed3\u5e93\u5305\u542b ODS \u5c42\u3001DIM \u5c42\u3001DWD \u5c42\u3001DWS \u5c42\u3001DWT \u5c42\u3001ADS \u5c42\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#ods_1","title":"ODS\u5c42","text":"<p>ODS\u5c42\uff08Operation Data Store\uff0c\u539f\u59cb\u6570\u636e\u5c42\uff09\uff0c\u6570\u636e\u6e90\u7684\u6570\u636e\u7ecfETL\u4e4b\u540e\u8fdb\u5165ODS\u5c42\uff0cODS\u5c42\u4fdd\u6301\u6570\u636e\u539f\u8c8c\uff0c\u4e0d\u4f1a\u5bf9\u6765\u81ea\u4e1a\u52a1\u7cfb\u7edf\u7684\u6570\u636e\u505a\u4fee\u6539\uff0c\u5176\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u8d77\u5230\u5907\u4efd\u6570\u636e\u7684\u76ee\u7684\uff0c\u5f53\u7136\uff0c\u6570\u4ed3\u63a5\u4e0b\u6765\u7684DIM\u5c42\u548cDWD\u5c42\u7684\u6570\u636e\u6765\u6e90\u4e5f\u662fODS\u5c42\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#dim_dwd","title":"DIM\u5c42 \u548c DWD\u5c42","text":"<p>DIM\u5c42\uff08Dimension\uff0c\u7ef4\u8868\u5c42\uff09\u548c DWD\u5c42\uff08Data Warehouse Detail\uff0c\u6570\u636e\u660e\u7ec6\u5c42\uff09\u8fd9\u4e24\u5c42\u9700\u8981\u7528\u5230\u7ef4\u5ea6\u5efa\u6a21\u7684\u7406\u8bba\u77e5\u8bc6\u6307\u5bfc\u5efa\u8868\uff0c\u4e00\u822c\u91c7\u7528\u661f\u578b\u6a21\u578b\uff0c\u5448\u73b0\u7684\u72b6\u6001\u662f\u661f\u5ea7\u6a21\u578b\uff0c\u5176\u4e2d\uff0cDIM\u5c42\u5b58\u653e\u7684\u662f\u7ef4\u5ea6\u8868\uff0cDWD\u5c42\u5b58\u653e\u7684\u662f\u4e8b\u5b9e\u8868\u3002</p> <p>\u63a5\u4e0b\u6765\u76843\u5c42\uff0cDWS\u5c42\u3001DWT\u5c42\u548cADS\u5c42\u90fd\u662f\u4ee5\u9700\u6c42\u4e3a\u9a71\u52a8\uff0c\u548c\u7ef4\u5ea6\u5efa\u6a21\u5df2\u7ecf\u6ca1\u6709\u5173\u7cfb\u4e86\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#dws_dwt","title":"DWS\u5c42 \u548c DWT\u5c42","text":"<p>DWS\u5c42\uff08data warehouse detail\uff09\u548c DWT\u5c42\uff08wata warehouse topic\uff09\u6309\u7167\u4e3b\u9898\u53bb\u5efa\u8868\uff0c\u4e3b\u9898\u76f8\u5f53\u4e8e\u89c2\u5bdf\u95ee\u9898\u7684\u89d2\u5ea6\uff0c\u5bf9\u5e94\u7740\u7ef4\u5ea6\u8868\uff0c\u901a\u5e38\u662f\u4e00\u4e2a\u7ef4\u5ea6\u8868\u5c31\u662f\u4e00\u4e2a\u89d2\u5ea6\uff0c\u6bd4\u5982DIM\u5c42\u6709\u7528\u6237\u7ef4\u5ea6\u8868\u3001\u5546\u54c1\u7ef4\u5ea6\u8868\u3001\u5730\u533a\u7ef4\u5ea6\u8868\uff0c\u90a3\u4e48\u76f8\u5e94\u7684DWS\u5c42\u548cDWT\u5c42\u4e5f\u5c31\u6709\u7528\u6237\u4e3b\u9898\u8868\u3001\u5546\u54c1\u4e3b\u9898\u8868\u3001\u5730\u533a\u4e3b\u9898\u8868\uff0c\u8868\u4e2d\u5b58\u7684\u6570\u636e\u662f\u5bf9\u4e8b\u5b9e\u8868\u6309\u7ef4\u5ea6\u5916\u952e\u805a\u5408\u7684\u7ed3\u679c\u3002</p> <p>DWS\u5c42 \u548c DWT\u5c42 \u7684\u6570\u636e\u662f\u5982\u4f55\u8ba1\u7b97\u5f97\u5230\u7684\uff1f</p> <p>DWS\u5c42\u8868\u4e2d\u5b58\u7684\u6570\u636e\u662f\u5c06DWD\u5c42\u591a\u5f20\u4e8b\u5b9e\u8868\u7684\u5ea6\u91cf\u503c\u6309\u540c\u4e00\u4e2a\u7ef4\u5ea6\u805a\u5408\u7684\u805a\u5408\u503c\u3002\u6bd4\u5982DWD\u5c42\u8ba2\u5355\u3001\u652f\u4ed8\u3001\u9000\u6b3e\u3001\u8bc4\u4ef7\u7b49\u4e8b\u5b9e\u8868\u4e2d\u90fd\u6709\u7528\u6237\u7ef4\u5ea6\uff0c\u90a3\u4e48DWS\u5c42\u7528\u6237\u4e3b\u9898\u8868\u4e2d\u5b58\u7684\u5c31\u662f\u5c06\u8fd9\u51e0\u5f20\u8868\u6309\u7528\u6237\u7ef4\u5ea6\u805a\u5408\u7684\u805a\u5408\u503c\uff0c\u4e5f\u5c31\u662fgroup by\u7528\u6237id\uff0c\u7136\u540e\u628a\u805a\u5408\u7684\u7ed3\u679c\u5199\u5230\u7528\u6237\u4e3b\u9898\u8868\u4e2d\u3002</p> <p>DWS\u5c42\u4e0eDWT\u5c42\u7684\u533a\u522b\u662f\uff0cDWS\u5c42\u5bf9DWD\u5c42\u6570\u636e\u6309\u5929\u6c47\u603b\uff0c\u800cDWT\u5c42\u662f\u5bf9DWD\u5c42\u7684\u6570\u636e\u8fdb\u884c\u7d2f\u79ef\u6c47\u603b\uff0c\u6bd4\u5982\u8fd1\u4e00\u4e2a\u661f\u671f\u5f97\u7d2f\u79ef\u503c\uff0c\u8fd130\u5929\u7684\u7d2f\u79ef\u503c\uff0c\u4ece\u5f00\u59cb\u81f3\u4eca\u7684\u7d2f\u79ef\u503c\u3002</p> <p>DWT\u5c42\u53ea\u4f1a\u4fdd\u7559\u4e24\u4e2a\u5206\u533a\u7684\u6570\u636e\uff0c\u4e00\u662f\u56e0\u4e3aDWT\u5c42\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\uff0c\u4e8c\u662f\u56e0\u4e3aDWT\u5c42\u7684\u6570\u636e\u4fdd\u5b58\u7684\u7d2f\u79ef\u6c47\u603b\u503c\uff0c\u6ca1\u6709\u5fc5\u6709\u4fdd\u7559\u5f88\u591a\u5206\u533a\u3002DWT\u5c42\u8868\u7684\u6570\u636e\u6765\u6e90\u662fDWT\u5c42\u524d\u4e00\u65e5\u5206\u533a\u4e2d\u7684\u6570\u636e\u548cDWS\u5c42\u5f53\u65e5\u5206\u533a\u4e2d\u7684\u6570\u636e\uff0c\u7136\u540e\u505a\u4e00\u4e2a\u52a0\u51cf\u64cd\u4f5c\uff0c\u6bd4\u5982\u8981\u8ba1\u7b97DWT\u5c42\u8fd130\u5929\u6570\u636e\u7684\u7d2f\u79ef\u805a\u5408\u503c\uff0c\u90a3\u4e48\u8ba1\u7b97\u7684\u65b9\u5f0f\u5c31\u662f DWT\u524d\u4e00\u65e5\u5206\u533a\u7684\u6570\u636e + DWS\u5c42\u6700\u65b0\u4e00\u5929\u7684\u6570\u636e - DWS\u5c4230\u5929\u7684\u6570\u636e\u3002</p> <p></p> <p>\u4f60\u8bf4\u901a\u5e38\u662fDIM\u5c42\u7684\u4e00\u4e2a\u7ef4\u5ea6\u8868\u5c31\u5bf9\u5e94\u4e8eDWS\u5c42\u548cDWT\u5c42\u4e00\u5f20\u4e3b\u9898\u8868\uff0c\u4e5f\u5c31\u662f\u8bf4\u6709\u4f8b\u5916\u60c5\u51b5\uff1f</p> <p>\u662f\u7684\uff0c\u56e0\u4e3a\u4e8b\u5b9e\u8868\u4e2d\u6709\u7ef4\u5ea6\u9000\u5316\u7684\u7ef4\u5ea6\u5b57\u6bb5\uff0c\u5728DWS\u5c42\u548cDWT\u5c42\u4e5f\u4f1a\u5bf9\u8fd9\u6837\u7684\u7ef4\u5ea6\u5efa\u7acb\u5bf9\u5e94\u7684\u4e3b\u9898\u8868\uff0c\u6bd4\u5982\uff0cDWS\u5c42\u6709\u8bbf\u5ba2\u4e3b\u9898\uff0c\u4f46\u662fDIM\u6ca1\u6709\u8bbf\u5ba2\u7ef4\u5ea6\u8868\uff0c\u56e0\u4e3a\u8bbf\u5ba2\u7ef4\u5ea6\u5728DWD\u5c42\u9875\u9762\u65e5\u5fd7\u8868\u4e2d\uff0c\u8fd9\u5f20\u8868\u7684\u6570\u636e\u6765\u81ea\u4e8eODS\u5c42\u7684\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\uff0c\u56e0\u4e3a\u8bbf\u5ba2\u4fe1\u606f\u7684\u7ef4\u5ea6\u5f88\u5c11\uff0c\u6240\u4ee5\u6ca1\u5fc5\u8981\u4e3a\u5176\u5355\u72ec\u5efa\u7acb\u4e00\u5f20\u7ef4\u5ea6\u8868\uff0c\u800c\u662f\u5c06\u7ef4\u5ea6\u5b57\u6bb5\u5b57\u8282\u9000\u5316\u5230\u4e8b\u5b9e\u8868\u4e2d\uff0c\u8fd9\u6837\u67e5\u8be2\u6548\u7387\u66f4\u9ad8\uff0c\u56e0\u4e3a\u51cf\u5c11\u4e86join\u7684\u6b21\u6570\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#ads","title":"ADS\u5c42","text":"<p>\u6700\u540e\u4e00\u5c42\u662fADS\u5c42\uff08application data store\uff09\uff0c\u8be5\u5c42\u662f\u76f4\u63a5\u4e3a\u7edf\u8ba1\u62a5\u8868\u63d0\u4f9b\u6570\u636e\uff0c\u6240\u4ee5\u901a\u5e38\u662f\u9700\u8981\u5c55\u793a\u4ec0\u4e48\u6307\u6807\u5c31\u76f4\u63a5\u5728\u8fd9\u4e00\u5c42\u8ba1\u7b97\u4ec0\u4e48\u6307\u6807\uff0c\u6bd4\u5982\u8def\u5f84\u5206\u6790\u3001\u7528\u6237\u7edf\u8ba1\u3001\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790\u3001\u7528\u6237\u7559\u5b58\u7387\u7b49\u3002</p> <p>\u7528\u6237\u7edf\u8ba1\uff1aADS\u5c42\u7684\u7528\u6237\u7edf\u8ba1\u4e0eDWS\u5c42\u548cDWT\u5c42\u7684\u7528\u6237\u4e3b\u9898\u8868\u5b58\u7684\u6570\u636e\u4e0d\u540c\uff0cDWT\u5b58\u7684\u662f\u67d0\u4e2a\u7528\u6237\u8fd1\u67651\u30017\u300130\u65e5\u4ee5\u53ca\u4ece\u5f00\u59cb\u81f3\u4eca\u7684\u5404\u9879\u6570\u636e\u7684\u7d2f\u79ef\u503c\uff0c\u6bd4\u5982\u4e0b\u5355\u6b21\u6570\u3001\u9000\u6b3e\u6b21\u6570\u7b49\uff1b\u4f46\u662fADS\u5c42\u5b58\u7684\u662f\u8fd11\u30017\u300130\u65e5\u4e0b\u5355\u7528\u6237\u603b\u6570\u3001\u9000\u6b3e\u7528\u6237\u603b\u6570\u7b49\u4fe1\u606f\uff1b\u4e5f\u5c31\u662fDWT\u5c42\u662f\u9488\u5bf9\u6bcf\u4e00\u4e2a\u7528\u6237\u90fd\u6709\u4e00\u6761\u6570\u636e\uff0c\u4f46\u662fADS\u5c42\u662f\u6240\u6709\u7528\u6237\u7684\u7edf\u8ba1\u503c\u3002</p> <p>\u8def\u5f84\u5206\u6790\uff1a\u5c31\u662f\u7528\u6237\u5728\u7f51\u7ad9\u4e2d\u7684\u8bbf\u95ee\u8def\u5f84\u7684\u53d8\u5316\uff0c\u6bd4\u5982\u4ece\u5546\u54c1\u8be6\u60c5\u9875\u76f4\u63a5\u8df3\u5230\u4ed8\u6b3e\u9875\u9762\u6709\u591a\u5c11\u6b21\uff0c\u6216\u8005\u662f\u4ece\u5546\u54c1\u8be6\u60c5\u9875\u8fd4\u56de\u9996\u9875\u6709\u591a\u5c11\u6b21\uff0c\u901a\u5e38\u662f\u7528\u6851\u57fa\u56fe\u5c55\u793a\uff0c\u6851\u57fa\u56fe\u9700\u8981\u63d0\u4f9b3\u4e2a\u503c\uff0c&lt;source, target, value\uff1e\uff0c\u6851\u57fa\u56fe\u4e2dtarget\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u4f46\u662f\u4e0d\u80fd\u5b58\u5728\u73af\u3002</p> <p>\u7528\u6237\u884c\u4e3a\u6f0f\u6597\u5206\u6790\uff1a\u6f0f\u6597\u5206\u6790\u53cd\u6620\u4e86\u4e00\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u4ece\u8d77\u70b9\u5230\u7ec8\u70b9\u5404\u9636\u6bb5\u7528\u6237\u8f6c\u5316\u60c5\u51b5\uff0c\u6bd4\u5982\u4e00\u4e2a\u5b8c\u6574\u7684\u8d2d\u7269\u6d41\u7a0b\u662f\uff1a\u6d4f\u89c8\u9996\u9875\uff0c\u63a5\u7740\u6d4f\u89c8\u5546\u54c1\u8be6\u60c5\u9875\uff0c\u7136\u540e\u52a0\u8d2d\u7269\u8f66\u3001\u7136\u540e\u4e0b\u5355\uff0c\u6700\u540e\u4ed8\u6b3e\uff0c\u6f0f\u6597\u5206\u6790\u5c31\u662f\u7edf\u8ba1\u8fd9\u4e2a\u5b8c\u6574\u8d2d\u7269\u6d41\u7a0b\u5404\u4e2a\u9636\u6bb5\u7684\u4eba\u6570\u3002</p> <p>\u7528\u6237\u7559\u5b58\u7387\uff1a\u7559\u5b58\u5206\u6790\u4e00\u822c\u5305\u542b\u65b0\u589e\u7559\u5b58\u548c\u6d3b\u8dc3\u7559\u5b58\u5206\u6790\u3002\u65b0\u589e\u7559\u5b58\u5206\u6790\u662f\u5206\u6790\u67d0\u5929\u7684\u65b0\u589e\u7528\u6237\u4e2d\uff0c\u6709\u591a\u5c11\u4eba\u6709\u540e\u7eed\u7684\u6d3b\u8dc3\u884c\u4e3a\u3002\u6d3b\u8dc3\u7559\u5b58\u5206\u6790\u662f\u5206\u6790\u67d0\u5929\u7684\u6d3b\u8dc3\u7528\u6237\u4e2d\uff0c\u6709\u591a\u5c11\u4eba\u6709\u540e\u7eed\u7684\u6d3b\u8dc3\u884c\u4e3a\u3002</p> <p>\u65b0\u589e\u7559\u5b58\u7387\u5177\u4f53\u662f\u6307\u7559\u5b58\u7528\u6237\u6570\u4e0e\u65b0\u589e\u7528\u6237\u6570\u7684\u6bd4\u503c\uff0c\u4f8b\u59822020-06-14\u65b0\u589e100\u4e2a\u7528\u6237\uff0c1\u65e5\u4e4b\u540e\uff082020-06-15\uff09\u8fd9100\u4eba\u4e2d\u670980\u4e2a\u4eba\u6d3b\u8dc3\u4e86\uff0c\u90a32020-06-14\u76841\u65e5\u7559\u5b58\u6570\u5219\u4e3a80\uff0c2020-06-14\u76841\u65e5\u7559\u5b58\u7387\u5219\u4e3a80%\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_8","title":"\u5173\u7cfb\u5efa\u6a21\u4e0e\u7ef4\u5ea6\u5efa\u6a21\u7684\u533a\u522b\uff1f","text":"<p>\u4ece\u6570\u4ed3\u6570\u636e\u88c5\u8f7d\u7684\u903b\u8f91\u4e0a\u770b\uff0c\u597d\u50cf\u7ef4\u5ea6\u6a21\u578b\u662f\u5c06\u5173\u7cfb\u6a21\u578b\u539f\u6765\u62c6\u5206\u7684\u8868\u53c8\u5408\u5e76\u56de\u6765\u4e86\uff0c\u6bd4\u5982\uff0cDIM\u5c42\u5546\u54c1\u7ef4\u5ea6\u8868\u7684\u6570\u636e\u6765\u81ea\u4e8eODS\u5c42\u7684 \u5546\u54c1\u8868\u3001\u4e00\u7ea7\u54c1\u7c7b\u8868\uff08\u6570\u7801\u3001\u670d\u88c5\uff09\u3001\u4e8c\u7ea7\u54c1\u7c7b\u8868\uff08\u7535\u8111\u3001\u624b\u673a\uff09\u3001\u4e09\u7ea7\u54c1\u7c7b\u8868\uff08\u53f0\u5f0f\u7535\u8111\u3001\u7b14\u8bb0\u672c\u672c\u7535\u8111\uff09\uff0c\u5728\u5173\u7cfb\u5efa\u6a21\u4e2d\u662f\u5c06\u8fd9\u4e9b\u8868\u5206\u5f00\u7684\uff0c\u5546\u54c1\u8868\u901a\u8fc7\u4e00\u7ea7\u5206\u7c7bid\u4e0e\u4e00\u7ea7\u5206\u7c7b\u8868\u5173\u8054\uff0c\u7136\u540e\u4e00\u7ea7\u5206\u7c7b\u8868\u4e0e\u4e8c\u7ea7\u5206\u7c7b\u8868\u5173\u8054\uff0c\u4e8c\u7ea7\u5206\u7c7b\u8868\u4e0e\u4e09\u7ea7\u5206\u7c7b\u8868\u5173\u8054\uff0c\u8981\u67e5\u5546\u54c1\u7684\u4e8c\u7ea7\u5206\u7c7b\u4fe1\u606f\u5c31\u9700\u8981\u4e24\u6b21join\u3002\u4f46\u5728\u7ef4\u5ea6\u5efa\u6a21\u4e2d\u5219\u662f\u5c06\u8fd9\u4e9b\u8868\u5168\u90e8\u5173\u8054\u4e4b\u540e\u5199\u5230\u5546\u54c1\u7ef4\u5ea6\u8868\u4e2d\uff0c\u5546\u54c1\u7ef4\u5ea6\u8868\u4e2d\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u4e00\u4ef6\u5546\u54c1\uff0c\u5546\u54c1\u7684\u6240\u6709\u4fe1\u606f\u90fd\u5b58\u5728\u8fd9\u4e00\u5f20\u8868\u4e2d\u3002</p> <p>\u4f46\u662f\u8fd9\u592a\u7247\u9762\u4e86\uff0c\u8fd9\u79cd\u7b80\u5355\u7684\u7406\u89e3\u5e76\u4e0d\u6b63\u786e\uff0c\u56e0\u4e3a\u5173\u7cfb\u5efa\u6a21\u4e0e\u7ef4\u5ea6\u5efa\u6a21\u9762\u5411\u7684\u95ee\u9898\u4e0d\u540c\uff0c\u6240\u4ee5\u5b83\u4eec\u5efa\u6a21\u7684\u601d\u60f3\u4e0e\u6d41\u7a0b\u4e0d\u540c\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff1a</p> <p>\u5173\u7cfb\u5efa\u6a21\u4e0e\u7ef4\u5ea6\u5efa\u6a21\u9762\u5411\u7684\u95ee\u9898\u4e0d\u540c\uff0c\u6240\u4ee5\u5b83\u4eec\u5efa\u6a21\u7684\u601d\u60f3\u4e0e\u6d41\u7a0b\u4e0d\u540c\u3002</p> <p>\u5173\u7cfb\u5efa\u6a21\u9762\u5411\u7684\u662f\u4e8b\u52a1\u5904\u7406\uff0c\u9075\u5faa\u4e09\u8303\u5f0f\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u964d\u4f4e\u6570\u636e\u5197\u4f59\uff0c\u4ece\u800c\u6d88\u9664\u63d2\u5165\u3001\u5220\u9664\u3001\u4fee\u6539\u5f02\u5e38\u3002</p> <p>\u7ef4\u5ea6\u5efa\u6a21\u4e0d\u8003\u8651\u6570\u636e\u6709\u6ca1\u6709\u5197\u4f59\u8fd9\u79cd\u95ee\u9898\uff0c\u56e0\u4e3a\u7ef4\u5ea6\u5efa\u6a21\u4e0d\u662f\u9762\u5411\u4e8b\u52a1\u5904\u7406\uff0c\u800c\u662f\u9762\u5411\u7684\u662f\u6570\u636e\u5206\u6790\uff0c\u9700\u8981\u7684\u662f\u5feb\u901f\u67e5\u8be2\uff0c\u5176\u5efa\u6a21\u8fc7\u7a0b\u4ece\u4e1a\u52a1\u8fc7\u7a0b\u51fa\u53d1\uff0c\u5c06\u4e1a\u52a1\u7528\u4e8b\u5b9e\u8868\u548c\u7ef4\u5ea6\u8868\u5448\u73b0\u51fa\u6765\uff0c\u7ef4\u5ea6\u5efa\u6a21\u5f97\u5230\u7684\u8868\u4e4b\u95f4\u7684\u5173\u8054\u7ed3\u6784\u7b80\u5355\uff0c\u6545\u67e5\u8be2\u7b80\u5355\uff0c\u67e5\u8be2\u6548\u7387\u8f83\u9ad8\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_9","title":"\u7ef4\u5ea6\u5efa\u6a21\u7684\u6d41\u7a0b\uff1f","text":"<p>\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b\u2192\u58f0\u660e\u7c92\u5ea6\u2192\u786e\u8ba4\u7ef4\u5ea6\u2192\u786e\u8ba4\u4e8b\u5b9e</p> <p>\uff081\uff09\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b</p> <p>\u6bd4\u5982\u4e0b\u5355\u4e1a\u52a1\uff0c\u652f\u4ed8\u4e1a\u52a1\uff0c\u9000\u6b3e\u4e1a\u52a1\uff0c\u7269\u6d41\u4e1a\u52a1\uff0c\u4e00\u6761\u4e1a\u52a1\u7ebf\u5bf9\u5e94\u4e00\u5f20\u4e8b\u5b9e\u8868\uff0c\u6b64\u6b65\u662f\u5728\u786e\u5b9a\u4e8b\u5b9e\u8868\u3002</p> <p>\uff082\uff09\u58f0\u660e\u7c92\u5ea6</p> <p>\u6570\u636e\u7c92\u5ea6\u6307\u6570\u636e\u4ed3\u5e93\u4e2d\u4fdd\u5b58\u6570\u636e\u7684\u7ec6\u5316\u7a0b\u5ea6\u6216\u7efc\u5408\u7a0b\u5ea6\u7684\u7ea7\u522b\uff0c\u6bd4\u5982DWD\u5c42\u7684\u6570\u636e\u6bd4DWS\u5c42\u7684\u6570\u636e\u7c92\u5ea6\u66f4\u52a0\u7ec6\uff0c\u6216\u8005\u8bf4DWS\u5c42\u6570\u636e\u6bd4DWD\u5c42\u6570\u636e\u7684\u7efc\u5408\u7a0b\u5ea6\u66f4\u52a0\u9ad8\u3002</p> <p>\u58f0\u660e\u7c92\u5ea6\u6307\u7684\u662f\u786e\u5b9a\u4e8b\u5b9e\u8868\u4e2d\u7684\u4e00\u884c\u6570\u636e\u8868\u793a\u4ec0\u4e48\uff0c\u5e94\u8be5\u5c3d\u53ef\u80fd\u9009\u62e9\u6700\u5c0f\u7c92\u5ea6\uff0c\u4e5f\u5c31\u662f\u5e94\u8be5\u4fdd\u5b58\u6700\u660e\u7ec6\u7684\u6570\u636e\uff0c\u4ee5\u6b64\u6765\u5e94\u5404\u79cd\u5404\u6837\u7684\u9700\u6c42\u3002</p> <p>\u5f53\u7136\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u53ef\u4ee5\u6709\u51fa\u5165\uff0c\u6bd4\u5982\u4e0e\u4e0b\u5355\u4e1a\u52a1\u76f8\u5173\u7684\u4e8b\u5b9e\u8868\u6709\u4e24\u5f20\uff0c\u5206\u522b\u662f\u8ba2\u5355\u4e8b\u5b9e\u8868\u548c\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\uff0c\u663e\u7136\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7c92\u5ea6\u66f4\u7ec6\u7684\u8868\uff0c\u8ba2\u5355\u4e8b\u5b9e\u8868\u4e2d\u8bb0\u5f55\u7684\u4e00\u4e2a\u8ba2\u5355\u7684\u603b\u91d1\u989d\u7b49\u6570\u636e\u53ef\u4ee5\u4ece\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u603b\u7684\u6570\u636e\u7b97\u51fa\u6765\uff0c\u4ece\u8fd9\u70b9\u4e0a\u770b\u8ba2\u5355\u4e8b\u5b9e\u8868\u662f\u6bd4\u8f83\u591a\u4f59\u7684\u4e00\u5f20\u4e8b\u5b9e\u8868\uff0c\u4f46\u662f\u5b9e\u9645\u60c5\u51b5\u662f\uff0c\u5bf9\u4e0b\u5355\u4e1a\u52a1\u7684\u7edf\u8ba1\u5176\u5b9e\u66f4\u52a0\u6ce8\u91cd\u4e8e\u5bf9\u4e00\u7b14\u8ba2\u5355\u8fdb\u884c\u7edf\u8ba1\uff0c\u800c\u4e0d\u662f\u5bf9\u4e00\u7b14\u8ba2\u5355\u4e2d\u7684\u4e00\u4e2a\u5546\u54c1\u9879\u8fdb\u884c\u7edf\u8ba1\uff0c\u6240\u4ee5\u6dfb\u52a0\u8ba2\u5355\u4e8b\u5b9e\u8868\u662f\u5f88\u6709\u5fc5\u8981\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u6bcf\u6b21\u90fd\u9700\u8981\u5bf9\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u8fdb\u884c\u6c47\u603b\uff0c\u5f53\u7136\uff0c\u5c06\u4e0b\u5355\u4e1a\u52a1\u5b9a\u4e49\u4e3a\u6210\u8fd9\u4e24\u5f20\u8868\u8fd8\u6709\u5176\u5b83\u597d\u5904\uff0c\u6bd4\u5982\u8ba2\u5355\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7279\u70b9\u5c31\u662f\u6570\u636e\u6709\u72b6\u6001\uff0c\u800c\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u4f1a\u8bb0\u5f55\u6240\u6709\u589e\u91cf\u6570\u636e\u3002</p> <p>\uff083\uff09\u786e\u5b9a\u7ef4\u5ea6</p> <p>\u6b64\u6b65\u9aa4\u786e\u5b9a\u7684\u662f\u4e0e\u4e8b\u5b9e\u8868\u76f8\u5173\u7684\u7ef4\u5ea6\u6709\u54ea\u4e9b\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u786e\u5b9a\u4e8b\u5b9e\u8868\u4e2d\u9700\u8981\u6709\u54ea\u4e9b\u7ef4\u5ea6\u5916\u952e\u3002\u4e8b\u5b9e\u8868\u4e2d\u7684\u7ef4\u5ea6\u63cf\u8ff0\u7684\u662f\u8be5\u4e1a\u52a1\u8fc7\u7a0b \u201c\u662f\u8c01\u3001\u5728\u4f55\u65f6\u3001\u5728\u4f55\u5730\u201d \u7684\u63cf\u8ff0\u4fe1\u606f\u3002</p> <p>\uff084\uff09\u786e\u5b9a\u4e8b\u5b9e</p> <p>\u6b64\u6b65\u9aa4\u786e\u8ba4\u7684\u662f\u4e8b\u5b9e\u8868\u4e2d\u7684\u5ea6\u91cf\u503c\uff08\u6b21\u6570\u3001\u4e2a\u6570\u3001\u4ef6\u6570\u3001\u91d1\u989d\u7b49\uff09\uff0c\u4f8b\u5982\u8ba2\u5355\u91d1\u989d\u3001\u4e0b\u5355\u6b21\u6570\u7b49\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u7ef4\u5ea6\u5efa\u6a21\u4ee5\u4e8b\u5b9e\u8868\u4e3a\u4e2d\u5fc3\uff0c\u4ee5\u4e1a\u52a1\u8fc7\u7a0b\u4e3a\u5efa\u6a21\u9a71\u52a8\uff0c\u57fa\u4e8e\u6bcf\u4e2a\u5177\u4f53\u4e1a\u52a1\u8fc7\u7a0b\u7684\u7279\u70b9\uff0c\u6784\u5efa\u6700\u7ec6\u7c92\u5ea6\u7684\u660e\u7ec6\u5c42\u4e8b\u5b9e\u8868\u3002</p> <p>\u7ef4\u5ea6\u5efa\u6a21\u6574\u4e2a\u6d41\u7a0b\u53ef\u4ee5\u501f\u52a9\u4e1a\u52a1\u603b\u7ebf\u77e9\u9635\u5b8c\u6210\u3002\u91cd\u70b9\u5173\u6ce8\u4e0b\u5355\u4e1a\u52a1\u6709\u5173\u7684\u4e24\u5f20\u4e8b\u5b9e\u8868\uff0c\u5373 \u8ba2\u5355\u4e8b\u5b9e\u8868 \u548c \u8ba2\u5355\u8be6\u60c5\u4e8b\u5b9e\u8868\u3002</p> \u65f6\u95f4 \u7528\u6237 \u5730\u533a \u5546\u54c1 \u4f18\u60e0\u5238 \u6d3b\u52a8 \u5ea6\u91cf\u503c \u8ba2\u5355 \u221a \u221a \u221a \u8fd0\u8d39/\u4f18\u60e0\u91d1\u989d/\u539f\u59cb\u91d1\u989d/\u6700\u7ec8\u91d1\u989d \u8ba2\u5355\u8be6\u60c5 \u221a \u221a \u221a \u221a \u221a \u221a \u4ef6\u6570/\u4f18\u60e0\u91d1\u989d/\u539f\u59cb\u91d1\u989d/\u6700\u7ec8\u91d1\u989d \u652f\u4ed8 \u221a \u221a \u221a \u652f\u4ed8\u91d1\u989d \u52a0\u8d2d \u221a \u221a \u221a \u4ef6\u6570/\u91d1\u989d \u6536\u85cf \u221a \u221a \u221a \u6b21\u6570 \u8bc4\u4ef7 \u221a \u221a \u221a \u6b21\u6570 \u9000\u5355 \u221a \u221a \u221a \u221a \u4ef6\u6570/\u91d1\u989d \u9000\u6b3e \u221a \u221a \u221a \u221a \u4ef6\u6570/\u91d1\u989d \u4f18\u60e0\u5238\u9886\u7528 \u221a \u221a \u221a \u6b21\u6570"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_10","title":"\u7ef4\u5ea6\u8868\u4e0e\u4e8b\u5b9e\u8868\uff1f","text":"<p>\u7ef4\u5ea6\u8868\u4e00\u822c\u662f\u5bf9\u4e8b\u5b9e\u7684\u63cf\u8ff0\u4fe1\u606f\u3002\u6bcf\u4e00\u5f20\u7ef4\u8868\u5bf9\u5e94\u73b0\u5b9e\u4e16\u754c\u4e2d\u7684\u4e00\u4e2a\u5bf9\u8c61\u6216\u8005\u6982\u5ff5\uff0c\u4f8b\u5982\uff1a\u7528\u6237\u3001\u5546\u54c1\u3001\u5730\u533a\u3001\u65e5\u671f\u7b49\u3002</p> <p>\u4e8b\u5b9e\u8868\u4e2d\u7684\u6bcf\u884c\u6570\u636e\u4ee3\u8868\u4e00\u4e2a\u4e1a\u52a1\u4e8b\u4ef6\uff0c\u6bd4\u5982\uff1a\u4e0b\u5355\u3001\u652f\u4ed8\u3001\u9000\u6b3e\u3001\u8bc4\u4ef7\u7b49\uff0c\u4e8b\u5b9e\u8868\u4e2d\u7684\u5b57\u6bb5\u4e00\u822c\u5206\u4e3a\u4e24\u7c7b\uff0c\u5373\uff1a\u7ef4\u5ea6\u5916\u952e \u548c \u5ea6\u91cf\u503c\u3002\u7ef4\u5ea6\u5916\u952e\u662f\u7528\u6765\u4e0e\u7ef4\u5ea6\u8868\u5173\u8054\u7684\u5b57\u6bb5\uff0c\u5ea6\u91cf\u503c\u8fd9\u4e2a\u4e1a\u52a1\u4e8b\u4ef6\u6240\u4ea7\u751f\u7684\u6570\u636e\uff0c\u6bd4\u5982\u4e0b\u5355\u7684\u91d1\u989d\uff0c\u5546\u54c1\u7684\u4ef6\u6570\u7b49\u3002</p> <p>DIM\u5c42\u548cDWD\u5c42\u7684\u6570\u636e\u6765\u81ea\u4e8eODS\u5c42\uff0c\u76f8\u5f53\u4e8e\u662f\u628aODS\u5c42\u4e2d\u4fdd\u5b58\u7684\u5173\u7cfb\u6a21\u578b\u8f6c\u6362\u6210\u4e86\u7ef4\u5ea6\u6a21\u578b\u3002</p> <p>\u4e0b\u5355\u4e1a\u52a1\u5bf9\u5e94\u4e24\u5f20\u4e8b\u5b9e\u8868\uff0c\u5206\u522b\u662f\u8ba2\u5355\u4e8b\u5b9e\u8868\u548c\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\uff0c\u8ba2\u5355\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002\u8ba2\u5355\u4e8b\u5b9e\u8868\u548c\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u7684\u533a\u522b\u662f\uff0c\u8ba2\u5355\u4e8b\u5b9e\u8868\u5b58\u7684\u662f\u4e00\u4e2a\u8ba2\u5355\u603b\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\u539f\u59cb\u603b\u91d1\u989d\u3001\u51cf\u514d\u91d1\u989d\u3001\u6700\u7ec8\u91d1\u989d\uff0c\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u5b58\u7684\u662f\u4e00\u4e2a\u8ba2\u5355\u4e2d\u7684\u4e00\u4e2a\u5546\u54c1\u9879\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\u5546\u54c1\u7684\u6570\u91cf\u3001\u539f\u59cb\u91d1\u989d\u3001\u6d3b\u52a8\u4f18\u60e0\u5206\u644a\u91d1\u989d\u3001\u6700\u7ec8\u91d1\u989d\u7b49\u3002</p> <p>\u652f\u4ed8\u4e1a\u52a1\u5bf9\u5e94\u652f\u4ed8\u4e8b\u5b9e\u8868\uff0c\u8fd9\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5176\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u5b57\u6bb5\u662fcreate_time\u3001callback_time\uff0ccallback_time\u4e0d\u4e3anull\uff0c\u8868\u793a\u652f\u4ed8\u5b8c\u6210\uff0c\u4e3anull\u5219\u8868\u793a\u652f\u4ed8\u672a\u5b8c\u6210\u3002</p> <p>\u9000\u6b3e\u4e1a\u52a1\u5bf9\u5e94\u7684\u9000\u6b3e\u4e8b\u5b9e\u8868\u4e5f\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5176\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u5b57\u6bb5\u662fcreate_time\u3001callback_time\uff0ccallback_time\u4e0d\u4e3anull\uff0c\u8868\u793a\u9000\u6b3e\u5b8c\u6210\uff0c\u4e3anull\u5219\u8868\u793a\u9000\u6b3e\u672a\u5b8c\u6210\u3002</p> <p>\u8bc4\u4ef7\u4e1a\u52a1\u5bf9\u5e94\u7684\u8bc4\u4ef7\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u56e0\u4e3a\u7528\u6237\u4e0d\u80fd\u4fee\u6539\u5df2\u53d1\u8868\u7684\u8bc4\u8bba\uff0c\u6240\u4ee5ODS\u5c42\u8bc4\u4ef7\u8868\u4e2d\u7684\u6570\u636e\u53ea\u4f1a\u65b0\u589e\u4e0d\u4f1a\u53d8\u5316\uff0c\u4e8e\u662fDWD\u5c42\u7684\u8bc4\u4ef7\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002</p> <p>\u8bc4\u4ef7\u4e8b\u5b9e\u8868\u7684\u6570\u636e\u5b8c\u5168\u6765\u81ea\u4e8eODS\u5c42\u540c\u6b65\u7684\u8bc4\u4ef7\u8868\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u5728DWD\u5c42\u5efa\u7acb\u8bc4\u4ef7\u4e8b\u5b9e\u8868\uff1f</p> <p>\u56e0\u4e3aDWD\u5c42\u7684\u5efa\u6a21\u601d\u60f3\u662f\u7ef4\u5ea6\u5efa\u6a21\uff0c\u4e8b\u5b9e\u8868\u5efa\u7acb\u7684\u4f9d\u636e\u4ee5\u4e1a\u52a1\u4e8b\u4ef6\u4e3a\u51c6\uff0c\u901a\u5e38\u6765\u8bf4DIM\u5c42\u4e0eDWD\u5c42\u4e00\u5f20\u8868\u7684\u6570\u636e\u6765\u81ea\u4e8eODS\u5c42\u591a\u5f20\u8868\u7684\u6570\u636e\uff0c\u4f46\u662f\u4e5f\u4e0d\u4e4f\u6709\u8fd9\u79cd\u5b8c\u5168\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u5173\u7cfb\u5efa\u6a21\u548c\u7ef4\u5ea6\u5efa\u6a21\u6240\u5efa\u7acb\u7684\u8868\u76f8\u540c\u3002\u4e0d\u8981\u603b\u628a\u5173\u7cfb\u5efa\u6a21\u548c\u7ef4\u5ea6\u5efa\u6a21\u8054\u7cfb\u5728\u4e00\u8d77\uff0c\u8fd9\u662f\u4e24\u79cd\u4e0d\u4e00\u6837\u7684\u5efa\u6a21\u601d\u60f3\uff0c\u6240\u9762\u5bf9\u7684\u95ee\u9898\u5e76\u4e0d\u76f8\u540c\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_11","title":"\u4e8b\u5b9e\u8868\u7684\u7c7b\u578b\uff1f","text":"<p>1.\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff08\u589e\u91cf\uff09\uff1a \u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u7279\u70b9\u662f\u6570\u636e\u53ea\u4f1a\u65b0\u589e\uff0c\u539f\u6709\u7684\u6570\u636e\u4e0d\u4f1a\u6539\u53d8\uff0c\u4e5f\u5c31\u662f\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u4f1a\u4fdd\u5b58\u6240\u6709\u4e1a\u52a1\u4e8b\u4ef6\u4ea7\u751f\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u7684\u540c\u6b65\u7b56\u7565\u662f\u589e\u91cf\u540c\u6b65\uff0c\u53ea\u9700\u8981\u5c06\u6bcf\u65e5\u589e\u91cf\u6570\u636e\u5199\u5230\u6700\u65b0\u7684\u5206\u533a\u5373\u53ef\u3002</p> <p>\u6bd4\u5982\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\u3002\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u603b\u7684\u5b58\u7684\u662f\u4e00\u4e2a\u8ba2\u5355\u4e2d\u7684\u4e00\u4e2a\u5546\u54c1\u9879\u7684\u60c5\u51b5\uff0c\u8ba2\u5355\u4ea7\u751f\u4e4b\u540e\uff0c\u65e0\u8bba\u8ba2\u5355\u7684\u72b6\u6001\u662f\u4ec0\u4e48\u6837\u7684\uff0c\u5b8c\u6210\u6216\u8005\u9000\u6b3e\uff0c\u8ba2\u5355\u660e\u7ec6\u90fd\u662f\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u7684\uff0c\u6240\u4ee5\u8ba2\u5355\u660e\u7ec6\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff0c\u5206\u533a\u5b57\u6bb5\u7b49\u4e8e\u8ba2\u5355\u7684\u521b\u5efa\u65f6\u95f4\u3002</p> <p>2.\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff08\u5168\u91cf\uff09\uff1a \u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u4e0d\u5173\u5fc3\u8868\u4e2d\u6570\u636e\u53d8\u5316\u7684\u4e2d\u95f4\u72b6\u6001\uff0c\u53ea\u4f1a\u5728\u56fa\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5982\u6bcf\u5929\u6216\u8005\u6bcf\u6708\u5bf9\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u540c\u6b65\uff0c\u5c31\u50cf\u662f\u5728\u8fd9\u4e2a\u65f6\u95f4\u70b9\u4e3a\u6570\u636e\u62cd\u4e86\u4e00\u5f20\u5feb\u7167\uff0c\u6240\u4ee5\u79f0\u4e3a\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u3002</p> <p>\u6bd4\u5982\u52a0\u8d2d\u4e8b\u5b9e\u8868\u5c31\u662f\u4e00\u5f20\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u7528\u6237\u5728\u4e00\u5929\u4e4b\u5185\u4f1a\u8fdb\u884c\u5f88\u591a\u6b21\u5c06\u5546\u54c1\u52a0\u5165\u5230\u8d2d\u7269\u8f66\u548c\u4ece\u8d2d\u7269\u8f66\u4e2d\u5220\u9664\uff0c\u4f46\u662f\u52a0\u8d2d\u4e8b\u5b9e\u8868\u5e76\u4e0d\u5173\u5fc3\u8fd9\u4e2d\u95f4\u7684\u64cd\u4f5c\uff0c\u53ea\u5728\u6bcf\u65e5\u7684\u4e00\u4e2a\u4e8b\u4ef6\u70b9\u5bf9\u6765\u81eaODS\u5c42\u7684\u6570\u636e\u505a\u4e00\u6b21\u5168\u91cf\u540c\u6b65\u3002</p> <p>3.\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff08\u65b0\u589e\u53ca\u53d8\u5316\uff09\uff1a \u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\u7684\u7279\u70b9\u662f\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\u4e0d\u540c\u542b\u4e49\u7684\u65f6\u95f4\u5b57\u6bb5\uff0c\u65f6\u95f4\u5b57\u6bb5\u662f\u5426\u6709\u503c\u8868\u793a\u7740\u6570\u636e\u5904\u4e8e\u4e0d\u540c\u72b6\u6001\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u6bcf\u4e00\u6761\u6570\u636e\u7684\u72b6\u6001\u53d8\u5316\u5c06\u5b83\u5199\u5230\u4e0d\u540c\u7684\u5206\u533a\u4e4b\u4e2d\uff0c\u4e5f\u5c31\u628a\u72b6\u6001\u6ca1\u6709\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u6700\u65b0\u76849999-99-99\u5206\u533a\u4e4b\u4e2d\uff0c\u628a\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\u7684\u6570\u636e\u4fdd\u5b58\u5728\u5176\u7ec8\u6b62\u65e5\u671f\u7684\u5206\u533a\u4e4b\u4e2d\u3002</p> <p>\u7b80\u5355\u7684\u6bd4\u5982\uff0c\u652f\u4ed8\u4e8b\u5b9e\u8868\u662f\u4e00\u5f20\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff0c\u5176\u4e0e\u72b6\u6001\u6709\u5173\u7684\u65f6\u95f4\u5b57\u6bb5\u662fcallback_time\uff0ccallback_time\u4e0d\u4e3anull\uff0c\u8868\u793a\u652f\u4ed8\u5b8c\u6210\uff0c\u4e3anull\u5219\u8868\u793a\u652f\u4ed8\u672a\u5b8c\u6210\u3002</p> <p>\u518d\u6bd4\u5982\uff0c\u8ba2\u5355\u4e8b\u5b9e\u8868\u4e2d\u6709\u8fd9\u4e9b\u65f6\u95f4\u5b57\u6bb5\uff1a</p> Text Only<pre><code>`create_time` STRING COMMENT '\u521b\u5efa\u65f6\u95f4(\u672a\u652f\u4ed8\u72b6\u6001)',\n`payment_time` STRING COMMENT '\u652f\u4ed8\u65f6\u95f4(\u5df2\u652f\u4ed8\u72b6\u6001)',\n`cancel_time` STRING COMMENT '\u53d6\u6d88\u65f6\u95f4(\u5df2\u53d6\u6d88\u72b6\u6001)',\n`finish_time` STRING COMMENT '\u5b8c\u6210\u65f6\u95f4(\u5df2\u5b8c\u6210\u72b6\u6001)',\n`refund_time` STRING COMMENT '\u9000\u6b3e\u65f6\u95f4(\u9000\u6b3e\u4e2d\u72b6\u6001)',\n`refund_finish_time` STRING COMMENT '\u9000\u6b3e\u5b8c\u6210\u65f6\u95f4(\u9000\u6b3e\u5b8c\u6210\u72b6\u6001)',\n`expire_time` STRING COMMENT '\u8fc7\u671f\u65f6\u95f4'\n</code></pre> <p>\u8868\u793a\u8ba2\u5355\u5b8c\u6210\u7684\u72b6\u6001\u6709\uff1a</p> <ol> <li>cancel_time\u4e0d\u4e3anull\uff0c\u7ec8\u6b62\u65f6\u95f4\u4e3acancel_time</li> <li>finish_time\u4e0d\u4e3anull\uff0c\u5e76\u4e14\u540c\u6b65\u7684\u65f6\u95f4\u5927\u4e8efinish_time 7\u5929\uff0c\u5e76\u4e14refund_time\u4e3anull\uff0c\u7ec8\u6b62\u65f6\u95f4\u4e3afinish_time+7\u5929</li> <li>refund_finish_time\u4e0d\u4e3anull\uff0c\u7ec8\u6b62\u65f6\u95f4\u4e3arefund_finish_time</li> <li>expire_time\u4e0d\u4e3anull\uff0c \u7ec8\u6b62\u65f6\u95f4\u4e3aexpire_time</li> </ol> <p>\u548c\u5176\u5b83\u7d2f\u79ef\u578b\u4e8b\u5b9e\u8868\u4e00\u6837\uff0c\u6839\u636e\u7ec8\u6b62\u65f6\u95f4\u5c06\u6570\u636e\u5199\u5230\u5bf9\u5e94\u7684\u5206\u533a\u4e2d\uff0c\u6ca1\u6709\u7ec8\u6b62\u7684\u6570\u636e\u5199\u52309999-99-99\u5206\u533a\u4e2d</p> <p>\u7d2f\u79ef\u578b\u4e8b\u5b9e\u8868\u7684\u88c5\u8f7d\u601d\u8def\u662f\uff0cDWD\u5c429999-99-99\u5206\u533a\u4e0eODS\u5c42\u5f53\u65e5\u5206\u533a\u7684\u6570\u636e\u505afull join\uff0c\u7136\u540e\u5c06\u5de6\u8fb9\u8868\u4e5f\u5c31\u662f9999-99-99\u5206\u533a\u4e2d\u672a\u5173\u8054\u4e0a\u7684\u6570\u636e\u548cODS\u5c42\u5f53\u65e5\u5206\u533a\u7684\u6570\u636e\u7528nvl\u6216\u8005coalesce\u51fd\u6570\u6216\u8005\u662fcase\u8bed\u53e5\u548c\u52a8\u6001\u5206\u533a\u628a\u6570\u636e\u5199\u5230\u5bf9\u5e94\u7684\u5206\u533a\u4e2d\u3002</p> <p>\u5de6\u8fb9\u8868\u4e5f\u5c31\u662f9999-99-99\u5206\u533a\u4e2d\u672a\u5173\u8054\u4e0a\u7684\u6570\u636e\u662f\u72b6\u6001\u6ca1\u6709\u53d1\u751f\u53d8\u5316\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8fd9\u90e8\u5206\u6570\u636e\u8fd8\u662f\u5904\u4e8e\u672a\u5b8c\u6210\u7684\u72b6\u6001\uff0c\u5de6\u8fb9\u8868\u5173\u8054\u4e0a\u7684\u6570\u636e\u662f\u72b6\u6001\u53d1\u751f\u53d8\u5316\u7684\u6570\u636e\uff0c\u4f46\u4e0d\u5fc5\u4ee3\u8868\u5176\u72b6\u6001\u5df2\u7ecf\u7ec8\u6b62\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u7684\u6700\u65b0\u72b6\u6001\u5168\u5728ODS\u5c42\u5f53\u65e5\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u4e2d\uff0c\u6240\u4ee5\u5c31\u4e0d\u7528\u7ba1\u8fd9\u90e8\u5206\u6570\u636e\u4e86\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_12","title":"\u62c9\u94fe\u8868\uff1f","text":"<p>\u62c9\u94fe\u8868\u53ef\u4ee5\u4fdd\u5b58\u5386\u53f2\u6570\u636e\uff0c\u5b9e\u73b0\u62c9\u94fe\u8868\u9700\u8981\u7ed9\u8868\u52a0\u4e0a\u4e24\u4e2a\u5b57\u6bb5<code>start_date</code>\u548c<code>end_date</code>\uff0c<code>start_date</code>\u662f\u8be5\u6761\u8bb0\u5f55\u6dfb\u52a0\u65f6\u7684\u65f6\u95f4\uff0c<code>end_date</code>\u662f\u8be5\u6761\u8bb0\u5f55\u8fc7\u671f\u7684\u65f6\u95f4\uff0c\u5bf9\u4e8e\u5c1a\u672a\u8fc7\u671f\u7684\u6570\u636e<code>end_date=\"9999-99-99\"</code>\uff0c\u7136\u540e\u5206\u533a\u5b57\u6bb5<code>dt</code>\u7b49\u4e8e<code>end_date</code>\uff0c\u4e5f\u5c31\u662f\u62c9\u94fe\u8868\u7684<code>9999-99-99</code>\u5206\u533a\u4f1a\u4fdd\u5b58\u6240\u6709\u6570\u636e\u7684\u6700\u65b0\u8bb0\u5f55\uff0c\u5982\u679c\u6570\u636e\u6709\u5386\u53f2\u8bb0\u5f55\uff0c\u90a3\u4e48\u4f1a\u4fdd\u5b58\u5728\u4e4b\u524d\u7684\u5206\u533a\u7684\u4e2d\u3002</p> <p>\u6bcf\u65e5\u540c\u6b65\u6570\u636e\u65f6\uff0c\u9700\u8981\u5c069999-99-99\u5206\u533a\u7684\u6570\u636e\u4e0e\u6765\u81eaODS\u5c42\u6bcf\u65e5\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u505afull join\uff0c\u7136\u540e\u5c06\u5de6\u8fb9\u88689999-99-99\u5206\u533a\u672a\u5173\u8054\u4e0a\u7684\u6570\u636e\u548c\u53f3\u8fb9\u8868ODS\u5c42\u6bcf\u65e5\u65b0\u589e\u53ca\u53d8\u5316\u7684\u6570\u636e\u4e00\u8d77insert overwrite\u52309999-99-99\u5206\u533a\u4e2d\uff0c\u56e0\u4e3a\u8fd9\u4e00\u90e8\u5206\u6570\u636e\u5c5e\u4e8e\u6700\u65b0\u7684\u6570\u636e\uff0c\u5c06\u5de6\u8fb9\u88689999-99-99\u5206\u533a\u5173\u8054\u4e0a\u7684\u6570\u636e\u5199\u5230\u524d\u4e00\u65e5\u7684\u5206\u533a\u4e2d\uff0c\u56e0\u4e3a\u6b64\u65f6\u8fd9\u4e00\u90e8\u5206\u6570\u636e\u5c31\u53d8\u6210\u4e86\u5386\u53f2\u6570\u636e\uff0c\u8fd9\u90e8\u5206\u6570\u636e\u7684end_date\u9700\u8981\u4fee\u6539\u6210\u540c\u6b65\u65f6\u7684\u524d\u4e00\u65e5\u65e5\u671f\u3002\u7528sql\u5199\u51fa\u6765\u5c31\u662f\u524d\u4e00\u90e8\u5206\u6570\u636e\u4e0e\u540e\u4e00\u90e8\u5206\u6570\u636e union all \u7136\u540e\u4f7f\u7528\u52a8\u6001\u5206\u533a\u5199\u52309999-99-99\u5206\u533a\u548c\u524d\u4e00\u65e5\u5206\u533a\u4e2d\u3002</p> <p></p> <p>\u62c9\u94fe\u8868\u7684\u4f7f\u7528\uff1a</p> <ul> <li> <p>\u5982\u679c\u8981\u5728\u67d0\u4e00\u5929\u7684\u5386\u53f2\u6570\u636e\u4e2d\u53d6\u6570\uff0c\u52a0\u4e0a dt=\"\u65e5\u671f\" \u53ef\u4ee5\u52a0\u5feb\u5206\u533a\u6570\u636e\u7684\u8fc7\u6ee4\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 end_date=\"\u65e5\u671f\";</p> </li> <li> <p>\u5982\u679c\u8981\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u52a0\u4e0a dt=\"9999-99-99\" \u53ef\u4ee5\u52a0\u5feb\u5206\u533a\u6570\u636e\u7684\u8fc7\u6ee4\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 end_date=\"9999-99-99\"\uff1b</p> </li> <li> <p>\u5982\u679c\u8981\u53d6\u67d0\u4e00\u5929\u7684\u5207\u7247\u6570\u636e\uff0c\u5373\u5728\u8fd9\u4e00\u5929\u6709\u6548\u7684\u6570\u636e,\u6bd4\u5982\uff1a\u53d6 2021-12-09 \u8fd9\u4e00\u5929\u7684\u5386\u53f2\u5207\u7247\uff0c\u90a3\u4e48\uff1a</p> </li> </ul> SQL<pre><code>select *\nfrom user_id\nwhere start_date&lt;=\"2021-12-09\" and end_date&gt;=\"2021-12-09\";\n</code></pre> <ul> <li>\u5982\u679c\u8981\u53d6\u67d0\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u5386\u53f2\u6570\u636e\uff0c\u6bd4\u5982\u53d6 2021-12-09 \u81f3 2021-12-30\uff0c\u90a3\u4e48 \uff1a</li> </ul> SQL<pre><code>select *\nfrom user_id\nwhere (start_date between \"2021-12-09\" and \"2021-12-30\")\n      or (end_date between \"2021-12-09\" and \"2021-12-30\")\n      or (start_date &lt; \"2021-12-09\" and end_date &gt; \"2021-12-30\")\n</code></pre>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#superset","title":"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bSuperSet\uff1f","text":"<p>Superset\u5c31\u662f\u7528\u6765\u5c55\u793a\u6570\u636e\u7684\uff0c\u628a\u6570\u636e\u4ee5\u56fe\u8868\u7684\u5f62\u5f0f\u76f4\u89c2\u5730\u5c55\u793a\u51fa\u6765\uff0c\u5b83\u662fApache\u5f00\u6e90\u7684\u4e00\u6b3e\u8f7b\u91cf\u7ea7BI\uff08Business Intelligence\uff09\u5206\u6790\u5de5\u5177\uff0c\u80fd\u591f\u5bf9\u63a5\u591a\u79cd\u6570\u636e\u6e90\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#kylin","title":"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bKylin?","text":"<p>Kylin\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u5206\u6790\u5f15\u64ce\uff0c\u5177\u6709\u8d85\u5927\u89c4\u6a21\u6570\u636eOLAP\u7684\u80fd\u529b\uff0c\u80fd\u591f\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u4e4b\u5185\u8fd4\u56desql\u7684\u67e5\u8be2\u7ed3\u679c\uff0c\u5b83\u7684\u8ba1\u7b97\u5f15\u64ce\u53ef\u4ee5MapReduce\uff0c\u8fd8\u53ef\u4ee5\u662fSpark\uff0c\u5b83\u539f\u7406\u5c31\u662f\u7a77\u4e3e\u51fa\u6240\u6709\u7ef4\u5ea6\u7ec4\u5408\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u89c2\u5bdf\u6570\u636e\u7684\u89d2\u5ea6\uff0c\u7136\u540e\u63d0\u524d\u4ee5\u8fd9\u4e9b\u7ef4\u5ea6\u7ec4\u5408\u7684\u8ba1\u7b97\u51fa\u5ea6\u91cf\u503c\u7684\u805a\u5408\u503c\u3002</p> <p>\u4e00\u4e2a\u89d2\u5ea6\u5f97\u5230\u7684\u6240\u6709\u805a\u5408\u503c\u5c31\u662f\u4e00\u4e2aCuboid\uff0c\u6240\u6709Cuboid\u7ec4\u6210\u4e00\u4e2aCube\uff0cKylin\u5728\u8ba1\u7b97\u65f6\u662f\u5148\u8ba1\u7b97\u6700\u9ad8\u7ef4\u7684Cuboid\uff0c\u7136\u540e\u518d\u5bf9\u9ad8\u7ef4Cuboid\u964d\u7ef4\u805a\u5408\u5c31\u53ef\u4f4e\u7ef4Cuboid\u4e86\u3002</p> <p>\u4f7f\u7528Kylin\u7684\u6b65\u9aa4\u5c31\u662f\u5148\u9009\u62e9\u4e00\u5927\u63a8\u8868\uff0c\u7136\u540e\u9009\u62e9\u8fd9\u4e9b\u8868\u7684join\u7c7b\u578b\u548cjoin\u5b57\u6bb5\uff0c\u63a5\u7740\u786e\u5b9a\u54ea\u4e9b\u5b57\u6bb5\u662f\u7ef4\u5ea6\uff0c\u54ea\u4e9b\u5b57\u6bb5\u662f\u5ea6\u91cf\uff0c\u6700\u540e\u9009\u62e9\u5ea6\u91cf\u503c\u7684\u805a\u5408\u51fd\u6570\u3002Kylin\u4f1a\u628a\u4f60\u9009\u62e9\u7684\u8868\u5148\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u7136\u540e\u7528\u7ef4\u5ea6\u5b57\u6bb5\u5206\u7ec4\uff0c\u5bf9\u5ea6\u91cf\u5b57\u6bb5\u805a\u5408\uff0c\u6700\u540e\u628a\u7ed3\u679c\u4fdd\u5b58\u5728cube\u4e2d\uff08cube\u4fdd\u5b58\u5728HBase\u4e2d\uff09\u3002\u6240\u4ee5\u4f7f\u7528Kylin\u6700\u91cd\u8981\u7684\u662f\u533a\u5206\u7ef4\u5ea6\u548c\u5ea6\u91cf\uff0c\u5efa\u6a21\u7684\u65b9\u5f0f\u5176\u5b9e\u5e76\u4e0d\u90a3\u4e48\u91cd\u8981\uff0c\u5efa\u6a21\u7684\u65b9\u6cd5\u53ea\u662f\u65b9\u6cd5\u8bba\uff0c\u6700\u540e\u843d\u5b9e\u7684\u8fd8\u662f\u8868\uff0cKylin\u53ea\u5173\u6ce8\u6700\u540e\u8fde\u63a5\u5728\u4e00\u8d77\u7684\u8868\u4e2d\u54ea\u4e9b\u662f\u7ef4\u5ea6\u54ea\u4e9b\u662f\u5ea6\u91cf\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_13","title":"\u7406\u89e3\uff1f","text":"<p>dwa\u5c42\u4e8b\u5b9e\u8868\uff0c\u5982\u679c\u7ef4\u5ea6\u662f1:1\u6216\u8005n:1\u7684\uff0c\u90fd\u4f1a\u5728\u540c\u4e00\u5f20\u4e8b\u5b9e\u8868\u4e0a\uff08\u51c6\u786e\u6765\u8bf4\uff0c\u4ed6\u4eec\u662f\u540c\u4e00\u4e2a\u4e3b\u9898\uff0c\u56e0\u4e3a\u4e00\u4e2a\u7ef4\u5ea6\u786e\u5b9a\u4e86\uff0c\u53e6\u4e00\u4e2a\u7ef4\u5ea6\u4e5f\u5c31\u786e\u5b9a\u4e86\uff09\uff1b\u5982\u679c\u4e24\u4e2a\u7ef4\u5ea6\u662fn:n\u7684\uff0c\u90a3\u4e48\u4ed6\u4fe9\u5c31\u662f\u6ca1\u6709\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u4e3b\u9898\uff0c\u5e94\u8be5\u5728\u4e24\u5f20\u4e0d\u540c\u7684\u4e8b\u5b9e\u8868\u4e0a\u3002</p> <p>\u6307\u6807\u662f\u4f34\u968f\u7740\u52a8\u4f5c\u51fa\u73b0\u7684\uff0c\u6240\u4ee5\u9700\u8981\u9009\u62e9\u4e1a\u52a1\u8fc7\u7a0b\uff0c\u7136\u540e\u7ec6\u5316\u4e00\u4e0b\u4e1a\u52a1\u8fc7\u7a0b\uff08\u786e\u5b9a\u8fd9\u4e2a\u52a8\u4f5c\u662f\u4e0d\u662f\u592a\u6cdb\u4e86\uff0c\u592a\u6cdb\u4e86\u8981\u5177\u4f53\uff0c\u4e5f\u5c31\u662f\u786e\u8ba4\u7c92\u5ea6\uff09\uff0c\u4e4b\u540e\u662f\u786e\u8ba4\u7ef4\u5ea6\uff08\u4e5f\u5c31\u662f\u770b\u8fd9\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u6709\u591a\u5c11\u5b9e\u4f53\u53c2\u4e0e\u4e86\uff09\uff0c\u6700\u540e\u662f\u786e\u8ba4\u6307\u6807\uff08\u770b\u770b\u8fd9\u4e2a\u4e1a\u52a1\u8fc7\u7a0b\u90fd\u4ea7\u751f\u4e86\u54ea\u4e9b\u6307\u6807\uff09\u3002</p> <p>\u7ef4\u5ea6\u8868\u662f\u4e00\u4e9b\u91cd\u8981\u7684\u5b9e\u4f53\uff0c\u8fd9\u4e9b\u5b9e\u4f53\u7684\u5173\u7cfb\u662fn:n\uff0c\u8fd9\u4e2a\u4e3b\u9898\u4f1a\u628a1:1\u548cn:1\u7684\u7ef4\u5ea6\u5438\u6536\u8fdb\u6765\u3002</p> <p>\u6bd4\u5982 \u7528\u6237\u3001\u5546\u54c1 \u4e24\u8005\u4ea7\u751f\u5173\u7cfb\u7684\u52a8\u4f5c\u662f\u4e0b\u5355\uff0c\u4e0b\u5355\u662f\u4e00\u4e2a\u52a8\u4f5c\uff0c\u6240\u4ee5\u8ba2\u5355\u662f\u4e00\u4e2a\u4e8b\u5b9e\u8868\u3002</p> <p>\u4e1a\u52a1\u8fc7\u7a0b\u662f\u5c06\u7ef4\u5ea6\u8054\u7cfb\u8d77\u6765\u4ea7\u751f\u6307\u6807\u7684\uff0c\u6240\u4ee5\u7ef4\u5ea6\u5efa\u6a21\u4ee5\u4e1a\u52a1\u8fc7\u7a0b\u9a71\u52a8\u3002</p> <p>dwd\u5c42\u4e8b\u5b9e\u8868\u4e00\u5b9a\u4f1a\u6709\u6307\u6807\u5417\uff1f\u4e5f\u4e0d\u4e00\u5b9a\uff0c\u6bd4\u5982\u4ece\u70b9\u51fb\u7b49\u57cb\u70b9\u4e8b\u4ef6\u8bb0\u5f55\u7684\u662f\u7528\u6237\u5728\u4f55\u65f6\u70b9\u51fb\u4e86\u4ec0\u4e48\uff0c\u8fd9\u79cd\u4e8b\u5b9e\u5c31\u6ca1\u6709\u6307\u6807\uff0c\u4f46\u662f\u8fd9\u79cd\u4e8b\u5b9e\u5728\u4e0b\u6e38dwa\u5c42\u4f1a\u805a\u5408\u51fa\u6307\u6807\u6765\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#scdslowly_changing_dimension","title":"SCD\uff08Slowly Changing Dimension\uff0c\u7f13\u6162\u53d8\u5316\u7ef4\uff09\u53ca\u5176\u5904\u7406\u65b9\u5f0f\uff1f","text":"<p>SCD\uff08Slowly Changing Dimension\uff0c\u7f13\u6162\u53d8\u5316\u7ef4\uff09\uff0c\u76f8\u5bf9\u4e8e\u4e8b\u5b9e\u6765\u8bf4\uff0c\u7ef4\u5ea6\u968f\u65f6\u95f4\u53d8\u6362\u66f4\u52a0\u7f13\u6162\uff0c\u6240\u4ee5\u79f0\u4e3a\u7f13\u6162\u53d8\u5316\u7ef4\u5ea6\u3002</p> <p>\u5e38\u7528\u7684\u5904\u7406\u65b9\u5f0f\uff1a</p> <ol> <li>\u5f53\u7ef4\u8868\u4e0d\u5927\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u6bcf\u5929\u7684\u5206\u533a\u90fd\u5b58\u5168\u91cf\u7684\u6570\u636e\u3002\u6216\u8005\u516c\u53f8\u6709\u94b1\u80fd\u8d2d\u4e70\u5f88\u591a\u673a\u5668\uff0c\u8fd9\u6837\u505a\u65e5\u540e\u4f7f\u7528\u4e5f\u66f4\u52a0\u65b9\u4fbf\uff0c\u6bd4\u5982\u5b57\u8282\u5c31\u662f\u8fd9\u6837\u505a\u7684\u3002</li> <li>\u6bcf\u5929\u90fd\u8986\u76d6\u5199\uff0c\u53ea\u4fdd\u7559\u4e00\u4e2a\u5206\u533a\u7684\u6570\u636e\u3002</li> <li>\u6dfb\u52a0\u65b0\u5217\u4fdd\u5b58\u65e7\u503c\uff0c\u5982\u679c\u53ea\u60f3\u4fdd\u5b58\u4e00\u4e2a\u65e7\u503c\u5c31\u53ea\u6dfb\u52a0\u4e00\u4e2a\u65b0\u5217\uff0c\u540c\u7406\uff0c\u5982\u679c\u60f3\u4fdd\u5b58\u591a\u4e2a\u65e7\u503c\uff0c\u90a3\u4e48\u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\u5217\u3002</li> <li>\u6dfb\u52a0\u65b0\u884c\uff0c\u4e5f\u5c31\u662f\u62c9\u94fe\u8868\uff0c\u6bcf\u5f53\u6570\u636e\u884c\u53d1\u751f\u53d8\u5316\uff0c\u5c31\u65b0\u589e\u4e00\u884c\u4fdd\u5b58\u65b0\u6570\u636e\uff0c\u7136\u540e\u65e7\u6570\u636e\u884c\u4fdd\u5b58\u5728\u5f53\u5929\u7684\u5206\u533a\u4e2d\uff0c\u65b0\u6570\u636e\u4fdd\u5b58\u57289999-99-99\u5206\u533a\u4e2d\u3002</li> </ol> <p>\u62c9\u94fe\u8868\uff08\u7f13\u6162\u53d8\u5316\u7ef4\uff09\uff1f</p> <p>\u7ef4\u5ea6\u8868\u90fd\u662f\u5168\u91cf\u8868\uff0c\u4f46\u662f\u6709\u4e9b\u7ef4\u5ea6\u8868\u6570\u636e\u91cf\u5b9e\u5728\u662f\u592a\u5927\u4e86\uff0c\u5e76\u4e14\u6570\u636e\u53d8\u5316\u7684\u4e5f\u6bd4\u8f83\u5c11\uff08\u540c\u6b65\u65f6\u95f4\u5e94\u8be5\u4e0d\u662f\u95ee\u9898\uff0c\u56e0\u4e3a\u62c9\u94fe\u8868\u5728\u540c\u6b65\u6570\u636e\u7684\u65f6\u5019\uff0c\u6570\u636e\u6e90\u9700\u8981\u5168\u8868\u626b\u63cf\uff0c\u5728\u5199\u5230dim\u5c42\u7684\u65f6\u5019\u8fd8\u9700\u8981\u8ba1\u7b97full join\uff0c\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u5e94\u8be5\u4e0d\u6bd4\u5168\u91cf\u540c\u6b65\u5feb\uff0c\u505a\u62c9\u94fe\u8868\u4e3b\u8981\u539f\u56e0\u8fd8\u662f\u8282\u7701\u5b58\u50a8\u7a7a\u95f4\u5427\uff09\uff0c\u5b58\u8d77\u6765\u592a\u8d39\u7a7a\u95f4\uff0c\u4e8e\u662f\u7528\u62c9\u94fe\u8868\u3002\u4e3a\u4ec0\u4e48\u4e0d\u53ea\u5b58\u50a82\u5929\u5de6\u53f3\u7684\u5168\u91cf\u6570\u636e\u5462\uff1f\u56e0\u4e3a\u6709\u65f6\u5019\u9700\u8981\u5168\u91cf\u7684\u5386\u53f2\u6570\u636e\uff0c\u4e0d\u6b62\u524d2\u5929\u7684\u3002\u62c9\u94fe\u8868\u53ef\u4ee5\u5728\u65e2\u8282\u7701\u4e86\u7a7a\u95f4\u7684\u540c\u65f6\u53c8\u4fdd\u7559\u4e86\u5168\u90e8\u7684\u5386\u53f2\u6570\u636e\u3002</p> <p>\u603b\u7ed3\uff0c\u62c9\u94fe\u8868\u9002\u5408\u6570\u636e\u91cf\u5927\uff0c\u4f46\u662f\u53d8\u5316\u91cf\u7ea7\u6bd4\u8f83\u5c0f\u7684\u7ef4\u5ea6\u8868\uff08\u7f13\u6162\u53d8\u5316\u7ef4\uff09\u3002\u62c9\u94fe\u8868\u7684\u4f5c\u7528\u662f\u53ef\u4ee5\u5728\u65e2\u8282\u7701\u4e86\u7a7a\u95f4\u7684\u540c\u65f6\u53c8\u4fdd\u7559\u4e86\u5168\u90e8\u7684\u5386\u53f2\u6570\u636e\u3002</p> <p>ODS\u5c42\u4e0d\u6539\u53d8\u6570\u636e\u6e90\u7684\u8868\u7ed3\u6784\uff0c\u53ea\u505a\u6570\u636e\u540c\u6b65\uff0c\u4f46\u662f\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u540c\u6b65\u65b9\u5f0f\uff0c\u4e0d\u540c\u7684\u540c\u6b65\u65b9\u5f0f\u53ea\u662f\u5f71\u54cd\u4e86\u6570\u636e\u7684\u50a8\u5b58\u65b9\u5f0f\u548c\u4e0b\u6e38\u7684\u4f7f\u7528\u65b9\u5f0f\uff08\u4e5f\u5c31\u662f\u53ea\u662f\u5f71\u54cd\u4e86sql\u7684\u5199\u6cd5\uff09\uff0c\u5e76\u6ca1\u6709\u6539\u53d8ods\u5c42\u9700\u8981\u4fdd\u5b58\u6240\u6709\u6570\u636e\u7684\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u65e0\u8bba\u4f7f\u7528\u54ea\u79cd\u540c\u6b65\u65b9\u5f0f\uff0cODS\u5c42\u90fd\u540c\u6b65\u4e86\u6240\u6709\u6570\u636e\u3002</p> <p>DIM\u5c42\u548cDWD\u5c42\u57fa\u4e8e\u7ef4\u5ea6\u5efa\u6a21\u7684\u601d\u60f3\uff0c\u5bf9\u8868\u7ed3\u6784\u505a\u51fa\u4e86\u4fee\u6539\uff0c\u4f46\u65e0\u8bba\u662f\u7ef4\u5ea6\u8868\u8fd8\u662f\u4e8b\u5b9e\u8868\uff0c\u90fd\u5b58\u50a8\u4e86\u4e0e\u4e4b\u76f8\u5173\u8054\u7684ODS\u7684\u5168\u90e8\u6570\u636e\u3002\u6bd4\u5982DIM\u5c42\u7684\u7ef4\u5ea6\u8868\u53ea\u6709\u5168\u91cf\u548c\u62c9\u94fe\u8868\u4e24\u79cd\uff0c\u8fd9\u4e24\u79cd\u8868\u90fd\u662f\u53ef\u4ee5\u53d6\u5230\u8be5\u7ef4\u5ea6\u7684\u6240\u6709\u5386\u53f2\u6570\u636e\u7684\u3002DWD\u5c42\u67093\u79cd\u8868\uff0c\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff08\u5168\u91cf\u8868\uff09\u3001\u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff08\u589e\u91cf\u8868\uff09\u3001\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff08\u65b0\u589e\u53ca\u53d8\u5316\u8868)\u90fd\u4fdd\u5b58\u4e86\u6240\u6709\u5386\u53f2\u4e8b\u52a1\u3002\u4e0d\u540c\u7c7b\u578b\u7684\u8868\u90fd\u53ef\u4ee5\u53d6\u5230\u6240\u6709\u5386\u53f2\u6570\u636e\uff0c\u53ea\u662f\u5f71\u54cd\u4e86\u4f7f\u7528\u65b9\u5f0f\u3002DIM\u5c42\u548cDWD\u5c42\u7684\u8868\u5c31\u662f\u5c06\u6570\u636e\u6e90\u7684\u6240\u6709\u5386\u53f2\u6570\u636e\u8fdb\u884c\u7ef4\u5ea6\u5efa\u6a21\u4e4b\u540e\u5f62\u6210\u7684\uff0c\u6240\u6709\u5386\u53f2\u6570\u636e \u548c \u7ef4\u5ea6\u5efa\u6a21 \u90fd\u662f\u540e\u7eed\u7edf\u8ba1\u4f7f\u7528\u7684\u57fa\u7840\uff08DWS\u3001DWT\u6b63\u662f\u5982\u6b64\uff09\u3002</p> <p>DWS\u5c42\u7684\u6570\u636e\u9762\u5411\u4e3b\u9898\u8fdb\u884c\u7edf\u8ba1\uff0c\u7edf\u8ba1\u4e3b\u9898\u5f53\u65e5\u6d3b\u8dc3\u4ea7\u751f\u7684\u5404\u9879\u6307\u6807\uff0c\u6240\u4ee5\u8be5\u5c42\u7684\u8868\u6ca1\u6709\u8be5\u4e3b\u4f53\u5168\u90e8\u7684\u5386\u53f2\u6570\u636e\u3002\u56e0\u4e3a\u662f\u7edf\u8ba1\u5f53\u65e5\u6d3b\u8dc3\uff0c\u6240\u4ee5\u5982\u679c\u662f\u4ece\u5468\u671f\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff08\u5168\u91cf\u8868\uff09\u548c \u4e8b\u52a1\u578b\u4e8b\u5b9e\u8868\uff08\u589e\u91cf\u8868\uff09\u4e2d\u53d6\u6570\uff0c\u5c31\u662f\u5f53\u65e5\u5206\u533a\uff1b\u5982\u679c\u662f\u7d2f\u79ef\u578b\u5feb\u7167\u4e8b\u5b9e\u8868\uff08\u65b0\u589e\u53ca\u53d8\u5316\u8868)\uff0c\u90a3\u4e48\u5c31\u662f\u5f53\u65e5\u5206\u533a\u548c<code>'9999-99-99'</code>\u5206\u533a\u3002</p> <p>DWT\u5c42\u540c\u6837\u662f\u9762\u5411\u4e3b\u9898\u8fdb\u884c\u7edf\u8ba1\uff0c\u4f46\u662fDWT\u56e0\u4e3a\u6709\u5386\u53f2\u5168\u90e8\u7684\u7d2f\u79ef\u503c\uff0c\u6240\u4ee5\u80af\u5b9a\u4e0d\u50cfDWS\u90a3\u6837\u53ea\u5b58\u5f53\u65e5\u6709\u52a8\u9759\u7684\u6570\u636e\uff0cdwt\u5e94\u8be5\u5b58\u7684\u662f\u5168\u91cf\u7684\u6570\u636e\uff08\u5982\u679c\u53ea\u5b58\u5386\u53f230\u5929\u7684\u7d2f\u79ef\u503c\uff0c\u90a3\u4e48\u8868\u4e2d\u53ef\u4ee5\u53ea\u4fdd\u5b58\u8fd130\u5929\u6709\u52a8\u9759\u7684\u6570\u636e\uff1b\uff09</p> <p>~~dws\u4e0edwt\u786e\u5b9e\u6709\u91cd\u590d\uff0cdwt\u57fa\u4e8edws\u8ba1\u7b97\uff0c\u90a3\u4e48dws\u7684\u89d2\u8272\u66f4\u50cf\u662f\u4e00\u4e2a\u4e2d\u95f4\u5c42\uff0c\u90a3\u4e48\u5c31\u5b9a\u4e49\u4e00\u4e2a\u4e2d\u95f4\u5c42dwi\u3002dwt\u66f4\u540d\u4e3adwa\u5bf9\u5916\u63d0\u4f9b\uff0cdwi\u4e0d\u5bf9\u5916\u3002dwa\u5c31\u662f\u6240\u8c13\u7684\u4e3b\u9898\u5bbd\u8868\u3002~~</p> <p>\u6700\u540e\u8bba\u6587\u7684\u6570\u4ed3\u5206\u5c42\u662f\uff0cods,dim,dwd,dwi,dwa,dm,app\uff0c\u601d\u8003dm\u5c42\u90fd\u9700\u8981\u505a\u6210\u4ec0\u4e48\u6837\uff1f</p> <p>dwa\u5b58\u7684\u662f\u73b0\u5728dws\u7684\u4e1c\u897f\uff0cdm\u5b58\u7684\u662f\u73b0\u5728dwt\u7684\u4e1c\u897f\uff0cdm\u8fd8\u5b58\u5168\u91cf\u7528\u6237\u753b\u50cf\uff0cdm\u7684\u8868\u8fd8\u76f4\u63a5\u7ed9\u6570\u636e\u96c6\u4f7f\u7528\uff0capp\u5c42\u5b58\u7684\u662f\u62a5\u8868\u4f7f\u7528\u7684\u4e1c\u897f\u3002</p> <p>\u7ef4\u8868\u5c31\u662f\u8fd9\u4e2a\u7cfb\u7edf\u4e2d\u6700\u57fa\u672c\u7684\u5b9e\u4f53\uff0c\u6bd4\u5982\u8fd9\u4e2a\u7535\u5546\u6570\u4ed3\u6700\u57fa\u672c\u7684\u7ef4\u5ea6\u662f\u7528\u6237\u3001\u5546\u54c1\u3001\u4f18\u60e0\u5238\u3002\u4e1a\u52a1\u6570\u636e\u5e93\u4f7f\u7528\u5173\u7cfb\u5efa\u6a21\u7684\u65f6\u5019\u4f1a\u628a\u7ef4\u8868\u62c6\u5f97\u5f88\u7ec6\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u51cf\u5c11\u5197\u4f59\uff0c\u907f\u514d\u5404\u79cd\u63d2\u5165\u5220\u9664\u4fee\u6539\u5f02\u5e38\u800c\u5bfc\u81f4\u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\u3002\u4f46\u662f\u7ef4\u5ea6\u5efa\u6a21\u662f\u4ee5\u6570\u636e\u67e5\u8be2\u5206\u6790\u4e3a\u76ee\u7684\uff0c\u4ee5\u8fd9\u4e9b\u6700\u57fa\u672c\u7684\u7ef4\u5ea6\u4e3a\u4e2d\u5fc3\uff0c\u7136\u540e\u5c06\u5b83\u4ee5\u6b64\u4e3a\u57fa\u7840\u6d3e\u751f\u5f97\u5230\u7684\u7ef4\u5ea6\u518d\u5199\u56de\u7ef4\u8868\uff0c\u6bd4\u5982\u5546\u54c1\u8868\u548cspu\u8868\u662f\u4e00\u5bf9\u591a\uff0c\u6700\u540e\u4f1a\u628aspu\u7684\u5c5e\u6027\u5199\u5230\u5546\u54c1\u8868\u91cc\u9762\uff0c\u5546\u54c1\u8868\u4e0e\u5546\u54c1\u7684\u9500\u552e\u5c5e\u6027\u662f\u591a\u5bf9\u591a\uff0c\u6700\u540e\u4f1a\u628a\u9500\u552e\u5c5e\u6027\u805a\u5408\u6210\u6570\u7ec4\u5199\u56de\u5546\u54c1\u8868\u91cc\u9762\uff1bspu\u8868\u548c\u5546\u54c1\u9500\u552e\u5c5e\u6027\u90fd\u662f\u56e0\u4e3a\u5546\u54c1\u5b58\u5728\u800c\u884d\u751f\u51fa\u6765\u7684\u7ef4\u5ea6\uff0c\u6240\u4ee5\u5728\u6700\u540e\u7684\u7ef4\u5ea6\u8868\u91cc\u9762\u53ea\u4f1a\u5c06\u4ed6\u4eec\u4f5c\u4e3a\u5546\u54c1\u7684\u9644\u5c5e\u5c5e\u6027\u5199\u5230\u5546\u54c1\u8868\u91cc\u9762\u3002</p> <p>\u4e8b\u5b9e\u8868\u5c31\u662f\u6700\u57fa\u672c\u7684\u5c5e\u6027\u4e4b\u95f4\u4ea7\u751f\u5173\u8054\uff08\u4e1a\u52a1\u8fc7\u7a0b\uff09\u800c\u751f\u6210\u7684\uff0c\u4f34\u968f\u7740\u6307\u6807\u7684\u51fa\u73b0\uff0c\u6240\u4ee5\u8fd9\u4e9b\u6307\u6807\u90fd\u53ef\u4ee5\u4ece\u4e24\u4e2a\u89d2\u5ea6\u6765\u89c2\u5bdf\uff1b\u53e6\u5916\u6709\u65f6\u5019\u53ef\u80fd\u662f\u66f4\u7c97\u7c92\u5ea6\u4e4b\u95f4\u7684\u7ef4\u5ea6\u4ea7\u751f\u7684\u5173\u8054\uff0c\u56e0\u4e3a\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u5c31\u662f\u8fd9\u4e48\u8bbe\u8ba1\u7684\uff08\u53ef\u80fd\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u4e0d\u80fd\u62c6\u5206\u5230\u66f4\u7ec6\u7c92\u5ea6\uff09\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u80fd\u9700\u8981\u6570\u4ed3\u6765\u4ee5\u67d0\u79cd\u903b\u8f91\u5bf9\u6307\u6807\u8fdb\u884c\u62c6\u5206\u3002</p> <p>\u4e8b\u5b9e\u8868\u5e94\u8be5\u6ca1\u6709delete\u6570\u636e\uff0c\u4e00\u822c\u662f\u7ef4\u5ea6\u8868\u6709delete\u6570\u636e\uff0c\u4e0d\u8fc7\u4e1a\u52a1\u7cfb\u7edf\u90fd\u4e0d\u4f1a\u771f\u6b63\u7684\u5220\u9664\u6570\u636e\uff0c\u800c\u662f\u6253\u4e2a\u5220\u9664\u6807\u8bb0\uff0c\u6240\u4ee5\u6570\u4ed3\u5c31\u65b0\u589e\uff0c\u6216\u8005\u65b0\u589e\u53ca\u53d8\u5316\u7684\u540c\u6b65\u7b56\u7565\uff0c\u62c9\u94fe\u8868\u548c\u7d2f\u79ef\u578b\u5feb\u7167\u8868\u90fd\u6ca1\u95ee\u9898\uff0c\u53e6\u5916\u7ef4\u5ea6\u8868\u4e00\u822c\u90fd\u662f\u5168\u91cf\u8868\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_14","title":"\u6570\u4ed3\u5206\u5c42\u7684\u610f\u4e49\uff1f","text":"<ul> <li>\u51cf\u5c11\u91cd\u590d\u5f00\u53d1\uff0c\u5728\u6570\u636e\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u4ea7\u751f\u4e2d\u95f4\u5c42\uff0c\u5c06\u516c\u5171\u903b\u8f91\u4e0b\u6c89\uff0c\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97\uff1b</li> <li>\u6e05\u6670\u6570\u636e\u7ed3\u6784\uff0c\u7b80\u5355\u5316\u590d\u6742\u95ee\u9898\uff0c\u6bcf\u4e2a\u5206\u5c42\u5206\u5de5\u660e\u786e\uff0c\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u7406\u89e3\uff1b</li> <li>\u65b9\u4fbf\u5b9a\u4f4d\u95ee\u9898\uff0c\u901a\u8fc7\u5206\u5c42\u4e86\u89e3\u6570\u636e\u8840\u7f18\u5173\u7cfb\uff0c\u5728\u51fa\u95ee\u9898\u7684\u65f6\u5019\u901a\u8fc7\u56de\u6eaf\u5b9a\u4f4d\u95ee\u9898\uff1b</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_15","title":"\u6570\u636e\u4ed3\u5e93\u5efa\u6a21\u65b9\u6cd5\uff1f","text":"<ul> <li> <p>ER\u6a21\u578b\uff08\u8303\u5f0f\u6a21\u578b\uff09</p> </li> <li> <p>\u7ef4\u5ea6\u5efa\u6a21</p> </li> </ul> <p>\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u4ee5\u53ca\u907f\u514d\u5197\u4f59\uff0cER\u6a21\u578b\u9075\u5faa\u7b2c\u4e09\u8303\u5f0f\uff0c\u4f46\u5728\u5927\u89c4\u6a21\u6570\u636e\u8de8\u8868\u5206\u6790\u7edf\u8ba1\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u9020\u6210\u591a\u8868\u5173\u8054\uff0c\u8fd9\u4f1a\u5927\u5927\u964d\u4f4e\u6267\u884c\u6548\u7387\u3002\u800c\u7ef4\u5ea6\u5efa\u6a21\u662f\u4ece\u5206\u6790\u51b3\u7b56\u7684\u9700\u6c42\u51fa\u53d1\u6784\u5efa\u6a21\u578b\uff0c\u4e3a\u5206\u6790\u9700\u6c42\u670d\u52a1\uff0c\u56e0\u6b64\u5b83\u91cd\u70b9\u5173\u6ce8\u7528\u6237\u5982\u4f55\u66f4\u5feb\u901f\u7684\u5b8c\u6210\u9700\u6c42\u5206\u6790\uff0c\u540c\u65f6\u5177\u6709\u8f83\u597d\u7684\u5927\u89c4\u6a21\u590d\u6742\u67e5\u8be2\u7684\u76f8\u5e94\u80fd\u529b\uff0c\u6240\u4ee5\u7ef4\u5ea6\u5efa\u6a21\u662f\u53cd\u8303\u5f0f\u7406\u8bba\uff0c\u5305\u542b\u661f\u578b\u6a21\u578b\u548c\u96ea\u82b1\u6a21\u578b\u4e24\u79cd\u3002</p> <ul> <li>Data Vault\u6a21\u578b</li> </ul> <p>DataVault\u7531Hub\uff08\u5173\u952e\u6838\u5fc3\u4e1a\u52a1\u5b9e\u4f53\uff09\u3001Link\uff08\u5173\u7cfb\uff09\u3001Satellite\uff08\u5b9e\u4f53\u5c5e\u6027\uff09 \u4e09\u90e8\u5206\u7ec4\u6210 \uff0c\u662fDan Linstedt\u53d1\u8d77\u521b\u5efa\u7684\u4e00\u79cd\u6a21\u578b\u65b9\u6cd5\u8bba\uff0c\u5b83\u662f\u5728ER\u5173\u7cfb\u6a21\u578b\u4e0a\u7684\u884d\u751f\uff0c\u540c\u65f6\u8bbe\u8ba1\u7684\u51fa\u53d1\u70b9\u4e5f\u662f\u4e3a\u4e86\u5b9e\u73b0\u6570\u636e\u7684\u6574\u5408\uff0c\u5e76\u975e\u4e3a\u6570\u636e\u51b3\u7b56\u5206\u6790\u76f4\u63a5\u4f7f\u7528\u3002</p> <ul> <li>Anchor\u6a21\u578b</li> </ul> <p>Anchor\u6a21\u578b\u662f\u5bf9Data Vault\u6a21\u578b\u505a\u4e86\u8fdb\u4e00\u6b65\u89c4\u8303\u5316\u5904\u7406\uff0c\u5b83\u662f\u4e00\u4e2a\u9ad8\u5ea6\u53ef\u6269\u5c55\u7684\u6a21\u578b\uff0c\u6240\u6709\u7684\u6269\u5c55\u53ea\u662f\u6dfb\u52a0\u800c\u4e0d\u662f\u4fee\u6539\uff0c\u56e0\u6b64\u5b83\u5c06\u6a21\u578b\u89c4\u8303\u52306NF\uff0c\u57fa\u672c\u53d8\u6210\u4e86K-V\u7ed3\u6784\u6a21\u578b\u3002\u4f01\u4e1a\u5f88\u5c11\u4f7f\u7528\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_16","title":"\u7ef4\u5ea6\u6a21\u578b\u7684\u79cd\u7c7b\uff1f","text":"<p>\u661f\u578b\u6a21\u578b\uff1a\u7531\u4e00\u5f20\u4e8b\u5b9e\u8868\u4e0e\u591a\u5f20\u7ef4\u5ea6\u8868\u7ec4\u6210\uff0c\u901a\u8fc7\u7ef4\u5ea6\u5916\u952e\u5173\u8054\u3002</p> <p></p> <p>\u96ea\u82b1\u6a21\u578b\uff1a\u4e0e\u661f\u578b\u6a21\u5f0f\u76f8\u540c\uff0c\u7531\u4e00\u5f20\u4e8b\u5b9e\u8868\u4e0e\u591a\u5f20\u7ef4\u5ea6\u8868\u7ec4\u6210\uff0c\u901a\u8fc7\u7ef4\u5ea6\u5916\u952e\u5173\u8054\uff0c\u6240\u8c13\u7684\u201c\u96ea\u82b1\u5316\u201d\u5c31\u662f\u5c06\u661f\u578b\u6a21\u578b\u4e2d\u7684\u7ef4\u5ea6\u8868\u8fdb\u884c\u89c4\u8303\u5316\u5904\u7406\uff0c\u4e0d\u8fc7\u96ea\u82b1\u6a21\u578b\u5bf9\u7ef4\u5ea6\u8fdb\u884c\u89c4\u8303\u4f1a\u5e76\u4e0d\u4f1a\u5b8c\u5168\u9075\u5faa3NF\uff0c\u56e0\u4e3a\u5b8c\u5168\u9075\u5faa\u4e09\u8303\u5f0f\u867d\u7136\u964d\u4f4e\u4e86\u6570\u636e\u7684\u5197\u4f59\uff0c\u4f46\u662f\u4f1a\u5bfc\u81f4\u67e5\u8be2\u6210\u672c\u8fc7\u9ad8\u3002</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_17","title":"\u661f\u578b\u6a21\u578b \u4e0e \u96ea\u82b1\u6a21\u578b \u7684\u4f18\u7f3a\u70b9\uff1f","text":"<p>\u56e0\u4e3a\u96ea\u82b1\u6a21\u578b\u4f1a\u5bf9\u7ef4\u5ea6\u8868\u8fdb\u884c\u89c4\u8303\u5316\uff0c\u4e5f\u5c31\u662f\u4f1a\u5c06\u4e00\u5f20\u8868\u62c6\u5206\u6210\u591a\u5f20\u8868\uff0c\u6240\u4ee5\u4f18\u70b9\u662f\u4f7f\u7528\u8d77\u6765\u66f4\u52a0\u7075\u6d3b\uff0c\u4f46\u662f\u7f3a\u70b9\u5c31\u662f\u67e5\u8be2\u6027\u80fd\u4f4e\uff1b\u661f\u578b\u6a21\u578b\u521a\u597d\u53cd\u8fc7\u6765\u4e86\uff0c\u56e0\u4e3a\u661f\u578b\u6a21\u578b\u4e0d\u4f1a\u8fdb\u884c\u89c4\u8303\u5316\uff0c\u6240\u4ee5\u4f18\u70b9\u5c31\u662f\u67e5\u8be2\u6027\u80fd\u9ad8\uff0c\u4f46\u662f\u4f7f\u7528\u8d77\u6765\u4e0d\u5982\u96ea\u82b1\u6a21\u578b\u7075\u6d3b\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93/#_18","title":"\u8be5\u5982\u4f55\u9009\u62e9\uff1f","text":"<p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e0d\u4f1a\u7edd\u5bf9\u9009\u62e9\u4e00\u79cd\uff0c\u6839\u636e\u60c5\u51b5\u7075\u6d3b\u7ec4\u5408\uff0c\u751a\u81f3\u5e76\u5b58\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","title":"\u8ba1\u7b97\u673a\u7f51\u7edc","text":"<p> \u7ea6 2463 \u4e2a\u5b57  4 \u5f20\u56fe\u7247  \u9884\u8ba1\u9605\u8bfb\u65f6\u95f4 49 \u5206\u949f</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#tcpudp","title":"TCP\u548cUDP\uff1f","text":"<p>UDP\u662f\u65e0\u8fde\u63a5\uff0c\u9762\u5411\u62a5\u6587\u7684\u4f20\u8f93\u5c42\u534f\u8bae\uff0c\u5c3d\u6700\u5927\u53ef\u80fd\u4ea4\u4ed8\u3002</p> <p>TCP\uff1a\u4e00\u662f\u9762\u5411\u8fde\u63a5\uff0c\u6709\u6d41\u91cf\u63a7\u5236\uff0c\u62e5\u585e\u63a7\u5236\uff0c\u63d0\u4f9b\u5168\u53cc\u5de5\u901a\u4fe1\uff1b\u4e8c\u662f\u9762\u5411\u5b57\u8282\u6d41\uff0c\u63d0\u4f9b\u53ef\u9760\u4ea4\u4ed8\uff0c\u80fd\u4fdd\u8bc1\u5b57\u8282\u6d41\u65e0\u5dee\u9519\u3001\u4e0d\u4e22\u5931\u3001\u4e0d\u91cd\u590d\u3001\u5e76\u4e14\u6309\u5e8f\u5230\u8fbe\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#tcp","title":"TCP \u7684\u4e09\u6b21\u63e1\u624b\uff1f","text":"<p>A \u4e3a\u5ba2\u6237\u7aef\uff0cB \u4e3a\u670d\u52a1\u5668\u7aef\uff1a</p> <ul> <li>\u9996\u5148 B \u5904\u4e8e LISTEN\uff08\u76d1\u542c\uff09\u72b6\u6001\uff0c\u7b49\u5f85\u5ba2\u6237\u7684\u8fde\u63a5\u8bf7\u6c42\u3002</li> <li>A \u5411 B \u53d1\u9001\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\uff0cSYN=1\uff0c\u5e8f\u53f7\u4e3a x\u3002</li> <li>B \u6536\u5230\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\uff0c\u5982\u679c\u540c\u610f\u5efa\u7acb\u8fde\u63a5\uff0c\u5219\u5411 A \u53d1\u9001\u8fde\u63a5\u786e\u8ba4\u62a5\u6587\uff0cSYN=1\uff0cACK=1\uff0c\u786e\u8ba4\u53f7\u4e3a x+1\uff0c\u5e8f\u53f7\u4e3a y\u3002</li> <li>A \u6536\u5230 B \u7684\u8fde\u63a5\u786e\u8ba4\u62a5\u6587\u540e\uff0c\u8fd8\u8981\u5411 B \u53d1\u51fa\u786e\u8ba4\uff0c\u786e\u8ba4\u53f7\u4e3a y+1\uff0c\u5e8f\u53f7\u4e3a x+1\u3002</li> <li>B \u6536\u5230 A \u7684\u786e\u8ba4\u540e\uff0c\u8fde\u63a5\u5efa\u7acb\u3002</li> </ul> <p>\u4e09\u6b21\u63e1\u624b\u7684\u539f\u56e0</p> <p>\u7b2c\u4e09\u6b21\u63e1\u624b\u662f\u4e3a\u4e86\u9632\u6b62\u5931\u6548\u7684\u8fde\u63a5\u8bf7\u6c42\u5230\u8fbe\u670d\u52a1\u5668\uff0c\u8ba9\u670d\u52a1\u5668\u9519\u8bef\u6253\u5f00\u8fde\u63a5\u3002\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8fde\u63a5\u8bf7\u6c42\u5982\u679c\u5728\u7f51\u7edc\u4e2d\u6ede\u7559\uff0c\u90a3\u4e48\u5c31\u4f1a\u9694\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u624d\u80fd\u6536\u5230\u670d\u52a1\u5668\u7aef\u53d1\u56de\u7684\u8fde\u63a5\u786e\u8ba4\uff0c\u5728\u8fd9\u671f\u95f4\u5ba2\u6237\u7aef\u7b49\u5f85\u4e00\u4e2a\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\u4e4b\u540e\uff0c\u4f1a\u91cd\u65b0\u8bf7\u6c42\u8fde\u63a5\uff0c\u4f46\u662f\u4e4b\u524d\u6ede\u7559\u7684\u8fde\u63a5\u8bf7\u6c42\u6700\u540e\u8fd8\u662f\u4f1a\u5230\u8fbe\u670d\u52a1\u5668\uff0c\u5982\u679c\u4e0d\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u5c31\u4f1a\u6253\u5f00\u4e24\u4e2a\u8fde\u63a5\uff0c\u5982\u679c\u6709\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u5ba2\u6237\u7aef\u4f1a\u5ffd\u7565\u670d\u52a1\u5668\u4e4b\u540e\u53d1\u9001\u7684\u5bf9\u6ede\u7559\u8fde\u63a5\u8bf7\u6c42\u7684\u8fde\u63a5\u786e\u8ba4\uff0c\u4e0d\u8fdb\u884c\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u56e0\u6b64\u5c31\u4e0d\u4f1a\u518d\u6b21\u6253\u5f00\u8fde\u63a5\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#tcp_1","title":"TCP \u7684\u56db\u6b21\u6325\u624b","text":"<p>\u4ee5\u4e0b\u63cf\u8ff0\u4e0d\u8ba8\u8bba\u5e8f\u53f7\u548c\u786e\u8ba4\u53f7\uff0c\u56e0\u4e3a\u5e8f\u53f7\u548c\u786e\u8ba4\u53f7\u7684\u89c4\u5219\u6bd4\u8f83\u7b80\u5355\u3002\u5e76\u4e14\u4e0d\u8ba8\u8bba ACK\uff0c\u56e0\u4e3a ACK \u5728\u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\u90fd\u4e3a 1\u3002</p> <ul> <li>A \u53d1\u9001\u8fde\u63a5\u91ca\u653e\u62a5\u6587\uff0cFIN=1\u3002</li> <li>B \u6536\u5230\u4e4b\u540e\u53d1\u51fa\u786e\u8ba4\uff0c\u6b64\u65f6 TCP \u5c5e\u4e8e\u534a\u5173\u95ed\u72b6\u6001\uff0cB \u80fd\u5411 A \u53d1\u9001\u6570\u636e\uff0c\u4f46\u662f A \u4e0d\u80fd\u5411 B \u53d1\u9001\u6570\u636e\u3002</li> <li>\u5f53 B \u4e0d\u518d\u9700\u8981\u8fde\u63a5\u65f6\uff0c\u53d1\u9001\u8fde\u63a5\u91ca\u653e\u62a5\u6587\uff0cFIN=1\u3002</li> <li>A \u6536\u5230\u540e\u53d1\u51fa\u786e\u8ba4\uff0c\u8fdb\u5165 TIME-WAIT \u72b6\u6001\uff0c\u7b49\u5f85 2 MSL\uff08\u6700\u5927\u62a5\u6587\u5b58\u6d3b\u65f6\u95f4\uff09\u540e\u91ca\u653e\u8fde\u63a5\u3002</li> <li>B \u6536\u5230 A \u7684\u786e\u8ba4\u540e\u91ca\u653e\u8fde\u63a5\u3002</li> </ul> <p>\u56db\u6b21\u6325\u624b\u7684\u539f\u56e0</p> <p>\u4e3b\u8981\u5c31\u662f\u4e3a\u4ec0\u4e48\u8981\u6709\u4e24\u4e2a\u7b49\u5f85\u65f6\u95f4\uff1a\u670d\u52a1\u5668\u7684 CLOSE-WAIT \u548c \u5ba2\u6237\u7aef\u7684 TIME-WAIT\u3002</p> <p>CLOSE-WAIT</p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u4e86 FIN \u8fde\u63a5\u91ca\u653e\u62a5\u6587\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u6536\u5230\u4e86\u8fd9\u4e2a\u62a5\u6587\uff0c\u5c31\u8fdb\u5165\u4e86 CLOSE-WAIT \u72b6\u6001\u3002\u8fd9\u4e2a\u72b6\u6001\u662f\u4e3a\u4e86\u8ba9\u670d\u52a1\u5668\u7aef\u53d1\u9001\u8fd8\u672a\u4f20\u9001\u5b8c\u6bd5\u7684\u6570\u636e\uff0c\u4f20\u9001\u5b8c\u6bd5\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u4f1a\u53d1\u9001 FIN \u8fde\u63a5\u91ca\u653e\u62a5\u6587\u3002</p> <p>TIME_WAIT</p> <p>\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u670d\u52a1\u5668\u7aef\u7684 FIN \u62a5\u6587\u540e\u8fdb\u5165\u6b64\u72b6\u6001\uff0c\u6b64\u65f6\u5e76\u4e0d\u662f\u76f4\u63a5\u8fdb\u5165 CLOSED \u72b6\u6001\uff0c\u8fd8\u9700\u8981\u7b49\u5f85\u4e00\u4e2a\u65f6\u95f4\u8ba1\u65f6\u5668\u8bbe\u7f6e\u7684\u65f6\u95f4 2MSL\u3002\u8fd9\u4e48\u505a\u6709\u4e24\u4e2a\u7406\u7531\uff1a</p> <ul> <li>\u786e\u4fdd\u6700\u540e\u4e00\u4e2a\u786e\u8ba4\u62a5\u6587\u80fd\u591f\u5230\u8fbe\u3002\u5982\u679c B \u6ca1\u6536\u5230 A \u53d1\u9001\u6765\u7684\u786e\u8ba4\u62a5\u6587\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u65b0\u53d1\u9001\u8fde\u63a5\u91ca\u653e\u8bf7\u6c42\u62a5\u6587\uff0cA \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u5c31\u662f\u4e3a\u4e86\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\u3002</li> <li>\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u662f\u4e3a\u4e86\u8ba9\u672c\u8fde\u63a5\u6301\u7eed\u65f6\u95f4\u5185\u6240\u4ea7\u751f\u7684\u6240\u6709\u62a5\u6587\u90fd\u4ece\u7f51\u7edc\u4e2d\u6d88\u5931\uff0c\u4f7f\u5f97\u4e0b\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\u4e0d\u4f1a\u51fa\u73b0\u65e7\u7684\u8fde\u63a5\u8bf7\u6c42\u62a5\u6587\u3002</li> </ul>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_1","title":"\u5982\u4f55\u89e3\u51b3\u7c98\u5305\u95ee\u9898\uff1f","text":"<p>\u56e0\u4e3aTCP\u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u534f\u8bae\uff0c\u5b83\u5e76\u4e0d\u533a\u5206\u5e94\u7528\u5c42\u4ea4\u4ed8\u7684\u6570\u636e\u5305\u7684\u8fb9\u754c\uff0c\u6240\u4ee5tcp\u534f\u8bae\u5f88\u6709\u53ef\u80fd\u5c06\u4f60\u591a\u6b21\u901a\u8fc7send\u51fd\u6570\u53d1\u9001\u7684\u6570\u636e\u5305\u653e\u5728\u4e00\u4e2atcp\u62a5\u6587\u91cc\u9762\u53d1\u9001\uff0c\u4e5f\u6709\u53ef\u80fd\u5c06\u5e94\u7528\u5c42\u7684\u4e00\u4e2a\u6570\u636e\u5305\u5212\u5206\u6210\u591a\u6b21\u53d1\u9001\uff0c\u7136\u540e\u4f20\u9001\u5230\u63a5\u6536\u65b9\uff0c\u63a5\u6536\u65b9tcp\u540c\u6837\u4e0d\u533a\u5206\u6570\u636e\u7684\u8fb9\u754c\uff0c\u4e5f\u6709\u53ef\u80fd\u7f13\u51b2\u591a\u4e2atcp\u62a5\u6587\u7684\u5185\u5bb9\u7136\u540e\u518d\u4ea4\u4ed8\u7ed9\u5e94\u7528\u5c42\uff0c\u7efc\u5408\u8fd9\u4e24\u65b9\u9762\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u7c98\u5305\u95ee\u9898\u3002\u5f52\u7ed3\u4e3a\u4e00\u70b9\u5c31\u662f\uff0ctcp\u4e0d\u662f\u9762\u5411\u62a5\u6587\u7684\u534f\u8bae\uff0c\u5b83\u5e76\u4e0d\u7ba1\u5e94\u7528\u5c42\u4ea4\u4ed8\u6570\u636e\u7684\u8fb9\u754c\uff0c\u53ea\u662f\u6309\u7167\u81ea\u5df1\u7684\u7b97\u6cd5\u8fdb\u884c\u53d1\u9001\uff0c\u4fdd\u8bc1\u4e0d\u4e22\u5931\u6570\u636e\u5e76\u4e14\u5b57\u8282\u7684\u987a\u5e8f\u4e0d\u53d8\u3002</p> <p>\u89e3\u51b3\u7c98\u5305\u7684\u95ee\u9898\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\u5c31\u662f\u5728\u5e94\u7528\u5c42\u7ed9\u6570\u636e\u52a0\u4e2a\u5934\u8bf4\u660e\u4e00\u4e2a\u6570\u636e\u5305\u7684\u957f\u5ea6\uff0c\u5982\u679c\u4e00\u6b21\u63a5\u6536\u7684\u957f\u5ea6\u5c0f\u4e8e\u62a5\u5934\u4e2d\u7684\u89c4\u5b9a\u7684\u957f\u5ea6\uff0c\u90a3\u4e48\u5c31\u5c06\u6570\u636e\u653e\u5728\u7f13\u51b2\u533a\u7b49\u4e00\u4e0b\uff0c\u5982\u679c\u5927\u4e8e\u5c31\u628a\u591a\u51fa\u6765\u7684\u6570\u636e\u653e\u5728\u7f13\u51b2\u533a\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u65b9\u6cd5\u5c31\u662f\u7ed9\u6570\u636e\u52a0\u4e00\u4e2a\u8fb9\u754c\uff0c\u6bd4\u5982\\r\\n\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u8981\u5904\u7406\u6570\u636e\u4e2d\u4e5f\u6709\\r\\n\u7684\u60c5\u51b5\u3002</p> <p>\u5bf9\u4e8eudp\u534f\u8bae\u6ca1\u6709\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u56e0\u4e3audp\u662f\u9762\u5411\u62a5\u6587\u7684\u534f\u8bae\uff0c\u53d1\u9001\u65b9\u5e94\u7528\u5c42\u7ed9\u4f60\u591a\u5927\u7684\u5305\uff0cudp\u5c31\u53d1\u591a\u5927\u7684\u5305\uff0c\u63a5\u6536\u65b9udp\u4e5f\u662f\u4e00\u6b21\u6536\u5230\u6574\u4e2a\u6570\u636e\u5305\u540e\u5411\u5e94\u7528\u5c42\u4ea4\u4ed8\u3002</p> <p>\u4e0d\u7528\u8003\u8651\u7f51\u7edc\u5c42\uff0c\u56e0\u4e3aip\u534f\u8bae\u5b8c\u5168\u5bf9\u4e0a\u5c42\u900f\u660e\uff0c\u5373\u4f7fip\u5c42\u53d1\u9001\u65b9\u5206\u5305\u4e86\uff0c\u5728\u63a5\u6536\u65b9ip\u5c42\u4e5f\u4f1a\u628a\u8fd9\u4e00\u4e2a\u5305\u7ec4\u88c5\u597d\u4e4b\u540e\u518d\u5411\u4f20\u8f93\u5c42\u4ea4\u4ed8\uff0c\u6240\u4ee5\u5c31\u662f\u4f20\u8f93\u5c42\u53d1\u9001\u65b9\u53d1\u9001\u591a\u5927\u7684\u5305\uff0c\u4f20\u8f93\u5c42\u63a5\u6536\u65b9\u5c31\u80fd\u6536\u5230\u591a\u5927\u7684\u5305\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#https","title":"HTTPS\u7684\u52a0\u5bc6\u8fc7\u7a0b\uff1f","text":"<p>1.\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42</p> <p>2.\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u6570\u5b57\u8bc1\u4e66\uff08\u6570\u5b57\u8bc1\u4e66\u91cc\u9762\u6709\u670d\u52a1\u5668\u7f51\u7ad9\u7684\u4fe1\u606f \u548c \u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u516c\u94a5\uff09</p> <p>3.\u5ba2\u6237\u7aef\u9a8c\u8bc1\u6570\u5b57\u8bc1\u4e66\u7684\u5408\u6cd5\u6027</p> <p>4.\u5ba2\u6237\u7aef\u5229\u7528\u516c\u94a5\u52a0\u5bc6 \u5bf9\u79f0\u52a0\u5bc6\u7684\u5bc6\u94a5 \u53d1\u9001\u7ed9\u670d\u52a1\u5668</p> <p>5.\u63a5\u4e0b\u6765\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u7528\u5bf9\u79f0\u52a0\u5bc6\u7684\u5bc6\u94a5\u52a0\u5bc6\u6570\u636e\u8fdb\u884c\u901a\u4fe1</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_2","title":"\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u4e00\u5f00\u59cb\u5c31\u7528\u5bf9\u79f0\u52a0\u5bc6\uff1f","text":"<p>\u56e0\u4e3a\u670d\u52a1\u5668\u76f4\u63a5\u5c06\u5bf9\u79f0\u52a0\u5bc6\u7684\u5bc6\u94a5\u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e2d\u95f4\u53ef\u80fd\u88ab\u622a\u83b7\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_3","title":"\u4e3a\u4ec0\u4e48\u4e0d\u670d\u52a1\u5668\u7528\u5ba2\u6237\u7aef\u7684\u516c\u94a5\uff0c\u5ba2\u6237\u7aef\u7528\u670d\u52a1\u5668\u7684\u516c\u94a5\uff1f","text":"<p>\u56e0\u4e3a\u516c\u94a5\u52a0\u5bc6\u7b97\u6cd5\u6bd4\u5bf9\u79f0\u52a0\u5bc6\u66f4\u52a0\u590d\u6742\uff0c\u8ba1\u7b97\u975e\u5e38\u8017\u65f6\uff0c\u6240\u4ee5\u53ea\u80fd\u8ba9\u5ba2\u6237\u7aef\u7528\u516c\u94a5\u52a0\u5bc6\u7b97\u6cd5\u4f20\u9012\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u7136\u540e\u7b97\u7136\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u52a0\u5bc6\u6570\u636e\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_4","title":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u6570\u5b57\u8bc1\u4e66\uff1f","text":"<p>\u56e0\u4e3a\u5728\u670d\u52a1\u5668\u5728\u5411\u5ba2\u6237\u7aef\u4f20\u9012\u516c\u94a5\u7684\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u88ab\u72f8\u732b\u6362\u592a\u5b50\uff0c\u610f\u601d\u662f\u4e2d\u95f4\u4eba\u867d\u7136\u622a\u83b7\u8fd9\u4e2a\u62a5\u6587\u4e2d\u6ca1\u7528\uff0c\u4f46\u662f\u53ef\u4ee5\u62e6\u622a\u8fd9\u4e2a\u62a5\u6587\u7136\u540e\u6362\u6210\u81ea\u5df1\u7684\u516c\u94a5\uff0c\u8fd9\u8981\u5c31\u53ef\u4ee5\u9a97\u8fc7\u5ba2\u6237\u7aef\uff0c\u7136\u540e\u62ff\u5230\u5ba2\u6237\u7aef\u51c6\u5907\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u4e8e\u662f\u4ee5\u540e\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5185\u5bb9\u5c31\u90fd\u6cc4\u9732\u4e86\u3002\u4f7f\u7528\u6570\u5b57\u8bc1\u4e66\u5c31\u53ef\u4ee5\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\u4e86\uff0c\u6570\u5b57\u8bc1\u4e66\u4e2d\u5305\u542b\u8fd9\u4e2a\u670d\u52a1\u5668\u7684\u516c\u94a5\u4fe1\u606f\u548c\u7f51\u7ad9\u7684\u5176\u5b83\u4fe1\u606f\uff0c\u5e76\u4e14\u6570\u5b57\u8bc1\u4e66\u7684\u6570\u5b57\u7b7e\u540d\u4f7f\u7528CA\u673a\u6784\u7684\u79c1\u94a5\u52a0\u5bc6\uff0c\u8fd9\u6837\u5373\u4f7f\u4e2d\u95f4\u4eba\u53ef\u4ee5\u6539\u53d8\u6570\u5b57\u8bc1\u4e66\u7684\u5185\u5bb9\u548c\u6570\u5b57\u7b7e\u540d\uff0c\u4f46\u4e5f\u65e0\u6cd5\u52a0\u5bc6\u6570\u5b57\u7b7e\u540d\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u6700\u540e\u4f1a\u4f7f\u7528CA\u7684\u516c\u94a5\u89e3\u5bc6\u6570\u5b57\u7b7e\u540d\u3002</p> <p>\u6570\u5b57\u7b7e\u540d\uff1a</p> <p></p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#url","title":"\u4e3a\u4ec0\u4e48\u8981\u8fdb\u884cURL\u7f16\u7801\uff1f","text":"<p>\u56e0\u4e3aURL\u4e2d\u7684\u6709\u7279\u6b8a\u542b\u4e49\u7684\u5b57\u7b26\u5982&amp; = ? \u4e0d\u80fd\u76f4\u63a5\u4f5c\u4e3a\u503c\u51fa\u73b0\u5728URL\uff0c\u5982\u679c\u8981\u51fa\u73b0\u5728\u503c\u4e2d\uff0c\u5c31\u5fc5\u987b\u5bf9\u5b83\u4eec\u8fdb\u884c\u8f6c\u4e49\uff0cURL\u7f16\u7801\u5c31\u662f\u7528\u6765\u8f6c\u4e49\u7684\uff0cRFC\u89c4\u5b9a\uff0cURL\u4e2d\u53ea\u6709ASCII\u7801\u7684\u975e\u4fdd\u7559\u5b57\uff08\u5982a b c\u7b49\uff09\u624d\u80fd\u539f\u6837\u4fdd\u7559\uff0c\u5bf9\u4e8eASCII\u7801\u7684\u5176\u5b83\u4fdd\u7559\u5b57\uff08\u5982 \uff01 * \u2019 ( ) ; : @ &amp; = + $ , / ? # [ ] \uff09\u91c7\u7528%\u52a0ASCII\u7801\u503c\u7684\u5f62\u5f0f\u8fdb\u884c\u7f16\u7801\uff0c\u6bd4\u5982&amp;\u7684ASCII\u7801\u503c\u662f26\uff0c\u90a3\u4e48\u5c31\u7528<code>\uff0526</code>\u8868\u793a\uff08\u4e00\u4e2a\u5b57\u7b26\u53d8\u6210\u4e863\u4e2a\u5b57\u7b26\uff09\uff0c\u5176\u5b83\u975eASCII\u7801\u7684\u5b57\u7b26\u91c7\u7528\u540c\u6837\u7684\u65b9\u5f0f\u8fdb\u884c\u7f16\u7801\uff0c\u53ea\u4e0d\u662f\u540e\u9762\u7684\u6570\u503c\u662f\u5bf9\u5e94\u7f16\u7801\u7684\u503c\uff0c\u6bd4\u5982\u201d\u4e2d\u6587\u201d\u4f7f\u7528UTF-8\u7f16\u7801\u5f97\u5230\u7684\u5b57\u8282\u662f<code>0xE4 0xB8 0xAD 0xE6 0x96 0x87</code>\uff0c\u7ecf\u8fc7URL\u7f16\u7801\u4e4b\u540e\u5f97\u5230<code>%E4%B8%AD%E6%96%87</code>\u3002</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#dns","title":"DNS\uff1f","text":"<p>DNS\uff08domain name system\uff09\u57df\u540d\u7cfb\u7edf\uff0c\u89e3\u6790\u6d41\u7a0b\u662f\uff1a</p> <ol> <li> <p>\u67e5\u6d4f\u89c8\u5668\u7684DNS\u7f13\u5b58\uff08\u5982\u679c\u662f\u4ece\u6d4f\u89c8\u5668\u51fa\u53d1\uff09\u3002</p> </li> <li> <p>\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u7cfb\u7edf\u8c03\u7528\u67e5DNS\uff08Linux\u7684\u7cfb\u7edf\u8c03\u7528\u662fgethostbyname\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9996\u5148\u662f\u67e5\u672c\u5730hosts\u6587\u4ef6\u3002</p> </li> <li> <p>\u7136\u540e\u9012\u5f52\u67e5\u8be2\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u3002</p> </li> <li> <p>\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u8fed\u4ee3\u67e5\u8be2\u57df\u540d\u7cfb\u7edf\uff0c\u9996\u5148\u662f\u67e5\u6839\u57df\u540d\u670d\u52a1\u5668\uff0c\u518d\u67e5\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\uff0c\u6700\u540e\u67e5\u6743\u9650\u57df\u540d\u670d\u52a1\u5668\u3002\uff08\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u4e0d\u5c5e\u4e8e\u57df\u540d\u7cfb\u7edf\uff0c\u5b83\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\u5668\uff09</p> </li> <li> <p>\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u89e3\u6790\u5230\u7684ip\u5730\u5740\uff0c\u6b64\u81f4\u6d4f\u89c8\u5668\u5c31\u62ff\u5230\u4e86\u5bf9\u5e94\u7f51\u7ad9\u7684ip\u3002</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#url_1","title":"\u6d4f\u89c8\u5668\u8f93\u5165URL\u5230\u8fd4\u56de\u9875\u9762\u7684\u5168\u8fc7\u7a0b\uff1f","text":"<ol> <li> <p>\u8fdb\u884c\u57df\u540d\u89e3\u6790\uff08DNS\uff09\u62ff\u5230\u7f51\u7ad9\u7684ip\u5730\u5740</p> </li> <li> <p>\u53d1\u9001http\u8bf7\u6c42\uff0chttp\u8bf7\u6c42\u662f\u5efa\u7acb\u5728tcp\u534f\u8bae\u4e4b\u4e0a\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u6240\u4ee5\u53d1\u9001http\u8bf7\u6c42\u4e4b\u524d\u4f1a\u5148\u8fdb\u884c\u5efa\u7acbtcp\u8fde\u63a5</p> </li> <li> <p>\u670d\u52a1\u5668\u54cd\u5e94\uff0c\u8fd4\u56de\u9875\u9762</p> </li> <li> <p>\u6d4f\u89c8\u5668\u63a5\u6536\u5230\u9875\u9762\u540e\u6e32\u67d3\uff0c\u9875\u9762\u4e2d\u8fd8\u6709\u4e00\u4e9b\u56fe\u7247\u7b49\u5185\u5bb9\uff0c\u6d4f\u89c8\u5668\u4f1a\u63a5\u7740\u53bb\u8bf7\u6c42\u56fe\u7247\uff0c\u8fd8\u6709\u5c31\u662f\u5728\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\uff0c\u6709\u5f88\u591aAjax\u5f02\u6b65\u8bf7\u6c42\uff0c\u6d4f\u89c8\u5668\u8fd8\u9700\u8981\u5411\u670d\u52a1\u5668\u8bf7\u6c42\u6570\u636e</p> </li> <li> <p>\u65ad\u5f00tcp\u8fde\u63a5</p> </li> </ol>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_5","title":"\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5 \u548c \u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u6709\u54ea\u4e9b\uff1f","text":"<p>\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff1aDES\u30013DES\u3001AES</p> <p>\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff1aRSA\u3001ECC</p> <p>\u6563\u5217\u7b97\u6cd5\uff1aMD5\u3001SHA-1</p>"},{"location":"%E9%97%AE%E7%AD%94/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#tcp_2","title":"\u4e3a\u4ec0\u4e48\u4f1a\u4e22\u5305\uff1f\u4f7f\u7528TCP\u534f\u8bae\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5305\uff1f","text":"<p>4.21 \u7528\u4e86 TCP \u534f\u8bae\uff0c\u6570\u636e\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5417\uff1f | \u5c0f\u6797coding (xiaolincoding.com)</p>"}]}