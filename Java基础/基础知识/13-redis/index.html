<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=江岳亮的博客><meta name=author content=Jmoon><link href=../12-nginx/ rel=prev><link href=../14-Stream%20%E5%92%8C%20Optional/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.10"><title>13-redis - Jmoon's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Source Code Pro"}</style><link rel=stylesheet href=/assets/stylesheets/font.css><link rel=stylesheet href=/assets/stylesheets/custom.css><link rel=stylesheet href=https://unpkg.com/katex@0/dist/katex.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=light> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#redis class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Jmoon's Blog" class="md-header__button md-logo" aria-label="Jmoon's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Jmoon's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 13-redis </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=light aria-label=切换到浅色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换到浅色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=dark aria-label=切换到黑暗模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换到黑暗模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../1-IO/ class=md-tabs__link> Java基础 </a> </li> <li class=md-tabs__item> <a href=../../../Web%E5%BC%80%E5%8F%91/MyBatis/1.MyBatis%E5%85%A5%E9%97%A8-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/ class=md-tabs__link> Web开发 </a> </li> <li class=md-tabs__item> <a href=../../../%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/0-Flink%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/ class=md-tabs__link> 大数据开发 </a> </li> <li class=md-tabs__item> <a href=../../../%E9%97%AE%E7%AD%94/Flink/ class=md-tabs__link> 问答 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Jmoon's Blog" class="md-nav__button md-logo" aria-label="Jmoon's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Jmoon's Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Java基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Java基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1 checked> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 基础知识 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../1-IO/ class=md-nav__link> <span class=md-ellipsis> 1-IO </span> </a> </li> <li class=md-nav__item> <a href=../2-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%20%E5%92%8C%20%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 2-进程与线程 和 进程间的通信方式 </span> </a> </li> <li class=md-nav__item> <a href=../3-BIO%E4%B9%8B%E7%BD%91%E7%BB%9CIO/ class=md-nav__link> <span class=md-ellipsis> 3-BIO之网络IO </span> </a> </li> <li class=md-nav__item> <a href=../4-NIO%E4%B9%8B%E7%BC%93%E5%86%B2%E5%8C%BA%E5%92%8C%E9%80%9A%E9%81%93/ class=md-nav__link> <span class=md-ellipsis> 4-NIO之缓冲区和通道 </span> </a> </li> <li class=md-nav__item> <a href=../5-NIO%E4%B9%8B%E9%80%89%E6%8B%A9%E5%99%A8%E4%B8%8EIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/ class=md-nav__link> <span class=md-ellipsis> 5-NIO之选择器与IO多路复用 </span> </a> </li> <li class=md-nav__item> <a href=../6-NIO%E4%B9%8B%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B-%E7%BE%A4%E8%81%8A%E7%B3%BB%E7%BB%9F/ class=md-nav__link> <span class=md-ellipsis> 6-NIO之网络编程应用实例-群聊系统 </span> </a> </li> <li class=md-nav__item> <a href=../7-ArrayList%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> 7-ArrayList源码笔记 </span> </a> </li> <li class=md-nav__item> <a href=../8-HashMap%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> 8-HashMap源码笔记 </span> </a> </li> <li class=md-nav__item> <a href=../9-docker/ class=md-nav__link> <span class=md-ellipsis> 9-docker </span> </a> </li> <li class=md-nav__item> <a href=../10-git/ class=md-nav__link> <span class=md-ellipsis> 10-git </span> </a> </li> <li class=md-nav__item> <a href=../11-maven/ class=md-nav__link> <span class=md-ellipsis> 11-maven </span> </a> </li> <li class=md-nav__item> <a href=../12-nginx/ class=md-nav__link> <span class=md-ellipsis> 12-nginx </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 13-redis </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 13-redis </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#redis class=md-nav__link> <span class=md-ellipsis> redis服务器启动命令 </span> </a> </li> <li class=md-nav__item> <a href=#redis_1 class=md-nav__link> <span class=md-ellipsis> redis客户端连接命令 </span> </a> </li> <li class=md-nav__item> <a href=#redis_2 class=md-nav__link> <span class=md-ellipsis> redis容器 </span> </a> </li> <li class=md-nav__item> <a href=#redis_3 class=md-nav__link> <span class=md-ellipsis> redis配置文件 </span> </a> </li> <li class=md-nav__item> <a href=#redis_4 class=md-nav__link> <span class=md-ellipsis> redis常用命令 </span> </a> </li> <li class=md-nav__item> <a href=#string class=md-nav__link> <span class=md-ellipsis> 字符串 (string) 常用操作 </span> </a> </li> <li class=md-nav__item> <a href=#list class=md-nav__link> <span class=md-ellipsis> 列表 (list) 常用操作 </span> </a> </li> <li class=md-nav__item> <a href=#set class=md-nav__link> <span class=md-ellipsis> 集合 (set) 常用操作 </span> </a> </li> <li class=md-nav__item> <a href=#hash class=md-nav__link> <span class=md-ellipsis> 哈希 (hash) 常用操作 </span> </a> </li> <li class=md-nav__item> <a href=#zset class=md-nav__link> <span class=md-ellipsis> 有序集合 (zset) 常用操作 </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 发布和订阅 </span> </a> </li> <li class=md-nav__item> <a href=#bitmaps class=md-nav__link> <span class=md-ellipsis> Bitmaps </span> </a> </li> <li class=md-nav__item> <a href=#hyperloglog class=md-nav__link> <span class=md-ellipsis> HyperLogLog </span> </a> </li> <li class=md-nav__item> <a href=#redis_5 class=md-nav__link> <span class=md-ellipsis> redis事务 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 主从复制 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 集群 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../14-Stream%20%E5%92%8C%20Optional/ class=md-nav__link> <span class=md-ellipsis> 14-Stream 和 Optional </span> </a> </li> <li class=md-nav__item> <a href=../IO/ class=md-nav__link> <span class=md-ellipsis> IO </span> </a> </li> <li class=md-nav__item> <a href=../Lambda/ class=md-nav__link> <span class=md-ellipsis> Lambda </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../Linux/1-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/01-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/ class=md-nav__link> <span class=md-ellipsis> 并发编程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../Web%E5%BC%80%E5%8F%91/MyBatis/1.MyBatis%E5%85%A5%E9%97%A8-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/ class=md-nav__link> <span class=md-ellipsis> Web开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Flink/0-Flink%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/ class=md-nav__link> <span class=md-ellipsis> 大数据开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../%E9%97%AE%E7%AD%94/Flink/ class=md-nav__link> <span class=md-ellipsis> 问答 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>13-redis</h1> <h4 id=redis><strong>redis服务器启动命令</strong><a class=headerlink href=#redis title="Permanent link">#</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><a href=#__codelineno-0-1><span class=linenos data-linenos="1 "></span></a>以默认配置启动：redis-server
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><a href=#__codelineno-0-2><span class=linenos data-linenos="2 "></span></a>指定配置文件启动：redis-server /path/to/redis.conf
</span></code></pre></div> <h4 id=redis_1><strong>redis客户端连接命令</strong><a class=headerlink href=#redis_1 title="Permanent link">#</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1></a><a href=#__codelineno-1-1><span class=linenos data-linenos="1 "></span></a>redis-cli -h &lt;ip&gt; -p &lt;port&gt; 省略-h参数默认连接127.0.0.1，省略-p参数默认6379端口
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2></a><a href=#__codelineno-1-2><span class=linenos data-linenos="2 "></span></a>也可以只执行一条命令而不进入客户端：redis-cli &lt;命令&gt;，如:
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3></a><a href=#__codelineno-1-3><span class=linenos data-linenos="3 "></span></a>查看redis服务器信息：redis-cl info server
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4></a><a href=#__codelineno-1-4><span class=linenos data-linenos="4 "></span></a>关闭redis服务器信息：redis-cl shutdown
</span></code></pre></div> <h4 id=redis_2><strong>redis容器</strong><a class=headerlink href=#redis_2 title="Permanent link">#</a></h4> <p>redis的docker容器没有默认的配置文件，所以需要在redis的官方github仓库下载redis.conf，然后再编辑，在启动redis服务器容器时挂载，注意，挂载文件需要修改文件的权限为777，容器才能同步文件的修改。</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a><a href=#__codelineno-2-1><span class=linenos data-linenos="1 "></span></a>docker run -d -v /root/redis/redis.conf:/data/redis.conf -v /root/redis/data:/data -p 6379:6379 --name myredis redis redis-server /usr/local/etc/redis/redis.conf
</span></code></pre></div> <h4 id=redis_3><strong>redis配置文件</strong><a class=headerlink href=#redis_3 title="Permanent link">#</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1></a><a href=#__codelineno-3-1><span class=linenos data-linenos=" 1 "></span></a>################################ 常规配置 ################################
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2></a><a href=#__codelineno-3-2><span class=linenos data-linenos=" 2 "></span></a>#后台启动redis
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3></a><a href=#__codelineno-3-3><span class=linenos data-linenos=" 3 "></span></a>daemonize yes
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4></a><a href=#__codelineno-3-4><span class=linenos data-linenos=" 4 "></span></a>#绑定到本机的某个网络接口上，127.0.0.1是ipv4的环回接口，::1是ipv6的环回接口，-表示当redis检测到本机网络接口并没有该ip地址时启动不会失败，注释掉bind，redis会默认绑定本机所有的网络接口
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5></a><a href=#__codelineno-3-5><span class=linenos data-linenos=" 5 "></span></a>#bind 127.0.0.1 -::1
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6></a><a href=#__codelineno-3-6><span class=linenos data-linenos=" 6 "></span></a>#设置端口
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7></a><a href=#__codelineno-3-7><span class=linenos data-linenos=" 7 "></span></a>port 6379
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8></a><a href=#__codelineno-3-8><span class=linenos data-linenos=" 8 "></span></a>#设置客户端无操作的超时时间
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9></a><a href=#__codelineno-3-9><span class=linenos data-linenos=" 9 "></span></a>timeout 0
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10></a><a href=#__codelineno-3-10><span class=linenos data-linenos="10 "></span></a>#每300s检测一次客户端的心跳
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11></a><a href=#__codelineno-3-11><span class=linenos data-linenos="11 "></span></a>tcp-keepalive 300
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12></a><a href=#__codelineno-3-12><span class=linenos data-linenos="12 "></span></a>#设置redis的数据库个数
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13></a><a href=#__codelineno-3-13><span class=linenos data-linenos="13 "></span></a>databases 16
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14></a><a href=#__codelineno-3-14><span class=linenos data-linenos="14 "></span></a>#设置密码
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15></a><a href=#__codelineno-3-15><span class=linenos data-linenos="15 "></span></a>#requirepass foobared
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16></a><a href=#__codelineno-3-16><span class=linenos data-linenos="16 "></span></a>#开启保护模式会使得只能通过本机环回接口连接redis
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17></a><a href=#__codelineno-3-17><span class=linenos data-linenos="17 "></span></a>protected-mode no
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18></a><a href=#__codelineno-3-18><span class=linenos data-linenos="18 "></span></a>#在指定日志文件的名称，若为空串则打印到标准输出上，若为空串且是以守护进程的方式启动，则将日志输出到/dev/null
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19></a><a href=#__codelineno-3-19><span class=linenos data-linenos="19 "></span></a>logfile &quot;&quot;
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20></a><a href=#__codelineno-3-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21></a><a href=#__codelineno-3-21><span class=linenos data-linenos="21 "></span></a>################################ SNAPSHOTTING RDB持久化配置 ################################
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22></a><a href=#__codelineno-3-22><span class=linenos data-linenos="22 "></span></a>#关闭RDB持久化
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23></a><a href=#__codelineno-3-23><span class=linenos data-linenos="23 "></span></a># save &quot;&quot;
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24></a><a href=#__codelineno-3-24><span class=linenos data-linenos="24 "></span></a>&lt;div markdown=&quot;1&quot; style=&quot;margin-top: -30px; font-size: 0.75em; opacity: 0.7;&quot;&gt;
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25></a><a href=#__codelineno-3-25><span class=linenos data-linenos="25 "></span></a>:material-circle-edit-outline: 约 5325 个字 :material-clock-time-two-outline: 预计阅读时间 106 分钟
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26></a><a href=#__codelineno-3-26><span class=linenos data-linenos="26 "></span></a>&lt;/div&gt;
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27></a><a href=#__codelineno-3-27><span class=linenos data-linenos="27 "></span></a>#rdb持久化的文件名，默认dump.rdb
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28></a><a href=#__codelineno-3-28><span class=linenos data-linenos="28 "></span></a>dbfilename dump.rdb
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29></a><a href=#__codelineno-3-29><span class=linenos data-linenos="29 "></span></a>#文件保存的位置
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30></a><a href=#__codelineno-3-30><span class=linenos data-linenos="30 "></span></a>dir /data
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31></a><a href=#__codelineno-3-31><span class=linenos data-linenos="31 "></span></a>#保存策略
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32></a><a href=#__codelineno-3-32><span class=linenos data-linenos="32 "></span></a>save 3600 1
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33></a><a href=#__codelineno-3-33><span class=linenos data-linenos="33 "></span></a>save 300 100
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34></a><a href=#__codelineno-3-34><span class=linenos data-linenos="34 "></span></a>save 60 10000
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35></a><a href=#__codelineno-3-35><span class=linenos data-linenos="35 "></span></a>#bgsave出错时停止写
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36></a><a href=#__codelineno-3-36><span class=linenos data-linenos="36 "></span></a>stop-writes-on-bgsave-error yes
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37></a><a href=#__codelineno-3-37><span class=linenos data-linenos="37 "></span></a>#开启压缩存储
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38></a><a href=#__codelineno-3-38><span class=linenos data-linenos="38 "></span></a>rdbcompression yes
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39></a><a href=#__codelineno-3-39><span class=linenos data-linenos="39 "></span></a>#存储时生成校验和，恢复时检查校验和
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40></a><a href=#__codelineno-3-40><span class=linenos data-linenos="40 "></span></a>rdbchecksum yes
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41></a><a href=#__codelineno-3-41><span class=linenos data-linenos="41 "></span></a>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42></a><a href=#__codelineno-3-42><span class=linenos data-linenos="42 "></span></a>################################ APPEND ONLY MODE AOF持久化配置 ################################
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43></a><a href=#__codelineno-3-43><span class=linenos data-linenos="43 "></span></a>#开启AOF，AOF和RDB同时开启，系统默认取AOF的数据
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44></a><a href=#__codelineno-3-44><span class=linenos data-linenos="44 "></span></a>appendonly yes
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45></a><a href=#__codelineno-3-45><span class=linenos data-linenos="45 "></span></a>#AOF文件名，默认appendonly.aof，且与dump.rdb放在同一目录下
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46></a><a href=#__codelineno-3-46><span class=linenos data-linenos="46 "></span></a>appendfilename &quot;appendonly.aof&quot;
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47></a><a href=#__codelineno-3-47><span class=linenos data-linenos="47 "></span></a>#AOF同步频率
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48></a><a href=#__codelineno-3-48><span class=linenos data-linenos="48 "></span></a>#始终同步，每次Redis的写入都会立刻记入日志；性能较差但数据完整性比较好
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49></a><a href=#__codelineno-3-49><span class=linenos data-linenos="49 "></span></a># appendfsync always
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50></a><a href=#__codelineno-3-50><span class=linenos data-linenos="50 "></span></a>#每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51></a><a href=#__codelineno-3-51><span class=linenos data-linenos="51 "></span></a>appendfsync everysec
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52></a><a href=#__codelineno-3-52><span class=linenos data-linenos="52 "></span></a>#redis不主动进行同步，把同步时机交给操作系统
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53></a><a href=#__codelineno-3-53><span class=linenos data-linenos="53 "></span></a># appendfsync no
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54></a><a href=#__codelineno-3-54><span class=linenos data-linenos="54 "></span></a># 不是很清楚这个配置的含义，大致意思是有子线程在bgsave或者bgrewriteaof时不进行文件AOF文件同步。官方建议为no，即要进行文件同步，不会丢失数据，但会造成阻塞；设置为yes表示不进行文件同步，而是写进缓冲区，待子线程下次保存时再同步AOF文件，也就是可能会数据丢失。
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55></a><a href=#__codelineno-3-55><span class=linenos data-linenos="55 "></span></a>no-appendfsync-on-rewrite no
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56></a><a href=#__codelineno-3-56><span class=linenos data-linenos="56 "></span></a>#重写触发的时机
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57></a><a href=#__codelineno-3-57><span class=linenos data-linenos="57 "></span></a>auto-aof-rewrite-percentage 100
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58></a><a href=#__codelineno-3-58><span class=linenos data-linenos="58 "></span></a>auto-aof-rewrite-min-size 64mb
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59></a><a href=#__codelineno-3-59><span class=linenos data-linenos="59 "></span></a>#忽略AOF文件结尾不完整的情况继续加载恢复数据
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60></a><a href=#__codelineno-3-60><span class=linenos data-linenos="60 "></span></a>aof-load-truncated yes
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61></a><a href=#__codelineno-3-61><span class=linenos data-linenos="61 "></span></a>#重写时把rdb文件数据放在在新的AOF文件的头部作为已有的历史数据，替换掉原来的流水账操作
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62></a><a href=#__codelineno-3-62><span class=linenos data-linenos="62 "></span></a>aof-use-rdb-preamble yes
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63></a><a href=#__codelineno-3-63><span class=linenos data-linenos="63 "></span></a>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64></a><a href=#__codelineno-3-64><span class=linenos data-linenos="64 "></span></a>############## REPLICATION 主从复制 ##################
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65></a><a href=#__codelineno-3-65><span class=linenos data-linenos="65 "></span></a>#设置从机的master主机
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66></a><a href=#__codelineno-3-66><span class=linenos data-linenos="66 "></span></a># replicaof &lt;masterip&gt; &lt;masterport&gt;
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67></a><a href=#__codelineno-3-67><span class=linenos data-linenos="67 "></span></a>#设置主机挂掉了从机还可以读，单词stale是陈旧的意思，表示主机挂掉了，在从机上读到的可能是一些旧数据
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68></a><a href=#__codelineno-3-68><span class=linenos data-linenos="68 "></span></a>replica-serve-stale-data yes
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69></a><a href=#__codelineno-3-69><span class=linenos data-linenos="69 "></span></a>#设置从机只读，设置为no可能产生一些问题
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70></a><a href=#__codelineno-3-70><span class=linenos data-linenos="70 "></span></a>replica-read-only yes
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71></a><a href=#__codelineno-3-71><span class=linenos data-linenos="71 "></span></a>#backlog用于从机增量式更新
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72></a><a href=#__codelineno-3-72><span class=linenos data-linenos="72 "></span></a># repl-backlog-size 1mb
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73></a><a href=#__codelineno-3-73><span class=linenos data-linenos="73 "></span></a>#设置当主机没有从机时，主机backlog过期删除时间，0表示永不删除，注意，从机本来就永不删除backlog
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74></a><a href=#__codelineno-3-74><span class=linenos data-linenos="74 "></span></a># repl-backlog-ttl 3600
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75></a><a href=#__codelineno-3-75><span class=linenos data-linenos="75 "></span></a>#哨兵选举时，从机的优先级，越小优先级越高，为0表示永不当master
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76></a><a href=#__codelineno-3-76><span class=linenos data-linenos="76 "></span></a>replica-priority 100
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77></a><a href=#__codelineno-3-77><span class=linenos data-linenos="77 "></span></a>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78></a><a href=#__codelineno-3-78><span class=linenos data-linenos="78 "></span></a>################################ REDIS CLUSTER  ###############################
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79></a><a href=#__codelineno-3-79><span class=linenos data-linenos="79 "></span></a>#开启集群模式
</span><span id=__span-3-80><a id=__codelineno-3-80 name=__codelineno-3-80></a><a href=#__codelineno-3-80><span class=linenos data-linenos="80 "></span></a>cluster-enabled yes
</span><span id=__span-3-81><a id=__codelineno-3-81 name=__codelineno-3-81></a><a href=#__codelineno-3-81><span class=linenos data-linenos="81 "></span></a>#集群模式下，节点自动生成的配置文件的名字，该文件不要手动去修改
</span><span id=__span-3-82><a id=__codelineno-3-82 name=__codelineno-3-82></a><a href=#__codelineno-3-82><span class=linenos data-linenos="82 "></span></a>cluster-config-file nodes-6379.conf
</span><span id=__span-3-83><a id=__codelineno-3-83 name=__codelineno-3-83></a><a href=#__codelineno-3-83><span class=linenos data-linenos="83 "></span></a>#节点判定为不可达的超时时间（毫秒）
</span><span id=__span-3-84><a id=__codelineno-3-84 name=__codelineno-3-84></a><a href=#__codelineno-3-84><span class=linenos data-linenos="84 "></span></a>cluster-node-timeout 15000
</span><span id=__span-3-85><a id=__codelineno-3-85 name=__codelineno-3-85></a><a href=#__codelineno-3-85><span class=linenos data-linenos="85 "></span></a>#如果设置为yes，当某一段插槽的主从都挂掉了，那么整个集群也就挂掉了；设置为no，当某一段插槽的主从都挂掉了，那么整个集群不会挂掉，只是该段插槽不可用
</span><span id=__span-3-86><a id=__codelineno-3-86 name=__codelineno-3-86></a><a href=#__codelineno-3-86><span class=linenos data-linenos="86 "></span></a>cluster-require-full-coverage yes
</span></code></pre></div> <hr> <h4 id=redis_4><strong>redis常用命令</strong><a class=headerlink href=#redis_4 title="Permanent link">#</a></h4> <p>动态设置redis的运行配置</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a><a href=#__codelineno-4-1><span class=linenos data-linenos="1 "></span></a>config set &lt;directive&gt; &lt;value&gt;
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><a href=#__codelineno-4-2><span class=linenos data-linenos="2 "></span></a>redis运行期间设置密码，重启失效：config set requirepass 123456
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><a href=#__codelineno-4-3><span class=linenos data-linenos="3 "></span></a>设置密码之后，客户端需要认证：auth &lt;password&gt;
</span></code></pre></div> <p>获取redis的配置信息</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1></a><a href=#__codelineno-5-1><span class=linenos data-linenos="1 "></span></a>config get &lt;pattern&gt;
</span></code></pre></div> <p>把redis运行时的配置信息重写到文件</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1></a><a href=#__codelineno-6-1><span class=linenos data-linenos="1 "></span></a>config rewrite
</span></code></pre></div> <p>切换数据库，默认16个数据库0~15</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1></a><a href=#__codelineno-7-1><span class=linenos data-linenos="1 "></span></a>select &lt;dbid&gt;
</span></code></pre></div> <p>查看当前库的key</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1></a><a href=#__codelineno-8-1><span class=linenos data-linenos="1 "></span></a>keys &lt;pattern&gt;
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2></a><a href=#__codelineno-8-2><span class=linenos data-linenos="2 "></span></a>&lt;pattern&gt;是正则表达式，如查看当前库的所有key：keys *
</span></code></pre></div> <p>判断某个key是否存在</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1></a><a href=#__codelineno-9-1><span class=linenos data-linenos="1 "></span></a>exists &lt;key&gt;
</span></code></pre></div> <p>查看key对应的value是什么数据类型，redis的5大常用数据结构：字符串 (string)、列表 (list)、集合 (set)、哈希 (hash)、有序集合 (zset)</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1></a><a href=#__codelineno-10-1><span class=linenos data-linenos="1 "></span></a>type &lt;key&gt;
</span></code></pre></div> <p>删除key-value</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1></a><a href=#__codelineno-11-1><span class=linenos data-linenos="1 "></span></a>del &lt;key&gt;
</span></code></pre></div> <p>非阻塞异步地删除key-value</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1></a><a href=#__codelineno-12-1><span class=linenos data-linenos="1 "></span></a>unlink &lt;key&gt;
</span></code></pre></div> <p>设置过期时间</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1></a><a href=#__codelineno-13-1><span class=linenos data-linenos="1 "></span></a>expire &lt;key&gt; &lt;seconds&gt;
</span></code></pre></div> <p>查看剩余多少时间过期，ttl (time to live)</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1></a><a href=#__codelineno-14-1><span class=linenos data-linenos="1 "></span></a>ttl &lt;key&gt;
</span></code></pre></div> <p>清空当前库</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1></a><a href=#__codelineno-15-1><span class=linenos data-linenos="1 "></span></a>flushdb
</span></code></pre></div> <p>清空全部库</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1></a><a href=#__codelineno-16-1><span class=linenos data-linenos="1 "></span></a>flushall
</span></code></pre></div> <hr> <h4 id=string><strong>字符串 (string) 常用操作</strong><a class=headerlink href=#string title="Permanent link">#</a></h4> <p>String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是512M，</p> <p>添加键值对</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1></a><a href=#__codelineno-17-1><span class=linenos data-linenos="1 "></span></a>set &lt;key&gt; &lt;value&gt;  
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2></a><a href=#__codelineno-17-2><span class=linenos data-linenos="2 "></span></a>set &lt;key&gt; &lt;value&gt; [ex &lt;seconds&gt; | px &lt;miliseconds&gt;] [nx | xx]
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3></a><a href=#__codelineno-17-3><span class=linenos data-linenos="3 "></span></a>同时设置key的过期时间 ex 秒 px 毫秒
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4></a><a href=#__codelineno-17-4><span class=linenos data-linenos="4 "></span></a>nx不存在时才设置，等同于setnx &lt;key&gt; &lt;value&gt; 当key不存在时添加，xx存在时才设置
</span></code></pre></div> <p>查询键对应的值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1></a><a href=#__codelineno-18-1><span class=linenos data-linenos="1 "></span></a>get &lt;key&gt;
</span></code></pre></div> <p>把 value 追加到原值的末尾</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1></a><a href=#__codelineno-19-1><span class=linenos data-linenos="1 "></span></a>append &lt;key&gt; &lt;value&gt;
</span></code></pre></div> <p>查询值的长度</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1></a><a href=#__codelineno-20-1><span class=linenos data-linenos="1 "></span></a>strlen &lt;key&gt;
</span></code></pre></div> <p>增加value中数字的值，字符串里必须全是数字，这是一个原子性操作</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1></a><a href=#__codelineno-21-1><span class=linenos data-linenos="1 "></span></a>incr &lt;key&gt; 加1
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2></a><a href=#__codelineno-21-2><span class=linenos data-linenos="2 "></span></a>incrby &lt;key&gt; &lt;step&gt; 加step
</span></code></pre></div> <p>减少value中数字的值，字符串里必须全是数字，这是一个原子性操作</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1></a><a href=#__codelineno-22-1><span class=linenos data-linenos="1 "></span></a>decr &lt;key&gt; 减1
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2></a><a href=#__codelineno-22-2><span class=linenos data-linenos="2 "></span></a>decr &lt;key&gt; &lt;step&gt; 减step
</span></code></pre></div> <p>同时设置一个或多个 key-value对</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1></a><a href=#__codelineno-23-1><span class=linenos data-linenos="1 "></span></a>mset &lt;key&gt; &lt;value&gt; [&lt;key&gt; &lt;value&gt; ....]
</span></code></pre></div> <p>同时获取一个或多个 value </p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1></a><a href=#__codelineno-24-1><span class=linenos data-linenos="1 "></span></a>mget &lt;key&gt; [&lt;key&gt; ....]
</span></code></pre></div> <p>同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在，有一个存在则会导致所有设置失败</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1></a><a href=#__codelineno-25-1><span class=linenos data-linenos="1 "></span></a>msetnx &lt;key&gt; &lt;value&gt; [&lt;key&gt; &lt;value&gt; ....]
</span></code></pre></div> <p>获取值的子串，类似java中的substring，<strong>前闭，后闭</strong>，-1表示最后一个位置</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1></a><a href=#__codelineno-26-1><span class=linenos data-linenos="1 "></span></a>getrange &lt;key&gt; &lt;起始位置&gt; &lt;结束位置&gt;
</span></code></pre></div> <p>从起始位置开始覆盖原值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1></a><a href=#__codelineno-27-1><span class=linenos data-linenos="1 "></span></a>setrange &lt;key&gt; &lt;起始位置&gt; &lt;value&gt;
</span></code></pre></div> <p>设置新值的同时获得旧值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1></a><a href=#__codelineno-28-1><span class=linenos data-linenos="1 "></span></a>getset &lt;key&gt; &lt;value&gt;
</span></code></pre></div> <hr> <h4 id=list><strong>列表 (list) 常用操作</strong><a class=headerlink href=#list title="Permanent link">#</a></h4> <p>向列表中插入值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1></a><a href=#__codelineno-29-1><span class=linenos data-linenos="1 "></span></a>lpush &lt;key&gt; &lt;element&gt; [&lt;element&gt; ...] 从左边插入值
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2></a><a href=#__codelineno-29-2><span class=linenos data-linenos="2 "></span></a>rpush &lt;key&gt; &lt;element&gt; [&lt;element&gt; ...] 从右边插入值
</span></code></pre></div> <p>从左到右在列表中取值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1></a><a href=#__codelineno-30-1><span class=linenos data-linenos="1 "></span></a>lrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; 
</span></code></pre></div> <p>弹出列表中的值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1></a><a href=#__codelineno-31-1><span class=linenos data-linenos="1 "></span></a>lpop &lt;key&gt; [count] 从左边弹
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2></a><a href=#__codelineno-31-2><span class=linenos data-linenos="2 "></span></a>rpop &lt;key&gt; [count] 从右边弹
</span></code></pre></div> <p>从 key1 列表右边弹出一个值，插到 key2列表左边</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1></a><a href=#__codelineno-32-1><span class=linenos data-linenos="1 "></span></a>rpoplpush &lt;key1&gt; &lt;key2&gt;
</span></code></pre></div> <p>取索引在 index处的值（从左到右）</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1></a><a href=#__codelineno-33-1><span class=linenos data-linenos="1 "></span></a>lindex &lt;key&gt; &lt;index&gt;
</span></code></pre></div> <p>获得列表长度</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1></a><a href=#__codelineno-34-1><span class=linenos data-linenos="1 "></span></a>llen &lt;key&gt;
</span></code></pre></div> <p>在 value 的 前面/后面 插入 newvalue </p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1></a><a href=#__codelineno-35-1><span class=linenos data-linenos="1 "></span></a>linsert &lt;key&gt; before/after &lt;pivot&gt; &lt;element&gt;
</span></code></pre></div> <p>从左到右删除n个 value</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1></a><a href=#__codelineno-36-1><span class=linenos data-linenos="1 "></span></a>lrem &lt;key&gt; &lt;n&gt; &lt;value&gt;
</span></code></pre></div> <p>将列表下标为index的值替换成value</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1></a><a href=#__codelineno-37-1><span class=linenos data-linenos="1 "></span></a>lset &lt;key&gt; &lt;index&gt; &lt;value&gt;
</span></code></pre></div> <hr> <h4 id=set><strong>集合 (set) 常用操作</strong><a class=headerlink href=#set title="Permanent link">#</a></h4> <p>将一个或多个 member 加入到集合 key 中，自动去重</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1></a><a href=#__codelineno-38-1><span class=linenos data-linenos="1 "></span></a>sadd &lt;key&gt; &lt;value1&gt; [&lt;member&gt;]
</span></code></pre></div> <p>取出集合中的所有值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1></a><a href=#__codelineno-39-1><span class=linenos data-linenos="1 "></span></a>smembers &lt;key&gt;
</span></code></pre></div> <p>判断集合是否为含有 member，有1，没有0</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1></a><a href=#__codelineno-40-1><span class=linenos data-linenos="1 "></span></a>sismember &lt;key&gt; &lt;member&gt;
</span></code></pre></div> <p>集合的元素个数</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1></a><a href=#__codelineno-41-1><span class=linenos data-linenos="1 "></span></a>scard &lt;key&gt;
</span></code></pre></div> <p>删除集合中的某个元素</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1></a><a href=#__codelineno-42-1><span class=linenos data-linenos="1 "></span></a>srem &lt;key&gt; &lt;member&gt; [&lt;member&gt; ...]
</span></code></pre></div> <p>从集合中随机弹出一个值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1></a><a href=#__codelineno-43-1><span class=linenos data-linenos="1 "></span></a>spop &lt;key&gt;
</span></code></pre></div> <p>随机从该集合中取出n个值，不会从集合中删除</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1></a><a href=#__codelineno-44-1><span class=linenos data-linenos="1 "></span></a>srandmember &lt;key&gt; &lt;n&gt;
</span></code></pre></div> <p>把集合中一个值从一个集合移动到另一个集合</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1></a><a href=#__codelineno-45-1><span class=linenos data-linenos="1 "></span></a>smove &lt;source&gt; &lt;destination&gt; &lt;value&gt;
</span></code></pre></div> <p>得到集合的交集</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1></a><a href=#__codelineno-46-1><span class=linenos data-linenos="1 "></span></a>sinter &lt;key1&gt; [&lt;key2&gt;...]
</span></code></pre></div> <p>得到集合的并集</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1></a><a href=#__codelineno-47-1><span class=linenos data-linenos="1 "></span></a>sunion &lt;key1&gt; [&lt;key2&gt;...]
</span></code></pre></div> <p>得到 key1 - key2 - ... 的差集，即key1中有但是key2....没有的元素</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1></a><a href=#__codelineno-48-1><span class=linenos data-linenos="1 "></span></a>sdiff &lt;key1&gt; [&lt;key2&gt;...]
</span></code></pre></div> <hr> <h4 id=hash><strong>哈希 (hash) 常用操作</strong><a class=headerlink href=#hash title="Permanent link">#</a></h4> <p>设置 field value </p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1></a><a href=#__codelineno-49-1><span class=linenos data-linenos="1 "></span></a>hset &lt;key&gt; &lt;field&gt; &lt;value&gt; [&lt;field&gt; &lt;value&gt; ...]
</span></code></pre></div> <p>从取出 field 的 value </p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1></a><a href=#__codelineno-50-1><span class=linenos data-linenos="1 "></span></a>hget &lt;key&gt; &lt;field&gt;
</span></code></pre></div> <p>检查 field 是否存在</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1></a><a href=#__codelineno-51-1><span class=linenos data-linenos="1 "></span></a>hexists &lt;key&gt; &lt;field&gt;
</span></code></pre></div> <p>列出所有field</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1></a><a href=#__codelineno-52-1><span class=linenos data-linenos="1 "></span></a>hkeys &lt;key&gt;
</span></code></pre></div> <p>列出所有value</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1></a><a href=#__codelineno-53-1><span class=linenos data-linenos="1 "></span></a>hvals &lt;key&gt;
</span></code></pre></div> <p>将 field 的值value增加 increment</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1></a><a href=#__codelineno-54-1><span class=linenos data-linenos="1 "></span></a>hincrby &lt;key&gt; &lt;field&gt; &lt;increment&gt;
</span></code></pre></div> <p>设置 field 的值为 value ，当且仅当域 field 不存在 </p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1></a><a href=#__codelineno-55-1><span class=linenos data-linenos="1 "></span></a>hsetnx &lt;key&gt; &lt;field&gt; &lt;value&gt;
</span></code></pre></div> <hr> <h4 id=zset><strong>有序集合 (zset) 常用操作</strong><a class=headerlink href=#zset title="Permanent link">#</a></h4> <p>将一个或多个 member 元素及其 score 值加入到有序集 key 当中</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1></a><a href=#__codelineno-56-1><span class=linenos data-linenos="1 "></span></a>zadd &lt;key&gt; &lt;score&gt; &lt;member&gt; [&lt;score&gt; &lt;member&gt;...]
</span></code></pre></div> <p>返回有序集合中下标在<start><stop>之间包括下标的元素（从小到大），加withscores表示把score也带上</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1></a><a href=#__codelineno-57-1><span class=linenos data-linenos="1 "></span></a>zrange &lt;key&gt; &lt;start&gt; &lt;stop&gt; [WITHSCORES]
</span></code></pre></div> <p>返回 score 值介于 min 和 max 之间（包括min，max)的元素（从小到大）</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1></a><a href=#__codelineno-58-1><span class=linenos data-linenos="1 "></span></a>zrangebyscore key min max [withscores] [limit offset count]
</span></code></pre></div> <p>同上，改为从大到小排列</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1></a><a href=#__codelineno-59-1><span class=linenos data-linenos="1 "></span></a>zrevrangebyscore key max min [withscores] [limit offset count]
</span></code></pre></div> <p>value 的 score 加上 increment</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1></a><a href=#__codelineno-60-1><span class=linenos data-linenos="1 "></span></a>zincrby &lt;key&gt; &lt;increment&gt; &lt;value&gt;
</span></code></pre></div> <p>删除该集合下，指定值的元素</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1></a><a href=#__codelineno-61-1><span class=linenos data-linenos="1 "></span></a>zrem &lt;key&gt; &lt;value&gt;
</span></code></pre></div> <p>统计该集合，分数区间内的元素个数 </p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1></a><a href=#__codelineno-62-1><span class=linenos data-linenos="1 "></span></a>zcount &lt;key&gt; &lt;min&gt; &lt;max&gt;
</span></code></pre></div> <p>返回该值在集合中的排名，从0开始</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1></a><a href=#__codelineno-63-1><span class=linenos data-linenos="1 "></span></a>zrank &lt;key&gt; &lt;value&gt;
</span></code></pre></div> <hr> <h4 id=_1><strong>发布和订阅</strong><a class=headerlink href=#_1 title="Permanent link">#</a></h4> <p><strong>订阅</strong></p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1></a><a href=#__codelineno-64-1><span class=linenos data-linenos="1 "></span></a>subscribe channel [channel...]
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2></a><a href=#__codelineno-64-2><span class=linenos data-linenos="2 "></span></a>psubscribe &lt;pattern&gt; [&lt;pattern&gt;...]
</span></code></pre></div> <p><strong>发布</strong></p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1></a><a href=#__codelineno-65-1><span class=linenos data-linenos="1 "></span></a>publish channel message
</span></code></pre></div> <p>查看活跃的频道数</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1></a><a href=#__codelineno-66-1><span class=linenos data-linenos="1 "></span></a>pubsub channels [&lt;pattern&gt;]
</span></code></pre></div> <p>查看频道订阅数</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1></a><a href=#__codelineno-67-1><span class=linenos data-linenos="1 "></span></a>pubsub numsub [&lt;channel&gt;...]
</span></code></pre></div> <p>查看模式订阅数</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1></a><a href=#__codelineno-68-1><span class=linenos data-linenos="1 "></span></a>pubsub numpat
</span></code></pre></div> <hr> <h4 id=bitmaps><strong>Bitmaps</strong><a class=headerlink href=#bitmaps title="Permanent link">#</a></h4> <p>设置值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1></a><a href=#__codelineno-69-1><span class=linenos data-linenos="1 "></span></a>setbit &lt;key&gt; &lt;offset&gt; &lt;value&gt;
</span></code></pre></div> <p>获取值</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1></a><a href=#__codelineno-70-1><span class=linenos data-linenos="1 "></span></a>getbit &lt;key&gt; &lt;offset&gt;
</span></code></pre></div> <p>指定范围为1的个数</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1></a><a href=#__codelineno-71-1><span class=linenos data-linenos="1 "></span></a>bitcount [start] [end]
</span></code></pre></div> <p>Bitmaps之间的运算</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1></a><a href=#__codelineno-72-1><span class=linenos data-linenos="1 "></span></a>bitop &lt;and|or|not|xor&gt; &lt;destkey&gt; &lt;key&gt; [&lt;key&gt;...]
</span></code></pre></div> <p>获取第一个值为bit的偏移量</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1></a><a href=#__codelineno-73-1><span class=linenos data-linenos="1 "></span></a>bitpos &lt;key&gt; &lt;bit&gt; [start] [end]
</span></code></pre></div> <hr> <h4 id=hyperloglog><strong>HyperLogLog</strong><a class=headerlink href=#hyperloglog title="Permanent link">#</a></h4> <p>添加元素</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1></a><a href=#__codelineno-74-1><span class=linenos data-linenos="1 "></span></a>pfadd &lt;key&gt; &lt;element&gt; [&lt;element&gt;]
</span></code></pre></div> <p>计算一个或多个HyperLogLog的独立总数</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1></a><a href=#__codelineno-75-1><span class=linenos data-linenos="1 "></span></a>pfcount &lt;key&gt; [&lt;key&gt;...]
</span></code></pre></div> <p>合并多个HyperLogLog到destkey</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1></a><a href=#__codelineno-76-1><span class=linenos data-linenos="1 "></span></a>pfmerge &lt;destkey&gt; &lt;sourcekey&gt; [&lt;sourcekey&gt;]
</span></code></pre></div> <hr> <h4 id=redis_5><strong>redis事务</strong><a class=headerlink href=#redis_5 title="Permanent link">#</a></h4> <p>redis里面的单个命令都是原子操作，但当某个需求需要执行多条命令时就不是一个原子操作了，redis事务就是将多条命令打包在一起执行，防止其它命令插队。</p> <p>multi命令表示开始组队，输入的每条命令都不会执行，只是先把命令组合在一起</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1></a><a href=#__codelineno-77-1><span class=linenos data-linenos="1 "></span></a>multi
</span></code></pre></div> <p>discard命令表示 放弃执行队列 并 结束组队</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1></a><a href=#__codelineno-78-1><span class=linenos data-linenos="1 "></span></a>discard
</span></code></pre></div> <p><strong>exec命令表示 结束组队 并 执行队列，执行过程中不会被插队</strong>。执行过程指令不被插队有三种情况，一是单线程执行，只有一个线程，没有其它线程，自然不会被打断；二是多线程并发，但是只有一个线程在执行，其它线程阻塞，于是不会被打断；~~三是多线程并行，并行时各自执行各自的，没有锁，不会被阻塞，所有线程都能同时执行，也没有被打断，（但其实在一条时间线上看，好像指令的执行还是有先后，也就是还是被插队了~~。<strong>redis在执行exec命令时采用的是单线程执行。</strong></p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1></a><a href=#__codelineno-79-1><span class=linenos data-linenos="1 "></span></a>exec
</span></code></pre></div> <p>需要注意的是，组队过程中某条命令出现了语法等错误，那么整个队列都会被取消；执行过程中某条命令出现了语法等错误，那么该命令不会执行，但其它命令依然会正常执行，这正是redis事务不同于关系型数据库事务的地方，redis事务不会回滚，没有原子性。</p> <p>因为redis事务在组队过程中命令没有执行，而在执行过程也不会被其它命令插队，所以redis事务的执行是串行化的，隔离性就是串行化，没有mysql的隔离级别。</p> <p>虽然redis事务是串行化执行的，但由于其对数据库的操作是打包执行，导致其串行化与mysql的串行化十分不同，因为打包执行意味着redis事务执行过程中不可能穿插其它java代码的逻辑，但mysql的事务就不一样，mysql的事务是并发执行的长事务，每个命令都是立即执行可以拿到结果的，事务执行期间可以根据结果执行其它java代码逻辑，从而进行读写操作，然后通过锁来保证串行化，也即保证了事务执行后数据库数据的一致性，这个一致性包括了java代码的逻辑。但redis事务串行化带来的一致性并不包括java代码的逻辑。</p> <p>一致性是一个逻辑上的概念，指的是满足特定逻辑的状态，在秒杀案例中库存不能小于0就是一个逻辑，保证数据库的一致性指数据库从一种一致性状态转移到另一种一致性状态。mysql的串行化事务是一个长过程，事务期间可以加入各种java代码的逻辑判断来保证一致性，但redis不能，那如何在redis事务的一致性中加入java代码的逻辑呢？</p> <p>答案就是<strong>乐观锁</strong>。mysql的串行化事务采用是悲观锁，如读锁、写锁；redis则采用乐观锁；这都是各自执行特点所决定。</p> <p>redis乐观锁命令watch需要在multi命令之前执行，具体的执行位置要看业务代码的逻辑，因为它就是用来确保一致性中有业务逻辑的。</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1></a><a href=#__codelineno-80-1><span class=linenos data-linenos="1 "></span></a>watch &lt;key&gt;
</span></code></pre></div> <p>秒杀案例，注意watch的位置：</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1></a><a href=#__codelineno-81-1><span class=linenos data-linenos=" 1 "></span></a>public String doSecKill(String phone, String prodId) {
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2></a><a href=#__codelineno-81-2><span class=linenos data-linenos=" 2 "></span></a>        if (phone == null || prodId == null || phone.length() == 0 || prodId.length() == 0) {
</span><span id=__span-81-3><a id=__codelineno-81-3 name=__codelineno-81-3></a><a href=#__codelineno-81-3><span class=linenos data-linenos=" 3 "></span></a>            log.info(&quot;系统错误！&quot;);
</span><span id=__span-81-4><a id=__codelineno-81-4 name=__codelineno-81-4></a><a href=#__codelineno-81-4><span class=linenos data-linenos=" 4 "></span></a>            return &quot;系统错误！&quot;;
</span><span id=__span-81-5><a id=__codelineno-81-5 name=__codelineno-81-5></a><a href=#__codelineno-81-5><span class=linenos data-linenos=" 5 "></span></a>        }
</span><span id=__span-81-6><a id=__codelineno-81-6 name=__codelineno-81-6></a><a href=#__codelineno-81-6><span class=linenos data-linenos=" 6 "></span></a>
</span><span id=__span-81-7><a id=__codelineno-81-7 name=__codelineno-81-7></a><a href=#__codelineno-81-7><span class=linenos data-linenos=" 7 "></span></a>        //商品的库存
</span><span id=__span-81-8><a id=__codelineno-81-8 name=__codelineno-81-8></a><a href=#__codelineno-81-8><span class=linenos data-linenos=" 8 "></span></a>        String stock = &quot;sk:&quot; + prodId + &quot;:stock&quot;;
</span><span id=__span-81-9><a id=__codelineno-81-9 name=__codelineno-81-9></a><a href=#__codelineno-81-9><span class=linenos data-linenos=" 9 "></span></a>        //秒杀成功的用户的手机号
</span><span id=__span-81-10><a id=__codelineno-81-10 name=__codelineno-81-10></a><a href=#__codelineno-81-10><span class=linenos data-linenos="10 "></span></a>        String user = &quot;sk:&quot; + prodId + &quot;:phone&quot;;
</span><span id=__span-81-11><a id=__codelineno-81-11 name=__codelineno-81-11></a><a href=#__codelineno-81-11><span class=linenos data-linenos="11 "></span></a>
</span><span id=__span-81-12><a id=__codelineno-81-12 name=__codelineno-81-12></a><a href=#__codelineno-81-12><span class=linenos data-linenos="12 "></span></a>        try (Jedis jedis = jedisPool.getResource()) {
</span><span id=__span-81-13><a id=__codelineno-81-13 name=__codelineno-81-13></a><a href=#__codelineno-81-13><span class=linenos data-linenos="13 "></span></a>
</span><span id=__span-81-14><a id=__codelineno-81-14 name=__codelineno-81-14></a><a href=#__codelineno-81-14><span class=linenos data-linenos="14 "></span></a>            if (jedis.get(stock) == null) {
</span><span id=__span-81-15><a id=__codelineno-81-15 name=__codelineno-81-15></a><a href=#__codelineno-81-15><span class=linenos data-linenos="15 "></span></a>                log.info(&quot;秒杀还没开始！！&quot;);
</span><span id=__span-81-16><a id=__codelineno-81-16 name=__codelineno-81-16></a><a href=#__codelineno-81-16><span class=linenos data-linenos="16 "></span></a>                return &quot;秒杀还没开始！&quot;;
</span><span id=__span-81-17><a id=__codelineno-81-17 name=__codelineno-81-17></a><a href=#__codelineno-81-17><span class=linenos data-linenos="17 "></span></a>            }
</span><span id=__span-81-18><a id=__codelineno-81-18 name=__codelineno-81-18></a><a href=#__codelineno-81-18><span class=linenos data-linenos="18 "></span></a>            if (jedis.sismember(user, phone)) {
</span><span id=__span-81-19><a id=__codelineno-81-19 name=__codelineno-81-19></a><a href=#__codelineno-81-19><span class=linenos data-linenos="19 "></span></a>                log.info(&quot;您已成功秒杀到商品，不可重复秒杀！&quot;);
</span><span id=__span-81-20><a id=__codelineno-81-20 name=__codelineno-81-20></a><a href=#__codelineno-81-20><span class=linenos data-linenos="20 "></span></a>                return &quot;您已成功秒杀到商品，不可重复秒杀！&quot;;
</span><span id=__span-81-21><a id=__codelineno-81-21 name=__codelineno-81-21></a><a href=#__codelineno-81-21><span class=linenos data-linenos="21 "></span></a>            }
</span><span id=__span-81-22><a id=__codelineno-81-22 name=__codelineno-81-22></a><a href=#__codelineno-81-22><span class=linenos data-linenos="22 "></span></a>/*watch必须放在这里或之前，当有两个或多个线程执行到这还没watch时，如果其中一个watch并执行了后面所有的代码，那么其它线程watch的将会是0，然后挂在下面的if判断；如果多个线程都watch的是1，通过了下面的if判断，则悲观锁只会让其中一个线程执行成功，其它均失败。*/
</span><span id=__span-81-23><a id=__codelineno-81-23 name=__codelineno-81-23></a><a href=#__codelineno-81-23><span class=linenos data-linenos="23 "></span></a>            jedis.watch(stock);
</span><span id=__span-81-24><a id=__codelineno-81-24 name=__codelineno-81-24></a><a href=#__codelineno-81-24><span class=linenos data-linenos="24 "></span></a>            //下面的jedis.get(stock)并不属于redis事务中的操作
</span><span id=__span-81-25><a id=__codelineno-81-25 name=__codelineno-81-25></a><a href=#__codelineno-81-25><span class=linenos data-linenos="25 "></span></a>            if (Integer.parseInt(jedis.get(stock)) &lt;= 0) {
</span><span id=__span-81-26><a id=__codelineno-81-26 name=__codelineno-81-26></a><a href=#__codelineno-81-26><span class=linenos data-linenos="26 "></span></a>                log.info(&quot;秒杀已经结束！&quot;);
</span><span id=__span-81-27><a id=__codelineno-81-27 name=__codelineno-81-27></a><a href=#__codelineno-81-27><span class=linenos data-linenos="27 "></span></a>                return &quot;秒杀已经结束！&quot;;
</span><span id=__span-81-28><a id=__codelineno-81-28 name=__codelineno-81-28></a><a href=#__codelineno-81-28><span class=linenos data-linenos="28 "></span></a>            }
</span><span id=__span-81-29><a id=__codelineno-81-29 name=__codelineno-81-29></a><a href=#__codelineno-81-29><span class=linenos data-linenos="29 "></span></a>
</span><span id=__span-81-30><a id=__codelineno-81-30 name=__codelineno-81-30></a><a href=#__codelineno-81-30><span class=linenos data-linenos="30 "></span></a>/*如果把watch放在这里，可能出现，在stock=1时，有两个请求同时到这里，一个没有执行watch，一个已经watch并执行了剩下所有，于是没有watch的线程此时watch的就是0，然后还能正常执行下面的代码，于是库存就变成-1了*/
</span><span id=__span-81-31><a id=__codelineno-81-31 name=__codelineno-81-31></a><a href=#__codelineno-81-31><span class=linenos data-linenos="31 "></span></a>            //jedis.watch(stock);
</span><span id=__span-81-32><a id=__codelineno-81-32 name=__codelineno-81-32></a><a href=#__codelineno-81-32><span class=linenos data-linenos="32 "></span></a>            Transaction multi = jedis.multi();
</span><span id=__span-81-33><a id=__codelineno-81-33 name=__codelineno-81-33></a><a href=#__codelineno-81-33><span class=linenos data-linenos="33 "></span></a>            multi.decr(stock);
</span><span id=__span-81-34><a id=__codelineno-81-34 name=__codelineno-81-34></a><a href=#__codelineno-81-34><span class=linenos data-linenos="34 "></span></a>/*由于这里并没有真正执行sadd，前面的if判断只能是在真正add之后有效，所以可能出现一个用户的多次请求都执行到这里，但没有执行下面的exec，最后的效果是一个用户成功抢到多次，库存归零了，但由于是set集合，所以只有保留用户的一条信息，于是成功抢到的用户数少于库存数*/
</span><span id=__span-81-35><a id=__codelineno-81-35 name=__codelineno-81-35></a><a href=#__codelineno-81-35><span class=linenos data-linenos="35 "></span></a>            multi.sadd(user, phone);
</span><span id=__span-81-36><a id=__codelineno-81-36 name=__codelineno-81-36></a><a href=#__codelineno-81-36><span class=linenos data-linenos="36 "></span></a>            List&lt;Object&gt; results;
</span><span id=__span-81-37><a id=__codelineno-81-37 name=__codelineno-81-37></a><a href=#__codelineno-81-37><span class=linenos data-linenos="37 "></span></a>            /*//验证取不到值，确实取不到
</span><span id=__span-81-38><a id=__codelineno-81-38 name=__codelineno-81-38></a><a href=#__codelineno-81-38><span class=linenos data-linenos="38 "></span></a>            if (multi.get(stock) != null) {
</span><span id=__span-81-39><a id=__codelineno-81-39 name=__codelineno-81-39></a><a href=#__codelineno-81-39><span class=linenos data-linenos="39 "></span></a>                System.out.println(multi.get(stock));
</span><span id=__span-81-40><a id=__codelineno-81-40 name=__codelineno-81-40></a><a href=#__codelineno-81-40><span class=linenos data-linenos="40 "></span></a>            }*/
</span><span id=__span-81-41><a id=__codelineno-81-41 name=__codelineno-81-41></a><a href=#__codelineno-81-41><span class=linenos data-linenos="41 "></span></a>            results = multi.exec();
</span><span id=__span-81-42><a id=__codelineno-81-42 name=__codelineno-81-42></a><a href=#__codelineno-81-42><span class=linenos data-linenos="42 "></span></a>            if (results == null || results.size() == 0) {
</span><span id=__span-81-43><a id=__codelineno-81-43 name=__codelineno-81-43></a><a href=#__codelineno-81-43><span class=linenos data-linenos="43 "></span></a>                log.info(&quot;很遗憾您未能抢到商品！&quot;);
</span><span id=__span-81-44><a id=__codelineno-81-44 name=__codelineno-81-44></a><a href=#__codelineno-81-44><span class=linenos data-linenos="44 "></span></a>                return &quot;很遗憾您未能抢到商品！&quot;;
</span><span id=__span-81-45><a id=__codelineno-81-45 name=__codelineno-81-45></a><a href=#__codelineno-81-45><span class=linenos data-linenos="45 "></span></a>            }
</span><span id=__span-81-46><a id=__codelineno-81-46 name=__codelineno-81-46></a><a href=#__codelineno-81-46><span class=linenos data-linenos="46 "></span></a>            log.info(&quot;秒杀成功&quot;);
</span><span id=__span-81-47><a id=__codelineno-81-47 name=__codelineno-81-47></a><a href=#__codelineno-81-47><span class=linenos data-linenos="47 "></span></a>            return &quot;秒杀成功！&quot;;
</span><span id=__span-81-48><a id=__codelineno-81-48 name=__codelineno-81-48></a><a href=#__codelineno-81-48><span class=linenos data-linenos="48 "></span></a>        }
</span><span id=__span-81-49><a id=__codelineno-81-49 name=__codelineno-81-49></a><a href=#__codelineno-81-49><span class=linenos data-linenos="49 "></span></a>    }
</span></code></pre></div> <p>apache benchmark 安装</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1></a><a href=#__codelineno-82-1><span class=linenos data-linenos="1 "></span></a>yum install httpd-tools
</span></code></pre></div> <p>压测命令</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1></a><a href=#__codelineno-83-1><span class=linenos data-linenos="1 "></span></a>ab -n 2000 -c 400 -p ~/postfile -T application/x-www-form-urlencoded http://192.168.37.1:8080/secKill
</span></code></pre></div> <hr> <h4 id=_2><strong>主从复制</strong><a class=headerlink href=#_2 title="Permanent link">#</a></h4> <p>主从复制模式下，slave从机只能读不能写，master可读可写，所以master的角色主要是写，slave的角色主要是读。</p> <p>设置成为谁的slave，如果在客户端中执行，则重启会失效，在配置文件中配置，重启有效</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1></a><a href=#__codelineno-84-1><span class=linenos data-linenos="1 "></span></a>replicaof &lt;host&gt; &lt;port&gt;
</span></code></pre></div> <p>设置不成为slave，而是master</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-85-1><a id=__codelineno-85-1 name=__codelineno-85-1></a><a href=#__codelineno-85-1><span class=linenos data-linenos="1 "></span></a>replicaof no one
</span></code></pre></div> <p>查看主从复制的信息</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-86-1><a id=__codelineno-86-1 name=__codelineno-86-1></a><a href=#__codelineno-86-1><span class=linenos data-linenos="1 "></span></a>info replication
</span><span id=__span-86-2><a id=__codelineno-86-2 name=__codelineno-86-2></a><a href=#__codelineno-86-2><span class=linenos data-linenos="2 "></span></a>role
</span></code></pre></div> <p><strong>哨兵模式</strong>配置流程：</p> <p>哨兵模式正确打开方式是为每个redis主机都运行一个哨兵，这样master主机挂掉了，剩下的slave主机的哨兵根据配置文件中的replica-priority值选举产生新的master，原来的master重新上线后会变成现在master的slave。</p> <p>1.编辑启动哨兵的配置文件sentinel.conf。由于redis的docker容器中没有启动哨兵的配置文件，所以需要到redis的官方github仓库上下载sentinel.conf文件，然后基于此文件进行编辑，编辑完再复制到容器内。</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-87-1><a id=__codelineno-87-1 name=__codelineno-87-1></a><a href=#__codelineno-87-1><span class=linenos data-linenos=" 1 "></span></a># 绑定网络接口
</span><span id=__span-87-2><a id=__codelineno-87-2 name=__codelineno-87-2></a><a href=#__codelineno-87-2><span class=linenos data-linenos=" 2 "></span></a># bind 127.0.0.1 192.168.1.1
</span><span id=__span-87-3><a id=__codelineno-87-3 name=__codelineno-87-3></a><a href=#__codelineno-87-3><span class=linenos data-linenos=" 3 "></span></a># 关闭保护模式，不然只能本机访问
</span><span id=__span-87-4><a id=__codelineno-87-4 name=__codelineno-87-4></a><a href=#__codelineno-87-4><span class=linenos data-linenos=" 4 "></span></a>protected-mode yes
</span><span id=__span-87-5><a id=__codelineno-87-5 name=__codelineno-87-5></a><a href=#__codelineno-87-5><span class=linenos data-linenos=" 5 "></span></a># 端口号
</span><span id=__span-87-6><a id=__codelineno-87-6 name=__codelineno-87-6></a><a href=#__codelineno-87-6><span class=linenos data-linenos=" 6 "></span></a>port 26379
</span><span id=__span-87-7><a id=__codelineno-87-7 name=__codelineno-87-7></a><a href=#__codelineno-87-7><span class=linenos data-linenos=" 7 "></span></a># 是否以守护进程的方式启动
</span><span id=__span-87-8><a id=__codelineno-87-8 name=__codelineno-87-8></a><a href=#__codelineno-87-8><span class=linenos data-linenos=" 8 "></span></a>daemonize no
</span><span id=__span-87-9><a id=__codelineno-87-9 name=__codelineno-87-9></a><a href=#__codelineno-87-9><span class=linenos data-linenos=" 9 "></span></a># 若以守护进程的方式启动，指定pid存放的位置
</span><span id=__span-87-10><a id=__codelineno-87-10 name=__codelineno-87-10></a><a href=#__codelineno-87-10><span class=linenos data-linenos="10 "></span></a>pidfile /var/run/redis-sentinel.pid
</span><span id=__span-87-11><a id=__codelineno-87-11 name=__codelineno-87-11></a><a href=#__codelineno-87-11><span class=linenos data-linenos="11 "></span></a>#在指定日志文件的名称，若为空串则打印到标准输出上，若为空串且是以守护进程的方式启动，则将日志输出到/dev/null
</span><span id=__span-87-12><a id=__codelineno-87-12 name=__codelineno-87-12></a><a href=#__codelineno-87-12><span class=linenos data-linenos="12 "></span></a>logfile &quot;&quot;
</span><span id=__span-87-13><a id=__codelineno-87-13 name=__codelineno-87-13></a><a href=#__codelineno-87-13><span class=linenos data-linenos="13 "></span></a>#工作目录
</span><span id=__span-87-14><a id=__codelineno-87-14 name=__codelineno-87-14></a><a href=#__codelineno-87-14><span class=linenos data-linenos="14 "></span></a>dir /tmp
</span><span id=__span-87-15><a id=__codelineno-87-15 name=__codelineno-87-15></a><a href=#__codelineno-87-15><span class=linenos data-linenos="15 "></span></a>
</span><span id=__span-87-16><a id=__codelineno-87-16 name=__codelineno-87-16></a><a href=#__codelineno-87-16><span class=linenos data-linenos="16 "></span></a># 最重要的配置，&lt;master-name&gt;是为master起的别名，&lt;ip&gt; &lt;redis-port&gt;是哨兵启动时master的IP和端口，哨兵会通过info
</span><span id=__span-87-17><a id=__codelineno-87-17 name=__codelineno-87-17></a><a href=#__codelineno-87-17><span class=linenos data-linenos="17 "></span></a># replication 命令获取到master主机所有slave从机的ip和端口号，&lt;quorum&gt;表示判定master不可达至少需要quorum个哨兵同意。
</span><span id=__span-87-18><a id=__codelineno-87-18 name=__codelineno-87-18></a><a href=#__codelineno-87-18><span class=linenos data-linenos="18 "></span></a># quorum一般设置为(sentinels/2 + 10)，例如：sentinel monitor mymaster 172.17.0.4 6379 2
</span><span id=__span-87-19><a id=__codelineno-87-19 name=__codelineno-87-19></a><a href=#__codelineno-87-19><span class=linenos data-linenos="19 "></span></a>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;
</span><span id=__span-87-20><a id=__codelineno-87-20 name=__codelineno-87-20></a><a href=#__codelineno-87-20><span class=linenos data-linenos="20 "></span></a>
</span><span id=__span-87-21><a id=__codelineno-87-21 name=__codelineno-87-21></a><a href=#__codelineno-87-21><span class=linenos data-linenos="21 "></span></a># 如果被监控的master主机配置了密码，那么需要以下配置进行认证
</span><span id=__span-87-22><a id=__codelineno-87-22 name=__codelineno-87-22></a><a href=#__codelineno-87-22><span class=linenos data-linenos="22 "></span></a># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;
</span><span id=__span-87-23><a id=__codelineno-87-23 name=__codelineno-87-23></a><a href=#__codelineno-87-23><span class=linenos data-linenos="23 "></span></a>
</span><span id=__span-87-24><a id=__codelineno-87-24 name=__codelineno-87-24></a><a href=#__codelineno-87-24><span class=linenos data-linenos="24 "></span></a># 每个哨兵节点通过ping命令来判断数据节点和其它哨兵节点是否可达，如果在下面配置的时间没有收到回复，则判定为不可达，默认30秒
</span><span id=__span-87-25><a id=__codelineno-87-25 name=__codelineno-87-25></a><a href=#__codelineno-87-25><span class=linenos data-linenos="25 "></span></a># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;
</span><span id=__span-87-26><a id=__codelineno-87-26 name=__codelineno-87-26></a><a href=#__codelineno-87-26><span class=linenos data-linenos="26 "></span></a>sentinel down-after-milliseconds mymaster 30000
</span><span id=__span-87-27><a id=__codelineno-87-27 name=__codelineno-87-27></a><a href=#__codelineno-87-27><span class=linenos data-linenos="27 "></span></a>
</span><span id=__span-87-28><a id=__codelineno-87-28 name=__codelineno-87-28></a><a href=#__codelineno-87-28><span class=linenos data-linenos="28 "></span></a># 故障转移时，设置多少个从节点并行发起复制的请求
</span><span id=__span-87-29><a id=__codelineno-87-29 name=__codelineno-87-29></a><a href=#__codelineno-87-29><span class=linenos data-linenos="29 "></span></a># sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;
</span><span id=__span-87-30><a id=__codelineno-87-30 name=__codelineno-87-30></a><a href=#__codelineno-87-30><span class=linenos data-linenos="30 "></span></a>sentinel parallel-syncs mymaster 1
</span><span id=__span-87-31><a id=__codelineno-87-31 name=__codelineno-87-31></a><a href=#__codelineno-87-31><span class=linenos data-linenos="31 "></span></a>
</span><span id=__span-87-32><a id=__codelineno-87-32 name=__codelineno-87-32></a><a href=#__codelineno-87-32><span class=linenos data-linenos="32 "></span></a># 故障转移超时时间，默认3分钟
</span><span id=__span-87-33><a id=__codelineno-87-33 name=__codelineno-87-33></a><a href=#__codelineno-87-33><span class=linenos data-linenos="33 "></span></a># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;
</span><span id=__span-87-34><a id=__codelineno-87-34 name=__codelineno-87-34></a><a href=#__codelineno-87-34><span class=linenos data-linenos="34 "></span></a>sentinel failover-timeout mymaster 180000
</span></code></pre></div> <p>2.启动哨兵</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-88-1><a id=__codelineno-88-1 name=__codelineno-88-1></a><a href=#__codelineno-88-1><span class=linenos data-linenos="1 "></span></a>redis-sentinel sentinel.conf
</span></code></pre></div> <p>可以连接哨兵查看哨兵监控的相关信息</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-89-1><a id=__codelineno-89-1 name=__codelineno-89-1></a><a href=#__codelineno-89-1><span class=linenos data-linenos="1 "></span></a>redis-cli -h &lt;sentinel-ip&gt; -p 26379
</span><span id=__span-89-2><a id=__codelineno-89-2 name=__codelineno-89-2></a><a href=#__codelineno-89-2><span class=linenos data-linenos="2 "></span></a>info sentinel
</span></code></pre></div> <hr> <h4 id=_3><strong>集群</strong><a class=headerlink href=#_3 title="Permanent link">#</a></h4> <p>数据分区是分布式存储的核心，分布式数据库首要解决的问题是把整个数据集按照分区规则映射到多个节点上，即把数据集划分到多个节点上，每个节点只负责整个数据集的一个子集。</p> <p><strong>手动配置集群流程：</strong></p> <p>1.修改配置文件，主要是开启集群模式</p> <p>2.启动6个redis容器，redis01、redis02 ...</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-90-1><a id=__codelineno-90-1 name=__codelineno-90-1></a><a href=#__codelineno-90-1><span class=linenos data-linenos="1 "></span></a>docker run -d -v /root/redis/redis.conf:/data/redis.conf --name redis01 redis redis-server /data/redis.conf
</span><span id=__span-90-2><a id=__codelineno-90-2 name=__codelineno-90-2></a><a href=#__codelineno-90-2><span class=linenos data-linenos="2 "></span></a>...
</span></code></pre></div> <p>3.任意进入一个redis实例的客户端，然后与其它5个节点握手，加入集群中的节点会自动进行协商，所以无需在每一个节点做与其它5个节点握手的动作。</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-91-1><a id=__codelineno-91-1 name=__codelineno-91-1></a><a href=#__codelineno-91-1><span class=linenos data-linenos="1 "></span></a>cluster meet 172.17.0.2 6379
</span><span id=__span-91-2><a id=__codelineno-91-2 name=__codelineno-91-2></a><a href=#__codelineno-91-2><span class=linenos data-linenos="2 "></span></a>...
</span></code></pre></div> <p>4.分别连接节点然后分配slot。节点握手后集群还不能正常工作，因为slot还没有分配，此时集群仍处于下线状态，不能进行数据的读写。</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-92-1><a id=__codelineno-92-1 name=__codelineno-92-1></a><a href=#__codelineno-92-1><span class=linenos data-linenos="1 "></span></a>redis-cli -h 172.17.0.2 cluster addslots {0...5461}
</span><span id=__span-92-2><a id=__codelineno-92-2 name=__codelineno-92-2></a><a href=#__codelineno-92-2><span class=linenos data-linenos="2 "></span></a>redis-cli -h 172.17.0.3 cluster addslots {5462...10922}
</span><span id=__span-92-3><a id=__codelineno-92-3 name=__codelineno-92-3></a><a href=#__codelineno-92-3><span class=linenos data-linenos="3 "></span></a>redis-cli -h 172.17.0.4 cluster addslots {10922...16383}
</span></code></pre></div> <p>5.连接到剩下3台redis主机，让其成为前面3台主机的从机</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-93-1><a id=__codelineno-93-1 name=__codelineno-93-1></a><a href=#__codelineno-93-1><span class=linenos data-linenos="1 "></span></a>redis-cli -h 172.17.0.5 cluster replicate {nodeId}
</span><span id=__span-93-2><a id=__codelineno-93-2 name=__codelineno-93-2></a><a href=#__codelineno-93-2><span class=linenos data-linenos="2 "></span></a>redis-cli -h 172.17.0.6 cluster replicate {nodeId}
</span><span id=__span-93-3><a id=__codelineno-93-3 name=__codelineno-93-3></a><a href=#__codelineno-93-3><span class=linenos data-linenos="3 "></span></a>redis-cli -h 172.17.0.7 cluster replicate {nodeId}
</span></code></pre></div> <p><strong>自动配置集群流程：</strong></p> <p>1.修改配置文件，主要是开启集群模式</p> <p>2.启动6个redis容器，redis01、redis02 ...</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-94-1><a id=__codelineno-94-1 name=__codelineno-94-1></a><a href=#__codelineno-94-1><span class=linenos data-linenos="1 "></span></a>docker run -d -v /root/redis/redis.conf:/data/redis.conf --name redis01 redis redis-server /data/redis.conf
</span><span id=__span-94-2><a id=__codelineno-94-2 name=__codelineno-94-2></a><a href=#__codelineno-94-2><span class=linenos data-linenos="2 "></span></a>...
</span></code></pre></div> <p>3.自动配置集群</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-95-1><a id=__codelineno-95-1 name=__codelineno-95-1></a><a href=#__codelineno-95-1><span class=linenos data-linenos="1 "></span></a>docker exec -it redis01 redis-cli --cluster create --cluster-replicas 1 172.17.0.2:6379 172.17.0.3:6379 172.17.0.4:6379 172.17.0.5:6379 172.17.0.6:6379 172.17.0.7:6379
</span></code></pre></div> <p><strong>常用命令：</strong></p> <p>使用redis-cli客户端连接到redis集群，加 -c 选项表示以集群的方式连接，也就是在设置和读取值时可以根据slot重定向连接到不同的redis服务器上，不加 -c 的话不能重定向，只能设置和读取连接的redis服务器上的slot。</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-96-1><a id=__codelineno-96-1 name=__codelineno-96-1></a><a href=#__codelineno-96-1><span class=linenos data-linenos="1 "></span></a>docker exec -it redis01 redis-cli -c
</span></code></pre></div> <p>查看集群节点之间的关系</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-97-1><a id=__codelineno-97-1 name=__codelineno-97-1></a><a href=#__codelineno-97-1><span class=linenos data-linenos="1 "></span></a>cluster nodes
</span></code></pre></div> <p>查询键所对应的slot</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-98-1><a id=__codelineno-98-1 name=__codelineno-98-1></a><a href=#__codelineno-98-1><span class=linenos data-linenos="1 "></span></a>cluster keyslot &lt;key&gt;
</span></code></pre></div> <p>查询slot中有多少键，要与slot所在的服务器连接才能查询到</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-99-1><a id=__codelineno-99-1 name=__codelineno-99-1></a><a href=#__codelineno-99-1><span class=linenos data-linenos="1 "></span></a>cluster countkeysinslot &lt;slot&gt;
</span></code></pre></div> <p>查询slot中的前count个键</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-100-1><a id=__codelineno-100-1 name=__codelineno-100-1></a><a href=#__codelineno-100-1><span class=linenos data-linenos="1 "></span></a>cluster getkeysinslot &lt;slot&gt; &lt;count&gt;
</span></code></pre></div> <hr> <p><strong>缓存穿透</strong></p> <p>问题描述：恶意用户<strong>高并发访问数据库中不存在的数据</strong>，这时redis中肯定没有也没有这些数据，于是将所有请求都直接交给数据库，造成数据库宕机。</p> <p>解决方案：</p> <p>1.布隆过滤器</p> <p><strong>布隆过滤器可以确定某条数据一定不存在，或者某条数据可能存在。</strong>具体做法是，将数据库中所有数据的键映射到布隆过滤器中，请求过来，首先检查布隆过滤器，如果返回为0，则可以断定数据库中一定没有这条记录，如果返回为1，虽然不能百分之百肯定数据库中一定有这条记录，但也有百分之八九十的概率可能有，于是放行，首先查redis，再查数据库，不保证一定能查到数据。比如数据库键的取值范围是40亿，数据库里有这40亿中的10亿条数据，将这10亿条数据映射到布隆过滤器之后，如果请求的数据是这10亿条数据中的一条，布隆过滤器并不能百分之百确定这条数据一定在数据库中，于是返回1，而对于剩下30亿数据的请求，其中百分之九十数据的请求，布隆过滤器会返回0，即肯定的告诉你数据库中没有这条数据，而对于剩下百分之十数据的请求，布隆过滤器拿不准，会返回1，所以布隆过滤器能拦下30亿*90%的恶意请求。</p> <p>2.拦截ip</p> <p>3.缓存空值</p> <p><strong>缓存击穿</strong></p> <p>问题描述：<strong>热点key突然过期失效</strong>，所有并发请求直接打到数据库上，造成数据宕机</p> <p>解决方案：这里主要是因为过期之后，所有并发请求直接打到数据库上，所以可以采用加锁的办法，只让一个请求去访问数据库，访问完之后将结果缓存到redis中，接着其它请求从redis中取数据。如果是单体应用，直接加互斥锁即可，分布式集群应用就需要加分布式锁。</p> <p><strong>缓存雪崩</strong></p> <p>问题描述：<strong>大面积key同时失效</strong>，也是所有请求直接打数据库上，造成数据库宕机</p> <p>解决方案：随机设置key的失效时间，防止同时失效</p> <p><strong>分布式锁</strong></p> <p>所谓分布式锁，其实就是让多台应用服务器互斥的访问同一个数据，这个数据是所有应用服务器都能访问到的。</p> <p>三种主流的分布式锁： 1.基于数据库 2.基于缓存（redis）等 3.基于zookeeper</p> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../12-nginx/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 12-nginx"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 12-nginx </div> </div> </a> <a href=../14-Stream%20%E5%92%8C%20Optional/ class="md-footer__link md-footer__link--next" aria-label="下一页: 14-Stream 和 Optional"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 14-Stream 和 Optional </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <h2 id=__comments>评论</h2> <!-- Insert generated snippet here --> <script src=https://giscus.app/client.js data-repo=Jmoon531/Jmoon531.github.io data-repo-id=R_kgDOOKeS9Q data-category=Announcements data-category-id=DIC_kwDOOKeS9c4CoWy3 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=zh-CN crossorigin=anonymous async>
</script> <!-- Synchronize Giscus theme with palette --> <script>
  var giscus = document.querySelector("script[src*=giscus]")

  // Set palette on initial load
  var palette = __md_get("__palette")
  if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate"
      ? "transparent_dark"
      : "light"

    // Instruct Giscus to set theme
    giscus.setAttribute("data-theme", theme)
  }

  // Register event handlers after documented loaded
  document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
      var palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate"
          ? "transparent_dark"
          : "light"

        // Instruct Giscus to change theme
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          "https://giscus.app"
        )
      }
    })
  })
</script> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright style="max-width: 100%;"> <div class=md-copyright__highlight style="display: grid;grid-template-columns: 1fr 1fr;"> <span>Copyright &copy; 2025 J-moon</span> <span style="justify-self: end;">Contact me via e-mail: Jmoon531@foxmail.com</span> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.path", "navigation.top", "navigation.indexes", "navigation.prune", "navigation.footer", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=/assets/javascripts/custom.js></script> <script src=/assets/javascripts/katex.js></script> <script src=https://unpkg.com/katex@0/dist/katex.min.js></script> <script src=https://unpkg.com/katex@0/dist/contrib/auto-render.min.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": false, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>